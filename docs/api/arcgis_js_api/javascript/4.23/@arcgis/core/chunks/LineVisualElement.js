/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{b as e,i as t,o as r}from"../core/lang.js";import{tryProjectWithZConversion as s}from"../geometry/projection.js";import{g as i}from"./ElevationProvider.js";import{j as o}from"./mat4.js";import{c as n}from"./mat4f64.js";import{s as a,Z as l,z as h,m as p,b as d}from"./mathUtils.js";import{f,c as u,a as _}from"./vec4f32.js";import{O as c}from"./Object3DVisualElement.js";import{R as m,c as g,a as C}from"./lineUtils.js";import{R as y}from"./Material.js";function w(o,n,a,l=!1){const h=s(o,n);return e(h)?null:(h.hasZ&&!l||!t(a)||(h.z=r(i(a,h),0)),h)}function O(e,t,r){r.warnOnce(`Failed to project analysis geometry (id: '${e.id}'), projection from spatial reference (wkid: '${t.wkid}') to view spatial reference is not supported. Projection may be possible after calling projection.load().`)}class P extends c{constructor(e){super(e),this._renderOccluded=y.OccludeAndTransparent,this._width=1,this._color=f(1,0,1,1),this._innerWidth=1,this._innerColor=null,this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._writeDepthEnabled=!0,this._falloff=0,this._polygonOffset=!1,this.applyProps(e)}setGeometryFromRenderSpacePoint(e){const t=1e3,r=[];r.push([[e[0]-t,e[1]+0,e[2]+0],[e[0]+t,e[1]+0,e[2]+0]]),r.push([[e[0]-0,e[1]-t,e[2]+0],[e[0]+0,e[1]+t,e[2]+0]]),r.push([[e[0]-0,e[1]+0,e[2]-t],[e[0]+0,e[1]+0,e[2]+t]]),this.geometry=r}setGeometryFromExtent(e){const t=this.view.spatialReference,r=d(),s=d(),i=100,o=[];a(r,e[0],e[1],i),this.view.renderCoordsHelper.toRenderCoords(r,t,s),o.push([s[0],s[1],s[2]]),a(r,e[2],e[1],i),this.view.renderCoordsHelper.toRenderCoords(r,t,s),o.push([s[0],s[1],s[2]]),a(r,e[2],e[3],i),this.view.renderCoordsHelper.toRenderCoords(r,t,s),o.push([s[0],s[1],s[2]]),a(r,e[0],e[3],i),this.view.renderCoordsHelper.toRenderCoords(r,t,s),o.push([s[0],s[1],s[2]]),a(r,e[0],e[1],i),this.view.renderCoordsHelper.toRenderCoords(r,t,s),o.push([s[0],s[1],s[2]]),a(r,e[0],e[1],i),this.view.renderCoordsHelper.toRenderCoords(r,t,s),o.push([s[0],s[1],s[2]]),this.geometry=[o]}setGeometryFromFrustum(e){const t=[];e.lines.forEach((e=>{t.push([e.origin[0],e.origin[1],e.origin[2]]),t.push([e.endpoint[0],e.endpoint[1],e.endpoint[2]])})),this.geometry=[t]}setGeometryFromBoundedPlane(e){const t=[],r=e.origin,s=e.basis1,i=e.basis2,o=.5,n=d(),a=d(),l=d(),h=d();n[0]=r[0]-s[0]*o-i[0]*o,n[1]=r[1]-s[1]*o-i[1]*o,n[2]=r[2]-s[2]*o-i[2]*o,a[0]=r[0]-s[0]*o+i[0]*o,a[1]=r[1]-s[1]*o+i[1]*o,a[2]=r[2]-s[2]*o+i[2]*o,l[0]=r[0]+s[0]*o+i[0]*o,l[1]=r[1]+s[1]*o+i[1]*o,l[2]=r[2]+s[2]*o+i[2]*o,h[0]=r[0]+s[0]*o-i[0]*o,h[1]=r[1]+s[1]*o-i[1]*o,h[2]=r[2]+s[2]*o-i[2]*o,t.push([n[0],n[1],n[2]]),t.push([a[0],a[1],a[2]]),t.push([l[0],l[1],l[2]]),t.push([h[0],h[1],h[2]]),t.push([n[0],n[1],n[2]]),this.geometry=[t]}setGeometryFromSegment(e){const t=e.endRenderSpace;this.transform=o(E,t);const{points:r}=e.createRenderGeometry(t,this.view.renderCoordsHelper);this.geometry=[r]}setGeometryFromSegments(e,t=l){this.transform=o(E,t),this.geometry=e.map((e=>e.createRenderGeometry(t,this.view.renderCoordsHelper).points))}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){h(e,this._color)||(p(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(r){t(r)?!e(this._innerColor)&&h(r,this._innerColor)||(this._innerColor=p(u(),r),this._updateMaterial()):t(this._innerColor)&&(this._innerColor=null,this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const r=t(e)!==t(this._stipplePattern);this._stipplePattern=e,r?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(r){(e(r)||e(this._stippleOffColor)||!h(r,this._stippleOffColor))&&(this._stippleOffColor=t(r)?_(r):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){this._stipplePreferContinuous!==e&&(this._stipplePreferContinuous=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}createExternalResources(){this._material=new m(this.materialParameters)}destroyExternalResources(){this._material=null}createGeometries(e){const t=this._createLineGeometries();if(0!==t.length)for(let r=0;r<t.length;++r){const s=g(t[r]);e.addGeometry(s,this._material)}}forEachExternalMaterial(e){e(this._material)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,isClosed:!1,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,polygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}_updateMaterial(){this.attached&&this._material.setParameters(this.materialParameters)}_createLineGeometries(){const t=this.geometry;if(e(t)||0===t.length)return[];const r=[];return t.forEach((e=>{const t=e.length,s=new Float64Array(3*t);e.forEach(((e,t)=>{s[3*t+0]=e[0],s[3*t+1]=e[1],s[3*t+2]=e[2]}));const i={overlayInfo:null,attributeData:{position:s},removeDuplicateStartEnd:C.KEEP};r.push(i)})),r}}const E=n();export{P as L,w as a,O as l};
