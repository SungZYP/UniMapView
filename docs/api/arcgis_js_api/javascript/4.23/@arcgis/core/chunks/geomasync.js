/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{version as n}from"../kernel.js";import{m as t,o as r,p as e,q as o,s as i,t as s,u as l}from"./arcadeUtils.js";import{z as u,p as a,j as c,h as f,l as m,o as p,x as g,R as d,n as h,C as w,B as y,D as A,f as j,g as E}from"./languageUtils.js";import{resolve as I}from"../core/promiseUtils.js";import F from"../geometry/Extent.js";import R from"../geometry/Geometry.js";import{disjoint as b,intersects as x,touches as N,crosses as S,within as U,contains as k,overlaps as z,equals as O,relate as M,intersect as P,union as C,difference as Z,symmetricDifference as D,clip as T,cut as v,planarArea as L,geodesicArea as q,planarLength as J,geodesicLength as V,distance as W,densify as B,geodesicDensify as G,generalize as H,buffer as K,geodesicBuffer as Q,offset as X,rotate as Y,simplify as $,isSimple as _}from"../geometry/geometryEngineAsync.js";import nn from"../geometry/Multipoint.js";import tn from"../geometry/Point.js";import rn from"../geometry/Polygon.js";import en from"../geometry/Polyline.js";import{fromJSON as on}from"../geometry/support/jsonUtils.js";import{g as sn}from"./unitUtils.js";import"../core/lang.js";import"../core/urlUtils.js";import"../config.js";import"./object.js";import"../core/Error.js";import"./Logger.js";import"./string.js";import"./featureConversionUtils.js";import"./OptimizedFeature.js";import"./OptimizedFeatureSet.js";import"./locale.js";import"./datetime.js";import"./number3.js";import"../geometry/SpatialReference.js";import"./tslib.es6.js";import"./JSONSupport.js";import"../core/Accessor.js";import"./deprecate.js";import"./get.js";import"./utils.js";import"./handleUtils.js";import"../core/accessorSupport/decorators/subclass.js";import"./metadata.js";import"./tracking.js";import"./ensureType.js";import"./ArrayPool.js";import"../core/accessorSupport/decorators/property.js";import"./watch.js";import"../core/scheduling.js";import"./nextTick.js";import"./writer.js";import"./sizeVariableUtils.js";import"../layers/support/Field.js";import"./jsonMap.js";import"./enumeration.js";import"./reader.js";import"./domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"./fieldType.js";import"../geometry/support/webMercatorUtils.js";import"./Ellipsoid.js";import"../core/accessorSupport/decorators/cast.js";import"../geometry.js";import"./typeUtils.js";import"./zmUtils.js";import"./extentUtils.js";import"../core/workers/workers.js";import"../core/workers/Connection.js";import"../core/workers/RemoteClient.js";import"./assets.js";import"../request.js";import"../intl.js";import"./number.js";import"./messages.js";import"./projectionEllipsoid.js";function ln(t){return 0===n.indexOf("4.")?rn.fromExtent(t):new rn({spatialReference:t.spatialReference,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]})}function un(n){if(a(n,2,2),n[0]instanceof R&&n[1]instanceof R);else if(n[0]instanceof R&&null===n[1]);else if(n[1]instanceof R&&null===n[0]);else if(null!==n[0]||null!==n[1])throw new Error("Illegal Argument")}function an(n,t){if("polygon"!==n.type&&"polyline"!==n.type&&"extent"!==n.type)return I(0);let r=1;if(n.spatialReference.vcsWkid||n.spatialReference.latestVcsWkid){r=s(n.spatialReference)/sn(n.spatialReference)}let e=0;if("polyline"===n.type)for(const t of n.paths)for(let n=1;n<t.length;n++)e+=l(t[n],t[n-1],r);else if("polygon"===n.type)for(const t of n.rings){for(let n=1;n<t.length;n++)e+=l(t[n],t[n-1],r);(t[0][0]!==t[t.length-1][0]||t[0][1]!==t[t.length-1][1]||void 0!==t[0][2]&&t[0][2]!==t[t.length-1][2])&&(e+=l(t[0],t[t.length-1],r))}else"extent"===n.type&&(e+=2*l([n.xmin,n.ymin,0],[n.xmax,n.ymin,0],r),e+=2*l([n.xmin,n.ymin,0],[n.xmin,n.ymax,0],r),e*=2,e+=4*Math.abs(h(n.zmax,0)*r-h(n.zmin,0)*r));const o=new en({hasZ:!1,hasM:!1,spatialReference:n.spatialReference,paths:[[0,0],[0,e]]});return J(o,t)}function cn(n){"async"===n.mode&&(n.functions.disjoint=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){return un(r=u(r)),null===r[0]||null===r[1]||b(r[0],r[1])}))},n.functions.intersects=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){return un(r=u(r)),null!==r[0]&&null!==r[1]&&x(r[0],r[1])}))},n.functions.touches=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){return un(r=u(r)),null!==r[0]&&null!==r[1]&&N(r[0],r[1])}))},n.functions.crosses=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){return un(r=u(r)),null!==r[0]&&null!==r[1]&&S(r[0],r[1])}))},n.functions.within=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){return un(r=u(r)),null!==r[0]&&null!==r[1]&&U(r[0],r[1])}))},n.functions.contains=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){return un(r=u(r)),null!==r[0]&&null!==r[1]&&k(r[0],r[1])}))},n.functions.overlaps=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){return un(r=u(r)),null!==r[0]&&null!==r[1]&&z(r[0],r[1])}))},n.functions.equals=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){return a(r,2,2),r[0]===r[1]||(r[0]instanceof R&&r[1]instanceof R?O(r[0],r[1]):!(!c(r[0])||!c(r[1]))&&r[0].getTime()===r[1].getTime())}))},n.functions.relate=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){if(r=u(r),a(r,3,3),r[0]instanceof R&&r[1]instanceof R)return M(r[0],r[1],f(r[2]));if(r[0]instanceof R&&null===r[1])return!1;if(r[1]instanceof R&&null===r[0])return!1;if(null===r[0]&&null===r[1])return!1;throw new Error("Illegal Argument")}))},n.functions.intersection=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){return un(r=u(r)),null===r[0]||null===r[1]?null:P(r[0],r[1])}))},n.functions.union=function(r,e){return n.standardFunctionAsync(r,e,(function(n,e,o){const i=[];if(0===(o=u(o)).length)throw new Error("Function called with wrong number of Parameters");if(1===o.length)if(m(o[0])){const n=u(o[0]);for(let t=0;t<n.length;t++)if(null!==n[t]){if(!(n[t]instanceof R))throw new Error("Illegal Argument");i.push(n[t])}}else{if(!p(o[0])){if(o[0]instanceof R)return g(t(o[0]),r.spatialReference);if(null===o[0])return null;throw new Error("Illegal Argument")}{const n=u(o[0].toArray());for(let t=0;t<n.length;t++)if(null!==n[t]){if(!(n[t]instanceof R))throw new Error("Illegal Argument");i.push(n[t])}}}else for(let n=0;n<o.length;n++)if(null!==o[n]){if(!(o[n]instanceof R))throw new Error("Illegal Argument");i.push(o[n])}return 0===i.length?null:C(i)}))},n.functions.difference=function(r,e){return n.standardFunctionAsync(r,e,(function(n,r,e){return un(e=u(e)),null!==e[0]&&null===e[1]?t(e[0]):null===e[0]?null:Z(e[0],e[1])}))},n.functions.symmetricdifference=function(r,e){return n.standardFunctionAsync(r,e,(function(n,r,e){return un(e=u(e)),null===e[0]&&null===e[1]?null:null===e[0]?t(e[1]):null===e[1]?t(e[0]):D(e[0],e[1])}))},n.functions.clip=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){if(r=u(r),a(r,2,2),!(r[1]instanceof F)&&null!==r[1])throw new Error("Illegal Argument");if(null===r[0])return null;if(!(r[0]instanceof R))throw new Error("Illegal Argument");return null===r[1]?null:T(r[0],r[1])}))},n.functions.cut=function(r,e){return n.standardFunctionAsync(r,e,(function(n,r,e){if(e=u(e),a(e,2,2),!(e[1]instanceof en)&&null!==e[1])throw new Error("Illegal Argument");if(null===e[0])return[];if(!(e[0]instanceof R))throw new Error("Illegal Argument");return null===e[1]?[t(e[0])]:v(e[0],e[1])}))},n.functions.area=function(t,e){return n.standardFunctionAsync(t,e,(function(n,e,o){if(a(o,1,2),null===(o=u(o))[0])return 0;if(d(o[0]))return o[0].sumArea(r(h(o[1],-1)),!1,t.abortSignal).then((n=>{if(t.abortSignal.aborted)throw new Error("Operation has been cancelled.");return n}));if(m(o[0])||p(o[0])){const n=w(o[0],t.spatialReference);return null===n?0:L(n,r(h(o[1],-1)))}if(!(o[0]instanceof R))throw new Error("Illegal Argument");return L(o[0],r(h(o[1],-1)))}))},n.functions.areageodetic=function(t,e){return n.standardFunctionAsync(t,e,(function(n,e,o){if(a(o,1,2),null===(o=u(o))[0])return 0;if(d(o[0]))return o[0].sumArea(r(h(o[1],-1)),!0,t.abortSignal).then((n=>{if(t.abortSignal.aborted)throw new Error("Operation has been cancelled.");return n}));if(m(o[0])||p(o[0])){const n=w(o[0],t.spatialReference);return null===n?0:q(n,r(h(o[1],-1)))}if(!(o[0]instanceof R))throw new Error("Illegal Argument");return q(o[0],r(h(o[1],-1)))}))},n.functions.length=function(t,r){return n.standardFunctionAsync(t,r,(function(n,r,o){if(a(o,1,2),null===(o=u(o))[0])return 0;if(d(o[0]))return o[0].sumLength(e(h(o[1],-1)),!1,t.abortSignal).then((n=>{if(t.abortSignal.aborted)throw new Error("Operation has been cancelled.");return n}));if(m(o[0])||p(o[0])){const n=y(o[0],t.spatialReference);return null===n?0:J(n,e(h(o[1],-1)))}if(!(o[0]instanceof R))throw new Error("Illegal Argument");return J(o[0],e(h(o[1],-1)))}))},n.functions.length3d=function(t,r){return n.standardFunctionAsync(t,r,(function(n,r,o){if(a(o,1,2),null===(o=u(o))[0])return 0;if(m(o[0])||p(o[0])){const n=y(o[0],t.spatialReference);return null===n?0:!0===n.hasZ?an(n,e(h(o[1],-1))):J(n,e(h(o[1],-1)))}if(!(o[0]instanceof R))throw new Error("Illegal Argument");return!0===o[0].hasZ?an(o[0],e(h(o[1],-1))):J(o[0],e(h(o[1],-1)))}))},n.functions.lengthgeodetic=function(t,r){return n.standardFunctionAsync(t,r,(function(n,r,o){if(a(o,1,2),null===(o=u(o))[0])return 0;if(d(o[0]))return o[0].sumLength(e(h(o[1],-1)),!0,t.abortSignal).then((n=>{if(t.abortSignal.aborted)throw new Error("Operation has been cancelled.");return n}));if(m(o[0])||p(o[0])){const n=y(o[0],t.spatialReference);return null===n?0:V(n,e(h(o[1],-1)))}if(!(o[0]instanceof R))throw new Error("Illegal Argument");return V(o[0],e(h(o[1],-1)))}))},n.functions.distance=function(t,r){return n.standardFunctionAsync(t,r,(function(n,r,o){o=u(o),a(o,2,3);let i=o[0];(m(o[0])||p(o[0]))&&(i=A(o[0],t.spatialReference));let s=o[1];if((m(o[1])||p(o[1]))&&(s=A(o[1],t.spatialReference)),!(i instanceof R))throw new Error("Illegal Argument");if(!(s instanceof R))throw new Error("Illegal Argument");return W(i,s,e(h(o[2],-1)))}))},n.functions.distancegeodetic=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){r=u(r),a(r,2,3);const o=r[0],i=r[1];if(!(o instanceof tn))throw new Error("Illegal Argument");if(!(i instanceof tn))throw new Error("Illegal Argument");const s=new en({paths:[],spatialReference:o.spatialReference});return s.addPath([o,i]),V(s,e(h(r[2],-1)))}))},n.functions.densify=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){if(r=u(r),a(r,2,3),null===r[0])return null;if(!(r[0]instanceof R))throw new Error("Illegal Argument");const o=j(r[1]);if(isNaN(o))throw new Error("Illegal Argument");if(o<=0)throw new Error("Illegal Argument");return r[0]instanceof rn||r[0]instanceof en?B(r[0],o,e(h(r[2],-1))):r[0]instanceof F?B(ln(r[0]),o,e(h(r[2],-1))):r[0]}))},n.functions.densifygeodetic=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){if(r=u(r),a(r,2,3),null===r[0])return null;if(!(r[0]instanceof R))throw new Error("Illegal Argument");const o=j(r[1]);if(isNaN(o))throw new Error("Illegal Argument");if(o<=0)throw new Error("Illegal Argument");return r[0]instanceof rn||r[0]instanceof en?G(r[0],o,e(h(r[2],-1))):r[0]instanceof F?G(ln(r[0]),o,e(h(r[2],-1))):r[0]}))},n.functions.generalize=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){if(r=u(r),a(r,2,4),null===r[0])return null;if(!(r[0]instanceof R))throw new Error("Illegal Argument");const o=j(r[1]);if(isNaN(o))throw new Error("Illegal Argument");return H(r[0],o,E(h(r[2],!0)),e(h(r[3],-1)))}))},n.functions.buffer=function(r,o){return n.standardFunctionAsync(r,o,(function(n,r,o){if(o=u(o),a(o,2,3),null===o[0])return null;if(!(o[0]instanceof R))throw new Error("Illegal Argument");const i=j(o[1]);if(isNaN(i))throw new Error("Illegal Argument");return 0===i?t(o[0]):K(o[0],i,e(h(o[2],-1)))}))},n.functions.buffergeodetic=function(r,o){return n.standardFunctionAsync(r,o,(function(n,r,o){if(o=u(o),a(o,2,3),null===o[0])return null;if(!(o[0]instanceof R))throw new Error("Illegal Argument");const i=j(o[1]);if(isNaN(i))throw new Error("Illegal Argument");return 0===i?t(o[0]):Q(o[0],i,e(h(o[2],-1)))}))},n.functions.offset=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){if(r=u(r),a(r,2,6),null===r[0])return null;if(!(r[0]instanceof rn||r[0]instanceof en))throw new Error("Illegal Argument");const o=j(r[1]);if(isNaN(o))throw new Error("Illegal Argument");const i=j(h(r[4],10));if(isNaN(i))throw new Error("Illegal Argument");const s=j(h(r[5],0));if(isNaN(s))throw new Error("Illegal Argument");return X(r[0],o,e(h(r[2],-1)),f(h(r[3],"round")).toLowerCase(),i,s)}))},n.functions.rotate=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){r=u(r),a(r,2,3);let e=r[0];if(null===e)return null;if(!(e instanceof R))throw new Error("Illegal Argument");e instanceof F&&(e=rn.fromExtent(e));const o=j(r[1]);if(isNaN(o))throw new Error("Illegal Argument");const i=h(r[2],null);if(null===i)return Y(e,o);if(i instanceof tn)return Y(e,o,i);throw new Error("Illegal Argument")}))},n.functions.centroid=function(r,e){return n.standardFunctionAsync(r,e,(function(n,e,s){if(s=u(s),a(s,1,1),null===s[0])return null;let l=s[0];if((m(s[0])||p(s[0]))&&(l=A(s[0],r.spatialReference)),null===l)return null;if(!(l instanceof R))throw new Error("Illegal Argument");return l instanceof tn?g(t(s[0]),r.spatialReference):l instanceof rn?l.centroid:l instanceof en?o(l):l instanceof nn?i(l):l instanceof F?l.center:null}))},n.functions.multiparttosinglepart=function(r,e){return n.standardFunctionAsync(r,e,(function(n,e,o){o=u(o),a(o,1,1);const i=[];if(null===o[0])return null;if(!(o[0]instanceof R))throw new Error("Illegal Argument");if(o[0]instanceof tn)return[g(t(o[0]),r.spatialReference)];if(o[0]instanceof F)return[g(t(o[0]),r.spatialReference)];return $(o[0]).then((n=>{if(n instanceof rn){const t=[],r=[];for(let e=0;e<n.rings.length;e++)if(n.isClockwise(n.rings[e])){const r=on({rings:[n.rings[e]],hasZ:!0===n.hasZ,hazM:!0===n.hasM,spatialReference:n.spatialReference.toJSON()});t.push(r)}else r.push({ring:n.rings[e],pt:n.getPoint(e,0)});for(let n=0;n<r.length;n++)for(let e=0;e<t.length;e++)if(t[e].contains(r[n].pt)){t[e].addRing(r[n].ring);break}return t}if(n instanceof en){const t=[];for(let r=0;r<n.paths.length;r++){const e=on({paths:[n.paths[r]],hasZ:!0===n.hasZ,hazM:!0===n.hasM,spatialReference:n.spatialReference.toJSON()});t.push(e)}return t}if(o[0]instanceof nn){const n=g(t(o[0]),r.spatialReference);for(let t=0;t<n.points.length;t++)i.push(n.getPoint(t));return i}return null}))}))},n.functions.issimple=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){if(r=u(r),a(r,1,1),null===r[0])return!0;if(!(r[0]instanceof R))throw new Error("Illegal Argument");return _(r[0])}))},n.functions.simplify=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){if(r=u(r),a(r,1,1),null===r[0])return null;if(!(r[0]instanceof R))throw new Error("Illegal Argument");return $(r[0])}))})}export{cn as registerFunctions};
