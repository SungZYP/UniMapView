/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import"../core/lang.js";import{L as s}from"./Logger.js";import{q as n,p as i,b as t,j as a,d as o,l as r,e,f as c,s as u,u as g,x as b,i as l,h as f,y as p,v as m,n as d,o as h}from"./mathUtils.js";import{O as I,s as j}from"./vectorStacks.js";import{g as P,h as N,e as w}from"./mat4.js";import{c as M}from"./mat4f64.js";import{p as v,A as T}from"./sphere.js";import{c as y,p as A,d as S}from"./lineSegment.js";import{c as _,a as x,n as V,b as E,w as O,d as Y,e as q,i as B,g as F,h as L,p as U,s as k}from"./plane.js";import{d as C}from"./ray.js";const R=s.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class z{constructor(){this.plane=_(),this.origin=t(),this.basis1=t(),this.basis2=t()}}function G(s=fs){return{plane:_(s.plane),origin:i(s.origin),basis1:i(s.basis1),basis2:i(s.basis2)}}function W(s,n=G()){return Z(s.origin,s.basis1,s.basis2,n)}function X(s,n){a(n.origin,s.origin),a(n.basis1,s.basis1),a(n.basis2,s.basis2),Y(n.plane,s.plane)}function Z(s,n,i,t=G()){return a(t.origin,s),a(t.basis1,n),a(t.basis2,i),D(t),function(s,n){Math.abs(o(s.basis1,s.basis2)/(r(s.basis1)*r(s.basis2)))>1e-6&&R.warn(n,"Provided basis vectors are not perpendicular");Math.abs(o(s.basis1,cs(s)))>1e-6&&R.warn(n,"Basis vectors and plane normal are not perpendicular");Math.abs(-o(cs(s),s.origin)-s.plane[3])>1e-6&&R.warn(n,"Plane offset is not consistent with plane origin")}(t,"fromValues()"),t}function D(s){x(s.basis2,s.basis1,s.origin,s.plane)}function H(s,n,i){s!==i&&W(s,i);const t=e(j.get(),cs(s),n);return c(i.origin,i.origin,t),i.plane[3]-=n,i}function J(s,n=G()){const i=(s[2]-s[0])/2,t=(s[3]-s[1])/2;return u(n.origin,s[0]+i,s[1]+t,0),u(n.basis1,i,0,0),u(n.basis2,0,t,0),q(0,0,1,0,n.plane),n}function K(s,n,i){return!!B(s.plane,n,i)&&us(s,i)}function Q(s,n,i){const t=ps.get();ls(s,n,t,ps.get());let r=Number.POSITIVE_INFINITY;for(const e of Is){const c=bs(s,e,ms.get()),u=j.get();if(F(t,c,u)){const s=b(j.get(),n.origin,u),t=Math.abs(l(o(n.direction,s)));t<r&&(r=t,a(i,u))}}return r===Number.POSITIVE_INFINITY?$(s,n,i):i}function $(s,n,i){if(K(s,n,i))return i;const t=ps.get(),o=ps.get();ls(s,n,t,o);let r=Number.POSITIVE_INFINITY;for(const e of Is){const c=bs(s,e,ms.get()),u=j.get();if(L(t,c,u)){const s=C(n,u);if(!E(o,u))continue;s<r&&(r=s,a(i,u))}}return is(s,n.origin)<r&&ss(s,n.origin,i),i}function ss(s,n,i){const t=U(s.plane,n,j.get()),a=A(gs(s,s.basis1),t,-1,1,j.get()),o=A(gs(s,s.basis2),t,-1,1,j.get());return f(i,c(j.get(),a,o),s.origin),i}function ns(s,n,i){const{origin:t,basis1:a,basis2:o}=s,r=f(j.get(),n,t),e=v(a,r),c=v(o,r),g=v(cs(s),r);return u(i,e,c,g)}function is(s,n){const i=ns(s,n,j.get()),{basis1:t,basis2:a}=s,o=r(t),e=r(a),c=Math.max(Math.abs(i[0])-o,0),u=Math.max(Math.abs(i[1])-e,0),g=i[2];return c*c+u*u+g*g}function ts(s,n){return Math.sqrt(is(s,n))}function as(s,n){return E(s.plane,n)&&us(s,n)}function os(s,n){const i=-s.plane[3];return v(cs(s),n)-i}function rs(s,n,i){return s!==i&&W(s,i),P(js,n),N(js,js),m(i.basis1,s.basis1,js),m(i.basis2,s.basis2,js),m(V(i.plane),V(s.plane),js),m(i.origin,s.origin,n),k(i.plane,i.plane,i.origin),i}function es(s,n,i,t){return s!==t&&W(s,t),w(Ps,n,i),m(t.basis1,s.basis1,Ps),m(t.basis2,s.basis2,Ps),D(t),t}function cs(s){return V(s.plane)}function us(s,n){const i=f(j.get(),n,s.origin),t=h(s.basis1),a=h(s.basis2),r=o(s.basis1,i),e=o(s.basis2,i);return-r-t<0&&r-t<0&&-e-a<0&&e-a<0}function gs(s,n){const i=ms.get();return a(i.origin,s.origin),a(i.vector,n),i}function bs(s,n,i){const{basis1:t,basis2:a,origin:o}=s,r=e(j.get(),t,n.origin[0]),u=e(j.get(),a,n.origin[1]);c(i.origin,r,u),c(i.origin,i.origin,o);const g=e(j.get(),t,n.direction[0]),b=e(j.get(),a,n.direction[1]);return e(i.vector,c(g,g,b),2),i}function ls(s,n,i,t){const a=cs(s);x(a,n.direction,n.origin,i),x(V(i),a,n.origin,t)}const fs={plane:_(),origin:n(0,0,0),basis1:n(1,0,0),basis2:n(0,1,0)},ps=new I(_),ms=new I(y),ds=t(),hs=new I((()=>({origin:null,basis1:null,basis2:null,plane:null}))),Is=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],js=M(),Ps=M(),Ns=Object.freeze({__proto__:null,BoundedPlaneClass:z,create:G,wrap:function(s,n,i){const t=hs.get();return t.origin=s,t.basis1=n,t.basis2=i,t.plane=O(0,0,0,0),D(t),t},copy:W,copyWithoutVerify:X,fromValues:Z,updateUnboundedPlane:D,elevate:H,setExtent:function(s,n,i){return J(n,i),H(i,os(s,s.origin),i),i},fromAABoundingRect:J,intersectRay:K,intersectRayClosestSilhouette:function(s,n,i){if(K(s,n,i))return i;const t=Q(s,n,j.get());return c(i,n.origin,e(j.get(),n.direction,g(n.origin,t)/r(n.direction))),i},closestPointOnSilhouette:Q,closestPoint:$,projectPoint:ss,projectPointLocal:ns,distance2:is,distance:ts,distanceToSilhouette:function(s,n){let i=Number.NEGATIVE_INFINITY;for(const t of Is){const a=bs(s,t,ms.get()),o=S(a,n);o>i&&(i=o)}return Math.sqrt(i)},extrusionContainsPoint:as,axisAt:function(s,n,i,t){return function(s,n,i){switch(n){case T.X:a(i,s.basis1),d(i,i);break;case T.Y:a(i,s.basis2),d(i,i);break;case T.Z:a(i,cs(s))}return i}(s,i,t)},altitudeAt:os,setAltitudeAt:function(s,n,i,t){const a=os(s,n),o=e(ds,cs(s),i-a);return c(t,n,o),t},equals:function(s,n){return p(s.basis1,n.basis1)&&p(s.basis2,n.basis2)&&p(s.origin,n.origin)},transform:rs,rotate:es,normal:cs,UP:fs});export{z as B,W as a,Ns as b,G as c,X as d,as as e,Z as f,ts as g,J as h,K as i,cs as n,es as r,rs as t,D as u};
