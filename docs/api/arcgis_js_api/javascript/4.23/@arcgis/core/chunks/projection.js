/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{L as r}from"./Logger.js";import{b as e}from"../core/lang.js";import{f as o,t,a,i as n}from"./mat3.js";import{b as f}from"./quatf64.js";import{c as s}from"./mat4f64.js";import{E as m,n as i,b as y}from"./mathUtils.js";import{projectBuffer as p,computeTranslationToOriginAndRotation as c}from"../geometry/projection.js";import{a as u}from"./projectionEllipsoid.js";import{l as P,f as T,h as l}from"../geometry/SpatialReference.js";import{y2lat as A}from"../geometry/support/webMercatorUtils.js";import{B as F,e as d}from"./BufferView.js";import{t as E,a as g,n as C}from"./vec3.js";const _=r.getLogger("esri.geometry.support.meshUtils.normalProjection");function j(r,e,o,t,a){return S(t)?(B(Y.TO_PCPF,F.fromTypedArray(r),d.fromTypedArray(e),d.fromTypedArray(o),t,F.fromTypedArray(a)),a):(_.error("Cannot convert spatial reference to PCPF"),a)}function M(r,e,o,t,a){return S(t)?(B(Y.FROM_PCPF,F.fromTypedArray(r),d.fromTypedArray(e),d.fromTypedArray(o),t,F.fromTypedArray(a)),a):(_.error("Cannot convert to spatial reference from PCPF"),a)}function O(r,e,o){return p(r,e,0,o,u(e),0,r.length/3),o}function R(r,e,o){return p(r,u(o),0,e,o,0,r.length/3),e}function h(r,o,t){if(e(r))return o;const a=d.fromTypedArray(r),n=d.fromTypedArray(o);return E(n,a,t),o}function L(r,o,t){if(e(r))return o;a(q,t);const f=F.fromTypedArray(r),s=F.fromTypedArray(o);return g(s,f,q),n(q)||C(s,s),o}function V(r,o,t){if(e(r))return o;a(q,t);const f=F.fromTypedArray(r,4*Float32Array.BYTES_PER_ELEMENT),s=F.fromTypedArray(o,4*Float32Array.BYTES_PER_ELEMENT);if(g(s,f,q),n(q)||C(s,s),r!==o)for(let e=3;e<r.length;e+=4)o[e]=r[e];return o}function b(r,e,o,t,a){if(!S(t))return _.error("Cannot convert spatial reference to PCPF"),a;B(Y.TO_PCPF,F.fromTypedArray(r,4*Float32Array.BYTES_PER_ELEMENT),d.fromTypedArray(e),d.fromTypedArray(o),t,F.fromTypedArray(a,4*Float32Array.BYTES_PER_ELEMENT));for(let e=3;e<r.length;e+=4)a[e]=r[e];return a}function v(r,e,o,t,a){if(!S(t))return _.error("Cannot convert to spatial reference from PCPF"),a;B(Y.FROM_PCPF,F.fromTypedArray(r,16),d.fromTypedArray(e),d.fromTypedArray(o),t,F.fromTypedArray(a,16));for(let e=3;e<r.length;e+=4)a[e]=r[e];return a}function B(r,e,a,n,f,s){if(!e)return;const y=a.count,p=u(f);if(N(f))for(let a=0;a<y;a++)n.getVec(a,U),e.getVec(a,w),c(p,U,W,p),o(q,W),r===Y.FROM_PCPF&&t(q,q),m(w,w,q),s.setVec(a,w);else for(let f=0;f<y;f++){n.getVec(f,U),e.getVec(f,w),c(p,U,W,p),o(q,W);const y=A(a.get(f,1));let u=Math.cos(y);r===Y.TO_PCPF&&(u=1/u),q[0]*=u,q[1]*=u,q[2]*=u,q[3]*=u,q[4]*=u,q[5]*=u,r===Y.FROM_PCPF&&t(q,q),m(w,w,q),i(w,w),s.setVec(f,w)}return s}function S(r){return N(r)||function(r){return r.isWebMercator}(r)}function N(r){return r.isWGS84||P(r)||T(r)||l(r)}var Y;!function(r){r[r.TO_PCPF=0]="TO_PCPF",r[r.FROM_PCPF=1]="FROM_PCPF"}(Y||(Y={}));const U=y(),w=y(),W=s(),q=f();export{j as a,b,R as c,M as d,v as e,L as f,V as g,O as p,h as t};
