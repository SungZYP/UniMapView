/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{i as e}from"../core/lang.js";import t from"../core/Error.js";import n from"../geometry/HeightModelInfo.js";import{p as i}from"./arcgisLayerUrl.js";function r(e,i){if(!e)return null;if(!s(e))return new t("webscene:unsupported-height-model-info","The vertical coordinate system of the scene is not supported",{heightModelInfo:e});const r=e.heightUnit,o=n.deriveUnitFromSR(e,i).heightUnit;return r!==o?new t("webscene:incompatible-height-unit",`The vertical units of the scene (${r}) must match the horizontal units of the scene (${o})`,{verticalUnit:r,horizontalUnit:o}):null}function o(e,i,r){const o=c(e),l=i,h=function(e,t,n){if(!s(e)||!s(t))return a.Unsupported;if(null==e||null==t)return a.Ok;if(!n&&e.heightUnit!==t.heightUnit)return a.Units;if(e.heightModel!==t.heightModel)return a.HeightModel;switch(e.heightModel){case"gravity-related-height":return a.Ok;case"ellipsoidal":return e.vertCRS===t.vertCRS?a.Ok:a.CRS;default:return a.Unsupported}}(o,l,r);if(o){const i=n.deriveUnitFromSR(o,e.spatialReference).heightUnit;if(!r&&i!==o.heightUnit){const e=new t("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${i})`,{horizontalUnit:i});return new t("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:o,error:e})}}if(!function(e){return"heightModelInfo"in e&&null!=e.heightModelInfo||null!=e.spatialReference||!u(e)}(e)||h===a.Unsupported)return new t("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:o});switch(h){case a.Units:{const e=o.heightUnit||"unknown",n=l.heightUnit||"unknown",i=new t("layerview:incompatible-height-unit",`The vertical units of the layer (${e}) must match the vertical units of the scene (${n})`,{layerUnit:e,sceneUnit:n});return new t("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:o,sceneHeightModelInfo:l,error:i})}case a.HeightModel:{const e=o.heightModel||"unknown",n=l.heightModel||"unknown",i=new t("layerview:incompatible-height-model",`The height model of the layer (${e}) must match the height model of the scene (${n})`,{layerHeightModel:e,sceneHeightModel:n});return new t("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:o,sceneHeightModelInfo:l,error:i})}case a.CRS:{const e=o.vertCRS||"unknown",n=l.vertCRS||"unknown",i=new t("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${e}) must match the vertical datum of the scene (${n})`,{layerDatum:e,sceneDatum:n});return new t("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:o,sceneHeightModelInfo:l,error:i})}}return null}var a;function s(e){return null==e||null!=e.heightModel&&null!=e.heightUnit}function c(t){const r=t.url&&i(t.url);return!(null==(t.spatialReference&&t.spatialReference.vcsWkid)&&e(r)&&"ImageServer"===r.serverType)&&l(t)&&t.heightModelInfo?t.heightModelInfo:u(t)?n.deriveUnitFromSR(g,t.spatialReference):null}function l(e){return"heightModelInfo"in e}function h(e){if("unknown"===e.type||!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"wfs":return!0;default:return!1}}function u(e){return h(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):f(e)}function d(e){return null!=e.layers||f(e)||h(e)||l(e)}function f(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"analysis":case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"map-image":case"map-notes":case"ogc-feature":case"open-street-map":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}!function(e){e[e.Ok=0]="Ok",e[e.Units=1]="Units",e[e.HeightModel=2]="HeightModel",e[e.CRS=3]="CRS",e[e.Unsupported=4]="Unsupported"}(a||(a={}));const g=new n({heightModel:"gravity-related-height"});export{c as d,d as m,o as r,r as v};
