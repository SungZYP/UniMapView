/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{substitute as t}from"../intl.js";import i from"../core/Collection.js";import{after as o,e as s}from"../core/promiseUtils.js";import n from"../core/Handles.js";import{L as r}from"../chunks/Logger.js";import{b as l}from"../core/lang.js";import{whenOnce as a}from"../core/reactiveUtils.js";import{t as p}from"../chunks/throttle.js";import{watch as u,whenFalse as c,on as d,init as h}from"../core/watchUtils.js";import{aliasOf as m}from"../core/accessorSupport/decorators/aliasOf.js";import{cast as g}from"../core/accessorSupport/decorators/cast.js";import{property as v}from"../core/accessorSupport/decorators/property.js";import{subclass as b}from"../core/accessorSupport/decorators/subclass.js";import _,{F as f}from"./Feature.js";import"../chunks/ensureType.js";import y from"./Widget.js";import j from"./Spinner/SpinnerViewModel.js";import{i as k,s as M,h as w}from"../chunks/widgetUtils.js";import{t as C}from"../chunks/jsxFactory.js";import F from"./Popup/PopupViewModel.js";import{H as A}from"../chunks/Heading.js";import{a as I}from"../chunks/accessibleHandler.js";import{m as S}from"../chunks/messageBundle.js";import{v as x}from"../chunks/vmEvent.js";import"../chunks/number.js";import"../chunks/jsonMap.js";import"../chunks/object.js";import"../chunks/locale.js";import"../chunks/string.js";import"../chunks/messages.js";import"../core/Error.js";import"../config.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/assets.js";import"../chunks/ArrayPool.js";import"../chunks/Evented.js";import"../core/Accessor.js";import"../chunks/deprecate.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/handleUtils.js";import"../chunks/metadata.js";import"../chunks/tracking.js";import"../chunks/watch.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/shared.js";import"./Attachments.js";import"../chunks/unitFormatUtils.js";import"../chunks/byteSizeEstimations.js";import"../chunks/mathUtils.js";import"../chunks/common.js";import"../chunks/unitUtils.js";import"../chunks/projectionEllipsoid.js";import"../geometry/SpatialReference.js";import"../chunks/JSONSupport.js";import"../chunks/writer.js";import"../chunks/Ellipsoid.js";import"./Attachments/AttachmentsViewModel.js";import"../Graphic.js";import"../geometry.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../chunks/reader.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../PopupTemplate.js";import"../layers/support/fieldUtils.js";import"../chunks/arcadeOnDemand.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../chunks/enumeration.js";import"../popup/support/FieldInfoFormat.js";import"../chunks/date.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../chunks/chartMediaInfoUtils.js";import"../chunks/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../support/actions/ActionBase.js";import"../chunks/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../Color.js";import"../chunks/colorUtils.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils3.js";import"../symbols/edges/Edges3D.js";import"../chunks/screenUtils.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils4.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../chunks/aaBoundingRect.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../chunks/persistableUrlUtils.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../portal/Portal.js";import"../chunks/Loadable.js";import"../chunks/Promise.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../chunks/Clonable.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../chunks/Thumbnail.js";import"../chunks/Symbol3DVerticalOffset.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../core/HandleOwner.js";import"../rest/query/support/AttachmentInfo.js";import"../rest/support/AttachmentQuery.js";import"./Feature/FeatureViewModel.js";import"../chunks/languageUtils.js";import"../chunks/datetime.js";import"../chunks/number3.js";import"../layers/support/Field.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/fieldType.js";import"../rest/support/Query.js";import"../TimeExtent.js";import"../chunks/timeUtils.js";import"../chunks/DataLayerSource.js";import"../rest/support/StatisticDefinition.js";import"../rest/support/RelationshipQuery.js";import"../tasks/QueryTask.js";import"../chunks/executeForTopCount.js";import"../chunks/utils5.js";import"../chunks/scaleUtils.js";import"../chunks/floorFilterUtils.js";import"../chunks/query.js";import"../geometry/support/normalizeUtils.js";import"../chunks/normalizeUtilsCommon.js";import"../chunks/pbfQueryUtils.js";import"../chunks/pbf.js";import"../chunks/OptimizedFeature.js";import"../chunks/OptimizedFeatureSet.js";import"../chunks/queryZScale.js";import"../chunks/zscale.js";import"../chunks/compilerUtils.js";import"../chunks/featureConversionUtils.js";import"../rest/support/FeatureSet.js";import"../rest/support/TopFeaturesQuery.js";import"../rest/support/TopFilter.js";import"../chunks/executeQueryJSON.js";import"../tasks/Task.js";import"../layers/FeatureLayer.js";import"../renderers/ClassBreaksRenderer.js";import"../renderers/Renderer.js";import"../renderers/support/AuthoringInfo.js";import"../renderers/support/AuthoringInfoVisualVariable.js";import"../chunks/colorRamps.js";import"../rest/support/AlgorithmicColorRamp.js";import"../rest/support/ColorRamp.js";import"../rest/support/MultipartColorRamp.js";import"../chunks/VisualVariablesMixin.js";import"../renderers/visualVariables/ColorVariable.js";import"../renderers/visualVariables/VisualVariable.js";import"../chunks/LegendOptions.js";import"../renderers/visualVariables/support/ColorStop.js";import"../renderers/visualVariables/OpacityVariable.js";import"../renderers/visualVariables/support/OpacityStop.js";import"../renderers/visualVariables/RotationVariable.js";import"../renderers/visualVariables/SizeVariable.js";import"../renderers/visualVariables/support/SizeStop.js";import"../chunks/sizeVariableUtils.js";import"../chunks/visualVariableUtils.js";import"../chunks/lengthUtils.js";import"../renderers/support/ClassBreakInfo.js";import"../chunks/commonProperties2.js";import"../symbols/support/jsonUtils.js";import"../chunks/symbolConversion.js";import"../renderers/DictionaryRenderer.js";import"../chunks/DictionaryLoader.js";import"../chunks/LRUCache.js";import"../chunks/MemCache.js";import"../renderers/DotDensityRenderer.js";import"../renderers/support/AttributeColorInfo.js";import"../renderers/HeatmapRenderer.js";import"../renderers/support/HeatmapColorStop.js";import"../renderers/SimpleRenderer.js";import"../renderers/UniqueValueRenderer.js";import"../chunks/diffUtils.js";import"../renderers/support/UniqueValueInfo.js";import"../chunks/styleUtils.js";import"../renderers/support/jsonUtils.js";import"../chunks/MultiOriginJSONSupport.js";import"../core/sql.js";import"../form/FormTemplate.js";import"../form/ExpressionInfo.js";import"../form/elements/GroupElement.js";import"../form/elements/FieldElement.js";import"../form/elements/support/inputs.js";import"../form/elements/inputs/BarcodeScannerInput.js";import"../form/elements/inputs/TextInput.js";import"../form/elements/inputs/Input.js";import"../form/elements/inputs/ComboBoxInput.js";import"../form/elements/inputs/DateTimePickerInput.js";import"../form/elements/inputs/RadioButtonsInput.js";import"../form/elements/inputs/SwitchInput.js";import"../form/elements/inputs/TextAreaInput.js";import"../form/elements/inputs/TextBoxInput.js";import"../form/support/elements.js";import"../geometry/HeightModelInfo.js";import"../layers/Layer.js";import"../chunks/FeatureIndex.js";import"../core/workers/workers.js";import"../core/workers/Connection.js";import"../core/workers/RemoteClient.js";import"../chunks/APIKeyMixin.js";import"../chunks/ArcGISService.js";import"../chunks/arcgisLayerUrl.js";import"../chunks/BlendLayer.js";import"../chunks/jsonUtils.js";import"../chunks/parser.js";import"../chunks/mat4f32.js";import"../chunks/mat4.js";import"../chunks/_commonjsHelpers.js";import"../chunks/CustomParametersMixin.js";import"../chunks/FeatureEffectLayer.js";import"../layers/support/FeatureEffect.js";import"../layers/support/FeatureFilter.js";import"../chunks/OperationalLayer.js";import"../chunks/commonProperties.js";import"../support/timeUtils.js";import"../chunks/ElevationInfo.js";import"../chunks/unitConversionUtils.js";import"../chunks/OrderedLayer.js";import"../chunks/PortalLayer.js";import"../chunks/asyncUtils.js";import"../portal/PortalItem.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"../chunks/RefreshableLayer.js";import"../chunks/ScaleRangeLayer.js";import"../chunks/TemporalLayer.js";import"../TimeInterval.js";import"../layers/support/TimeInfo.js";import"../chunks/featureReductionUtils.js";import"../layers/support/FeatureReductionSelection.js";import"../layers/support/FeatureReductionCluster.js";import"../layers/support/LabelClass.js";import"../chunks/labelUtils.js";import"../chunks/defaultsJSON.js";import"../layers/support/FeatureTemplate.js";import"../layers/support/FeatureType.js";import"../chunks/fieldProperties.js";import"../layers/support/FieldsIndex.js";import"../layers/support/GeometryFieldsInfo.js";import"../chunks/labelingInfo.js";import"../layers/support/LayerFloorInfo.js";import"../layers/support/Relationship.js";import"../chunks/versionUtils.js";import"../chunks/styleUtils2.js";import"../support/popupUtils.js";import"./support/widget.js";import"../chunks/widgetThemeUtils.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/domUtils.js";import"../chunks/uuid.js";import"../chunks/projector.js";import"../chunks/AnchorElementViewModel.js";import"../symbols/support/symbolUtils.js";import"../chunks/utils6.js";import"../chunks/ItemCache.js";import"../symbols/support/cimSymbolUtils.js";import"../chunks/utils7.js";import"../chunks/InputManager.js";import"../chunks/Queue.js";import"../chunks/layerViewUtils.js";import"../chunks/actions.js";import"../chunks/GoTo.js";const O="esri-spinner",P="esri-spinner--start",E="esri-spinner--finish";let U=class extends y{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.location=null,this.view=null,this.viewModel=new j,this.visible=!1}initialize(){this.own([u(this,"visible",(e=>this._visibleChange(e)))])}destroy(){this._animationPromise=null}show(e){const{location:t,promise:i}=e;t&&(this.viewModel.location=t),this.visible=!0;const o=()=>this.hide();i&&i.catch((()=>{})).then(o)}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:t}=this.viewModel,i=!!t,o={[P]:e&&i,[E]:!e&&i},s=this._getPositionStyles();return C("div",{class:this.classes(O,o),styles:s})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const t=o(this._animationDelay);this._animationPromise=t,t.catch((()=>{})).then((()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)}))}_getPositionStyles(){const{screenLocation:e,view:t}=this.viewModel;if(!t||l(e))return{};const{padding:i}=t;return{left:e.x-i.left+"px",top:e.y-i.top+"px"}}};e([m("viewModel.location")],U.prototype,"location",void 0),e([m("viewModel.view")],U.prototype,"view",void 0),e([v({type:j})],U.prototype,"viewModel",void 0),e([m("viewModel.visible")],U.prototype,"visible",void 0),U=e([b("esri.widgets.Spinner")],U);const D=U,L="esri-icon-left-triangle-arrow",N="esri-icon-right-triangle-arrow",V="esri-icon-maximize",B="esri-icon-dock-bottom",T="esri-icon-dock-left",R="esri-icon-dock-right",W="esri-icon-close",z="esri-icon-minimize",H="esri-icon-check-mark",$="esri-icon-loading-indicator",K="esri-icon-default-action",q="esri-icon-handle-horizontal",Q="esri-rotating",G="esri-popup",J="esri-widget",Z="esri-popup__main-container",X="esri-popup__loading-container",Y="esri-popup--is-collapsible",ee="esri-popup--is-collapsed",te="esri-popup--shadow",ie="esri-popup--is-docked",oe="esri-popup--is-docked-top-left",se="esri-popup--is-docked-top-center",ne="esri-popup--is-docked-top-right",re="esri-popup--is-docked-bottom-left",le="esri-popup--is-docked-bottom-center",ae="esri-popup--is-docked-bottom-right",pe="esri-popup--aligned-top-center",ue="esri-popup--aligned-bottom-center",ce="esri-popup--aligned-top-left",de="esri-popup--aligned-bottom-left",he="esri-popup--aligned-top-right",me="esri-popup--aligned-bottom-right",ge="esri-popup--feature-menu-open",ve="esri-popup--actions-menu-open",be="esri-popup--feature-updated",_e="esri-popup__header",fe="esri-popup__header-buttons",ye="esri-popup__header-container",je="esri-popup__header-container--button",ke="esri-popup__header-title",Me="esri-popup__content",we="esri-popup__footer",Ce="esri-popup__footer--has-pagination",Fe="esri-popup__footer--has-actions",Ae="esri-popup__footer--has-actions-menu",Ie="esri-popup__button",Se="esri-popup__button--disabled",xe="esri-popup__button--dock",Oe="esri-popup__icon",Pe="esri-popup__icon--dock-icon",Ee="esri-popup__inline-actions-container",Ue="esri-popup__actions-menu-button",De="esri-popup__actions",Le="esri-popup__action",Ne="esri-popup__action-image",Ve="esri-popup__action-text",Be="esri-popup__action-toggle",Te="esri-popup__action-toggle--on",Re="esri-popup__pointer",We="esri-popup__pointer-direction",ze="esri-popup__navigation",He="esri-popup__pagination-previous",$e="esri-popup__pagination-next",Ke="esri-popup__pagination-previous-icon",qe="esri-popup__pagination-previous-icon--rtl",Qe="esri-popup__pagination-next-icon",Ge="esri-popup__pagination-next-icon--rtl",Je="esri-popup__feature-menu",Ze="esri-popup__feature-menu-list",Xe="esri-popup__feature-menu-item",Ye="esri-popup__feature-menu-viewport",et="esri-popup__feature-menu-header",tt="esri-popup__feature-menu-item--selected",it="esri-popup__feature-menu-button",ot="esri-popup__feature-menu-title",st="esri-popup__feature-menu-observer",nt="esri-popup__feature-menu-loader",rt={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};function lt(e,t){return void 0===t?`esri-popup__${e}`:`esri-popup__${e}-${t}`}const at=r.getLogger("esri.widgets.Popup"),pt={closeButton:!0,featureNavigation:!0};let ut=class extends(f(y)){constructor(e,t){super(e,t),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new n,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverCallback=([e])=>{null!=e&&e.isIntersecting&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._displaySpinnerThrottled=p((()=>this._displaySpinner()),0),this.actions=null,this.alignment="auto",this.autoCloseEnabled=null,this.autoOpenEnabled=null,this.defaultPopupTemplateEnabled=null,this.content=null,this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureCount=null,this.featureMenuOpen=!1,this.features=null,this.goToOverride=null,this.headingLevel=2,this.highlightEnabled=null,this.location=null,this.label=void 0,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.promises=null,this.selectedFeature=null,this.selectedFeatureIndex=null,this.spinnerEnabled=!0,this.title=null,this.updateLocationEnabled=null,this.view=null,this.viewModel=new F,this.visible=null,this.visibleElements={...pt},this._addSelectedFeatureIndexHandle(),this.own([u(this,"viewModel.screenLocation",(()=>this._positionContainer())),u(this,["viewModel.active","dockEnabled"],(()=>this._toggleScreenLocationEnabled())),u(this,"viewModel.screenLocation",((e,t)=>{!!e!=!!t&&this.reposition()})),u(this,["viewModel.view.padding","viewModel.view.size","viewModel.active","viewModel.location","alignment"],(()=>this.reposition())),u(this,"spinnerEnabled",(e=>this._spinnerEnabledChange(e))),u(this,"viewModel.view.size",((e,t)=>this._updateDockEnabledForViewSize(e,t))),u(this,"viewModel.view",((e,t)=>this._viewChange(e,t))),u(this,"viewModel.view.ready",((e,t)=>this._viewReadyChange(e,t))),u(this,["viewModel.waitingForResult","viewModel.location"],(()=>{this._hideSpinner(),this._displaySpinnerThrottled()})),u(this,["selectedFeatureWidget.viewModel.title","selectedFeatureWidget.viewModel.state"],(()=>this._setTitleFromFeatureWidget())),u(this,["selectedFeatureWidget.viewModel.content","selectedFeatureWidget.viewModel.state"],(()=>this._setContentFromFeatureWidget())),c(this,"collapsed",(()=>{var e,t;"xsmall"===(null==(e=this.viewModel)||null==(t=e.view)?void 0:t.widthBreakpoint)&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()})),d(this,"viewModel.allActions","change",(()=>this._watchActions())),h(this,"viewModel.allActions",(()=>this._watchActions())),u(this,"viewModel.featureViewModels",(()=>this._featureMenuViewportScrollTop()))])}destroy(){var e,t;this._destroySelectedFeatureWidget(),this._destroySpinner(),null==(e=this._handles)||e.destroy(),this._unobserveFeatureMenuObserver(),null==(t=this._featureMenuIntersectionObserver)||t.disconnect(),this._handles=null}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){var e,t,i,o,s,n,r;return!!(this.selectedFeatureWidget?(null==(e=this.selectedFeatureWidget)||null==(t=e.viewModel)?void 0:t.waitingForContent)||"error"===(null==(i=this.selectedFeatureWidget)||null==(o=i.viewModel)?void 0:o.state)||(null==(s=this.selectedFeatureWidget)||null==(n=s.viewModel)?void 0:n.content):null==(r=this.viewModel)?void 0:r.content)}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||rt}set dockOptions(e){const t={...rt},i=this.get("viewModel.view.breakpoints"),o={};i&&(o.width=i.xsmall,o.height=i.xsmall);const s={...t,...e},n={...t.breakpoint,...o},{breakpoint:r}=s;!0===r?s.breakpoint=n:"object"==typeof r&&(s.breakpoint={...n,...r}),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}get selectedFeatureWidget(){const{_feature:e,visibleElements:t,headingLevel:i}=this,{selectedFeatureViewModel:o}=this.viewModel,s={...t,title:!1};return o?(e?(e.viewModel=o,e.visibleElements=s):this._feature=new _({headingLevel:i+1,viewModel:o,visibleElements:s}),this._feature):null}castVisibleElements(e){return{...pt,...e}}blur(){const{active:e}=this.viewModel;e||at.warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||at.warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){var t,i;this._handles.remove("selected-index");const o=!!e&&!!e.featureMenuOpen,s=!!e&&!!e.actionsMenuOpen,n={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:s,featureMenuOpen:o};"xsmall"===(null==(t=this.viewModel)||null==(i=t.view)?void 0:i.widthBreakpoint)&&(n.collapsed=!0),this.set(n),this.viewModel.open(e),this._shouldFocus(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){this.viewModel.triggerAction(e)}render(){var e,t,i,o;const{actionsMenuOpen:s,dockEnabled:n,featureMenuVisible:r,dividedActions:l,currentAlignment:a,currentDockPosition:p}=this,{active:u}=this.viewModel,{menuActions:c}=l,d=u&&c.length>1&&s,h=u&&n,m=u&&!n,g=null==(e=this.selectedFeature)||null==(t=e.layer)?void 0:t.title,v=null==(i=this.selectedFeature)||null==(o=i.layer)?void 0:o.id,b={[pe]:"top-center"===a,[ue]:"bottom-center"===a,[ce]:"top-left"===a,[de]:"bottom-left"===a,[he]:"top-right"===a,[me]:"bottom-right"===a,[ie]:h,[te]:m,[oe]:"top-left"===p,[se]:"top-center"===p,[ne]:"top-right"===p,[re]:"bottom-left"===p,[le]:"bottom-center"===p,[ae]:"bottom-right"===p,[ge]:r,[ve]:d};return C("div",{class:this.classes(G,b),role:"presentation","data-layer-title":g,"data-layer-id":v,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},u?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return C("span",{"aria-hidden":"true",class:this.classes(Oe,$,Q)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?C("div",{key:lt("loading-container"),role:"presentation",class:X,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=k(this.container),t={[N]:e,[qe]:e,[L]:!e,[Ke]:!e};return C("span",{"aria-hidden":"true",class:this.classes(Oe,t)})}renderPreviousButton(){const{messages:e}=this;return C("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(Ie,He),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=k(this.container),t={[L]:e,[Ge]:e,[N]:!e,[Qe]:!e};return C("span",{"aria-hidden":"true",class:this.classes(Oe,t)})}renderNextButton(){const{messages:e}=this;return C("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(Ie,$e),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:t,messagesCommon:i}=this,{featureCount:o,selectedFeatureIndex:s}=this.viewModel;return C("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(Ie,it),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e.toString(),"aria-label":i.menu,title:i.menu},this._getPageText(o,s))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}renderDockIcon(){const{dockEnabled:e}=this,t=this._wouldDockTo(),i={[z]:e,[Pe]:!e,[R]:!e&&("top-right"===t||"bottom-right"===t),[T]:!e&&("top-left"===t||"bottom-left"===t),[V]:!e&&"top-center"===t,[B]:!e&&"bottom-center"===t};return C("span",{"aria-hidden":"true",class:this.classes(i,Oe)})}renderDockButton(){var e,t,i;const{dockEnabled:o,messages:s}=this,n=null==(e=this.viewModel)||null==(t=e.view)?void 0:t.widthBreakpoint,r=o?s.undock:s.dock;return"xsmall"!==n&&null!=(i=this.dockOptions)&&i.buttonEnabled?C("div",{role:"button","aria-label":r,title:r,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(Ie,xe)},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:t,collapsible:i,contentCollapsed:o,messagesCommon:s}=this,n={[je]:i},r=C(A,{level:this.headingLevel,class:ke,innerHTML:e}),l=i?C("button",{key:`${e}--collapsible`,id:t,title:o?s.expand:s.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(ye,n),"aria-expanded":o?"false":"true",onclick:this._toggleCollapsed,type:"button"},r):C("div",{key:e,id:t,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(ye,n)},r);return e?l:null}renderCloseIcon(){return C("span",{"aria-hidden":"true",class:this.classes(Oe,W)})}renderCloseButton(){const{visibleElements:e,messagesCommon:t}=this;return e.closeButton?C("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:Ie,"aria-label":t.close,title:t.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return C("header",{class:_e},this.renderTitle(),C("div",{class:fe},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:t,contentCollapsed:i}=this,{content:o}=this.viewModel;return t&&!i?C("article",{key:o,enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:Me},this.renderContent()):null}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:o,messagesCommon:s}=this,n=i?s.close:s.open,{menuActions:r}=o;return r.length?C("div",{key:lt("actions-menu-button"),class:this.classes(Ie,Ue),role:"button",id:t,"aria-haspopup":"true","aria-controls":i?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":n,title:n},C("span",{"aria-hidden":"true",class:q})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:o}=this,{menuActions:s}=o;return s.length&&i?C("ul",{id:e,role:"menu","aria-labelledby":t,key:lt("actions"),class:De,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},s.toArray().map((e=>this.renderAction({action:e,type:"menu-item"})))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return!!e.length&&e.toArray().map((e=>this.renderAction({action:e,type:"inline"})))}renderInlineActionsContainer(){const{inlineActions:e,menuActions:t}=this.dividedActions,i=!!e.length,o=!!t.length;return i||o?C("div",{key:"inline-actions-container","data-inline-actions":i.toString(),"data-menu-actions":o.toString(),class:Ee},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?C("section",{key:lt("navigation"),class:this.classes(ze)},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:t}=this,{inlineActions:i,menuActions:o}=t,s=!!i.length,n=!!o.length,r={[Ce]:e,[Fe]:s,[Ae]:n};return e||s?C("div",{key:lt("feature-buttons"),class:this.classes(we,r)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:i,isLoadingFeature:o}=this.viewModel,s=t(e.selectedFeatures,{total:i.length});return C("section",{key:lt("menu"),class:Je},C("strong",{class:et},s),C("nav",{bind:this,class:Ye,"data-node-ref":"_featureMenuViewportNode",afterCreate:M},this.renderFeatureMenu(),C("div",{class:st,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),o?C("div",{class:nt},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:C("div",{key:lt("pointer"),class:Re,role:"presentation"},C("div",{class:this.classes(We,te)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:t,currentDockPosition:i,titleId:o,contentId:s,collapsible:n,hasContent:r,contentCollapsed:l,visibleElements:a}=this,{title:p}=this.viewModel,u="bottom-left"===t||"bottom-center"===t||"bottom-right"===t||"top-left"===i||"top-center"===i||"top-right"===i,c="top-left"===t||"top-center"===t||"top-right"===t||"bottom-left"===i||"bottom-center"===i||"bottom-right"===i,d={[te]:e,[Y]:n,[ee]:l};return C("div",{class:this.classes(Z,J,d),tabIndex:a.closeButton?null:-1,role:"dialog","aria-labelledby":p?o:"","aria-describedby":r&&!l?s:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},u?this.renderFooter():null,u?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),c?this.renderFooter():null,c?this.renderFeatureMenuContainer():null)}renderContent(){var e;const t=null==(e=this.viewModel)?void 0:e.content;return t?"string"==typeof t?C("div",{key:t,innerHTML:t}):this.renderNodeContent(t):null}renderActionText(e){return C("span",{key:"text",class:Ve},e)}renderActionIcon(e){const t=this._getActionClass(e),i=this._getActionImage(e),o={[$]:e.active,[Q]:e.active,[Oe]:!!t,[Ne]:!e.active&&!!i};return t&&(o[t]=!e.active),C("span",{key:"icon","aria-hidden":"true",class:this.classes(Oe,o),styles:this._getIconStyles(i)})}renderAction(e){const{action:t,type:i}=e,o=this._getActionTitle(t),s={[Le]:"toggle"!==t.type,[Be]:"toggle"===t.type,[Te]:"toggle"===t.type&&t.value,[Se]:t.disabled},n=[this.renderActionIcon(t),this.renderActionText(o)],r="menu-item"===i?C("li",{key:t.uid,role:"menuitem",tabIndex:0,title:o,"aria-label":o,class:this.classes(Ie,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n):C("div",{key:t.uid,role:"button",tabIndex:0,title:o,"aria-label":o,class:this.classes(Ie,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n);return t.visible?r:null}renderFeatureMenuItem(e,t){const{messages:i,messagesCommon:o}=this,{selectedFeatureIndex:s,selectedFeatureViewModel:n}=this.viewModel,r=e===n,l={[tt]:r},a=r?C("span",{key:lt(`feature-menu-selected-feature-${s}`),title:i.selectedFeature,"aria-label":i.selectedFeature,class:H}):null,p=C("span",{innerHTML:e.title||o.untitled});return C("li",{role:"menuitem",tabIndex:-1,key:lt(`feature-menu-feature-${s}`),class:this.classes(l,Xe),bind:this,"data-feature-index":t,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature},C("span",{class:ot},p,a))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:t}=this.viewModel;return t.length>1?C("ol",{class:Ze,id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},t.filter((e=>!!e.graphic)).map(((e,t)=>this.renderFeatureMenuItem(e,t)))):null}_getActionTitle(e){const{messages:i,selectedFeature:o,messagesCommon:s}=this,{id:n}=e,r=null==o?void 0:o.attributes,l="zoom-to-feature"===n?t(e.title,{messages:i}):"remove-selected-feature"===n?t(e.title,{messages:s}):"zoom-to-clustered-features"===n||"browse-clustered-features"===n?t(e.title,{messages:i}):e.title;return l&&r?t(l,r):l}_getActionClass(e){const{selectedFeature:i}=this,o=null==i?void 0:i.attributes,{className:s,image:n}=e,r=n||s?s:K;return r&&o?t(r,o):r}_getActionImage(e){const{selectedFeature:i}=this,o=null==i?void 0:i.attributes,{image:s}=e;return s&&o?t(s,o):s}_createFeatureUpdatedAnimation(){return w("enter",be)}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:t}=this;if("number"!=typeof e)return null;const i=Math.round(e);return Math.max(t?i-1:i,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const t="actions";this._handles.remove(t),e&&e.forEach((e=>{this._handles.add(u(e,["uid","active","className","disabled","id","title","image","visible"],(()=>this.scheduleRender())),t)}))}_divideActions(){const{allActions:e}=this.viewModel,t=e.filter((e=>e.visible)),o=this._getInlineActionCount(),s=null===o,n=0===o;return{inlineActions:s?t.slice(0):n?new i:t.slice(0,o),menuActions:s?new i:n?t.slice(0):t.slice(o)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(){const{selectedFeatureWidget:e,messagesCommon:t}=this;var i,o;e&&(this.viewModel.title="error"===(null==(i=e.viewModel)?void 0:i.state)?t.errorMessage:(null==(o=e.viewModel)?void 0:o.title)||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_handleFeatureMenuKeyup(e){"Escape"===s(e)&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){"Escape"===s(e)&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_handleFeatureMenuItemKeyup(e){const t=s(e),{_featureMenuNode:i}=this,o=e.currentTarget["data-feature-index"];if(!i)return;const n=i.querySelectorAll("li"),r=n.length;if("ArrowUp"!==t)if("ArrowDown"!==t)if("Home"!==t)if("End"!==t);else{e.stopPropagation();n[n.length-1].focus()}else{e.stopPropagation();n[0].focus()}else{e.stopPropagation();n[(o+1+r)%r].focus()}else{e.stopPropagation();n[(o-1+r)%r].focus()}}_handleActionMenuItemKeyup(e){const t=s(e),{_actionsMenuNode:i}=this,o=e.currentTarget.dataset.actionUid,{menuActions:n}=this.dividedActions,r=n.findIndex((e=>e.uid===o));if(!i)return;const l=i.querySelectorAll("li"),a=l.length;if("ArrowUp"!==t)if("ArrowDown"!==t)if("Home"!==t)if("End"!==t);else{e.stopPropagation();l[l.length-1].focus()}else{e.stopPropagation();l[0].focus()}else{e.stopPropagation();l[(r+1+a)%a].focus()}else{e.stopPropagation();l[(r-1+a)%a].focus()}}_handleMainKeyup(e){const t=s(e);"ArrowLeft"===t&&(e.stopPropagation(),this.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const t=this.get("viewModel.view");this._createSpinner(t)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:i}=this.viewModel;i?e.show({location:t}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}async _shouldFocus(e){e.shouldFocus&&(await a((()=>{var e;return!0===(null==(e=this.viewModel)?void 0:e.active)})),this.focus())}_addSelectedFeatureIndexHandle(){const e=u(this,"viewModel.selectedFeatureIndex",((e,t)=>this._selectedFeatureIndexUpdated(e,t)));this._handles.add(e,"selected-index")}_selectedFeatureIndexUpdated(e,t){const{featureCount:i}=this;i&&e!==t&&-1!==e&&(this.actionsMenuOpen=!1,this.featureMenuOpen=!1)}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}_isOutsideView(e){const{popupHeight:t,popupWidth:i,screenLocation:o,side:s,view:n}=e;if(isNaN(i)||isNaN(t)||!n||!o)return!1;const r=n.padding;return"right"===s&&o.x+i/2>n.width-r.right||("left"===s&&o.x-i/2<r.left||("top"===s&&o.y-t<r.top||"bottom"===s&&o.y+t>n.height-r.bottom))}_calculateAutoAlignment(e){if("auto"!==e)return e;const{_pointerOffsetInPx:t,_containerNode:i,_mainContainerNode:o,viewModel:s}=this,{screenLocation:n,view:r}=s;if(l(n)||!r||!i)return"top-center";if(!this._isScreenLocationWithinView(n,r))return this._get("currentAlignment")||"top-center";function a(e){return parseInt(e.replace(/[^-\d\.]/g,""),10)}const p=o?window.getComputedStyle(o,null):null,u=p?a(p.getPropertyValue("max-height")):0,c=p?a(p.getPropertyValue("height")):0,{height:d,width:h}=i.getBoundingClientRect(),m=h+t,g=Math.max(d,u,c)+t,v=this._isOutsideView({popupHeight:g,popupWidth:m,screenLocation:n,side:"right",view:r}),b=this._isOutsideView({popupHeight:g,popupWidth:m,screenLocation:n,side:"left",view:r}),_=this._isOutsideView({popupHeight:g,popupWidth:m,screenLocation:n,side:"top",view:r}),f=this._isOutsideView({popupHeight:g,popupWidth:m,screenLocation:n,side:"bottom",view:r});return b?_?"bottom-right":"top-right":v?_?"bottom-left":"top-left":_?f?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return"function"==typeof e?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return k(this.container)&&t.reverse(),e.replace(/leading/gi,t[0]).replace(/trailing/gi,t[1])}_callDockPosition(e){return"function"==typeof e?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(null==(e=this.dockOptions)?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){var t;if("auto"!==e)return e;const i=null==(t=this.viewModel)?void 0:t.view,o=k(this.container)?"top-left":"top-right";if(!i)return o;const s=i.padding||{left:0,right:0,top:0,bottom:0},n=i.width-s.left-s.right,{breakpoints:r}=i;return r&&n<=r.xsmall?"bottom-center":o}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!e)return;const{screenLocation:t}=this.viewModel,{width:i}=e.getBoundingClientRect(),o=this._calculatePositionStyle(t,i);o&&(e.style.top=o.top,e.style.left=o.left,e.style.bottom=o.bottom,e.style.right=o.right)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:i}=this;return"top-left"===t||"bottom-left"===t||"top-right"===t||"bottom-right"===t?e+i:e}_calculateAlignmentPosition(e,t,i,o){const{currentAlignment:s,_pointerOffsetInPx:n}=this,r=o/2,l=i.height-t,a=i.width-e,{padding:p}=this.view;return"bottom-center"===s?{top:t+n-p.top,left:e-r-p.left}:"top-left"===s?{bottom:l+n-p.bottom,right:a+n-p.right}:"bottom-left"===s?{top:t+n-p.top,right:a+n-p.right}:"top-right"===s?{bottom:l+n-p.bottom,left:e+n-p.left}:"bottom-right"===s?{top:t+n-p.top,left:e+n-p.left}:"top-center"===s?{bottom:l+n-p.bottom,left:e-r-p.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:i,view:o}=this;if(!o)return;if(i)return{left:"",top:"",right:"",bottom:""};if(l(e)||!t)return;const s=this._calculateFullWidth(t),n=this._calculateAlignmentPosition(e.x,e.y,o,s);return n?{top:void 0!==n.top?`${n.top}px`:"auto",left:void 0!==n.left?`${n.left}px`:"auto",bottom:void 0!==n.bottom?`${n.bottom}px`:"auto",right:void 0!==n.right?`${n.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){if(e){const e=this.get("viewModel.view");this._wireUpView(e)}else t&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:t}=this;t&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,i){const[o,s]=e,[n,r]=t,{width:l,height:a}=i;return o<=l&&n>l||o>l&&n<=l||s<=a&&r>a||s>a&&r<=a}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;const i=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},o=i.left+i.right,s=i.top+i.bottom,n=[],r=[];n[0]=e[0]-o,n[1]=e[1]-s,r[0]=t[0]-o,r[1]=t[1]-s;const{dockOptions:l}=this,a=l.breakpoint;this._dockingThresholdCrossed(n,r,a)&&this._setDockEnabledForViewSize(l),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const t=e.querySelectorAll("li");if(t.length){t[0].focus()}}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const t=e.querySelectorAll("li");if(t.length){t[0].focus()}}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const i=t.active&&!e;t.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){var t,i;const o=e.breakpoint,s=null==(t=this.viewModel)||null==(i=t.view)?void 0:i.ui;if(!s)return!1;const{width:n,height:r}=s;if(isNaN(n)||isNaN(r))return!1;const l=o.hasOwnProperty("width")&&n<=o.width,a=o.hasOwnProperty("height")&&r<=o.height;return l||a}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,i){return this.featureNavigationVisible?t(this.messages.pageText,{index:i+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:t}=this;e&&(t&&t.ui&&t.ui.remove(this._spinner,"popup-spinner"),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new D({view:e}),e.ui.add(this._spinner,{key:"popup-spinner",position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const t=e.currentTarget.dataset.actionUid,{allActions:i}=this.viewModel,o=i.findIndex((e=>e.uid===t)),s=i.getItemAt(o);s&&"toggle"===s.type&&(s.value=!s.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(o)}_selectFeature(e){const t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};e([v({readOnly:!0})],ut.prototype,"actionsMenuId",null),e([v({readOnly:!0})],ut.prototype,"actionsMenuButtonId",null),e([v({readOnly:!0})],ut.prototype,"featureMenuId",null),e([v({readOnly:!0})],ut.prototype,"titleId",null),e([v({readOnly:!0})],ut.prototype,"contentId",null),e([v({readOnly:!0})],ut.prototype,"hasContent",null),e([v({readOnly:!0})],ut.prototype,"featureNavigationVisible",null),e([v({readOnly:!0})],ut.prototype,"collapsible",null),e([v({readOnly:!0})],ut.prototype,"featureMenuVisible",null),e([v({readOnly:!0})],ut.prototype,"contentCollapsed",null),e([v({readOnly:!0})],ut.prototype,"dividedActions",null),e([m("viewModel.actions")],ut.prototype,"actions",void 0),e([v()],ut.prototype,"actionsMenuOpen",null),e([v()],ut.prototype,"alignment",void 0),e([m("viewModel.autoCloseEnabled")],ut.prototype,"autoCloseEnabled",void 0),e([m("viewModel.autoOpenEnabled")],ut.prototype,"autoOpenEnabled",void 0),e([m("viewModel.defaultPopupTemplateEnabled")],ut.prototype,"defaultPopupTemplateEnabled",void 0),e([m("viewModel.content")],ut.prototype,"content",void 0),e([v()],ut.prototype,"collapsed",void 0),e([v()],ut.prototype,"collapseEnabled",void 0),e([v({readOnly:!0})],ut.prototype,"currentAlignment",null),e([v({readOnly:!0})],ut.prototype,"currentDockPosition",null),e([v()],ut.prototype,"dockOptions",null),e([v()],ut.prototype,"dockEnabled",void 0),e([m("viewModel.featureCount")],ut.prototype,"featureCount",void 0),e([v()],ut.prototype,"featureMenuOpen",void 0),e([m("viewModel.features")],ut.prototype,"features",void 0),e([m("viewModel.goToOverride")],ut.prototype,"goToOverride",void 0),e([v()],ut.prototype,"headingLevel",void 0),e([m("viewModel.highlightEnabled")],ut.prototype,"highlightEnabled",void 0),e([m("viewModel.location")],ut.prototype,"location",void 0),e([v({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],ut.prototype,"label",void 0),e([v()],ut.prototype,"maxInlineActions",void 0),e([v(),S("esri/widgets/Popup/t9n/Popup")],ut.prototype,"messages",void 0),e([v(),S("esri/t9n/common")],ut.prototype,"messagesCommon",void 0),e([m("viewModel.promises")],ut.prototype,"promises",void 0),e([m("viewModel.selectedFeature")],ut.prototype,"selectedFeature",void 0),e([m("viewModel.selectedFeatureIndex")],ut.prototype,"selectedFeatureIndex",void 0),e([v({readOnly:!0})],ut.prototype,"selectedFeatureWidget",null),e([v()],ut.prototype,"spinnerEnabled",void 0),e([m("viewModel.title")],ut.prototype,"title",void 0),e([m("viewModel.updateLocationEnabled")],ut.prototype,"updateLocationEnabled",void 0),e([m("viewModel.view")],ut.prototype,"view",void 0),e([v({type:F}),x(["triggerAction","trigger-action"])],ut.prototype,"viewModel",void 0),e([m("viewModel.visible")],ut.prototype,"visible",void 0),e([v()],ut.prototype,"visibleElements",void 0),e([g("visibleElements")],ut.prototype,"castVisibleElements",null),e([I()],ut.prototype,"_close",null),e([I()],ut.prototype,"_toggleDockEnabled",null),e([I()],ut.prototype,"_toggleFeatureMenu",null),e([I()],ut.prototype,"_toggleActionsMenu",null),e([I()],ut.prototype,"_triggerAction",null),e([I()],ut.prototype,"_selectFeature",null),e([I()],ut.prototype,"_next",null),e([I()],ut.prototype,"_previous",null),ut=e([b("esri.widgets.Popup")],ut);const ct=ut;export{D as S,ct as default};
