/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{_ as t}from"../chunks/tslib.es6.js";import{m as e,i as s,x as i,r as o,u as r,b as n,o as a,T as l,I as p}from"../core/lang.js";import{m as c}from"../chunks/memoize.js";import{o as m,throwIfAborted as u,createTask as d}from"../core/promiseUtils.js";import{watch as h,initial as g}from"../core/reactiveUtils.js";import{aliasOf as j}from"../core/accessorSupport/decorators/aliasOf.js";import"../chunks/ensureType.js";import{property as b}from"../core/accessorSupport/decorators/property.js";import{subclass as f}from"../core/accessorSupport/decorators/subclass.js";import y from"./Widget.js";import k from"./ElevationProfile/ElevationProfileViewModel.js";import v from"../core/Accessor.js";import _ from"../core/Collection.js";import{init as C}from"../core/watchUtils.js";import{substitute as x}from"../intl.js";import{t as S}from"../chunks/throttle.js";import{f as P,i as w,u as L}from"../chunks/unitFormatUtils.js";import{F as E,N as M,a as U,M as T,E as I,P as B,b as A,L as F}from"./ElevationProfile/ElevationProfileLine.js";import{e as D,i as z,o as V}from"../chunks/widgetUtils.js";import{m as O}from"../chunks/messageBundle.js";import"../chunks/Logger.js";import{t as R}from"../chunks/jsxFactory.js";import{t as $,c as W}from"../chunks/unitUtils.js";import{P as G}from"../chunks/Popover.js";import{m as H,h as N}from"../chunks/handleUtils.js";import{l as Y}from"./Feature.js";import{i as X}from"../chunks/widgetThemeUtils.js";import{a as q}from"../chunks/number.js";import"../core/Error.js";import"../chunks/object.js";import"../config.js";import"../chunks/string.js";import"../chunks/watch.js";import"../chunks/ArrayPool.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/tracking.js";import"../chunks/metadata.js";import"../chunks/deprecate.js";import"../chunks/domUtils.js";import"../chunks/Evented.js";import"../core/Handles.js";import"../chunks/shared.js";import"../chunks/Promise.js";import"../chunks/uuid.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/projector.js";import"../chunks/assets.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/locale.js";import"../chunks/messages.js";import"../chunks/jsonMap.js";import"../Graphic.js";import"../geometry.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../chunks/JSONSupport.js";import"../chunks/reader.js";import"../geometry/SpatialReference.js";import"../chunks/writer.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../chunks/Ellipsoid.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../PopupTemplate.js";import"../layers/support/fieldUtils.js";import"../chunks/arcadeOnDemand.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../chunks/enumeration.js";import"../popup/support/FieldInfoFormat.js";import"../chunks/date.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../chunks/chartMediaInfoUtils.js";import"../chunks/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../support/actions/ActionBase.js";import"../chunks/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../Color.js";import"../chunks/colorUtils.js";import"../chunks/mathUtils.js";import"../chunks/common.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils3.js";import"../symbols/edges/Edges3D.js";import"../chunks/screenUtils.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils4.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../chunks/aaBoundingRect.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../chunks/persistableUrlUtils.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../portal/Portal.js";import"../chunks/Loadable.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../chunks/Clonable.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../chunks/Thumbnail.js";import"../chunks/Symbol3DVerticalOffset.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../chunks/byteSizeEstimations.js";import"../chunks/LRUCache.js";import"../chunks/MemCache.js";import"../chunks/ElevationQueryTileCache.js";import"../chunks/defaultUnit.js";import"../chunks/elevationInfoUtils.js";import"../chunks/unitConversionUtils.js";import"../chunks/lengthUtils.js";import"../chunks/vec2.js";import"../geometry/projection.js";import"../chunks/mat4.js";import"../chunks/pe.js";import"../chunks/projectionEllipsoid.js";import"../chunks/geodesicConstants.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"../chunks/zscale.js";import"../geometry/support/geodesicUtils.js";import"../chunks/QueueProcessor.js";import"../chunks/Queue.js";import"../chunks/Scheduler.js";import"../chunks/debugFlags.js";import"../chunks/traversalUtils.js";import"./ElevationProfile/ElevationProfileLineGround.js";import"../chunks/elevationQuerySourceUtils.js";import"../Ground.js";import"../chunks/compilerUtils.js";import"../chunks/loadAll.js";import"../chunks/asyncUtils.js";import"./ElevationProfile/ElevationProfileLineInput.js";import"../chunks/ElevationQuery.js";import"../layers/support/ElevationSampler.js";import"./ElevationProfile/ElevationProfileLineQuery.js";import"./ElevationProfile/ElevationProfileLineView.js";import"../chunks/vec4f64.js";import"../chunks/ray.js";import"../chunks/vectorStacks.js";import"../chunks/quatf64.js";import"../chunks/mat4f64.js";import"../chunks/vec2f64.js";import"../chunks/Intersector.js";import"../chunks/ViewingMode.js";import"../chunks/boundedPlane.js";import"../chunks/sphere.js";import"../chunks/lineSegment.js";import"../chunks/plane.js";import"../chunks/verticalOffsetUtils.js";import"../chunks/mat3.js";import"../chunks/quat.js";import"../chunks/vec3f32.js";import"../chunks/utils2.js";import"../chunks/Util.js";import"../chunks/doublePrecisionUtils.js";import"../chunks/intersectorUtilsConversions.js";import"../layers/GraphicsLayer.js";import"../chunks/GraphicsCollection.js";import"../core/HandleOwner.js";import"../layers/Layer.js";import"../chunks/BlendLayer.js";import"../chunks/jsonUtils.js";import"../chunks/parser.js";import"../chunks/mat4f32.js";import"../chunks/_commonjsHelpers.js";import"../chunks/ScaleRangeLayer.js";import"../chunks/ElevationInfo.js";import"../chunks/DOMContainer.js";import"./Popup.js";import"./Spinner/SpinnerViewModel.js";import"../chunks/AnchorElementViewModel.js";import"./Popup/PopupViewModel.js";import"../symbols/support/symbolUtils.js";import"../chunks/utils6.js";import"../chunks/ItemCache.js";import"../symbols/support/cimSymbolUtils.js";import"../chunks/utils7.js";import"../chunks/InputManager.js";import"../chunks/layerViewUtils.js";import"./Feature/FeatureViewModel.js";import"./Attachments/AttachmentsViewModel.js";import"../rest/query/support/AttachmentInfo.js";import"../rest/support/AttachmentQuery.js";import"../chunks/languageUtils.js";import"../chunks/datetime.js";import"../chunks/number3.js";import"../layers/support/Field.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/fieldType.js";import"../rest/support/Query.js";import"../TimeExtent.js";import"../chunks/timeUtils.js";import"../chunks/DataLayerSource.js";import"../rest/support/StatisticDefinition.js";import"../rest/support/RelationshipQuery.js";import"../tasks/QueryTask.js";import"../chunks/executeForTopCount.js";import"../chunks/utils5.js";import"../chunks/scaleUtils.js";import"../chunks/floorFilterUtils.js";import"../chunks/query.js";import"../geometry/support/normalizeUtils.js";import"../chunks/normalizeUtilsCommon.js";import"../chunks/pbfQueryUtils.js";import"../chunks/pbf.js";import"../chunks/OptimizedFeature.js";import"../chunks/OptimizedFeatureSet.js";import"../chunks/queryZScale.js";import"../chunks/featureConversionUtils.js";import"../rest/support/FeatureSet.js";import"../rest/support/TopFeaturesQuery.js";import"../rest/support/TopFilter.js";import"../chunks/executeQueryJSON.js";import"../tasks/Task.js";import"../layers/FeatureLayer.js";import"../renderers/ClassBreaksRenderer.js";import"../renderers/Renderer.js";import"../renderers/support/AuthoringInfo.js";import"../renderers/support/AuthoringInfoVisualVariable.js";import"../chunks/colorRamps.js";import"../rest/support/AlgorithmicColorRamp.js";import"../rest/support/ColorRamp.js";import"../rest/support/MultipartColorRamp.js";import"../chunks/VisualVariablesMixin.js";import"../renderers/visualVariables/ColorVariable.js";import"../renderers/visualVariables/VisualVariable.js";import"../chunks/LegendOptions.js";import"../renderers/visualVariables/support/ColorStop.js";import"../renderers/visualVariables/OpacityVariable.js";import"../renderers/visualVariables/support/OpacityStop.js";import"../renderers/visualVariables/RotationVariable.js";import"../renderers/visualVariables/SizeVariable.js";import"../renderers/visualVariables/support/SizeStop.js";import"../chunks/sizeVariableUtils.js";import"../chunks/visualVariableUtils.js";import"../renderers/support/ClassBreakInfo.js";import"../chunks/commonProperties2.js";import"../symbols/support/jsonUtils.js";import"../chunks/symbolConversion.js";import"../renderers/DictionaryRenderer.js";import"../chunks/DictionaryLoader.js";import"../renderers/DotDensityRenderer.js";import"../renderers/support/AttributeColorInfo.js";import"../renderers/HeatmapRenderer.js";import"../renderers/support/HeatmapColorStop.js";import"../renderers/SimpleRenderer.js";import"../renderers/UniqueValueRenderer.js";import"../chunks/diffUtils.js";import"../renderers/support/UniqueValueInfo.js";import"../chunks/styleUtils.js";import"../renderers/support/jsonUtils.js";import"../chunks/MultiOriginJSONSupport.js";import"../core/sql.js";import"../form/FormTemplate.js";import"../form/ExpressionInfo.js";import"../form/elements/GroupElement.js";import"../form/elements/FieldElement.js";import"../form/elements/support/inputs.js";import"../form/elements/inputs/BarcodeScannerInput.js";import"../form/elements/inputs/TextInput.js";import"../form/elements/inputs/Input.js";import"../form/elements/inputs/ComboBoxInput.js";import"../form/elements/inputs/DateTimePickerInput.js";import"../form/elements/inputs/RadioButtonsInput.js";import"../form/elements/inputs/SwitchInput.js";import"../form/elements/inputs/TextAreaInput.js";import"../form/elements/inputs/TextBoxInput.js";import"../form/support/elements.js";import"../geometry/HeightModelInfo.js";import"../chunks/FeatureIndex.js";import"../core/workers/workers.js";import"../core/workers/Connection.js";import"../core/workers/RemoteClient.js";import"../chunks/APIKeyMixin.js";import"../chunks/ArcGISService.js";import"../chunks/arcgisLayerUrl.js";import"../chunks/CustomParametersMixin.js";import"../chunks/FeatureEffectLayer.js";import"../layers/support/FeatureEffect.js";import"../layers/support/FeatureFilter.js";import"../chunks/OperationalLayer.js";import"../chunks/commonProperties.js";import"../support/timeUtils.js";import"../chunks/OrderedLayer.js";import"../chunks/PortalLayer.js";import"../portal/PortalItem.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"../chunks/RefreshableLayer.js";import"../chunks/TemporalLayer.js";import"../TimeInterval.js";import"../layers/support/TimeInfo.js";import"../chunks/featureReductionUtils.js";import"../layers/support/FeatureReductionSelection.js";import"../layers/support/FeatureReductionCluster.js";import"../layers/support/LabelClass.js";import"../chunks/labelUtils.js";import"../chunks/defaultsJSON.js";import"../layers/support/FeatureTemplate.js";import"../layers/support/FeatureType.js";import"../chunks/fieldProperties.js";import"../layers/support/FieldsIndex.js";import"../layers/support/GeometryFieldsInfo.js";import"../chunks/labelingInfo.js";import"../layers/support/LayerFloorInfo.js";import"../layers/support/Relationship.js";import"../chunks/versionUtils.js";import"../chunks/styleUtils2.js";import"../support/popupUtils.js";import"../chunks/actions.js";import"../chunks/GoTo.js";import"../chunks/Heading.js";import"../chunks/accessibleHandler.js";import"../chunks/vmEvent.js";import"./Attachments.js";import"./support/widget.js";import"./Sketch/SketchViewModel.js";import"../geometry/Circle.js";import"../chunks/keybindings.js";import"../chunks/QueryEngineResult.js";import"../chunks/quantizationUtils.js";import"../core/sql/WhereClause.js";import"../chunks/utils11.js";import"../chunks/generateRendererUtils.js";import"../chunks/projectionSupport.js";import"../chunks/json.js";import"../chunks/utils17.js";import"../chunks/Settings2.js";import"../chunks/RightAngleSnappingHint.js";import"../chunks/geometry2dUtils.js";import"../views/interactive/snapping/SnappingOptions.js";import"../views/interactive/snapping/FeatureSnappingLayerSource.js";import"../chunks/screenUtils2.js";import"../chunks/Material.js";import"../chunks/VertexAttribute.js";import"../chunks/basicInterfaces.js";const Q="esri-elevation-profile",Z={esriWidget:"esri-widget--panel esri-widget",esriWidgetDisabled:"esri-widget--disabled",buttonDisabled:"esri-button--disabled",widgetIcon:"esri-icon-elevation-profile",base:`${Q}`,portrait:`${Q}--portrait`,refined:`${Q}--refined`,mainContainer:`${Q}__main-container`,promptContainer:`${Q}__prompt-container`,header:`${Q}__header`,zoomOutButton:`${Q}__zoom-out-button esri-icon-zoom-out-magnifying-glass`,clearButton:`${Q}__clear-button esri-icon-trash`,actionButton:`${Q}__action-button esri-button`,sketchButton:`${Q}__sketch-button esri-button--primary`,sketchCancelButton:`${Q}__sketch-cancel-button esri-button--secondary`,sketchDoneButton:`${Q}__sketch-done-button esri-button--primary`,selectButton:`${Q}__select-button esri-button--secondary`,selectCancelButton:`${Q}__select-cancel-button esri-button--secondary`,chartContainer:`${Q}__chart-container`,chartSpinner:`${Q}__chart-spinner esri-icon-loading-indicator esri-rotating`,chartSpinnerVisible:`${Q}__chart-spinner--visible`,chartSpinnerSmall:`${Q}__chart-spinner--small`,footer:`${Q}__footer`},J={line:"amcharts-LineSeries",cursorEnabled:"amcharts-cursor--enabled",axisTooltip:"amcharts-axis-tooltip",seriesTooltip:"amcharts-series-tooltip"},K="esri-elevation-profile-legend",tt="esri-elevation-profile-legend-item",et={base:tt,disabled:`${tt}--disabled`,expanded:`${tt}--expanded`,colorIndicator:`${tt}__color-indicator`,header:`${tt}__header`,content:`${tt}__content`,collapseToggle:`${tt}__collapse-toggle esri-button esri-button--tertiary`,collapseToggleIcon:`${tt}__collapse-toggle__icon esri-icon-down`,label:`${tt}__label`,labelDisabled:`${tt}__label--disabled`,checkbox:`${tt}__checkbox`},st="esri-elevation-profile-statistics",it={base:st,statistic:`${st}__statistic`,statisticLabel:`${st}__statistic__label`,statisticValue:`${st}__statistic__value`,slopeValue:`${st}__slope-value`,slopeUpIcon:"esri-icon-arrow-up",slopeDownIcon:"esri-icon-arrow-down"},ot="esri-elevation-profile-settings",rt={base:`${ot} esri-icon-handle-vertical`,popoverContent:`${ot}__popover-content`,select:`${ot}__select esri-select`,selectLabel:`${ot}__select-label`,checkboxLabel:`${ot}__checkbox-label`,checkbox:`${ot}__checkbox`,uniformChartScalingCheckbox:`${ot}__uniform-chart-scaling-checkbox`};let nt=class extends v{constructor(){super(...arguments),this.legend=!0,this.chart=!0,this.clearButton=!0,this.settingsButton=!0,this.sketchButton=!0,this.selectButton=!0,this.unitSelector=!0,this.uniformChartScalingToggle=!0}};t([b()],nt.prototype,"legend",void 0),t([b()],nt.prototype,"chart",void 0),t([b()],nt.prototype,"clearButton",void 0),t([b()],nt.prototype,"settingsButton",void 0),t([b()],nt.prototype,"sketchButton",void 0),t([b()],nt.prototype,"selectButton",void 0),t([b()],nt.prototype,"unitSelector",void 0),t([b()],nt.prototype,"uniformChartScalingToggle",void 0),nt=t([f("esri.widgets.ElevationProfile.ElevationProfileVisibleElements")],nt);const at=nt;let lt=class extends y{constructor(t,e){super(t,e),this._messagesUnits=null,this._updateLayout=t=>{const e=t.parentElement,s=t.style.display;e.removeChild(t),document.body.appendChild(t),t.style.display="block";let i=80;for(const e of t.childNodes)e instanceof HTMLElement&&(i=Math.max(i,e.offsetWidth));document.body.removeChild(t),e.appendChild(t),t.style.display=s,t.style.setProperty("--max-width",`${i}px`)},this._updateLayoutThrottled=S(this._updateLayout,100)}initialize(){this.own(this._updateLayoutThrottled)}render(){return R("div",{bind:this,class:it.base,afterCreate:this._updateLayout,afterUpdate:this._updateLayoutThrottled},this._renderStatistics())}_renderStatistics(){var t;const e=null==(t=this._messages)?void 0:t.statistics;return e?[this._renderDistanceStatistic("maxDistance",e.maxDistance),this._renderElevationStatistic("elevationGain",e.gain),this._renderElevationStatistic("elevationLoss",e.loss),this._renderElevationStatistic("minElevation",e.minElevation),this._renderElevationStatistic("maxElevation",e.maxElevation),this._renderElevationStatistic("avgElevation",e.avgElevation),this._renderSlopeStatistic("maxPositiveSlope","maxNegativeSlope",e.maxSlope),this._renderSlopeStatistic("avgPositiveSlope","avgNegativeSlope",e.avgSlope)]:[]}_renderDistanceStatistic(t,e){const s=this._renderValue(t,(t=>{const e=this.effectiveUnits.distance;return P(this._messagesUnits,t,e,E)}));return this._renderStatistic(e,s)}_renderElevationStatistic(t,e){const s=this._renderValue(t,(t=>{const e=this.effectiveUnits.elevation;return P(this._messagesUnits,t,e,E)}));return this._renderStatistic(e,s)}_renderSlopeStatistic(t,e,s){const i=R("div",{key:"slope-up",class:it.slopeValue},R("div",{class:it.slopeUpIcon}),this._renderValue(t,(t=>w(t,"degrees",E))),R("div",{class:it.slopeDownIcon}),this._renderValue(e,(t=>w(t,"degrees",E))));return this._renderStatistic(s,i)}_renderStatistic(t,e){return R("div",{class:it.statistic},R("label",{class:it.statisticLabel},t),R("div",{class:it.statisticValue},e))}_renderValue(t,i){const o=this.line,r=1===o.progress?o.statistics:null,n=e(r,(e=>e[t]));return s(n)?i(n):M}};function pt(t,{profiles:e}){const i=t.title;if(s(i))return i;switch(t.type){case"ground":return e.ground;case"input":return e.input;case"query":return e.query;case"view":return e.view;default:return""}}t([b()],lt.prototype,"effectiveUnits",void 0),t([b()],lt.prototype,"line",void 0),t([b(),O("esri/widgets/ElevationProfile/t9n/ElevationProfile")],lt.prototype,"_messages",void 0),t([b(),O("esri/core/t9n/Units")],lt.prototype,"_messagesUnits",void 0),lt=t([f("esri.widgets.ElevationProfile.Statistics")],lt);let ct=class extends y{constructor(t,e){super(t,e),this.expanded=!1,this.checkboxVisible=!0,this._messages=null}initialize(){this._statistics=new lt(this._statisticsProps),this.own(this.watch("_statisticsProps",(t=>{this._statistics.set(t)})))}destroy(){this._statistics=i(this._statistics)}render(){const t=this.expanded;return R("div",{key:this,class:this.classes(et.base,{[et.disabled]:this.disabled,[et.expanded]:t})},this._renderColorIndicator(),R("div",{key:"header",class:et.header},this._renderLabelWithCheckbox(),this._renderCollapseToggleButton()),t&&R("div",{key:"content",class:et.content},this._statistics.render()))}get disabled(){return!this.line.available}get _statisticsProps(){return{line:this.line,effectiveUnits:this.effectiveUnits}}_renderColorIndicator(){return R("div",{key:"color-indicator",class:et.colorIndicator,styles:{backgroundColor:this.line.color.toCss()}})}_renderCollapseToggleButton(){const t=this._messages,e=this.expanded?t.hideDetails:t.showDetails;return R("button",{key:"collapse-toggle",bind:this,class:et.collapseToggle,onclick:this._onCollapseToggleClick,title:e,"aria-label":e,type:"button"},R("span",{class:et.collapseToggleIcon}))}_onCollapseToggleClick(){this.onExpandedToggle()}_renderLabelWithCheckbox(){const{line:t,checkboxVisible:e,disabled:s}=this,i=`${et.base}__check-${t.id}`;return R("label",{key:"id",for:i,class:this.classes(et.label,{[et.labelDisabled]:s||!e})},e&&this._renderCheckbox(i),R("span",null,pt(t,this._messages)))}_renderCheckbox(t){const e=this.line,s=e.visible,i=this.disabled,o=this._messages,r=s?o.hideProfile:o.showProfile,n=pt(e,this._messages),a=x(r,{name:n});return R("input",{key:"checkbox",id:t,type:"checkbox",class:et.checkbox,title:a,checked:s,disabled:i,"aria-label":a,bind:this,onchange:t=>this._onCheckboxToggle(t,e)})}_onCheckboxToggle(t,e){t.stopPropagation(),e.toggleVisibility()}};t([b({nonNullable:!0})],ct.prototype,"effectiveUnits",void 0),t([b({nonNullable:!0})],ct.prototype,"line",void 0),t([b()],ct.prototype,"expanded",void 0),t([b()],ct.prototype,"disabled",null),t([b()],ct.prototype,"checkboxVisible",void 0),t([b()],ct.prototype,"onExpandedToggle",void 0),t([b()],ct.prototype,"_statistics",void 0),t([b(),O("esri/widgets/ElevationProfile/t9n/ElevationProfile")],ct.prototype,"_messages",void 0),ct=t([f("esri.widgets.ElevationProfile.LegendItem")],ct);let mt=class extends y{constructor(t,e){super(t,e),this._items=new _,this._expandedLine=null}initialize(){this.own([C(this,"profiles",(t=>{this._destroyItems(),this._items.addMany(t.map((t=>this._createItemForLine(t))))})),this.watch("effectiveUnits",(t=>{this._items.forEach((e=>{e.effectiveUnits=t}))}))])}destroy(){this._destroyItems()}render(){return R("div",{class:K},this._items.toArray().map((t=>t.render())))}_onExpandedToggle(t){this._expandedLine=t===this._expandedLine?null:t,this._items.forEach((t=>t.expanded=t.line===this._expandedLine))}_createItemForLine(t){return new ct({line:t,effectiveUnits:this.effectiveUnits,expanded:t===this._expandedLine,checkboxVisible:this.profiles.length>1,onExpandedToggle:()=>this._onExpandedToggle(t)})}_destroyItems(){this._items.drain((t=>t.destroy()))}};t([b()],mt.prototype,"profiles",void 0),t([b()],mt.prototype,"effectiveUnits",void 0),t([b()],mt.prototype,"_items",void 0),t([b()],mt.prototype,"_expandedLine",void 0),mt=t([f("esri.widgets.ElevationProfile.Legend")],mt);let ut=class extends y{constructor(t,e){super(t,e),this._messagesUnits=null,this._popover=null,this._buttonElement=null,this._focusOutElement=null,this._requestFocusOnCreate=!1}destroy(){this._destroyPopover()}render(){const{unitSelector:t,uniformChartScalingToggle:e}=this.visibleElements;if(!t&&!e)return R("div",{key:`${this.id}-empty`});const i=s(this._popover)&&this._popover.open?this._messages.hideSettings:this._messages.showSettings;return R("button",{class:rt.base,title:i,bind:this,afterCreate:this._initializePopover,onclick:this._togglePopover,"aria-label":i,type:"button"})}_initializePopover(t){this._destroyPopover(),this._buttonElement=t,this._popover=new G({owner:this,placement:"bottom-end",offset:[0,0],anchorElement:t,renderContentFunction:()=>this._renderPopoverContent()})}_destroyPopover(){this._focusOutElement=o(this._focusOutElement),this._popover=i(this._popover)}_renderPopoverContent(){const{unitSelector:t,uniformChartScalingToggle:e}=this.visibleElements;return R("div",{class:rt.popoverContent,dir:D(r(this._buttonElement)),bind:this,afterCreate:this._onPopoverContentAfterCreate},t&&this._renderUnitSelector(),e&&this._renderUniformChartScalingToggle())}_renderUnitSelector(){const{unit:t,unitOptions:e}=this.viewModel,s=this._messagesUnits;return R("label",{key:"unit-selector-label",class:rt.selectLabel},this._messages.unitSelectLabel,R("select",{class:rt.select,value:t,bind:this,onchange:this._onUnitChange,afterCreate:this._onUnitSelectAfterCreate},e.map((t=>R("option",{key:t,value:t},$(t)?s.systems[t]:s.units[t].pluralCapitalized)))))}_onUnitChange(t){this.viewModel.unit=t.target.value}_onUnitSelectAfterCreate(t){this._requestFocusOnCreate&&(this._requestFocusOnCreate=!1,t.focus())}_renderUniformChartScalingToggle(){const t=this._messages,e=this.viewModel.uniformChartScaling,s=e?t.uniformChartScalingDisable:t.uniformChartScalingEnable;return R("label",{key:"uniform-chart-scaling-label",class:rt.checkboxLabel,onmousedown:dt},R("input",{class:this.classes(rt.checkbox,rt.uniformChartScalingCheckbox),type:"checkbox",checked:e,title:s,"aria-label":s,bind:this,onchange:this._onUniformChartScalingChange}),t.uniformChartScalingLabel)}_onUniformChartScalingChange(t){this.viewModel.uniformChartScaling=t.target.checked}_togglePopover(t){s(this._popover)&&this._popover.open?this._closePopover():this._openPopover()}_openPopover(){e(this._popover,(t=>t.open=!0)),this._requestFocusOnCreate=!0}_closePopover({focusOnButton:t=!0}={}){e(this._popover,(t=>t.open=!1)),t&&e(this._buttonElement,(t=>t.focus()))}_onPopoverContentAfterCreate(t){o(this._focusOutElement),this._focusOutElement=m(t,"focusout",(({relatedTarget:e})=>{const s=t.contains(e),i=e===this._buttonElement;s||i||this._closePopover({focusOnButton:!1})}))}};function dt(t){t.preventDefault()}function ht(t,e){const s=Math.floor(Math.log10(t)),i=t/10**s;let o;return o=e?i<1.5?1:i<3?2:i<5?2.5:i<7?5:10:i<=1?1:i<=2?2:i<=3?2.5:i<=5?5:10,o*10**s}t([b()],ut.prototype,"viewModel",void 0),t([b()],ut.prototype,"visibleElements",void 0),t([b(),O("esri/widgets/ElevationProfile/t9n/ElevationProfile")],ut.prototype,"_messages",void 0),t([b(),O("esri/core/t9n/Units")],ut.prototype,"_messagesUnits",void 0),ut=t([f("esri.widgets.ElevationProfile.SettingsButton")],ut);const gt={sideSpacing:15,paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0,axisFontSize:9,axisFontWeight:"400",axisGridStroke:"#f4f4f4",axisLabelsFontSize:9,axisLabelsFontWeight:"400",axisLabelsColor:"#a9a9a9",axisTooltipFontSize:12,axisTooltipBackgroundColor:"#323232",axisTooltipLabelColor:"#f8f8f8",axisTooltipPaddingTop:Math.round(3),axisTooltipPaddingBottom:Math.round(3),axisTooltipPaddingHorizontal:Math.round(3.75),xAxisMinGridDistance:50,xAxisLabelsSpacing:Math.round(6),xAxisMinLabelPosition:.05,xAxisMaxLabelPosition:.9,yAxisMinGridDistance:30,yAxisLabelSpacing:Math.round(3.75),yAxisMinLabelPosition:0,yAxisMaxLabelPosition:.8,seriesTooltipFontSize:12,seriesTooltipBackgroundColor:"#f8f8f8",seriesTooltipLabelColor:"#323232",seriesFillLighten:.9,seriesTooltipSpacing:6,seriesTooltipPaddingVertical:Math.round(3.75),seriesTooltipPaddingHorizontal:Math.round(3.75),tooltipBorderRadius:0},jt={...gt,axisGridStroke:"#323232",axisLabelsColor:"#a9a9a9",axisTooltipBackgroundColor:"#323232",axisTooltipLabelColor:"#f8f8f8",seriesTooltipBackgroundColor:"#323232",seriesTooltipLabelColor:"#f8f8f8",seriesFillLighten:-.75},bt={minX:void 0,maxX:void 0,minY:void 0,maxY:void 0};async function ft(t){const i=await Y();u(t.abortOptions);const{am4core:o,am4charts:r}=i;o.options.minPolylineStep=.5,o.options.autoSetClassName=!0,o.options.animationsEnabled=!1;const a=X(),l=a?jt:gt;a&&o.useTheme(i.am4themes_dark);const p=o.create(t.container,r.XYChart);p.arrangeTooltips=!1,p.preloader.disabled=!0,p.zoomOutButton.disabled=!0;const c=z(t.container);p.rtl=c,p.padding(l.paddingTop,c?l.paddingLeft:l.paddingRight,l.paddingBottom,c?l.paddingRight:l.paddingLeft);const m=p.plotContainer.background;m.strokeWidth=0,m.strokeOpacity=0,m.stroke=null;const d=p.xAxes.push(new r.ValueAxis),h=p.yAxes.push(new r.ValueAxis),g={params:t,amCharts4Index:i,amChart:p,xAxis:d,yAxis:h,series:new Map,data:null,messages:null,theme:l,zooming:!1,pointerIsOver:!1};p.cursor=function(t){const e=new t.amCharts4Index.am4charts.XYCursor;return e.trackable=!0,e.lineY.disabled=!0,e.behavior="zoomXY",e}(g),function(t){const e=t.theme,s=t.amChart.tooltip,{am4core:i}=t.amCharts4Index;s.id="series-tooltip",s.fitPointerToBounds=!0,s.pointerOrientation="vertical",s.zIndex=-1,s.getFillFromObject=!1,s.label.fontSize=e.seriesTooltipFontSize,s.label.fill=i.color(e.seriesTooltipLabelColor),s.label.padding(e.seriesTooltipPaddingVertical,e.seriesTooltipPaddingHorizontal,e.seriesTooltipPaddingVertical,e.seriesTooltipPaddingHorizontal),s.background.cornerRadius=e.tooltipBorderRadius,s.background.stroke=null,s.background.fill=i.color(e.seriesTooltipBackgroundColor),s.background.padding(0,0,0,0),s.adapter.add("dy",(()=>e.seriesTooltipSpacing*(s.background.pointerY<=0?1:-1))),z(t.params.container)&&(s.label.textAlign="middle")}(g),function(t){const{xAxis:e,theme:s}=t,{am4core:i}=t.amCharts4Index;e.numberFormatter=Mt(t,"distance"),e.strictMinMax=!0,e.cursorTooltipEnabled=!1,e.title.visible=!1;const o=e.renderer;o.line.visible=!1,o.minGridDistance=s.xAxisMinGridDistance,o.minLabelPosition=s.xAxisMinLabelPosition,o.maxLabelPosition=s.xAxisMaxLabelPosition,o.fontWeight=s.axisFontWeight,o.fontSize=s.axisFontSize,o.baseGrid.disabled=!0;const r=o.labels.template;r.fontSize=s.axisLabelsFontSize,r.fontWeight=s.axisLabelsFontWeight,r.fill=i.color(s.axisLabelsColor),r.paddingTop=s.xAxisLabelsSpacing,r.horizontalCenter="left",r.paddingLeft=0;const n=e.tooltip;n.id="axis-tooltip",n.background.fill=i.color(s.axisTooltipBackgroundColor),n.background.stroke=null,n.background.padding(0,0,0,0),n.label.fontSize=s.axisTooltipFontSize,n.label.fill=i.color(s.axisTooltipLabelColor),n.label.padding(s.axisTooltipPaddingTop,s.axisTooltipPaddingHorizontal,s.axisTooltipPaddingBottom,s.axisTooltipPaddingHorizontal);const a=o.grid.template;a.strokeOpacity=1,a.stroke=i.color(s.axisGridStroke)}(g),function(t){const{yAxis:e,theme:s}=t,{am4core:i}=t.amCharts4Index;e.numberFormatter=Mt(t,"elevation"),e.title.visible=!1,e.cursorTooltipEnabled=!1,e.strictMinMax=!0,e.baseValue=U;const o=e.renderer;o.inside=!0,o.line.opacity=0,o.line.visible=!1,o.minGridDistance=s.yAxisMinGridDistance,o.minLabelPosition=s.yAxisMinLabelPosition,o.maxLabelPosition=s.yAxisMaxLabelPosition,o.fontWeight=s.axisFontWeight,o.fontSize=s.axisFontSize,o.baseGrid.disabled=!0;const r=o.labels.template;r.fontSize=s.axisLabelsFontSize,r.fontWeight=s.axisLabelsFontWeight,r.fill=i.color(s.axisLabelsColor),r.verticalCenter="bottom",r.paddingLeft=s.yAxisLabelSpacing,r.paddingBottom=0;const n=o.grid.template;n.strokeOpacity=1,n.stroke=i.color(s.axisGridStroke),z(t.params.container)&&(o.opposite=!0,r.textAlign="middle",r.paddingLeft=0,r.paddingRight=s.yAxisLabelSpacing)}(g);const j=[St(g,t.onRangeChange),wt(g,t.onCursorPositionChange),Pt(g)];let b=null,f=!1;const y=()=>{n(b)||("undefined"!=typeof window&&"cancelIdleCallback"in window?window.cancelIdleCallback(b):clearTimeout(b),b=null)};return{...g,destroy(){f=!0,y(),N(j).remove(),p.dispose()},update(t){if(t.data===g.data&&t.messages===g.messages)return;if(y(),f)return;const i=()=>{f||(b=null,function(t,{data:i,messages:o}){const r=s(i)&&i.refined;t.amChart.cursor.disabled=!r,t.amChart.htmlContainer.classList.toggle(J.cursorEnabled,r);const a=t.data!==i,l=e(t.data,(t=>t.effectiveUnits))!==e(i,(t=>t.effectiveUnits));t.data=i,t.messages=o,a&&(function(t){const{xAxis:s,yAxis:i}=t,{minX:o,maxX:r,minY:a,maxY:l}=function({data:t,pixelWidth:s,pixelHeight:i}){if(n(t))return bt;const o=t.statistics,r=0,a=e(o,(t=>t.maxDistance));let l=e(o,(t=>t.minElevation)),p=e(o,(t=>t.maxElevation));if(n(a)||n(l)||n(p))return bt;const c=Math.max(a-r,.001);let m=Math.max(p-l,.001);const u=t.effectiveUnits;if(t.dynamicElevationRange){const t=W(c,u.distance,u.elevation);m=Math.max(m,t/T)}if(l-=.02*m,p=l+m+.02*m,[l,p]=function(t,e,s=10){const i=ht(e-t,!1);if(0===i)return[t,e];const o=ht(i/(s-1),!0);return[Math.floor(t/o)*o,Math.ceil(e/o)*o]}(l,p,10),m=p-l,t.uniformScaling)return yt({data:t,bounds:{minX:r,maxX:a,minY:l,maxY:p},pixelWidth:s,pixelHeight:i,centered:!0});return{minX:r,maxX:r+c,minY:l,maxY:l+m}}({data:t.data,pixelWidth:s.pixelWidth,pixelHeight:i.pixelHeight});s.min=o,s.max=r,i.min=a,i.max=l}(t),function(t){const{amChart:s,data:i}=t;if(n(i)||0===i.lines.length)return void s.series.clear();const o=new Map,r=new Set(s.series.values),a=i.lines.length;for(let n=0;n<a;n++){const l=i.lines[n];let p=t.series.get(l.id);p?(e(p.fill,(t=>r.delete(t))),r.delete(p.line)):(p=Ct(t,l),e(p.fill,(t=>s.series.push(t))),s.series.push(p.line)),o.set(p.id,p);const c=a-n-1;e(p.fill,(t=>t.zIndex=c)),p.line.zIndex=a+c,vt(t,p,l)}t.series=o;for(const t of r)s.series.removeValue(t)}(t));l&&(t.yAxis.invalidateLabels(),t.xAxis.invalidateLabels());Lt(t)}(g,t))};b="undefined"!=typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(i,{timeout:30}):setTimeout(i,30)},zoomOut(){f||(g.yAxis.zoom({start:0,end:1},!1,!0),g.xAxis.zoom({start:0,end:1},!1,!0))}}}function yt({data:t,bounds:e,pixelWidth:s,pixelHeight:i,centered:o}){if(n(t))return e;let{minX:r,maxX:a,minY:l,maxY:p}=e;const c=a-r,m=p-l,u=t.effectiveUnits,d=W(m,u.elevation,u.distance)/i/(c/s);return d>=1?[r,a]=kt([r,a],d,o):[l,p]=kt([l,p],1/d,o),{minX:r,maxX:a,minY:l,maxY:p}}function kt([t,e],s,i){const o=(e-t)*s;if(i){const s=(t+e)/2-o/2;return[s,s+o]}return[t,t+o]}function vt(t,{line:s,fill:i},o){const{theme:r}=t,{am4core:n}=t.amCharts4Index,{r:l,g:p,b:c,a:m}=o.color,u=n.color({r:l,g:p,b:c,a:m}),d=a(o.samples,[]),h=d.length>0;s.stroke=u,s.visible=h,e(i,(t=>{t.visible=h,t.fill=u.lighten(r.seriesFillLighten)}));const g=d.length,j=s.data;if(j.length===g){for(let t=0;t<g;++t)_t(j[t],d[t]);s.invalidateRawData(),e(i,(t=>t.invalidateRawData()))}else s.data=d,e(i,(t=>t.data=d))}function _t(t,e){t.x=e.x,t.y=e.y,t.z=e.z,t.distance=e.distance,t.elevation=e.elevation}function Ct(t,e){const{id:s}=e,i=xt(t,`line-${s}`);i.strokeWidth=e.chartStrokeWidth,i.dy=e.chartStrokeOffsetY;let o=null;return e.chartFillEnabled&&(o=xt(t,`fill-${s}`),o.fillOpacity=1),{id:s,line:i,fill:o}}function xt(t,e){const s=new t.amCharts4Index.am4charts.LineSeries;s.id=e,s.showOnInit=!1,s.simplifiedProcessing=!0,s.minDistance=.5,s.excludeFromTotal=!0,s.clickable=!1,s.contextMenuDisabled=!0,s.cursorHoverEnabled=!1,s.cursorTooltipEnabled=!1,s.connect=!1,s.fill=null,s.stroke=null;s.dataFields.valueX="distance";return s.dataFields.valueY="elevation",s}function St(t,e){const{amChart:s,xAxis:i,yAxis:o}=t;let r=!1;const a=()=>{const{data:e}=t;if(!r||n(e)||!e.uniformScaling)return;r=!1;const{minX:a,maxX:l,minY:p,maxY:c}=yt({data:t.data,bounds:{minX:i.minZoomed,maxX:i.maxZoomed,minY:o.minZoomed,maxY:o.maxZoomed},pixelWidth:i.pixelWidth,pixelHeight:o.pixelHeight,centered:!0});i.zoomToValues(a,l,!0),o.zoomToValues(p,c,!0),s.validate(),Lt(t)},l=()=>{e(t.xAxis.zoomFactor,t.yAxis.zoomFactor)},p=e=>{t.zooming=e,Lt(t)},c=[s.events.on("down",(()=>p(!0))),s.events.on("up",(()=>p(!1))),s.cursor.events.on("zoomended",(()=>{r=!0})),i.events.on("startendchanged",a),o.events.on("startendchanged",a),i.events.on("rangechangeended",l),o.events.on("rangechangeended",l)];return H((()=>{c.forEach((t=>t.dispose()))}))}function Pt({xAxis:t,yAxis:e}){const s=t=>()=>{t.renderer.grid.each((t=>{t.visible="none"!==t.dataItem.label.dom.getAttribute("display")}))},i=[t.events.on("rangechangeended",s(t)),t.events.on("validated",s(t)),e.events.on("rangechangeended",s(e)),e.events.on("validated",s(e))];return H((()=>{i.forEach((t=>t.dispose()))}))}function wt(t,e){const{amChart:s,xAxis:i,yAxis:o}=t,{cursor:r,events:n}=s,a=e=>{t.pointerIsOver=e,Lt(t)},l=()=>{a(!1),e(null,null)},p=[r.events.on("cursorpositionchanged",(()=>{if(!t.pointerIsOver)return;Lt(t);const s=i.toAxisPosition(r.xPosition),n=o.toAxisPosition(r.yPosition);e(s,n)})),n.on("over",(()=>a(!0))),n.on("out",l),n.on("blur",l)];return H((()=>{p.forEach((t=>t.dispose()))}))}function Lt(t){const{amChart:i,xAxis:o,data:r,theme:a,zooming:l,pointerIsOver:p}=t;if(t.amChart.tooltip.hide(),t.xAxis.hideTooltip(),!p)return;if(l)return;if(n(r)||!r.refined)return;const c=function(t){const{amChart:i,yAxis:o,data:r}=t;if(n(r))return null;const a=r.lines.map((s=>({line:s,y:e(Ut(t,s),(t=>t.elevation))}))).sort(Et),l=a.length?a[0].y:null;if(n(l))return null;const p=i.cursor,c=o.measuredHeight,m=c+i.pixelPaddingTop;return{text:a.map((({y:e,line:i})=>function(t,e,i){const{data:o,messages:r}=t;if(n(o)||n(r))return"";const a=x(r.chartTooltip,{name:pt(e,r),elevation:s(i)?P(r,i,o.effectiveUnits.elevation,E):M});return`[${e.color.toHex()}]●[/] ${a}`}(t,i,e))).join("\n"),x:p.point.x+p.parent.pixelX+i.pixelPaddingLeft,y:m-o.valueToPosition(l)*c}}(t);if(s(c)){const{cursor:e,tooltip:r}=i;e.show(0),e.validate(),r.text=c.text,r.show(0),r.validate();const l=c.y-r.contentHeight-a.seriesTooltipSpacing;r.pointerOrientation=l<30?"up":"down",r.pointTo(c,!0),r.validate();const p=o.tooltip;p.text=function(t){const{data:e,messages:i}=t;if(n(e)||n(i))return"";const o=e.lines[0],r=o?Ut(t,o):null;return s(r)?P(i,r.distance,e.effectiveUnits.distance,E):"-"}(t),p.show(0),p.validate()}}function Et({y:t},{y:e}){return n(t)?1:n(e)?-1:e-t}function Mt(t,e){const s=t.xAxis.numberFormatter.clone();return s.format=(s,i,o)=>{const{messages:r,data:a}=t;if(n(r)||n(a)||"string"==typeof s)return"";return`${q(s,{maximumFractionDigits:o})} ${L(r,a.effectiveUnits[e],"abbr")}`},s}function Ut({amChart:t,xAxis:e},s){const i=a(s.samples,[]);if(0===i.length)return null;const o=e.toAxisPosition(t.cursor.xPosition),r=e.positionToValue(o);return l(i,r,(t=>t.distance))}var Tt;!function(t){t.Sketch="sketch",t.SketchCancel="sketch-cancel",t.SketchDone="sketch-done",t.Select="select",t.SelectCancel="select-cancel"}(Tt||(Tt={}));const It=[{type:Tt.Select},{type:Tt.Sketch}],Bt={[I.None]:null,[I.NoValidInput]:"noProfile",[I.NoVisibleProfiles]:"noProfile",[I.RefinedButNoChartData]:"noProfile",[I.TooComplex]:"tooComplex",[I.UnknownError]:"unknown",[I.InvalidGeometry]:"invalidGeometry",[I.InvalidElevationInfo]:"invalidElevationInfo"};let At=class extends y{constructor(t,e){super(t,e),this.viewModel=null,this.view=null,this.input=null,this.profiles=null,this.unitOptions=[],this.unit="metric",this.geodesicDistanceThreshold=1e5,this.visibleElements=new at,this.iconClass=Z.widgetIcon,this.label=void 0,this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this._chartContainer=null,this._chart=null,this._chartInitTask=null,this._chartIsRefined=!1,this._portrait=!1,this._zoomOutButtonVisible=!1,this._getChartUpdateParamsMemoized=c(((t,e,s,i)=>({chart:t,data:e,stationary:s,messages:i}))),this._getDetailsPropsMemoized=c(((t,e)=>({effectiveUnits:t,profiles:e}))),null!=t&&t.viewModel||(this._defaultViewModel=new k({view:null==t?void 0:t.view}),this.viewModel=this._defaultViewModel)}initialize(){this._legend=new mt(this._legendProps),this._settingsButton=new ut(this._settingsButtonProps),this.own([h((()=>this._legendProps),(t=>this._legend.set(t))),h((()=>this._settingsButtonProps),(t=>this._settingsButton.set(t)))])}postInitialize(){this.own([h((()=>this._chartContainer),(()=>{this._destroyChart();const t=this._chartContainer;n(t)||(this._chartInitTask=d((e=>this._initializeChart(t,e))))}),g),h((()=>this._chartUpdateParams),(()=>this._updateChart(this._chartUpdateParams)),g)])}destroy(){this._destroyChart(),s(this._defaultViewModel)&&this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy(),this._legend=i(this._legend),this._settingsButton=i(this._settingsButton)}get _chartUpdateParams(){const t=this.view;return this._getChartUpdateParamsMemoized(this._chart,this.viewModel.chartData,!s(t)||t.stationary,this._chartMessages)}get _chartMessages(){return{...this.messagesUnits,...this.messages}}get _legendProps(){return this._getDetailsPropsMemoized(this.viewModel.effectiveUnits,this._profilesArray)}get _profilesArray(){return this.profiles.toArray()}get _settingsButtonProps(){return{viewModel:this.viewModel,visibleElements:this.visibleElements}}render(){const{viewModel:t,visible:e}=this;return R("div",{key:this,class:this.classes({[Z.base]:e,[Z.esriWidget]:e,[Z.esriWidgetDisabled]:e&&"disabled"===t.state,[Z.portrait]:this._portrait,[Z.refined]:1===t.progress}),"aria-label":this.messages.widgetLabel,afterCreate:t=>{this.own(V(t,(t=>{this._portrait=t.contentRect.width<B})))}},e&&this._renderContentForState())}_renderContentForState(){switch(this.viewModel.state){case A.Ready:return this._renderContentForReadyState();case A.Selecting:return this._renderContentForSelectingState();case A.Creating:return this._renderContentForCreatingState();case A.Selected:return this._renderContentForSelectedState();case A.Created:return this._renderContentForCreatedState();case A.Disabled:return this._renderContentForReadyState()}}_renderContentForReadyState(){const{sketchButton:t,selectButton:e}=this.visibleElements,s=this.messages;let i;if(t&&e)i=s.readyPrompt;else if(t)i=s.readyPromptCreateOnly;else if(e)i=s.readyPromptSelectOnly;else{var o;i=null==(o=s.errors)?void 0:o.noProfile}return this._renderContent({prompt:i,chart:!1,actions:It})}_renderContentForSelectingState(){const t=this.view;if(n(t))return null;const e=this.messages[`selectingPrompt-${t.type}`];return this._renderContent({prompt:e,chart:!1,actions:[{type:Tt.SelectCancel}]})}_renderContentForCreatingState(){const{view:t,viewModel:e}=this;if(n(t))return null;const s=e.hasVertices?[{type:Tt.SketchCancel},{type:Tt.SketchDone,disabled:!e.tool.interaction.canStopCreating}]:[{type:Tt.Select},{type:Tt.Sketch,disabled:!0}];if(e.errorState===I.NoValidInput){const e=this.messages[`creatingPrompt-${t.type}`];return this._renderContent({chart:!1,actions:s,prompt:e})}const i=this._getErrorMessage();return i?this._renderContent({chart:!1,actions:s,prompt:i}):this._renderContent({chart:!0,actions:s})}_renderContentForSelectedState(){const t=this._getErrorMessage();return t?this._renderContent({chart:!1,actions:It,prompt:t}):this._renderContent({chart:!0,actions:It})}_renderContentForCreatedState(){const t=this._getErrorMessage();return t?this._renderContent({chart:!1,actions:It,prompt:t}):this._renderContent({chart:!0,actions:It})}_getErrorMessage(){var t,e;const s=Bt[this.viewModel.errorState];return null==(t=this.messages)||null==(e=t.errors)?void 0:e[s]}_renderContent(t){const e=s(t.prompt)?this._renderPrompt(t.prompt):t.chart&&this._renderChart(),i=s(this.viewModel.input);return[R("header",{key:"header",class:Z.header},this._zoomOutButtonVisible&&this._renderZoomOutButton(),this.visibleElements.clearButton&&i&&this._renderClearButton(),this.visibleElements.settingsButton&&this._settingsButton.render()),R("div",{class:Z.mainContainer},...e),this.visibleElements.legend&&this._legend.render(),this._renderActions(t)]}_renderZoomOutButton(){return R("button",{key:"zoom-out",class:Z.zoomOutButton,bind:this,onclick:this._onZoomOutButtonClick,title:this.messages.zoomOut,type:"button"})}_onZoomOutButtonClick(){e(this._chart,(t=>t.zoomOut()))}_renderClearButton(){return R("button",{key:"clear-profile",class:Z.clearButton,bind:this,onclick:this._onClearButtonClick,title:this.messages.clearProfile,type:"button"})}_onClearButtonClick(){this.viewModel.clear()}_renderPrompt(t){return[R("div",{key:"prompt-container",bind:this,class:Z.promptContainer},R("p",null,t))]}_renderChart(){if(!this.visibleElements.chart)return[R("div",{key:"empty-chart-container",class:Z.chartContainer})];const t=this._chartIsRefined||this._canRenderChart();if(!t)return[this._renderSpinner({size:"large"}),R("div",{key:"chart-container-empty",class:Z.chartContainer})];const{chartData:e,progress:i}=this.viewModel;return[s(e)&&i>0&&i<1&&this._renderSpinner({size:t?"small":"large"}),R("div",{key:"chart-container",bind:this,class:Z.chartContainer,afterCreate:this._onChartContainerAfterCreate,afterRemoved:this._onChartContainerRemoved})]}_renderSpinner(t){return R("div",{key:"spinner",class:this.classes(Z.chartSpinner,{[Z.chartSpinnerSmall]:"small"===t.size}),afterCreate:this._onSpinnerAfterCreate,exitAnimation:this._onSpinnerExit})}_onSpinnerAfterCreate(t){requestAnimationFrame((()=>t.classList.add(Z.chartSpinnerVisible)))}_onSpinnerExit(t,e){t.classList.remove(Z.chartSpinnerVisible),setTimeout(e,200)}_canRenderChart(){const t=this.viewModel.chartData;if(n(t))return!1;if(!this.viewModel.inputIsSketched)return t.refined;let e=0;for(const{samples:i}of t.lines)e+=s(i)?i.length:0;return t.refined||e<=F}_renderActions({actions:t}){const e=t.map((t=>{switch(t.type){case Tt.Sketch:return this.visibleElements.sketchButton&&this._renderAction({action:t,onClick:this._onSketchButtonClick,className:Z.sketchButton,label:this.messages.sketchButtonLabel});case Tt.SketchCancel:return this.visibleElements.sketchButton&&this._renderAction({action:t,onClick:this._onCancelButtonClick,className:Z.sketchCancelButton,label:this.messagesCommon.cancel});case Tt.SketchDone:return this.visibleElements.sketchButton&&this._renderAction({action:t,onClick:this._onDoneButtonClick,className:Z.sketchDoneButton,label:this.messagesCommon.done});case Tt.Select:return this.visibleElements.selectButton&&this._renderAction({action:t,onClick:this._onSelectButtonClick,className:Z.selectButton,label:this.messages.selectButtonLabel});case Tt.SelectCancel:return this.visibleElements.selectButton&&this._renderAction({action:t,onClick:this._onCancelButtonClick,className:Z.selectCancelButton,label:this.messagesCommon.cancel})}})).filter(Boolean);return e.length?R("footer",{key:"footer",class:Z.footer},...e):null}_renderAction({action:t,onClick:e,className:s,label:i}){return R("button",{key:`action-${t.type}`,class:this.classes(Z.actionButton,s,{[Z.buttonDisabled]:t.disabled}),bind:this,disabled:t.disabled,onclick:e,type:"button"},i)}_onSketchButtonClick(){this.viewModel.start({mode:"sketch"})}_onSelectButtonClick(){this.viewModel.start({mode:"select"})}_onCancelButtonClick(){this.viewModel.cancel()}_onDoneButtonClick(){this.viewModel.stop()}_updateChart(t){const{data:e,chart:i,messages:o,stationary:r}=t;!n(i)&&!n(o)&&r&&this._canRenderChart()&&(i.update(t),this._chartIsRefined=s(e)&&e.refined)}_onChartContainerAfterCreate(t){this._chartContainer=t}_onChartContainerRemoved(){this._chartContainer=null}async _initializeChart(t,e){this._chart=await ft({container:t,abortOptions:{signal:e},onRangeChange:(t,e)=>{this._zoomOutButtonVisible=1!==t||1!==e},onCursorPositionChange:t=>{this.viewModel.hoveredChartPosition=t}}),this._updateChart(this._chartUpdateParams)}_destroyChart(){this._chartInitTask=p(this._chartInitTask),this._chart=i(this._chart),this._chartIsRefined=!1}};t([b({type:k})],At.prototype,"viewModel",void 0),t([j("viewModel.view")],At.prototype,"view",void 0),t([j("viewModel.input")],At.prototype,"input",void 0),t([j("viewModel.profiles")],At.prototype,"profiles",void 0),t([j("viewModel.unitOptions")],At.prototype,"unitOptions",void 0),t([j("viewModel.unit")],At.prototype,"unit",void 0),t([j("viewModel.geodesicDistanceThreshold")],At.prototype,"geodesicDistanceThreshold",void 0),t([b({type:at,nonNullable:!0})],At.prototype,"visibleElements",void 0),t([b()],At.prototype,"iconClass",void 0),t([j("messages.widgetLabel",{overridable:!0})],At.prototype,"label",void 0),t([j("viewModel.visible")],At.prototype,"visible",void 0),t([b(),O("esri/widgets/ElevationProfile/t9n/ElevationProfile")],At.prototype,"messages",void 0),t([b(),O("esri/t9n/common")],At.prototype,"messagesCommon",void 0),t([b(),O("esri/core/t9n/Units")],At.prototype,"messagesUnits",void 0),t([b()],At.prototype,"_chartContainer",void 0),t([b()],At.prototype,"_chart",void 0),t([b()],At.prototype,"_chartInitTask",void 0),t([b()],At.prototype,"_chartIsRefined",void 0),t([b()],At.prototype,"_settingsButton",void 0),t([b()],At.prototype,"_legend",void 0),t([b()],At.prototype,"_portrait",void 0),t([b()],At.prototype,"_zoomOutButtonVisible",void 0),t([b()],At.prototype,"_chartUpdateParams",null),t([b()],At.prototype,"_chartMessages",null),t([b()],At.prototype,"_legendProps",null),t([b()],At.prototype,"_profilesArray",null),t([b()],At.prototype,"_settingsButtonProps",null),At=t([f("esri.widgets.ElevationProfile")],At);const Ft=At;export{Ft as default};
