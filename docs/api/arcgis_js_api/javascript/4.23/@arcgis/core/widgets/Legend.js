/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import s from"../core/Handles.js";import{on as t,watch as i,init as r}from"../core/watchUtils.js";import{aliasOf as o}from"../core/accessorSupport/decorators/aliasOf.js";import"../core/lang.js";import{cast as l}from"../core/accessorSupport/decorators/cast.js";import{property as n}from"../core/accessorSupport/decorators/property.js";import{subclass as a}from"../core/accessorSupport/decorators/subclass.js";import c from"./Widget.js";import p from"./Legend/LegendViewModel.js";import{substitute as m}from"../intl.js";import{e as d}from"../chunks/screenUtils.js";import"../chunks/ensureType.js";import{g as h,a as u,r as y,b as g,c as f,d as v,e as b,f as _}from"../chunks/renderUtils.js";import{g as j}from"../chunks/utils6.js";import{i as k,c as w}from"../chunks/widgetUtils.js";import"../chunks/Logger.js";import{t as L}from"../chunks/jsxFactory.js";import{c as S}from"../chunks/projector.js";import{renderColorRampPreviewHTML as x}from"../symbols/support/symbolUtils.js";import{H as I,i as C}from"../chunks/Heading.js";import{a as E}from"../chunks/accessibleHandler.js";import{m as z}from"../chunks/messageBundle.js";import{a as $}from"../chunks/number.js";import"../core/Accessor.js";import"../chunks/deprecate.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/handleUtils.js";import"../chunks/metadata.js";import"../chunks/ArrayPool.js";import"../chunks/tracking.js";import"../chunks/watch.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../core/promiseUtils.js";import"../core/Error.js";import"../chunks/object.js";import"../config.js";import"../chunks/string.js";import"../core/Collection.js";import"../chunks/Evented.js";import"../chunks/shared.js";import"../chunks/domUtils.js";import"../chunks/Promise.js";import"../core/reactiveUtils.js";import"../chunks/uuid.js";import"../chunks/assets.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/widgetThemeUtils.js";import"../chunks/locale.js";import"../chunks/messages.js";import"../chunks/jsonMap.js";import"./Legend/support/ActiveLayerInfo.js";import"../Color.js";import"../chunks/colorUtils.js";import"../chunks/mathUtils.js";import"../chunks/common.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../chunks/enumeration.js";import"../chunks/reader.js";import"../chunks/writer.js";import"../layers/support/fieldUtils.js";import"../chunks/arcadeOnDemand.js";import"../geometry.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../chunks/JSONSupport.js";import"../geometry/SpatialReference.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../chunks/Ellipsoid.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../symbols/Symbol.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils3.js";import"../symbols/edges/Edges3D.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils4.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../chunks/aaBoundingRect.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../chunks/persistableUrlUtils.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../portal/Portal.js";import"../chunks/Loadable.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../chunks/Clonable.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../chunks/Thumbnail.js";import"../chunks/Symbol3DVerticalOffset.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../chunks/EffectView.js";import"../chunks/parser.js";import"../chunks/mat4f32.js";import"../chunks/mat4.js";import"../chunks/_commonjsHelpers.js";import"../chunks/jsonUtils.js";import"../chunks/ExportImageParameters.js";import"../core/HandleOwner.js";import"../chunks/commonProperties.js";import"../TimeExtent.js";import"../chunks/timeUtils.js";import"../support/timeUtils.js";import"../chunks/ElevationInfo.js";import"../chunks/unitConversionUtils.js";import"../chunks/lengthUtils.js";import"../chunks/unitUtils.js";import"../chunks/projectionEllipsoid.js";import"../chunks/sublayerUtils.js";import"../chunks/floorFilterUtils.js";import"../renderers/support/jsonUtils.js";import"../renderers/ClassBreaksRenderer.js";import"../renderers/Renderer.js";import"../renderers/support/AuthoringInfo.js";import"../renderers/support/AuthoringInfoVisualVariable.js";import"../chunks/colorRamps.js";import"../rest/support/AlgorithmicColorRamp.js";import"../rest/support/ColorRamp.js";import"../rest/support/MultipartColorRamp.js";import"../chunks/VisualVariablesMixin.js";import"../renderers/visualVariables/ColorVariable.js";import"../renderers/visualVariables/VisualVariable.js";import"../chunks/LegendOptions.js";import"../renderers/visualVariables/support/ColorStop.js";import"../renderers/visualVariables/OpacityVariable.js";import"../renderers/visualVariables/support/OpacityStop.js";import"../renderers/visualVariables/RotationVariable.js";import"../renderers/visualVariables/SizeVariable.js";import"../renderers/visualVariables/support/SizeStop.js";import"../chunks/sizeVariableUtils.js";import"../chunks/visualVariableUtils.js";import"../Graphic.js";import"../PopupTemplate.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../popup/support/FieldInfoFormat.js";import"../chunks/date.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../chunks/chartMediaInfoUtils.js";import"../chunks/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../support/actions/ActionBase.js";import"../chunks/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../chunks/compilerUtils.js";import"../renderers/support/ClassBreakInfo.js";import"../chunks/commonProperties2.js";import"../symbols/support/jsonUtils.js";import"../chunks/symbolConversion.js";import"../renderers/DictionaryRenderer.js";import"../chunks/DictionaryLoader.js";import"../chunks/LRUCache.js";import"../chunks/MemCache.js";import"../renderers/DotDensityRenderer.js";import"../renderers/support/AttributeColorInfo.js";import"../renderers/HeatmapRenderer.js";import"../renderers/support/HeatmapColorStop.js";import"../renderers/SimpleRenderer.js";import"../renderers/UniqueValueRenderer.js";import"../chunks/diffUtils.js";import"../renderers/support/UniqueValueInfo.js";import"../chunks/styleUtils.js";import"../chunks/rendererConversion.js";import"../symbols/support/cimSymbolUtils.js";import"../chunks/utils7.js";import"../chunks/numberUtils.js";import"../chunks/previewSymbol3D.js";import"../chunks/colorUtils2.js";import"../chunks/webStyleSymbolUtils.js";import"../chunks/devEnvironmentUtils.js";import"./smartMapping/support/utils.js";import"../chunks/utils13.js";import"../chunks/mat2df32.js";import"../chunks/mat2d.js";import"../chunks/asyncUtils.js";import"../chunks/ItemCache.js";const U="http://www.w3.org/2000/svg",R="esri-relationship-ramp--diamond__container",A="esri-relationship-ramp--diamond__left-column",M="esri-relationship-ramp--diamond__right-column",F="esri-relationship-ramp--diamond__middle-column",N="esri-relationship-ramp--diamond__middle-column--label",D="esri-relationship-ramp--diamond__middle-column--ramp",V="esri-relationship-ramp--square__table",P="esri-relationship-ramp--square__table-row",O="esri-relationship-ramp--square__table-cell",T="esri-relationship-ramp--square__table-label",B="esri-relationship-ramp--square__table-label--left-bottom",q="esri-relationship-ramp--square__table-label--right-bottom",H="esri-relationship-ramp--square__table-label--left-top",W="esri-relationship-ramp--square__table-label--right-top";function G(e,s,t,i){const{focus:r,labels:o}=e,l=!!r,n=function(e,s,t,i,r=60){const{focus:o,numClasses:l,colors:n,rotation:a}=e,c=!!o,p=Math.sqrt(r**2+r**2)+(c?0:5),m=[],d=[],_=[],k=(r||75)/l;for(let e=0;e<l;e++){const s=e*k;for(let t=0;t<l;t++){const i=t*k,r=h(n[e][t]),o=u(null),l={type:"rect",x:i,y:s,width:k,height:k};m.push(y(r)),d.push(g(l,r.fill,o,null)),_.push(f(l))}}const w=10,S=15,x=15,I=10;let C=null;c||(C="margin: -15px -15px -18px -15px");const E=Q("left",o,s),z=Q("right",o,s),$=v(_),R=b($,p,p,0,!1,a,!1),A=b($,p,p,0,!1,c?-45:null,!1),M={filter:j(i),opacity:null==t?null:`${t}`};return L("div",{styles:M,class:c?D:O},L("svg",{xmlns:U,width:p,height:p,style:C},L("defs",null,L("marker",{id:`${s}_arrowStart`,markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},L("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),L("marker",{id:`${s}_arrowEnd`,markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},L("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555","stroke-width":"1"})),m),L("g",{transform:R},d),L("g",{transform:A},L("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":E.markerStart,"marker-end":E.markerEnd,x1:-w,y1:r-S,x2:-w,y2:S}),L("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":z.markerStart,"marker-end":z.markerEnd,x1:x,y1:r+I,x2:r-x,y2:r+I}))))}(e,s,t,i),a={justifyContent:"center"},c=k();return l?L("div",{class:R,styles:a},L("div",{class:A},c?o.right:o.left),L("div",{class:F},L("div",{class:N},o.top),n,L("div",{class:N},o.bottom)),L("div",{class:M},c?o.left:o.right)):L("div",{class:V},L("div",{class:P},L("div",{class:w(O,T,q)},c?o.top:o.left),L("div",{class:O}),L("div",{class:w(O,T,B)},c?o.left:o.top)),L("div",{class:P},L("div",{class:O}),n,L("div",{class:O})),L("div",{class:P},L("div",{class:w(O,T,W)},c?o.right:o.bottom),L("div",{class:O}),L("div",{class:w(O,T,H)},c?o.bottom:o.right)))}function Q(e,s,t){const i=`${t}_arrowStart`,r=`${t}_arrowEnd`,o="left"===e,l={markerStart:null,markerEnd:null};switch(s){case"HL":o?l.markerStart=`url(#${r})`:l.markerEnd=`url(#${i})`;break;case"LL":l.markerStart=`url(#${r})`;break;case"LH":o?l.markerEnd=`url(#${i})`:l.markerStart=`url(#${r})`;break;default:l.markerEnd=`url(#${i})`}return l}const X=S(),Y="esri-univariate-above-and-below-ramp__symbol",Z="esri-legend__color-ramp";function J(e="vertical"){const s="stroke:rgb(200, 200, 200);stroke-width:1";return"vertical"===e?L("svg",{height:"4",width:"10"},L("line",{x1:"0",y1:"2",x2:"10",y2:"2",style:s})):L("svg",{height:"10",width:"10"},L("line",{x1:"5",y1:"0",x2:"5",y2:"10",style:s}))}function K(e,s="vertical"){const t=document.createElement("div");return t.style.height="20px",t.className=Y,null!=e&&(t.style.opacity=e.toString()),X.append(t,J.bind(null,s)),t}function ee(e,s,t="vertical",i){e.infos.forEach(((e,r)=>{if(i&&2===r)e.preview=K(s,t);else{const s=d(e.size)+("horizontal"===t?20:10),i="div"===e.preview.tagName.toLowerCase(),r=i?e.preview:document.createElement("div");r.className=Y,"horizontal"===t?r.style.width=`${s}px`:r.style.height=`${s}px`,i||r.appendChild(e.preview),e.preview=r}}))}function se(e,s="classic"){const t=e.infos;return"classic"===s?(d(t[0].size)+10)/2:(d(t[0].size)-d(t[t.length-1].size))/2}function te(e,s){if(!e)return null;const t=e.infos.map((e=>e.color)),i=x("full"===s.type?t:"above"===s.type?t.slice(0,3):t.slice(2,5),{width:s.width,height:s.height,align:s.rampAlignment,effectList:s.effectList});return i.className=Z,null!=s.opacity&&(i.style.opacity=s.opacity.toString()),i}function ie(e,s,t,i="vertical"){let r=0;const o=e.infos,l=Math.floor(o.length/2),n="full"===s||"above"===s?0:l,a="full"===s||"below"===s?o.length-1:l;for(let e=n;e<=a;e++)if(t&&e===l)r+="horizontal"===i?10:20;else{r+=d(o[e].size)+("horizontal"===i?20:10)}return Math.round(r)}function re(e,s,t,i="vertical"){const r=ie(e,s,t,i),o=e.infos,l=Math.floor(o.length/2),n="full"===s||"above"===s?0:l,a="full"===s||"below"===s?o.length-1:l,c="full"===s?o[n].size+o[a].size:"above"===s?o[n].size:o[a].size,p=t?"vertical"===i?20:10:0,m="vertical"===i?10*("full"===s?2:1):20*("full"===s?2:1);return Math.round(r-(d(c)/2+p/2+m/2))}function oe(e,s,t="vertical"){const i=e.infos;let r=i.find((({type:e})=>"size-ramp"===e)),o=i.find((({type:e})=>"color-ramp"===e));var l,n;(r&&(r={...r},r.infos=[...r.infos],ee(r,s,t,!0)),o&&(o={...o},o.infos=[...o.infos]),"horizontal"===t)&&(null==(l=r)||l.infos.reverse(),null==(n=o)||n.infos.reverse());return{sizeRampElement:r,colorRampElement:o}}function le(e,s="vertical"){const t=e.infos;let i=t.find((({type:e})=>"size-ramp"===e)),r=t.find((({type:e})=>"color-ramp"===e));var o,l;(i&&(i={...i},i.infos=[...i.infos],ee(i,null,s,!1)),r&&(r={...r},r.infos=[...r.infos]),"horizontal"===s)&&(null==(o=i)||o.infos.reverse(),null==(l=r)||l.infos.reverse());return{sizeRampElement:i,colorRampElement:r}}function ne(e){e.appendChild(this)}function ae(e,s,t){if(!s)return;if("string"==typeof s||"number"==typeof s)return s;if("value"in s||"unit"in s)return m(e.dotValue,s);if("colorName"in s||"bandName"in s)return e[s.colorName]+": "+(e[s.bandName]||s.bandName);if("showCount"in s)return s.showCount?e.clusterCountTitle:null;let i=null;return!function(e,s){return s}(0,t)?ce(s,t)&&(i=s.normField?"showNormField":s.normByPct?"showNormPct":s.field?"showField":null):i=s.ratioPercentTotal?"showRatioPercentTotal":s.ratioPercent?"showRatioPercent":s.ratio?"showRatio":s.normField?"showNormField":s.field?"showField":null,i?m("showField"===i?"{field}":e[i],{field:s.field,normField:s.normField}):null}function ce(e,s){return!s}function pe(e,s){return!!(s&&"Stretched"===s&&e.version>=10.3&&"esri.layers.ImageryLayer"===e.declaredClass)}const me="esri-legend--card__carousel-indicator--activated",de="esri-legend--card",he="esri-legend--stacked",ue="esri-legend--card__carousel-title",ye="esri-legend--card__carousel-indicator",ge="esri-legend--card__interval-separator",fe="esri-legend--card__imagery-layer-image--stretched",ve="esri-legend--card__image-label",be="esri-legend--card__layer-caption",_e="esri-legend--card__label-element",je="esri-legend--card__layer-row",ke="esri-legend--card__label-cell",we="esri-legend--card__message",Le="esri-legend--card__ramp-label",Se="esri-legend--card__section",xe="esri-legend--card__service-caption-text",Ie="esri-legend--card__service-content",Ce="esri-legend--card__service",Ee="esri-legend--card__group-layer",ze="esri-legend--card__group-layer-child",$e="esri-legend--card__symbol",Ue="esri-legend--card__size-ramp-row",Re="esri-legend--card__symbol-row",Ae="esri-legend--card__symbol-cell",Me="esri-legend--card__carousel-indicator-container",Fe="esri-legend--card__interval-separators-container",Ne="esri-legend--card__relationship-label-container",De="esri-legend--card__label-container",Ve="esri-legend--card__service-caption-container",Pe="esri-legend--card__symbol-container",Oe="esri-legend--card__size-ramp-container",Te="esri-legend--card__size-ramp-preview",Be="esri-legend__size-ramp--horizontal",qe="esri-legend__ramp-labels",He="esri-legend__layer-cell esri-legend__layer-cell--info",We="esri-univariate-above-and-below-ramp__color--card";var Ge;!function(e){e.Auto="auto",e.Stack="stack",e.SideBySide="side-by-side"}(Ge||(Ge={}));const Qe=window.devicePixelRatio;let Xe=class extends c{constructor(e,t){super(e,t),this._handles=new s,this._hasIndicators=!1,this._selectedSectionName=null,this._sectionNames=[],this._sectionMap=new Map,this.activeLayerInfos=null,this.headingLevel=3,this.layout=Ge.Stack,this.messages=null,this.messagesCommon=null,this.type="card",this.view=null}initialize(){this.own([this.watch("activeLayerInfos",(e=>{this._handles.removeAll(),this._watchForSectionChanges(e)}))])}destroy(){this._handles.destroy(),this._handles=null}render(){this._hasIndicators=this.layout===Ge.Auto&&this.view.container.clientWidth<=768||this.layout===Ge.Stack;const e=this.activeLayerInfos,s=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));this._hasIndicators?this._selectedSectionName&&-1!==this._sectionNames.indexOf(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;const t=this._sectionNames.length,i=this._sectionNames.map(((e,s)=>{const i=m(this.messagesCommon.pagination.pageText,{index:s+1,total:t});return L("div",{key:e,role:"tab",id:e,"aria-label":i,"aria-controls":`${e}-panel`,"aria-selected":(this._selectedSectionName===e).toString(),tabIndex:this._selectedSectionName===e?0:-1,title:i,onclick:this._selectSection,onkeydown:this._focusSection,bind:this,class:this.classes(ye,{[me]:this._selectedSectionName===e}),"data-section-name":e})})),r=this._hasIndicators&&t>1?L("div",{class:Me,key:"carousel-navigation",role:"tablist"},i):null,o=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):s&&s.length?s:null,l={[he]:this._hasIndicators};return L("div",{class:this.classes(de,l)},o||L("div",{class:we},this.messages.noLegend),r)}_selectSection(e){const s=e.target.getAttribute("data-section-name");s&&(this._selectedSectionName=s)}_focusSection(e){switch(e.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(e);break;case"Enter":case" ":this._selectSection(e)}}_switchSectionOnArrowPress(e){const s=e.key,t="ArrowLeft"===s?-1:1,i=e.target.getAttribute("data-section-name"),r=this._sectionNames.indexOf(i),o=this._sectionNames;let l=null;-1!==r&&(o[r+t]?l=document.getElementById(o[r+t]):"ArrowLeft"===s?l=document.getElementById(o[o.length-1]):"ArrowRight"===s&&(l=document.getElementById(o[0])),l&&l.focus())}_watchForSectionChanges(e){if(this._generateSectionNames(),e){e.forEach((e=>{const s=`activeLayerInfo-${e.layer.uid}-version-change`;this._handles.remove(s),this._watchForSectionChanges(e.children),this._handles.add(e.watch("version",(()=>this._generateSectionNames())),s)}));const s="activeLayerInfos-collection-change";this._handles.remove(s),this._handles.add(e.on("change",(()=>this._watchForSectionChanges(e))),s)}}_generateSectionNames(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)}_getSectionName(e,s,t){return`${this.id}${e.uid}-type-${s.type}-${t}`}_generateSectionNamesForActiveLayerInfo(e){e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach(((s,t)=>{this._sectionNames.push(this._getSectionName(e.layer,s,t))}))}_renderLegendForLayer(e){if(!e.ready)return null;if(e.children.length){const s=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return L("div",{key:e.layer.uid,class:this.classes(Ce,Ee)},L("div",{class:Ve},e.title),s)}{const s=e.legendElements;if(s&&!s.length)return null;const t=s.some((e=>"relationship-ramp"===e.type)),i=s.map(((s,i)=>this._renderLegendForElement(s,e,i,t))).filter((e=>!!e));if(!i.length)return null;const r={[ze]:!!e.parent};return L("div",{key:e.layer.uid,class:this.classes(Ce,r)},L("div",{class:Ve},L("div",{class:xe},e.title)),L("div",{class:Ie},i))}}_renderLegendForElement(e,s,t,i=!1){const r="color-ramp"===e.type,o="opacity-ramp"===e.type,l="size-ramp"===e.type,n=s.layer;let a=null;if("string"==typeof e.title)a=e.title;else if(e.title){const s=e.title,t=ae(this.messages,s,r||o);a=s.title?`${s.title} (${t})`:t}const c=this._getSectionName(n,e,t),p=this._hasIndicators?L("div",null,L(I,{level:this.headingLevel,class:ue},s.title),L(I,{level:C(this.headingLevel),class:be},a)):a?L(I,{level:this.headingLevel,class:be},a):null,m=s.effectList;let d=null;if("symbol-table"===e.type){const t=e.infos.map(((t,i)=>this._renderLegendForElementInfo(t,s,e.legendType,i))).filter((e=>!!e));if(t.length){const e=t[0].properties.classes&&t[0].properties.classes[Re],s={[De]:!e&&!i,[Ne]:i};d=L("div",{class:this.classes(s)},t)}}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type?d=this._renderLegendForRamp(e,n.opacity,m):l?d=this._renderSizeRamp(e,n.opacity):"relationship-ramp"===e.type?d=G(e,this.id,n.opacity,m):"univariate-above-and-below-ramp"===e.type?d=this._renderUnivariateAboveAndBelowRamp(e,n.opacity,m):"univariate-color-size-ramp"===e.type&&(d=this._renderUnivariateColorSizeRamp(e,n.opacity,m));if(!d)return null;const h=L("div",{key:c,class:Se,id:`${c}-panel`,role:"tabpanel","aria-labelledby":c,tabIndex:0},[p,d]);return this._sectionMap.set(c,h),h}_renderUnivariateAboveAndBelowRamp(e,s,t){const{sizeRampElement:i,colorRampElement:r}=oe(e,s,"horizontal");if(!i)return null;const o=ie(i,"full",!0,"horizontal"),l=re(i,"above",!0,"horizontal"),n=re(i,"below",!0,"horizontal"),a=te(r,{width:l,height:12,rampAlignment:"horizontal",opacity:s,type:"above",effectList:t}),c=te(r,{width:n,height:12,rampAlignment:"horizontal",opacity:s,type:"below",effectList:t}),p=se(i,"card"),m=i.infos.map((e=>e.label)),d=m.length-1,h=m.map(((e,s)=>0===s||s===d?L("div",{key:s},e):null)),u={marginTop:"3px",display:"flex"};k(this.container)?u.marginRight=`${p}px`:u.marginLeft=`${p}px`;const y={width:`${o}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return L("div",{class:je,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},L("div",{class:this.classes(Pe,Be),styles:{display:"flex",flexDirection:"row"}},i.infos.map(((e,s)=>L("div",{key:s,class:$e,bind:e.preview,afterCreate:ne})))),a?L("div",{class:We,styles:u,key:"color-ramp-preview"},L("div",{bind:a,afterCreate:ne}),L("div",{bind:c,afterCreate:ne})):null,L("div",{class:He},L("div",{class:qe,styles:y},h)))}_renderUnivariateColorSizeRamp(e,s,t){const{sizeRampElement:i,colorRampElement:r}=le(e,"horizontal");if(!i)return null;const o=ie(i,"full",!1,"horizontal"),l=te(r,{width:re(i,"full",!1,"horizontal"),height:12,rampAlignment:"horizontal",opacity:s,type:"full",effectList:t}),n=se(i,"card"),a=i.infos.length-1,c=i.infos.map(((e,s)=>0===s||s===a?L("div",{key:s},e.label):null)),p={marginTop:"3px",display:"flex"};k(this.container)?p.marginRight=`${n}px`:p.marginLeft=`${n}px`;const m={width:`${o}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return L("div",{class:je,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},L("div",{class:this.classes(Pe,Be),styles:{display:"flex",flexDirection:"row"}},i.infos.map(((e,s)=>L("div",{key:s,class:$e,bind:e.preview,afterCreate:ne})))),L("div",{class:We,styles:p,key:"color-ramp-preview"},L("div",{bind:l,afterCreate:ne})),L("div",{class:He},L("div",{class:qe,styles:m},c)))}_renderLegendForElementInfo(e,s,t,i){const r=s.layer;if(e.type)return this._renderLegendForElement(e,s,i);const o=pe(r,t);if(e.preview){var l,n;if(!e.symbol||-1===e.symbol.type.indexOf("simple-fill")){if(!e.label)return L("div",{key:i,bind:e.preview,afterCreate:ne});const s={[Ae]:this._hasIndicators};return L("div",{key:i,class:this.classes(je,{[Re]:this._hasIndicators})},L("div",{class:this.classes(s),bind:e.preview,afterCreate:ne}),L("div",{class:this.classes(ve,{[ke]:this._hasIndicators})},ae(this.messages,e.label,!1)||""))}let t=255,o=255,a=255,c=0,p=255,m=255,d=255,h=0;const u=e.symbol.color&&e.symbol.color.a,y=e.symbol.outline&&e.symbol.outline.color&&e.symbol.outline.color.a;u&&(t=e.symbol.color.r,o=e.symbol.color.g,a=e.symbol.color.b,c=e.symbol.color.a*r.opacity),y&&(p=e.symbol.outline.color.r,m=e.symbol.outline.color.g,d=e.symbol.outline.color.b,h=e.symbol.outline.color.a*r.opacity);const g=null==(l=null==(n=e.symbol.color)?void 0:n.isBright)||l,f=g?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)",v={background:u?`rgba(${t}, ${o}, ${a}, ${c})`:"none",color:g?"black":"white",textShadow:`-1px -1px 0 ${f},\n                                              1px -1px 0 ${f},\n                                              -1px 1px 0 ${f},\n                                              1px 1px 0 ${f}`,border:y?`1px solid rgba(${p}, ${m}, ${d}, ${h})`:"none",filter:j(s.effectList)};return L("div",{key:i,class:je},L("div",{class:_e,styles:v}," ",e.label," "))}if(e.src){const s=this._renderImage(e,r,o);return L("div",{key:i,class:je},s,L("div",{class:ve},e.label||""))}}_renderImage(e,s,t){const{label:i,src:r,opacity:o}=e,l={[fe]:t,[$e]:!t},n={opacity:`${null!=o?o:s.opacity}`};return L("img",{alt:ae(this.messages,i,!1),src:r,border:0,width:e.width,height:e.height,class:this.classes(l),styles:n})}_renderSizeRampLines(e){const s=e.infos,t=s[0],i=s[s.length-1],r=t.symbol,o=this._hasIndicators,l=d(t.size+t.outlineSize)*Qe,n=d(i.size+i.outlineSize)*Qe,a=o?l:l+50*Qe,c=o?l/2+50*Qe:l,p=function(e){if(e){if(e.type.indexOf("3d")>-1){const s=e.symbolLayers&&e.symbolLayers.length;if(!s)return;const t=e.symbolLayers.getItemAt(s-1).get("resource.primitive");return"triangle"===t||"cone"===t||"tetrahedron"===t}return"triangle"===e.style}}(r),m=function(e){if(e){if(e.type.indexOf("3d")>-1){const s=e.symbolLayers&&e.symbolLayers.length;if(!s)return;const t=e.symbolLayers.getItemAt(s-1),i=t.resource&&t.resource.primitive;return"circle"===i||"cross"===i||"kite"===i||"sphere"===i||"cube"===i||"diamond"===i}{const s=e.style;return"circle"===s||"diamond"===s||"cross"===s}}}(r),h=document.createElement("canvas");h.width=a,h.height=c,h.style.width=h.width/Qe+"px",h.style.height=h.height/Qe+"px";const u=h.getContext("2d");if(o){u.beginPath();const e=0,s=0,t=a/2-n/2,i=c;u.moveTo(e,s),u.lineTo(t,i);const r=a,o=0,l=a/2+n/2,p=c;u.moveTo(r,o),u.lineTo(l,p)}else{u.beginPath();const e=0,s=c/2-n/2,t=a,i=0;u.moveTo(e,s),u.lineTo(t,i);const r=0,o=c/2+n/2,l=a,p=c;u.moveTo(r,o),u.lineTo(l,p)}return u.strokeStyle="#ddd",u.stroke(),L("div",{bind:h,afterCreate:ne,styles:o?{display:"flex",marginTop:`-${p?0:m?l/2:0}px`,marginBottom:`-${p?n:m?n/2:0}px`}:{display:"flex",marginRight:`-${p?0:m?l/2:0}px`,marginLeft:`-${p?0:m?n/2:0}px`}})}_renderSizeRamp(e,s){const t=e.infos,i=t[0].label,r=t[t.length-1].label;let o=t[0].preview,l=t[t.length-1].preview;const n=this._hasIndicators,a={"flex-direction":n?"column":"row-reverse"};o&&(o=o.cloneNode(!0),o.style.display="flex"),l&&(l=l.cloneNode(!0),l.style.display="flex");const c={opacity:null!=s?`${s}`:""};return L("div",{class:this.classes(je,{[Ue]:n})},L("div",{class:Le},n?i:r),L("div",{class:Oe,styles:a},L("div",{bind:o,afterCreate:ne,class:Te,styles:c}),this._renderSizeRampLines(e),L("div",{bind:l,afterCreate:ne,class:Oe,styles:c})),L("div",{class:Le},n?r:i))}_renderLegendForRamp(e,s,t){const i=e.infos,r="heatmap-ramp"===e.type,o=i.length-1,l=25,n=o>2&&!r?25*o:100,a=n+20,c=10,p=i.slice(0).reverse();p.forEach(((e,s)=>{e.offset=r?e.ratio:s/o}));const m=p.length-1,d=p.length%2!=0&&p[p.length/2|0],h=d&&L("div",{class:Fe},L("div",{class:ge},"|"),L("div",{class:Le},d.label)),u=i[i.length-1].label,y=i[0].label,g=[[{shape:{type:"path",path:"M0 12.5 L10 0 L10 25 Z"},fill:p[0].color,stroke:{width:0}},{shape:{type:"rect",x:c,y:0,width:n,height:l},fill:{type:"linear",x1:c,y1:0,x2:n+c,y2:0,colors:p},stroke:{width:0}},{shape:{type:"path",path:`M${n+c} 0 L${a} 12.5 L${n+c} 25 Z`},fill:p[m].color,stroke:{width:0}}]],f=_(g,a,l),{messages:v}=this,b={filter:j(t),opacity:null==s?null:`${s}`};return L("div",{class:je,styles:{justifyContent:"center"}},L("div",{class:Le},r?v[u]:u),L("div",{class:Pe},L("div",{styles:b},f),h),L("div",{class:Le},r?v[y]:y))}};e([n()],Xe.prototype,"activeLayerInfos",void 0),e([n()],Xe.prototype,"headingLevel",void 0),e([n()],Xe.prototype,"layout",void 0),e([n(),z("esri/widgets/Legend/t9n/Legend")],Xe.prototype,"messages",void 0),e([n(),z("esri/t9n/common")],Xe.prototype,"messagesCommon",void 0),e([n({readOnly:!0})],Xe.prototype,"type",void 0),e([n()],Xe.prototype,"view",void 0),e([E()],Xe.prototype,"_selectSection",null),Xe=e([a("esri.widgets.Legend.styles.Card")],Xe);const Ye=Xe,Ze="esri-legend__service",Je="esri-legend__service-label",Ke="esri-legend__layer",es="esri-legend__group-layer",ss="esri-legend__group-layer-child",ts="esri-legend__layer-table",is="esri-legend__layer-table--size-ramp",rs="esri-legend__layer-child-table",os="esri-legend__layer-caption",ls="esri-legend__layer-body",ns="esri-legend__layer-row",as="esri-legend__layer-cell esri-legend__layer-cell--info",cs="esri-legend__imagery-layer-image--stretched",ps="esri-legend__imagery-layer-info--stretched",ms="esri-legend__layer-cell esri-legend__layer-cell--symbols",ds="esri-legend__symbol",hs="esri-legend__ramps",us="esri-legend__size-ramp",ys="esri-legend__color-ramp",gs="esri-legend__opacity-ramp",fs="esri-legend__ramp-labels",vs="esri-legend__ramp-label",bs="esri-univariate-above-and-below-ramp__label",_s="esri-legend__message",js="esri-widget__heading",ks={display:"flex",alignItems:"flex-start"},ws={marginLeft:"3px"},Ls={display:"table-cell",verticalAlign:"middle"};let Ss=class extends c{constructor(e,s){super(e,s),this.activeLayerInfos=null,this.headingLevel=3,this.messages=null,this.type="classic"}render(){const e=this.activeLayerInfos,s=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));return L("div",null,s&&s.length?s:L("div",{class:_s},this.messages.noLegend))}_renderLegendForLayer(e){if(!e.ready)return null;const s=!!e.children.length,t=`esri-legend__${e.layer.uid}-version-${e.version}`,i=e.title?I({level:this.headingLevel,class:this.classes(js,Je)},e.title):null;if(s){const s=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return L("div",{key:t,class:this.classes(Ze,es)},i,s)}{const s=e.legendElements;if(s&&!s.length)return null;const r=s.map((s=>this._renderLegendForElement(s,e.layer,e.effectList))).filter((e=>!!e));if(!r.length)return null;const o={[ss]:!!e.parent};return L("div",{key:t,class:this.classes(Ze,o),tabIndex:0},i,L("div",{class:Ke},r))}}_renderLegendForElement(e,s,t,i){const r="color-ramp"===e.type,o="opacity-ramp"===e.type,l="size-ramp"===e.type;let n=null;if("symbol-table"===e.type||l){const i=e.infos.map((i=>this._renderLegendForElementInfo(i,s,t,l,e.legendType))).filter((e=>!!e));i.length&&(n=L("div",{class:ls},i))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?n=this._renderLegendForRamp(e,s.opacity):"relationship-ramp"===e.type?n=G(e,this.id,s.opacity,t):"univariate-above-and-below-ramp"===e.type?n=this._renderUnivariateAboveAndBelowRamp(e,s.opacity,t):"univariate-color-size-ramp"===e.type&&(n=this._renderUnivariateColorSizeRamp(e,s.opacity,t));if(!n)return null;const a=e.title;let c=null;if("string"==typeof a)c=a;else if(a){const e=ae(this.messages,a,r||o);c=ce(0,r||o)&&a.title?`${a.title} (${e})`:e}const p=i?rs:ts,m=c?L("div",{class:os},c):null,d={[is]:l||!i};return L("div",{class:this.classes(p,d)},m,n)}_renderUnivariateAboveAndBelowRamp(e,s,t){const{sizeRampElement:i,colorRampElement:r}=oe(e,s);if(!i)return null;const o=re(i,"above",!0),l=re(i,"below",!0),n=te(r,{width:12,height:o,rampAlignment:"vertical",opacity:s,type:"above",effectList:t}),a=te(r,{width:12,height:l,rampAlignment:"vertical",opacity:s,type:"below",effectList:t}),c=se(i),p=i.infos.map((e=>e.label)),m=p.map(((e,s)=>{const t=2===s;return 0===s?L("div",{key:s,class:e?n?bs:vs:null},e):t?L("div",null):null})),d=p.length-1,h=Math.floor(p.length/2),u=p.map(((e,s)=>s===h||s===d?L("div",{key:s,class:e?n?bs:vs:null},e):null)),y={display:"table-cell",verticalAlign:"middle"},g={marginTop:`${c}px`},f={height:`${o}px`},v={height:`${l}px`};return L("div",{key:"univariate-above-and-below-ramp-preview",styles:ks},L("div",{class:ls},i.infos.map(((e,s)=>L("div",{class:this.classes(ns,us)},L("div",{class:ds,styles:y,bind:e.preview,afterCreate:ne}),n||s%2!=0?null:L("div",{class:as},p[s]))))),n?L("div",{styles:g,key:"color-ramp-preview"},L("div",{styles:ws},L("div",{styles:Ls},L("div",{class:hs,bind:n,afterCreate:ne})),L("div",{styles:Ls},L("div",{class:fs,styles:f},m))),L("div",{styles:ws},L("div",{styles:Ls},L("div",{class:hs,bind:a,afterCreate:ne})),L("div",{styles:Ls},L("div",{class:fs,styles:v},u)))):null)}_renderUnivariateColorSizeRamp(e,s,t){const{sizeRampElement:i,colorRampElement:r}=le(e);if(!i)return null;const o=se(i),l=re(i,"full",!1),n=te(r,{width:12,height:l,rampAlignment:"vertical",opacity:s,type:"full",effectList:t}),a=i.infos.length-1,c=i.infos.map(((e,s)=>0===s||s===a?L("div",{key:s,class:e.label?r?bs:vs:null},e.label):null)),p={display:"table-cell",verticalAlign:"middle"},m={marginTop:`${o}px`},d={height:`${l}px`};return L("div",{key:"univariate-above-and-below-ramp-preview",styles:ks},L("div",{class:ls},i.infos.map((e=>L("div",{class:this.classes(ns,us)},L("div",{class:ds,styles:p,bind:e.preview,afterCreate:ne}))))),L("div",{styles:m,key:"color-ramp-preview"},L("div",{styles:ws},L("div",{styles:Ls},L("div",{class:hs,bind:n,afterCreate:ne})),L("div",{styles:Ls},L("div",{class:fs,styles:d},c)))))}_renderLegendForRamp(e,s){const t=e.infos,i="opacity-ramp"===e.type,r="heatmap-ramp"===e.type,o="stretch-ramp"===e.type,l=e.preview,n=i?gs:"";l.className=`${ys} ${n}`,null!=s&&(l.style.opacity=s.toString());const a=t.map((e=>L("div",{class:e.label?vs:null},r?this.messages[e.label]:o?this._getStretchStopLabel(e):e.label))),c={width:"24px"},p={height:l.style.height};return L("div",{class:ns},L("div",{class:ms,styles:c},L("div",{class:hs,bind:l,afterCreate:ne})),L("div",{class:as},L("div",{class:fs,styles:p},a)))}_getStretchStopLabel(e){return e.label?this.messages[e.label]+": "+("string"==typeof e.value?e.value:$(e.value,{style:"decimal",notation:e.value.toString().indexOf("e")>-1?"scientific":"standard"})):""}_renderLegendForElementInfo(e,s,t,i,r){if(e.type)return this._renderLegendForElement(e,s,t,!0);let o=null;const l=pe(s,r);if(e.preview?o=L("div",{class:ds,bind:e.preview,afterCreate:ne}):e.src&&(o=this._renderImage(e,s,l)),!o)return null;const n={[ps]:l},a={[ps]:l,[us]:!l&&i};return L("div",{class:ns},L("div",{class:this.classes(ms,a)},o),L("div",{class:this.classes(as,n)},ae(this.messages,e.label,!1)||""))}_renderImage(e,s,t){const{label:i,src:r,opacity:o}=e,l={[cs]:t,[ds]:!t},n={opacity:`${null!=o?o:s.opacity}`};return L("img",{alt:ae(this.messages,i,!1),src:r,border:0,width:e.width,height:e.height,class:this.classes(l),styles:n})}};e([n()],Ss.prototype,"activeLayerInfos",void 0),e([n()],Ss.prototype,"headingLevel",void 0),e([n(),z("esri/widgets/Legend/t9n/Legend")],Ss.prototype,"messages",void 0),e([n({readOnly:!0})],Ss.prototype,"type",void 0),Ss=e([a("esri.widgets.Legend.styles.Classic")],Ss);const xs=Ss,Is="esri-legend",Cs="esri-widget",Es="esri-widget--panel",zs="esri-icon-layer-list";let $s=class extends c{constructor(e,t){super(e,t),this._handles=new s,this.activeLayerInfos=null,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.headingLevel=3,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.iconClass=zs,this.label=void 0,this.layerInfos=null,this.messages=null,this.style=new xs,this.view=null,this.viewModel=new p}initialize(){this.own(t(this,"view","resize",(()=>this.scheduleRender())),t(this,"activeLayerInfos","change",(()=>this._refreshActiveLayerInfos(this.activeLayerInfos))),i(this,"headingLevel",(e=>{const{style:s}=this;s&&(s.headingLevel=e)})),r(this,"style",((e,s)=>{s&&e!==s&&s.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,"card"===e.type&&(e.view=this.view),e.headingLevel=this.headingLevel)})))}destroy(){this._handles.destroy(),this._handles=null}castStyle(e){if(e instanceof Ye||e instanceof xs)return e;if("string"==typeof e)return"card"===e?new Ye:new xs;if(e&&"string"==typeof e.type){const s={...e};delete s.type;return new("card"===e.type?Ye:xs)(s)}return new xs}render(){return L("div",{class:this.classes(Is,Cs,this.style instanceof xs?Es:null)},this.style.render())}_refreshActiveLayerInfos(e){this._handles.removeAll(),e.forEach((e=>this._renderOnActiveLayerInfoChange(e))),this.scheduleRender()}_renderOnActiveLayerInfoChange(e){const s=r(e,"version",(()=>this.scheduleRender()));this._handles.add(s,`version_${e.layer.uid}`);const i=t(e,"children","change",(()=>{e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))}));this._handles.add(i,`children_${e.layer.uid}`),e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))}};e([o("viewModel.activeLayerInfos")],$s.prototype,"activeLayerInfos",void 0),e([o("viewModel.basemapLegendVisible")],$s.prototype,"basemapLegendVisible",void 0),e([o("viewModel.groundLegendVisible")],$s.prototype,"groundLegendVisible",void 0),e([n()],$s.prototype,"headingLevel",void 0),e([o("viewModel.hideLayersNotInCurrentView")],$s.prototype,"hideLayersNotInCurrentView",void 0),e([o("viewModel.keepCacheOnDestroy")],$s.prototype,"keepCacheOnDestroy",void 0),e([o("viewModel.respectLayerVisibility")],$s.prototype,"respectLayerVisibility",void 0),e([n()],$s.prototype,"iconClass",void 0),e([n({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],$s.prototype,"label",void 0),e([o("viewModel.layerInfos")],$s.prototype,"layerInfos",void 0),e([n(),z("esri/widgets/Legend/t9n/Legend")],$s.prototype,"messages",void 0),e([n()],$s.prototype,"style",void 0),e([l("style")],$s.prototype,"castStyle",null),e([o("viewModel.view")],$s.prototype,"view",void 0),e([n()],$s.prototype,"viewModel",void 0),$s=e([a("esri.widgets.Legend")],$s);const Us=$s;export{Us as default};
