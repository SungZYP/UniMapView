/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{i as s}from"../core/lang.js";import{m as t}from"../chunks/memoize.js";import{aliasOf as r}from"../core/accessorSupport/decorators/aliasOf.js";import"../chunks/ensureType.js";import{property as o}from"../core/accessorSupport/decorators/property.js";import{subclass as i}from"../core/accessorSupport/decorators/subclass.js";import{g as n}from"../chunks/weather.js";import a from"./Widget.js";import{H as l}from"../chunks/Heading.js";import"../chunks/widgetUtils.js";import{m as c}from"../chunks/messageBundle.js";import"../chunks/Logger.js";import{t as d,a as u}from"../chunks/jsxFactory.js";import{watch as h}from"../core/reactiveUtils.js";import p,{W as g}from"./Weather/WeatherViewModel.js";import"../config.js";import"../chunks/object.js";import"../chunks/string.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/handleUtils.js";import"../chunks/metadata.js";import"../core/Error.js";import"../chunks/tracking.js";import"../views/3d/environment/CloudyWeather.js";import"../chunks/JSONSupport.js";import"../core/Accessor.js";import"../chunks/deprecate.js";import"../chunks/ArrayPool.js";import"../chunks/watch.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../core/promiseUtils.js";import"../chunks/enumeration.js";import"../chunks/jsonMap.js";import"../views/3d/environment/FoggyWeather.js";import"../views/3d/environment/RainyWeather.js";import"../views/3d/environment/SunnyWeather.js";import"../intl.js";import"../chunks/number.js";import"../chunks/locale.js";import"../chunks/messages.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/assets.js";import"../chunks/domUtils.js";import"../chunks/Evented.js";import"../core/Handles.js";import"../core/Collection.js";import"../chunks/shared.js";import"../chunks/Promise.js";import"../chunks/uuid.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/projector.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/widgetThemeUtils.js";import"../chunks/mathUtils.js";import"../chunks/common.js";const m="esri-weather",v={base:`${m}`,esriWidget:"esri-widget",esriWidgetDisabled:"esri-widget--disabled",widgetIcon:"esri-icon-partly-cloudy",content:`${m}__content`,selector:`${m}__selector`,error:`${m}__error`,warning:`${m}__warning`},y={base:`${`${m}__coverage-slider`}`};let j=class extends a{constructor(e){super(e),this._onChangeTimeout=null,this._onChangeDebounced=e=>{const s=e.target.value;this._cancelChange(),this._onChangeTimeout=setTimeout((()=>this.onChange(s)),200)},this._cancelChange=()=>{s(this._onChangeTimeout)&&(clearTimeout(this._onChangeTimeout),this._onChangeTimeout=null)}}initialize(){this.own(h((()=>this.onChange),(()=>{this._cancelChange()})))}render(){const{label:e,disabled:s}=this;return d("div",{class:y.base},d("calcite-label",{scale:"s",disabled:s},e,d("calcite-slider",{"aria-label":e,disabled:this.disabled,max:1,min:0,step:.01,value:this.value,onCalciteSliderInput:this._onChangeDebounced,onCalciteSliderChange:this._onChangeDebounced})))}destroy(){this._cancelChange()}async loadDependencies(){await import("../chunks/calcite-slider.js")}};e([o()],j.prototype,"value",void 0),e([o()],j.prototype,"onChange",void 0),e([o()],j.prototype,"disabled",void 0),j=e([i("esri.widgets.Weather.CoverageSlider")],j);const w={sunny:"brightness",cloudy:"partly-cloudy",rainy:"rain",snowy:"snow",foggy:"fog"};let b=class extends a{constructor(e){super(e),this.viewModel=new p,this.headingLevel=4,this.iconClass=v.widgetIcon,this.label=void 0,this._renderWeatherTypeButton=e=>{var s,t;const r=this.viewModel,o=null==(s=this.messages)||null==(t=s[e])?void 0:t.label,i=r.state===g.Disabled,n=!i&&r.current.type===e;return d("calcite-button",{appearance:n?"solid":"outline","aria-checked":n?"true":"false",color:n?"blue":"neutral",disabled:i,"icon-start":w[e],key:`${e}-type-button`,label:o,role:"radio",scale:"l",title:o,onclick:()=>{n||r.setWeatherByType(e)}})},this._getOnSunnyChange=t((e=>s=>{e.cloudCover=s})),this._getOnCloudyChange=t((e=>s=>{e.cloudCover=s})),this._getOnRainyChange=t((e=>s=>{e.cloudCover=s})),this._getOnSnowyChange=t((e=>s=>{e.cloudCover=s})),this._getOnFoggyChange=t((e=>s=>{e.fogStrength=s}))}render(){var e;const s=this.viewModel.state===g.Disabled;return d("div",{class:this.classes(v.base,v.esriWidget,s&&v.esriWidgetDisabled),role:"region","aria-label":null==(e=this.messages)?void 0:e.widgetLabelAccessible},this._renderContent())}async loadDependencies(){await Promise.all([import("../chunks/calcite-button.js"),import("../chunks/calcite-icon.js"),import("../chunks/calcite-label.js")])}get view(){var e;return null==(e=this.viewModel)?void 0:e.view}set view(e){this.viewModel&&(this.viewModel.view=e)}get _errorMessage(){var e;const s=null==(e=this.messages)?void 0:e.error;switch(this.viewModel.error){case"unsupported-view":return s.unsupported;case"local-scene":return s.localScene;default:return null}}get _warningMessage(){if("not-visible"===this.viewModel.error){var e,t;return s(this.view)&&"3d"===(null==(e=this.view)?void 0:e.type)&&this.view.environment.atmosphereEnabled?null==(t=this.messages)?void 0:t.error.notVisible:null}return null}_renderContent(){if(this.viewModel.state===g.Error)return d("div",{key:"error",class:v.error},this._errorMessage);const e=this.messages,t=this._warningMessage;return d(u,null,d(l,{level:this.headingLevel},null==e?void 0:e.widgetLabel),d("div",{class:v.content},d("div",{class:v.selector,role:"radiogroup","aria-label":null==e?void 0:e.weatherType},n().map(this._renderWeatherTypeButton)),this._renderOptions(),s(t)&&this._renderWarning(t)))}_renderOptions(){const e=this.viewModel,s=e.state===g.Disabled,t=e.current,r=this.messages;switch(t.type){case"sunny":return d(j,{key:"sunny-slider",disabled:s,label:null==r?void 0:r.sunny.cloudCover,value:t.cloudCover,onChange:this._getOnSunnyChange(t)});case"cloudy":return d(j,{key:"cloudy-slider",disabled:s,label:null==r?void 0:r.cloudy.cloudCover,value:t.cloudCover,onChange:this._getOnCloudyChange(t)});case"rainy":return d(j,{key:"rainy-slider",disabled:s,label:null==r?void 0:r.rainy.cloudCover,value:t.cloudCover,onChange:this._getOnRainyChange(t)});case"snowy":return d(j,{key:"snowy-slider",disabled:s,label:null==r?void 0:r.rainy.cloudCover,value:t.cloudCover,onChange:this._getOnSnowyChange(t)});case"foggy":return d(j,{key:"foggy-slider",disabled:s,label:null==r?void 0:r.foggy.fogStrength,value:t.fogStrength,onChange:this._getOnFoggyChange(t)})}}_renderWarning(e){return d("div",{key:"warning",class:v.warning},d("calcite-icon",{icon:"exclamation-mark-triangle",scale:"s"}),e)}};e([o()],b.prototype,"viewModel",void 0),e([o()],b.prototype,"view",null),e([o()],b.prototype,"headingLevel",void 0),e([o()],b.prototype,"iconClass",void 0),e([r("messages.widgetLabel",{overridable:!0})],b.prototype,"label",void 0),e([o(),c("esri/widgets/Weather/t9n/Weather")],b.prototype,"messages",void 0),e([o()],b.prototype,"_errorMessage",null),e([o()],b.prototype,"_warningMessage",null),b=e([i("esri.widgets.Weather")],b);const k=b;export{k as default};
