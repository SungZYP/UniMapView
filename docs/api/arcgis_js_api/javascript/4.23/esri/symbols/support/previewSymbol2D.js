// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("exports ../../Color ../../core/Error ../../core/screenUtils ./gfxUtils ./previewUtils ./renderUtils".split(" "),function(A,D,E,r,y,u,F){function G(c,a){const h=H.getContext("2d"),n=[];a&&(a.weight&&n.push(a.weight),a.size&&n.push(a.size+"px"),a.family&&n.push(a.family));h.font=n.join(" ");return h.measureText(c).width}function I(c){if(0===c.length)return 0;if(2<c.length){const a=r.px2pt(1),h=parseFloat(c);switch(c.slice(-2)){case "px":return h;case "pt":return h*a;case "in":return 72*h*a;
case "pc":return 12*h*a;case "mm":return h*J*a;case "cm":return h*K*a}}return parseFloat(c)}function B(c){var a=null==c?void 0:c.size;c=null!=a&&"object"===typeof a&&"width"in a?r.pt2px(a.width):null;a=null!=a&&"object"===typeof a&&"height"in a?r.pt2px(a.height):null;return{width:c,height:a}}const L=u.SymbolSizeDefaults.size,x=u.SymbolSizeDefaults.maxSize,C=u.SymbolSizeDefaults.maxOutlineSize,M=u.SymbolSizeDefaults.lineWidth,H=document.createElement("canvas"),J=7.2/2.54,K=72/2.54;A.previewSymbol2D=
function(c,a){var h,n,f="number"===typeof(null==a?void 0:a.size)?null==a?void 0:a.size:null,g=null!=f?r.pt2px(f):null;f=null!=(null==a?void 0:a.maxSize)?r.pt2px(a.maxSize):null;const N=null!=(null==a?void 0:a.opacity)?a.opacity:null,v=null!=(null==a?void 0:a.rotation)?a.rotation:"angle"in c?c.angle:null,p=y.getFill(c);var d=y.getStroke(c);if(p&&!d){const m="type"in p?null:new D(p);"#ffffff"===(m?m.toHex():null)&&(d={color:"#bdc3c7",width:.75})}const k={shape:null,fill:null,stroke:d,offset:[0,0]};
null!=(h=d)&&h.width&&(d.width=Math.min(d.width,C));h=(null==(n=d)?void 0:n.width)||0;let q=null==(null==a?void 0:a.size)?!1:null!=(null==a?void 0:a.scale)?null==a?void 0:a.scale:!0,b=0,e=0,w=!1;switch(c.type){case "simple-marker":var l=c.style;e=b=f=Math.min(null!=g?g:r.pt2px(c.size),f||x);switch(l){case "circle":k.shape={type:"circle",cx:0,cy:0,r:.5*f};q||(b+=h,e+=h);break;case "cross":k.shape={type:"path",path:[{command:"M",values:[0,.5*e]},{command:"L",values:[b,.5*e]},{command:"M",values:[.5*
b,0]},{command:"L",values:[.5*b,e]}]};break;case "diamond":k.shape={type:"path",path:[{command:"M",values:[0,.5*e]},{command:"L",values:[.5*b,0]},{command:"L",values:[b,.5*e]},{command:"L",values:[.5*b,e]},{command:"Z",values:[]}]};q||(b+=h,e+=h);break;case "square":k.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[b,0]},{command:"L",values:[b,e]},{command:"L",values:[0,e]},{command:"Z",values:[]}]};q||(b+=h,e+=h);v&&(w=!0);break;case "triangle":k.shape={type:"path",path:[{command:"M",
values:[.5*b,0]},{command:"L",values:[b,e]},{command:"L",values:[0,e]},{command:"Z",values:[]}]};q||(b+=h,e+=h);v&&(w=!0);break;case "x":k.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[b,e]},{command:"M",values:[b,0]},{command:"L",values:[0,e]}]};v&&(w=!0);break;case "path":k.shape={type:"path",path:c.path||""},q||(b+=h,e+=h),v&&(w=!0),q=!0}break;case "simple-line":{const {width:m,height:t}=B(a);f=null!=t?t:Math.min(null!=g?g:h,f||C);g=null!=m?m:M;d.width=f;b=g;e=f;g=(null==
k?void 0:null==(l=k.stroke)?void 0:l.cap)||"butt";l="round"===g;q=!0;k.stroke.cap="butt"===g?"square":g;k.shape={type:"path",path:[{command:"M",values:[l?f/2:0,e/2]},{command:"L",values:[l?b-f/2:b,e/2]}]};break}case "picture-fill":case "simple-fill":{f="object"===typeof(null==a?void 0:a.symbolConfig)&&(null==a?void 0:a.symbolConfig.isSquareFill);const {width:m,height:t}=B(a);b=f&&null!=m?m:null!=g?g:L;e=f&&null!=t?t:b;q||(b+=h,e+=h);q=!0;k.shape=f?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",
values:[b,0]},{command:"L",values:[b,e]},{command:"L",values:[0,e]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:u.shapes.fill[0];break}case "picture-marker":l=r.pt2px(c.width);d=r.pt2px(c.height);g=null!=g?g:Math.max(l,d);d=l/d;l=1>=d?Math.ceil(g*d):g;d=1>=d?g:Math.ceil(g/d);b=Math.min(l,f||x);e=Math.min(d,f||x);k.shape={type:"image",x:-Math.round(b/2),y:-Math.round(e/2),width:b,height:e,src:c.url||""};v&&(w=!0);break;case "text":l=c.text||"Aa",d=c.font,f=Math.min(null!=g?g:r.pt2px(d.size),
f||x),n=G(l,{weight:d.weight,size:f,family:d.family}),b=(g=/[\uE600-\uE6FF]/.test(l))?f:n,e=f,n=.25*I((d?f:0).toString()),g&&(n+=5),k.shape={type:"text",text:l,x:0,y:n,align:"middle",decoration:d&&d.decoration,rotated:c.rotated,kerning:c.kerning},k.font=d&&{size:f,style:d.style,decoration:d.decoration,weight:d.weight,family:d.family}}if(!k.shape)return Promise.reject(new E("symbolPreview: renderPreviewHTML2D","symbol not supported."));f=c.color;g=null;p&&"pattern"===p.type&&f&&"picture-fill"!==c.type?
g=y.getPatternUrlWithColor(p.src,f.toCss(!0)).then(m=>{p.src=m;k.fill=p;return k}):(k.fill=p,g=Promise.resolve(k));return g.then(m=>{const t=[[m]];if("object"===typeof(null==a?void 0:a.symbolConfig)&&null!=a&&a.symbolConfig.applyColorModulation){const z=.6*b;t.unshift([{...m,offset:[-z,0],fill:u.adjustColorBrightness(p,-.3)}]);t.push([{...m,offset:[z,0],fill:u.adjustColorBrightness(p,.3)}]);b+=2*z;q=!1}return F.renderSymbol(t,[b,e],{node:a&&a.node,scale:q,opacity:N,rotation:v,useRotationSize:w,effectView:null==
a?void 0:a.effectView})})};Object.defineProperty(A,"__esModule",{value:!0})});