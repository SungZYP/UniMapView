// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Collection ../core/Error ../core/Handles ../core/Logger ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../chunks/vec3 ../chunks/vec3f64 ./Layer ./VoxelWasmManager ./mixins/APIKeyMixin ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./mixins/SceneService ./support/arcgisLayerUrl ./support/commonProperties ./support/VoxelDynamicSection ./support/VoxelSection ./support/VoxelSlice ./support/VoxelStyle ./support/VoxelVariable ./support/VoxelVolume ./support/VoxelVolumeIndex".split(" "),
function(w,f,n,t,B,c,l,C,D,p,g,U,V,W,E,F,G,H,I,q,J,K,L,M,N,O,P,u,x,y,z,Q,R,S,T){const v=c.getLogger(" esri.layers.VoxelLayer");var k;(function(m){m[m.API=1]="API";m[m.VerboseAPI=2]="VerboseAPI";m[m.Error=3]="Error"})(k||(k={}));c=function(m){function r(a){a=m.call(this,a)||this;a.serviceRoot="";a.popupEnabled=!0;a.operationalLayerType="Voxel";a.legendEnabled=!0;a.title=null;a.sections=new n;a.style=null;a.opacity=1;a.variables=new n;a.volumes=new n;a.index=null;a.minScale=0;a.maxScale=0;a.type="voxel";
a._dbgFlags=new Set;a._handles=new B;a.version={major:Number.NaN,minor:Number.NaN,versionString:""};return a}w._inheritsLoose(r,m);var d=r.prototype;d.destroy=function(){this._handles=l.destroyMaybe(this._handles)};d._dbg=function(a,b){this._dbgFlags.has(a)&&(a===k.Error?v.error(b):v.warn(b))};d.load=function(a){const b=l.isSome(a)?a.signal:null;a=this.loadFromPortal({supportedTypes:["Scene Service"]},a).catch(D.throwIfAbortError).then(()=>this._fetchService(b)).then(()=>this.serviceRoot=this.url);
this.addResolvingPromise(a);return Promise.resolve(this)};d.getConfiguration=function(){this._handles.add([p.watch(()=>this._getRenderMode(),b=>this._pushRenderModeToWasm(b)),p.watch(()=>this._getCurrentVariableId(),b=>this._pushCurrentVariableIdToWasm(b)),p.watch(()=>this._getDynamicSections(),b=>this._pushDynamicSectionsToWasm(b)),p.watch(()=>this._getSlices(),b=>this._pushSlicesToWasm(b)),p.watch(()=>this._getSections(),b=>this._pushSectionsToWasm(b))]);const a={layerType:this.operationalLayerType,
version:this.version.versionString,name:this.title,spatialReference:this.spatialReference,fullExtent:this.fullExtent,volumes:this.volumes.toJSON(),variables:this.variables.toJSON(),index:this.index.toJSON(),sections:this.sections.toJSON(),style:this.style};return a.index&&this.index.isValid()?JSON.stringify(a):""};d.readVersion=function(a,b){return m.prototype.parseVersionString.call(this,a)};d._getSections=function(){const a=[];for(const b of this.sections)a.push(new y({enabled:b.enabled,href:b.href,
id:b.id,label:b.label,normal:b.normal,point:b.point,sizeInPixel:b.sizeInPixel,slices:b.slices,timeId:b.timeId,variableId:b.variableId}));return a};d._pushSectionsToWasm=function(a){this._dbg(k.VerboseAPI,"VoxelLayer._pushSectionsToWasm() called");q.getInstance().setLayerStaticSections(this,a)||this._dbg(k.Error,"VoxelLayer._pushSectionsToWasm() failed!")};d._isPlaneValid=function(a,b,h){if(!(a.point&&Array.isArray(a.point)&&3===a.point.length&&a.normal&&Array.isArray(a.normal)&&3===a.normal.length))return!1;
for(let e=0;3>e;++e){const A=a.point[e];if(0>A||A>=h[b[e]].size)return!1}b=H.fromValues(a.normal[0],a.normal[1],a.normal[2]);G.normalize(b,b);if(1E-6>Math.abs(b[0])+Math.abs(b[1])+Math.abs(b[2]))return!1;a.normal[0]=b[0];a.normal[1]=b[1];a.normal[2]=b[2];return!0};d.getVariableStyle=function(a){let b=-1;b=l.isSome(a)?a:this._getCurrentVariableId();if(null==this||!this.style.variableStyles||-1===b)return null;a=this.style.variableStyles.findIndex(h=>h.variableId===b);return 0>a?null:this.style.variableStyles.getItemAt(a)};
d.getVariable=function(a){let b=-1;b=l.isSome(a)?a:this._getCurrentVariableId();if(!this.variables||-1===b)return null;a=this.variables.findIndex(h=>h.id===b);return 0>a?null:this.variables.getItemAt(a)};d.getVolume=function(a){const b=this.getVariable(a);return l.isSome(b)?this.volumes.find(({id:h})=>h===b.volumeId):null};d.validateLayer=function(a){if(a.layerType&&a.layerType!==this.operationalLayerType)throw new t("voxel-layer:layer-type-not-supported","VoxelLayer does not support this layer type",
{layerType:a.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor)||3>this.version.major)throw new t("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"3.x"});if(3<this.version.major)throw new t("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"3.x"});};d._getVolumeStyle=function(a){const b=this.getVariable(a);return l.isSome(b)?
this.style.volumeStyles.find(({volumeId:h})=>h===b.volumeId):null};d._getSlices=function(){const a=[],b=this.getVolume(null);if(!l.isSome(b)||!b.isVolumeValid())return a;const h=this._getVolumeStyle(null);if(!l.isSome(h))return a;for(const e of h.slices)this._isPlaneValid(e,[0,1,b.getZDimension()],b.dimensions)?a.push(new z({enabled:e.enabled,label:e.label,point:e.point,normal:e.normal})):a.push(new z({enabled:!1,label:"invalid",point:e.point,normal:e.normal}));return a};d._pushSlicesToWasm=function(a){this._dbg(k.VerboseAPI,
"VoxelLayer._pushSlicesToWasm() called!");q.getInstance().setLayerSlices(this,a)||this._dbg(k.Error,"VoxelLayer._pushSlicesToWasm() failed!")};d._getDynamicSections=function(){const a=[],b=this.getVolume(null);if(!l.isSome(b)||!b.isVolumeValid())return a;const h=this._getVolumeStyle(null);if(!l.isSome(h))return a;for(const e of h.dynamicSections)this._isPlaneValid(e,[0,1,b.getZDimension()],b.dimensions)?a.push(new x({enabled:e.enabled,label:e.label,point:e.point,normal:e.normal})):a.push(new x({enabled:!1,
label:"invalid",point:e.point,normal:e.normal}));return a};d._pushDynamicSectionsToWasm=function(a){this._dbg(k.VerboseAPI,"VoxelLayer._pushDynamicSectionsToWasm() called!");q.getInstance().setLayerDynamicSections(this,a)||this._dbg(k.Error,"VoxelLayer._updateDynamicSections() failed!")};d._getCurrentVariableId=function(){return this.style?this.style.currentVariableId:-1};d._pushCurrentVariableIdToWasm=function(a){this._dbg(k.VerboseAPI,"VoxelLayer._pushCurrentVariableIdToWasm() called!");q.getInstance().setLayerCurrentVariable(this,
a)||this._dbg(k.Error,"VoxelLayer._pushCurrentVariableIdToWasm() failed!")};d._getRenderMode=function(){return this.style?this.style.renderMode:"volume"};d._pushRenderModeToWasm=function(a){this._dbg(k.VerboseAPI,"VoxelLayer._pushRenderModeToWasm() called!");q.getInstance().setLayerRenderMode(this,a)||this._dbg(k.Error,"VoxelLayer.setLayerRenderMode() failed!")};w._createClass(r,[{key:"url",set:function(a){this._set("url",P.sanitizeUrl(a,v))}}]);return r}(O.SceneService(K.ArcGISService(L.OperationalLayer(M.PortalLayer(N.ScaleRangeLayer(C.MultiOriginJSONMixin(J.APIKeyMixin(I))))))));
f.__decorate([g.property(u.popupEnabled)],c.prototype,"popupEnabled",void 0);f.__decorate([g.property({type:["Voxel"]})],c.prototype,"operationalLayerType",void 0);f.__decorate([g.property(u.legendEnabled)],c.prototype,"legendEnabled",void 0);f.__decorate([g.property({json:{write:!0}})],c.prototype,"title",void 0);f.__decorate([g.property(u.url)],c.prototype,"url",null);f.__decorate([g.property({type:n.ofType(y),json:{write:!0,origins:{"web-scene":{name:"layerDefinition.sections",write:!0},service:{write:!1}}}})],
c.prototype,"sections",void 0);f.__decorate([g.property({type:Q,json:{write:!0,origins:{"web-scene":{name:"layerDefinition.style",write:!0},service:{write:!1}}}})],c.prototype,"style",void 0);f.__decorate([g.property({type:["show","hide"]})],c.prototype,"listMode",void 0);f.__decorate([g.property({type:Number,range:{min:0,max:1},nonNullable:!0,json:{read:!1,write:!1,origins:{"web-scene":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"opacity",void 0);f.__decorate([g.property({type:n.ofType(R)})],
c.prototype,"variables",void 0);f.__decorate([g.property({type:n.ofType(S)})],c.prototype,"volumes",void 0);f.__decorate([g.property({type:T})],c.prototype,"index",void 0);f.__decorate([g.property({type:Number,json:{name:"layerDefinition.minScale",read:!1,write:!1,origins:{service:{read:!1,write:!1}}}})],c.prototype,"minScale",void 0);f.__decorate([g.property({type:Number,json:{name:"layerDefinition.maxScale",read:!1,write:!1,origins:{service:{read:!1,write:!1}}}})],c.prototype,"maxScale",void 0);
f.__decorate([g.property({json:{read:!1},readOnly:!0})],c.prototype,"type",void 0);f.__decorate([g.property({readOnly:!0,json:{name:"serviceVersion"}})],c.prototype,"version",void 0);f.__decorate([E.reader("service","version")],c.prototype,"readVersion",null);return c=f.__decorate([F.subclass("esri.layers.VoxelLayer")],c)});