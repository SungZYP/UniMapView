// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../assets"],function(Q,H,R){function S(h){const {_malloc:q,_free:k,_lerc_getBlobInfo:u,_lerc_getDataRanges:K,_lerc_decode_4D:L,asm:J}=h;let d;const x=Object.values(J).find(a=>a&&"buffer"in a&&a.buffer===h.HEAPU8.buffer),B=a=>{a=a.map(g=>(g>>3<<3)+16);var c=a.reduce((g,n)=>g+n),l=q(c);d=new Uint8Array(x.buffer);c=a[0];a[0]=l;for(l=1;l<a.length;l++){const g=a[l];a[l]=a[l-1]+c;c=g}return a};I.getBlobInfo=a=>{var c=new Uint8Array(48),l=new Uint8Array(24);const [g,n,
t]=B([a.length,c.length,l.length]);d.set(a,g);d.set(c,n);d.set(l,t);var e=u(g,a.length,n,t,12,3);if(e)throw k(g),`lerc-getBlobInfo: error code is ${e}`;d=new Uint8Array(x.buffer);c.set(d.slice(n,n+c.length));l.set(d.slice(t,t+l.length));c=new Uint32Array(c.buffer);var b=new Float64Array(l.buffer);const [p,r,f,D,v,y,z,A,F,,E]=c;l={version:p,dimCount:f,width:D,height:v,validPixelCount:z,bandCount:y,blobSize:A,maskCount:F,dataType:r,minValue:b[0],maxValue:b[1],maxZerror:b[2],statistics:[],bandCountWithNoData:E};
if(E)return l;if(1===f&&1===y)return k(g),l.statistics.push({minValue:b[0],maxValue:b[1]}),l;var m=f*y*8,w=new Uint8Array(m),G=new Uint8Array(m);c=g;b=0;let M=!1;d.byteLength<g+2*m?(k(g),M=!0,[c,b,C]=B([a.length,m,m]),d.set(a,c)):[b,C]=B([m,m]);d.set(w,b);d.set(G,C);if(e=K(g,a.length,f,y,b,C))throw k(c),M||k(b),`lerc-getDataRanges: error code is ${e}`;d=new Uint8Array(x.buffer);w.set(d.slice(b,b+m));G.set(d.slice(C,C+m));a=new Float64Array(w.buffer);e=new Float64Array(G.buffer);G=l.statistics;for(m=
0;m<y;m++)if(1<f){w=a.slice(m*f,(m+1)*f);var C=e.slice(m*f,(m+1)*f);const T=Math.min.apply(null,w),U=Math.max.apply(null,C);G.push({minValue:T,maxValue:U,dimStats:{minValues:w,maxValues:C}})}else G.push({minValue:a[m],maxValue:e[m]});k(c);M||k(b);return l};I.decode=(a,c)=>{const {maskCount:l,dimCount:g,bandCount:n,width:t,height:e,dataType:b,bandCountWithNoData:p}=c;var r=O[b],f=t*e;c=new Uint8Array(f*n);const D=f*g*n*r.size;r=new Uint8Array(D);const v=new Uint8Array(n),y=8*n,z=new Uint8Array(y),
[A,F,E,m,w]=B([a.length,c.length,r.length,v.length,z.length]);d.set(a,A);d.set(c,F);d.set(r,E);d.set(v,m);d.set(z,w);if(a=L(A,a.length,l,F,g,t,e,n,b,E,m,w))throw k(A),`lerc-decode: error code is ${a}`;d=new Uint8Array(x.buffer);r.set(d.slice(E,E+D));c.set(d.slice(F,F+f));a=null;if(p)for(v.set(d.slice(m,m+n)),z.set(d.slice(w,w+y)),a=[],f=0;f<v.length;f++)a.push(v[f]?z[f]:null);k(A);return{data:r,maskData:c,noDataValues:a}}}const O=[{pixelType:"S8",size:1,ctor:Int8Array,range:[-128,128]},{pixelType:"U8",
size:1,ctor:Uint8Array,range:[0,255]},{pixelType:"S16",size:2,ctor:Int16Array,range:[-32768,32767]},{pixelType:"U16",size:2,ctor:Uint16Array,range:[0,65536]},{pixelType:"S32",size:4,ctor:Int32Array,range:[-2147483648,2147483647]},{pixelType:"U32",size:4,ctor:Uint32Array,range:[0,4294967296]},{pixelType:"F32",size:4,ctor:Float32Array,range:[-3.4027999387901484E38,3.4027999387901484E38]},{pixelType:"F64",size:8,ctor:Float64Array,range:[-1.7976931348623157E308,1.7976931348623157E308]}];let N=null,P=
!1;const I={getBlobInfo:null,decode:null};H.decode=function(h,q={}){var k,u=null!=(k=q.inputOffset)?k:0;k=h instanceof Uint8Array?h.subarray(u):new Uint8Array(h,u);h=I.getBlobInfo(k);const {data:K,maskData:L}=I.decode(k,h),{width:J,height:d,bandCount:x,dimCount:B,dataType:a,maskCount:c,statistics:l}=h;k=O[a];var g=new k.ctor(K.buffer);u=[];const n=[],t=J*d;var e=t*B;for(var b=0;b<x;b++){var p=g.subarray(b*e,(b+1)*e);if(q.returnPixelInterleavedDims)u.push(p);else{a:{var r=t,f=B;if(2>f)break a;const D=
new k.ctor(r*f);for(let v=0,y=0;v<r;v++)for(let z=0,A=v;z<f;z++,A+=r)D[A]=p[y++];p=D}u.push(p)}n.push(L.subarray(b*e,(b+1)*e))}g=0===c?null:1===c?n[0]:new Uint8Array(t);if(1<c)for(g.set(n[0]),e=1;e<n.length;e++)for(b=n[e],p=0;p<t;p++)g[p]&=b[p];({noDataValue:e}=q);e=null!=e&&k.range[0]<=e&&k.range[1]>=e;if(0<c&&e)for({noDataValue:e}=q,b=0;b<x;b++)for(p=u[b],r=n[b]||g,f=0;f<t;f++)0===r[f]&&(p[f]=e);return{width:J,height:d,bandCount:x,pixelType:q.pixelType&&0===h.version?q.pixelType:k.pixelType,dimCount:B,
statistics:l,pixels:u,mask:g,bandMasks:c===x&&1<x?n:null}};H.getBlobInfo=function(h,q={}){var k,u;h=h instanceof Uint8Array?h.subarray(null!=(k=q.inputOffset)?k:0):new Uint8Array(h,null!=(u=q.inputOffset)?u:0);return I.getBlobInfo(h)};H.isLoaded=function(){return P};H.load=function(){return N?N:N=(new Promise((h,q)=>Q(["../../../chunks/lerc-wasm"],h,q))).then(h=>h.lercWasm).then(({default:h})=>h({locateFile:q=>R.getAssetUrl(`esri/layers/support/rasterFormats/${q}`)})).then(h=>{S(h);P=!0})};Object.defineProperty(H,
"__esModule",{value:!0})});