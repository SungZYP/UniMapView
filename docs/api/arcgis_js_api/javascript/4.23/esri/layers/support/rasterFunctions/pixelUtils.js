// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/maybe","../PixelBlock"],function(A,K,F){function D(a){return K.isSome(a)&&"esri.layers.support.PixelBlock"===a.declaredClass&&a.pixels&&0<a.pixels.length}function Q(a,c){a=Math.min(Math.max(a,-100),100);c=Math.min(Math.max(c,-100),100);let b,f;const g=new Uint8Array(256);for(b=0;256>b;b++)0<a&&100>a?f=(200*b-25500+510*c)/(2*(100-a))+128:0>=a&&-100<a?f=(200*b-25500+510*c)*(100+a)/2E4+128:100===a?(f=200*b-25500+256*(100-a)+510*c,f=0<f?255:0):-100===a&&(f=128),g[b]=255<
f?255:0>f?0:f;return g}function R(a,c,b,f,g,m,k,l){return{xmin:g<=b*a?0:g<b*a+a?g-b*a:a,ymin:m<=f*c?0:m<f*c+c?m-f*c:c,xmax:g+k<=b*a?0:g+k<b*a+a?g+k-b*a:a,ymax:m+l<=f*c?0:m+l<f*c+c?m+l-f*c:c}}function M(a,c,b,f,g,m){const {width:k,height:l}=b.block,{x:d,y:h}=b.offset,{width:e,height:p}=b.mosaic;b=R(k,l,f,g,d,h,e,p);let q=0;var n=0;if(m){var t=m.hasGCSSShiftTransform?360:m.halfWorldWidth,u=k*m.resolutionX,r=m.startX+f*u;u=r+u;r<t&&u>t?n=m.rightPadding:r>=t&&(q=m.leftMargin-m.rightPadding,n=0)}b.xmax-=
n;if("number"===typeof c)for(m=b.ymin;m<b.ymax;m++)for(n=(g*l+m-h)*e+(f*k-d)+q,t=b.xmin;t<b.xmax;t++)a[n+t]=c;else for(m=b.ymin;m<b.ymax;m++)for(n=(g*l+m-h)*e+(f*k-d)+q,t=m*k,r=b.xmin;r<b.xmax;r++)a[n+r]=c[t+r]}function S(a,c,b={}){const {clipOffset:f,clipSize:g,alignmentInfo:m,blockWidths:k}=b;if(k)return Y(a,c,{blockWidths:k});var l=a.find(x=>D(x));if(K.isNone(l))return null;b=g?g.width:c.width;const d=g?g.height:c.height;var h=l.width,e=l.height;const p=c.width/h,q=c.height/e;c={offset:f||{x:0,
y:0},mosaic:g||c,block:{width:h,height:e}};h=l.pixelType;e=F.getPixelArrayConstructor(h);var n=l.pixels.length;l=[];for(var t=0;t<n;t++){var u=new e(b*d);for(let x=0;x<q;x++)for(let w=0;w<p;w++){var r=a[x*p+w];D(r)&&(r=r.pixels[t],M(u,r,c,w,x,m))}l.push(u)}let v;if(a.some(x=>K.isNone(x)||x.mask&&0<x.mask.length))for(v=new Uint8Array(b*d),e=0;e<q;e++)for(n=0;n<p;n++)u=a[e*p+n],(t=K.isSome(u)?u.mask:null)?M(v,t,c,n,e,m):u?M(v,1,c,n,e,m):M(v,0,c,n,e,m);a=new F({width:b,height:d,pixels:l,pixelType:h,
mask:v});a.updateStatistics();return a}function Y(a,c,b){const f=a.find(n=>K.isSome(n));if(!K.isSome(f))return null;var g=a.some(n=>K.isSome(n)?!!n.mask:!0);const {width:m,height:k}=c;c=g?new Uint8Array(m*k):null;({blockWidths:b}=b);const l=[],d=f.getPlaneCount(),h=F.getPixelArrayConstructor(f.pixelType);if(g)for(let n=0,t=0;n<a.length;t+=b[n],n++)if(g=a[n],D(g)){var e=g.mask;for(var p=0;p<k;p++)for(var q=0;q<b[n];q++)c[p*m+q+t]=null==e?255:e[p*g.width+q]}for(g=0;g<d;g++){e=new h(m*k);for(let n=0,
t=0;n<a.length;t+=b[n],n++)if(p=a[n],D(p)&&(q=p.pixels[g],null!=q))for(let u=0;u<k;u++)for(let r=0;r<b[n];r++)e[u*m+r+t]=q[u*p.width+r];l.push(e)}a=new F({width:m,height:k,mask:c,pixels:l,pixelType:f.pixelType});a.updateStatistics();return a}function T(a){if(!D(a))return null;const c=a.clone(),{width:b,height:f,pixels:g,mask:m}=a;var k=g[0];a=c.pixels[0];for(let h=2;h<f-1;h++){const e=new Map;for(var l=h-2;l<h+2;l++)for(var d=0;4>d;d++){const p=l*b+d;L(e,k[p],m?m[p]:1)}a[h*b]=U(e);a[h*b+1]=a[h*b+
2]=a[h*b];for(l=3;l<b-1;l++)d=(h-2)*b+l+1,L(e,k[d],m?m[d]:1),d=(h-1)*b+l+1,L(e,k[d],m?m[d]:1),d=h*b+l+1,L(e,k[d],m?m[d]:1),d=(h+1)*b+l+1,L(e,k[d],m?m[d]:1),d=(h-2)*b+l-3,N(e,k[d],m?m[d]:1),d=(h-1)*b+l-3,N(e,k[d],m?m[d]:1),d=h*b+l-3,N(e,k[d],m?m[d]:1),d=(h+1)*b+l-3,N(e,k[d],m?m[d]:1),a[h*b+l]=U(e);a[h*b+l+1]=a[h*b+l]}for(k=0;k<b;k++)a[k]=a[b+k]=a[2*b+k],a[(f-1)*b+k]=a[(f-2)*b+k];c.updateStatistics();return c}function U(a){if(0===a.size)return 0;let c=0,b=-1,f=0;const g=a.keys();let m=g.next();for(;!m.done;)f=
a.get(m.value),f>c&&(b=m.value,c=f),m=g.next();return b}function N(a,c,b){0!==b&&(b=a.get(c),1===b?a.delete(c):a.set(c,b-1))}function L(a,c,b){0!==b&&a.set(c,a.has(c)?a.get(c)+1:1)}function V(a,c,b){let {x:f,y:g}=c;const {width:m,height:k}=b;if(0===f&&0===g&&k===a.height&&m===a.width)return a;const {width:l,height:d}=a;c=Math.max(0,g);const h=Math.max(0,f),e=Math.min(f+m,l),p=Math.min(g+k,d);if(0>e||0>p||!D(a))return null;f=Math.max(0,-f);g=Math.max(0,-g);const {pixels:q,mask:n}=a;var t=m*k,u=q.length;
const r=[];for(var v=0;v<u;v++){var x=q[v],w=F.createEmptyBand(a.pixelType,t);for(let B=c;B<p;B++){const z=B*l;let J=(B+g-c)*m+f;for(let G=h;G<e;G++)w[J++]=x[z+G]}r.push(w)}t=new Uint8Array(t);for(u=c;u<p;u++)for(v=u*l,x=(u+g-c)*m+f,w=h;w<e;w++)t[x++]=n?n[v+w]:1;a=new F({width:b.width,height:b.height,pixelType:a.pixelType,pixels:r,mask:t});a.updateStatistics();return a}function Z(a,c=!0){if(!D(a))return null;const {pixels:b,width:f,height:g,mask:m,pixelType:k}=a;a=[];const l=Math.round(f/2),d=Math.round(g/
2),h=g-1,e=f-1;for(var p=0;p<b.length;p++){var q=b[p],n=F.createEmptyBand(k,l*d),t=0;for(var u=0;u<g;u+=2)for(var r=0;r<f;r+=2){var v=q[u*f+r];if(c){var x=r===e?v:q[u*f+r+1];const w=u===h?v:q[u*f+r+f],B=r===e?w:u===h?x:q[u*f+r+f+1];n[t++]=(v+x+w+B)/4}else n[t++]=v}a.push(n)}p=null;if(m)for(p=new Uint8Array(l*d),q=0,n=0;n<g;n+=2)for(t=0;t<f;t+=2)u=m[n*f+t],c?(r=t===e?u:m[n*f+t+1],v=n===h?u:m[n*f+t+f],x=t===e?v:n===h?r:m[n*f+t+f+1],p[q++]=u*r*v*x?1:0):p[q++]=u;return new F({width:l,height:d,pixelType:k,
pixels:a,mask:p})}function W(a,c,b,f,g=.5){const {width:m,height:k}=a,{width:l,height:d}=c;a=f.cols;f=f.rows;c=Math.ceil(l/a-.1/a);const h=Math.ceil(d/f-.1/f);let e,p,q,n,t;const u=c*a;var r=u*h*f;const v=new Float32Array(r),x=new Float32Array(r),w=new Uint32Array(r),B=new Uint32Array(r);let z=0,J,G;for(let H=0;H<h;H++)for(let I=0;I<c;I++){var y=12*(H*c+I);r=b[y];e=b[y+1];p=b[y+2];q=b[y+3];n=b[y+4];t=b[y+5];for(var C=0;C<f;C++){z=(H*f+C)*u+I*a;G=(C+.5)/f;for(let E=0;E<C;E++)J=(E+.5)/a,v[z+E]=(r*J+
e*G+p)*m-g,x[z+E]=(q*J+n*G+t)*k-g,w[z+E]=Math.round(v[z+E]),B[z+E]=Math.round(x[z+E])}y+=6;r=b[y];e=b[y+1];p=b[y+2];q=b[y+3];n=b[y+4];t=b[y+5];for(y=0;y<f;y++)for(z=(H*f+y)*u+I*a,G=(y+.5)/f,C=y;C<a;C++)J=(C+.5)/a,v[z+C]=(r*J+e*G+p)*m-g,x[z+C]=(q*J+n*G+t)*k-g,w[z+C]=Math.round(v[z+C]),B[z+C]=Math.round(x[z+C])}return{offsets_x:v,offsets_y:x,offsets_xi:w,offsets_yi:B,gridWidth:u}}A.approximateTransform=function(a,c,b,f,g="nearest"){if(!D(a))return null;"majority"===g&&(a=T(a));const {pixels:m,mask:k,
pixelType:l}=a,d=a.width;var h=a.height;const e=F.getPixelArrayConstructor(l),p=m.length,{width:q,height:n}=c;a=!1;for(let B=0;B<b.length;B+=3)-1===b[B]&&-1===b[B+1]&&-1===b[B+2]&&(a=!0);const {offsets_x:t,offsets_y:u,offsets_xi:r,offsets_yi:v,gridWidth:x}=W({width:d,height:h},c,b,f,"majority"===g?0:.5);let w;c=(B,z,J)=>{const G=B instanceof Float32Array||B instanceof Float64Array?0:.5;for(let y=0;y<n;y++){w=y*x;for(let C=0;C<q;C++){if(0>t[w]||0>u[w])B[y*q+C]=0;else if(J)B[y*q+C]=z[r[w]+v[w]*d];else{const H=
Math.floor(t[w]),I=Math.floor(u[w]),E=Math.ceil(t[w]),O=Math.ceil(u[w]),P=t[w]-H,X=u[w]-I;B[y*q+C]=!k||k[H+I*d]&&k[H+I*d]&&k[H+O*d]&&k[E+O*d]?(1-X)*((1-P)*z[H+I*d]+P*z[E+I*d])+X*((1-P)*z[H+O*d]+P*z[E+O*d])+G:z[r[w]+v[w]*d]}w++}}};b=[];for(h=0;h<p;h++)f=new e(q*n),c(f,m[h],"nearest"===g||"majority"===g),b.push(f);g=new F({width:q,height:n,pixelType:l,pixels:b});if(k)g.mask=new Uint8Array(q*n),c(g.mask,k,!0);else if(a)for(g.mask=new Uint8Array(q*n),a=0;a<q*n;a++)g.mask[a]=0>t[a]||0>u[a]?0:1;g.updateStatistics();
return g};A.clip=V;A.colorize=function(a,c){if(!D(a)||!c&&(c.indexedColormap||c.indexed2DColormap))return a;const b=a.clone();var f=b.pixels;let g=b.mask;const m=b.width*b.height;if(1!==f.length)return a;const {indexedColormap:k,indexed2DColormap:l,offset:d,alphaSpecified:h}=c;c=k.length-1;a=0;f=f[0];const e=new Uint8Array(f.length),p=new Uint8Array(f.length),q=new Uint8Array(f.length);let n=0;if(k)if(g)for(a=0;a<m;a++)g[a]&&(n=4*(f[a]-d),n<d||n>c?g[a]=0:(e[a]=k[n],p[a]=k[n+1],q[a]=k[n+2],g[a]=k[n+
3]));else{g=new Uint8Array(m);for(a=0;a<m;a++)n=4*(f[a]-d),n<d||n>c?g[a]=0:(e[a]=k[n],p[a]=k[n+1],q[a]=k[n+2],g[a]=k[n+3]);b.mask=g}else if(g)for(a=0;a<m;a++)g[a]&&(c=l[f[a]],e[a]=c[0],p[a]=c[1],q[a]=c[2],g[a]=c[3]);else{g=new Uint8Array(m);for(a=0;a<m;a++)c=l[f[a]],e[a]=c[0],p[a]=c[1],q[a]=c[2],g[a]=c[3];b.mask=g}b.pixels=[e,p,q];b.statistics=null;b.pixelType="u8";b.maskIsAlpha=h;return b};A.createColormapLUT=function(a){if(a){var c=a.colormap;if(c&&0!==c.length){c=c.sort((h,e)=>h[0]-e[0]);var b=
0;0>c[0][0]&&(b=c[0][0]);var f=Math.max(256,c[c.length-1][0]-b+1),g=new Uint8Array(4*f),m=[],k=0,l=0,d=5===c[0].length;if(65536<f)return c.forEach(h=>{m[h[0]-b]=d?h.slice(1):h.slice(1).concat([255])}),{indexed2DColormap:m,offset:b,alphaSpecified:d};if(a.fillUnspecified)for(a=c[l],k=a[0]-b;k<f;k++)g[4*k]=a[1],g[4*k+1]=a[2],g[4*k+2]=a[3],g[4*k+3]=d?a[4]:255,k===a[0]-b&&(a=l===c.length-1?a:c[++l]);else for(k=0;k<c.length;k++)a=c[k],l=4*(a[0]-b),g[l]=a[1],g[l+1]=a[2],g[l+2]=a[3],g[l+3]=d?a[4]:255;return{indexedColormap:g,
offset:b,alphaSpecified:d}}}};A.createContrastBrightnessLUT=Q;A.createHistogramEqualizationLUT=function(a,c=256){c=Math.min(c,256);const {size:b,counts:f}=a;a=new Uint8Array(b);var g=f.reduce((h,e)=>h+e/c,0);let m=0;var k=0;let l=0,d=g;for(let h=0;h<b;h++)if(l+=f[h],!(h<b-1&&l+f[h+1]<d)){for(;m<c-1&&d<l;)m++,d+=g;for(;k<=h;k++)a[k]=m;k=h+1}for(g=k;g<b;g++)a[g]=c-1;return a};A.createStretchLUT=function(a){const {minCutOff:c,maxCutOff:b,gamma:f,pixelType:g}=a,m=a.outMin||0,k=a.outMax||255;if(-1===["u8",
"u16","s8","s16"].indexOf(g))return null;const l=c.length;let d;let h=0;"s8"===g?h=-127:"s16"===g&&(h=-32767);let e=256;-1<["u16","s16"].indexOf(g)&&(e=65536);const p=[],q=k-m;for(d=0;d<l;d++)p[d]=b[d]-c[d];var n=f&&f.length>=l;const t=[];if(n)for(d=0;d<l;d++)t[d]=1<f[d]?2<f[d]?6.5+(f[d]-2)**2.5:6.5+100*(2-f[d])**4:1;let u;const r=[];let v,x,w;if(n)for(d=0;d<l;d++){w=[];for(n=0;n<e;n++)v=n+h,u=(v-c[d])/p[d],x=1,1<f[d]&&(x-=(1/q)**(u*t[d])),w[n]=v<b[d]&&v>c[d]?Math.floor(x*q*u**(1/f[d]))+m:v>=b[d]?
k:m;r[d]=w}else for(d=0;d<l;d++){w=[];for(n=0;n<e;n++)v=n+h,w[n]=v<=c[d]?m:v>=b[d]?k:Math.floor((v-c[d])/p[d]*q)+m;r[d]=w}if(null!=a.contrastOffset)for(a=Q(a.contrastOffset,a.brightnessOffset),d=0;d<l;d++)for(w=r[d],n=0;n<e;n++)w[n]=a[w[n]];return{lut:r,offset:h}};A.estimateStatisticsFromHistograms=function(a){const c=[];for(let m=0;m<a.length;m++){const {min:k,max:l,size:d,counts:h}=a[m];let e=0;var b=0;for(var f=0;f<d;f++)e+=h[f],b+=f*h[f];b/=e;f=0;for(var g=0;g<d;g++)f+=h[g]*(g-b)**2;g=(l-k)/d;
c.push({min:k,max:l,avg:(b+.5)*g+k,stddev:Math.sqrt(f/(e-1))*g})}return c};A.estimateStatisticsHistograms=function(a){if(!D(a))return null;a.statistics||a.updateStatistics();const {pixels:c,mask:b,pixelType:f,statistics:g}=a;a=a.width*a.height;const m=c.length;let k,l;let d;var h;const e=[],p=[];for(d=0;d<m;d++){var q=new Uint32Array(256);var n=c[d];if("u8"===f)if(k=-.5,l=255.5,b)for(h=0;h<a;h++)b[h]&&q[n[h]]++;else for(h=0;h<a;h++)q[n[h]]++;else{k=g[d].minValue;l=g[d].maxValue;var t=(l-k)/256;var u=
new Uint32Array(257);if(b)for(h=0;h<a;h++)b[h]&&u[Math.floor((n[h]-k)/t)]++;else for(h=0;h<a;h++)u[Math.floor((n[h]-k)/t)]++;for(h=0;255>h;h++)q[h]=u[h];q[255]=u[255]+u[256]}e.push({min:k,max:l,size:256,counts:q});for(h=n=u=t=0;256>h;h++)t+=q[h],u+=h*q[h];u/=t;for(h=0;256>h;h++)n+=q[h]*(h-u)**2;q=Math.sqrt(n/(t-1));t=(l-k)/256;h=(u+.5)*t+k;q*=t;p.push({min:k,max:l,avg:h,stddev:q})}return{statistics:p,histograms:e}};A.extractBands=function(a,c){if(null==c||!c.length||!D(a))return a;const b=a.pixels.length;
return c&&c.some(f=>f>=b)||1===b&&1===c.length&&0===c[0]||b===c.length&&!c.some((f,g)=>f!==g)?a:new F({pixelType:a.pixelType,width:a.width,height:a.height,mask:a.mask,validPixelCount:a.validPixelCount,maskIsAlpha:a.maskIsAlpha,pixels:c.map(f=>a.pixels[f]),statistics:a.statistics&&c.map(f=>a.statistics[f])})};A.getClipBounds=R;A.getLocalArithmeticNorthRotations=function(a,c){const {coefficients:b,spacing:f}=c,{offsets_x:g,offsets_y:m,gridWidth:k}=W(a,a,b,{rows:f[0],cols:f[1]},.5),{width:l,height:d}=
a;a=new Float32Array(l*d);c=180/Math.PI;for(let p=0;p<d;p++)for(let q=0;q<l;q++){var h=p*k+q,e=0===p?h:h-k;const n=p===d-1?h:h+k;h=g[e]-g[n];e=m[n]-m[e];isNaN(h)||isNaN(e)?a[p*l+q]=90:(e=Math.atan2(e,h)*c,e=(360+e)%360,a[p*l+q]=e)}return a};A.isValidPixelBlock=D;A.lookupPixels=function(a,c){if(!D(a))return null;const {pixels:b,mask:f}=a,g=a.width*a.height,m=b.length;let k=c.lut;({offset:c}=c);let l,d;k&&1===k[0].length&&(k=b.map(()=>k));const h=[];let e,p,q;if(c)if(null==f)for(l=0;l<m;l++){e=b[l];
p=k[l];q=new Uint8Array(g);for(d=0;d<g;d++)q[d]=p[e[d]-c];h.push(q)}else for(l=0;l<m;l++){e=b[l];p=k[l];q=new Uint8Array(g);for(d=0;d<g;d++)f[d]&&(q[d]=p[e[d]-c]);h.push(q)}else if(null==f)for(l=0;l<m;l++){e=b[l];p=k[l];q=new Uint8Array(g);for(d=0;d<g;d++)q[d]=p[e[d]];h.push(q)}else for(l=0;l<m;l++){e=b[l];p=k[l];q=new Uint8Array(g);for(d=0;d<g;d++)f[d]&&(q[d]=p[e[d]]);h.push(q)}a=new F({width:a.width,height:a.height,pixels:h,mask:f,pixelType:"u8"});a.updateStatistics();return a};A.mosaic=S;A.mosaicPixelData=
function(a,c){if(!a||0===a.length)return null;var b=a.find(p=>p.pixelBlock);if(!b||K.isNone(b.pixelBlock))return null;var f=(b.extent.xmax-b.extent.xmin)/b.pixelBlock.width;const g=(b.extent.ymax-b.extent.ymin)/b.pixelBlock.height,m=.01*Math.min(f,g),k=a.sort((p,q)=>Math.abs(p.extent.ymax-q.extent.ymax)>m?q.extent.ymax-p.extent.ymax:Math.abs(p.extent.xmin-q.extent.xmin)>m?p.extent.xmin-q.extent.xmin:0);var l=Math.min.apply(null,k.map(p=>p.extent.xmin));const d=Math.min.apply(null,k.map(p=>p.extent.ymin)),
h=Math.max.apply(null,k.map(p=>p.extent.xmax)),e=Math.max.apply(null,k.map(p=>p.extent.ymax));a={x:Math.round((c.xmin-l)/f),y:Math.round((e-c.ymax)/g)};l={width:Math.round((h-l)/f),height:Math.round((e-d)/g)};f={width:Math.round((c.xmax-c.xmin)/f),height:Math.round((c.ymax-c.ymin)/g)};if(Math.round(l.width/b.pixelBlock.width)*Math.round(l.height/b.pixelBlock.height)!==k.length||0>a.x||0>a.y||l.width<f.width||l.height<f.height)return null;b=k.map(p=>p.pixelBlock);b=S(b,l,{clipOffset:a,clipSize:f});
return{extent:c,pixelBlock:b}};A.remapColor=function(a,c){if(!D(a))return null;a=a.clone();var {pixels:b}=a;const f=a.width*a.height,g=c.length,m=Math.floor(g/2),k=c[Math.floor(m)];b=b[0];let l,d,h,e,p,q,n=!1;const t=new Uint8Array(f),u=new Uint8Array(f),r=new Uint8Array(f);let v=a.mask;const x=4===c[0].mappedColor.length;v||(v=new Uint8Array(f),v.fill(x?255:1),a.mask=v);for(p=0;p<f;p++)if(v[p]){l=b[p];n=!1;q=m;d=k;h=0;for(e=g-1;1<e-h;){if(l===d.value){n=!0;break}l>d.value?h=q:e=q;q=Math.floor((h+
e)/2);d=c[Math.floor(q)]}n||(l===c[h].value?(d=c[h],n=!0):l===c[e].value?(d=c[e],n=!0):l<c[h].value?(n=!1,d=null):l>c[h].value&&(l<c[e].value?(d=c[h],n=!0):e===g-1?(n=!1,d=null):(d=c[e],n=!0)));n?(t[p]=d.mappedColor[0],u[p]=d.mappedColor[1],r[p]=d.mappedColor[2],v[p]=d.mappedColor[3]):t[p]=u[p]=r[p]=v[p]=0}a.pixels=[t,u,r];a.mask=v;a.pixelType="u8";a.maskIsAlpha=x;return a};A.resampleByMajority=T;A.setValidBoundary=function(a,c,b){if(!D(a))return null;const {width:f,height:g}=a,m=c.x;c=c.y;const k=
b.width+m;b=b.height+c;if(0>m||0>c||k>f||b>g||0===m&&0===c&&k===f&&b===g)return a;a.mask||(a.mask=new Uint8Array(f*g));const l=a.mask;for(let d=0;d<g;d++){const h=d*f;for(let e=0;e<f;e++)l[h+e]=d<c||d>=b||e<m||e>=k?0:1}a.updateStatistics();return a};A.split=function(a,c,b){if(!D(a))return null;const {width:f,height:g}=c;let {width:m,height:k}=a;const l=new Map,d={x:0,y:0};b=null==b?1:1+b;for(let h=0;h<b;h++){const e=Math.ceil(m/f),p=Math.ceil(k/g);for(let q=0;q<p;q++){d.y=q*g;for(let n=0;n<e;n++){d.x=
n*f;const t=V(a,d,c);l.set(`${h}/${q}/${n}`,t)}}h<b-1&&(a=Z(a));m=Math.round(m/2);k=Math.round(k/2)}return l};A.stretch=function(a,c){if(!D(a))return null;a=a.clone();const {pixels:b,mask:f}=a,{minCutOff:g,maxCutOff:m,gamma:k}=c,l=c.outMin||0;c=c.outMax||255;const d=a.width*a.height,h=b.length;let e;let p,q,n;const t=c-l,u=[];for(e=0;e<h;e++)u[e]=m[e]-g[e];var r=k&&k.length>=h;const v=[];if(r)for(e=0;e<h;e++)v[e]=1<k[e]?2<k[e]?6.5+(k[e]-2)**2.5:6.5+100*(2-k[e])**4:1;if(r)if(null!=f)for(r=0;r<d;r++){if(f[r])for(e=
0;e<h;e++)p=b[e][r],n=(p-g[e])/u[e],q=1,1<k[e]&&(q-=(1/t)**(n*v[e])),b[e][r]=p<m[e]&&p>g[e]?Math.floor(q*t*n**(1/k[e]))+l:p>=m[e]?c:l}else for(r=0;r<d;r++)for(e=0;e<h;e++)p=b[e][r],n=(p-g[e])/u[e],q=1,1<k[e]&&(q-=(1/t)**(n*v[e])),b[e][r]=p<m[e]&&p>g[e]?Math.floor(q*t*n**(1/k[e]))+l:p>=m[e]?c:l;else if(null!=f)for(r=0;r<d;r++){if(f[r])for(e=0;e<h;e++)p=b[e][r],b[e][r]=p<m[e]&&p>g[e]?Math.floor((p-g[e])/u[e]*t)+l:p>=m[e]?c:l}else for(r=0;r<d;r++)for(e=0;e<h;e++)p=b[e][r],b[e][r]=p<m[e]&&p>g[e]?Math.floor((p-
g[e])/u[e]*t)+l:p>=m[e]?c:l;a.pixelType="u8";a.updateStatistics();return a};Object.defineProperty(A,"__esModule",{value:!0})});