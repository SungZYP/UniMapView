// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../core/Error ../../../core/maybe ../../../core/unitUtils ../../../chunks/pe ../../../geometry/projection ../../../geometry/Extent ../../../geometry/Point ../../../geometry/SpatialReference".split(" "),function(z,ja,ua,ka,x,I,w,C,O,B,la){function P(a,b,c){return!C.canProjectWithoutEngine(a,b,c)}function H(a,b,c){if((a=P(a,b,c))&&!C.isLoaded())throw new ka("rasterprojectionhelper-project","projection engine is not loaded");
return a}function Q(){Q=ja._asyncToGenerator(function*(){if(C.isLoaded())return null;yield C.load()});return Q.apply(this,arguments)}function R(a,b,c,d=null){const k=a.spatialReference;if(k.equals(b))return a;H(k,b,d);c=c.center;c=new O({xmin:c.x-a.x/2,xmax:c.x+a.x/2,ymin:c.y-a.y/2,ymax:c.y+a.y/2,spatialReference:k});d=C.project(c,b,d);if(x.isNone(d))return null;d={x:d.xmax-d.xmin,y:d.ymax-d.ymin};c=E(b);x.isSome(c)&&d.x>=c&&(b=I.getMetersPerUnitForSR(k)/I.getMetersPerUnitForSR(b),d.x=a.x*b,d.y=a.y*
b);return d}function F(a,b=.01){return I.getMetersPerUnitForSR(a)?b/I.getMetersPerUnitForSR(a):0}function S(a,b,c=null,d=!0){var k=a.spatialReference;if(k.equals(b))return a;H(k,b,c);c=C.project(a,b,c);if(!d||!c)return c;d=L(k,!0);b=L(b,!0);(k=F(k))&&x.isSome(d)&&x.isSome(b)&&(0<c.x&&Math.abs(a.x-d[0])<k?c.x-=b[1]-b[0]:0>c.x&&Math.abs(a.x-d[1])<k&&(c.x+=b[1]-b[0]));return c}function Z(a){const {inSR:b,outSR:c,datumTransformation:d,preferPE:k}=a;if(b.equals(c))return{points:a}=T(a,null),a;if(b.isWebMercator&&
c.isWGS84||b.isWGS84&&c.isWebMercator){{const {cols:l,rows:m,xres:n,yres:p,usePixelCenter:t,inSR:r,outSR:u}=a;let {xmin:v,ymax:q}=a;t&&(v+=n/2,q-=p/2);a=[];var g=[],f=Math.max(l,m);for(var h=0;h<f;h++){var e=C.project(new B({x:v+n*Math.min(l,h),y:q-p*Math.min(m,h),spatialReference:r}),u);h<=l&&a.push(e.x);h<=m&&g.push(e.y)}f=[];for(h=0;h<l;h++)for(e=0;e<m;e++)f.push([a[h],g[e]]);a=f}return a}if(H(b,c,d)&&k){if(b.isGeographic)return aa(a);g=J(b);if(x.isSome(g))return aa(a)}return ma(a)}function ma(a){var {points:b}=
T(a,null);b=b.map(c=>new B(c[0],c[1],a.inSR));return C.project(b,a.outSR,a.datumTransformation).map(c=>c?[c.x,c.y]:[NaN,NaN])}function aa(a){const {inSR:b,outSR:c,datumTransformation:d}=a,k=J(b),{points:g,mask:f}=T(a,k);b.isGeographic||(a=b.wkid?w.PeFactory.coordsys(b.wkid):w.PeFactory.fromString(b.isGeographic?w.PeDefs.PE_TYPE_GEOGCS:w.PeDefs.PE_TYPE_PROJCS,b.wkt),w.PeCSTransformations.projToGeog(a,g.length,g));x.isSome(d)&&d.steps.length&&d.steps.forEach(h=>{const e=h.wkid?w.PeFactory.geogtran(h.wkid):
w.PeFactory.fromString(w.PeDefs.PE_TYPE_GEOGTRAN,h.wkt);w.PeGTTransformations.geogToGeog(e,g.length,g,null,h.isInverse?w.PeDefs.PE_TRANSFORM_2_TO_1:w.PeDefs.PE_TRANSFORM_1_TO_2)});c.isGeographic||(a=J(c,!0),a=x.isSome(a)&&a.isEnvelope?[a.bbox[1],a.bbox[3]]:[-90,90],na(g,a),a=c.wkid?w.PeFactory.coordsys(c.wkid):w.PeFactory.fromString(c.isGeographic?w.PeDefs.PE_TYPE_GEOGCS:w.PeDefs.PE_TYPE_PROJCS,c.wkt),w.PeCSTransformations.geogToProj(a,g.length,g));a=g;if(f&&g.length!==f.length){a=[];for(let h=0,
e=0;h<f.length;h++)f[h]?a.push(g[e++]):a.push([NaN,NaN])}return a}function J(a,b=!1){var c=a.wkid||a.wkt;if(!c||a.isGeographic)return null;c=String(c);if(U.has(c))return c=U.get(c),b?null==c?void 0:c.gcs:null==c?void 0:c.pcs;var d=a.wkid?w.PeFactory.coordsys(a.wkid):w.PeFactory.fromString(a.isGeographic?w.PeDefs.PE_TYPE_GEOGCS:w.PeDefs.PE_TYPE_PROJCS,a.wkt);a=F(a,1E-4);a=ba(d,a);d=ba(d,0,!0);U.set(c,{pcs:a,gcs:d});return b?d:a}function ba(a,b=0,c=!1){var d=w.PePCSInfo.generate(a),k=c?a.horizonGcsGenerate():
a.horizonPcsGenerate();if(null==k||!k.length)return null;c=!1;a=k.find(l=>1===l.getInclusive()&&1===l.getKind());if(!a){a=k.find(l=>1===l.getInclusive()&&0===l.getKind());if(!a)return null;c=!0}d=d.isPannableRectangle();a=a.getCoord();if(c)return{isEnvelope:c,isPannable:d,vertices:a,coef:null,bbox:[a[0][0]-b,a[0][1]-b,a[1][0]+b,a[1][1]+b]};b=0;c=[];let [g,f]=a[0],[h,e]=a[0];for(let l=0,m=a.length;l<m;l++){b++;b===m&&(b=0);const [n,p]=a[l],[t,r]=a[b];if(r===p)c.push([n,t,p,r,2]);else{k=(t-n)/(r-p||
1E-4);const u=n-k*p;p<r?c.push([k,u,p,r,0]):c.push([k,u,r,p,1])}g=g<n?g:n;f=f<p?f:p;h=h>n?h:n;e=e>p?e:p}return{isEnvelope:!1,isPannable:d,vertices:a,coef:c,bbox:[g,f,h,e]}}function T(a,b){const c=[],{cols:d,rows:k,xres:g,yres:f,usePixelCenter:h}=a;let {xmin:e,ymax:l}=a;h&&(e+=g/2,l-=f/2);if(!x.isSome(b)){for(a=0;a<d;a++)for(b=0;b<k;b++)c.push([e+g*a,l-f*b]);return{points:c}}a=new Uint8Array(d*k);if(b.isEnvelope){const {bbox:[v,q,A,D]}=b;for(let G=0,M=0;G<d;G++){var m=e+g*G,n=b.isPannable||m>=v&&m<=
A;for(var p=0;p<k;p++,M++){var t=l-f*p;n&&t>=q&&t<=D&&(c.push([m,t]),a[M]=1)}}return{points:c,mask:a}}({coef:m}=b);b=[];for(n=0;n<k;n++){var r=l-f*n;p=[];t=[];for(var u=0;u<m.length;u++){const [v,q,A,D,G]=m[u];r===A&&A===D?(p.push(v),p.push(q),t.push(2),t.push(2)):r>=A&&r<=D&&(p.push(v*r+q),t.push(G))}r=p;if(2<p.length){u=2===t[0]?0:t[0];let v=p[0];r=[];for(let q=1;q<t.length;q++)if(2!==t[q]||q===t.length-1)t[q]!==u&&(r.push(0===u?Math.min(v,p[q-1]):Math.max(v,p[q-1])),u=t[q],v=p[q]),q===t.length-
1&&r.push(0===t[q]?Math.min(v,p[q]):Math.max(v,p[q]));r.sort((q,A)=>q-A)}else p[0]>p[1]&&(r=[p[1],p[0]]);b.push(r)}for(let v=0,q=0;v<d;v++)for(m=e+g*v,n=0;n<k;n++,q++)if(p=l-f*n,t=b[n],2===t.length)m>=t[0]&&m<=t[1]&&(c.push([m,p]),a[q]=1);else if(2<t.length){r=!1;for(u=0;u<t.length;u+=2)if(m>=t[u]&&m<=t[u+1]){r=!0;break}r&&(c.push([m,p]),a[q]=1)}return{points:c,mask:a}}function na(a,b){const [c,d]=b;for(b=0;b<a.length;b++){const k=a[b][1];if(k<c||k>d)a[b]=[NaN,NaN]}}function ca(a){const b=E(a[0].spatialReference);
if(2>a.length||!x.isSome(b))return a[0];let {xmin:c,xmax:d,ymin:k,ymax:g}=a[0];for(let f=1;f<a.length;f++){const h=a[f];d=h.xmax+b*f;k=Math.min(k,h.ymin);g=Math.max(g,h.ymax)}return new O({xmin:c,xmax:d,ymin:k,ymax:g,spatialReference:a[0].spatialReference})}function V(a,b,c=null,d=!0){if(a.spatialReference.equals(b))return a;const k=da(a),g=E(a.spatialReference,!0);var f=E(b);if(0===k||x.isNone(g)||x.isNone(f))return ea(a,b,c,d);f=a.clone().normalize();if(1===f.length&&a.xmax<g&&a.xmax-g/2>F(a.spatialReference)){const {xmin:h,
xmax:e}=a;for(let l=0;l<=k;l++)f[l]=new O({xmin:0===l?h:-g/2,xmax:l===k?e-g*l:g/2,ymin:a.ymin,ymax:a.ymax,spatialReference:a.spatialReference})}a=f.map(h=>ea(h,b,c,d));return ca(a.filter(h=>!!h))}function ea(a,b,c=null,d=!0,k=!0){const g=a.spatialReference;if(g.equals(b))return a;H(g,b,c);const f=C.project(a,b,c);if(k&&b.isWebMercator&&f&&(f.ymax=Math.min(2.0037508342787E7,f.ymax),f.ymin=Math.max(-2.0037508342787E7,f.ymin),f.ymin>=f.ymax))return null;if(!d||!f)return f;var h=L(g,!0);d=L(b,!0);if(x.isNone(h)||
x.isNone(d))return f;k=F(g,.001);const e=F(g,500);var l=F(b,.001);if(Math.abs(f.xmin-d[0])<l&&Math.abs(f.xmax-d[1])<l){l=Math.abs(a.xmin-h[0]);h=Math.abs(h[1]-a.xmax);if(l<k&&h>e){f.xmin=d[0];var m=[];m.push(new B(a.xmax,a.ymin,g));m.push(new B(a.xmax,(a.ymin+a.ymax)/2,g));m.push(new B(a.xmax,a.ymax,g));m=m.map(n=>S(n,b,c)).filter(n=>!isNaN(null==n?void 0:n.x)).map(n=>n.x);f.xmax=Math.max.apply(null,m)}h<k&&l>e&&(f.xmax=d[1],d=[],d.push(new B(a.xmin,a.ymin,g)),d.push(new B(a.xmin,(a.ymin+a.ymax)/
2,g)),d.push(new B(a.xmin,a.ymax,g)),a=d.map(n=>S(n,b,c)).filter(n=>!isNaN(null==n?void 0:n.x)).map(n=>n.x),f.xmin=Math.min.apply(null,a))}else a=F(b,.001),Math.abs(f.xmin-d[0])<a&&(f.xmin=d[0]),Math.abs(f.xmax-d[1])<a&&(f.xmax=d[1]);return f}function E(a,b=!1){return a.isWebMercator?2*(b?2.0037508342787E7:2.0037508342788905E7):a.wkid&&a.isGeographic?360:2*oa[a.wkid]||null}function L(a,b=!1){if(a.isGeographic)return[-180,180];a=E(a,b);return x.isSome(a)?[-a/2,a/2]:null}function fa(a,b,c,d){a=(a-b)/
c;0!==a-Math.floor(a)?a=Math.floor(a):d&&--a;return a}function da(a,b=!1){var c=E(a.spatialReference);if(!x.isSome(c))return 0;const d=b?0:-(c/2),k=F(a.spatialReference),g=!b&&Math.abs(a.xmin+c/2)<k?-c/2:a.xmin;a=fa(!b&&Math.abs(a.xmax-c/2)<k?c/2:a.xmax,d,c,!0);c=fa(g,d,c,!1);return a-c}function W(a){const {projectedExtent:b,srcBufferExtent:c,pixelSize:d,datumTransformation:k,rasterTransform:g}=a;var f=b.spatialReference;const h=c.spatialReference;H(f,h);const {xmin:e,ymin:l,xmax:m,ymax:n}=b,p=E(h),
t=x.isSome(p)&&(a.hasWrapAround||"gcs-shift"===(null==g?void 0:g.type));a=a.spacing||[32,32];var r=a[0]*d.x,u=a[1]*d.y;const v=1===a[0],q=Math.ceil((m-e)/r-.1/a[0])+(v?0:1),A=Math.ceil((n-l)/u-.1/a[1])+(v?0:1);f=Z({cols:q,rows:A,xmin:e,ymax:n,xres:r,yres:u,inSR:f,outSR:h,datumTransformation:k,preferPE:4>=a[0],usePixelCenter:v});r=[];let D;u=0;const G=v?-1:NaN,{xmin:M,xmax:pa,ymax:qa,width:ra,height:sa}=c,ta=F(h,500);for(let N=0;N<q;N++){const X=[];for(let K=0;K<A;K++){var y=f[N*A+K];t&&y[0]>pa&&y[0]>
p/2-ta&&(y[0]-=p);!y||isNaN(y[0])||isNaN(y[1])?(r.push(G),r.push(G),X.push(null),u++):(g&&(y=g.inverseTransform(new B({x:y[0],y:y[1],spatialReference:h})),y=[y.x,y.y]),X.push(y),0<N&&t&&D[K]&&y[0]<D[K][0]&&(y[0]+=p),r.push((y[0]-M)/ra),r.push((qa-y[1])/sa))}D=X}return{offsets:r,error:null,coefficients:null,outofBoundPointCount:u,spacing:a,size:v?[q,A]:[q-1,A-1]}}function ha(a,b,c){const {cols:d,rows:k}=b;b=new Float32Array((d-1)*(k-1)*12);const g=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),f=new Float32Array([-1,
1,0,0,-1,1,1,0,0]);for(let p=0;p<d-1;p++){for(var h=0;h<k-1;h++){var e=p*k*2+2*h,l=a[e];const t=a[e+1];var m=a[e+2],n=a[e+3];e+=2*k;const r=a[e],u=a[e+1],v=a[e+2];e=a[e+3];let q=0,A=12*(h*(d-1)+p);for(let D=0;3>D;D++)b[A++]=g[q++]*l+g[q++]*m+g[q++]*v;q=0;for(m=0;3>m;m++)b[A++]=g[q++]*t+g[q++]*n+g[q++]*e;q=0;for(n=0;3>n;n++)b[A++]=f[q++]*l+f[q++]*r+f[q++]*v;q=0;for(l=0;3>l;l++)b[A++]=f[q++]*t+f[q++]*u+f[q++]*e}if(c)for(h=0;h<b.length;h++)isNaN(b[h])&&(b[h]=-1)}return b}const ia=function(a,b,c,d=0){if(1===
c[0])return[0,0];var k=1,g=-1,f=1,h=-1;for(var e=0;e<a.length;e+=2)isNaN(a[e])||(k=k>a[e]?a[e]:k,g=g>a[e]?g:a[e],f=f>a[e+1]?a[e+1]:f,h=h>a[e+1]?h:a[e+1]);const {cols:l,rows:m}=b;b=(g-k)/l/c[0];c=(h-f)/m/c[1];d*=2;f=0;h=!1;k=[0,0];for(g=0;g<l-3;g++){for(e=0;e<m-3;e++){var n=g*m*2+2*e;const p=Math.abs(((a[n]+a[n+4]+a[n+4*m]+a[n+4*m+4])/4-a[n+2*m+2])/b);n=Math.abs(((a[n+1]+a[n+5]+a[n+4*m+1]+a[n+4*m+5])/4-a[n+2*m+3])/c);p+n>f&&(f=p+n,k=[p,n]);if(d&&f>d){h=!0;break}}if(h)break}return k},oa={3395:2.0037508342789244E7,
3410:1.7334193943686873E7,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53034:2.001508679602057E7,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,
54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54034:2.0037508342789244E7,54079:2.0037508342789244E7,54080:2.0037508342789244E7,54100:2.0037508342789244E7,54101:2.0037508342789244E7},U=new Map,Y=new Map;z.computeProjectedScales=function(a,b,c=512,d=!0){const {extent:k,spatialReference:g,pixelSize:f}=a,h=R(new B({x:f.x,y:f.y,spatialReference:g}),b,k);if(null==h)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};var e=(h.x+h.y)/2,
l=I.getMetersPerUnitForSR(b);e=e*l*96*39.37;const m=b.isGeographic?256/c*2.958287637958547E8:256/c*5.91657527591555E8;c="vector-magdir"===a.dataType||"vector-uv"===a.dataType;const n=V(k,b);c||d&&(b.isGeographic||b.isWebMercator)&&(c=0>n.xmin*n.xmax);d=e;if(c)d=m,a=b.isGeographic?1.341104507446289E-6:.29858214164761665,l=96*a*l*39.37,b=R(new B({x:a,y:a,spatialReference:{wkid:b.isGeographic?4326:3857}}),g,n),b.x*=d/l,b.y*=d/l;else{b={x:f.x,y:f.y};a=Math.ceil(Math.log(Math.min(a.width,a.height)/32)/
Math.LN2);for(l=0;d<.5005*m&&l<a;)l++,d*=2,b.x*=2,b.y*=2;1.001>=Math.max(d,m)/Math.min(d,m)&&(d=m)}a=[d];l=[{x:b.x,y:b.y}];for(e=Math.min(70.5310735,e)/1.001;d>=e;)d/=2,b.x/=2,b.y/=2,a.push(d),l.push({x:b.x,y:b.y});return{projectedPixelSize:h,scales:a,srcResolutions:l,isCustomTilingScheme:!c}};z.defaultGridSpacing=32;z.defaultProjectionToleranceInPixels=4;z.getDefaultDatumTransformationForDataset=function(a,b,c){return H(a.spatialReference,b)?c?C.getTransformation(b,a.spatialReference,a):C.getTransformation(a.spatialReference,
b,a):null};z.getProjectedGridPoints=Z;z.getProjectionOffsetGrid=function(a){var b=a.isAdaptive&&null==a.spacing;let c=a.spacing||[32,32],d=W(a);var k={cols:d.size[0]+1,rows:d.size[1]+1};const g=0<d.outofBoundPointCount&&d.outofBoundPointCount<d.offsets.length/2;let f=d.outofBoundPointCount===d.offsets.length/2||b&&g?[0,0]:ia(d.offsets,k,c,4);const h=(f[0]+f[1])/2;var e=a.projectedExtent.spatialReference;const l=a.srcBufferExtent.spatialReference;b&&(g||4<h)&&(P(e,l,a.datumTransformation)&&(e.isGeographic||
x.isSome(J(e))),c=[4,4],d=W({...a,spacing:c}),k={cols:d.size[0]+1,rows:d.size[1]+1},f=ia(d.offsets,k,c,4));d.error=f;1<c[0]&&(d.coefficients=ha(d.offsets,k,g));!a.includeGCSGrid||e.isGeographic||e.isWebMercator||(l.isGeographic?d.gcsGrid={offsets:d.offsets,coefficients:d.coefficients,spacing:c}:(b=J(e),x.isSome(b)&&!b.isEnvelope&&(e&&!e.isGeographic&&(b=String(e.wkid||e.wkt),Y.has(b)?e=Y.get(b):(e=(e.wkid?w.PeFactory.coordsys(e.wkid):w.PeFactory.fromString(w.PeDefs.PE_TYPE_PROJCS,e.wkt)).getGeogcs().getCode(),
Y.set(b,e)),e=new la({wkid:e})),e=V(a.projectedExtent,e),{offsets:a}=W({...a,srcBufferExtent:e,spacing:c}),k=ha(a,k,g),d.gcsGrid={offsets:a,coefficients:k,spacing:c})));return d};z.getRasterDatasetAlignmentInfo=function(a){const b=a.storageInfo.origin.x;var c=E(a.spatialReference,!0);if(!x.isSome(c))return{originX:b,halfWorldWidth:null,pyramidsInfo:null};const d=c/2,{nativePixelSize:k,storageInfo:g,extent:f}=a,{maximumPyramidLevel:h,blockWidth:e,pyramidScalingFactor:l}=g;let m=k.x;const n=[];a=x.isSome(a.transform)&&
"gcs-shift"===a.transform.type;const p=b+(a?0:d);c=a?c-b:d-b;for(let t=0;t<=h;t++){const r=(f.xmax-b)/m/e,u=c/m/e;n.push({resolutionX:m,blockWidth:e,datsetColumnCount:0===r-Math.floor(r)?r:Math.ceil(r),worldColumnCountFromOrigin:0===u-Math.floor(u)?u:Math.ceil(u),leftMargin:Math.round(p/m)%e,rightPadding:(e-Math.round(c/m)%e)%e,originColumnOffset:Math.floor(p/m/e)});m*=l}return{originX:b,halfWorldWidth:d,pyramidsInfo:n,hasGCSSShiftTransform:a}};z.getWorldWidth=E;z.getWorldWrapCount=da;z.load=function(){return Q.apply(this,
arguments)};z.minimumGridSpacing=4;z.projectExtent=V;z.projectPoint=S;z.projectResolution=R;z.requirePE=P;z.snapExtent=function(a){a=a.clone().normalize();return 1===a.length?a[0]:ca(a)};z.snapPyramid=function(a,b,c){const {storageInfo:d,pixelSize:k}=b;let g=!1;var {pyramidResolutions:f}=d;if(x.isSome(f)&&f.length){a=(a.x+a.y)/2;var h=f[f.length-1];h=(h.x+h.y)/2;var e=(k.x+k.y)/2;if(a<=e)var l=0;else if(a>=h)l=f.length,g=8<a/h;else{h=e;for(let m=1;m<=f.length;m++){e=(f[m-1].x+f[m-1].y)/2;if(a<=e){a===
e?l=m:"down"===c?(l=m-1,g=8<a/h):l="up"===c?m:a-h>e-a||2<a/h?m:m-1;break}h=e}}c=0===l?k:f[l-1];return{pyramidLevel:l,pyramidResolution:new B({x:c.x,y:c.y,spatialReference:b.spatialReference}),excessiveReading:g}}l=Math.log(a.x/k.x)/Math.LN2;a=Math.log(a.y/k.y)/Math.LN2;f=b.storageInfo.maximumPyramidLevel||0;l="down"===c?Math.floor(Math.min(l,a)):"up"===c?Math.ceil(Math.max(l,a)):Math.round((l+a)/2);0>l?l=0:l>f&&(g=l>f+3,l=f);c=2**l;b=new B({x:c*b.nativePixelSize.x,y:c*b.nativePixelSize.y,spatialReference:b.spatialReference});
return{pyramidLevel:l,pyramidResolution:b,excessiveReading:g}};Object.defineProperty(z,"__esModule",{value:!0})});