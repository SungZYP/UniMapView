// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/maybe ./checkWebGLError ./context-util ./enums ./ShaderTranspiler".split(" "),function(r,w,t,n,p,q,m,u){function h(g,e){if(n.isNone(g)||g.length!==e.length)return!0;for(let b=0;b<g.length;++b)if(g[b]!==e[b])return!0;return!1}function v(g,e,b){const a=g.gl,c=a.createShader(e);a.shaderSource(c,b);a.compileShader(c);p.webglValidateShadersEnabled()&&!a.getShaderParameter(c,a.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===
m.ShaderType.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(a.getShaderInfoLog(c)),console.error(x(b)),g.type===q.ContextType.WEBGL2&&(console.log("Shader source before transpilation:"),console.log(b)));return c}function x(g){let e=2;return g.replace(/\n/g,()=>{var b=e++;b=1E3<=b?b.toString():("  "+b).slice(-3);return"\n"+b+":"})}function k(g,e){for(let b=0;b<g.length;++b)e[b]=g[b]}t=function(){function g(b,a,c,d,f=new Map){this._context=b;this._locations=d;this._uniformBlockBindings=
f;this._refCount=1;this._compiled=!1;this._nameToUniformLocation={};this._nameToUniform1={};this._nameToUniform1v={};this._nameToUniform2={};this._nameToUniform3={};this._nameToUniform4={};this._nameToUniformMatrix3={};this._nameToUniformMatrix4={};b||console.error("RenderingContext isn't initialized!");0===a.length&&console.error("Shaders source should not be empty!");this._context.type===q.ContextType.WEBGL2&&(a=u.transpileShader(a,m.ShaderType.VERTEX_SHADER),c=u.transpileShader(c,m.ShaderType.FRAGMENT_SHADER));
this._vShader=v(this._context,m.ShaderType.VERTEX_SHADER,a);this._fShader=v(this._context,m.ShaderType.FRAGMENT_SHADER,c);this._vShader&&this._fShader||console.error("Error loading shaders!");this._context.instanceCounter.increment(m.ResourceType.Shader,this);p.webglValidateShadersEnabled()&&(this.vertexShader=a,this.fragmentShader=c)}var e=g.prototype;e.dispose=function(){if(!(0<--this._refCount)){var b=this._context.gl;this._vShader&&(b.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(m.ResourceType.Shader,
this));this._fShader&&(b.deleteShader(this._fShader),this._fShader=null);this._glName&&(b.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(m.ResourceType.Program,this))}};e.ref=function(){++this._refCount};e._getUniformLocation=function(b){void 0===this._nameToUniformLocation[b]&&(this._nameToUniformLocation[b]=this._context.gl.getUniformLocation(this.glName,b));return this._nameToUniformLocation[b]};e.hasUniform=function(b){return null!==this._getUniformLocation(b)};
e.setUniform1i=function(b,a){const c=this._nameToUniform1[b];if(void 0===c||a!==c)this._context.gl.uniform1i(this._getUniformLocation(b),a),this._nameToUniform1[b]=a};e.setUniform1iv=function(b,a){const c=this._nameToUniform1v[b];h(c,a)&&(this._context.gl.uniform1iv(this._getUniformLocation(b),a),void 0===c?this._nameToUniform1v[b]=Array.from(a):k(a,c))};e.setUniform2iv=function(b,a){const c=this._nameToUniform2[b];h(c,a)&&(this._context.gl.uniform2iv(this._getUniformLocation(b),a),void 0===c?this._nameToUniform2[b]=
Array.from(a):k(a,c))};e.setUniform3iv=function(b,a){const c=this._nameToUniform3[b];h(c,a)&&(this._context.gl.uniform3iv(this._getUniformLocation(b),a),void 0===c?this._nameToUniform3[b]=Array.from(a):k(a,c))};e.setUniform4iv=function(b,a){const c=this._nameToUniform4[b];h(c,a)&&(this._context.gl.uniform4iv(this._getUniformLocation(b),a),void 0===c?this._nameToUniform4[b]=Array.from(a):k(a,c))};e.setUniform1f=function(b,a){const c=this._nameToUniform1[b];if(void 0===c||a!==c)this._context.gl.uniform1f(this._getUniformLocation(b),
a),this._nameToUniform1[b]=a};e.setUniform1fv=function(b,a){const c=this._nameToUniform1v[b];h(c,a)&&(this._context.gl.uniform1fv(this._getUniformLocation(b),a),void 0===c?this._nameToUniform1v[b]=Array.from(a):k(a,c))};e.setUniform2f=function(b,a,c){const d=this._nameToUniform2[b];if(void 0===d||a!==d[0]||c!==d[1])this._context.gl.uniform2f(this._getUniformLocation(b),a,c),void 0===d?this._nameToUniform2[b]=[a,c]:(d[0]=a,d[1]=c)};e.setUniform2fv=function(b,a){const c=this._nameToUniform2[b];h(c,
a)&&(this._context.gl.uniform2fv(this._getUniformLocation(b),a),void 0===c?this._nameToUniform2[b]=Array.from(a):k(a,c))};e.setUniform3f=function(b,a,c,d){const f=this._nameToUniform3[b];if(void 0===f||a!==f[0]||c!==f[1]||d!==f[2])this._context.gl.uniform3f(this._getUniformLocation(b),a,c,d),void 0===f?this._nameToUniform3[b]=[a,c,d]:(f[0]=a,f[1]=c,f[2]=d)};e.setUniform3fv=function(b,a){const c=this._nameToUniform3[b];h(c,a)&&(this._context.gl.uniform3fv(this._getUniformLocation(b),a),void 0===c?
this._nameToUniform3[b]=Array.from(a):k(a,c))};e.setUniform4f=function(b,a,c,d,f){const l=this._nameToUniform4[b];if(void 0===l||a!==l[0]||c!==l[1]||d!==l[2]||f!==l[3])this._context.gl.uniform4f(this._getUniformLocation(b),a,c,d,f),void 0===l?this._nameToUniform4[b]=[a,c,d,f]:(l[0]=a,l[1]=c,l[2]=d,l[3]=f)};e.setUniform4fv=function(b,a){const c=this._nameToUniform4[b];h(c,a)&&(this._context.gl.uniform4fv(this._getUniformLocation(b),a),void 0===c?this._nameToUniform4[b]=Array.from(a):k(a,c))};e.setUniformMatrix3fv=
function(b,a,c=!1){const d=this._nameToUniformMatrix3[b];var f=n.isNone(d)?!0:9!==d.length?h(d,a):9!==d.length||d[0]!==a[0]||d[1]!==a[1]||d[2]!==a[2]||d[3]!==a[3]||d[4]!==a[4]||d[5]!==a[5]||d[6]!==a[6]||d[7]!==a[7]||d[8]!==a[8];f&&(this._context.gl.uniformMatrix3fv(this._getUniformLocation(b),c,a),void 0===d?this._nameToUniformMatrix3[b]=Array.from(a):k(a,d))};e.setUniformMatrix4fv=function(b,a,c=!1){const d=this._nameToUniformMatrix4[b];var f=n.isNone(d)?!0:16!==d.length?h(d,a):16!==d.length||d[0]!==
a[0]||d[1]!==a[1]||d[2]!==a[2]||d[3]!==a[3]||d[4]!==a[4]||d[5]!==a[5]||d[6]!==a[6]||d[7]!==a[7]||d[8]!==a[8]||d[9]!==a[9]||d[10]!==a[10]||d[11]!==a[11]||d[12]!==a[12]||d[13]!==a[13]||d[14]!==a[14]||d[15]!==a[15];f&&(this._context.gl.uniformMatrix4fv(this._getUniformLocation(b),c,a),void 0===d?this._nameToUniformMatrix4[b]=Array.from(a):k(a,d))};e.stop=function(){};w._createClass(g,[{key:"glName",get:function(){if(n.isSome(this._glName))return this._glName;if(n.isNone(this._vShader))return null;const b=
this._context.gl,a=b.createProgram();b.attachShader(a,this._vShader);b.attachShader(a,this._fShader);this._locations.forEach((c,d)=>b.bindAttribLocation(a,c,d));b.linkProgram(a);p.webglValidateShadersEnabled()&&!b.getProgramParameter(a,b.LINK_STATUS)&&console.error("Could not link shader\n"+`validated: ${b.getProgramParameter(a,b.VALIDATE_STATUS)}`+`, gl error ${b.getError()}`+`, vertex: ${b.getShaderParameter(this._vShader,b.COMPILE_STATUS)}`+`, fragment: ${b.getShaderParameter(this._fShader,b.COMPILE_STATUS)}`+
`, info log: ${b.getProgramInfoLog(a)}`+`, vertex source: ${this.vertexShader}`+`, fragment source: ${this.fragmentShader}`);if(this._context.type===q.ContextType.WEBGL2)for(const [c,d]of this._uniformBlockBindings){const f=b.getUniformBlockIndex(a,c);4294967295>f&&b.uniformBlockBinding(a,f,d)}this._glName=a;this._context.instanceCounter.increment(m.ResourceType.Program,this);return a}},{key:"hasGLName",get:function(){return n.isSome(this._glName)}},{key:"isCompiled",get:function(){if(this._compiled)return!0;
const b=this._context.gl.getExtension("KHR_parallel_shader_compile");return null==b?this._compiled=!0:this._compiled=!!this._context.gl.getProgramParameter(this.glName,b.COMPLETION_STATUS_KHR)}}]);return g}();r.Program=t;Object.defineProperty(r,"__esModule",{value:!0})});