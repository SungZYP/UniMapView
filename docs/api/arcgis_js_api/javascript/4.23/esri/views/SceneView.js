// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/iteratorUtils":function(){define(["exports"],function(a){a.cache=function(b){const c=[];return function*(){yield*c;for(const g of b)c.push(g),yield g}};a.find=function(b,c){for(const g of b)if(null!=g&&c(g))return g};a.isIterable=function(b){return null!=b&&"function"===typeof b[Symbol.iterator]};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/boundedPlane":function(){define("exports ../core/has ../core/Logger ../core/mathUtils ../core/ObjectStack ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/support/Axis ../geometry/support/lineSegment ../geometry/support/plane ../geometry/support/ray ../geometry/support/vector ../geometry/support/vectorStacks".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v){function q(ba=da){return{plane:d.create(ba.plane),origin:l.clone(ba.origin),basis1:l.clone(ba.basis1),basis2:l.clone(ba.basis2)}}function t(ba,Z,ha){const na=la.get();na.origin=ba;na.basis1=Z;na.basis2=ha;na.plane=d.wrap(0,0,0,0);E(na);return na}function r(ba,Z=q()){return u(ba.origin,ba.basis1,ba.basis2,Z)}function x(ba,Z){f.copy(Z.origin,ba.origin);f.copy(Z.basis1,ba.basis1);f.copy(Z.basis2,ba.basis2);d.copy(Z.plane,ba.plane)}function u(ba,Z,ha,na=q()){f.copy(na.origin,
ba);f.copy(na.basis1,Z);f.copy(na.basis2,ha);E(na);1E-6<Math.abs(f.dot(na.basis1,na.basis2)/(f.length(na.basis1)*f.length(na.basis2)))&&aa.warn("fromValues()","Provided basis vectors are not perpendicular");1E-6<Math.abs(f.dot(na.basis1,S(na)))&&aa.warn("fromValues()","Basis vectors and plane normal are not perpendicular");1E-6<Math.abs(-f.dot(S(na),na.origin)-na.plane[3])&&aa.warn("fromValues()","Plane offset is not consistent with plane origin");return na}function E(ba){d.fromVectorsAndPoint(ba.basis2,
ba.basis1,ba.origin,ba.plane)}function y(ba,Z,ha){ba!==ha&&r(ba,ha);ba=f.scale(v.sv3d.get(),S(ba),Z);f.add(ha.origin,ha.origin,ba);ha.plane[3]-=Z;return ha}function A(ba,Z,ha){p(Z,ha);y(ha,Q(ba,ba.origin),ha);return ha}function p(ba,Z=q()){const ha=(ba[2]-ba[0])/2,na=(ba[3]-ba[1])/2;f.set(Z.origin,ba[0]+ha,ba[1]+na,0);f.set(Z.basis1,ha,0,0);f.set(Z.basis2,0,na,0);d.fromValues(0,0,1,0,Z.plane);return Z}function B(ba,Z,ha){return d.intersectRay(ba.plane,Z,ha)?T(ba,ha):!1}function D(ba,Z,ha){if(B(ba,
Z,ha))return ha;ba=C(ba,Z,v.sv3d.get());f.add(ha,Z.origin,f.scale(v.sv3d.get(),Z.direction,f.distance(Z.origin,ba)/f.length(Z.direction)));return ha}function C(ba,Z,ha){const na=Y.get();var pa=Y.get();U(ba,Z,na,pa);pa=Number.POSITIVE_INFINITY;for(const Da of ia){var xa=W(ba,Da,ea.get());const ua=v.sv3d.get();d.intersectLineSegment(na,xa,ua)&&(xa=f.direction(v.sv3d.get(),Z.origin,ua),xa=Math.abs(g.acosClamped(f.dot(Z.direction,xa))),xa<pa&&(pa=xa,f.copy(ha,ua)))}return pa===Number.POSITIVE_INFINITY?
F(ba,Z,ha):ha}function F(ba,Z,ha){if(B(ba,Z,ha))return ha;const na=Y.get(),pa=Y.get();U(ba,Z,na,pa);let xa=Number.POSITIVE_INFINITY;for(const ua of ia){var Da=W(ba,ua,ea.get());const Fa=v.sv3d.get();d.intersectLineSegmentClamp(na,Da,Fa)&&(Da=m.distance2(Z,Fa),d.isPointInside(pa,Fa)&&Da<xa&&(xa=Da,f.copy(ha,Fa)))}H(ba,Z.origin)<xa&&G(ba,Z.origin,ha);return ha}function G(ba,Z,ha){var na=d.projectPoint(ba.plane,Z,v.sv3d.get());Z=e.projectPointClamp(V(ba,ba.basis1),na,-1,1,v.sv3d.get());na=e.projectPointClamp(V(ba,
ba.basis2),na,-1,1,v.sv3d.get());f.subtract(ha,f.add(v.sv3d.get(),Z,na),ba.origin);return ha}function L(ba,Z,ha){const {origin:na,basis1:pa,basis2:xa}=ba,Da=f.subtract(v.sv3d.get(),Z,na);Z=z.projectPointSignedLength(pa,Da);const ua=z.projectPointSignedLength(xa,Da);ba=z.projectPointSignedLength(S(ba),Da);return f.set(ha,Z,ua,ba)}function H(ba,Z){Z=L(ba,Z,v.sv3d.get());const {basis1:ha,basis2:na}=ba;ba=f.length(ha);var pa=f.length(na);ba=Math.max(Math.abs(Z[0])-ba,0);pa=Math.max(Math.abs(Z[1])-pa,
0);Z=Z[2];return ba*ba+pa*pa+Z*Z}function M(ba,Z){return Math.sqrt(H(ba,Z))}function K(ba,Z){let ha=Number.NEGATIVE_INFINITY;for(const pa of ia){var na=W(ba,pa,ea.get());na=e.distance2(na,Z);na>ha&&(ha=na)}return Math.sqrt(ha)}function I(ba,Z){return d.isPointInside(ba.plane,Z)&&T(ba,Z)}function O(ba,Z,ha,na){switch(ha){case k.Axis.X:f.copy(na,ba.basis1);f.normalize(na,na);break;case k.Axis.Y:f.copy(na,ba.basis2);f.normalize(na,na);break;case k.Axis.Z:f.copy(na,S(ba))}return na}function Q(ba,Z){const ha=
-ba.plane[3];return z.projectPointSignedLength(S(ba),Z)-ha}function J(ba,Z,ha,na){const pa=Q(ba,Z);ba=f.scale(ja,S(ba),ha-pa);f.add(na,Z,ba);return na}function P(ba,Z){return f.exactEquals(ba.basis1,Z.basis1)&&f.exactEquals(ba.basis2,Z.basis2)&&f.exactEquals(ba.origin,Z.origin)}function N(ba,Z,ha){ba!==ha&&r(ba,ha);w.invert(ca,Z);w.transpose(ca,ca);f.transformMat4(ha.basis1,ba.basis1,ca);f.transformMat4(ha.basis2,ba.basis2,ca);f.transformMat4(d.normal(ha.plane),d.normal(ba.plane),ca);f.transformMat4(ha.origin,
ba.origin,Z);d.setOffsetFromPoint(ha.plane,ha.plane,ha.origin);return ha}function R(ba,Z,ha,na){ba!==na&&r(ba,na);w.fromRotation(fa,Z,ha);f.transformMat4(na.basis1,ba.basis1,fa);f.transformMat4(na.basis2,ba.basis2,fa);E(na);return na}function S(ba){return d.normal(ba.plane)}function T(ba,Z){const ha=f.subtract(v.sv3d.get(),Z,ba.origin);Z=f.squaredLength(ba.basis1);const na=f.squaredLength(ba.basis2),pa=f.dot(ba.basis1,ha);ba=f.dot(ba.basis2,ha);return 0>-pa-Z&&0>pa-Z&&0>-ba-na&&0>ba-na}function V(ba,
Z){const ha=ea.get();f.copy(ha.origin,ba.origin);f.copy(ha.vector,Z);return ha}function W(ba,Z,ha){const {basis1:na,basis2:pa,origin:xa}=ba;ba=f.scale(v.sv3d.get(),na,Z.origin[0]);const Da=f.scale(v.sv3d.get(),pa,Z.origin[1]);f.add(ha.origin,ba,Da);f.add(ha.origin,ha.origin,xa);ba=f.scale(v.sv3d.get(),na,Z.direction[0]);Z=f.scale(v.sv3d.get(),pa,Z.direction[1]);f.scale(ha.vector,f.add(ba,ba,Z),2);return ha}function U(ba,Z,ha,na){ba=S(ba);d.fromVectorsAndPoint(ba,Z.direction,Z.origin,ha);d.fromVectorsAndPoint(d.normal(ha),
ba,Z.origin,na)}const aa=c.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");b=function(){this.plane=d.create();this.origin=l.create();this.basis1=l.create();this.basis2=l.create()};const da={plane:d.create(),origin:l.fromValues(0,0,0),basis1:l.fromValues(1,0,0),basis2:l.fromValues(0,1,0)},Y=new h.ObjectStack(d.create),ea=new h.ObjectStack(e.create),ja=l.create(),la=new h.ObjectStack(()=>({origin:null,basis1:null,basis2:null,plane:null})),ia=[{origin:[-1,-1],direction:[1,0]},{origin:[1,
-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],ca=n.create(),fa=n.create();h=Object.freeze({__proto__:null,BoundedPlaneClass:b,create:q,wrap:t,copy:r,copyWithoutVerify:x,fromValues:u,updateUnboundedPlane:E,elevate:y,setExtent:A,fromAABoundingRect:p,intersectRay:B,intersectRayClosestSilhouette:D,closestPointOnSilhouette:C,closestPoint:F,projectPoint:G,projectPointLocal:L,distance2:H,distance:M,distanceToSilhouette:K,extrusionContainsPoint:I,axisAt:O,altitudeAt:Q,
setAltitudeAt:J,equals:P,transform:N,rotate:R,normal:S,UP:da});a.BoundedPlaneClass=b;a.UP=da;a.altitudeAt=Q;a.axisAt=O;a.boundedPlane=h;a.closestPoint=F;a.closestPointOnSilhouette=C;a.copy=r;a.copyWithoutVerify=x;a.create=q;a.distance=M;a.distance2=H;a.distanceToSilhouette=K;a.elevate=y;a.equals=P;a.extrusionContainsPoint=I;a.fromAABoundingRect=p;a.fromValues=u;a.intersectRay=B;a.intersectRayClosestSilhouette=D;a.normal=S;a.projectPoint=G;a.projectPointLocal=L;a.rotate=R;a.setAltitudeAt=J;a.setExtent=
A;a.transform=N;a.updateUnboundedPlane=E;a.wrap=t})},"esri/core/ObjectStack":function(){define(["exports","./nextTick"],function(a,b){let c=function(){function g(w){this.allocator=w;this._items=[];this._itemsPtr=0;this._grow()}var h=g.prototype;h.get=function(){0===this._itemsPtr&&b.nextTick(()=>this._reset());this._itemsPtr===this._items.length&&this._grow();return this._items[this._itemsPtr++]};h._reset=function(){this._items.length=Math.min(Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+
3072),this._items.length);this._itemsPtr=0};h._grow=function(){for(let w=0;w<Math.max(8,Math.min(this._items.length,1024));w++)this._items.push(this.allocator())};return g}();a.ObjectStack=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/mat4f64":function(){define(["exports"],function(a){function b(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function c(f){return[f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8],f[9],f[10],f[11],f[12],f[13],f[14],f[15]]}function g(f,l,k,e,d,m,z,v,q,t,r,
x,u,E,y,A){return[f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A]}function h(f,l){return new Float64Array(f,l,16)}const w=b(),n=Object.freeze({__proto__:null,create:b,clone:c,fromValues:g,createView:h,IDENTITY:w});a.IDENTITY=w;a.clone=c;a.create=b;a.createView=h;a.fromValues=g;a.mat4f64=n})},"esri/geometry/support/Axis":function(){define(["exports"],function(a){a.Axis=void 0;var b=a.Axis||(a.Axis={});b[b.X=0]="X";b[b.Y=1]="Y";b[b.Z=2]="Z";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/lineSegment":function(){define("exports ../../core/mathUtils ../../core/ObjectStack ../../chunks/vec3 ../../chunks/vec3f64 ./vectorStacks".split(" "),
function(a,b,c,g,h,w){function n(v){return v?{origin:h.clone(v.origin),vector:h.clone(v.vector)}:{origin:h.create(),vector:h.create()}}function f(v,q){const t=z.get();t.origin=v;t.vector=q;return t}function l(v,q,t=n()){g.copy(t.origin,v);g.copy(t.vector,q);return t}function k(v,q){q=g.subtract(w.sv3d.get(),q,v.origin);var t=g.dot(v.vector,q);const r=g.dot(v.vector,v.vector);t=b.clamp(t/r,0,1);v=g.subtract(w.sv3d.get(),g.scale(w.sv3d.get(),v.vector,t),q);return g.dot(v,v)}function e(v,q,t,r,x){const {vector:u,
origin:E}=v;q=g.subtract(w.sv3d.get(),q,E);q=g.dot(u,q)/g.squaredLength(u);g.scale(x,u,b.clamp(q,t,r));return g.add(x,x,v.origin)}function d(v,q,t,r){const x=v.origin;var u=g.add(w.sv3d.get(),x,v.vector);v=q.origin;var E=g.add(w.sv3d.get(),v,q.vector),y=w.sv3d.get();q=w.sv3d.get();y[0]=x[0]-v[0];y[1]=x[1]-v[1];y[2]=x[2]-v[2];q[0]=E[0]-v[0];q[1]=E[1]-v[1];q[2]=E[2]-v[2];if(1E-6>Math.abs(q[0])&&1E-6>Math.abs(q[1])&&1E-6>Math.abs(q[2]))return!1;E=w.sv3d.get();E[0]=u[0]-x[0];E[1]=u[1]-x[1];E[2]=u[2]-
x[2];if(1E-6>Math.abs(E[0])&&1E-6>Math.abs(E[1])&&1E-6>Math.abs(E[2]))return!1;u=y[0]*q[0]+y[1]*q[1]+y[2]*q[2];var A=q[0]*E[0]+q[1]*E[1]+q[2]*E[2];const p=q[0]*q[0]+q[1]*q[1]+q[2]*q[2],B=(E[0]*E[0]+E[1]*E[1]+E[2]*E[2])*p-A*A;if(1E-6>Math.abs(B))return!1;y=(u*A-(y[0]*E[0]+y[1]*E[1]+y[2]*E[2])*p)/B;u=(u+A*y)/p;t&&(y=b.clamp(y,0,1),u=b.clamp(u,0,1));t=w.sv3d.get();A=w.sv3d.get();t[0]=x[0]+y*E[0];t[1]=x[1]+y*E[1];t[2]=x[2]+y*E[2];A[0]=v[0]+u*q[0];A[1]=v[1]+u*q[1];A[2]=v[2]+u*q[2];r.tA=y;r.tB=u;r.pA=t;
r.pB=A;r.distance2=g.squaredDistance(t,A);return!0}const m={tA:0,tB:0,pA:h.create(),pB:h.create(),distance2:0},z=new c.ObjectStack(()=>({origin:null,vector:null}));a.closestLineSegmentDistance2=function(v,q){return d(v,q,!0,m)?m.distance2:null};a.closestLineSegmentPoint=function(v,q,t){return d(v,q,!0,m)?(g.copy(t,m.pA),!0):!1};a.closestRayDistance2=function(v,q){if(d(v,f(q.origin,q.direction),!1,m)){const {tA:t,pB:r,distance2:x}=m;if(0<=t&&1>=t)return x;if(0>t)return g.squaredDistance(v.origin,r);
if(1<t)return g.squaredDistance(g.add(w.sv3d.get(),v.origin,v.vector),r)}return null};a.copy=function(v,q=n()){return l(v.origin,v.vector,q)};a.create=n;a.distance=function(v,q){return Math.sqrt(k(v,q))};a.distance2=k;a.fromPoints=function(v,q,t=n()){g.copy(t.origin,v);g.subtract(t.vector,q,v);return t};a.fromValues=l;a.pointAt=function(v,q,t){return g.add(t,v.origin,g.scale(t,v.vector,q))};a.projectPoint=function(v,q,t){return e(v,q,0,1,t)};a.projectPointClamp=e;a.wrap=f;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/geometry/support/vectorStacks":function(){define(["exports","../../core/VectorStack"],function(a,b){const c=b.VectorStack.createVec2f64(),g=b.VectorStack.createVec3f64(),h=b.VectorStack.createVec4f64(),w=b.VectorStack.createMat3f64(),n=b.VectorStack.createMat4f64();b=b.VectorStack.createQuatf64();a.sm3d=w;a.sm4d=n;a.sq4d=b;a.sv2d=c;a.sv3d=g;a.sv4d=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/VectorStack":function(){define("exports ../chunks/_rollupPluginBabelHelpers ./byteSizeEstimations ./nextTick ../chunks/mat3f64 ../chunks/mat4f64 ../chunks/quatf64 ../chunks/vec2f64 ../chunks/vec3f64 ../chunks/vec4f64".split(" "),
function(a,b,c,g,h,w,n,f,l,k){let e=function(){function m(v,q,t){this.itemByteSize=v;this.itemCreate=q;this._buffers=[];this._items=[];this._itemsPtr=0;this._itemsPerBuffer=Math.ceil(t/this.itemByteSize)}var z=m.prototype;z.get=function(){0===this._itemsPtr&&g.nextTick(()=>this._reset());const v=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=v;){const q=new ArrayBuffer(this._itemsPerBuffer*this.itemByteSize);for(let t=0;t<this._itemsPerBuffer;++t)this._items.push(this.itemCreate(q,
t*this.itemByteSize));this._buffers.push(q)}return this._items[this._itemsPtr++]};z._reset=function(){const v=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>v;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0};m.createVec2f64=function(v=d){return new m(16,f.createView,v)};m.createVec3f64=function(v=d){return new m(24,l.createView,v)};m.createVec4f64=function(v=d){return new m(32,k.createView,v)};m.createMat3f64=function(v=
d){return new m(72,h.createView,v)};m.createMat4f64=function(v=d){return new m(128,w.createView,v)};m.createQuatf64=function(v=d){return new m(32,n.createView,v)};b._createClass(m,[{key:"test",get:function(){return{size:this._buffers.length*this._itemsPerBuffer*this.itemByteSize}}}]);return m}();const d=4*c.ByteSizeUnit.KILOBYTES;a.VectorStack=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/byteSizeEstimations":function(){define(["exports"],function(a){function b(c){return 32+c.length}
a.ByteSizeUnit=void 0;(function(c){c[c.KILOBYTES=1024]="KILOBYTES";c[c.MEGABYTES=1048576]="MEGABYTES";c[c.GIGABYTES=1073741824]="GIGABYTES"})(a.ByteSizeUnit||(a.ByteSizeUnit={}));a.estimateAttributesObjectSize=function(c){if(!c)return 0;let g=32;for(const h in c)if(c.hasOwnProperty(h)){const w=c[h];switch(typeof w){case "string":g+=b(w);break;case "number":g+=16;break;case "boolean":g+=4}}return g};a.estimateFixedArraySize=function(c,g){return 32+c.length*g};a.estimateNumberByteSize=function(){return 16};
a.estimateStringByteSize=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/mat3f64":function(){define(["exports"],function(a){function b(){return[1,0,0,0,1,0,0,0,1]}function c(n){return[n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8]]}function g(n,f,l,k,e,d,m,z,v){return[n,f,l,k,e,d,m,z,v]}function h(n,f){return new Float64Array(n,f,9)}const w=Object.freeze({__proto__:null,create:b,clone:c,fromValues:g,createView:h});a.clone=c;a.create=b;a.createView=h;a.fromValues=g;a.mat3f64=w})},
"esri/chunks/quatf64":function(){define(["exports"],function(a){function b(){return[0,0,0,1]}function c(f){return[f[0],f[1],f[2],f[3]]}function g(f,l,k,e){return[f,l,k,e]}function h(f,l){return new Float64Array(f,l,4)}const w=b(),n=Object.freeze({__proto__:null,create:b,clone:c,fromValues:g,createView:h,IDENTITY:w});a.IDENTITY=w;a.clone=c;a.create=b;a.createView=h;a.fromValues=g;a.quatf64=n})},"esri/chunks/vec2f64":function(){define(["exports"],function(a){function b(){return[0,0]}function c(q){return[q[0],
q[1]]}function g(q,t){return[q,t]}function h(q){const t=[0,0],r=Math.min(2,q.length);for(let x=0;x<r;++x)t[x]=q[x];return t}function w(q,t){return new Float64Array(q,t,2)}function n(){return[0,0]}function f(){return[1,1]}function l(){return[1,0]}function k(){return[0,1]}const e=[0,0],d=[1,1],m=[1,0],z=[0,1],v=Object.freeze({__proto__:null,create:b,clone:c,fromValues:g,fromArray:h,createView:w,zeros:n,ones:f,unitX:l,unitY:k,ZEROS:e,ONES:d,UNIT_X:m,UNIT_Y:z});a.ONES=d;a.UNIT_X=m;a.UNIT_Y=z;a.ZEROS=
e;a.clone=c;a.create=b;a.createView=w;a.fromArray=h;a.fromValues=g;a.ones=f;a.unitX=l;a.unitY=k;a.vec2f64=v;a.zeros=n})},"esri/chunks/vec4f64":function(){define(["exports"],function(a){function b(){return[0,0,0,0]}function c(u){return[u[0],u[1],u[2],u[3]]}function g(u,E,y,A){return[u,E,y,A]}function h(u){const E=b(),y=Math.min(4,u.length);for(let A=0;A<y;++A)E[A]=u[A];return E}function w(u,E){return new Float64Array(u,E,4)}function n(){return b()}function f(){return[1,1,1,1]}function l(){return[1,
0,0,0]}function k(){return[0,1,0,0]}function e(){return[0,0,1,0]}function d(){return[0,0,0,1]}const m=b(),z=f(),v=l(),q=k(),t=e(),r=d(),x=Object.freeze({__proto__:null,create:b,clone:c,fromValues:g,fromArray:h,createView:w,zeros:n,ones:f,unitX:l,unitY:k,unitZ:e,unitW:d,ZEROS:m,ONES:z,UNIT_X:v,UNIT_Y:q,UNIT_Z:t,UNIT_W:r});a.ONES=z;a.UNIT_W=r;a.UNIT_X=v;a.UNIT_Y=q;a.UNIT_Z=t;a.ZEROS=m;a.clone=c;a.create=b;a.createView=w;a.fromArray=h;a.fromValues=g;a.ones=f;a.unitW=d;a.unitX=l;a.unitY=k;a.unitZ=e;a.vec4f64=
x;a.zeros=n})},"esri/geometry/support/plane":function(){define("exports ../../core/mathUtils ../../core/maybe ../../chunks/vec3 ../../chunks/vec3f64 ../../chunks/sphere ./vectorStacks".split(" "),function(a,b,c,g,h,w,n){function f(D=y){return[D[0],D[1],D[2],D[3]]}function l(D,C){return k(C[0],C[1],C[2],C[3],D)}function k(D,C,F,G,L=f()){L[0]=D;L[1]=C;L[2]=F;L[3]=G;return L}function e(D,C,F){var G=C[0]*C[0]+C[1]*C[1]+C[2]*C[2];G=1E-5<Math.abs(G-1)&&1E-12<G?1/Math.sqrt(G):1;F[0]=C[0]*G;F[1]=C[1]*G;F[2]=
C[2]*G;F[3]=-(F[0]*D[0]+F[1]*D[1]+F[2]*D[2]);return F}function d(D,C,F,G=f()){var L=F[0]-C[0],H=F[1]-C[1],M=F[2]-C[2];F=D[0]-C[0];const K=D[1]-C[1],I=D[2]-C[2];C=H*I-M*K;M=M*F-L*I;L=L*K-H*F;H=C*C+M*M+L*L;H=1E-5<Math.abs(H-1)&&1E-12<H?1/Math.sqrt(H):1;G[0]=C*H;G[1]=M*H;G[2]=L*H;G[3]=-(G[0]*D[0]+G[1]*D[1]+G[2]*D[2])}function m(D,C,F,G,L){if(3>D.count)return!1;D.getVec(F,t);let H=G,M=!1;for(;H<D.count-1&&!M;)D.getVec(H,r),H++,M=!g.exactEquals(t,r);if(!M)return!1;H=Math.max(H,L);for(M=!1;H<D.count&&!M;)D.getVec(H,
x),H++,g.subtract(u,t,r),g.normalize(u,u),g.subtract(E,r,x),g.normalize(E,E),M=!g.exactEquals(t,x)&&!g.exactEquals(r,x)&&.99619469809>Math.abs(g.dot(u,E));if(!M)return 0===F&&1===G&&2===L?!1:m(D,C,0,1,2);d(t,r,x,C);return!0}function z(D,C,F){D=g.scale(n.sv3d.get(),D,g.dot(D,C));g.subtract(F,C,D);return F}function v(D,C){return g.dot(D,C)+D[3]}function q(D,C,F,G,L){const H=g.dot(D,F);if(0===H)return!1;D=-(g.dot(D,C)+D[3])/H;G&A.CLAMP&&(D=b.clamp(D,0,1));if(!(G&A.INFINITE_MIN)&&0>D||!(G&A.INFINITE_MAX)&&
1<D)return!1;g.add(L,C,g.scale(L,F,D));return!0}const t=h.create(),r=h.create(),x=h.create(),u=h.create(),E=h.create(),y=[0,0,1,0];var A;(function(D){D[D.NONE=0]="NONE";D[D.CLAMP=1]="CLAMP";D[D.INFINITE_MIN=4]="INFINITE_MIN";D[D.INFINITE_MAX=8]="INFINITE_MAX"})(A||(A={}));const p=A.INFINITE_MIN|A.INFINITE_MAX,B=A.INFINITE_MAX;a.UP=y;a.clip=function(D,C){const F=g.dot(D,C.ray.direction);D=-v(D,C.ray.origin);if(0>D&&0<=F)return!1;if(-1E-6<F&&1E-6>F)return 0<D;if((0>D||0>F)&&!(0>D&&0>F))return!0;D/=
F;0<F?D<C.c1&&(C.c1=D):D>C.c0&&(C.c0=D);return C.c0<=C.c1};a.clipInfinite=function(D,C){const F=g.dot(D,C.ray.direction);D=-v(D,C.ray.origin);if(-1E-6<F&&1E-6>F)return 0<D;D/=F;0<F?D<C.c1&&(C.c1=D):D>C.c0&&(C.c0=D);return C.c0<=C.c1};a.copy=l;a.create=f;a.distance=function(D,C){return Math.abs(v(D,C))};a.fromManyPoints=function(D,C){return m(D,C,0,1,2)};a.fromManyPointsSampleAt=m;a.fromNormalAndOffset=function(D,C,F){g.copy(F,D);F[3]=C;return F};a.fromPoints=d;a.fromPositionAndNormal=e;a.fromValues=
k;a.fromVectorsAndPoint=function(D,C,F,G){g.cross(x,C,D);return e(F,x,G)};a.intersectLine=function(D,C,F,G){F=g.subtract(n.sv3d.get(),F,C);return q(D,C,F,p,G)};a.intersectLineSegment=function(D,C,F){return q(D,C.origin,C.vector,A.NONE,F)};a.intersectLineSegmentClamp=function(D,C,F){return q(D,C.origin,C.vector,A.CLAMP,F)};a.intersectRay=function(D,C,F){return c.isSome(C)?q(D,C.origin,C.direction,B,F):!1};a.isAABBFullyInside=function(D,C){const F=C[0],G=C[1],L=C[2],H=C[3],M=C[4];C=C[5];return 0<=D[0]*
(0<D[0]?F:H)+D[1]*(0<D[1]?G:M)+D[2]*(0<D[2]?L:C)+D[3]};a.isPointInside=function(D,C){return 0<=v(D,C)};a.isPointOutside=function(D,C){return 0>v(D,C)};a.isSphereFullyInside=function(D,C){return 0<=v(D,w.getCenter(C))-C[3]};a.isSphereFullyOutside=function(D,C){return 0>v(D,w.getCenter(C))+C[3]};a.negate=function(D,C){C[0]=-D[0];C[1]=-D[1];C[2]=-D[2];C[3]=-D[3];return C};a.normal=function(D){return D};a.projectPoint=function(D,C,F){const G=g.scale(n.sv3d.get(),D,-D[3]);C=g.subtract(n.sv3d.get(),C,G);
D=z(D,C,n.sv3d.get());g.add(F,D,G);return F};a.projectVector=z;a.setOffsetFromPoint=function(D,C,F){C!==D&&l(D,C);D[3]=-g.dot(D,F);return D};a.signedDistance=v;a.wrap=function(D,C,F,G){return k(D,C,F,G,n.sv4d.get())};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/sphere":function(){define("exports ../core/has ../core/Logger ../core/mathUtils ../core/maybe ./mat4 ./vec3 ./vec3f64 ./vec4 ./vec4f64 ../geometry/support/Axis ../geometry/support/ray ../geometry/support/vector ../geometry/support/vectorStacks".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z){function v(){return k.create()}function q(T,V=v()){return l.copy(V,T)}function t(T,V){return k.fromValues(T[0],T[1],T[2],V)}function r(T){return T}function x(T){T[0]=T[1]=T[2]=T[3]=0}function u(T){return T}function E(T){return Array.isArray(T)?T[3]:T}function y(T){return Array.isArray(T)?T:R}function A(T,V,W,U){return k.fromValues(T,V,W,U)}function p(T,V,W){T!==W&&n.copy(W,T);W[3]=T[3]+V;return W}function B(T,V,W){J.error("sphere.setExtent is not yet supported");
return T===W?W:q(T,W)}function D(T,V,W){if(h.isNone(V))return!1;const {origin:U,direction:aa}=V;var da=P;da[0]=U[0]-T[0];da[1]=U[1]-T[1];da[2]=U[2]-T[2];V=aa[0]*aa[0]+aa[1]*aa[1]+aa[2]*aa[2];const Y=2*(aa[0]*da[0]+aa[1]*da[1]+aa[2]*da[2]);T=Y*Y-4*V*(da[0]*da[0]+da[1]*da[1]+da[2]*da[2]-T[3]*T[3]);if(0>T)return!1;da=Math.sqrt(T);T=(-Y-da)/(2*V);V=(-Y+da)/(2*V);if(0>T||V<T&&0<V)T=V;if(0>T)return!1;W&&(W[0]=U[0]+aa[0]*T,W[1]=U[1]+aa[1]*T,W[2]=U[2]+aa[2]*T);return!0}function C(T,V){return D(T,V,null)}
function F(T,V,W){if(D(T,V,W))return W;T=G(T,V,z.sv3d.get());n.add(W,V.origin,n.scale(z.sv3d.get(),V.direction,n.distance(V.origin,T)/n.length(V.direction)));return W}function G(T,V,W){const U=z.sv3d.get(),aa=z.sm4d.get();n.cross(U,V.origin,V.direction);const da=E(T);n.cross(W,U,V.origin);n.scale(W,W,1/n.length(W)*da);T=K(T,V.origin);V=m.angle(V.origin,W);w.fromRotation(aa,V+T,U);n.transformMat4(W,W,aa);return W}function L(T,V,W){if(D(T,V,W))return W;d.closestPoint(V,y(T),W);return H(T,W,W)}function H(T,
V,W){V=n.subtract(z.sv3d.get(),V,y(T));V=n.scale(z.sv3d.get(),V,T[3]/n.length(V));return n.add(W,V,y(T))}function M(T,V){V=n.subtract(z.sv3d.get(),V,y(T));V=n.squaredLength(V);return Math.sqrt(Math.abs(V-T[3]*T[3]))}function K(T,V){V=n.subtract(z.sv3d.get(),V,y(T));V=n.length(V);T=E(T);return g.acosClamped(T/(T+Math.abs(T-V)))}function I(T,V,W,U){T=n.subtract(N,V,y(T));switch(W){case e.Axis.X:return W=g.cartesianToSpherical(T,N)[2],n.set(U,-Math.sin(W),Math.cos(W),0);case e.Axis.Y:return T=g.cartesianToSpherical(T,
N),W=T[1],T=T[2],V=Math.sin(W),n.set(U,-V*Math.cos(T),-V*Math.sin(T),Math.cos(W));case e.Axis.Z:return n.normalize(U,T)}}function O(T,V){V=n.subtract(S,V,y(T));return n.length(V)-T[3]}function Q(T,V,W,U){const aa=O(T,V);T=I(T,V,e.Axis.Z,S);W=n.scale(S,T,W-aa);return n.add(U,V,W)}const J=c.getLogger("esri.geometry.support.sphere"),P=f.create(),N=f.create(),R=f.create(),S=f.create();b=Object.freeze({__proto__:null,create:v,copy:q,fromCenterAndRadius:t,wrap:r,clear:x,fromRadius:u,getRadius:E,getCenter:y,
fromValues:A,elevate:p,setExtent:B,intersectRay:D,intersectsRay:C,intersectRayClosestSilhouette:F,closestPointOnSilhouette:G,closestPoint:L,projectPoint:H,distanceToSilhouette:M,angleToSilhouette:K,axisAt:I,altitudeAt:O,setAltitudeAt:Q});a.altitudeAt=O;a.angleToSilhouette=K;a.axisAt=I;a.clear=x;a.closestPoint=L;a.closestPointOnSilhouette=G;a.copy=q;a.create=v;a.distanceToSilhouette=M;a.elevate=p;a.fromCenterAndRadius=t;a.fromRadius=u;a.fromValues=A;a.getCenter=y;a.getRadius=E;a.intersectRay=D;a.intersectRayClosestSilhouette=
F;a.intersectsRay=C;a.projectPoint=H;a.setAltitudeAt=Q;a.setExtent=B;a.sphere=b;a.wrap=r})},"esri/geometry/support/ray":function(){define("exports ../../core/arrayUtils ../../core/ObjectStack ../../chunks/vec3 ../../chunks/vec3f64 ./vectorStacks".split(" "),function(a,b,c,g,h,w){function n(e){return e?{origin:h.clone(e.origin),direction:h.clone(e.direction)}:{origin:h.create(),direction:h.create()}}function f(e,d,m=n()){g.copy(m.origin,e);g.copy(m.direction,d);return m}function l(e,d){e=g.cross(w.sv3d.get(),
g.normalize(w.sv3d.get(),e.direction),g.subtract(w.sv3d.get(),d,e.origin));return g.dot(e,e)}const k=new c.ObjectStack(function(){return{origin:null,direction:null}});a.closestPoint=function(e,d,m){d=g.dot(e.direction,g.subtract(m,d,e.origin));g.add(m,e.origin,g.scale(m,e.direction,d));return m};a.copy=function(e,d=n()){return f(e.origin,e.direction,d)};a.create=n;a.distance=function(e,d){return Math.sqrt(l(e,d))};a.distance2=l;a.equals=function(e,d){return b.equals(e.origin,d.origin)&&b.equals(e.direction,
d.direction)};a.fromPoints=function(e,d,m=n()){g.copy(m.origin,e);g.subtract(m.direction,d,e);return m};a.fromValues=f;a.wrap=function(e,d){const m=k.get();m.origin=e;m.direction=d;return m};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/vector":function(){define(["exports","../../core/mathUtils","../../chunks/vec3","../../chunks/vec3f64"],function(a,b,c,g){const h=g.create(),w=g.create();a.angle=function(n,f){n=c.dot(n,f)/(c.length(n)*c.length(f));return-b.acosClamped(n)};
a.angleAroundAxis=function(n,f,l){c.normalize(h,n);c.normalize(w,f);n=c.dot(h,w);n=b.acosClamped(n);f=c.cross(h,h,w);return 0>c.dot(f,l)?2*Math.PI-n:n};a.projectPoint=function(n,f,l){f=c.dot(n,f)/c.dot(n,n);return c.scale(l,n,f)};a.projectPointSignedLength=function(n,f){return c.dot(n,f)/c.length(n)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/coordinateSystem":function(){define("exports ../../chunks/mat4 ../../chunks/vec3 ../../chunks/vec3f64 ../projectionEllipsoid ../SpatialReference ./Axis ../../chunks/boundedPlane ../../chunks/sphere".split(" "),
function(a,b,c,g,h,w,n,f,l){function k(t){return{operations:t,value:t.create()}}function e(t,r,x=k(t)){x.operations=t;t.copy(r,x.value);return x}function d(t,r,x,u){return t.operations.setAltitudeAt(t.value,r,x,u)}const m=2**50,z=g.create(),v={operations:null,value:null},q=g.create();a.altitudeAt=function(t,r){return t.operations.altitudeAt(t.value,r)};a.axisAt=function(t,r,x,u){return t.operations.axisAt(t.value,r,x,u)};a.closestPoint=function(t,r,x){return t.operations.closestPoint(t.value,r,x)};
a.closestPointOnSilhouette=function(t,r,x){return t.operations.closestPointOnSilhouette(t.value,r,x)};a.coordinateSystemFromOneAxisAndNormalVector=function(t,r,x,u,E){c.copy(x,t);c.copy(q,r);c.normalize(q,q);c.cross(u,q,x);c.cross(E,u,x)};a.create=function(t){const {value:r,operations:x}=t;return{operations:x,value:x.create(r)}};a.createFromOperations=k;a.createGlobal=function(t){return e(l.sphere,l.fromValues(0,0,0,h.getReferenceEllipsoid(t).radius))};a.createLocal=function(){return e(f.boundedPlane,
f.fromValues([0,0,0],[m,0,0],[0,m,0]))};a.distanceToSilhouette=function(t,r){return t.operations.distanceToSilhouette(t.value,r)};a.elevate=function(t,r,x){return t.operations.elevate(t.value,r,x.value)};a.fromValues=e;a.intersectRay=function(t,r,x){return t.operations.intersectRay(t.value,r,x)};a.intersectRayClosestSilhouette=function(t,r,x){return t.operations.intersectRayClosestSilhouette(t.value,r,x)};a.intersectsRay=function(t,r){return t.operations.intersectRay(t.value,r,null)};a.normalAt=function(t,
r,x){return t.operations.axisAt(t.value,r,n.Axis.Z,x)};a.renderSRFromViewSR=function(t,r){return t?h.getSphericalPCPF(r):r.isGeographic?w.PlateCarree:r};a.setAltitudeAt=d;a.setAltitudeOfTransformation=function(t,r,x,u){r!==u&&b.copy(u,r);c.set(z,u[12],u[13],u[14]);d(t,z,x,z);u[12]=z[0];u[13]=z[1];u[14]=z[2];return u};a.setExtent=function(t,r,x){t.operations.setExtent(t.value,r,x.value);return x};a.vectorCoordinates=function(t,r,x,u,E){E[0]=c.dot(t,r);E[1]=c.dot(t,x);E[2]=c.dot(t,u);return E};a.wrap=
function(t,r){v.operations=t;v.value=r;return v};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/VoxelWasmManager":function(){define(["./VoxelWasmPerScene"],function(a){return function(){function b(){this.view2WASM=new Map}b.getInstance=function(){b.instance||(b.instance=new b);return b.instance};var c=b.prototype;c.getVoxelWasmPerSceneView=function(g){return this.view2WASM.has(g)?this.view2WASM.get(g):null};c.isUpdating=function(g,h){return this.view2WASM.has(g)?this.view2WASM.get(g).isUpdating(h):
!1};c.addLayer=function(g,h){this.view2WASM.has(g)||this.view2WASM.set(g,new a(g));return this.view2WASM.get(g).addVoxelLayer(h)};c.removeLayer=function(g,h){this.view2WASM.has(g)&&1>this.view2WASM.get(g).removeVoxelLayer(h)&&this.view2WASM.delete(g)};c.setLayerEnabled=function(g,h,w){this.view2WASM.has(g)&&this.view2WASM.get(g).setEnabled(h,w)};c.setLayerSlices=function(g,h){let w=!1;this.view2WASM.forEach((n,f)=>{f.allLayerViews.filter(l=>"voxel-3d"===l.type).forEach(l=>{l.layer===g&&(w=n.setSlices(l,
h))})});return w};c.setLayerDynamicSections=function(g,h){let w=!1;this.view2WASM.forEach((n,f)=>{f.allLayerViews.filter(l=>"voxel-3d"===l.type).forEach(l=>{l.layer===g&&(w=n.setDynamicSections(l,h))})});return w};c.setLayerCurrentVariable=function(g,h){let w=!1;this.view2WASM.forEach((n,f)=>{f.allLayerViews.filter(l=>"voxel-3d"===l.type).forEach(l=>{l.layer===g&&(w=n.setCurrentVariable(l,h))})});return w};c.setLayerRenderMode=function(g,h){let w=!1;this.view2WASM.forEach((n,f)=>{f.allLayerViews.filter(l=>
"voxel-3d"===l.type).forEach(l=>{l.layer===g&&(w=n.setRenderMode(l,h))})});return w};c.setLayerStaticSections=function(g,h){let w=!1;this.view2WASM.forEach((n,f)=>{f.allLayerViews.filter(l=>"voxel-3d"===l.type).forEach(l=>{l.layer===g&&(w=n.setStaticSections(l,h))})});return w};return b}()})},"esri/layers/VoxelWasmPerScene":function(){define("../chunks/_rollupPluginBabelHelpers ../request ../core/has ../core/Logger ../core/maybe ../core/promiseUtils ../core/reactiveUtils ../libs/vxl/enums ../libs/vxl/VxlModule ../views/3d/webgl-engine/lib/RenderPass ../views/3d/webgl-engine/lib/RenderSlot ../views/webgl/context-util ../views/webgl/enums".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m){const z=g.getLogger("esri.layers.VoxelWasmPerScene");var v;(function(q){q[q.Lifetime=1]="Lifetime";q[q.RequestResponse=2]="RequestResponse";q[q.Rendering=3]="Rendering";q[q.Error=4]="Error"})(v||(v={}));return function(){function q(r){this._havePreparedWithAllLayers=this._halfIntTexturesAvailable=!1;this._vxl=this._renderPluginContext=null;this._moreToLoad=this._pluginIsActive=!1;this._viewportHeight=this._viewportWidth=-1;this._newLayers=[];this._layers=new Map;
this._renderPass=k.RenderPass.MATERIAL;this._renderSlot=e.RenderSlot.VOXEL;this._renderTargetToRestore=this._rctx=null;this._lastFrameWasStationary=!1;this._wasmMemBlockSizes=[512,1024,2048,4096,8192,16384,32768,65536];this._wasmMemBlocks=new Map;this._dbgFlags=new Set;this._view=r;this._initialize()}var t=q.prototype;t._dbg=function(r,x){this._dbgFlags.has(r)&&(r===v.Error?z.error(x):z.warn(x))};t._removeRenderPlugin=function(){this._pluginIsActive&&this._view._stage&&(this._dbg(v.Lifetime,"--removeRenderPlugin--"),
this._view._stage.removeRenderPlugin(this));this._pluginIsActive=!1};t._initialize=function(){this._dbg(v.Lifetime,"--initialize--");for(const r of this._wasmMemBlockSizes)this._wasmMemBlocks.set(r,0);this._readyWatchHandle=n.watch(()=>this._view.ready,r=>{r&&"local"===this._view.viewingMode?(this._dbg(v.Lifetime,"view ready status changed to ready on a local view, calling addRenderPlugin"),this._view._stage.addRenderPlugin([this._renderSlot],this),this._pluginIsActive=!0):(this._dbg(v.Lifetime,"view ready status changed, not ready or not a local view!"),
this._removeRenderPlugin())},{initial:!0});this._qualityWatchHandle=n.watch(()=>{var r;return null==(r=this._view)?void 0:r.qualityProfile},r=>{this._dbg(v.Rendering,"qualityProfile changed to "+r);this._vxl&&this._vxl.set_quality(this._toWasmQuality(r))},{initial:!0});this._timeExtentWatchHandle=n.watch(()=>{var r;return null==(r=this._view)?void 0:r.timeExtent},()=>{if(this._vxl){var r;const x=this._getTimeArgs(null==(r=this._view)?void 0:r.timeExtent);this._dbg(v.Rendering,"sceneView timeExtent changed to useTime\x3d"+
x.useTime+" st\x3d"+x.startTime+" et\x3d"+x.endTime);this._vxl.set_scene_time_extent(x.startTime,x.endTime,x.useTime);this._renderPluginContext.requestRender()}},{initial:!0});this._stationaryWatchHandle=n.watch(()=>{var r;return null==(r=this._view)?void 0:r.stationary},r=>{this._vxl&&r&&!this._lastFrameWasStationary&&this._renderPluginContext.requestRender()})};t.initializeRenderContext=function(r){this._dbg(v.Lifetime,"--initializeRenderContext--");const x=r.renderContext.rctx;x.type===d.ContextType.WEBGL2?
(this._renderPluginContext=r,this._rctx=r.renderContext.rctx,this._halfIntTexturesAvailable=!!this._rctx.capabilities.textureNorm16,this._initializeWasm(x.gl)):this._dbg(v.Error,"WebGL 1 context only!")};t.uninitializeRenderContext=function(){this._rctx=this._renderPluginContext=null;this._dbg(v.Lifetime,"--uninitializeRenderContext--")};t._restoreFramebuffer=function(){if(this._renderTargetToRestore){var r=this._renderTargetToRestore.fbo;this._rctx?(this._rctx.bindFramebuffer(r,!0),r=this._renderTargetToRestore.viewport,
this._rctx.setViewport(r.x,r.y,r.width,r.height)):this._dbg(v.Error,"no context in restoreFramebuffer!")}};t._bindPreviousDepthToSlot=function(r,x){var u=!!this._renderTargetToRestore;if(!this._rctx||!u)return 0;u=this._renderTargetToRestore.fbo.depthStencilTexture;if(!u)return this._dbg(v.Error,"no depth/stencil texture exists!"),0;0===x?this._rctx.bindTexture(null,r,!0):this._rctx.bindTexture(u,r,!0);return 1};t._modifyResourceCount=function(r,x,u){this._rctx?1===u?this._rctx.instanceCounter.increment(r,
x):this._rctx.instanceCounter.decrement(r,x):this._dbg(v.Error,"modifyAllocation callback has no rendering context!")};t._setBlendState=function(r,x,u,E){this._rctx?(this._rctx.setBlendingEnabled(1===r),this._rctx.setBlendFunction(x,u),this._rctx.setBlendEquation(E)):this._dbg(v.Error,"setBlendState callback has no rendering context!")};t._setFrontFace=function(r){this._rctx?this._rctx.setFrontFace(r):this._dbg(v.Error,"setFrontFace callback has no rendering context!")};t._setDepthStencilStateFunction=
function(r,x,u){this._rctx?(this._rctx.setDepthFunction(u),this._rctx.setDepthTestEnabled(1===r),this._rctx.setDepthWriteEnabled(1===x),this._rctx.setStencilTestEnabled(!1),this._rctx.setStencilFunction(m.CompareFunction.ALWAYS,0,255),this._rctx.setStencilOpSeparate(m.Face.FRONT,m.StencilOperation.KEEP,m.StencilOperation.INCR,m.StencilOperation.KEEP),this._rctx.setStencilOpSeparate(m.Face.BACK,m.StencilOperation.KEEP,m.StencilOperation.DECR,m.StencilOperation.KEEP)):this._dbg(v.Error,"setDepthStencilStateFunction callback has no rendering context!")};
t._setRasterizerState=function(r){if(this._rctx)switch(r){case f.WasmCullMode.None:this._rctx.setFaceCullingEnabled(!1);break;case f.WasmCullMode.Back:this._rctx.setCullFace(m.Face.BACK);this._rctx.setFaceCullingEnabled(!0);break;case f.WasmCullMode.Front:this._rctx.setCullFace(m.Face.FRONT),this._rctx.setFaceCullingEnabled(!0)}else this._dbg(v.Error,"setRasterizerState callback has no rendering context!")};t._setViewport=function(r,x,u,E){this._rctx?this._rctx.setViewport(r,x,u,E):this._dbg(v.Error,
"setViewport callback has no rendering context!")};t._updateMemoryUsage=function(){this._layers.forEach((r,x)=>{r.needMemoryUsageUpdate&&(x=this._vxl.estimate_memory_usage(x),0<=x&&(r.needMemoryUsageUpdate=!1,r.layerView.setUsedMemory(x)))})};t._syncRequestsResponses=function(){this._layers.forEach((r,x)=>{const u=[];r.responses.forEach((p,B)=>{u.push(B);this._dbg(v.RequestResponse,"responding for requestID:"+B+" size:"+p.size);this._vxl.respond(x,B,p);if(p.requestType===f.VoxelRequestType.TreeIndex||
p.requestType===f.VoxelRequestType.Section)r.needMemoryUsageUpdate=!0});const E=r.responses;for(var y of u)E.delete(y);y=this._vxl.get_new_requests(x);const A=r.abortController.signal;for(const p in y){r.outstandingRequestCount+=1;1===r.outstandingRequestCount&&r.layerView.updatingFlagChanged();const B=y[p],D={responseType:"array-buffer",signal:A};this._dbg(v.RequestResponse,"making requestID:"+p+" url:"+B.url);b(B.url,D).then(C=>{--r.outstandingRequestCount;0===r.outstandingRequestCount&&r.layerView.updatingFlagChanged();
this._dbg(v.RequestResponse,"have response for requestID:"+p);let F=0;if(0<C.data.byteLength){F=this._vxl._malloc(C.data.byteLength);const G=new Uint8Array(this._vxl.HEAPU8.buffer,F,C.data.byteLength),L=new Uint8Array(C.data);for(let H=0;H<C.data.byteLength;++H)G[H]=L[H]}E.set(+p,{responseType:B.responseType,ptr:F,size:C.data.byteLength,success:!0,requestType:B.requestType})}).catch(C=>{--r.outstandingRequestCount;0===r.outstandingRequestCount&&r.layerView.updatingFlagChanged();w.isAbortError(C)||
(this._dbg(v.Error,`requestID:${p} failed, error=${C.toString()}`),E.set(+p,{responseType:B.responseType,ptr:0,size:0,success:!1,requestType:B.requestType}))})}})};t.updateWasmCamera=function(r){this._vxl.set_projection_matrix.apply(this._vxl,r.projectionMatrix);this._vxl.set_view_matrix.apply(this._vxl,r.viewMatrix);this._vxl.set_near_far(r.near,r.far)};t.isUpdating=function(r){return!this._vxl&&this._vxlPromise?!0:this._layers.has(r)?0<this._layers.get(r).outstandingRequestCount:!1};t.setEnabled=
function(r,x){this._layers.forEach((u,E)=>{u.layerView===r&&(this._vxl.set_enabled(E,x),this._renderPluginContext.requestRender())})};t.setSlices=function(r,x){return this._doMaskedUIUpdate(r,{mask:f.UpdateFlags.Slices,slices:{planes:x,currentEditPlane:-1}},!0)};t.setDynamicSections=function(r,x){return this._doMaskedUIUpdate(r,{mask:f.UpdateFlags.DynamicSections,dynamicSections:{planes:x,currentEditPlane:-1}},!0)};t.setStaticSections=function(r,x){return this._doMaskedUIUpdate(r,{mask:f.UpdateFlags.StaticSections,
staticSections:x},!0)};t.setCurrentVariable=function(r,x){return this._doMaskedUIUpdate(r,{mask:f.UpdateFlags.CurrentVariable,currentVariable:x},!0)};t.setRenderMode=function(r,x){return this._doMaskedUIUpdate(r,{mask:f.UpdateFlags.RenderMode,renderMode:x},!0)};t._doMaskedUIUpdate=function(r,x,u){if(!this._vxl)return!1;let E=!1;this._layers.forEach((y,A)=>{y.layerView===r&&(y={str:JSON.stringify(x),byteCount:0,ptr:0,isReusable:!1},this._allocateBlock(y)&&(E=1===this._vxl.handle_masked_ui_update(A,
y.ptr,y.byteCount)?!0:!1,y.isReusable||this._vxl._free(y.ptr)))});E&&u&&this._renderPluginContext.requestRender();return E};t.addVoxelLayer=function(r){if(!this._vxl){const x={layerView:r,resolveCallback:null,rejectCallback:null};r=new Promise((u,E)=>{x.resolveCallback=u;x.rejectCallback=E});this._newLayers.push(x);return r}r=this._addVoxelLayer(r);return 0>r?Promise.reject(-1):Promise.resolve(r)};t.removeVoxelLayer=function(r){if(!this._vxl){var x=this._newLayers.findIndex(E=>r===E.layerView);0<=
x&&(this._newLayers[x].resolveCallback(-1),this._newLayers.splice(x,1));x=this._newLayers.length;0===x&&(this._dbg(v.Lifetime," no voxel layers left after removing a layer, removing RenderPlugin and destroying"),this.destroy());return x}let u=-1;this._layers.forEach((E,y)=>{E.layerView===r&&(u=y,E.abortController.abort(),this._vxl.remove_layer(u))});0<=u&&this._layers.delete(u);x=this._layers.size;0===x&&(this._dbg(v.Lifetime," no voxel layers left after removing a layer, removing RenderPlugin and destroying"),
this.destroy());return x};t._getBlockSize=function(r){for(const x of this._wasmMemBlockSizes)if(r<x)return x;return-1};t._allocateBlock=function(r){r.byteCount=this._vxl.lengthBytesUTF8(r.str)+1;const x=this._getBlockSize(r.byteCount);0>x?(r.isReusable=!1,r.ptr=this._vxl._malloc(r.byteCount)):(r.isReusable=!0,r.ptr=this._wasmMemBlocks.get(x),0===r.ptr&&(r.ptr=this._vxl._malloc(x),this._wasmMemBlocks.set(x,r.ptr)));return 0!==r.ptr?(this._vxl.stringToUTF8(r.str,r.ptr,r.byteCount),!0):!1};t._getTimeArgs=
function(r){let x=-Number.MAX_VALUE,u=Number.MAX_VALUE,E=!1;h.isSome(r)&&(r.isAllTime?E=!0:(h.isSome(r.start)&&(E=!0,x=r.start.getTime()/1E3),h.isSome(r.end)&&(E=!0,u=r.end.getTime()/1E3)));return{startTime:x,endTime:u,useTime:E}};t._addVoxelLayer=function(r){var x,u=r.layer,E=-1;E=u.getConfiguration();if(1>E.length)return-1;const y={str:E,byteCount:0,ptr:0,isReusable:!1};if(!this._allocateBlock(y))return-1;E=this._getTimeArgs(null==(x=this._view)?void 0:x.timeExtent);x=this._view.spatialReference.isWGS84&&
u.spatialReference.isWGS84?111319.49079327357:1;E=this._vxl.add_layer(u.serviceRoot,y.ptr,y.byteCount,x,x,E.startTime,E.endTime,E.useTime,this._toWasmQuality(this._view.qualityProfile));y.isReusable||this._vxl._free(y.ptr);if(0<=E){u=new AbortController;this._layers.set(E,{layerView:r,responses:new Map,outstandingRequestCount:0,abortController:u,needMemoryUsageUpdate:!1});if(!this._halfIntTexturesAvailable||c("mac")){u=[];x="";for(const A of r.layer.variables)if("Int16"===A.renderingFormat.type||
"UInt16"===A.renderingFormat.type)u.push(A.name),A.id===r.layer.style.currentVariableId&&(x=A.name);""!==x&&z.error("#addVoxelLayer_error()",r.layer,`The voxel layer '${r.layer.title}' cannot render the current variable '${x}' in this browser`);0<u.length&&z.warn("#addVoxelLayer_warning()",r.layer,`The voxel layer '${r.layer.title}' cannot render the variables '${u.toString()}' in this browser`)}c("esri-mobile")&&z.warnOnce("Mobile support differs across devices. Voxel layer might not display as expected.");
return E}return-1};t.prepareRender=function(r){if(this._vxl){var x=r.viewForward;r=r.eye;this._vxl.update_camera_pos_and_direction(r[0],r[1],r[2],x[0],x[1],x[2]);x=this._vxl.cull();this._dbg(v.RequestResponse,"missingResourceCount\x3d"+x);this._moreToLoad=0<x;this._havePreparedWithAllLayers=0===this._newLayers.length;this._updateMemoryUsage()}};t.render=function(r){if(this._vxl&&r.pass===this._renderPass&&r.slot===this._renderSlot){for(var x of this._newLayers){const u=this._addVoxelLayer(x.layerView);
-1===u?x.rejectCallback(-1):x.resolveCallback(u)}this._newLayers=[];if(0===this._layers.size)this._dbg(v.Error,"No voxel layers but RenderPlugin instance is being asked to render!");else{this._renderTargetToRestore={fbo:this._rctx.getBoundFramebufferObject(),viewport:this._rctx.getViewport()};this._syncRequestsResponses();this._lastFrameWasStationary=this._view.stationary;this._rctx.setPolygonOffsetFillEnabled(!1);this._rctx.setScissorTestEnabled(!1);this._rctx.setColorMask(!0,!0,!0,!0);this._vxl.begin_color_frame(!this._view.stationary||
this._moreToLoad,r.scenelightingData.lightingMainDirection[0],r.scenelightingData.lightingMainDirection[1],r.scenelightingData.lightingMainDirection[2]);x=this._renderTargetToRestore.viewport;if(x.width!==this._viewportWidth||x.height!==this._viewportHeight)this._viewportWidth=x.width,this._viewportHeight=x.height,this._vxl.set_viewport(x.width,x.height),this._layers.forEach(u=>{u.needMemoryUsageUpdate=!0});0===x.x&&0===x.y||this._dbg(v.Error,"Unsupported viewport parameters detected!");this.updateWasmCamera(r.camera);
this._vxl.draw();this._renderTargetToRestore.fbo=null;r.rctx.externalTextureUnitUpdate(this._vxl.get_texture_units_bound_in_frame(),this._vxl.get_active_texture_unit());r.rctx.externalVertexArrayObjectUpdate();r.rctx.externalVertexBufferUpdate();this._rctx.externalProgramUpdate();(this._moreToLoad||!this._havePreparedWithAllLayers&&0<this._layers.size)&&this._renderPluginContext.requestRender()}}};t.destroy=function(){this._dbg(v.Lifetime,"--destroy--");this._removeRenderPlugin();this._readyWatchHandle=
h.removeMaybe(this._readyWatchHandle);this._qualityWatchHandle=h.removeMaybe(this._qualityWatchHandle);this._timeExtentWatchHandle=h.removeMaybe(this._timeExtentWatchHandle);this._stationaryWatchHandle=h.removeMaybe(this._stationaryWatchHandle);this._vxl&&(this._layers.forEach(r=>{r.abortController.abort()}),this._wasmMemBlocks.forEach(r=>{0!==r&&this._vxl._free(r)}),this._vxl.uninitialize_voxel_wasm(),this._vxl=null)};t._initializeWasm=function(r){if(this._vxl)return Promise.resolve();this._vxlPromise||
(this._vxlPromise=l.loadVoxelWASM(r).then(x=>{var u;this._vxl=x;this._vxlPromise=null;if(0>=this._newLayers.length)this._dbg(v.Lifetime," no voxel layers left after WASM downloaded, removing RenderPlugin and destroying"),this.destroy();else{x=this._getTimeArgs(null==(u=this._view)?void 0:u.timeExtent);u=this._vxl.addFunction(this._restoreFramebuffer.bind(this),"v");var E=this._vxl.addFunction(this._setBlendState.bind(this),"viiii"),y=this._vxl.addFunction(this._setFrontFace.bind(this),"vi"),A=this._vxl.addFunction(this._setRasterizerState.bind(this),
"vi"),p=this._vxl.addFunction(this._setDepthStencilStateFunction.bind(this),"viii"),B=this._vxl.addFunction(this._setViewport.bind(this),"viiii"),D=this._vxl.addFunction(this._bindPreviousDepthToSlot.bind(this),"iii"),C=this._vxl.addFunction(this._modifyResourceCount.bind(this),"viii"),F=this._halfIntTexturesAvailable&&!c("mac");this._vxl.initialize_voxel_wasm(u,E,y,A,p,B,D,C,x.startTime,x.endTime,x.useTime,F);this._renderPluginContext&&this._renderPluginContext.requestRender()}}).catch(()=>{for(const x of this._newLayers)x.rejectCallback(-2);
this._dbg(v.Error," WASM failed to download, removing RenderPlugin and destroying");this.destroy()}));return this._vxlPromise};t.pickDepth=function(r,x,u){if(!this._vxl||!this._rctx||0===this._layers.size)return null;const E=u.viewport[3]-x;if(0>r||r>u.viewport[2]||0>x||x>u.viewport[3])return this._dbg(v.Error,`pickDepth: outOfRange, screenXY=[${r}, ${E}], vp=[${u.viewport.toString()}]`),null;this._renderTargetToRestore={fbo:this._rctx.getBoundFramebufferObject(),viewport:this._rctx.getViewport()};
x=u.viewForward;const y=u.eye;this._vxl.update_camera_pos_and_direction(y[0],y[1],y[2],x[0],x[1],x[2]);this.updateWasmCamera(u);this._vxl.begin_frame();r=this._vxl.pick_depth(r,E);this._renderTargetToRestore.fbo=null;this._rctx.externalTextureUnitUpdate(this._vxl.get_texture_units_bound_in_frame(),this._vxl.get_active_texture_unit());this._rctx.externalVertexArrayObjectUpdate();this._rctx.externalVertexBufferUpdate();this._rctx.externalProgramUpdate();return r.success?r.distanceToCamera:null};t._toWasmQuality=
function(r){switch(r){case "low":return 0;case "medium":return 1;case "high":return 2}};a._createClass(q,[{key:"canRender",get:function(){return!!this._vxl&&"local"===this._view.viewingMode}}]);return q}()})},"esri/libs/vxl/enums":function(){define(["exports"],function(a){a.WasmResponseType=void 0;(function(b){b[b.Binary=0]="Binary";b[b.JSON=1]="JSON"})(a.WasmResponseType||(a.WasmResponseType={}));a.VoxelRequestType=void 0;(function(b){b[b.TreeIndex=0]="TreeIndex";b[b.TreeStats=1]="TreeStats";b[b.TreeData=
2]="TreeData";b[b.BrickBundles=3]="BrickBundles";b[b.Section=4]="Section";b[b.VariableStats=5]="VariableStats"})(a.VoxelRequestType||(a.VoxelRequestType={}));a.WasmCullMode=void 0;(function(b){b[b.None=1]="None";b[b.Front=2]="Front";b[b.Back=3]="Back"})(a.WasmCullMode||(a.WasmCullMode={}));a.WasmRenderingQuality=void 0;(function(b){b[b.Low=0]="Low";b[b.Medium=1]="Medium";b[b.High=2]="High"})(a.WasmRenderingQuality||(a.WasmRenderingQuality={}));a.UpdateFlags=void 0;(function(b){b[b.None=0]="None";
b[b.StaticSections=1]="StaticSections";b[b.Slices=2]="Slices";b[b.DynamicSections=4]="DynamicSections";b[b.GhostShell=8]="GhostShell";b[b.Isosurface=16]="Isosurface";b[b.Quality=32]="Quality";b[b.SunLocation=64]="SunLocation";b[b.StaticSectionSelection=128]="StaticSectionSelection";b[b.ExaggerationAndOffset=256]="ExaggerationAndOffset";b[b.CurrentTime=512]="CurrentTime";b[b.CurrentVariable=1024]="CurrentVariable";b[b.DeleteIsosurface=2048]="DeleteIsosurface";b[b.ContainerVisibility=4096]="ContainerVisibility";
b[b.RenderMode=8192]="RenderMode";b[b.Optimization=16384]="Optimization"})(a.UpdateFlags||(a.UpdateFlags={}));Object.defineProperty(a,"__esModule",{value:!0})})},"esri/libs/vxl/VxlModule":function(){define(["require","exports","../../assets"],function(a,b,c){function g(h){return c.getAssetUrl(`esri/libs/vxl/${h}`)}b.loadVoxelWASM=function(h){return(new Promise(w=>(new Promise((n,f)=>a(["../../chunks/vxlLayer"],n,f))).then(n=>n.vxlLayer).then(({default:n})=>{const f=n({locateFile:g,preinitializedWebGLContext:h,
onRuntimeInitialized:()=>w(f)})}))).catch(w=>Promise.reject(w))};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderPass":function(){define(["exports"],function(a){a.RenderPass=void 0;var b=a.RenderPass||(a.RenderPass={});b[b.MATERIAL=0]="MATERIAL";b[b.MATERIAL_ALPHA=1]="MATERIAL_ALPHA";b[b.MATERIAL_DEPTH=2]="MATERIAL_DEPTH";b[b.MATERIAL_NORMAL=3]="MATERIAL_NORMAL";b[b.MATERIAL_DEPTH_SHADOWMAP_ALL=4]="MATERIAL_DEPTH_SHADOWMAP_ALL";b[b.MATERIAL_HIGHLIGHT=5]="MATERIAL_HIGHLIGHT";
b[b.MATERIAL_DEPTH_SHADOWMAP_DEFAULT=6]="MATERIAL_DEPTH_SHADOWMAP_DEFAULT";b[b.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT=7]="MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT";b[b.MAX_PASS=8]="MAX_PASS";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderSlot":function(){define(["exports"],function(a){a.RenderSlot=void 0;var b=a.RenderSlot||(a.RenderSlot={});b[b.INTEGRATED_MESH=0]="INTEGRATED_MESH";b[b.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN";b[b.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL";b[b.OPAQUE_PLUGIN=
3]="OPAQUE_PLUGIN";b[b.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL";b[b.TRANSPARENT_PLUGIN=5]="TRANSPARENT_PLUGIN";b[b.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN";b[b.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=7]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL";b[b.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN";b[b.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL";b[b.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL";b[b.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS";b[b.POSTPROCESSING_ENVIRONMENT_OPAQUE=12]=
"POSTPROCESSING_ENVIRONMENT_OPAQUE";b[b.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=13]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT";b[b.LASERLINES=14]="LASERLINES";b[b.LASERLINES_CONTRAST_CONTROL=15]="LASERLINES_CONTRAST_CONTROL";b[b.HUD_MATERIAL=16]="HUD_MATERIAL";b[b.LABEL_MATERIAL=17]="LABEL_MATERIAL";b[b.LINE_CALLOUTS=18]="LINE_CALLOUTS";b[b.LINE_CALLOUTS_HUD_DEPTH=19]="LINE_CALLOUTS_HUD_DEPTH";b[b.DRAPED_MATERIAL=20]="DRAPED_MATERIAL";b[b.DRAPED_WATER=21]="DRAPED_WATER";b[b.VOXEL=22]="VOXEL";b[b.MAX_SLOTS=
23]="MAX_SLOTS";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/context-util":function(){define(["exports","../../core/has","../../core/maybe"],function(a,b,c){function g(f){const l=b("esri-force-webgl");if(l===a.ContextType.WEBGL1||l===a.ContextType.WEBGL2)return[l];switch(f){case "2d":return[a.ContextType.WEBGL1];case "3d":return[a.ContextType.WEBGL2,a.ContextType.WEBGL1]}}function h(f,l,k={}){if(!window.WebGLRenderingContext)return n(f,'This page requires a browser that supports WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org"\x3eClick here to upgrade your browser.\x3c/a\x3e'),
null;l=w(f,l,k);c.isNone(l)&&n(f,'It doesn\'t appear your computer can support WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org/troubleshooting/"\x3eClick here for more information.\x3c/a\x3e');return l}function w(f,l,k={}){l=l===a.ContextType.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let e=null;for(const d of l){try{e=f.getContext(d,k)}catch(m){}if(e)break}return e}function n(f,l){(f=f.parentNode)&&(f.innerHTML='\x3ctable style\x3d"background-color: #8CE; width: 100%; height: 100%;"\x3e\x3ctr\x3e\x3ctd align\x3d"center"\x3e\x3cdiv style\x3d"display: table-cell; vertical-align: middle;"\x3e\x3cdiv style\x3d""\x3e'+
l+"\x3c/div\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e")}a.ContextType=void 0;(function(f){f[f.WEBGL1=1]="WEBGL1";f[f.WEBGL2=2]="WEBGL2"})(a.ContextType||(a.ContextType={}));a.createContext=w;a.createContextOrErrorHTML=function(f,l,k={}){for(f=g(f);1<f.length;){const e=w(l,f.shift(),k);if(c.isSome(e))return e}return h(l,f.shift(),k)};a.getContextTypes=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/enums":function(){define(["exports"],function(a){a.ClearBufferBit=
void 0;(function(b){b[b.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT";b[b.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT";b[b.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(a.ClearBufferBit||(a.ClearBufferBit={}));a.PrimitiveType=void 0;(function(b){b[b.POINTS=0]="POINTS";b[b.LINES=1]="LINES";b[b.LINE_LOOP=2]="LINE_LOOP";b[b.LINE_STRIP=3]="LINE_STRIP";b[b.TRIANGLES=4]="TRIANGLES";b[b.TRIANGLE_STRIP=5]="TRIANGLE_STRIP";b[b.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(a.PrimitiveType||(a.PrimitiveType={}));a.BlendFactor=
void 0;(function(b){b[b.ZERO=0]="ZERO";b[b.ONE=1]="ONE";b[b.SRC_COLOR=768]="SRC_COLOR";b[b.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR";b[b.SRC_ALPHA=770]="SRC_ALPHA";b[b.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA";b[b.DST_ALPHA=772]="DST_ALPHA";b[b.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA";b[b.DST_COLOR=774]="DST_COLOR";b[b.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR";b[b.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE";b[b.CONSTANT_COLOR=32769]="CONSTANT_COLOR";b[b.ONE_MINUS_CONSTANT_COLOR=
32770]="ONE_MINUS_CONSTANT_COLOR";b[b.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA";b[b.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"})(a.BlendFactor||(a.BlendFactor={}));a.BlendOperation=void 0;(function(b){b[b.ADD=32774]="ADD";b[b.SUBTRACT=32778]="SUBTRACT";b[b.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"})(a.BlendOperation||(a.BlendOperation={}));a.BufferType=void 0;(function(b){b[b.ARRAY_BUFFER=34962]="ARRAY_BUFFER";b[b.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER";b[b.UNIFORM_BUFFER=
35345]="UNIFORM_BUFFER";b[b.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER";b[b.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER";b[b.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER";b[b.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"})(a.BufferType||(a.BufferType={}));a.Face=void 0;(function(b){b[b.FRONT=1028]="FRONT";b[b.BACK=1029]="BACK";b[b.FRONT_AND_BACK=1032]="FRONT_AND_BACK"})(a.Face||(a.Face={}));a.CullMode=void 0;(function(b){b[b.CW=2304]="CW";b[b.CCW=2305]="CCW"})(a.CullMode||(a.CullMode={}));a.DataType=
void 0;(function(b){b[b.BYTE=5120]="BYTE";b[b.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";b[b.SHORT=5122]="SHORT";b[b.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT";b[b.INT=5124]="INT";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.FLOAT=5126]="FLOAT"})(a.DataType||(a.DataType={}));a.CompareFunction=void 0;(function(b){b[b.NEVER=512]="NEVER";b[b.LESS=513]="LESS";b[b.EQUAL=514]="EQUAL";b[b.LEQUAL=515]="LEQUAL";b[b.GREATER=516]="GREATER";b[b.NOTEQUAL=517]="NOTEQUAL";b[b.GEQUAL=518]="GEQUAL";b[b.ALWAYS=519]="ALWAYS"})(a.CompareFunction||
(a.CompareFunction={}));a.StencilOperation=void 0;(function(b){b[b.ZERO=0]="ZERO";b[b.KEEP=7680]="KEEP";b[b.REPLACE=7681]="REPLACE";b[b.INCR=7682]="INCR";b[b.DECR=7683]="DECR";b[b.INVERT=5386]="INVERT";b[b.INCR_WRAP=34055]="INCR_WRAP";b[b.DECR_WRAP=34056]="DECR_WRAP"})(a.StencilOperation||(a.StencilOperation={}));a.TextureSamplingMode=void 0;(function(b){b[b.NEAREST=9728]="NEAREST";b[b.LINEAR=9729]="LINEAR";b[b.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST";b[b.LINEAR_MIPMAP_NEAREST=9985]=
"LINEAR_MIPMAP_NEAREST";b[b.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR";b[b.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"})(a.TextureSamplingMode||(a.TextureSamplingMode={}));a.TextureWrapMode=void 0;(function(b){b[b.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE";b[b.REPEAT=10497]="REPEAT";b[b.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(a.TextureWrapMode||(a.TextureWrapMode={}));a.TextureType=void 0;(function(b){b[b.TEXTURE_2D=3553]="TEXTURE_2D";b[b.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP";b[b.TEXTURE_3D=
32879]="TEXTURE_3D";b[b.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X";b[b.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X";b[b.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y";b[b.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y";b[b.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z";b[b.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z";b[b.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"})(a.TextureType||(a.TextureType=
{}));a.PixelFormat=void 0;(function(b){b[b.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT";b[b.DEPTH_STENCIL=34041]="DEPTH_STENCIL";b[b.ALPHA=6406]="ALPHA";b[b.RGB=6407]="RGB";b[b.RGBA=6408]="RGBA";b[b.LUMINANCE=6409]="LUMINANCE";b[b.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA";b[b.RED=6403]="RED";b[b.RG=33319]="RG";b[b.RED_INTEGER=36244]="RED_INTEGER";b[b.RG_INTEGER=33320]="RG_INTEGER";b[b.RGB_INTEGER=36248]="RGB_INTEGER";b[b.RGBA_INTEGER=36249]="RGBA_INTEGER"})(a.PixelFormat||(a.PixelFormat={}));a.SizedPixelFormat=
void 0;(function(b){b[b.RGBA4=32854]="RGBA4";b[b.R16F=33325]="R16F";b[b.RG16F=33327]="RG16F";b[b.RGB32F=34837]="RGB32F";b[b.RGBA16F=34842]="RGBA16F";b[b.R32F=33326]="R32F";b[b.RG32F=33328]="RG32F";b[b.RGBA32F=34836]="RGBA32F";b[b.R11F_G11F_B10F=35898]="R11F_G11F_B10F";b[b.RGB8=32849]="RGB8";b[b.RGBA8=32856]="RGBA8";b[b.RGB5_A1=32855]="RGB5_A1";b[b.R8=33321]="R8";b[b.RG8=33323]="RG8";b[b.R8I=33329]="R8I";b[b.R8UI=33330]="R8UI";b[b.R16I=33331]="R16I";b[b.R16UI=33332]="R16UI";b[b.R32I=33333]="R32I";
b[b.R32UI=33334]="R32UI";b[b.RG8I=33335]="RG8I";b[b.RG8UI=33336]="RG8UI";b[b.RG16I=33337]="RG16I";b[b.RG16UI=33338]="RG16UI";b[b.RG32I=33339]="RG32I";b[b.RG32UI=33340]="RG32UI";b[b.RGB16F=34843]="RGB16F";b[b.RGB9_E5=35901]="RGB9_E5";b[b.SRGB8=35905]="SRGB8";b[b.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8";b[b.RGB565=36194]="RGB565";b[b.RGBA32UI=36208]="RGBA32UI";b[b.RGB32UI=36209]="RGB32UI";b[b.RGBA16UI=36214]="RGBA16UI";b[b.RGB16UI=36215]="RGB16UI";b[b.RGBA8UI=36220]="RGBA8UI";b[b.RGB8UI=36221]="RGB8UI";b[b.RGBA32I=
36226]="RGBA32I";b[b.RGB32I=36227]="RGB32I";b[b.RGBA16I=36232]="RGBA16I";b[b.RGB16I=36233]="RGB16I";b[b.RGBA8I=36238]="RGBA8I";b[b.RGB8I=36239]="RGB8I";b[b.R8_SNORM=36756]="R8_SNORM";b[b.RG8_SNORM=36757]="RG8_SNORM";b[b.RGB8_SNORM=36758]="RGB8_SNORM";b[b.RGBA8_SNORM=36759]="RGBA8_SNORM";b[b.RGB10_A2=32857]="RGB10_A2";b[b.RGB10_A2UI=36975]="RGB10_A2UI"})(a.SizedPixelFormat||(a.SizedPixelFormat={}));a.PixelType=void 0;(function(b){b[b.FLOAT=5126]="FLOAT";b[b.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";b[b.UNSIGNED_INT_24_8=
34042]="UNSIGNED_INT_24_8";b[b.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4";b[b.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1";b[b.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5";b[b.BYTE=5120]="BYTE";b[b.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT";b[b.SHORT=5122]="SHORT";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.INT=5124]="INT";b[b.HALF_FLOAT=5131]="HALF_FLOAT";b[b.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV";b[b.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV";
b[b.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV";b[b.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"})(a.PixelType||(a.PixelType={}));a.RenderbufferFormat=void 0;(function(b){b[b.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16";b[b.STENCIL_INDEX8=36168]="STENCIL_INDEX8";b[b.DEPTH_STENCIL=34041]="DEPTH_STENCIL";b[b.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24";b[b.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F";b[b.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8";b[b.DEPTH32F_STENCIL8=
36013]="DEPTH32F_STENCIL8"})(a.RenderbufferFormat||(a.RenderbufferFormat={}));a.Usage=void 0;(function(b){b[b.STATIC_DRAW=35044]="STATIC_DRAW";b[b.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW";b[b.STREAM_DRAW=35040]="STREAM_DRAW";b[b.STATIC_READ=35045]="STATIC_READ";b[b.DYNAMIC_READ=35049]="DYNAMIC_READ";b[b.STREAM_READ=35041]="STREAM_READ";b[b.STATIC_COPY=35046]="STATIC_COPY";b[b.DYNAMIC_COPY=35050]="DYNAMIC_COPY";b[b.STREAM_COPY=35042]="STREAM_COPY"})(a.Usage||(a.Usage={}));a.ShaderType=void 0;(function(b){b[b.FRAGMENT_SHADER=
35632]="FRAGMENT_SHADER";b[b.VERTEX_SHADER=35633]="VERTEX_SHADER"})(a.ShaderType||(a.ShaderType={}));a.FramebufferTarget=void 0;(function(b){b[b.FRAMEBUFFER=36160]="FRAMEBUFFER";b[b.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER";b[b.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"})(a.FramebufferTarget||(a.FramebufferTarget={}));a.TargetType=void 0;(function(b){b[b.TEXTURE=0]="TEXTURE";b[b.RENDER_BUFFER=1]="RENDER_BUFFER";b[b.CUBEMAP=2]="CUBEMAP"})(a.TargetType||(a.TargetType={}));a.DepthStencilTargetType=
void 0;(function(b){b[b.NONE=0]="NONE";b[b.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER";b[b.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER";b[b.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER";b[b.DEPTH_STENCIL_TEXTURE=4]="DEPTH_STENCIL_TEXTURE"})(a.DepthStencilTargetType||(a.DepthStencilTargetType={}));a.ResourceType=void 0;(function(b){b[b.Texture=0]="Texture";b[b.Buffer=1]="Buffer";b[b.VAO=2]="VAO";b[b.Shader=3]="Shader";b[b.Program=4]="Program";b[b.Framebuffer=5]="Framebuffer";b[b.Renderbuffer=
6]="Renderbuffer";b[b.Sync=7]="Sync";b[b.COUNT=8]="COUNT"})(a.ResourceType||(a.ResourceType={}));a.ColorAttachment=void 0;(function(b){b[b.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0";b[b.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1";b[b.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2";b[b.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3";b[b.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4";b[b.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5";b[b.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6";b[b.COLOR_ATTACHMENT7=36071]=
"COLOR_ATTACHMENT7";b[b.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8";b[b.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9";b[b.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10";b[b.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11";b[b.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12";b[b.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13";b[b.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14";b[b.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"})(a.ColorAttachment||(a.ColorAttachment={}));a.CompressedTextureFormat=void 0;
(function(b){b[b.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT";b[b.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC";b[b.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC";b[b.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC";b[b.COMPRESSED_SIGNED_RG11_EAC=
37491]="COMPRESSED_SIGNED_RG11_EAC";b[b.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2";b[b.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2";b[b.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2";b[b.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2";b[b.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC";b[b.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(a.CompressedTextureFormat||
(a.CompressedTextureFormat={}));a.UniformType=void 0;(function(b){b[b.FLOAT=5126]="FLOAT";b[b.FLOAT_VEC2=35664]="FLOAT_VEC2";b[b.FLOAT_VEC3=35665]="FLOAT_VEC3";b[b.FLOAT_VEC4=35666]="FLOAT_VEC4";b[b.INT=5124]="INT";b[b.INT_VEC2=35667]="INT_VEC2";b[b.INT_VEC3=35668]="INT_VEC3";b[b.INT_VEC4=35669]="INT_VEC4";b[b.BOOL=35670]="BOOL";b[b.BOOL_VEC2=35671]="BOOL_VEC2";b[b.BOOL_VEC3=35672]="BOOL_VEC3";b[b.BOOL_VEC4=35673]="BOOL_VEC4";b[b.FLOAT_MAT2=35674]="FLOAT_MAT2";b[b.FLOAT_MAT3=35675]="FLOAT_MAT3";b[b.FLOAT_MAT4=
35676]="FLOAT_MAT4";b[b.SAMPLER_2D=35678]="SAMPLER_2D";b[b.SAMPLER_CUBE=35680]="SAMPLER_CUBE";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2";b[b.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3";b[b.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4";b[b.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3";b[b.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4";b[b.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2";b[b.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4";b[b.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2";b[b.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3";
b[b.SAMPLER_3D=35679]="SAMPLER_3D";b[b.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW";b[b.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY";b[b.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW";b[b.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW";b[b.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D";b[b.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D";b[b.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE";b[b.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY";b[b.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D";b[b.UNSIGNED_INT_SAMPLER_3D=
36307]="UNSIGNED_INT_SAMPLER_3D";b[b.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE";b[b.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"})(a.UniformType||(a.UniformType={}));a.SyncParameter=void 0;(function(b){b[b.OBJECT_TYPE=37138]="OBJECT_TYPE";b[b.SYNC_CONDITION=37139]="SYNC_CONDITION";b[b.SYNC_STATUS=37140]="SYNC_STATUS";b[b.SYNC_FLAGS=37141]="SYNC_FLAGS"})(a.SyncParameter||(a.SyncParameter={}));a.SyncStatus=void 0;(function(b){b[b.UNSIGNALED=37144]="UNSIGNALED";
b[b.SIGNALED=37145]="SIGNALED"})(a.SyncStatus||(a.SyncStatus={}));a.ClientWaitSyncStatus=void 0;(function(b){b[b.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED";b[b.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED";b[b.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED";b[b.WAIT_FAILED=37149]="WAIT_FAILED"})(a.ClientWaitSyncStatus||(a.ClientWaitSyncStatus={}));a.SyncCondition=void 0;(function(b){b[b.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"})(a.SyncCondition||(a.SyncCondition={}));a.SyncFlag=
void 0;(function(b){b[b.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"})(a.SyncFlag||(a.SyncFlag={}));a.BASE_TEXTURE_UNIT=33984;a.DepthStencilAttachment=33306;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/layerUtils":function(){define(["exports"],function(a){a.areLabelsVisible=function(b){return!0===b.labelsVisible&&null!=b.labelingInfo&&0<b.labelingInfo.length};a.getLayersForScale=function(b,c){const g=[];if(0<b&&c)for(let h=0;h<c.length;h++)if(!(0<=c[h].parentLayerId&&
-1===g.indexOf(c[h].parentLayerId)&&c.some(function(w){return w.id===c[h].parentLayerId}))&&0<=c[h].id){let w=!0;const n=c[h].maxScale,f=c[h].minScale;if(0<n||0<f)0<n&&0<f?w=n<=b&&b<=f:0<n?w=n<=b:0<f&&(w=b<=f);w&&g.push(c[h].id)}return g};a.getTileMaxtrixSetFromActiveLayer=function(b){if(b.activeLayer){const c=b.activeLayer.tileMatrixSet;if(c)return c;if(b=b.activeLayer.tileMatrixSets)return b}return null};a.isBaseLayer=function(b){return b.parent&&"esri.Basemap"===b.parent.declaredClass&&-1<b.parent.baseLayers.indexOf(b)};
a.isReprojectableTiledLayer=function(b){return b&&"imagery-tile"===b.type};a.isTiledLayer=function(b){return b&&"base-tile"===b.type||"tile"===b.type||"elevation"===b.type||"imagery-tile"===b.type||"base-elevation"===b.type||"open-street-map"===b.type||"wcs"===b.type||"web-tile"===b.type||"wmts"===b.type||"vector-tile"===b.type};a.isVoxelLayer=function(b){return b&&"voxel"===b.type};a.isWMTSLayer=function(b){return b&&"wmts"===b.type};a.serializeLayerDefinitions=function(b){const c=/[:;]/,g=[];let h=
!1;if(b&&(b.forEach(function(w,n){g.push([n,w]);!h&&c.test(w)&&(h=!0)}),0<g.length)){if(h){const w={};g.forEach(n=>{w[n[0]]=n[1]});b=JSON.stringify(w)}else{const w=[];g.forEach(n=>{w.push(n[0]+":"+n[1])});b=w.join(";")}return b}return null};a.serializeTimeOptions=function(b){if(b){var c=[];b.forEach(function(g,h){c.push('"'+h+'":'+JSON.stringify(g))});if(c.length)return"{"+c.join(",")+"}"}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/BreakpointsOwner":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/ArrayPool ../core/Handles ../core/maybe ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){function m(q,t){return t?z[q].valueToClassName[t].split(" "):[]}const z={widthBreakpoint:{getValue(q){const t=q.viewSize[0];q=q.breakpoints;const r=this.values;return t<=q.xsmall?r.xsmall:t<=q.small?r.small:t<=q.medium?r.medium:t<=q.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",
small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",
xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(q){const t=q.viewSize[1];q=q.breakpoints;const r=this.values;return t<=q.xsmall?r.xsmall:t<=q.small?r.small:t<=q.medium?r.medium:t<=q.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",
small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",
xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(q){q=q.viewSize;const t=this.values;return q[1]>=q[0]?t.portrait:t.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},v={xsmall:544,small:768,medium:992,large:1200};a.BreakpointsOwner=
q=>{q=function(t){function r(...u){u=t.call(this,...u)||this;u._breakpointsHandles=new h;u.orientation=null;u.widthBreakpoint=null;u.heightBreakpoint=null;u.breakpoints=v;return u}b._inheritsLoose(r,t);var x=r.prototype;x.initialize=function(){this._breakpointsHandles.add(n.watch(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),n.initial))};x.destroy=function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=w.destroyMaybe(this._breakpointsHandles))};x._updateClassNames=
function(){if(this.container){var u=g.acquire(),E=g.acquire(),y=!1,A;for(A in z){const p=this[A],B=z[A].getValue({viewSize:this.size,breakpoints:this.breakpoints});p!==B&&(y=!0,this[A]=B,m(A,p).forEach(D=>E.push(D)),m(A,B).forEach(D=>u.push(D)))}y&&(this._applyClassNameChanges(u,E),g.release(u),g.release(E))}};x._applyClassNameChanges=function(u,E){const y=this.container;y&&(E.forEach(A=>y.classList.remove(A)),u.forEach(A=>y.classList.add(A)))};x._removeActiveClassNames=function(){const u=this.container;
if(u)for(var E in z)m(E,this[E]).forEach(y=>u.classList.remove(y))};b._createClass(r,[{key:"breakpoints",set:function(u){var E=this._get("breakpoints");if(u!==E){E=(E=u)&&E.xsmall<E.small&&E.small<E.medium&&E.medium<E.large;if(!E){const y=JSON.stringify(v,null,2);console.warn("provided breakpoints are not valid, using defaults:"+y)}u=E?u:v;this._set("breakpoints",{...u})}}}]);return r}(q);c.__decorate([f.property()],q.prototype,"breakpoints",null);c.__decorate([f.property()],q.prototype,"orientation",
void 0);c.__decorate([f.property()],q.prototype,"widthBreakpoint",void 0);c.__decorate([f.property()],q.prototype,"heightBreakpoint",void 0);return q=c.__decorate([d.subclass("esri.views.BreakpointsOwner")],q)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/DOMContainer":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/domUtils ../core/reactiveUtils ../core/scheduling ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./overlay/ViewOverlay ../widgets/Popup".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m){function z(q){q&&(g.empty(q),q.parentNode&&q.parentNode.removeChild(q))}const v=[0,0];a.DOMContainer=q=>{q=function(t){function r(...u){var E=t.call(this,...u)||this;E._freqInfo={freq:16,time:750};E._overlayRenderTaskHandle=null;E.height=0;E.position=null;E.resizing=!1;E.root=null;E.surface=null;E.suspended=!0;E.ui=null;E.userContent=null;E.width=0;E.widthBreakpoint=null;E.handles.add([E.watch("cursor",y=>{const A=E.surface;A&&A.setAttribute("data-cursor",y)}),
E.watch("interacting",y=>{const A=E.surface;A&&A.setAttribute("data-interacting",y.toString())})]);return E}b._inheritsLoose(r,t);var x=r.prototype;x.initialize=function(){this.handles.add(this.watch("ui",(u,E)=>this._handleUIChange(u,E)));this._wireUI(this.ui);this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])};x.destroy=function(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&this.popup.destroy(),
this.container=null)};x.blur=function(){this.surface&&this.surface.blur()};x.focus=function(){this.surface&&this.surface.focus()};x.pageToContainer=function(u,E,y){const A=this.position;u-=A[0];E-=A[1];y?(y[0]=u,y[1]=E):y=[u,E];return y};x.containerToPage=function(u,E,y){const A=this.position;u+=A[0];E+=A[1];y?(y[0]=u,y[1]=E):y=[u,E];return y};x._handleUIChange=function(u,E){E&&(this.handles.remove("ui"),E.destroy());u&&this._wireUI(u);this._set("ui",u)};x._wireUI=function(u){this.handles.remove("ui");
u&&(u.view=this,this.handles.add([h.watch(()=>this.root,E=>{if(E){{const y=document.createElement("div");E.appendChild(y);E=y}}else E=null;u.container=E},h.initial),h.watch(()=>this.popup,(E,y)=>{y&&u.remove(y,"popup");E&&(E.view=u.view,u.add(E,{key:"popup",position:"manual"}))},h.initial)],"ui"))};x._stopMeasuring=function(){this.handles.remove("measuring");this._get("resizing")&&this._set("resizing",!1)};x._startMeasuring=function(){const u=this._freqInfo;u.freq=16;u.time=750;this.handles.add([(()=>
{const E=()=>{u.freq=16;u.time=750};window.addEventListener("resize",E);return{remove(){window.removeEventListener("resize",E)}}})(),w.addFrameTask({prepare:E=>{const y=this._measure(),A=this._freqInfo;A.time+=E.deltaTime;y&&(A.freq=16,this._get("resizing")||this._set("resizing",!0));A.time<A.freq||(A.time=0,this._position()||y?A.freq=16:A.freq=Math.min(750,2*A.freq),!y&&512<=A.freq&&this._get("resizing")&&this._set("resizing",!1))}})],"measuring");this._measure();this._position()};x._measure=function(){var u=
this.container;const E=u?u.clientWidth:0;u=u?u.clientHeight:0;if(0===E||0===u)return this.suspended||this._set("suspended",!0),!1;const y=this.width,A=this.height;if(E===y&&u===A)return this.suspended&&this._set("suspended",!1),!1;this._set("width",E);this._set("height",u);this.suspended&&this._set("suspended",!1);this.emit("resize",{oldWidth:y,oldHeight:A,width:E,height:u});return!0};x._position=function(){var u=this.container;const E=this.position;{const y=(u.ownerDocument||window.document).defaultView;
u=u.getBoundingClientRect();v[0]=u.left+y.pageXOffset;v[1]=u.top+y.pageYOffset}return E&&v[0]===E[0]&&v[1]===E[1]?!1:(this._set("position",[v[0],v[1]]),!0)};x.forceDOMReadyCycle=function(){};b._createClass(r,[{key:"container",set:function(u){var E=this._get("container");if(E!==u)if(this.handles.remove("dom-size"),this._stopMeasuring(),E&&(E.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),
this._set("overlay",null),z(this.root),this._set("root",null),g.reparent(this.userContent,E),z(this.userContent),this._set("userContent",null)),u){u.classList.add("esri-view");E=document.createElement("div");E.className="esri-view-user-storage";g.reparent(u,E);u.appendChild(E);this._set("userContent",E);E=document.createElement("div");E.className="esri-view-root";u.insertBefore(E,u.firstChild);this._set("root",E);const y=document.createElement("div");y.className="esri-view-surface";y.setAttribute("role",
"application");y.tabIndex=0;E.appendChild(y);this._set("surface",y);const A=new d;E.appendChild(A.surface);this._set("overlay",A);A.watch("needsRender",p=>{p&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=w.addFrameTask({render:()=>{this.overlay.render()}}):this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null)});this.forceDOMReadyCycle();this.handles.add(h.watch(()=>this.size,p=>{const [B,D]=p;B>=document.body.clientWidth||D>=document.body.clientHeight?
y.classList.add("esri-view-surface--inset-outline"):y.classList.remove("esri-view-surface--inset-outline")},h.initial),"dom-size");this._set("container",u);this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}},{key:"focused",get:function(){const u=document.activeElement===this.surface;return document.hasFocus()&&u}},{key:"popup",get:function(){return this._get("popup")||new m({view:this})},
set:function(u){const E=this._get("popup");E&&E!==u&&E.destroy();this._set("popup",u)}},{key:"size",get:function(){return[this.width,this.height]}}]);return r}(q);c.__decorate([n.property({value:null,cast:t=>g.byId(t)})],q.prototype,"container",null);c.__decorate([n.property({readOnly:!0})],q.prototype,"focused",null);c.__decorate([n.property({readOnly:!0})],q.prototype,"height",void 0);c.__decorate([n.property({type:m})],q.prototype,"popup",null);c.__decorate([n.property({type:d})],q.prototype,"overlay",
void 0);c.__decorate([n.property({readOnly:!0})],q.prototype,"position",void 0);c.__decorate([n.property({readOnly:!0})],q.prototype,"resizing",void 0);c.__decorate([n.property({readOnly:!0})],q.prototype,"root",void 0);c.__decorate([n.property({value:null,readOnly:!0})],q.prototype,"size",null);c.__decorate([n.property({readOnly:!0})],q.prototype,"surface",void 0);c.__decorate([n.property({readOnly:!0})],q.prototype,"suspended",void 0);c.__decorate([n.property()],q.prototype,"ui",void 0);c.__decorate([n.property({readOnly:!0})],
q.prototype,"userContent",void 0);c.__decorate([n.property({readOnly:!0})],q.prototype,"width",void 0);c.__decorate([n.property()],q.prototype,"widthBreakpoint",void 0);return q=c.__decorate([e.subclass("esri.views.DOMContainer")],q)};a.isDOMContainer=function(q){return q&&"focus"in q};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/overlay/ViewOverlay":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Collection ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../libs/maquette/projection ../../libs/maquette/projector ../support/WatchUpdatingTracking".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){c=function(m){function z(){var q=m.apply(this,arguments)||this;q.items=new g;q._watchUpdatingTracking=new d.WatchUpdatingTracking;q._callbacks=new Map;q._projector=e.createProjector();q._hiddenProjector=e.createProjector();return q}a._inheritsLoose(z,m);var v=z.prototype;v.initialize=function(){const q=document.createElement("div");q.className="esri-overlay-surface";this._set("surface",q);this._hiddenSurface=document.createElement("div");this._hiddenSurface.setAttribute("style",
"visibility: hidden;");q.appendChild(this._hiddenSurface);this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,t=>{for(const r of t.added){const x=()=>r.render();this._callbacks.set(r,x);this._projector.append(this.surface,x)}for(const r of t.removed)t=this._projector.detach(this._callbacks.get(r)),this.surface.removeChild(t.domNode),this._callbacks.delete(r)})};v.addItem=function(q){this.items.add(q)};v.removeItem=function(q){this.items.remove(q)};v.destroy=function(){this.items.removeAll();
this._callbacks.forEach(q=>this._projector.detach(q));this._projector=this._callbacks=null;this._watchUpdatingTracking.destroy()};v.render=function(){this._projector.renderNow()};v.computeBoundingRect=function(q){const t=this._hiddenSurface,r=this._hiddenProjector;let x=null;const u=()=>x=q.render();r.append(t,u);r.renderNow();const E={left:0,top:0,right:0,bottom:0};if(x&&x.domNode){const y=x.domNode.getBoundingClientRect();E.left=y.left;E.top=y.top;E.right=y.right;E.bottom=y.bottom}for(r.detach(u);t.firstChild;)t.removeChild(t.firstChild);
return E};v.overlaps=function(q,t){q=this.computeBoundingRect(q);t=this.computeBoundingRect(t);return Math.max(q.left,t.left)<=Math.min(q.right,t.right)&&Math.max(q.top,t.top)<=Math.min(q.bottom,t.bottom)};v.renderCanvas=function(q){if(this.items.some(r=>r.visible)){var t=q.getContext("2d");t.save();t.font=`10px ${getComputedStyle(this.surface).fontFamily}`;this.items.forEach(r=>{t.save();r.renderCanvas(t);t.restore()});t.restore()}};a._createClass(z,[{key:"needsRender",get:function(){return 0<this.items.length}},
{key:"hasVisibleItems",get:function(){return this.items.some(q=>q.visible)}}]);return z}(c);b.__decorate([h.property({readOnly:!0})],c.prototype,"surface",void 0);b.__decorate([h.property({readOnly:!0})],c.prototype,"items",void 0);b.__decorate([h.property({readOnly:!0})],c.prototype,"needsRender",null);b.__decorate([h.property({readOnly:!0})],c.prototype,"_watchUpdatingTracking",void 0);b.__decorate([h.property({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],c.prototype,"updating",void 0);
return c=b.__decorate([l.subclass("esri.views.overlay.ViewOverlay")],c)})},"esri/widgets/Popup":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../intl ../core/Collection ../core/events ../core/Handles ../core/Logger ../core/maybe ../core/reactiveUtils ../core/throttle ../core/watchUtils ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Feature ./Spinner ./Widget ./Feature/support/FeatureContentMixin ./Popup/PopupViewModel ./support/Heading ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/decorators/vmEvent ./support/jsxFactory ./support/widgetUtils ../intl/substitute".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G){function L(I,O){return void 0===O?`${"esri-popup"}__${I}`:`${"esri-popup"}__${I}-${O}`}const H={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},M=n.getLogger("esri.widgets.Popup"),K={closeButton:!0,featureNavigation:!0};c=function(I){function O(J,P){var N=I.call(this,J,P)||this;N._blurClose=!1;N._blurContainer=!1;N._containerNode=null;N._mainContainerNode=null;N._featureMenuNode=null;N._actionsMenuNode=null;N._focusClose=
!1;N._focusContainer=!1;N._focusDockButton=!1;N._focusFeatureMenuButton=!1;N._focusActionsMenuButton=!1;N._focusFirstFeature=!1;N._focusFirstAction=!1;N._handles=new w;N._pointerOffsetInPx=16;N._spinner=null;N._feature=null;N._featureMenuIntersectionObserverCallback=([R])=>{null!=R&&R.isIntersecting&&N.viewModel.featurePage++};N._featureMenuIntersectionObserver=new IntersectionObserver(N._featureMenuIntersectionObserverCallback,{root:window.document});N._displaySpinnerThrottled=k.throttle(()=>N._displaySpinner(),
0);N.actions=null;N.alignment="auto";N.autoCloseEnabled=null;N.autoOpenEnabled=null;N.defaultPopupTemplateEnabled=null;N.content=null;N.collapsed=!1;N.collapseEnabled=!0;N.dockEnabled=!1;N.featureCount=null;N.featureMenuOpen=!1;N.features=null;N.goToOverride=null;N.headingLevel=2;N.highlightEnabled=null;N.location=null;N.label=void 0;N.maxInlineActions=3;N.messages=null;N.messagesCommon=null;N.promises=null;N.selectedFeature=null;N.selectedFeatureIndex=null;N.spinnerEnabled=!0;N.title=null;N.updateLocationEnabled=
null;N.view=null;N.viewModel=new y;N.visible=null;N.visibleElements={...K};N._addSelectedFeatureIndexHandle();N.own([e.watch(a._assertThisInitialized(N),"viewModel.screenLocation",()=>N._positionContainer()),e.watch(a._assertThisInitialized(N),["viewModel.active","dockEnabled"],()=>N._toggleScreenLocationEnabled()),e.watch(a._assertThisInitialized(N),"viewModel.screenLocation",(R,S)=>{!!R!==!!S&&N.reposition()}),e.watch(a._assertThisInitialized(N),["viewModel.view.padding","viewModel.view.size","viewModel.active",
"viewModel.location","alignment"],()=>N.reposition()),e.watch(a._assertThisInitialized(N),"spinnerEnabled",R=>N._spinnerEnabledChange(R)),e.watch(a._assertThisInitialized(N),"viewModel.view.size",(R,S)=>N._updateDockEnabledForViewSize(R,S)),e.watch(a._assertThisInitialized(N),"viewModel.view",(R,S)=>N._viewChange(R,S)),e.watch(a._assertThisInitialized(N),"viewModel.view.ready",(R,S)=>N._viewReadyChange(R,S)),e.watch(a._assertThisInitialized(N),["viewModel.waitingForResult","viewModel.location"],()=>
{N._hideSpinner();N._displaySpinnerThrottled()}),e.watch(a._assertThisInitialized(N),["selectedFeatureWidget.viewModel.title","selectedFeatureWidget.viewModel.state"],()=>N._setTitleFromFeatureWidget()),e.watch(a._assertThisInitialized(N),["selectedFeatureWidget.viewModel.content","selectedFeatureWidget.viewModel.state"],()=>N._setContentFromFeatureWidget()),e.whenFalse(a._assertThisInitialized(N),"collapsed",()=>{var R,S;"xsmall"===(null==(R=N.viewModel)?void 0:null==(S=R.view)?void 0:S.widthBreakpoint)&&
N.viewModel.active&&N.collapseEnabled&&N.viewModel.centerAtLocation()}),e.on(a._assertThisInitialized(N),"viewModel.allActions","change",()=>N._watchActions()),e.init(a._assertThisInitialized(N),"viewModel.allActions",()=>N._watchActions()),e.watch(a._assertThisInitialized(N),"viewModel.featureViewModels",()=>N._featureMenuViewportScrollTop())]);return N}a._inheritsLoose(O,I);var Q=O.prototype;Q.destroy=function(){var J,P;this._destroySelectedFeatureWidget();this._destroySpinner();null==(J=this._handles)?
void 0:J.destroy();this._unobserveFeatureMenuObserver();null==(P=this._featureMenuIntersectionObserver)?void 0:P.disconnect();this._handles=null};Q.castVisibleElements=function(J){return{...K,...J}};Q.blur=function(){const {active:J}=this.viewModel;J||M.warn("Popup can only be blurred when currently active.");this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0;this.scheduleRender()};Q.clear=function(){this.viewModel.clear()};Q.close=function(){this.visible=!1};Q.fetchFeatures=
function(J,P){return this.viewModel.fetchFeatures(J,P)};Q.focus=function(){const {active:J}=this.viewModel;J||M.warn("Popup can only be focused when currently active.");this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0;this.scheduleRender()};Q.next=function(){return this.viewModel.next()};Q.open=function(J){var P,N;this._handles.remove("selected-index");const R={collapsed:J?!!J.collapsed:!1,actionsMenuOpen:J?!!J.actionsMenuOpen:!1,featureMenuOpen:J?!!J.featureMenuOpen:!1};
"xsmall"===(null==(P=this.viewModel)?void 0:null==(N=P.view)?void 0:N.widthBreakpoint)&&(R.collapsed=!0);this.set(R);this.viewModel.open(J);this._shouldFocus(J);this._addSelectedFeatureIndexHandle()};Q.previous=function(){return this.viewModel.previous()};Q.reposition=function(){this.renderNow();this._positionContainer();this._setCurrentAlignment()};Q.triggerAction=function(J){this.viewModel.triggerAction(J)};Q.render=function(){var J,P,N,R;const {actionsMenuOpen:S,dockEnabled:T,featureMenuVisible:V,
dividedActions:W,currentAlignment:U,currentDockPosition:aa}=this,{active:da}=this.viewModel;var {menuActions:Y}=W;Y=da&&1<Y.length&&S;const ea=null==(J=this.selectedFeature)?void 0:null==(P=J.layer)?void 0:P.title;J=null==(N=this.selectedFeature)?void 0:null==(R=N.layer)?void 0:R.id;return C.tsx("div",{class:this.classes("esri-popup",{["esri-popup--aligned-top-center"]:"top-center"===U,["esri-popup--aligned-bottom-center"]:"bottom-center"===U,["esri-popup--aligned-top-left"]:"top-left"===U,["esri-popup--aligned-bottom-left"]:"bottom-left"===
U,["esri-popup--aligned-top-right"]:"top-right"===U,["esri-popup--aligned-bottom-right"]:"bottom-right"===U,["esri-popup--is-docked"]:da&&T,["esri-popup--shadow"]:da&&!T,["esri-popup--is-docked-top-left"]:"top-left"===aa,["esri-popup--is-docked-top-center"]:"top-center"===aa,["esri-popup--is-docked-top-right"]:"top-right"===aa,["esri-popup--is-docked-bottom-left"]:"bottom-left"===aa,["esri-popup--is-docked-bottom-center"]:"bottom-center"===aa,["esri-popup--is-docked-bottom-right"]:"bottom-right"===
aa,["esri-popup--feature-menu-open"]:V,["esri-popup--actions-menu-open"]:Y}),role:"presentation","data-layer-title":ea,"data-layer-id":J,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},da?[this.renderMainContainer(),this.renderPointer()]:null)};Q.renderLoadingIcon=function(){return C.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon","esri-icon-loading-indicator","esri-rotating")})};Q.renderNavigationLoading=function(){const {messagesCommon:J}=
this;return this.viewModel.pendingPromisesCount?C.tsx("div",{key:L("loading-container"),role:"presentation",class:"esri-popup__loading-container","aria-label":J.loading,title:J.loading},this.renderLoadingIcon()):null};Q.renderPreviousIcon=function(){const J=F.isRTL(this.container);return C.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",{["esri-icon-right-triangle-arrow"]:J,["esri-popup__pagination-previous-icon--rtl"]:J,["esri-icon-left-triangle-arrow"]:!J,["esri-popup__pagination-previous-icon"]:!J})})};
Q.renderPreviousButton=function(){const {messages:J}=this;return C.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes("esri-popup__button","esri-popup__pagination-previous"),"aria-label":J.previous,title:J.previous},this.renderPreviousIcon())};Q.renderNextIcon=function(){const J=F.isRTL(this.container);return C.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",{["esri-icon-left-triangle-arrow"]:J,["esri-popup__pagination-next-icon--rtl"]:J,
["esri-icon-right-triangle-arrow"]:!J,["esri-popup__pagination-next-icon"]:!J})})};Q.renderNextButton=function(){const {messages:J}=this;return C.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes("esri-popup__button","esri-popup__pagination-next"),"aria-label":J.next,title:J.next},this.renderNextIcon())};Q.renderFeatureMenuButton=function(){const {featureMenuOpen:J,featureMenuId:P,messagesCommon:N}=this,{featureCount:R,selectedFeatureIndex:S}=
this.viewModel;return C.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes("esri-popup__button","esri-popup__feature-menu-button"),"aria-haspopup":"true","aria-controls":P,"aria-expanded":J.toString(),"aria-label":N.menu,title:N.menu},this._getPageText(R,S))};Q.renderNavigationButtons=function(){return this.featureNavigationVisible?
[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null};Q.renderDockIcon=function(){const {dockEnabled:J}=this,P=this._wouldDockTo();return C.tsx("span",{"aria-hidden":"true",class:this.classes({["esri-icon-minimize"]:J,["esri-popup__icon--dock-icon"]:!J,["esri-icon-dock-right"]:!J&&("top-right"===P||"bottom-right"===P),["esri-icon-dock-left"]:!J&&("top-left"===P||"bottom-left"===P),["esri-icon-maximize"]:!J&&"top-center"===P,["esri-icon-dock-bottom"]:!J&&
"bottom-center"===P},"esri-popup__icon")})};Q.renderDockButton=function(){var J,P,N;const {dockEnabled:R,messages:S}=this,T=null==(J=this.viewModel)?void 0:null==(P=J.view)?void 0:P.widthBreakpoint;J=R?S.undock:S.dock;return"xsmall"!==T&&null!=(N=this.dockOptions)&&N.buttonEnabled?C.tsx("div",{role:"button","aria-label":J,title:J,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes("esri-popup__button",
"esri-popup__button--dock")},this.renderDockIcon()):null};Q.renderTitle=function(){const {title:J}=this.viewModel,{titleId:P,collapsible:N,contentCollapsed:R,messagesCommon:S}=this;var T={["esri-popup__header-container--button"]:N};const V=C.tsx(A.Heading,{level:this.headingLevel,class:"esri-popup__header-title",innerHTML:J});T=N?C.tsx("button",{key:`${J}--collapsible`,id:P,title:R?S.expand:S.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes("esri-popup__header-container",
T),"aria-expanded":R?"false":"true",onclick:this._toggleCollapsed,type:"button"},V):C.tsx("div",{key:J,id:P,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes("esri-popup__header-container",T)},V);return J?T:null};Q.renderCloseIcon=function(){return C.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon","esri-icon-close")})};Q.renderCloseButton=function(){const {visibleElements:J,messagesCommon:P}=this;return J.closeButton?C.tsx("div",{role:"button",
tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:"esri-popup__button","aria-label":P.close,title:P.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null};Q.renderHeader=function(){return C.tsx("header",{class:"esri-popup__header"},this.renderTitle(),C.tsx("div",{class:"esri-popup__header-buttons"},this.renderDockButton(),this.renderCloseButton()))};Q.renderContentContainer=function(){const {contentId:J,hasContent:P,
contentCollapsed:N}=this,{content:R}=this.viewModel;return P&&!N?C.tsx("article",{key:R,enterAnimation:this._createFeatureUpdatedAnimation(),id:J,class:"esri-popup__content"},this.renderContent()):null};Q.renderActionsMenuButton=function(){const {actionsMenuId:J,actionsMenuButtonId:P,actionsMenuOpen:N,dividedActions:R,messagesCommon:S}=this,T=N?S.close:S.open,{menuActions:V}=R;return V.length?C.tsx("div",{key:L("actions-menu-button"),class:this.classes("esri-popup__button","esri-popup__actions-menu-button"),
role:"button",id:P,"aria-haspopup":"true","aria-controls":N?J:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":T,title:T},C.tsx("span",{"aria-hidden":"true",class:"esri-icon-handle-horizontal"})):null};Q.renderMenuActions=function(){const {actionsMenuId:J,actionsMenuButtonId:P,actionsMenuOpen:N,dividedActions:R}=this,{menuActions:S}=R;return S.length&&N?
C.tsx("ul",{id:J,role:"menu","aria-labelledby":P,key:L("actions"),class:"esri-popup__actions",bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},S.toArray().map(T=>this.renderAction({action:T,type:"menu-item"}))):null};Q.renderInlineActions=function(){const {inlineActions:J}=this.dividedActions;return!!J.length&&J.toArray().map(P=>this.renderAction({action:P,type:"inline"}))};Q.renderInlineActionsContainer=function(){const {inlineActions:J,
menuActions:P}=this.dividedActions,N=!!J.length,R=!!P.length;return N||R?C.tsx("div",{key:"inline-actions-container","data-inline-actions":N.toString(),"data-menu-actions":R.toString(),class:"esri-popup__inline-actions-container"},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null};Q.renderNavigation=function(){return this.featureNavigationVisible?C.tsx("section",{key:L("navigation"),class:this.classes("esri-popup__navigation")},this.renderNavigationButtons()):
null};Q.renderFooter=function(){const {featureNavigationVisible:J,dividedActions:P}=this,{inlineActions:N,menuActions:R}=P,S=!!N.length,T={["esri-popup__footer--has-pagination"]:J,["esri-popup__footer--has-actions"]:S,["esri-popup__footer--has-actions-menu"]:!!R.length};return J||S?C.tsx("div",{key:L("feature-buttons"),class:this.classes("esri-popup__footer",T)},this.renderInlineActionsContainer(),this.renderNavigation()):null};Q.renderFeatureMenuContainer=function(){var {messages:J}=this;const {featureViewModels:P,
isLoadingFeature:N}=this.viewModel;J=G.substitute(J.selectedFeatures,{total:P.length});return C.tsx("section",{key:L("menu"),class:"esri-popup__feature-menu"},C.tsx("strong",{class:"esri-popup__feature-menu-header"},J),C.tsx("nav",{bind:this,class:"esri-popup__feature-menu-viewport","data-node-ref":"_featureMenuViewportNode",afterCreate:F.storeNode},this.renderFeatureMenu(),C.tsx("div",{class:"esri-popup__feature-menu-observer",bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),
N?C.tsx("div",{class:"esri-popup__feature-menu-loader"},this.renderLoadingIcon()):null))};Q.renderPointer=function(){return this.dockEnabled?null:C.tsx("div",{key:L("pointer"),class:"esri-popup__pointer",role:"presentation"},C.tsx("div",{class:this.classes("esri-popup__pointer-direction","esri-popup--shadow")}))};Q.renderMainContainer=function(){const {dockEnabled:J,currentAlignment:P,currentDockPosition:N,titleId:R,contentId:S,collapsible:T,hasContent:V,contentCollapsed:W,visibleElements:U}=this,
{title:aa}=this.viewModel,da="bottom-left"===P||"bottom-center"===P||"bottom-right"===P||"top-left"===N||"top-center"===N||"top-right"===N,Y="top-left"===P||"top-center"===P||"top-right"===P||"bottom-left"===N||"bottom-center"===N||"bottom-right"===N;return C.tsx("div",{class:this.classes("esri-popup__main-container","esri-widget",{["esri-popup--shadow"]:J,["esri-popup--is-collapsible"]:T,["esri-popup--is-collapsed"]:W}),tabIndex:U.closeButton?null:-1,role:"dialog","aria-labelledby":aa?R:"","aria-describedby":V&&
!W?S:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},da?this.renderFooter():null,da?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),Y?this.renderFooter():null,Y?this.renderFeatureMenuContainer():null)};Q.renderContent=function(){var J;const P=null==(J=this.viewModel)?void 0:J.content;return P?"string"===typeof P?C.tsx("div",{key:P,innerHTML:P}):this.renderNodeContent(P):null};
Q.renderActionText=function(J){return C.tsx("span",{key:"text",class:"esri-popup__action-text"},J)};Q.renderActionIcon=function(J){const P=this._getActionClass(J),N=this._getActionImage(J),R={["esri-icon-loading-indicator"]:J.active,["esri-rotating"]:J.active,["esri-popup__icon"]:!!P,["esri-popup__action-image"]:!J.active&&!!N};P&&(R[P]=!J.active);return C.tsx("span",{key:"icon","aria-hidden":"true",class:this.classes("esri-popup__icon",R),styles:this._getIconStyles(N)})};Q.renderAction=function(J){const {action:P,
type:N}=J;J=this._getActionTitle(P);const R={["esri-popup__action"]:"toggle"!==P.type,["esri-popup__action-toggle"]:"toggle"===P.type,["esri-popup__action-toggle--on"]:"toggle"===P.type&&P.value,["esri-popup__button--disabled"]:P.disabled},S=[this.renderActionIcon(P),this.renderActionText(J)];J="menu-item"===N?C.tsx("li",{key:P.uid,role:"menuitem",tabIndex:0,title:J,"aria-label":J,class:this.classes("esri-popup__button",R),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":P.uid,
onclick:this._triggerAction,onkeydown:this._triggerAction},S):C.tsx("div",{key:P.uid,role:"button",tabIndex:0,title:J,"aria-label":J,class:this.classes("esri-popup__button",R),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":P.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},S);return P.visible?J:null};Q.renderFeatureMenuItem=function(J,P){const {messages:N,messagesCommon:R}=this,{selectedFeatureIndex:S,selectedFeatureViewModel:T}=this.viewModel;var V=J===T;const W=
{["esri-popup__feature-menu-item--selected"]:V};V=V?C.tsx("span",{key:L(`feature-menu-selected-feature-${S}`),title:N.selectedFeature,"aria-label":N.selectedFeature,class:"esri-icon-check-mark"}):null;J=C.tsx("span",{innerHTML:J.title||R.untitled});return C.tsx("li",{role:"menuitem",tabIndex:-1,key:L(`feature-menu-feature-${S}`),class:this.classes(W,"esri-popup__feature-menu-item"),bind:this,"data-feature-index":P,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature},
C.tsx("span",{class:"esri-popup__feature-menu-title"},J,V))};Q.renderFeatureMenu=function(){const {featureMenuId:J}=this,{featureViewModels:P}=this.viewModel;return 1<P.length?C.tsx("ol",{class:"esri-popup__feature-menu-list",id:J,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},P.filter(N=>!!N.graphic).map((N,R)=>this.renderFeatureMenuItem(N,R))):null};Q._getActionTitle=function(J){const {messages:P,selectedFeature:N,
messagesCommon:R}=this,{id:S}=J,T=null==N?void 0:N.attributes;return(J="zoom-to-feature"===S?G.substitute(J.title,{messages:P}):"remove-selected-feature"===S?G.substitute(J.title,{messages:R}):"zoom-to-clustered-features"===S?G.substitute(J.title,{messages:P}):"browse-clustered-features"===S?G.substitute(J.title,{messages:P}):J.title)&&T?G.substitute(J,T):J};Q._getActionClass=function(J){var {selectedFeature:P}=this;P=null==P?void 0:P.attributes;const {className:N,image:R}=J;return(J=R||N?N:"esri-icon-default-action")&&
P?G.substitute(J,P):J};Q._getActionImage=function(J){var {selectedFeature:P}=this;P=null==P?void 0:P.attributes;({image:J}=J);return J&&P?G.substitute(J,P):J};Q._createFeatureUpdatedAnimation=function(){return F.cssTransition("enter","esri-popup--feature-updated")};Q._getInlineActionCount=function(){const {maxInlineActions:J,featureNavigationVisible:P}=this;if("number"!==typeof J)return null;const N=Math.round(J);return Math.max(P?N-1:N,0)};Q._watchActions=function(){const {allActions:J}=this.viewModel;
this.notifyChange("dividedActions");this._handles.remove("actions");J&&J.forEach(P=>{this._handles.add(e.watch(P,"uid active className disabled id title image visible".split(" "),()=>this.scheduleRender()),"actions")})};Q._divideActions=function(){var {allActions:J}=this.viewModel;J=J.filter(S=>S.visible);const P=this._getInlineActionCount(),N=null===P,R=0===P;return{inlineActions:N?J.slice(0):R?new g:J.slice(0,P),menuActions:N?new g:R?J.slice(0):J.slice(P)}};Q._featureMenuOpenChanged=function(J){J?
this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0};Q._actionsMenuOpenChanged=function(J){J?this._focusFirstAction=!0:this._focusActionsMenuButton=!0};Q._setTitleFromFeatureWidget=function(){const {selectedFeatureWidget:J,messagesCommon:P}=this;if(J){var N,R;this.viewModel.title="error"===(null==(N=J.viewModel)?void 0:N.state)?P.errorMessage:(null==(R=J.viewModel)?void 0:R.title)||""}};Q._setContentFromFeatureWidget=function(){const {selectedFeatureWidget:J}=this;J&&(this.viewModel.content=
J)};Q._unobserveFeatureMenuObserver=function(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)};Q._featureMenuIntersectionObserverCreated=function(J){this._unobserveFeatureMenuObserver();this._featureMenuIntersectionObserver.observe(J);this._featureMenuIntersectionObserverNode=J};Q._handleFeatureMenuKeyup=function(J){"Escape"===h.eventKey(J)&&(J.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=
!1,this.scheduleRender())};Q._handleActionMenuKeyup=function(J){"Escape"===h.eventKey(J)&&(J.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())};Q._handleFeatureMenuItemKeyup=function(J){const P=h.eventKey(J);var {_featureMenuNode:N}=this;const R=J.currentTarget["data-feature-index"];if(N){N=N.querySelectorAll("li");var S=N.length;"ArrowUp"===P?(J.stopPropagation(),N[(R-1+S)%S].focus()):"ArrowDown"===P?(J.stopPropagation(),N[(R+1+S)%S].focus()):"Home"===
P?(J.stopPropagation(),N[0].focus()):"End"===P&&(J.stopPropagation(),N[N.length-1].focus())}};Q._handleActionMenuItemKeyup=function(J){const P=h.eventKey(J);var {_actionsMenuNode:N}=this;const R=J.currentTarget.dataset.actionUid;var {menuActions:S}=this.dividedActions;S=S.findIndex(V=>V.uid===R);if(N){N=N.querySelectorAll("li");var T=N.length;"ArrowUp"===P?(J.stopPropagation(),N[(S-1+T)%T].focus()):"ArrowDown"===P?(J.stopPropagation(),N[(S+1+T)%T].focus()):"Home"===P?(J.stopPropagation(),N[0].focus()):
"End"===P&&(J.stopPropagation(),N[N.length-1].focus())}};Q._handleMainKeyup=function(J){const P=h.eventKey(J);"ArrowLeft"===P&&(J.stopPropagation(),this.previous());"ArrowRight"===P&&(J.stopPropagation(),this.next())};Q._spinnerEnabledChange=function(J){this._destroySpinner();J&&(J=this.get("viewModel.view"),this._createSpinner(J))};Q._hideSpinner=function(){const {_spinner:J}=this;J&&(J.location=null,J.hide())};Q._displaySpinner=function(){const {_spinner:J}=this;if(J){var {location:P,waitingForResult:N}=
this.viewModel;N?J.show({location:P}):J.hide()}};Q._getIconStyles=function(J){return{"background-image":J?`url(${J})`:""}};Q._shouldFocus=function(){var J=a._asyncToGenerator(function*(P){P.shouldFocus&&(yield l.whenOnce(()=>{var N;return!0===(null==(N=this.viewModel)?void 0:N.active)}),this.focus())});return function(P){return J.apply(this,arguments)}}();Q._addSelectedFeatureIndexHandle=function(){const J=e.watch(this,"viewModel.selectedFeatureIndex",(P,N)=>this._selectedFeatureIndexUpdated(P,N));
this._handles.add(J,"selected-index")};Q._selectedFeatureIndexUpdated=function(J,P){const {featureCount:N}=this;N&&J!==P&&-1!==J&&(this.featureMenuOpen=this.actionsMenuOpen=!1)};Q._destroySelectedFeatureWidget=function(){const {_feature:J}=this;J&&(J.viewModel=null,J&&!J.destroyed&&J.destroy());this._feature=null};Q._isScreenLocationWithinView=function(J,P){return-1<J.x&&-1<J.y&&J.x<=P.width&&J.y<=P.height};Q._isOutsideView=function(J){const {popupHeight:P,popupWidth:N,screenLocation:R,side:S,view:T}=
J;if(isNaN(N)||isNaN(P)||!T||!R)return!1;J=T.padding;return"right"===S&&R.x+N/2>T.width-J.right||"left"===S&&R.x-N/2<J.left||"top"===S&&R.y-P<J.top||"bottom"===S&&R.y+P>T.height-J.bottom?!0:!1};Q._calculateAutoAlignment=function(J){if("auto"!==J)return J;const {_pointerOffsetInPx:P,_containerNode:N,_mainContainerNode:R,viewModel:S}=this,{screenLocation:T,view:V}=S;if(f.isNone(T)||!V||!N)return"top-center";if(!this._isScreenLocationWithinView(T,V))return this._get("currentAlignment")||"top-center";
var W=(J=R?window.getComputedStyle(R,null):null)?parseInt(J.getPropertyValue("max-height").replace(/[^-\d\.]/g,""),10):0,U=J?parseInt(J.getPropertyValue("height").replace(/[^-\d\.]/g,""),10):0;const {height:aa,width:da}=N.getBoundingClientRect();J=da+P;const Y=Math.max(aa,W,U)+P;W=this._isOutsideView({popupHeight:Y,popupWidth:J,screenLocation:T,side:"right",view:V});U=this._isOutsideView({popupHeight:Y,popupWidth:J,screenLocation:T,side:"left",view:V});const ea=this._isOutsideView({popupHeight:Y,
popupWidth:J,screenLocation:T,side:"top",view:V});J=this._isOutsideView({popupHeight:Y,popupWidth:J,screenLocation:T,side:"bottom",view:V});return U?ea?"bottom-right":"top-right":W?ea?"bottom-left":"top-left":ea?J?"top-center":"bottom-center":"top-center"};Q._callCurrentAlignment=function(J){return"function"===typeof J?J.call(this):J};Q._getCurrentAlignment=function(){const {alignment:J,dockEnabled:P}=this;return P||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(J)))};
Q._setCurrentAlignment=function(){this._set("currentAlignment",this._getCurrentAlignment())};Q._setCurrentDockPosition=function(){this._set("currentDockPosition",this._getCurrentDockPosition())};Q._calculatePositionResult=function(J){const P=["left","right"];F.isRTL(this.container)&&P.reverse();return J.replace(/leading/gi,P[0]).replace(/trailing/gi,P[1])};Q._callDockPosition=function(J){return"function"===typeof J?J.call(this):J};Q._getDockPosition=function(){var J;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(null==
(J=this.dockOptions)?void 0:J.position)))};Q._getCurrentDockPosition=function(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null};Q._wouldDockTo=function(){return this.dockEnabled?null:this._getDockPosition()};Q._calculateAutoDockPosition=function(J){var P;if("auto"!==J)return J;J=null==(P=this.viewModel)?void 0:P.view;P=F.isRTL(this.container)?"top-left":"top-right";if(!J)return P;var N=J.padding||{left:0,right:0,top:0,bottom:0};N=J.width-N.left-N.right;({breakpoints:J}=
J);return J&&N<=J.xsmall?"bottom-center":P};Q._positionContainer=function(J=this._containerNode){J&&(this._containerNode=J);if(J){var {screenLocation:P}=this.viewModel,{width:N}=J.getBoundingClientRect();if(P=this._calculatePositionStyle(P,N))J.style.top=P.top,J.style.left=P.left,J.style.bottom=P.bottom,J.style.right=P.right}};Q._calculateFullWidth=function(J){const {currentAlignment:P,_pointerOffsetInPx:N}=this;return"top-left"===P||"bottom-left"===P||"top-right"===P||"bottom-right"===P?J+N:J};Q._calculateAlignmentPosition=
function(J,P,N,R){const {currentAlignment:S,_pointerOffsetInPx:T}=this;R/=2;const V=N.height-P;N=N.width-J;const {padding:W}=this.view;if("bottom-center"===S)return{top:P+T-W.top,left:J-R-W.left};if("top-left"===S)return{bottom:V+T-W.bottom,right:N+T-W.right};if("bottom-left"===S)return{top:P+T-W.top,right:N+T-W.right};if("top-right"===S)return{bottom:V+T-W.bottom,left:J+T-W.left};if("bottom-right"===S)return{top:P+T-W.top,left:J+T-W.left};if("top-center"===S)return{bottom:V+T-W.bottom,left:J-R-W.left}};
Q._calculatePositionStyle=function(J,P){const {dockEnabled:N,view:R}=this;if(R){if(N)return{left:"",top:"",right:"",bottom:""};if(!f.isNone(J)&&P&&(P=this._calculateFullWidth(P),J=this._calculateAlignmentPosition(J.x,J.y,R,P)))return{top:void 0!==J.top?`${J.top}px`:"auto",left:void 0!==J.left?`${J.left}px`:"auto",bottom:void 0!==J.bottom?`${J.bottom}px`:"auto",right:void 0!==J.right?`${J.right}px`:"auto"}}};Q._viewChange=function(J,P){J&&P&&(this.close(),this.clear())};Q._viewReadyChange=function(J,
P){J?(J=this.get("viewModel.view"),this._wireUpView(J)):P&&(this.close(),this.clear())};Q._wireUpView=function(J){this._destroySpinner();if(J){var {spinnerEnabled:P}=this;P&&this._createSpinner(J);this._setDockEnabledForViewSize(this.dockOptions)}};Q._dockingThresholdCrossed=function(J,P,N){const [R,S]=J,[T,V]=P,{width:W,height:U}=N;return R<=W&&T>W||R>W&&T<=W||S<=U&&V>U||S>U&&V<=U};Q._updateDockEnabledForViewSize=function(J,P){if(J&&P){var N=this.get("viewModel.view.padding")||{left:0,right:0,top:0,
bottom:0},R=N.left+N.right,S=N.top+N.bottom;N=[];var T=[];N[0]=J[0]-R;N[1]=J[1]-S;T[0]=P[0]-R;T[1]=P[1]-S;({dockOptions:J}=this);this._dockingThresholdCrossed(N,T,J.breakpoint)&&this._setDockEnabledForViewSize(J);this._setCurrentDockPosition()}};Q._focusDockButtonNode=function(J){this._focusDockButton&&(this._focusDockButton=!1,J.focus())};Q._closeButtonNodeUpdated=function(J){this._focusClose?(this._focusClose=!1,J.focus()):this._blurClose&&(this._blurClose=!1,J.blur())};Q._mainContainerNodeUpdated=
function(J){this._mainContainerNode=J;this._focusContainer?(this._focusContainer=!1,J.focus()):this._blurContainer&&(this._blurContainer=!1,J.blur())};Q._featureMenuNodeUpdated=function(J){(this._featureMenuNode=J)&&this._focusFirstFeature&&(this._focusFirstFeature=!1,J=J.querySelectorAll("li"),J.length&&J[0].focus())};Q._actionsMenuNodeUpdated=function(J){(this._actionsMenuNode=J)&&this._focusFirstAction&&(this._focusFirstAction=!1,J=J.querySelectorAll("li"),J.length&&J[0].focus())};Q._focusFeatureMenuButtonNode=
function(J){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,J.focus())};Q._focusActionsMenuButtonNode=function(J){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,J.focus())};Q._featureMenuViewportScrollTop=function(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)};Q._toggleScreenLocationEnabled=function(){const {dockEnabled:J,viewModel:P}=this;P&&(P.screenLocationEnabled=P.active&&!J)};Q._shouldDockAtCurrentViewSize=function(J){var P,N;J=J.breakpoint;
const R=null==(P=this.viewModel)?void 0:null==(N=P.view)?void 0:N.ui;if(!R)return!1;const {width:S,height:T}=R;if(isNaN(S)||isNaN(T))return!1;P=J.hasOwnProperty("width")&&S<=J.width;N=J.hasOwnProperty("height")&&T<=J.height;return P||N};Q._setDockEnabledForViewSize=function(J){J.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(J))};Q._getPageText=function(J,P){return this.featureNavigationVisible?G.substitute(this.messages.pageText,{index:P+1,total:J}):null};Q._destroySpinner=function(){const {_spinner:J,
view:P}=this;J&&(P&&P.ui&&P.ui.remove(this._spinner,"popup-spinner"),J.destroy(),this._spinner=null)};Q._createSpinner=function(J){J&&(this._spinner=new x({view:J}),J.ui.add(this._spinner,{key:"popup-spinner",position:"manual"}))};Q._toggleCollapsed=function(){this.collapsed=!this.collapsed};Q._close=function(){this.close();this.view&&this.view.focus()};Q._toggleDockEnabled=function(){this.dockEnabled=!this.dockEnabled;this._focusDockButton=!0;this.scheduleRender()};Q._toggleFeatureMenu=function(){const J=
!this.featureMenuOpen;this._featureMenuOpenChanged(J);this.actionsMenuOpen=!1;this.featureMenuOpen=J};Q._toggleActionsMenu=function(){const J=!this.actionsMenuOpen;this._actionsMenuOpenChanged(J);this.featureMenuOpen=!1;this.actionsMenuOpen=J};Q._triggerAction=function(J){const P=J.currentTarget.dataset.actionUid;var {allActions:N}=this.viewModel;J=N.findIndex(R=>R.uid===P);(N=N.getItemAt(J))&&"toggle"===N.type&&(N.value=!N.value);this.actionsMenuOpen=!1;this.viewModel.triggerAction(J)};Q._selectFeature=
function(J){J=J.currentTarget["data-feature-index"];isNaN(J)||(this.viewModel.selectedFeatureIndex=J);this.featureMenuOpen=!1;this._focusFeatureMenuButton=!0;this.scheduleRender()};Q._next=function(){this.next()};Q._previous=function(){this.previous()};a._createClass(O,[{key:"actionsMenuId",get:function(){return`${this.id}-actions-menu`}},{key:"actionsMenuButtonId",get:function(){return`${this.id}-actions-menu-button`}},{key:"featureMenuId",get:function(){return`${this.id}-feature-menu`}},{key:"titleId",
get:function(){return`${this.id}-popup-title`}},{key:"contentId",get:function(){return`${this.id}-popup-content`}},{key:"hasContent",get:function(){var J,P,N,R,S,T,V;return!!(this.selectedFeatureWidget?(null==(J=this.selectedFeatureWidget)?0:null==(P=J.viewModel)?0:P.waitingForContent)||"error"===(null==(N=this.selectedFeatureWidget)?void 0:null==(R=N.viewModel)?void 0:R.state)||(null==(S=this.selectedFeatureWidget)?0:null==(T=S.viewModel)?0:T.content):null==(V=this.viewModel)?0:V.content)}},{key:"featureNavigationVisible",
get:function(){return this.viewModel.active&&1<this.viewModel.featureCount&&this.visibleElements.featureNavigation}},{key:"collapsible",get:function(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}},{key:"featureMenuVisible",get:function(){return this.featureNavigationVisible&&this.featureMenuOpen}},{key:"contentCollapsed",get:function(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}},{key:"dividedActions",get:function(){return this._divideActions()}},{key:"actionsMenuOpen",
get:function(){return this.viewModel.active?this._get("actionsMenuOpen"):!1},set:function(J){this._set("actionsMenuOpen",!!J)}},{key:"currentAlignment",get:function(){return this._getCurrentAlignment()}},{key:"currentDockPosition",get:function(){return this._getCurrentDockPosition()}},{key:"dockOptions",get:function(){return this._get("dockOptions")||H},set:function(J){var P={...H};const N=this.get("viewModel.view.breakpoints");var R={};N&&(R.width=N.xsmall,R.height=N.xsmall);J={...P,...J};P={...P.breakpoint,
...R};({breakpoint:R}=J);!0===R?J.breakpoint=P:"object"===typeof R&&(J.breakpoint={...P,...R});this._set("dockOptions",J);this._setCurrentDockPosition();this.reposition()}},{key:"selectedFeatureWidget",get:function(){const {_feature:J,visibleElements:P,headingLevel:N}=this,{selectedFeatureViewModel:R}=this.viewModel,S={...P,title:!1};if(!R)return null;J?(J.viewModel=R,J.visibleElements=S):this._feature=new r({headingLevel:N+1,viewModel:R,visibleElements:S});return this._feature}}]);return O}(E.FeatureContentMixin(u));
b.__decorate([q.property({readOnly:!0})],c.prototype,"actionsMenuId",null);b.__decorate([q.property({readOnly:!0})],c.prototype,"actionsMenuButtonId",null);b.__decorate([q.property({readOnly:!0})],c.prototype,"featureMenuId",null);b.__decorate([q.property({readOnly:!0})],c.prototype,"titleId",null);b.__decorate([q.property({readOnly:!0})],c.prototype,"contentId",null);b.__decorate([q.property({readOnly:!0})],c.prototype,"hasContent",null);b.__decorate([q.property({readOnly:!0})],c.prototype,"featureNavigationVisible",
null);b.__decorate([q.property({readOnly:!0})],c.prototype,"collapsible",null);b.__decorate([q.property({readOnly:!0})],c.prototype,"featureMenuVisible",null);b.__decorate([q.property({readOnly:!0})],c.prototype,"contentCollapsed",null);b.__decorate([q.property({readOnly:!0})],c.prototype,"dividedActions",null);b.__decorate([d.aliasOf("viewModel.actions")],c.prototype,"actions",void 0);b.__decorate([q.property()],c.prototype,"actionsMenuOpen",null);b.__decorate([q.property()],c.prototype,"alignment",
void 0);b.__decorate([d.aliasOf("viewModel.autoCloseEnabled")],c.prototype,"autoCloseEnabled",void 0);b.__decorate([d.aliasOf("viewModel.autoOpenEnabled")],c.prototype,"autoOpenEnabled",void 0);b.__decorate([d.aliasOf("viewModel.defaultPopupTemplateEnabled")],c.prototype,"defaultPopupTemplateEnabled",void 0);b.__decorate([d.aliasOf("viewModel.content")],c.prototype,"content",void 0);b.__decorate([q.property()],c.prototype,"collapsed",void 0);b.__decorate([q.property()],c.prototype,"collapseEnabled",
void 0);b.__decorate([q.property({readOnly:!0})],c.prototype,"currentAlignment",null);b.__decorate([q.property({readOnly:!0})],c.prototype,"currentDockPosition",null);b.__decorate([q.property()],c.prototype,"dockOptions",null);b.__decorate([q.property()],c.prototype,"dockEnabled",void 0);b.__decorate([d.aliasOf("viewModel.featureCount")],c.prototype,"featureCount",void 0);b.__decorate([q.property()],c.prototype,"featureMenuOpen",void 0);b.__decorate([d.aliasOf("viewModel.features")],c.prototype,"features",
void 0);b.__decorate([d.aliasOf("viewModel.goToOverride")],c.prototype,"goToOverride",void 0);b.__decorate([q.property()],c.prototype,"headingLevel",void 0);b.__decorate([d.aliasOf("viewModel.highlightEnabled")],c.prototype,"highlightEnabled",void 0);b.__decorate([d.aliasOf("viewModel.location")],c.prototype,"location",void 0);b.__decorate([q.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],c.prototype,"label",void 0);b.__decorate([q.property()],c.prototype,"maxInlineActions",void 0);
b.__decorate([q.property(),B.messageBundle("esri/widgets/Popup/t9n/Popup")],c.prototype,"messages",void 0);b.__decorate([q.property(),B.messageBundle("esri/t9n/common")],c.prototype,"messagesCommon",void 0);b.__decorate([d.aliasOf("viewModel.promises")],c.prototype,"promises",void 0);b.__decorate([d.aliasOf("viewModel.selectedFeature")],c.prototype,"selectedFeature",void 0);b.__decorate([d.aliasOf("viewModel.selectedFeatureIndex")],c.prototype,"selectedFeatureIndex",void 0);b.__decorate([q.property({readOnly:!0})],
c.prototype,"selectedFeatureWidget",null);b.__decorate([q.property()],c.prototype,"spinnerEnabled",void 0);b.__decorate([d.aliasOf("viewModel.title")],c.prototype,"title",void 0);b.__decorate([d.aliasOf("viewModel.updateLocationEnabled")],c.prototype,"updateLocationEnabled",void 0);b.__decorate([d.aliasOf("viewModel.view")],c.prototype,"view",void 0);b.__decorate([q.property({type:y}),D.vmEvent(["triggerAction","trigger-action"])],c.prototype,"viewModel",void 0);b.__decorate([d.aliasOf("viewModel.visible")],
c.prototype,"visible",void 0);b.__decorate([q.property()],c.prototype,"visibleElements",void 0);b.__decorate([v.cast("visibleElements")],c.prototype,"castVisibleElements",null);b.__decorate([p.accessibleHandler()],c.prototype,"_close",null);b.__decorate([p.accessibleHandler()],c.prototype,"_toggleDockEnabled",null);b.__decorate([p.accessibleHandler()],c.prototype,"_toggleFeatureMenu",null);b.__decorate([p.accessibleHandler()],c.prototype,"_toggleActionsMenu",null);b.__decorate([p.accessibleHandler()],
c.prototype,"_triggerAction",null);b.__decorate([p.accessibleHandler()],c.prototype,"_selectFeature",null);b.__decorate([p.accessibleHandler()],c.prototype,"_next",null);b.__decorate([p.accessibleHandler()],c.prototype,"_previous",null);return c=b.__decorate([t.subclass("esri.widgets.Popup")],c)})},"esri/core/throttle":function(){define(["exports"],function(a){a.throttle=function(b,c,g,h){let w=null,n=1E3;"number"===typeof c?(n=c,h=g):(w=null!=c?c:null,n=g);let f=0,l;const k=()=>{f=0;b.apply(h,l)};
c=(...e)=>{w&&w.apply(h,e);l=e;n?f||(f=setTimeout(k,n)):k()};c.remove=()=>{f&&(clearTimeout(f),f=0)};c.forceUpdate=()=>{f&&(clearTimeout(f),k())};c.hasPendingUpdates=()=>!!f;return c};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Feature":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../intl ../core/watchUtils ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./Feature/FeatureAttachments ./Feature/FeatureContent ./Feature/FeatureExpression ./Feature/FeatureFields ./Feature/FeatureMedia ./Feature/FeatureViewModel ./Feature/support/FeatureContentMixin ./support/Heading ./support/widgetUtils ./support/decorators/messageBundle ../core/Logger ./support/jsxFactory ../intl/substitute".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B){const D={title:!0,content:!0,lastEditedInfo:!0};g=function(C){function F(L,H){L=C.call(this,L,H)||this;L._contentWidgets=[];L.graphic=null;L.defaultPopupTemplateEnabled=!1;L.headingLevel=2;L.label=void 0;L.messages=null;L.messagesCommon=null;L.messagesURIUtils=null;L.spatialReference=null;L.title=null;L.visibleElements={...D};L.map=null;L.view=null;L.viewModel=new r;return L}b._inheritsLoose(F,C);var G=F.prototype;G.initialize=function(){this.own(h.init(this,
"viewModel.contentViewModels",()=>this._setupContentWidgets()))};G.loadDependencies=function(){return new Promise((L,H)=>a(["../chunks/calcite-notice"],L,H))};G.destroy=function(){this._destroyContentWidgets()};G.castVisibleElements=function(L){return{...D,...L}};G.render=function(){var {state:L}=this.viewModel;L=p.tsx("div",{class:"esri-feature__size-container",key:"container"},this.renderTitle(),"error"===L?this.renderError():"loading"===L?this.renderLoading():this.renderContentContainer());return p.tsx("div",
{class:this.classes("esri-feature","esri-widget")},L)};G.setActiveMedia=function(L,H){this.viewModel.setActiveMedia(L,H)};G.nextMedia=function(L){this.viewModel.nextMedia(L)};G.previousMedia=function(L){this.viewModel.previousMedia(L)};G.renderError=function(){const {messagesCommon:L,messages:H,visibleElements:M}=this;return p.tsx("calcite-notice",{active:!0,color:"red",icon:"exclamation-mark-circle",scale:"s"},M.title?p.tsx("div",{key:"error-title",slot:"title"},L.errorMessage):null,p.tsx("div",
{key:"error-message",slot:"message"},H.loadingError))};G.renderLoading=function(){return p.tsx("div",{key:"loading-container",class:"esri-feature__loading-container"},p.tsx("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")}))};G.renderContentContainer=function(){const {visibleElements:L}=this;return L.content?p.tsx("div",{class:"esri-feature__main-container"},[this.renderContent(),this.renderLastEditInfo()]):null};G.renderTitle=function(){const {visibleElements:L,
title:H}=this;return L.title?p.tsx(u.Heading,{level:this.headingLevel,class:"esri-feature__title",innerHTML:H}):null};G.renderContent=function(){var L=this.viewModel.content;return L?Array.isArray(L)?L.length?p.tsx("div",{key:"content-content-elements"},L.map(this.renderContentElement,this)):null:"string"===typeof L?(L=this._contentWidgets[0],!L||L.destroyed?null:p.tsx("div",{key:"content-content"},L.render())):this.renderNodeContent(L):null};G.renderContentElement=function(L,H){const {visibleElements:M}=
this;if("boolean"!==typeof M.content&&!M.content[L.type])return null;switch(L.type){case "attachments":return this.renderAttachments(H);case "custom":return this.renderCustom(L,H);case "fields":return this.renderFields(H);case "media":return this.renderMedia(H);case "text":return this.renderText(L,H);case "expression":return this.renderExpression(H);default:return null}};G.renderAttachments=function(L){const H=this._contentWidgets[L];if(!H||H.destroyed)return null;const {state:M,attachmentInfos:K}=
H.viewModel;return"loading"===M||0<K.length?p.tsx("div",{key:this._buildKey("attachments-element",L),class:this.classes("esri-feature__content-element")},H.render()):null};G.renderExpression=function(L){const H=this._contentWidgets[L];return!H||H.destroyed?null:p.tsx("div",{key:this._buildKey("expression-element",L),class:"esri-feature__content-element"},H.render())};G.renderCustom=function(L,H){({creator:L}=L);const M=this._contentWidgets[H];return!M||M.destroyed?null:L?p.tsx("div",{key:this._buildKey("custom-element",
H),class:"esri-feature__content-element"},M.render()):null};G.renderFields=function(L){const H=this._contentWidgets[L];return!H||H.destroyed?null:p.tsx("div",{key:this._buildKey("fields-element",L),class:"esri-feature__content-element"},H.render())};G.renderMedia=function(L){const H=this._contentWidgets[L];return!H||H.destroyed?null:p.tsx("div",{key:this._buildKey("media-element",L),class:"esri-feature__content-element"},H.render())};G.renderLastEditInfo=function(){const {visibleElements:L,messages:H}=
this;var {lastEditInfo:M}=this.viewModel;if(!M||!L.lastEditedInfo)return null;const {date:K,user:I}=M;M=B.substitute("edit"===M.type?I?H.lastEditedByUser:H.lastEdited:I?H.lastCreatedByUser:H.lastCreated,{date:K,user:I});return p.tsx("div",{key:"edit-info-element",class:this.classes("esri-feature__last-edited-info","esri-feature__content-element")},M)};G.renderText=function(L,H){const M=this._contentWidgets[H];return!M||M.destroyed?null:L.text?p.tsx("div",{key:this._buildKey("text-element",H),class:this.classes("esri-feature__content-element",
"esri-feature__text")},M.render()):null};G._buildKey=function(L,...H){const M=this.get("viewModel.graphic.uid")||"0";H=H.join("-");return`${L}__${M}-${H}`};G._destroyContentWidget=function(L){L&&(L.viewModel=null,!L.destroyed&&L.destroy())};G._destroyContentWidgets=function(){this._contentWidgets.forEach(L=>this._destroyContentWidget(L));this._contentWidgets=[]};G._setupContentWidgets=function(){this._destroyContentWidgets();const {headingLevel:L,visibleElements:H}=this;var M=this.get("viewModel.content");
const {contentViewModels:K}=this.viewModel;Array.isArray(M)?M.forEach((I,O)=>{"attachments"===I.type&&(this._contentWidgets[O]=new m({displayType:I.displayType,headingLevel:H.title?L+1:L,viewModel:K[O]}));"fields"===I.type&&(this._contentWidgets[O]=new q({viewModel:K[O]}));"media"===I.type&&(this._contentWidgets[O]=new t({viewModel:K[O]}));"text"===I.type&&(this._contentWidgets[O]=new z({viewModel:K[O]}));"custom"===I.type&&(this._contentWidgets[O]=new z({viewModel:K[O]}));"expression"===I.type&&
(this._contentWidgets[O]=new v({viewModel:K[O]}))},this):(M=K[0])&&!M.destroyed&&(this._contentWidgets[0]=new z({viewModel:M}));this.scheduleRender()};return F}(x.FeatureContentMixin(d));c.__decorate([w.aliasOf("viewModel.graphic")],g.prototype,"graphic",void 0);c.__decorate([w.aliasOf("viewModel.defaultPopupTemplateEnabled")],g.prototype,"defaultPopupTemplateEnabled",void 0);c.__decorate([k.property()],g.prototype,"headingLevel",void 0);c.__decorate([k.property({aliasOf:{source:"messages.widgetLabel",
overridable:!0}})],g.prototype,"label",void 0);c.__decorate([k.property(),y.messageBundle("esri/widgets/Feature/t9n/Feature")],g.prototype,"messages",void 0);c.__decorate([k.property(),y.messageBundle("esri/t9n/common")],g.prototype,"messagesCommon",void 0);c.__decorate([k.property(),y.messageBundle("esri/widgets/support/t9n/uriUtils")],g.prototype,"messagesURIUtils",void 0);c.__decorate([w.aliasOf("viewModel.spatialReference")],g.prototype,"spatialReference",void 0);c.__decorate([w.aliasOf("viewModel.title")],
g.prototype,"title",void 0);c.__decorate([k.property()],g.prototype,"visibleElements",void 0);c.__decorate([l.cast("visibleElements")],g.prototype,"castVisibleElements",null);c.__decorate([w.aliasOf("viewModel.map")],g.prototype,"map",void 0);c.__decorate([w.aliasOf("viewModel.view")],g.prototype,"view",void 0);c.__decorate([k.property({type:r})],g.prototype,"viewModel",void 0);return g=c.__decorate([e.subclass("esri.widgets.Feature")],g)})},"esri/widgets/Feature/FeatureAttachments":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/watchUtils ../../core/accessorSupport/decorators/aliasOf ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass ../Attachments ../Widget ./FeatureAttachments/FeatureAttachmentsViewModel ./support/FeatureElementInfo ../support/widgetUtils ../../core/Logger ../support/jsxFactory".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q){h=function(t){function r(u,E){u=t.call(this,u,E)||this;u._featureElementInfo=null;u.attachmentsWidget=new k;u.description=null;u.displayType=null;u.graphic=null;u.headingLevel=2;u.title=null;u.viewModel=new d;return u}a._inheritsLoose(r,t);var x=r.prototype;x.initialize=function(){this._featureElementInfo=new m;c.init(this,["viewModel.description","viewModel.title","headingLevel"],()=>this._setupFeatureElementInfo());c.init(this,"viewModel.graphic",u=>this.attachmentsWidget.graphic=
u)};x.destroy=function(){this.attachmentsWidget.destroy();this._featureElementInfo.destroy()};x.render=function(){var u;const {attachmentsWidget:E}=this;return q.tsx("div",{class:"esri-feature-attachments"},null==(u=this._featureElementInfo)?void 0:u.render(),null==E?void 0:E.render())};x._setupFeatureElementInfo=function(){const {description:u,title:E,headingLevel:y}=this;this._featureElementInfo.set({description:u,title:E,headingLevel:y})};return r}(e);b.__decorate([f.property({readOnly:!0})],h.prototype,
"attachmentsWidget",void 0);b.__decorate([g.aliasOf("viewModel.description")],h.prototype,"description",void 0);b.__decorate([g.aliasOf("attachmentsWidget.displayType")],h.prototype,"displayType",void 0);b.__decorate([g.aliasOf("viewModel.graphic")],h.prototype,"graphic",void 0);b.__decorate([f.property()],h.prototype,"headingLevel",void 0);b.__decorate([g.aliasOf("viewModel.title")],h.prototype,"title",void 0);b.__decorate([f.property({type:d})],h.prototype,"viewModel",void 0);return h=b.__decorate([l.subclass("esri.widgets.Feature.FeatureAttachments")],
h)})},"esri/widgets/Attachments":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Error ../core/unitFormatUtils ../core/watchUtils ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./Attachments/AttachmentsViewModel ./Attachments/support/attachmentUtils ./support/widgetUtils ./support/decorators/messageBundle ../core/Logger ./support/jsxFactory".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r){const x={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},u=window.CSS;n=function(E){function y(p,B){p=E.call(this,p,B)||this;p.abilities=null;p.displayType="auto";p.graphic=null;p.label=void 0;p.messages=null;p.messagesUnits=null;p.selectedFile=null;p.submitting=!1;p.viewModel=new m;p.visibleElements={...x};p._supportsImageOrientation=u&&u.supports&&u.supports("image-orientation",
"from-image");p._addAttachmentForm=null;p._updateAttachmentForm=null;return p}a._inheritsLoose(y,E);var A=y.prototype;A.initialize=function(){this.own(h.on(this,"viewModel.attachmentInfos","change",()=>this.scheduleRender()),h.init(this,"viewModel.mode",()=>this._modeChanged()))};A.castVisibleElements=function(p){return{...x,...p}};A.addAttachment=function(){const {_addAttachmentForm:p,viewModel:B}=this;this._set("submitting",!0);this._set("error",null);return B.addAttachment(p).then(D=>{this._set("submitting",
!1);this._set("error",null);B.mode="view";return D}).catch(D=>{this._set("submitting",!1);this._set("error",new c("attachments:add-attachment",this.messages.addErrorMessage,D));throw D;})};A.deleteAttachment=function(p){const {viewModel:B}=this;this._set("submitting",!0);this._set("error",null);return B.deleteAttachment(p).then(D=>{this._set("submitting",!1);this._set("error",null);B.mode="view";return D}).catch(D=>{this._set("submitting",!1);this._set("error",new c("attachments:delete-attachment",
this.messages.deleteErrorMessage,D));throw D;})};A.updateAttachment=function(){const {viewModel:p}=this,{_updateAttachmentForm:B}=this;this._set("submitting",!0);this._set("error",null);return p.updateAttachment(B).then(D=>{this._set("submitting",!1);this._set("error",null);p.mode="view";return D}).catch(D=>{this._set("submitting",!1);this._set("error",new c("attachments:update-attachment",this.messages.updateErrorMessage,D));throw D;})};A.render=function(){const {submitting:p,viewModel:B}=this,{state:D}=
B;return r.tsx("div",{class:this.classes("esri-attachments","esri-widget")},p?this.renderProgressBar():null,"loading"===D?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())};A.renderErrorMessage=function(){const {error:p,visibleElements:B}=this;return p&&B.errorMessage?r.tsx("div",{key:"error-message",class:"esri-attachments__error-message"},p.message):null};A.renderAttachments=function(){const {mode:p,activeAttachmentInfo:B}=this.viewModel;return"add"===p?this.renderAddForm():
"edit"===p?this.renderDetailsForm(B):this.renderAttachmentContainer()};A.renderLoading=function(){return r.tsx("div",{class:"esri-attachments__loader-container",key:"loader"},r.tsx("div",{class:"esri-attachments__loader"}))};A.renderProgressBar=function(){return this.visibleElements.progressBar?r.tsx("div",{class:"esri-attachments__progress-bar",key:"progress-bar"}):null};A.renderAddForm=function(){const {submitting:p,selectedFile:B}=this;var D=p||!B,C=this.visibleElements.cancelAddButton?r.tsx("button",
{type:"button",bind:this,disabled:p,onclick:this._cancelForm,class:this.classes("esri-button","esri-button--tertiary","esri-button--small","esri-button--half",p&&"esri-button--disabled")},this.messages.cancel):null;D=this.visibleElements.addSubmitButton?r.tsx("button",{type:"submit",disabled:D,class:this.classes("esri-button","esri-button--secondary","esri-button--small","esri-button--half",{["esri-button--disabled"]:D})},this.messages.add):null;const F=B?r.tsx("span",{key:"file-name",class:"esri-attachments__file-name"},
B.name):null;C=r.tsx("form",{bind:this,afterCreate:v.storeNode,afterRemoved:v.discardNode,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},r.tsx("fieldset",{class:"esri-attachments__file-fieldset"},F,r.tsx("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},B?this.messages.changeFile:this.messages.selectFile,r.tsx("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),
D,C);return r.tsx("div",{key:"add-form-container",class:"esri-attachments__form-node"},C)};A.renderDetailsForm=function(p){const {visibleElements:B,viewModel:D,selectedFile:C,submitting:F}=this,{contentType:G,size:L,url:H}=p;var {abilities:M}=D,K=F||!C,I=M.editing&&M.operations.delete&&B.deleteButton?r.tsx("button",{key:"delete-button",type:"button",disabled:F,bind:this,onclick:P=>this._submitDeleteAttachment(P,p),class:this.classes("esri-button","esri-button--small","esri-button--tertiary","esri-attachments__delete-button",
{["esri-button--disabled"]:F})},this.messages.delete):null;K=M.editing&&M.operations.update&&B.updateButton?r.tsx("button",{disabled:K,key:"update-button",type:"submit",class:this.classes("esri-button","esri-button--small","esri-button--third",{["esri-button--disabled"]:K})},this.messages.update):null;const O=this.visibleElements.cancelUpdateButton?r.tsx("button",{disabled:F,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes("esri-button","esri-button--small",
"esri-button--tertiary","esri-button--third",{["esri-button--disabled"]:F})},this.messages.cancel):null;var Q=C?r.tsx("span",{key:"file-name",class:"esri-attachments__file-name"},C.name):null;M=M.editing&&M.operations.update?r.tsx("fieldset",{key:"file",class:"esri-attachments__file-fieldset"},Q,r.tsx("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},this.messages.changeFile,r.tsx("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",
bind:this,onchange:this._handleFileInputChange}))):null;Q=r.tsx("fieldset",{key:"size",class:"esri-attachments__metadata-fieldset"},r.tsx("label",null,g.formatFileSize(this.messagesUnits,L)));const J=r.tsx("fieldset",{key:"content-type",class:"esri-attachments__metadata-fieldset"},r.tsx("label",null,G));I=r.tsx("form",{bind:this,afterCreate:v.storeNode,afterRemoved:v.discardNode,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},r.tsx("div",{class:"esri-attachments__metadata"},
Q,J),M,r.tsx("div",{class:"esri-attachments__actions"},I,O,K));return r.tsx("div",{key:"edit-form-container",class:"esri-attachments__form-node"},r.tsx("a",{class:"esri-attachments__item-link",href:H,rel:"noreferrer",target:"_blank"},this.renderImageMask({attachmentInfo:p,size:400}),r.tsx("div",{class:"esri-attachments__item-link-overlay"},r.tsx("span",{class:"esri-attachments__item-link-overlay-icon"},r.tsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},r.tsx("path",
{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),r.tsx("path",{fill:"none",d:"M0 0h32v32H0z"}))))),I)};A.renderImageMask=function({attachmentInfo:p,size:B}){var {supportsResizeAttachments:D}=this.viewModel;const {contentType:C,name:F,url:G}=p,L=D&&z.isSupportedImage(C);p=(p=this._getCSSTransform(p,L))?{transform:p,"image-orientation":"none"}:{};const H=-1===G.indexOf("?")?"?":"\x26";B=L?`${G}${H}w=${B}`:z.getIconPath(C);D={["esri-attachments__image--resizable"]:D};
return r.tsx("div",{class:this.classes({["esri-attachments__item-mask--icon"]:!L},"esri-attachments__item-mask")},r.tsx("img",{styles:p,alt:F,src:B,class:this.classes(D,"esri-attachments__image")}))};A.renderAttachmentInfo=function({attachmentInfo:p,displayType:B}){var {viewModel:D}=this;({abilities:D}=D);const {name:C,url:F}=p;B=this.renderImageMask({attachmentInfo:p,size:"list"===B?48:400});var G=D.editing?r.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-chevron-icon",
v.isRTL(this.container)?"esri-icon-left":"esri-icon-right")}):null;G=r.tsx("label",{class:"esri-attachments__label"},r.tsx("span",{class:"esri-attachments__filename"},C||this.messages.noTitle),G);B=[B,G];D=D.editing?r.tsx("button",{key:"details-button",bind:this,class:"esri-attachments__item-button",title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":p.id,onclick:()=>this._startEditAttachment(p),type:"button"},B):r.tsx("a",{key:"details-link",
class:"esri-attachments__item-button",href:F,target:"_blank"},B);return r.tsx("li",{class:"esri-attachments__item",key:p},D)};A.renderAttachmentContainer=function(){const {effectiveDisplayType:p,viewModel:B,visibleElements:D}=this,{attachmentInfos:C,abilities:F}=B;var G=C&&C.length;const L={["esri-attachments__container--list"]:"preview"!==p,["esri-attachments__container--preview"]:"preview"===p},H=F.editing&&F.operations.add&&D.addButton?r.tsx("button",{bind:this,onclick:()=>this._startAddAttachment(),
class:this.classes("esri-button","esri-button--tertiary","esri-attachments__add-attachment-button"),type:"button"},r.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-add-icon","esri-icon-plus")}),this.messages.add):null;G=G?r.tsx("ul",{class:"esri-attachments__items"},C.toArray().map(M=>this.renderAttachmentInfo({attachmentInfo:M,displayType:p}))):r.tsx("div",{class:"esri-widget__content--empty"},this.messages.noAttachments);return r.tsx("div",{key:"attachments-container",
class:this.classes("esri-attachments__container",L)},G,H)};A._modeChanged=function(){this._set("error",null);this._set("selectedFile",null)};A._handleFileInputChange=function(p){p=(p=p.target)&&p.files&&p.files.item(0);this._set("selectedFile",p)};A._submitDeleteAttachment=function(p,B){p.preventDefault();this.deleteAttachment(B)};A._submitAddAttachment=function(p){p.preventDefault();this.addAttachment()};A._submitUpdateAttachment=function(p){p.preventDefault();this.updateAttachment()};A._startEditAttachment=
function(p){const {viewModel:B}=this;B.activeAttachmentInfo=p;B.mode="edit"};A._startAddAttachment=function(){this.viewModel.mode="add"};A._cancelForm=function(p){p.preventDefault();this.viewModel.mode="view"};A._getCSSTransform=function(p,B){({orientationInfo:p}=p);return!this._supportsImageOrientation&&B&&p?[p.rotation?`rotate(${p.rotation}deg)`:"",p.mirrored?"scaleX(-1)":""].join(" "):""};a._createClass(y,[{key:"effectiveDisplayType",get:function(){const {displayType:p}=this;return p&&"auto"!==
p?p:this.viewModel.supportsResizeAttachments?"preview":"list"}}]);return y}(d);b.__decorate([w.aliasOf("viewModel.abilities")],n.prototype,"abilities",void 0);b.__decorate([k.property()],n.prototype,"displayType",void 0);b.__decorate([k.property({readOnly:!0})],n.prototype,"effectiveDisplayType",null);b.__decorate([w.aliasOf("viewModel.graphic")],n.prototype,"graphic",void 0);b.__decorate([k.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],n.prototype,"label",void 0);b.__decorate([k.property(),
q.messageBundle("esri/widgets/Attachments/t9n/Attachments")],n.prototype,"messages",void 0);b.__decorate([k.property(),q.messageBundle("esri/core/t9n/Units")],n.prototype,"messagesUnits",void 0);b.__decorate([k.property({readOnly:!0})],n.prototype,"selectedFile",void 0);b.__decorate([k.property({readOnly:!0})],n.prototype,"submitting",void 0);b.__decorate([k.property({readOnly:!0})],n.prototype,"error",void 0);b.__decorate([k.property({type:m})],n.prototype,"viewModel",void 0);b.__decorate([k.property()],
n.prototype,"visibleElements",void 0);b.__decorate([l.cast("visibleElements")],n.prototype,"castVisibleElements",null);return n=b.__decorate([e.subclass("esri.widgets.Attachments")],n)})},"esri/core/unitFormatUtils":function(){define("exports ./byteSizeEstimations ./mathUtils ./string ./unitUtils ../intl/number".split(" "),function(a,b,c,g,h,w){function n(k,e,d){return k.units[e][d]}function f(k,e,d,m=2,z="abbr"){return`${w.formatNumber(e,{minimumFractionDigits:m,maximumFractionDigits:m})} ${n(k,
d,z)}`}const l=["B","kB","MB","GB","TB"];a.formatAngleDegrees=function(k,e,d=2){k=h.convertUnit(k,e,"degrees");return w.formatNumber(k,{style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:d,minimumFractionDigits:d})};a.formatDMS=function(k,e,d=2){k=h.convertUnit(k,e,"degrees");e=k-Math.floor(k);k-=e;e*=60;let m=e-Math.floor(e);e-=m;m*=60;return`${k.toFixed()}\u00b0 ${e.toFixed()}' ${m.toFixed(d)}"`};a.formatDecimal=f;a.formatFileSize=function(k,e){let d=0===e?0:Math.floor(Math.log(e)/
Math.log(b.ByteSizeUnit.KILOBYTES));d=c.clamp(d,0,l.length-1);e=w.formatNumber(e/b.ByteSizeUnit.KILOBYTES**d,{maximumFractionDigits:2});return g.replace(k.units.bytes[l[d]],{fileSize:e})};a.formatImperialArea=function(k,e,d,m=2,z="abbr"){const v=h.preferredImperialAreaUnit(e,d);return f(k,h.convertUnit(e,d,v),v,m,z)};a.formatImperialLength=function(k,e,d,m=2,z="abbr"){const v=h.preferredImperialLengthUnit(e,d);return f(k,h.convertUnit(e,d,v),v,m,z)};a.formatImperialVerticalLength=function(k,e,d,m=
2,z="abbr"){const v=h.preferredImperialVerticalLengthUnit(e,d);return f(k,h.convertUnit(e,d,v),v,m,z)};a.formatMetricArea=function(k,e,d,m=2,z="abbr"){const v=h.preferredMetricAreaUnit(e,d);return f(k,h.convertUnit(e,d,v),v,m,z)};a.formatMetricLength=function(k,e,d,m=2,z="abbr"){const v=h.preferredMetricLengthUnit(e,d);return f(k,h.convertUnit(e,d,v),v,m,z)};a.formatMetricVerticalLength=function(k,e,d,m=2,z="abbr"){const v=h.preferredMetricVerticalLengthUnit(e,d);return f(k,h.convertUnit(e,d,v),v,
m,z)};a.unitName=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Attachments/AttachmentsViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../core/Collection ../../core/Error ../../core/HandleOwner ../../core/maybe ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../rest/query/support/AttachmentInfo ../../rest/support/AttachmentQuery ../Feature/support/featureUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q){const t={editing:!1,operations:{add:!0,update:!0,delete:!0}},r=g.ofType(z);g=function(x){function u(y){var A=x.call(this,y)||this;A._getAttachmentsPromise=null;A._attachmentLayer=null;A.abilities={...t};A.activeAttachmentInfo=null;A.attachmentInfos=new r;A.graphic=null;A.mode="view";A.handles.add([f.init(a._assertThisInitialized(A),"graphic",()=>A._graphicChanged())]);return A}a._inheritsLoose(u,x);var E=u.prototype;E.destroy=function(){this.graphic=this._attachmentLayer=
null};E.castAbilities=function(y){return{...t,...y}};E.getAttachments=function(){var y=a._asyncToGenerator(function*(){const {_attachmentLayer:A,attachmentInfos:p}=this;if(!A||"function"!==typeof A.queryAttachments)throw new h("invalid-layer","getAttachments(): A valid layer is required.");const B=this._getFeatureId();var D=new v({objectIds:[B],returnMetadata:!0});const C=[];this._getAttachmentsPromise=D=A.queryAttachments(D).then(F=>F[B]||C).catch(()=>C);this.notifyChange("state");D=yield D;p.removeAll();
D.length&&p.addMany(D);this._getAttachmentsPromise=null;this.notifyChange("state");return D});return function(){return y.apply(this,arguments)}}();E.addAttachment=function(){var y=a._asyncToGenerator(function*(A){const {_attachmentLayer:p,attachmentInfos:B,graphic:D,abilities:C}=this;if(!A)throw new h("invalid-attachment","addAttachment(): An attachment is required.",{attachment:A});if(!C.operations.add)throw new h("invalid-abilities","addAttachment(): add abilities are required.");if(!p||"function"!==
typeof p.addAttachment)throw new h("invalid-layer","addAttachment(): A valid layer is required.");A=yield p.addAttachment(D,A).then(F=>this._queryAttachment(F.objectId));B.add(A);return A});return function(A){return y.apply(this,arguments)}}();E.deleteAttachment=function(){var y=a._asyncToGenerator(function*(A){const {_attachmentLayer:p,attachmentInfos:B,graphic:D,abilities:C}=this;if(!A)throw new h("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:A});
if(!C.operations.delete)throw new h("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!p||"function"!==typeof p.deleteAttachments)throw new h("invalid-layer","deleteAttachment(): A valid layer is required.");const F=yield p.deleteAttachments(D,[A.id]).then(()=>A);B.remove(F);return F});return function(A){return y.apply(this,arguments)}}();E.updateAttachment=function(){var y=a._asyncToGenerator(function*(A,p=this.activeAttachmentInfo){const {_attachmentLayer:B,attachmentInfos:D,
graphic:C,abilities:F}=this;if(!A)throw new h("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:A});if(!p)throw new h("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:p});if(!F.operations.update)throw new h("invalid-abilities","updateAttachment(): Update abilities are required.");const G=D.findIndex(L=>L===p);if(!B||"function"!==typeof B.updateAttachment)throw new h("invalid-layer","updateAttachment(): A valid layer is required.");
A=yield B.updateAttachment(C,p.id,A).then(L=>this._queryAttachment(L.objectId));D.splice(G,1,A);return A});return function(A){return y.apply(this,arguments)}}();E._queryAttachment=function(){var y=a._asyncToGenerator(function*(A){if(!A)throw new h("invalid-attachment-id","Could not query attachment.");const {_attachmentLayer:p}=this,B=this._getFeatureId();A=new v({objectIds:[B],attachmentsWhere:`AttachmentId=${A}`,returnMetadata:!0});return p.queryAttachments(A).then(D=>D[B][0])});return function(A){return y.apply(this,
arguments)}}();E._getFeatureId=function(){const {_attachmentLayer:y,graphic:A}=this;if(!y||!A)return null;const {objectIdField:p}=y,{attributes:B}=A;return B&&B[p]};E._graphicChanged=function(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))};E._setAttachmentLayer=function(){var {graphic:y}=this;this._attachmentLayer=(y=q.getSourceLayer(y))?"scene"===y.type&&n.isSome(y.associatedLayer)?y.associatedLayer:y:null};a._createClass(u,[{key:"state",get:function(){return this._getAttachmentsPromise?
"loading":this.graphic?"ready":"disabled"}},{key:"supportsResizeAttachments",get:function(){return this.get("graphic.layer.capabilities.operations.supportsResizeAttachments")||!1}}]);return u}(w.HandleOwner);b.__decorate([l.property()],g.prototype,"abilities",void 0);b.__decorate([d.cast("abilities")],g.prototype,"castAbilities",null);b.__decorate([l.property()],g.prototype,"activeAttachmentInfo",void 0);b.__decorate([l.property({readOnly:!0,type:r})],g.prototype,"attachmentInfos",void 0);b.__decorate([l.property({type:c})],
g.prototype,"graphic",void 0);b.__decorate([l.property()],g.prototype,"mode",void 0);b.__decorate([l.property({readOnly:!0})],g.prototype,"state",null);b.__decorate([l.property({readOnly:!0})],g.prototype,"supportsResizeAttachments",null);return g=b.__decorate([m.subclass("esri.widgets.Attachments.AttachmentsViewModel")],g)})},"esri/widgets/Feature/support/featureUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../intl ../../../core/Logger ../../../core/maybe ../../../core/string ../../../intl/date ../../../intl/number ../../../layers/support/fieldUtils ../../../popup/support/FieldInfoFormat ../../../support/arcadeOnDemand".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){function d(){d=b._asyncToGenerator(function*(Y,ea){return"function"===typeof Y?Y.call(null,ea):Y});return d.apply(this,arguments)}function m(Y){return Y?R.test(Y):!1}function z(Y,ea){if(!m(ea)||!Y)return null;const ja=ea.replace(R,"").toLowerCase();let la;Y.some(ia=>ia.name.toLowerCase()===ja?(la=ia,!0):!1);return la}function v(Y,ea){return(ea=q(ea,Y))?ea.name:Y}function q(Y,ea){return Y&&"function"===typeof Y.getField?Y.getField(ea):null}function t({formattedAttributes:Y,
template:ea,fieldInfoMap:ja}){return`${w.replace(w.replace(ea,la=>{{const ia=ja.get(la.toLowerCase());la=`{${ia&&ia.fieldName||la}}`}return la}),Y).replace(J,"")}`.trim()}function r(Y,ea,ja=!1){const la=ea[Y];"string"===typeof la&&(ja=(ja?encodeURIComponent(la):la).replace(N,"%27"),ea[Y]=ja)}function x(Y,ea=!1){const ja={...Y};Object.keys(ja).forEach(la=>r(la,ja,ea));return ja}function u(Y,ea){return Y.replace(P,(ja,la,ia)=>(ja=q(ea,ia))?`{${ja.name}}`:la)}function E(Y,ea,ja){return(Y=u(Y,ja))?Y.replace(V,
(la,ia,ca)=>{ia=`${ia||ca}`.trim();return w.replace(la,x(ea,ia&&"{"!==ia[0]))}):Y}function y(Y,ea){var ja=ea.fieldName,la=A(ea.fieldInfos,ja),ia=null==la?void 0:la.clone();la=ea.preventPlacesFormatting;ea=ea.layer;ja=q(ea,ja);if(ia&&"date"===(null==ja?void 0:ja.type)){ja=ia.format||new k;ja.dateFormat=ja.dateFormat||"short-date-short-time";var ca;if(!(ca="feature"===(null==ea?void 0:ea.type)&&ea.datesInUnknownTimezone)){if(ca=!(null==ea||!ea.layer))ca=ea.layer,ca="map-image"===(null==ca?void 0:ca.type);
ca=ca&&ea.layer.datesInUnknownTimezone}ja.dateTimeFormatOptions=ca?{timeZone:"UTC"}:null;ia.format=ja}ia=ia&&ia.format;"string"!==typeof Y||!ia||null!=ia.dateFormat||null==ia.places&&null==ia.digitSeparator||(ea=Number(Y),isNaN(ea)||(Y=ea));return"string"===typeof Y||null==Y||null==ia?D(Y):la?f.formatNumber(Y,{...f.convertNumberFormatToIntlOptions(ia),minimumFractionDigits:0,maximumFractionDigits:20}):ia.format(Y)}function A(Y,ea){if(Y&&Y.length&&ea){var ja=ea.toLowerCase(),la=void 0;Y.some(ia=>ia.fieldName&&
ia.fieldName.toLowerCase()===ja?(la=ia,!0):!1);return la}}function p({fieldName:Y,graphic:ea,layer:ja}){if(K(Y)||!ja||"function"!==typeof ja.getFeatureType)return null;const {typeIdField:la}=ja;return la&&Y===la?(Y=ja.getFeatureType(ea))?Y.name:null:null}function B({fieldName:Y,value:ea,graphic:ja,layer:la}){return K(Y)||!la||"function"!==typeof la.getFieldDomain?null:(Y=la.getFieldDomain(Y,{feature:ja}))&&"coded-value"===Y.type?Y.getName(ea):null}function D(Y){return"string"===typeof Y?Y.replace(S,
'\x3cbr class\x3d"esri-text-new-line" /\x3e'):Y}function C(Y){const {value:ea,fieldName:ja,fieldInfos:la,fieldInfoMap:ia,layer:ca,graphic:fa}=Y;return null==ea?"":(Y=B({fieldName:ja,value:ea,graphic:fa,layer:ca}))||(Y=p({fieldName:ja,graphic:fa,layer:ca}))?Y:ia.get(ja.toLowerCase())?y(ea,{fieldInfos:la,fieldName:ja,layer:ca}):(Y=ca&&ca.fieldsIndex)&&Y.isDateField(ja)?n.formatDate(ea,U):D(ea)}function F(Y,ea){return G.apply(this,arguments)}function G(){G=b._asyncToGenerator(function*(Y,ea){var ja,
la;const {layer:ia,graphic:ca,outFields:fa,objectIds:ba,returnGeometry:Z,spatialReference:ha}=Y;Y=ba[0];if("number"!==typeof Y&&"string"!==typeof Y)return Q.warn("Could not query required fields for the specified feature. The feature's ID is invalid.",{layer:ia,graphic:ca,objectId:Y,requiredFields:fa}),null;if(null==(ja=ia.capabilities)||null==(la=ja.operations)||!la.supportsQuery)return Q.warn("The specified layer cannot be queried. The following fields will not be available.",{layer:ia,graphic:ca,
requiredFields:fa,returnGeometry:Z}),null;ja=ia.createQuery();ja.objectIds=ba;ja.outFields=null!=fa&&fa.length?fa:[ia.objectIdField];ja.returnGeometry=!!Z;ja.returnZ=!!Z;ja.returnM=!!Z;ja.outSpatialReference=ha;return(yield ia.queryFeatures(ja,ea)).features[0]});return G.apply(this,arguments)}function L(Y){return H.apply(this,arguments)}function H(){H=b._asyncToGenerator(function*(Y){var ea;if(null==(ea=Y.expressionInfos)||!ea.length)return!1;ea=yield e.loadArcade();({arcadeUtils:{hasGeometryFunctions:ea}}=
ea);return ea(Y)});return H.apply(this,arguments)}function M(){M=b._asyncToGenerator(function*({graphic:Y,popupTemplate:ea,layer:ja,spatialReference:la},ia){if(ja&&ea&&("function"===typeof ja.load&&(yield ja.load(ia)),Y.attributes)){var ca=Y.attributes[ja.objectIdField];if(null!=ca){ca=[ca];var fa=yield ea.getRequiredFields(ja.fieldsIndex),ba=l.featureHasFields(fa,Y);fa=ba?[]:fa;ea=ea.returnGeometry||(yield L(ea));if(!ba||ea)if(ja=yield F({layer:ja,graphic:Y,outFields:fa,objectIds:ca,returnGeometry:ea,
spatialReference:la},ia))ja.geometry&&(Y.geometry=ja.geometry),ja.attributes&&(Y.attributes={...Y.attributes,...ja.attributes})}}});return M.apply(this,arguments)}function K(Y=""){return Y?-1!==Y.indexOf("relationships/"):!1}function I({attributes:Y,graphic:ea,relatedInfo:ja}){Y&&ea&&ja&&Object.keys(ea.attributes).forEach(la=>{var ia={layerId:ja.relation.id.toString(),fieldName:la};Y[ia?`${"relationships/"}${ia.layerId}/${ia.fieldName}`:""]=ea.attributes[la]})}function O(Y,ea){Y&&ea&&(ea.relatedFeatures&&
ea.relatedFeatures&&ea.relatedFeatures.forEach(ja=>I({attributes:Y,graphic:ja,relatedInfo:ea})),ea.relatedStatsFeatures&&ea.relatedStatsFeatures&&ea.relatedStatsFeatures.forEach(ja=>I({attributes:Y,graphic:ja,relatedInfo:ea})))}const Q=g.getLogger("esri.widgets.Feature.support.featureUtils"),J=/href=(""|'')/gi,P=/(\{([^\{\r\n]+)\})/g,N=/'/g,R=/^\s*expression\//i,S=/(\n)/gi,T=/[\u00A0-\u9999<>&]/gim,V=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,W=/^(?:mailto:|tel:)/,U=n.convertDateFormatToIntlOptions("short-date-short-time"),
aa=Y=>{if(!Y)return!1;Y=Y.toUpperCase();return-1<Y.indexOf("CURRENT_TIMESTAMP")||-1<Y.indexOf("CURRENT_DATE")||-1<Y.indexOf("CURRENT_TIME")},da=({layer:Y,method:ea,query:ja,definitionExpression:la})=>{var ia,ca;null!=(ia=Y.capabilities)&&null!=(ca=ia.query)&&ca.supportsCacheHint&&"attachments"!==ea&&(Y=h.isSome(ja.where)&&ja.where,ea=h.isSome(ja.geometry)&&ja.geometry,aa(la)||aa(Y)||"extent"===(null==ea?void 0:ea.type)||"tile"===ja.resultType||(ja.cacheHint=!0))};a.applyTextFormattingHTML=D;a.createfieldInfoMap=
function(Y,ea){const ja=new Map;Y&&Y.forEach(la=>{const ia=v(la.fieldName,ea);la.fieldName=ia;ja.set(ia.toLowerCase(),la)});return ja};a.fixTokens=u;a.formatAttributes=function({fieldInfos:Y,attributes:ea,layer:ja,graphic:la,fieldInfoMap:ia,relatedInfos:ca}){const fa={};null==ca?void 0:ca.forEach(ba=>O(fa,ba));Object.keys(ea).forEach(ba=>{fa[ba]=C({fieldName:ba,fieldInfos:Y,fieldInfoMap:ia,layer:ja,value:ea[ba],graphic:la})});return fa};a.formatEditInfo=function(Y,ea){const {creatorField:ja,creationDateField:la,
editorField:ia,editDateField:ca}=Y;if(ea){Y=ea[ca];if("number"===typeof Y)return ea=ea[ia],{type:"edit",date:n.formatDate(Y,U),user:ea};Y=ea[la];return"number"===typeof Y?(ea=ea[ja],{type:"create",date:n.formatDate(Y,U),user:ea}):null}};a.formatValueToFieldInfo=y;a.getAllFieldInfos=function(Y){const ea=[];if(!Y)return ea;const {fieldInfos:ja,content:la}=Y;ja&&ea.push(...ja);if(!la||!Array.isArray(la))return ea;la.forEach(ia=>{"fields"===ia.type&&(ia=ia&&ia.fieldInfos)&&ea.push(...ia)});return ea};
a.getFieldInfo=A;a.getFieldInfoLabel=function(Y,ea){return(ea=z(ea,null==Y?void 0:Y.fieldName))?ea.title||null:Y?Y.label||Y.fieldName:null};a.getFixedFieldName=v;a.getFixedFieldNames=function(Y,ea){return Y&&Y.map(ja=>v(ja,ea))};a.getSourceLayer=function(Y){if(!h.isNone(Y))return Y.get("sourceLayer")||Y.get("layer")};a.graphicCallback=function(Y,ea){return d.apply(this,arguments)};a.htmlEntities=function(Y){return Y.replace(T,ea=>`&#${ea.charCodeAt(0)};`)};a.isExpressionField=m;a.isRelatedField=K;
a.preLayerQueryCallback=({query:Y,layer:ea,method:ja})=>{da({layer:ea,method:ja,query:Y,definitionExpression:`${ea.definitionExpression} ${ea.serviceDefinitionExpression}`})};a.preRequestCallback=({queryPayload:Y,layer:ea,method:ja})=>{da({layer:ea,method:ja,query:Y,definitionExpression:`${ea.definitionExpression} ${ea.serviceDefinitionExpression}`})};a.queryUpdatedFeature=function(Y,ea){return M.apply(this,arguments)};a.shouldOpenInNewTab=function(Y=""){if(Y)return!W.test(Y.trim().toLowerCase())};
a.substituteAttributes=t;a.substituteFieldsInLinksAndAttributes=function({attributes:Y,globalAttributes:ea,layer:ja,text:la,expressionAttributes:ia,fieldInfoMap:ca}){return la?t({formattedAttributes:ea,template:E(la,{...ea,...ia,...Y},ja),fieldInfoMap:ca}):""};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Attachments/support/attachmentUtils":function(){define(["exports","../../../assets"],function(a,b){a.getIconPath=function(c){const g=b.getAssetUrl("esri/themes/base/images/files/");
return c?"text/plain"===c?`${g}text-32.svg`:"application/pdf"===c?`${g}pdf-32.svg`:"text/csv"===c?`${g}csv-32.svg`:"application/gpx+xml"===c?`${g}gpx-32.svg`:"application/x-dwf"===c?`${g}cad-32.svg`:"application/postscript"===c||"application/json"===c||"text/xml"===c||"model/vrml"===c?`${g}code-32.svg`:"application/x-zip-compressed"===c||"application/x-7z-compressed"===c||"application/x-gzip"===c||"application/x-tar"===c||"application/x-gtar"===c||"application/x-bzip2"===c||"application/gzip"===c||
"application/x-compress"===c||"application/x-apple-diskimage"===c||"application/x-rar-compressed"===c||"application/zip"===c?`${g}zip-32.svg`:-1!==c.indexOf("image/")?`${g}image-32.svg`:-1!==c.indexOf("audio/")?`${g}sound-32.svg`:-1!==c.indexOf("video/")?`${g}video-32.svg`:-1!==c.indexOf("msexcel")||-1!==c.indexOf("ms-excel")||-1!==c.indexOf("spreadsheetml")?`${g}excel-32.svg`:-1!==c.indexOf("msword")||-1!==c.indexOf("ms-word")||-1!==c.indexOf("wordprocessingml")?`${g}word-32.svg`:-1!==c.indexOf("powerpoint")||
-1!==c.indexOf("presentationml")?`${g}report-32.svg`:`${g}generic-32.svg`:`${g}generic-32.svg`};a.isSupportedImage=function(c){c=c.toLowerCase();return"image/bmp"===c||"image/emf"===c||"image/exif"===c||"image/gif"===c||"image/x-icon"===c||"image/jpeg"===c||"image/png"===c||"image/tiff"===c||"image/x-wmf"===c};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Feature/FeatureAttachments/FeatureAttachmentsViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../Attachments/AttachmentsViewModel".split(" "),
function(a,b,c,g,h,w,n,f){g=function(l){function k(e){e=l.call(this,e)||this;e.description=null;e.title=null;return e}a._inheritsLoose(k,l);return k}(f);b.__decorate([c.property()],g.prototype,"description",void 0);b.__decorate([c.property()],g.prototype,"title",void 0);return g=b.__decorate([n.subclass("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],g)})},"esri/widgets/Feature/support/FeatureElementInfo":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../Widget ../../support/Heading ../../support/widgetUtils ../../../core/Logger ../../support/jsxFactory".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){g=function(m){function z(q,t){q=m.call(this,q,t)||this;q.description=null;q.headingLevel=2;q.title=null;return q}a._inheritsLoose(z,m);var v=z.prototype;v.render=function(){return d.tsx("div",{class:"esri-feature-element-info"},this.renderTitle(),this.renderDescription())};v.renderTitle=function(){const {title:q}=this;return q?d.tsx(l.Heading,{level:this.headingLevel,class:"esri-feature-element-info__title"},q):null};v.renderDescription=function(){const {description:q}=
this;return q?d.tsx("div",{key:"description",class:"esri-feature-element-info__description"},q):null};return z}(f);b.__decorate([c.property()],g.prototype,"description",void 0);b.__decorate([c.property()],g.prototype,"headingLevel",void 0);b.__decorate([c.property()],g.prototype,"title",void 0);return g=b.__decorate([n.subclass("esri.widgets.Feature.support.FeatureElementInfo")],g)})},"esri/widgets/support/Heading":function(){define("exports ../../core/mathUtils ./widgetUtils ../../core/has ../../core/Logger ./jsxFactory".split(" "),
function(a,b,c,g,h,w){const n={heading:"esri-widget__heading"};a.CSS=n;a.Heading=function(f,l){const k=b.clamp(Math.ceil(f.level),1,6),e=`h${k}`;delete f.level;return w.tsx(e,{...f,class:c.classes(n.heading,f.class),role:"heading","aria-level":String(k)},l)};a.incrementHeadingLevel=function(f,l=1){return b.clamp(Math.ceil(f+l),1,6)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Feature/FeatureContent":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/aliasOf ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureContent/FeatureContentViewModel ./support/featureUtils ../support/widget ../support/jsxFactory".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m){g=function(z){function v(t,r){t=z.call(this,t,r)||this;t.creator=null;t.graphic=null;t.viewModel=null;t._addTargetToAnchors=x=>{Array.from(x.querySelectorAll("a")).forEach(u=>{e.shouldOpenInNewTab(u.href)&&!u.hasAttribute("target")&&u.setAttribute("target","_blank")})};return t}a._inheritsLoose(v,z);var q=v.prototype;q.renderLoading=function(){return m.tsx("div",{class:"esri-feature-content__loader-container",key:"loader"},m.tsx("div",{class:"esri-feature-content__loader"}))};
q.renderCreated=function(){var t;const r=null==(t=this.viewModel)?void 0:t.created;return r?r instanceof HTMLElement?m.tsx("div",{key:r,bind:r,afterCreate:this._attachToNode}):d.isWidget(r)?m.tsx("div",{key:r},!r.destroyed&&r.render()):m.tsx("div",{key:r,innerHTML:r,afterCreate:this._addTargetToAnchors}):null};q.render=function(){var t;const r=null==(t=this.viewModel)?void 0:t.state;return m.tsx("div",{class:"esri-feature-content"},"loading"===r?this.renderLoading():this.renderCreated())};q._attachToNode=
function(t){t.appendChild(this)};return v}(l);b.__decorate([c.aliasOf("viewModel.creator")],g.prototype,"creator",void 0);b.__decorate([c.aliasOf("viewModel.graphic")],g.prototype,"graphic",void 0);b.__decorate([n.property({type:k})],g.prototype,"viewModel",void 0);return g=b.__decorate([f.subclass("esri.widgets.Feature.FeatureContent")],g)})},"esri/widgets/Feature/FeatureContent/FeatureContentViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Accessor ../../../core/HandleOwner ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../support/featureUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){g=function(m){function z(q){var t=m.call(this,q)||this;t._loadingPromise=null;t.created=null;t.creator=null;t.destroyer=null;t.graphic=null;t.handles.add(w.init(a._assertThisInitialized(t),"creator",r=>{t._destroyContent();t._createContent(r)}));return t}a._inheritsLoose(z,m);var v=z.prototype;v.destroy=function(){this._destroyContent()};v._destroyContent=function(){const {created:q,graphic:t,destroyer:r}=this;q&&(d.graphicCallback(r,{graphic:t}).catch(()=>null),
this._set("created",null))};v._createContent=function(){var q=a._asyncToGenerator(function*(t){var {graphic:r}=this;this._loadingPromise=t=d.graphicCallback(t,{graphic:r}).catch(()=>null);this.notifyChange("state");r=yield t;t===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",r))});return function(t){return q.apply(this,arguments)}}();a._createClass(z,[{key:"state",get:function(){return this._loadingPromise?"loading":"ready"}}]);return z}(h.HandleOwnerMixin(g));
b.__decorate([n.property({readOnly:!0})],g.prototype,"created",void 0);b.__decorate([n.property()],g.prototype,"creator",void 0);b.__decorate([n.property()],g.prototype,"destroyer",void 0);b.__decorate([n.property({type:c})],g.prototype,"graphic",void 0);b.__decorate([n.property({readOnly:!0})],g.prototype,"state",null);return g=b.__decorate([e.subclass("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],g)})},"esri/widgets/Feature/FeatureExpression":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureContent ./FeatureFields ./FeatureMedia ./FeatureExpression/FeatureExpressionViewModel ../support/widgetUtils ../../core/Logger ../support/jsxFactory".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q){h=function(t){function r(u,E){u=t.call(this,u,E)||this;u.viewModel=new m;return u}a._inheritsLoose(r,t);var x=r.prototype;x.initialize=function(){c.init(this,"viewModel.contentElementViewModel",()=>this._setupExpressionWidget())};x.destroy=function(){this._destroyContentWidget()};x.renderLoading=function(){return q.tsx("div",{key:"loading-container",class:"esri-feature__loading-container"},q.tsx("span",{class:this.classes("esri-icon-loading-indicator esri-rotating",
"esri-feature__loading-spinner")}))};x.render=function(){var u;const {state:E}=this.viewModel;return q.tsx("div",{class:"esri-feature-expression"},"loading"===E?this.renderLoading():"disabled"===E?null:null==(u=this._contentWidget)?void 0:u.render())};x._destroyContentWidget=function(){const {_contentWidget:u}=this;u&&(u.viewModel=null,u.destroy());this._contentWidget=null};x._setupExpressionWidget=function(){const {contentElementViewModel:u,contentElement:E}=this.viewModel,y=null==E?void 0:E.type;
this._destroyContentWidget();this._contentWidget=u?"fields"===y?new e({viewModel:u}):"media"===y?new d({viewModel:u}):"text"===y?new k({viewModel:u}):null:null;this.scheduleRender()};return r}(l);b.__decorate([g.property({type:m})],h.prototype,"viewModel",void 0);return h=b.__decorate([f.subclass("esri.widgets.Feature.FeatureExpression")],h)})},"esri/widgets/Feature/FeatureFields":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/watchUtils ../../core/accessorSupport/decorators/aliasOf ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureFields/FeatureFieldsViewModel ./support/FeatureElementInfo ../support/uriUtils ../support/widgetUtils ../support/decorators/messageBundle ../../core/Logger ../support/jsxFactory".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t){h=function(r){function x(E,y){E=r.call(this,E,y)||this;E._featureElementInfo=null;E.attributes=null;E.description=null;E.expressionInfos=null;E.fieldInfos=null;E.title=null;E.viewModel=new e;E.messages=null;E.messagesURIUtils=null;return E}a._inheritsLoose(x,r);var u=x.prototype;u.initialize=function(){this._featureElementInfo=new d;c.init(this,["viewModel.description","viewModel.title"],()=>this._setupFeatureElementInfo())};u.destroy=function(){this._featureElementInfo.destroy()};
u.renderFieldInfo=function(E,y){var {attributes:A}=this.viewModel;const p=E.fieldName,B=E.label||p;A=A?null==A[p]?"":A[p]:"";E=!(!E.format||!E.format.dateFormat);A="number"!==typeof A||E?m.autoLink(this.messagesURIUtils,A):this._forceLTR(A);E={["esri-feature-fields__field-data--date"]:E};return t.tsx("tr",{key:`fields-element-info-row-${p}-${y}`},t.tsx("th",{key:`fields-element-info-row-header-${p}-${y}`,class:"esri-feature-fields__field-header",innerHTML:B}),t.tsx("td",{key:`fields-element-info-row-data-${p}-${y}`,
class:this.classes("esri-feature-fields__field-data",E),innerHTML:A}))};u.renderFields=function(){const {formattedFieldInfos:E}=this.viewModel;return null!=E&&E.length?t.tsx("table",{class:"esri-widget__table",summary:this.messages.fieldsSummary},t.tsx("tbody",null,E.map((y,A)=>this.renderFieldInfo(y,A)))):null};u.render=function(){var E;return t.tsx("div",{class:"esri-feature-fields"},null==(E=this._featureElementInfo)?void 0:E.render(),this.renderFields())};u._setupFeatureElementInfo=function(){const {description:E,
title:y}=this;this._featureElementInfo.set({description:E,title:y})};u._forceLTR=function(E){return`&lrm;${E}`};return x}(k);b.__decorate([g.aliasOf("viewModel.attributes")],h.prototype,"attributes",void 0);b.__decorate([g.aliasOf("viewModel.description")],h.prototype,"description",void 0);b.__decorate([g.aliasOf("viewModel.expressionInfos")],h.prototype,"expressionInfos",void 0);b.__decorate([g.aliasOf("viewModel.fieldInfos")],h.prototype,"fieldInfos",void 0);b.__decorate([g.aliasOf("viewModel.title")],
h.prototype,"title",void 0);b.__decorate([f.property({type:e})],h.prototype,"viewModel",void 0);b.__decorate([f.property(),v.messageBundle("esri/widgets/Feature/t9n/Feature")],h.prototype,"messages",void 0);b.__decorate([f.property(),v.messageBundle("esri/widgets/support/t9n/uriUtils")],h.prototype,"messagesURIUtils",void 0);return h=b.__decorate([l.subclass("esri.widgets.Feature.FeatureFields")],h)})},"esri/widgets/Feature/FeatureFields/FeatureFieldsViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../popup/ExpressionInfo ../../../popup/FieldInfo ../support/featureUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){c=function(d){function m(z){z=d.call(this,z)||this;z.attributes=null;z.expressionInfos=null;z.description=null;z.fieldInfos=null;z.title=null;return z}a._inheritsLoose(m,d);a._createClass(m,[{key:"formattedFieldInfos",get:function(){const {expressionInfos:z,fieldInfos:v}=this,q=[];null==v?void 0:v.forEach(t=>{if(!t.hasOwnProperty("visible")||t.visible)t=t.clone(),t.label=e.getFieldInfoLabel(t,z),q.push(t)});return q}}]);return m}(c);b.__decorate([g.property()],c.prototype,
"attributes",void 0);b.__decorate([g.property({type:[l]})],c.prototype,"expressionInfos",void 0);b.__decorate([g.property()],c.prototype,"description",void 0);b.__decorate([g.property({type:[k]})],c.prototype,"fieldInfos",void 0);b.__decorate([g.property({readOnly:!0})],c.prototype,"formattedFieldInfos",null);b.__decorate([g.property()],c.prototype,"title",void 0);return c=b.__decorate([f.subclass("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],c)})},"esri/widgets/support/uriUtils":function(){define(["exports",
"../../core/string"],function(a,b){function c(h){let w=null;g.some(n=>{n.pattern.test(h)&&(w=n);return!!w});return w}const g=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",
appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",
appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];a.autoLink=function(h,w){if("string"!==typeof w||!w)return w;const n=c(w);if(!n)return w;const f=w.match(n.pattern);
h=b.replace(b.replace(n.label,{messages:h,hierPart:f&&f[2]}),{appName:n.appName});return w.replace(n.pattern,`<a${n.target?` target="${n.target}"`:""} href="$1"${"_blank"===n.target?' rel\x3d"noreferrer"':""}>${h}</a>`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Feature/FeatureMedia":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/events ../../core/watchUtils ../../core/accessorSupport/decorators/aliasOf ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureMedia/FeatureMediaViewModel ./support/FeatureElementInfo ./support/featureUtils ../support/chartUtils ../support/widgetUtils ../support/decorators/messageBundle ../../core/Logger ../support/jsxFactory ../support/widgetThemeUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u){w=function(E){function y(p,B){var D=E.call(this,p,B)||this;D._refreshTimer=null;D._refreshIntervalInfo=null;D._featureElementInfo=null;D.attributes=null;D.activeMediaInfoIndex=null;D.description=null;D.fieldInfoMap=null;D.layer=null;D.mediaInfos=null;D.popupTemplate=null;D.relatedInfos=null;D.title=null;D.viewModel=new d;D.messages=null;D._getChartDependencies=function(){var C=a._asyncToGenerator(function*(F){const G=yield v.loadChartsModule(),{destroyed:L,
viewModel:H}=a._assertThisInitialized(D);if(!L&&H&&F){var {activeMediaInfo:M}=H;D._renderChart({chartDiv:F,mediaInfo:M,chartsModule:G})}});return function(F){return C.apply(this,arguments)}}();return D}a._inheritsLoose(y,E);var A=y.prototype;A.initialize=function(){this._featureElementInfo=new m;this.own(g.init(this,["viewModel.activeMediaInfo","viewModel.activeMediaInfoIndex"],()=>this._setupMediaRefreshTimer()),g.init(this,["viewModel.description","viewModel.title"],()=>this._setupFeatureElementInfo()))};
A.destroy=function(){this._clearMediaRefreshTimer();this._featureElementInfo.destroy()};A.render=function(){var p;return x.tsx("div",{bind:this,class:"esri-feature-media",onkeyup:this._handleMediaKeyup},null==(p=this._featureElementInfo)?void 0:p.render(),this.renderMedia())};A.renderMedia=function(){const {formattedMediaInfoCount:p}=this.viewModel;return p?x.tsx("div",{key:"media-element-container",class:"esri-feature-media__container"},this.renderMediaPageButton("previous"),this.renderMediaInfo(),
this.renderMediaPageButton("next")):null};A.renderImageMediaInfo=function(p){var {_refreshIntervalInfo:B}=this;const {activeMediaInfoIndex:D,formattedMediaInfoCount:C}=this.viewModel,{value:F,refreshInterval:G,altText:L,title:H,type:M}=p,{sourceURL:K,linkURL:I}=F;p=z.shouldOpenInNewTab(I)?"_blank":"_self";const O="_blank"===p?"noreferrer":"";B=G?B:null;B=x.tsx("img",{alt:L||H,key:`media-${M}-${D}-${C}-${B?B.timestamp:0}`,src:B?B.sourceURL:K});return(p=I?x.tsx("a",{title:H,href:I,rel:O,target:p},B):
null)?p:B};A.renderChartMediaInfo=function(p){const {activeMediaInfoIndex:B,formattedMediaInfoCount:D}=this.viewModel;return x.tsx("div",{key:`media-${p.type}-${B}-${D}`,bind:this,class:"esri-feature-media__chart",afterCreate:this._getChartDependencies})};A.renderMediaInfoType=function(){const {activeMediaInfo:p}=this.viewModel;return p?"image"===p.type?this.renderImageMediaInfo(p):-1!==p.type.indexOf("chart")?this.renderChartMediaInfo(p):null:null};A.renderMediaInfo=function(){var {activeMediaInfo:p}=
this.viewModel;if(!p)return null;const B=p.title?x.tsx("div",{key:"media-title",class:"esri-feature-media__item-title",innerHTML:p.title}):null;p=p.caption?x.tsx("div",{key:"media-caption",class:"esri-feature-media__item-caption",innerHTML:p.caption}):null;return x.tsx("div",{key:"media-container",class:"esri-feature-media__item-container"},x.tsx("div",{key:"media-item-container",class:"esri-feature-media__item"},this.renderMediaInfoType()),B,p)};A.renderMediaPageButton=function(p){if(2>this.viewModel.formattedMediaInfoCount)return null;
const B=(p="previous"===p)?this.messages.previous:this.messages.next,D=p?this.classes("esri-feature-media__button","esri-feature-media__previous"):this.classes("esri-feature-media__button","esri-feature-media__next"),C=p?this.classes("esri-feature-media__icon","esri-feature-media__previous-icon","esri-icon-left-triangle-arrow"):this.classes("esri-feature-media__icon","esri-feature-media__next-icon","esri-icon-right-triangle-arrow"),F=p?this.classes("esri-feature-media__icon","esri-feature-media__previous-icon--rtl",
"esri-icon-right-triangle-arrow"):this.classes("esri-feature-media__icon","esri-feature-media__next-icon--rtl","esri-icon-left-triangle-arrow");return x.tsx("button",{type:"button",key:p?"media-previous":"media-next",title:B,"aria-label":B,tabIndex:0,class:D,bind:this,onclick:p?this._previous:this._next},x.tsx("span",{"aria-hidden":"true",class:C}),x.tsx("span",{"aria-hidden":"true",class:F}))};A._setupFeatureElementInfo=function(){const {description:p,title:B}=this;this._featureElementInfo.set({description:p,
title:B})};A._next=function(){this.viewModel.next()};A._previous=function(){this.viewModel.previous()};A._handleMediaKeyup=function(p){const B=c.eventKey(p);"ArrowLeft"===B&&(p.stopPropagation(),this.viewModel.previous());"ArrowRight"===B&&(p.stopPropagation(),this.viewModel.next())};A._renderChart=function(p){const {abilities:B}=this.viewModel,{chartsModule:D,chartDiv:C,mediaInfo:F}=p,{value:G,type:L}=F,{am4core:H}=D,M=v.getColorSet(H);u.isDarkTheme()&&H.useTheme(D.am4themes_dark);const K=window.matchMedia("(prefers-reduced-motion: reduce)");
B.chartAnimation&&!K.matches?H.useTheme(D.am4themes_animated):H.unuseTheme(D.am4themes_animated);H.useTheme(function(I){I instanceof H.ColorSet&&M&&(I.list=M)});p="pie-chart"===L?this._createPieChart(p):this._createXYChart(p);C.setAttribute("aria-label",F.altText||F.title);p.data=G.series.map(I=>({tooltip:I.tooltip,value:I.value})).filter(I=>"pie-chart"===L?0<I.value:!0)};A._customizeChartTooltip=function(p,B){p.label.wrap=!0;p.label.maxWidth=200;p.autoTextColor=!1;p.getFillFromObject=!1;p.label.fill=
B.color("#ffffff");p.background.fill=B.color({r:0,g:0,b:0,a:.7})};A._createPieChart=function(p){const {chartDiv:B,chartsModule:D}=p,{am4core:C,am4charts:F}=D;p=C.create(B,F.PieChart);p.rtl=q.isRTL(this.container);const G=p.series.push(new F.PieSeries);G.labels.template.disabled=!0;G.ticks.template.disabled=!0;G.dataFields.value="value";G.dataFields.category="tooltip";this._customizeChartTooltip(G.tooltip,C);G.slices.template.tooltipText=p.rtl?"{category}: %{value.percent.formatNumber('#.0')}":"{category}: {value.percent.formatNumber('#.0')}%";
return p};A._getMinSeriesValue=function(p){let B=0;p.forEach(D=>B=Math.min(D.value,B));return B};A._createColumnChart=function(p,B){const {chartsModule:D,mediaInfo:C}=B;({value:B}=C);const {am4core:F,am4charts:G}=D,L=p.xAxes.push(new G.CategoryAxis);L.dataFields.category="tooltip";L.renderer.labels.template.disabled=!0;this._customizeChartTooltip(L.tooltip,F);L.tooltip.events.on("sizechanged",()=>{L.tooltip.dy=-L.tooltip.contentHeight});var H=p.yAxes.push(new G.ValueAxis);const M=H.renderer.labels.template;
H.renderer.minLabelPosition=.05;H.renderer.maxLabelPosition=.95;H.min=this._getMinSeriesValue(B.series);this._customizeChartTooltip(H.tooltip,F);M.wrap=!0;H=p.series.push(new G.ColumnSeries);H.dataFields.valueY="value";H.dataFields.categoryX="tooltip";p.cursor=new G.XYCursor;15<B.series.length&&(p.scrollbarX=new F.Scrollbar)};A._createBarChart=function(p,B){const {chartsModule:D,mediaInfo:C}=B;({value:B}=C);const {am4core:F,am4charts:G}=D,L=p.yAxes.push(new G.CategoryAxis);L.dataFields.category="tooltip";
L.renderer.inversed=!0;L.renderer.labels.template.disabled=!0;this._customizeChartTooltip(L.tooltip,F);L.tooltip.events.on("sizechanged",()=>{L.tooltip.dx=L.tooltip.contentWidth});var H=p.xAxes.push(new G.ValueAxis);const M=H.renderer.labels.template;H.renderer.minLabelPosition=.05;H.renderer.maxLabelPosition=.95;H.min=this._getMinSeriesValue(B.series);this._customizeChartTooltip(H.tooltip,F);M.wrap=!0;H=p.series.push(new G.ColumnSeries);H.dataFields.valueX="value";H.dataFields.categoryY="tooltip";
p.cursor=new G.XYCursor;15<B.series.length&&(p.scrollbarY=new F.Scrollbar)};A._createLineChart=function(p,B){const {chartsModule:D,mediaInfo:C}=B;({value:B}=C);const {am4core:F,am4charts:G}=D,L=p.xAxes.push(new G.CategoryAxis);L.dataFields.category="tooltip";L.renderer.labels.template.disabled=!0;this._customizeChartTooltip(L.tooltip,F);L.tooltip.events.on("sizechanged",()=>{L.tooltip.dy=-L.tooltip.contentHeight});var H=p.yAxes.push(new G.ValueAxis);const M=H.renderer.labels.template;H.renderer.minLabelPosition=
.05;H.renderer.maxLabelPosition=.95;H.min=this._getMinSeriesValue(B.series);this._customizeChartTooltip(H.tooltip,F);M.wrap=!0;H=p.series.push(new G.LineSeries);H.dataFields.categoryX="tooltip";H.dataFields.valueY="value";p.cursor=new G.XYCursor;15<B.series.length&&(p.scrollbarX=new F.Scrollbar)};A._createXYChart=function(p){const {chartDiv:B,chartsModule:D,mediaInfo:C}=p,{type:F}=C,{am4core:G,am4charts:L}=D,H=G.create(B,L.XYChart);H.rtl=q.isRTL(this.container);"column-chart"===F&&this._createColumnChart(H,
p);"bar-chart"===F&&this._createBarChart(H,p);"line-chart"===F&&this._createLineChart(H,p);return H};A._clearMediaRefreshTimer=function(){const {_refreshTimer:p}=this;p&&(clearTimeout(p),this._refreshTimer=null)};A._updateMediaInfoTimestamp=function(p){const B=Date.now();this._refreshIntervalInfo={timestamp:B,sourceURL:this._getImageSource(p,B)};this.scheduleRender()};A._setupMediaRefreshTimer=function(){this._clearMediaRefreshTimer();const {activeMediaInfo:p}=this.viewModel;p&&"image"===p.type&&
p.refreshInterval&&this._setRefreshTimeout(p)};A._setRefreshTimeout=function(p){const {refreshInterval:B,value:D}=p;B&&(p=6E4*B,this._updateMediaInfoTimestamp(D.sourceURL),this._refreshTimer=setInterval(()=>{this._updateMediaInfoTimestamp(D.sourceURL)},p))};A._getImageSource=function(p,B){const D=-1!==p.indexOf("?")?"\x26":"?",[C,F=""]=p.split("#");return`${C}${D}timestamp=${B}${F?"#":""}${F}`};return y}(e);b.__decorate([h.aliasOf("viewModel.attributes")],w.prototype,"attributes",void 0);b.__decorate([h.aliasOf("viewModel.activeMediaInfoIndex")],
w.prototype,"activeMediaInfoIndex",void 0);b.__decorate([h.aliasOf("viewModel.description")],w.prototype,"description",void 0);b.__decorate([h.aliasOf("viewModel.fieldInfoMap")],w.prototype,"fieldInfoMap",void 0);b.__decorate([h.aliasOf("viewModel.layer")],w.prototype,"layer",void 0);b.__decorate([h.aliasOf("viewModel.mediaInfos")],w.prototype,"mediaInfos",void 0);b.__decorate([h.aliasOf("viewModel.popupTemplate")],w.prototype,"popupTemplate",void 0);b.__decorate([h.aliasOf("viewModel.relatedInfos")],
w.prototype,"relatedInfos",void 0);b.__decorate([h.aliasOf("viewModel.title")],w.prototype,"title",void 0);b.__decorate([l.property({type:d})],w.prototype,"viewModel",void 0);b.__decorate([l.property(),t.messageBundle("esri/widgets/Feature/t9n/Feature")],w.prototype,"messages",void 0);return w=b.__decorate([k.subclass("esri.widgets.Feature.FeatureMedia")],w)})},"esri/widgets/Feature/FeatureMedia/FeatureMediaViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass ../../../popup/FieldInfo ../../../popup/content/support/ChartMediaInfoValueSeries ../support/featureUtils ../support/relatedFeatureUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){const m={chartAnimation:!0};c=function(z){function v(t){t=z.call(this,t)||this;t.abilities={...m};t.activeMediaInfoIndex=0;t.attributes=null;t.description=null;t.fieldInfoMap=null;t.formattedAttributes=null;t.expressionAttributes=null;t.layer=null;t.mediaInfos=null;t.popupTemplate=null;t.relatedInfos=null;t.title=null;return t}a._inheritsLoose(v,z);var q=v.prototype;q.castAbilities=function(t){return{...m,...t}};q.setActiveMedia=function(t){this._setContentElementMedia(t)};
q.next=function(){this._pageContentElementMedia(1)};q.previous=function(){this._pageContentElementMedia(-1)};q._setContentElementMedia=function(t){const {formattedMediaInfoCount:r}=this;this.activeMediaInfoIndex=(t+r)%r};q._pageContentElementMedia=function(t){const {activeMediaInfoIndex:r}=this;this._setContentElementMedia(r+t)};q._formatMediaInfos=function(){const {attributes:t,mediaInfos:r,formattedAttributes:x,expressionAttributes:u,fieldInfoMap:E,layer:y}=this;return null==r?void 0:r.map(A=>{A=
null==A?void 0:A.clone();if(!A)return null;A.title=e.substituteFieldsInLinksAndAttributes({attributes:t,fieldInfoMap:E,globalAttributes:x,expressionAttributes:u,layer:y,text:A.title});A.caption=e.substituteFieldsInLinksAndAttributes({attributes:t,fieldInfoMap:E,globalAttributes:x,expressionAttributes:u,layer:y,text:A.caption});A.altText=e.substituteFieldsInLinksAndAttributes({attributes:t,fieldInfoMap:E,globalAttributes:x,expressionAttributes:u,layer:y,text:A.altText});if("image"===A.type){var {value:p}=
A;this._setImageValue({value:p,formattedAttributes:x,layer:y});return A.value.sourceURL?A:void 0}return"pie-chart"===A.type||"line-chart"===A.type||"column-chart"===A.type||"bar-chart"===A.type?({value:p}=A,this._setChartValue({value:p,chartType:A.type,attributes:t,formattedAttributes:x,layer:y}),A):null}).filter(Boolean)};q._setImageValue=function(t){const {fieldInfoMap:r}=this,{value:x,formattedAttributes:u,layer:E}=t,{linkURL:y,sourceURL:A}=x;A&&(t=e.fixTokens(A,E),x.sourceURL=e.substituteAttributes({formattedAttributes:u,
template:t,fieldInfoMap:r}));y&&(t=e.fixTokens(y,E),x.linkURL=e.substituteAttributes({formattedAttributes:u,template:t,fieldInfoMap:r}))};q._setChartValue=function(t){const {value:r,attributes:x,formattedAttributes:u,chartType:E,layer:y}=t,{popupTemplate:A,relatedInfos:p}=this,{fields:B,normalizeField:D}=r;r.fields=e.getFixedFieldNames(B,y);D&&(r.normalizeField=e.getFixedFieldName(D,y));if(B.some(F=>!!(null!=u[F]||e.isRelatedField(F)&&p.size))){var C=null==A?void 0:A.fieldInfos;B.forEach(F=>{e.isRelatedField(F)?
r.series=[...r.series,...this._getRelatedChartInfos({fieldInfos:C,fieldName:F,formattedAttributes:u,chartType:E,value:r})]:(F=this._getChartOption({value:r,attributes:x,chartType:E,formattedAttributes:u,fieldName:F,fieldInfos:C}),r.series.push(F))})}};q._getRelatedChartInfos=function(t){var r;const {fieldInfos:x,fieldName:u,formattedAttributes:E,chartType:y,value:A}=t,p=[];t=d.getRelatedFieldInfo(u);const {layerId:B,fieldName:D}=t;t=null==(r=this.relatedInfos)?void 0:r.get(B.toString());if(!t)return p;
const {relatedFeatures:C,relation:F}=t;if(!F||!C)return p;({cardinality:r}=F);C.forEach(G=>{const {attributes:L}=G;L&&Object.keys(L).forEach(H=>{H===D&&p.push(this._getChartOption({value:A,attributes:L,formattedAttributes:E,fieldName:u,chartType:y,relatedFieldName:H,fieldInfos:x}))})});return"one-to-many"===r||"many-to-many"===r?p:[p[0]]};q._getTooltip=function({label:t,value:r,chartType:x}){return"pie-chart"===x?t:`${t}: ${r}`};q._getChartOption=function(t){const {value:r,attributes:x,formattedAttributes:u,
fieldName:E,relatedFieldName:y,fieldInfos:A,chartType:p}=t;var {layer:B}=this;const {normalizeField:D,tooltipField:C}=r;var F=D?e.isRelatedField(D)?x[d.getRelatedFieldInfo(D).fieldName]:x[D]:null;t=y&&void 0!==x[y]?x[y]:void 0!==x[E]?x[E]:u[E];const G=void 0===t?null:t&&F?t/F:t;t=new k({value:G});if(e.isRelatedField(E)){var L=d.getRelatedFieldInfo(E);var H=d.getRelatedFieldInfo(C);H=H?H.fieldName:null;B=e.formatValueToFieldInfo(G,{fieldInfos:A,fieldName:y,layer:B,preventPlacesFormatting:!!F});L=L?
L.label||L.fieldName:y;t.tooltip=this._getTooltip({label:H&&void 0!==x[H]?x[H]:L,value:B,chartType:p});return t}F=e.getFieldInfo(A,E);B=e.getFixedFieldName(E,B);F=C&&void 0!==u[C]?u[C]:e.getFieldInfoLabel(F||new l({fieldName:B}),null==(L=this.popupTemplate)?void 0:L.expressionInfos);t.tooltip=this._getTooltip({label:F,value:u[B],chartType:p});return t};a._createClass(v,[{key:"activeMediaInfo",get:function(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}},{key:"formattedMediaInfos",
get:function(){return this._formatMediaInfos()||[]}},{key:"formattedMediaInfoCount",get:function(){return this.formattedMediaInfos.length}}]);return v}(c);b.__decorate([g.property()],c.prototype,"abilities",void 0);b.__decorate([n.cast("abilities")],c.prototype,"castAbilities",null);b.__decorate([g.property()],c.prototype,"activeMediaInfoIndex",void 0);b.__decorate([g.property({readOnly:!0})],c.prototype,"activeMediaInfo",null);b.__decorate([g.property()],c.prototype,"attributes",void 0);b.__decorate([g.property()],
c.prototype,"description",void 0);b.__decorate([g.property()],c.prototype,"fieldInfoMap",void 0);b.__decorate([g.property()],c.prototype,"formattedAttributes",void 0);b.__decorate([g.property()],c.prototype,"expressionAttributes",void 0);b.__decorate([g.property({readOnly:!0})],c.prototype,"formattedMediaInfos",null);b.__decorate([g.property()],c.prototype,"layer",void 0);b.__decorate([g.property({readOnly:!0})],c.prototype,"formattedMediaInfoCount",null);b.__decorate([g.property()],c.prototype,"mediaInfos",
void 0);b.__decorate([g.property()],c.prototype,"popupTemplate",void 0);b.__decorate([g.property()],c.prototype,"relatedInfos",void 0);b.__decorate([g.property()],c.prototype,"title",void 0);return c=b.__decorate([f.subclass("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],c)})},"esri/widgets/Feature/support/relatedFeatureUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../request ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../layers/support/fieldUtils ../../../rest/support/Query ../../../rest/support/RelationshipQuery ../../../rest/support/StatisticDefinition ../../../tasks/QueryTask ./featureUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){function m(A,p){if(!p.relationships)return null;let B=null;({relationships:p}=p);p.some(D=>D.id===parseInt(A,10)?(B=D,!0):!1);return B}function z({originRelationship:A,relationships:p,layerId:B}){let D;p&&p.some(C=>{`${C.relatedTableId}`===B&&C.id===A.id&&(D=C);return!!D});return D}function v(A,p){p=p.toLowerCase();for(const B in A)if(B.toLowerCase()===p)return A[B];return null}function q(A,p,B,D){const C=new l;C.outFields=["*"];C.relationshipId="number"===typeof p.id?
p.id:parseInt(p.id,10);C.objectIds=[A.attributes[B.objectIdField]];return B.queryRelatedFeatures(C,D)}function t(A,p,B){let D=0;const C=[];for(;D<p.length;)C.push(`${A} IN (${p.slice(D,B+D)})`),D+=B;return C.join(" OR ")}function r(A,p,B,D){return x.apply(this,arguments)}function x(){x=b._asyncToGenerator(function*(A,p,B,D){var C=B.layerId.toString();const {layerInfo:F,queryTask:G,relation:L,relatedFields:H,outStatistics:M}=p;C=z({originRelationship:L,relationships:F.relationships,layerId:C});if(C.relationshipTableId&&
C.keyFieldInRelationshipTable){B=(yield q(A,C,B,D))[A.attributes[B.objectIdField]];if(!B)return null;const K=B.features.map(I=>I.attributes[F.objectIdField]);if(0<(null==M?void 0:M.length)&&F.supportsStatistics)return p=new f,p.where=t(F.objectIdField,K,1E3),p.outFields=H,p.outStatistics=M,p={features:Promise.resolve(B),statsFeatures:G.execute(p)},w.eachAlways(p)}return(C=null==C?void 0:C.keyField)?(B=n.isNumericField(u(F.fields,C)),A=v(A.attributes,L.keyField),C=B?`${C}=${A}`:`${C}='${A}'`,A=G.execute(new f({where:C,
outFields:p.relatedFields}),D),p=p.outStatistics&&0<p.outStatistics.length&&F.supportsStatistics?G.execute(new f({where:C,outFields:p.relatedFields,outStatistics:p.outStatistics}),D):null,D={features:A},p&&(D.statsFeatures=p),w.eachAlways(D)):null});return x.apply(this,arguments)}function u(A,p){if(null!=A){p=p.toLowerCase();for(const B of A)if(B&&B.name.toLowerCase()===p)return B}return null}const E=h.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),y=new Map;a.createRelatedInfo=function(A,
p){if(A=m(A,p)){var B=`${p.url}/${A.relatedTableId}`;p=new e({url:B,sourceSpatialReference:p.spatialReference});return{url:B,queryTask:p,relation:A,relatedFields:[],outStatistics:[]}}};a.getDestinationRelation=z;a.getRelatedFieldInfo=function(A){if(!d.isRelatedField(A))return null;const [p,B]=A.split("/").slice(1);return{layerId:p,fieldName:B}};a.queryLayerInfos=function({relatedInfos:A,layer:p},B){const D={};A.forEach((C,F)=>{({relation:C}=C);if(!C)throw F=new g("relation-required","A relation is required on a layer to retrieve related records."),
E.error(F),F;({relatedTableId:C}=C);if("number"!==typeof C)throw F=new g("A related table ID is required on a layer to retrieve related records."),E.error(F),F;C=`${p.url}/${C}`;const G=y.get(C),L=G?G:c(C,{query:{f:"json"},signal:B&&B.signal});G||y.set(C,L);D[F]=L});return w.eachAlways(D)};a.queryRelatedFeatures=function({graphic:A,relatedInfos:p,layer:B},D){const C={};p.forEach((F,G)=>{F.layerInfo&&(C[G]=r(A,F,B,D))});return w.eachAlways(C)};a.setRelatedFeatures=function(A,p){if(p&&A){var {features:B,
statsFeatures:D}=A;A=B&&B.value;p.relatedFeatures=A?A.features:[];A=D&&D.value;p.relatedStatsFeatures=A?A.features:[]}};a.updateRelatedInfo=function({relatedInfo:A,fieldName:p,fieldInfo:B}){A.relatedFields.push(p);B.statisticType&&(p=new k({statisticType:B.statisticType,onStatisticField:p,outStatisticFieldName:p}),A.outStatistics.push(p))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/support/chartUtils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../intl ../../core/has ../../intl/locale".split(" "),
function(a,b,c,g,h,w){function n(m){if(!m)return"en-us";if(k.has(m.toLowerCase()))return m.toLowerCase();{m=m.split("-")[0].toLowerCase();let v=null;for(z of k.keys())if(z.startsWith(m)){v=z;break}var z=v}return z||"en-us"}function f(){f=c._asyncToGenerator(function*(m=w.getLocale()){m=n(m);if(e&&m===d)return e;e=(new Promise((z,v)=>a(["../../chunks/index"],z,v))).then(z=>z.index);d=m;try{const [z,v]=yield Promise.all([e,k.get(d)()]);d===m&&(z.am4core.options.defaultLocale=v.default);z.am4core.options.suppressWarnings=
!0;z.am4core.options.autoDispose=!0}catch{return d=e=null}return e});return f.apply(this,arguments)}g="#ffffff #858585 #ffbebe #ffebbe #ffebaf #ffffbe #e9ffbe #d3ffbe #beffe8 #bee8ff #bed2ff #e8beff #ffbee8 #ebebeb #707070 #ff7f7f #ffa77f #ffd37f #ffff73 #d1ff73 #a3ff73 #73ffdf #73dfff #73b2ff #df73ff #ff73df #d6d6d6 #5c5c5c #ff0000 #ff5500 #ffaa00 #ffff00 #aaff00 #55ff00 #00ffc5 #00c5ff #0070ff #c500ff #ff00c5 #c2c2c2 #474747 #e60000 #e64c00 #e69800 #e6e600 #98e600 #4ce600 #00e6a9 #00a9e6 #005ce6 #a900e6 #e600a9 #adadad #242424 #a80000 #a83800 #a87000 #a8a800 #70a800 #38a800 #00a884 #0084a8 #004da8 #8400a8 #a80084 #999999 #1a1a1a #730000 #732600 #734c00 #737300 #4c7300 #267300 #00734c #004c73 #002673 #4c0073 #73004".split(" ");
var l=[{name:"default",colors:[].concat(g.slice(30,39),g.slice(28,30).reverse())},{name:"cat-dark",colors:"#ed5151 #149ece #a7c636 #9e559c #fc921f #ffde3e #f789d8 #b7814a #3caf99 #6b6bd6 #b54779 #7f7f7f".split(" ")},{name:"tropical-bliss",colors:"#fce138 #ff9399 #fcd27e #f1983c #a553b7 #b1a9d0 #6ecffc #4c81cd #fc6f84 #fc3e5a #6af689 #48885c".split(" ")},{name:"desert-blooms",colors:"#102432 #144d59 #ffc730 #ed9310 #a64f1b #661510 #d9351a #b31515 #4a0932 #8c213f #18382e #2c6954".split(" ")},{name:"under-the-sea",
colors:"#bf9727 #607100 #00734c #704489 #01acca #024e76 #f09100 #ea311f #c6004b #7570b3 #666666 #333333".split(" ")},{name:"vibrant-rainbow",colors:"#fffb00 #f5cb11 #9fd40c #46e39c #32b8a6 #7ff2fa #ac08cc #dd33ff #eb7200 #e8a784 #bf2e2e #6c7000".split(" ")},{name:"ocean-bay",colors:"#191921 #11495c #78b1c2 #454f4b #8f8f82 #9be0c0 #87b051 #f7ec88 #ebdcc1 #dbb658 #c43541 #75351e".split(" ")},{name:"prairie-summer",colors:"#332424 #751555 #d47013 #d68989 #211173 #82aad6 #7bfaeb #6ec9a8 #6b6408 #eada40 #ccc54a #1fc235".split(" ")},
{name:"pastel-chalk",colors:"#fffd99 #f5e6a4 #c1d48c #b8e3d0 #a0b8b5 #cbf7fa #d791f2 #dfc1eb #f2b983 #e8c4b2 #bf8e8e #94995c".split(" ")},{name:"seq-yellow-orange-red-bright",colors:"#910000 #b1260b #c0370f #e05919 #ef6a1d #ff7b22 #ffa143 #ffb454 #ffda74 #ffed85".split(" ")},{name:"seq-reds-bright",colors:"#57453b #7b4238 #9f4036 #c23d33 #d7483c #ec5244 #f3696c #f9816c #ffc4ae #fff0dc".split(" ")},{name:"seq-purples-bright",colors:"#4e465c #5a4a78 #695291 #775baa #8663c3 #946bdc #aa89e8 #c1a6f3 #d7c4ff #e6e1ff".split(" ")},
{name:"seq-blues-bright",colors:"#404d54 #435c6c #48799d #4b88b6 #4d96ce #50a5e7 #74bbed #98d0f3 #bce6f9 #e6faff".split(" ")},{name:"seq-greens-bright",colors:"#39544c #386757 #368165 #359b73 #33b581 #4bc392 #64d2a2 #7ce0b3 #cbf6d9 #f4ffea".split(" ")},{name:"seq-browns-bright",colors:"#524834 #715b38 #8f6e3c #ae8140 #cc9444 #eba748 #eeb664 #f0c47f #f9e0b7 #fff8eb".split(" ")}];const k=new Map([["ar",()=>(new Promise((m,z)=>a(["../../chunks/ar"],m,z))).then(m=>m.ar)],["bg-bg",()=>(new Promise((m,
z)=>a(["../../chunks/bg_BG"],m,z))).then(m=>m.bg_BG)],["bs-ba",()=>(new Promise((m,z)=>a(["../../chunks/bs_BA"],m,z))).then(m=>m.bs_BA)],["ca-es",()=>(new Promise((m,z)=>a(["../../chunks/ca_ES"],m,z))).then(m=>m.ca_ES)],["cs-cz",()=>(new Promise((m,z)=>a(["../../chunks/cs_CZ"],m,z))).then(m=>m.cs_CZ)],["da-dk",()=>(new Promise((m,z)=>a(["../../chunks/da_DK"],m,z))).then(m=>m.da_DK)],["de-de",()=>(new Promise((m,z)=>a(["../../chunks/de_DE"],m,z))).then(m=>m.de_DE)],["de-ch",()=>(new Promise((m,z)=>
a(["../../chunks/de_CH"],m,z))).then(m=>m.de_CH)],["el-gr",()=>(new Promise((m,z)=>a(["../../chunks/el_GR"],m,z))).then(m=>m.el_GR)],["en-us",()=>(new Promise((m,z)=>a(["../../chunks/en_US"],m,z))).then(m=>m.en_US)],["en-ca",()=>(new Promise((m,z)=>a(["../../chunks/en_CA"],m,z))).then(m=>m.en_CA)],["es-es",()=>(new Promise((m,z)=>a(["../../chunks/es_ES"],m,z))).then(m=>m.es_ES)],["et-ee",()=>(new Promise((m,z)=>a(["../../chunks/et_EE"],m,z))).then(m=>m.et_EE)],["fi-fi",()=>(new Promise((m,z)=>a(["../../chunks/fi_FI"],
m,z))).then(m=>m.fi_FI)],["fr-fr",()=>(new Promise((m,z)=>a(["../../chunks/fr_FR"],m,z))).then(m=>m.fr_FR)],["he-il",()=>(new Promise((m,z)=>a(["../../chunks/he_IL"],m,z))).then(m=>m.he_IL)],["hr-hr",()=>(new Promise((m,z)=>a(["../../chunks/hr_HR"],m,z))).then(m=>m.hr_HR)],["hu-hu",()=>(new Promise((m,z)=>a(["../../chunks/hu_HU"],m,z))).then(m=>m.hu_HU)],["id-id",()=>(new Promise((m,z)=>a(["../../chunks/id_ID"],m,z))).then(m=>m.id_ID)],["it-it",()=>(new Promise((m,z)=>a(["../../chunks/it_IT"],m,z))).then(m=>
m.it_IT)],["ja-jp",()=>(new Promise((m,z)=>a(["../../chunks/ja_JP"],m,z))).then(m=>m.ja_JP)],["ko-kr",()=>(new Promise((m,z)=>a(["../../chunks/ko_KR"],m,z))).then(m=>m.ko_KR)],["lt-lt",()=>(new Promise((m,z)=>a(["../../chunks/lt_LT"],m,z))).then(m=>m.lt_LT)],["lv-lv",()=>(new Promise((m,z)=>a(["../../chunks/lv_LV"],m,z))).then(m=>m.lv_LV)],["nb-no",()=>(new Promise((m,z)=>a(["../../chunks/nb_NO"],m,z))).then(m=>m.nb_NO)],["nl-nl",()=>(new Promise((m,z)=>a(["../../chunks/nl_NL"],m,z))).then(m=>m.nl_NL)],
["pl-pl",()=>(new Promise((m,z)=>a(["../../chunks/pl_PL"],m,z))).then(m=>m.pl_PL)],["pt-br",()=>(new Promise((m,z)=>a(["../../chunks/pt_BR"],m,z))).then(m=>m.pt_BR)],["pt-pt",()=>(new Promise((m,z)=>a(["../../chunks/pt_PT"],m,z))).then(m=>m.pt_PT)],["ro-ro",()=>(new Promise((m,z)=>a(["../../chunks/ro_RO"],m,z))).then(m=>m.ro_RO)],["ru-ru",()=>(new Promise((m,z)=>a(["../../chunks/ru_RU"],m,z))).then(m=>m.ru_RU)],["sk-sk",()=>(new Promise((m,z)=>a(["../../chunks/sk_SK"],m,z))).then(m=>m.sk_SK)],["sl-sl",
()=>(new Promise((m,z)=>a(["../../chunks/sl_SL"],m,z))).then(m=>m.sl_SL)],["sr-rs",()=>(new Promise((m,z)=>a(["../../chunks/sr_RS"],m,z))).then(m=>m.sr_RS)],["sv-se",()=>(new Promise((m,z)=>a(["../../chunks/sv_SE"],m,z))).then(m=>m.sv_SE)],["th-th",()=>(new Promise((m,z)=>a(["../../chunks/th_TH"],m,z))).then(m=>m.th_TH)],["tr-tr",()=>(new Promise((m,z)=>a(["../../chunks/tr_TR"],m,z))).then(m=>m.tr_TR)],["uk-ua",()=>(new Promise((m,z)=>a(["../../chunks/uk_UA"],m,z))).then(m=>m.uk_UA)],["vi-vn",()=>
(new Promise((m,z)=>a(["../../chunks/vi_VN"],m,z))).then(m=>m.vi_VN)],["zh-cn",()=>(new Promise((m,z)=>a(["../../chunks/zh_Hans"],m,z))).then(m=>m.zh_Hans)],["zh-hk",()=>(new Promise((m,z)=>a(["../../chunks/zh_Hant"],m,z))).then(m=>m.zh_Hant)],["zh-tw",()=>(new Promise((m,z)=>a(["../../chunks/zh_Hant"],m,z))).then(m=>m.zh_Hant)]]);let e,d;b.getChartLocale=n;b.getColorSet=function(m,z="default"){const v=l.find(q=>q.name===z);return v?v.colors.map(q=>m.color(q)):null};b.loadChartsModule=function(){return f.apply(this,
arguments)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/widgets/Feature/FeatureExpression/FeatureExpressionViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../chunks/languageUtils ../../../core/Accessor ../../../core/HandleOwner ../../../core/throttle ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../popup/content/AttachmentsContent ../../../popup/content/Content ../../../popup/content/CustomContent ../../../popup/content/ExpressionContent ../../../popup/content/FieldsContent ../../../popup/content/MediaContent ../../../popup/content/TextContent ../../../popup/ElementExpressionInfo ../FeatureContent/FeatureContentViewModel ../FeatureFields/FeatureFieldsViewModel ../FeatureMedia/FeatureMediaViewModel ../support/arcadeFeatureUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B){h=function(D){function C(F){var G=D.call(this,F)||this;G._abortController=null;G.expressionInfo=null;G.graphic=null;G.contentElement=null;G.contentElementViewModel=null;G.interceptor=null;G.view=null;G._cancelQuery=()=>{const {_abortController:L}=a._assertThisInitialized(G);L&&L.abort();G._abortController=null};G._createVM=()=>{var L,H;const M=null==(L=G.contentElement)?void 0:L.type;null==(H=G.contentElementViewModel)?void 0:H.destroy();
L="fields"===M?new A:"media"===M?new p:"text"===M?new y:null;G._set("contentElementViewModel",L)};G._compile=a._asyncToGenerator(function*(){G._cancelQuery();const L=new AbortController;G._abortController=L;yield G._compileExpression();G._abortController===L&&(G._abortController=null)});G._compileThrottled=n.throttle(G._compile,1,a._assertThisInitialized(G));G._compileExpression=a._asyncToGenerator(function*(){const {expressionInfo:L,graphic:H,interceptor:M,spatialReference:K,map:I,view:O,_abortController:Q}=
a._assertThisInitialized(G);if(L&&H&&K&&I){var J=yield B.loadArcadeUtils();if(Q===G._abortController)if((J=yield B.createCompiledExpression({arcadeUtils:J,expressionInfo:L,graphic:H,interceptor:M,map:I,spatialReference:K,view:O}))&&"esri.arcade.Dictionary"===J.declaredClass){J=yield g.castAsJsonAsync(J,Q.signal);var P=null==J?void 0:J.type;J="media"===P?x.fromJSON(J):"text"===P?u.fromJSON(J):"fields"===P?r.fromJSON(J):null;G._set("contentElement",J)}else G._set("contentElement",null)}else G._set("contentElement",
null)});G.handles.add([f.init(a._assertThisInitialized(G),["expressionInfo","graphic","map","spatialReference","view"],G._compileThrottled),f.init(a._assertThisInitialized(G),"contentElement",G._createVM)]);return G}a._inheritsLoose(C,D);C.prototype.destroy=function(){var F;this._cancelQuery();null==(F=this.contentElementViewModel)?void 0:F.destroy();this._set("contentElementViewModel",null);this._set("contentElement",null)};a._createClass(C,[{key:"spatialReference",get:function(){var F;return(null==
(F=this.view)?void 0:F.spatialReference)||null},set:function(F){void 0===F?this._clearOverride("spatialReference"):this._override("spatialReference",F)}},{key:"state",get:function(){const {_abortController:F,contentElement:G,contentElementViewModel:L}=this;return F?"loading":G||L?"ready":"disabled"}},{key:"map",get:function(){var F;return(null==(F=this.view)?void 0:F.map)||null},set:function(F){void 0===F?this._clearOverride("map"):this._override("map",F)}}]);return C}(w.HandleOwnerMixin(h));b.__decorate([l.property()],
h.prototype,"_abortController",void 0);b.__decorate([l.property({type:E})],h.prototype,"expressionInfo",void 0);b.__decorate([l.property({type:c})],h.prototype,"graphic",void 0);b.__decorate([l.property({readOnly:!0})],h.prototype,"contentElement",void 0);b.__decorate([l.property({readOnly:!0})],h.prototype,"contentElementViewModel",void 0);b.__decorate([l.property()],h.prototype,"interceptor",void 0);b.__decorate([l.property()],h.prototype,"spatialReference",null);b.__decorate([l.property({readOnly:!0})],
h.prototype,"state",null);b.__decorate([l.property()],h.prototype,"map",null);b.__decorate([l.property()],h.prototype,"view",void 0);return h=b.__decorate([m.subclass("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],h)})},"esri/chunks/languageUtils":function(){define("exports ../arcade/FunctionWrapper ../arcade/ImmutableArray ../arcade/ImmutablePathArray ../arcade/ImmutablePointArray ../core/promiseUtils ../geometry/Extent ../geometry/Geometry ../geometry/Multipoint ../geometry/Point ../geometry/Polygon ../geometry/Polyline ./datetime ../core/maybe ../core/number ../geometry/support/coordsUtils ../intl/locale ../arcade/featureset/support/shared".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r){function x(ya,La,Va){return""===La||null===La||void 0===La||La===Va||La===Va?ya:ya=ya.split(La).join(Va)}function u(ya){return ya instanceof cb||ya instanceof b||ya instanceof Ca}function E(ya){return A(ya)||B(ya)||M(ya)||p(ya)||null===ya||ya===wa||"number"===typeof ya?!0:!1}function y(ya,La){return void 0===ya?La:ya}function A(ya){return"string"===typeof ya||ya instanceof String}function p(ya){return"boolean"===typeof ya}function B(ya){return"number"===
typeof ya}function D(ya){return"number"===typeof ya&&isFinite(ya)&&Math.floor(ya)===ya}function C(ya){return ya instanceof Array}function F(ya){return"esri.arcade.Feature"===(null==ya?void 0:ya.arcadeDeclaredClass)?!0:!1}function G(ya){return!0===(ya&&ya.declaredRootClass&&"esri.arcade.featureset.support.FeatureSet"===ya.declaredRootClass)}function L(ya){return!0===(ya&&ya.declaredRootClass&&"esri.arcade.featureSetCollection"===ya.declaredRootClass)}function H(ya){return ya instanceof c}function M(ya){return ya instanceof
Date}function K(ya,La,Va){if(ya.length<La||ya.length>Va)throw Error("Function called with wrong number of Parameters");}function I(ya){return 0>ya?-Math.round(-ya):Math.round(ya)}function O(){let ya=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(La){const Va=(ya+16*Math.random())%16|0;ya=Math.floor(ya/16);return("x"===La?Va:Va&3|8).toString(16)})}function Q(ya,La){if(!1===isNaN(ya)){if(void 0===La||null===La||""===La)return ya.toString();La=x(La,"\u2030","");La=x(La,
"\u00a4","");return v.format(ya,{pattern:La})}return ya.toString()}function J(ya,La){ya=m.DateTime.fromJSDate(ya);return void 0===La||null===La||""===La?ya.toISO({suppressMilliseconds:!0}):ya.toFormat(P(La),{locale:t.getLocale(),numberingSystem:"latn"})}function P(ya){ya=ya.replace(/LTS|LT|LL?L?L?|l{1,4}/g,"[$\x26]");let La="";const Va=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;
for(const hb of ya.match(Va))switch(hb){case "D":La+="d";break;case "DD":La+="dd";break;case "DDD":La+="o";break;case "d":La+="c";break;case "ddd":La+="ccc";break;case "dddd":La+="cccc";break;case "M":La+="L";break;case "MM":La+="LL";break;case "MMM":La+="LLL";break;case "MMMM":La+="LLLL";break;case "YY":La+="yy";break;case "Y":case "YYYY":La+="yyyy";break;case "Q":La+="q";break;case "Z":La+="ZZ";break;case "ZZ":La+="ZZZ";break;case "S":La+="'S'";break;case "SS":La+="'SS'";break;case "SSS":La+="u";
break;case "A":case "a":La+="a";break;case "m":case "mm":case "h":case "hh":case "H":case "HH":case "s":case "ss":case "X":case "x":La+=hb;break;default:La=2<=hb.length&&"["===hb.slice(0,1)&&"]"===hb.slice(-1)?La+`'${hb.slice(1,-1)}'`:La+`'${hb}'`}return La}function N(ya,La,Va){switch(Va){case "\x3e":return ya>La;case "\x3c":return ya<La;case "\x3e\x3d":return ya>=La;case "\x3c\x3d":return ya<=La}return!1}function R(ya,La,Va){if(null===ya){if(null===La||La===wa)return N(null,null,Va);if(B(La))return N(0,
La,Va);if(A(La)||p(La))return N(0,aa(La),Va);if(M(La))return N(0,La.getTime(),Va)}if(ya===wa){if(null===La||La===wa)return N(null,null,Va);if(B(La))return N(0,La,Va);if(A(La)||p(La))return N(0,aa(La),Va);if(M(La))return N(0,La.getTime(),Va)}else if(B(ya)){if(B(La))return N(ya,La,Va);if(p(La))return N(ya,aa(La),Va);if(null===La||La===wa)return N(ya,0,Va);if(A(La))return N(ya,aa(La),Va);if(M(La))return N(ya,La.getTime(),Va)}else if(A(ya)){if(A(La))return N(T(ya),T(La),Va);if(M(La))return N(aa(ya),La.getTime(),
Va);if(B(La))return N(aa(ya),La,Va);if(null===La||La===wa)return N(aa(ya),0,Va);if(p(La))return N(aa(ya),aa(La),Va)}else if(M(ya)){if(M(La))return N(ya,La,Va);if(null===La||La===wa)return N(ya.getTime(),0,Va);if(B(La))return N(ya.getTime(),La,Va);if(p(La)||A(La))return N(ya.getTime(),aa(La),Va)}else if(p(ya)){if(p(La))return N(ya,La,Va);if(B(La))return N(aa(ya),aa(La),Va);if(M(La))return N(aa(ya),La.getTime(),Va);if(null===La||La===wa)return N(aa(ya),0,Va);if(A(La))return N(aa(ya),aa(La),Va)}return!S(ya,
La)||"\x3c\x3d"!==Va&&"\x3e\x3d"!==Va?!1:!0}function S(ya,La){if(ya===La||null===ya&&La===wa||null===La&&ya===wa)return!0;if(M(ya)&&M(La))return ya.getTime()===La.getTime();if(ya instanceof g||ya instanceof h)return ya.equalityTest(La);if(ya instanceof k&&La instanceof k){const Va=ya.cache._arcadeCacheId,hb=La.cache._arcadeCacheId;if(void 0!==Va&&null!==Va)return Va===hb}return void 0!==ya&&void 0!==La&&null!==ya&&null!==La&&"object"===typeof ya&&"object"===typeof La&&(ya._arcadeCacheId===La._arcadeCacheId&&
void 0!==ya._arcadeCacheId&&null!==ya._arcadeCacheId||ya._underlyingGraphic===La._underlyingGraphic&&void 0!==ya._underlyingGraphic&&null!==ya._underlyingGraphic)?!0:!1}function T(ya,La){if(A(ya))return ya;if(null===ya)return"";if(B(ya))return Q(ya,La);if(p(ya))return ya.toString();if(M(ya))return J(ya,La);if(ya instanceof f)return JSON.stringify(ya.toJSON());if(C(ya)){La=[];for(var Va=0;Va<ya.length;Va++)La[Va]=U(ya[Va]);return"["+La.join(",")+"]"}if(ya instanceof c){La=[];for(Va=0;Va<ya.length();Va++)La[Va]=
U(ya.get(Va));return"["+La.join(",")+"]"}return null!==ya&&"object"===typeof ya&&void 0!==ya.castToText?ya.castToText():u(ya)?"object, Function":""}function V(ya){const La=[];if(!1===C(ya))return null;if(ya instanceof c){for(var Va=0;Va<ya.length();Va++)La[Va]=aa(ya.get(Va));return La}for(Va=0;Va<ya.length;Va++)La[Va]=aa(ya[Va]);return La}function W(ya,La){if(A(ya))return ya;if(null===ya)return"";if(B(ya))return Q(ya,La);if(p(ya))return ya.toString();if(M(ya))return J(ya,La);if(ya instanceof f)return ya instanceof
n?'{"xmin":'+ya.xmin.toString()+',"ymin":'+ya.ymin.toString()+","+(ya.hasZ?'"zmin":'+ya.zmin.toString()+",":"")+(ya.hasM?'"mmin":'+ya.mmin.toString()+",":"")+'"xmax":'+ya.xmax.toString()+',"ymax":'+ya.ymax.toString()+","+(ya.hasZ?'"zmax":'+ya.zmax.toString()+",":"")+(ya.hasM?'"mmax":'+ya.mmax.toString()+",":"")+'"spatialReference":'+ha(ya.spatialReference)+"}":ha(ya.toJSON(),(hb,kb)=>hb.key===kb.key?0:"spatialReference"===hb.key?1:"spatialReference"===kb.key||hb.key<kb.key?-1:hb.key>kb.key?1:0);if(C(ya)){La=
[];for(var Va=0;Va<ya.length;Va++)La[Va]=U(ya[Va]);return"["+La.join(",")+"]"}if(ya instanceof c){La=[];for(Va=0;Va<ya.length();Va++)La[Va]=U(ya.get(Va));return"["+La.join(",")+"]"}return null!==ya&&"object"===typeof ya&&void 0!==ya.castToText?ya.castToText():u(ya)?"object, Function":""}function U(ya){return null===ya?"null":p(ya)||B(ya)||A(ya)?JSON.stringify(ya):ya instanceof f||ya instanceof c||ya instanceof Array?W(ya):ya instanceof Date?JSON.stringify(J(ya,"")):null!==ya&&"object"===typeof ya&&
void 0!==ya.castToText?ya.castToText():"null"}function aa(ya,La){return B(ya)?ya:null===ya||""===ya?0:M(ya)?NaN:p(ya)?ya?1:0:C(ya)||""===ya||void 0===ya?NaN:void 0!==La&&A(ya)?(La=x(La,"\u2030",""),La=x(La,"\u00a4",""),v.parse(ya,{pattern:La})):ya===wa?0:Number(ya)}function da(ya){return M(ya)?ya:A(ya)&&(ya=ea(ya))?ya.toJSDate():null}function Y(ya){return M(ya)?m.DateTime.fromJSDate(ya):A(ya)?ea(ya):null}function ea(ya){const La=/ (\d\d)/;let Va=m.DateTime.fromISO(ya);return Va.isValid||La.test(ya)&&
(ya=ya.replace(La,"T$1"),Va=m.DateTime.fromISO(ya),Va.isValid)?Va:null}function ja(ya){return p(ya)?ya:A(ya)?(ya=ya.toLowerCase(),"true"===ya?!0:!1):B(ya)?0===ya||isNaN(ya)?!1:!0:!1}function la(ya,La){if(z.isNone(ya))return null;if(null===ya.spatialReference||void 0===ya.spatialReference)ya.spatialReference=La;return ya}function ia(ya){if(null===ya)return null;if(ya instanceof k)return"NaN"===ya.x||null===ya.x||isNaN(ya.x)?null:ya;if(ya instanceof e){if(0===ya.rings.length)return null;for(const La of ya.rings)if(0<
La.length)return ya;return null}if(ya instanceof d){if(0===ya.paths.length)return null;for(const La of ya.paths)if(0<La.length)return ya;return null}return ya instanceof l?0===ya.points.length?null:ya:ya instanceof n?"NaN"===ya.xmin||null===ya.xmin||isNaN(ya.xmin)?null:ya:null}function ca(ya,La){if(!ya||!ya.domain)return La;let Va=null;if("string"===ya.field.type||"esriFieldTypeString"===ya.field.type)La=T(La);else{if(null===La||void 0===La)return null;if(""===La)return La;La=aa(La)}for(let hb=0;hb<
ya.domain.codedValues.length;hb++){const kb=ya.domain.codedValues[hb];kb.code===La&&(Va=kb)}return null===Va?La:Va.name}function fa(ya,La){if(!ya||!ya.domain)return La;let Va=null;La=T(La);for(let hb=0;hb<ya.domain.codedValues.length;hb++){const kb=ya.domain.codedValues[hb];kb.name===La&&(Va=kb)}return null===Va?La:Va.code}function ba(ya,La,Va=null,hb=null){if(!La||!La.fields)return null;let kb=null;for(let sb=0;sb<La.fields.length;sb++){const $a=La.fields[sb];$a.name.toLowerCase()===ya.toString().toLowerCase()&&
(kb=$a)}if(null===kb)throw Error("Field not found");let ib,ob;null===hb&&Va&&La.typeIdField&&(hb=Va.hasField(La.typeIdField)?Va.field(La.typeIdField):null);null!==hb&&void 0!==hb&&La.types.some(function(sb){return sb.id===hb?((ib=sb.domains&&sb.domains[kb.name])&&"inherited"===ib.type&&(ib=Z(kb.name,La),ob=!0),!0):!1});ob||ib||(ib=Z(ya,La));return{field:kb,domain:ib}}function Z(ya,La){let Va;La.fields.some(function(hb){hb.name.toLowerCase()===ya.toLowerCase()&&(Va=hb.domain);return!!Va});return Va}
function ha(ya,La){La||(La={});"function"===typeof La&&(La={cmp:La});const Va="boolean"===typeof La.cycles?La.cycles:!1,hb=La.cmp&&function(ib){return function(ob){return function(sb,$a){return ib({key:sb,value:ob[sb]},{key:$a,value:ob[$a]})}}}(La.cmp),kb=[];return function sb(ob){ob&&ob.toJSON&&"function"===typeof ob.toJSON&&(ob=ob.toJSON());if(void 0!==ob){if("number"===typeof ob)return isFinite(ob)?""+ob:"null";if("object"!==typeof ob)return JSON.stringify(ob);var $a;if(Array.isArray(ob)){var za=
"[";for($a=0;$a<ob.length;$a++)$a&&(za+=","),za+=sb(ob[$a])||"null";return za+"]"}if(null===ob)return"null";if(-1!==kb.indexOf(ob)){if(Va)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON");}var Pa=kb.push(ob)-1,Xa=Object.keys(ob).sort(hb&&hb(ob));za="";for($a=0;$a<Xa.length;$a++){const Za=Xa[$a],eb=sb(ob[Za]);eb&&(za&&(za+=","),za+=JSON.stringify(Za)+":"+eb)}kb.splice(Pa,1);return"{"+za+"}"}}(ya)}function na(ya){if(null===ya)return null;const La=[];for(const Va of ya)Va&&
Va.arcadeDeclaredClass&&"esri.arcade.Feature"===Va.arcadeDeclaredClass?La.push(Va.geometry()):La.push(Va);return La}function pa(ya,La){if(La instanceof k)ya.push(La.hasZ?La.hasM?[La.x,La.y,La.z,La.m]:[La.x,La.y,La.z]:[La.x,La.y]);else throw Error("Invalid Argument");}function xa(ya,La){if(C(ya)||H(ya)){let Va=!1,hb=!1,kb=[];if(C(ya)){for(const ib of ya)pa(kb,ib);0<kb.length&&(La=ya[0].spatialReference,Va=ya[0].hasZ,hb=ya[0].hasM)}else if(ya instanceof h)kb=ya._elements,0<kb.length&&(Va=ya._hasZ,hb=
ya._hasM,La=ya.get(0).spatialReference);else if(H(ya)){for(const ib of ya.toArray())pa(kb,ib);0<kb.length&&(La=ya.get(0).spatialReference,Va=!0===ya.get(0).hasZ,hb=!0===ya.get(0).hasM)}else throw Error("Invalid Argument");if(0===kb.length)return null;!1===q.isClockwise(kb,hb,Va)&&(kb=kb.slice(0).reverse());return new e({rings:[kb],spatialReference:La,hasZ:Va,hasM:hb})}return ya}function Da(ya,La){if(C(ya)||H(ya)){let Va=!1,hb=!1,kb=[];if(C(ya)){for(const ib of ya)pa(kb,ib);0<kb.length&&(La=ya[0].spatialReference,
Va=!0===ya[0].hasZ,hb=!0===ya[0].hasM)}else if(ya instanceof h)kb=ya._elements,0<kb.length&&(Va=ya._hasZ,hb=ya._hasM,La=ya.get(0).spatialReference);else if(H(ya)){for(const ib of ya.toArray())pa(kb,ib);0<kb.length&&(La=ya.get(0).spatialReference,Va=!0===ya.get(0).hasZ,hb=!0===ya.get(0).hasM)}return 0===kb.length?null:new d({paths:[kb],spatialReference:La,hasZ:Va,hasM:hb})}return ya}function ua(ya,La){if(C(ya)||H(ya)){let Va=!1,hb=!1,kb=[];if(C(ya)){for(const ib of ya)pa(kb,ib);0<kb.length&&(La=ya[0].spatialReference,
Va=!0===ya[0].hasZ,hb=!0===ya[0].hasM)}else if(ya instanceof h)kb=ya._elements,0<kb.length&&(Va=ya._hasZ,hb=ya._hasM,La=ya.get(0).spatialReference);else if(H(ya)){for(const ib of ya.toArray())pa(kb,ib);0<kb.length&&(La=ya.get(0).spatialReference,Va=!0===ya.get(0).hasZ,hb=!0===ya.get(0).hasM)}return 0===kb.length?null:new l({points:kb,spatialReference:La,hasZ:Va,hasM:hb})}return ya}function Fa(ya,La=!1){const Va=[];if(null===ya)return Va;if(!0===C(ya)){for(var hb=0;hb<ya.length;hb++){var kb=T(ya[hb]);
""===kb&&!0!==La||Va.push(kb)}return Va}if(ya instanceof c){for(hb=0;hb<ya.length();hb++)kb=T(ya.get(hb)),""===kb&&!0!==La||Va.push(kb);return Va}return E(ya)?(ya=T(ya),""===ya&&!0!==La||Va.push(ya),Va):[]}function qa(ya){Ua++;return 0===Ua%100?(Ua=0,w.create(La=>{setTimeout(()=>{La(ya)},0)})):ya}function sa(ya,La,Va){switch(Va){case "\x26":return ya&La;case "|":return ya|La;case "^":return ya^La;case "\x3c\x3c":return ya<<La;case "\x3e\x3e":return ya>>La;case "\x3e\x3e\x3e":return ya>>>La}}function ma(ya,
La=null){if(null!=ya){if(p(ya)||B(ya)||A(ya))return ya;if(ya instanceof f)return!0===(null==La?void 0:La.keepGeometryType)?ya:ya.toJSON();if(ya instanceof c)return ya.toArray().map(Va=>ma(Va,La));if(ya instanceof Array)return ya.map(Va=>ma(Va,La));if(ya instanceof Date)return ya;if(null!==ya&&"object"===typeof ya&&void 0!==ya.castAsJson)return ya.castAsJson(La)}return null}function ra(ya,La,Va,hb,kb){return va(ya,La,Va).then(ib=>{kb[hb]=ib})}function va(ya,La=null,Va=null){ya instanceof c&&(ya=ya.toArray());
if(null!=ya){if(E(ya)||ya instanceof f||ya instanceof Date)return w.resolve(ma(ya,Va));if(ya instanceof Array){const hb=[],kb=[];for(const ib of ya)null===ib||E(ib)||ib instanceof f||ib instanceof Date?kb.push(ma(ib,Va)):(kb.push(null),hb.push(ra(ib,La,Va,kb.length-1,kb)));return 0<hb.length?w.all(hb).then(()=>kb):w.resolve(kb)}if(null!==ya&&"object"===typeof ya&&void 0!==ya.castAsJsonAsync)return ya.castAsJsonAsync(La,Va)}return w.resolve(null)}function Ia(ya,La,Va){const hb=ya.fullSchema();return null!==
hb&&hb.fields?ba(La,hb,ya,Va):null}function Ja(ya){ya=ya.fullSchema();return null!==ya&&ya.fields?ya.typeIdField?{subtypeField:ya.typeIdField,subtypes:ya.types?ya.types.map(La=>({name:La.name,code:La.id})):[]}:null:null}function Ha(ya,La,Va,hb){const kb=ya.fullSchema();if(null===kb||!kb.fields)return null;hb=ba(La,kb,ya,hb);if(void 0===Va)try{Va=ya.field(La)}catch(ib){return null}return ca(hb,Va)}function Ta(ya,La,Va,hb){const kb=ya.fullSchema();if(null===kb||!kb.fields)return null;if(void 0===Va){try{Va=
ya.field(La)}catch(ib){return null}return Va}ya=ba(La,kb,ya,hb);return fa(ya,Va)}function db(ya){ya=ya.fullSchema();if(null===ya||!ya.fields)return null;const La=[];for(const Va of ya.fields)La.push(r.esriFieldToJson(Va));return{objectIdField:ya.objectIdField,globalIdField:ya.globalIdField,geometryType:void 0===r.layerGeometryEsriRestConstants[ya.geometryType]?"":r.layerGeometryEsriRestConstants[ya.geometryType],fields:La}}let fb=function(ya){this.value=ya},ka=function(ya){this.value=ya},cb=function(ya){this.fn=
ya},Ca=function(ya,La){this.paramCount=La;this.fn=ya};const Ka=cb,Oa=Ca,wa={type:"VOID"},Aa={type:"BREAK"},Na={type:"CONTINUE"};let Ua=0;const Ya=Object.freeze({__proto__:null,ReturnResultE:fb,ImplicitResultE:ka,NativeFunctionE:cb,SizzleFunctionE:Ca,NativeFunction:Ka,ImplicitResult:ka,ReturnResult:fb,SizzleFunction:Oa,voidOperation:wa,breakResult:Aa,continueResult:Na,multiReplace:x,isFunctionParameter:u,isSimpleType:E,defaultUndefined:y,isString:A,isBoolean:p,isNumber:B,isInteger:D,isArray:C,isFeature:F,
isFeatureSet:G,isFeatureSetCollection:L,isImmutableArray:H,isDate:M,pcCheck:K,absRound:I,generateUUID:O,formatNumber:Q,formatDate:J,standardiseDateFormat:P,greaterThanLessThan:R,equalityTest:S,toString:T,toNumberArray:V,toStringExplicit:W,toNumber:aa,toDate:da,toDateTime:Y,toBoolean:ja,fixSpatialReference:la,fixNullGeometry:ia,getDomainValue:ca,getDomainCode:fa,getDomain:ba,stableStringify:ha,autoCastFeatureToGeometry:na,autoCastArrayOfPointsToPolygon:xa,autoCastArrayOfPointsToPolyline:Da,autoCastArrayOfPointsToMultiPoint:ua,
toStringArray:Fa,tick:qa,binaryOperator:sa,castAsJson:ma,castAsJsonAsync:va,featureFullDomain:Ia,featureSubtypes:Ja,featureDomainValueLookup:Ha,featureDomainCodeLookup:Ta,featureSchema:db});a.ImplicitResult=ka;a.ImplicitResultE=ka;a.NativeFunction=Ka;a.NativeFunctionE=cb;a.ReturnResult=fb;a.ReturnResultE=fb;a.SizzleFunction=Oa;a.SizzleFunctionE=Ca;a.absRound=I;a.autoCastArrayOfPointsToMultiPoint=ua;a.autoCastArrayOfPointsToPolygon=xa;a.autoCastArrayOfPointsToPolyline=Da;a.autoCastFeatureToGeometry=
na;a.binaryOperator=sa;a.breakResult=Aa;a.castAsJson=ma;a.castAsJsonAsync=va;a.continueResult=Na;a.defaultUndefined=y;a.equalityTest=S;a.featureDomainCodeLookup=Ta;a.featureDomainValueLookup=Ha;a.featureFullDomain=Ia;a.featureSchema=db;a.featureSubtypes=Ja;a.fixNullGeometry=ia;a.fixSpatialReference=la;a.formatDate=J;a.formatNumber=Q;a.generateUUID=O;a.getDomain=ba;a.getDomainCode=fa;a.getDomainValue=ca;a.greaterThanLessThan=R;a.isArray=C;a.isBoolean=p;a.isDate=M;a.isFeature=F;a.isFeatureSet=G;a.isFeatureSetCollection=
L;a.isFunctionParameter=u;a.isImmutableArray=H;a.isInteger=D;a.isNumber=B;a.isSimpleType=E;a.isString=A;a.lc=Ya;a.multiReplace=x;a.pcCheck=K;a.stableStringify=ha;a.standardiseDateFormat=P;a.tick=qa;a.toBoolean=ja;a.toDate=da;a.toDateTime=Y;a.toNumber=aa;a.toNumberArray=V;a.toString=T;a.toStringArray=Fa;a.toStringExplicit=W;a.voidOperation=wa})},"esri/arcade/FunctionWrapper":function(){define(function(){return function(a,b){this.context=this.definition=null;this.definition=a;this.context=b}})},"esri/arcade/ImmutableArray":function(){define(function(){return function(){function a(c=
[]){this._elements=c}var b=a.prototype;b.length=function(){return this._elements.length};b.get=function(c){return this._elements[c]};b.toArray=function(){const c=[];for(let g=0;g<this.length();g++)c.push(this.get(g));return c};return a}()})},"esri/arcade/ImmutablePathArray":function(){define(["../chunks/_rollupPluginBabelHelpers","./ImmutableArray","./ImmutablePointArray"],function(a,b,c){return function(g){function h(n,f,l,k,e){n=g.call(this,n)||this;n._lazyPath=[];n._hasZ=!1;n._hasM=!1;n._hasZ=
l;n._hasM=k;n._spRef=f;n._cacheId=e;return n}a._inheritsLoose(h,g);var w=h.prototype;w.get=function(n){if(void 0===this._lazyPath[n]){const f=this._elements[n];if(void 0===f)return;this._lazyPath[n]=new c(f,this._spRef,this._hasZ,this._hasM,this._cacheId,n)}return this._lazyPath[n]};w.equalityTest=function(n){return n===this?!0:null===n||!1===n instanceof h?!1:n.getUniqueHash()===this.getUniqueHash()};w.getUniqueHash=function(){return this._cacheId.toString()};return h}(b)})},"esri/arcade/ImmutablePointArray":function(){define(["../chunks/_rollupPluginBabelHelpers",
"./ImmutableArray","../geometry/Point"],function(a,b,c){return function(g){function h(n,f,l,k,e,d){n=g.call(this,n)||this;n._lazyPt=[];n._hasZ=!1;n._hasM=!1;n._spRef=f;n._hasZ=l;n._hasM=k;n._cacheId=e;n._partId=d;return n}a._inheritsLoose(h,g);var w=h.prototype;w.get=function(n){if(void 0===this._lazyPt[n]){const f=this._elements[n];if(void 0===f)return;const l=this._hasZ,k=this._hasM;let e=null;e=l&&!k?new c(f[0],f[1],f[2],void 0,this._spRef):k&&!l?new c(f[0],f[1],void 0,f[2],this._spRef):l&&k?new c(f[0],
f[1],f[2],f[3],this._spRef):new c(f[0],f[1],this._spRef);e.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+n.toString();this._lazyPt[n]=e}return this._lazyPt[n]};w.equalityTest=function(n){return n===this?!0:null===n||!1===n instanceof h?!1:n.getUniqueHash()===this.getUniqueHash()};w.getUniqueHash=function(){return this._cacheId.toString()+"-"+this._partId.toString()};return h}(b)})},"esri/chunks/datetime":function(){define(["exports"],function(a){function b(X){return"undefined"===
typeof X}function c(X){return"number"===typeof X}function g(X){return"number"===typeof X&&0===X%1}function h(){try{return"undefined"!==typeof Intl&&!!Intl.RelativeTimeFormat}catch(X){return!1}}function w(X,oa,Ga){if(0!==X.length)return X.reduce((Ma,Sa)=>{Sa=[oa(Sa),Sa];return Ma?Ga(Ma[0],Sa[0])===Ma[0]?Ma:Sa:Sa},null)[1]}function n(X,oa){return oa.reduce((Ga,Ma)=>{Ga[Ma]=X[Ma];return Ga},{})}function f(X,oa){return Object.prototype.hasOwnProperty.call(X,oa)}function l(X,oa,Ga){return g(X)&&X>=oa&&
X<=Ga}function k(X,oa=2){return 0>X?"-"+(""+-X).padStart(oa,"0"):(""+X).padStart(oa,"0")}function e(X){if(!b(X)&&null!==X&&""!==X)return parseInt(X,10)}function d(X){if(!b(X)&&null!==X&&""!==X)return parseFloat(X)}function m(X){if(!b(X)&&null!==X&&""!==X)return X=1E3*parseFloat("0."+X),Math.floor(X)}function z(X,oa,Ga=!1){oa=10**oa;return(Ga?Math.trunc:Math.round)(X*oa)/oa}function v(X){return 0===X%4&&(0!==X%100||0===X%400)}function q(X,oa){var Ga=oa-1;Ga=Ga-12*Math.floor(Ga/12)+1;return 2===Ga?
v(X+(oa-Ga)/12)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][Ga-1]}function t(X){let oa=Date.UTC(X.year,X.month-1,X.day,X.hour,X.minute,X.second,X.millisecond);100>X.year&&0<=X.year&&(oa=new Date(oa),oa.setUTCFullYear(oa.getUTCFullYear()-1900));return+oa}function r(X){var oa=X-1;oa=(oa+Math.floor(oa/4)-Math.floor(oa/100)+Math.floor(oa/400))%7;return 4===(X+Math.floor(X/4)-Math.floor(X/100)+Math.floor(X/400))%7||3===oa?53:52}function x(X){return 99<X?X:60<X?1900+X:2E3+X}function u(X,oa,Ga,Ma=null){X=
new Date(X);const Sa={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};Ma&&(Sa.timeZone=Ma);return(oa=(new Intl.DateTimeFormat(Ga,{timeZoneName:oa,...Sa})).formatToParts(X).find(Wa=>"timezonename"===Wa.type.toLowerCase()))?oa.value:null}function E(X,oa){X=parseInt(X,10);Number.isNaN(X)&&(X=0);oa=parseInt(oa,10)||0;oa=0>X||Object.is(X,-0)?-oa:oa;return 60*X+oa}function y(X){const oa=Number(X);if("boolean"===typeof X||""===X||Number.isNaN(oa))throw new ab(`Invalid unit value ${X}`);
return oa}function A(X,oa){const Ga={};for(const Ma in X)if(f(X,Ma)){const Sa=X[Ma];void 0!==Sa&&null!==Sa&&(Ga[oa(Ma)]=y(Sa))}return Ga}function p(X,oa){const Ga=Math.trunc(Math.abs(X/60)),Ma=Math.trunc(Math.abs(X%60));X=0<=X?"+":"-";switch(oa){case "short":return`${X}${k(Ga,2)}:${k(Ma,2)}`;case "narrow":return`${X}${Ga}${0<Ma?`:${Ma}`:""}`;case "techie":return`${X}${k(Ga,2)}${k(Ma,2)}`;default:throw new RangeError(`Value format ${oa} is out of range for property format`);}}function B(X){return n(X,
["hour","minute","second","millisecond"])}function D(X){switch(X){case "narrow":return[...Pd];case "short":return[...wc];case "long":return[...Qc];case "numeric":return"1 2 3 4 5 6 7 8 9 10 11 12".split(" ");case "2-digit":return"01 02 03 04 05 06 07 08 09 10 11 12".split(" ");default:return null}}function C(X){switch(X){case "narrow":return[...Qd];case "short":return[...jd];case "long":return[...kd];case "numeric":return"1234567".split("");default:return null}}function F(X){switch(X){case "narrow":return[...Rd];
case "short":return[...Sd];case "long":return[...Td];default:return null}}function G(X,oa,Ga="always",Ma=!1){const Sa={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]};var Wa=-1===["hours","minutes","seconds"].indexOf(X);if("auto"===Ga&&Wa)switch(Ga="days"===X,oa){case 1:return Ga?"tomorrow":`next ${Sa[X][0]}`;case -1:return Ga?"yesterday":`last ${Sa[X][0]}`;
case 0:return Ga?"today":`this ${Sa[X][0]}`}Ga=Object.is(oa,-0)||0>oa;oa=Math.abs(oa);Wa=1===oa;const gb=Sa[X];X=Ma?Wa?gb[1]:gb[2]||gb[1]:Wa?Sa[X][0]:X;return Ga?`${oa} ${X} ago`:`in ${oa} ${X}`}function L(X,oa){let Ga="";for(const Ma of X)Ga=Ma.literal?Ga+Ma.val:Ga+oa(Ma.val);return Ga}function H(X,oa){if(b(X)||null===X)return oa;if(X instanceof pc)return X;if("string"===typeof X){const Ga=X.toLowerCase();return"local"===Ga||"system"===Ga?oa:"utc"===Ga||"gmt"===Ga?Mb.utcInstance:Mb.parseSpecifier(Ga)||
cc.create(X)}return c(X)?Mb.instance(X):"object"===typeof X&&X.offset&&"number"===typeof X.offset?X:new Ud(X)}function M(X,oa={}){const Ga=JSON.stringify([X,oa]);let Ma=ld[Ga];Ma||(Ma=new Intl.ListFormat(X,oa),ld[Ga]=Ma);return Ma}function K(X,oa={}){const Ga=JSON.stringify([X,oa]);let Ma=Rc[Ga];Ma||(Ma=new Intl.DateTimeFormat(X,oa),Rc[Ga]=Ma);return Ma}function I(X,oa={}){const Ga=JSON.stringify([X,oa]);let Ma=xc[Ga];Ma||(Ma=new Intl.NumberFormat(X,oa),xc[Ga]=Ma);return Ma}function O(X,oa={}){const {base:Ga,
...Ma}=oa,Sa=JSON.stringify([X,Ma]);let Wa=Sc[Sa];Wa||(Wa=new Intl.RelativeTimeFormat(X,oa),Sc[Sa]=Wa);return Wa}function Q(X){const oa=[];for(let Ga=1;12>=Ga;Ga++){const Ma=Ea.utc(2016,Ga,1);oa.push(X(Ma))}return oa}function J(X){const oa=[];for(let Ga=1;7>=Ga;Ga++){const Ma=Ea.utc(2016,11,13+Ga);oa.push(X(Ma))}return oa}function P(X,oa,Ga,Ma,Sa){X=X.listingMode(Ga);return"error"===X?null:"en"===X?Ma(oa):Sa(oa)}function N(...X){X=X.reduce((oa,Ga)=>oa+Ga.source,"");return RegExp(`^${X}$`)}function R(...X){return oa=>
X.reduce(([Ga,Ma,Sa],Wa)=>{const [gb,nb,qb]=Wa(oa,Sa);return[{...Ga,...gb},Ma||nb,qb]},[{},null,1]).slice(0,2)}function S(X,...oa){if(null==X)return[null,null];for(const [Ga,Ma]of oa)if(oa=Ga.exec(X))return Ma(oa);return[null,null]}function T(...X){return(oa,Ga)=>{const Ma={};let Sa;for(Sa=0;Sa<X.length;Sa++)Ma[X[Sa]]=e(oa[Ga+Sa]);return[Ma,null,Ga+Sa]}}function V(X,oa,Ga){X=X[oa];return b(X)?Ga:e(X)}function W(X,oa){return[{year:V(X,oa),month:V(X,oa+1,1),day:V(X,oa+2,1)},null,oa+3]}function U(X,
oa){return[{hours:V(X,oa,0),minutes:V(X,oa+1,0),seconds:V(X,oa+2,0),milliseconds:m(X[oa+3])},null,oa+4]}function aa(X,oa){const Ga=!X[oa]&&!X[oa+1];X=E(X[oa+1],X[oa+2]);return[{},Ga?null:Mb.instance(X),oa+3]}function da(X,oa){return[{},X[oa]?cc.create(X[oa]):null,oa+1]}function Y(X){const [oa,Ga,Ma,Sa,Wa,gb,nb,qb,xb]=X,vb="-"===oa[0];X=qb&&"-"===qb[0];const yb=(wb,Lb=!1)=>void 0!==wb&&(Lb||wb&&vb)?-wb:wb;return[{years:yb(d(Ga)),months:yb(d(Ma)),weeks:yb(d(Sa)),days:yb(d(Wa)),hours:yb(d(gb)),minutes:yb(d(nb)),
seconds:yb(d(qb),"-0"===qb),milliseconds:yb(m(xb),X)}]}function ea(X,oa,Ga,Ma,Sa,Wa,gb){oa={year:2===oa.length?x(e(oa)):e(oa),month:wc.indexOf(Ga)+1,day:e(Ma),hour:e(Sa),minute:e(Wa)};gb&&(oa.second=e(gb));X&&(oa.weekday=3<X.length?kd.indexOf(X)+1:jd.indexOf(X)+1);return oa}function ja(X){const [,oa,Ga,Ma,Sa,Wa,gb,nb,qb,xb,vb,yb]=X;X=ea(oa,Sa,Ma,Ga,Wa,gb,nb);let wb;wb=qb?Vd[qb]:xb?0:E(vb,yb);return[X,new Mb(wb)]}function la(X){const [,oa,Ga,Ma,Sa,Wa,gb,nb]=X;return[ea(oa,Sa,Ma,Ga,Wa,gb,nb),Mb.utcInstance]}
function ia(X){const [,oa,Ga,Ma,Sa,Wa,gb,nb]=X;return[ea(oa,nb,Ga,Ma,Sa,Wa,gb),Mb.utcInstance]}function ca(X,oa,Ga=!1){X={values:Ga?oa.values:{...X.values,...oa.values||{}},loc:X.loc.clone(oa.loc),conversionAccuracy:oa.conversionAccuracy||X.conversionAccuracy};return new zb(X)}function fa(X,oa,Ga,Ma,Sa){X=X[Sa][Ga];var Wa=oa[Ga]/X;Wa=Math.sign(Wa)!==Math.sign(Ma[Sa])&&0!==Ma[Sa]&&1>=Math.abs(Wa)?0>Wa?Math.floor(Wa):Math.ceil(Wa):Math.trunc(Wa);Ma[Sa]+=Wa;oa[Ga]-=Wa*X}function ba(X,oa){Wd.reduce((Ga,
Ma)=>{if(b(oa[Ma]))return Ga;Ga&&fa(X,oa,Ga,oa,Ma);return Ma},null)}function Z(X,oa){X=oa.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf()-X.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf();return Math.floor(zb.fromMillis(X).as("days"))}function ha(X,oa,Ga){var Ma=[["years",(nb,qb)=>qb.year-nb.year],["quarters",(nb,qb)=>qb.quarter-nb.quarter],["months",(nb,qb)=>qb.month-nb.month+12*(qb.year-nb.year)],["weeks",(nb,qb)=>{nb=Z(nb,qb);return(nb-nb%7)/7}],["days",Z]];const Sa={};let Wa,gb;for(const [nb,
qb]of Ma)0<=Ga.indexOf(nb)&&(Wa=nb,Ma=qb(X,oa),gb=X.plus({[nb]:Ma}),gb>oa?(X=X.plus({[nb]:Ma-1}),--Ma):X=gb,Sa[nb]=Ma);return[X,Sa,gb,Wa]}function na(X,oa,Ga,Ma){let [Sa,Wa,gb,nb]=ha(X,oa,Ga);X=oa-Sa;Ga=Ga.filter(qb=>0<=["hours","minutes","seconds","milliseconds"].indexOf(qb));0===Ga.length&&(gb<oa&&(gb=Sa.plus({[nb]:1})),gb!==Sa&&(Wa[nb]=(Wa[nb]||0)+X/(gb-Sa)));oa=zb.fromObject(Wa,Ma);return 0<Ga.length?zb.fromMillis(X,Ma).shiftTo(...Ga).plus(oa):oa}function pa({numberingSystem:X},oa=""){return new RegExp(`${Tc[X||
"latn"]}${oa}`)}function xa(X,oa=Ga=>Ga){return{regex:X,deser:([Ga])=>{{let Ma=parseInt(Ga,10);if(isNaN(Ma)){Ma="";for(let Sa=0;Sa<Ga.length;Sa++){const Wa=Ga.charCodeAt(Sa);if(-1!==Ga[Sa].search(Tc.hanidec))Ma+=Xd.indexOf(Ga[Sa]);else for(const gb in md){const [nb,qb]=md[gb];Wa>=nb&&Wa<=qb&&(Ma+=Wa-nb)}}Ga=parseInt(Ma,10)}else Ga=Ma}return oa(Ga)}}}function Da(X){return X.replace(/\./g,"\\.?").replace(yc,nd)}function ua(X,oa){return null===X?null:{regex:RegExp(X.map(Da).join("|")),deser:([Ga])=>
X.findIndex(Ma=>Ga.replace(/\./g,"").replace(yc," ").toLowerCase()===Ma.replace(/\./g,"").replace(yc," ").toLowerCase())+oa}}function Fa(X,oa){return{regex:X,deser:([,Ga,Ma])=>E(Ga,Ma),groups:oa}}function qa(X){return{regex:X,deser:([oa])=>oa}}function sa(X,oa){const Ga=pa(oa),Ma=pa(oa,"{2}"),Sa=pa(oa,"{3}"),Wa=pa(oa,"{4}"),gb=pa(oa,"{6}"),nb=pa(oa,"{1,2}"),qb=pa(oa,"{1,3}"),xb=pa(oa,"{1,6}"),vb=pa(oa,"{1,9}"),yb=pa(oa,"{2,4}"),wb=pa(oa,"{4,6}"),Lb=Yb=>({regex:RegExp(Yb.val.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,
"\\$\x26")),deser:([Yd])=>Yd,literal:!0}),Zb=(Yb=>{if(X.literal)return Lb(Yb);switch(Yb.val){case "G":return ua(oa.eras("short",!1),0);case "GG":return ua(oa.eras("long",!1),0);case "y":return xa(xb);case "yy":return xa(yb,x);case "yyyy":return xa(Wa);case "yyyyy":return xa(wb);case "yyyyyy":return xa(gb);case "M":return xa(nb);case "MM":return xa(Ma);case "MMM":return ua(oa.months("short",!0,!1),1);case "MMMM":return ua(oa.months("long",!0,!1),1);case "L":return xa(nb);case "LL":return xa(Ma);case "LLL":return ua(oa.months("short",
!1,!1),1);case "LLLL":return ua(oa.months("long",!1,!1),1);case "d":return xa(nb);case "dd":return xa(Ma);case "o":return xa(qb);case "ooo":return xa(Sa);case "HH":return xa(Ma);case "H":return xa(nb);case "hh":return xa(Ma);case "h":return xa(nb);case "mm":return xa(Ma);case "m":return xa(nb);case "q":return xa(nb);case "qq":return xa(Ma);case "s":return xa(nb);case "ss":return xa(Ma);case "S":return xa(qb);case "SSS":return xa(Sa);case "u":return qa(vb);case "uu":return qa(nb);case "uuu":return xa(Ga);
case "a":return ua(oa.meridiems(),0);case "kkkk":return xa(Wa);case "kk":return xa(yb,x);case "W":return xa(nb);case "WW":return xa(Ma);case "E":case "c":return xa(Ga);case "EEE":return ua(oa.weekdays("short",!1,!1),1);case "EEEE":return ua(oa.weekdays("long",!1,!1),1);case "ccc":return ua(oa.weekdays("short",!0,!1),1);case "cccc":return ua(oa.weekdays("long",!0,!1),1);case "Z":case "ZZ":return Fa(new RegExp(`([+-]${nb.source})(?::(${Ma.source}))?`),2);case "ZZZ":return Fa(new RegExp(`([+-]${nb.source})(${Ma.source})?`),
2);case "z":return qa(/[a-z_+-/]{1,256}?/i);default:return Lb(Yb)}})(X)||{invalidReason:"missing Intl.DateTimeFormat.formatToParts support"};Zb.token=X;return Zb}function ma(X){return[`^${X.map(oa=>oa.regex).reduce((oa,Ga)=>`${oa}(${Ga.source})`,"")}$`,X]}function ra(X,oa,Ga){if(X=X.match(oa)){oa={};let Ma=1;for(const Sa in Ga)if(f(Ga,Sa)){const Wa=Ga[Sa],gb=Wa.groups?Wa.groups+1:1;!Wa.literal&&Wa.token&&(oa[Wa.token.val[0]]=Wa.deser(X.slice(Ma,Ma+gb)));Ma+=gb}return[X,oa]}return[X,{}]}function va(X){const oa=
Sa=>{switch(Sa){case "S":return"millisecond";case "s":return"second";case "m":return"minute";case "h":case "H":return"hour";case "d":return"day";case "o":return"ordinal";case "L":case "M":return"month";case "y":return"year";case "E":case "c":return"weekday";case "W":return"weekNumber";case "k":return"weekYear";case "q":return"quarter";default:return null}};let Ga=null,Ma;b(X.z)||(Ga=cc.create(X.z));b(X.Z)||(Ga||(Ga=new Mb(X.Z)),Ma=X.Z);b(X.q)||(X.M=3*(X.q-1)+1);b(X.h)||(12>X.h&&1===X.a?X.h+=12:12===
X.h&&0===X.a&&(X.h=0));0===X.G&&X.y&&(X.y=-X.y);b(X.u)||(X.S=m(X.u));return[Object.keys(X).reduce((Sa,Wa)=>{const gb=oa(Wa);gb&&(Sa[gb]=X[Wa]);return Sa},{}),Ga,Ma]}function Ia(){zc||(zc=Ea.fromMillis(1555555555555));return zc}function Ja(X,oa){if(X.literal)return X;const Ga=Nb.macroTokenToFormatOpts(X.val);if(!Ga)return X;oa=Nb.create(oa,Ga).formatDateTimeParts(Ia()).map(Ma=>{{const {type:Wa,value:gb}=Ma;if("literal"===Wa)Ma={literal:!0,val:gb};else{Ma=Ga[Wa];var Sa=od[Wa];"object"===typeof Sa&&
(Sa=Sa[Ma]);Ma=Sa?{literal:!1,val:Sa}:void 0}}return Ma});return oa.includes(void 0)?X:oa}function Ha(X,oa){return Array.prototype.concat(...X.map(Ga=>Ja(Ga,oa)))}function Ta(X,oa,Ga){Ga=Ha(Nb.parseFormat(Ga),X);var Ma=Ga.map(Wa=>sa(Wa,X));const Sa=Ma.find(Wa=>Wa.invalidReason);if(Sa)return{input:oa,tokens:Ga,invalidReason:Sa.invalidReason};{const [Wa,gb]=ma(Ma);Ma=RegExp(Wa,"i");const [nb,qb]=ra(oa,Ma,gb),[xb,vb,yb]=qb?va(qb):[null,null,void 0];if(f(qb,"a")&&f(qb,"H"))throw new Qa("Can't include meridiem when specifying 24-hour format");
return{input:oa,tokens:Ga,regex:Ma,rawMatches:nb,matches:qb,result:xb,zone:vb,specificOffset:yb}}}function db(X,oa){return new Tb("unit out of range",`you specified ${oa} (of type ${typeof oa}) as a ${X}, which is invalid`)}function fb(X,oa,Ga){X=(new Date(Date.UTC(X,oa-1,Ga))).getUTCDay();return 0===X?7:X}function ka(X,oa){X=v(X)?ta:Ac;const Ga=X.findIndex(Ma=>Ma<oa);return{month:Ga+1,day:oa-X[Ga]}}function cb(X){const {year:oa,month:Ga,day:Ma}=X;var Sa=Ma+(v(oa)?ta:Ac)[Ga-1];const Wa=fb(oa,Ga,Ma);
Sa=Math.floor((Sa-Wa+10)/7);let gb;1>Sa?(gb=oa-1,Sa=r(gb)):Sa>r(oa)?(gb=oa+1,Sa=1):gb=oa;return{weekYear:gb,weekNumber:Sa,weekday:Wa,...B(X)}}function Ca(X){const {weekYear:oa,weekNumber:Ga,weekday:Ma}=X;var Sa=fb(oa,1,4),Wa=v(oa)?366:365;Sa=7*Ga+Ma-Sa-3;1>Sa?(Wa=oa-1,Sa+=v(Wa)?366:365):Sa>Wa?(Wa=oa+1,Sa-=v(oa)?366:365):Wa=oa;const {month:gb,day:nb}=ka(Wa,Sa);return{year:Wa,month:gb,day:nb,...B(X)}}function Ka(X){const {year:oa,month:Ga,day:Ma}=X;var Sa=Ma+(v(oa)?ta:Ac)[Ga-1];return{year:oa,ordinal:Sa,
...B(X)}}function Oa(X){const {year:oa,ordinal:Ga}=X,{month:Ma,day:Sa}=ka(oa,Ga);return{year:oa,month:Ma,day:Sa,...B(X)}}function wa(X){const oa=g(X.year),Ga=l(X.month,1,12),Ma=l(X.day,1,q(X.year,X.month));return oa?Ga?Ma?!1:db("day",X.day):db("month",X.month):db("year",X.year)}function Aa(X){const {hour:oa,minute:Ga,second:Ma,millisecond:Sa}=X;X=l(oa,0,23)||24===oa&&0===Ga&&0===Ma&&0===Sa;const Wa=l(Ga,0,59),gb=l(Ma,0,59),nb=l(Sa,0,999);return X?Wa?gb?nb?!1:db("millisecond",Sa):db("second",Ma):db("minute",
Ga):db("hour",oa)}function Na(X){return new Tb("unsupported zone",`the zone "${X.name}" is not supported`)}function Ua(X){null===X.weekData&&(X.weekData=cb(X.c));return X.weekData}function Ya(X,oa){X={ts:X.ts,zone:X.zone,c:X.c,o:X.o,loc:X.loc,invalid:X.invalid};return new Ea({...X,...oa,old:X})}function ya(X,oa,Ga){let Ma=X-6E4*oa;const Sa=Ga.offset(Ma);if(oa===Sa)return[Ma,oa];Ma-=6E4*(Sa-oa);oa=Ga.offset(Ma);return Sa===oa?[Ma,Sa]:[X-6E4*Math.min(Sa,oa),Math.max(Sa,oa)]}function La(X,oa){X=new Date(X+
6E4*oa);return{year:X.getUTCFullYear(),month:X.getUTCMonth()+1,day:X.getUTCDate(),hour:X.getUTCHours(),minute:X.getUTCMinutes(),second:X.getUTCSeconds(),millisecond:X.getUTCMilliseconds()}}function Va(X,oa,Ga){return ya(t(X),oa,Ga)}function hb(X,oa){const Ga=X.o;var Ma=X.c.year+Math.trunc(oa.years);const Sa=X.c.month+Math.trunc(oa.months)+3*Math.trunc(oa.quarters);Ma={...X.c,year:Ma,month:Sa,day:Math.min(X.c.day,q(Ma,Sa))+Math.trunc(oa.days)+7*Math.trunc(oa.weeks)};oa=zb.fromObject({years:oa.years-
Math.trunc(oa.years),quarters:oa.quarters-Math.trunc(oa.quarters),months:oa.months-Math.trunc(oa.months),weeks:oa.weeks-Math.trunc(oa.weeks),days:oa.days-Math.trunc(oa.days),hours:oa.hours,minutes:oa.minutes,seconds:oa.seconds,milliseconds:oa.milliseconds}).as("milliseconds");Ma=t(Ma);let [Wa,gb]=ya(Ma,Ga,X.zone);0!==oa&&(Wa+=oa,gb=X.zone.offset(Wa));return{ts:Wa,o:gb}}function kb(X,oa,Ga,Ma,Sa,Wa){const {setZone:gb,zone:nb}=Ga;return X&&0!==Object.keys(X).length?(X=Ea.fromObject(X,{...Ga,zone:oa||
nb,specificOffset:Wa}),gb?X:X.setZone(nb)):Ea.invalid(new Tb("unparsable",`the input "${Sa}" can't be parsed as ${Ma}`))}function ib(X,oa,Ga=!0){return X.isValid?Nb.create(Db.create("en-US"),{allowZ:Ga,forceSimple:!0}).formatDateTimeFromString(X,oa):null}function ob(X,oa){const Ga=9999<X.c.year||0>X.c.year;let Ma="";Ga&&0<=X.c.year&&(Ma+="+");Ma+=k(X.c.year,Ga?6:4);oa?(Ma=Ma+"-"+k(X.c.month),Ma=Ma+"-"+k(X.c.day)):(Ma+=k(X.c.month),Ma+=k(X.c.day));return Ma}function sb(X,oa,Ga,Ma,Sa){let Wa=k(X.c.hour);
oa?(Wa=Wa+":"+k(X.c.minute),0===X.c.second&&Ga||(Wa+=":")):Wa+=k(X.c.minute);0===X.c.second&&Ga||(Wa+=k(X.c.second),0===X.c.millisecond&&Ma||(Wa=Wa+"."+k(X.c.millisecond,3)));Sa&&(X.isOffsetFixed&&0===X.offset?Wa+="Z":0>X.o?(Wa=Wa+"-"+k(Math.trunc(-X.o/60)),Wa=Wa+":"+k(Math.trunc(-X.o%60))):(Wa=Wa+"+"+k(Math.trunc(X.o/60)),Wa=Wa+":"+k(Math.trunc(X.o%60))));return Wa}function $a(X){const oa={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",
minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[X.toLowerCase()];if(!oa)throw new Ra(X);return oa}function za(X,oa){const Ga=H(oa.zone,Gb.defaultZone);oa=Db.fromObject(oa);const Ma=Gb.now();var Sa;if(b(X.year))X=Ma;else{for(const Wa of bb)b(X[Wa])&&
(X[Wa]=qc[Wa]);if(Sa=wa(X)||Aa(X))return Ea.invalid(Sa);Sa=Ga.offset(Ma);[X,Sa]=Va(X,Sa,Ga)}return new Ea({ts:X,zone:Ga,loc:oa,o:Sa})}function Pa(X,oa,Ga){const Ma=b(Ga.round)?!0:Ga.round,Sa=(gb,nb)=>{gb=z(gb,Ma||Ga.calendary?0:2,!0);return oa.loc.clone(Ga).relFormatter(Ga).format(gb,nb)},Wa=gb=>Ga.calendary?oa.hasSame(X,gb)?0:oa.startOf(gb).diff(X.startOf(gb),gb).get(gb):oa.diff(X,gb).get(gb);if(Ga.unit)return Sa(Wa(Ga.unit),Ga.unit);for(const gb of Ga.units){const nb=Wa(gb);if(1<=Math.abs(nb))return Sa(nb,
gb)}return Sa(X>oa?-0:0,Ga.units[Ga.units.length-1])}function Xa(X){let oa={};0<X.length&&"object"===typeof X[X.length-1]?(oa=X[X.length-1],X=Array.from(X).slice(0,X.length-1)):X=Array.from(X);return[oa,X]}function Za(X){if(Ea.isDateTime(X))return X;if(X&&X.valueOf&&c(X.valueOf()))return Ea.fromJSDate(X);if(X&&"object"===typeof X)return Ea.fromObject(X);throw new ab(`Unknown datetime argument: ${X}, of type ${typeof X}`);}class eb extends Error{}class lb extends eb{constructor(X){super(`Invalid DateTime: ${X.toMessage()}`)}}
class tb extends eb{constructor(X){super(`Invalid Interval: ${X.toMessage()}`)}}class mb extends eb{constructor(X){super(`Invalid Duration: ${X.toMessage()}`)}}class Qa extends eb{}class Ra extends eb{constructor(X){super(`Invalid unit ${X}`)}}class ab extends eb{}class jb extends eb{constructor(){super("Zone is an abstract class")}}const pb={year:"numeric",month:"numeric",day:"numeric"},ub={year:"numeric",month:"short",day:"numeric"},rb={year:"numeric",month:"short",day:"numeric",weekday:"short"},
Ab={year:"numeric",month:"long",day:"numeric"},Kb={year:"numeric",month:"long",day:"numeric",weekday:"long"},Ob={hour:"numeric",minute:"numeric"},Ub={hour:"numeric",minute:"numeric",second:"numeric"},Bc={hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},Vb={hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"long"},lc={hour:"numeric",minute:"numeric",hourCycle:"h23"},$b={hour:"numeric",minute:"numeric",second:"numeric",hourCycle:"h23"},rc={hour:"numeric",minute:"numeric",
second:"numeric",hourCycle:"h23",timeZoneName:"short"},sc={hour:"numeric",minute:"numeric",second:"numeric",hourCycle:"h23",timeZoneName:"long"},mc={year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric"},nc={year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},fc={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"},tc={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},
Uc={year:"numeric",month:"short",day:"numeric",weekday:"short",hour:"numeric",minute:"numeric"},Hb={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",timeZoneName:"short"},Cc={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},Fb={year:"numeric",month:"long",day:"numeric",weekday:"long",hour:"numeric",minute:"numeric",timeZoneName:"long"},Wb={year:"numeric",month:"long",day:"numeric",weekday:"long",hour:"numeric",
minute:"numeric",second:"numeric",timeZoneName:"long"},Qc="January February March April May June July August September October November December".split(" "),wc="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),Pd="JFMAMJJASOND".split(""),kd="Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),jd="Mon Tue Wed Thu Fri Sat Sun".split(" "),Qd="MTWTFSS".split(""),Vc=["AM","PM"],Td=["Before Christ","Anno Domini"],Sd=["BC","AD"],Rd=["B","A"],pd={D:pb,DD:ub,DDD:Ab,DDDD:Kb,t:Ob,
tt:Ub,ttt:Bc,tttt:Vb,T:lc,TT:$b,TTT:rc,TTTT:sc,f:mc,ff:fc,fff:Hb,ffff:Fb,F:nc,FF:tc,FFF:Cc,FFFF:Wb};class Nb{static create(X,oa={}){return new Nb(X,oa)}static parseFormat(X){let oa=null,Ga="",Ma=!1;const Sa=[];for(let Wa=0;Wa<X.length;Wa++){const gb=X.charAt(Wa);"'"===gb?(0<Ga.length&&Sa.push({literal:Ma,val:Ga}),oa=null,Ga="",Ma=!Ma):Ma?Ga+=gb:gb===oa?Ga+=gb:(0<Ga.length&&Sa.push({literal:!1,val:Ga}),oa=Ga=gb)}0<Ga.length&&Sa.push({literal:Ma,val:Ga});return Sa}static macroTokenToFormatOpts(X){return pd[X]}constructor(X,
oa){this.opts=oa;this.loc=X;this.systemLoc=null}formatWithSystemDefault(X,oa){null===this.systemLoc&&(this.systemLoc=this.loc.redefaultToSystem());return this.systemLoc.dtFormatter(X,{...this.opts,...oa}).format()}formatDateTime(X,oa={}){return this.loc.dtFormatter(X,{...this.opts,...oa}).format()}formatDateTimeParts(X,oa={}){return this.loc.dtFormatter(X,{...this.opts,...oa}).formatToParts()}resolvedOptions(X,oa={}){return this.loc.dtFormatter(X,{...this.opts,...oa}).resolvedOptions()}num(X,oa=0){if(this.opts.forceSimple)return k(X,
oa);const Ga={...this.opts};0<oa&&(Ga.padTo=oa);return this.loc.numberFormatter(Ga).format(X)}formatDateTimeFromString(X,oa){const Ga="en"===this.loc.listingMode(),Ma=this.loc.outputCalendar&&"gregory"!==this.loc.outputCalendar,Sa=(vb,yb)=>this.loc.extract(X,vb,yb),Wa=vb=>X.isOffsetFixed&&0===X.offset&&vb.allowZ?"Z":X.isValid?X.zone.formatOffset(X.ts,vb.format):"",gb=(vb,yb)=>Ga?D(vb)[X.month-1]:Sa(yb?{month:vb}:{month:vb,day:"numeric"},"month"),nb=(vb,yb)=>Ga?C(vb)[X.weekday-1]:Sa(yb?{weekday:vb}:
{weekday:vb,month:"long",day:"numeric"},"weekday"),qb=vb=>{const yb=Nb.macroTokenToFormatOpts(vb);return yb?this.formatWithSystemDefault(X,yb):vb},xb=vb=>Ga?F(vb)[0>X.year?0:1]:Sa({era:vb},"era");return L(Nb.parseFormat(oa),vb=>{switch(vb){case "S":return this.num(X.millisecond);case "u":case "SSS":return this.num(X.millisecond,3);case "s":return this.num(X.second);case "ss":return this.num(X.second,2);case "uu":return this.num(Math.floor(X.millisecond/10),2);case "uuu":return this.num(Math.floor(X.millisecond/
100));case "m":return this.num(X.minute);case "mm":return this.num(X.minute,2);case "h":return this.num(0===X.hour%12?12:X.hour%12);case "hh":return this.num(0===X.hour%12?12:X.hour%12,2);case "H":return this.num(X.hour);case "HH":return this.num(X.hour,2);case "Z":return Wa({format:"narrow",allowZ:this.opts.allowZ});case "ZZ":return Wa({format:"short",allowZ:this.opts.allowZ});case "ZZZ":return Wa({format:"techie",allowZ:this.opts.allowZ});case "ZZZZ":return X.zone.offsetName(X.ts,{format:"short",
locale:this.loc.locale});case "ZZZZZ":return X.zone.offsetName(X.ts,{format:"long",locale:this.loc.locale});case "z":return X.zoneName;case "a":return Ga?Vc[12>X.hour?0:1]:Sa({hour:"numeric",hourCycle:"h12"},"dayperiod");case "d":return Ma?Sa({day:"numeric"},"day"):this.num(X.day);case "dd":return Ma?Sa({day:"2-digit"},"day"):this.num(X.day,2);case "c":return this.num(X.weekday);case "ccc":return nb("short",!0);case "cccc":return nb("long",!0);case "ccccc":return nb("narrow",!0);case "E":return this.num(X.weekday);
case "EEE":return nb("short",!1);case "EEEE":return nb("long",!1);case "EEEEE":return nb("narrow",!1);case "L":return Ma?Sa({month:"numeric",day:"numeric"},"month"):this.num(X.month);case "LL":return Ma?Sa({month:"2-digit",day:"numeric"},"month"):this.num(X.month,2);case "LLL":return gb("short",!0);case "LLLL":return gb("long",!0);case "LLLLL":return gb("narrow",!0);case "M":return Ma?Sa({month:"numeric"},"month"):this.num(X.month);case "MM":return Ma?Sa({month:"2-digit"},"month"):this.num(X.month,
2);case "MMM":return gb("short",!1);case "MMMM":return gb("long",!1);case "MMMMM":return gb("narrow",!1);case "y":return Ma?Sa({year:"numeric"},"year"):this.num(X.year);case "yy":return Ma?Sa({year:"2-digit"},"year"):this.num(X.year.toString().slice(-2),2);case "yyyy":return Ma?Sa({year:"numeric"},"year"):this.num(X.year,4);case "yyyyyy":return Ma?Sa({year:"numeric"},"year"):this.num(X.year,6);case "G":return xb("short");case "GG":return xb("long");case "GGGGG":return xb("narrow");case "kk":return this.num(X.weekYear.toString().slice(-2),
2);case "kkkk":return this.num(X.weekYear,4);case "W":return this.num(X.weekNumber);case "WW":return this.num(X.weekNumber,2);case "o":return this.num(X.ordinal);case "ooo":return this.num(X.ordinal,3);case "q":return this.num(X.quarter);case "qq":return this.num(X.quarter,2);case "X":return this.num(Math.floor(X.ts/1E3));case "x":return this.num(X.ts);default:return qb(vb)}})}formatDurationFromString(X,oa){const Ga=Sa=>{switch(Sa[0]){case "S":return"millisecond";case "s":return"second";case "m":return"minute";
case "h":return"hour";case "d":return"day";case "M":return"month";case "y":return"year";default:return null}};oa=Nb.parseFormat(oa);const Ma=oa.reduce((Sa,{literal:Wa,val:gb})=>Wa?Sa:Sa.concat(gb),[]);X=X.shiftTo(...Ma.map(Ga).filter(Sa=>Sa));return L(oa,(Sa=>Wa=>{const gb=Ga(Wa);return gb?this.num(Sa.get(gb),Wa.length):Wa})(X))}}class Tb{constructor(X,oa){this.reason=X;this.explanation=oa}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}class pc{get type(){throw new jb;
}get name(){throw new jb;}get isUniversal(){throw new jb;}offsetName(X,oa){throw new jb;}formatOffset(X,oa){throw new jb;}offset(X){throw new jb;}equals(X){throw new jb;}get isValid(){throw new jb;}}let Wc=null;class Xc extends pc{static get instance(){null===Wc&&(Wc=new Xc);return Wc}get type(){return"system"}get name(){return(new Intl.DateTimeFormat).resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(X,{format:oa,locale:Ga}){return u(X,oa,Ga)}formatOffset(X,oa){return p(this.offset(X),
oa)}offset(X){return-(new Date(X)).getTimezoneOffset()}equals(X){return"system"===X.type}get isValid(){return!0}}let Dc={};const qd={year:0,month:1,day:2,hour:3,minute:4,second:5};let Ec={};class cc extends pc{static create(X){Ec[X]||(Ec[X]=new cc(X));return Ec[X]}static resetCache(){Ec={};Dc={}}static isValidSpecifier(X){return this.isValidZone(X)}static isValidZone(X){if(!X)return!1;try{return(new Intl.DateTimeFormat("en-US",{timeZone:X})).format(),!0}catch(oa){return!1}}constructor(X){super();
this.zoneName=X;this.valid=cc.isValidZone(X)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(X,{format:oa,locale:Ga}){return u(X,oa,Ga,this.name)}formatOffset(X,oa){return p(this.offset(X),oa)}offset(X){X=new Date(X);if(isNaN(X))return NaN;var oa=this.name;Dc[oa]||(Dc[oa]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:oa,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}));oa=Dc[oa];if(oa.formatToParts){oa=
oa.formatToParts(X);var Ga=[];for(let xb=0;xb<oa.length;xb++){const {type:vb,value:yb}=oa[xb],wb=qd[vb];b(wb)||(Ga[wb]=parseInt(yb,10))}oa=Ga}else{{oa=oa.format(X).replace(/\u200E/g,"");oa=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(oa);const [,xb,vb,yb,wb,Lb,Zb]=oa;oa=[yb,xb,vb,wb,Lb,Zb]}}const [Ma,Sa,Wa,gb,nb,qb]=oa;oa=t({year:Ma,month:Sa,day:Wa,hour:24===gb?0:gb,minute:nb,second:qb,millisecond:0});X=+X;Ga=X%1E3;return(oa-(X-(0<=Ga?Ga:1E3+Ga)))/6E4}equals(X){return"iana"===X.type&&X.name===this.name}get isValid(){return this.valid}}
let Yc=null;class Mb extends pc{static get utcInstance(){null===Yc&&(Yc=new Mb(0));return Yc}static instance(X){return 0===X?Mb.utcInstance:new Mb(X)}static parseSpecifier(X){return X&&(X=X.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i))?new Mb(E(X[1],X[2])):null}constructor(X){super();this.fixed=X}get type(){return"fixed"}get name(){return 0===this.fixed?"UTC":`UTC${p(this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(X,oa){return p(this.fixed,oa)}get isUniversal(){return!0}offset(){return this.fixed}equals(X){return"fixed"===
X.type&&X.fixed===this.fixed}get isValid(){return!0}}class Ud extends pc{constructor(X){super();this.zoneName=X}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}let rd=()=>Date.now(),Fc="system",Gc=null,sd=null,td=null,ud;class Gb{static get now(){return rd}static set now(X){rd=X}static set defaultZone(X){Fc=X}static get defaultZone(){return H(Fc,Xc.instance)}static get defaultLocale(){return Gc}static set defaultLocale(X){Gc=
X}static get defaultNumberingSystem(){return sd}static set defaultNumberingSystem(X){sd=X}static get defaultOutputCalendar(){return td}static set defaultOutputCalendar(X){td=X}static get throwOnInvalid(){return ud}static set throwOnInvalid(X){ud=X}static resetCaches(){Db.resetCache();cc.resetCache()}}let ld={},Rc={},xc={},Sc={},uc=null;class vd{constructor(X,oa,Ga){this.padTo=Ga.padTo||0;this.floor=Ga.floor||!1;const {padTo:Ma,floor:Sa,...Wa}=Ga;if(!oa||0<Object.keys(Wa).length)oa={useGrouping:!1,
...Ga},0<Ga.padTo&&(oa.minimumIntegerDigits=Ga.padTo),this.inf=I(X,oa)}format(X){if(this.inf)return this.inf.format(this.floor?Math.floor(X):X);X=this.floor?Math.floor(X):z(X,3);return k(X,this.padTo)}}class Zd{constructor(X,oa,Ga){this.opts=Ga;if(X.zone.isUniversal){var Ma=X.offset/60*-1;Ma=0<=Ma?`Etc/GMT+${Ma}`:`Etc/GMT${Ma}`;0!==X.offset&&cc.create(Ma).valid?this.dt=X:(Ma="UTC",this.dt=Ga.timeZoneName?X:0===X.offset?X:Ea.fromMillis(X.ts+6E4*X.offset))}else"system"===X.zone.type?this.dt=X:(this.dt=
X,Ma=X.zone.name);X={...this.opts};Ma&&(X.timeZone=Ma);this.dtf=K(oa,X)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}class $d{constructor(X,oa,Ga){this.opts={style:"long",...Ga};!oa&&h()&&(this.rtf=O(X,Ga))}format(X,oa){return this.rtf?this.rtf.format(X,oa):G(oa,X,this.opts.numeric,"long"!==this.opts.style)}formatToParts(X,oa){return this.rtf?this.rtf.formatToParts(X,oa):[]}}
class Db{static fromOpts(X){return Db.create(X.locale,X.numberingSystem,X.outputCalendar,X.defaultToEN)}static create(X,oa,Ga,Ma=!1){X=X||Gb.defaultLocale;var Sa;(Sa=X)||(Ma?Ma="en-US":(uc||(uc=(new Intl.DateTimeFormat).resolvedOptions().locale),Ma=uc),Sa=Ma);return new Db(Sa,oa||Gb.defaultNumberingSystem,Ga||Gb.defaultOutputCalendar,X)}static resetCache(){uc=null;Rc={};xc={};Sc={}}static fromObject({locale:X,numberingSystem:oa,outputCalendar:Ga}={}){return Db.create(X,oa,Ga)}constructor(X,oa,Ga,
Ma){var Sa=X.indexOf("-u-");if(-1===Sa)X=[X];else{let qb;Sa=X.substring(0,Sa);try{qb=K(X).resolvedOptions()}catch(yb){qb=K(Sa).resolvedOptions()}const {numberingSystem:xb,calendar:vb}=qb;X=[Sa,xb,vb]}const [Wa,gb,nb]=X;this.locale=Wa;this.numberingSystem=oa||gb||null;this.outputCalendar=Ga||nb||null;oa=this.locale;Ga=this.numberingSystem;if((X=this.outputCalendar)||Ga)oa+="-u",X&&(oa+=`-ca-${X}`),Ga&&(oa+=`-nu-${Ga}`);this.intl=oa;this.weekdaysCache={format:{},standalone:{}};this.monthsCache={format:{},
standalone:{}};this.meridiemCache=null;this.eraCache={};this.specifiedLocale=Ma;this.fastNumbersCached=null}get fastNumbers(){if(null==this.fastNumbersCached){var X=this.numberingSystem&&"latn"!==this.numberingSystem?!1:"latn"===this.numberingSystem||!this.locale||this.locale.startsWith("en")||"latn"===(new Intl.DateTimeFormat(this.intl)).resolvedOptions().numberingSystem;this.fastNumbersCached=X}return this.fastNumbersCached}listingMode(){const X=this.isEnglish(),oa=(null===this.numberingSystem||
"latn"===this.numberingSystem)&&(null===this.outputCalendar||"gregory"===this.outputCalendar);return X&&oa?"en":"intl"}clone(X){return X&&0!==Object.getOwnPropertyNames(X).length?Db.create(X.locale||this.specifiedLocale,X.numberingSystem||this.numberingSystem,X.outputCalendar||this.outputCalendar,X.defaultToEN||!1):this}redefaultToEN(X={}){return this.clone({...X,defaultToEN:!0})}redefaultToSystem(X={}){return this.clone({...X,defaultToEN:!1})}months(X,oa=!1,Ga=!0){return P(this,X,Ga,D,()=>{const Ma=
oa?{month:X,day:"numeric"}:{month:X},Sa=oa?"format":"standalone";this.monthsCache[Sa][X]||(this.monthsCache[Sa][X]=Q(Wa=>this.extract(Wa,Ma,"month")));return this.monthsCache[Sa][X]})}weekdays(X,oa=!1,Ga=!0){return P(this,X,Ga,C,()=>{const Ma=oa?{weekday:X,year:"numeric",month:"long",day:"numeric"}:{weekday:X},Sa=oa?"format":"standalone";this.weekdaysCache[Sa][X]||(this.weekdaysCache[Sa][X]=J(Wa=>this.extract(Wa,Ma,"weekday")));return this.weekdaysCache[Sa][X]})}meridiems(X=!0){return P(this,void 0,
X,()=>Vc,()=>{if(!this.meridiemCache){const oa={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[Ea.utc(2016,11,13,9),Ea.utc(2016,11,13,19)].map(Ga=>this.extract(Ga,oa,"dayperiod"))}return this.meridiemCache})}eras(X,oa=!0){return P(this,X,oa,F,()=>{const Ga={era:X};this.eraCache[X]||(this.eraCache[X]=[Ea.utc(-40,1,1),Ea.utc(2017,1,1)].map(Ma=>this.extract(Ma,Ga,"era")));return this.eraCache[X]})}extract(X,oa,Ga){return(X=this.dtFormatter(X,oa).formatToParts().find(Ma=>Ma.type.toLowerCase()===
Ga))?X.value:null}numberFormatter(X={}){return new vd(this.intl,X.forceSimple||this.fastNumbers,X)}dtFormatter(X,oa={}){return new Zd(X,this.intl,oa)}relFormatter(X={}){return new $d(this.intl,this.isEnglish(),X)}listFormatter(X={}){return M(this.intl,X)}isEnglish(){return"en"===this.locale||"en-us"===this.locale.toLowerCase()||(new Intl.DateTimeFormat(this.intl)).resolvedOptions().locale.startsWith("en-us")}equals(X){return this.locale===X.locale&&this.numberingSystem===X.numberingSystem&&this.outputCalendar===
X.outputCalendar}}const wd=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,Zc=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,xd=RegExp(`${Zc.source}${wd.source}?`),$c=RegExp(`(?:T${xd.source})?`),ae=T("weekYear","weekNumber","weekDay"),be=T("year","ordinal"),yd=RegExp(`${Zc.source} ?(?:${wd.source}|(${/[A-Za-z_+-]{1,256}(:?\/[A-Za-z0-9_+-]{1,256}(\/[A-Za-z0-9_+-]{1,256})?)?/.source}))?`),ce=RegExp(`(?: ${yd.source})?`),de=RegExp(`^T?${Zc.source}$`),ee=/^-?P(?:(?:(-?\d{1,9}(?:\.\d{1,9})?)Y)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,9}(?:\.\d{1,9})?)W)?(?:(-?\d{1,9}(?:\.\d{1,9})?)D)?(?:T(?:(-?\d{1,9}(?:\.\d{1,9})?)H)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,9}))?S)?)?)$/,
Vd={GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480},fe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/,ge=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,he=/^(Monday|Tuesday|Wedsday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,
ie=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/,je=N(/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,$c),ke=N(/(\d{4})-?W(\d\d)(?:-?(\d))?/,$c),le=N(/(\d{4})-?(\d{3})/,$c),me=N(xd),ne=R(W,U,aa),oe=R(ae,U,aa),pe=R(be,U,aa),qe=R(U,aa),re=R(U),se=N(/(\d{4})-(\d\d)-(\d\d)/,ce),te=N(yd),ue=R(W,U,aa,da),ve=R(U,aa,da),zd={weeks:{days:7,hours:168,minutes:10080,seconds:604800,milliseconds:6048E5},days:{hours:24,minutes:1440,seconds:86400,
milliseconds:864E5},hours:{minutes:60,seconds:3600,milliseconds:36E5},minutes:{seconds:60,milliseconds:6E4},seconds:{milliseconds:1E3}},we={years:{quarters:4,months:12,weeks:52,days:365,hours:8760,minutes:525600,seconds:31536E3,milliseconds:31536E6},quarters:{months:3,weeks:13,days:91,hours:2184,minutes:131040,seconds:7862400,milliseconds:78624E5},months:{weeks:4,days:30,hours:720,minutes:43200,seconds:2592E3,milliseconds:2592E6},...zd},xe={years:{quarters:4,months:12,weeks:52.1775,days:365.2425,
hours:8765.82,minutes:525949.2,seconds:31556952,milliseconds:31556952E3},quarters:{months:3,weeks:13.044375,days:91.310625,hours:2191.455,minutes:131487.3,seconds:7889238,milliseconds:7889238E3},months:{weeks:30.436875/7,days:30.436875,hours:730.485,minutes:43829.1,seconds:2629746,milliseconds:2629746E3},...zd},gc="years quarters months weeks days hours minutes seconds milliseconds".split(" "),Wd=gc.slice(0).reverse();class zb{constructor(X){const oa="longterm"===X.conversionAccuracy||!1;this.values=
X.values;this.loc=X.loc||Db.create();this.conversionAccuracy=oa?"longterm":"casual";this.invalid=X.invalid||null;this.matrix=oa?xe:we;this.isLuxonDuration=!0}static fromMillis(X,oa){return zb.fromObject({milliseconds:X},oa)}static fromObject(X,oa={}){if(null==X||"object"!==typeof X)throw new ab(`Duration.fromObject: argument expected to be an object, got ${null===X?"null":typeof X}`);return new zb({values:A(X,zb.normalizeUnit),loc:Db.fromObject(oa),conversionAccuracy:oa.conversionAccuracy})}static fromDurationLike(X){if(c(X))return zb.fromMillis(X);
if(zb.isDuration(X))return X;if("object"===typeof X)return zb.fromObject(X);throw new ab(`Unknown duration argument ${X} of type ${typeof X}`);}static fromISO(X,oa){const [Ga]=S(X,[ee,Y]);return Ga?zb.fromObject(Ga,oa):zb.invalid("unparsable",`the input "${X}" can't be parsed as ISO 8601`)}static fromISOTime(X,oa){const [Ga]=S(X,[de,re]);return Ga?zb.fromObject(Ga,oa):zb.invalid("unparsable",`the input "${X}" can't be parsed as ISO 8601`)}static invalid(X,oa=null){if(!X)throw new ab("need to specify a reason the Duration is invalid");
X=X instanceof Tb?X:new Tb(X,oa);if(Gb.throwOnInvalid)throw new mb(X);return new zb({invalid:X})}static normalizeUnit(X){const oa={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[X?X.toLowerCase():X];if(!oa)throw new Ra(X);return oa}static isDuration(X){return X&&
X.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(X,oa={}){oa={...oa,floor:!1!==oa.round&&!1!==oa.floor};return this.isValid?Nb.create(this.loc,oa).formatDurationFromString(this,X):"Invalid Duration"}toHuman(X={}){const oa=gc.map(Ga=>{const Ma=this.values[Ga];return b(Ma)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...X,unit:Ga.slice(0,-1)}).format(Ma)}).filter(Ga=>Ga);return this.loc.listFormatter({type:"conjunction",
style:X.listStyle||"narrow",...X}).format(oa)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let X="P";0!==this.years&&(X+=this.years+"Y");if(0!==this.months||0!==this.quarters)X+=this.months+3*this.quarters+"M";0!==this.weeks&&(X+=this.weeks+"W");0!==this.days&&(X+=this.days+"D");if(0!==this.hours||0!==this.minutes||0!==this.seconds||0!==this.milliseconds)X+="T";0!==this.hours&&(X+=this.hours+"H");0!==this.minutes&&(X+=this.minutes+"M");if(0!==this.seconds||
0!==this.milliseconds)X+=z(this.seconds+this.milliseconds/1E3,3)+"S";"P"===X&&(X+="T0S");return X}toISOTime(X={}){if(!this.isValid)return null;var oa=this.toMillis();if(0>oa||864E5<=oa)return null;X={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...X};oa=this.shiftTo("hours","minutes","seconds","milliseconds");let Ga="basic"===X.format?"hhmm":"hh:mm";X.suppressSeconds&&0===oa.seconds&&0===oa.milliseconds||(Ga+="basic"===X.format?"ss":":ss",X.suppressMilliseconds&&0===
oa.milliseconds||(Ga+=".SSS"));oa=oa.toFormat(Ga);X.includePrefix&&(oa="T"+oa);return oa}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(X){if(!this.isValid)return this;X=zb.fromDurationLike(X);const oa={};for(const Ga of gc)if(f(X.values,Ga)||f(this.values,Ga))oa[Ga]=X.get(Ga)+this.get(Ga);return ca(this,{values:oa},!0)}minus(X){if(!this.isValid)return this;X=zb.fromDurationLike(X);return this.plus(X.negate())}mapUnits(X){if(!this.isValid)return this;
const oa={};for(const Ga of Object.keys(this.values))oa[Ga]=y(X(this.values[Ga],Ga));return ca(this,{values:oa},!0)}get(X){return this[zb.normalizeUnit(X)]}set(X){if(!this.isValid)return this;X={...this.values,...A(X,zb.normalizeUnit)};return ca(this,{values:X})}reconfigure({locale:X,numberingSystem:oa,conversionAccuracy:Ga}={}){X={loc:this.loc.clone({locale:X,numberingSystem:oa})};Ga&&(X.conversionAccuracy=Ga);return ca(this,X)}as(X){return this.isValid?this.shiftTo(X).get(X):NaN}normalize(){if(!this.isValid)return this;
const X=this.toObject();ba(this.matrix,X);return ca(this,{values:X},!0)}shiftTo(...X){if(!this.isValid||0===X.length)return this;X=X.map(Wa=>zb.normalizeUnit(Wa));const oa={},Ga={},Ma=this.toObject();let Sa;for(const Wa of gc)if(0<=X.indexOf(Wa)){Sa=Wa;let gb=0;for(const qb in Ga)gb+=this.matrix[qb][Wa]*Ga[qb],Ga[qb]=0;c(Ma[Wa])&&(gb+=Ma[Wa]);const nb=Math.trunc(gb);oa[Wa]=nb;Ga[Wa]=(1E3*gb-1E3*nb)/1E3;for(const qb in Ma)gc.indexOf(qb)>gc.indexOf(Wa)&&fa(this.matrix,Ma,qb,oa,Wa)}else c(Ma[Wa])&&(Ga[Wa]=
Ma[Wa]);for(const Wa in Ga)0!==Ga[Wa]&&(oa[Sa]+=Wa===Sa?Ga[Wa]:Ga[Wa]/this.matrix[Sa][Wa]);return ca(this,{values:oa},!0).normalize()}negate(){if(!this.isValid)return this;const X={};for(const oa of Object.keys(this.values))X[oa]=0===this.values[oa]?0:-this.values[oa];return ca(this,{values:X},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?
this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:
null}equals(X){if(!this.isValid||!X.isValid||!this.loc.equals(X.loc))return!1;for(const Ma of gc){var oa=this.values[Ma];var Ga=X.values[Ma];oa=void 0===oa||0===oa?void 0===Ga||0===Ga:oa===Ga;if(!oa)return!1}return!0}}class Eb{constructor(X){this.s=X.start;this.e=X.end;this.invalid=X.invalid||null;this.isLuxonInterval=!0}static invalid(X,oa=null){if(!X)throw new ab("need to specify a reason the Interval is invalid");X=X instanceof Tb?X:new Tb(X,oa);if(Gb.throwOnInvalid)throw new tb(X);return new Eb({invalid:X})}static fromDateTimes(X,
oa){X=Za(X);oa=Za(oa);var Ga=X&&X.isValid?oa&&oa.isValid?oa<X?Eb.invalid("end before start",`The end of an interval must be after its start, but you had start=${X.toISO()} and end=${oa.toISO()}`):null:Eb.invalid("missing or invalid end"):Eb.invalid("missing or invalid start");return null==Ga?new Eb({start:X,end:oa}):Ga}static after(X,oa){oa=zb.fromDurationLike(oa);X=Za(X);return Eb.fromDateTimes(X,X.plus(oa))}static before(X,oa){oa=zb.fromDurationLike(oa);X=Za(X);return Eb.fromDateTimes(X.minus(oa),
X)}static fromISO(X,oa){const [Ga,Ma]=(X||"").split("/",2);if(Ga&&Ma){let gb;try{var Sa=Ea.fromISO(Ga,oa);gb=Sa.isValid}catch(qb){gb=!1}let nb;try{var Wa=Ea.fromISO(Ma,oa);nb=Wa.isValid}catch(qb){nb=!1}if(gb&&nb)return Eb.fromDateTimes(Sa,Wa);if(gb){if(Wa=zb.fromISO(Ma,oa),Wa.isValid)return Eb.after(Sa,Wa)}else if(nb&&(Sa=zb.fromISO(Ga,oa),Sa.isValid))return Eb.before(Wa,Sa)}return Eb.invalid("unparsable",`the input "${X}" can't be parsed as ISO 8601`)}static isInterval(X){return X&&X.isLuxonInterval||
!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return null===this.invalidReason}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(X="milliseconds"){return this.isValid?this.toDuration(...[X]).get(X):NaN}count(X="milliseconds"){if(!this.isValid)return NaN;const oa=this.start.startOf(X),Ga=this.end.startOf(X);return Math.floor(Ga.diff(oa,X).get(X))+
1}hasSame(X){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,X):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(X){return this.isValid?this.s>X:!1}isBefore(X){return this.isValid?this.e<=X:!1}contains(X){return this.isValid?this.s<=X&&this.e>X:!1}set({start:X,end:oa}={}){return this.isValid?Eb.fromDateTimes(X||this.s,oa||this.e):this}splitAt(...X){if(!this.isValid)return[];X=X.map(Za).filter(Wa=>this.contains(Wa)).sort();const oa=[];let {s:Ga}=this,Ma=0;for(;Ga<
this.e;){var Sa=X[Ma]||this.e;Sa=+Sa>+this.e?this.e:Sa;oa.push(Eb.fromDateTimes(Ga,Sa));Ga=Sa;Ma+=1}return oa}splitBy(X){X=zb.fromDurationLike(X);if(!this.isValid||!X.isValid||0===X.as("milliseconds"))return[];let {s:oa}=this,Ga=1;const Ma=[];for(;oa<this.e;){var Sa=this.start.plus(X.mapUnits(Wa=>Wa*Ga));Sa=+Sa>+this.e?this.e:Sa;Ma.push(Eb.fromDateTimes(oa,Sa));oa=Sa;Ga+=1}return Ma}divideEqually(X){return this.isValid?this.splitBy(this.length()/X).slice(0,X):[]}overlaps(X){return this.e>X.s&&this.s<
X.e}abutsStart(X){return this.isValid?+this.e===+X.s:!1}abutsEnd(X){return this.isValid?+X.e===+this.s:!1}engulfs(X){return this.isValid?this.s<=X.s&&this.e>=X.e:!1}equals(X){return this.isValid&&X.isValid?this.s.equals(X.s)&&this.e.equals(X.e):!1}intersection(X){if(!this.isValid)return this;const oa=this.s>X.s?this.s:X.s;X=this.e<X.e?this.e:X.e;return oa>=X?null:Eb.fromDateTimes(oa,X)}union(X){return this.isValid?Eb.fromDateTimes(this.s<X.s?this.s:X.s,this.e>X.e?this.e:X.e):this}static merge(X){const [oa,
Ga]=X.sort((Ma,Sa)=>Ma.s-Sa.s).reduce(([Ma,Sa],Wa)=>Sa?Sa.overlaps(Wa)||Sa.abutsStart(Wa)?[Ma,Sa.union(Wa)]:[Ma.concat([Sa]),Wa]:[Ma,Wa],[[],null]);Ga&&oa.push(Ga);return oa}static xor(X){let oa=null,Ga=0;const Ma=[];X=X.map(Sa=>[{time:Sa.s,type:"s"},{time:Sa.e,type:"e"}]);X=Array.prototype.concat(...X).sort((Sa,Wa)=>Sa.time-Wa.time);for(const Sa of X)Ga+="s"===Sa.type?1:-1,1===Ga?oa=Sa.time:(oa&&+oa!==+Sa.time&&Ma.push(Eb.fromDateTimes(oa,Sa.time)),oa=null);return Eb.merge(Ma)}difference(...X){return Eb.xor([this].concat(X)).map(oa=>
this.intersection(oa)).filter(oa=>oa&&!oa.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} \u2013 ${this.e.toISO()})`:"Invalid Interval"}toISO(X){return this.isValid?`${this.s.toISO(X)}/${this.e.toISO(X)}`:"Invalid Interval"}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:"Invalid Interval"}toISOTime(X){return this.isValid?`${this.s.toISOTime(X)}/${this.e.toISOTime(X)}`:"Invalid Interval"}toFormat(X,{separator:oa=" \u2013 "}={}){return this.isValid?`${this.s.toFormat(X)}${oa}${this.e.toFormat(X)}`:
"Invalid Interval"}toDuration(X,oa){return this.isValid?this.e.diff(this.s,X,oa):zb.invalid(this.invalidReason)}mapEndpoints(X){return Eb.fromDateTimes(X(this.s),X(this.e))}}class vc{static hasDST(X=Gb.defaultZone){const oa=Ea.now().setZone(X).set({month:12});return!X.isUniversal&&oa.offset!==oa.set({month:6}).offset}static isValidIANAZone(X){return cc.isValidZone(X)}static normalizeZone(X){return H(X,Gb.defaultZone)}static months(X="long",{locale:oa=null,numberingSystem:Ga=null,locObj:Ma=null,outputCalendar:Sa=
"gregory"}={}){return(Ma||Db.create(oa,Ga,Sa)).months(X)}static monthsFormat(X="long",{locale:oa=null,numberingSystem:Ga=null,locObj:Ma=null,outputCalendar:Sa="gregory"}={}){return(Ma||Db.create(oa,Ga,Sa)).months(X,!0)}static weekdays(X="long",{locale:oa=null,numberingSystem:Ga=null,locObj:Ma=null}={}){return(Ma||Db.create(oa,Ga,null)).weekdays(X)}static weekdaysFormat(X="long",{locale:oa=null,numberingSystem:Ga=null,locObj:Ma=null}={}){return(Ma||Db.create(oa,Ga,null)).weekdays(X,!0)}static meridiems({locale:X=
null}={}){return Db.create(X).meridiems()}static eras(X="short",{locale:oa=null}={}){return Db.create(oa,null,"gregory").eras(X)}static features(){return{relative:h()}}}const Tc={arab:"[\u0660-\u0669]",arabext:"[\u06f0-\u06f9]",bali:"[\u1b50-\u1b59]",beng:"[\u09e6-\u09ef]",deva:"[\u0966-\u096f]",fullwide:"[\uff10-\uff19]",gujr:"[\u0ae6-\u0aef]",hanidec:"[\u3007|\u4e00|\u4e8c|\u4e09|\u56db|\u4e94|\u516d|\u4e03|\u516b|\u4e5d]",khmr:"[\u17e0-\u17e9]",knda:"[\u0ce6-\u0cef]",laoo:"[\u0ed0-\u0ed9]",limb:"[\u1946-\u194f]",
mlym:"[\u0d66-\u0d6f]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0b66-\u0b6f]",tamldec:"[\u0be6-\u0bef]",telu:"[\u0c66-\u0c6f]",thai:"[\u0e50-\u0e59]",tibt:"[\u0f20-\u0f29]",latn:"\\d"},md={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],
thai:[3664,3673],tibt:[3872,3881]},Xd=Tc.hanidec.replace(/[\[|\]]/g,"").split(""),nd=`( |${String.fromCharCode(160)})`,yc=new RegExp(nd,"g"),od={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"}};let zc=null;const Ac=[0,31,59,90,120,151,181,212,243,273,
304,334],ta=[0,31,60,91,121,152,182,213,244,274,305,335],qc={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},Xb={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},ad={ordinal:1,hour:0,minute:0,second:0,millisecond:0},bb="year month day hour minute second millisecond".split(" "),bd="weekYear weekNumber weekday hour minute second millisecond".split(" "),Ba="year ordinal hour minute second millisecond".split(" ");class Ea{constructor(X){const oa=X.zone||Gb.defaultZone;let Ga=X.invalid||
(Number.isNaN(X.ts)?new Tb("invalid input"):null)||(oa.isValid?null:Na(oa));this.ts=b(X.ts)?Gb.now():X.ts;let Ma=null;var Sa=null;Ga||(X.old&&X.old.ts===this.ts&&X.old.zone.equals(oa)?[Ma,Sa]=[X.old.c,X.old.o]:(Sa=oa.offset(this.ts),Ma=La(this.ts,Sa),Ma=(Ga=Number.isNaN(Ma.year)?new Tb("invalid input"):null)?null:Ma,Sa=Ga?null:Sa));this._zone=oa;this.loc=X.loc||Db.create();this.invalid=Ga;this.weekData=null;this.c=Ma;this.o=Sa;this.isLuxonDateTime=!0}static now(){return new Ea({})}static local(){const [X,
oa]=Xa(arguments),[Ga,Ma,Sa,Wa,gb,nb,qb]=oa;return za({year:Ga,month:Ma,day:Sa,hour:Wa,minute:gb,second:nb,millisecond:qb},X)}static utc(){const [X,oa]=Xa(arguments),[Ga,Ma,Sa,Wa,gb,nb,qb]=oa;X.zone=Mb.utcInstance;return za({year:Ga,month:Ma,day:Sa,hour:Wa,minute:gb,second:nb,millisecond:qb},X)}static fromJSDate(X,oa={}){X="[object Date]"===Object.prototype.toString.call(X)?X.valueOf():NaN;if(Number.isNaN(X))return Ea.invalid("invalid input");const Ga=H(oa.zone,Gb.defaultZone);return Ga.isValid?new Ea({ts:X,
zone:Ga,loc:Db.fromObject(oa)}):Ea.invalid(Na(Ga))}static fromMillis(X,oa={}){if(c(X))return-864E13>X||864E13<X?Ea.invalid("Timestamp out of range"):new Ea({ts:X,zone:H(oa.zone,Gb.defaultZone),loc:Db.fromObject(oa)});throw new ab(`fromMillis requires a numerical input, but received a ${typeof X} with value ${X}`);}static fromSeconds(X,oa={}){if(c(X))return new Ea({ts:1E3*X,zone:H(oa.zone,Gb.defaultZone),loc:Db.fromObject(oa)});throw new ab("fromSeconds requires a numerical input");}static fromObject(X,
oa={}){X=X||{};var Ga=H(oa.zone,Gb.defaultZone);if(!Ga.isValid)return Ea.invalid(Na(Ga));var Ma=Gb.now();const Sa=b(oa.specificOffset)?Ga.offset(Ma):oa.specificOffset,Wa=A(X,$a);var gb=!b(Wa.ordinal),nb=!b(Wa.year),qb=!b(Wa.month)||!b(Wa.day);nb=nb||qb;var xb=Wa.weekYear||Wa.weekNumber;oa=Db.fromObject(oa);if((nb||gb)&&xb)throw new Qa("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(qb&&gb)throw new Qa("Can't mix ordinal dates with month/day");qb=xb||Wa.weekday&&!nb;let vb=
La(Ma,Sa);qb?(Ma=bd,xb=Xb,vb=cb(vb)):gb?(Ma=Ba,xb=ad,vb=Ka(vb)):(Ma=bb,xb=qc);let yb=!1;for(var wb of Ma)b(Wa[wb])?Wa[wb]=yb?xb[wb]:vb[wb]:yb=!0;qb?(wb=g(Wa.weekYear),Ma=l(Wa.weekNumber,1,r(Wa.weekYear)),xb=l(Wa.weekday,1,7),wb=wb?Ma?xb?!1:db("weekday",Wa.weekday):db("week",Wa.week):db("weekYear",Wa.weekYear)):gb?(wb=g(Wa.year),Ma=l(Wa.ordinal,1,v(Wa.year)?366:365),wb=wb?Ma?!1:db("ordinal",Wa.ordinal):db("year",Wa.year)):wb=wa(Wa);if(wb=wb||Aa(Wa))return Ea.invalid(wb);gb=qb?Ca(Wa):gb?Oa(Wa):Wa;const [Lb,
Zb]=Va(gb,Sa,Ga);Ga=new Ea({ts:Lb,zone:Ga,o:Zb,loc:oa});return Wa.weekday&&nb&&X.weekday!==Ga.weekday?Ea.invalid("mismatched weekday",`you can't specify both a weekday of ${Wa.weekday} and a date of ${Ga.toISO()}`):Ga}static fromISO(X,oa={}){const [Ga,Ma]=S(X,[je,ne],[ke,oe],[le,pe],[me,qe]);return kb(Ga,Ma,oa,"ISO 8601",X)}static fromRFC2822(X,oa={}){const [Ga,Ma]=S(X.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim(),[fe,ja]);return kb(Ga,Ma,oa,"RFC 2822",X)}static fromHTTP(X,oa={}){const [Ga,
Ma]=S(X,[ge,la],[he,la],[ie,ia]);return kb(Ga,Ma,oa,"HTTP",oa)}static fromFormat(X,oa,Ga={}){if(b(X)||b(oa))throw new ab("fromFormat requires an input string and a format");const {locale:Ma=null,numberingSystem:Sa=null}=Ga;var Wa=Db.fromOpts({locale:Ma,numberingSystem:Sa,defaultToEN:!0});{const {result:vb,zone:yb,specificOffset:wb,invalidReason:Lb}=Ta(Wa,X,oa);Wa=[vb,yb,wb,Lb]}const [gb,nb,qb,xb]=Wa;return xb?Ea.invalid(xb):kb(gb,nb,Ga,`format ${oa}`,X,qb)}static fromString(X,oa,Ga={}){return Ea.fromFormat(X,
oa,Ga)}static fromSQL(X,oa={}){const [Ga,Ma]=S(X,[se,ue],[te,ve]);return kb(Ga,Ma,oa,"SQL",X)}static invalid(X,oa=null){if(!X)throw new ab("need to specify a reason the DateTime is invalid");X=X instanceof Tb?X:new Tb(X,oa);if(Gb.throwOnInvalid)throw new lb(X);return new Ea({invalid:X})}static isDateTime(X){return X&&X.isLuxonDateTime||!1}get(X){return this[X]}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?
this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:
NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?Ua(this).weekYear:NaN}get weekNumber(){return this.isValid?Ua(this).weekNumber:NaN}get weekday(){return this.isValid?Ua(this).weekday:NaN}get ordinal(){return this.isValid?Ka(this.c).ordinal:NaN}get monthShort(){return this.isValid?vc.months("short",{locObj:this.loc})[this.month-
1]:null}get monthLong(){return this.isValid?vc.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?vc.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?vc.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,
{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return v(this.year)}get daysInMonth(){return q(this.year,this.month)}get daysInYear(){return this.isValid?v(this.year)?366:365:NaN}get weeksInWeekYear(){return this.isValid?r(this.weekYear):NaN}resolvedLocaleOptions(X={}){const {locale:oa,numberingSystem:Ga,
calendar:Ma}=Nb.create(this.loc.clone(X),X).resolvedOptions(this);return{locale:oa,numberingSystem:Ga,outputCalendar:Ma}}toUTC(X=0,oa={}){return this.setZone(Mb.instance(X),oa)}toLocal(){return this.setZone(Gb.defaultZone)}setZone(X,{keepLocalTime:oa=!1,keepCalendarTime:Ga=!1}={}){X=H(X,Gb.defaultZone);if(X.equals(this.zone))return this;if(X.isValid){let Ma=this.ts;if(oa||Ga)oa=X.offset(this.ts),Ga=this.toObject(),[Ma]=Va(Ga,oa,X);return Ya(this,{ts:Ma,zone:X})}return Ea.invalid(Na(X))}reconfigure({locale:X,
numberingSystem:oa,outputCalendar:Ga}={}){X=this.loc.clone({locale:X,numberingSystem:oa,outputCalendar:Ga});return Ya(this,{loc:X})}setLocale(X){return this.reconfigure({locale:X})}set(X){if(!this.isValid)return this;X=A(X,$a);var oa=!b(X.weekYear)||!b(X.weekNumber)||!b(X.weekday);const Ga=!b(X.ordinal),Ma=!b(X.year),Sa=!b(X.month)||!b(X.day),Wa=X.weekYear||X.weekNumber;if((Ma||Sa||Ga)&&Wa)throw new Qa("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(Sa&&Ga)throw new Qa("Can't mix ordinal dates with month/day");
oa?oa=Ca({...cb(this.c),...X}):b(X.ordinal)?(oa={...this.toObject(),...X},b(X.day)&&(oa.day=Math.min(q(oa.year,oa.month),oa.day))):oa=Oa({...Ka(this.c),...X});const [gb,nb]=Va(oa,this.o,this.zone);return Ya(this,{ts:gb,o:nb})}plus(X){if(!this.isValid)return this;X=zb.fromDurationLike(X);return Ya(this,hb(this,X))}minus(X){if(!this.isValid)return this;X=zb.fromDurationLike(X).negate();return Ya(this,hb(this,X))}startOf(X){if(!this.isValid)return this;const oa={};X=zb.normalizeUnit(X);switch(X){case "years":oa.month=
1;case "quarters":case "months":oa.day=1;case "weeks":case "days":oa.hour=0;case "hours":oa.minute=0;case "minutes":oa.second=0;case "seconds":oa.millisecond=0}"weeks"===X&&(oa.weekday=1);"quarters"===X&&(oa.month=3*(Math.ceil(this.month/3)-1)+1);return this.set(oa)}endOf(X){return this.isValid?this.plus({[X]:1}).startOf(X).minus(1):this}toFormat(X,oa={}){return this.isValid?Nb.create(this.loc.redefaultToEN(oa)).formatDateTimeFromString(this,X):"Invalid DateTime"}toLocaleString(X=pb,oa={}){return this.isValid?
Nb.create(this.loc.clone(oa),X).formatDateTime(this):"Invalid DateTime"}toLocaleParts(X={}){return this.isValid?Nb.create(this.loc.clone(X),X).formatDateTimeParts(this):[]}toISO({format:X="extended",suppressSeconds:oa=!1,suppressMilliseconds:Ga=!1,includeOffset:Ma=!0}={}){if(!this.isValid)return null;X="extended"===X;let Sa=ob(this,X);return Sa=Sa+"T"+sb(this,X,oa,Ga,Ma)}toISODate({format:X="extended"}={}){return this.isValid?ob(this,"extended"===X):null}toISOWeekDate(){return ib(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:X=
!1,suppressSeconds:oa=!1,includeOffset:Ga=!0,includePrefix:Ma=!1,format:Sa="extended"}={}){return this.isValid?(Ma?"T":"")+sb(this,"extended"===Sa,oa,X,Ga):null}toRFC2822(){return ib(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return ib(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?ob(this,!0):null}toSQLTime({includeOffset:X=!0,includeZone:oa=!1,includeOffsetSpace:Ga=!0}={}){let Ma="HH:mm:ss.SSS";if(oa||X)Ga&&(Ma+=" "),oa?Ma+="z":X&&(Ma+="ZZ");return ib(this,
Ma,!0)}toSQL(X={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(X)}`:null}toString(){return this.isValid?this.toISO():"Invalid DateTime"}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1E3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1E3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(X={}){if(!this.isValid)return{};const oa={...this.c};X.includeConfig&&(oa.outputCalendar=this.outputCalendar,
oa.numberingSystem=this.loc.numberingSystem,oa.locale=this.loc.locale);return oa}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(X,oa="milliseconds",Ga={}){if(!this.isValid||!X.isValid)return zb.invalid("created by diffing an invalid DateTime");Ga={locale:this.locale,numberingSystem:this.numberingSystem,...Ga};const Ma=(Array.isArray(oa)?oa:[oa]).map(zb.normalizeUnit);oa=X.valueOf()>this.valueOf();X=na(oa?this:X,oa?X:this,Ma,Ga);return oa?X.negate():X}diffNow(X="milliseconds",oa={}){return this.diff(Ea.now(),
X,oa)}until(X){return this.isValid?Eb.fromDateTimes(this,X):this}hasSame(X,oa){if(!this.isValid)return!1;const Ga=X.valueOf();X=this.setZone(X.zone,{keepLocalTime:!0});return X.startOf(oa)<=Ga&&Ga<=X.endOf(oa)}equals(X){return this.isValid&&X.isValid&&this.valueOf()===X.valueOf()&&this.zone.equals(X.zone)&&this.loc.equals(X.loc)}toRelative(X={}){if(!this.isValid)return null;const oa=X.base||Ea.fromObject({},{zone:this.zone}),Ga=X.padding?this<oa?-X.padding:X.padding:0;let Ma="years months days hours minutes seconds".split(" "),
Sa=X.unit;Array.isArray(X.unit)&&(Ma=X.unit,Sa=void 0);return Pa(oa,this.plus(Ga),{...X,numeric:"always",units:Ma,unit:Sa})}toRelativeCalendar(X={}){return this.isValid?Pa(X.base||Ea.fromObject({},{zone:this.zone}),this,{...X,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...X){if(!X.every(Ea.isDateTime))throw new ab("min requires all arguments be DateTimes");return w(X,oa=>oa.valueOf(),Math.min)}static max(...X){if(!X.every(Ea.isDateTime))throw new ab("max requires all arguments be DateTimes");
return w(X,oa=>oa.valueOf(),Math.max)}static fromFormatExplain(X,oa,Ga={}){const {locale:Ma=null,numberingSystem:Sa=null}=Ga;Ga=Db.fromOpts({locale:Ma,numberingSystem:Sa,defaultToEN:!0});return Ta(Ga,X,oa)}static fromStringExplain(X,oa,Ga={}){return Ea.fromFormatExplain(X,oa,Ga)}static get DATE_SHORT(){return pb}static get DATE_MED(){return ub}static get DATE_MED_WITH_WEEKDAY(){return rb}static get DATE_FULL(){return Ab}static get DATE_HUGE(){return Kb}static get TIME_SIMPLE(){return Ob}static get TIME_WITH_SECONDS(){return Ub}static get TIME_WITH_SHORT_OFFSET(){return Bc}static get TIME_WITH_LONG_OFFSET(){return Vb}static get TIME_24_SIMPLE(){return lc}static get TIME_24_WITH_SECONDS(){return $b}static get TIME_24_WITH_SHORT_OFFSET(){return rc}static get TIME_24_WITH_LONG_OFFSET(){return sc}static get DATETIME_SHORT(){return mc}static get DATETIME_SHORT_WITH_SECONDS(){return nc}static get DATETIME_MED(){return fc}static get DATETIME_MED_WITH_SECONDS(){return tc}static get DATETIME_MED_WITH_WEEKDAY(){return Uc}static get DATETIME_FULL(){return Hb}static get DATETIME_FULL_WITH_SECONDS(){return Cc}static get DATETIME_HUGE(){return Fb}static get DATETIME_HUGE_WITH_SECONDS(){return Wb}}
a.DateTime=Ea;a.Info=vc;a.Interval=Eb})},"esri/core/number":function(){define(["exports","./string","../intl/locale"],function(a,b,c){function g(d){d||(d=c.getLocale());let m=d in l;if(!m){const t=d.split("-");1<t.length&&t[0]in l&&(d=t[0],m=!0);m||(d="en")}const [z,v,q="#,##0.###"]=l[d];return{decimal:z,group:v,pattern:q}}function h(d,m,z){z=z||{};!0===z.places&&(z.places=0);Infinity===z.places&&(z.places=6);m=m.split(".");var v="string"===typeof z.places&&z.places.indexOf(","),q=z.places;v?q=z.places.substring(v+
1):0<=q||(q=(m[1]||[]).length);0>z.round||(d=Number(d.toFixed(Number(q))));d=String(Math.abs(d)).split(".");const t=d[1]||"";m[1]||z.places?(v&&(z.places=z.places.substring(0,v)),v=void 0!==z.places?z.places:m[1]&&m[1].lastIndexOf("0")+1,v>t.length&&(d[1]=t.padEnd(Number(v),"0")),q<t.length&&(d[1]=t.substr(0,Number(q)))):d[1]&&d.pop();q=m[0].replace(",","");v=q.indexOf("0");-1!==v&&(v=q.length-v,v>d[0].length&&(d[0]=d[0].padStart(v,"0")),-1===q.indexOf("#")&&(d[0]=d[0].substr(d[0].length-v)));q=m[0].lastIndexOf(",");
let r,x;-1!==q&&(r=m[0].length-q-1,m=m[0].substr(0,q),q=m.lastIndexOf(","),-1!==q&&(x=m.length-q-1));m=[];for(q=d[0];q;)v=q.length-r,m.push(0<v?q.substr(v):q),q=0<v?q.slice(0,v):"",x&&(r=x,x=void 0);d[0]=m.reverse().join(z.group||",");return d.join(z.decimal||".")}function w(d){d=d||{};var m=g(d.locale);const z=d.pattern||m.pattern,v=m.group,q=m.decimal;let t=1;if(-1!==z.indexOf("%"))t/=100;else if(-1!==z.indexOf("\u2030"))t/=1E3;else if(-1!==z.indexOf("\u00a4"))throw Error("currency notation not supported");
m=z.split(";");1===m.length&&m.push("-"+m[0]);return{regexp:e(m,function(r){r="(?:"+b.escapeRegExpString(r,".")+")";return r.replace(k,function(x){const u={signed:!1,separator:d.strict?v:[v,""],fractional:d.fractional,decimal:q,exponent:!1};x=x.split(".");let E=d.places;1===x.length&&1!==t&&(x[1]="###");1===x.length||0===E?u.fractional=!1:(void 0===E&&(E=d.pattern?x[1].lastIndexOf("0")+1:Infinity),E&&null==d.fractional&&(u.fractional=!0),!d.places&&E<x[1].length&&(E+=","+x[1].length),u.places=E);
x=x[0].split(",");1<x.length&&(u.groupSize=x.pop().length,1<x.length&&(u.groupSize2=x.pop().length));return"("+n(u)+")"})},!0).replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:v,decimal:q,factor:t}}function n(d){d=d||{};"places"in d||(d.places=Infinity);"string"!==typeof d.decimal&&(d.decimal=".");"fractional"in d&&!/^0/.test(String(d.places))||(d.fractional=[!0,!1]);"exponent"in d||(d.exponent=[!0,!1]);"eSigned"in d||(d.eSigned=[!0,!1]);var m=f(d);const z=e(d.fractional,function(q){let t="";q&&0!==d.places&&
(t="\\"+d.decimal,t=Infinity===d.places?"(?:"+t+"\\d+)?":t+("\\d{"+d.places+"}"));return t},!0),v=e(d.exponent,function(q){return q?"([eE]"+f({signed:d.eSigned})+")":""});m+=z;z&&(m="(?:(?:"+m+")|(?:"+z+"))");return m+v}function f(d){d=d||{};"signed"in d||(d.signed=[!0,!1]);"separator"in d?"groupSize"in d||(d.groupSize=3):d.separator="";const m=e(d.signed,function(v){return v?"[-+]":""},!0),z=e(d.separator,function(v){if(!v)return"(?:\\d+)";v=b.escapeRegExpString(v);" "===v?v="\\s":"\u00a0"===v&&
(v="\\s\\xa0");const q=d.groupSize,t=d.groupSize2;return t?(v="(?:0|[1-9]\\d{0,"+(t-1)+"}(?:["+v+"]\\d{"+t+"})*["+v+"]\\d{"+q+"})",0<q-t?"(?:"+v+"|(?:0|[1-9]\\d{0,"+(q-1)+"}))":v):"(?:0|[1-9]\\d{0,"+(q-1)+"}(?:["+v+"]\\d{"+q+"})*)"},!0);return m+z}const l={ar:[".",","],bg:[",","\u00a0"],bs:[",","."],ca:[",","."],cs:[",","\u00a0"],da:[",","."],de:[",","."],"de-ch":[".","\u2019"],el:[",","."],en:[".",","],"en-au":[".",","],es:[",","."],"es-mx":[".",","],et:[",","\u00a0"],fi:[",","\u00a0"],fr:[",","\u202f"],
"fr-ch":[",","\u202f"],he:[".",","],hi:[".",",","#,##,##0.###"],hr:[",","."],hu:[",","\u00a0"],id:[",","."],it:[",","."],"it-ch":[".","\u2019"],ja:[".",","],ko:[".",","],lt:[",","\u00a0"],lv:[",","\u00a0"],mk:[",","."],nb:[",","\u00a0"],nl:[",","."],pl:[",","\u00a0"],pt:[",","."],"pt-pt":[",","\u00a0"],ro:[",","."],ru:[",","\u00a0"],sk:[",","\u00a0"],sl:[",","."],sr:[",","."],sv:[",","\u00a0"],th:[".",","],tr:[",","."],uk:[",","\u00a0"],vi:[",","."],zh:[".",","]},k=/[#0,]*[#0](?:\.0*#*)?/,e=function(d,
m,z){if(!(d instanceof Array))return m(d);const v=[];for(let q=0;q<d.length;q++)v.push(m(d[q]));d=v.join("|");return"("+(z?"?:":"")+d+")"};a._parseInfo=w;a.format=function(d,m){m={...m};var z=g(m.locale);m.customs=z;var v=m.pattern||z.pattern;if(isNaN(d)||Infinity===Math.abs(d))return null;{m=m||{};z=m.customs.group;const t=m.customs.decimal;v=v.split(";");var q=v[0];v=v[0>d?1:0]||"-"+q;if(-1!==v.indexOf("%"))d*=100;else if(-1!==v.indexOf("\u2030"))d*=1E3;else{if(-1!==v.indexOf("\u00a4"))throw Error("currency notation not supported");
if(-1!==v.indexOf("E"))throw Error("exponential notation not supported");}const r=k;q=q.match(r);if(!q)throw Error("unable to find a number expression in pattern: "+v);!1===m.fractional&&(m.places=0);d=v.replace(r,h(d,q[0],{decimal:t,group:z,places:m.places,round:m.round}))}return d};a.getCustoms=g;a.parse=function(d,m){m=w(m);d=(new RegExp("^"+m.regexp+"$")).exec(d);if(!d)return NaN;let z=d[1];if(!d[1]){if(!d[2])return NaN;z=d[2];m.factor*=-1}z=z.replace(new RegExp("["+m.group+"\\s\\xa0]","g"),"").replace(m.decimal,
".");return Number(z)*m.factor};a.regexp=function(d){return w(d).regexp};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/arcade/featureset/support/shared":function(){define(["exports","../../../core/promiseUtils","../../../geometry/Extent","../../../layers/support/Field"],function(a,b,c,g){function h(w){return w instanceof Date}a.FeatureServiceDatabaseType=void 0;(function(w){w[w.Standardised=0]="Standardised";w[w.StandardisedNoInterval=1]="StandardisedNoInterval";w[w.SqlServer=2]="SqlServer";
w[w.Oracle=3]="Oracle";w[w.Postgres=4]="Postgres";w[w.PGDB=5]="PGDB";w[w.FILEGDB=6]="FILEGDB";w[w.NotEvaluated=7]="NotEvaluated"})(a.FeatureServiceDatabaseType||(a.FeatureServiceDatabaseType={}));a.IdState=void 0;(function(w){w[w.InFeatureSet=0]="InFeatureSet";w[w.NotInFeatureSet=1]="NotInFeatureSet";w[w.Unknown=2]="Unknown"})(a.IdState||(a.IdState={}));a.callback=function(w,n){return function(){try{w.apply(null,arguments)}catch(f){n.reject(f)}}};a.cloneAttributes=function(w){const n={};for(const f in w)n[f]=
w[f];return n};a.cloneField=function(w){return g.fromJSON(w.toJSON())};a.convertLinearUnitsToCode=function(w){if(void 0===w)return null;if("number"===typeof w||"number"===typeof w)return w;switch(w.toLowerCase()){case "meters":case "meter":return 9001;case "miles":case "mile":return 9035;case "kilometers":case "kilometer":case "km":return 9036}return null};a.convertSquareUnitsToCode=function(w){if(void 0===w)return null;if("number"===typeof w)return w;switch(w.toLowerCase()){case "meters":case "meter":return 109404;
case "miles":case "mile":return 109413;case "kilometers":case "kilometer":case "km":return 109414}return null};a.defaultMaxRecords=1E3;a.equalityTest=function(w,n){return w===n?!0:h(w)&&h(n)?w.getTime()===n.getTime():!1};a.errback=function(w){return function(n){w.reject(n)}};a.esriFieldToJson=function(w){return w.toJSON?w.toJSON():w};a.extractServiceUrl=function(w){if(void 0===w)return"";w=w.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer");w=w.replace(/\/mapserver\/[0-9]*/i,"/MapServer");return w=
w.split("?")[0]};a.isArray=function(w){return w instanceof Array};a.isBoolean=function(w){return"boolean"===typeof w};a.isDate=h;a.isNumber=function(w){return"number"===typeof w};a.isString=function(w){return"string"===typeof w||w instanceof String};a.layerFieldEsriConstants={"small-integer":"esriFieldTypeSmallInteger",integer:"esriFieldTypeInteger",long:"esriFieldTypeLong",single:"esriFieldTypeSingle",double:"esriFieldTypeDouble",string:"esriFieldTypeString",date:"esriFieldTypeDate",oid:"esriFieldTypeOID",
geometry:"esriFieldTypeGeometry",blob:"esriFieldTypeBlob",raster:"esriFieldTypeRaster",guid:"esriFieldTypeGUID","global-id":"esriFieldTypeGlobalID",xml:"eesriFieldTypeXML",esriFieldTypeSmallInteger:"esriFieldTypeSmallInteger",esriFieldTypeInteger:"esriFieldTypeInteger",esriFieldTypeLong:"esriFieldTypeLong",esriFieldTypeSingle:"esriFieldTypeSingle",esriFieldTypeDouble:"esriFieldTypeDouble",esriFieldTypeString:"esriFieldTypeString",esriFieldTypeDate:"esriFieldTypeDate",esriFieldTypeOID:"esriFieldTypeOID",
esriFieldTypeGeometry:"esriFieldTypeGeometry",esriFieldTypeBlob:"esriFieldTypeBlob",esriFieldTypeRaster:"esriFieldTypeRaster",esriFieldTypeGUID:"esriFieldTypeGUID",esriFieldTypeGlobalID:"esriFieldTypeGlobalID",esriFieldTypeXML:"eesriFieldTypeXML"};a.layerGeometryEsriConstants={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",
envelope:"extent"};a.layerGeometryEsriRestConstants={point:"esriGeometryPoint",polygon:"esriGeometryPolygon",polyline:"esriGeometryPolyline",multipoint:"esriGeometryMultipoint",extent:"esriGeometryEnvelope",esriGeometryPoint:"esriGeometryPoint",esriGeometryPolygon:"esriGeometryPolygon",esriGeometryPolyline:"esriGeometryPolyline",esriGeometryMultipoint:"esriGeometryMultipoint",esriGeometryEnvelope:"esriGeometryEnvelope",envelope:"esriGeometryEnvelope"};a.reduceArrayWithPromises=function(w,n){return b.create((f,
l)=>{const k=b.resolve(!0);w.reduce((e,d,m,z)=>e.then(v=>{try{return n(v,d,m,z)}catch(q){return b.reject(q)}},v=>b.reject(v)),k).then(f,l)})};a.sameGeomType=function(w,n){return w===n||"point"===w&&"esriGeometryPoint"===n||"polyline"===w&&"esriGeometryPolyline"===n||"polygon"===w&&"esriGeometryPolygon"===n||"extent"===w&&"esriGeometryEnvelope"===n||"multipoint"===w&&"esriGeometryMultipoint"===n||"point"===n&&"esriGeometryPoint"===w||"polyline"===n&&"esriGeometryPolyline"===w||"polygon"===n&&"esriGeometryPolygon"===
w||"extent"===n&&"esriGeometryEnvelope"===w||"multipoint"===n&&"esriGeometryMultipoint"===w?!0:!1};a.shapeExtent=function(w){if(null===w)return null;switch(w.type){case "polygon":case "multipoint":case "polyline":return w.extent;case "point":return new c({xmin:w.x,ymin:w.y,xmax:w.x,ymax:w.y,spatialReference:w.spatialReference});case "extent":return w}return null};a.stableStringify=function(w,n){n||(n={});"function"===typeof n&&(n={cmp:n});const f="boolean"===typeof n.cycles?n.cycles:!1,l=n.cmp&&function(e){return function(d){return function(m,
z){return e({key:m,value:d[m]},{key:z,value:d[z]})}}}(n.cmp),k=[];return function m(d){d&&d.toJSON&&"function"===typeof d.toJSON&&(d=d.toJSON());if(void 0!==d){if("number"===typeof d)return isFinite(d)?""+d:"null";if("object"!==typeof d)return JSON.stringify(d);var z;if(Array.isArray(d)){var v="[";for(z=0;z<d.length;z++)z&&(v+=","),v+=m(d[z])||"null";return v+"]"}if(null===d)return"null";if(-1!==k.indexOf(d)){if(f)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON");
}var q=k.push(d)-1,t=Object.keys(d).sort(l&&l(d));v="";for(z=0;z<t.length;z++){const r=t[z],x=m(d[r]);x&&(v&&(v+=","),v+=JSON.stringify(r)+":"+x)}k.splice(q,1);return"{"+v+"}"}}(w)};a.toEsriGeometryType=function(w){switch(w){case "point":return"esriGeometryPoint";case "polygon":return"esriGeometryPolygon";case "multipoint":return"esriGeometryMultipoint";case "polyline":return"esriGeometryPolyline";default:return"esriGeometryPoint"}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Feature/support/arcadeFeatureUtils":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/promiseUtils ../../../layers/FeatureLayer ./featureUtils".split(" "),
function(a,b,c,g,h,w,n){function f(x){return`<ul class="esri-widget__list">${x.map(u=>`<li>${"string"===typeof u?n.applyTextFormattingHTML(n.htmlEntities(u)):u}</li>`).join("")}</ul>`}function l(x){return`<table class="esri-widget__table">${x.keys().map(u=>{var E=x.field(u);E="string"===typeof E?n.applyTextFormattingHTML(n.htmlEntities(E)):E;return`<tr><th>${u}</th><td>${E}</td></tr>`}).join("")}</table>`}function k({aggregatedFeatures:x,arcadeUtils:u,featureSetVars:E,context:y,viewInfo:A,map:p,graphic:B,
interceptor:D}){E.forEach(C=>{C=C.toLowerCase();var F={map:p,spatialReference:A.sr,interceptor:D};"$map"===C&&(y.vars[C]=u.convertMapToFeatureSetCollection(F));"$layer"===C&&(y.vars[C]=u.convertFeatureLayerToFeatureSet({layer:B.sourceLayer,spatialReference:A.sr,interceptor:D}));"$datastore"===C&&(y.vars[C]=u.convertServiceUrlToWorkspace({url:B.sourceLayer.url,spatialReference:A.sr,interceptor:D}));if("$aggregatedfeatures"===C){F=B.layer;const {fields:G,objectIdField:L,geometryType:H,spatialReference:M,
displayField:K}=F;F=new w({fields:G,objectIdField:L,geometryType:H,spatialReference:M,displayField:K,..."feature"===F.type?{templates:F.templates,typeIdField:F.typeIdField,types:F.types}:null,source:x});y.vars[C]=u.convertFeatureLayerToFeatureSet({layer:F,spatialReference:A.sr,interceptor:D})}})}function e(){return new Promise((x,u)=>a(["../../../support/arcadeUtils"],x,u))}function d(x){return m.apply(this,arguments)}function m(){m=c._asyncToGenerator(function*({graphic:x,view:u}){const {isAggregate:E,
layer:y}=x;if(!E||!y||"2d"!==(null==u?void 0:u.type))return[];u=yield u.whenLayerView(y);if(!u.createQuery||!u.queryFeatures)return[];const A=u.createQuery();A.aggregateIds=[x.getObjectId()];({features:x}=yield u.queryFeatures(A));return x});return m.apply(this,arguments)}function z(x){return v.apply(this,arguments)}function v(){v=c._asyncToGenerator(function*({expressionInfo:x,arcadeUtils:u,interceptor:E,spatialReference:y,map:A,graphic:p,view:B}){if(!x||!x.expression)return null;const D=u.createSyntaxTree(x.expression),
C=t.filter(G=>u.hasVariable(D,G));[B]=yield h.all([d({graphic:p,view:B}),u.loadScriptDependencies(D,!0,C)]);const F=u.getViewInfo({spatialReference:y});y=u.createExecContext(p,F);y.interceptor=E;y.useAsync=!0;k({aggregatedFeatures:B,arcadeUtils:u,featureSetVars:C,context:y,viewInfo:F,map:A,graphic:p,interceptor:E});E=u.createFunction(D,y);return u.executeAsyncFunction(E,y).catch(G=>r.error("arcade-execution-error",{error:G,graphic:p,expressionInfo:x}))});return v.apply(this,arguments)}function q(){q=
c._asyncToGenerator(function*({expressionInfos:x,spatialReference:u,graphic:E,interceptor:y,map:A,view:p}){if(!x||!x.length)return{};const B=yield e(),D={};for(const C of x)D[`expression/${C.name}`]=z({expressionInfo:C,arcadeUtils:B,interceptor:y,spatialReference:u,map:A,graphic:E,view:p});x=yield h.eachAlways(D);u={};for(const C in x)E=x[C].value,E="string"===typeof E?n.applyTextFormattingHTML(n.htmlEntities(E)):Array.isArray(E)?f(E):"esri.arcade.Dictionary"===(null==E?void 0:E.declaredClass)?l(E):
E,u[C]=E;return u});return q.apply(this,arguments)}const t=["$datastore","$map","$layer","$aggregatedfeatures"],r=g.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");b.createCompiledExpression=z;b.createCompiledExpressions=function(x){return q.apply(this,arguments)};b.loadArcadeUtils=e;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/widgets/Feature/FeatureViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../arcade/featureset/support/FeatureSetQueryInterceptor ../../core/Accessor ../../core/Handles ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/throttle ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../popup/content/TextContent ./FeatureAttachments/FeatureAttachmentsViewModel ./FeatureContent/FeatureContentViewModel ./FeatureExpression/FeatureExpressionViewModel ./FeatureFields/FeatureFieldsViewModel ./FeatureMedia/FeatureMediaViewModel ./support/arcadeFeatureUtils ./support/featureUtils ./support/relatedFeatureUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B){var D;const C=n.getLogger("esri.widgets.FeatureViewModel"),F={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0};h=D=function(G){function L(M){var K=G.call(this,M)||this;K._handles=new w;K._error=null;K._featureAbortController=null;K.graphicChangedThrottled=k.throttle(K._graphicChanged,1,a._assertThisInitialized(K));K._expressionAttributes=null;K._graphicExpressionAttributes=
null;K.abilities={...F};K.content=null;K.contentViewModels=[];K.defaultPopupTemplateEnabled=!1;K.formattedAttributes=null;K.lastEditInfo=null;K.relatedInfos=new Map;K.title="";K.view=null;K._isAllowedContentType=I=>{const {abilities:O}=a._assertThisInitialized(K);return"attachments"===I.type&&O.attachmentsContent||"custom"===I.type&&O.customContent||"fields"===I.type&&O.fieldsContent||"media"===I.type&&O.mediaContent||"text"===I.type&&O.textContent||"expression"===I.type&&O.expressionContent};K._handles.add(e.init(a._assertThisInitialized(K),
["graphic","_effectivePopupTemplate","abilities"],()=>K.graphicChangedThrottled()));return K}a._inheritsLoose(L,G);var H=L.prototype;H.destroy=function(){this._clear();this._cancelFeatureQuery();this._error=null;this._handles.destroy();this.graphic=this._handles=null;this._destroyContentViewModels();this.relatedInfos.clear()};H.castAbilities=function(M){return{...F,...M}};H.setActiveMedia=function(M,K){M=this.contentViewModels[M];M instanceof y&&M.setActiveMedia(K)};H.nextMedia=function(M){M=this.contentViewModels[M];
M instanceof y&&M.next()};H.previousMedia=function(M){M=this.contentViewModels[M];M instanceof y&&M.previous()};H._clear=function(){this._set("title","");this._set("content",null);this._set("formattedAttributes",null)};H._graphicChanged=function(){var M=a._asyncToGenerator(function*(){this._cancelFeatureQuery();this._error=null;this._clear();const {graphic:K}=this;if(K){var I=new AbortController;this._featureAbortController=I;try{yield this._queryFeature({signal:I.signal})}catch(O){l.isAbortError(O)||
(this._error=O,C.error("error","The popupTemplate could not be displayed for this feature.",{error:O,graphic:K,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===I&&(this._featureAbortController=null)}});return function(){return M.apply(this,arguments)}}();H._cancelFeatureQuery=function(){const {_featureAbortController:M}=this;M&&M.abort();this._featureAbortController=null};H._compileContentElement=function(M,K){if("attachments"===M.type)return this._compileAttachments(M,
K);if("custom"===M.type)return this._compileCustom(M,K);if("fields"===M.type)return this._compileFields(M,K);if("media"===M.type)return this._compileMedia(M,K);if("text"===M.type)return this._compileText(M,K);if("expression"===M.type)return this._compileExpression(M,K)};H._compileContent=function(M){this._destroyContentViewModels();if(this.graphic)return Array.isArray(M)?M.filter(this._isAllowedContentType).map((K,I)=>this._compileContentElement(K,I)):"string"===typeof M?this._compileText(new t({text:M}),
0).text:M};H._destroyContentViewModels=function(){var M;null==(M=this._handles)?void 0:M.remove("content-view-models");this.contentViewModels.forEach(K=>K&&!K.destroyed&&K.destroy());this._set("contentViewModels",[])};H._setExpressionContentVM=function(M,K){const {formattedAttributes:I}=this,{contentElement:O,contentElementViewModel:Q}=M;M=null==O?void 0:O.type;Q&&M&&("fields"===M&&(this._createFieldsFormattedAttributes({contentElement:O,contentElementIndex:K,formattedAttributes:I}),Q.set(this._createFieldsVMParams(O,
K))),"media"===M&&(this._createMediaFormattedAttributes({contentElement:O,contentElementIndex:K,formattedAttributes:I}),Q.set(this._createMediaVMParams(O,K))),"text"===M&&Q.set(this._createTextVMParams(O)))};H._compileExpression=function(M,K){const {expressionInfo:I}=M,{graphic:O,map:Q,spatialReference:J,view:P}=this,N=new u({expressionInfo:I,graphic:O,interceptor:D.interceptor,map:Q,spatialReference:J,view:P});this.contentViewModels[K]=N;this._handles.add(e.init(N,"contentElementViewModel",()=>this._setExpressionContentVM(N,
K)),"content-view-models");return M};H._compileAttachments=function(M,K){const {graphic:I}=this,{description:O,title:Q}=M;this.contentViewModels[K]=new r({graphic:I,...this._compileTitleAndDesc({title:Q,description:O})});return M};H._compileCustom=function(M,K){const {graphic:I}=this,{creator:O,destroyer:Q}=M;this.contentViewModels[K]=new x({graphic:I,creator:O,destroyer:Q});return M};H._compileTitleAndDesc=function({title:M,description:K}){const {_fieldInfoMap:I,_sourceLayer:O,graphic:Q,formattedAttributes:J,
_expressionAttributes:P}=this,{attributes:N}=Q,R=J.global;return{title:p.substituteFieldsInLinksAndAttributes({attributes:N,fieldInfoMap:I,globalAttributes:R,expressionAttributes:P,layer:O,text:M}),description:p.substituteFieldsInLinksAndAttributes({attributes:N,fieldInfoMap:I,globalAttributes:R,expressionAttributes:P,layer:O,text:K})}};H._createFieldsVMParams=function(M,K){const {_effectivePopupTemplate:I,formattedAttributes:O}=this,Q={...O.global,...O.content[K]};K=(null==M?void 0:M.fieldInfos)||
(null==I?void 0:I.fieldInfos);K=null==K?void 0:K.filter(({fieldName:R})=>p.isExpressionField(R)||p.isRelatedField(R)||Q.hasOwnProperty(R));const J=null==I?void 0:I.expressionInfos,{description:P,title:N}=M;return{attributes:Q,expressionInfos:J,fieldInfos:K,...this._compileTitleAndDesc({title:N,description:P})}};H._compileFields=function(M,K){const I=M.clone();M=new E(this._createFieldsVMParams(M,K));this.contentViewModels[K]=M;I.fieldInfos=M.formattedFieldInfos.slice(0);return I};H._createMediaVMParams=
function(M,K){const {abilities:I,graphic:O,_fieldInfoMap:Q,formattedAttributes:J,_effectivePopupTemplate:P,relatedInfos:N,_sourceLayer:R,_expressionAttributes:S}=this,{attributes:T}=O,{description:V,mediaInfos:W,title:U}=M;return{abilities:{chartAnimation:I.chartAnimation},activeMediaInfoIndex:M.activeMediaInfoIndex||0,attributes:T,layer:R,fieldInfoMap:Q,formattedAttributes:{...J.global,...J.content[K]},expressionAttributes:S,mediaInfos:W,popupTemplate:P,relatedInfos:N,...this._compileTitleAndDesc({title:U,
description:V})}};H._compileMedia=function(M,K){const I=M.clone();M=new y(this._createMediaVMParams(M,K));I.mediaInfos=M.formattedMediaInfos.slice(0);this.contentViewModels[K]=M;return I};H._createTextVMParams=function(M){const {graphic:K,_fieldInfoMap:I,_sourceLayer:O,_expressionAttributes:Q}=this;if(M&&M.text){const {attributes:J}=K;M.text=p.substituteFieldsInLinksAndAttributes({attributes:J,fieldInfoMap:I,globalAttributes:this.formattedAttributes.global,expressionAttributes:Q,layer:O,text:M.text})}return{graphic:K,
creator:M.text}};H._compileText=function(M,K){M=M.clone();this.contentViewModels[K]=new x(this._createTextVMParams(M));return M};H._compileLastEditInfo=function(){const {_effectivePopupTemplate:M,_sourceLayer:K,graphic:I}=this;if(M){var {lastEditInfoEnabled:O}=M,Q=null==K?void 0:K.editFieldsInfo;if(O&&Q)return p.formatEditInfo(Q,I.attributes)}};H._compileTitle=function(M){const {_fieldInfoMap:K,_sourceLayer:I,graphic:O,_expressionAttributes:Q}=this,{attributes:J}=O;return p.substituteFieldsInLinksAndAttributes({attributes:J,
fieldInfoMap:K,globalAttributes:this.formattedAttributes.global,expressionAttributes:Q,layer:I,text:M})};H._getTitle=function(){var M=a._asyncToGenerator(function*(){const {_effectivePopupTemplate:K,graphic:I}=this;return p.graphicCallback(null==K?void 0:K.title,{graphic:I})});return function(){return M.apply(this,arguments)}}();H._getContent=function(){var M=a._asyncToGenerator(function*(){const {_effectivePopupTemplate:K,graphic:I}=this;return p.graphicCallback(null==K?void 0:K.content,{graphic:I})});
return function(){return M.apply(this,arguments)}}();H._queryFeature=function(){var M=a._asyncToGenerator(function*(K){const {_featureAbortController:I,_sourceLayer:O,graphic:Q,_effectivePopupTemplate:J,spatialReference:P,map:N,view:R}=this,{content:{value:S},title:{value:T}}=yield l.eachAlways({content:this._getContent(),title:this._getTitle()});I===this._featureAbortController&&Q&&(yield p.queryUpdatedFeature({graphic:Q,popupTemplate:J,layer:O,spatialReference:P},K),{expressionAttributes:{value:K}}=
yield l.eachAlways({checkForRelatedFeatures:this._checkForRelatedFeatures(K),expressionAttributes:A.createCompiledExpressions({expressionInfos:null==J?void 0:J.expressionInfos,spatialReference:P,graphic:Q,map:N,interceptor:D.interceptor,view:R})}),I===this._featureAbortController&&Q&&(this._expressionAttributes=K,this._graphicExpressionAttributes={...Q.attributes,...K},this._set("formattedAttributes",this._createFormattedAttributes(S)),this._set("title",this._compileTitle(T)),this._set("lastEditInfo",
this._compileLastEditInfo()||null),this._set("content",this._compileContent(S)||null)))});return function(K){return M.apply(this,arguments)}}();H._createMediaFormattedAttributes=function({contentElement:M,contentElementIndex:K,formattedAttributes:I}){const {_effectivePopupTemplate:O,graphic:Q,relatedInfos:J,_sourceLayer:P,_fieldInfoMap:N,_graphicExpressionAttributes:R}=this;I.content[K]=p.formatAttributes({fieldInfos:null==O?void 0:O.fieldInfos,graphic:Q,attributes:{...R,...M.attributes},layer:P,
fieldInfoMap:N,relatedInfos:J})};H._createFieldsFormattedAttributes=function({contentElement:M,contentElementIndex:K,formattedAttributes:I}){if(M.fieldInfos){const {graphic:O,relatedInfos:Q,_sourceLayer:J,_fieldInfoMap:P,_graphicExpressionAttributes:N}=this;I.content[K]=p.formatAttributes({fieldInfos:M.fieldInfos,graphic:O,attributes:{...N,...M.attributes},layer:J,fieldInfoMap:P,relatedInfos:Q})}};H._createFormattedAttributes=function(M){const {_effectivePopupTemplate:K,graphic:I,relatedInfos:O,_sourceLayer:Q,
_fieldInfoMap:J,_graphicExpressionAttributes:P}=this,N={global:p.formatAttributes({fieldInfos:null==K?void 0:K.fieldInfos,graphic:I,attributes:P,layer:Q,fieldInfoMap:J,relatedInfos:O}),content:[]};Array.isArray(M)&&M.forEach((R,S)=>{"fields"===R.type&&this._createFieldsFormattedAttributes({contentElement:R,contentElementIndex:S,formattedAttributes:N});"media"===R.type&&this._createMediaFormattedAttributes({contentElement:R,contentElementIndex:S,formattedAttributes:N})});return N};H._checkForRelatedFeatures=
function(M){const {graphic:K,_effectivePopupTemplate:I}=this;return this._queryRelatedInfos(K,p.getAllFieldInfos(I),M)};H._queryRelatedInfos=function(){var M=a._asyncToGenerator(function*(K,I,O){const {relatedInfos:Q,_sourceLayer:J}=this;Q.clear();const P=f.isSome(J.associatedLayer)?yield J.associatedLayer.load(O):J;if(P){var N=I.filter(T=>T&&p.isRelatedField(T.fieldName));if(N&&N.length){I.forEach(T=>this._configureRelatedInfo(T,P));var R=yield B.queryLayerInfos({relatedInfos:Q,layer:P},O);Object.keys(R).forEach(T=>
{var V;const W=Q.get(T.toString());T=null==(V=R[T])?void 0:V.value;W&&T&&(W.layerInfo=T.data)});var S=yield B.queryRelatedFeatures({graphic:K,relatedInfos:Q,layer:P},O);Object.keys(S).forEach(T=>{var V;B.setRelatedFeatures(null==(V=S[T])?void 0:V.value,Q.get(T.toString()))})}}});return function(K,I,O){return M.apply(this,arguments)}}();H._configureRelatedInfo=function(M,K){const {relatedInfos:I}=this,O=B.getRelatedFieldInfo(M.fieldName);if(O){var {layerId:Q,fieldName:J}=O;Q&&(K=I.get(Q.toString())||
B.createRelatedInfo(Q,K))&&(B.updateRelatedInfo({relatedInfo:K,fieldName:J,fieldInfo:M}),this.relatedInfos.set(Q,K))}};a._createClass(L,[{key:"_effectivePopupTemplate",get:function(){return f.isSome(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}},{key:"_fieldInfoMap",get:function(){return p.createfieldInfoMap(p.getAllFieldInfos(this._effectivePopupTemplate),this._sourceLayer)}},{key:"_sourceLayer",get:function(){return p.getSourceLayer(this.graphic)}},
{key:"state",get:function(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}},{key:"graphic",set:function(M){this._set("graphic",M?M.clone():null)}},{key:"spatialReference",get:function(){return this.get("view.spatialReference")||null},set:function(M){void 0===M?this._clearOverride("spatialReference"):this._override("spatialReference",M)}},{key:"map",get:function(){return this.get("view.map")||null},set:function(M){void 0===M?this._clearOverride("map"):
this._override("map",M)}},{key:"waitingForContent",get:function(){return!!this._featureAbortController}}]);return L}(h);h.interceptor=new g.FeatureSetQueryInterceptor(p.preLayerQueryCallback,p.preRequestCallback);b.__decorate([d.property()],h.prototype,"_error",void 0);b.__decorate([d.property()],h.prototype,"_featureAbortController",void 0);b.__decorate([d.property({readOnly:!0})],h.prototype,"_effectivePopupTemplate",null);b.__decorate([d.property({readOnly:!0})],h.prototype,"_fieldInfoMap",null);
b.__decorate([d.property({readOnly:!0})],h.prototype,"_sourceLayer",null);b.__decorate([d.property()],h.prototype,"abilities",void 0);b.__decorate([v.cast("abilities")],h.prototype,"castAbilities",null);b.__decorate([d.property({readOnly:!0})],h.prototype,"content",void 0);b.__decorate([d.property({readOnly:!0})],h.prototype,"contentViewModels",void 0);b.__decorate([d.property({type:Boolean})],h.prototype,"defaultPopupTemplateEnabled",void 0);b.__decorate([d.property({readOnly:!0})],h.prototype,"state",
null);b.__decorate([d.property({readOnly:!0})],h.prototype,"formattedAttributes",void 0);b.__decorate([d.property({type:c,value:null})],h.prototype,"graphic",null);b.__decorate([d.property({readOnly:!0})],h.prototype,"lastEditInfo",void 0);b.__decorate([d.property({readOnly:!0})],h.prototype,"relatedInfos",void 0);b.__decorate([d.property()],h.prototype,"spatialReference",null);b.__decorate([d.property({readOnly:!0})],h.prototype,"title",void 0);b.__decorate([d.property()],h.prototype,"map",null);
b.__decorate([d.property({readOnly:!0})],h.prototype,"waitingForContent",null);b.__decorate([d.property()],h.prototype,"view",void 0);return h=D=b.__decorate([q.subclass("esri.widgets.FeatureViewModel")],h)})},"esri/arcade/featureset/support/FeatureSetQueryInterceptor":function(){define(["exports"],function(a){a.FeatureSetQueryInterceptor=function(b,c){this.preLayerQueryCallback=b;this.preRequestCallback=c;this.preLayerQueryCallback||(this.preLayerQueryCallback=g=>{});this.preRequestCallback||(this.preLayerQueryCallback=
g=>{})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Feature/support/FeatureContentMixin":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/set ../../../core/accessorSupport/decorators/subclass ../../support/widget ../../support/jsxFactory".split(" "),function(a,b,c,g,h,w,n,f,l,k,e){a.FeatureContentMixin=
d=>{d=function(m){function z(){var v=m.apply(this,arguments)||this;v.renderNodeContent=q=>k.isWidget(q)&&!q.destroyed?e.tsx("div",{key:q},q.render()):q instanceof HTMLElement?e.tsx("div",{key:q,bind:q,afterCreate:v._attachToNode}):k.hasDomNode(q)?e.tsx("div",{key:q,bind:q.domNode,afterCreate:v._attachToNode}):null;return v}b._inheritsLoose(z,m);z.prototype._attachToNode=function(v){v.appendChild(this)};return z}(d);return d=c.__decorate([l.subclass("esri.widgets.Feature.ContentMixin")],d)};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/widgets/Spinner":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/maybe ../core/promiseUtils ../core/watchUtils ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./Spinner/SpinnerViewModel ./support/widgetUtils ../core/Logger ./support/jsxFactory".split(" "),function(a,b,c,g,h,
w,n,f,l,k,e,d,m,z,v,q){n=function(t){function r(u,E){u=t.call(this,u,E)||this;u._animationDelay=500;u._animationPromise=null;u.location=null;u.view=null;u.viewModel=new m;u.visible=!1;return u}a._inheritsLoose(r,t);var x=r.prototype;x.initialize=function(){this.own([h.watch(this,"visible",u=>this._visibleChange(u))])};x.destroy=function(){this._animationPromise=null};x.show=function(u){const {location:E,promise:y}=u;E&&(this.viewModel.location=E);this.visible=!0;u=()=>this.hide();y&&y.catch(()=>{}).then(u)};
x.hide=function(){this.visible=!1};x.render=function(){var {visible:u}=this,{screenLocation:E}=this.viewModel;E=!!E;u={["esri-spinner--start"]:u&&E,["esri-spinner--finish"]:!u&&E};E=this._getPositionStyles();return q.tsx("div",{class:this.classes("esri-spinner",u),styles:E})};x._visibleChange=function(u){if(u)this.viewModel.screenLocationEnabled=!0;else{var E=g.after(this._animationDelay);this._animationPromise=E;E.catch(()=>{}).then(()=>{this._animationPromise===E&&(this.viewModel.screenLocationEnabled=
!1,this._animationPromise=null)})}};x._getPositionStyles=function(){const {screenLocation:u,view:E}=this.viewModel;if(!E||c.isNone(u))return{};const {padding:y}=E;return{left:`${u.x-y.left}px`,top:`${u.y-y.top}px`}};return r}(d);b.__decorate([w.aliasOf("viewModel.location")],n.prototype,"location",void 0);b.__decorate([w.aliasOf("viewModel.view")],n.prototype,"view",void 0);b.__decorate([k.property({type:m})],n.prototype,"viewModel",void 0);b.__decorate([w.aliasOf("viewModel.visible")],n.prototype,
"visible",void 0);return n=b.__decorate([e.subclass("esri.widgets.Spinner")],n)})},"esri/widgets/Spinner/SpinnerViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../support/AnchorElementViewModel".split(" "),function(a,b,c,g,h,w,n,f){g=function(l){function k(e){e=l.call(this,e)||this;e.visible=
!1;return e}a._inheritsLoose(k,l);return k}(f);b.__decorate([c.property()],g.prototype,"visible",void 0);return g=b.__decorate([n.subclass("esri.widgets.CompassViewModel")],g)})},"esri/widgets/support/AnchorElementViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Evented ../../core/Handles ../../core/maybe ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){c=function(d){function m(v){var q=d.call(this,v)||this;q._anchorHandles=new g;q.location=null;q.screenLocation=null;q.screenLocationEnabled=!1;q.view=null;q._anchorHandles.add([w.watch(a._assertThisInitialized(q),["screenLocationEnabled","location","view.size","view.stationary"],()=>q._updateScreenPointAndHandle()),w.watch(a._assertThisInitialized(q),["view","view.ready"],()=>q._wireUpView())]);return q}a._inheritsLoose(m,d);var z=m.prototype;z.destroy=function(){this.view=
null;this._anchorHandles&&this._anchorHandles.destroy();this._viewpointHandle=this._anchorHandles=null};z._wireUpView=function(){this._anchorHandles.remove("view");this._viewpointHandle=null;if(this.get("view.ready")){this._setScreenLocation();var {view:v}=this;v=w.pausable(v,"3d"===v.type?"camera":"viewpoint",()=>this._viewpointChange());this._anchorHandles.add(v,"view");this._viewpointHandle=v;this._toggleWatchingViewpoint()}};z._viewpointChange=function(){this._setScreenLocation();this.emit("view-change")};
z._updateScreenPointAndHandle=function(){this._setScreenLocation();this._toggleWatchingViewpoint()};z._toggleWatchingViewpoint=function(){const {_viewpointHandle:v,location:q,screenLocationEnabled:t}=this;v&&(q&&t?v.resume():v.pause())};z._setScreenLocation=function(){const {location:v,view:q,screenLocationEnabled:t}=this;var r=this.get("view.ready");r=t&&r&&h.isSome(v)?q.toScreen(v):null;this._set("screenLocation",r)};return m}(c.EventedAccessor);b.__decorate([n.property()],c.prototype,"location",
void 0);b.__decorate([n.property({readOnly:!0})],c.prototype,"screenLocation",void 0);b.__decorate([n.property()],c.prototype,"screenLocationEnabled",void 0);b.__decorate([n.property()],c.prototype,"view",void 0);return c=b.__decorate([e.subclass("esri.widgets.support.AnchorElementViewModel")],c)})},"esri/widgets/Popup/PopupViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../Graphic ../../symbols ../../core/Collection ../../core/Error ../../core/Handles ../../core/Logger ../../core/maybe ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/webMercatorUtils ../../layers/Layer ../../support/actions/ActionBase ../../support/actions/ActionButton ../../support/actions/ActionToggle ../../symbols/support/symbolUtils ../../views/input/InputManager ../../views/support/layerViewUtils ../Feature/FeatureViewModel ./actions ./actionUtils ../support/AnchorElementViewModel ../support/GoTo ../../geometry/Point ../../symbols/SimpleFillSymbol".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H){const M=w.ofType({key:"type",defaultKeyValue:"button",base:x,typeMap:{button:u,toggle:E}}),K=l.getLogger("esri.widgets.Popup.PopupViewModel");c=function(I){function O(J){J=I.call(this,J)||this;J._handles=new f;J._pendingPromises=new Set;J._fetchFeaturesController=null;J._selectedClusterFeature=null;J.featurePage=null;J.actions=new M;J.defaultPopupTemplateEnabled=!1;J.autoCloseEnabled=!1;J.autoOpenEnabled=!0;J.browseClusterEnabled=
!1;J.content=null;J.featuresPerPage=20;J.featureViewModelAbilities=null;J.featureViewModels=[];J.highlightEnabled=!0;J.includeDefaultActions=!0;J.selectedClusterBoundaryFeature=new g({symbol:new H({outline:{width:1.5,color:"cyan"},style:"none"})});J.title=null;J.updateLocationEnabled=!1;J.view=null;J.visible=!1;J.zoomFactor=4;J.zoomToLocation=null;return J}a._inheritsLoose(O,I);var Q=O.prototype;Q.initialize=function(){this._handles.add([e.init(this,["autoOpenEnabled","view"],()=>this._autoOpenEnabledChange()),
this.on("view-change",()=>this._autoClose()),e.watch(this,["highlightEnabled","selectedFeature","visible","view"],()=>this._highlightFeature()),e.watch(this,"view.animation.state",J=>this._animationStateChange(J)),e.watch(this,"location",J=>this._locationChange(J)),e.watch(this,"selectedFeature",J=>this._selectedFeatureChange(J)),e.watch(this,["selectedFeatureIndex","featureCount","featuresPerPage"],()=>this._selectedFeatureIndexChange()),e.watch(this,["featurePage","selectedFeatureIndex","featureCount",
"featuresPerPage, featureViewModels"],()=>this._setGraphicOnFeatureViewModels()),e.watch(this,"featureViewModels",()=>this._featureViewModelsChange()),this.on("trigger-action",J=>C.triggerAction({event:J,view:this.view})),e.whenFalse(this,"waitingForResult",()=>this._waitingForResultChange(),!0),e.watch(this,["features","view","view.map","view.spatialReference"],()=>this._updateFeatureVMs()),e.watch(this,["view.scale"],this._viewScaleChange),e.whenFalse(this,"visible",()=>this.browseClusterEnabled=
!1),e.watch(this,"browseClusterEnabled",J=>J?this.enableClusterBrowsing():this.disableClusterBrowsing())])};Q.destroy=function(){this._cancelFetchingFeatures();this._handles.destroy();this._handles=null;this._pendingPromises.clear();this.browseClusterEnabled=!1;this.view=null};Q.centerAtLocation=function(){var {view:J}=this;const P=C.getSelectedTarget(this);return P?this.callGoTo({target:{target:P,scale:J.scale}}):(J=new n("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",
{target:P,view:J}),K.error(J),Promise.reject(J))};Q.clear=function(){this.set({promises:[],features:[],content:null,title:null,location:null})};Q.fetchFeatures=function(J,P){const {view:N}=this;return N&&J?N.fetchPopupFeatures(J,{event:P&&P.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:P&&P.signal}):(J=new n("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:J,view:N}),K.error(J),Promise.reject(J))};Q.open=
function(J){J={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...J,visible:!0};var {fetchFeatures:P}=J;delete J.fetchFeatures;P&&this._setFetchFeaturesPromises(J.location);P=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const N of P)delete J[N];this.set(J)};Q.triggerAction=function(J){(J=this.allActions.getItemAt(J))&&!J.disabled&&this.emit("trigger-action",{action:J})};Q.next=function(){this.selectedFeatureIndex+=1;return this};Q.previous=function(){--this.selectedFeatureIndex;return this};
Q.disableClusterBrowsing=function(){C.removeClusteredFeaturesForBrowsing(this);this._clearBrowsedClusterGraphics()};Q.enableClusterBrowsing=function(){var J=a._asyncToGenerator(function*(){yield C.displayClusterExtent(this);yield C.browseAggregateFeatures(this)});return function(){return J.apply(this,arguments)}}();Q._animationStateChange=function(J){this.zoomToLocation||(D.zoomToFeature.disabled="waiting-for-target"===J)};Q._clearBrowsedClusterGraphics=function(){var J;const P=null==(J=this.view)?
void 0:J.graphics;P&&(P.remove(this.selectedClusterBoundaryFeature),P.remove(this._selectedClusterFeature));this._selectedClusterFeature=null;this.selectedClusterBoundaryFeature.geometry=null};Q._viewScaleChange=function(){var J;null!=(J=this.selectedFeature)&&J.isAggregate?(this.visible=this.browseClusterEnabled=!1,this.clear()):this.browseClusterEnabled&&(this.browseClusterEnabled=!1,this.features=[this.selectedFeature])};Q._locationChange=function(J){const {selectedFeature:P,updateLocationEnabled:N}=
this;N&&J&&(!P||P.geometry)&&this.centerAtLocation()};Q._selectedFeatureIndexChange=function(){this.featurePage=1<this.featureCount?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null};Q._featureViewModelsChange=function(){this.featurePage=1<this.featureCount?1:null};Q._setGraphicOnFeatureViewModels=function(){const {features:J,featureCount:P,featurePage:N,featuresPerPage:R,featureViewModels:S}=this;if(null!==N){var T=((N-1)*R+P)%P;S.slice(T,T+R).forEach((V,W)=>{V&&!V.graphic&&(V.graphic=
J[T+W])})}};Q._selectedFeatureChange=function(){var J=a._asyncToGenerator(function*(P){if(P){var {location:N,updateLocationEnabled:R,view:S}=this;this.browseClusterEnabled?(this._selectedClusterFeature&&(S.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),P.isAggregate||(P.symbol=yield y.getDisplayedSymbol(P),this._selectedClusterFeature=P,S.graphics.add(this._selectedClusterFeature))):!R&&N||!P.geometry?R&&!P.geometry&&this.centerAtLocation().then(()=>{this.location=
S.center.clone()}):this.location=k.unwrap(this._getPointFromGeometry(P.geometry))}});return function(P){return J.apply(this,arguments)}}();Q._waitingForResultChange=function(){!this.featureCount&&this.promises&&(this.visible=!1)};Q._setFetchFeaturesPromises=function(J){return this._fetchFeaturesWithController(this._getScreenPoint(J||this.location)).then(P=>{const {clientOnlyGraphics:N,promisesPerLayerView:R}=P;P=Promise.resolve(N);const S=R.map(T=>T.promise);this.promises=[P,...S]})};Q._destroyFeatureVMs=
function(){this.featureViewModels.forEach(J=>J&&!J.destroyed&&J.destroy());this._set("featureViewModels",[])};Q._updateFeatureVMs=function(){const {selectedFeature:J,features:P,featureViewModels:N}=this;null!=J&&J.isAggregate||(this.browseClusterEnabled=!1);this._destroyFeatureVMs();if(P&&P.length){var R=N.slice(0),S=[];P.forEach((T,V)=>{if(T){var W=null;R.some((da,Y)=>{da&&da.graphic===T&&(W=da,R.splice(Y,1));return!!W});if(W)S[V]=W;else{var U,aa;const da=new B({abilities:this.featureViewModelAbilities,
defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:null==(U=this.view)?void 0:U.spatialReference,graphic:T===J?T:null,map:null==(aa=this.view)?void 0:aa.map,view:this.view});S[V]=da}}});R.forEach(T=>T&&!T.destroyed&&T.destroy());this._set("featureViewModels",S)}};Q._getScreenPoint=function(J){const {view:P}=this;return P&&J&&"function"===typeof P.toScreen?P.toScreen(J):null};Q._autoOpenEnabledChange=function(){const {_handles:J,autoOpenEnabled:P}=this;J.remove("auto-fetch-features");
if(P&&this.view){const N=this.view.on("click",R=>{"mouse"===R.pointerType&&0!==R.button||this._fetchFeaturesAndOpen(R)},A.ViewEventPriorities.WIDGET);J.add(N,"auto-fetch-features")}};Q._cancelFetchingFeatures=function(){const J=this._fetchFeaturesController;J&&J.abort();this._fetchFeaturesController=null;this.notifyChange("waitingForResult")};Q._fetchFeaturesWithController=function(J,P){this._cancelFetchingFeatures();const N=new AbortController,{signal:R}=N;this._fetchFeaturesController=N;this.notifyChange("waitingForResult");
J=this.fetchFeatures(J,{signal:R,event:P});J.catch(()=>{}).then(()=>{this._fetchFeaturesController=null;this.notifyChange("waitingForResult")});return J};Q._fetchFeaturesAndOpen=function(J){const {screenPoint:P,mapPoint:N}=J,{view:R}=this;this._fetchFeaturesWithController(P,J).then(S=>{const {clientOnlyGraphics:T,promisesPerLayerView:V,location:W}=S,U=[Promise.resolve(T),...V.map(aa=>aa.promise)];R.popup.open({location:W||N,promises:U});return S})};Q._updatePendingPromises=function(J){J&&this._pendingPromises.has(J)&&
(this._pendingPromises.delete(J),this.notifyChange("pendingPromisesCount"))};Q._autoClose=function(){this.autoCloseEnabled&&(this.visible=!1)};Q._getPointFromGeometry=function(J){return k.isNone(J)?null:"point"===J.type?J:"extent"===J.type?J.center:"polygon"===J.type?J.centroid:"multipoint"===J.type||"polyline"===J.type?J.extent.center:null};Q._getLayerView=function(){var J=a._asyncToGenerator(function*(P,N){yield P.when();return P.whenLayerView(N)});return function(P,N){return J.apply(this,arguments)}}();
Q._highlightFeature=function(){var J=a._asyncToGenerator(function*(){this._handles.remove("highlight");const {selectedFeature:P,highlightEnabled:N,view:R,visible:S}=this;if(P&&R&&N&&S){var {layer:T,sourceLayer:V}=P;if("map-notes"===(null==V?void 0:V.type)||"subtype-group"===(null==V?void 0:V.type))T=V;if(T&&T instanceof r){var W=this._getLayerView(R,T);this._highlightPromise=W;var U=yield W;if(U&&p.highlightsSupported(U)&&this._highlightPromise===W&&this.selectedFeature&&this.highlightEnabled&&this.visible){W=
"imagery"===T.type?void 0:"objectIdField"in T&&T.objectIdField;var aa=P.attributes;U=U.highlight(aa&&W&&aa[W]||P);this._handles.add(U,"highlight")}}}});return function(){return J.apply(this,arguments)}}();Q._updateFeatures=function(J){const {features:P}=this;J&&J.length&&(P.length?(J=J.filter(N=>-1===P.indexOf(N)),this.features=P.concat(J)):this.features=J)};a._createClass(O,[{key:"isLoadingFeature",get:function(){return this.featureViewModels.some(J=>J.waitingForContent)}},{key:"active",get:function(){return!(!this.visible||
this.waitingForResult)}},{key:"allActions",get:function(){const J=this._get("allActions")||new M;J.removeAll();const {actions:P,defaultActions:N,defaultPopupTemplateEnabled:R,includeDefaultActions:S,selectedFeature:T}=this;var V=S?N.concat(P):P;const W=T&&("function"===typeof T.getEffectivePopupTemplate&&T.getEffectivePopupTemplate(R)||T.popupTemplate),U=W&&W.actions;(V=W&&W.overwriteActions?U:U?U.concat(V):V)&&V.filter(Boolean).forEach(aa=>J.add(aa));return J}},{key:"defaultActions",get:function(){var J;
const P=this._get("defaultActions")||new M;P.removeAll();P.addMany(null!=(J=this.selectedFeature)&&J.isAggregate?[D.zoomToClusteredFeatures.clone(),D.browseClusteredFeatures.clone()]:[D.zoomToFeature.clone()]);return P}},{key:"featureCount",get:function(){return this.features.length}},{key:"features",get:function(){return this._get("features")||[]},set:function(J){J=J||[];this._set("features",J);const {pendingPromisesCount:P,promiseCount:N,selectedFeatureIndex:R}=this,S=N&&J.length;S&&P&&-1===R?this.selectedFeatureIndex=
0:S&&-1!==R||(this.selectedFeatureIndex=J.length?0:-1)}},{key:"location",get:function(){return this._get("location")||null},set:function(J){const P=this.get("view.spatialReference.isWebMercator");J&&J.get("spatialReference.isWGS84")&&P&&(J=t.geographicToWebMercator(J));this._set("location",J)}},{key:"pendingPromisesCount",get:function(){return this._pendingPromises.size}},{key:"waitingForResult",get:function(){return!(!(this._fetchFeaturesController||0<this.pendingPromisesCount)||0!==this.featureCount)}},
{key:"promiseCount",get:function(){return this.promises.length}},{key:"promises",get:function(){return this._get("promises")||[]},set:function(J){this._pendingPromises.clear();this.features=[];Array.isArray(J)&&J.length?(this._set("promises",J),J=J.slice(0),J.forEach(P=>{this._pendingPromises.add(P);P.then(N=>{this._pendingPromises.has(P)&&this._updateFeatures(N);this._updatePendingPromises(P)},()=>this._updatePendingPromises(P))})):this._set("promises",[]);this.notifyChange("pendingPromisesCount")}},
{key:"selectedFeature",get:function(){const {features:J,selectedFeatureIndex:P}=this;return-1===P?null:J[P]||null}},{key:"selectedFeatureIndex",get:function(){const J=this._get("selectedFeatureIndex");return"number"===typeof J?J:-1},set:function(J){const {featureCount:P}=this;J=isNaN(J)||-1>J||!P?-1:(J+P)%P;this._set("selectedFeatureIndex",J)}},{key:"selectedFeatureViewModel",get:function(){return this.featureViewModels[this.selectedFeatureIndex]||null}},{key:"state",get:function(){return this.get("view.ready")?
"ready":"disabled"}}]);return O}(G.GoToMixin(F));b.__decorate([d.property()],c.prototype,"featurePage",void 0);b.__decorate([d.property()],c.prototype,"isLoadingFeature",null);b.__decorate([d.property({type:M})],c.prototype,"actions",void 0);b.__decorate([d.property({readOnly:!0})],c.prototype,"active",null);b.__decorate([d.property({readOnly:!0})],c.prototype,"allActions",null);b.__decorate([d.property({type:Boolean})],c.prototype,"defaultPopupTemplateEnabled",void 0);b.__decorate([d.property()],
c.prototype,"autoCloseEnabled",void 0);b.__decorate([d.property()],c.prototype,"autoOpenEnabled",void 0);b.__decorate([d.property()],c.prototype,"browseClusterEnabled",void 0);b.__decorate([d.property()],c.prototype,"content",void 0);b.__decorate([d.property({type:M,readOnly:!0})],c.prototype,"defaultActions",null);b.__decorate([d.property({readOnly:!0})],c.prototype,"featureCount",null);b.__decorate([d.property()],c.prototype,"features",null);b.__decorate([d.property()],c.prototype,"featuresPerPage",
void 0);b.__decorate([d.property()],c.prototype,"featureViewModelAbilities",void 0);b.__decorate([d.property({readOnly:!0})],c.prototype,"featureViewModels",void 0);b.__decorate([d.property()],c.prototype,"highlightEnabled",void 0);b.__decorate([d.property()],c.prototype,"includeDefaultActions",void 0);b.__decorate([d.property({type:L})],c.prototype,"location",null);b.__decorate([d.property({readOnly:!0})],c.prototype,"pendingPromisesCount",null);b.__decorate([d.property({readOnly:!0})],c.prototype,
"selectedClusterBoundaryFeature",void 0);b.__decorate([d.property({readOnly:!0})],c.prototype,"waitingForResult",null);b.__decorate([d.property({readOnly:!0})],c.prototype,"promiseCount",null);b.__decorate([d.property()],c.prototype,"promises",null);b.__decorate([d.property({value:null,readOnly:!0})],c.prototype,"selectedFeature",null);b.__decorate([d.property({value:-1})],c.prototype,"selectedFeatureIndex",null);b.__decorate([d.property({readOnly:!0})],c.prototype,"selectedFeatureViewModel",null);
b.__decorate([d.property({readOnly:!0})],c.prototype,"state",null);b.__decorate([d.property()],c.prototype,"title",void 0);b.__decorate([d.property()],c.prototype,"updateLocationEnabled",void 0);b.__decorate([d.property()],c.prototype,"view",void 0);b.__decorate([d.property()],c.prototype,"visible",void 0);b.__decorate([d.property()],c.prototype,"zoomFactor",void 0);b.__decorate([d.property()],c.prototype,"zoomToLocation",void 0);b.__decorate([d.property()],c.prototype,"centerAtLocation",null);return c=
b.__decorate([q.subclass("esri.widgets.Popup.PopupViewModel")],c)})},"esri/symbols/support/symbolUtils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/maybe ../../support/arcadeOnDemand ./previewUtils ./utils".split(" "),function(a,b,c,g,h,w,n,f){function l(q,t){if(t&&(q.style.filter=f.getCSSFilterFromEffectList(t),t=t.effects))for(const r of t)if("drop-shadow"===(null==r?void 0:r.type)){0>r.offsetX?q.style.marginLeft=`${Math.abs(r.offsetX)}px`:
q.style.marginRight=`${r.offsetX}px`;break}}function k(q,t){return e.apply(this,arguments)}function e(){e=c._asyncToGenerator(function*(q,t){switch(q.type){case "web-style":var {previewWebStyleSymbol:r}=yield new Promise((x,u)=>a(["./previewWebStyleSymbol"],x,u));return r(q,k,t);case "label-3d":case "line-3d":case "mesh-3d":case "point-3d":case "polygon-3d":return{previewSymbol3D:r}=yield new Promise((x,u)=>a(["./previewSymbol3D"],x,u)),r(q,t);case "simple-marker":case "simple-line":case "simple-fill":case "picture-marker":case "picture-fill":case "text":return{previewSymbol2D:r}=
yield new Promise((x,u)=>a(["./previewSymbol2D"],x,u)),r(q,t);case "cim":return{previewCIMSymbol:r}=yield new Promise((x,u)=>a(["./previewCIMSymbol"],x,u)),r(q,t)}});return e.apply(this,arguments)}function d(q){return q&&"opacity"in q?q.opacity*d(q.parent):1}function m(){m=c._asyncToGenerator(function*(q,t){var r,x;if(q){var u=q.sourceLayer;u=null!=(r=h.isSome(t)&&null!=(x=t.useSourceLayer)&&x?u:q.layer)?r:u;r=d(u);if(h.isSome(q.symbol)&&(!h.isSome(t)||!0!==t.ignoreGraphicSymbol))return q="web-style"===
q.symbol.type?yield q.symbol.fetchSymbol(h.isSome(t)?t.abortOptions:null):q.symbol.clone(),f.applyColorToSymbol(q,null,r),q;var E=h.isSome(t)&&t.renderer||u&&"renderer"in u&&u.renderer;if(x=E&&"getSymbolAsync"in E?yield E.getSymbolAsync(q,t):null){x="web-style"===x.type?yield x.fetchSymbol(h.isSome(t)?t.abortOptions:null):x.clone();if(!("visualVariables"in E&&E.visualVariables&&E.visualVariables.length))return f.applyColorToSymbol(x,null,r),x;"arcadeRequiredForVisualVariables"in E&&E.arcadeRequiredForVisualVariables&&
(h.isNone(t)||h.isNone(t.arcade))&&(t={...h.unwrap(t)},t.arcade=yield w.loadArcade());u=yield new Promise((C,F)=>a(["../../renderers/visualVariables/support/visualVariableUtils"],C,F));var y=[],A=[],p=[],B=[];for(var D of E.visualVariables)switch(D.type){case "color":y.push(D);break;case "opacity":A.push(D);break;case "rotation":B.push(D);break;case "size":D.target||p.push(D)}D=(D=!!y.length&&y[y.length-1])?u.getColor(D,q,t):null;A=(A=!!A.length&&A[A.length-1])?u.getOpacity(A,q,t):null;null!=r&&(A=
null!=A?A*r:r);f.applyColorToSymbol(x,D,A);p.length&&(r=u.getAllSizes(p,q,t),yield f.applySizesToSymbol(x,r));for(const C of B)f.applyRotationToSymbol(x,u.getRotationAngle(C,q,t),C.axis);return x}}});return m.apply(this,arguments)}function z(){z=c._asyncToGenerator(function*(q,t){var r;if(q){var x=d(q.layer||q.sourceLayer);if(h.isSome(q.symbol)&&(!h.isSome(t)||!0!==t.ignoreGraphicSymbol))return q="web-style"===q.symbol.type?yield q.symbol.fetchSymbol(h.isSome(t)?t.abortOptions:null):q.symbol.clone(),
f.getColorFromSymbol(q,x);var u=h.isSome(t)&&t.renderer||q.get("layer.renderer")||q.get("sourceLayer.renderer"),E=yield u.getSymbolAsync(q,t);if(E){E="web-style"===E.type?yield E.fetchSymbol(h.isSome(t)?t.abortOptions:null):E.clone();E=f.getColorFromSymbol(E,x);if(!("visualVariables"in u)||"visualVariables"in u&&!u.visualVariables||"visualVariables"in u&&(null==(r=u.visualVariables)||!r.length))return E;u.arcadeRequiredForVisualVariables&&(h.isNone(t)||h.isNone(t.arcade))&&(t={...h.unwrap(t)},t.arcade=
yield w.loadArcade());r=yield new Promise((p,B)=>a(["../../renderers/visualVariables/support/visualVariableUtils"],p,B));var y=[],A=[];for(const p of u.visualVariables)switch(p.type){case "color":y.push(p);break;case "opacity":A.push(p)}u=(u=0<y.length?y[y.length-1]:null)?r.getColor(u,q,t):E;q=(E=0<A.length?A[A.length-1]:null)?r.getOpacity(E,q,t):null;null!=x&&(q=null!=q?q*x:x);return u?f.applyOpacityToColor(u,q):null}}});return z.apply(this,arguments)}let v=null;b.getDisplayedColor=function(q,t){return z.apply(this,
arguments)};b.getDisplayedSymbol=function(q,t){return m.apply(this,arguments)};b.renderColorRampPreviewHTML=function(q,t={}){var r="horizontal"===t.align;const {width:x=r?75:24,height:u=r?24:75,gradient:E=!0}=t;var y=window.devicePixelRatio,A=x*y,p=u*y;y=document.createElement("canvas");y.width=A;y.height=p;y.style.width=`${x}px`;y.style.height=`${u}px`;const B=y.getContext("2d");var D=r?A:0,C=r?0:p;if(E){const F=B.createLinearGradient(0,0,D,C);r=q.length;const G=1===r?0:1/(r-1);q.forEach((L,H)=>
F.addColorStop(H*G,L.toString()));B.fillStyle=F;B.fillRect(0,0,A,p)}else{A=r?A/q.length:A;p=r?p:p/q.length;C=D=0;for(const F of q)B.fillStyle=F.toString(),B.fillRect(D,C,A,p),D=r?D+A:0,C=r?0:C+p}q=document.createElement("div");q.style.width=`${x}px`;q.style.height=`${u}px`;l(q,null==t?void 0:t.effectList);q.appendChild(y);return q};b.renderDotDensityPreviewHTML=function(q,t,r){const {backgroundColor:x,outline:u,dotSize:E}=q;r=r&&r.swatchSize||n.SymbolSizeDefaults.size;const y=Math.round(r*r/E**2*
.8),A=window.devicePixelRatio;q=document.createElement("canvas");const p=r*A;q.width=p;q.height=p;q.style.width=`${q.width/A}px`;q.style.height=`${q.height/A}px`;const B=q.getContext("2d");x&&(B.fillStyle=x.toCss(!0),B.fillRect(0,0,p,p),B.fill());B.fillStyle=t.toCss(!0);if(v&&v.length/2===y)for(t=0;t<2*y;t+=2)B.fillRect(v[t],v[t+1],E*A,E*A),B.fill();else for(v=[],t=0;t<2*y;t+=2){const D=Math.floor(Math.random()*(p-0+1)),C=Math.floor(Math.random()*(p-0+1));v.push(D,C);B.fillRect(D,C,E*A,E*A);B.fill()}u&&
(u.color&&(B.strokeStyle=u.color.toCss(!0)),B.lineWidth=u.width,B.strokeRect(0,0,p,p));r=new Image(r,r);r.src=q.toDataURL();return r};b.renderPreviewHTML=k;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/symbols/support/previewUtils":function(){define(["exports","../../Color"],function(a,b){function c(g,h){return Math.round(Math.min(Math.max(g+191.25*h,0),255))}a.SymbolSizeDefaults=void 0;(function(g){g[g.size=22]="size";g[g.lineWidth=50]="lineWidth";g[g.maxSize=120]="maxSize";g[g.maxOutlineSize=
80]="maxOutlineSize";g[g.tallSymbolWidth=20]="tallSymbolWidth"})(a.SymbolSizeDefaults||(a.SymbolSizeDefaults={}));a.adjustColorBrightness=function(g,h){if("type"in g&&("linear"===g.type||"pattern"===g.type))return g;g=new b(g);return new b([c(g.r,h),c(g.g,h),c(g.b,h),g.a])};a.adjustColorComponentBrightness=c;a.getConeShapes=function(g,h){let w=h?a.SymbolSizeDefaults.tallSymbolWidth:g;h=h?4:6;w=w<=a.SymbolSizeDefaults.size?w-.5*h:w-h;h=.15*w;const n=w;g-=h;return[{type:"ellipse",cx:.5*w,cy:g,rx:.5*
w,ry:h},{type:"path",path:[{command:"M",values:[.5*n,0]},{command:"L",values:[n,g]},{command:"L",values:[0,g]},{command:"Z",values:[]}]}]};a.getCubeShapes=function(g,h){let w=h?a.SymbolSizeDefaults.tallSymbolWidth:g;var n=h?4:6;n=w=w<=a.SymbolSizeDefaults.size?w-.5*n:w-n;h=h?.35*w:.5*w;return[{type:"path",path:[{command:"M",values:[.5*n,0]},{command:"L",values:[n,.5*h]},{command:"L",values:[.5*n,h]},{command:"L",values:[0,.5*h]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,
.5*h]},{command:"L",values:[.5*n,h]},{command:"L",values:[.5*n,g]},{command:"L",values:[0,g-.5*h]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*n,h]},{command:"L",values:[.5*n,g]},{command:"L",values:[n,g-.5*h]},{command:"L",values:[n,.5*h]},{command:"Z",values:[]}]}]};a.getCylinderShapes=function(g,h){var w=h?a.SymbolSizeDefaults.tallSymbolWidth:g;h=h?4:6;w=w<=a.SymbolSizeDefaults.size?w-.5*h:w-h;h=.5*w;const n=.15*w;g-=n;return[{type:"ellipse",cx:.5*w,cy:g,rx:h,ry:n},{type:"path",
path:[{command:"M",values:[0,n]},{command:"L",values:[0,g]},{command:"L",values:[w,g]},{command:"L",values:[w,n]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*w,cy:n,rx:h,ry:n}]};a.getDiamondShapes=function(g){var h=g;h=h<a.SymbolSizeDefaults.size?h-2:h-4;const w=Math.floor(g/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*h,0]},{command:"L",values:[h,.5*g-w]},{command:"L",values:[.45*h-w,.5*g+w]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*h,0]},{command:"L",
values:[.45*h-w,.5*g+w]},{command:"L",values:[0,.5*g-w]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*g-w]},{command:"L",values:[.45*h-w,.5*g+w]},{command:"L",values:[.45*h,g]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*h,g]},{command:"L",values:[h,.5*g-w]},{command:"L",values:[.45*h-w,.5*g+w]},{command:"Z",values:[]}]}]};a.getExtrudeSymbolShapes=function(g){const h=a.SymbolSizeDefaults.size;g*=.5;return[{type:"path",path:[{command:"M",values:[0,
.35*h]},{command:"L",values:[.3*h,.7*h]},{command:"L",values:[.3*h,.7*h+g]},{command:"L",values:[0,.7*h+g-.35*h]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*h,.7*h]},{command:"L",values:[.3*h,.7*h+g]},{command:"L",values:[h,g]},{command:"L",values:[h,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*h,0]},{command:"L",values:[h,0]},{command:"L",values:[.3*h,.7*h]},{command:"L",values:[0,.35*h]},{command:"Z",values:[]}]}]};a.getInvertedConeShapes=function(g){let h=
g;h=h<a.SymbolSizeDefaults.size?h-3:h-6;const w=.15*h,n=h;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[n,0]},{command:"L",values:[.5*n,g-w]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*h,cy:0,rx:.5*h,ry:w}]};a.getPathSymbolShapes=function(g,h,w){var n=a.SymbolSizeDefaults.size;let f=n,l=n;1>g?f*=.75:1<g&&(l*=1.25);g=n;h&&w&&(f=l=g=n=0);return[{type:"path",path:[{command:"M",values:[g,0]},{command:"L",values:[w?g:.875*g,0]},{command:"L",values:[w?f-.5*g:0,l-.5*n]},
{command:"L",values:[f-.5*g,l-.5*n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[g,0]},{command:"L",values:[g,h?0:.125*n]},{command:"L",values:[f-.5*g,h?l-.5*n:n]},{command:"L",values:[f-.5*g,l-.5*n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[f-.5*g,l-.5*n]},{command:"L",values:[w?f-.5*g:0,l-.5*n]},{command:"L",values:[w?f-.5*g:0,h?l-.5*n:n]},{command:"L",values:[f-.5*g,h?l-.5*n:n]},{command:"Z",values:[]}]}]};a.getTetrahedronShapes=function(g){var h=
g;h=h<a.SymbolSizeDefaults.size?h-1:h-2;return[{type:"path",path:[{command:"M",values:[.45*g,0]},{command:"L",values:[g,h]},{command:"L",values:[.45*g,.6*h]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*g,0]},{command:"L",values:[.45*g,.6*h]},{command:"L",values:[0,h]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,h]},{command:"L",values:[.45*g,.6*h]},{command:"L",values:[g,h]},{command:"Z",values:[]}]}]};a.getWaterSymbolShapes=function(){return[{type:"path",
path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},
{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}]};
a.shapes={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],squareFill:[{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],
cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],
tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",
path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/symbols/support/utils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../Color ../../symbols ../../core/asyncUtils ../../core/has ../../core/maybe ../../core/screenUtils ../../chunks/vec3f64 ../../layers/effects/jsonUtils ./gfxUtils ./Symbol3DMaterial".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m){function z(H){H=H.symbolLayers;if(!H)return null;let M=null;H.forEach(K=>{if("object"!==K.type||null==K.resource.href)M="water"===K.type?f.unwrap(K.color):f.isSome(K.material)?f.unwrap(K.material.color):null});return M?new g(M):null}function v(H,M){if(null==M)return H;H=H.toRgba();H[3]*=M;return new g(H)}function q(H,M,K){if(H=H.symbolLayers){var I=O=>{O=f.isSome(O)?O:null;M=M||O||null!=K&&L;return v(M,K)};H.forEach(O=>{if("object"!==O.type||null==O.resource.href||
M)if("water"===O.type)O.color=I(O.color);else{var Q=f.isSome(O.material)?O.material.color:null;Q=I(Q);f.isNone(O.material)?O.material=new m.Symbol3DMaterial({color:Q}):O.material.color=Q;null!=K&&"outline"in O&&f.isSome(O.outline)&&f.isSome(O.outline.color)&&(O.outline.color=v(O.outline.color,K))}})}}function t(H,M){return r.apply(this,arguments)}function r(){r=c._asyncToGenerator(function*(H,M){(H=H.symbolLayers)&&(yield w.forEach(H,function(){var K=c._asyncToGenerator(function*(I){return x(I,M)});
return function(I){return K.apply(this,arguments)}}()))});return r.apply(this,arguments)}function x(H,M){return u.apply(this,arguments)}function u(){u=c._asyncToGenerator(function*(H,M){switch(H.type){case "extrude":H.size="number"===typeof M[2]?M[2]:0;break;case "icon":case "line":case "text":M=E(M);f.isSome(M)&&(H.size=M);break;case "path":{const K=p(M,k.ONES,[H.width,void 0,H.height]);H.width=C(M[0],H.width,1,K);H.height=C(M[2],H.height,1,K)}break;case "object":yield y(H,M)}});return u.apply(this,
arguments)}function E(H){for(const M of H)if("number"===typeof M)return M;return null}function y(H,M){return A.apply(this,arguments)}function A(){A=c._asyncToGenerator(function*(H,M){const {resourceSize:K,symbolSize:I}=yield B(H),O=p(M,K,I);H.width=C(M[0],I[0],K[0],O);H.depth=C(M[1],I[1],K[1],O);H.height=C(M[2],I[2],K[2],O)});return A.apply(this,arguments)}function p(H,M,K){for(let I=0;3>I;I++){const O=H[I];switch(O){case "symbol-value":return null!=K[I]?K[I]/M[I]:1;case "proportional":break;default:if(O&&
M[I])return O/M[I]}}return 1}function B(H){return D.apply(this,arguments)}function D(){D=c._asyncToGenerator(function*(H){const M=yield(yield new Promise((P,N)=>a(["./symbolLayerUtils"],P,N))).computeObjectLayerResourceSize(H,10),{width:K,height:I,depth:O}=H;H=[K,O,I];let Q=1;for(var J=0;3>J;J++)if(null!=H[J]){Q=H[J]/M[J];break}for(J=0;3>J;J++)null==H[J]&&(H[J]=M[J]*Q);return{resourceSize:M,symbolSize:H}});return D.apply(this,arguments)}function C(H,M,K,I){switch(H){case "proportional":return K*I;
case "symbol-value":return null!=M?M:K;default:return H}}function F(){F=c._asyncToGenerator(function*(H,M){if(H&&M){if(h.isSymbol3D(H))return t(H,M);if(h.isSymbol2D(H)&&(M=E(M),!f.isNone(M)))switch(H.type){case "simple-marker":H.size=M;break;case "picture-marker":{const K=H.width/H.height;1<K?(H.width=M,H.height=M*K):(H.width=M*K,H.height=M);break}case "simple-line":H.width=M;break;case "text":H.font.size=M}}});return F.apply(this,arguments)}const G=/\/resource\/(.*?)\.svg$/,L=new g("white");b.applyColorToSymbol=
function(H,M,K){if(H&&(M||null!=K))if(M&&(M=new g(M)),h.isSymbol3D(H))q(H,M,K);else if(h.isSymbol2D(H)){if(M=M||H.color)H.color=v(M,K);null!=K&&"outline"in H&&H.outline&&H.outline.color&&(H.outline.color=v(H.outline.color,K))}};b.applyOpacityToColor=v;b.applyRotationToSymbol=function(H,M,K){H&&null!=M&&(h.isSymbol3D(H)?(H=H.symbolLayers)&&H.forEach(I=>{if(I&&"object"===I.type)switch(K){case "tilt":I.tilt=M;break;case "roll":I.roll=M;break;default:I.heading=M}}):!h.isSymbol2D(H)||"simple-marker"!==
H.type&&"picture-marker"!==H.type&&"text"!==H.type||(H.angle=M))};b.applySizesToSymbol=function(H,M){return F.apply(this,arguments)};b.getCSSFilterFromEffectList=function(H){if(!H)return null;H=H.effects.filter(M=>"bloom"!==M.type).map(M=>M.toJSON());return e.effectFunctionsFromJSON(H)};b.getColorFromSymbol=function(H,M){if(!H)return null;let K=null;h.isSymbol3D(H)?K=z(H):h.isSymbol2D(H)&&(K=H.color?new g(H.color):null);return K?v(K,M):null};b.getIconHref=function(H,M){M=M.resource.href;return!n("esri-canvas-svg-support")&&
H.styleOrigin&&G.test(M)?M.replace(G,"/resource/png/$1.png"):M};b.getSymbolOutlineSize=function(H){if(!H)return 0;if(h.isSymbol3D(H)){{const M=H.symbolLayers&&H.symbolLayers.length;M?(H=H.symbolLayers.getItemAt(M-1),H="outline"in H?f.get(H,"outline","size"):void 0):H=void 0}return f.isSome(H)?H:0}return(H=d.getStroke(H))&&l.px2pt(H.width)||0};b.isVolumetricSymbol=function(H){if(f.isNone(H)||!("symbolLayers"in H)||f.isNone(H.symbolLayers))return!1;switch(H.type){case "point-3d":return H.symbolLayers.some(M=>
"object"===M.type);case "line-3d":return H.symbolLayers.some(M=>"path"===M.type);case "polygon-3d":return H.symbolLayers.some(M=>"object"===M.type||"extrude"===M.type);default:return!1}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/symbols/support/gfxUtils":function(){define("exports ../../assets ../../Color ../../request ../../core/ItemCache ../../core/screenUtils ./cimSymbolUtils".split(" "),function(a,b,c,g,h,w,n){function f(m){if(!m)return null;let z;switch(m.type){case "simple-fill":case "picture-fill":case "simple-marker":z=
f(m.outline);break;case "simple-line":{const v=w.pt2px(m.width);"none"!==m.style&&0!==v&&(z={color:m.color,style:d(m.style),width:v,cap:m.cap,join:"miter"===m.join?w.pt2px(m.miterLimit):m.join});break}default:z=null}return z}const l={left:"start",center:"middle",right:"end",justify:"start"},k={top:"text-before-edge",middle:"central",baseline:"alphabetic",bottom:"text-after-edge"},e=new h(1E3),d=function(){const m={};return function(z){if(m[z])return m[z];const v=z.replace(/-/g,"");return m[z]=v}}();
c=new c([128,128,128]);a.defaultThematicColor=c;a.dekebabifyLineStyle=d;a.getFill=function(m){const z=m.style;let v=null;if(m)switch(m.type){case "simple-marker":"cross"!==z&&"x"!==z&&(v=m.color);break;case "simple-fill":"solid"===z?v=m.color:"none"!==z&&(v={type:"pattern",x:0,y:0,src:b.getAssetUrl(`esri/symbols/patterns/${z}.png`),width:5,height:5});break;case "picture-fill":v={type:"pattern",src:m.url,width:w.pt2px(m.width)*m.xscale,height:w.pt2px(m.height)*m.yscale,x:w.pt2px(m.xoffset),y:w.pt2px(m.yoffset)};
break;case "text":v=m.color;break;case "cim":v=n.getCIMSymbolColor(m)}return v};a.getPatternUrlWithColor=function(m,z){const v=m+"-"+z;return void 0!==e.get(v)?Promise.resolve(e.get(v)):g(m,{responseType:"image"}).then(q=>{q=q.data;const t=q.naturalWidth,r=q.naturalHeight,x=document.createElement("canvas");x.width=t;x.height=r;const u=x.getContext("2d");u.fillStyle=z;u.fillRect(0,0,t,r);u.globalCompositeOperation="destination-in";u.drawImage(q,0,0);q=x.toDataURL();e.put(v,q);return q})};a.getSVGAlign=
function(m){return m=(m=m.horizontalAlignment)&&l[m.toLowerCase()]||"middle"};a.getSVGBaseline=function(m){return(m=m.verticalAlignment)&&k[m.toLowerCase()]||"alphabetic"};a.getSVGBaselineShift=function(m){return"bottom"===m.verticalAlignment?"super":null};a.getStroke=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/ItemCache":function(){define(["./MemCache"],function(a){return function(){function b(g,h){this._storage=new a.MemCacheStorage;this._storage.maxSize=g;h&&this._storage.registerRemoveFunc("",
h)}var c=b.prototype;c.put=function(g,h){this._storage.put(g,h,1,1)};c.pop=function(g){return this._storage.pop(g)};c.get=function(g){return this._storage.get(g)};c.clear=function(){this._storage.clearAll()};c.destroy=function(){this._storage.destroy()};return b}()})},"esri/symbols/support/cimSymbolUtils":function(){define(["exports","../../Color","../cim/utils"],function(a,b,c){function g(d){d=c.toCIMSymbolJSON(d);if("CIMTextSymbol"===d.type)return d.height;let m=0;if(d.symbolLayers)for(const z of d.symbolLayers)c.isCIMMarker(z)&&
z.size>m?m=z.size:c.isCIMStroke(z)&&z.width>m?m=z.width:c.isCIMFill(z);return m}function h(d,m,z,v){if("CIMTextSymbol"===d.type)d.height*=m;else{if(z&&d.effects)for(const q of d.effects)f(q,m);if(d.symbolLayers)for(const q of d.symbolLayers)switch(q.type){case "CIMPictureMarker":case "CIMVectorMarker":w(q,m,v);break;case "CIMPictureStroke":case "CIMSolidStroke":null!=v&&v.preserveOutlineWidth||!q.width||(q.width*=m);break;case "CIMPictureFill":q.height&&(q.height*=m);q.offsetX&&(q.offsetX*=m);q.offsetY&&
(q.offsetY*=m);break;case "CIMHatchFill":h(q.lineSymbol,m,!0,{...v,preserveOutlineWidth:!1}),q.offsetX&&(q.offsetX*=m),q.offsetY&&(q.offsetY*=m),q.separation&&(q.separation*=m)}}}function w(d,m,z){d.markerPlacement&&n(d.markerPlacement,m);d.offsetX&&(d.offsetX*=m);d.offsetY&&(d.offsetY*=m);d.anchorPoint&&"Absolute"===d.anchorPointUnits&&(d.anchorPoint={x:d.anchorPoint.x*m,y:d.anchorPoint.y*m});d.size*=m;if("CIMVectorMarker"===d.type&&d.markerGraphics)for(const v of d.markerGraphics)d.scaleSymbolsProportionally||
h(v.symbol,m,!0,z)}function n(d,m){c.isCIMMarkerStrokePlacement(d)&&d.offset&&(d.offset*=m);switch(d.type){case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineSameSize":d.customEndingOffset&&(d.customEndingOffset*=m);d.offsetAlongLine&&(d.offsetAlongLine*=m);if(d.placementTemplate&&d.placementTemplate.length){var z=d.placementTemplate.map(v=>v*m);d.placementTemplate=z}break;case "CIMMarkerPlacementAlongLineVariableSize":d.maxRandomOffset&&(d.maxRandomOffset*=m);d.placementTemplate&&
d.placementTemplate.length&&(z=d.placementTemplate.map(v=>v*m),d.placementTemplate=z);break;case "CIMMarkerPlacementOnLine":d.startPointOffset&&(d.startPointOffset*=m);break;case "CIMMarkerPlacementAtExtremities":d.offsetAlongLine&&(d.offsetAlongLine*=m);break;case "CIMMarkerPlacementAtRatioPositions":d.beginPosition&&(d.beginPosition*=m);d.endPosition&&(d.endPosition*=m);break;case "CIMMarkerPlacementPolygonCenter":d.offsetX&&(d.offsetX*=m);d.offsetY&&(d.offsetY*=m);break;case "CIMMarkerPlacementInsidePolygon":d.offsetX&&
(d.offsetX*=m),d.offsetY&&(d.offsetY*=m),d.stepX&&(d.stepX*=m),d.stepY&&(d.stepY*=m)}}function f(d,m){switch(d.type){case "CIMGeometricEffectArrow":case "CIMGeometricEffectDonut":d.width&&(d.width*=m);break;case "CIMGeometricEffectBuffer":d.size&&(d.size*=m);break;case "CIMGeometricEffectCut":d.beginCut&&(d.beginCut*=m);d.endCut&&(d.endCut*=m);d.middleCut&&(d.middleCut*=m);break;case "CIMGeometricEffectDashes":d.customEndingOffset&&(d.customEndingOffset*=m);d.offsetAlongLine&&(d.offsetAlongLine*=
m);if(d.dashTemplate&&d.dashTemplate.length){const z=d.dashTemplate.map(v=>v*m);d.dashTemplate=z}break;case "CIMGeometricEffectExtension":case "CIMGeometricEffectJog":case "CIMGeometricEffectRadial":d.length&&(d.length*=m);break;case "CIMGeometricEffectMove":d.offsetX&&(d.offsetX*=m);d.offsetY&&(d.offsetY*=m);break;case "CIMGeometricEffectOffset":case "CIMGeometricEffectOffsetTangent":d.offset&&(d.offset*=m);break;case "CIMGeometricEffectRegularPolygon":d.radius&&(d.radius*=m);break;case "CIMGeometricEffectTaperedPolygon":d.fromWidth&&
(d.fromWidth*=m);d.length&&(d.length*=m);d.toWidth&&(d.toWidth*=m);break;case "CIMGeometricEffectWave":d.amplitude&&(d.amplitude*=m),d.period&&(d.period*=m)}}function l(d,m){let z;z="CIMTextSymbol"===d.type?d.symbol:d;d="CIMPolygonSymbol"===d.type;if(z.symbolLayers)for(const v of z.symbolLayers)if(!(v.colorLocked||d&&(c.isCIMStroke(v)||c.isCIMMarker(v)&&v.markerPlacement&&c.isCIMMarkerStrokePlacement(v.markerPlacement))))switch(v.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":v.tintColor&&
k(m,v.tintColor);break;case "CIMVectorMarker":v.markerGraphics.forEach(q=>{l(q.symbol,m)});break;case "CIMSolidStroke":case "CIMSolidFill":k(m,v.color);break;case "CIMHatchFill":l(v.lineSymbol,m)}}function k(d,m){for(const z of d)if(z.join(".")===m.join("."))return;d.push(m)}function e(d,m,z){var v="CIMTextSymbol"===d.type?d.symbol:d;d="CIMPolygonSymbol"===v.type?!0:!1;if(v.symbolLayers)for(const q of v.symbolLayers)if(!q.colorLocked){if(d)if(z){if({layersToColor:v}=z,(c.isCIMStroke(q)||c.isCIMMarker(q)&&
q.markerPlacement&&c.isCIMMarkerStrokePlacement(q.markerPlacement))&&"fill"===v||c.isCIMFill(q)&&"outline"===v)continue}else if(c.isCIMStroke(q)||c.isCIMMarker(q)&&q.markerPlacement&&c.isCIMMarkerStrokePlacement(q.markerPlacement))continue;v=m.toArray();switch(q.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":q.tintColor=v;break;case "CIMVectorMarker":q.markerGraphics.forEach(t=>{e(t.symbol,m,z)});break;case "CIMSolidStroke":case "CIMSolidFill":q.color=v;break;case "CIMHatchFill":e(q.lineSymbol,
m,z)}}}a.applyCIMSymbolColor=function(d,m,z){m instanceof b||(m=new b(m));(d=c.toCIMSymbolJSON(d))&&e(d,m,z)};a.applyCIMSymbolRotation=function(d,m,z=!1){d=c.toCIMSymbolJSON(d);z&&0!==m&&(m=360-m);if("CIMTextSymbol"===d.type)d.angle=m;else if("CIMPointSymbol"===d.type&&d.symbolLayers){z=m-(d.angle||0);for(const v of d.symbolLayers)if(c.isCIMMarker(v)){let q=v.rotation||0;q=v.rotateClockwise?q-z:q+z;v.rotation=q}d.angle=m}};a.getCIMSymbolColor=function(d){d=c.toCIMSymbolJSON(d);const m=[];l(d,m);return m.length?
new b(c.fromCIMColor(m[0])):null};a.getCIMSymbolRotation=function(d,m=!1){d=c.toCIMSymbolJSON(d);return"CIMTextSymbol"===d.type||"CIMPointSymbol"===d.type?m&&0!==d.angle?360-d.angle:d.angle||0:0};a.getCIMSymbolSize=g;a.scaleCIMMarker=w;a.scaleCIMSymbolTo=function(d,m,z){const v=c.toCIMSymbolJSON(d);d=g(d);if(0===d)if("CIMTextSymbol"===v.type)v.height=m;else{if(v.symbolLayers)for(const q of v.symbolLayers)switch(q.type){case "CIMPictureMarker":case "CIMVectorMarker":q.size=m;break;case "CIMPictureStroke":case "CIMSolidStroke":q.width=
m}}else h(v,m/d,!1,z)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/symbols/cim/utils":function(){define(["require","exports"],function(a,b){function c(g,h){"string"!==typeof g&&(g=String(g));switch(h){case "LowerCase":return g.toLowerCase();case "Allcaps":return g.toUpperCase();default:return g}}b._adjustTextCase=c;b.colorToArray=function(g){return[g.r,g.g,g.b,g.a]};b.createLabelOverrideFunction=function(g,h,w){const n=e=>{let d=e.length;for(;d--;)if(-1===" /-,\n".indexOf(e.charAt(d)))return!1;
return!0},f=[];var l=0;let k=-1;do k=h.indexOf("[",l),k>=l&&(k>l&&(l=h.substr(l,k-l),f.push([l,null,n(l)])),l=k+1,k=h.indexOf("]",l),k>=l&&(k>l&&(l=h.substr(l,k-l),(l=g[l])&&f.push([null,l,!1])),l=k+1));while(-1!==k);l<h.length-1&&(g=h.substr(l),f.push([g,null,n(g)]));return e=>{let d="",m=null;for(const z of f){const [v,q,t]=z;if(v)t?m=v:(m&&(d+=m,m=null),d+=v);else{const r=e.attributes[q];r&&(m&&(d+=m,m=null),d+=r)}}return c(d,w)}};b.evaluateValueOrFunction=function(g,h,w,n){return"function"===
typeof g?g(h,w,n):g};b.fromCIMColor=function(g){return g?{r:g[0],g:g[1],b:g[2],a:g[3]/255}:{r:0,g:0,b:0,a:0}};b.getValue=g=>isNaN(g)||!g?0:g;b.importGeometryEngine=function(){return new Promise((g,h)=>a(["../../geometry/geometryEngineJSON"],g,h))};b.isCIMFill=function(g){return"CIMGradientFill"===g.type||"CIMHatchFill"===g.type||"CIMPictureFill"===g.type||"CIMSolidFill"===g.type||"CIMWaterFill"===g.type};b.isCIMMarker=function(g){return"CIMVectorMarker"===g.type||"CIMPictureMarker"===g.type||"CIMBarChartMarker"===
g.type||"CIMCharacterMarker"===g.type||"CIMPieChartMarker"===g.type||"CIMStackedBarChartMarker"===g.type};b.isCIMMarkerStrokePlacement=function(g){return"CIMMarkerPlacementAlongLineRandomSize"===g.type||"CIMMarkerPlacementAlongLineSameSize"===g.type||"CIMMarkerPlacementAlongLineVariableSize"===g.type||"CIMMarkerPlacementAtExtremities"===g.type||"CIMMarkerPlacementAtMeasuredUnits"===g.type||"CIMMarkerPlacementAtRatioPositions"===g.type||"CIMMarkerPlacementOnLine"===g.type||"CIMMarkerPlacementOnVertices"===
g.type};b.isCIMStroke=function(g){return"CIMGradientStroke"===g.type||"CIMPictureStroke"===g.type||"CIMSolidStroke"===g.type};b.isGeometryEngineRequired=g=>{if(!g)return!1;for(const h of g)switch(h.type){case "CIMGeometricEffectBuffer":case "CIMGeometricEffectOffset":return!0}return!1};b.resampleHermite=function(g,h,w,n,f,l,k=!0){const e=h/f;w/=l;const d=Math.ceil(e/2),m=Math.ceil(w/2);for(let q=0;q<l;q++)for(let t=0;t<f;t++){const r=4*(t+(k?l-q-1:q)*f);var z=0;let x=0,u=0,E=0,y=0,A=0,p=0;const B=
(q+.5)*w;for(let D=Math.floor(q*w);D<(q+1)*w;D++){var v=Math.abs(B-(D+.5))/m;const C=(t+.5)*e;v*=v;for(let F=Math.floor(t*e);F<(t+1)*e;F++){let G=Math.abs(C-(F+.5))/d;z=Math.sqrt(v+G*G);-1<=z&&1>=z&&(z=2*z*z*z-3*z*z+1,0<z&&(G=4*(F+D*h),p+=z*g[G+3],u+=z,255>g[G+3]&&(z=z*g[G+3]/250),E+=z*g[G],y+=z*g[G+1],A+=z*g[G+2],x+=z))}}n[r]=E/x;n[r+1]=y/x;n[r+2]=A/x;n[r+3]=p/u}};b.toCIMSymbolJSON=function(g){var h;return null==(h=g.data)?void 0:h.symbol};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/support/layerViewUtils":function(){define(["exports",
"../../core/maybe"],function(a,b){a.extractSafeScaleBounds=function(c){var g,h;const w=c.effectiveScaleRange;c=null!=(g=null==w?void 0:w.minScale)?g:0;g=null!=(h=null==w?void 0:w.maxScale)?h:0;return{minScale:c,maxScale:g}};a.highlightsSupported=function(c){return c&&"function"===typeof c.highlight};a.isScaleRangeActive=function(c,g){return 0<c||0<g};a.occludeesSupported=function(c){return c&&"function"===typeof c.maskOccludee};a.scaleBoundsPredicate=function(c,g,h){return b.isNone(c)||c>h&&(0===
g||c<g)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Popup/actions":function(){define(["exports","../../support/actions/ActionButton"],function(a,b){const c=new b({id:"zoom-to-feature",title:"{messages.zoom}",className:"esri-icon-zoom-in-magnifying-glass"}),g=new b({id:"remove-selected-feature",title:"{messages.remove}",className:"esri-icon-trash"}),h=new b({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:"esri-icon-zoom-in-magnifying-glass"});b=new b({id:"browse-clustered-features",
title:"{messages.browseClusteredFeatures}",className:"esri-icon-table"});a.all=[c,g,b,h];a.browseClusteredFeatures=b;a.removeSelectedFeature=g;a.zoomToClusteredFeatures=h;a.zoomToFeature=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/Popup/actionUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/Error ../../core/Logger ../../core/promiseUtils ./actions".split(" "),function(a,b,c,g,h,w){function n(q){const {selectedFeature:t,location:r,view:x}=
q;return x?"3d"===x.type?t||r:q.get("selectedFeature.geometry")||r:null}function f(q,t){if("3d"!==(null==t?void 0:t.type)||!q||"esri.Graphic"!==q.declaredClass)return!0;if((t=t.getViewForGraphic(q))&&"whenGraphicBounds"in t){let r=!1;t.whenGraphicBounds(q,{useViewElevation:!0}).then(x=>{r=!x||!x.boundingBox||x.boundingBox[0]===x.boundingBox[3]&&x.boundingBox[1]===x.boundingBox[4]&&x.boundingBox[2]===x.boundingBox[5]}).catch(()=>{const x=new c("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",
{graphic:q});v.error(x)});return r}return!0}function l(q){return k.apply(this,arguments)}function k(){k=b._asyncToGenerator(function*(q){const {location:t,selectedFeature:r,view:x,zoomFactor:u}=q,E=n(q);if(!E)return q=new c("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:E,view:x}),v.error(q),Promise.reject(q);const y=x.scale/u,A=q.get("selectedFeature.geometry")||t,p=A&&"point"===A.type&&f(r,x);w.zoomToFeature.active=!0;w.zoomToFeature.disabled=!0;try{yield q.view.goTo({target:E,
scale:p?y:void 0})}finally{w.zoomToFeature.active=!1,w.zoomToFeature.disabled=!1,q.zoomToLocation=null,p&&(q.location=A)}});return k.apply(this,arguments)}function e(q){return d.apply(this,arguments)}function d(){d=b._asyncToGenerator(function*(q){const {selectedFeature:t,view:r}=q;if("2d"!==(null==r?void 0:r.type))throw q=new c("zoomToCluster:invalid-view","View must be 2d MapView.",{view:r}),v.error(q),q;if(!t.isAggregate)throw q=new c("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",
{selectedFeature:t}),v.error(q),q;q=yield r.whenLayerView(t.sourceLayer);const x=q.createQuery();x.aggregateIds=[t.getObjectId()];w.zoomToClusteredFeatures.active=!0;w.zoomToClusteredFeatures.disabled=!0;({extent:q}=yield q.queryExtent(x));yield r.goTo({target:q});w.zoomToClusteredFeatures.active=!1;w.zoomToClusteredFeatures.disabled=!1});return d.apply(this,arguments)}function m(){m=b._asyncToGenerator(function*(q){const {selectedFeature:t,view:r}=q;if("2d"!==(null==r?void 0:r.type))throw q=new c("displayClusterExtent:invalid-view",
"View must be 2d MapView.",{view:r}),v.error(q),q;if(!t.isAggregate)throw q=new c("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t}),v.error(q),q;var x=yield r.whenLayerView(t.sourceLayer);const u=x.createQuery();u.aggregateIds=[t.getObjectId()];({extent:x}=yield x.queryExtent(u));q.selectedClusterBoundaryFeature.geometry=x;r.graphics.add(q.selectedClusterBoundaryFeature)});return m.apply(this,arguments)}function z(){z=b._asyncToGenerator(function*(q){const {selectedFeature:t,
view:r}=q;if("2d"!==(null==r?void 0:r.type))throw q=new c("browseAggregateFeatures:invalid-view","View must be 2d MapView.",{view:r}),v.error(q),q;if(!t.isAggregate)throw q=new c("browseAggregateFeatures:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t}),v.error(q),q;q=yield r.whenLayerView(t.sourceLayer);const x=q.createQuery();x.aggregateIds=[t.getObjectId()];w.browseClusteredFeatures.active=!0;w.browseClusteredFeatures.disabled=!0;({features:q}=
yield q.queryFeatures(x));w.browseClusteredFeatures.active=!1;w.browseClusteredFeatures.disabled=!1;r.popup.open({features:[t].concat(q),featureMenuOpen:!0})});return z.apply(this,arguments)}const v=g.getLogger("esri.widgets.Popup.PopupViewModel");a.browseAggregateFeatures=function(q){return z.apply(this,arguments)};a.displayClusterExtent=function(q){return m.apply(this,arguments)};a.getSelectedTarget=n;a.isZoomScreenSize=f;a.removeClusteredFeaturesForBrowsing=function(q){var t;null!=(t=q.selectedFeature)&&
t.isAggregate&&(q.features=q.features.filter(r=>r.isAggregate))};a.triggerAction=function(q){const {event:t,view:r}=q;({action:q}=t);var x=r&&r.popup;if(!q)return Promise.reject(new c("trigger-action:missing-arguments","Event has no action"));if(!x)return Promise.reject(new c("trigger-action:missing-arguments","view.popup is missing"));const {disabled:u,id:E}=q;if(!E)return Promise.reject(new c("trigger-action:invalid-action","action.id is missing"));if(u)return Promise.reject(new c("trigger-action:invalid-action",
"Action is disabled"));if(E===w.zoomToFeature.id)return l(x.viewModel).catch(h.throwIfNotAbortError);if(E===w.zoomToClusteredFeatures.id)return e(x.viewModel);if(E===w.browseClusteredFeatures.id)return x.featureMenuOpen=!x.featureMenuOpen,x.viewModel.browseClusterEnabled=!x.viewModel.browseClusterEnabled,Promise.resolve();x.viewModel.browseClusterEnabled=!1;if(E===w.removeSelectedFeature.id){x.close();({selectedFeature:q}=x);if(!q)return Promise.reject(new c(`trigger-action:${w.removeSelectedFeature.id}`,
"selectedFeature is required",{selectedFeature:q}));({sourceLayer:x}=q);x?x.remove(q):r.graphics.remove(q)}return Promise.resolve()};a.zoomToClusterExtent=e;a.zoomToLocation=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/widgets/support/GoTo":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,g,h,w,n,f){a.GoToMixin=l=>{l=function(k){function e(...d){d=k.call(this,...d)||this;d.goToOverride=null;d.view=null;return d}b._inheritsLoose(e,k);e.prototype.callGoTo=function(d){const {view:m}=this;return this.goToOverride?this.goToOverride(m,d):m.goTo(d.target,d.options)};return e}(l);c.__decorate([g.property()],l.prototype,"goToOverride",void 0);c.__decorate([g.property()],l.prototype,"view",void 0);return l=c.__decorate([f.subclass("esri.widgets.support.GoTo")],l)};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/GroundView":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Accessor ../core/Collection ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./support/GroundViewElevationSampler".split(" "),function(a,b,c,g,h,w,n,f,l,k,e,d){c=function(m){function z(q){q=m.call(this,q)||this;q.handles=new h;
q.view=null;q.layerViews=new g;return q}a._inheritsLoose(z,m);var v=z.prototype;v.initialize=function(){this.handles.add(w.when(this,"view.map.ground",q=>q.load()));this.handles.add(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))};v.destroy=function(){this._set("view",null);this.handles&&(this.handles.destroy(),this.handles=null)};v._layerViewsAfterChangesHandler=function(){this.handles.remove("updating");this.handles.add(this.layerViews.map(q=>q.watch("updating",()=>
this._updateUpdating(),!0)).toArray(),"updating");this._updateUpdating()};v._updateUpdating=function(){this.notifyChange("updating")};a._createClass(z,[{key:"elevationSampler",get:function(){return this.view&&"2d"!==this.view.type&&this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new d({view:this.view}):null}},{key:"updating",get:function(){return this.suspended?!1:this.layerViews.some(q=>q.updating)}},{key:"suspended",get:function(){return!this.view||this.view.suspended}}]);
return z}(c);b.__decorate([n.property({readOnly:!0})],c.prototype,"elevationSampler",null);b.__decorate([n.property({type:Boolean,readOnly:!0})],c.prototype,"updating",null);b.__decorate([n.property({constructOnly:!0})],c.prototype,"view",void 0);b.__decorate([n.property({type:g,readOnly:!0})],c.prototype,"layerViews",void 0);b.__decorate([n.property({readOnly:!0})],c.prototype,"suspended",null);return c=b.__decorate([e.subclass("esri.views.GroundView")],c)})},"esri/views/support/GroundViewElevationSampler":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Evented ../../core/Logger ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../geometry/support/webMercatorUtils ../../layers/support/ElevationSampler ../3d/support/ElevationProvider ../3d/terrain/TerrainConst".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q){const t=g.getLogger("esri.views.support.GroundViewElevationSampler");c=function(r){function x(E){E=r.call(this,E)||this;E.demResolution={min:-1,max:-1};E.noDataValue=q.ELEVATION_NODATA_VALUE;return E}a._inheritsLoose(x,r);var u=x.prototype;u.initialize=function(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))};u.elevationAt=function(E){var y=E.spatialReference;const A=this.spatialReference;return m.canProject(y,A)?h.isNone(this.extent)||
!d.extentContainsPoint(this.extent,E)?(y=h.isSome(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null,t.warn("#elevationAt()",`Point used to sample elevation (${E.x}, ${E.y}) is outside of the sampler extent (${y})`),this.noDataValue):v.getElevationAtPoint(this.view.elevationProvider,E):(t.error(`Cannot sample elevation at a location with spatial reference (${y?y.wkid:"unknown"}) different from the view (${A.wkid})`),null)};u.queryElevation=function(E){return z.updateGeometryElevation(E.clone(),
this)};a._createClass(x,[{key:"extent",get:function(){const E=this.view.basemapTerrain;return h.isSome(E.extent)&&E.spatialReference?e.toExtent(E.extent,E.spatialReference):null}}]);return x}(c.EventedAccessor);b.__decorate([w.property({readOnly:!0})],c.prototype,"demResolution",void 0);b.__decorate([w.property({readOnly:!0})],c.prototype,"extent",null);b.__decorate([w.property({readOnly:!0})],c.prototype,"noDataValue",void 0);b.__decorate([w.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],
c.prototype,"spatialReference",void 0);b.__decorate([w.property({constructOnly:!0})],c.prototype,"view",void 0);return c=b.__decorate([k.subclass("esri.views.support.GroundViewElevationSampler")],c)})},"esri/layers/support/ElevationSampler":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../geometry ../../core/has ../../core/Logger ../../core/maybe ../../core/unitUtils ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../geometry/support/webMercatorUtils ../../geometry/Point".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){function d(r,x){const u=m(r,x.spatialReference);if(!u)return null;switch(r.type){case "point":r.z=w.unwrapOr(x.elevationAt(u),0);break;case "polyline":q.spatialReference=u.spatialReference;var E=r.hasM&&!r.hasZ;for(var y=0;y<r.paths.length;y++){var A=r.paths[y],p=u.paths[y];for(let B=0;B<A.length;B++){const D=A[B],C=p[B];q.x=C[0];q.y=C[1];E&&(D[3]=D[2]);D[2]=w.unwrapOr(x.elevationAt(q),0)}}r.hasZ=!0;break;case "multipoint":q.spatialReference=u.spatialReference;E=r.hasM&&
!r.hasZ;for(y=0;y<r.points.length;y++)A=r.points[y],p=u.points[y],q.x=p[0],q.y=p[1],E&&(A[3]=A[2]),A[2]=w.unwrapOr(x.elevationAt(q),0);r.hasZ=!0}return r}function m(r,x){if(w.isNone(r))return null;const u=r.spatialReference;if(u.equals(x))return r;(r=k.project(r,x))||z.error(`Cannot project geometry spatial reference (wkid:${u.wkid}) to elevation sampler spatial reference (wkid:${x.wkid})`);return r}const z=h.getLogger("esri.layers.support.ElevationSampler");c=function(){function r(){}var x=r.prototype;
x.queryElevation=function(u){return d(u.clone(),this)};x.on=function(){return t};x.projectIfRequired=function(u,E){return m(u,E)};return r}();let v=function(r){function x(E,y,A){var p=r.call(this)||this;p.tile=E;p.noDataValue=A;p.extent=f.toExtent(E.tile.extent,y.spatialReference);A=n.getMetersPerUnitForSR(y.spatialReference);E=y.lodAt(E.tile.level).resolution*A;p.demResolution={min:E,max:E};return p}b._inheritsLoose(x,r);var u=x.prototype;u.contains=function(E){E=this.projectIfRequired(E,this.spatialReference);
return l.extentContainsPoint(this.extent,E)};u.elevationAt=function(E){var y=this.projectIfRequired(E,this.spatialReference);return w.isNone(y)?null:this.contains(E)?this.tile.sample(y.x,y.y):(y=this.extent,z.warn("#elevationAt()",`Point used to sample elevation (${E.x}, ${E.y}) is outside of the sampler extent (${`${y.xmin}, ${y.ymin}, ${y.xmax}, ${y.ymax}`})`),this.noDataValue)};b._createClass(x,[{key:"spatialReference",get:function(){return this.extent.spatialReference}}]);return x}(c);g=function(r){function x(u,
E,y){var A=r.call(this)||this;let p;"number"===typeof E?(A.noDataValue=E,p=null):(p=E,A.noDataValue=y);A.samplers=p?u.map(B=>new v(B,p,A.noDataValue)):u;if(u=A.samplers[0]){A.extent=u.extent.clone();const {min:B,max:D}=u.demResolution;A.demResolution={min:B,max:D};for(u=1;u<A.samplers.length;u++)E=A.samplers[u],A.extent.union(E.extent),A.demResolution.min=Math.min(A.demResolution.min,E.demResolution.min),A.demResolution.max=Math.max(A.demResolution.max,E.demResolution.max)}else A.extent=f.toExtent(f.create(),
p.spatialReference),A.demResolution={min:0,max:0};return A}b._inheritsLoose(x,r);x.prototype.elevationAt=function(u){const E=this.projectIfRequired(u,this.spatialReference);if(!E)return null;for(const y of this.samplers)if(y.contains(E))return y.elevationAt(E);z.warn("#elevationAt()",`Point used to sample elevation (${u.x}, ${u.y}) is outside of the sampler`);return this.noDataValue};b._createClass(x,[{key:"spatialReference",get:function(){return this.extent.spatialReference}}]);return x}(c);const q=
new e,t={remove(){}};a.ElevationSamplerBase=c;a.MultiTileElevationSampler=g;a.TileElevationSampler=v;a.updateGeometryElevation=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/ElevationProvider":function(){define(["exports","../../../core/maybe","../../../layers/graphics/dehydratedFeatureUtils"],function(a,b,c){function g(h){return"array"in h}a.SamplePosition=function(h,w=null,n=0){this.array=h;this.spatialReference=w;this.offset=n};a.getElevationAtPoint=function(h,w,n=
"ground"){if(c.isDehydratedPoint(w))return h.getElevation(w.x,w.y,w.z||0,w.spatialReference,n);if(g(w)){let f=w.offset;return h.getElevation(w.array[f++],w.array[f++],w.array[f]||0,b.unwrapOr(w.spatialReference,h.spatialReference),n)}return h.getElevation(w[0],w[1],w[2]||0,h.spatialReference,n)};a.isSamplePosition=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/dehydratedFeatureUtils":function(){define(["exports"],function(a){a.isDehydratedPoint=function(b){return"point"===
b.type};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TerrainConst":function(){define(["exports","../../../core/mathUtils","../../../geometry/support/aaBoundingRect","./TilingScheme"],function(a,b,c,g){b=b.clampFloat32(b.NUMBER_MAX_FLOAT32/10);const h=c.create();g.default.WebMercatorAuxiliarySphere.getExtent(0,0,0,h);c=c.create([-180,-90,180,90]);a.DEFAULT_TILE_BACKGROUND="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2JJREFUeNrs3d1O20AQgFFvRJInQLQBhHj/h0JVW34El1yQ2F73DVq3jTys55zrqUBbPrErZUSZ+vcOsto4AjK76Lqu1vr8+G3mPzjc3D/+eJj/Bcz/cd75R80fbu79BsAVCAQAAgABgABAACAAEAAIAAQAAgABQPOKfQAy83Ho+HnnHzXv49B4A4AAQAAgABAACAAEAAIAAYAAQAAgABAANM4+AKnZB4ifd/5R8/YB8AYAAYAAQAAgABAACAAEAAIAAYAAQAAgAGicfQBSsw8QP+/8o+btA+ANAAIAAYAAQAAgABAACAAEAAIAAYAAQADQOPsApGYfIH7e+UfN2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAXA201QdggAggH0AUrMPED8/jsPL03fns/y8fQC8AUAAIAAQAAgABAACAAGAAEAAIAAQAAgAGmcfgNTsA8TP2weImrcPgDcACAAEAAIAAYAAQAAgABAACAAEAAIAAUDj7AOQmn2A+Hn7AFHz9gHwBgABgABAACAAEAAIAAQAAgABgABgNS4cAf9pu9u3O1+m/n2aplKK/0j+TX86/tVP5+eZ3+729gFIfwWyDxA7bx8gat4+ANkJAAGAAEAAIAAQAAgABAACAAGAAEAAIABonn0AUrMPED9vHyBq3j4A3gAgABAACAAEAAIAAYAAQAAgABAA51VrdQgCAAHAsuwDkJp9gPj5vj+9vvx0PsvP2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAYAAoHH2AUjNPkD8vH2AqHn7AHgDgABAACAAEAAIAAQAAgABgABAACAAEAA0zj4AqdkHiJ+3DxA1bx8AbwAQACQ0DL0AyKuOowBwBYKUSikCIHUBAsAVCAQAAgABgABAALBy9gFIzT5A/Lx9gKj5y6trVyC8AUAAIAAQAAgAVq90Pg5N5gA2AsAVCAQAAgABgABAALB29gFIzT5A/Lx9gKj5q6+3rkB4A4AAQAAgABAACADWzB/IIHsCAsAVCARAlKlWhyAAEAAIABZjH4DU7APEz5+OH2+vT85n+fkvhztXILwBQAAgABAACAAEAGtWigBIHcBGALgCgQBAACAAyPMO9nHosxuHodZx5vB2t691HIdh/nx/Os7/Zsz/fvgXAAAA//8DAF1P1hM2ICMfAAAAAElFTkSuQmCC";
a.ELEVATION_DESIRED_MAX_UPSCALING_DISTANCE=4;a.ELEVATION_NODATA_VALUE=b;a.GEOGRAPHIC_WORLD_EXTENT=c;a.GEOMETRY_VERTEX_STRIDE=5;a.MAX_MEMORY_LOD_BIAS=2.5;a.MAX_PATCH_TESSELATION=512;a.MAX_ROOT_TILES=64;a.PROGRESSIVE_LOADING_MODULO=4;a.TILE_LOADING_DEBUGLOG=!1;a.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR="Cannot extend surface to encompass all layers because it would result in too many root tiles.";a.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR="Surface extent is too large for tile resolution at level 0.";a.WEBMERCATOR_WORLD_EXTENT=
h;a.getElevationDesiredResolutionLevel=w=>4>w?3:4;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TilingScheme":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../geometry/Extent ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils ../../../layers/support/TileInfo".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m){function z(){return new c("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}let v=function(){function t(x){var u=t.checkUnsupported(x);if(h.isSome(u))throw u;x=h.unwrap(x);this.spatialReference=x.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;this._isGCS=f.canProjectToWGS84ComparableLonLat(this.spatialReference)||e.isMars(this.spatialReference)||e.isMoon(this.spatialReference);this.origin=[x.origin.x,x.origin.y];
this.pixelSize=x.size[0];this.dpi=x.dpi;var E=x.lods.reduce(function(p,B,D){B.level<p.min&&(p.min=B.level,p.minIndex=D);p.max=Math.max(p.max,B.level);return p},{min:Infinity,minIndex:0,max:-Infinity}),y=x.lods[E.minIndex];const A=2**y.level;u=y.resolution*A;y=y.scale*A;this.levels=Array(E.max+1);for(E=0;E<this.levels.length;E++)this.levels[E]={resolution:u,scale:y,tileSize:[u*x.size[0],u*x.size[1]]},u/=2,y/=2}var r=t.prototype;r.clone=function(){return new t(this.toTileInfo())};r.toTileInfo=function(){return new m({dpi:this.dpi,
origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((x,u)=>({level:u,scale:x.scale,resolution:x.resolution}))})};r.getExtent=function(x,u,E,y){var A=this.levels[x];x=A.tileSize[0];A=A.tileSize[1];y[0]=this.origin[0]+E*x;y[2]=y[0]+x;y[3]=this.origin[1]-u*A;y[1]=y[3]-A};r.convertExtentToRadians=function(x,u){this._isWebMercator?(u[0]=d.x2lon(x[0]),u[1]=d.y2lat(x[1]),u[2]=d.x2lon(x[2]),
u[3]=d.y2lat(x[3])):this._isGCS&&(u[0]=g.deg2rad(x[0]),u[1]=g.deg2rad(x[1]),u[2]=g.deg2rad(x[2]),u[3]=g.deg2rad(x[3]))};r.getExtentGeometry=function(x,u,E,y=new n){this.getExtent(x,u,E,q);y.spatialReference=this.spatialReference;y.xmin=q[0];y.ymin=q[1];y.xmax=q[2];y.ymax=q[3];y.zmin=void 0;y.zmax=void 0;return y};r.ensureMaxLod=function(x){if(null==x)return!1;for(var u=!1;this.levels.length<=x;){u=this.levels[this.levels.length-1];const E=u.resolution/2;this.levels.push({resolution:E,scale:u.scale/
2,tileSize:[E*this.pixelSize,E*this.pixelSize]});u=!0}return u};r.capMaxLod=function(x){this.levels.length>x+1&&(this.levels.length=x+1)};r.getMaxLod=function(){return this.levels.length-1};r.scaleAtLevel=function(x){return this.levels[0].scale/2**x};r.levelAtScale=function(x){const u=this.levels[0].scale;return x>=u?0:Math.log(u/x)*Math.LOG2E};r.resolutionAtLevel=function(x){return this.levels[0].resolution/2**x};r.compatibleWith=function(x){if(!(x instanceof t)){if(t.checkUnsupported(x))return!1;
x=new t(x)}if(!x.spatialReference.equals(this.spatialReference)||x.pixelSize!==this.pixelSize)return!1;const u=Math.min(this.levels.length,x.levels.length)-1,E=this.levels[u].resolution;let y=.5*E;if(!g.floatEqualAbsolute(x.origin[0],this.origin[0],y)||!g.floatEqualAbsolute(x.origin[1],this.origin[1],y))return!1;y=.5*E/2**u/this.pixelSize*12;return g.floatEqualAbsolute(E,x.levels[u].resolution,y)};r.rootTilesInExtent=function(x,u=null,E=Infinity){const y=[],A=this.levels[0].tileSize;if(h.isNone(x)||
0===A[0]||0===A[1])return y;t.computeRowColExtent(x,A,this.origin,q);x=q[1];let p=q[3],B=q[0],D=q[2];var C=D-B;const F=p-x;C*F>E&&(E=Math.floor(Math.sqrt(E)),F>E&&(x=x+Math.floor(.5*F)-Math.floor(.5*E),p=x+E),C>E&&(B=B+Math.floor(.5*C)-Math.floor(.5*E),D=B+E));for(E=x;E<p;E++)for(C=B;C<D;C++)y.push([0,E,C]);h.isSome(u)&&(u[0]=this.origin[0]+B*A[0],u[1]=this.origin[1]-p*A[1],u[2]=this.origin[0]+D*A[0],u[3]=this.origin[1]-x*A[1]);return y};t.computeRowColExtent=function(x,u,E,y){const A=.001*(x[2]-
x[0]+(x[3]-x[1]));y[0]=Math.max(0,Math.floor((x[0]+A-E[0])/u[0]));y[2]=Math.max(0,Math.ceil((x[2]-A-E[0])/u[0]));y[1]=Math.max(0,Math.floor((E[1]-x[3]+A)/u[1]));y[3]=Math.max(0,Math.ceil((E[1]-x[1]-A)/u[1]))};t.isPowerOfTwo=function(x){x=x.lods;const u=x[0].resolution*2**x[0].level;return!x.some(function(E){return!g.floatEqualRelative(E.resolution,u/2**E.level)})};t.hasGapInLevels=function(x){x=x.lods.map(function(u){return u.level});x.sort(function(u,E){return u-E});for(let u=1;u<x.length;u++)if(x[u]!==
x[0]+u)return!0;return!1};t.tileSizeSupported=function(x){const u=x.size[1];return u===x.size[0]&&0===(u&u-1)&&128<=u&&512>=u};t.hasOriginPerLODs=function(x){const u=x.origin;return x.lods.some(E=>null!=E.origin&&(E.origin[0]!==u.x||E.origin[1]!==u.y))};t.getMissingTileInfoError=function(){return new c("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")};t.checkUnsupported=function(x){return h.isNone(x)?z():1>x.lods.length?new c("tilingscheme:generic","Tiling scheme must have at least one level"):
t.isPowerOfTwo(x)?t.hasGapInLevels(x)?new c("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):t.tileSizeSupported(x)?t.hasOriginPerLODs(x)?new c("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new c("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new c("tilingscheme:power-of-two","Tiling scheme must be power of two")};t.fromExtent=function(x,u){const E=x[2]-x[0],y=x[3]-x[1],A=
w.getMetersPerUnitForSR(u),p=1.2*Math.max(E,y);x=new t(new m({size:[256,256],origin:{x:x[0]-.5*(p-E),y:x[3]+.5*(p-y)},lods:[{level:0,resolution:p/256,scale:1/(256/96*.0254/(p*A))}],spatialReference:u}));x.ensureMaxLod(20);return x};t.makeWebMercatorAuxiliarySphere=function(x){const u=new t(t.WebMercatorAuxiliarySphereTileInfo);u.ensureMaxLod(x);return u};t.makeGCSWithTileSize=function(x,u=256,E=16){const y=256/u;x=new t(new m({size:[u,u],origin:{x:-180,y:90,spatialReference:x},spatialReference:x,
lods:[{level:0,resolution:.703125*y,scale:2.95497598570834E8*y}]}));x.ensureMaxLod(E);return x};b._createClass(t,[{key:"test",get:function(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}]);return t}();v.WebMercatorAuxiliarySphereTileInfo=new m({size:[256,256],origin:{x:-2.0037508342787E7,y:2.0037508342787E7,spatialReference:l.WebMercator},spatialReference:l.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:5.91657527591555E8}]});v.WebMercatorAuxiliarySphere=v.makeWebMercatorAuxiliarySphere(19);
const q=k.create();a.default=v;a.getMissingTileInfoError=z;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/TileInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/maybe ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x){var u;c=new c.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});g=u=function(E){function y(p){p=E.call(this,p)||this;p.dpi=96;p.format=null;p.origin=null;p.minScale=0;p.maxScale=0;p.size=null;p.spatialReference=null;return p}a._inheritsLoose(y,E);y.create=function(p=
{}){const {resolutionFactor:B=1,scales:D,size:C=256,spatialReference:F=v.WebMercator,numLODs:G=24}=p;if(!t.isValid(F)){p=[];if(D)for(var L=0;L<D.length;L++){var H=D[L];p.push({level:L,scale:H,resolution:H})}else for(L=5E-4,H=G-1;0<=H;H--)p.unshift({level:H,scale:L,resolution:L}),L*=2;return new u({dpi:96,lods:p,origin:new z(0,0,F),size:[C,C],spatialReference:F})}L=t.getInfo(F);p=p.origin?new z({x:p.origin.x,y:p.origin.y,spatialReference:F}):L?new z({x:L.origin[0],y:L.origin[1],spatialReference:F}):
new z({x:0,y:0,spatialReference:F});L=1/(39.37*w.getMetersPerUnitForSR(F)*96);H=[];if(D)for(var M=0;M<D.length;M++){var K=D[M];H.push({level:M,scale:K,resolution:K*L})}else{var I=t.isGeographic(F)?512/C*5.916575275917094E8:256/C*5.91657527591555E8;M=Math.ceil(G/B);H.push({level:0,scale:I,resolution:I*L});for(K=1;K<M;K++)I/=2**B,H.push({level:K,scale:I,resolution:I*L})}return new u({dpi:96,lods:H,origin:p,size:[C,C],spatialReference:F})};var A=y.prototype;A.readOrigin=function(p,B){return z.fromJSON({spatialReference:B.spatialReference,
...p})};A.readSize=function(p,B){return[B.cols,B.rows]};A.writeSize=function(p,B){B.cols=p[0];B.rows=p[1]};A.zoomToScale=function(p){const B=this.scales;if(0>=p)return B[0];if(p>=B.length-1)return B[B.length-1];{const D=Math.floor(p);return B[D]/(B[D]/B[D+1])**(p-D)}};A.scaleToZoom=function(p){const B=this.scales,D=B.length-1;let C=0;for(;C<D;C++){const F=B[C],G=B[C+1];if(F<=p)break;if(G===p)return C+1;if(F>p&&G<p)return C+Math.log(F/p)/Math.log(F/G)}return C};A.snapScale=function(p,B=.95){p=this.scaleToZoom(p);
return p%Math.floor(p)>=B?this.zoomToScale(Math.ceil(p)):this.zoomToScale(Math.floor(p))};A.tileAt=function(p,B,D,C){var F=this.lodAt(p);if(!F)return null;let G;if("number"===typeof B)G=B,B=D;else{if(t.equals(B.spatialReference,this.spatialReference))G=B.x,B=B.y;else{C=r.project(B,this.spatialReference);if(h.isNone(C))return null;G=C.x;B=C.y}C=D}D=F.resolution*this.size[0];F=F.resolution*this.size[1];C||(C={id:null,level:0,row:0,col:0,extent:q.create()});C.level=p;C.row=Math.floor((this.origin.y-
B)/F+.001);C.col=Math.floor((G-this.origin.x)/D+.001);this.updateTileInfo(C);return C};A.updateTileInfo=function(p,B=u.ExtrapolateOptions.NONE){var D=this.lodAt(p.level);D||B!==u.ExtrapolateOptions.POWER_OF_TWO||(B=this.lods[this.lods.length-1],B.level<p.level&&(D=B));if(D){var C=p.level-D.level;B=D.resolution*this.size[0]/2**C;D=D.resolution*this.size[1]/2**C;p.id=`${p.level}/${p.row}/${p.col}`;p.extent||(p.extent=q.create());p.extent[0]=this.origin.x+p.col*B;p.extent[1]=this.origin.y-(p.row+1)*
D;p.extent[2]=p.extent[0]+B;p.extent[3]=p.extent[1]+D}};A.upsampleTile=function(p){const B=this._upsampleLevels[p.level];if(!B||-1===B.parentLevel)return!1;p.level=B.parentLevel;p.row=Math.floor(p.row/B.factor+.001);p.col=Math.floor(p.col/B.factor+.001);this.updateTileInfo(p);return!0};A.getTileBounds=function(p,B){var {resolution:D}=this.lodAt(B.level);const C=D*this.size[0];D*=this.size[1];p[0]=this.origin.x+B.col*C;p[1]=this.origin.y-(B.row+1)*D;p[2]=p[0]+C;p[3]=p[1]+D;return p};A.lodAt=function(p){return this._levelToLOD&&
this._levelToLOD[p]||null};A.clone=function(){return u.fromJSON(this.write({}))};A.getOrCreateCompatible=function(p,B){if(256===this.size[0]&&256===this.size[1])return 256===p?this:null;const D=[],C=this.lods.length;for(let F=0;F<C;F++){const G=this.lods[F];D.push(new x({level:G.level,scale:G.scale,resolution:G.resolution*B}))}return new u({size:[p,p],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:D})};A._initializeUpsampleLevels=
function(){const p=this.lods;this._upsampleLevels=[];let B=null;for(let D=0;D<p.length;D++){const C=p[D];this._upsampleLevels[C.level]={parentLevel:B?B.level:-1,factor:B?B.resolution/C.resolution:0};B=C}};a._createClass(y,[{key:"isWrappable",get:function(){const {spatialReference:p,origin:B}=this;if(p&&B){const D=t.getInfo(p);return p.isWrappable&&Math.abs(D.origin[0]-B.x)<=D.dx}return!1}},{key:"lods",set:function(p){let B=0,D=0;const C=[];this._levelToLOD={};p&&(B=-Infinity,D=Infinity,p.forEach(F=>
{C.push(F.scale);B=F.scale>B?F.scale:B;D=F.scale<D?F.scale:D;this._levelToLOD[F.level]=F}));this._set("scales",C);this._set("minScale",B);this._set("maxScale",D);this._set("lods",p);this._initializeUpsampleLevels()}}]);return y}(g.JSONSupport);b.__decorate([n.property({type:Number,json:{write:!0}})],g.prototype,"compressionQuality",void 0);b.__decorate([n.property({type:Number,json:{write:!0}})],g.prototype,"dpi",void 0);b.__decorate([n.property({type:String,json:{read:c.read,write:c.write,origins:{"web-scene":{read:!1,
write:!1}}}})],g.prototype,"format",void 0);b.__decorate([n.property({readOnly:!0})],g.prototype,"isWrappable",null);b.__decorate([n.property({type:z,json:{write:!0}})],g.prototype,"origin",void 0);b.__decorate([e.reader("origin")],g.prototype,"readOrigin",null);b.__decorate([n.property({type:[x],value:null,json:{write:!0}})],g.prototype,"lods",null);b.__decorate([n.property({readOnly:!0})],g.prototype,"minScale",void 0);b.__decorate([n.property({readOnly:!0})],g.prototype,"maxScale",void 0);b.__decorate([n.property({readOnly:!0})],
g.prototype,"scales",void 0);b.__decorate([n.property({cast:E=>Array.isArray(E)?E:"number"===typeof E?[E,E]:[256,256]})],g.prototype,"size",void 0);b.__decorate([e.reader("size",["rows","cols"])],g.prototype,"readSize",null);b.__decorate([m.writer("size",{cols:{type:k.Integer},rows:{type:k.Integer}})],g.prototype,"writeSize",null);b.__decorate([n.property({type:v,json:{write:!0}})],g.prototype,"spatialReference",void 0);g=u=b.__decorate([d.subclass("esri.layers.support.TileInfo")],g);(function(E){E=
E.ExtrapolateOptions||(E.ExtrapolateOptions={});E[E.NONE=0]="NONE";E[E.POWER_OF_TWO=1]="POWER_OF_TWO"})(g||(g={}));return g})},"esri/layers/support/LOD":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,g,h,w,n,f){var l;c=l=function(k){function e(d){d=
k.call(this,d)||this;d.cols=null;d.level=0;d.levelValue=null;d.origin=null;d.resolution=0;d.rows=null;d.scale=0;return d}a._inheritsLoose(e,k);e.prototype.clone=function(){return new l({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})};return e}(c.JSONSupport);b.__decorate([g.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"cols",void 0);b.__decorate([g.property({type:n.Integer,
json:{write:!0}})],c.prototype,"level",void 0);b.__decorate([g.property({type:String,json:{write:!0}})],c.prototype,"levelValue",void 0);b.__decorate([g.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"origin",void 0);b.__decorate([g.property({type:Number,json:{write:!0}})],c.prototype,"resolution",void 0);b.__decorate([g.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,
"rows",void 0);b.__decorate([g.property({type:Number,json:{write:!0}})],c.prototype,"scale",void 0);return c=l=b.__decorate([f.subclass("esri.layers.support.LOD")],c)})},"esri/views/PopupView":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/maybe ../core/promiseUtils ../core/Logger ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/set ../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,g,h,w,n,f,
l,k,e){a.PopupView=d=>{d=function(m){function z(){return m.apply(this,arguments)||this}b._inheritsLoose(z,m);var v=z.prototype;v.fetchPopupFeatures=function(){var q=b._asyncToGenerator(function*(t,r){yield this.when();const {location:x,queryArea:u,layerViewsAndGraphics:E,clientOnlyGraphics:y}=yield this._prepareFetchPopupFeatures(t,r);t=Promise.resolve(y);r=this._queryLayerPopupFeatures(u,E,r);const A=r.map(p=>p.promise);t=h.eachAlwaysValues([t,...A]).then(p=>Array.from(new Set(p.flat())));return{location:x,
clientOnlyGraphics:y,allGraphicsPromise:t,promisesPerLayerView:r}});return function(t,r){return q.apply(this,arguments)}}();v._queryLayerPopupFeatures=function(q,t,r){return t.map(({layerView:x,graphics:u})=>{u={clientGraphics:u,event:g.isSome(r)?r.event:null,signal:g.isSome(r)?r.signal:null,defaultPopupTemplateEnabled:g.isSome(r)?!!r.defaultPopupTemplateEnabled:!1};u=x.fetchPopupFeatures(q,u);return{layerView:x,promise:u}})};v._isValidPopupGraphic=function(q,t){return q&&!!q.getEffectivePopupTemplate(g.isSome(t)&&
t.defaultPopupTemplateEnabled)};v._prepareFetchPopupFeatures=function(){var q=b._asyncToGenerator(function*(t,r){const {clientGraphics:x,queryArea:u,location:E}=yield this._popupHitTestGraphics(t,r);t=this._getFetchPopupLayerViews();const {layerViewsAndGraphics:y,clientOnlyGraphics:A}=this._graphicsPerFetchPopupLayerView(x,t);return{clientOnlyGraphics:A,layerViewsAndGraphics:y,queryArea:u,location:E}});return function(t,r){return q.apply(this,arguments)}}();v._popupHitTestGraphics=function(){var q=
b._asyncToGenerator(function*(t,r){const {results:x,mapPoint:u}=yield this.popupHitTest(t);t=x.filter(y=>this._isValidPopupGraphic(y.graphic,r));const E=t.length?t[0].mapPoint:null;return{clientGraphics:t.map(y=>y.graphic),queryArea:u,location:u||E}});return function(t,r){return q.apply(this,arguments)}}();v._getFetchPopupLayerViews=function(){const q=[];this.allLayerViews.forEach(t=>{this._isValidPopupLayerView(t)&&q.push(t)});g.isSome(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&
q.push(this.graphicsView);return q.reverse()};v._isValidPopupLayerView=function(q){return g.isSome(q)&&(!("layer"in q)||!q.suspended)&&"fetchPopupFeatures"in q};v._graphicsPerFetchPopupLayerView=function(q,t){const r=[],x=new Map;t=t.map(u=>{const E=[];"layer"in u?x.set(u.layer,E):x.set(u.graphics,E);return{layerView:u,graphics:E}});for(const u of q)(q=x.get(u.layer)||x.get(u.sourceLayer)||null)?q.push(u):r.push(u);return{layerViewsAndGraphics:t,clientOnlyGraphics:r}};return z}(d);return d=c.__decorate([e.subclass("esri.views.PopupView")],
d)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layerViewModuleImportUtils":function(){define(["require","exports","../../core/Error","../../core/maybe"],function(a,b,c,g){const h=l=>Object.freeze({__proto__:null,default:l}),w=()=>new Promise((l,k)=>a(["./layers/TileLayerView3D"],e=>l(h(e)),k)),n=()=>new Promise((l,k)=>a(["./layers/ElevationLayerView3D"],e=>l(h(e)),k)),f={analysis:()=>new Promise((l,k)=>a(["./layers/AnalysisLayerView3D"],e=>l(h(e)),k)),"base-dynamic":()=>new Promise((l,
k)=>a(["./layers/BaseDynamicLayerView3D"],e=>l(h(e)),k)),"base-elevation":n,"base-tile":w,"bing-maps":w,"building-scene":()=>new Promise((l,k)=>a(["./layers/BuildingSceneLayerView3D"],e=>l(h(e)),k)),csv:()=>new Promise((l,k)=>a(["./layers/CSVLayerView3D"],e=>l(h(e)),k)),elevation:n,feature:()=>new Promise((l,k)=>a(["./layers/FeatureLayerView3D"],e=>l(h(e)),k)),geojson:()=>new Promise((l,k)=>a(["./layers/GeoJSONLayerView3D"],e=>l(h(e)),k)),graphics:()=>new Promise((l,k)=>a(["./layers/GraphicsLayerView3D"],
e=>l(h(e)),k)),group:()=>new Promise((l,k)=>a(["../layers/GroupLayerView"],e=>l(h(e)),k)),imagery:()=>new Promise((l,k)=>a(["./layers/ImageryLayerView3D"],e=>l(h(e)),k)),"integrated-mesh":()=>new Promise((l,k)=>a(["./layers/IntegratedMeshLayerView3D"],e=>l(h(e)),k)),"map-image":()=>new Promise((l,k)=>a(["./layers/MapImageLayerView3D"],e=>l(h(e)),k)),"ogc-feature":()=>new Promise((l,k)=>a(["./layers/OGCFeatureLayerView3D"],e=>l(h(e)),k)),"open-street-map":w,"point-cloud":()=>new Promise((l,k)=>a(["./layers/PointCloudLayerView3D"],
e=>l(h(e)),k)),voxel:()=>new Promise((l,k)=>a(["./layers/VoxelLayerView3D"],e=>l(h(e)),k)),route:()=>new Promise((l,k)=>a(["./layers/RouteLayerView3D"],e=>l(h(e)),k)),scene:l=>null==l.profile||"mesh-pyramids"===l.profile?new Promise((k,e)=>a(["./layers/SceneLayerView3D"],d=>k(h(d)),e)):new Promise((k,e)=>a(["./layers/SceneLayerGraphicsView3D"],d=>k(h(d)),e)),stream:()=>new Promise((l,k)=>a(["./layers/StreamLayerView3D"],e=>l(h(e)),k)),tile:w,"imagery-tile":()=>new Promise((l,k)=>a(["./layers/ImageryTileLayerView3D"],
e=>l(h(e)),k)),"vector-tile":()=>new Promise((l,k)=>a(["./layers/VectorTileLayerView3D"],e=>l(h(e)),k)),wcs:()=>new Promise((l,k)=>a(["./layers/ImageryTileLayerView3D"],e=>l(h(e)),k)),"web-tile":w,wfs:()=>new Promise((l,k)=>a(["./layers/WFSLayerView3D"],e=>l(h(e)),k)),wms:()=>new Promise((l,k)=>a(["./layers/WMSLayerView3D"],e=>l(h(e)),k)),wmts:()=>new Promise((l,k)=>a(["./layers/WMTSLayerView3D"],e=>l(h(e)),k)),"geo-rss":null,kml:null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null};
b.layerView3DImporter={hasLayerViewModule:l=>g.isSome(f[l.type]),importLayerView:l=>{var k=f[l.type];if(!g.isSome(k))throw l=l.declaredClass?l.declaredClass.slice(l.declaredClass.lastIndexOf(".")+1):"Unknown",k=l.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),l=new c(`${k}:view-not-supported`,`${l} is not supported in 3D`),l;return k(l)}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/analysis/AnalysisViewManager3D":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Collection ../../../core/Error ../../../core/HandleOwner ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/scheduling ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m){const z=r=>Object.freeze({__proto__:null,default:r}),v=f.getLogger("esri.views.3d.analysis.AnalysisViewManager3D");var q;(function(r){r[r.PENDING=0]="PENDING";r[r.CREATED=1]="CREATED"})(q||(q={}));var t;(function(r){r[r.ADDED=0]="ADDED";r[r.REMOVED=1]="REMOVED"})(t||(t={}));g=function(r){function x(E){E=r.call(this,E)||this;E._allAnalysisViews=new h;E._creatingViewCount=0;E._items=new Map;E._scheduledUpdateHandle=null;E._analysisModules={"area-measurement":{module:null},
"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}};return E}b._inheritsLoose(x,r);var u=x.prototype;u.destroy=function(){this.detach()};u.attach=function(){this.handles.add(this._connectOwner(this.view),"analyses-owner-handles")};u.detach=function(){this.handles.remove("analyses-owner-handles");this._update();this._creatingViewCount=0};u.whenAnalysisView=function(E){const y=this._items.get(E);return l.isNone(y)||y.state.list===t.REMOVED?(E=new w("AnalysisViewManager:no-analysisview-for-analysis",
"The analysis has not been added to view.analyses",{analysis:E}),Promise.reject(E)):y.createAnalysisViewTask.promise};u._connectOwner=function(E){return this._connectAnalysesCollection(E.analyses)};u._connectAnalysesCollection=function(E){for(const p of E)this._addAnalysis(p);const y=E.on("after-add",p=>this._addAnalysis(p.item)),A=E.on("after-remove",p=>this._removeAnalysis(p.item));return{remove:()=>{y.remove();A.remove();for(const p of E)this._removeAnalysis(p)}}};u._addAnalysis=function(E){const y=
this._items.get(E);if(null==y){const A={state:{view:q.PENDING,list:t.ADDED},analysis:E,view:null,createAnalysisViewTask:null};this._items.set(E,A);A.createAnalysisViewTask=k.createTask(p=>this._createAnalysisViewPromise(A,p))}else y.state.list=t.ADDED};u._removeAnalysis=function(E){E=this._items.get(E);null==E?v.error("Trying to remove analysis which was not added"):(E.state.list=t.REMOVED,this._scheduleUpdate())};u._scheduleUpdate=function(){l.isSome(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=
e.schedule(()=>this._update()))};u._update=function(){this._scheduledUpdateHandle=l.removeMaybe(this._scheduledUpdateHandle);this._items.forEach(E=>{if(E.state.list===t.REMOVED)switch(this._items.delete(E.analysis),E.state.view){case q.PENDING:E.createAnalysisViewTask=l.abortMaybe(E.createAnalysisViewTask);break;case q.CREATED:l.isSome(E.view)&&(this._allAnalysisViews.remove(E.view),E.view=l.destroyMaybe(E.view),E.createAnalysisViewTask=null)}})};u._createAnalysisViewPromise=function(){var E=b._asyncToGenerator(function*(y,
A){var p=y.analysis;const B=p.type,D=this._analysisModules[B];this._creatingViewCount+=1;if(l.isNone(D.module))try{D.module=yield this._loadAnalysisModule(B)}catch(C){throw--this._creatingViewCount,C;}if(k.isAborted(A))throw--this._creatingViewCount,k.createAbortError("AnalysisView creation aborted");p=new D.module.default({analysis:p,view:this.view});try{yield p.when()}catch(C){throw--this._creatingViewCount,C;}if(k.isAborted(A))throw--this._creatingViewCount,p.destroy(),k.createAbortError("AnalysisView creation aborted");
y.view=p;y.state.view=q.CREATED;this._allAnalysisViews.add(p);--this._creatingViewCount;return p});return function(y,A){return E.apply(this,arguments)}}();u._loadAnalysisModule=function(E){switch(E){case "area-measurement":return new Promise((y,A)=>a(["./AreaMeasurementAnalysisView3D"],p=>y(z(p)),A));case "direct-line-measurement":return new Promise((y,A)=>a(["./DirectLineMeasurementAnalysisView3D"],p=>y(z(p)),A));case "line-of-sight":return new Promise((y,A)=>a(["./LineOfSightAnalysisView3D"],p=>
y(z(p)),A));case "slice":return new Promise((y,A)=>a(["./SliceAnalysisView3D"],p=>y(z(p)),A));default:return null}};b._createClass(x,[{key:"updating",get:function(){return!this.view.ready||0!==this._creatingViewCount||this._allAnalysisViews.some(E=>E.updating)}},{key:"testInfo",get:function(){return{allAnalysisViews:this._allAnalysisViews}}}]);return x}(n.HandleOwnerMixin(g));c.__decorate([d.property()],g.prototype,"updating",null);c.__decorate([d.property({constructOnly:!0})],g.prototype,"view",
void 0);c.__decorate([d.property()],g.prototype,"_allAnalysisViews",void 0);c.__decorate([d.property()],g.prototype,"_creatingViewCount",void 0);return g=c.__decorate([m.subclass("esri.views.3d.analysis.AnalysisViewManager3D")],g)})},"esri/views/3d/constraints/Constraints":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./AltitudeConstraint ./ClipDistanceConstraint ./TiltConstraint".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){a.Constraints=function(m){function z(){var v=m.apply(this,arguments)||this;v.tilt=new d.default;v.altitude=new k.default;v.clipDistance=new e.default;return v}b._inheritsLoose(z,m);return z}(g);c.__decorate([h.property({type:d.default})],a.Constraints.prototype,"tilt",void 0);c.__decorate([h.property({type:k.default})],a.Constraints.prototype,"altitude",void 0);c.__decorate([h.property({type:e.default})],a.Constraints.prototype,"clipDistance",void 0);a.Constraints=
c.__decorate([l.subclass("esri.views.3d.constraints.Constraints")],a.Constraints);a.default=a.Constraints;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/deprecate ../../../core/Logger ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){a.AltitudeConstraint=function(m){function z(){var v=m.apply(this,arguments)||this;v.min=d.earthAltitudeConstraint.min;v.max=d.earthAltitudeConstraint.max;return v}b._inheritsLoose(z,m);b._createClass(z,[{key:"mode",get:function(){h.deprecated(w.getLogger(this.declaredClass),"esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",{version:"4.6"});return"manual"},
set:function(v){h.deprecated(w.getLogger(this.declaredClass),"esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",{version:"4.6"})}}]);return z}(g);c.__decorate([n.property({type:Number})],a.AltitudeConstraint.prototype,"min",void 0);c.__decorate([n.property({type:Number})],a.AltitudeConstraint.prototype,"max",void 0);a.AltitudeConstraint=c.__decorate([e.subclass("esri.views.3d.constraints.AltitudeConstraint")],
a.AltitudeConstraint);a.default=a.AltitudeConstraint;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/Constraints":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Logger ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/Ellipsoid ../../ViewingMode ../support/mathUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z){const v=h.getLogger("esri.views.3d.state.Constraints");a.Constraints=function(x){function u(y){y=x.call(this,y)||this;y.collision=new r;y.distance=Infinity;y.minimumPoiDistance=4;return y}b._inheritsLoose(u,x);var E=u.prototype;E.clampAltitude=function(y){return this.altitude?w.clamp(y,this.altitude.min,this.altitude.max):y};E.clampTilt=function(y,A){if(!this.tilt)return A;y=this.tilt(y);return w.clamp(A,y.min,y.max)};E.clampDistance=function(y){return Math.min(y,
this.distance)};E.createDefaultTilt=function(){return this.mode===m.ViewingMode.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()};E.createConstantMaxTilt=function(y){return(A,p=t)=>{p.min=q.min;p.max=y;return p}};E._createDefaultTiltLocal=function(){const y=this.collision.enabled?z.makePiecewiseLinearFunction([[4E3,q.max],[1E4,w.deg2rad(88)],[6E6,w.deg2rad(88)]]):()=>q.max;return(A,p=t)=>{p.min=q.min;p.max=y(A);return p}};E._createDefaultTiltGlobal=function(){const y=this.collision.enabled?
z.makePiecewiseLinearFunction([[4E3,q.max],[5E4,w.deg2rad(88)],[6E6,w.deg2rad(88)],[2E7,q.min]]):z.makePiecewiseLinearFunction([[3E5,q.max],[3E6,w.deg2rad(88)],[6E6,w.deg2rad(88)],[2E7,q.min]]);return(A,p=t)=>{p.min=q.min;p.max=y(A);return p}};b._createClass(u,[{key:"altitude",get:function(){return this.mode===m.ViewingMode.Local?null:this._get("altitude")||null},set:function(y){this.mode===m.ViewingMode.Local?v.warn("Altitude constraint is ignored in local scenes"):this._set("altitude",y)}}]);return u}(g);
c.__decorate([n.property()],a.Constraints.prototype,"altitude",null);c.__decorate([n.property({readOnly:!0})],a.Constraints.prototype,"collision",void 0);c.__decorate([n.property()],a.Constraints.prototype,"distance",void 0);c.__decorate([n.property({readOnly:!0})],a.Constraints.prototype,"minimumPoiDistance",void 0);c.__decorate([n.property()],a.Constraints.prototype,"tilt",void 0);c.__decorate([n.property({constructOnly:!0})],a.Constraints.prototype,"mode",void 0);a.Constraints=c.__decorate([e.subclass("esri.views.3d.state.Constraints")],
a.Constraints);h={min:-2E5,max:4*d.earth.radius};const q={min:w.deg2rad(.5),max:w.deg2rad(179.5)},t={min:0,max:0};let r=function(x){function u(){var E=x.apply(this,arguments)||this;E.enabled=!0;E.elevationMargin=5;return E}b._inheritsLoose(u,x);return u}(g);c.__decorate([n.property({type:Boolean})],r.prototype,"enabled",void 0);c.__decorate([n.property({type:Number})],r.prototype,"elevationMargin",void 0);r=c.__decorate([e.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],r);c=a.Constraints;
a.TiltDefault=q;a.default=c;a.earthAltitudeConstraint=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,g,h,w,n,
f,l){a.ClipDistanceConstraint=function(k){function e(){var m=k.apply(this,arguments)||this;m.mode="auto";return m}b._inheritsLoose(e,k);var d=e.prototype;d.castNear=function(m){return Math.max(1E-8,m)};d.castFar=function(m){return Math.max(1E-8,m)};d.autoUpdate=function(m,z){"auto"===this.mode&&(this._get("near")!==m&&this._set("near",m),this._get("far")!==z&&this._set("far",z))};b._createClass(e,[{key:"near",get:function(){return this._get("near")},set:function(m){this._set("near",m);m>=this._get("far")&&
(this.far=m+1E-9);this.mode="manual"}},{key:"far",get:function(){return this._get("far")},set:function(m){this._set("far",m);m<=this._get("near")&&(this.near=m-1E-9);this.mode="manual"}}]);return e}(g);c.__decorate([h.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"near",null);c.__decorate([f.cast("near")],a.ClipDistanceConstraint.prototype,"castNear",null);c.__decorate([h.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"far",null);c.__decorate([f.cast("far")],
a.ClipDistanceConstraint.prototype,"castFar",null);c.__decorate([h.property({type:["auto","manual"]})],a.ClipDistanceConstraint.prototype,"mode",void 0);a.ClipDistanceConstraint=c.__decorate([l.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],a.ClipDistanceConstraint);a.default=a.ClipDistanceConstraint;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/constraints/TiltConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){var d=h.rad2deg(e.TiltDefault.min),m=h.rad2deg(e.TiltDefault.max);a.TiltConstraint=function(z){function v(){var t=z.apply(this,arguments)||this;t.mode="auto";return t}b._inheritsLoose(v,z);var q=v.prototype;q.castMax=function(t){return h.clamp(t,d,m)};q.autoUpdate=function(t){"auto"===this.mode&&this._get("max")!==t&&this._set("max",t)};b._createClass(v,[{key:"max",get:function(){return this._get("max")},set:function(t){this._set("max",t);this.mode="manual"}}]);return v}(g);
c.__decorate([w.property({type:["auto","manual"]})],a.TiltConstraint.prototype,"mode",void 0);c.__decorate([w.property({type:Number,value:m})],a.TiltConstraint.prototype,"max",null);c.__decorate([l.cast("max")],a.TiltConstraint.prototype,"castMax",null);a.TiltConstraint=c.__decorate([k.subclass("esri.views.3d.constraints.TiltConstraint")],a.TiltConstraint);a.default=a.TiltConstraint;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/lang ../../../core/Logger ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/ensureType ./lightingUtils ./SceneViewAtmosphere ./SunLighting ./SunnyWeather ./VirtualLighting ./weather ../../../webscene/Environment ../../../webscene/Lighting".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q){var t;const r=g.getLogger("esri.views.3d.environment.SceneViewEnvironment");g=t=function(x){function u(y){y=x.call(this,y)||this;y.atmosphere=new k.default;y.lighting=new e;return y}a._inheritsLoose(u,x);u.fromWebsceneEnvironment=function(y){y=y.cloneConstructProperties();return new t({...y,lighting:e.fromWebsceneLighting(y.lighting)})};var E=u.prototype;E.castLighting=function(y){return this._convertLighting(y)};E.applyLighting=function(y){this.lighting=
this._convertLighting(y)};E._convertLighting=function(y){if(!y)return new e;if(y instanceof e||y instanceof m)return y;if(y instanceof q){var A;return"sun"===(null==(A=this.lighting)?void 0:A.type)?this.lighting.cloneWithWebsceneLighting(y):e.fromWebsceneLighting(y)}return f.ensureOneOfType(l.lightingTypes,y)};E.clone=function(){return new t({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,
background:c.clone(this.background)})};E.cloneWithWebsceneEnvironment=function(y){return new t({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:c.clone(this.background),...y.cloneConstructProperties(),lighting:this.lighting.type&&"sun"!==this.lighting.type?e.fromWebsceneLighting(y.lighting):this.lighting.cloneWithWebsceneLighting(y.lighting)})};a._createClass(u,[{key:"weather",set:function(y){z.validateWeatherType(null==
y?void 0:y.type,r)&&this._set("weather",y)}}]);return u}(v);b.__decorate([h.property({type:k.default,json:{read:!1},nonNullable:!0})],g.prototype,"atmosphere",void 0);b.__decorate([h.property({types:z.weatherTypes,nonNullable:!0,json:{write:!1},value:new d})],g.prototype,"weather",null);b.__decorate([h.property({nonNullable:!0})],g.prototype,"lighting",void 0);b.__decorate([w.cast("lighting")],g.prototype,"castLighting",null);return g=t=b.__decorate([n.subclass("esri.views.3d.environment.SceneViewEnvironment")],
g)})},"esri/views/3d/environment/lightingUtils":function(){define(["exports","./SunLighting","./VirtualLighting"],function(a,b,c){a.lightingTypes={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:b,virtual:c}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/SunLighting":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Evented ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../webscene/Lighting".split(" "),
function(a,b,c,g,h,w,n,f,l){var k;c=k=function(d){function m(v){v=d.call(this,v)||this;v.type="sun";v.cameraTrackingEnabled=!0;v.ambientOcclusionEnabled=!1;v.waterReflectionEnabled=!1;v.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};var q=(new Date).getFullYear();q=new Date("March 15, "+q+" 12:00:00 UTC");v._set("defaultDate",q);v._set("date",q);return v}a._inheritsLoose(m,d);m.fromWebsceneLighting=function(v){return new k(v.cloneConstructProperties())};var z=m.prototype;z.autoUpdate=
function(v,q){const t=k.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=q.hours;this.positionTimezoneInfo.minutes=q.minutes;this.positionTimezoneInfo.seconds=q.seconds;q=null;null!=v&&(this.positionTimezoneInfo.autoUpdated=!0,q=this.date&&this.date.getTime(),this._set("date",new Date(v.getTime())));const r=k.calculateTimezoneOffset(this.positionTimezoneInfo);t!==r&&(e.target=this,e.timezoneOffset=r,this.emit("timezone-will-change",e));if(null!=v)return q!==v.getTime()};
z.clone=function(){const v=this._get("date")===this._get("defaultDate"),q=new k({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled});v&&q._set("date",q._get("defaultDate"));q.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated;q.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours;q.positionTimezoneInfo.minutes=
this.positionTimezoneInfo.minutes;q.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds;return q};z.cloneWithWebsceneLighting=function(v){const q=this.clone();null!=v.date&&(q.date=v.date);q.directShadowsEnabled=v.directShadowsEnabled;q.displayUTCOffset=v.displayUTCOffset;return q};a._createClass(m,[{key:"defaultDate",get:function(){return new Date(this._get("defaultDate").getTime())},set:function(v){const q=this._get("date")===this._get("defaultDate");v=new Date(v.getTime());this._set("defaultDate",
v);q&&this._set("date",v)}},{key:"date",set:function(v){null!=v&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(v.getTime())))}}]);return m}(c.EventedMixin(l));b.__decorate([g.property({readOnly:!0})],c.prototype,"type",void 0);b.__decorate([g.property({type:Boolean})],c.prototype,"cameraTrackingEnabled",void 0);b.__decorate([g.property({type:Boolean})],c.prototype,"ambientOcclusionEnabled",void 0);b.__decorate([g.property({type:Boolean})],c.prototype,"waterReflectionEnabled",
void 0);b.__decorate([g.property({type:Date})],c.prototype,"defaultDate",null);b.__decorate([g.property({type:Date})],c.prototype,"date",null);c=k=b.__decorate([f.subclass("esri.views.3d.environment.SunLighting")],c);(function(d){d.calculateTimezoneOffset=function({hours:m,minutes:z,seconds:v}){return Math.round(m+z/60+v/3600)}})(c||(c={}));const e={target:null,timezoneOffset:0};return c})},"esri/webscene/Lighting":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer".split(" "),
function(a,b,c,g,h,w,n,f,l,k){var e;c=e=function(d){function m(v){v=d.call(this,v)||this;v.date=null;v.directShadowsEnabled=!1;v.displayUTCOffset=null;return v}a._inheritsLoose(m,d);var z=m.prototype;z.readDate=function(v,q){return null!=q.datetime&&new Date(q.datetime)||null};z.writeDate=function(v,q,t){q[t]=v.getTime()};z.readDirectShadowsEnabled=function(v,q){return!!q.directShadows};z.writedirectShadowsEnabled=function(v,q,t){v&&(q[t]=v)};z.writeDisplayUTCOffset=function(v,q){null!=v&&(q.displayUTCOffset=
v)};z.clone=function(){return new e(this.cloneConstructProperties())};z.cloneConstructProperties=function(){const v={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(v.date=new Date(this.date.getTime()));return v};return m}(c.JSONSupport);b.__decorate([g.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],c.prototype,"date",void 0);b.__decorate([f.reader("date",["datetime"])],c.prototype,"readDate",
null);b.__decorate([k.writer("date")],c.prototype,"writeDate",null);b.__decorate([g.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],c.prototype,"directShadowsEnabled",void 0);b.__decorate([f.reader("directShadowsEnabled",["directShadows"])],c.prototype,"readDirectShadowsEnabled",null);b.__decorate([k.writer("directShadowsEnabled")],c.prototype,"writedirectShadowsEnabled",null);b.__decorate([g.property({type:Number,json:{write:!0}})],c.prototype,"displayUTCOffset",void 0);
b.__decorate([k.writer("displayUTCOffset")],c.prototype,"writeDisplayUTCOffset",null);return c=e=b.__decorate([l.subclass("esri.webscene.Lighting")],c)})},"esri/views/3d/environment/VirtualLighting":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Evented ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../webscene/Lighting".split(" "),
function(a,b,c,g,h,w,n,f,l){var k;c=k=function(e){function d(z){z=e.call(this,z)||this;z.type="virtual";z.ambientOcclusionEnabled=!1;z.waterReflectionEnabled=!1;return z}a._inheritsLoose(d,e);var m=d.prototype;m.clone=function(){return new k({...this.cloneConstructProperties(),ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled})};m.cloneWithWebsceneLighting=function(z){const v=this.clone();v.directShadowsEnabled=z.directShadowsEnabled;return v};
return d}(c.EventedMixin(l));b.__decorate([g.property({readOnly:!0})],c.prototype,"type",void 0);b.__decorate([g.property({type:Boolean})],c.prototype,"ambientOcclusionEnabled",void 0);b.__decorate([g.property({type:Boolean})],c.prototype,"waterReflectionEnabled",void 0);return c=k=b.__decorate([f.subclass("esri.views.3d.environment.VirtualLighting")],c)})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,g,h,w,n,f,l){var k;a.SceneViewAtmosphere=k=function(e){function d(){return e.apply(this,arguments)||this}b._inheritsLoose(d,e);d.prototype.clone=function(){return new k({quality:this.quality})};b._createClass(d,[{key:"quality",set:function(m){-1!==["low","high"].indexOf(m)&&this._set("quality",m)}}]);return d}(g);c.__decorate([h.property({type:["low","high"],value:"low"})],a.SceneViewAtmosphere.prototype,"quality",null);a.SceneViewAtmosphere=k=c.__decorate([l.subclass("esri.views.3d.environment.SceneViewAtmosphere")],
a.SceneViewAtmosphere);a.default=a.SceneViewAtmosphere;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/SunnyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,g,h,w,n,f,l){var k;c=k=function(e){function d(m){m=e.call(this,m)||this;m.type="sunny";m.cloudCover=.5;return m}a._inheritsLoose(d,e);d.prototype.clone=function(){return new k({cloudCover:this.cloudCover})};return d}(c.JSONSupport);b.__decorate([f.enumeration({sunny:"sunny"})],c.prototype,"type",void 0);b.__decorate([g.property({type:Number,nonNullable:!0,range:{min:0,max:1}})],c.prototype,"cloudCover",void 0);return c=k=b.__decorate([l.subclass("esri.views.3d.environment.SunnyWeather")],
c)})},"esri/views/3d/environment/weather":function(){define("exports ../../../core/has ./CloudyWeather ./FoggyWeather ./RainyWeather ./SnowyWeather ./SunnyWeather".split(" "),function(a,b,c,g,h,w,n){function f(){return b("enable-feature:precipitation")?l:l.filter(k=>"snowy"!==k)}c={key:"type",base:null,typeMap:{sunny:n,cloudy:c,rainy:h,snowy:w,foggy:g}};const l=Object.keys(c.typeMap);a.getWeatherTypes=f;a.validateWeatherType=function(k,e){return f().includes(k)?!0:(e.error(`"${k}" is not a valid weather type`),
!1)};a.weatherEquals=function(k,e){if(k.type!==e.type)return!1;switch(k.type){case "sunny":case "rainy":case "snowy":case "cloudy":return k.cloudCover===e.cloudCover;case "foggy":return k.fogStrength===e.fogStrength}};a.weatherHeightLimit=1E4;a.weatherTypes=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/CloudyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,g,h,w,n,f,l){var k;c=k=function(e){function d(m){m=e.call(this,m)||this;m.type="cloudy";m.cloudCover=.5;return m}a._inheritsLoose(d,e);d.prototype.clone=function(){return new k({cloudCover:this.cloudCover})};return d}(c.JSONSupport);b.__decorate([f.enumeration({cloudy:"cloudy"})],c.prototype,"type",void 0);b.__decorate([g.property({type:Number,nonNullable:!0,range:{min:0,max:1}})],c.prototype,"cloudCover",void 0);return c=k=b.__decorate([l.subclass("esri.views.3d.environment.CloudyWeather")],
c)})},"esri/views/3d/environment/FoggyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,g,h,w,n,f,l){var k;c=k=function(e){function d(m){m=e.call(this,m)||this;m.type=
"foggy";m.fogStrength=.5;return m}a._inheritsLoose(d,e);d.prototype.clone=function(){return new k({fogStrength:this.fogStrength})};return d}(c.JSONSupport);b.__decorate([f.enumeration({foggy:"foggy"})],c.prototype,"type",void 0);b.__decorate([g.property({type:Number,nonNullable:!0,range:{min:0,max:1}})],c.prototype,"fogStrength",void 0);return c=k=b.__decorate([l.subclass("esri.views.3d.environment.FoggyWeather")],c)})},"esri/views/3d/environment/RainyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,g,h,w,n,f,l){var k;c=k=function(e){function d(m){m=e.call(this,m)||this;m.type="rainy";m.cloudCover=.5;m.precipitation=.5;return m}a._inheritsLoose(d,e);d.prototype.clone=function(){return new k({cloudCover:this.cloudCover,precipitation:this.precipitation})};return d}(c.JSONSupport);b.__decorate([f.enumeration({rainy:"rainy"})],c.prototype,"type",void 0);b.__decorate([g.property({type:Number,nonNullable:!0,range:{min:0,max:1}})],c.prototype,"cloudCover",void 0);b.__decorate([g.property({type:Number,
nonNullable:!0,range:{min:0,max:1}})],c.prototype,"precipitation",void 0);return c=k=b.__decorate([l.subclass("esri.views.3d.environment.RainyWeather")],c)})},"esri/views/3d/environment/SnowyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,g,h,w,n,f,l){var k;c=k=function(e){function d(m){m=e.call(this,m)||this;m.type="snowy";m.cloudCover=.5;m.precipitation=.5;return m}a._inheritsLoose(d,e);d.prototype.clone=function(){return new k({cloudCover:this.cloudCover,precipitation:this.precipitation})};return d}(c);b.__decorate([f.enumeration({snowy:"snowy"})],c.prototype,"type",void 0);b.__decorate([g.property({type:Number,nonNullable:!0,range:{min:0,max:1}})],c.prototype,"cloudCover",void 0);b.__decorate([g.property({type:Number,
nonNullable:!0,range:{min:0,max:1}})],c.prototype,"precipitation",void 0);return c=k=b.__decorate([l.subclass("esri.views.3d.environment.SnowyWeather")],c)})},"esri/webscene/Environment":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./Lighting ./background/utils".split(" "),function(a,b,c,g,h,w,n,f,l){var k;w=(e,d,
m)=>({enabled:!m||!m.isPresentation});c=k=function(e){function d(z){z=e.call(this,z)||this;z.lighting=new f;z.background=null;z.atmosphereEnabled=!0;z.starsEnabled=!0;return z}a._inheritsLoose(d,e);var m=d.prototype;m.clone=function(){return new k(this.cloneConstructProperties())};m.cloneConstructProperties=function(){return{lighting:f.prototype.clone.call(this.lighting),background:g.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled}};return d}(c.JSONSupport);
b.__decorate([h.property({type:f,json:{write:!0}})],c.prototype,"lighting",void 0);b.__decorate([h.property(l.backgroundProperty)],c.prototype,"background",void 0);b.__decorate([h.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:w}}})],c.prototype,"atmosphereEnabled",void 0);b.__decorate([h.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:w}}})],c.prototype,"starsEnabled",void 0);return c=k=b.__decorate([n.subclass("esri.webscene.Environment")],c)})},"esri/webscene/background/utils":function(){define(["exports",
"./Background","./ColorBackground"],function(a,b,c){b={base:b,key:"type",typeMap:{color:c}};b={types:b,json:{read:function(g){return(h,w,n)=>{if(!h)return h;for(const f in g.typeMap)if(h.type===f)return w=new g.typeMap[f],w.read(h,n),w}}(b),write:{overridePolicy:(g,h,w)=>({enabled:!w||!w.isPresentation})}}};a.backgroundProperty=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/webscene/background/Background":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,g,h,w,n,f){c=function(l){function k(e){return l.call(this,e)||this}a._inheritsLoose(k,l);k.prototype.clone=function(){};return k}(c.JSONSupport);b.__decorate([g.property({readOnly:!0,json:{read:!1}})],c.prototype,"type",void 0);return c=b.__decorate([f.subclass("esri.webscene.background.Background")],c)})},"esri/webscene/background/ColorBackground":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../symbols/support/materialUtils ./Background".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){var d;h={...k.colorAndTransparencyProperty,nonNullable:!0};e=d=function(m){function z(q){q=m.call(this,q)||this;q.type="color";q.color=new c([0,0,0,1]);return q}a._inheritsLoose(z,m);var v=z.prototype;v.clone=function(){return new d(this.cloneProperties())};v.cloneProperties=function(){return{color:this.color.clone()}};return z}(e);b.__decorate([f.enumeration({color:"color"},{readOnly:!0})],e.prototype,"type",void 0);b.__decorate([g.property(h)],e.prototype,"color",
void 0);return e=d=b.__decorate([l.subclass("esri.webscene.background.ColorBackground")],e)})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Evented ../../../core/Handles ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../ViewingMode ./EnvironmentRenderer ../support/earthUtils ../support/sunUtils ../webgl-engine/lighting/Lightsources ../../../webscene/background/ColorBackground".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B){a.SceneViewEnvironmentManager=function(M){function K(){var O=M.call(this)||this;O._referencePointUpdateDelay=200;O._referencePointUpdateInterval=3E3;O._referencePointUpdateDistThreshold=1E6;O._referencePosUpdateQuery=null;O._referencePosMapCoordsRequested=null;O._viewHandles=new w;O._preserveAbsoluteDateTime=!1;O._trackingEnabled=!1;O._referencePosResetPreserveAbsoluteTime=!1;O._referencePosUpdateTimer=null;O._referencePosMapCoords=null;
O._mainLight=new p.MainLight;O._ambientLight=new p.AmbientLight;O._moonLight=new p.FillLight;O.disableQueries=!1;O._disableWeather=!1;O._renderer=null;O._referencePosWGS84Comparable=null;O._resetReferencePosition();return O}b._inheritsLoose(K,M);var I=K.prototype;I.destroy=function(){this.disconnectView();this._viewHandles.destroy()};I.connectView=function(O){if(!this._renderer){this._renderer=new E.EnvironmentRenderer({view:O});var Q=()=>this._updateRenderParameters(),J=()=>this._cameraHandler(),
P=()=>this._updateLighting();this._viewHandles.add([l.watch(()=>O.environment.lighting,N=>this._updateLightingHandler(N),l.sync),l.watch(()=>O.environment.lighting.date,N=>this._lightingDateHandler(N),l.sync),l.watch(()=>O.stationary,()=>this._interactingStationaryHandler()),l.watch(()=>O.environment.lighting.directShadowsEnabled,Q,l.sync),l.watch(()=>O.environment.lighting.ambientOcclusionEnabled,Q,l.sync),l.watch(()=>O.environment.lighting.waterReflectionEnabled,Q,l.sync),l.watch(()=>{var N;return null==
(N=O.environment.background)?void 0:N.color},Q,l.sync),l.watch(()=>O.spatialReference,()=>this._resetReferencePosition(!0),l.sync),l.watch(()=>O.environment.weather.type,P,l.sync),l.watch(()=>this.weatherEnabled,P,l.sync),l.watch(()=>O.viewingMode,()=>this._resetReferencePosition(!0),l.syncAndInitial),l.watch(()=>"sun"===O.environment.lighting.type?O.environment.lighting.cameraTrackingEnabled:!1,N=>this._updateCameraTracking(N),l.syncAndInitial),l.watch(()=>O.state.camera,J,l.syncAndInitial),l.watch(()=>
this.disableQueries,J)]);this._updateRenderParameters();this._updateLighting();this._cameraHandler();this.notifyChange("updating")}};I.disconnectView=function(){this._viewHandles.removeAll();this._resetReferencePosition();this._renderer=n.destroyMaybe(this._renderer)};I._updateLightingHandler=function(O){this._updateCameraTracking("sun"===O.type?O.cameraTrackingEnabled:!1);this._lightingDateHandler(O.date);this._updateRenderParameters()};I._updateCameraTracking=function(O){(this._trackingEnabled=
O)?this._cameraHandler():(O=this._view.environment.lighting,"sun"===(null==O?void 0:O.type)&&(O.positionTimezoneInfo.autoUpdated=!1))};I._lightingDateHandler=function(O){const Q=this._view.environment.lighting;if("virtual"===(null==Q?void 0:Q.type))this._updateLighting();else if(O){if(!Q.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;if(!r.canProjectToWGS84ComparableLonLat(this._view.spatialReference)){var J=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(J)){this._requestReferencePositionUpdate(J);
return}}this._preupdateTracking(O);n.isSome(this._referencePosWGS84Comparable)&&(J=y.positionToTimezoneInfo(this._referencePosWGS84Comparable,G),n.isSome(J)&&(Q.autoUpdate(null,J),this._trackingEnabled&&(Q.positionTimezoneInfo.autoUpdated=!0)))}this._updateLighting(O)}};I._preupdateTracking=function(O){!this._trackingEnabled&&"sun"===this._view.environment.lighting.type&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(O)};I._cameraHandler=function(O=null){var Q=this._view;
Q.ready&&(Q=Q.stateManager.camera)&&(this._cameraHandlerClientSide(Q,O)||this._cameraHandlerServerSide(Q))};I._cameraHandlerClientSide=function(O,Q){const J=x.isEarth(this._view.spatialReference);if(J&&!r.canProjectToWGS84ComparableLonLat(this._view.spatialReference))return!1;O=O.position;n.isNone(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=q.create());J?r.projectPointToWGS84ComparableLonLat(O,this._referencePosWGS84Comparable):v.set(this._referencePosWGS84Comparable,O.longitude,
O.latitude,O.z);this.notifyChange("referencePositionWGS84Comparable");this._autoUpdateTimezone(this._referencePosWGS84Comparable,Q)||this._updateLighting(Q);return!0};I._cameraHandlerServerSide=function(O){O=O.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(O))&&this._requestReferencePositionUpdate(O,!0);this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=O.z*this._view.mapCoordsHelper.unitInMeters,
this._referencePosChanged())};I._interactingStationaryHandler=function(){this._view.stationary&&this._executePendingReferencePositionUpdate()};I._updateLighting=function(O){const Q=this._view;var J=O||Q.environment.lighting.date,P=this._referencePosWGS84Comparable;O=n.isSome(P)?D:C;n.isSome(P)&&A.computeColorAndIntensity(J,P,Q.state.viewingMode,this.weatherVisible?Q.environment.weather.type:"disabled",Q.state.camera,Q.environment.lighting.type,O);J=this._mainLight;P=O.direct;v.scale(J.intensity,P.color,
P.intensity*Math.PI);v.copy(J.direction,P.directionToLightSource);J.specularStrength=O.specularStrength;J.environmentStrength=O.environmentStrength;const N=this._ambientLight;v.scale(N.intensity,O.ambient.color,O.ambient.intensity);const R=this._moonLight;v.lerp(R.intensity,L,H,O.globalFactor);v.scale(R.intensity,R.intensity,(1-.5*O.globalFactor)*(1-.4*O.noonFactor*(1-O.globalFactor)));v.copy(R.direction,P.directionToLightSource);Q._stage.renderView.updateLightSources([J,N,R],1-O.noonFactor,O.globalFactor);
this._updateRenderParameters()};I._autoUpdateTimezone=function(O,Q=null){if("virtual"===this._view.environment.lighting.type||!this._view.environment.lighting.cameraTrackingEnabled||n.isNone(O))return!1;const J=F;J.setTime((Q||this._view.environment.lighting.date).getTime());O=y.positionToTimezoneInfo(O,G);if(n.isNone(O))return!1;var P=this._view.environment.lighting.positionTimezoneInfo;if(!P.autoUpdated)P=O;else if(P.hours===O.hours&&P.minutes===O.minutes&&P.seconds===O.seconds)return!1;const N=
J.getUTCHours()-(O.hours-P.hours),R=J.getUTCMinutes()-(O.minutes-P.minutes);P=J.getUTCSeconds()-(O.seconds-P.seconds);J.setUTCHours(N);J.setUTCMinutes(R);J.setUTCSeconds(P);return Q?!1:this._view.environment.lighting.autoUpdate(J,O)};I._updateRenderParameters=function(){const O=this._view._stage;if(O){var Q=n.mapOr(this._referencePosWGS84Comparable,!0,P=>A.computeShadowsEnabled(P[2],this._view.state.viewingMode)),J=this._view.environment.background;J=J instanceof B?{type:"color",color:t.fromArray(g.toUnitRGBA(J.color))}:
{type:"color",color:t.fromValues(0,0,0,1)};O.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&Q,ssao:this._view.environment.lighting.ambientOcclusionEnabled,waterReflectionEnabled:this._view.environment.lighting.waterReflectionEnabled,fillLightsEnabled:"sun"===this._view.environment.lighting.type,background:J})}};I._resetReferencePosition=function(O=!1){this._cancelReferencePosUpdates();this._referencePosWGS84Comparable=this._referencePosResetPreserveAbsoluteTime=
this._referencePosMapCoordsRequested=this._referencePosMapCoords=null;this.notifyChange("updating");O&&this._cameraHandler()};I._requestReferencePositionUpdate=function(O,Q=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(O):this._referencePosMapCoordsRequested=O.clone(),this._referencePosResetPreserveAbsoluteTime=!!Q,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const J=this._referencePosUpdateQuery=
f.after(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===J)return this._doReferencePositionUpdateQuery(()=>this._referencePosUpdateQuery!==J)}).catch(N=>{"mapcoordshelper:missing-geometry-service"===N.name&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===J&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),P=this._referencePosUpdateTimer=f.after(this._referencePointUpdateInterval).then(()=>
{this._referencePosUpdateTimer===P&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}};I._doReferencePositionUpdateQuery=function(){var O=b._asyncToGenerator(function*(Q){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1);this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone();
this._referencePosMapCoordsRequested=this._referencePosResetPreserveAbsoluteTime=null;const J=yield this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);Q()||isNaN(J[0])||isNaN(J[1])||(Q=this._referencePosMapCoords.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=J[0],this._referencePosWGS84Comparable[1]=J[1],this._referencePosWGS84Comparable[2]=Q):this._referencePosWGS84Comparable=[J[0],J[1],Q],this._referencePosChanged())});
return function(Q){return O.apply(this,arguments)}}();I._executePendingReferencePositionUpdate=function(){const O=this._referencePosMapCoordsRequested;O&&this._requestReferencePositionUpdate(O,this._referencePosResetPreserveAbsoluteTime)};I._referencePosChanged=function(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting();this.notifyChange("referencePositionWGS84Comparable")};I._exceedsReferencePosDistThreshold=
function(O){return this._referencePosMapCoords?(O=this._referencePosMapCoords.distance(O),this._view.mapCoordsHelper&&(O*=this._view.mapCoordsHelper.unitInMeters),O>this._referencePointUpdateDistThreshold):!0};I._cancelReferencePosUpdates=function(){const O=!!this._referencePosUpdateQuery;this._referencePosUpdateTimer=this._referencePosUpdateQuery=null;return O};b._createClass(K,[{key:"_view",get:function(){var O;return null==(O=this._renderer)?void 0:O.view}},{key:"updating",get:function(){var O;
return!!(!this.disableQueries&&(this._referencePosUpdateQuery||this._referencePosMapCoordsRequested)||null!=(O=this._renderer)&&O.updating)}},{key:"weatherEnabled",get:function(){var O,Q,J;return(null==(O=this._view)?void 0:O.environment.atmosphereEnabled)&&!this._disableWeather&&(null==(Q=this._view)?void 0:null==(J=Q.state)?void 0:J.viewingMode)===u.ViewingMode.Global&&x.isEarth(this._view.spatialReference)}},{key:"weatherVisible",get:function(){var O;return this.weatherEnabled&&(null==(O=this._renderer)?
void 0:O.weatherVisible)}},{key:"referencePositionWGS84Comparable",get:function(){return this._referencePosWGS84Comparable}},{key:"test",get:function(){const O=this;return{get renderer(){return O._renderer},set referencePointUpdateInterval(Q){O._referencePointUpdateInterval=Q},set referencePointUpdateDistThreshold(Q){O._referencePointUpdateDistThreshold=Q},set referencePosUpdateTimer(Q){O._referencePosUpdateTimer=Q},set referencePointUpdateDelay(Q){O._referencePointUpdateDelay=Q},set disableWeather(Q){O._disableWeather=
Q}}}}]);return K}(h.EventedAccessor);c.__decorate([k.property({type:Boolean,readOnly:!0})],a.SceneViewEnvironmentManager.prototype,"updating",null);c.__decorate([k.property()],a.SceneViewEnvironmentManager.prototype,"disableQueries",void 0);c.__decorate([k.property()],a.SceneViewEnvironmentManager.prototype,"_disableWeather",void 0);c.__decorate([k.property()],a.SceneViewEnvironmentManager.prototype,"weatherEnabled",null);c.__decorate([k.property()],a.SceneViewEnvironmentManager.prototype,"weatherVisible",
null);c.__decorate([k.property()],a.SceneViewEnvironmentManager.prototype,"referencePositionWGS84Comparable",null);c.__decorate([k.property()],a.SceneViewEnvironmentManager.prototype,"_renderer",void 0);c.__decorate([k.property()],a.SceneViewEnvironmentManager.prototype,"_referencePosWGS84Comparable",void 0);a.SceneViewEnvironmentManager=c.__decorate([z.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],a.SceneViewEnvironmentManager);const D=new A.ColorAndIntensity,C=new A.ColorAndIntensity,
F=new Date,G={hours:0,minutes:0,seconds:0},L=q.fromValues(.22,.22,.33),H=q.fromValues(.22,.22,.22);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/has ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../geometry/projectionEllipsoid ../../../geometry/support/spatialReferenceUtils ../../../support/featureFlags ./ChapmanAtmosphere ./CloudsComposition ./CloudsData ./CloudsGenerator ./CloudsPresets ./Fog ./PanoramicAtmosphere ./Precipitation ../../../chunks/Precipitation.glsl ./SimpleAtmosphere ./Stars ./weather ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H,M){var K;const I=[M.RenderSlot.POSTPROCESSING_ENVIRONMENT_OPAQUE,M.RenderSlot.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];a.EnvironmentRenderer=K=function(Q){function J(N){N=Q.call(this,N)||this;N._handles=new w;N._context=null;N._pendingAtmosphere=null;N._atmosphere=null;N._precipitationEnabled=r.enablePrecipitation();return N}b._inheritsLoose(J,Q);var P=J.prototype;P.initialize=function(){this.view._stage.addRenderPlugin(I,this)};
P.destroy=function(){var N;this._pendingAtmosphere=f.destroyMaybe(this._pendingAtmosphere);null!=(null==(N=this.view)?void 0:N._stage)&&this.view._stage.removeRenderPlugin(this);this._handles=f.destroyMaybe(this._handles);this._set("view",null)};P.updateAnimation=function(N){return f.isSome(this._precipitation)?this._precipitation.update(N):!1};P.initializeRenderContext=function(N=null){this._context=N;this._handles.add([k.when(this.view,"basemapTerrain",()=>this._updateBasemapTerrain(),!0),l.watch(()=>
({viewingMode:this.view.viewingMode,atmosphereEnabled:this.view.environment.atmosphereEnabled,atmosphereQuality:this.view.environment.atmosphere.quality}),()=>this._updateAtmosphere(),l.syncAndInitial),l.watch(()=>this._stars,()=>this._setNeedsRender()),l.watch(()=>this._clouds,()=>this._updateWeather(this._weatherUpdateParameters),l.initial),l.watch(()=>this._precipitation,()=>this._setNeedsRender()),l.watch(()=>this._fog,()=>this._updateFog(this._weatherUpdateParameters),l.initial),l.watch(()=>
this._weatherUpdateParameters,R=>{this._updateWeather(R);this._updateFog(R)},l.syncAndInitial)])};P.uninitializeRenderContext=function(){this._context=null;this._atmosphere=f.destroyMaybe(this._atmosphere);this._set("_stars",f.destroyMaybe(this._stars));this._set("_precipitation",f.destroyMaybe(this._precipitation));this._set("_clouds",f.destroyMaybe(this._clouds));this._set("_cloudComposition",f.destroyMaybe(this._cloudComposition));this._set("_fog",f.destroyMaybe(this._fog))};P.render=function(N){if(N.pass===
H.RenderPass.MATERIAL)switch(N.slot){case M.RenderSlot.POSTPROCESSING_ENVIRONMENT_OPAQUE:f.isSome(this._stars)&&this._stars.render(N);f.isSome(this._atmosphere)&&this._atmosphere.canRender&&(this._atmosphere.render(N),E.isReadyCloudsData(this._clouds)&&f.isSome(this._cloudComposition)&&(this._cloudComposition.render(N,this._clouds,f.isSome(this.view.animation)),this._cloudComposition.isFading&&this._setNeedsRender()));break;case M.RenderSlot.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(f.isSome(this._atmosphere)&&
this._atmosphere.canRender){const R=this.weatherEnabled?this.view.environment.weather.type:"disabled";this._atmosphere.renderHaze(N,"rainy"===R);if(f.isSome(this._fog)){const S="foggy"===R||"rainy"===R||"snowy"===R;(S||"realistic"!==this._selectAtmosphereType())&&this._fog.render(N,S,"rainy"===R)}"rainy"!==this.view.environment.weather.type&&"snowy"!==this.view.environment.weather.type||!f.isSome(this._precipitation)||this._precipitation.render(N,this.view.environment.weather.precipitation,"rainy"===
this.view.environment.weather.type?C.PrecipitationType.RAIN:C.PrecipitationType.SNOW)}}};P._updateWeather=function(N){f.isNone(N)||f.isNone(this._clouds)||(this._clouds.applyPreset(A.cloudPresets[N.type],N.weatherAdjustment),this._setNeedsRender())};P._setNeedsRender=function(){f.isSome(this._context)&&this._context.requestRender()};P._updateFog=function(N){if(!f.isNone(this._fog)&&!f.isNone(N))switch(N.type){case "foggy":this._fog.strength=n.lerp(3E-5,.005,N.weatherAdjustment**3);this._setNeedsRender();
break;case "rainy":case "snowy":this._fog.strength=n.lerp(4E-6,8E-5,N.effect**3);this._setNeedsRender();break;default:this._fog.strength=4E-6,this._setNeedsRender()}};P._updateAtmosphere=function(){var N=this._selectAtmosphereType();if(this.atmosphereType!==N)if(f.isSome(this._pendingAtmosphere)&&(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null),N=this._getAtmosphereClass()){var R=new N(this.view);f.isSome(this._context)&&R.initializeRenderContext(this._context);
f.isNone(this._atmosphere)&&(this._atmosphere=R,this._setNeedsRender());this._pendingAtmosphere=R;R.when().then(()=>{f.isSome(this._atmosphere)&&this._pendingAtmosphere&&this._pendingAtmosphere!==this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=this._pendingAtmosphere);this._pendingAtmosphere=null;this._setNeedsRender();this._updateBasemapTerrain()}).catch(()=>{this._pendingAtmosphere===R&&(this._pendingAtmosphere=null)})}else f.isSome(this._atmosphere)&&(this._atmosphere.destroy(),
this._atmosphere=null,this._setNeedsRender()),this._updateBasemapTerrain()};P._getAtmosphereClass=function(){switch(this._selectAtmosphereType()){case "none":return null;case "realistic":return x.ChapmanAtmosphere;case "panoramic":return B.PanoramicAtmosphere;case "simple":return F}};P._selectAtmosphereType=function(){const N=this.view.get("environment.atmosphereEnabled"),R=this.view.get("environment.atmosphere.quality"),S=this.view.viewingMode;return!N||null==R||t.isMoon(this.view.spatialReference)?
"none":"local"===S?"panoramic":"high"===R&&f.isSome(this._context)&&x.ChapmanAtmosphere.isSupported(this._context)&&t.isEarth(this.view.spatialReference)?"realistic":"simple"};P._updateBasemapTerrain=function(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=f.isSome(this._atmosphere)&&"simple"===this.atmosphereType)};b._createClass(J,[{key:"atmosphereType",get:function(){return f.isSome(this._pendingAtmosphere)?this._pendingAtmosphere.type:f.isSome(this._atmosphere)?this._atmosphere.type:
"none"}},{key:"canRender",get:function(){var N;return!(null==(N=this.view.basemapTerrain)||!N.renderer.canRender)||"global"!==this.view.viewingMode}},{key:"needsLinearDepth",get:function(){return"realistic"===this._selectAtmosphereType()}},{key:"updating",get:function(){return f.isSome(this._pendingAtmosphere)||f.isSome(this._stars)&&this._stars.updating||f.isSome(this._clouds)&&this._clouds.running}},{key:"weatherVisible",get:function(){return v.length(this.view.state.camera.eye)-q.getReferenceEllipsoid(this.view.spatialReference).radius<=
L.weatherHeightLimit}},{key:"_stars",get:function(){var N,R;const S=this.view,T=null!=(N=null==(R=S.environment)?void 0:R.starsEnabled)?N:!1;N=this._get("_stars");return!T||f.isNone(this._context)?(f.destroyMaybe(N),null):f.isSome(N)?N:new G.Stars({view:S,requestRender:()=>this._setNeedsRender()})}},{key:"_precipitation",get:function(){const N=this._get("_precipitation");if(!this._precipitationEnabled||f.isNone(this._context))return f.destroyMaybe(N),null;const R=this.view,S=this._context;if(f.isSome(N)&&
N.context===S)return N;f.destroyMaybe(N);return new D.Precipitation({context:S,view:R})}},{key:"_clouds",get:function(){const N=this._get("_clouds");if(!this.weatherEnabled||f.isNone(this._context))return f.destroyMaybe(N),null;if(f.isSome(N))return N;const R=this.view,S=this._context.renderContext.rctx;f.destroyMaybe(N);return new y.CloudsGenerator({rctx:S,view:R,requestRender:()=>this._setNeedsRender()})}},{key:"_cloudComposition",get:function(){const N=this._get("_cloudComposition");if(!this.weatherEnabled||
f.isNone(this._context))return f.destroyMaybe(N),null;const R=this.view.state.viewingMode,S=this._context.renderContext.rctx,T=q.getReferenceEllipsoid(this.view.spatialReference).radius;if(f.isSome(N)&&N.viewingMode===R&&N.radius===T)return N;f.destroyMaybe(N);return new u.CloudsComposition({rctx:S,viewingMode:R,radius:T})}},{key:"_fog",get:function(){const N=this._get("_fog");if(!this.weatherEnabled||f.isNone(this._context))return f.destroyMaybe(N),null;if(f.isSome(N))return N;const R=this.view,
S=this._context;f.destroyMaybe(N);return new p.Fog({context:S,view:R})}},{key:"weatherEnabled",get:function(){var N,R;return!(null==(N=this.view)||null==(R=N.environmentManager)||!R.weatherEnabled)}},{key:"precipitationEnabled",get:function(){return this._precipitationEnabled},set:function(N){this._precipitationEnabled=N}},{key:"_weatherUpdateParameters",get:function(){const N=this.weatherEnabled?this.view.environment.weather:null;return f.isNone(N)?null:"rainy"===N.type||"snowy"===N.type?{type:N.type,
weatherAdjustment:N.cloudCover,effect:N.precipitation}:{type:N.type,weatherAdjustment:"foggy"===N.type?N.fogStrength:N.cloudCover}}},{key:"test",get:function(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType(),stubGetAtmosphereClass:N=>{O=K.prototype._getAtmosphereClass;K.prototype._getAtmosphereClass=N},restoreGetAtmosphereClass:()=>{K.prototype._getAtmosphereClass=O},precipitationEnabled:N=>{this.precipitationEnabled=N}}}}]);return J}(g);
c.__decorate([e.property({constructOnly:!0})],a.EnvironmentRenderer.prototype,"view",void 0);c.__decorate([e.property({type:Boolean,readOnly:!0})],a.EnvironmentRenderer.prototype,"updating",null);c.__decorate([e.property()],a.EnvironmentRenderer.prototype,"weatherVisible",null);c.__decorate([e.property()],a.EnvironmentRenderer.prototype,"_context",void 0);c.__decorate([e.property()],a.EnvironmentRenderer.prototype,"_pendingAtmosphere",void 0);c.__decorate([e.property({readOnly:!0})],a.EnvironmentRenderer.prototype,
"_stars",null);c.__decorate([e.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_precipitation",null);c.__decorate([e.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_clouds",null);c.__decorate([e.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_cloudComposition",null);c.__decorate([e.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_fog",null);c.__decorate([e.property()],a.EnvironmentRenderer.prototype,"weatherEnabled",null);c.__decorate([e.property()],a.EnvironmentRenderer.prototype,
"_precipitationEnabled",void 0);c.__decorate([e.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_weatherUpdateParameters",null);a.EnvironmentRenderer=K=c.__decorate([z.subclass("esri.views.3d.environment.EnvironmentRenderer")],a.EnvironmentRenderer);let O;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/ChapmanAtmosphere":function(){define("exports ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/watchUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/support/Ellipsoid ./atmosphereUtils ./ChapmanAtmosphereTechnique ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r){let x=function(){function u(y){this._view=y;this.type="realistic";this.canRender=!0;this._cameraPosition=e.create();this._projectionInverse=n.create();this._viewInverse=n.create();this._heightParameters=d.create();this._betasRayleigh=e.create();this._betasCombined=e.create();this._scaleHeight=0;this._radii=l.create();this._nearFar=l.create();this._lowerElevationBoundRadius=this._altitudeFade=this._innerFadeDistance=this._cAtmosphere=this._cameraHeightSq=
this._cameraHeight=0;this._lowerBoundEarthRadius=m.earth.radius;this._hazeStrength=1;this._darkenHaze=!1;this._updateRadius(m.earth.radius)}var E=u.prototype;E.destroy=function(){this._atmosphereTechnique=g.releaseMaybe(this._atmosphereTechnique);this._atmosphereHazeTechnique=g.releaseMaybe(this._atmosphereHazeTechnique);this._vao=g.disposeMaybe(this._vao);this._handles=g.destroyMaybe(this._handles)};E.when=function(){return Promise.resolve()};E.initializeRenderContext=function(y){const A=y.renderContext.rctx;
this._handles=new b;g.isSome(this._view.basemapTerrain.rootTiles)&&this._updateElevation({spatialReference:this._view.basemapTerrain.spatialReference,tile:this._view.basemapTerrain.rootTiles[0],extent:this._view.basemapTerrain.rootTiles[0].extent,context:"ground"});this._handles.add(h.on(this._view,"basemapTerrain","elevation-change",B=>this._updateElevation(B),()=>this._updateElevation()));this._handles.add(h.on(this._view,"basemapTerrain","elevation-bounds-change",()=>this._updateVisibleElevationBounds()));
const p=new v.ChapmanAtmosphereTechniqueConfiguration;p.haze=!1;this._atmosphereTechnique=y.shaderTechniqueRepository.acquire(v.ChapmanAtmosphereTechnique,p);p.haze=!0;this._atmosphereHazeTechnique=y.shaderTechniqueRepository.acquire(v.ChapmanAtmosphereTechnique,p);this._vao=t.createQuadVAO(A,q.Pos2Tex);this._scaleHeight=z.rayLeighScaleHeight*z.atmosphereHeight;k.set(this._betasRayleigh,z.betaRayleigh[0],z.betaRayleigh[1],z.betaRayleigh[2]);k.set(this._betasCombined,z.betaRayleigh[0]+z.betaOzone[0],
z.betaRayleigh[1]+z.betaOzone[1],z.betaRayleigh[2]+z.betaOzone[2])};E.render=function(y){this._render(y,this._atmosphereTechnique,y.offscreenRenderingHelper.depthTexture)};E.renderHaze=function(y,A){this._darkenHaze=A;this._render(y,this._atmosphereHazeTechnique,y.offscreenRenderingHelper.linearDepthTexture)};E._render=function(y,A,p){this._update(y.camera);const B=y.rctx.useTechnique(A);y.offscreenRenderingHelper.renderDepthDetached(()=>{B.bindTexture(p,"depthTex");this._renderCommon(A.program,y)})};
E._renderCommon=function(y,A){if(!g.isNone(this._vao)){var p=A.rctx;A.scenelightingData.setLightDirectionUniform(y);y.setUniform4fv("heightParameters",this._heightParameters);y.setUniform3fv("cameraPosition",this._cameraPosition);y.setUniformMatrix4fv("inverseProjectionMatrix",this._projectionInverse);y.setUniformMatrix4fv("inverseViewMatrix",this._viewInverse);y.setUniform2fv("nearFar",this._nearFar);y.setUniform2fv("radii",this._radii);y.setUniform1f("scaleHeight",this._scaleHeight);y.setUniform1f("betaMie",
z.betaMie);y.setUniform3fv("betaRayleigh",this._betasRayleigh);y.setUniform3fv("betaCombined",this._betasCombined);y.setUniform1f("innerFadeDistance",this._innerFadeDistance);y.setUniform1f("altitudeFade",this._altitudeFade);y.setUniform1f("hazeStrength",this._hazeStrength);p.bindVAO(this._vao);y.assertCompatibleVertexAttributeLocations(this._vao);p.drawArrays(r.PrimitiveType.TRIANGLE_STRIP,0,4)}};E._adjustRadiusForTesselation=function(y){return y*Math.cos(Math.PI/16/16)};E._updateElevation=function(y){y=
y?y.tile:g.unwrapOr(this._view.basemapTerrain.rootTiles,[null])[0];g.isNone(y)||0!==y.level||(y=this._adjustRadiusForTesselation(m.earth.radius+y.elevationBounds[0]),y!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=y,this._lowerBoundEarthRadius=-1,this._updateVisibleElevationBounds()))};E._updateVisibleElevationBounds=function(){const y=this._adjustRadiusForTesselation(m.earth.radius+this._view.basemapTerrain.elevationBounds.min);(0>this._lowerBoundEarthRadius||y<this._lowerBoundEarthRadius)&&
this._updateRadius(y)};E._updateRadius=function(y){this._lowerBoundEarthRadius=y;f.set(this._radii,y,y+z.atmosphereHeight);this._innerFadeDistance=2*Math.sqrt((2*y-z.innerAtmosphereDepth)*z.innerAtmosphereDepth)};E._update=function(y){g.isNone(y)||(this._cameraHeight=k.length(y.eye),this._cameraHeightSq=this._cameraHeight*this._cameraHeight,this._cAtmosphere=this._cameraHeightSq-this._radii[1]*this._radii[1],this._heightParameters=d.fromValues(this._cameraHeight,this._cameraHeightSq,this._cAtmosphere,
Math.min(1,Math.max(0,(this._cameraHeight-this._radii[0])/z.atmosphereHeight))),k.copy(this._cameraPosition,y.eye),w.invert(this._projectionInverse,y.projectionMatrix),w.invert(this._viewInverse,y.viewMatrix),f.set(this._nearFar,y.near,y.far),this._altitudeFade=z.computeInnerAltitudeFade(this._cameraHeight-this._lowerBoundEarthRadius),this._hazeStrength=this._darkenHaze?c.lerp(.6,1,c.smoothstep(9500,10500,this._cameraHeight-m.earth.radius)):1)};u.isSupported=function(y){return y.renderContext.rctx.capabilities.depthTexture};
return u}();a.ChapmanAtmosphere=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/vec2":function(){define(["exports","./common"],function(a,b){function c(P,N){P[0]=N[0];P[1]=N[1];return P}function g(P,N,R){P[0]=N;P[1]=R;return P}function h(P,N,R){P[0]=N[0]+R[0];P[1]=N[1]+R[1];return P}function w(P,N,R){P[0]=N[0]-R[0];P[1]=N[1]-R[1];return P}function n(P,N,R){P[0]=N[0]*R[0];P[1]=N[1]*R[1];return P}function f(P,N,R){P[0]=N[0]/R[0];P[1]=N[1]/R[1];return P}function l(P,N){P[0]=Math.ceil(N[0]);
P[1]=Math.ceil(N[1]);return P}function k(P,N){P[0]=Math.floor(N[0]);P[1]=Math.floor(N[1]);return P}function e(P,N,R){P[0]=Math.min(N[0],R[0]);P[1]=Math.min(N[1],R[1]);return P}function d(P,N,R){P[0]=Math.max(N[0],R[0]);P[1]=Math.max(N[1],R[1]);return P}function m(P,N){P[0]=Math.round(N[0]);P[1]=Math.round(N[1]);return P}function z(P,N,R){P[0]=N[0]*R;P[1]=N[1]*R;return P}function v(P,N,R,S){P[0]=N[0]+R[0]*S;P[1]=N[1]+R[1]*S;return P}function q(P,N){const R=N[0]-P[0];P=N[1]-P[1];return Math.sqrt(R*
R+P*P)}function t(P,N){const R=N[0]-P[0];P=N[1]-P[1];return R*R+P*P}function r(P){const N=P[0];P=P[1];return Math.sqrt(N*N+P*P)}function x(P){const N=P[0];P=P[1];return N*N+P*P}function u(P,N){P[0]=-N[0];P[1]=-N[1];return P}function E(P,N){P[0]=1/N[0];P[1]=1/N[1];return P}function y(P,N){var R=N[0];const S=N[1];R=R*R+S*S;0<R&&(R=1/Math.sqrt(R),P[0]=N[0]*R,P[1]=N[1]*R);return P}function A(P,N){return P[0]*N[0]+P[1]*N[1]}function p(P,N,R){N=N[0]*R[1]-N[1]*R[0];P[0]=P[1]=0;P[2]=N;return P}function B(P,
N,R,S){const T=N[0];N=N[1];P[0]=T+S*(R[0]-T);P[1]=N+S*(R[1]-N);return P}function D(P,N){N=N||1;const R=2*b.RANDOM()*Math.PI;P[0]=Math.cos(R)*N;P[1]=Math.sin(R)*N;return P}function C(P,N,R){const S=N[0];N=N[1];P[0]=R[0]*S+R[2]*N;P[1]=R[1]*S+R[3]*N;return P}function F(P,N,R){const S=N[0];N=N[1];P[0]=R[0]*S+R[2]*N+R[4];P[1]=R[1]*S+R[3]*N+R[5];return P}function G(P,N,R){const S=N[0];N=N[1];P[0]=R[0]*S+R[3]*N+R[6];P[1]=R[1]*S+R[4]*N+R[7];return P}function L(P,N,R){const S=N[0];N=N[1];P[0]=R[0]*S+R[4]*
N+R[12];P[1]=R[1]*S+R[5]*N+R[13];return P}function H(P,N,R,S){const T=N[0]-R[0];N=N[1]-R[1];const V=Math.sin(S);S=Math.cos(S);P[0]=T*S-N*V+R[0];P[1]=T*V+N*S+R[1];return P}function M(P,N){var R=P[0];P=P[1];const S=N[0];N=N[1];let T=R*R+P*P;0<T&&(T=1/Math.sqrt(T));let V=S*S+N*N;0<V&&(V=1/Math.sqrt(V));R=(R*S+P*N)*T*V;return 1<R?0:-1>R?Math.PI:Math.acos(R)}function K(P){return"vec2("+P[0]+", "+P[1]+")"}function I(P,N){return P[0]===N[0]&&P[1]===N[1]}function O(P,N){const R=P[0];P=P[1];const S=N[0];N=
N[1];return Math.abs(R-S)<=b.EPSILON*Math.max(1,Math.abs(R),Math.abs(S))&&Math.abs(P-N)<=b.EPSILON*Math.max(1,Math.abs(P),Math.abs(N))}function Q(P,N,R,S,T){let V=N[0]-R[0];R=N[1]-R[1];T=(S[0]*V+S[1]*R)*(T-1);V=S[0]*T;R=S[1]*T;P[0]=N[0]+V;P[1]=N[1]+R;return P}const J=Object.freeze({__proto__:null,copy:c,set:g,add:h,subtract:w,multiply:n,divide:f,ceil:l,floor:k,min:e,max:d,round:m,scale:z,scaleAndAdd:v,distance:q,squaredDistance:t,length:r,squaredLength:x,negate:u,inverse:E,normalize:y,dot:A,cross:p,
lerp:B,random:D,transformMat2:C,transformMat2d:F,transformMat3:G,transformMat4:L,rotate:H,angle:M,str:K,exactEquals:I,equals:O,projectAndScale:Q,len:r,sub:w,mul:n,div:f,dist:q,sqrDist:t,sqrLen:x});a.add=h;a.angle=M;a.ceil=l;a.copy=c;a.cross=p;a.dist=q;a.distance=q;a.div=f;a.divide=f;a.dot=A;a.equals=O;a.exactEquals=I;a.floor=k;a.inverse=E;a.len=r;a.length=r;a.lerp=B;a.max=d;a.min=e;a.mul=n;a.multiply=n;a.negate=u;a.normalize=y;a.projectAndScale=Q;a.random=D;a.rotate=H;a.round=m;a.scale=z;a.scaleAndAdd=
v;a.set=g;a.sqrDist=t;a.sqrLen=x;a.squaredDistance=t;a.squaredLength=x;a.str=K;a.sub=w;a.subtract=w;a.transformMat2=C;a.transformMat2d=F;a.transformMat3=G;a.transformMat4=L;a.vec2=J})},"esri/views/3d/environment/atmosphereUtils":function(){define(["exports","../../../chunks/vec3f64"],function(a,b){const c=b.fromValues(5.802E-6,1.3558E-5,3.31E-5);b=b.fromValues(1.95E-6,5.643E-6,2.55E-7);a.atmosphereHeight=1E5;a.betaMie=3.996E-6;a.betaOzone=b;a.betaRayleigh=c;a.computeInnerAltitudeFade=function(g){return Math.min(1,
Math.max(0,(g-1E5)/9E5))};a.innerAtmosphereDepth=1E4;a.rayLeighScaleHeight=.085;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/ChapmanAtmosphereTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/ChapmanAtmosphere.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){n=function(m){function z(){return m.apply(this,arguments)||this}c._inheritsLoose(z,m);var v=z.prototype;v.initializeProgram=function(q){const t=z.shader.get().build({haze:this.configuration.haze});return new k.Program(q.rctx,t,l.Default3D)};v.initializePipeline=function(){return this.configuration.haze?d.makePipelineState({blending:d.separateBlendingParams(e.BlendFactor.ONE,e.BlendFactor.ZERO,e.BlendFactor.ONE_MINUS_SRC_COLOR,e.BlendFactor.ONE),colorWrite:d.defaultColorWriteParams}):
d.makePipelineState({blending:d.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:e.CompareFunction.LEQUAL},colorWrite:d.defaultColorWriteParams})};return z}(n.ShaderTechnique);n.shader=new w.ReloadableShaderModule(h.ChapmanAtmosphereShader,()=>new Promise((m,z)=>a(["./ChapmanAtmosphere.glsl"],m,z)));h=function(m){function z(){var v=m.apply(this,arguments)||this;v.haze=!1;return v}c._inheritsLoose(z,
m);return z}(f.ShaderTechniqueConfiguration);g.__decorate([f.parameter()],h.prototype,"haze",void 0);b.ChapmanAtmosphereTechnique=n;b.ChapmanAtmosphereTechniqueConfiguration=h;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/ChapmanAtmosphere.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,g,h,w,n){function f(k){const e=new w.ShaderBuilder;e.attributes.add(n.VertexAttribute.POSITION,"vec2");e.include(b.TextureCoordinateAttribute,{attributeTextureCoordinates:b.TextureCoordinateAttributeType.Default});e.varyings.add("worldRay","vec3");e.varyings.add("eyeDir","vec3");e.vertex.uniforms.add("inverseProjectionMatrix","mat4");e.vertex.uniforms.add("inverseViewMatrix","mat4");e.vertex.code.add(h.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`);e.fragment.uniforms.add("lightingMainDirection","vec3").add("radii","vec2").add("scaleHeight","float").add("cameraPosition","vec3").add("nearFar","vec2").add("heightParameters","vec4").add("innerFadeDistance","float").add("altitudeFade","float").add("depthTex","sampler2D").add("betaRayleigh","vec3").add("betaCombined","vec3").add("betaMie","float").add("hazeStrength","float");e.include(g.Gamma);k.haze&&e.fragment.include(c.ReadLinearDepth);e.fragment.code.add(h.glsl`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`);e.fragment.code.add(h.glsl`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`);e.fragment.code.add(h.glsl`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`);e.fragment.code.add(h.glsl`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${k.haze?h.glsl`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${k.haze?h.glsl``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${k.haze?"":h.glsl`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.05968310365 * mumu;

      ${k.haze?h.glsl`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:h.glsl`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.11936620731 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${k.haze?h.glsl`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:h.glsl`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${k.haze?h.glsl`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:h.glsl`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${k.haze?"":h.glsl`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, lightingMainDirection, gl_FragColor);
          }`}
    }
  `);return e}const l=Object.freeze({__proto__:null,build:f});a.ChapmanAtmosphereShader=l;a.build=f})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c){a.TextureCoordinateAttributeType=void 0;(function(g){g[g.None=0]="None";g[g.Default=1]="Default";g[g.Atlas=2]="Atlas";g[g.COUNT=3]="COUNT"})(a.TextureCoordinateAttributeType||(a.TextureCoordinateAttributeType=
{}));a.TextureCoordinateAttribute=function(g,h){h.attributeTextureCoordinates===a.TextureCoordinateAttributeType.Default&&(g.attributes.add(c.VertexAttribute.UV0,"vec2"),g.varyings.add("vuv0","vec2"),g.vertex.code.add(b.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
}`));h.attributeTextureCoordinates===a.TextureCoordinateAttributeType.Atlas&&(g.attributes.add(c.VertexAttribute.UV0,"vec2"),g.varyings.add("vuv0","vec2"),g.attributes.add(c.VertexAttribute.UVREGION,"vec4"),g.varyings.add("vuvRegion","vec4"),g.vertex.code.add(b.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`));h.attributeTextureCoordinates===a.TextureCoordinateAttributeType.None&&g.vertex.code.add(b.glsl`void forwardTextureCoordinates() {}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderModules/interfaces":function(){define(["exports"],function(a){function b(c,...g){let h="";for(let w=0;w<g.length;w++)h+=c[w]+g[w];return h+=c[c.length-1]}(function(c){c.int=function(g){return Math.round(g).toString()};c.float=function(g){return g.toPrecision(8)}})(b||(b=
{}));a.glsl=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/VertexAttribute":function(){define(["exports"],function(a){a.VertexAttribute=void 0;var b=a.VertexAttribute||(a.VertexAttribute={});b.POSITION="position";b.NORMAL="normal";b.UV0="uv0";b.AUXPOS1="auxpos1";b.AUXPOS2="auxpos2";b.MAPPOS="mapPos";b.COLOR="color";b.SYMBOLCOLOR="symbolColor";b.SIZE="size";b.TANGENT="tangent";b.OFFSET="offset";b.SUBDIVISIONFACTOR="subdivisionFactor";b.COLORFEATUREATTRIBUTE="colorFeatureAttribute";
b.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute";b.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute";b.DISTANCETOSTART="distanceToStart";b.UVMAPSPACE="uvMapSpace";b.BOUNDINGRECT="boundingRect";b.UVREGION="uvRegion";b.NORMALCOMPRESSED="normalCompressed";b.PROFILERIGHT="profileRight";b.PROFILEUP="profileUp";b.PROFILEVERTEXANDNORMAL="profileVertexAndNormal";b.FEATUREVALUE="featureValue";b.MODELORIGINHI="modelOriginHi";b.MODELORIGINLO="modelOriginLo";b.MODEL="model";b.MODELNORMAL="modelNormal";b.INSTANCECOLOR=
"instanceColor";b.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute";b.LOCALTRANSFORM="localTransform";b.GLOBALTRANSFORM="globalTransform";b.BOUNDINGSPHERE="boundingSphere";b.MODELORIGIN="modelOrigin";b.MODELSCALEFACTORS="modelScaleFactors";b.FEATUREATTRIBUTE="featureAttribute";b.STATE="state";b.LODLEVEL="lodLevel";b.POSITION0="position0";b.POSITION1="position1";b.NORMALA="normalA";b.NORMALB="normalB";b.COMPONENTINDEX="componentIndex";b.VARIANTOFFSET="variantOffset";b.VARIANTSTROKE="variantStroke";
b.VARIANTEXTENSION="variantExtension";b.U8PADDING="u8padding";b.U16PADDING="u16padding";b.SIDENESS="sideness";b.START="start";b.END="end";b.UP="up";b.EXTRUDE="extrude";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl":function(){define(["exports","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,b,c){a.ReadLinearDepth=function(g){g.include(b.RgbaFloatEncoding);g.code.add(c.glsl`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.RgbaFloatEncoding=function(c){c.code.add(b.glsl`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.Gamma=function(c){c.fragment.code.add(b.glsl`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderModules/ShaderBuilder":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/Logger"],function(a,b,c){const g=c.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");c=function(){function m(){this.includedModules=new Map}m.prototype.include=function(z,v){this.includedModules.has(z)?this.includedModules.get(z)!==v&&g.error("Trying to include shader module multiple times with different sets of options."):
(this.includedModules.set(z,v),z(this.builder,v))};return m}();let h=function(m){function z(){var v=m.apply(this,arguments)||this;v.vertex=new f;v.fragment=new f;v.attributes=new l;v.varyings=new k;v.extensions=new e;v.constants=new d;return v}b._inheritsLoose(z,m);z.prototype.generateSource=function(v){const q=this.extensions.generateSource(v),t=this.attributes.generateSource(v),r=this.varyings.generateSource();var x="vertex"===v?this.vertex:this.fragment;const u=x.uniforms.generateSource(),E=x.code.generateSource();
v="vertex"===v?"precision highp float;\nprecision highp sampler2D;":"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif";x=this.constants.generateSource().concat(x.constants.generateSource());return`\n${q.join("\n")}\n\n${v}\n\n${x.join("\n")}\n\n${u.join("\n")}\n\n${t.join("\n")}\n\n${r.join("\n")}\n\n${E.join("\n")}`};b._createClass(z,[{key:"fragmentUniforms",get:function(){return this.fragment.uniforms}},
{key:"builder",get:function(){return this}}]);return z}(c),w=function(){function m(){this._entries=new Map}var z=m.prototype;z.add=function(v,q,t){this._entries.set(`${v}_${q}_${t}`,{name:v,type:q,arraySize:t});return this};z.generateSource=function(){return Array.from(this._entries.values()).map(v=>{var q=v.arraySize;return`uniform ${v.type} ${v.name}${q?`[${q}]`:""};`})};b._createClass(m,[{key:"entries",get:function(){return Array.from(this._entries.values())}}]);return m}(),n=function(){function m(){this._entries=
[]}var z=m.prototype;z.add=function(v){this._entries.push(v)};z.generateSource=function(){return this._entries};return m}(),f=function(m){function z(){var v=m.apply(this,arguments)||this;v.uniforms=new w;v.code=new n;v.constants=new d;return v}b._inheritsLoose(z,m);b._createClass(z,[{key:"builder",get:function(){return this}}]);return z}(c),l=function(){function m(){this._entries=[]}var z=m.prototype;z.add=function(v,q){this._entries.push([v,q])};z.generateSource=function(v){return"fragment"===v?
[]:this._entries.map(q=>`attribute ${q[1]} ${q[0]};`)};return m}(),k=function(){function m(){this._entries=[]}var z=m.prototype;z.add=function(v,q){this._entries.push([v,q])};z.generateSource=function(){return this._entries.map(v=>`varying ${v[1]} ${v[0]};`)};return m}(),e=function(){function m(){this._entries=new Set}var z=m.prototype;z.add=function(v){this._entries.add(v)};z.generateSource=function(v){const q="vertex"===v?m.ALLOWLIST_VERTEX:m.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(t=>
q.includes(t)).map(t=>`#extension ${t} : enable`)};return m}();e.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"];e.ALLOWLIST_VERTEX=[];let d=function(){function m(){this._entries=[]}var z=m.prototype;z.add=function(v,q,t){let r="ERROR_CONSTRUCTOR_STRING";switch(q){case "float":r=m._numberToFloatStr(t);break;case "int":r=m._numberToIntStr(t);break;case "bool":r=t.toString();break;case "vec2":r=`vec2(${m._numberToFloatStr(t[0])},                            ${m._numberToFloatStr(t[1])})`;
break;case "vec3":r=`vec3(${m._numberToFloatStr(t[0])},                            ${m._numberToFloatStr(t[1])},                            ${m._numberToFloatStr(t[2])})`;break;case "vec4":r=`vec4(${m._numberToFloatStr(t[0])},                            ${m._numberToFloatStr(t[1])},                            ${m._numberToFloatStr(t[2])},                            ${m._numberToFloatStr(t[3])})`;break;case "ivec2":r=`ivec2(${m._numberToIntStr(t[0])},                             ${m._numberToIntStr(t[1])})`;
break;case "ivec3":r=`ivec3(${m._numberToIntStr(t[0])},                             ${m._numberToIntStr(t[1])},                             ${m._numberToIntStr(t[2])})`;break;case "ivec4":r=`ivec4(${m._numberToIntStr(t[0])},                             ${m._numberToIntStr(t[1])},                             ${m._numberToIntStr(t[2])},                             ${m._numberToIntStr(t[3])})`;break;case "mat2":case "mat3":case "mat4":r=`${q}(${Array.prototype.map.call(t,x=>m._numberToFloatStr(x)).join(", ")})`}this._entries.push(`const ${q} ${v} = ${r};`);
return this};m._numberToIntStr=function(v){return v.toFixed(0)};m._numberToFloatStr=function(v){return Number.isInteger(v)?v.toFixed(1):v.toString()};z.generateSource=function(){return Array.from(this._entries)};return m}();a.Code=n;a.Includes=c;a.ShaderBuilder=h;a.Stage=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function g(w,
n){this._module=w;this._loadModule=n}var h=g.prototype;h.get=function(){return this._module};h.reload=function(){var w=b._asyncToGenerator(function*(){return this._module=yield this._loadModule()});return function(){return w.apply(this,arguments)}}();return g}();a.ReloadableShaderModule=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe",
"../../../../webgl/enums"],function(a,b,c,g){let h=function(){function w(f,l,k){this.release=k;l&&(this._config=l.snapshot());this._program=this.initializeProgram(f);this._pipeline=this.initializePipeline(f)}var n=w.prototype;n.destroy=function(){this._program=c.disposeMaybe(this._program);this._pipeline=this._config=null};n.reload=function(f){c.disposeMaybe(this._program);this._program=this.initializeProgram(f);this._pipeline=this.initializePipeline(f)};n.bindPass=function(f,l){};n.bindMaterial=
function(f,l){};n.bindDraw=function(f){};n.bindPipelineState=function(f,l=null,k){f.setPipelineState(this.getPipelineState(l,k))};n.ensureAttributeLocations=function(f){this.program.assertCompatibleVertexAttributeLocations(f)};n.getPipelineState=function(f,l){return this._pipeline};b._createClass(w,[{key:"program",get:function(){return this._program}},{key:"key",get:function(){return this._config.key}},{key:"configuration",get:function(){return this._config}},{key:"primitiveType",get:function(){return g.PrimitiveType.TRIANGLES}}]);
return w}();a.ShaderTechnique=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function g(){this._key="";this._keyDirty=!1;this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[];this._parameterNames||(this._parameterNames=[])}g.prototype.snapshot=function(){const h=this._parameterNames,
w={key:this.key};for(const n of h)w[n]=this[n];return w};b._createClass(g,[{key:"key",get:function(){this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits));return this._key}}]);return g}();a.ShaderTechniqueConfiguration=c;a.parameter=function(g={}){return(h,w)=>{var n,f;h._parameterNames=null!=(n=h._parameterNames)?n:[];h._parameterNames.push(w);const l=h._parameterNames.length-1;n=Math.ceil(Math.log2(g.count||2));const k=null!=(f=h._parameterBits)?f:[0];
let e=0;for(;16<k[e]+n;)e++,e>=k.length&&k.push(0);h._parameterBits=k;const d=k[e],m=(1<<n)-1<<d;k[e]+=n;Object.defineProperty(h,w,{get(){return this[l]},set(z){if(this[l]!==z&&(this[l]=z,this._keyDirty=!0,this._parameterBits[e]=this._parameterBits[e]&~m|+z<<d&m,"number"!==typeof z&&"boolean"!==typeof z))throw"Configuration value for "+w+" must be boolean or number, got "+typeof z;}})}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["exports",
"./VertexAttribute"],function(a,b){b=new Map([[b.VertexAttribute.POSITION,0],[b.VertexAttribute.NORMAL,1],[b.VertexAttribute.UV0,2],[b.VertexAttribute.COLOR,3],[b.VertexAttribute.SIZE,4],[b.VertexAttribute.TANGENT,4],[b.VertexAttribute.AUXPOS1,5],[b.VertexAttribute.SYMBOLCOLOR,5],[b.VertexAttribute.AUXPOS2,6],[b.VertexAttribute.FEATUREATTRIBUTE,6],[b.VertexAttribute.INSTANCEFEATUREATTRIBUTE,6],[b.VertexAttribute.INSTANCECOLOR,7],[b.VertexAttribute.MODEL,8],[b.VertexAttribute.MODELNORMAL,12],[b.VertexAttribute.MODELORIGINHI,
11],[b.VertexAttribute.MODELORIGINLO,15]]);a.Default3D=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Program":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/PooledArray","../../../webgl/checkWebGLError"],function(a,b,c,g,h){let w=function(){function n(l,k,e){this._context=l;this._locations=e;this._textures=new Map;this._freeTextureUnits=new g({deallocator:null});this._glProgram=l.programCache.acquire(k.generateSource("vertex"),
k.generateSource("fragment"),e);this._glProgram.stop=()=>{throw Error("Wrapped _glProgram used directly");};this._fragmentUniforms=h.webglDebugEnabled()?k.fragmentUniforms.entries:null}var f=n.prototype;f.dispose=function(){this._glProgram.dispose()};f.setUniform1b=function(l,k){this._glProgram.setUniform1i(l,k?1:0)};f.setUniform1i=function(l,k){this._glProgram.setUniform1i(l,k)};f.setUniform1f=function(l,k){this._glProgram.setUniform1f(l,k)};f.setUniform1fv=function(l,k){this._glProgram.setUniform1fv(l,
k)};f.setUniform1iv=function(l,k){this._glProgram.setUniform1iv(l,k)};f.setUniform2f=function(l,k,e){this._glProgram.setUniform2f(l,k,e)};f.setUniform2fv=function(l,k){this._glProgram.setUniform2fv(l,k)};f.setUniform2iv=function(l,k){this._glProgram.setUniform2iv(l,k)};f.setUniform3f=function(l,k,e,d){this._glProgram.setUniform3f(l,k,e,d)};f.setUniform3fv=function(l,k){this._glProgram.setUniform3fv(l,k)};f.setUniform3iv=function(l,k){this._glProgram.setUniform3iv(l,k)};f.setUniform4f=function(l,k,
e,d,m){this._glProgram.setUniform4f(l,k,e,d,m)};f.setUniform4fv=function(l,k){this._glProgram.setUniform4fv(l,k)};f.setUniform4iv=function(l,k){this._glProgram.setUniform4iv(l,k)};f.setUniformMatrix3fv=function(l,k){this._glProgram.setUniformMatrix3fv(l,k)};f.setUniformMatrix4fv=function(l,k){this._glProgram.setUniformMatrix4fv(l,k)};f.assertCompatibleVertexAttributeLocations=function(l){l.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")};f.stop=function(){this._textures.clear();
this._freeTextureUnits.clear()};f.bindTexture=function(l,k){if(c.isNone(l)||null==l.glName){if(l=this._textures.get(k))this._context.bindTexture(null,l.unit),this._freeTextureUnit(l),this._textures.delete(k);return null}let e=this._textures.get(k);null==e?(e=this._allocTextureUnit(l),this._textures.set(k,e)):e.texture=l;this._context.useProgram(this);this.setUniform1i(k,e.unit);this._context.bindTexture(l,e.unit);return e.unit};f.rebindTextures=function(){this._context.useProgram(this);this._textures.forEach((l,
k)=>{this._context.bindTexture(l.texture,l.unit);this.setUniform1i(k,l.unit)});c.isSome(this._fragmentUniforms)&&this._fragmentUniforms.forEach(l=>{if(("sampler2D"===l.type||"samplerCube"===l.type)&&!this._textures.has(l.name))throw Error(`Texture sampler ${l.name} has no bound texture`);})};f._allocTextureUnit=function(l){return{texture:l,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}};f._freeTextureUnit=function(l){this._freeTextureUnits.push(l.unit)};b._createClass(n,
[{key:"glName",get:function(){return this._glProgram.glName}},{key:"isCompiled",get:function(){return this._glProgram.isCompiled}}]);return n}();a.Program=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/checkWebGLError":function(){define(["exports","../../core/Error","../../core/has","../../core/Logger"],function(a,b,c,g){function h(f,l){switch(l){case f.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case f.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";
case f.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case f.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case f.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case f.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const w=g.getLogger("esri/views/webgl"),
n=!!c("enable-feature:webgl-debug");a.checkWebGLError=function(f){if(n){const l=f.getError();l&&(f=h(f,l),w.error(new b("webgl-error","WebGL error occured",{message:f,stack:Error().stack})))}};a.hasFeatureFlagWebGLDebug=n;a.webglDebugEnabled=function(){return n};a.webglValidateShadersEnabled=function(){return n};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/renderState":function(){define(["exports","../3d/webgl-engine/lib/basicInterfaces","./enums"],function(a,b,c){function g(K){return p.intern(K)}
function h(K){return B.intern(K)}function w(K){return D.intern(K)}function n(K){return C.intern(K)}function f(K){return F.intern(K)}function l(K){return G.intern(K)}function k(K){return L.intern(K)}function e(K){return H.intern(K)}function d(K){return"["+K.join(",")+"]"}function m(K){return K?d([K.srcRgb,K.srcAlpha,K.dstRgb,K.dstAlpha,K.opRgb,K.opAlpha,K.color.r,K.color.g,K.color.b,K.color.a]):null}function z(K){return K?d([K.face,K.mode]):null}function v(K){return K?d([K.factor,K.units]):null}function q(K){return K?
d([K.func]):null}function t(K){return K?d([K.function.func,K.function.ref,K.function.mask,K.operation.fail,K.operation.zFail,K.operation.zPass]):null}function r(K){return K?d([K.zNear,K.zFar]):null}function x(K){return K?d([K.r,K.g,K.b,K.a]):null}function u(K){return K?d([K.mask]):null}const E={face:c.Face.BACK,mode:c.CullMode.CCW},y={face:c.Face.FRONT,mode:c.CullMode.CCW};var A=function(){function K(I,O){this.makeKey=I;this.makeRef=O;this.interns=new Map}K.prototype.intern=function(I){if(!I)return null;
const O=this.makeKey(I),Q=this.interns;Q.has(O)||Q.set(O,this.makeRef(I));return Q.get(O)};return K}();const p=new A(m,K=>({__tag:"Blending",...K})),B=new A(z,K=>({__tag:"Culling",...K})),D=new A(v,K=>({__tag:"PolygonOffset",...K})),C=new A(q,K=>({__tag:"DepthTest",...K})),F=new A(t,K=>({__tag:"StencilTest",...K})),G=new A(r,K=>({__tag:"DepthWrite",...K})),L=new A(x,K=>({__tag:"ColorWrite",...K})),H=new A(u,K=>({__tag:"StencilWrite",...K})),M=new A(function(K){return K?d([m(K.blending),z(K.culling),
v(K.polygonOffset),q(K.depthTest),t(K.stencilTest),r(K.depthWrite),x(K.colorWrite),u(K.stencilWrite)]):null},K=>({blending:g(K.blending),culling:h(K.culling),polygonOffset:w(K.polygonOffset),depthTest:n(K.depthTest),stencilTest:f(K.stencilTest),depthWrite:l(K.depthWrite),colorWrite:k(K.colorWrite),stencilWrite:e(K.stencilWrite)}));A=function(){function K(O){this._stencilWriteInvalid=this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=this._polygonOffsetInvalid=
this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=O}var I=K.prototype;I.setPipeline=function(O){if(this._pipelineInvalid||O!==this._pipeline)this._setBlending(O.blending),this._setCulling(O.culling),this._setPolygonOffset(O.polygonOffset),this._setDepthTest(O.depthTest),this._setStencilTest(O.stencilTest),this._setDepthWrite(O.depthWrite),this._setColorWrite(O.colorWrite),this._setStencilWrite(O.stencilWrite),this._pipeline=O;this._pipelineInvalid=!1};I.invalidateBlending=
function(){this._pipelineInvalid=this._blendingInvalid=!0};I.invalidateCulling=function(){this._pipelineInvalid=this._cullingInvalid=!0};I.invalidatePolygonOffset=function(){this._pipelineInvalid=this._polygonOffsetInvalid=!0};I.invalidateDepthTest=function(){this._pipelineInvalid=this._depthTestInvalid=!0};I.invalidateStencilTest=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};I.invalidateDepthWrite=function(){this._pipelineInvalid=this._depthWriteInvalid=!0};I.invalidateColorWrite=
function(){this._pipelineInvalid=this._colorWriteInvalid=!0};I.invalidateStencilWrite=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};I._setBlending=function(O){this._blending=this._setSubState(O,this._blending,this._blendingInvalid,this._stateSetters.setBlending);this._blendingInvalid=!1};I._setCulling=function(O){this._culling=this._setSubState(O,this._culling,this._cullingInvalid,this._stateSetters.setCulling);this._cullingInvalid=!1};I._setPolygonOffset=function(O){this._polygonOffset=
this._setSubState(O,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1};I._setDepthTest=function(O){this._depthTest=this._setSubState(O,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);this._depthTestInvalid=!1};I._setStencilTest=function(O){this._stencilTest=this._setSubState(O,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest);this._stencilTestInvalid=!1};I._setDepthWrite=function(O){this._depthWrite=
this._setSubState(O,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=!1};I._setColorWrite=function(O){this._colorWrite=this._setSubState(O,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite);this._colorWriteInvalid=!1};I._setStencilWrite=function(O){this._stencilWrite=this._setSubState(O,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite);this._stencilTestInvalid=!1};I._setSubState=function(O,Q,J,
P){if(J||O!==Q)P(O),this._pipelineInvalid=!0;return O};return K}();a.StateTracker=A;a.backFaceCullingParams=E;a.cullingParams=K=>K===b.CullFaceOptions.Back?E:K===b.CullFaceOptions.Front?y:null;a.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0};a.defaultDepthWriteParams={zNear:0,zFar:1};a.frontFaceCullingParams=y;a.makeBlending=g;a.makeColorWrite=k;a.makeCulling=h;a.makeDepthTest=n;a.makeDepthWrite=l;a.makePipelineState=function(K){return M.intern(K)};a.makePolygonOffset=w;a.makeStencilTest=f;a.makeStencilWrite=
e;a.separateBlendingParams=function(K,I,O,Q,J=c.BlendOperation.ADD,P=c.BlendOperation.ADD,N=[0,0,0,0]){return{srcRgb:K,srcAlpha:I,dstRgb:O,dstAlpha:Q,opRgb:J,opAlpha:P,color:{r:N[0],g:N[1],b:N[2],a:N[3]}}};a.simpleBlendingParams=function(K,I,O=c.BlendOperation.ADD,Q=[0,0,0,0]){return{srcRgb:K,srcAlpha:K,dstRgb:I,dstAlpha:I,opRgb:O,opAlpha:O,color:{r:Q[0],g:Q[1],b:Q[2],a:Q[3]}}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/basicInterfaces":function(){define(["exports"],
function(a){a.CullFaceOptions=void 0;(function(b){b[b.None=0]="None";b[b.Front=1]="Front";b[b.Back=2]="Back";b[b.COUNT=3]="COUNT"})(a.CullFaceOptions||(a.CullFaceOptions={}));a.DepthTestFunction=void 0;(function(b){b[b.Less=0]="Less";b[b.Lequal=1]="Lequal";b[b.COUNT=2]="COUNT"})(a.DepthTestFunction||(a.DepthTestFunction={}));a.AntiAliasingMode=void 0;(function(b){b[b.NONE=0]="NONE";b[b.SMAA=1]="SMAA"})(a.AntiAliasingMode||(a.AntiAliasingMode={}));a.TransparencyPassType=void 0;(function(b){b[b.Color=
0]="Color";b[b.Alpha=1]="Alpha";b[b.FrontFace=2]="FrontFace";b[b.NONE=3]="NONE";b[b.COUNT=4]="COUNT"})(a.TransparencyPassType||(a.TransparencyPassType={}));a.RenderRequestType=void 0;(function(b){b[b.BACKGROUND=0]="BACKGROUND";b[b.UPDATE=1]="UPDATE"})(a.RenderRequestType||(a.RenderRequestType={}));a.ResourceState=void 0;(function(b){b[b.NOT_LOADED=0]="NOT_LOADED";b[b.LOADING=1]="LOADING";b[b.LOADED=2]="LOADED"})(a.ResourceState||(a.ResourceState={}));a.StencilBits=void 0;(function(b){b[b.IntegratedMeshMaskExcluded=
1]="IntegratedMeshMaskExcluded";b[b.OutlineVisualElementMask=2]="OutlineVisualElementMask"})(a.StencilBits||(a.StencilBits={}));a.UpdatePolicy=void 0;(function(b){b[b.ASYNC=0]="ASYNC";b[b.SYNC=1]="SYNC"})(a.UpdatePolicy||(a.UpdatePolicy={}));a.Object3DState=void 0;(function(b){b[b.Highlight=0]="Highlight";b[b.MaskOccludee=1]="MaskOccludee";b[b.COUNT=2]="COUNT"})(a.Object3DState||(a.Object3DState={}));a.PrimitiveType=void 0;(function(b){b[b.Triangle=0]="Triangle";b[b.Point=1]="Point";b[b.Line=2]="Line"})(a.PrimitiveType||
(a.PrimitiveType={}));a.PowerOfTwoResizeMode=void 0;(function(b){b[b.STRETCH=1]="STRETCH";b[b.PAD=2]="PAD"})(a.PowerOfTwoResizeMode||(a.PowerOfTwoResizeMode={}));a.ValidationState=void 0;(function(b){b[b.CHANGED=0]="CHANGED";b[b.UNCHANGED=1]="UNCHANGED"})(a.ValidationState||(a.ValidationState={}));a.AlphaDiscardMode=void 0;(function(b){b[b.Blend=0]="Blend";b[b.Opaque=1]="Opaque";b[b.Mask=2]="Mask";b[b.MaskBlend=3]="MaskBlend";b[b.COUNT=4]="COUNT"})(a.AlphaDiscardMode||(a.AlphaDiscardMode={}));a.Decorations=
void 0;(function(b){b[b.OFF=0]="OFF";b[b.ON=1]="ON"})(a.Decorations||(a.Decorations={}));Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["exports","./VertexAttribute","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,b,c,g){const h=[new g.VertexElementDescriptor(b.VertexAttribute.POSITION,3,c.DataType.FLOAT,0,12)],w=[new g.VertexElementDescriptor(b.VertexAttribute.POSITION,3,c.DataType.FLOAT,
0,20),new g.VertexElementDescriptor(b.VertexAttribute.UV0,2,c.DataType.FLOAT,12,20)],n=[new g.VertexElementDescriptor(b.VertexAttribute.POSITION,3,c.DataType.FLOAT,0,32),new g.VertexElementDescriptor(b.VertexAttribute.NORMAL,3,c.DataType.FLOAT,12,32),new g.VertexElementDescriptor(b.VertexAttribute.UV0,2,c.DataType.FLOAT,24,32)],f=[new g.VertexElementDescriptor(b.VertexAttribute.POSITION,3,c.DataType.FLOAT,0,16),new g.VertexElementDescriptor(b.VertexAttribute.COLOR,4,c.DataType.UNSIGNED_BYTE,12,16)],
l=[new g.VertexElementDescriptor(b.VertexAttribute.POSITION,2,c.DataType.FLOAT,0,8)];b=[new g.VertexElementDescriptor(b.VertexAttribute.POSITION,2,c.DataType.FLOAT,0,16),new g.VertexElementDescriptor(b.VertexAttribute.UV0,2,c.DataType.FLOAT,8,16)];a.Pos2=l;a.Pos2Tex=b;a.Pos3=h;a.Pos3Col=f;a.Pos3NormalTex=n;a.Pos3Tex=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/VertexElementDescriptor":function(){define(["exports"],function(a){a.VertexElementDescriptor=function(b,c,g,h,w,
n=!1,f=0){this.name=b;this.count=c;this.type=g;this.offset=h;this.stride=w;this.normalized=n;this.divisor=f};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("exports ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),function(a,b,c,g,h,w,n){a.createColorTexture=function(f,l,k=4){const e=new Uint8Array(k*k*4);
for(let d=0;d<e.length;d+=4)e[d+0]=255*l[0],e[d+1]=255*l[1],e[d+2]=255*l[2],e[d+3]=255*l[3];return new w.Texture(f,{target:h.TextureType.TEXTURE_2D,pixelFormat:h.PixelFormat.RGBA,dataType:h.PixelType.UNSIGNED_BYTE,samplingMode:h.TextureSamplingMode.NEAREST,width:k,height:k},e)};a.createEmptyDepthTexture=function(f){return new w.Texture(f,{target:h.TextureType.TEXTURE_2D,pixelFormat:h.PixelFormat.RGBA,dataType:h.PixelType.UNSIGNED_BYTE,samplingMode:h.TextureSamplingMode.NEAREST,width:1,height:1},new Uint8Array([255,
255,255,255]))};a.createEmptyTexture=function(f,l=4){return new w.Texture(f,{target:h.TextureType.TEXTURE_2D,pixelFormat:h.PixelFormat.RGBA,dataType:h.PixelType.UNSIGNED_BYTE,samplingMode:h.TextureSamplingMode.NEAREST,width:l,height:l})};a.createQuadVAO=function(f,l=c.Pos2,k=b.Default3D,e=-1,d=1){let m=null;switch(l){case c.Pos2Tex:m=new Float32Array([e,e,0,0,d,e,1,0,e,d,0,1,d,d,1,1]);break;default:m=new Float32Array([e,e,d,e,e,d,d,d])}return new n.VertexArrayObject(f,k,{geometry:l},{geometry:g.BufferObject.createVertex(f,
h.Usage.STATIC_DRAW,m)})};a.createScreenSizeTriangleVAO=function(f,l=c.Pos2,k=b.Default3D){const e=new Float32Array([-1,-1,3,-1,-1,3]);return new n.VertexArrayObject(f,k,{geometry:l},{geometry:g.BufferObject.createVertex(f,h.Usage.STATIC_DRAW,e)})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/BufferObject":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/arrayUtils ../../core/Logger ../../core/maybe ../../core/typedArrayUtil ./checkWebGLError ./context-util ./enums".split(" "),
function(a,b,c,g,h,w,n,f,l){const k=g.getLogger("esri.views.webgl.BufferObject");g=function(){function e(m,z,v,q){this._context=m;this.bufferType=z;this.usage=v;this._glName=null;this._size=-1;this._indexType=void 0;m.instanceCounter.increment(l.ResourceType.Buffer,this);this._glName=this._context.gl.createBuffer();n.checkWebGLError(this._context.gl);q&&this.setData(q)}e.createIndex=function(m,z,v){return new e(m,l.BufferType.ELEMENT_ARRAY_BUFFER,z,v)};e.createVertex=function(m,z,v){return new e(m,
l.BufferType.ARRAY_BUFFER,z,v)};e.createUniform=function(m,z,v){if(m.type!==f.ContextType.WEBGL2)throw Error("Uniform buffers are supported in WebGL2 only!");return new e(m,l.BufferType.UNIFORM_BUFFER,z,v)};e.createPixelPack=function(m,z=l.Usage.STREAM_READ,v){if(m.type!==f.ContextType.WEBGL2)throw Error("Pixel pack buffers are supported in WebGL2 only!");m=new e(m,l.BufferType.PIXEL_PACK_BUFFER,z);v&&m.setSize(v);return m};e.createPixelUnpack=function(m,z=l.Usage.STREAM_DRAW,v){if(m.type!==f.ContextType.WEBGL2)throw Error("Pixel unpack buffers are supported in WebGL2 only!");
return new e(m,l.BufferType.PIXEL_UNPACK_BUFFER,z,v)};var d=e.prototype;d.dispose=function(){var m;null!=(m=this._context)&&m.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(l.ResourceType.Buffer,this),this._context=null):this._glName&&k.warn("Leaked WebGL buffer object")};d.setSize=function(m,z=null){0>=m&&k.error("Buffer size needs to be positive!");if(this.bufferType===l.BufferType.ELEMENT_ARRAY_BUFFER&&h.isSome(z))switch(this._indexType=
z,z){case l.DataType.UNSIGNED_SHORT:m*=2;break;case l.DataType.UNSIGNED_INT:m*=4}this._setBufferData(m)};d.setData=function(m){if(m){var z=m.byteLength;this.bufferType===l.BufferType.ELEMENT_ARRAY_BUFFER&&(w.isUint16Array(m)&&(z/=2,this._indexType=l.DataType.UNSIGNED_SHORT),w.isUint32Array(m)&&(z/=4,this._indexType=l.DataType.UNSIGNED_INT));this._setBufferData(z,m)}};d._setBufferData=function(m,z=null){this._size=m;const v=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);
this._context.bindBuffer(this);const q=this._context.gl;h.isSome(z)?q.bufferData(this.bufferType,z,this.usage):q.bufferData(this.bufferType,m,this.usage);n.checkWebGLError(q);this._isVAOAware&&this._context.bindVAO(v)};d.setSubData=function(m,z=0,v=0,q=m.byteLength){if(m){(0>z||z>=this._size)&&k.error("offset is out of range!");var t=z,r=v,x=q,u=m.byteLength;this.bufferType===l.BufferType.ELEMENT_ARRAY_BUFFER&&(w.isUint16Array(m)?(u/=2,t*=2,r*=2,x*=2):w.isUint32Array(m)&&(u/=4,t*=4,r*=4,x*=4));void 0===
q&&(q=u-1);v>=q&&k.error("end must be bigger than start!");z+v-q>this._size&&k.error("An attempt to write beyond the end of the buffer!");z=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);v=this._context.gl;q=ArrayBuffer.isView(m)?m.buffer:m;m=0===r&&x===m.byteLength?q:q.slice(r,x);v.bufferSubData(this.bufferType,t,m);n.checkWebGLError(v);this._isVAOAware&&this._context.bindVAO(z)}};d.setSubDataFromView=function(m,z,v,q){if(m){(0>z||z>=this._size)&&
k.error("offset is out of range!");v>=q&&k.error("end must be bigger than start!");z+v-q>this._size&&k.error("An attempt to write beyond the end of the buffer!");var t=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);var r=this._context.gl;this._context.type===f.ContextType.WEBGL2?r.bufferSubData(this.bufferType,z*m.BYTES_PER_ELEMENT,m,v,q-v):(v=0===v&&q===m.length?m:m.subarray(v,q),r.bufferSubData(this.bufferType,z*m.BYTES_PER_ELEMENT,v));n.checkWebGLError(r);
this._isVAOAware&&this._context.bindVAO(t)}};d.getSubData=function(m,z=0,v,q){if(this._context.type!==f.ContextType.WEBGL2)k.error("Get buffer subdata is supported in WebGL2 only!");else if(0>v||0>q)k.error("Problem getting subdata: offset and length were less than zero!");else{var t=c.isArrayLike(m)?m.BYTES_PER_ELEMENT:1;t*((null!=v?v:0)+(null!=q?q:0))>m.byteLength?k.error("Problem getting subdata: offset and length exceeded destination size!"):(z+t*(null!=q?q:0)>this.byteSize&&k.warn("Potential problem getting subdata: requested data exceeds buffer size!"),
t=this._context.gl,this._context.bindBuffer(this,l.BufferType.COPY_READ_BUFFER),t.getBufferSubData(l.BufferType.COPY_READ_BUFFER,z,m,v,q),this._context.unbindBuffer(l.BufferType.COPY_READ_BUFFER))}};d.getSubDataAsync=function(){var m=b._asyncToGenerator(function*(z,v=0,q,t){this._context.type!==f.ContextType.WEBGL2?k.error("Get buffer subdata is supported in WebGL2 only!"):(yield this._context.clientWaitAsync(),this.getSubData(z,v,q,t))});return function(z){return m.apply(this,arguments)}}();b._createClass(e,
[{key:"glName",get:function(){return this._glName}},{key:"size",get:function(){return this._size}},{key:"indexType",get:function(){return this._indexType}},{key:"byteSize",get:function(){return this.bufferType===l.BufferType.ELEMENT_ARRAY_BUFFER?this._indexType===l.DataType.UNSIGNED_INT?4*this._size:2*this._size:this._size}},{key:"_isVAOAware",get:function(){return this.bufferType===l.BufferType.ELEMENT_ARRAY_BUFFER||this.bufferType===l.BufferType.ARRAY_BUFFER}}]);return e}();a.BufferObject=g;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/webgl/Texture":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/mathUtils ../../core/maybe ./checkWebGLError ./context-util ./enums ./capabilities/isWebGL2Context".split(" "),function(a,b,c,g,h,w,n,f,l){function k(z){return h.isSome(z)&&"type"in z&&"compressed"===z.type}function e(z){var v;if(v=h.isSome(z)&&!k(z))v=!(h.isSome(z)&&"byteLength"in z);return v}function d(z){return z===f.TextureType.TEXTURE_3D||z===f.TextureType.TEXTURE_2D_ARRAY}
function m(z,v,q,t=1){v=Math.max(v,q);z===f.TextureType.TEXTURE_3D&&(v=Math.max(v,t));return Math.round(Math.log(v)/Math.LN2)+1}c=function(){function z(q,t,r=null){this._context=q;this.type="texture";this._glName=null;this._descriptor=void 0;this._wasImmutablyAllocated=this._wrapModeDirty=this._samplingModeDirty=!1;q.instanceCounter.increment(f.ResourceType.Texture,this);this._descriptor={target:f.TextureType.TEXTURE_2D,samplingMode:f.TextureSamplingMode.LINEAR,wrapMode:f.TextureWrapMode.REPEAT,flipped:!1,
hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1,...t};if(q.type!==n.ContextType.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),d(this._descriptor.target)))throw Error("3D and array textures are not supported in WebGL1");this._descriptor.target===f.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}var v=z.prototype;v.dispose=function(){this._context.gl&&this._glName&&(this._context.unbindTextureAllUnits(this),this._context.gl.deleteTexture(this._glName),
this._glName=null,this._context.instanceCounter.decrement(f.ResourceType.Texture,this))};v.release=function(){this.dispose()};v.resize=function(q,t){const r=this._descriptor;if(r.width!==q||r.height!==t){if(this._wasImmutablyAllocated)throw Error("Immutable textures can't be resized!");r.width=q;r.height=t;this._descriptor.target===f.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}};v._setDataCubeMap=function(q=null){for(let t=f.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X;t<=
f.TextureType.TEXTURE_CUBE_MAP_NEGATIVE_Z;t++)this._setData(q,t)};v.setData=function(q){this._setData(q)};v._setData=function(q,t){var r;if(this._context&&this._context.gl){var x=this._context.gl;this._glName||(this._glName=x.createTexture());void 0===q&&(q=null);var u=this._descriptor;null!=(r=t)?r:t=u.target;r=d(t);if(null===q&&(u.width=u.width||4,u.height=u.height||4,r)){var E;u.depth=null!=(E=u.depth)?E:1}E=this._context.bindTexture(this,z.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(z.TEXTURE_UNIT_FOR_UPDATES);
z._validateTexture(this._context,u);this._configurePixelStorage();var y=u.pixelFormat,A=u.internalFormat?u.internalFormat:this._deriveInternalFormat(y,u.dataType);if(e(q)){y=q.width;let p=q.height;q instanceof HTMLVideoElement&&(y=q.videoWidth,p=q.videoHeight);u.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(t,A,u.hasMipmap,y,p,1);this._texImage(t,0,A,y,p,1,q);w.checkWebGLError(x);u.hasMipmap&&this.generateMipmap();void 0===u.width&&(u.width=y);void 0===u.height&&(u.height=p);r&&void 0===
u.depth&&(u.depth=1)}else{const {width:p,height:B,depth:D}=u;null!=p&&null!=B||console.error("Width and height must be specified!");r&&null==D&&console.error("Depth must be specified!");u.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(t,A,u.hasMipmap,p,B,D);x.DEPTH24_STENCIL8&&A===x.DEPTH_STENCIL&&(A=x.DEPTH24_STENCIL8);if(k(q)){const C=q.levels;q=m(t,p,B,D);r=Math.min(q-1,C.length-1);l(x)?x.texParameteri(u.target,x.TEXTURE_MAX_LEVEL,r):u.hasMipmap=u.hasMipmap&&q===C.length;const F=A;
if(!(F in f.CompressedTextureFormat))throw Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel((G,L,H,M)=>{this._compressedTexImage(t,G,F,L,H,M,C[Math.min(G,C.length-1)])},r)}else h.isSome(q)?(this._texImage(t,0,A,p,B,D,q),w.checkWebGLError(x),u.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((C,F,G,L)=>{this._texImage(t,C,A,F,G,L,null);w.checkWebGLError(x)})}z._applySamplingMode(x,this._descriptor);z._applyWrapMode(x,this._descriptor);z._applyAnisotropicFilteringParameters(this._context,
this._descriptor);w.checkWebGLError(x);this._context.bindTexture(E,z.TEXTURE_UNIT_FOR_UPDATES)}};v.updateData=function(q,t,r,x,u,E){E||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");const y=this._context.gl,A=this._descriptor,{pixelFormat:p,internalFormat:B,dataType:D,isImmutable:C,target:F}=A;if(C&&!this._wasImmutablyAllocated)throw Error("Cannot update immutable texture before allocation!");const G=this._context.bindTexture(this,
z.TEXTURE_UNIT_FOR_UPDATES);(0>t||0>r||x>A.width||u>A.height||t+x>A.width||r+u>A.height)&&console.error("An attempt to update out of bounds of the texture!");this._configurePixelStorage();e(E)?y.texSubImage2D(F,q,t,r,p,D,E):k(E)?y.compressedTexSubImage2D(F,q,t,r,x,u,B,E.levels[q]):y.texSubImage2D(F,q,t,r,x,u,p,D,E);this._context.bindTexture(G,z.TEXTURE_UNIT_FOR_UPDATES)};v.updateData3D=function(q,t,r,x,u,E,y,A){A||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");
const p=this._context.gl;if(!l(p))throw Error("3D textures are not supported in WebGL1");const B=this._descriptor,{pixelFormat:D,dataType:C,isImmutable:F,target:G,internalFormat:L}=B;if(F&&!this._wasImmutablyAllocated)throw Error("Cannot update immutable texture before allocation!");d(G)||console.warn("Attempting to set 3D texture data on a non-3D texture");const H=this._context.bindTexture(this,z.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(z.TEXTURE_UNIT_FOR_UPDATES);(0>t||0>r||0>x||
u>B.width||E>B.height||y>B.depth||t+u>B.width||r+E>B.height||x+y>B.depth)&&console.error("An attempt to update out of bounds of the texture!");this._configurePixelStorage();k(A)?(A=A.levels[q],p.compressedTexSubImage3D(G,q,t,r,x,u,E,y,L,A)):p.texSubImage3D(G,q,t,r,x,u,E,y,D,C,A);this._context.bindTexture(H,z.TEXTURE_UNIT_FOR_UPDATES)};v.generateMipmap=function(){const q=this._descriptor;if(!q.hasMipmap){if(this._wasImmutablyAllocated)throw Error("Cannot add mipmaps to immutable texture after allocation");
this._samplingModeDirty=q.hasMipmap=!0;z._validateTexture(this._context,q)}q.samplingMode===f.TextureSamplingMode.LINEAR?(this._samplingModeDirty=!0,q.samplingMode=f.TextureSamplingMode.LINEAR_MIPMAP_NEAREST):q.samplingMode===f.TextureSamplingMode.NEAREST&&(this._samplingModeDirty=!0,q.samplingMode=f.TextureSamplingMode.NEAREST_MIPMAP_NEAREST);const t=this._context.bindTexture(this,z.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(z.TEXTURE_UNIT_FOR_UPDATES);this._context.gl.generateMipmap(q.target);
this._context.bindTexture(t,z.TEXTURE_UNIT_FOR_UPDATES)};v.setSamplingMode=function(q){q!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=q,this._samplingModeDirty=!0)};v.setWrapMode=function(q){q!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=q,z._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)};v.applyChanges=function(){const q=this._context.gl,t=this._descriptor;this._samplingModeDirty&&(z._applySamplingMode(q,t),this._samplingModeDirty=!1);this._wrapModeDirty&&
(z._applyWrapMode(q,t),this._wrapModeDirty=!1)};v._deriveInternalFormat=function(q,t){if(this._context.type===n.ContextType.WEBGL1)return q;switch(t){case f.PixelType.FLOAT:switch(q){case f.PixelFormat.RGBA:return f.SizedPixelFormat.RGBA32F;case f.PixelFormat.RGB:return f.SizedPixelFormat.RGB32F;default:throw Error("Unable to derive format");}case f.PixelType.UNSIGNED_BYTE:switch(q){case f.PixelFormat.RGBA:return f.SizedPixelFormat.RGBA8;case f.PixelFormat.RGB:return f.SizedPixelFormat.RGB8}default:return q}};
v._configurePixelStorage=function(){const q=this._context.gl,{unpackAlignment:t,flipped:r,preMultiplyAlpha:x}=this._descriptor;q.pixelStorei(q.UNPACK_ALIGNMENT,t);q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,r?1:0);q.pixelStorei(q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,x?1:0)};v._texStorage=function(q,t,r,x,u,E){const y=this._context.gl;if(!l(y))throw Error("Immutable textures are not supported in WebGL1");if(!(t in f.SizedPixelFormat))throw Error("Immutable textures must have a sized internal format");this._descriptor.isImmutable&&
(r=r?m(q,x,u,E):1,d(q)?y.texStorage3D(q,r,t,x,u,E):y.texStorage2D(q,r,t,x,u),this._wasImmutablyAllocated=!0)};v._texImage=function(q,t,r,x,u,E,y){const A=this._context.gl;let p=null;const B=this._context.type===n.ContextType.WEBGL2,D=d(q),{isImmutable:C,pixelFormat:F,dataType:G}=this._descriptor;B&&(p=A);!B&&e(y)?A.texImage2D(q,0,r,F,G,y):C?h.isSome(y)&&(D?p.texSubImage3D(q,t,0,0,0,x,u,E,F,G,y):A.texSubImage2D(q,t,0,0,x,u,F,G,y)):(y=h.unwrap(y),D?p.texImage3D(q,t,r,x,u,E,0,F,G,y):A.texImage2D(q,t,
r,x,u,0,F,G,y))};v._compressedTexImage=function(q,t,r,x,u,E,y){const A=this._context.gl;let p=null;const B=d(q),D=this._descriptor.isImmutable;if(B){if(this._context.type!==n.ContextType.WEBGL2)throw Error("3D textures are not supported in WebGL1");p=A}D?h.isSome(y)&&(B?p.compressedTexSubImage3D(q,t,0,0,0,x,u,E,r,y):A.compressedTexSubImage2D(q,t,0,0,x,u,r,y)):B?p.compressedTexImage3D(q,t,r,x,u,E,0,y):A.compressedTexImage2D(q,t,r,x,u,0,y)};v._forEachMipmapLevel=function(q,t=Infinity){let {width:r,
height:x,depth:u,hasMipmap:E,target:y}=this._descriptor;const A=y===f.TextureType.TEXTURE_3D;for(let p=0;;++p){q(p,r,x,u);if(!E||1===r&&1===x&&(!A||1===u)||p>=t)break;r=Math.max(1,r>>1);x=Math.max(1,x>>1);A&&(u=Math.max(1,u>>1))}};z._validateTexture=function(q,t){(0>t.width||0>t.height||0>t.depth)&&console.error("Negative dimension parameters are not allowed!");q=l(q.gl);const r=g.isPowerOfTwo(t.width)&&g.isPowerOfTwo(t.height);q||!t.isImmutable&&!d(t.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!");
q||r||("number"===typeof t.wrapMode?t.wrapMode!==f.TextureWrapMode.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):(t.wrapMode.s!==f.TextureWrapMode.CLAMP_TO_EDGE||t.wrapMode.t!==f.TextureWrapMode.CLAMP_TO_EDGE)&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),t.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))};z._applySamplingMode=function(q,t){let r=t.samplingMode,x=t.samplingMode;if(r===
f.TextureSamplingMode.LINEAR_MIPMAP_NEAREST||r===f.TextureSamplingMode.LINEAR_MIPMAP_LINEAR)r=f.TextureSamplingMode.LINEAR,t.hasMipmap||(x=f.TextureSamplingMode.LINEAR);else if(r===f.TextureSamplingMode.NEAREST_MIPMAP_NEAREST||r===f.TextureSamplingMode.NEAREST_MIPMAP_LINEAR)r=f.TextureSamplingMode.NEAREST,t.hasMipmap||(x=f.TextureSamplingMode.NEAREST);q.texParameteri(t.target,q.TEXTURE_MAG_FILTER,r);q.texParameteri(t.target,q.TEXTURE_MIN_FILTER,x)};z._applyWrapMode=function(q,t){"number"===typeof t.wrapMode?
(q.texParameteri(t.target,q.TEXTURE_WRAP_S,t.wrapMode),q.texParameteri(t.target,q.TEXTURE_WRAP_T,t.wrapMode)):(q.texParameteri(t.target,q.TEXTURE_WRAP_S,t.wrapMode.s),q.texParameteri(t.target,q.TEXTURE_WRAP_T,t.wrapMode.t))};z._applyAnisotropicFilteringParameters=function(q,t){var r;const x=q.capabilities.textureFilterAnisotropic;x&&q.gl.texParameterf(t.target,x.TEXTURE_MAX_ANISOTROPY,null!=(r=t.maxAnisotropy)?r:1)};b._createClass(z,[{key:"glName",get:function(){return this._glName}},{key:"descriptor",
get:function(){return this._descriptor}},{key:"isDirty",get:function(){return this._samplingModeDirty||this._wrapModeDirty}}]);return z}();c.TEXTURE_UNIT_FOR_UPDATES=0;a.Texture=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/isWebGL2Context":function(){define(function(){return function(a){return window.WebGL2RenderingContext&&a instanceof window.WebGL2RenderingContext}})},"esri/views/webgl/VertexArrayObject":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/Logger ../../core/maybe ./enums ./Util".split(" "),
function(a,b,c,g,h,w){const n=c.getLogger("esri.views.webgl.VertexArrayObject");c=function(){function f(k,e,d,m,z=null){this._context=k;this._locations=e;this._layout=d;this._buffers=m;this._indexBuffer=z;this._glName=null;this._initialized=!1;k.instanceCounter.increment(h.ResourceType.VAO,this)}var l=f.prototype;l.dispose=function(k=!0){if(this._context){if(this._glName){var e,d;const m=null==(e=this._context)?void 0:null==(d=e.capabilities)?void 0:d.vao;m?(m.deleteVertexArray(this._glName),this._glName=
null):n.warn("Leaked WebGL VAO")}this._context.getBoundVAO()===this&&this._context.bindVAO(null);if(k){for(const m in this._buffers)this._buffers[m].dispose(),delete this._buffers[m];this._indexBuffer=g.disposeMaybe(this._indexBuffer)}this._context.instanceCounter.decrement(h.ResourceType.VAO,this);this._context=null}else(this._glName||k&&0<Object.getOwnPropertyNames(this._buffers).length)&&n.warn("Leaked WebGL VAO")};l.initialize=function(){if(!this._initialized){var k=this._context.capabilities.vao;
if(k){const e=k.createVertexArray();k.bindVertexArray(e);this._bindLayout();k.bindVertexArray(null);this._glName=e}this._initialized=!0}};l.bind=function(){this.initialize();const k=this._context.capabilities.vao;k?k.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())};l._bindLayout=function(){const {_buffers:k,_layout:e,_indexBuffer:d}=this;k||n.error("Vertex buffer dictionary is empty!");const m=this._context.gl;for(const z in k){const v=k[z];v||n.error("Vertex buffer is uninitialized!");
const q=e[z];q||n.error("Vertex element descriptor is empty!");w.bindVertexBufferLayout(this._context,this._locations,v,q)}g.isSome(d)&&(this._context.capabilities.vao?m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,d.glName):this._context.bindBuffer(d))};l.unbind=function(){this.initialize();const k=this._context.capabilities.vao;k?k.bindVertexArray(null):this._unbindLayout()};l._unbindLayout=function(){const {_buffers:k,_layout:e}=this;k||n.error("Vertex buffer dictionary is empty!");for(const d in k){const m=
k[d];m||n.error("Vertex buffer is uninitialized!");w.unbindVertexBufferLayout(this._context,this._locations,m,e[d])}g.isSome(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)};b._createClass(f,[{key:"glName",get:function(){return this._glName}},{key:"vertexBuffers",get:function(){return this._buffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"size",get:function(){return Object.keys(this._buffers).reduce((k,e)=>k+this._buffers[e].size,g.isSome(this._indexBuffer)?
this._indexBuffer.size:0)}},{key:"layout",get:function(){return this._layout}},{key:"locations",get:function(){return this._locations}}]);return f}();a.VertexArrayObject=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/Util":function(){define(["exports","../../core/has","../../core/maybe","./enums"],function(a,b,c,g){function h(f){return f[0].stride}function w(f){switch(f){case g.PixelFormat.ALPHA:case g.PixelFormat.LUMINANCE:case g.PixelFormat.RED:case g.PixelFormat.RED_INTEGER:case g.SizedPixelFormat.R8:case g.SizedPixelFormat.R8I:case g.SizedPixelFormat.R8UI:case g.SizedPixelFormat.R8_SNORM:case g.RenderbufferFormat.STENCIL_INDEX8:return 1;
case g.PixelFormat.LUMINANCE_ALPHA:case g.PixelFormat.RG:case g.PixelFormat.RG_INTEGER:case g.SizedPixelFormat.RGBA4:case g.SizedPixelFormat.R16F:case g.SizedPixelFormat.R16I:case g.SizedPixelFormat.R16UI:case g.SizedPixelFormat.RG8:case g.SizedPixelFormat.RG8I:case g.SizedPixelFormat.RG8UI:case g.SizedPixelFormat.RG8_SNORM:case g.SizedPixelFormat.RGB565:case g.SizedPixelFormat.RGB5_A1:case g.RenderbufferFormat.DEPTH_COMPONENT16:return 2;case g.PixelFormat.DEPTH_COMPONENT:case g.PixelFormat.RGB:case g.PixelFormat.RGB_INTEGER:case g.SizedPixelFormat.RGB8:case g.SizedPixelFormat.RGB8I:case g.SizedPixelFormat.RGB8UI:case g.SizedPixelFormat.RGB8_SNORM:case g.SizedPixelFormat.SRGB8:case g.RenderbufferFormat.DEPTH_COMPONENT24:return 3;
case g.PixelFormat.DEPTH_STENCIL:case g.PixelFormat.RGBA:case g.PixelFormat.RGBA_INTEGER:case g.SizedPixelFormat.RGBA8:case g.SizedPixelFormat.R32F:case g.SizedPixelFormat.R11F_G11F_B10F:case g.SizedPixelFormat.RG16F:case g.SizedPixelFormat.R32I:case g.SizedPixelFormat.R32UI:case g.SizedPixelFormat.RG16I:case g.SizedPixelFormat.RG16UI:case g.SizedPixelFormat.RGBA8I:case g.SizedPixelFormat.RGBA8UI:case g.SizedPixelFormat.RGBA8_SNORM:case g.SizedPixelFormat.SRGB8_ALPHA8:case g.SizedPixelFormat.RGB9_E5:case g.SizedPixelFormat.RGB10_A2UI:case g.SizedPixelFormat.RGB10_A2:case g.RenderbufferFormat.DEPTH_STENCIL:case g.RenderbufferFormat.DEPTH_COMPONENT32F:case g.RenderbufferFormat.DEPTH24_STENCIL8:return 4;
case g.RenderbufferFormat.DEPTH32F_STENCIL8:return 5;case g.SizedPixelFormat.RGB16F:case g.SizedPixelFormat.RGB16I:case g.SizedPixelFormat.RGB16UI:return 6;case g.SizedPixelFormat.RG32F:case g.SizedPixelFormat.RG32I:case g.SizedPixelFormat.RG32UI:case g.SizedPixelFormat.RGBA16F:case g.SizedPixelFormat.RGBA16I:case g.SizedPixelFormat.RGBA16UI:return 8;case g.SizedPixelFormat.RGB32F:case g.SizedPixelFormat.RGB32I:case g.SizedPixelFormat.RGB32UI:return 12;case g.SizedPixelFormat.RGBA32F:case g.SizedPixelFormat.RGBA32I:case g.SizedPixelFormat.RGBA32UI:return 16;
case g.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT:case g.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case g.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT:case g.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case g.CompressedTextureFormat.COMPRESSED_R11_EAC:case g.CompressedTextureFormat.COMPRESSED_SIGNED_R11_EAC:case g.CompressedTextureFormat.COMPRESSED_RGB8_ETC2:case g.CompressedTextureFormat.COMPRESSED_SRGB8_ETC2:case g.CompressedTextureFormat.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case g.CompressedTextureFormat.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;
case g.CompressedTextureFormat.COMPRESSED_RG11_EAC:case g.CompressedTextureFormat.COMPRESSED_SIGNED_RG11_EAC:case g.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:case g.CompressedTextureFormat.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function n(f){if(c.isNone(f))return 0;if("descriptor"in f)return f.glName?n(f.descriptor):0;const l=f.internalFormat||"pixelFormat"in f&&f.pixelFormat;if(!l)return 0;const k="hasMipmap"in f&&f.hasMipmap?1.3:1;f=f.width*f.height;return w(l)*f*k}a.bindVertexBufferLayout=
function(f,l,k,e,d=0){const m=f.gl,z=f.capabilities.instancing;f.bindBuffer(k);for(const v of e)if(f=l.get(v.name),void 0===f&&console.error(`There is no location for vertex attribute '${v.name}' defined.`),k=d*v.stride,4>=v.count)m.vertexAttribPointer(f,v.count,v.type,v.normalized,v.stride,v.offset+k),m.enableVertexAttribArray(f),0<v.divisor&&z&&z.vertexAttribDivisor(f,v.divisor);else if(9===v.count)for(e=0;3>e;e++)m.vertexAttribPointer(f+e,3,v.type,v.normalized,v.stride,v.offset+12*e+k),m.enableVertexAttribArray(f+
e),0<v.divisor&&z&&z.vertexAttribDivisor(f+e,v.divisor);else if(16===v.count)for(e=0;4>e;e++)m.vertexAttribPointer(f+e,4,v.type,v.normalized,v.stride,v.offset+16*e+k),m.enableVertexAttribArray(f+e),0<v.divisor&&z&&z.vertexAttribDivisor(f+e,v.divisor);else console.error("Unsupported vertex attribute element count: "+v.count)};a.getBytesPerElementFormat=w;a.getErrorString=function(f){f=f.gl;switch(f.getError()){case f.NO_ERROR:return null;case f.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";
case f.INVALID_VALUE:return"A numeric argument is out of range";case f.INVALID_OPERATION:return"The specified command is not allowed for the current state";case f.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case f.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case f.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"};a.getGpuMemoryUsage=n;a.getStride=h;a.unbindVertexBufferLayout=function(f,l,k,e){const d=
f.gl,m=f.capabilities.instancing;f.bindBuffer(k);for(const z of e)if(k=l.get(z.name),4>=z.count)d.disableVertexAttribArray(k),z.divisor&&0<z.divisor&&m&&m.vertexAttribDivisor(k,0);else if(9===z.count)for(e=0;3>e;e++)d.disableVertexAttribArray(k+e),z.divisor&&0<z.divisor&&m&&m.vertexAttribDivisor(k+e,0);else if(16===z.count)for(e=0;4>e;e++)d.disableVertexAttribArray(k+e),z.divisor&&0<z.divisor&&m&&m.vertexAttribDivisor(k+e,0);else console.error("Unsupported vertex attribute element count: "+z.count);
f.unbindBuffer(g.BufferType.ARRAY_BUFFER)};a.vertexCount=function(f,l){return f.vertexBuffers[l].size/h(f.layout[l])};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/CloudsComposition":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/support/axisAngle ./CloudsCompositionTechnique ./weather ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u){function E(L,H,M){L.bindTexture(M.clouds.cubeMap.colorTexture,"cubeMap");L.setUniform1f("cloudsHeight",M.parallax.cloudsHeight);L.setUniformMatrix4fv("rotationMatrixClouds",M.parallax.transform);L.setUniformMatrix4fv("rotationMatrixCloudsCrossFade",M.parallaxNew.transform);L.setUniform3fv("anchorPosition",M.parallax.anchorPointClouds);L.setUniform3fv("anchorPositionCrossFade",M.parallaxNew.anchorPointClouds);M.fadeInOut.stage!==A.FINISHED?L.setUniform1f("totalFadeInOut",
M.fadeInOutHeight.factor+Math.max(h.clamp(M.fadeInOut.factor,0,1))):L.setUniform1f("totalFadeInOut",M.fadeInOutHeight.factor+Math.max(h.clamp(M.fadeIn.factor,0,1)));L.setUniform1f("radiusCurvatureCorrectionFactor",M.parallax.radiusCurvatureCorrectionFactor);L.setUniform1i("crossFade",M.crossFade.stage);L.setUniform1f("crossFadeAnchorFactor",h.clamp(M.crossFade.factor,0,1));L.setUniform1f("radius",M.parallax.radius);L.setUniform3fv("cameraPosition",H.eye)}a.CloudsComposition=function(L){function H(K){var I=
L.call(this,K)||this;I._inverseProjectionMatrix=m.create();I._inverseViewMatrix=m.create();I._technique=new t.CloudsCompositionTechnique(K);I._vao=x.createQuadVAO(K.rctx);I._setDefaultParallax(K.radius);return I}b._inheritsLoose(H,L);var M=H.prototype;M.destroy=function(){this._technique=w.releaseMaybe(this._technique);this._vao=w.disposeMaybe(this._vao)};M.render=function(K,I,O){this._parameters.clouds=I;I=K.camera;if(!w.isNone(this._vao)&&!w.isNone(I)){var Q=K.rctx,J=Q.useTechnique(this._technique);
K.scenelightingData.setLightDirectionUniform(J);K.scenelightingData.setUniforms(J,!1,!1);d.invert(this._inverseProjectionMatrix,I.projectionMatrix);d.invert(this._inverseViewMatrix,I.viewMatrix);J.setUniformMatrix4fv("inverseProjectionMatrix",this._inverseProjectionMatrix);J.setUniformMatrix4fv("inverseViewMatrix",this._inverseViewMatrix);J.setUniform2f("cloudVariables",this._parameters.clouds.coverage,this._parameters.clouds.absorption);this._setParallaxParams(I.eye,O);K.cloudsCompositionParams=
this._parameters;E(J,I,this._parameters);Q.bindVAO(this._vao);J.assertCompatibleVertexAttributeLocations(this._vao);Q.drawArrays(u.PrimitiveType.TRIANGLE_STRIP,0,4)}};M._setDefaultParallax=function(K){this._parameters={parallax:{anchorPointClouds:v.create(),radius:K,cloudsHeight:1E5,radiusCurvatureCorrectionFactor:0,transform:m.create()},parallaxNew:{anchorPointClouds:v.create(),radius:K,cloudsHeight:1E5,radiusCurvatureCorrectionFactor:0,transform:m.create()},crossFade:{stage:p.FINISHED,factor:0,
distanceThresholdFactor:.3},fadeInOut:{stage:A.FINISHED,factor:0,distanceThresholdFactor:.6},fadeIn:{stage:y.FINISHED,factor:0,distanceThresholdFactor:2},fadeInOutHeight:{stage:B.FINISHED,factor:-1},cameraPositionLastFrame:v.create(),startTime:0,startTimeHeightFade:0,clouds:null}};M._isCameraPositionFinal=function(K){return z.equals(this._parameters.cameraPositionLastFrame,K)};M._setFadeInStage=function(K){K=this._isCameraPositionFinal(K);this._parameters.fadeIn.stage===y.FINISHED&&(this._parameters.fadeIn.factor=
1,z.copy(this._parameters.parallax.anchorPointClouds,F),this._parameters.fadeIn.stage=y.CHANGE_ANCHOR,this._parameters.crossFade.stage=p.FINISHED,this._parameters.fadeInOut.stage=A.FINISHED);this._parameters.fadeIn.stage===y.CHANGE_ANCHOR&&K&&(z.copy(this._parameters.parallax.anchorPointClouds,F),this._parameters.fadeIn.stage=y.FADE_IN,this._parameters.startTime=performance.now());0<this._parameters.fadeIn.factor&&this._parameters.fadeIn.stage===y.FADE_IN&&(this._parameters.fadeIn.factor=1-(performance.now()-
this._parameters.startTime)/500);0>=this._parameters.fadeIn.factor&&this._parameters.fadeIn.stage===y.FADE_IN&&(this._parameters.fadeIn.stage=y.FINISHED,this._parameters.fadeIn.factor=0)};M._setCrossFadingStage=function(){this._parameters.crossFade.stage===p.FINISHED&&(z.copy(this._parameters.parallaxNew.anchorPointClouds,F),this._parameters.startTime=performance.now(),this._parameters.crossFade.factor=0,this._parameters.crossFade.stage=p.CROSS_FADE);1>this._parameters.crossFade.factor&&this._parameters.crossFade.stage===
p.CROSS_FADE&&(this._parameters.crossFade.factor=(performance.now()-this._parameters.startTime)/500);1<=this._parameters.crossFade.factor&&this._parameters.crossFade.stage===p.CROSS_FADE&&(this._parameters.crossFade.stage=p.FINISHED,this._parameters.crossFade.factor=1,z.copy(this._parameters.parallax.anchorPointClouds,this._parameters.parallaxNew.anchorPointClouds))};M._setFadeInOutStage=function(K){this._parameters.fadeInOut.stage===A.FINISHED&&(this._parameters.startTime=performance.now(),this._parameters.fadeInOut.factor=
0,this._parameters.fadeInOut.stage=A.FADE_OUT);1>this._parameters.fadeInOut.factor&&this._parameters.fadeInOut.stage===A.FADE_OUT&&(this._parameters.fadeInOut.factor=(performance.now()-this._parameters.startTime)/250);1<=this._parameters.fadeInOut.factor&&this._parameters.fadeInOut.stage===A.FADE_OUT&&(this._parameters.fadeInOut.factor=1,z.copy(this._parameters.parallax.anchorPointClouds,F));1<=this._parameters.fadeInOut.factor&&this._parameters.fadeInOut.stage===A.FADE_OUT&&this._isCameraPositionFinal(K)&&
(this._parameters.startTime=performance.now(),this._parameters.fadeInOut.factor=1,this._parameters.fadeInOut.stage=A.FADE_IN,this._parameters.crossFade.stage=p.FINISHED,this._parameters.crossFade.factor=0);0<this._parameters.fadeInOut.factor&&this._parameters.fadeInOut.stage===A.FADE_IN&&(this._parameters.fadeInOut.factor=1-(performance.now()-this._parameters.startTime)/500);0>=this._parameters.fadeInOut.factor&&this._parameters.fadeInOut.stage===A.FADE_IN&&(this._parameters.fadeInOut.stage=A.FINISHED,
this._parameters.fadeInOut.factor=0)};M._setFadeInOutHeight=function(K){const I=performance.now();this._parameters.startTimeHeightFade=this._parameters.fadeInOutHeight.stage===B.FINISHED?I:this._parameters.startTimeHeightFade;this._parameters.fadeInOutHeight.factor=K?this._parameters.fadeInOutHeight.factor+(I-this._parameters.startTimeHeightFade)/500:this._parameters.fadeInOutHeight.factor-(I-this._parameters.startTimeHeightFade)/500;this._parameters.startTimeHeightFade=I;this._parameters.fadeInOutHeight.factor=
h.clamp(this._parameters.fadeInOutHeight.factor,0,1);this._parameters.fadeInOutHeight.stage=B.HEIGHT_FADE};M._setParallaxParams=function(K,I){0>this._parameters.fadeInOutHeight.factor&&(this._parameters.fadeInOutHeight.factor=z.length(K)-this._parameters.parallax.radius>r.weatherHeightLimit?1:0);z.normalize(F,K);z.scale(F,F,this._parameters.parallax.radius);0===this._parameters.parallax.anchorPointClouds[0]&&0===this._parameters.parallax.anchorPointClouds[1]&&0===this._parameters.parallax.anchorPointClouds[2]&&
z.copy(this._parameters.parallax.anchorPointClouds,F);var O=z.length(z.subtract(G,this._parameters.parallax.anchorPointClouds,F));let Q=!0;O>this._parameters.fadeIn.distanceThresholdFactor*this._parameters.parallax.cloudsHeight||this._parameters.fadeIn.stage!==y.FINISHED?this._setFadeInStage(K):O>this._parameters.fadeInOut.distanceThresholdFactor*this._parameters.parallax.cloudsHeight||this._parameters.fadeInOut.stage!==A.FINISHED?this._setFadeInOutStage(K):O>this._parameters.crossFade.distanceThresholdFactor*
this._parameters.parallax.cloudsHeight&&!I||this._parameters.crossFade.stage!==p.FINISHED?this._setCrossFadingStage():Q=!1;I=z.length(K);O=I-this._parameters.parallax.radius;(O>1.7*r.weatherHeightLimit||O<-r.weatherHeightLimit)&&1>this._parameters.fadeInOutHeight.factor?this._parameters.fadeInOutHeight.factor=1:(O>r.weatherHeightLimit||O<-.35*r.weatherHeightLimit)&&1>this._parameters.fadeInOutHeight.factor?this._setFadeInOutHeight(!0):O<r.weatherHeightLimit&&O>-.35*r.weatherHeightLimit&&0<this._parameters.fadeInOutHeight.factor?
this._setFadeInOutHeight(!1):this._parameters.fadeInOutHeight.stage=B.FINISHED;this._parameters.parallax.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(I*I-this._parameters.parallax.radius*this._parameters.parallax.radius,0))/I;q.fromPoints(D,this._parameters.parallax.anchorPointClouds,C);this._parameters.parallax.transform=m.create();d.rotate(this._parameters.parallax.transform,this._parameters.parallax.transform,C[3],q.axis(C));Q&&(q.fromPoints(D,this._parameters.parallaxNew.anchorPointClouds,
C),this._parameters.parallaxNew.transform=m.create(),d.rotate(this._parameters.parallaxNew.transform,this._parameters.parallaxNew.transform,C[3],q.axis(C)));z.copy(this._parameters.cameraPositionLastFrame,K)};b._createClass(H,[{key:"isFading",get:function(){return this._parameters.crossFade.stage!==p.FINISHED||this._parameters.fadeInOut.stage!==A.FINISHED||this._parameters.fadeIn.stage!==y.FINISHED||this._parameters.fadeInOutHeight.stage!==B.FINISHED}}]);return H}(g);c.__decorate([n.property({constructOnly:!0})],
a.CloudsComposition.prototype,"rctx",void 0);c.__decorate([n.property({constructOnly:!0})],a.CloudsComposition.prototype,"viewingMode",void 0);c.__decorate([n.property({constructOnly:!0})],a.CloudsComposition.prototype,"radius",void 0);a.CloudsComposition=c.__decorate([e.subclass("esri.views.3d.environment.CloudsComposition")],a.CloudsComposition);var y;(function(L){L[L.FINISHED=0]="FINISHED";L[L.CHANGE_ANCHOR=1]="CHANGE_ANCHOR";L[L.FADE_IN=2]="FADE_IN"})(y||(y={}));var A;(function(L){L[L.FINISHED=
0]="FINISHED";L[L.FADE_OUT=1]="FADE_OUT";L[L.FADE_IN=2]="FADE_IN"})(A||(A={}));var p;(function(L){L[L.FINISHED=0]="FINISHED";L[L.CROSS_FADE=1]="CROSS_FADE"})(p||(p={}));var B;(function(L){L[L.FINISHED=0]="FINISHED";L[L.HEIGHT_FADE=1]="HEIGHT_FADE"})(B||(B={}));const D=v.fromValues(0,0,1),C=q.create(),F=v.create(),G=v.create();a.bindCloudsComposition=E;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/axisAngle":function(){define("exports ../../chunks/quat ../../chunks/quatf64 ../../chunks/vec3 ./vector ./vectorStacks".split(" "),
function(a,b,c,g,h,w){function n(m=k){return[m[0],m[1],m[2],m[3]]}function f(m,z,v,q,t=n()){t[0]=m;t[1]=z;t[2]=v;t[3]=q;return t}function l(m,z){m[3]=z;return m}const k=[0,0,1,0],e=c.create(),d=c.create();a.UP=k;a.angle=function(m){return m[3]};a.axis=function(m){return m};a.compose=function(m,z,v=n()){b.setAxisAngle(e,m,m[3]);b.setAxisAngle(d,z,z[3]);b.multiply(e,d,e);return l(v,b.getAxisAngle(v,e))};a.copy=function(m,z=n()){return f(m[0],m[1],m[2],m[3],z)};a.create=n;a.fromAxisAndAngle=function(m,
z,v=n()){g.copy(v,m);v[3]=z;return v};a.fromPoints=function(m,z,v=n()){g.cross(v,m,z);g.normalize(v,v);v[3]=h.angle(m,z);return v};a.fromValues=f;a.setAngle=l;a.wrap=function(m,z,v,q){return f(m,z,v,q,w.sv4d.get())};a.wrapAxisAngle=function(m,z){return f(m[0],m[1],m[2],z,w.sv4d.get())};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/quat":function(){define("exports ./mat3f64 ./quatf64 ./vec3f64 ./common ./vec3 ./vec4".split(" "),function(a,b,c,g,h,w,n){function f(T){T[0]=0;T[1]=0;
T[2]=0;T[3]=1;return T}function l(T,V,W){W*=.5;const U=Math.sin(W);T[0]=U*V[0];T[1]=U*V[1];T[2]=U*V[2];T[3]=Math.cos(W);return T}function k(T,V){const W=2*Math.acos(V[3]),U=Math.sin(W/2);U>h.EPSILON?(T[0]=V[0]/U,T[1]=V[1]/U,T[2]=V[2]/U):(T[0]=1,T[1]=0,T[2]=0);return W}function e(T,V,W){const U=V[0],aa=V[1],da=V[2];V=V[3];const Y=W[0],ea=W[1],ja=W[2];W=W[3];T[0]=U*W+V*Y+aa*ja-da*ea;T[1]=aa*W+V*ea+da*Y-U*ja;T[2]=da*W+V*ja+U*ea-aa*Y;T[3]=V*W-U*Y-aa*ea-da*ja;return T}function d(T,V,W){W*=.5;const U=V[0],
aa=V[1],da=V[2];V=V[3];const Y=Math.sin(W);W=Math.cos(W);T[0]=U*W+V*Y;T[1]=aa*W+da*Y;T[2]=da*W-aa*Y;T[3]=V*W-U*Y;return T}function m(T,V,W){W*=.5;const U=V[0],aa=V[1],da=V[2];V=V[3];const Y=Math.sin(W);W=Math.cos(W);T[0]=U*W-da*Y;T[1]=aa*W+V*Y;T[2]=da*W+U*Y;T[3]=V*W-aa*Y;return T}function z(T,V,W){W*=.5;const U=V[0],aa=V[1],da=V[2];V=V[3];const Y=Math.sin(W);W=Math.cos(W);T[0]=U*W+aa*Y;T[1]=aa*W-U*Y;T[2]=da*W+V*Y;T[3]=V*W-da*Y;return T}function v(T,V){const W=V[0],U=V[1];V=V[2];T[0]=W;T[1]=U;T[2]=
V;T[3]=Math.sqrt(Math.abs(1-W*W-U*U-V*V));return T}function q(T,V,W,U){const aa=V[0],da=V[1],Y=V[2];V=V[3];let ea=W[0],ja=W[1],la=W[2];W=W[3];let ia;let ca;var fa=aa*ea+da*ja+Y*la+V*W;0>fa&&(fa=-fa,ea=-ea,ja=-ja,la=-la,W=-W);1-fa>h.EPSILON?(ia=Math.acos(fa),ca=Math.sin(ia),fa=Math.sin((1-U)*ia)/ca,U=Math.sin(U*ia)/ca):fa=1-U;T[0]=fa*aa+U*ea;T[1]=fa*da+U*ja;T[2]=fa*Y+U*la;T[3]=fa*V+U*W;return T}function t(T){var V=h.RANDOM();const W=h.RANDOM(),U=h.RANDOM(),aa=Math.sqrt(1-V);V=Math.sqrt(V);T[0]=aa*
Math.sin(2*Math.PI*W);T[1]=aa*Math.cos(2*Math.PI*W);T[2]=V*Math.sin(2*Math.PI*U);T[3]=V*Math.cos(2*Math.PI*U);return T}function r(T,V){const W=V[0],U=V[1],aa=V[2];V=V[3];var da=W*W+U*U+aa*aa+V*V;da=da?1/da:0;T[0]=-W*da;T[1]=-U*da;T[2]=-aa*da;T[3]=V*da;return T}function x(T,V){T[0]=-V[0];T[1]=-V[1];T[2]=-V[2];T[3]=V[3];return T}function u(T,V){var W=V[0]+V[4]+V[8];if(0<W)W=Math.sqrt(W+1),T[3]=.5*W,W=.5/W,T[0]=(V[5]-V[7])*W,T[1]=(V[6]-V[2])*W,T[2]=(V[1]-V[3])*W;else{let U=0;V[4]>V[0]&&(U=1);V[8]>V[3*
U+U]&&(U=2);const aa=(U+1)%3,da=(U+2)%3;W=Math.sqrt(V[3*U+U]-V[3*aa+aa]-V[3*da+da]+1);T[U]=.5*W;W=.5/W;T[3]=(V[3*aa+da]-V[3*da+aa])*W;T[aa]=(V[3*aa+U]+V[3*U+aa])*W;T[da]=(V[3*da+U]+V[3*U+da])*W}return T}function E(T,V,W,U){var aa=.5*Math.PI/180;V*=aa;W*=aa;U*=aa;aa=Math.sin(V);V=Math.cos(V);const da=Math.sin(W);W=Math.cos(W);const Y=Math.sin(U);U=Math.cos(U);T[0]=aa*W*U-V*da*Y;T[1]=V*da*U+aa*W*Y;T[2]=V*W*Y-aa*da*U;T[3]=V*W*U+aa*da*Y;return T}function y(T){return"quat("+T[0]+", "+T[1]+", "+T[2]+", "+
T[3]+")"}function A(T,V,W){const U=w.dot(V,W);if(-.999999>U)return w.cross(Q,J,V),1E-6>w.len(Q)&&w.cross(Q,P,V),w.normalize(Q,Q),l(T,Q,Math.PI),T;if(.999999<U)return T[0]=0,T[1]=0,T[2]=0,T[3]=1,T;w.cross(Q,V,W);T[0]=Q[0];T[1]=Q[1];T[2]=Q[2];T[3]=1+U;return I(T,T)}function p(T,V,W,U,aa,da){q(N,V,aa,da);q(R,W,U,da);q(T,N,R,2*da*(1-da));return T}function B(T,V,W,U){const aa=S;aa[0]=W[0];aa[3]=W[1];aa[6]=W[2];aa[1]=U[0];aa[4]=U[1];aa[7]=U[2];aa[2]=-V[0];aa[5]=-V[1];aa[8]=-V[2];return I(T,u(T,aa))}const D=
n.copy,C=n.set,F=n.add,G=n.scale,L=n.dot,H=n.lerp,M=n.length,K=n.squaredLength,I=n.normalize,O=n.exactEquals;n=n.equals;const Q=g.create(),J=g.fromValues(1,0,0),P=g.fromValues(0,1,0),N=c.create(),R=c.create(),S=b.create();b=Object.freeze({__proto__:null,identity:f,setAxisAngle:l,getAxisAngle:k,multiply:e,rotateX:d,rotateY:m,rotateZ:z,calculateW:v,slerp:q,random:t,invert:r,conjugate:x,fromMat3:u,fromEuler:E,str:y,copy:D,set:C,add:F,mul:e,scale:G,dot:L,lerp:H,length:M,len:M,squaredLength:K,sqrLen:K,
normalize:I,exactEquals:O,equals:n,rotationTo:A,sqlerp:p,setAxes:B});a.add=F;a.calculateW=v;a.conjugate=x;a.copy=D;a.dot=L;a.equals=n;a.exactEquals=O;a.fromEuler=E;a.fromMat3=u;a.getAxisAngle=k;a.identity=f;a.invert=r;a.len=M;a.length=M;a.lerp=H;a.mul=e;a.multiply=e;a.normalize=I;a.quat=b;a.random=t;a.rotateX=d;a.rotateY=m;a.rotateZ=z;a.rotationTo=A;a.scale=G;a.set=C;a.setAxes=B;a.setAxisAngle=l;a.slerp=q;a.sqlerp=p;a.sqrLen=K;a.squaredLength=K;a.str=y})},"esri/views/3d/environment/CloudsCompositionTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/CloudsComposition.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k){w=function(e){function d(z){var v;return v=e.call(this,z,null,()=>v.destroy())||this}c._inheritsLoose(d,e);var m=d.prototype;m.initializeProgram=function(z){const v=d.shader.get().build();return new f.Program(z.rctx,v,n.Default3D)};m.initializePipeline=function(){return k.makePipelineState({blending:k.simpleBlendingParams(l.BlendFactor.ONE,l.BlendFactor.SRC_ALPHA),depthTest:{func:l.CompareFunction.LEQUAL},colorWrite:k.defaultColorWriteParams})};return d}(w.ShaderTechnique);
w.shader=new h.ReloadableShaderModule(g.CloudsCompositionShader,()=>new Promise((e,d)=>a(["./CloudsComposition.glsl"],e,d)));b.CloudsCompositionTechnique=w;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/CloudsComposition.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateMainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CloudsParallaxShading.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){function m(){const v=new e.ShaderBuilder;v.attributes.add(d.VertexAttribute.POSITION,"vec2");v.varyings.add("worldRay","vec3");v.vertex.uniforms.add("inverseProjectionMatrix","mat4");v.vertex.uniforms.add("inverseViewMatrix","mat4");v.vertex.code.add(k.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`);v.fragment.uniforms.add("lightingMainDirection","vec3");v.fragment.include(f.ColorConversion);v.fragment.include(l.RgbaFloatEncoding);v.include(c.EvaluateMainLighting);v.include(b.EvaluateAmbientLighting,{pbrMode:h.PBRMode.Disabled,lightingSphericalHarmonicsOrder:2});v.include(w.PiUtils);v.include(g.Gamma);v.include(n.CloudsParallaxShading);v.fragment.code.add(k.glsl`void main() {
vec4 cloudsColor = crossFade == 0 ? renderCloud(normalize(worldRay), cameraPosition) : renderCloudCrossFade(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`);return v}const z=Object.freeze({__proto__:null,build:m});a.CloudsCompositionShader=z;a.build=m})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl":function(){define(["exports","./PhysicallyBasedRenderingParameters.glsl","../../shaderModules/interfaces"],function(a,b,c){a.EvaluateAmbientLighting=function(g,h){g=g.fragment;const w=void 0!==h.lightingSphericalHarmonicsOrder?h.lightingSphericalHarmonicsOrder:2;0===w?(g.uniforms.add("lightingAmbientSH0","vec3"),
g.code.add(c.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===w?(g.uniforms.add("lightingAmbientSH_R","vec4"),g.uniforms.add("lightingAmbientSH_G","vec4"),g.uniforms.add("lightingAmbientSH_B","vec4"),g.code.add(c.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===w&&(g.uniforms.add("lightingAmbientSH0","vec3"),g.uniforms.add("lightingAmbientSH_R1","vec4"),g.uniforms.add("lightingAmbientSH_G1","vec4"),g.uniforms.add("lightingAmbientSH_B1","vec4"),g.uniforms.add("lightingAmbientSH_R2","vec4"),g.uniforms.add("lightingAmbientSH_G2","vec4"),g.uniforms.add("lightingAmbientSH_B2","vec4"),g.code.add(c.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),h.pbrMode!==b.PBRMode.Normal&&h.pbrMode!==b.PBRMode.Schematic||g.code.add(c.glsl`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl":function(){define(["exports","../../../../../../chunks/vec3f32","../attributes/VertexTextureCoordinates.glsl","../../shaderModules/interfaces"],function(a,b,c,g){b=b.fromValues(0,.6,.2);a.PBRMode=void 0;(function(h){h[h.Disabled=0]="Disabled";h[h.Normal=1]="Normal";h[h.Schematic=2]="Schematic";h[h.Water=3]="Water";h[h.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh";
h[h.COUNT=5]="COUNT"})(a.PBRMode||(a.PBRMode={}));a.PBRSchematicMRRValues=b;a.PhysicallyBasedRenderingParameters=function(h,w){const n=h.fragment,f=w.hasMetalnessAndRoughnessTexture||w.hasEmissionTexture||w.hasOcclusionTexture;w.pbrMode===a.PBRMode.Normal&&f&&h.include(c.VertexTextureCoordinates,w);w.pbrMode===a.PBRMode.Schematic?n.code.add(g.glsl`const vec3 mrr = vec3(0.0, 0.6, 0.2);
const vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`):(w.pbrMode===a.PBRMode.Disabled&&n.code.add(g.glsl`float getBakedOcclusion() { return 1.0; }`),w.pbrMode===a.PBRMode.Normal&&(n.uniforms.add("emissionFactor","vec3"),n.uniforms.add("mrrFactors","vec3"),n.code.add(g.glsl`vec3 mrr;
vec3 emission;
float occlusion;`),w.hasMetalnessAndRoughnessTexture&&(n.uniforms.add("texMetallicRoughness","sampler2D"),w.supportsTextureAtlas&&n.uniforms.add("texMetallicRoughnessSize","vec2"),n.code.add(g.glsl`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),w.hasEmissionTexture&&(n.uniforms.add("texEmission","sampler2D"),w.supportsTextureAtlas&&n.uniforms.add("texEmissionSize","vec2"),n.code.add(g.glsl`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),w.hasOcclusionTexture?(n.uniforms.add("texOcclusion","sampler2D"),w.supportsTextureAtlas&&n.uniforms.add("texOcclusionSize","vec2"),n.code.add(g.glsl`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):n.code.add(g.glsl`float getBakedOcclusion() { return 1.0; }`),n.code.add(g.glsl`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${f?"vtc.uv \x3d vuv0;":""}
      ${w.hasMetalnessAndRoughnessTexture?w.supportsTextureAtlas?"vtc.size \x3d texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":""}
      ${w.hasEmissionTexture?w.supportsTextureAtlas?"vtc.size \x3d texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":""}
      ${w.hasOcclusionTexture?w.supportsTextureAtlas?"vtc.size \x3d texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""}
    }
  `)))};a.bindPBRUniforms=function(h,w,n=!1){n||(h.setUniform3fv("mrrFactors",w.mrrFactors),h.setUniform3fv("emissionFactor",w.emissiveFactor))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/vec3f32":function(){define(["exports"],function(a){function b(){return new Float32Array(3)}function c(t){const r=new Float32Array(3);r[0]=t[0];r[1]=t[1];r[2]=t[2];return r}function g(t,r,x){const u=new Float32Array(3);u[0]=t;u[1]=r;u[2]=x;return u}function h(t,r){return new Float32Array(t,r,
3)}function w(){return b()}function n(){return g(1,1,1)}function f(){return g(1,0,0)}function l(){return g(0,1,0)}function k(){return g(0,0,1)}const e=b(),d=n(),m=f(),z=l(),v=k(),q=Object.freeze({__proto__:null,create:b,clone:c,fromValues:g,createView:h,zeros:w,ones:n,unitX:f,unitY:l,unitZ:k,ZEROS:e,ONES:d,UNIT_X:m,UNIT_Y:z,UNIT_Z:v});a.ONES=d;a.UNIT_X=m;a.UNIT_Y=z;a.UNIT_Z=v;a.ZEROS=e;a.clone=c;a.create=b;a.createView=h;a.fromValues=g;a.ones=n;a.unitX=f;a.unitY=l;a.unitZ=k;a.vec3f32=q;a.zeros=w})},
"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTextureCoordinates.glsl":function(){define(["exports","./TextureCoordinateAttribute.glsl","../util/TextureAtlasLookup.glsl","../../shaderModules/interfaces"],function(a,b,c,g){a.VertexTextureCoordinates=function(h,w){h.include(b.TextureCoordinateAttribute,w);h.fragment.code.add(g.glsl`
  struct TextureLookupParameter {
    vec2 uv;
    ${w.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `);w.attributeTextureCoordinates===b.TextureCoordinateAttributeType.Default&&h.fragment.code.add(g.glsl`vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {
return texture2D(tex, params.uv);
}`);w.attributeTextureCoordinates===b.TextureCoordinateAttributeType.Atlas&&(h.include(c.TextureAtlasLookup),h.fragment.code.add(g.glsl`vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {
return textureAtlasLookup(tex, params.size, params.uv, vuvRegion);
}`))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/TextureAtlasLookup.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.TextureAtlasLookup=function(c){c.extensions.add("GL_EXT_shader_texture_lod");c.extensions.add("GL_OES_standard_derivatives");c.fragment.code.add(b.glsl`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateMainLighting.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.EvaluateMainLighting=function(c){c=c.fragment;c.uniforms.add("lightingMainDirection","vec3");c.uniforms.add("lightingMainIntensity","vec3");c.uniforms.add("lightingFixedFactor","float");c.uniforms.add("lightingSpecularStrength","float");c.uniforms.add("lightingEnvironmentStrength","float");
c.code.add(b.glsl`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, lightingMainDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return lightingMainIntensity * ((1.0 - shadowing) * dotVal);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.PiUtils=function(c){c.vertex.code.add(b.glsl`const float PI = 3.141592653589793;`);c.fragment.code.add(b.glsl`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CloudsParallaxShading.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.CloudsParallaxShading=function(c){c.fragment.uniforms.add("anchorPosition","vec3").add("anchorPositionCrossFade","vec3").add("fadeInOutFactor","float").add("cloudsHeight","float").add("rotationMatrixClouds","mat4").add("rotationMatrixCloudsCrossFade",
"mat4").add("radiusCurvatureCorrectionFactor","float").add("radius","float").add("cameraPosition","vec3").add("totalFadeInOut","float").add("crossFade","int").add("crossFadeAnchorFactor","float").add("cloudVariables","vec2").add("cubeMap","samplerCube");c.fragment.code.add(b.glsl`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos, float radiusReduction)
{
vec3 dirAnchor = normalize(spherePos);
vec3 sphereOriginOffset = dirAnchor * radiusReduction;
float radiusClouds = radius + cloudsHeight - radiusReduction;
float B = 2.0 * dot(cameraPosition - sphereOriginOffset, dir);
float C = dot(cameraPosition - sphereOriginOffset, cameraPosition - sphereOriginOffset) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`);c.fragment.code.add(b.glsl`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`);c.fragment.code.add(b.glsl`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`);c.fragment.code.add(b.glsl`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(lightingMainDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(lightingMainDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((lightingMainIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * pow(dirDotLight, RIM_SCATTERING_FACTOR) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`);c.fragment.code.add(b.glsl`vec4 getCloudData(vec3 rayDir)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
return mix(vec4(vec3(clamp(1.0 - cloudVariables.y, 0.6, 1.0)), 0.0), cloudData, smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(mu)));
}`);c.fragment.code.add(b.glsl`vec4 renderCloud(vec3 worldRay, vec3 position)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), position, anchorPosition, 0.0);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(normalize(-worldRay), cloudData), totalTransmittance);
}`);c.fragment.code.add(b.glsl`vec4 renderCloudCrossFade(vec3 worldRay, vec3 position)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), position, anchorPosition, 0.0);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColor = vec4(calculateCloudColor(normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), position, anchorPositionCrossFade, 0.0);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.ColorConversion=function(c){c.code.add(b.glsl`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/CloudsData":function(){define(["exports","../../../core/maybe"],function(a,b){a.isReadyCloudsData=function(c){return b.isSome(c)&&b.isSome(c.cubeMap)&&!c.running&&0<c.coverage};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/CloudsGenerator":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/has ../../../core/mathUtils ../../../core/maybe ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3f32 ../../../geometry/projectionEllipsoid ./CloudsPresets ./CloudsTechnique ./NoiseTextureAtlas ../webgl-engine/lib/glUtil3D ../../support/Scheduler ../../webgl/enums ../../webgl/FramebufferObject".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D){a.CloudsGenerator=function(H){function M(I){I=H.call(this,I)||this;I._frameTask=null;I._handles=new h;I._cubeMapSize=w("esri-mobile")?1024:2048;I._techniques=[];I._techniqueConfiguration=new E.CloudsTechniqueConfiguration;I.coverage=n.lerp(L.coverage[0],L.coverage[1],.5);I.density=n.lerp(L.density[0],L.density[1],.5);I.absorption=n.lerp(L.absorption[0],L.absorption[1],.5);I.cloudSize=n.lerp(L.cloudSize[0],L.cloudSize[1],.5);I.detailSize=
n.lerp(L.detailSize[0],L.detailSize[1],.5);I.smoothness=n.lerp(L.smoothness[0],L.smoothness[1],.5);I.cloudHeight=n.lerp(L.cloudHeight[0],L.cloudHeight[1],.5);I.raymarchingStepType=L.raymarchingStepType;I._cloudRadius=0;I._viewMatrix=t.create();I._viewMatrix3=v.create();I.running=!1;return I}b._inheritsLoose(M,H);var K=M.prototype;K._getTechnique=function(I){const O=this._techniques[I];if(O)return O;this._techniqueConfiguration.steps=I;this._techniques[I]=new E.CloudsTechnique({rctx:this.rctx,viewingMode:this.view.state.viewingMode},
this._techniqueConfiguration);return this._techniques[I]};K.initialize=function(){this._vao=A.createQuadVAO(this.rctx);this._cloudRadius=.5*x.getReferenceEllipsoid(this.view.spatialReference).radius;this.setDirty();this._frameTask=this.view.resourceController.scheduler.registerTask(p.TaskPriority.CLOUDS_GENERATOR,this);this._handles.add(this._frameTask);this._handles.add(l.init(this,"coverage",()=>this.setDirty()));"coverage density absorption cloudSize detailSize smoothness cloudHeight raymarchingStepType".split(" ").forEach(I=>
this._handles.add(l.init(this,I,()=>this.setDirty())))};K.destroy=function(){this._handles.destroy();this._techniques.forEach(I=>f.releaseMaybe(I));this._techniques=null;this._frameBufferCube=f.disposeMaybe(this._frameBufferCube);this._vao=f.disposeMaybe(this._vao);this._noiseTexture=f.destroyMaybe(this._noiseTexture)};K._ensureNoiseTexture=function(){f.isNone(this._noiseTexture)&&(this._noiseTexture=new y.NoiseTextureAtlas(this.rctx,this.view),this._noiseTexture.render(this.rctx));return this._noiseTexture.textureAtlas};
K.applyPreset=function(I,O){const Q=I.median,J=P=>{const N=n.lerp(P[0],P[1],Q);return.5>O?n.lerp(P[0],N,2*O):n.lerp(N,P[1],2*(O-.5))};this.coverage=J(I.coverage);this.density=J(I.density);this.absorption=J(I.absorption);this.cloudSize=J(I.cloudSize);this.detailSize=J(I.detailSize);this.smoothness=J(I.smoothness);this.cloudHeight=J(I.cloudHeight);this.raymarchingStepType=I.raymarchingStepType};K.setDirty=function(){this.running=!0};K.runTask=function(I){if(0===this.coverage||f.isNone(this._vao))this.running=
!1;else{var O=this._ensureNoiseTexture();if(f.isNone(O))this.running=!1;else{var Q=this._getTechnique(this.raymarchingStepType);if(this.rctx.isTechniqueCompiled(Q)){var J=this.rctx.getViewport();this.rctx.setViewport(0,0,this._cubeMapSize,this._cubeMapSize);this.rctx.bindFramebuffer(this.frameBufferCube);Q=this.rctx.useTechnique(Q);var P=1+this.absorption,N=n.lerp(35,120,this.absorption);Q.bindTexture(O,"cloudShapeTexture");Q.setUniform1f("cloudRadius",this._cloudRadius);Q.setUniform1f("halfCubeMapSize",
.5*this._cubeMapSize);Q.setUniform1f("power",N);Q.setUniform1f("sigmaE",P);Q.setUniform1f("density",n.lerp(0,.3,this.density));Q.setUniform1f("cloudSize",n.lerp(0,.02,Math.max(.01,1-this.cloudSize)));Q.setUniform1f("detailSize",n.lerp(0,.2,Math.max(.01,1-this.detailSize)));Q.setUniform1f("smoothness",n.lerp(0,.5,1-this.smoothness));Q.setUniform1f("cloudHeight",n.lerp(0,1500,this.cloudHeight));Q.setUniform1f("coverage",this.coverage);this.rctx.bindVAO(this._vao);Q.assertCompatibleVertexAttributeLocations(this._vao);
for(O=0;5>O;O++)q.targetTo(this._viewMatrix,G,C[O],F[O]),z.fromMat4(this._viewMatrix3,this._viewMatrix),Q.setUniformMatrix3fv("view",this._viewMatrix3),this.frameBufferCube.setColorTextureTarget(B.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X+O),this.rctx.gl.drawArrays(this.rctx.gl.TRIANGLE_STRIP,0,4),this.rctx.gl.flush();this.running=!1;this.rctx.setViewport(J.x,J.y,J.width,J.height);this.requestRender();I.madeProgress()}}}};b._createClass(M,[{key:"frameBufferCube",get:function(){f.isNone(this._frameBufferCube)&&
(this._frameBufferCube=new D.FramebufferObject(this.rctx,{colorTarget:B.TargetType.CUBEMAP,width:this._cubeMapSize,height:this._cubeMapSize},{target:B.TextureType.TEXTURE_CUBE_MAP,pixelFormat:B.PixelFormat.RGBA,dataType:B.PixelType.UNSIGNED_BYTE,wrapMode:B.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:B.TextureSamplingMode.LINEAR,hasMipmap:!1,width:this._cubeMapSize,height:this._cubeMapSize}));return this._frameBufferCube}},{key:"cubeMap",get:function(){return this._frameBufferCube}}]);return M}(g);
c.__decorate([k.property({constructOnly:!0})],a.CloudsGenerator.prototype,"rctx",void 0);c.__decorate([k.property({constructOnly:!0})],a.CloudsGenerator.prototype,"view",void 0);c.__decorate([k.property({constructOnly:!0})],a.CloudsGenerator.prototype,"requestRender",void 0);c.__decorate([k.property()],a.CloudsGenerator.prototype,"_frameTask",void 0);c.__decorate([k.property()],a.CloudsGenerator.prototype,"coverage",void 0);c.__decorate([k.property()],a.CloudsGenerator.prototype,"density",void 0);
c.__decorate([k.property()],a.CloudsGenerator.prototype,"absorption",void 0);c.__decorate([k.property()],a.CloudsGenerator.prototype,"cloudSize",void 0);c.__decorate([k.property()],a.CloudsGenerator.prototype,"detailSize",void 0);c.__decorate([k.property()],a.CloudsGenerator.prototype,"smoothness",void 0);c.__decorate([k.property()],a.CloudsGenerator.prototype,"cloudHeight",void 0);c.__decorate([k.property()],a.CloudsGenerator.prototype,"raymarchingStepType",void 0);c.__decorate([k.property()],a.CloudsGenerator.prototype,
"running",void 0);a.CloudsGenerator=c.__decorate([m.subclass("esri.views.3d.environment.CloudsGenerator")],a.CloudsGenerator);const C=[r.fromValues(1,0,0),r.fromValues(-1,0,0),r.fromValues(0,1,0),r.fromValues(0,-1,0),r.fromValues(0,0,1)],F=[r.fromValues(0,1,0),r.fromValues(0,1,0),r.fromValues(0,0,-1),r.fromValues(0,0,1),r.fromValues(0,1,0)],G=r.zeros(),L=u.cloudPresets.sunny;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/mat3":function(){define(["exports","./common"],function(a,
b){function c(I,O){I[0]=O[0];I[1]=O[1];I[2]=O[2];I[3]=O[4];I[4]=O[5];I[5]=O[6];I[6]=O[8];I[7]=O[9];I[8]=O[10];return I}function g(I,O){I[0]=O[0];I[1]=O[1];I[2]=O[2];I[3]=O[3];I[4]=O[4];I[5]=O[5];I[6]=O[6];I[7]=O[7];I[8]=O[8];return I}function h(I,O,Q,J,P,N,R,S,T,V){I[0]=O;I[1]=Q;I[2]=J;I[3]=P;I[4]=N;I[5]=R;I[6]=S;I[7]=T;I[8]=V;return I}function w(I){I[0]=1;I[1]=0;I[2]=0;I[3]=0;I[4]=1;I[5]=0;I[6]=0;I[7]=0;I[8]=1;return I}function n(I,O){if(I===O){const Q=O[1],J=O[2],P=O[5];I[1]=O[3];I[2]=O[6];I[3]=
Q;I[5]=O[7];I[6]=J;I[7]=P}else I[0]=O[0],I[1]=O[3],I[2]=O[6],I[3]=O[1],I[4]=O[4],I[5]=O[7],I[6]=O[2],I[7]=O[5],I[8]=O[8];return I}function f(I,O){const Q=O[0],J=O[1],P=O[2],N=O[3],R=O[4],S=O[5],T=O[6],V=O[7];O=O[8];const W=O*R-S*V,U=-O*N+S*T,aa=V*N-R*T;let da=Q*W+J*U+P*aa;if(!da)return null;da=1/da;I[0]=W*da;I[1]=(-O*J+P*V)*da;I[2]=(S*J-P*R)*da;I[3]=U*da;I[4]=(O*Q-P*T)*da;I[5]=(-S*Q+P*N)*da;I[6]=aa*da;I[7]=(-V*Q+J*T)*da;I[8]=(R*Q-J*N)*da;return I}function l(I,O){const Q=O[0],J=O[1],P=O[2],N=O[3],
R=O[4],S=O[5],T=O[6],V=O[7];O=O[8];I[0]=R*O-S*V;I[1]=P*V-J*O;I[2]=J*S-P*R;I[3]=S*T-N*O;I[4]=Q*O-P*T;I[5]=P*N-Q*S;I[6]=N*V-R*T;I[7]=J*T-Q*V;I[8]=Q*R-J*N;return I}function k(I){const O=I[3],Q=I[4],J=I[5],P=I[6],N=I[7],R=I[8];return I[0]*(R*Q-J*N)+I[1]*(-R*O+J*P)+I[2]*(N*O-Q*P)}function e(I,O,Q){const J=O[0],P=O[1],N=O[2],R=O[3],S=O[4],T=O[5],V=O[6],W=O[7];O=O[8];const U=Q[0],aa=Q[1],da=Q[2],Y=Q[3],ea=Q[4],ja=Q[5],la=Q[6],ia=Q[7];Q=Q[8];I[0]=U*J+aa*R+da*V;I[1]=U*P+aa*S+da*W;I[2]=U*N+aa*T+da*O;I[3]=Y*
J+ea*R+ja*V;I[4]=Y*P+ea*S+ja*W;I[5]=Y*N+ea*T+ja*O;I[6]=la*J+ia*R+Q*V;I[7]=la*P+ia*S+Q*W;I[8]=la*N+ia*T+Q*O;return I}function d(I,O,Q){const J=O[0],P=O[1],N=O[2],R=O[3],S=O[4],T=O[5],V=O[6],W=O[7];O=O[8];const U=Q[0];Q=Q[1];I[0]=J;I[1]=P;I[2]=N;I[3]=R;I[4]=S;I[5]=T;I[6]=U*J+Q*R+V;I[7]=U*P+Q*S+W;I[8]=U*N+Q*T+O;return I}function m(I,O,Q){const J=O[0],P=O[1],N=O[2],R=O[3],S=O[4],T=O[5],V=O[6],W=O[7];O=O[8];const U=Math.sin(Q);Q=Math.cos(Q);I[0]=Q*J+U*R;I[1]=Q*P+U*S;I[2]=Q*N+U*T;I[3]=Q*R-U*J;I[4]=Q*S-
U*P;I[5]=Q*T-U*N;I[6]=V;I[7]=W;I[8]=O;return I}function z(I,O,Q){const J=Q[0],P=Q[1];Q=Q[2];I[0]=J*O[0];I[1]=J*O[1];I[2]=J*O[2];I[3]=P*O[3];I[4]=P*O[4];I[5]=P*O[5];I[6]=Q*O[6];I[7]=Q*O[7];I[8]=Q*O[8];return I}function v(I,O,Q){const J=Q[0];Q=Q[1];I[0]=J*O[0];I[1]=J*O[1];I[2]=J*O[2];I[3]=Q*O[3];I[4]=Q*O[4];I[5]=Q*O[5];return I}function q(I,O){I[0]=1;I[1]=0;I[2]=0;I[3]=0;I[4]=1;I[5]=0;I[6]=O[0];I[7]=O[1];I[8]=1;return I}function t(I,O){const Q=Math.sin(O);O=Math.cos(O);I[0]=O;I[1]=Q;I[2]=0;I[3]=-Q;
I[4]=O;I[5]=0;I[6]=0;I[7]=0;I[8]=1;return I}function r(I,O){I[0]=O[0];I[1]=0;I[2]=0;I[3]=0;I[4]=O[1];I[5]=0;I[6]=0;I[7]=0;I[8]=1;return I}function x(I,O){I[0]=O[0];I[1]=O[1];I[2]=0;I[3]=O[2];I[4]=O[3];I[5]=0;I[6]=O[4];I[7]=O[5];I[8]=1;return I}function u(I,O){var Q=O[0],J=O[1],P=O[2];O=O[3];var N=Q+Q,R=J+J;const S=P+P;Q*=N;const T=J*N;J*=R;const V=P*N,W=P*R;P*=S;N*=O;R*=O;O*=S;I[0]=1-J-P;I[3]=T-O;I[6]=V+R;I[1]=T+O;I[4]=1-Q-P;I[7]=W-N;I[2]=V-R;I[5]=W+N;I[8]=1-Q-J;return I}function E(I,O){const Q=O[0],
J=O[1],P=O[2],N=O[4],R=O[5],S=O[6],T=O[8],V=O[9];O=O[10];const W=O*R-S*V,U=-O*N+S*T,aa=V*N-R*T;var da=Q*W+J*U+P*aa;if(!da)return null;da=1/da;I[0]=W*da;I[1]=(-O*J+P*V)*da;I[2]=(S*J-P*R)*da;I[3]=U*da;I[4]=(O*Q-P*T)*da;I[5]=(-S*Q+P*N)*da;I[6]=aa*da;I[7]=(-V*Q+J*T)*da;I[8]=(R*Q-J*N)*da;return I}function y(I,O){const Q=O[0],J=O[1],P=O[2],N=O[3],R=O[4],S=O[5],T=O[6],V=O[7];var W=O[8],U=O[9],aa=O[10],da=O[11];const Y=O[12],ea=O[13],ja=O[14];O=O[15];const la=Q*S-J*R,ia=Q*T-P*R,ca=Q*V-N*R,fa=J*T-P*S,ba=J*
V-N*S,Z=P*V-N*T,ha=W*ea-U*Y,na=W*ja-aa*Y;W=W*O-da*Y;const pa=U*ja-aa*ea;U=U*O-da*ea;aa=aa*O-da*ja;da=la*aa-ia*U+ca*pa+fa*W-ba*na+Z*ha;if(!da)return null;da=1/da;I[0]=(S*aa-T*U+V*pa)*da;I[1]=(T*W-R*aa-V*na)*da;I[2]=(R*U-S*W+V*ha)*da;I[3]=(P*U-J*aa-N*pa)*da;I[4]=(Q*aa-P*W+N*na)*da;I[5]=(J*W-Q*U-N*ha)*da;I[6]=(ea*Z-ja*ba+O*fa)*da;I[7]=(ja*ca-Y*Z-O*ia)*da;I[8]=(Y*ba-ea*ca+O*la)*da;return I}function A(I,O,Q){I[0]=2/O;I[1]=0;I[2]=0;I[3]=0;I[4]=-2/Q;I[5]=0;I[6]=-1;I[7]=1;I[8]=1;return I}function p(I){return"mat3("+
I[0]+", "+I[1]+", "+I[2]+", "+I[3]+", "+I[4]+", "+I[5]+", "+I[6]+", "+I[7]+", "+I[8]+")"}function B(I){return Math.sqrt(I[0]**2+I[1]**2+I[2]**2+I[3]**2+I[4]**2+I[5]**2+I[6]**2+I[7]**2+I[8]**2)}function D(I,O,Q){I[0]=O[0]+Q[0];I[1]=O[1]+Q[1];I[2]=O[2]+Q[2];I[3]=O[3]+Q[3];I[4]=O[4]+Q[4];I[5]=O[5]+Q[5];I[6]=O[6]+Q[6];I[7]=O[7]+Q[7];I[8]=O[8]+Q[8];return I}function C(I,O,Q){I[0]=O[0]-Q[0];I[1]=O[1]-Q[1];I[2]=O[2]-Q[2];I[3]=O[3]-Q[3];I[4]=O[4]-Q[4];I[5]=O[5]-Q[5];I[6]=O[6]-Q[6];I[7]=O[7]-Q[7];I[8]=O[8]-
Q[8];return I}function F(I,O,Q){I[0]=O[0]*Q;I[1]=O[1]*Q;I[2]=O[2]*Q;I[3]=O[3]*Q;I[4]=O[4]*Q;I[5]=O[5]*Q;I[6]=O[6]*Q;I[7]=O[7]*Q;I[8]=O[8]*Q;return I}function G(I,O,Q,J){I[0]=O[0]+Q[0]*J;I[1]=O[1]+Q[1]*J;I[2]=O[2]+Q[2]*J;I[3]=O[3]+Q[3]*J;I[4]=O[4]+Q[4]*J;I[5]=O[5]+Q[5]*J;I[6]=O[6]+Q[6]*J;I[7]=O[7]+Q[7]*J;I[8]=O[8]+Q[8]*J;return I}function L(I,O){return I[0]===O[0]&&I[1]===O[1]&&I[2]===O[2]&&I[3]===O[3]&&I[4]===O[4]&&I[5]===O[5]&&I[6]===O[6]&&I[7]===O[7]&&I[8]===O[8]}function H(I,O){const Q=I[0],J=
I[1],P=I[2],N=I[3],R=I[4],S=I[5],T=I[6],V=I[7];I=I[8];const W=O[0],U=O[1],aa=O[2],da=O[3],Y=O[4],ea=O[5],ja=O[6],la=O[7];O=O[8];return Math.abs(Q-W)<=b.EPSILON*Math.max(1,Math.abs(Q),Math.abs(W))&&Math.abs(J-U)<=b.EPSILON*Math.max(1,Math.abs(J),Math.abs(U))&&Math.abs(P-aa)<=b.EPSILON*Math.max(1,Math.abs(P),Math.abs(aa))&&Math.abs(N-da)<=b.EPSILON*Math.max(1,Math.abs(N),Math.abs(da))&&Math.abs(R-Y)<=b.EPSILON*Math.max(1,Math.abs(R),Math.abs(Y))&&Math.abs(S-ea)<=b.EPSILON*Math.max(1,Math.abs(S),Math.abs(ea))&&
Math.abs(T-ja)<=b.EPSILON*Math.max(1,Math.abs(T),Math.abs(ja))&&Math.abs(V-la)<=b.EPSILON*Math.max(1,Math.abs(V),Math.abs(la))&&Math.abs(I-O)<=b.EPSILON*Math.max(1,Math.abs(I),Math.abs(O))}function M(I){const O=b.EPSILON,Q=I[0],J=I[1],P=I[2],N=I[3],R=I[4],S=I[5],T=I[6],V=I[7];I=I[8];return Math.abs(1-(Q*Q+N*N+T*T))<=O&&Math.abs(1-(J*J+R*R+V*V))<=O&&Math.abs(1-(P*P+S*S+I*I))<=O}const K=Object.freeze({__proto__:null,fromMat4:c,copy:g,set:h,identity:w,transpose:n,invert:f,adjoint:l,determinant:k,multiply:e,
translate:d,rotate:m,scale:z,scaleByVec2:v,fromTranslation:q,fromRotation:t,fromScaling:r,fromMat2d:x,fromQuat:u,normalFromMat4Legacy:E,normalFromMat4:y,projection:A,str:p,frob:B,add:D,subtract:C,multiplyScalar:F,multiplyScalarAndAdd:G,exactEquals:L,equals:H,isOrthoNormal:M,mul:e,sub:C});a.add=D;a.adjoint=l;a.copy=g;a.determinant=k;a.equals=H;a.exactEquals=L;a.frob=B;a.fromMat2d=x;a.fromMat4=c;a.fromQuat=u;a.fromRotation=t;a.fromScaling=r;a.fromTranslation=q;a.identity=w;a.invert=f;a.isOrthoNormal=
M;a.mat3=K;a.mul=e;a.multiply=e;a.multiplyScalar=F;a.multiplyScalarAndAdd=G;a.normalFromMat4=y;a.normalFromMat4Legacy=E;a.projection=A;a.rotate=m;a.scale=z;a.scaleByVec2=v;a.set=h;a.str=p;a.sub=C;a.subtract=C;a.translate=d;a.transpose=n})},"esri/views/3d/environment/CloudsPresets":function(){define(["exports","../../../chunks/Clouds.glsl"],function(a,b){let c=function(g,h,w,n,f,l,k,e,d=.5){this.coverage=g;this.density=h;this.absorption=w;this.cloudSize=n;this.detailSize=f;this.smoothness=l;this.cloudHeight=
k;this.raymarchingStepType=e;this.median=d};b={sunny:new c([.1,.7],[.02,.02],[0,0],[.86,.86],[.8,.8],[.5,.5],[.05,.05],b.RayMarchingSteps.SIXTEEN),cloudy:new c([.24,.7],[.135,.2],[0,0],[.5,.5],[.65,.7],[.3,.3],[1,1],b.RayMarchingSteps.TWOHUNDRED),rainy:new c([.5,.9],[.2,.5],[.3,.6],[.4,.4],[.7,.7],[.5,.5],[1,1],b.RayMarchingSteps.TWOHUNDRED),snowy:new c([.5,.9],[.2,.5],[0,0],[.4,.4],[.7,.7],[.5,.5],[1,1],b.RayMarchingSteps.TWOHUNDRED),foggy:new c([.8,.8],[.5,.5],[0,0],[.85,.85],[.75,.75],[.8,.8],
[.3,.3],b.RayMarchingSteps.HUNDRED)};a.CloudPresets=c;a.cloudPresets=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/Clouds.glsl":function(){define(["exports","../views/3d/environment/NoiseTextureAtlas","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],function(a,b,c,g,h){function w(f){const l=new h.ShaderBuilder;l.include(c.ScreenSpacePass,!1);l.fragment.uniforms.add("cloudRadius",
"float").add("halfCubeMapSize","float").add("power","float").add("sigmaE","float").add("density","float").add("cloudSize","float").add("detailSize","float").add("smoothness","float").add("cloudHeight","float").add("coverage","float").add("view","mat3").add("cloudShapeTexture","sampler2D");l.fragment.code.add(g.glsl`
    const int STEPS = ${f.steps===a.RayMarchingSteps.SIXTEEN?g.glsl`16`:f.steps===a.RayMarchingSteps.HUNDRED?g.glsl`100`:g.glsl`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);

    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`);l.fragment.code.add(g.glsl`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${g.glsl.float(b.ATLAS_SIZE)};
      const float dataWidth = ${g.glsl.float(b.ATLAS_SIZE)};
      const float tileRows = ${g.glsl.float(b.TILE_ROWS)};
      const vec3 atlasDimensions = vec3(${g.glsl.float(b.TILE_SIZE)}, ${g.glsl.float(b.TILE_SIZE)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${g.glsl.float(b.TEXTURE_SCALE)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }`);l.fragment.code.add(g.glsl`float clouds(vec3 p) {
float cloudVariations = getCloudShape(0.002 * p, 0.5);
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
cloud += (cloudVariations * 0.6 - 0.3) * ( -4.0 * (coverage * coverage - coverage));
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * saturate(remap(heightFraction, 0.75, 1.0, 1.0, 0.0));
float shape = getCloudShape(cloudSize * p, 0.0);
shape *= mix(0.0, 1.0, min(2.0 * (1.0 - coverage), 1.0));
cloud = saturate(remap(cloud, shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`);l.fragment.code.add(g.glsl`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`);l.fragment.code.add("\n    vec3 multipleOctaves(float extinction, float mu, float stepL) {\n      float attenuation \x3d 1.0;\n      float contribution \x3d 1.0;\n      float phaseAttenuation \x3d 1.0;\n      vec3 luminance \x3d vec3(0);\n\n      for (int i \x3d 0; i \x3c 4; i++) {\n        float phase \x3d mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);\n        luminance +\x3d contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);\n        attenuation *\x3d 0.2;\n        contribution *\x3d 0.6;\n        phaseAttenuation *\x3d 0.5;\n      }\n\n      return luminance;\n    }");
l.fragment.code.add(g.glsl`vec3 lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
vec3 beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`);l.fragment.code.add(g.glsl`vec3 mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return vec3(0);
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
vec3 color = vec3(0.0);
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
vec3 luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
color += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return color;
}`);l.fragment.code.add(g.glsl`void main() {
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
if (hitsPlanet) {
gl_FragColor = vec4(vec3(0), 1);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
float totalTransmittance = 1.0;
vec3 sunDirection = normalize(vec3(0, 0, 1));
vec3 col = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance).rgb;
gl_FragColor = vec4(col, totalTransmittance);
}`);return l}a.RayMarchingSteps=void 0;(function(f){f[f.SIXTEEN=0]="SIXTEEN";f[f.HUNDRED=1]="HUNDRED";f[f.TWOHUNDRED=2]="TWOHUNDRED";f[f.COUNT=3]="COUNT"})(a.RayMarchingSteps||(a.RayMarchingSteps={}));const n=Object.freeze({__proto__:null,get RayMarchingSteps(){return a.RayMarchingSteps},build:w});a.CloudsShader=n;a.build=w})},"esri/views/3d/environment/NoiseTextureAtlas":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/has ../../../core/maybe ./NoiseTextureAtlasTechnique ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/FramebufferObject".split(" "),
function(a,b,c,g,h,w,n,f){const l=c("esri-mobile")?64:128;c=l/128;const k=Math.ceil(Math.sqrt(l)),e=(l+2)*k;let d=function(){function m(v,q){this._frameBuffer=new f.FramebufferObject(v,{colorTarget:n.TargetType.TEXTURE,width:e,height:e},{target:n.TextureType.TEXTURE_2D,pixelFormat:n.PixelFormat.RGBA,dataType:n.PixelType.UNSIGNED_BYTE,wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:n.TextureSamplingMode.LINEAR,hasMipmap:!1,width:e,height:e});this._vao=w.createQuadVAO(v);this._technique=new h.NoiseTextureAtlasTechnique({rctx:v,
viewingMode:q.state.viewingMode})}var z=m.prototype;z.destroy=function(){this._technique=g.releaseMaybe(this._technique);this._frameBuffer=g.disposeMaybe(this._frameBuffer);this._vao=g.disposeMaybe(this._vao)};z.render=function(v){if(!g.isNone(this._vao)&&!g.isNone(this.textureAtlas)){var q=v.getViewport();v.setViewport(0,0,e,e);v.bindFramebuffer(this._frameBuffer);var t=v.useTechnique(this._technique);t.setUniform1f("tileSize",l);t.setUniform1f("tileRows",k);v.bindVAO(this._vao);t.assertCompatibleVertexAttributeLocations(this._vao);
v.gl.drawArrays(v.gl.TRIANGLE_STRIP,0,4);v.setViewport(q.x,q.y,q.width,q.height)}};b._createClass(m,[{key:"textureAtlas",get:function(){return this._frameBuffer.colorTexture}}]);return m}();a.ATLAS_SIZE=e;a.NoiseTextureAtlas=d;a.TEXTURE_SCALE=c;a.TILE_ROWS=k;a.TILE_SIZE=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/NoiseTextureAtlasTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/NoiseTextureAtlas.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k){w=function(e){function d(z){var v;return v=e.call(this,z,null,()=>v.destroy())||this}c._inheritsLoose(d,e);var m=d.prototype;m.initializeProgram=function(z){const v=d.shader.get().build();return new f.Program(z.rctx,v,n.Default3D)};m.initializePipeline=function(){return k.makePipelineState({blending:k.simpleBlendingParams(l.BlendFactor.ONE,l.BlendFactor.ZERO),depthTest:{func:l.CompareFunction.LEQUAL},colorWrite:k.defaultColorWriteParams})};return d}(w.ShaderTechnique);
w.shader=new h.ReloadableShaderModule(g.NoiseTextureAtlasShader,()=>new Promise((e,d)=>a(["./NoiseTextureAtlas.glsl"],e,d)));b.NoiseTextureAtlasTechnique=w;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/NoiseTextureAtlas.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],function(a,b,c,g){function h(){const n=new g.ShaderBuilder;
n.include(b.ScreenSpacePass,!1);n.fragment.uniforms.add("tileRows","float").add("tileSize","float");n.fragment.code.add(c.glsl`
    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    vec4 taylorInvSqrt(vec4 r) {
      return 1.79284291400159 - 0.85373472095314 * r;
    }

    vec4 mod289(vec4 x) {
      return x - floor( x * (1.0 / 289.0)) * 289.0;
    }

    vec4 permute(vec4 x) {
      return mod289(((x * 34.0) + 1.0) * x);
    }

    vec4 fade(vec4 t) {
      return (t * t * t) * (t * (t * vec4(6.0) - vec4(15.0)) + vec4(10.0));
    }

    float glmPerlin(vec4 Position, vec4 rep) {
      vec4 Pi0 = mod(floor(Position), rep);
      vec4 Pi1 = mod(Pi0 + 1.0, rep);
      vec4 Pf0 = fract(Position);
      vec4 Pf1 = Pf0 - 1.0;
      vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
      vec4 iy = vec4(Pi0.y, Pi0.y, Pi1.y, Pi1.y);

      vec4 ixy = permute(permute(ix) + iy);
      vec4 ixy0 = permute(ixy + vec4(Pi0.z));
      vec4 ixy1 = permute(ixy + vec4(Pi1.z));
      vec4 ixy00 = permute(ixy0 + vec4(Pi0.w));
      vec4 ixy01 = permute(ixy0 + vec4(Pi1.w));
      vec4 ixy10 = permute(ixy1 + vec4(Pi0.w));
      vec4 ixy11 = permute(ixy1 + vec4(Pi1.w));

      vec4 gx00 = ixy00 / 7.0;
      vec4 gy00 = floor(gx00) / 7.0;
      vec4 gz00 = floor(gy00) / 6.0;
      gx00 = fract(gx00) - 0.5;
      gy00 = fract(gy00) - 0.5;
      gz00 = fract(gz00) - 0.5;
      vec4 gw00 = vec4(0.75) - abs(gx00) - abs(gy00) - abs(gz00);
      vec4 sw00 = step(gw00, vec4(0.0));
      gx00 -= sw00 * (step(0.0, gx00) - 0.5);
      gy00 -= sw00 * (step(0.0, gy00) - 0.5);

      vec4 gx01 = ixy01 / 7.0;
      vec4 gy01 = floor(gx01) / 7.0;
      vec4 gz01 = floor(gy01) / 6.0;
      gx01 = fract(gx01) - 0.5;
      gy01 = fract(gy01) - 0.5;
      gz01 = fract(gz01) - 0.5;
      vec4 gw01 = vec4(0.75) - abs(gx01) - abs(gy01) - abs(gz01);
      vec4 sw01 = step(gw01, vec4(0.0));
      gx01 -= sw01 * (step(0.0, gx01) - 0.5);
      gy01 -= sw01 * (step(0.0, gy01) - 0.5);

      vec4 gx10 = ixy10 / 7.0;
      vec4 gy10 = floor(gx10) / 7.0;
      vec4 gz10 = floor(gy10) / 6.0;
      gx10 = fract(gx10) - 0.5;
      gy10 = fract(gy10) - 0.5;
      gz10 = fract(gz10) - 0.5;
      vec4 gw10 = vec4(0.75) - abs(gx10) - abs(gy10) - abs(gz10);
      vec4 sw10 = step(gw10, vec4(0.0));
      gx10 -= sw10 * (step(0.0, gx10) - 0.5);
      gy10 -= sw10 * (step(0.0, gy10) - 0.5);

      vec4 gx11 = ixy11 / 7.0;
      vec4 gy11 = floor(gx11) / 7.0;
      vec4 gz11 = floor(gy11) / 6.0;
      gx11 = fract(gx11) - 0.5;
      gy11 = fract(gy11) - 0.5;
      gz11 = fract(gz11) - 0.5;
      vec4 gw11 = vec4(0.75) - abs(gx11) - abs(gy11) - abs(gz11);
      vec4 sw11 = step(gw11, vec4(0.0));
      gx11 -= sw11 * (step(0.0, gx11) - 0.5);
      gy11 -= sw11 * (step(0.0, gy11) - 0.5);

      vec4 g0000 = vec4(gx00.x, gy00.x, gz00.x, gw00.x);
      vec4 g1000 = vec4(gx00.y, gy00.y, gz00.y, gw00.y);
      vec4 g0100 = vec4(gx00.z, gy00.z, gz00.z, gw00.z);
      vec4 g1100 = vec4(gx00.w, gy00.w, gz00.w, gw00.w);
      vec4 g0010 = vec4(gx10.x, gy10.x, gz10.x, gw10.x);
      vec4 g1010 = vec4(gx10.y, gy10.y, gz10.y, gw10.y);
      vec4 g0110 = vec4(gx10.z, gy10.z, gz10.z, gw10.z);
      vec4 g1110 = vec4(gx10.w, gy10.w, gz10.w, gw10.w);
      vec4 g0001 = vec4(gx01.x, gy01.x, gz01.x, gw01.x);
      vec4 g1001 = vec4(gx01.y, gy01.y, gz01.y, gw01.y);
      vec4 g0101 = vec4(gx01.z, gy01.z, gz01.z, gw01.z);
      vec4 g1101 = vec4(gx01.w, gy01.w, gz01.w, gw01.w);
      vec4 g0011 = vec4(gx11.x, gy11.x, gz11.x, gw11.x);
      vec4 g1011 = vec4(gx11.y, gy11.y, gz11.y, gw11.y);
      vec4 g0111 = vec4(gx11.z, gy11.z, gz11.z, gw11.z);
      vec4 g1111 = vec4(gx11.w, gy11.w, gz11.w, gw11.w);

      vec4 norm00 = taylorInvSqrt(vec4(dot(g0000, g0000), dot(g0100, g0100), dot(g1000, g1000), dot(g1100, g1100)));
      g0000 *= norm00.x;
      g0100 *= norm00.y;
      g1000 *= norm00.z;
      g1100 *= norm00.w;

      vec4 norm01 = taylorInvSqrt(vec4(dot(g0001, g0001), dot(g0101, g0101), dot(g1001, g1001), dot(g1101, g1101)));
      g0001 *= norm01.x;
      g0101 *= norm01.y;
      g1001 *= norm01.z;
      g1101 *= norm01.w;

      vec4 norm10 = taylorInvSqrt(vec4(dot(g0010, g0010), dot(g0110, g0110), dot(g1010, g1010), dot(g1110, g1110)));
      g0010 *= norm10.x;
      g0110 *= norm10.y;
      g1010 *= norm10.z;
      g1110 *= norm10.w;

      vec4 norm11 = taylorInvSqrt(vec4(dot(g0011, g0011), dot(g0111, g0111), dot(g1011, g1011), dot(g1111, g1111)));
      g0011 *= norm11.x;
      g0111 *= norm11.y;
      g1011 *= norm11.z;
      g1111 *= norm11.w;

      float n0000 = dot(g0000, Pf0);
      float n1000 = dot(g1000, vec4(Pf1.x, Pf0.y, Pf0.z, Pf0.w));
      float n0100 = dot(g0100, vec4(Pf0.x, Pf1.y, Pf0.z, Pf0.w));
      float n1100 = dot(g1100, vec4(Pf1.x, Pf1.y, Pf0.z, Pf0.w));
      float n0010 = dot(g0010, vec4(Pf0.x, Pf0.y, Pf1.z, Pf0.w));
      float n1010 = dot(g1010, vec4(Pf1.x, Pf0.y, Pf1.z, Pf0.w));
      float n0110 = dot(g0110, vec4(Pf0.x, Pf1.y, Pf1.z, Pf0.w));
      float n1110 = dot(g1110, vec4(Pf1.x, Pf1.y, Pf1.z, Pf0.w));
      float n0001 = dot(g0001, vec4(Pf0.x, Pf0.y, Pf0.z, Pf1.w));
      float n1001 = dot(g1001, vec4(Pf1.x, Pf0.y, Pf0.z, Pf1.w));
      float n0101 = dot(g0101, vec4(Pf0.x, Pf1.y, Pf0.z, Pf1.w));
      float n1101 = dot(g1101, vec4(Pf1.x, Pf1.y, Pf0.z, Pf1.w));
      float n0011 = dot(g0011, vec4(Pf0.x, Pf0.y, Pf1.z, Pf1.w));
      float n1011 = dot(g1011, vec4(Pf1.x, Pf0.y, Pf1.z, Pf1.w));
      float n0111 = dot(g0111, vec4(Pf0.x, Pf1.y, Pf1.z, Pf1.w));
      float n1111 = dot(g1111, Pf1);

      vec4 fade_xyzw = fade(Pf0);
      vec4 n_0w = mix(vec4(n0000, n1000, n0100, n1100), vec4(n0001, n1001, n0101, n1101), fade_xyzw.w);
      vec4 n_1w = mix(vec4(n0010, n1010, n0110, n1110), vec4(n0011, n1011, n0111, n1111), fade_xyzw.w);
      vec4 n_zw = mix(n_0w, n_1w, fade_xyzw.z);
      vec2 n_yzw = mix(vec2(n_zw.x, n_zw.y), vec2(n_zw.z, n_zw.w), fade_xyzw.y);
      float n_xyzw = mix(n_yzw.x, n_yzw.y, fade_xyzw.x);
      return 2.2 * n_xyzw;
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * glmPerlin(vec4(p, 0.0), vec4(frequency));
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float hash(float p) {
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);;
    }

    float noise(vec3 x) {
      vec3 p = floor(x);
      vec3 f = fract(x);

      f = f * f * (3.0 - 2.0 * f);
      float n = p.x + p.y * 57.0 + 113.0 * p.z;

      return mix(
      mix(
        mix(hash(n + 0.0), hash(n + 1.0), f.x),
        mix(hash(n + 57.0), hash(n + 58.0), f.x),
        f.y),
      mix(
        mix(hash(n + 113.0), hash(n + 114.0), f.x),
        mix(hash(n + 170.0), hash(n + 171.0), f.x),
        f.y),
      f.z);
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - noise(mod(tp, numCells));
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv, float tileRows) {
      vec2 tile = floor(uv);
      float z = floor(tileRows * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${c.glsl.float(8)});

      float worley0 = worley(p, ${c.glsl.float(2)} * 2.0);
      float worley1 = worley(p, ${c.glsl.float(2)} * 8.0);
      float worley2 = worley(p, ${c.glsl.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${c.glsl.float(2)});
      float worley1 = worley(p, ${c.glsl.float(2)} * 2.0);
      float worley2 = worley(p, ${c.glsl.float(2)} * 4.0);
      float worley3 = worley(p, ${c.glsl.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `);n.fragment.code.add(c.glsl`void main() {
float padWidth = 1.0;
float paddedSize = tileSize + 2.0 * padWidth;
float tileCount = tileRows * tileRows;
vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);
bool padCell = false;
if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
padCell = true;
}
if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
padCell = true;
}
bool startPadX = false;
bool startPadY = false;
bool endPadX = false;
bool endPadY = false;
if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
startPadX = true;
}
if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
startPadY = true;
}
if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
endPadX = true;
}
if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
endPadY = true;
}
vec2 padding = vec2(2.0 * padWidth) * tile;
vec2 uv;
if (padCell) {
vec2 pixel = gl_FragCoord.xy - padWidth - padding;
if (startPadX) {
pixel.x += tileSize;
}
if (startPadY) {
pixel.y += tileSize;
}
if (endPadX) {
pixel.x -= tileSize;
}
if (endPadY) {
pixel.y -= tileSize;
}
uv = vec2(pixel.xy / tileSize);
} else {
vec2 pixel = gl_FragCoord.xy - padWidth - padding;
uv = vec2(pixel.xy / tileSize);
}
vec3 p_ = get3Dfrom2D(uv, tileRows);
vec3 p = p_;
p.z /= (tileRows * tileRows);
float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
float worleyNoise = getTextureForPointWorley(p);
gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
p_ = mod(p_ + 1.0, tileRows * tileRows);
p = p_;
p.z /= (tileRows * tileRows);
worleyPerlinNoise = getTextureForPointPerlinWorley(p);
worleyNoise = getTextureForPointWorley(p);
gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
gl_FragColor.ba = vec2(0.0, 1.0);
}`);return n}const w=Object.freeze({__proto__:null,build:h});a.NoiseTextureAtlasShader=w;a.build=h})},"esri/views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass":function(){define(["exports","../shaderModules/interfaces","../../lib/VertexAttribute"],function(a,b,c){a.ScreenSpacePass=function(g,h=!0){g.attributes.add(c.VertexAttribute.POSITION,"vec2");h&&g.varyings.add("uv","vec2");g.vertex.code.add(b.glsl`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${h?b.glsl`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/FramebufferObject":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/Logger ../../core/maybe ./BufferObject ./checkWebGLError ./context-util ./enums ./Renderbuffer ./Texture ./Util".split(" "),function(a,b,c,g,h,w,n,f,l,k,e){function d(r){return"type"in r&&"texture"===r.type}function m(r){return d(r)||"pixelFormat"in r}function z(r,x){r.target!==f.TextureType.TEXTURE_2D&&r.target!==f.TextureType.TEXTURE_CUBE_MAP&&
console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!");void 0!==x.width&&0<=x.width&&void 0!==x.height&&0<=x.height?x.width===r.width&&x.height===r.height||console.error("Color attachment texture must match the framebuffer's!"):(x.width=r.width,x.height=r.height)}function v(r,x){void 0!==x.width&&0<=x.width&&void 0!==x.height&&0<=x.height?x.width===r.width&&x.height===r.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(x.width=r.width,x.height=r.height)}
function q(r){return r.descriptor.target===f.TextureType.TEXTURE_CUBE_MAP?f.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X:f.TextureType.TEXTURE_2D}const t=c.getLogger("esri.views.webgl.FrameBufferObject");c=function(){function r(u,E,y=null,A=null){this._context=u;this._stencilAttachment=this._depthAttachment=this._glName=null;this._colorAttachments=new Map;this._initialized=!1;this._desc={...E};u.instanceCounter.increment(f.ResourceType.Framebuffer,this);if(g.isSome(y))for(Array.isArray(y)||(y=[y]),u=0;u<
y.length;++u){E=y[u];const B=f.ColorAttachment.COLOR_ATTACHMENT0+u;let D;m(E)?(d(E)?(D=E.descriptor,this._colorAttachments.set(B,E)):(D=E,this._colorAttachments.set(B,new k.Texture(this._context,D))),z(D,this._desc)):("type"in E&&"renderbuffer"===E.type?(D=E.descriptor,this._colorAttachments.set(B,E)):(D=E,this._colorAttachments.set(B,new l.Renderbuffer(this._context,D))),v(D,this._desc));this._validateColorAttachmentPoint(B)}if(g.isSome(A))if(m(A))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),
d(A)?(y=A.descriptor,this._depthStencilTexture=A):(y=A,this._depthStencilTexture=new k.Texture(this._context,y)),z(y,this._desc);else{var p;"type"in A&&"renderbuffer"===A.type?y=A.descriptor:(y=A,A=new l.Renderbuffer(this._context,y));u=null!=(p=this._desc.depthStencilTarget)?p:f.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER;u===f.DepthStencilTargetType.STENCIL_RENDER_BUFFER?this._stencilAttachment=A:u===f.DepthStencilTargetType.DEPTH_RENDER_BUFFER||u===f.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER?
this._depthAttachment=A:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER');v(y,this._desc)}}var x=r.prototype;x.dispose=function(){if(this._desc){var u=this._context.getBoundFramebufferObject();this._disposeColorAttachments();this._disposeDepthStencilAttachments();this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null);this._context.bindFramebuffer(u);this._context.instanceCounter.decrement(f.ResourceType.Framebuffer,
this);this._desc=null}};x.getColorTexture=function(u){return(u=this._colorAttachments.get(u))&&d(u)?u:null};x.attachColorTexture=function(u,E=f.ColorAttachment.COLOR_ATTACHMENT0){u&&(this._validateColorAttachmentPoint(E),z(u.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(u.glName,E)),this._colorAttachments.set(E,u))};x.detachColorTexture=function(u=f.ColorAttachment.COLOR_ATTACHMENT0){const E=this._colorAttachments.get(u);
if(d(E))return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,u)),this._colorAttachments.delete(u),E};x.setColorTextureTarget=function(u,E=f.ColorAttachment.COLOR_ATTACHMENT0){const y=this._colorAttachments.get(E);d(y)&&this._framebufferTexture2D(y.glName,E,u)};x.attachDepthStencilTexture=function(u){if(!g.isNone(u)){var E=u.descriptor;E.pixelFormat!==f.PixelFormat.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");
E.dataType!==f.PixelType.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!");this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");z(E,this._desc);this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==f.DepthStencilTargetType.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=f.DepthStencilTargetType.DEPTH_STENCIL_TEXTURE);this._disposeDepthStencilAttachments();
this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(u.glName,f.DepthStencilAttachment));this._depthStencilTexture=u}};x.detachDepthStencilTexture=function(){const u=this._depthStencilTexture;u&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,f.DepthStencilAttachment));this._depthStencilTexture=null;return u};x.attachDepthStencilBuffer=function(u){if(!g.isNone(u)){var E=u.descriptor;E.internalFormat!==f.RenderbufferFormat.DEPTH_STENCIL&&
E.internalFormat!==f.RenderbufferFormat.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat");v(E,this._desc);this._disposeDepthStencilAttachments();this._desc.depthStencilTarget=E.internalFormat===f.RenderbufferFormat.DEPTH_STENCIL?f.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER:f.DepthStencilTargetType.DEPTH_RENDER_BUFFER;this._initialized&&(this._context.bindFramebuffer(this),E=this._context.gl,E.framebufferRenderbuffer(f.FramebufferTarget.FRAMEBUFFER,this._desc.depthStencilTarget===
f.DepthStencilTargetType.DEPTH_RENDER_BUFFER?E.DEPTH_ATTACHMENT:E.DEPTH_STENCIL_ATTACHMENT,E.RENDERBUFFER,u.glName));this._depthAttachment=u}};x.detachDepthStencilBuffer=function(){const u=this._context.gl,E=this._depthAttachment;E&&this._initialized&&(this._context.bindFramebuffer(this),u.framebufferRenderbuffer(f.FramebufferTarget.FRAMEBUFFER,this._desc.depthStencilTarget===f.DepthStencilTargetType.DEPTH_RENDER_BUFFER?u.DEPTH_ATTACHMENT:u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,null));this._depthAttachment=
null;return E};x.detachAll=function(){this._colorAttachments.forEach((u,E)=>this._detachColorAttachment(E));this.detachDepthStencilBuffer();this.detachDepthStencilTexture()};x.copyToTexture=function(u,E,y,A,p,B,D){(0>u||0>E||0>p||0>B)&&console.error("Offsets cannot be negative!");(0>=y||0>=A)&&console.error("Copy width and height must be greater than zero!");var C=this._desc;const F=D.descriptor;D.descriptor.target!==f.TextureType.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!");(u+
y>C.width||E+A>C.height||p+y>F.width||B+A>F.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");C=this._context;D=C.bindTexture(D,k.Texture.TEXTURE_UNIT_FOR_UPDATES);C.setActiveTexture(k.Texture.TEXTURE_UNIT_FOR_UPDATES);C.bindFramebuffer(this);C.gl.copyTexSubImage2D(f.TextureType.TEXTURE_2D,0,p,B,u,E,y,A);C.bindTexture(D,k.Texture.TEXTURE_UNIT_FOR_UPDATES)};x.readPixels=function(u,E,y,A,p,B,D){(0>=y||0>=A)&&console.error("Copy width and height must be greater than zero!");
D||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(u,E,y,A,p,B,D)};x.readPixelsAsync=function(){var u=b._asyncToGenerator(function*(E,y,A,p,B,D,C){if(this._context.type!==n.ContextType.WEBGL2)w.webglDebugEnabled()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),this.readPixels(E,y,A,p,B,D,C);else{var F=this._context.gl,G=h.BufferObject.createPixelPack(this._context,f.Usage.STREAM_READ,C.byteLength);
this._context.bindBuffer(G);this._context.bindFramebuffer(this);F.readPixels(E,y,A,p,B,D,0);this._context.unbindBuffer(f.BufferType.PIXEL_PACK_BUFFER);yield G.getSubDataAsync(C);G.dispose()}});return function(E,y,A,p,B,D,C){return u.apply(this,arguments)}}();x.resize=function(u,E){const y=this._desc;if(y.width!==u||y.height!==E)if(this._initialized){y.width=u;y.height=E;this._colorAttachments.forEach(A=>{A&&A.resize(u,E)});if(null!=this._depthStencilTexture)this._depthStencilTexture.resize(u,E);else if(this._depthAttachment||
this._stencilAttachment)this._depthAttachment&&this._depthAttachment.resize(u,E),this._stencilAttachment&&this._stencilAttachment.resize(u,E);this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null);this._initialized=!1}else y.width=u,y.height=E,this._colorAttachments.forEach(A=>{A&&A.resize(u,E)}),this._depthStencilTexture&&this._depthStencilTexture.resize(u,E)};x.initializeAndBind=function(u=f.FramebufferTarget.FRAMEBUFFER){var E,y,A,p;const B=this._context.gl;if(this._initialized)B.bindFramebuffer(u,
this.glName);else{this._glName&&B.deleteFramebuffer(this._glName);var D=this._context,C=B.createFramebuffer(),F=this._desc,G=null!=(E=F.colorTarget)?E:f.TargetType.RENDER_BUFFER;E=null!=(y=F.width)?y:1;y=null!=(A=F.height)?A:1;B.bindFramebuffer(u,C);0===this._colorAttachments.size&&(G===f.TargetType.TEXTURE||G===f.TargetType.CUBEMAP?this._colorAttachments.set(f.ColorAttachment.COLOR_ATTACHMENT0,new k.Texture(D,{target:this.descriptor.colorTarget===f.TargetType.CUBEMAP?f.TextureType.TEXTURE_CUBE_MAP:
f.TextureType.TEXTURE_2D,pixelFormat:f.PixelFormat.RGBA,dataType:f.PixelType.UNSIGNED_BYTE,samplingMode:f.TextureSamplingMode.NEAREST,wrapMode:f.TextureWrapMode.CLAMP_TO_EDGE,width:F.width,height:F.height})):(A=new l.Renderbuffer(D,{internalFormat:f.SizedPixelFormat.RGBA4,width:E,height:y}),this._colorAttachments.set(f.ColorAttachment.COLOR_ATTACHMENT0,A)));this._colorAttachments.forEach((L,H)=>{L&&(d(L)?this._framebufferTexture2D(L.glName,H,q(L),u):B.framebufferRenderbuffer(u,H,B.RENDERBUFFER,L.glName))});
A=null!=(p=F.depthStencilTarget)?p:f.DepthStencilTargetType.NONE;switch(A){case f.DepthStencilTargetType.DEPTH_RENDER_BUFFER:case f.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER:this._depthAttachment||(this._depthAttachment=new l.Renderbuffer(D,{internalFormat:F.depthStencilTarget===f.DepthStencilTargetType.DEPTH_RENDER_BUFFER?f.RenderbufferFormat.DEPTH_COMPONENT16:f.RenderbufferFormat.DEPTH_STENCIL,width:E,height:y}));B.framebufferRenderbuffer(u,A===f.DepthStencilTargetType.DEPTH_RENDER_BUFFER?
B.DEPTH_ATTACHMENT:B.DEPTH_STENCIL_ATTACHMENT,B.RENDERBUFFER,this._depthAttachment.glName);break;case f.DepthStencilTargetType.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new l.Renderbuffer(D,{internalFormat:f.RenderbufferFormat.STENCIL_INDEX8,width:E,height:y}));B.framebufferRenderbuffer(u,B.STENCIL_ATTACHMENT,B.RENDERBUFFER,this._stencilAttachment.glName);break;case f.DepthStencilTargetType.DEPTH_STENCIL_TEXTURE:this._depthStencilTexture||(D.capabilities.depthTexture||
console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),this._depthStencilTexture=new k.Texture(D,{target:f.TextureType.TEXTURE_2D,pixelFormat:f.PixelFormat.DEPTH_STENCIL,dataType:f.PixelType.UNSIGNED_INT_24_8,samplingMode:f.TextureSamplingMode.NEAREST,wrapMode:f.TextureWrapMode.CLAMP_TO_EDGE,width:E,height:y})),this._framebufferTexture2D(this._depthStencilTexture.glName,B.DEPTH_STENCIL_ATTACHMENT,q(this._depthStencilTexture),
u)}w.webglValidateShadersEnabled()&&B.checkFramebufferStatus(u)!==B.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");this._glName=C;this._initialized=!0}};x._framebufferTexture2D=function(u,E=f.ColorAttachment.COLOR_ATTACHMENT0,y=f.TextureType.TEXTURE_2D,A=f.FramebufferTarget.FRAMEBUFFER,p=0){this._context.gl.framebufferTexture2D(A,E,y,u,p)};x._detachColorAttachment=function(u){w.webglDebugEnabled()&&console.warn("Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!");
const E=this._context.gl,y=this._colorAttachments.get(u);d(y)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,u)):this._initialized&&(this._context.bindFramebuffer(this),E.framebufferRenderbuffer(f.FramebufferTarget.FRAMEBUFFER,u,E.RENDERBUFFER,null));this._colorAttachments.delete(u);return y};x._disposeColorAttachments=function(){this._colorAttachments.forEach((u,E)=>{this._detachColorAttachment(E);u.dispose()});this._colorAttachments.clear()};x._disposeDepthStencilAttachments=
function(){const u=this._context.gl;this._depthAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),u.framebufferRenderbuffer(f.FramebufferTarget.FRAMEBUFFER,this._desc.depthStencilTarget===f.DepthStencilTargetType.DEPTH_RENDER_BUFFER?u.DEPTH_ATTACHMENT:u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,null)),this._depthAttachment.dispose(),this._depthAttachment=null);this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),u.framebufferRenderbuffer(f.FramebufferTarget.FRAMEBUFFER,
u.STENCIL_ATTACHMENT,u.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null);this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,u.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)};x._validateColorAttachmentPoint=function(u){if(-1===r._MAX_COLOR_ATTACHMENTS){const E=this._context.capabilities.drawBuffers;r._MAX_COLOR_ATTACHMENTS=E?this._context.gl.getParameter(E.MAX_COLOR_ATTACHMENTS):
1}u-=f.ColorAttachment.COLOR_ATTACHMENT0;u+1>r._MAX_COLOR_ATTACHMENTS&&t.error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${u+1}. Implementation supports up to ${r._MAX_COLOR_ATTACHMENTS} color attachments`)};b._createClass(r,[{key:"glName",get:function(){return this._glName}},{key:"descriptor",get:function(){return this._desc}},{key:"colorTexture",get:function(){const u=this._colorAttachments.get(f.ColorAttachment.COLOR_ATTACHMENT0);return u&&d(u)?u:null}},{key:"colorAttachment",
get:function(){return this._colorAttachments.get(f.ColorAttachment.COLOR_ATTACHMENT0)}},{key:"depthStencilAttachment",get:function(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}},{key:"depthStencilTexture",get:function(){return this._depthStencilTexture}},{key:"width",get:function(){return this._desc.width}},{key:"height",get:function(){return this._desc.height}},{key:"gpuMemoryUsage",get:function(){return[...this._colorAttachments].reduce((u,[,E])=>u+e.getGpuMemoryUsage(E),
0)+e.getGpuMemoryUsage(this.depthStencilAttachment)}}]);return r}();c._MAX_COLOR_ATTACHMENTS=-1;a.FramebufferObject=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/Renderbuffer":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./context-util","./enums"],function(a,b,c,g){let h=function(){function w(f,l){this._context=f;this._desc=l;this.type="renderbuffer";this._context.instanceCounter.increment(g.ResourceType.Renderbuffer,this);f=this._context.gl;this.glName=
f.createRenderbuffer();this._context.bindRenderbuffer(this);const {width:k,height:e,internalFormat:d,multisampled:m}=l;if(m){if(this._context.type!==c.ContextType.WEBGL2)throw Error("Multisampled renderbuffers are not supported in WebGL1!");f.renderbufferStorageMultisample(f.RENDERBUFFER,this.samples,d,k,e)}else f.renderbufferStorage(f.RENDERBUFFER,d,k,e)}var n=w.prototype;n.resize=function(f,l){const k=this._desc;if(k.width!==f||k.height!==l)k.width=f,k.height=l,f=this._context.gl,this._context.bindRenderbuffer(this),
k.multisampled?f.renderbufferStorageMultisample(f.RENDERBUFFER,this.samples,k.internalFormat,k.width,k.height):f.renderbufferStorage(f.RENDERBUFFER,k.internalFormat,k.width,k.height)};n.dispose=function(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(g.ResourceType.Renderbuffer,this),this._context=null)};b._createClass(w,[{key:"descriptor",get:function(){return this._desc}},{key:"samples",get:function(){const f=this._desc.samples,l=this._context.parameters.maxSamples;
return f?Math.min(f,l):l}}]);return w}();a.Renderbuffer=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/CloudsTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/Clouds.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){n=function(m){function z(q,t){var r;return r=m.call(this,q,t,()=>r.destroy())||this}c._inheritsLoose(z,m);var v=z.prototype;v.initializeProgram=function(q){const t=z.shader.get().build({steps:this.configuration.steps});return new k.Program(q.rctx,t,l.Default3D)};v.initializePipeline=function(){return d.makePipelineState({blending:d.separateBlendingParams(e.BlendFactor.ONE,e.BlendFactor.ONE,e.BlendFactor.ZERO,e.BlendFactor.ZERO),depthTest:{func:e.CompareFunction.LEQUAL},
colorWrite:d.defaultColorWriteParams})};return z}(n.ShaderTechnique);n.shader=new w.ReloadableShaderModule(h.CloudsShader,()=>new Promise((m,z)=>a(["./Clouds.glsl"],m,z)));w=function(m){function z(){var v=m.apply(this,arguments)||this;v.steps=h.RayMarchingSteps.SIXTEEN;return v}c._inheritsLoose(z,m);return z}(f.ShaderTechniqueConfiguration);g.__decorate([f.parameter({count:h.RayMarchingSteps.COUNT})],w.prototype,"steps",void 0);b.CloudsTechnique=n;b.CloudsTechniqueConfiguration=w;Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/views/3d/environment/Fog":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../geometry/projectionEllipsoid ./atmosphereUtils ./FogTechnique ./weather ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p){a.Fog=function(B){function D(F){var G=B.call(this,F)||this;G._projectionInverse=m.create();G._viewInverse=m.create();G._nearFar=v.create();G._fogColor=t.create();G._fogColorAtNight=t.create();G._cameraDirection=t.create();G._foggyFadeStart=.3;G._foggyFadeEnd=.6;G._hazeFadeStart=.7;G._hazeFadeEnd=1;G._strength=4E-6;G._vao=A.createQuadVAO(F.context.renderContext.rctx,y.Pos2Tex);F=r.getReferenceEllipsoid(F.view.spatialReference);G._planetRadius=
F.radius;G._atmosphereRadius=F.radius+x.atmosphereHeight;return G}b._inheritsLoose(D,B);var C=D.prototype;C.destroy=function(){this._hazeFogTechnique=w.releaseMaybe(this._hazeFogTechnique);this._thickFogTechnique=w.releaseMaybe(this._thickFogTechnique);this._vao=w.disposeMaybe(this._vao)};C.when=function(){return Promise.resolve()};C.render=function(F,G,L){if(0!==this.view.basemapTerrain.baseOpacity||G)if(this._update(F,G,L),!(0>=this._fogAmount)){var H=F.offscreenRenderingHelper,M=G?this.thickFogTechnique:
this.hazeFogTechnique,K=F.rctx.useTechnique(M);H.renderDepthDetached(()=>{K.bindTexture(H.depthTexture,"depthTex");this._renderFog(M.program,F)})}};C._renderFog=function(F,G){if(w.isNone(this._vao))return!1;const L=G.rctx;F.setUniform3fv("cameraPosition",G.camera.eye);F.setUniformMatrix4fv("inverseProjectionMatrix",this._projectionInverse);F.setUniformMatrix4fv("inverseViewMatrix",this._viewInverse);F.setUniform2fv("nearFar",this._nearFar);F.setUniform1f("atmosphereC",this._atmosphereC);F.setUniform1f("fogStrength",
this._strength);F.setUniform1f("fogAmount",this._fogAmount);F.setUniform3fv("fogColor",this._fogColor);L.bindVAO(this._vao);F.assertCompatibleVertexAttributeLocations(this._vao);L.drawArrays(p.PrimitiveType.TRIANGLE_STRIP,0,4);return!0};C._update=function(F,G,L){if(!w.isNone(F.camera)){var H=G?.1:0;L?q.set(this._fogColor,.5,.5,.5):G?q.set(this._fogColor,1.5,1.5,1.5):q.set(this._fogColor,.24,.44,.8);q.scale(this._fogColorAtNight,this._fogColor,H);q.normalize(this._cameraDirection,F.camera.eye);L=Math.max(0,
q.dot(this._cameraDirection,F.scenelightingData.lightingMainDirection));q.lerp(this._fogColor,this._fogColorAtNight,this._fogColor,L);d.invert(this._projectionInverse,F.camera.projectionMatrix);d.invert(this._viewInverse,F.camera.viewMatrix);z.set(this._nearFar,F.camera.near,F.camera.far);F=q.length(F.camera.eye);this._atmosphereC=F*F-this._atmosphereRadius*this._atmosphereRadius;this._fogAmount=G?1-h.smoothstep(this._foggyFadeStart*E.weatherHeightLimit,this._foggyFadeEnd*E.weatherHeightLimit,Math.abs(F-
this._planetRadius)):1-h.smoothstep(this._hazeFadeStart*E.weatherHeightLimit,this._hazeFadeEnd*E.weatherHeightLimit,Math.abs(F-this._planetRadius))}};D.isSupported=function(F){return F.capabilities.depthTexture};b._createClass(D,[{key:"_shaderTechniqueRepository",get:function(){return this.context.shaderTechniqueRepository}},{key:"strength",get:function(){return this._strength},set:function(F){this._strength=F}},{key:"thickFogTechnique",get:function(){if(w.isNone(this._thickFogTechnique)){const F=
new u.FogTechniqueConfiguration;F.haze=!1;this._thickFogTechnique=this._shaderTechniqueRepository.acquire(u.FogTechnique,F)}return this._thickFogTechnique}},{key:"hazeFogTechnique",get:function(){if(w.isNone(this._hazeFogTechnique)){const F=new u.FogTechniqueConfiguration;F.haze=!0;this._hazeFogTechnique=this._shaderTechniqueRepository.acquire(u.FogTechnique,F)}return this._hazeFogTechnique}}]);return D}(g);c.__decorate([n.property({constructOnly:!0})],a.Fog.prototype,"context",void 0);c.__decorate([n.property({constructOnly:!0})],
a.Fog.prototype,"view",void 0);a.Fog=c.__decorate([e.subclass("esri.views.3d.environment.Fog")],a.Fog);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/FogTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/Fog.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){n=function(m){function z(){return m.apply(this,arguments)||this}c._inheritsLoose(z,m);var v=z.prototype;v.initializeProgram=function(q){const t=z.shader.get().build({haze:this.configuration.haze});return new k.Program(q.rctx,t,l.Default3D)};v.initializePipeline=function(){return this.configuration.haze?d.makePipelineState({blending:d.separateBlendingParams(e.BlendFactor.ONE,e.BlendFactor.ZERO,e.BlendFactor.ONE_MINUS_SRC_COLOR,e.BlendFactor.ONE),colorWrite:d.defaultColorWriteParams}):
d.makePipelineState({blending:d.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ZERO,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE),colorWrite:d.defaultColorWriteParams})};return z}(n.ShaderTechnique);n.shader=new w.ReloadableShaderModule(h.FogShader,()=>new Promise((m,z)=>a(["./Fog.glsl"],m,z)));h=function(m){function z(){var v=m.apply(this,arguments)||this;v.haze=!1;return v}c._inheritsLoose(z,m);return z}(f.ShaderTechniqueConfiguration);g.__decorate([f.parameter()],h.prototype,
"haze",void 0);b.FogTechnique=n;b.FogTechniqueConfiguration=h;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/Fog.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,g,h,w,n){function f(k){const e=new w.ShaderBuilder;e.attributes.add(n.VertexAttribute.POSITION,"vec2");e.include(b.TextureCoordinateAttribute,{attributeTextureCoordinates:b.TextureCoordinateAttributeType.Default});e.varyings.add("worldRay","vec3");e.varyings.add("eyeDir","vec3");e.vertex.uniforms.add("inverseProjectionMatrix","mat4");e.vertex.uniforms.add("inverseViewMatrix","mat4");e.vertex.code.add(h.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`);e.fragment.uniforms.add("atmosphereC","float").add("cameraPosition","vec3").add("nearFar","vec2").add("depthTex","sampler2D").add("fogStrength","float").add("fogAmount","float").add("fogColor","vec3");e.include(g.Gamma);e.fragment.include(c.ReadLinearDepth);e.fragment.code.add(h.glsl`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`);e.fragment.code.add(h.glsl`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`);e.fragment.code.add(h.glsl`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${k.haze?h.glsl`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `);return e}const l=Object.freeze({__proto__:null,build:f});a.FogShader=l;a.build=f})},"esri/views/3d/environment/PanoramicAtmosphere":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../support/requestImageUtils ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechnique ./resources/SimpleAtmosphereTexture ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/core/shaderLibrary/util/View.glsl ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y){const A=c.getLogger("esri.views.3d.environment.PanoramicAtmosphere");c=function(){function D(){this.type="panoramic";this._techniqueConfig=new k.SimpleAtmosphereTechniqueConfiguration;this._readyResolver=h.createResolver();this._readyController=new AbortController}var C=D.prototype;C.destroy=function(){this._readyResolver.reject();this._texture=g.disposeMaybe(this._texture);this._vao=g.disposeMaybe(this._vao);this._readyController=g.abortMaybe(this._readyController)};
C.when=function(){return this._readyResolver.promise};C.initializeRenderContext=function(F){this._techniqueConfig.geometry=l.SimpleAtmosphereGeometry.Cylinder;this._technique=F.shaderTechniqueRepository.acquire(k.SimpleAtmosphereTechnique,this._techniqueConfig);const G=F.renderContext.rctx;this._vao=this._createVertexArrayObject(G);this._vaoCount=E.vertexCount(this._vao,"geometry");f.requestImage(e,{signal:this._readyController.signal}).then(L=>{this._texture=new u.Texture(G,{pixelFormat:x.PixelFormat.RGBA,
dataType:x.PixelType.UNSIGNED_BYTE,wrapMode:x.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:x.TextureSamplingMode.LINEAR,flipped:!0},L);F.requestRender();this._readyController=null;this._readyResolver.resolve()}).catch(L=>{h.isAbortError(L)||A.error("Unable to initialize atmosphere: image request failed",L);this._readyResolver.reject()})};C.render=function(F){const G=F.rctx,L=G.useTechnique(this._technique);L.bindTexture(this._texture,"tex");z.bindProjectionMatrix(L,F.camera.projectionMatrix);var H=
p;w.copy(H,F.camera.viewMatrix);H[12]=0;H[13]=0;H[14]=0;H[15]=1;L.setUniformMatrix4fv("view",p);L.setUniform4f("uColor",1,1,1,1);F.scenelightingData.setLightDirectionUniform(L);G.bindVAO(this._vao);L.assertCompatibleVertexAttributeLocations(this._vao);G.drawArrays(x.PrimitiveType.TRIANGLES,0,this._vaoCount)};C.renderHaze=function(){return!1};C._createVertexArrayObject=function(F){var G=q.createPolySphereGeometry(1,2,!1);const L=G.indices.get(t.VertexAttribute.POSITION);for(var H=0;H<L.length;H+=3){var M=
L[H];L[H]=L[H+2];L[H+2]=M}G=G.vertexAttributes.get(t.VertexAttribute.POSITION).data;H=B.createBuffer(L.length);M=H.position;for(let K=0;K<L.length;++K){const I=3*L[K];M.set(K,0,G[I]);M.set(K,1,G[I+1]);M.set(K,2,G[I+2])}return new y.VertexArrayObject(F,v.Default3D,{geometry:d.glLayout(B)},{geometry:r.BufferObject.createVertex(F,x.Usage.STATIC_DRAW,H.buffer)})};b._createClass(D,[{key:"canRender",get:function(){return null!=this._texture}}]);return D}();const p=n.create(),B=m.newLayout().vec3f(t.VertexAttribute.POSITION);
a.PanoramicAtmosphere=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/support/requestImageUtils":function(){define(["exports","../chunks/_rollupPluginBabelHelpers","../request"],function(a,b,c){function g(){g=b._asyncToGenerator(function*(h,w){({data:h}=yield c(h,{responseType:"image",...w}));return h});return g.apply(this,arguments)}a.requestImage=function(h,w){return g.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/SimpleAtmosphere.glsl":function(){define(["exports",
"../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/lib/VertexAttribute"],function(a,b,c,g,h){function w(f){const l=new g.ShaderBuilder;f.geometry===a.SimpleAtmosphereGeometry.Underground?(l.attributes.add(h.VertexAttribute.POSITION,"vec2"),l.varyings.add("color","vec4"),l.vertex.uniforms.add("lightingMainDirection","vec3").add("cameraPosition","vec3").add("undergroundFadeAlpha",
"float"),l.vertex.code.add(c.glsl`void main(void) {
float ndotl = dot(normalize(cameraPosition), lightingMainDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),l.fragment.code.add(c.glsl`void main() {
gl_FragColor = color;
}`)):(l.include(b.Transform,{linearDepth:!1}),l.attributes.add(h.VertexAttribute.POSITION,"vec3"),l.varyings.add("vtc","vec2"),l.varyings.add("falloff","float"),f=f.geometry===a.SimpleAtmosphereGeometry.Cylinder,l.vertex.uniforms.add("proj","mat4").add("view","mat4").add("lightingMainDirection","vec3"),f||(l.varyings.add("innerFactor","float"),l.vertex.uniforms.add("silCircleCenter","vec3").add("silCircleV1","vec3").add("silCircleV2","vec3").add("texV","vec2").add("innerScale","float")),l.vertex.code.add(c.glsl`
		void main(void) {
      ${f?c.glsl`
      vec3 pos = position;
      float ndotl = lightingMainDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:c.glsl`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${c.glsl.float(.04908738515625)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), lightingMainDirection);
      vtc.x = position.x  * ${c.glsl.float(.0078125)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),l.fragment.uniforms.add("tex","sampler2D"),f||l.fragment.uniforms.add("altitudeFade","float"),l.fragment.code.add(c.glsl`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${f?c.glsl`gl_FragColor = atmosphereColor;`:c.glsl`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`));return l}a.SimpleAtmosphereGeometry=void 0;(function(f){f[f.Cone=0]="Cone";f[f.Cylinder=1]="Cylinder";f[f.Underground=2]="Underground";f[f.COUNT=3]="COUNT"})(a.SimpleAtmosphereGeometry||(a.SimpleAtmosphereGeometry={}));const n=Object.freeze({__proto__:null,get SimpleAtmosphereGeometry(){return a.SimpleAtmosphereGeometry},build:w});a.SimpleAtmosphereShader=n;a.build=w})},"esri/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl":function(){define(["exports","../shaderModules/interfaces"],
function(a,b){a.Transform=function(c,g){g={hasModelTransformation:!1,...g};g.hasModelTransformation?g.linearDepth?c.vertex.code.add(b.glsl`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):c.vertex.code.add(b.glsl`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`):g.linearDepth?c.vertex.code.add(b.glsl`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):c.vertex.code.add(b.glsl`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/SimpleAtmosphereTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/SimpleAtmosphere.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){n=function(m){function z(){return m.apply(this,arguments)||this}c._inheritsLoose(z,m);var v=z.prototype;v.initializeProgram=function(q){const t=z.shader.get().build({geometry:this.configuration.geometry});return new k.Program(q.rctx,t,l.Default3D)};v.initializePipeline=function(){return this.configuration.geometry===h.SimpleAtmosphereGeometry.Cylinder?d.makePipelineState({blending:d.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,
e.BlendFactor.ONE_MINUS_SRC_ALPHA),culling:d.backFaceCullingParams,depthTest:{func:e.CompareFunction.LEQUAL},colorWrite:d.defaultColorWriteParams}):d.makePipelineState({blending:d.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:e.CompareFunction.LEQUAL},colorWrite:d.defaultColorWriteParams})};return z}(n.ShaderTechnique);n.shader=new w.ReloadableShaderModule(h.SimpleAtmosphereShader,()=>new Promise((m,
z)=>a(["./SimpleAtmosphere.glsl"],m,z)));w=function(m){function z(){var v=m.apply(this,arguments)||this;v.geometry=h.SimpleAtmosphereGeometry.Cone;return v}c._inheritsLoose(z,m);return z}(f.ShaderTechniqueConfiguration);g.__decorate([f.parameter({count:h.SimpleAtmosphereGeometry.COUNT})],w.prototype,"geometry",void 0);b.SimpleAtmosphereTechnique=n;b.SimpleAtmosphereTechniqueConfiguration=w;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define(function(){return"data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAACXBIWXMAAC4jAAAuIwF4pT92AAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAXVJREFUeNq0k9GWhDAIQ3PjzP9/cuehFqhW19mz++IhkCZAq1prsqT+kSQS9g8Vnqp6VGVWkYVktR6tj3Gr968nLnfwlHzHYyHapkKS73bPd/39eI38AYWj24OGvqdwWjZ3l8IDgacXyl1Dj9tdLOzZiicj+P1YcGk0H2O2vN/VQpTveEHmPHQxZxYlqsQdhUeuCWREuDEvAjqlCqDIMYwIo2ijR1HdYUS58dQrKpgQ0EGeMocsTNXrxzyOhS9kfzlWjn82YuWLqwAnvfNEWJFjYXkJCT0s7AmS0NG4x7Lt6Cpy2MiVPBZmS668QT5AR1cevp7b6CpzQ/ZSNH0vmhy5CsNtdax0MBpXDBiFsrDiMSLKMc8b6hH93bNbEpRsIyHDUhNcfTyeKF16PC7c/2QdczvUnvOB1ylZHVFSMtd5s8C2IW/7w6hwM5GLavLCd1zkiFjB+BwH1DSgctQ7mPOimBLJrw35beSXkd8BM/cCqbXWPgMA+GQQ5sIgkfAAAAAASUVORK5CYII\x3d"})},
"esri/views/3d/support/buffer/glUtil":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,b,c){const g={u8:b.DataType.UNSIGNED_BYTE,u16:b.DataType.UNSIGNED_SHORT,u32:b.DataType.UNSIGNED_INT,i8:b.DataType.BYTE,i16:b.DataType.SHORT,i32:b.DataType.INT,f32:b.DataType.FLOAT};a.glLayout=function(h,w=0){const n=h.stride;return h.fieldNames.filter(f=>{f=h.fields.get(f).optional;return!(f&&f.glPadding)}).map(f=>{const l=h.fields.get(f),k=l.constructor.ElementCount;
var e=g[l.constructor.ElementType];if(!e)throw Error("BufferType not supported in WebGL");return new c.VertexElementDescriptor(f,k,e,l.offset,n,!(!l.optional||!l.optional.glNormalized),w)})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../geometry/support/buffer/BufferView","../../../../geometry/support/buffer/types"],function(a,b,c,g){let h=function(){function n(l,
k){this.layout=l;this.buffer="number"===typeof k?new ArrayBuffer(k*l.stride):k;for(const e of l.fieldNames)k=l.fields.get(e),this[e]=new k.constructor(this.buffer,k.offset,this.stride)}var f=n.prototype;f.getField=function(l,k){return(l=this[l])&&l.elementCount===k.ElementCount&&l.elementType===k.ElementType?l:null};f.slice=function(l,k){return new n(this.layout,this.buffer.slice(l*this.stride,k*this.stride))};f.copyFrom=function(l,k,e,d){const m=this.stride;0===m%4?(l=new Uint32Array(l.buffer,k*
m,d*m/4),(new Uint32Array(this.buffer,e*m,d*m/4)).set(l)):(l=new Uint8Array(l.buffer,k*m,d*m),(new Uint8Array(this.buffer,e*m,d*m)).set(l))};b._createClass(n,[{key:"stride",get:function(){return this.layout.stride}},{key:"count",get:function(){return this.buffer.byteLength/this.stride}},{key:"byteLength",get:function(){return this.buffer.byteLength}}]);return n}(),w=function(){function n(){this.stride=0;this.fields=new Map;this.fieldNames=[]}var f=n.prototype;f.vec2f=function(l,k){this._appendField(l,
c.BufferViewVec2f,k);return this};f.vec2f64=function(l,k){this._appendField(l,c.BufferViewVec2f64,k);return this};f.vec3f=function(l,k){this._appendField(l,c.BufferViewVec3f,k);return this};f.vec3f64=function(l,k){this._appendField(l,c.BufferViewVec3f64,k);return this};f.vec4f=function(l,k){this._appendField(l,c.BufferViewVec4f,k);return this};f.vec4f64=function(l,k){this._appendField(l,c.BufferViewVec4f64,k);return this};f.mat3f=function(l,k){this._appendField(l,c.BufferViewMat3f,k);return this};
f.mat3f64=function(l,k){this._appendField(l,c.BufferViewMat3f64,k);return this};f.mat4f=function(l,k){this._appendField(l,c.BufferViewMat4f,k);return this};f.mat4f64=function(l,k){this._appendField(l,c.BufferViewMat4f64,k);return this};f.vec4u8=function(l,k){this._appendField(l,c.BufferViewVec4u8,k);return this};f.f32=function(l,k){this._appendField(l,c.BufferViewFloat,k);return this};f.f64=function(l,k){this._appendField(l,c.BufferViewFloat64,k);return this};f.u8=function(l,k){this._appendField(l,
c.BufferViewUint8,k);return this};f.u16=function(l,k){this._appendField(l,c.BufferViewUint16,k);return this};f.i8=function(l,k){this._appendField(l,c.BufferViewInt8,k);return this};f.vec2i8=function(l,k){this._appendField(l,c.BufferViewVec2i8,k);return this};f.vec2i16=function(l,k){this._appendField(l,c.BufferViewVec2i16,k);return this};f.vec2u8=function(l,k){this._appendField(l,c.BufferViewVec2u8,k);return this};f.vec4u16=function(l,k){this._appendField(l,c.BufferViewVec4u16,k);return this};f.u32=
function(l,k){this._appendField(l,c.BufferViewUint32,k);return this};f._appendField=function(l,k,e){const d=k.ElementCount*g.elementTypeSize(k.ElementType);this.fields.set(l,{size:d,constructor:k,offset:this.stride,optional:e});this.stride+=d;this.fieldNames.push(l)};f.alignTo=function(l){this.stride=Math.floor((this.stride+l-1)/l)*l;return this};f.hasField=function(l){return 0<=this.fieldNames.indexOf(l)};f.createBuffer=function(l){return new h(this,l)};f.createView=function(l){return new h(this,
l)};f.clone=function(){const l=new n;l.stride=this.stride;l.fields=new Map;this.fields.forEach((k,e)=>l.fields.set(e,k));l.fieldNames=this.fieldNames.slice();l.BufferType=this.BufferType;return l};return n}();a.InterleavedBuffer=h;a.InterleavedLayout=w;a.newLayout=function(){return new w};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/BufferView":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ./internals/Mat3 ./internals/Mat4 ./internals/Scalar ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),
function(a,b,c,g,h,w,n,f){let l=function(N){function R(S,T=0,V,W){S=N.call(this,Float32Array,S,T,V,W)||this;S.elementType="f32";return S}b._inheritsLoose(R,N);R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(h.BufferViewScalarImpl);l.ElementType="f32";let k=function(N){function R(S,T=0,V,W){S=N.call(this,Float32Array,S,T,V,W)||this;S.elementType="f32";return S}b._inheritsLoose(R,N);R.prototype.slice=function(S,T){return this.sliceBuffer(R,S,
T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(w.BufferViewVec2Impl);k.ElementType="f32";let e=function(N){function R(S,T=0,V,W){S=N.call(this,Float32Array,S,T,V,W)||this;S.elementType="f32";return S}b._inheritsLoose(R,N);R.prototype.slice=function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(n.BufferViewVec3Impl);e.ElementType="f32";let d=
function(N){function R(S,T=0,V,W){S=N.call(this,Float32Array,S,T,V,W)||this;S.elementType="f32";return S}b._inheritsLoose(R,N);R.prototype.slice=function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(f.BufferViewVec4Impl);d.ElementType="f32";let m=function(N){function R(S,T=0,V,W){S=N.call(this,Float32Array,S,T,V,W)||this;S.elementType="f32";return S}b._inheritsLoose(R,N);R.prototype.slice=function(S,
T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(c.BufferViewMat3Impl);m.ElementType="f32";c=function(N){function R(S,T=0,V,W){S=N.call(this,Float64Array,S,T,V,W)||this;S.elementType="f64";return S}b._inheritsLoose(R,N);R.prototype.slice=function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(c.BufferViewMat3Impl);
c.ElementType="f64";let z=function(N){function R(S,T=0,V,W){S=N.call(this,Float32Array,S,T,V,W)||this;S.elementType="f32";return S}b._inheritsLoose(R,N);R.prototype.slice=function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(g.BufferViewMat4Impl);z.ElementType="f32";g=function(N){function R(S,T=0,V,W){S=N.call(this,Float64Array,S,T,V,W)||this;S.elementType="f64";return S}b._inheritsLoose(R,N);R.prototype.slice=
function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(g.BufferViewMat4Impl);g.ElementType="f64";let v=function(N){function R(S,T=0,V,W){S=N.call(this,Float64Array,S,T,V,W)||this;S.elementType="f64";return S}b._inheritsLoose(R,N);R.prototype.slice=function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(h.BufferViewScalarImpl);
v.ElementType="f64";let q=function(N){function R(S,T=0,V,W){S=N.call(this,Float64Array,S,T,V,W)||this;S.elementType="f64";return S}b._inheritsLoose(R,N);R.prototype.slice=function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(w.BufferViewVec2Impl);q.ElementType="f64";let t=function(N){function R(S,T=0,V,W){S=N.call(this,Float64Array,S,T,V,W)||this;S.elementType="f64";return S}b._inheritsLoose(R,N);R.prototype.slice=
function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(n.BufferViewVec3Impl);t.ElementType="f64";let r=function(N){function R(S,T=0,V,W){S=N.call(this,Float64Array,S,T,V,W)||this;S.elementType="f64";return S}b._inheritsLoose(R,N);R.prototype.slice=function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(f.BufferViewVec4Impl);
r.ElementType="f64";let x=function(N){function R(S,T=0,V,W){S=N.call(this,Uint8Array,S,T,V,W)||this;S.elementType="u8";return S}b._inheritsLoose(R,N);R.prototype.slice=function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(h.BufferViewScalarImpl);x.ElementType="u8";let u=function(N){function R(S,T=0,V,W){S=N.call(this,Uint8Array,S,T,V,W)||this;S.elementType="u8";return S}b._inheritsLoose(R,N);R.prototype.slice=
function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(w.BufferViewVec2Impl);u.ElementType="u8";let E=function(N){function R(S,T=0,V,W){S=N.call(this,Uint8Array,S,T,V,W)||this;S.elementType="u8";return S}b._inheritsLoose(R,N);R.prototype.slice=function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(n.BufferViewVec3Impl);
E.ElementType="u8";let y=function(N){function R(S,T=0,V,W){S=N.call(this,Uint8Array,S,T,V,W)||this;S.elementType="u8";return S}b._inheritsLoose(R,N);R.prototype.slice=function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(f.BufferViewVec4Impl);y.ElementType="u8";let A=function(N){function R(S,T=0,V,W){S=N.call(this,Uint16Array,S,T,V,W)||this;S.elementType="u16";return S}b._inheritsLoose(R,N);R.prototype.slice=
function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(h.BufferViewScalarImpl);A.ElementType="u16";let p=function(N){function R(S,T=0,V,W){S=N.call(this,Uint16Array,S,T,V,W)||this;S.elementType="u16";return S}b._inheritsLoose(R,N);R.prototype.slice=function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(w.BufferViewVec2Impl);
p.ElementType="u16";let B=function(N){function R(S,T=0,V,W){S=N.call(this,Uint16Array,S,T,V,W)||this;S.elementType="u16";return S}b._inheritsLoose(R,N);R.prototype.slice=function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(n.BufferViewVec3Impl);B.ElementType="u16";let D=function(N){function R(S,T=0,V,W){S=N.call(this,Uint16Array,S,T,V,W)||this;S.elementType="u16";return S}b._inheritsLoose(R,N);R.prototype.slice=
function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(f.BufferViewVec4Impl);D.ElementType="u16";let C=function(N){function R(S,T=0,V,W){S=N.call(this,Uint32Array,S,T,V,W)||this;S.elementType="u32";return S}b._inheritsLoose(R,N);R.prototype.slice=function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(h.BufferViewScalarImpl);
C.ElementType="u32";let F=function(N){function R(S,T=0,V,W){S=N.call(this,Uint32Array,S,T,V,W)||this;S.elementType="u32";return S}b._inheritsLoose(R,N);R.prototype.slice=function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(w.BufferViewVec2Impl);F.ElementType="u32";let G=function(N){function R(S,T=0,V,W){S=N.call(this,Uint32Array,S,T,V,W)||this;S.elementType="u32";return S}b._inheritsLoose(R,N);R.prototype.slice=
function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(n.BufferViewVec3Impl);G.ElementType="u32";let L=function(N){function R(S,T=0,V,W){S=N.call(this,Uint32Array,S,T,V,W)||this;S.elementType="u32";return S}b._inheritsLoose(R,N);R.prototype.slice=function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(f.BufferViewVec4Impl);
L.ElementType="u32";let H=function(N){function R(S,T=0,V,W){S=N.call(this,Int8Array,S,T,V,W)||this;S.elementType="i8";return S}b._inheritsLoose(R,N);R.prototype.slice=function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(h.BufferViewScalarImpl);H.ElementType="i8";let M=function(N){function R(S,T=0,V,W){S=N.call(this,Int8Array,S,T,V,W)||this;S.elementType="i8";return S}b._inheritsLoose(R,N);R.prototype.slice=
function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(w.BufferViewVec2Impl);M.ElementType="i8";let K=function(N){function R(S,T=0,V,W){S=N.call(this,Int8Array,S,T,V,W)||this;S.elementType="i8";return S}b._inheritsLoose(R,N);R.prototype.slice=function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(n.BufferViewVec3Impl);
K.ElementType="i8";let I=function(N){function R(S,T=0,V,W){S=N.call(this,Int8Array,S,T,V,W)||this;S.elementType="i8";return S}b._inheritsLoose(R,N);R.prototype.slice=function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(f.BufferViewVec4Impl);I.ElementType="i8";let O=function(N){function R(S,T=0,V,W){S=N.call(this,Int16Array,S,T,V,W)||this;S.elementType="i16";return S}b._inheritsLoose(R,N);R.prototype.slice=
function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(h.BufferViewScalarImpl);O.ElementType="i16";let Q=function(N){function R(S,T=0,V,W){S=N.call(this,Int16Array,S,T,V,W)||this;S.elementType="i16";return S}b._inheritsLoose(R,N);R.prototype.slice=function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(w.BufferViewVec2Impl);
Q.ElementType="i16";let J=function(N){function R(S,T=0,V,W){S=N.call(this,Int16Array,S,T,V,W)||this;S.elementType="i16";return S}b._inheritsLoose(R,N);R.prototype.slice=function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(n.BufferViewVec3Impl);J.ElementType="i16";let P=function(N){function R(S,T=0,V,W){S=N.call(this,Int16Array,S,T,V,W)||this;S.elementType="i16";return S}b._inheritsLoose(R,N);R.prototype.slice=
function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(f.BufferViewVec4Impl);P.ElementType="i16";h=function(N){function R(S,T=0,V,W){S=N.call(this,Int32Array,S,T,V,W)||this;S.elementType="i32";return S}b._inheritsLoose(R,N);R.prototype.slice=function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(h.BufferViewScalarImpl);
h.ElementType="i32";w=function(N){function R(S,T=0,V,W){S=N.call(this,Int32Array,S,T,V,W)||this;S.elementType="i32";return S}b._inheritsLoose(R,N);R.prototype.slice=function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(w.BufferViewVec2Impl);w.ElementType="i32";n=function(N){function R(S,T=0,V,W){S=N.call(this,Int32Array,S,T,V,W)||this;S.elementType="i32";return S}b._inheritsLoose(R,N);R.prototype.slice=
function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(n.BufferViewVec3Impl);n.ElementType="i32";f=function(N){function R(S,T=0,V,W){S=N.call(this,Int32Array,S,T,V,W)||this;S.elementType="i32";return S}b._inheritsLoose(R,N);R.prototype.slice=function(S,T){return this.sliceBuffer(R,S,T)};R.fromTypedArray=function(S,T){return new R(S.buffer,S.byteOffset,T,S.byteOffset+S.byteLength)};return R}(f.BufferViewVec4Impl);
f.ElementType="i32";a.BufferViewFloat=l;a.BufferViewFloat64=v;a.BufferViewInt16=O;a.BufferViewInt32=h;a.BufferViewInt8=H;a.BufferViewMat3f=m;a.BufferViewMat3f64=c;a.BufferViewMat4f=z;a.BufferViewMat4f64=g;a.BufferViewUint16=A;a.BufferViewUint32=C;a.BufferViewUint8=x;a.BufferViewVec2f=k;a.BufferViewVec2f64=q;a.BufferViewVec2i16=Q;a.BufferViewVec2i32=w;a.BufferViewVec2i8=M;a.BufferViewVec2u16=p;a.BufferViewVec2u32=F;a.BufferViewVec2u8=u;a.BufferViewVec3f=e;a.BufferViewVec3f64=t;a.BufferViewVec3i16=
J;a.BufferViewVec3i32=n;a.BufferViewVec3i8=K;a.BufferViewVec3u16=B;a.BufferViewVec3u32=G;a.BufferViewVec3u8=E;a.BufferViewVec4f=d;a.BufferViewVec4f64=r;a.BufferViewVec4i16=P;a.BufferViewVec4i32=f;a.BufferViewVec4i8=I;a.BufferViewVec4u16=D;a.BufferViewVec4u32=L;a.BufferViewVec4u8=y;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/internals/Mat3":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function g(w,
n,f=0,l,k){this.TypedArrayConstructor=w;this.elementCount=9;w=this.TypedArrayConstructor;void 0===l&&(l=9*w.BYTES_PER_ELEMENT);const e=0===n.byteLength?0:f;this.typedBuffer=null==k?new w(n,e):new w(n,e,(k-f)/w.BYTES_PER_ELEMENT);this.typedBufferStride=l/w.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var h=g.prototype;h.sliceBuffer=function(w,n,f=this.count-n){n=this.typedBuffer.byteOffset+
n*this.stride;return new w(this.buffer,n,this.stride,n+f*this.stride)};h.getMat=function(w,n){w*=this.typedBufferStride;for(let f=0;9>f;f++)n[f]=this.typedBuffer[w++];return n};h.setMat=function(w,n){w*=this.typedBufferStride;for(let f=0;9>f;f++)this.typedBuffer[w++]=n[f]};h.get=function(w,n){return this.typedBuffer[w*this.typedBufferStride+n]};h.set=function(w,n,f){this.typedBuffer[w*this.typedBufferStride+n]=f};h.copyFrom=function(w,n,f){const l=this.typedBuffer,k=n.typedBuffer;w*=this.typedBufferStride;
n=f*n.typedBufferStride;for(f=0;9>f;++f)l[w++]=k[n++]};b._createClass(g,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return g}();c.ElementCount=9;a.BufferViewMat3Impl=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/internals/Mat4":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function g(w,n,f=0,l,k){this.TypedArrayConstructor=w;this.elementCount=16;w=this.TypedArrayConstructor;void 0===
l&&(l=16*w.BYTES_PER_ELEMENT);const e=0===n.byteLength?0:f;this.typedBuffer=null==k?new w(n,e):new w(n,e,(k-f)/w.BYTES_PER_ELEMENT);this.typedBufferStride=l/w.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var h=g.prototype;h.sliceBuffer=function(w,n,f=this.count-n){n=this.typedBuffer.byteOffset+n*this.stride;return new w(this.buffer,n,this.stride,n+f*this.stride)};h.getMat=function(w,
n){w*=this.typedBufferStride;for(let f=0;16>f;f++)n[f]=this.typedBuffer[w++];return n};h.setMat=function(w,n){w*=this.typedBufferStride;for(let f=0;16>f;f++)this.typedBuffer[w++]=n[f]};h.get=function(w,n){return this.typedBuffer[w*this.typedBufferStride+n]};h.set=function(w,n,f){this.typedBuffer[w*this.typedBufferStride+n]=f};h.copyFrom=function(w,n,f){const l=this.typedBuffer,k=n.typedBuffer;w*=this.typedBufferStride;n=f*n.typedBufferStride;for(f=0;16>f;++f)l[w++]=k[n++]};b._createClass(g,[{key:"buffer",
get:function(){return this.typedBuffer.buffer}}]);return g}();c.ElementCount=16;a.BufferViewMat4Impl=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/internals/Scalar":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function g(w,n,f=0,l,k){this.TypedArrayConstructor=w;this.elementCount=1;w=this.TypedArrayConstructor;void 0===l&&(l=w.BYTES_PER_ELEMENT);const e=0===n.byteLength?0:f;this.typedBuffer=null==
k?new w(n,e):new w(n,e,(k-f)/w.BYTES_PER_ELEMENT);this.typedBufferStride=l/w.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var h=g.prototype;h.sliceBuffer=function(w,n,f=this.count-n){n=this.typedBuffer.byteOffset+n*this.stride;return new w(this.buffer,n,this.stride,n+f*this.stride)};h.get=function(w){return this.typedBuffer[w*this.typedBufferStride]};h.set=function(w,n){this.typedBuffer[w*
this.typedBufferStride]=n};b._createClass(g,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return g}();c.ElementCount=1;a.BufferViewScalarImpl=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/internals/Vec2":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec2"],function(a,b,c){let g=function(){function h(n,f,l=0,k,e){this.TypedArrayConstructor=n;this.elementCount=2;n=this.TypedArrayConstructor;void 0===
k&&(k=2*n.BYTES_PER_ELEMENT);const d=0===f.byteLength?0:l;this.typedBuffer=null==e?new n(f,d):new n(f,d,(e-l)/n.BYTES_PER_ELEMENT);this.typedBufferStride=k/n.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var w=h.prototype;w.sliceBuffer=function(n,f,l=this.count-f){f=this.typedBuffer.byteOffset+f*this.stride;return new n(this.buffer,f,this.stride,f+l*this.stride)};w.getVec=function(n,
f){n*=this.typedBufferStride;return c.set(f,this.typedBuffer[n],this.typedBuffer[n+1])};w.setVec=function(n,f){n*=this.typedBufferStride;this.typedBuffer[n++]=f[0];this.typedBuffer[n]=f[1]};w.get=function(n,f){return this.typedBuffer[n*this.typedBufferStride+f]};w.set=function(n,f,l){this.typedBuffer[n*this.typedBufferStride+f]=l};w.setValues=function(n,f,l){n*=this.typedBufferStride;this.typedBuffer[n++]=f;this.typedBuffer[n]=l};w.copyFrom=function(n,f,l){const k=this.typedBuffer,e=f.typedBuffer;
n*=this.typedBufferStride;f=l*f.typedBufferStride;k[n++]=e[f++];k[n]=e[f]};b._createClass(h,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return h}();g.ElementCount=2;a.BufferViewVec2Impl=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/internals/Vec3":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec3"],function(a,b,c){let g=function(){function h(n,f,l=0,k,e){this.TypedArrayConstructor=n;this.elementCount=
3;n=this.TypedArrayConstructor;void 0===k&&(k=3*n.BYTES_PER_ELEMENT);const d=0===f.byteLength?0:l;this.typedBuffer=null==e?new n(f,d):new n(f,d,(e-l)/n.BYTES_PER_ELEMENT);this.typedBufferStride=k/n.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var w=h.prototype;w.sliceBuffer=function(n,f,l=this.count-f){f=this.typedBuffer.byteOffset+f*this.stride;return new n(this.buffer,f,this.stride,
f+l*this.stride)};w.getVec=function(n,f){n*=this.typedBufferStride;return c.set(f,this.typedBuffer[n],this.typedBuffer[n+1],this.typedBuffer[n+2])};w.setVec=function(n,f){n*=this.typedBufferStride;this.typedBuffer[n++]=f[0];this.typedBuffer[n++]=f[1];this.typedBuffer[n]=f[2]};w.get=function(n,f){return this.typedBuffer[n*this.typedBufferStride+f]};w.set=function(n,f,l){this.typedBuffer[n*this.typedBufferStride+f]=l};w.setValues=function(n,f,l,k){n*=this.typedBufferStride;this.typedBuffer[n++]=f;this.typedBuffer[n++]=
l;this.typedBuffer[n]=k};w.copyFrom=function(n,f,l){const k=this.typedBuffer,e=f.typedBuffer;n*=this.typedBufferStride;f=l*f.typedBufferStride;k[n++]=e[f++];k[n++]=e[f++];k[n]=e[f]};b._createClass(h,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return h}();g.ElementCount=3;a.BufferViewVec3Impl=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/internals/Vec4":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec4"],
function(a,b,c){let g=function(){function h(n,f,l=0,k,e){this.TypedArrayConstructor=n;this.elementCount=4;n=this.TypedArrayConstructor;void 0===k&&(k=4*n.BYTES_PER_ELEMENT);const d=0===f.byteLength?0:l;this.typedBuffer=null==e?new n(f,d):new n(f,d,(e-l)/n.BYTES_PER_ELEMENT);this.typedBufferStride=k/n.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var w=h.prototype;w.sliceBuffer=
function(n,f,l=this.count-f){f=this.typedBuffer.byteOffset+f*this.stride;return new n(this.buffer,f,this.stride,f+l*this.stride)};w.getVec=function(n,f){n*=this.typedBufferStride;return c.set(f,this.typedBuffer[n++],this.typedBuffer[n++],this.typedBuffer[n++],this.typedBuffer[n])};w.setVec=function(n,f){n*=this.typedBufferStride;this.typedBuffer[n++]=f[0];this.typedBuffer[n++]=f[1];this.typedBuffer[n++]=f[2];this.typedBuffer[n]=f[3]};w.get=function(n,f){return this.typedBuffer[n*this.typedBufferStride+
f]};w.set=function(n,f,l){this.typedBuffer[n*this.typedBufferStride+f]=l};w.setValues=function(n,f,l,k,e){n*=this.typedBufferStride;this.typedBuffer[n++]=f;this.typedBuffer[n++]=l;this.typedBuffer[n++]=k;this.typedBuffer[n]=e};w.copyFrom=function(n,f,l){const k=this.typedBuffer,e=f.typedBuffer;n*=this.typedBufferStride;f=l*f.typedBufferStride;k[n++]=e[f++];k[n++]=e[f++];k[n++]=e[f++];k[n]=e[f]};b._createClass(h,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return h}();g.ElementCount=
4;a.BufferViewVec4Impl=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/types":function(){define(["exports","../../../core/has"],function(a,b){a.elementTypeSize=function(c){switch(c){case "u8":return 1;case "u16":return 2;case "u32":return 4;case "i8":return 1;case "i16":return 2;case "i32":return 4;case "f32":return 4;case "f64":return 8}};a.isInteger=function(c){switch(c){case "u8":case "u16":case "u32":case "i8":case "i16":case "i32":return!0;case "f32":case "f64":return!1}};
a.isSigned=function(c){switch(c){case "u8":case "u16":case "u32":return!1;case "i8":case "i16":case "i32":case "f32":case "f64":return!0}};a.maximumValue=function(c){switch(c){case "u8":return 255;case "u16":return 65535;case "u32":return 4294967295;case "i8":return 127;case "i16":return 32767;case "i32":return 2147483647;case "f32":return 3.402823E38;case "f64":return 1.79769E308}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl":function(){define(["exports",
"../../../../../../chunks/mat4","../../../../../../chunks/mat4f32"],function(a,b,c){function g(w,n,f){b.translate(h,f,n);w.setUniform3fv("localOrigin",n);w.setUniformMatrix4fv("view",h)}const h=c.create();a.bindCameraPosition=function(w,n,f){w.setUniform3f("cameraPosition",f[3]-n[0],f[7]-n[1],f[11]-n[2])};a.bindProjectionMatrix=function(w,n){w.setUniformMatrix4fv("proj",n)};a.bindView=function(w,n){g(w,n.origin,n.camera.viewMatrix)};a.bindViewCustomOrigin=g;a.bindViewport=function(w,n){w.setUniform4fv("viewport",
n.camera.fullViewport)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../geometry/support/plane ../../../../geometry/support/ray ./basicInterfaces ./BufferVectorMath ./Geometry ./geometryDataUtils ./Util ./VertexAttribute".split(" "),function(a,b,c,g,h,w,n,f,l,k,e){const d=n.Vec3Compact;var m;(function(r){const x=[[-.5,-.5,.5],[.5,-.5,.5],[.5,
.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],u=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],E=[0,0,1,0,1,1,0,1],y=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),A=new Uint16Array(36);for(var p=0;6>p;p++)for(let D=0;6>D;D++)A[6*p+D]=p;const B=new Uint16Array(36);for(p=0;6>p;p++)B[6*p]=0,B[6*p+1]=1,B[6*p+2]=2,B[6*p+3]=2,B[6*p+4]=3,B[6*p+5]=0;r.createGeometry=function(D){Array.isArray(D)||(D=[D,D,D]);const C=Array(24);for(let F=0;8>F;F++)C[3*
F]=x[F][0]*D[0],C[3*F+1]=x[F][1]*D[1],C[3*F+2]=x[F][2]*D[2];return new f.Geometry([[e.VertexAttribute.POSITION,{size:3,data:C,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:u}],[e.VertexAttribute.UV0,{size:2,data:E}]],[[e.VertexAttribute.POSITION,y],[e.VertexAttribute.NORMAL,A],[e.VertexAttribute.UV0,B]])}})(m||(m={}));var z;(function(r){const x=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],u=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],E=new Uint16Array([5,
1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),y=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);r.createGeometry=function(A){Array.isArray(A)||(A=[A,A,A]);const p=Array(18);for(let B=0;6>B;B++)p[3*B]=x[B][0]*A[0],p[3*B+1]=x[B][1]*A[1],p[3*B+2]=x[B][2]*A[2];return new f.Geometry([[e.VertexAttribute.POSITION,{size:3,data:p,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:u}]],[[e.VertexAttribute.POSITION,E],[e.VertexAttribute.NORMAL,y]])}})(z||(z={}));var v;(function(r){const x=
b.fromValues(-.5,0,-.5),u=b.fromValues(.5,0,-.5),E=b.fromValues(0,0,.5),y=b.fromValues(0,.5,0),A=b.create(),p=b.create(),B=b.create(),D=b.create(),C=b.create();a.subtract(A,x,y);a.subtract(p,x,u);a.cross(B,A,p);a.normalize(B,B);a.subtract(A,u,y);a.subtract(p,u,E);a.cross(D,A,p);a.normalize(D,D);a.subtract(A,E,y);a.subtract(p,E,x);a.cross(C,A,p);a.normalize(C,C);const F=[x,u,E,y],G=[0,-1,0,B[0],B[1],B[2],D[0],D[1],D[2],C[0],C[1],C[2]],L=[0,1,2,3,1,0,3,2,1,3,0,2],H=[0,0,0,1,1,1,2,2,2,3,3,3];r.createGeometry=
function(M){Array.isArray(M)||(M=[M,M,M]);const K=Array(12);for(let I=0;4>I;I++)K[3*I]=F[I][0]*M[0],K[3*I+1]=F[I][1]*M[1],K[3*I+2]=F[I][2]*M[2];return new f.Geometry([[e.VertexAttribute.POSITION,{size:3,data:K,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:G}]],[[e.VertexAttribute.POSITION,new Uint16Array(L)],[e.VertexAttribute.NORMAL,new Uint16Array(H)]])}})(v||(v={}));var q;(function(r){function x(y,A,p,B,D){if(Math.abs(a.dot(A,y))>D)return!1;a.cross(p,y,A);a.normalize(p,p);a.cross(B,p,y);
a.normalize(B,B);return!0}function u(y,A,p,B,D,C,F){return x(y,A,D,C,F)||x(y,p,D,C,F)||x(y,B,D,C,F)}r.createBoxGeometry=m.createGeometry;r.createDiamondGeometry=z.createGeometry;r.createTetrahedronGeometry=v.createGeometry;r.createSphereGeometry=function(y,A,p,B={uv:!0}){var D=-Math.PI,C=2*Math.PI,F=-Math.PI/2,G=Math.PI;A=Math.max(3,Math.floor(A));const L=Math.max(2,Math.floor(p));var H=(A+1)*(L+1);p=new Float32Array(3*H);const M=new Float32Array(3*H);H=new Float32Array(2*H);const K=[];let I=0;for(var O=
0;O<=L;O++){var Q=[];const P=O/L,N=F+P*G,R=Math.cos(N);for(let S=0;S<=A;S++){const T=S/A;var J=D+T*C;const V=Math.cos(J)*R,W=Math.sin(N);J=-Math.sin(J)*R;p[3*I]=V*y;p[3*I+1]=W*y;p[3*I+2]=J*y;M[3*I]=V;M[3*I+1]=W;M[3*I+2]=J;H[2*I]=T;H[2*I+1]=P;Q.push(I);++I}K.push(Q)}y=new Uint32Array(2*A*(L-1)*3);I=0;for(D=0;D<L;D++)for(C=0;C<A;C++)F=K[D][C],G=K[D][C+1],O=K[D+1][C+1],Q=K[D+1][C],0===D?(y[I++]=F,y[I++]=O,y[I++]=Q):D===L-1?(y[I++]=F,y[I++]=G,y[I++]=O):(y[I++]=F,y[I++]=G,y[I++]=O,y[I++]=O,y[I++]=Q,y[I++]=
F);A=[[e.VertexAttribute.POSITION,y],[e.VertexAttribute.NORMAL,y]];p=[[e.VertexAttribute.POSITION,{size:3,data:p,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:M,exclusive:!0}]];B.uv&&(p.push([e.VertexAttribute.UV0,{size:2,data:H,exclusive:!0}]),A.push([e.VertexAttribute.UV0,y]));B.offset&&(A[0][0]=e.VertexAttribute.OFFSET,p[0][0]=e.VertexAttribute.OFFSET,A.push([e.VertexAttribute.POSITION,new Uint32Array(y.length)]),p.push([e.VertexAttribute.POSITION,{size:3,data:Float64Array.from(B.offset),
exclusive:!0}]));return new f.Geometry(p,A)};r.createPolySphereGeometry=function(y,A,p){function B(G,L){G>L&&([G,L]=[L,G]);const H=G.toString()+"."+L.toString();if(F[H])return F[H];let M=D.length;D.length+=3;d.add(D,3*G,D,3*L,D,M);d.scale(D,M,y/d.length(D,M));M/=3;return F[H]=M}let D;p?(D=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],p=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1])):(p=y*(1+Math.sqrt(5))/2,D=[-y,p,0,y,p,0,-y,-p,0,y,-p,0,0,-y,p,0,y,p,0,-y,-p,0,y,-p,p,0,-y,p,0,y,-p,0,
-y,-p,0,y],p=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]));for(var C=0;C<D.length;C+=3)d.scale(D,C,y/d.length(D,C));let F={};for(C=0;C<A;C++){const G=p.length,L=new Uint32Array(4*G);for(let H=0;H<G;H+=3){const M=p[H],K=p[H+1],I=p[H+2],O=B(M,K),Q=B(K,I),J=B(I,M),P=4*H;L[P]=M;L[P+1]=O;L[P+2]=J;L[P+3]=K;L[P+4]=Q;L[P+5]=O;L[P+6]=I;L[P+7]=J;L[P+8]=Q;L[P+9]=O;L[P+10]=Q;L[P+11]=J}p=L;F={}}A=new Float32Array(D);
for(C=0;C<A.length;C+=3)d.normalize(A,C);p=[[e.VertexAttribute.POSITION,p],[e.VertexAttribute.NORMAL,p]];A=[[e.VertexAttribute.POSITION,{size:3,data:new Float32Array(D),exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:A,exclusive:!0}]];return new f.Geometry(A,p)};r.createPointGeometry=function(y,A,p,B,D,C,F){A=A?[A[0],A[1],A[2]]:[0,0,0];y=y?[y[0],y[1],y[2]]:[0,0,1];C=C||[0,0];p=[[e.VertexAttribute.POSITION,{size:3,data:A,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:y,exclusive:!0}],
[e.VertexAttribute.UV0,{size:C.length,data:C}],[e.VertexAttribute.COLOR,{size:4,data:p?[255*p[0],255*p[1],255*p[2],3<p.length?255*p[3]:255]:[255,255,255,255],exclusive:!0}],[e.VertexAttribute.SIZE,{size:2,data:null!=B&&2===B.length?B:[1,1]}]];null!=D&&(D=new Float32Array([D[0],D[1],D[2],D[3]]),p.push([e.VertexAttribute.AUXPOS1,{size:4,data:D}]));null!=F&&(F=new Float32Array([F[0],F[1],F[2],F[3]]),p.push([e.VertexAttribute.AUXPOS2,{size:4,data:F}]));return new f.Geometry(p,null,w.PrimitiveType.Point)};
r.updatePointGeometry=function(y,A,p,B,D,C,F,G){if(null!=y){const {data:L}=G.getMutableAttribute(e.VertexAttribute.NORMAL);L[0]=y[0];L[1]=y[1];L[2]=y[2]}null!=A&&({data:y}=G.getMutableAttribute(e.VertexAttribute.POSITION),y[0]=A[0],y[1]=A[1],y[2]=A[2]);null!=p&&({data:A}=G.getMutableAttribute(e.VertexAttribute.COLOR),A[0]=p[0],A[1]=p[1],A[2]=p[2],A[3]=p[3]);null!=B&&({data:p}=G.getMutableAttribute(e.VertexAttribute.SIZE),p[0]=B[0],p[1]=B[1]);null!=D&&({data:B}=G.getMutableAttribute(e.VertexAttribute.AUXPOS1),
B[0]=D[0],B[1]=D[1],B[2]=D[2],B[3]=D[3]);null!=C&&({data:D}=G.getMutableAttribute(e.VertexAttribute.UV0),D[0]=C[0],D[1]=C[1]);null!=F&&({data:C}=G.getMutableAttribute(e.VertexAttribute.AUXPOS2),C[0]=F[0],C[1]=F[1],C[2]=F[2],C[3]=F[3])};r.createPointArrayGeometry=function(y,A){const p=new Float32Array(3*y.length),B=new Float32Array(A?3*y.length:3),D=new Uint32Array(y.length),C=new Uint32Array(y.length);for(let F=0;F<y.length;F++)p[3*F]=y[F][0],p[3*F+1]=y[F][1],p[3*F+2]=y[F][2],A&&(B[3*F]=A[F][0],B[3*
F+1]=A[F][1],B[3*F+2]=A[F][2]),D[F]=F,C[F]=0;A||(B[0]=0,B[1]=1,B[2]=0);return new f.Geometry([[e.VertexAttribute.POSITION,{size:3,data:p,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:B,exclusive:!0}],[e.VertexAttribute.UV0,{size:2,data:[0,0],exclusive:!0}]],[[e.VertexAttribute.POSITION,D],[e.VertexAttribute.NORMAL,A?D:C],[e.VertexAttribute.UV0,C]],w.PrimitiveType.Point)};r.createTriangleGeometry=function(){const y=new Uint16Array([0,1,2]),A=new Uint16Array([0,0,0]),p=new Uint16Array([0,0,
0]);return new f.Geometry([[e.VertexAttribute.POSITION,{size:3,data:[0,0,0,0,0,100,100,0,0],exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:[0,1,0],exclusive:!0}],[e.VertexAttribute.UV0,{size:2,data:[0,0],exclusive:!0}]],[[e.VertexAttribute.POSITION,y],[e.VertexAttribute.NORMAL,A],[e.VertexAttribute.UV0,p]])};const E=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];r.createSquareGeometry=function(y=E){const A=Array(12);for(var p=0;4>p;p++)for(let B=0;3>B;B++)A[3*p+B]=y[p][B];y=new Uint32Array([0,1,2,2,
3,0]);p=new Uint32Array([0,0,0,0,0,0]);return new f.Geometry([[e.VertexAttribute.POSITION,{size:3,data:A,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[e.VertexAttribute.UV0,{size:2,data:[0,0,1,0,1,1,0,1],exclusive:!0}],[e.VertexAttribute.COLOR,{size:4,data:[255,255,255,255],exclusive:!0}]],[[e.VertexAttribute.POSITION,y],[e.VertexAttribute.NORMAL,p],[e.VertexAttribute.UV0,y],[e.VertexAttribute.COLOR,p]])};r.createConeGeometry=function(y,A,p,B,D=!0,C=!0){var F=0,G=b.fromValues(0,
F,0),L=b.fromValues(0,F+y,0),H=b.fromValues(0,-1,0),M=b.fromValues(0,1,0);B&&(F=y,L=b.fromValues(0,0,0),G=b.fromValues(0,F,0),H=b.fromValues(0,1,0),M=b.fromValues(0,-1,0));G=[L,G];H=[H,M];M=p+2;L=Math.sqrt(y*y+A*A);if(B)for(B=p-1;0<=B;B--){var K=2*Math.PI/p*B,I=b.fromValues(Math.cos(K)*A,F,Math.sin(K)*A);G.push(I);K=b.fromValues(y*Math.cos(K)/L,-A/L,y*Math.sin(K)/L);H.push(K)}else for(B=0;B<p;B++)K=2*Math.PI/p*B,I=b.fromValues(Math.cos(K)*A,F,Math.sin(K)*A),G.push(I),K=b.fromValues(y*Math.cos(K)/
L,A/L,y*Math.sin(K)/L),H.push(K);y=new Uint32Array(6*(p+2));p=new Uint32Array(6*(p+2));F=A=0;if(D){for(D=3;D<G.length;D++)y[A++]=1,y[A++]=D-1,y[A++]=D,p[F++]=0,p[F++]=0,p[F++]=0;y[A++]=G.length-1;y[A++]=2;y[A++]=1;p[F++]=0;p[F++]=0;p[F++]=0}if(C){for(C=3;C<G.length;C++)y[A++]=C,y[A++]=C-1,y[A++]=0,p[F++]=C,p[F++]=C-1,p[F++]=1;y[A++]=0;y[A++]=2;y[A++]=G.length-1;p[F++]=1;p[F++]=2;p[F++]=H.length-1}C=new Float32Array(3*M);for(D=0;D<M;D++)C[3*D]=G[D][0],C[3*D+1]=G[D][1],C[3*D+2]=G[D][2];G=new Float32Array(3*
M);for(D=0;D<M;D++)G[3*D]=H[D][0],G[3*D+1]=H[D][1],G[3*D+2]=H[D][2];return new f.Geometry([[e.VertexAttribute.POSITION,{size:3,data:C,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:G,exclusive:!0}]],[[e.VertexAttribute.POSITION,y],[e.VertexAttribute.NORMAL,p]])};r.createCylinderGeometry=function(y,A,p,B,D,C){B=B?b.clone(B):b.fromValues(1,0,0);D=D?b.clone(D):b.fromValues(0,0,0);C=null==C?!0:C;var F=b.create();a.normalize(F,B);const G=b.create();a.scale(G,F,Math.abs(y));const L=b.create();a.scale(L,
G,-.5);a.add(L,L,D);const H=b.fromValues(0,1,0);.2>Math.abs(1-a.dot(F,H))&&a.set(H,0,0,1);const M=b.create();a.cross(M,F,H);a.normalize(M,M);a.cross(H,M,F);y=2*p+(C?2:0);D=p+(C?2:0);B=new Float32Array(3*y);const K=new Float32Array(3*D),I=new Float32Array(2*y),O=new Uint32Array(3*p*(C?4:2)),Q=new Uint32Array(3*p*(C?4:2));C&&(B[3*(y-2)]=L[0],B[3*(y-2)+1]=L[1],B[3*(y-2)+2]=L[2],I[2*(y-2)]=0,I[2*(y-2)+1]=0,B[3*(y-1)]=B[3*(y-2)]+G[0],B[3*(y-1)+1]=B[3*(y-2)+1]+G[1],B[3*(y-1)+2]=B[3*(y-2)+2]+G[2],I[2*(y-
1)]=1,I[2*(y-1)+1]=1,K[3*(D-2)]=-F[0],K[3*(D-2)+1]=-F[1],K[3*(D-2)+2]=-F[2],K[3*(D-1)]=F[0],K[3*(D-1)+1]=F[1],K[3*(D-1)+2]=F[2]);F=function(S,T,V){O[S]=T;Q[S]=V};let J=0;const P=b.create(),N=b.create();for(let S=0;S<p;S++){var R=2*Math.PI/p*S;a.scale(P,H,Math.sin(R));a.scale(N,M,Math.cos(R));a.add(P,P,N);K[3*S]=P[0];K[3*S+1]=P[1];K[3*S+2]=P[2];a.scale(P,P,A);a.add(P,P,L);B[3*S]=P[0];B[3*S+1]=P[1];B[3*S+2]=P[2];I[2*S]=S/p;I[2*S+1]=0;B[3*(S+p)]=B[3*S]+G[0];B[3*(S+p)+1]=B[3*S+1]+G[1];B[3*(S+p)+2]=B[3*
S+2]+G[2];I[2*(S+p)]=S/p;I[2*S+1]=1;R=(S+1)%p;F(J++,S,S);F(J++,S+p,S);F(J++,R,R);F(J++,R,R);F(J++,S+p,S);F(J++,R+p,R)}if(C){for(A=0;A<p;A++)C=(A+1)%p,F(J++,y-2,D-2),F(J++,A,D-2),F(J++,C,D-2);for(A=0;A<p;A++)C=(A+1)%p,F(J++,A+p,D-1),F(J++,y-1,D-1),F(J++,C+p,D-1)}return new f.Geometry([[e.VertexAttribute.POSITION,{size:3,data:B,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:K,exclusive:!0}],[e.VertexAttribute.UV0,{size:2,data:I,exclusive:!0}]],[[e.VertexAttribute.POSITION,O],[e.VertexAttribute.NORMAL,
Q],[e.VertexAttribute.UV0,O]])};r.createTubeGeometry=function(y,A,p,B,D){p=p||10;B=null!=B?B:!0;k.assert(1<y.length);const C=[],F=[];for(let G=0;G<p;G++){C.push([0,-G-1,-((G+1)%p)-1]);const L=G/p*2*Math.PI;F.push([Math.cos(L)*A,Math.sin(L)*A])}return r.createPathExtrusionGeometry(F,y,[[0,0,0]],C,B,D)};r.createPathExtrusionGeometry=function(y,A,p,B,D,C=b.fromValues(0,0,0)){var F=y.length;const G=new Float32Array(A.length*F*3+(6*p.length||0)),L=new Float32Array(A.length*F*3+(p?6:0));var H=(A.length-
1)*F*6+6*B.length;const M=new Uint32Array(H);H=new Uint32Array(H);let K=0;var I=0;let O=0,Q=0;const J=b.create(),P=b.create(),N=b.create(),R=b.create(),S=b.create(),T=b.create(),V=b.create(),W=c.create(),U=b.create(),aa=b.create(),da=b.create(),Y=b.create(),ea=b.create(),ja=g.create();a.set(U,0,1,0);a.subtract(P,A[1],A[0]);a.normalize(P,P);D?(a.add(W,A[0],C),a.normalize(N,W)):a.set(N,0,0,1);u(P,N,U,U,S,N,.99619469809);a.copy(R,N);a.copy(Y,S);for(var la=0;la<p.length;la++)a.scale(T,S,p[la][0]),a.scale(W,
N,p[la][2]),a.add(T,T,W),a.add(T,T,A[0]),G[K++]=T[0],G[K++]=T[1],G[K++]=T[2];L[I++]=-P[0];L[I++]=-P[1];L[I++]=-P[2];for(la=0;la<B.length;la++)M[O++]=0<B[la][0]?B[la][0]:-B[la][0]-1+p.length,M[O++]=0<B[la][1]?B[la][1]:-B[la][1]-1+p.length,M[O++]=0<B[la][2]?B[la][2]:-B[la][2]-1+p.length,H[Q++]=0,H[Q++]=0,H[Q++]=0;la=p.length;const ia=p.length-1;for(let fa=0;fa<A.length;fa++){let ba=!1;0<fa&&(a.copy(J,P),fa<A.length-1?(a.subtract(P,A[fa+1],A[fa]),a.normalize(P,P)):ba=!0,a.add(aa,J,P),a.normalize(aa,
aa),a.add(da,A[fa-1],R),g.fromPositionAndNormal(A[fa],aa,ja),g.intersectRay(ja,h.wrap(da,J),W)?(a.subtract(W,W,A[fa]),a.normalize(N,W),a.cross(S,aa,N),a.normalize(S,S)):u(aa,R,Y,U,S,N,.99619469809),a.copy(R,N),a.copy(Y,S));D&&(a.add(W,A[fa],C),a.normalize(ea,W));for(let Z=0;Z<F;Z++)if(a.scale(T,S,y[Z][0]),a.scale(W,N,y[Z][1]),a.add(T,T,W),a.normalize(V,T),L[I++]=V[0],L[I++]=V[1],L[I++]=V[2],a.add(T,T,A[fa]),G[K++]=T[0],G[K++]=T[1],G[K++]=T[2],!ba){var ca=(Z+1)%F;M[O++]=la+Z;M[O++]=la+F+Z;M[O++]=la+
ca;M[O++]=la+ca;M[O++]=la+F+Z;M[O++]=la+F+ca;for(ca=0;6>ca;ca++)H[Q++]=M[O-6+ca]-ia}la+=F}y=A[A.length-1];for(A=0;A<p.length;A++)a.scale(T,S,p[A][0]),a.scale(W,N,p[A][1]),a.add(T,T,W),a.add(T,T,y),G[K++]=T[0],G[K++]=T[1],G[K++]=T[2];p=I/3;L[I++]=P[0];L[I++]=P[1];L[I++]=P[2];F=la-F;for(I=0;I<B.length;I++)M[O++]=0<=B[I][0]?la+B[I][0]:-B[I][0]-1+F,M[O++]=0<=B[I][2]?la+B[I][2]:-B[I][2]-1+F,M[O++]=0<=B[I][1]?la+B[I][1]:-B[I][1]-1+F,H[Q++]=p,H[Q++]=p,H[Q++]=p;return new f.Geometry([[e.VertexAttribute.POSITION,
{size:3,data:G,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:L,exclusive:!0}]],[[e.VertexAttribute.POSITION,M],[e.VertexAttribute.NORMAL,H]])};r.createPolylineGeometry=function(y,A,p){k.assert(1<y.length,"createPolylineGeometry(): polyline needs at least 2 points");k.assert(3===y[0].length,"createPolylineGeometry(): malformed vertex");k.assert(null==A||A.length===y.length,"createPolylineGeometry: need same number of points and normals");k.assert(null==A||3===A[0].length,"createPolylineGeometry(): malformed normal");
var B=new Float64Array(3*y.length);const D=new Uint32Array(2*(y.length-1));var C=0,F=0;for(var G=0;G<y.length;G++){for(var L=0;3>L;L++)B[C++]=y[G][L];0<G&&(D[F++]=G-1,D[F++]=G)}C=[];F=[];C.push([e.VertexAttribute.POSITION,D]);F.push([e.VertexAttribute.POSITION,{size:3,data:B,exclusive:!0}]);if(A){B=new Float32Array(3*A.length);G=0;for(L=0;L<y.length;L++)for(let H=0;3>H;H++)B[G++]=A[L][H];C.push([e.VertexAttribute.NORMAL,D]);F.push([e.VertexAttribute.NORMAL,{size:3,data:B,exclusive:!0}])}p&&(F.push([e.VertexAttribute.COLOR,
{size:4,data:p}]),C.push([e.VertexAttribute.COLOR,l.generateDefaultIndexArray(p.length/4)]));return new f.Geometry(F,C,w.PrimitiveType.Line)};r.createExtrudedTriangle=function(y,A,p,B,D=0){const C=Array(18);y=[[-A,D,B/2],[p,D,B/2],[0,y+D,B/2],[-A,D,-B/2],[p,D,-B/2],[0,y+D,-B/2]];A=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(p=0;6>p;p++)C[3*p]=y[p][0],C[3*p+1]=y[p][1],C[3*p+2]=y[p][2];return new f.Geometry([[e.VertexAttribute.POSITION,{size:3,data:C,exclusive:!0}]],[[e.VertexAttribute.POSITION,
A]])};r.transformInPlace=function(y,A){y=y.getMutableAttribute(e.VertexAttribute.POSITION).data;for(let p=0;p<y.length;p+=3)a.set(t,y[p],y[p+1],y[p+2]),a.transformMat4(t,t,A),y[p]=t[0],y[p+1]=t[1],y[p+2]=t[2]};r.cgToGIS=function(y,A=y){var p=y.vertexAttributes;y=p.get(e.VertexAttribute.POSITION).data;if(p=p.get(e.VertexAttribute.NORMAL).data){var B=A.getMutableAttribute(e.VertexAttribute.NORMAL).data;for(var D=0;D<p.length;D+=3){const C=p[D+1];B[D+1]=-p[D+2];B[D+2]=C}}if(y)for(p=A.getMutableAttribute(e.VertexAttribute.POSITION).data,
B=0;B<y.length;B+=3)D=y[B+1],p[B+1]=-y[B+2],p[B+2]=D;return A};r.makeOrthoBasisDirUp=x;r.makeOrthoBasisDirUpFallback=u})(q||(q={}));const t=b.create();return q})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["exports"],function(a){a.Vec3Compact=void 0;(function(b){b.length=function(c,g){const h=c[g],w=c[g+1];c=c[g+2];return Math.sqrt(h*h+w*w+c*c)};b.normalize=function(c,g){var h=c[g];const w=c[g+1],n=c[g+2];h=1/Math.sqrt(h*h+w*w+n*n);c[g]*=h;c[g+1]*=h;c[g+2]*=h};b.scale=function(c,
g,h){c[g]*=h;c[g+1]*=h;c[g+2]*=h};b.add=function(c,g,h,w,n,f=g){n=n||c;n[f]=c[g]+h[w];n[f+1]=c[g+1]+h[w+1];n[f+2]=c[g+2]+h[w+2]};b.subtract=function(c,g,h,w,n,f=g){n=n||c;n[f]=c[g]-h[w];n[f+1]=c[g+1]-h[w+1];n[f+2]=c[g+2]-h[w+2]}})(a.Vec3Compact||(a.Vec3Compact={}));Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Geometry":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./basicInterfaces ./BoundingInfo ./ContentObject ./ContentObjectType ./geometryDataUtils ./Util ./VertexAttribute".split(" "),
function(a,b,c,g,h,w,n,f,l,k){function e(d){if(d.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return d;for(const m of d)if(65536<=m)return d;return new Uint16Array(d)}w=function(d){function m(v,q=[],t=g.PrimitiveType.Triangle,r=-1){var x=d.call(this)||this;x._primitiveType=t;x.edgeIndicesLength=r;x.type=n.ContentObjectType.Geometry;x._vertexAttributes=new Map;x._indices=new Map;x._boundingInfo=null;for(const [u,E]of v)E&&x._vertexAttributes.set(u,{...E});if(null==q||0===q.length){v=x._vertexAttributes.values().next().value;
v=null==v?0:v.data.length/v.size;q=f.generateDefaultIndexArray(v);x.edgeIndicesLength=0>x.edgeIndicesLength?v:x.edgeIndicesLength;for(const u of x._vertexAttributes.keys())x._indices.set(u,q)}else for(const [u,E]of q)E&&(x._indices.set(u,e(E)),u===k.VertexAttribute.POSITION&&(x.edgeIndicesLength=0>x.edgeIndicesLength?x._indices.get(u).length:x.edgeIndicesLength));return x}b._inheritsLoose(m,d);var z=m.prototype;z.cloneShallow=function(){const v=new m([],void 0,this._primitiveType,void 0),{_vertexAttributes:q,
_indices:t}=v;this._vertexAttributes.forEach((r,x)=>{q.set(x,r)});this._indices.forEach((r,x)=>{t.set(x,r)});v.screenToWorldRatio=this.screenToWorldRatio;v._boundingInfo=this._boundingInfo;return v};z.getMutableAttribute=function(v){(v=this._vertexAttributes.get(v))&&!v.exclusive&&(v.data=Array.from(v.data),v.exclusive=!0);return v};z.computeAttachmentOrigin=function(v){return this.primitiveType===g.PrimitiveType.Triangle?this._computeAttachmentOriginTriangles(v):this._computeAttachmentOriginPoints(v)};
z._computeAttachmentOriginTriangles=function(v){const q=this.indices.get(k.VertexAttribute.POSITION),t=this.vertexAttributes.get(k.VertexAttribute.POSITION);return f.computeAttachmentOriginTriangles(t,q,v)};z._computeAttachmentOriginPoints=function(v){const q=this.indices.get(k.VertexAttribute.POSITION),t=this.vertexAttributes.get(k.VertexAttribute.POSITION);return f.computeAttachmentOriginPoints(t,q,v)};z.invalidateBoundingInfo=function(){this._boundingInfo=null};z._calculateBoundingInfo=function(){const v=
this.indices.get(k.VertexAttribute.POSITION);if(0===v.length)return null;const q=this.primitiveType===g.PrimitiveType.Triangle?3:1;l.assert(0===v.length%q,"Indexing error: "+v.length+" not divisible by "+q);const t=f.generateDefaultIndexArray(v.length/q),r=this.vertexAttributes.get(k.VertexAttribute.POSITION);return new h.BoundingInfo(t,q,v,r)};b._createClass(m,[{key:"vertexAttributes",get:function(){return this._vertexAttributes}},{key:"indices",get:function(){return this._indices}},{key:"indexCount",
get:function(){const v=this._indices.values().next().value;return v?v.length:0}},{key:"primitiveType",get:function(){return this._primitiveType}},{key:"faceCount",get:function(){return this.indexCount/3}},{key:"boundingInfo",get:function(){c.isNone(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo());return this._boundingInfo}}]);return m}(w.ContentObject);a.Geometry=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define(["exports",
"../../../../core/PooledArray","../../../../chunks/vec3","../../../../chunks/vec3f64","./Util"],function(a,b,c,g,h){let w=function(){function f(k,e,d,m){this.primitiveIndices=k;this._numIndexPerPrimitive=e;this.indices=d;this.position=m;this.center=g.create();h.assert(1<=k.length);h.assert(0===d.length%this._numIndexPerPrimitive);h.assert(d.length>=k.length*this._numIndexPerPrimitive);h.assert(3===m.size||4===m.size);const {data:z,size:v}=m;m=k.length;e=v*d[this._numIndexPerPrimitive*k[0]];n.clear();
n.push(e);this.bbMin=g.fromValues(z[e],z[e+1],z[e+2]);this.bbMax=g.clone(this.bbMin);for(var q=0;q<m;++q){var t=this._numIndexPerPrimitive*k[q];for(var r=0;r<this._numIndexPerPrimitive;++r){e=v*d[t+r];n.push(e);let x=z[e];this.bbMin[0]=Math.min(x,this.bbMin[0]);this.bbMax[0]=Math.max(x,this.bbMax[0]);x=z[e+1];this.bbMin[1]=Math.min(x,this.bbMin[1]);this.bbMax[1]=Math.max(x,this.bbMax[1]);x=z[e+2];this.bbMin[2]=Math.min(x,this.bbMin[2]);this.bbMax[2]=Math.max(x,this.bbMax[2])}}c.lerp(this.center,this.bbMin,
this.bbMax,.5);this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);k=this.radius*this.radius;for(d=0;d<n.length;++d)e=n.getItemAt(d),m=z[e]-this.center[0],q=z[e+1]-this.center[1],e=z[e+2]-this.center[2],t=m*m+q*q+e*e,t<=k||(t=Math.sqrt(t),r=.5*(t-this.radius),this.radius+=r,k=this.radius*this.radius,t=r/t,this.center[0]+=m*t,this.center[1]+=q*t,this.center[2]+=e*t);n.clear()}var l=f.prototype;l.getCenter=function(){return this.center};
l.getBSRadius=function(){return this.radius};l.getBBMin=function(){return this.bbMin};l.getBBMax=function(){return this.bbMax};l.getChildren=function(){if(this._children)return this._children;if(1<c.squaredDistance(this.bbMin,this.bbMax)){var k=c.lerp(g.create(),this.bbMin,this.bbMax,.5),e=this.primitiveIndices.length;const v=new Uint8Array(e),q=Array(8);for(var d=0;8>d;++d)q[d]=0;const {data:t,size:r}=this.position;for(d=0;d<e;++d){var m=0;const x=this._numIndexPerPrimitive*this.primitiveIndices[d];
var z=r*this.indices[x];let u=t[z],E=t[z+1],y=t[z+2];for(let A=1;A<this._numIndexPerPrimitive;++A){z=r*this.indices[x+A];const p=t[z],B=t[z+1];z=t[z+2];p<u&&(u=p);B<E&&(E=B);z<y&&(y=z)}u<k[0]&&(m|=1);E<k[1]&&(m|=2);y<k[2]&&(m|=4);v[d]=m;++q[m]}k=0;for(d=0;8>d;++d)0<q[d]&&++k;if(2>k)return;k=Array(8);for(d=0;8>d;++d)k[d]=0<q[d]?new Uint32Array(q[d]):void 0;for(d=0;8>d;++d)q[d]=0;for(d=0;d<e;++d)m=v[d],k[m][q[m]++]=this.primitiveIndices[d];this._children=Array(8);for(e=0;8>e;++e)void 0!==k[e]&&(this._children[e]=
new f(k[e],this._numIndexPerPrimitive,this.indices,this.position))}return this._children};f.prune=function(){n.prune()};return f}();const n=new b({deallocator:null});a.BoundingInfo=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Util":function(){define(["exports","../../../../chunks/vec2","../../../../chunks/vec2f64","../../../../chunks/vec4","../../../../chunks/vec4f64"],function(a,b,c,g,h){function w(l,k){if(!l)throw k=k||"assert",console.log(Error(k).stack),
new f(k);}const n=h.create();let f=function(){function l(k){this.message=k}l.prototype.toString=function(){return`AssertException: ${this.message}`};return l}();a.assert=w;a.fovd2fovx=function(l,k,e){return 2*Math.atan(k*Math.tan(.5*l)/Math.sqrt(k*k+e*e))};a.fovd2fovy=function(l,k,e){return 2*Math.atan(e*Math.tan(.5*l)/Math.sqrt(k*k+e*e))};a.fovx2fovd=function(l,k,e){return 2*Math.atan(Math.sqrt(k*k+e*e)*Math.tan(.5*l)/k)};a.fovy2fovd=function(l,k,e){return 2*Math.atan(Math.sqrt(k*k+e*e)*Math.tan(.5*
l)/e)};a.inverseProjectionInfo=function(l,k,e,d,m){0===l[11]?(d[0]=2/(k*l[0]),d[1]=2/(e*l[5]),d[2]=(1+l[12])/l[0],d[3]=(1+l[13])/l[5],b.set(m,0,1)):(d[0]=-2/(k*l[0]),d[1]=-2/(e*l[5]),d[2]=(1-l[8])/l[0],d[3]=(1-l[9])/l[5],b.set(m,1,0))};a.isTranslationMatrix=function(l){return 1===l[0]&&0===l[1]&&0===l[2]&&0===l[3]&&0===l[4]&&1===l[5]&&0===l[6]&&0===l[7]&&0===l[8]&&0===l[9]&&1===l[10]&&0===l[11]&&1===l[15]};a.logWithBase=function(l,k){return Math.log(l)/Math.log(k)};a.project=function(l,k,e,d,m){m||
(m=l);n[0]=l[0];n[1]=l[1];n[2]=l[2];n[3]=1;g.transformMat4(n,n,k);2<m.length&&(m[2]=-n[2]);g.transformMat4(n,n,e);w(0!==n[3]);m[0]=n[0]/n[3];m[1]=n[1]/n[3];m[2]=n[2]/n[3];m[0]=(.5*m[0]+.5)*d[2]+d[0];m[1]=(.5*m[1]+.5)*d[3]+d[1]};a.rayBoxTest=function(l,k,e,d){let m,z=(e[0]-l[0])/k[0],v=(d[0]-l[0])/k[0];z>v&&(m=z,z=v,v=m);let q=(e[1]-l[1])/k[1],t=(d[1]-l[1])/k[1];q>t&&(m=q,q=t,t=m);if(z>t||q>v)return!1;q>z&&(z=q);t<v&&(v=t);e=(e[2]-l[2])/k[2];l=(d[2]-l[2])/k[2];e>l&&(m=e,e=l,l=m);if(z>l||e>v)return!1;
l<v&&(v=l);return 0>v?!1:!0};a.rayRay2D=function(l,k,e,d,m,z=c.create()){const v=(d[m]-e[m])*(k[0]-l[0])-(d[0]-e[0])*(k[m]-l[m]);if(0===v)return!1;e=((d[0]-e[0])*(l[m]-e[m])-(d[m]-e[m])*(l[0]-e[0]))/v;z[0]=l[0]+e*(k[0]-l[0]);z[1]=l[m]+e*(k[m]-l[m]);return!0};a.setMatrixTranslation3=function(l,k,e,d){l[12]=k;l[13]=e;l[14]=d};a.verify=function(l,k){l||console.warn("Verify failed: "+(k||"")+"\n"+Error("verify").stack)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ContentObject":function(){define(["exports",
"../../../../core/uid"],function(a,b){let c=function(){function g(){this.id=b.generateUID()}g.prototype.unload=function(){};return g}();a.ContentObject=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ContentObjectType":function(){define(["exports"],function(a){a.ContentObjectType=void 0;var b=a.ContentObjectType||(a.ContentObjectType={});b[b.Layer=0]="Layer";b[b.Object=1]="Object";b[b.Geometry=2]="Geometry";b[b.Material=3]="Material";b[b.Texture=4]="Texture";
b[b.COUNT=5]="COUNT";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["exports","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/support/triangle"],function(a,b,c,g){let h=(()=>{const d=new Uint32Array(131072);for(let m=0;m<d.length;++m)d[m]=m;return d})();const w=new Uint16Array([0]),n=(()=>{const d=new Uint16Array(65536);for(let m=0;m<d.length;++m)d[m]=m;return d})(),f=c.create(),l=c.create(),k=
c.create(),e=c.create();a.computeAttachmentOriginLines=function(d,m,z,v){if(!d)return!1;const {size:q,data:t}=d;b.set(v,0,0,0);b.set(e,0,0,0);let r=d=0;const x=m?m.length-1:t.length/q-1;z=x+(z?2:0);for(let y=0;y<z;y+=2){var u=y<x?y:x,E=y<x?y+1:0;u=(m?m[u]:u)*q;E=(m?m[E]:E)*q;f[0]=t[u+0];f[1]=t[u+1];f[2]=t[u+2];l[0]=t[E+0];l[1]=t[E+1];l[2]=t[E+2];b.scale(f,b.add(f,f,l),.5);E=b.dist(f,l);0<E?(b.add(v,v,b.scale(f,f,E)),d+=E):(b.add(e,e,f),r++)}return 0!==d?(b.scale(v,v,1/d),!0):0!==r?(b.scale(v,e,1/
r),!0):!1};a.computeAttachmentOriginPoints=function(d,m,z){if(!d||!m)return!1;const {size:v,data:q}=d;b.set(z,0,0,0);d=-1;let t=0;for(let r=0;r<m.length;r++){const x=m[r]*v;d!==x&&(z[0]+=q[x+0],z[1]+=q[x+1],z[2]+=q[x+2],t++);d=x}1<t&&b.scale(z,z,1/t);return 0<t};a.computeAttachmentOriginTriangles=function(d,m,z){if(!d)return!1;const {size:v,data:q}=d;b.set(z,0,0,0);b.set(e,0,0,0);let t=d=0;for(let x=0;x<m.length-2;x+=3){var r=m[x+0]*v;const u=m[x+1]*v,E=m[x+2]*v;b.set(f,q[r+0],q[r+1],q[r+2]);b.set(l,
q[u+0],q[u+1],q[u+2]);b.set(k,q[E+0],q[E+1],q[E+2]);(r=g.areaPoints3d(f,l,k))?(b.add(f,f,l),b.add(f,f,k),b.scale(f,f,1/3*r),b.add(z,z,f),d+=r):(b.add(e,e,f),b.add(e,e,l),b.add(e,e,k),t+=3)}return 0===t&&0===d?!1:0!==d?(b.scale(z,z,1/d),!0):0!==t?(b.scale(z,e,1/t),!0):!1};a.generateDefaultIndexArray=function(d){if(1===d)return w;if(d<n.length)return new Uint16Array(n.buffer,0,d);if(d>h.length){h=new Uint32Array(Math.max(2*h.length,d));for(let m=0;m<h.length;m++)h[m]=m}return new Uint32Array(h.buffer,
0,d)};a.generateIndexArray=function(d){if(1===d)return new Uint16Array(w);if(d<n.length)return new Uint16Array(n.slice(0,d));if(d>h.length){d=new Uint32Array(d);for(let m=0;m<d.length;m++)d[m]=m;return d}return new Uint32Array(h.slice(0,d))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/triangle":function(){define("exports ../../core/ObjectStack ../../chunks/vec2 ../../chunks/vec3 ../../chunks/vec3f64 ./lineSegment ./vectorStacks".split(" "),function(a,b,c,g,h,w,n){function f(v){return v?
{p0:h.clone(v.p0),p1:h.clone(v.p1),p2:h.clone(v.p2)}:{p0:h.create(),p1:h.create(),p2:h.create()}}function l(v,q,t,r=f()){g.copy(r.p0,v);g.copy(r.p1,q);g.copy(r.p2,t);return r}function k(v,q,t){var r=c.distance(v,q);q=c.distance(q,t);v=c.distance(t,v);t=(r+q+v)/2;r=t*(t-r)*(t-q)*(t-v);return 0>=r?0:Math.sqrt(r)}const e=new b.ObjectStack(w.create),d=new b.ObjectStack(()=>({p0:null,p1:null,p2:null})),m=h.create(),z=h.create();a.area2d=function(v){return k(v.p0,v.p1,v.p2)};a.areaPoints2d=k;a.areaPoints3d=
function(v,q,t){g.subtract(m,q,v);g.subtract(z,t,v);return g.length(g.cross(m,m,z))/2};a.copy=function(v,q=f()){return l(v.p0,v.p1,v.p2,q)};a.create=f;a.distance2=function(v,q){var t=v.p0,r=v.p1;v=v.p2;const x=g.subtract(n.sv3d.get(),r,t),u=g.subtract(n.sv3d.get(),v,r),E=g.subtract(n.sv3d.get(),t,v),y=g.subtract(n.sv3d.get(),q,t);var A=g.subtract(n.sv3d.get(),q,r),p=g.subtract(n.sv3d.get(),q,v);const B=g.cross(x,x,E),D=g.dot(g.cross(n.sv3d.get(),x,B),y);A=g.dot(g.cross(n.sv3d.get(),u,B),A);p=g.dot(g.cross(n.sv3d.get(),
E,B),p);if(0<D&&0<A&&0<p)return q=g.dot(B,y),q*q/g.dot(B,B);t=w.distance2(w.fromValues(t,x,e.get()),q);r=w.distance2(w.fromValues(r,u,e.get()),q);q=w.distance2(w.fromValues(v,E,e.get()),q);return Math.min(t,r,q)};a.fromValues=l;a.intersectRay=function(v,q,t){const {direction:r,origin:x}=q,{p0:u,p1:E,p2:y}=v;var A=E[0]-u[0],p=E[1]-u[1],B=E[2]-u[2];v=y[0]-u[0];q=y[1]-u[1];const D=y[2]-u[2];var C=r[1]*D-q*r[2],F=r[2]*v-D*r[0];const G=r[0]*q-v*r[1];var L=A*C+p*F+B*G;if(-1E-5<L&&1E-5>L)return!1;L=1/L;
const H=x[0]-u[0],M=x[1]-u[1],K=x[2]-u[2];C=L*(H*C+M*F+K*G);if(0>C||1<C)return!1;F=M*B-p*K;B=K*A-B*H;A=H*p-A*M;p=L*(r[0]*F+r[1]*B+r[2]*A);if(0>p||1<C+p)return!1;t&&(g.scale(t,r,L*(v*F+q*B+D*A)),g.add(t,x,t));return!0};a.wrap=function(v,q,t){const r=d.get();r.p0=v;r.p1=q;r.p2=t;return r};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/Precipitation":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../../chunks/Precipitation.glsl ./PrecipitationTechnique ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/core/shaderLibrary/util/View.glsl ../webgl-engine/lib/AnimationTimer ../webgl-engine/lib/VertexAttribute ../../support/WatchUpdatingTracking ../../webgl/BufferObject ../../webgl/enums ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C){a.Precipitation=function(L){function H(K){var I=L.call(this,K)||this;I._numParticles=25E4;I._rainSpeed=.1;I._snowSpeed=.01;I._opacity=1;I._width=500;I._offset=z.create();I._tile=z.create();I._particleColor=m.create();I._particleColorAtNight=m.create();I._nightMultiplier=.7;I._cameraDirection=m.create();I._renderParameters={camera:null,time:0,radius:1};I._animation=new E.AnimationTimer;I._updatingTracking=new A.WatchUpdatingTracking;I._renderParameters.time=
0;I._renderParameters.radius=v.getReferenceEllipsoid(K.view.spatialReference).radius;I._shaderTechniqueRepository=K.context.shaderTechniqueRepository;return I}b._inheritsLoose(H,L);var M=H.prototype;M.destroy=function(){this._updatingTracking.destroy();this._numParticles=0;this._snowTechnique=h.releaseMaybe(this._snowTechnique);this._rainTechnique=h.releaseMaybe(this._rainTechnique);this._vao=h.disposeMaybe(this._vao);this._instanceIdBuffer=h.disposeMaybe(this._instanceIdBuffer)};M.update=function(K){return this._animation.advance(K)};
M.render=function(K,I,O){const {rctx:Q,camera:J}=K;this._ensureResources(Q);var P=O===q.PrecipitationType.RAIN?this.rainTechnique:this.snowTechnique;h.isNone(P)||h.isNone(this._vao)||h.isNone(this._instanceIdBuffer)||(h.isSome(K.cloudsCompositionParams)&&(this._opacity=1-K.cloudsCompositionParams.fadeInOutHeight.factor),0>=this._opacity||(P=Q.useTechnique(P),this._renderParameters.camera=J,this._renderParameters.time=(O===q.PrecipitationType.RAIN?this._rainSpeed:this._snowSpeed)*w.secondsFromMilliseconds(this._animation.time),
this._update(P,J,O,K),Q.bindVAO(this._vao),K=t.PrecipitationTechnique.attributeLocation,P.assertCompatibleVertexAttributeLocations(this._vao),D.bindVertexBufferLayout(Q,K,this._instanceIdBuffer,G,0),Q.capabilities.instancing.drawArraysInstanced(B.PrimitiveType.TRIANGLES,0,3,this._numParticles*I),D.unbindVertexBufferLayout(Q,K,this._instanceIdBuffer,G)))};M._update=function(K,I,O,Q){const J=I.eye;this._tile[0]=Math.floor((J[0]+.5*this._width)/this._width);this._tile[1]=Math.floor((J[1]+.5*this._width)/
this._width);this._tile[2]=Math.floor((J[2]+.5*this._width)/this._width);this._offset[0]=J[0]-this._tile[0]*this._width;this._offset[1]=J[1]-this._tile[1]*this._width;this._offset[2]=J[2]-this._tile[2]*this._width;K.setUniform1f("width",this._width);K.setUniform3fv("offset",this._offset);K.setUniformMatrix4fv("view",I.viewMatrix);K.setUniform3fv("cameraPosition",J);u.bindProjectionMatrix(K,I.projectionMatrix);K.setUniform1f("time",this._renderParameters.time);O===q.PrecipitationType.RAIN?d.set(this._particleColor,
.85,.85,.85):d.set(this._particleColor,1,1,1);d.scale(this._particleColorAtNight,this._particleColor,this._nightMultiplier);d.normalize(this._cameraDirection,J);I=Math.max(0,d.dot(this._cameraDirection,Q.scenelightingData.lightingMainDirection));d.lerp(this._particleColor,this._particleColorAtNight,this._particleColor,I);K.setUniform3fv("particleColor",this._particleColor);K.setUniform1f("opacity",this._opacity)};M._ensureResources=function(K){h.isSome(this._vao)||(this._vao=this._createVertexArrayObject(K),
h.isSome(this._instanceIdBuffer)||(this._instanceIdBuffer=this._createInstanceIndices(K)))};M._createInstanceIndices=function(K){const I=[];for(let O=0;O<this._numParticles;O++)I.push(O);return p.BufferObject.createVertex(K,B.Usage.STATIC_DRAW,new Float32Array(I))};M._createVertexArrayObject=function(K){const I=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new C.VertexArrayObject(K,t.PrecipitationTechnique.attributeLocation,{geometry:r.glLayout(F)},{geometry:p.BufferObject.createVertex(K,B.Usage.STATIC_DRAW,
I)})};b._createClass(H,[{key:"updating",get:function(){return this._updatingTracking.updating}},{key:"rainTechnique",get:function(){if(h.isNone(this._rainTechnique)){const K=new t.PrecipitationTechniqueConfiguration;K.type=q.PrecipitationType.RAIN;this._rainTechnique=this._shaderTechniqueRepository.acquire(t.PrecipitationTechnique,K)}return this._rainTechnique}},{key:"snowTechnique",get:function(){if(h.isNone(this._snowTechnique)){const K=new t.PrecipitationTechniqueConfiguration;K.type=q.PrecipitationType.SNOW;
this._snowTechnique=this._shaderTechniqueRepository.acquire(t.PrecipitationTechnique,K)}return this._snowTechnique}}]);return H}(g);c.__decorate([n.property({constructOnly:!0})],a.Precipitation.prototype,"context",void 0);c.__decorate([n.property({constructOnly:!0})],a.Precipitation.prototype,"view",void 0);c.__decorate([n.property({readOnly:!0})],a.Precipitation.prototype,"updating",null);c.__decorate([n.property()],a.Precipitation.prototype,"_updatingTracking",void 0);a.Precipitation=c.__decorate([e.subclass("esri.views.3d.environment.Precipitation")],
a.Precipitation);const F=x.newLayout().vec3f(y.VertexAttribute.POSITION),G=r.glLayout(x.newLayout().f32(y.VertexAttribute.INSTANCEFEATUREATTRIBUTE),1);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/Precipitation.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/lib/VertexAttribute"],function(a,b,c,g){function h(n){const f=new c.ShaderBuilder;f.attributes.add(g.VertexAttribute.POSITION,
"vec3");f.attributes.add(g.VertexAttribute.INSTANCEFEATUREATTRIBUTE,"float");f.vertex.uniforms.add("cameraPosition","vec3").add("offset","vec3").add("width","float").add("proj","mat4").add("view","mat4").add("time","float");f.varyings.add("vUv","vec2");f.vertex.code.add(b.glsl`
    //https://www.shadertoy.com/view/4djSRW
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${n.type===a.PrecipitationType.RAIN?b.glsl`

            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:b.glsl`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `);f.fragment.uniforms.add("opacity","float").add("particleColor","vec3");f.fragment.code.add(b.glsl`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${n.type===a.PrecipitationType.RAIN?b.glsl`d = 0.5 * smoothstep(0.5, 0.0, d);`:b.glsl`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `);return f}a.PrecipitationType=void 0;(function(n){n[n.RAIN=0]="RAIN";n[n.SNOW=1]="SNOW"})(a.PrecipitationType||(a.PrecipitationType={}));const w=Object.freeze({__proto__:null,get PrecipitationType(){return a.PrecipitationType},build:h});a.PrecipitationShader=w;a.build=h})},"esri/views/3d/environment/PrecipitationTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/Precipitation.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/Program ../webgl-engine/lib/VertexAttribute ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){n=function(m){function z(){return m.apply(this,arguments)||this}c._inheritsLoose(z,m);var v=z.prototype;v.initializeProgram=function(q){const t=z.shader.get().build({type:this.configuration.type});return new l.Program(q.rctx,t,z.attributeLocation)};v.initializePipeline=function(){return d.makePipelineState({blending:d.separateBlendingParams(e.BlendFactor.ONE,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:e.CompareFunction.LEQUAL},
colorWrite:d.defaultColorWriteParams})};return z}(n.ShaderTechnique);n.shader=new w.ReloadableShaderModule(h.PrecipitationShader,()=>new Promise((m,z)=>a(["./Precipitation.glsl"],m,z)));n.attributeLocation=new Map([[k.VertexAttribute.POSITION,0],[k.VertexAttribute.INSTANCEFEATUREATTRIBUTE,1]]);w=function(m){function z(){var v=m.apply(this,arguments)||this;v.type=h.PrecipitationType.RAIN;return v}c._inheritsLoose(z,m);return z}(f.ShaderTechniqueConfiguration);g.__decorate([f.parameter()],w.prototype,
"type",void 0);b.PrecipitationTechnique=n;b.PrecipitationTechniqueConfiguration=w;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/AnimationTimer":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/time"],function(a,b,c,g){let h=function(){function w(){this.enabled=!0;this._time=0}w.prototype.advance=function(n){if(c.isSome(n.forcedTime)){if(this._time===n.forcedTime)return!1;this._time=n.forcedTime;
return!0}return this.enabled&&0!==n.dt?(this._time+=n.dt,!0):!1};b._createClass(w,[{key:"time",get:function(){return g.Milliseconds(this._time)}}]);return w}();a.AnimationTimer=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/SimpleAtmosphere":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/promiseUtils ../../../core/watchUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../../geometry/support/spatialReferenceUtils ../../../support/requestImageUtils ./atmosphereUtils ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechnique ./resources/MarsAtmosphereTexture ./resources/SimpleAtmosphereTexture ../support/mathUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Util ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H,M){function K(S,T,V,W,U){const aa=e.length(S),da=W*Math.sqrt(aa*aa-W*W)/aa,Y=U.silCircleV1,ea=U.silCircleV2;e.scale(U.silCircleCenter,S,Math.sqrt(W*W-da*da)/aa);e.cross(Y,S,T);1>e.squaredLength(Y)&&e.cross(Y,S,V);e.scale(Y,Y,da/e.length(Y));e.cross(ea,Y,S);e.scale(ea,ea,da/e.length(ea));return da}const I=b.getLogger("esri.views.3d.environment.SimpleAtmosphere"),O=-q.innerAtmosphereDepth,Q=E.makePiecewiseLinearFunction([[50,.1015625],
[500,.21875],[5E3,.51171875],[5E4,.4140625]]);b=function(){function S(V){this.view=V;this.type="simple";this._renderData={texV:k.create(),silCircleCenter:d.create(),silCircleV1:d.create(),silCircleV2:d.create(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0};this._texture=null;this._fadeVaoCount=0;this._readyResolver=h.createResolver();this._readyController=new AbortController;this.texV1=1;this.canRender=!0;this.isOnMars=z.isMars(V.spatialReference);V=m.getReferenceEllipsoid(V.spatialReference);
this.planetRadius=V.radius;this.outerRimWidth=V.outerAtmosphereRimWidth;this.innerRimFactor=(this.planetRadius+O)/this.planetRadius;this.middleRimFactor=(this.planetRadius+0)/this.planetRadius;this.outerRimFactor=(this.planetRadius+this.outerRimWidth)/this.planetRadius;this.texV0=0/this.outerRimWidth;this.texVScale=this.texV1-this.texV0}var T=S.prototype;T.destroy=function(){this._readyResolver.reject();this._cameraChangeHandle=g.removeMaybe(this._cameraChangeHandle);this._texture=g.disposeMaybe(this._texture);
this._fadeVao=g.disposeMaybe(this._fadeVao);this._vao=g.disposeMaybe(this._vao);this._readyController=g.abortMaybe(this._readyController)};T.when=function(){return this._readyResolver.promise};T.initializeRenderContext=function(){var V=a._asyncToGenerator(function*(W){this._shaderTechniqueRepository=W.shaderTechniqueRepository;const U=W.renderContext.rctx;this._cameraChangeHandle=w.init(this.view,"state.camera",()=>W.requestRender(),!0);this._vao=this._createRibbon(U);this._vaoCount=H.vertexCount(this._vao,
"geometry");this._fadeVao=B.createQuadVAO(U);this._fadeVaoCount=H.vertexCount(this._fadeVao,"geometry");const aa=this.isOnMars?x:u,da=this._readyController.signal;try{const Y=yield v.requestImage(aa,{signal:da});h.throwIfAborted(da);this._texture=new L.Texture(U,{pixelFormat:G.PixelFormat.RGBA,dataType:G.PixelType.UNSIGNED_BYTE,wrapMode:G.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:G.TextureSamplingMode.LINEAR,flipped:!0},Y);W.requestRender();this._readyController=null;this._readyResolver.resolve()}catch(Y){h.isAbortError(Y)||
I.error("Unable to initialize simple atmosphere: image request failed",Y),this._readyResolver.reject(Y)}});return function(W){return V.apply(this,arguments)}}();T.render=function(V){this._update(V.camera);const W=V.rctx;if(1>this._renderData.undergroundFadeAlpha){var U=W.useTechnique(this.coneTechnique);U.setUniformMatrix4fv("proj",V.camera.projectionMatrix);U.setUniformMatrix4fv("view",V.camera.viewMatrix);U.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter);U.setUniform3fv("silCircleV1",
this._renderData.silCircleV1);U.setUniform3fv("silCircleV2",this._renderData.silCircleV2);U.setUniform2fv("texV",this._renderData.texV);U.bindTexture(this._texture,"tex");V.scenelightingData.setLightDirectionUniform(U);U.setUniform1f("altitudeFade",this._renderData.altitudeFade);U.setUniform1f("innerScale",this._renderData.innerScale);W.bindVAO(this._vao);W.drawArrays(G.PrimitiveType.TRIANGLES,0,this._vaoCount)}0<this._renderData.undergroundFadeAlpha&&(U=W.useTechnique(this.undergroundTechnique),
U.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),V.scenelightingData.setLightDirectionUniform(U),U.setUniform3fv("cameraPosition",V.camera.eye),W.bindVAO(this._fadeVao),W.drawArrays(G.PrimitiveType.TRIANGLE_STRIP,0,this._fadeVaoCount))};T.renderHaze=function(){return!1};T._update=function(V){var W=d.create();const U=this.planetRadius;var aa=e.length(V.eye);const da=aa-U;this._renderData.undergroundFadeAlpha=0>da?Math.min(-da/5E3,1):0;var Y=U+O,ea=U+Math.max(50,da);this._renderData.innerScale=
ea*ea/(Math.sqrt(ea*ea-U*U)*Math.sqrt(ea*ea-Y*Y)+U*Y)-1;this._renderData.altitudeFade=q.computeInnerAltitudeFade(da);e.scale(W,V.eye,(U+50)/aa);K(W,V.center,V.up,U,this._renderData);W=this._computeScreenRimWidth(V,W,V.up,this._renderData);aa=Q(da);Y=this.texV0+.001953125*this.texVScale;ea=this.texV0+W*aa*this.texVScale;50<da&&(K(V.eye,V.center,V.up,U,this._renderData),V=this._computeScreenRimWidth(V,V.eye,V.up,this._renderData),V=c.clamp((V-1.5)/(W-1.5),0,1),Y=this.texV0+.001953125*V*this.texVScale,
ea=this.texV0+c.lerp(this.texV1,W*aa,V)*this.texVScale);l.set(this._renderData.texV,Y,ea)};T._createRibbon=function(V){const W=new Float32Array(1155),U=new Uint32Array(1920);W[0]=0;W[1]=0;W[2]=-1;for(var aa=0;128>aa;aa++){var da=9*aa+3;W[da+0]=aa;W[da+1]=this.innerRimFactor;W[da+2]=-1;W[da+3]=aa;W[da+4]=this.middleRimFactor;W[da+5]=0;W[da+6]=aa;W[da+7]=this.outerRimFactor;W[da+8]=1;da=3*aa+1;var Y=127===aa?1:da+3,ea=15*aa;U[ea+0]=da;U[ea+1]=da+1;U[ea+2]=Y+1;U[ea+3]=Y+1;U[ea+4]=Y;U[ea+5]=da;U[ea+6]=
da+1;U[ea+7]=da+2;U[ea+8]=Y+2;U[ea+9]=Y+2;U[ea+10]=Y+1;U[ea+11]=da+1;U[ea+12]=da;U[ea+13]=Y;U[ea+14]=0}aa=R.createBuffer(U.length);da=aa.position;for(Y=0;Y<U.length;++Y)ea=3*U[Y],da.set(Y,0,W[ea]),da.set(Y,1,W[ea+1]),da.set(Y,2,W[ea+2]);return new M.VertexArrayObject(V,p.Default3D,{geometry:y.glLayout(R)},{geometry:F.BufferObject.createVertex(V,G.Usage.STATIC_DRAW,aa.buffer)})};T._computeScreenRimWidth=function(V,W,U,aa){e.add(P,aa.silCircleCenter,aa.silCircleV2);e.scale(N,P,this.outerRimFactor);
n.lookAt(J,W,P,U);D.project(P,J,V.projectionMatrix,V.viewport);D.project(N,J,V.projectionMatrix,V.viewport);return e.distance(P,N)/V.height};a._createClass(S,[{key:"coneTechnique",get:function(){if(g.isNone(this._coneTechnique)){const V=new r.SimpleAtmosphereTechniqueConfiguration;V.geometry=t.SimpleAtmosphereGeometry.Cone;this._coneTechnique=this._shaderTechniqueRepository.acquire(r.SimpleAtmosphereTechnique,V)}return this._coneTechnique}},{key:"undergroundTechnique",get:function(){if(g.isNone(this._undergroundTechnique)){const V=
new r.SimpleAtmosphereTechniqueConfiguration;V.geometry=t.SimpleAtmosphereGeometry.Underground;this._undergroundTechnique=this._shaderTechniqueRepository.acquire(r.SimpleAtmosphereTechnique,V)}return this._undergroundTechnique}}]);return S}();const J=f.create(),P=d.create(),N=d.create(),R=A.newLayout().vec3f(C.VertexAttribute.POSITION);return b})},"esri/views/3d/environment/resources/MarsAtmosphereTexture":function(){define(function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAAE00TaTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAp1JREFUSMd9lcmSEzEQRCtflnqxYZgIThBDAP//kXDQ0pJtuDhqycxWZ5fKERFCERARIAVEyCjCtSFFEjWVa9q7OdJE0oiidIhKhRBROlhloiGVhaYERQHJWFEwMpYKrjUlibI2cqSJIJEpKNmM2c3GkRTOJDnThTMpnMWu0VFszs3Jfbe5bza3w+a229yOIs6zmP3czfn1K2w/for8+EVU15pNmmyqkeJyclinXNJRu1xrUaJmjmdzJiejVNt7zZVBRAIq1RwrsrrWnez+SR7WmQQP/1itKz2q/pmzuJtYnNy2bth9x9z2NLfDcB7FHOcGx6ebOb9/iPzxG/ztg4iorglFiKjzF9HSNphCoRb1OY3RZQJrYgRdT68bmgXGDdBzrTG8qNS7QP/m19ef7tGlcoH7vESYkK70uoPuOLEetz0IqeGoWQW6MlB/j36EnipYGKPWwDRg/RkNhXCNJIzAhMk6PrDePJNII6JHqM5VWqYApCtNFPe0GFFGtOWopWCrEVBSoiQi06KkRRaD08IlxXa/ifz8Jvz2LvjyLnh7F/r8Rei8a8xfjNkIrpmMOQ1C02COrkTEHxGhh+6DQJfXc/eZprXxcIyVIf1LJVgWvKaHvwI/1aQxtv851SQ/nqGXL6MHFVY3nmhLyqKsWO/+qzWif+yS1TpNKq8NezjGPCV69ciZoQj1PwfN6QRpWyCGVMe1D/AAHt3/gefu1Ign3AVpjOiNXkN90JlpL6TUnzFEUU+Jvks0tkp/dY3Fy1TzI24BWwsYJPyg11Q0FqDwK72xIz2kLojbeuxS1FpgtfNWyMX1gFw0j3W7RNeSHTVEe3VaV7SdCzVywFaEt02w7QH7Eeg4AvZDNdJ+Cu1HENsutO+Byi6ilEBZ9BeCNBJceJIjHgAAAABJRU5ErkJggg\x3d\x3d"})},
"esri/views/3d/environment/Stars":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../assets ../../../core/Accessor ../../../core/Error ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ./StarsTechnique ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/VertexAttribute ../../support/WatchUpdatingTracking ../../webgl/BufferObject ../../webgl/enums ../../webgl/VertexArrayObject".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D){const C=n.getLogger("esri.views.3d.environment.Stars");a.Stars=function(K){function I(Q){Q=K.call(this,Q)||this;Q._loadDataTask=null;Q._numPoints=0;Q._renderParameter={camera:null,modelMatrix:t.create()};Q._updatingTracking=new A.WatchUpdatingTracking;return Q}b._inheritsLoose(I,K);var O=I.prototype;O.initialize=function(){this._loadDataTask=this._createLoadDataTask()};O.destroy=function(){this._loadDataTask=f.abortMaybe(this._loadDataTask);
this._updatingTracking.destroy();this._numPoints=0;this._technique=f.releaseMaybe(this._technique);this._vao=f.disposeMaybe(this._vao)};O.render=function(Q){const {rctx:J,camera:P}=Q;this._ensureResources(J);f.isNone(this._technique)||f.isNone(this._vao)||(Q=J.useTechnique(this._technique),this._renderParameter.camera=P,this._technique.bindPass(this._renderParameter),J.bindVAO(this._vao),Q.assertCompatibleVertexAttributeLocations(this._vao),J.drawArrays(B.PrimitiveType.POINTS,0,this._numPoints))};
O._ensureResources=function(Q){if(!f.isSome(this._technique)&&!f.isNone(M)){this._technique=new r.StarsTechnique({rctx:Q,viewingMode:this.view.state.viewingMode});this._numPoints=M.byteLength/9;var J=new Float32Array(M,0,2*this._numPoints),P=new Uint8Array(M,8*this._numPoints,this._numPoints);this._vao=this._createVertexArrayObject(Q,J,P,this._numPoints);this._updatingTracking.add(()=>{var N;return null==(N=this.view)?void 0:N.environment.lighting.date},N=>this._update(N),k.initial)}};O._computeDayDuration=
function(Q){const J=new Date(Q.getFullYear(),0,1,11,58,56),P=new Date(Q.getFullYear()+1,0,1,11,58,55);return(+Q-+J)/(+P-+J)};O._update=function(Q){if(Q){var J=Q.getHours()/12,P=Q.getMinutes()/60*(2/24),N=Q.getSeconds()/60*(2/1440);J=(J+P+N-.9972222)%2;Q=2*this._computeDayDuration(Q);P=this._renderParameter.modelMatrix;q.copy(P,L);q.rotateZ(P,P,-Q*Math.PI);q.multiply(P,G,P);q.rotateZ(P,P,-J*Math.PI);this.requestRender()}};O._hexToRGB=function(Q){return[parseInt(Q.substring(0,2),16),parseInt(Q.substring(2,
4),16),parseInt(Q.substring(4,6),16)]};O._unpackUint8Attributes=function(Q){return 192<=Q?[2.9,Q-192]:160<=Q?[2.5,Q-160]:128<=Q?[2,Q-128]:96<=Q?[1.5,Q-96]:64<=Q?[1,Q-64]:32<=Q?[.7,Q-32]:[.4,Q]};O._createVertexArrayObject=function(Q,J,P,N){const R=H.createBuffer(N),S=R.position,T=R.color,V=R.size;for(let aa=0;aa<N;aa++){var W=J[2*aa],U=J[2*aa+1];S.set(aa,0,-Math.cos(W)*Math.sin(U));S.set(aa,1,-Math.sin(W)*Math.sin(U));S.set(aa,2,-Math.cos(U));W=this._unpackUint8Attributes(P[aa]);U=this._hexToRGB(F[W[1]]);
T.set(aa,0,255*U[0]);T.set(aa,1,255*U[1]);T.set(aa,2,255*U[2]);T.set(aa,3,255);V.set(aa,W[0])}return new D.VertexArrayObject(Q,E.Default3D,{geometry:x.glLayout(H)},{geometry:p.BufferObject.createVertex(Q,B.Usage.STATIC_DRAW,R.buffer)})};O._createLoadDataTask=function(){var Q=this;if(f.isSome(M))return null;const J=l.createTask(function(){var P=b._asyncToGenerator(function*(N){({data:N}=yield g.fetchAsset("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:N}));Q._verifyStarData(N);
M=N});return function(N){return P.apply(this,arguments)}}());J.promise.catch(P=>{l.isAbortError(P)||C.error(P)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))});return J};O._verifyStarData=function(Q){if(!Q)throw new w("stars:no-data-received","Failed to create stars because star catalogue is missing");Q=Q.byteLength/9;if(0!==Q%1||5E4<Q||5E3>Q)throw new w("stars:invalid-data","Failed to create stars because star catalogue data is invalid");};b._createClass(I,[{key:"updating",
get:function(){return this._updatingTracking.updating||this.loading}},{key:"loading",get:function(){return f.isSome(this._loadDataTask)&&!this._loadDataTask.finished}}]);return I}(h);c.__decorate([e.property({constructOnly:!0})],a.Stars.prototype,"view",void 0);c.__decorate([e.property({constructOnly:!0})],a.Stars.prototype,"requestRender",void 0);c.__decorate([e.property({readOnly:!0})],a.Stars.prototype,"updating",null);c.__decorate([e.property()],a.Stars.prototype,"_loadDataTask",void 0);c.__decorate([e.property()],
a.Stars.prototype,"_updatingTracking",void 0);a.Stars=c.__decorate([v.subclass("esri.views.3d.environment.Stars")],a.Stars);const F="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),G=t.fromValues(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),L=t.fromValues(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,
0,.39778850739794974,.9174771405229186,0,0,0,0,1),H=u.newLayout().vec3f(y.VertexAttribute.POSITION).vec4u8(y.VertexAttribute.COLOR).f32(y.VertexAttribute.SIZE);let M=null;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/environment/StarsTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/Stars.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){f=function(z){function v(t){var r;return r=z.call(this,t,null,()=>r.destroy())||this}c._inheritsLoose(v,z);var q=v.prototype;q.initializeProgram=function(t){const r=v.shader.get().build();return new k.Program(t.rctx,r,l.Default3D)};q.initializePipeline=function(){return d.makePipelineState({blending:d.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:e.CompareFunction.LEQUAL},
colorWrite:d.defaultColorWriteParams})};q.bindPass=function(t){const r=this._makeInfiniteProjectionMatrix(t.camera.projectionMatrix,t.camera.near,m);g.multiply(r,r,t.camera.viewMatrix);g.multiply(r,r,t.modelMatrix);this.program.setUniformMatrix4fv("transform",r);this.program.setUniform4fv("viewport",t.camera.fullViewport);this.program.setUniform1f("pixelRatio",t.camera.pixelRatio)};q._makeInfiniteProjectionMatrix=function(t,r,x){g.copy(x,t);x[10]=2.4E-7-1;x[11]=-1;x[14]=(2.4E-7-2)*r;return x};return v}(f.ShaderTechnique);
f.shader=new n.ReloadableShaderModule(w.StarsShader,()=>new Promise((z,v)=>a(["./Stars.glsl"],z,v)));const m=h.create();b.StarsTechnique=f;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/Stars.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/lib/VertexAttribute"],function(a,b,c,g,h){function w(){const f=
new g.ShaderBuilder;f.attributes.add(h.VertexAttribute.POSITION,"vec3");f.attributes.add(h.VertexAttribute.COLOR,"vec4");f.attributes.add(h.VertexAttribute.SIZE,"float");f.varyings.add("vcolor","vec4");f.varyings.add("vsize","float");f.vertex.uniforms.add("transform","mat4").add("viewport","vec4").add("pixelRatio","float");f.include(b.AlignPixel);f.vertex.code.add(c.glsl`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`);f.fragment.code.add(c.glsl`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`);return f}const n=Object.freeze({__proto__:null,build:w});a.StarsShader=n;a.build=w})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.AlignPixel=function(c){const g=b.glsl`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,h=b.glsl`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;c.vertex.code.add(g);c.vertex.code.add(h);c.fragment.code.add(g);c.fragment.code.add(h)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/earthUtils":function(){define(["exports","../../../core/mathUtils","../../../geometry/Point","../../../geometry/projectionEllipsoid"],function(a,b,c,g){function h(f,l,k){return w(f,l.longitude,l.latitude,k.longitude,k.latitude)}function w(f,l,k,e,d){k=b.deg2rad(k);d=b.deg2rad(d);l=b.deg2rad(l);const m=b.deg2rad(e);e=Math.sin((k-d)/2);
l=Math.sin((l-m)/2);k=2*b.asinClamped(Math.sqrt(e*e+Math.cos(k)*Math.cos(d)*l*l));return Math.round(k*f*1E4)/1E4}function n(f,l){f/=15;l||(f=Math.round(f));return f}a.getGreatCircleDistance=w;a.getGreatCircleDistanceFromPoints=h;a.getGreatCircleSpanAt=function(f,l,k){const e=l.spatialReference,d=g.getReferenceEllipsoid(e),m=new c(l.x,f.y,e),z=new c(k.x,f.y,e);l=new c(f.x,l.y,e);f=new c(f.x,k.y,e);return{lon:h(d.radius,m,z),lat:h(d.radius,l,f)}};a.getLatDeltaForDistance=function(f,l){return b.rad2deg(f/
l)};a.getLonDeltaForDistance=function(f,l,k){l/=k;f=b.deg2rad(f);l=Math.sin(l/2);f=Math.cos(f);f=2*b.asinClamped(Math.sqrt(l*l/(f*f)));return b.rad2deg(f)};a.getMaxCameraAltitude=function(f,l){f=b.deg2rad(f/2);return(1-Math.sin(f))*l/Math.sin(f)};a.longitudeToTimezone=n;a.pointToTimezone=function(f,l){return n(f.longitude,l)};a.positionToTimezoneInfo=function(f,l){l||(l={hours:0,minutes:0,seconds:0});l.hours=n(f[0],!0);f=l.hours%1;l.hours-=f;l.minutes=60*f;f=l.minutes%1;l.minutes-=f;l.seconds=Math.round(60*
f);return l};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/sunUtils":function(){define("exports ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../ViewingMode ../../../chunks/SunCalc".split(" "),function(a,b,c,g,h,w,n,f){function l(u,E,y,A){const p=q,B=c.identity(v);if(y===n.ViewingMode.Global)f.SunCalc.getPosition(u,0,0,p),h.set(A,0,0,-1),c.rotateX(B,B,-p.azimuth),c.rotateY(B,B,-p.altitude);else{var D=
m.planarDirection;y=D.globalAngles;D=(Math.abs(E[2])-D.localAltitude)/(D.globalAltitude-D.localAltitude);D=b.clamp(D,0,1);1>D?(f.SunCalc.getPosition(u,E[1],E[0],p),p.azimuth=(1-D)*p.azimuth+D*y.azimuth,p.altitude=(1-D)*p.altitude+D*y.altitude):(p.azimuth=y.azimuth,p.altitude=y.altitude);h.set(A,0,-1,0);c.rotateZ(B,B,-p.azimuth);c.rotateX(B,B,-p.altitude)}h.transformMat4(A,A,B)}function k(u){switch(u){case "disabled":case "sunny":return{direct:1,ambient:1};case "cloudy":return{direct:1,ambient:1};
case "rainy":return{direct:.4,ambient:1.2};case "snowy":return{direct:.5,ambient:1.3};case "foggy":return{direct:.2,ambient:1.6}}}function e(u,E){const y=(u[0]+u[1]+u[2])/3;for(let A=0;3>A;A++)u[A]+=(y-u[A])*E;return u}function d(u,E,y,A){const p=[];for(let B=0;B<y.length;B++)p[B]=(A[B]-y[B])*u/E+y[B];return p}const m={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8E5,ambient:.015,direct:.75},planarDirection:{localAltitude:1E4,
globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}},z=w.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258),v=g.create(),q={azimuth:0,altitude:0},t=new Date(0),r=g.create(),x=w.create();a.ColorAndIntensity=function(){this.ambient={color:w.fromValues(1,1,1),intensity:.55};this.direct={color:w.fromValues(1,1,1),intensity:.55,directionToLightSource:w.clone(z)};this.noonFactor=.5;this.globalFactor=0;this.environmentStrength=this.specularStrength=1};a.computeColorAndIntensity=
function(u,E,y,A,p,B,D){h.set(D.ambient.color,1,1,1);D.ambient.intensity=m.global.ambient;h.set(D.direct.color,1,1,1);D.direct.intensity=m.global.direct;var C=b.clamp((Math.abs(E[2])-m.local.altitude)/(m.global.altitude-m.local.altitude),0,1);D.globalFactor=C;var F;"sun"===B&&(F=f.SunCalc.getTimes(u,E[1],E[0]));if(1>C){if("sun"===B){{var G=F;var L=u.valueOf();if(G.polarException===f.SunCalc.PolarException.MIDNIGHT_SUN){var H=L-36E5*(u.getHours()+48)-6E4*u.getMinutes();var M=H+432E6}else G.polarException===
f.SunCalc.PolarException.POLAR_NIGHT?(H=L-2,M=L-1):(H=G.sunrise.valueOf(),M=G.sunset.valueOf());var K=M-H;G=H+K/2;var I=K/4;var O=G-I;I=G+I;var Q=.06*K;K=H-Q/2;H+=Q/2;const P=M-Q/2,N=M+Q/2;M=m.local;Q=[.01,M.ambientAtNight];const R=[.8,.8,1],S=[.01,.01,.01],T=[M.directAtTwilight,M.ambientAtTwilight],V=[1,.6,.5],W=[.8,.8,1],U=[.9*M.directAtNoon,M.ambientAtNoon],aa=[1,.98,.98],da=[.98,.98,1],Y=[M.directAtNoon,M.ambientAtNoon],ea=[1,1,1],ja=[1,1,1];M=[0,0];let la=[0,0,0];var J=[0,0,0];L<K||L>N?(M=Q,
la=S,J=R):L<H?(J=H-K,M=d(L-K,J,Q,T),la=d(L-K,J,S,V),J=d(L-K,J,R,W)):L<O?(J=O-H,M=d(L-H,J,T,U),la=d(L-H,J,V,aa),J=d(L-H,J,W,da)):L<G?(J=G-O,M=d(L-O,J,U,Y),la=d(L-O,J,aa,ea),J=d(L-O,J,da,ja)):L<I?(J=I-G,M=d(L-G,J,Y,U),la=d(L-G,J,ea,aa),J=d(L-G,J,ja,da)):L<P?(J=P-I,M=d(L-I,J,U,T),la=d(L-I,J,aa,V),J=d(L-I,J,da,W)):L<N&&(J=N-P,M=d(L-P,J,T,Q),la=d(L-P,J,V,S),J=d(L-P,J,W,R));L=0;switch(A){case "rainy":case "foggy":L=.9;case "snowy":L=.5}0<L&&(la=e(la,L),J=e(J,L));G=w.fromValues(la[0],la[1],la[2]);O=w.fromValues(J[0],
J[1],J[2]);I=k(A);L=M[0]*I.direct;M=M[1]*I.ambient}}else O=k(A),L=m.local.directAtNoon*O.direct,G=w.fromValues(1,1,1),M=m.local.ambientAtNoon*O.ambient,O=w.fromValues(1,1,1);h.lerp(D.ambient.color,O,D.ambient.color,C);D.ambient.intensity=b.lerp(M,D.ambient.intensity,C);h.lerp(D.direct.color,G,D.direct.color,C);D.direct.intensity=b.lerp(L,D.direct.intensity,C);D.specularStrength="rainy"===A||"snowy"===A||"foggy"===A?0:1;D.environmentStrength="rainy"===A?.7:"snowy"===A||"foggy"===A?.75:1}"sun"===B?
(A=u.valueOf(),F.polarException===f.SunCalc.PolarException.MIDNIGHT_SUN?(C=A-36E5*(u.getHours()+48)-6E4*u.getMinutes(),F=C+432E6):F.polarException===f.SunCalc.PolarException.POLAR_NIGHT?(C=A-2,F=A-1):(C=F.sunrise.valueOf(),F=F.sunset.valueOf()),A=1-b.clamp(Math.abs(A-(C+(F-C)/2))/432E5,0,1)):A=1;D.noonFactor=A;"sun"===B?l(u,E,y,D.direct.directionToLightSource):(u=D.direct.directionToLightSource,y===n.ViewingMode.Global?h.normalize(x,p.eye):h.set(x,0,0,1),c.fromRotation(r,.35,p.viewRight),h.transformMat4(u,
x,r),c.fromRotation(r,-.5,x),h.transformMat4(u,u,r))};a.computeDirectionsOverTime=function(u,E,y,A,p){u=u.getTime();E=E.getTime()-u;E=Math.floor(E/y)+1;const B=Array(E);for(let D=0;D<E;++D)t.setTime(u+y*D),B[D]=w.create(),l(t,A,p,B[D]);return B};a.computeShadowsEnabled=function(u,E){return E===n.ViewingMode.Global?!0:Math.abs(u)<m.planarDirection.localAltitude};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/SunCalc":function(){define(["exports"],function(a){var b={exports:{}};(function(c){(function(g){g=
g();void 0!==g&&(c.exports=g)})(function(){function g(B){return new Date(864E5*(B+.5-2440588))}function h(B,D){return r(z(B)*v(y)-q(D)*z(y),v(B))}function w(B,D){return t(z(D)*v(y)+v(D)*z(y)*z(B))}function n(B,D,C){return r(z(B),v(B)*z(D)-q(C)*v(D))}function f(B,D,C){return t(z(D)*z(C)+v(D)*v(C)*v(B))}function l(B){return u*(1.9148*z(B)+.02*z(2*B)+3E-4*z(3*B))}function k(B,D){B=u*(357.5291+.98560028*B);var C=l(B);B=B+C+102.9372*u+m;D||(D={dec:0,ra:0});D.dec=w(B,0);D.ra=h(B,0);return D}function e(B,
D,C){return 2451545+B+.0053*z(D)-.0069*z(2*C)}function d(B){var D=u*(134.963+13.064993*B),C=u*(93.272+13.22935*B);B=u*(218.316+13.176396*B)+6.289*u*z(D);C=5.128*u*z(C);D=385001-20905*v(D);return{ra:h(B,C),dec:w(B,C),dist:D}}var m=Math.PI,z=Math.sin,v=Math.cos,q=Math.tan,t=Math.asin,r=Math.atan2,x=Math.acos,u=m/180,E={dec:0,ra:0},y=23.4397*u,A={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(B,D,C,F){C=u*-C;D*=u;var G=B.valueOf()/864E5-.5+2440588-2451545;B=k(G,E);C=u*(280.16+
360.9856235*G)-C-B.ra;F||(F={azimuth:0,altitude:0});F.azimuth=n(C,D,B.dec);F.altitude=f(C,D,B.dec);return F}},p=[[-.83,"sunrise","sunset"]];A.addTime=function(B,D,C){p.push([B,D,C])};A.getTimes=function(B,D,C){function F(N){var R=L,S=I;N=x((z(N)-z(R)*z(S))/(v(R)*v(S)));return e(9E-4+(N+G)/(2*m)+H,M,K)}var G=u*-C,L=u*D,H=Math.round(B.valueOf()/864E5-.5+2440588-2451545-9E-4-G/(2*m));B=9E-4+(0+G)/(2*m)+H;var M=u*(357.5291+.98560028*B);D=l(M);var K=M+D+102.9372*u+m,I=w(K,0);B=e(B,M,K);D={solarNoon:g(B),
nadir:g(B-.5),polarException:A.PolarException.NORMAL};var O;C=0;for(O=p.length;C<O;C+=1){var Q=p[C];var J=F(Q[0]*u);var P=B-(J-B);D[Q[1]]=g(P);D[Q[2]]=g(J)}D.polarException=function(N){N=(z(N)-z(L)*z(I))/(v(L)*v(I));return-1>N?A.PolarException.MIDNIGHT_SUN:1<N?A.PolarException.POLAR_NIGHT:A.PolarException.NORMAL}(p[0][0]*u);return D};A.getMoonPosition=function(B,D,C){C=u*-C;D*=u;var F=B.valueOf()/864E5-.5+2440588-2451545;B=d(F);C=u*(280.16+360.9856235*F)-C-B.ra;F=f(C,D,B.dec);F+=.017*u/q(F+10.26*
u/(F+5.1*u));return{azimuth:n(C,D,B.dec),altitude:F,distance:B.dist}};A.getMoonFraction=function(B){var D=B.valueOf()/864E5-.5+2440588-2451545;B=k(D);D=d(D);B=x(z(B.dec)*z(D.dec)+v(B.dec)*v(D.dec)*v(B.ra-D.ra));B=r(149598E3*z(B),D.dist-149598E3*v(B));return(1+v(B))/2};return A})})(b);a.SunCalc=b.exports})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["exports","../../../../chunks/vec3f64"],function(a,b){a.AmbientLight=function(c=b.create()){this.intensity=c};a.FillLight=function(c=
b.create(),g=b.fromValues(.57735,.57735,.57735)){this.intensity=c;this.direction=g};a.MainLight=function(c=b.create(),g=b.fromValues(.57735,.57735,.57735),h=!0,w=1,n=1){this.intensity=c;this.direction=g;this.castShadows=h;this.specularStrength=w;this.environmentStrength=n};a.SphericalHarmonicsAmbientLight=function(){this.r=[0];this.g=[0];this.b=[0]};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/SceneInputManager":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/GamepadNavigation ./handlers/KeyboardNavigation ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/BrowserEventSource ../../input/InputManager ../../input/handlers/PreventContextMenu ../../input/recognizers/Drag ../../input/recognizers/ImmediateDoubleClick ../../input/recognizers/PointerClickHoldAndDrag ../../input/recognizers/SingleAndDoubleClick ../../input/recognizers/VerticalTwoFingerDrag ../state/controllers/RotateController".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L){c=function(M){function K(){var O=M.apply(this,arguments)||this;O._handles=new g;return O}a._inheritsLoose(K,M);var I=K.prototype;I.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null);this.disconnect()};I.disconnect=function(){this.view.viewEvents.disconnect();this._inputManager&&(this._inputManager.destroy(),this._inputManager=null);this._source&&(this._source.destroy(),this._source=null)};I.connect=
function(){const O=this.view;this._source=new y.BrowserEventSource(this.view.surface,O.input);var Q=[new D.ImmediateDoubleClick,new C.PointerClickHoldAndDrag,new F.SingleAndDoubleClick,new B.Drag(this.view.navigation),new G.VerticalTwoFingerDrag];this._inputManager=Q=new A.InputManager({eventSource:this._source,recognizers:Q});Q.installHandlers("prevent-context-menu",[new p.PreventContextMenu],A.ViewEventPriorities.INTERNAL);this._modeDragPan=new t.PinchAndPanNavigation(O,"primary");this._modeDragRotate=
new d.DragRotate(O,"secondary",L.PivotPoint.CENTER);this._modeDragZoom=new m.DragZoom(O,"tertiary");Q.installHandlers("navigation",[new r.PointerDownCancelAnimation(O),new e.DoubleClickZoom(O),new z.GamepadNavigation(O),new v.KeyboardNavigation(O,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"}),new q.MouseWheelZoom(O),new u.SingleKeyResetTilt(O,"p"),new x.SingleKeyResetHeading(O,
"n"),new d.DragRotate(O,"primary",L.PivotPoint.EYE,["b"]),new d.DragRotate(O,"secondary",L.PivotPoint.CENTER,["b"]),new t.PinchAndPanNavigation(O,"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new E.TwoFingerTilt(O)],A.ViewEventPriorities.INTERNAL);this.view.viewEvents.connect(Q);this._updateMode();h.init(this.view.navigation,"browserTouchPanEnabled",J=>{this._source.browserTouchPanningEnabled=!J})};I._updateMode=function(){var O=this.primaryDragAction;O=H.get(this.mode).get(O);
this._modeDragPan&&(this._modeDragPan.pointerAction=O.pan);this._modeDragRotate&&(this._modeDragRotate.pointerAction=O.rotate);this._modeDragZoom&&(this._modeDragZoom.pointerAction=O.zoom)};a._createClass(K,[{key:"primaryDragAction",get:function(){return this._get("primaryDragAction")},set:function(O){"pan"!==O&&"rotate"!==O||O===this._get("primaryDragAction")||(this._set("primaryDragAction",O),this._updateMode())}},{key:"mode",get:function(){return this._get("mode")},set:function(O){"default"!==
O&&"pro"!==O||O===this._get("mode")||(this._set("mode",O),this._updateMode())}},{key:"test",get:function(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}}]);return K}(c);b.__decorate([w.property()],c.prototype,"view",void 0);b.__decorate([w.property({value:"pan"})],c.prototype,"primaryDragAction",null);b.__decorate([w.property({value:"default"})],c.prototype,"mode",null);b.__decorate([w.property({readOnly:!0,
aliasOf:"_inputManager.hasPendingInputs"})],c.prototype,"hasPendingInputs",void 0);b.__decorate([w.property({readOnly:!0,aliasOf:"_inputManager.latestPointerType"})],c.prototype,"latestPointerType",void 0);b.__decorate([w.property()],c.prototype,"_inputManager",void 0);c=b.__decorate([k.subclass("esri.views.3d.input.SceneInputManager")],c);const H=new Map;b=new Map;w=new Map;b.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});b.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});
w.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"});w.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});H.set("default",b);H.set("pro",w);return c})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(a,
b,c,g,h,w,n){w=function(f){function l(k,e){var d=f.call(this,!0)||this;d.view=k;d.registerIncoming("double-click",e,m=>d._handleDoubleClick(m));return d}b._inheritsLoose(l,f);l.prototype._handleDoubleClick=function(k){const e=k.data;if(n.eventMatchesPointerAction(e,"primary")){const d=this.view.state.isGlobal?new g.ZoomStepController({view:this.view,mode:"animation"}):new h.ZoomStepController({view:this.view,mode:"animation"});this.view.state.switchCameraController(d);d.zoomStep(Math.log(.5)/Math.log(.6),
c.createScreenPointArray(e.x,e.y));k.stopPropagation()}};return l}(w.InputHandler);a.DoubleClickZoom=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/time ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/set ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/projectionEllipsoid ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/common ../PointToPointAnimationController ../../utils/navigationUtils ../../../support/geometryUtils/ray ../../../support/geometryUtils/sphere ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing ../../../camera/constraintUtils/surfaceCollision".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p){a.ZoomStepController=function(D){function C(){var G=D.apply(this,arguments)||this;G.zoomLocation=d.create();G.tmpCamera=new E.default;G.tmpViewDir=d.create();G.tmpRayDir={origin:d.create(),direction:d.create()};G.targetOnSphere=d.create();G.tmpCenter=d.create();G.constraintOptions={selection:q.ConstraintTypes.ALL_EXCEPT_COLLISION,interactionType:q.InteractionType.ZOOM,interactionFactor:null,interactionStartCamera:new E.default,interactionDirection:null,
tiltMode:q.TiltMode.TUMBLE};G.sphere=z.create();return G}b._inheritsLoose(C,D);var F=C.prototype;F.initialize=function(){this.intersector=y.newIntersector(this.view.state.viewingMode)};F.zoomStep=function(G,L){if(this.active){var H=this.view.state,{interactionStartCamera:M}=this.constraintOptions;this.animation.finished?M.copyFrom(H.camera):this.animation.cameraAt(1,M);var K=M=!1;this.intersectionHelper.intersectScreen(L,this.zoomLocation)&&(M=0<G?!0:!1,K=!0);this.tmpCamera.copyFrom(H.camera);M?this.intersectionHelper.intersectRay(this.tmpCamera.ray,
this.intersector,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:e.copy(this.zoomLocation,this.tmpCamera.center);this._updateCamera(this.tmpCamera,G,this.zoomLocation,L,K);this.begin(this.tmpCamera)}};F.animationSettings=function(){return{apex:null,duration:g.Milliseconds(600),easing:A.outExpo}};F._updateCamera=function(G,L,H,M,K){var I=m.getReferenceEllipsoid(this.view.spatialReference);
if(r.decideNavigationMode(G,M,K,I)===r.NavigationMode.Horizontal){L=.6**L;this.sphere[3]=e.length(H);e.subtract(this.tmpViewDir,G.center,G.eye);K=e.length(this.tmpViewDir);I=K*L;1>=L&&4>I&&(I=4,L=I/K);if(1E-6>Math.abs(K-I))return;K=e.length(G.center);this.sphere[3]!==K&&(G.center=e.scale(B,G.center,(this.sphere[3]+L*(K-this.sphere[3]))/K));e.scale(this.tmpViewDir,this.tmpViewDir,-L);G.eye=e.add(B,G.center,this.tmpViewDir);v.applyAll(this.view,G,this.constraintOptions);1E-12<e.squaredDistance(H,G.center)&&
u.intersectScreen(this.sphere,G,M,this.targetOnSphere)&&r.panToPosition(this.sphere,G,H,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{K=.6**Math.abs(L);I=0<L?1:-1;x.fromScreenAtEye(G,M,this.tmpRayDir);e.normalize(this.tmpRayDir.direction,this.tmpRayDir.direction);var O;this.view.camera.position.hasZ&&(O=Math.abs(this.view.camera.position.z));O=Math.max(12*O,20);M=this.view._stage.renderView.getMinimalDepthForArea(null,M[0],M[1],this.view.state.camera,60);O=O>M?M:O;e.scale(this.tmpRayDir.direction,
this.tmpRayDir.direction,O);e.add(H,this.tmpRayDir.origin,this.tmpRayDir.direction);H=O*K;M=Math.max(4,1.01*G.nearFar[0]);0<L&&H<M&&(H=M,K=H/O);if(1E-6>Math.abs(O-H))return;e.scale(this.tmpRayDir.direction,this.tmpRayDir.direction,I*(1-K));G.eye=e.add(B,G.eye,this.tmpRayDir.direction);G.center=e.add(B,G.center,this.tmpRayDir.direction)}p.applySurfaceCollisionConstraint(this.view,G)};return C}(t.PointToPointAnimationController);a.ZoomStepController=c.__decorate([k.subclass("esri.views.3d.state.controllers.global.ZoomStepController")],
a.ZoomStepController);const B=d.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils":function(){define("exports ../../../chunks/vec2 ./constraintUtils/altitude ./constraintUtils/common ./constraintUtils/distance ./constraintUtils/surfaceCollision ./constraintUtils/tilt ../../animation/easing".split(" "),function(a,b,c,g,h,w,n,f){const l=[{type:g.ConstraintTypes.TILT,error:function(e,d,m){return n.getTiltConstraintError(e,d,m)*d.distance},apply:n.applyTiltConstraint},
{type:g.ConstraintTypes.ALTITUDE,error:c.getAltitudeConstraintError,apply:c.applyAltitudeConstraint},{type:g.ConstraintTypes.DISTANCE,error:h.getDistanceConstraintError,apply:h.applyDistanceConstraint}],k={selection:g.ConstraintTypes.ALL,interactionType:g.InteractionType.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:g.TiltMode.TUMBLE};a.applyAltitudeConstraint=c.applyAltitudeConstraint;a.getAltitudeConstraintError=c.getAltitudeConstraintError;Object.defineProperty(a,
"ConstraintTypes",{enumerable:!0,get:()=>g.ConstraintTypes});Object.defineProperty(a,"InteractionType",{enumerable:!0,get:()=>g.InteractionType});a.applyDistanceConstraint=h.applyDistanceConstraint;a.getDistanceConstraintError=h.getDistanceConstraintError;Object.defineProperty(a,"ApplyCollisionMode",{enumerable:!0,get:()=>w.Mode});a.applySurfaceCollisionConstraint=w.applySurfaceCollisionConstraint;a.applyTiltConstraint=n.applyTiltConstraint;a.getTiltConstraintError=n.getTiltConstraintError;a.applyAll=
function(e,d,m=k,z=d){let v=!1;z!==d&&z.copyFrom(d);z.computeUp(e.state.viewingMode);for(d=0;5>d;d++){let t=0;for(var q of l)if(g.hasConstraintType(m.selection,q.type)){const r=Math.abs(q.error(e,z,m));q.apply(e,z,m)&&(v=!0,t+=r)}if(0===t)break}q=g.hasConstraintType(m.selection,g.ConstraintTypes.COLLISION);a:switch(m.interactionType){case g.InteractionType.PAN:m=w.Mode.EYE_AND_CENTER;break a;case g.InteractionType.ASCEND:m=e.state.isGlobal?w.Mode.EYE_AND_CENTER_SCALE:w.Mode.EYE_AND_CENTER;break a;
default:m=w.Mode.EYE}q&&w.applySurfaceCollisionConstraint(e,z,m)&&(v=!0);v&&z.computeUp(e.state.viewingMode);return v};a.pixelDistanceToInteractionFactor=function(e,d){e="number"===typeof e?e:b.distance(e,d);return f.inOutCubic(Math.min(1,e/150))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("exports ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ./common ../../support/intersectionUtils".split(" "),
function(a,b,c,g,h,w,n,f){function l(q,t,r=n.defaultApplyOptions){var x=q.state.constraints.altitude;x=q.state.isGlobal&&x?r.interactionType===n.InteractionType.TUMBLE&&n.hasConstraintType(r.selection,n.ConstraintTypes.TILT)?!1:!0:!1;if(!x)return 0;var u=q.state.constraints.altitude;x=e;x.min=u.min;x.max=u.max;u=r.interactionType;if(u!==n.InteractionType.NONE){var {min:E,max:y}=x,{interactionStartCamera:A,interactionFactor:p}=r;r=u===n.InteractionType.TUMBLE||u===n.InteractionType.ZOOM;u=l(q,A);var B=
0===u?0:q.renderCoordsHelper.getAltitude(A.eye);x.min=E;x.max=y;n.adjustRangeForInteraction(u,B,r,p,.05*B,x)}q=q.renderCoordsHelper.getAltitude(t.eye);q=b.clamp(q,x.min,x.max)-q;return 1E-6>=Math.abs(q)?0:q}function k(q,t,r,x){q.renderCoordsHelper.worldUpAtPosition(t.eye,x);g.scale(x,x,r);return x}const e={min:0,max:0},d=h.create(),m=h.create(),z=h.create(),v=h.create();a.applyAltitudeConstraint=function(q,t,r=n.defaultApplyOptions){const x=l(q,t,r);if(0===x)return!1;const u=q.renderCoordsHelper,
E=u.getAltitude(t.eye)+x;r=n.interactionDirectionTowardsConstraintMinimization(t,r.interactionDirection,k(q,t,Math.sign(x),m),d);q=g.copy(z,t.viewForward);r=u.intersectInfiniteManifold(w.wrap(t.eye,r),E,v);t.eye=c.isSome(r)?r:u.setAltitude(v,E,t.eye);t.center=f.closestPointOnRay(v,t.eye,q,t.center);return!0};a.getAltitudeConstraintError=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils/common":function(){define(["exports","../../../../chunks/vec3"],function(a,
b){a.InteractionType=void 0;(function(g){g[g.NONE=0]="NONE";g[g.ZOOM=1]="ZOOM";g[g.TUMBLE=2]="TUMBLE";g[g.LOOK_AROUND=3]="LOOK_AROUND";g[g.PAN=4]="PAN";g[g.ASCEND=5]="ASCEND"})(a.InteractionType||(a.InteractionType={}));a.ConstraintTypes=void 0;(function(g){g[g.NONE=0]="NONE";g[g.TILT=1]="TILT";g[g.ALTITUDE=2]="ALTITUDE";g[g.DISTANCE=4]="DISTANCE";g[g.COLLISION=8]="COLLISION";g[g.ALL=15]="ALL";g[g.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(a.ConstraintTypes||(a.ConstraintTypes={}));a.TiltMode=
void 0;(function(g){g[g.TUMBLE=0]="TUMBLE";g[g.LOOK_AROUND=1]="LOOK_AROUND"})(a.TiltMode||(a.TiltMode={}));const c={selection:a.ConstraintTypes.NONE,interactionType:a.InteractionType.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:a.TiltMode.TUMBLE};a.adjustRangeForInteraction=function(g,h,w,n,f,l){0!==g&&(w?(l.min=Math.min(l.min,h),l.max=Math.max(l.max,h)):null!=n?(l.min-=Math.max(0,(h-l.min)*(1-n)),l.max+=Math.max(0,(h-l.max)*(1-n))):f&&(l.min-=Math.max(0,
h-l.min-f),l.max+=Math.max(0,h-l.max-f)))};a.defaultApplyOptions=c;a.hasConstraintType=function(g,h){return 0!==(g&h)};a.interactionDirectionTowardsConstraintMinimization=function(g,h,w,n){h=h||g.viewForward;b.copy(n,h);b.scale(n,n,Math.sign(b.dot(h,w)));return n};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/intersectionUtils":function(){define(["exports","../../../chunks/vec2f64","../../../chunks/vec3","../../../chunks/vec3f64","../../../geometry/support/plane"],function(a,
b,c,g,h){function w(l,k,e,d){const m=f;l?(e&&d&&(m.len=c.distance(k,e)),c.copy(m.dir,l)):d?(m.len=c.distance(k,e),c.subtract(m.dir,e,k),c.scale(m.dir,m.dir,1/m.len)):(c.subtract(m.dir,e,k),c.normalize(m.dir,m.dir));return m}function n(l,k,e,d){d.clip[0]=0;d.clip[1]=e?d.len:Number.MAX_VALUE;for(e=0;e<l.length;e++){{var m=l[e],z=k;var v=d;const q=c.dot(h.normal(m),v.dir);m=-h.signedDistance(m,z);0>m&&0<=q?v=!1:-1E-6<q&&1E-6>q?v=0<m:!(0>m||0>q)||0>m&&0>q?(m/=q,0<q?m<v.clip[1]&&(v.clip[1]=m):m>v.clip[0]&&
(v.clip[0]=m),v=v.clip[0]<=v.clip[1]):v=!0}if(!v)return!1}return!0}const f={dir:g.create(),len:0,clip:b.create()};a.closestPointOnRay=function(l,k,e,d){d=c.dot(e,c.subtract(l,d,k));return c.add(l,k,c.scale(l,e,d))};a.frustumLineSegment=function(l,k,e,d){d=w(d,k,e,!0);return n(l,k,e,d)};a.frustumPoint=function(l,k){for(let e=0;6>e;e++)if(0<h.signedDistance(l[e],k))return!1;return!0};a.frustumRay=function(l,k,e,d){e=w(d,k,e,!1);return n(l,k,null,e)};a.frustumSphere=function(l,k,e){const d=k[0],m=k[1];
k=k[2];return l[0][0]*d+l[0][1]*m+l[0][2]*k+l[0][3]>e||l[1][0]*d+l[1][1]*m+l[1][2]*k+l[1][3]>e||l[2][0]*d+l[2][1]*m+l[2][2]*k+l[2][3]>e||l[3][0]*d+l[3][1]*m+l[3][2]*k+l[3][3]>e||l[4][0]*d+l[4][1]*m+l[4][2]*k+l[4][3]>e||l[5][0]*d+l[5][1]*m+l[5][2]*k+l[5][3]>e?!1:!0};a.planeSphere=function(l,k,e){return l[0]*k[0]+l[1]*k[1]+l[2]*k[2]+l[3]<e};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils/distance":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ../../../../chunks/sphere ./common".split(" "),
function(a,b,c,g,h,w,n){function f(v,q,t=n.defaultApplyOptions){if(!v.state.isLocal)return 0;var r=v.state.constraints.distance;if(!v.pointsOfInterest.surfaceOrigin.renderLocation||Infinity===r)return 0;l.min=0;l.max=r;r=l;var x=t.interactionType;if(x!==n.InteractionType.NONE){var {min:u,max:E}=r,{interactionStartCamera:y,interactionFactor:A}=t;t=x===n.InteractionType.ZOOM||x===n.InteractionType.PAN;x=f(v,y);var p=0===x?0:c.distance(y.eye,v.pointsOfInterest.surfaceOrigin.renderLocation);r.min=u;r.max=
E;n.adjustRangeForInteraction(x,p,t,A,.05*p,r)}v=c.distance(q.eye,v.pointsOfInterest.surfaceOrigin.renderLocation);v=l.max-v;return-1E-6<=v?0:v}const l={min:0,max:0},k=g.create(),e=g.create(),d=g.create(),m=g.create(),z=g.create();a.applyDistanceConstraint=function(v,q,t=n.defaultApplyOptions){var r=f(v,q,t);if(0===r)return!1;var x=v.pointsOfInterest.surfaceOrigin;r=c.distance(q.eye,v.pointsOfInterest.surfaceOrigin.renderLocation)+r;const u=c.copy(k,q.eye);t=n.interactionDirectionTowardsConstraintMinimization(q,
t.interactionDirection,c.direction(m,q.eye,v.pointsOfInterest.surfaceOrigin.renderLocation),d);if(!w.intersectRay(w.fromCenterAndRadius(x.renderLocation,r),h.wrap(q.eye,t),z))return!1;q.eye=z;x=c.subtract(e,q.eye,u);q.center=c.add(z,q.center,x);x=v.renderCoordsHelper.getAltitude(q.center);v=v.renderCoordsHelper.intersectInfiniteManifold(q.ray,x,z);b.isSome(v)&&(q.center=v);return!0};a.getDistanceConstraintError=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["exports",
"../../../../chunks/vec3","../../../../chunks/vec3f64","../intersectionUtils"],function(a,b,c,g){a.Mode=void 0;(function(n){n[n.EYE=0]="EYE";n[n.EYE_AND_CENTER=1]="EYE_AND_CENTER";n[n.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(a.Mode||(a.Mode={}));const h=c.create(),w=c.create();a.applySurfaceCollisionConstraint=function(n,f,l=a.Mode.EYE){var k=n.state.constraints;if(!k.collision.enabled)return!1;var e=g.surfaceElevationBelowRenderLocation(n,f.eye);const d=n.renderCoordsHelper.getAltitude(f.eye);
k=e+k.collision.elevationMargin;if(d>=k)return!1;e=b.length(f.eye);b.subtract(h,f.center,f.eye);f.eye=n.renderCoordsHelper.setAltitude(w,k,f.eye);l===a.Mode.EYE_AND_CENTER?f.center=b.add(h,f.eye,h):l===a.Mode.EYE_AND_CENTER_SCALE&&(f.center=b.scale(h,f.center,(e-d+k)/e));return!0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/intersectionUtils":function(){define("exports ../../../core/maybe ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../webgl-engine/lib/Intersector".split(" "),
function(a,b,c,g,h,w,n){function f(v,q){return v.elevationProvider?b.unwrapOr(v.elevationProvider.getElevation(q[0],q[1],q[2],v.renderCoordsHelper.spatialReference,"ground"),0):0}function l(v,q,t){if(!v.state.isGlobal)return!1;const r=f(v,q);({far:v}=v.stateManager.constraintsManager.nearFarHeuristic.compute(q,t,v.renderDataExtent,r,z));v*=v;return c.squaredDistance(q,t)>v}const k={},e=g.create(),d=g.create(),m=g.create(),z={near:0,far:0};a.cameraOnContentAlongViewDirection=function(v,q,t,r){const x=
v.state.camera.clone();q&&(x.eye=q,x.center=t,x.up=r);q=x.ray;t=k[v.viewingMode];t||(t=n.newIntersector(v.state.viewingMode),t.options.backfacesTerrain=!v.state.isGlobal,t.options.invisibleTerrain=!0,k[v.viewingMode]=t);({isGlobal:r}=v.state);v.sceneIntersectionHelper.intersectRay(q,t,d)&&!l(v,q.origin,d)?q=!0:!v.renderCoordsHelper.intersectManifold(q,0,d)||l(v,q.origin,d)?r?(t=h.getReferenceEllipsoid(v.spatialReference).radius,t=c.dot(q.origin,q.origin)-t*t,c.scale(d,q.direction,(0<t?Math.sqrt(t)/
3:1)/c.length(q.direction)),c.add(d,d,q.origin),q=!0):q=!1:q=!0;q||c.copy(d,x.center);t=v.state.constraints;r=t.minimumPoiDistance;c.squaredDistance(x.eye,d)<r&&(q=t.collision.enabled,c.copy(m,x.viewForward),c.scale(m,m,r),q?x.eye=c.subtract(e,d,m):c.add(d,x.eye,m),v=v.renderCoordsHelper,r=v.getAltitude(x.eye),t=t.collision.elevationMargin,q&&r<t&&(c.subtract(m,d,x.eye),x.eye=v.setAltitude(e,t,x.eye),c.add(d,x.eye,m)));x.center=d;return x};a.eyeWithinExtent=function(v,q,t,r){return b.isSome(v.renderCoordsHelper.fromRenderCoords(q.eye,
e,r))&&w.containsPoint(t,e)};a.surfaceElevationBelowRenderLocation=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Intersector":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/ray ../../../ViewingMode ./IntersectorInterfaces ./intersectorUtils ./verticalOffsetUtils ../materials/renderers/utils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v){function q(y){return new x(y)}let t=function(){function y(p){this.options=new d.IntersectorOptions;this._results=new r;this.transform=new z.IntersectorTransform;this.tolerance=1E-5;this.verticalOffset=null;this._ray=k.create();this._rayEnd=n.create();this._rayBeginTransformed=n.create();this._rayEndTransformed=n.create();this.viewingMode=null==p?e.ViewingMode.Global:p}var A=y.prototype;A.reset=function(p,B,D){this.resetWithRay(k.fromPoints(p,B,this._ray),D)};
A.resetWithRay=function(p,B){this.camera=B;p!==this._ray&&k.copy(p,this._ray);0!==this.options.verticalOffset?this.viewingMode===e.ViewingMode.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null;w.add(this._rayEnd,this._ray.origin,this._ray.direction);this._results.init(this._ray)};A.intersect=function(p=null,B,D,C,F){this.point=B;this.filterPredicate=C;this.tolerance=null==D?1E-5:D;B=z.getVerticalOffsetObject3D(this.verticalOffset);
if(c.isSome(p)&&0<p.length){const G=F?L=>{F(L)&&this.intersectObject(L)}:L=>{this.intersectObject(L)};for(const L of p)p=L.getSpatialQueryAccelerator&&L.getSpatialQueryAccelerator(),c.isSome(p)?(c.isSome(B)?p.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,G,B):p.forEachAlongRay(this._ray.origin,this._ray.direction,G),this.options.selectionMode&&this.options.hud&&p.forEachDegenerateObject(G)):L.objects.forAll(H=>G(H))}this.sortResults()};A.intersectObject=function(p){const B=
p.geometryRecords;if(B){var D=p.transformation,C=z.getVerticalOffsetObject3D(this.verticalOffset);for(const F of B){const {geometry:G,material:L,instanceParameters:H}=F;if(v.isInstanceHidden(H))continue;const M=G.id;this.transform.setAndInvalidateLazyTransforms(D,F.getShaderTransformation());w.transformMat4(this._rayBeginTransformed,this.rayBegin,this.transform.inverse);w.transformMat4(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const K=this.transform.transform;c.isSome(C)&&(C.objectTransform=
this.transform);L.intersect(G,H,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(I,O,Q,J,P,N)=>{0<=I&&(!c.isSome(this.filterPredicate)||this.filterPredicate(this._ray.origin,this._rayEnd,I))&&(J?(null==this._results.hud.dist||I<this._results.hud.dist)&&this._results.hud.set(d.IntersectorType.HUD,{object:p,geometryId:M,triangleNr:Q,center:N},I,O,h.IDENTITY,P):((null==this._results.min.drapedLayerOrder||P>=this._results.min.drapedLayerOrder)&&(null==this._results.min.dist||
I<this._results.min.dist)&&this._results.min.set(d.IntersectorType.OBJECT,{object:p,geometryId:M,triangleNr:Q},I,O,K,P),this.options.store!==d.StoreResults.MIN&&(null==this._results.max.drapedLayerOrder||P<this._results.max.drapedLayerOrder)&&(null==this._results.max.dist||I>this._results.max.dist)&&this._results.max.set(d.IntersectorType.OBJECT,{object:p,geometryId:M,triangleNr:Q},I,O,K,P),this.options.store===d.StoreResults.ALL&&(J=q(this._ray),J.set(d.IntersectorType.OBJECT,{object:p,geometryId:M,
triangleNr:Q},I,O,K),this._results.all.push(J))))},F.shaderTransformation)}}};A.sortResults=function(){this._results.all.sort((p,B)=>p.dist!==B.dist?c.unwrapOr(p.dist,0)-c.unwrapOr(B.dist,0):p.drapedLayerOrder!==B.drapedLayerOrder?c.unwrapOr(p.drapedLayerOrder,Number.MAX_VALUE)-c.unwrapOr(B.drapedLayerOrder,Number.MAX_VALUE):c.unwrapOr(B.drapedLayerGraphicOrder,Number.MIN_VALUE)-c.unwrapOr(p.drapedLayerGraphicOrder,Number.MIN_VALUE))};b._createClass(y,[{key:"results",get:function(){return this._results}},
{key:"ray",get:function(){return this._ray}},{key:"rayBegin",get:function(){return this._ray.origin}},{key:"rayEnd",get:function(){return this._rayEnd}}]);return y}(),r=function(){function y(){this._min=new x(k.create());this._max=new x(k.create());this._hud=new x(k.create());this._ground=new x(k.create())}y.prototype.init=function(A){this._min.init(A);this._max.init(A);this._hud.init(A);this._ground.init(A);this.all=[]};b._createClass(y,[{key:"min",get:function(){return this._min}},{key:"max",get:function(){return this._max}},
{key:"hud",get:function(){return this._hud}},{key:"ground",get:function(){return this._ground}}]);return y}(),x=function(){function y(p){this.intersector=d.IntersectorType.OBJECT;this.normal=n.create();this.transformation=h.create();this._ray=k.create();this.init(p)}var A=y.prototype;A.getIntersectionPoint=function(p){if(!m.isValidIntersectorResult(this))return!1;w.scale(u,this.ray.direction,this.dist);w.add(p,this.ray.origin,u);return!0};A.getTransformedNormal=function(p){w.copy(E,this.normal);E[3]=
0;f.transformMat4(E,E,this.transformation);w.copy(p,E);return w.normalize(p,p)};A.init=function(p){this.drapedLayerGraphicOrder=this.drapedLayerOrder=this.target=this.dist=null;this.intersector=d.IntersectorType.OBJECT;k.copy(p,this._ray)};A.set=function(p,B,D,C,F,G,L){this.intersector=p;this.dist=D;w.copy(this.normal,c.unwrapOr(C,n.UNIT_Z));g.copy(this.transformation,c.unwrapOr(F,h.IDENTITY));this.target=B;this.drapedLayerOrder=G;this.drapedLayerGraphicOrder=L};A.copy=function(p){k.copy(p.ray,this._ray);
this.intersector=p.intersector;this.dist=p.dist;this.target=p.target;this.drapedLayerOrder=p.drapedLayerOrder;this.drapedLayerGraphicOrder=p.drapedLayerGraphicOrder;w.copy(this.normal,p.normal);g.copy(this.transformation,p.transformation)};b._createClass(y,[{key:"ray",get:function(){return this._ray}},{key:"distanceInRenderSpace",get:function(){return c.isSome(this.dist)?(w.scale(u,this.ray.direction,this.dist),w.length(u)):null}}]);return y}();const u=n.create(),E=l.create();a.DEFAULT_TOLERANCE=
1E-5;a.newIntersector=function(y){return new t(y)};a.newIntersectorResult=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/IntersectorInterfaces":function(){define(["exports"],function(a){a.IntersectorType=void 0;(function(b){b[b.OBJECT=0]="OBJECT";b[b.HUD=1]="HUD";b[b.TERRAIN=2]="TERRAIN";b[b.OVERLAY=3]="OVERLAY";b[b.I3S=4]="I3S";b[b.PCL=5]="PCL";b[b.LOD=6]="LOD";b[b.VOXEL=7]="VOXEL"})(a.IntersectorType||(a.IntersectorType={}));a.StoreResults=void 0;(function(b){b[b.MIN=
0]="MIN";b[b.MINMAX=1]="MINMAX";b[b.ALL=2]="ALL"})(a.StoreResults||(a.StoreResults={}));a.IntersectorOptions=function(){this.verticalOffset=0;this.selectionMode=!1;this.selectOpaqueTerrainOnly=this.hud=!0;this.invisibleTerrain=!1;this.backfacesTerrain=!0;this.isFiltered=!1;this.store=a.StoreResults.ALL};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/intersectorUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/boundedPlane ./IntersectorInterfaces".split(" "),
function(a,b,c,g,h,w){function n(l){return b.isSome(l)&&b.isSome(l.dist)}const f=g.create();a.isHudIntersectorResult=function(l){return n(l)&&l.intersector===w.IntersectorType.HUD&&!!l.target&&b.isSome(l.target.center)};a.isObjectIntersectorResult=function(l){return n(l)&&l.intersector===w.IntersectorType.OBJECT&&!!l.target};a.isValidIntersectorResult=n;a.sliceFilterPredicate=function(l){return(k,e,d)=>{c.lerp(f,k,e,d);return!h.extrusionContainsPoint(l,f)}};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/webgl-engine/lib/verticalOffsetUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf64 ../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../chunks/sphere".split(" "),function(a,b,c,g,h,w,n,f,l,k,e,d,m,z){let v=function(){function p(){this._transform=
n.create();this._transformInverse=new q({value:this._transform},w.invert,n.create);this._transformInverseTranspose=new q(this._transformInverse,w.transpose,n.create);this._transformTranspose=new q({value:this._transform},w.transpose,n.create);this._transformInverseRotation=new q({value:this._transform},g.normalFromMat4Legacy,h.create)}var B=p.prototype;B._invalidateLazyTransforms=function(){this._transformInverse.invalidate();this._transformInverseTranspose.invalidate();this._transformTranspose.invalidate();
this._transformInverseRotation.invalidate()};B.setTransformMatrix=function(D){w.copy(this._transform,D)};B.multiplyTransform=function(D){w.multiply(this._transform,this._transform,D)};B.set=function(D){w.copy(this._transform,D);this._invalidateLazyTransforms()};B.setAndInvalidateLazyTransforms=function(D,C){this.setTransformMatrix(D);this.multiplyTransform(C);this._invalidateLazyTransforms()};b._createClass(p,[{key:"transform",get:function(){return this._transform}},{key:"inverse",get:function(){return this._transformInverse.value}},
{key:"inverseTranspose",get:function(){return this._transformInverseTranspose.value}},{key:"inverseRotation",get:function(){return this._transformInverseRotation.value}},{key:"transpose",get:function(){return this._transformTranspose.value}}]);return p}(),q=function(){function p(B,D,C){this.original=B;this.update=D;this.dirty=!0;this.transform=C()}p.prototype.invalidate=function(){this.dirty=!0};b._createClass(p,[{key:"value",get:function(){this.dirty&&(this.update(this.transform,this.original.value),
this.dirty=!1);return this.transform}}]);return p}(),t=function(){function p(D=0){this.offset=D;this.tmpVertex=d.create()}var B=p.prototype;B.applyToVertex=function(D,C,F){const G=D+this.localOrigin[0],L=C+this.localOrigin[1],H=F+this.localOrigin[2],M=this.offset/Math.sqrt(G*G+L*L+H*H);this.tmpVertex[0]=D+G*M;this.tmpVertex[1]=C+L*M;this.tmpVertex[2]=F+H*M;return this.tmpVertex};B.applyToAabb=function(D){var C=D[0]+this.localOrigin[0];const F=D[1]+this.localOrigin[1],G=D[2]+this.localOrigin[2],L=
D[3]+this.localOrigin[0],H=D[4]+this.localOrigin[1],M=D[5]+this.localOrigin[2],K=this.offset/Math.sqrt(C*C+F*F+G*G);D[0]+=C*K;D[1]+=F*K;D[2]+=G*K;C=this.offset/Math.sqrt(L*L+H*H+M*M);D[3]+=L*C;D[4]+=H*C;D[5]+=M*C;return D};return p}(),r=function(){function p(D=0){this.offset=D;this.componentLocalOriginLength=0;this.tmpVertex=d.create();this.mbs=m.create();this.obb={center:d.create(),halfSize:e.create(),quaternion:null}}var B=p.prototype;B.applyToVertex=function(D,C,F){const G=F+this.componentLocalOriginLength,
L=this.offset/Math.sqrt(D*D+C*C+G*G);this.tmpVertex[0]=D+D*L;this.tmpVertex[1]=C+C*L;this.tmpVertex[2]=F+G*L;return this.tmpVertex};B.applyToAabb=function(D){var C=D[0];const F=D[1],G=D[2]+this.componentLocalOriginLength,L=D[3],H=D[4],M=D[5]+this.componentLocalOriginLength,K=this.offset/Math.sqrt(C*C+F*F+G*G);D[0]+=C*K;D[1]+=F*K;D[2]+=G*K;C=this.offset/Math.sqrt(L*L+H*H+M*M);D[3]+=L*C;D[4]+=H*C;D[5]+=M*C;return D};B.applyToMbs=function(D){const C=Math.sqrt(D[0]*D[0]+D[1]*D[1]+D[2]*D[2]),F=this.offset/
C;this.mbs[0]=D[0]+D[0]*F;this.mbs[1]=D[1]+D[1]*F;this.mbs[2]=D[2]+D[2]*F;this.mbs[3]=D[3]+D[3]*this.offset/C;return this.mbs};B.applyToObb=function(D){var C=D.center;const F=this.offset/Math.sqrt(C[0]*C[0]+C[1]*C[1]+C[2]*C[2]);this.obb.center[0]=C[0]+C[0]*F;this.obb.center[1]=C[1]+C[1]*F;this.obb.center[2]=C[2]+C[2]*F;k.transformQuat(this.obb.halfSize,D.halfSize,D.quaternion);k.add(this.obb.halfSize,this.obb.halfSize,D.center);C=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*
this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);this.obb.halfSize[0]+=this.obb.halfSize[0]*C;this.obb.halfSize[1]+=this.obb.halfSize[1]*C;this.obb.halfSize[2]+=this.obb.halfSize[2]*C;k.subtract(this.obb.halfSize,this.obb.halfSize,D.center);f.conjugate(A,D.quaternion);k.transformQuat(this.obb.halfSize,this.obb.halfSize,A);this.obb.halfSize[0]*=0>this.obb.halfSize[0]?-1:1;this.obb.halfSize[1]*=0>this.obb.halfSize[1]?-1:1;this.obb.halfSize[2]*=0>this.obb.halfSize[2]?-1:1;this.obb.quaternion=
D.quaternion;return this.obb};b._createClass(p,[{key:"localOrigin",set:function(D){this.componentLocalOriginLength=Math.sqrt(D[0]*D[0]+D[1]*D[1]+D[2]*D[2])}}]);return p}(),x=function(){function p(D=0){this.offset=D;this.sphere=z.create();this.tmpVertex=d.create()}var B=p.prototype;B.applyToVertex=function(D,C,F){const G=this.objectTransform.transform;let L=G[0]*D+G[4]*C+G[8]*F+G[12],H=G[1]*D+G[5]*C+G[9]*F+G[13];D=G[2]*D+G[6]*C+G[10]*F+G[14];C=this.offset/Math.sqrt(L*L+H*H+D*D);L+=L*C;H+=H*C;D+=D*
C;C=this.objectTransform.inverse;this.tmpVertex[0]=C[0]*L+C[4]*H+C[8]*D+C[12];this.tmpVertex[1]=C[1]*L+C[5]*H+C[9]*D+C[13];this.tmpVertex[2]=C[2]*L+C[6]*H+C[10]*D+C[14];return this.tmpVertex};B.applyToMinMax=function(D,C){const F=this.offset/Math.sqrt(D[0]*D[0]+D[1]*D[1]+D[2]*D[2]);D[0]+=D[0]*F;D[1]+=D[1]*F;D[2]+=D[2]*F;D=this.offset/Math.sqrt(C[0]*C[0]+C[1]*C[1]+C[2]*C[2]);C[0]+=C[0]*D;C[1]+=C[1]*D;C[2]+=C[2]*D};B.applyToAabb=function(D){var C=this.offset/Math.sqrt(D[0]*D[0]+D[1]*D[1]+D[2]*D[2]);
D[0]+=D[0]*C;D[1]+=D[1]*C;D[2]+=D[2]*C;C=this.offset/Math.sqrt(D[3]*D[3]+D[4]*D[4]+D[5]*D[5]);D[3]+=D[3]*C;D[4]+=D[4]*C;D[5]+=D[5]*C;return D};B.applyToBoundingSphere=function(D){const C=Math.sqrt(D[0]*D[0]+D[1]*D[1]+D[2]*D[2]),F=this.offset/C;this.sphere[0]=D[0]+D[0]*F;this.sphere[1]=D[1]+D[1]*F;this.sphere[2]=D[2]+D[2]*F;this.sphere[3]=D[3]+D[3]*this.offset/C;return this.sphere};return p}();const u=new x,E=new r,y=new t,A=l.create();a.I3SVerticalOffsetGlobalViewingMode=r;a.IntersectorTransform=
v;a.Object3DVerticalOffsetGlobalViewingMode=x;a.TERRAIN_ID="terrain";a.TerrainVerticalOffsetGlobalViewingMode=t;a.getVerticalOffsetI3S=function(p){return c.isSome(p)?(E.offset=p,E):null};a.getVerticalOffsetObject3D=function(p){return c.isSome(p)?(u.offset=p,u):null};a.getVerticalOffsetTerrain=function(p){return c.isSome(p)?(y.offset=p,y):null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/renderers/utils":function(){define("exports ../../../../../core/maybe ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../lib/Util ../../../../webgl/doublePrecisionUtils".split(" "),
function(a,b,c,g,h,w){const n=new Float64Array(3),f=new Float32Array(6),l=g.create();a.addObject3DStateID=function(k,e){b.isNone(k)&&(k=[]);k.push(e);return k};a.calculateTransformRelativeToOrigin=function(k,e,d){const m=k.origin.vec3;h.setMatrixTranslation3(l,-m[0],-m[1],-m[2]);b.isSome(k.transformation)?c.multiply(e,l,k.transformation):c.copy(e,l);d&&(c.invert(d,e),c.transpose(d,d))};a.encodeDoubleVec3=function(k,e,d,m,z){n[0]=k.get(e,0);n[1]=k.get(e,1);n[2]=k.get(e,2);w.encodeDoubleArray(n,f,3);
d.set(z,0,f[0]);m.set(z,0,f[1]);d.set(z,1,f[2]);m.set(z,1,f[3]);d.set(z,2,f[4]);m.set(z,2,f[5])};a.isInstanceHidden=function(k){return b.isSome(k)?!k.visible:!1};a.removeObject3DStateID=function(k,e){if(b.isNone(k))return null;k=k.filter(d=>d!==e);return 0===k.length?null:k};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/doublePrecisionUtils":function(){define(["exports"],function(a){function b(h,w,n){for(let f=0;f<n;++f)w[2*f]=h[f],w[2*f+1]=h[f]-w[2*f]}const c=new Float64Array(1),
g=new Float32Array(2);a.decodeDoubleArray=function(h,w,n){for(let f=0;f<n;++f)w[f]=h[2*f]+h[2*f+1]};a.encodeDouble=function(h,w){g[0]=h;g[1]=h-g[0];w[0]=g[0];w[1]=g[1]};a.encodeDoubleArray=b;a.encodeDoubleArraySplit=function(h,w,n,f){for(let l=0;l<f;++l)c[0]=h[l],b(c,g,1),w[l]=g[0],n[l]=g[1]};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../../../chunks/sphere ./common ../../state/utils/viewUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){function m(p,B,D=e.defaultApplyOptions,C=!0){A.eyeCenterDistance=0;A.requiresTwoSteps=!1;const F=z(p,B,D,void 0,A);if(0===F)return!1;h.fromRotation(r,-F,B.viewRight);switch(D.tiltMode){case e.TiltMode.LOOK_AROUND:n.transformMat4(t,B.viewForward,r);n.scale(t,t,A.eyeCenterDistance);B.center=n.add(x,B.eye,t);break;case e.TiltMode.TUMBLE:n.subtract(t,B.center,B.eye);n.transformMat4(t,t,r);B.eye=n.subtract(x,B.center,t);break;default:b.neverReached(D.tiltMode)}B.up=n.transformMat4(x,
B.up,r);return A.requiresTwoSteps&&C?m(p,B,D,!1):!0}function z(p,B,D=e.defaultApplyOptions,C=e.defaultApplyOptions,F){if(!p.state.constraints.tilt)return 0;var G=p.state.constraints.tilt(B.distance,E);if(D.interactionType!==e.InteractionType.NONE){var {interactionStartCamera:L,interactionFactor:H}=D,{min:M,max:K}=G,I=z(p,L,e.defaultApplyOptions,D),O=0===I?0:d.viewAngle(p.renderCoordsHelper,L.center,L.eye);G.min=M;G.max=K;D.interactionType===e.InteractionType.TUMBLE?(e.hasConstraintType(D.selection,
e.ConstraintTypes.ALTITUDE)&&q(p,L,G),e.adjustRangeForInteraction(I,O,!0,H,u,G)):e.adjustRangeForInteraction(I,O,!1,H,u,G)}C.interactionType===e.InteractionType.TUMBLE&&e.hasConstraintType(C.selection,e.ConstraintTypes.ALTITUDE)&&q(p,C.interactionStartCamera,G);if(D.tiltMode===e.TiltMode.LOOK_AROUND||C.tiltMode===e.TiltMode.LOOK_AROUND){a:switch(F&&(F.requiresTwoSteps=!1),p.viewingMode){case "global":D=y;I=p.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;C=I+l.getReferenceEllipsoid(p.spatialReference).radius;
I=p.renderCoordsHelper.intersectManifold(B.ray,I,x);D.eyeCenterDistance=B.distance;D.centerIsOnSurface=!1;g.isSome(I)?(D.eyeCenterDistance=n.distance(B.eye,I),D.tiltAtCenter=d.viewAngle(p.renderCoordsHelper,I,B.eye),D.centerIsOnSurface=!0):p.state.isLocal?D.tiltAtCenter=d.viewAngle(p.renderCoordsHelper,B.center,B.eye):(k.closestPointOnSilhouette(k.fromRadius(C),B.ray,x),D.eyeCenterDistance=n.distance(B.eye,x),D.tiltAtCenter=c.acosClamped(-n.dot(B.viewForward,n.normalize(x,x))));D.radius=C;D.eyeRadius=
n.length(B.eye);D.constraints=p.state.constraints;B=c.clamp(D.tiltAtCenter,G.min,G.max);if(1E-9<Math.abs(D.tiltAtCenter-B)){if(D.centerIsOnSurface){{const {constraints:Q,eyeCenterDistance:J,tiltAtCenter:P}=D;B=P;p=Q.clampTilt(J,P);G=v(D,p);if(Q.clampTilt(G,P)!==p)for(G=0;10>G&&1E-9<Math.abs(p-B);)C=(B+p)/2,I=v(D,C),I=Q.clampTilt(I,C),1E-9<Math.abs(I-C)?B=C:p=C,G++;B=p}G=B;p=c.asinClamped(D.radius/D.eyeRadius*Math.sin(D.tiltAtCenter));G=c.asinClamped(D.radius/D.eyeRadius*Math.sin(G));p=D.eyeRadius>
D.radius?p-G:G-p}else B=D.constraints.clampTilt(D.eyeCenterDistance,D.tiltAtCenter),F&&B<Math.PI/2&&(F.requiresTwoSteps=!0,B=Math.PI/2-1E-5),p=D.tiltAtCenter-Math.PI/2-(B-Math.PI/2);F&&(F.eyeCenterDistance=v(D,B));F=p}else F=0;break a;case "local":C=d.viewAngle(p.renderCoordsHelper,B.center,B.eye);D=c.clamp(C,G.min,G.max);G=C-D;1E-9<Math.abs(G)?(F&&(C=p.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,p=p.renderCoordsHelper.getAltitude(B.eye)-C,D=Math.cos(D),F.eyeCenterDistance=1E-4<
Math.abs(D)?p/D:B.distance),F=G):F=0;break a;default:b.neverReached(p.viewingMode),F=void 0}return F}F=d.viewAngle(p.renderCoordsHelper,B.center,B.eye);D=c.clamp(F,G.min,G.max);F-=D;F=1E-9<Math.abs(F)?F:0;return F}function v(p,B){if(!p.centerIsOnSurface)return p.eyeCenterDistance;B=Math.PI-c.clamp(B,0,Math.PI);const D=c.asinClamped(p.radius/p.eyeRadius*Math.sin(B)),C=Math.sin(Math.PI-B-D)/Math.sin(B);return p.eyeRadius<p.radius&&1<C?Math.sin(Math.PI-B-(Math.PI-D))/Math.sin(B)*p.eyeRadius:C*p.eyeRadius}
function q(p,B,D){if(!p.state.isLocal){var C=p.state.constraints;if(C.altitude){var F=n.squaredLength(B.center),G=Math.sqrt(F);B=B.distance;var L=l.getReferenceEllipsoid(p.spatialReference).radius;p=C.altitude.min+L;C=C.altitude.max+L;p=(p*p-B*B-F)/(-2*G*B);D.min=Math.max(D.min,Math.min(Math.PI-c.acosClamped((C*C-B*B-F)/(-2*G*B)),D.max));D.max=Math.min(D.max,Math.PI-c.acosClamped(p))}}}const t=f.create(),r=w.create(),x=f.create(),u=c.deg2rad(5),E={min:0,max:0},y={constraints:null,radius:0,eyeRadius:0,
centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},A={eyeCenterDistance:0,requiresTwoSteps:!1};a.applyTiltConstraint=m;a.getTiltConstraintError=z;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/utils/viewUtils":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/vec3","../../../../chunks/vec3f64"],function(a,b,c,g){const h=g.create(),w=g.create();a.viewAngle=function(n,f,l){n.worldUpAtPosition(f,h);c.subtract(w,l,f);n=c.length(w);return 0===
n?0:b.acosClamped(c.dot(w,h)/n)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/easing":function(){define(["exports"],function(a){function b(P){return P}function c(P){const N=2*(P-Math.sqrt((P-1)*P)),R=N/2/P;return S=>S<R?P*S*S:N*S-N+1}function g(P,N){return(R,S)=>R<N?N*P(R/N,S):1-P((1-R)/(1-N),S)*(1-N)}const h=P=>P*P,w=P=>1-h(1-P),n=P=>.5>P?h(2*P)/2:(1-h(1-2*(P-.5))+1)/2,f=P=>P*P*P,l=P=>1-f(1-P),k=P=>.5>P?f(2*P)/2:(1-f(1-2*(P-.5))+1)/2,e=P=>P*P*P*P,d=P=>1-e(1-P),m=P=>.5>
P?e(2*P)/2:(1-e(1-2*(P-.5))+1)/2,z=P=>P*P*P*P*P,v=P=>1-z(1-P),q=P=>.5>P?z(2*P)/2:(1-z(1-2*(P-.5))+1)/2,t=P=>-Math.cos(P*Math.PI/2)+1,r=P=>1-t(1-P),x=P=>.5>P?t(2*P)/2:(1-t(1-2*(P-.5))+1)/2,u=P=>2**(10*(P-1)),E=P=>1-2**(10*(1-P-1)),y=P=>.5>P?2**(10*(2*P-1))/2:(1-2**(10*(1-2*(P-.5)-1))+1)/2,A=P=>-(Math.sqrt(1-P*P)-1),p=P=>1-A(1-P),B=P=>.5>P?A(2*P)/2:(1-A(1-2*(P-.5))+1)/2,D=g(c(1),1),C=g(c(1),0),F=g(c(1),.5),G=g(c(2),1),L=g(c(2),0),H=g(c(2),.5),M=g(c(3),1),K=g(c(3),0),I=g(c(3),.5),O=g(c(4),1),Q=g(c(4),
0),J=g(c(4),.5);a.EasingFunctions={linear:b,"in-quad":h,"out-quad":w,"in-out-quad":n,"in-coast-quad":D,"out-coast-quad":C,"in-out-coast-quad":F,"in-cubic":f,"out-cubic":l,"in-out-cubic":k,"in-coast-cubic":G,"out-coast-cubic":L,"in-out-coast-cubic":H,"in-quart":e,"out-quart":d,"in-out-quart":m,"in-coast-quart":M,"out-coast-quart":K,"in-out-coast-quart":I,"in-quint":z,"out-quint":v,"in-out-quint":q,"in-coast-quint":O,"out-coast-quint":Q,"in-out-coast-quint":J,"in-sine":t,"out-sine":r,"in-out-sine":x,
"in-expo":u,"out-expo":E,"in-out-expo":y,"in-circ":A,"out-circ":p,"in-out-circ":B};a.inCirc=A;a.inCoastCubic=G;a.inCoastQuad=D;a.inCoastQuart=M;a.inCoastQuint=O;a.inCubic=f;a.inExpo=u;a.inOutCirc=B;a.inOutCoastCubic=H;a.inOutCoastQuad=F;a.inOutCoastQuart=I;a.inOutCoastQuint=J;a.inOutCubic=k;a.inOutExpo=y;a.inOutQuad=n;a.inOutQuart=m;a.inOutQuint=q;a.inOutSine=x;a.inQuad=h;a.inQuart=e;a.inQuint=z;a.inSine=t;a.linear=b;a.outCirc=p;a.outCoastCubic=L;a.outCoastQuad=C;a.outCoastQuart=K;a.outCoastQuint=
Q;a.outCubic=l;a.outExpo=E;a.outQuad=w;a.outQuart=d;a.outQuint=v;a.outSine=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../ViewAnimation ../../animation/pointToPoint/Animation ./AnimationController ../../webgl-engine/lib/Camera ../../webgl-engine/lib/Intersector ../../../animation/easing".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v){a.PointToPointAnimationController=function(r){function x(E){E=r.call(this,E)||this;E.view=null;E.mode="interaction";E.hasTarget=!1;return E}b._inheritsLoose(x,r);var u=x.prototype;u.initialize=function(){this.animation=new e.Animation(this.view.state.viewingMode);this.viewAnimation="interaction"===this.mode?null:new k};u.begin=function(E,y){this.hasTarget=!0;y=this.animationSettings(y);q.copyFrom(this.view.state.camera);const A=z.newIntersector(this.view.state.viewingMode);
this.intersectionHelper.intersectRay(q.ray,A,t)&&(q.center=t);this.animation.update(q,E,y);this.animation.finished&&this.finish()};u.finish=function(){this.animation.currentTime=this.animation.time;r.prototype.finish.call(this)};u.stepController=function(E,y){this.hasTarget&&this.animation.step(E,y)};u.onControllerEnd=function(E){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,E),this.animation.currentTime=this.animation.time);r.prototype.onControllerEnd.call(this,
E)};u.animationSettings=function(E={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(Infinity)/6,ascensionFactor:void 0,descensionFactor:void 0},...E,easing:"string"===typeof E.easing?v.EasingFunctions[E.easing]:E.easing}};b._createClass(x,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}},{key:"isInteractive",get:function(){return"interaction"===this.mode}},{key:"steppingFinished",get:function(){return this.hasTarget&&this.animation.finished}}]);
return x}(d.AnimationController);c.__decorate([g.property({constructOnly:!0})],a.PointToPointAnimationController.prototype,"view",void 0);c.__decorate([g.property({constructOnly:!0})],a.PointToPointAnimationController.prototype,"mode",void 0);a.PointToPointAnimationController=c.__decorate([f.subclass("esri.views.3d.state.controllers.PointToPointAnimationController")],a.PointToPointAnimationController);const q=new m.default,t=l.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/animation/pointToPoint/Animation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/time ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./Camera ../../webgl-engine/lib/Camera ../../../animation/pointToPoint/Animation".split(" "),
function(a,b,c,g,h,w,n,f){const l=h.create();h=function(){function k(d){this.currentTime=c.Milliseconds(0);this._animation=new f.Animation(()=>new w(d));this._current=new w(d)}var e=k.prototype;e.update=function(d,m,z){const v=this._animation.definition.source,q=this._animation.definition.target,t=g.subtract(l,m.center,d.center),r=g.length(t);1E-5<=r?(t[0]/=r,t[1]/=r,t[2]/=r):(t[0]=0,t[1]=1,t[0]=0);g.copy(v.lookAtDirection,t);g.copy(q.lookAtDirection,t);v.copyFromRenderCamera(d);q.copyFromRenderCamera(m);
this._current.copyFrom(v);this._animation.update(v,q,z);this.currentTime=c.Milliseconds(0);d.almostEquals(m)&&(this.currentTime=this._animation.time)};e.cameraAt=function(d,m){this._animation.cameraAt(d,this._current);m=m||new n.default;this._current.copyToRenderCamera(m);return m};e.step=function(d,m){this.finished||(this.currentTime=c.Milliseconds(this.currentTime+c.millisecondsFromSeconds(d)),this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,
m)};b._createClass(k,[{key:"finished",get:function(){return this.currentTime>=this._animation.time}},{key:"time",get:function(){return this._animation.time}}]);return k}();a.Animation=h;a.default=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/animation/pointToPoint/Camera":function(){define("../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../../support/mathUtils".split(" "),
function(a,b,c,g,h,w,n){const f=h.create(),l=h.create(),k=h.create(),e=h.create(),d=h.create(),m=h.create();var z=h.fromValues(0,0,1),v=h.fromValues(0,1,0),q=h.fromValues(1,0,0);const t=c.create();return function(){function r(u=w.ViewingMode.Global){this.viewingMode=u;this.center=h.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=h.clone(v)}var x=r.prototype;x.pixelsPerPanAtZoom=function(u){return this.size/2/(this._zoomToPanScale*u)};x.zoomAtPixelsPerPan=function(u){return this.size/
2/(this._zoomToPanScale*u)};x.pixelsPerRotateAtZoom=function(){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)};x.compareTo=function(u,E){E||(E={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if(this.viewingMode===w.ViewingMode.Global){var y=g.length(this.center);const A=g.length(u.center);y=(y+A)/2;E.pan=n.angle(this.center,u.center)*y}else E.pan=g.distance(this.center,u.center);y=Math.abs(u.yaw-this.yaw);y>=Math.PI&&(y=2*Math.PI-y);E.rotate=Math.max(y,Math.abs(u.pitch-this.pitch));E.sourceZoom=
this.distance;E.targetZoom=u.distance;return E};x.interpolate=function(u,E,y){this.viewingMode===w.ViewingMode.Global?n.slerp(u.center,E.center,y.pan,this.center):g.lerp(this.center,u.center,E.center,y.pan);this.distance=a.lerp(u.distance,E.distance,y.zoom);this.pitch=a.lerp(u.pitch,E.pitch,y.rotate);u=u.yaw;E=E.yaw;Math.abs(E-u)>=Math.PI&&(u+=2*(u<E?1:-1)*Math.PI);this.yaw=a.lerp(u,E,y.rotate)};x.copyFrom=function(u){g.copy(this.center,u.center);this.pitch=u.pitch;this.yaw=u.yaw;this.distance=u.distance;
g.copy(this.lookAtDirection,u.lookAtDirection);this.size=u.size;this.copyFromCommon(u);this.viewingMode=u.viewingMode};x.copyFromRenderCamera=function(u){const E=this._lookAtOrientation(u.center,t);g.copy(this.center,u.center);g.subtract(e,u.center,u.eye);g.transformMat3(e,e,E);g.transformMat3(d,u.up,E);this.distance=g.length(e);e[0]/=this.distance;e[1]/=this.distance;e[2]/=this.distance;this.pitch=this._eyeUpToPitch(e);this.yaw=this._eyeUpToYaw(e,d);this.size=Math.sqrt(u.width*u.width+u.height*u.height);
this.copyFromCommon(u)};x.copyFromCommon=function(u){this.fov=u.fov;this._zoomToPanScale=Math.atan(.5*this.fov)};x.copyToRenderCamera=function(u){const E=this._lookAtOrientation(this.center,t);b.transpose(E,E);this._axisAngleVec3(q,this.pitch-Math.PI/2,v,e);this._axisAngleVec3(z,this.yaw,e);this._axisAngleVec3(q,this.pitch-Math.PI/2,z,d);this._axisAngleVec3(z,this.yaw,d);g.scale(e,e,this.distance);g.transformMat3(e,e,E);g.transformMat3(d,d,E);u.center=this.center;u.eye=g.subtract(e,this.center,e);
u.up=d};x._axisAngleVec3=function(u,E,y,A=y){const p=Math.cos(E);E=Math.sin(E);g.scale(f,y,p);g.cross(l,u,y);g.scale(l,l,E);g.scale(k,u,(1-p)*g.dot(u,y));return g.add(A,g.add(A,f,l),k)};x._lookAtOrientation=function(u,E=c.create()){this._upAtLookAt(u,k);g.cross(f,this.lookAtDirection,k);g.normalize(f,f);0===f[0]&&0===f[1]&&0===f[2]&&g.copy(f,q);g.cross(l,k,f);g.normalize(l,l);E[0]=f[0];E[1]=l[0];E[2]=k[0];E[3]=f[1];E[4]=l[1];E[5]=k[1];E[6]=f[2];E[7]=l[2];E[8]=k[2];return E};x._upAtLookAt=function(u,
E){return this.viewingMode===w.ViewingMode.Local?g.copy(E,z):g.normalize(E,u)};x._eyeUpToPitch=function(u){return Math.PI-n.angle(z,u)};x._eyeUpToYaw=function(u,E){.5>Math.abs(E[2])?(g.copy(m,E),0<u[2]&&g.scale(m,m,-1)):g.copy(m,u);g.cross(l,m,z);g.normalize(l,l);return n.angle(q,l,z)};return r}()})},"esri/views/3d/webgl-engine/lib/Camera":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../geometry/support/vector ../../../ViewingMode ./Util".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x){const u=c.getLogger("esri.views.3d.webgl-engine.lib.Camera");c=function(){function D(F=null,G=null,L=null){this._viewUp=d.create();this._viewForward=d.create();this._viewRight=d.create();this._ray=q.create();this._viewport=z.fromValues(0,0,1,1);this._padding=z.fromValues(0,0,0,0);this._fov=55/180*Math.PI;this._nearFar=k.fromValues(1,1E3);this._viewDirty=!0;this._viewMatrix=f.create();this._projectionDirty=!0;this._projectionMatrix=f.create();this._viewProjectionDirty=
!0;this._viewProjectionMatrix=f.create();this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=f.create();this._frustumDirty=!0;this._frustum=v.create();this._fullViewport=z.create();this.pixelRatio=1;this.relativeElevation=0;h.isSome(F)&&e.copy(this._ray.origin,F);this._center=h.isSome(G)?d.clone(G):d.create();this._up=h.isSome(L)?d.clone(L):d.fromValues(0,0,1)}var C=D.prototype;C.depthNDCToWorld=function(F){return 2*this.near*this.far/(this.far+this.near-(2*F-1)*(this.far-this.near))};
C.copyFrom=function(F){e.copy(this._ray.origin,F.eye);e.copy(this._center,F.center);e.copy(this._up,F.up);m.copy(this._viewport,F.viewport);m.copy(this._padding,F.padding);l.copy(this._nearFar,F.nearFar);this._fov=F.fov;this.relativeElevation=F.relativeElevation;this._viewDirty=F._viewDirty;this._viewDirty||(n.copy(this._viewMatrix,F.viewMatrix),e.copy(this._viewRight,F.viewRight),e.copy(this._viewUp,F.viewUp),e.copy(this._viewForward,F.viewForward));F._projectionDirty?this._projectionDirty=!0:(n.copy(this._projectionMatrix,
F.projectionMatrix),this._projectionDirty=!1);this._viewProjectionDirty=!0;this._frustumDirty=F._frustumDirty;this._frustumDirty||(v.copy(this._frustum,F.frustum),this._frustumDirty=!1);F._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(n.copy(this._viewInverseTransposeMatrix,F.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1);m.copy(this._fullViewport,F.fullViewport);this.pixelRatio=F.pixelRatio;return this};C.copyViewFrom=function(F){this.eye=F.eye;
this.center=F.center;this.up=F.up};C.clone=function(){return(new D).copyFrom(this)};C.equals=function(F){return e.exactEquals(this.eye,F.eye)&&e.exactEquals(this._center,F.center)&&e.exactEquals(this._up,F.up)&&m.exactEquals(this._viewport,F.viewport)&&m.exactEquals(this._padding,F.padding)&&l.exactEquals(this._nearFar,F.nearFar)&&this._fov===F.fov&&this.pixelRatio===F.pixelRatio&&this.relativeElevation===F.relativeElevation};C.almostEquals=function(F){if(this.pixelRatio!==F.pixelRatio||.001<=Math.abs(F.fov-
this._fov))return!1;const G=1-1E-10;e.sub(A,F.eye,F.center);e.sub(p,this.eye,this._center);const L=e.dot(A,p),H=e.sqrLen(A),M=e.sqrLen(p);return L*L>=G*H*M&&e.sqrDist(F.eye,this.eye)<2.5E-7*Math.max(H,M)&&.5>m.squaredDistance(F.padding,this._padding)&&.5>m.squaredDistance(F.viewport,this._viewport)};C.computeRenderPixelSizeAt=function(F){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(F))};C.computeRenderPixelSizeAtDist=function(F){return F*this.perRenderPixelRatio};C.computeScreenPixelSizeAt=
function(F){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(F))};C._viewDirectionDistance=function(F){return Math.abs(t.projectPointSignedLength(this.viewForward,e.subtract(A,F,this.eye)))};C.computeScreenPixelSizeAtDist=function(F){return F*this.perScreenPixelRatio};C.computeDistanceFromRadius=function(F,G){return F/Math.tan(Math.min(this.fovX,this.fovY)/(2*(G||1)))};C.getScreenCenter=function(F=w.createScreenPointArray()){F[0]=(this.padding[a.PaddingSide.LEFT]+this.width/2)/
this.pixelRatio;F[1]=(this.padding[a.PaddingSide.TOP]+this.height/2)/this.pixelRatio;return F};C.getRenderCenter=function(F,G=.5,L=.5){F[0]=this.padding[a.PaddingSide.LEFT]+this.width*G;F[1]=this.padding[a.PaddingSide.BOTTOM]+this.height*L;F[2]=.5;return F};C.setGLViewport=function(F){const G=this.viewport,L=this.padding;F.setViewport(G[0]-L[3],G[1]-L[2],G[2]+L[1]+L[3],G[3]+L[0]+L[2])};C.applyProjection=function(F,G,L=!1){F!==E&&e.copy(E,F);E[3]=1;L&&(G[2]=-E[2]);m.transformMat4(E,E,this.projectionMatrix);
e.scale(E,E,1/Math.abs(E[3]));F=this.fullViewport;G[0]=g.lerp(0,F[0]+F[2],.5+.5*E[0]);G[1]=g.lerp(0,F[1]+F[3],.5+.5*E[1]);L||(G[2]=.5*(E[2]+1));return G};C.projectToScreen=function(F,G){this.projectToRenderScreen(F,B);this.renderToScreen(B,G)};C.projectToRenderScreen=function(F,G){E[0]=F[0];E[1]=F[1];E[2]=F[2];E[3]=1;m.transformMat4(E,E,this.viewProjectionMatrix);if(0===E[3])return null;e.scale(E,E,1/Math.abs(E[3]));F=this.fullViewport;"x"in G?(G.x=g.lerp(0,F[0]+F[2],.5+.5*E[0]),G.y=g.lerp(0,F[1]+
F[3],.5+.5*E[1])):(G[0]=g.lerp(0,F[0]+F[2],.5+.5*E[0]),G[1]=g.lerp(0,F[1]+F[3],.5+.5*E[1]),2<G.length&&(G[2]=.5*(E[2]+1)));return G};C.unprojectFromScreen=function(F,G){return this.unprojectFromRenderScreen(this.screenToRender(F,B),G)};C.unprojectFromRenderScreen=function(F,G){n.multiply(y,this.projectionMatrix,this.viewMatrix);if(!n.invert(y,y))return null;const L=this.fullViewport;E[0]=2*(F[0]-L[0])/L[2]-1;E[1]=2*(F[1]-L[1])/L[3]-1;E[2]=2*F[2]-1;E[3]=1;m.transformMat4(E,E,y);if(0===E[3])return null;
G[0]=E[0]/E[3];G[1]=E[1]/E[3];G[2]=E[2]/E[3];return G};C.constrainWindowSize=function(F,G,L,H=L){F*=this.pixelRatio;G*=this.pixelRatio;return[Math.max(F-L/2,0),Math.max(this.fullHeight-G-H/2,0),L- -Math.min(F-L/2,0)- -Math.min(this.fullWidth-F-L/2,0),H- -Math.min(this.fullHeight-G-H/2,0)- -Math.min(G-H/2,0)]};C.computeUp=function(F){F===r.ViewingMode.Global?this._computeUpGlobal():this._computeUpLocal()};C.screenToRender=function(F,G){const L=this.fullHeight-F[1]*this.pixelRatio;G[0]=F[0]*this.pixelRatio;
G[1]=L;return G};C.renderToScreen=function(F,G){const L=(this.fullHeight-F[1])/this.pixelRatio;G[0]=F[0]/this.pixelRatio;G[1]=L};C._computeUpGlobal=function(){e.subtract(A,this.center,this.eye);const F=e.length(this.center);1>F?(e.set(this._up,0,0,1),this._markViewDirty()):Math.abs(e.dot(A,this.center))>.9999*e.length(A)*F||(e.cross(this._up,A,this.center),e.cross(this._up,this._up,A),e.normalize(this._up,this._up),this._markViewDirty())};C._computeUpLocal=function(){e.direction(A,this.eye,this.center);
.9999>=Math.abs(A[2])&&(e.scale(A,A,A[2]),e.set(this._up,-A[0],-A[1],1-A[2]),e.normalize(this._up,this._up),this._markViewDirty())};C._compareAndSetView=function(F,G){"number"===typeof F[0]&&isFinite(F[0])&&"number"===typeof F[1]&&isFinite(F[1])&&"number"===typeof F[2]&&isFinite(F[2])?e.exactEquals(F,G)||(e.copy(G,F),this._markViewDirty()):u.warn("Camera vector contains invalid number, ignoring value")};C._markViewDirty=function(){this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0};C._recomputeFrustum=
function(){this._frustumDirty&&(v.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)};C._ensureViewClean=function(){this._viewDirty&&(n.lookAt(this._viewMatrix,this.eye,this._center,this._up),e.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),e.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),e.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=
!0)};b._createClass(D,[{key:"eye",get:function(){return this._ray.origin},set:function(F){this._compareAndSetView(F,this._ray.origin)}},{key:"center",get:function(){return this._center},set:function(F){this._compareAndSetView(F,this._center)}},{key:"ray",get:function(){e.subtract(this._ray.direction,this.center,this.eye);return this._ray}},{key:"up",get:function(){return this._up},set:function(F){this._compareAndSetView(F,this._up)}},{key:"viewMatrix",get:function(){this._ensureViewClean();return this._viewMatrix},
set:function(F){n.copy(this._viewMatrix,F);this._viewDirty=!1;this._frustumDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=!0}},{key:"viewForward",get:function(){this._ensureViewClean();return this._viewForward}},{key:"viewUp",get:function(){this._ensureViewClean();return this._viewUp}},{key:"viewRight",get:function(){this._ensureViewClean();return this._viewRight}},{key:"nearFar",get:function(){return this._nearFar}},{key:"near",get:function(){return this._nearFar[0]},set:function(F){this._nearFar[0]!==
F&&(this._nearFar[0]=F,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"far",get:function(){return this._nearFar[1]},set:function(F){this._nearFar[1]!==F&&(this._nearFar[1]=F,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"viewport",get:function(){return this._viewport},set:function(F){this.x=F[0];this.y=F[1];this.width=F[2];this.height=F[3]}},{key:"x",get:function(){return this._viewport[0]},set:function(F){F+=this._padding[a.PaddingSide.LEFT];
this._viewport[0]!==F&&(this._viewport[0]=F,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"y",get:function(){return this._viewport[1]},set:function(F){F+=this._padding[a.PaddingSide.BOTTOM];this._viewport[1]!==F&&(this._viewport[1]=F,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"width",get:function(){return this._viewport[2]},set:function(F){this._viewport[2]!==F&&(this._viewport[2]=F,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=
!0)}},{key:"height",get:function(){return this._viewport[3]},set:function(F){this._viewport[3]!==F&&(this._viewport[3]=F,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"fullWidth",get:function(){return this._viewport[2]+this._padding[a.PaddingSide.RIGHT]+this._padding[a.PaddingSide.LEFT]},set:function(F){this.width=F-(this._padding[a.PaddingSide.RIGHT]+this._padding[a.PaddingSide.LEFT])}},{key:"fullHeight",get:function(){return this._viewport[3]+this._padding[a.PaddingSide.TOP]+
this._padding[a.PaddingSide.BOTTOM]},set:function(F){this.height=F-(this._padding[a.PaddingSide.TOP]+this._padding[a.PaddingSide.BOTTOM])}},{key:"fullViewport",get:function(){this._fullViewport[0]=this._viewport[0]-this._padding[a.PaddingSide.LEFT];this._fullViewport[1]=this._viewport[1]-this._padding[a.PaddingSide.BOTTOM];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport}},{key:"aspect",get:function(){return this.width/this.height}},{key:"padding",
get:function(){return this._padding},set:function(F){if(this._padding[a.PaddingSide.TOP]!==F[a.PaddingSide.TOP]||this._padding[a.PaddingSide.RIGHT]!==F[a.PaddingSide.RIGHT]||this._padding[a.PaddingSide.BOTTOM]!==F[a.PaddingSide.BOTTOM]||this._padding[a.PaddingSide.LEFT]!==F[a.PaddingSide.LEFT])this._viewport[0]+=F[a.PaddingSide.LEFT]-this._padding[a.PaddingSide.LEFT],this._viewport[1]+=F[a.PaddingSide.BOTTOM]-this._padding[a.PaddingSide.BOTTOM],this._viewport[2]-=F[a.PaddingSide.RIGHT]+F[a.PaddingSide.LEFT]-
(this._padding[a.PaddingSide.RIGHT]+this._padding[a.PaddingSide.LEFT]),this._viewport[3]-=F[a.PaddingSide.TOP]+F[a.PaddingSide.BOTTOM]-(this._padding[a.PaddingSide.TOP]+this._padding[a.PaddingSide.BOTTOM]),m.copy(this._padding,F),this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0}},{key:"viewProjectionMatrix",get:function(){this._viewProjectionDirty&&(n.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix}},
{key:"projectionMatrix",get:function(){if(this._projectionDirty){const F=this.width,G=this.height,L=this.near*Math.tan(this.fovY/2),H=L*this.aspect;n.frustum(this._projectionMatrix,-H*(1+2*this._padding[a.PaddingSide.LEFT]/F),H*(1+2*this._padding[a.PaddingSide.RIGHT]/F),-L*(1+2*this._padding[a.PaddingSide.BOTTOM]/G),L*(1+2*this._padding[a.PaddingSide.TOP]/G),this.near,this.far);this._projectionDirty=!1}return this._projectionMatrix},set:function(F){n.copy(this._projectionMatrix,F);this._projectionDirty=
!1;this._frustumDirty=this._viewProjectionDirty=!0}},{key:"fov",get:function(){return this._fov},set:function(F){this._fov=F;this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0}},{key:"fovX",get:function(){return x.fovd2fovx(this._fov,this.width,this.height)},set:function(F){this._fov=x.fovx2fovd(F,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0}},{key:"fovY",get:function(){return x.fovd2fovy(this._fov,this.width,this.height)},set:function(F){this._fov=
x.fovy2fovd(F,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0}},{key:"distance",get:function(){return e.distance(this._center,this.eye)}},{key:"frustum",get:function(){this._recomputeFrustum();return this._frustum}},{key:"viewInverseTransposeMatrix",get:function(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)n.invert(this._viewInverseTransposeMatrix,this.viewMatrix),n.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),
this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix}},{key:"perRenderPixelRatio",get:function(){return Math.tan(this.fovX/2)/(this.width/2)}},{key:"perScreenPixelRatio",get:function(){return this.perRenderPixelRatio*this.pixelRatio}},{key:"aboveGround",get:function(){return this.relativeElevation&&0<=this.relativeElevation}}]);return D}();const E=z.create(),y=f.create(),A=d.create(),p=d.create(),B=w.createRenderScreenPointArray3();a.PaddingSide=void 0;(function(D){D[D.TOP=
0]="TOP";D[D.RIGHT=1]="RIGHT";D[D.BOTTOM=2]="BOTTOM";D[D.LEFT=3]="LEFT"})(a.PaddingSide||(a.PaddingSide={}));a.default=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/frustum":function(){define("exports ../../core/ObjectStack ../../chunks/mat4 ../../chunks/vec3 ../../chunks/vec3f64 ../../chunks/vec4 ../../chunks/vec4f64 ./clipRay ./plane ./vectorStacks".split(" "),function(a,b,c,g,h,w,n,f,l,k){function e(){return[h.create(),h.create(),h.create(),h.create(),h.create(),
h.create(),h.create(),h.create()]}function d(r,x){l.fromPoints(x[a.PointIndex.FAR_BOTTOM_LEFT],x[a.PointIndex.NEAR_BOTTOM_LEFT],x[a.PointIndex.NEAR_TOP_LEFT],r[a.PlaneIndex.LEFT]);l.fromPoints(x[a.PointIndex.NEAR_BOTTOM_RIGHT],x[a.PointIndex.FAR_BOTTOM_RIGHT],x[a.PointIndex.FAR_TOP_RIGHT],r[a.PlaneIndex.RIGHT]);l.fromPoints(x[a.PointIndex.FAR_BOTTOM_LEFT],x[a.PointIndex.FAR_BOTTOM_RIGHT],x[a.PointIndex.NEAR_BOTTOM_RIGHT],r[a.PlaneIndex.BOTTOM]);l.fromPoints(x[a.PointIndex.NEAR_TOP_LEFT],x[a.PointIndex.NEAR_TOP_RIGHT],
x[a.PointIndex.FAR_TOP_RIGHT],r[a.PlaneIndex.TOP]);l.fromPoints(x[a.PointIndex.NEAR_BOTTOM_LEFT],x[a.PointIndex.NEAR_BOTTOM_RIGHT],x[a.PointIndex.NEAR_TOP_RIGHT],r[a.PlaneIndex.NEAR]);l.fromPoints(x[a.PointIndex.FAR_BOTTOM_RIGHT],x[a.PointIndex.FAR_BOTTOM_LEFT],x[a.PointIndex.FAR_TOP_LEFT],r[a.PlaneIndex.FAR])}function m(r,x){for(let u=0;u<a.NumPlanes.NUM;u++)if(!l.clip(r[u],x))return!1;return!0}a.PlaneIndex=void 0;(function(r){r[r.LEFT=0]="LEFT";r[r.RIGHT=1]="RIGHT";r[r.BOTTOM=2]="BOTTOM";r[r.TOP=
3]="TOP";r[r.NEAR=4]="NEAR";r[r.FAR=5]="FAR"})(a.PlaneIndex||(a.PlaneIndex={}));a.PointIndex=void 0;(function(r){r[r.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT";r[r.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT";r[r.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT";r[r.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT";r[r.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT";r[r.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT";r[r.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT";r[r.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"})(a.PointIndex||(a.PointIndex={}));const z={bottom:[a.PointIndex.FAR_BOTTOM_RIGHT,
a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.NEAR_BOTTOM_LEFT,a.PointIndex.FAR_BOTTOM_LEFT],near:[a.PointIndex.NEAR_BOTTOM_LEFT,a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.NEAR_TOP_RIGHT,a.PointIndex.NEAR_TOP_LEFT],far:[a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.FAR_BOTTOM_LEFT,a.PointIndex.FAR_TOP_LEFT,a.PointIndex.FAR_TOP_RIGHT],right:[a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.FAR_TOP_RIGHT,a.PointIndex.NEAR_TOP_RIGHT],left:[a.PointIndex.FAR_BOTTOM_LEFT,a.PointIndex.NEAR_BOTTOM_LEFT,
a.PointIndex.NEAR_TOP_LEFT,a.PointIndex.FAR_TOP_LEFT],top:[a.PointIndex.FAR_TOP_LEFT,a.PointIndex.NEAR_TOP_LEFT,a.PointIndex.NEAR_TOP_RIGHT,a.PointIndex.FAR_TOP_RIGHT]};a.NumPlanes=void 0;(function(r){r[r.NUM=6]="NUM"})(a.NumPlanes||(a.NumPlanes={}));a.NumPoints=void 0;(function(r){r[r.NUM=8]="NUM"})(a.NumPoints||(a.NumPoints={}));const v=[n.fromValues(-1,-1,-1,1),n.fromValues(1,-1,-1,1),n.fromValues(1,1,-1,1),n.fromValues(-1,1,-1,1),n.fromValues(-1,-1,1,1),n.fromValues(1,-1,1,1),n.fromValues(1,1,
1,1),n.fromValues(-1,1,1,1)],q=new b.ObjectStack(f.create),t=e();a.computePlanes=d;a.copy=function(r,x){for(let u=0;u<a.NumPlanes.NUM;u++)l.copy(r[u],x[u])};a.create=function(r){return r?[l.create(r[0]),l.create(r[1]),l.create(r[2]),l.create(r[3]),l.create(r[4]),l.create(r[5])]:[l.create(),l.create(),l.create(),l.create(),l.create(),l.create()]};a.createPoints=e;a.fromMatrix=function(r,x,u,E=t){r=c.multiply(k.sm4d.get(),x,r);c.invert(r,r);for(x=0;x<a.NumPoints.NUM;++x){const y=w.transformMat4(k.sv4d.get(),
v[x],r);g.set(E[x],y[0]/y[3],y[1]/y[3],y[2]/y[3])}d(u,E)};a.intersectClipRay=function(r,x){for(let u=0;u<a.NumPlanes.NUM;u++)if(!l.clipInfinite(r[u],x))return!1;return!0};a.intersectsAABB=function(r,x){for(let u=0;u<a.NumPlanes.NUM;u++)if(l.isAABBFullyInside(r[u],x))return!1;return!0};a.intersectsLineSegment=function(r,x,u){return m(r,f.fromLineSegmentAndDirection(x,u,q.get()))};a.intersectsPoint=function(r,x){for(let u=0;u<a.NumPlanes.NUM;u++)if(0<l.signedDistance(r[u],x))return!1;return!0};a.intersectsRay=
function(r,x){return m(r,f.fromRay(x,q.get()))};a.intersectsSphere=function(r,x){for(let u=0;u<a.NumPlanes.NUM;u++){const E=r[u];if(E[0]*x[0]+E[1]*x[1]+E[2]*x[2]+E[3]>=x[3])return!1}return!0};a.planePointIndices=z;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/clipRay":function(){define(["exports","../../core/ObjectStack","../../chunks/vec3","./ray","./vectorStacks"],function(a,b,c,g,h){function w(e){return e?{ray:g.create(e.ray),c0:e.c0,c1:e.c1}:{ray:g.create(),c0:0,c1:Number.MAX_VALUE}}
function n(e,d,m,z=w()){g.copy(e,z.ray);z.c0=d;z.c1=m;return z}function f(e,d,m=w()){const z=c.length(e.vector);g.fromValues(e.origin,d,m.ray);m.c0=0;m.c1=z;return m}function l(e,d,m){return c.add(m,e.ray.origin,c.scale(m,e.ray.direction,d))}const k=new b.ObjectStack(()=>({c0:0,c1:0,ray:null}));a.copy=function(e,d=w()){return n(e.ray,e.c0,e.c1,d)};a.create=w;a.fromLineSegment=function(e,d=w()){const m=c.normalize(h.sv3d.get(),e.vector);return f(e,m,d)};a.fromLineSegmentAndDirection=f;a.fromRay=function(e,
d=w()){g.copy(e,d.ray);d.c0=0;d.c1=Number.MAX_VALUE;return d};a.fromValues=n;a.getAt=l;a.getEnd=function(e,d){return l(e,e.c1,d)};a.getStart=function(e,d){return l(e,e.c0,d)};a.wrap=function(e,d,m){const z=k.get();z.ray=e;z.c0=d;z.c1=m;return z};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/Animation":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/time ../easing ./Definition ./Settings ./apex/Path".split(" "),function(a,
b,c,g,h,w,n){const f={zoom:0,pan:0,rotate:0};let l=function(){function k(d){this.createCamera=d;this._time=c.Milliseconds(0);this.definition=new h.Definition(d);this.path=new n.Path}var e=k.prototype;e.update=function(d,m,z){this.definition.update(d,m,z);this.path.update(this.definition,z);this._time=this._applyTimeSettings(c.millisecondsFromSeconds(this.path.time),z);this._easing=z.easing?z.easing:1E3<=this._time?g.inOutCoastQuad:g.outExpo};e.cameraAt=function(d,m){m=m||this.createCamera();d=Math.min(Math.max(0,
d),1);d=this._normalizedEasing(d);d=this.path.interpolateComponentsAt(d,f);m.interpolate(this.definition.source,this.definition.target,d);return m};e._normalizedEasing=function(d){const m=this._easing(0,this._time),z=this._easing(1,this._time);return(this._easing(d,this._time)-m)/(z-m)};e._applyTimeSettings=function(d,m){const z=null!=m.speedFactor?m.speedFactor:1;null!=m.duration?d=m.duration:null!=m.speedFactor&&(d=c.Milliseconds(d/z));return c.Milliseconds(Math.min(Math.max(null!=m.minDuration?
m.minDuration:w.defaultSettings.minDuration/z,d),null!=m.maxDuration?m.maxDuration:w.defaultSettings.maxDuration/z))};b._createClass(k,[{key:"time",get:function(){return this._time}}]);return k}();a.Animation=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/Definition":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./Settings"],function(a,b,c){let g=function(){function h(n){this.createCamera=n;this.compared={sourceZoom:0,targetZoom:0,
pan:0,rotate:0};this.settings={desiredScreenFlow:c.defaultSettings.desiredScreenFlow};this.source=n();this.target=n()}var w=h.prototype;w.clone=function(){const n=new h(this.createCamera);n.copyFrom(this);return n};w.copyFrom=function(n){this.update(n.source,n.target,n.settings)};w.update=function(n,f,l){this.source!==n&&this.source.copyFrom(n);this.target!==f&&this.target.copyFrom(f);this.compared=this.source.compareTo(this.target,this.compared);this.settings.desiredScreenFlow=null!=l.desiredScreenFlow?
l.desiredScreenFlow:c.defaultSettings.desiredScreenFlow;this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size;this.halfWindowSize=this.target.size/2};w.halfWindowPanAtZoom=function(n){n=this.target.pixelsPerPanAtZoom(n);return this.halfWindowSize/n};b._createClass(h,[{key:"hasZoom",get:function(){return 1E-5<Math.abs(this.compared.sourceZoom-this.compared.targetZoom)}},{key:"hasPan",get:function(){return 1E-9<this.compared.pan}},{key:"hasRotate",get:function(){return 1E-9<this.compared.rotate}}]);
return h}();a.Definition=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/Settings":function(){define(["exports","../../../core/time"],function(a,b){b={desiredScreenFlow:2,minDuration:b.Milliseconds(500),maxDuration:b.Milliseconds(8E3)};a.defaultSettings=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/apex/Path":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../easing ../Path ../Segment ./planning".split(" "),
function(a,b,c,g,h,w){g=function(n){function f(k,e){var d=n.call(this)||this;d._preallocSegments=[new h.Segment,new h.Segment,new h.Segment];d.update(k,e);return d}b._inheritsLoose(f,n);var l=f.prototype;l.update=function(k,e){if(k){this.definition?this.definition.copyFrom(k):this.definition=k.clone();var d=null;e&&e.apex&&(d=w.optimalDistance(k,e.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==d?this._updateWithoutApex():this._updateWithApex(d,e.apex)}};l.segmentInterpolateComponentsAt=
function(k,e,d){d=k.interpolateComponentsAt(e,d);k===this._ascensionSegment?d.zoom=c.outQuad(d.zoom):k===this._descensionSegment&&(d.zoom=c.inQuad(d.zoom));return d};l._updateWithApex=function(k,e){const [d,m,z]=this._preallocSegments,v=null!=e.ascensionFactor?e.ascensionFactor:.5;e=Math.min(1-v,null!=e.ascensionFactor?e.descensionFactor:.5);const q=1-v-e;d.definition?d.definition.copyFrom(this.definition):d.definition=this.definition.clone();d.definition.compared.targetZoom=k;d.definition.compared.pan=
this.definition.compared.pan*v;d.definition.compared.rotate=this.definition.compared.rotate*v;d.update();this._ascensionSegment=d;this.segments.push(d);0<q&&(m.definition?m.definition.copyFrom(this.definition):m.definition=this.definition.clone(),m.definition.copyFrom(this.definition),m.definition.compared.sourceZoom=k,m.definition.compared.targetZoom=k,m.definition.compared.pan=this.definition.compared.pan*q,m.definition.compared.rotate=this.definition.compared.rotate*q,m.update(),this.segments.push(m));
z.definition?z.definition.copyFrom(this.definition):z.definition=this.definition.clone();z.definition.compared.sourceZoom=k;z.definition.compared.pan=this.definition.compared.pan*e;z.definition.compared.rotate=this.definition.compared.rotate*e;z.update();this._descensionSegment=z;this.segments.push(z)};l._updateWithoutApex=function(){const [k]=this._preallocSegments;k.update(this.definition);this.segments.push(k)};return f}(g.Path);a.Path=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/Path":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../core/time"],function(a,b,c){let g=function(){function h(){this.segments=[]}var w=h.prototype;w.interpolateComponentsAt=function(n,f){n=Math.min(Math.max(n,0),1);n*=this.time;var l=0,k=0;const e=this.definition;for(let d=0;d<this.segments.length;d++){const m=this.segments[d],z=m.definition;if(n<=m.time||d===this.segments.length-1)return f=this.segmentInterpolateComponentsAt(m,n/m.time,f),f.pan=e.hasPan?(l+z.compared.pan*f.pan)/e.compared.pan:1,
f.rotate=e.hasRotate?(k+z.compared.rotate*f.rotate)/e.compared.rotate:1,n=f.zoom*(z.compared.targetZoom-z.compared.sourceZoom)+z.compared.sourceZoom,l=this.segments[0].definition.compared.sourceZoom,k=this.segments[this.segments.length-1].definition.compared.targetZoom,f.zoom=e.hasZoom?(n-l)/(k-l):1,f;n-=m.time;l+=z.compared.pan;k+=z.compared.rotate}};w.segmentInterpolateComponentsAt=function(n,f,l){return n.interpolateComponentsAt(f,l)};b._createClass(h,[{key:"time",get:function(){return this.segments.reduce((n,
f)=>c.Seconds(n+f.time),c.Seconds(0))}}]);return h}();a.Path=g;a.default=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/Segment":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/time"],function(a,b,c){let g=function(){function h(n){n&&this.update(n)}var w=h.prototype;w.update=function(n){n&&(this.definition?this.definition.copyFrom(n):this.definition=n.clone());this._updatePrecomputedVariables();this._updatePixelFlow()};
w._updatePrecomputedVariables=function(){var n=this.definition;const f=n.compared,l=f.sourceZoom,k=f.targetZoom;this._zoomSign=l>k?1:-1;this._panPixelsAtSource=f.pan*n.source.pixelsPerPanAtZoom(l);n=(n.source.pixelsPerRotateAtZoom(l)+n.target.pixelsPerRotateAtZoom(k))/2;this._rotatePixels=f.rotate*n};w._updatePixelFlow=function(){var n=this.definition.compared.sourceZoom,f=this.definition.compared.targetZoom;const {hasZoom:l,hasPan:k,hasRotate:e}=this.definition;var d=0,m=0;l&&(k&&(d=(f/n-1)/(-1/
(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),e&&(m=Math.log(n/f)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._rotatePixels));this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;n=this.definition.desiredPixelFlow;l&&k&&e?(f=d+m+d*m,this._zoomPixelFlow=d*m/f*n,this._panPixelFlow=m/f*n,this._rotatePixelFlow=d/f*n):l&&k?(m=1+d,this._zoomPixelFlow=d/m*n,this._panPixelFlow=1/m*n):l&&e?(d=1+m,this._zoomPixelFlow=m/d*n,this._rotatePixelFlow=
1/d*n):k&&e?(d=this._panPixelsAtSource/this._rotatePixels,m=1+d,this._panPixelFlow=d/m*n,this._rotatePixelFlow=1/m*n):k?this._panPixelFlow=n:l?this._zoomPixelFlow=n:e&&(this._rotatePixelFlow=n);this._time=e?this.rotateTime:l?this.zoomTime:k?this.panTime:c.Seconds(0)};w._interpolateComponentsZoom=function(n){if(0===n||1===n)return n;if(this.definition.hasZoom){const f=this.definition.compared.sourceZoom,l=this.definition.compared.targetZoom;return(f*(f/l)**-n-f)/(l-f)}return n};w._interpolateComponentsPan=
function(n){if(0===n||1===n)return n;if(this.definition.hasPan&&this.definition.hasZoom){const f=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*this._panPixelFlow*(2**(f*n*this._time)-1)/(f*Math.LN2)}return n};w._interpolateComponentsRotate=function(n){return n};w.interpolateComponentsAt=function(n,f){n=Math.min(Math.max(n,0),1);const l=this._interpolateComponentsZoom(n),k=this._interpolateComponentsPan(n);n=this._interpolateComponentsRotate(n);
f?(f.zoom=l,f.pan=k,f.rotate=n):f={zoom:l,pan:k,rotate:n};return f};b._createClass(h,[{key:"time",get:function(){return this._time}},{key:"rotateTime",get:function(){return this.definition.hasRotate?c.Seconds(this._rotatePixels/this._rotatePixelFlow):c.Seconds(0)}},{key:"zoomTime",get:function(){return this.definition.hasZoom?c.Seconds(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._zoomPixelFlow):c.Seconds(0)}},
{key:"panTime",get:function(){if(this.definition.hasPan){if(this.definition.hasZoom){const n=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2;return c.Seconds(Math.log(this._zoomPixelFlow/this._panPixelFlow*this._panPixelsAtSource*n+1)/(n*this._zoomPixelFlow))}return c.Seconds(this._panPixelsAtSource/this._panPixelFlow)}return c.Seconds(0)}}]);return h}();a.Segment=g;a.default=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["exports",
"./functions"],function(a,b){function c(g,h){const w=Math.max(g.compared.sourceZoom,g.compared.targetZoom);g=g.source.zoomAtPixelsPerPan(g.desiredPixelFlow/g.compared.pan)/2;return g<w?null!=h.maximumDistance?w+(h.maximumDistance-w)/2:1.5*w:h.maximumDistance?Math.min(h.maximumDistance,g):g}a.optimalDistance=function(g,h){let w=c(g,h);const n={ascensionFactor:null!=h.ascensionFactor?h.ascensionFactor:.5,descensionFactor:null!=h.descensionFactor?h.descensionFactor:.5};var f=0===n.ascensionFactor,l=
0===n.descensionFactor;const k=f?b.tAscensionZoomOnly:b.tAscensionZoomPan,e=f?b.dtAscensionZoomOnly:b.dtAscensionZoomPan,d=f?b.ddtAscensionZoomOnly:b.ddtAscensionZoomPan,m=l?b.tDescensionZoomOnly:b.tDescensionZoomPan,z=l?b.dtDescensionZoomOnly:b.dtDescensionZoomPan,v=l?b.ddtDescensionZoomOnly:b.ddtDescensionZoomPan;f=y=>k(g,y,n)+b.tPanion(g,y,n)+m(g,y,n);l=y=>e(g,y,n)+b.dtPanion(g,y,n)+z(g,y,n);const q=y=>d(g,y,n)+b.ddtPanion(g,y,n)+v(g,y,n);let t=f(w);const r=b.tBaseLine(g),x=h.maximumIterations||
20,u=null!=h.maximumDistance?h.maximumDistance:Infinity;for(h=0;h<x;h++){var E=(l(w)+1E-6)/q(w);if(isNaN(E)||w>=u&&0>E){if(!isFinite(u))return null;w=u;t=f(w);break}w-=E;if(w<g.compared.sourceZoom||w<g.compared.targetZoom)return null;E=f(w);if(.005>=Math.abs(E-t)/t)break;t=E}return t>.7*r||w<g.compared.sourceZoom||w<g.compared.targetZoom?null:w};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["exports"],function(a){a.ddtAscensionZoomOnly=
function(b,c){return-b.halfWindowSize/(c*c*b.desiredPixelFlow*Math.LN2)};a.ddtAscensionZoomPan=function(b,c,g){const h=c-b.compared.sourceZoom,w=1/h,n=1/c,f=Math.log(b.compared.sourceZoom*n);g=(g.ascensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(h))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*w*(-2*w*n*g+2*w*f+2*n-2*f*g/(h*h)-g/(c*c))/(b.desiredPixelFlow*Math.LN2)};a.ddtDescensionZoomOnly=function(b,c){return-b.halfWindowSize/(c*c*b.desiredPixelFlow*Math.LN2)};a.ddtDescensionZoomPan=
function(b,c,g){const h=c-b.compared.targetZoom,w=1/h,n=1/c,f=Math.log(c/b.compared.targetZoom);g=(b.halfWindowPanAtZoom(c)+g.descensionFactor*Math.LN2*b.compared.pan-b.halfWindowPanAtZoom(b.compared.targetZoom))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*w*(-2*w*n*g-2*w*f+2*n+2*f*g/(h*h)-g/(c*c))/(b.desiredPixelFlow*Math.LN2)};a.ddtPanion=function(b,c,g){return-2*b.compared.pan*b.halfWindowSize*(g.ascensionFactor+g.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(c*c*c))};a.dtAscensionZoomOnly=
function(b,c){return b.halfWindowSize/(c*b.desiredPixelFlow*Math.LN2)};a.dtAscensionZoomPan=function(b,c,g){const h=1/c,w=Math.log(b.compared.sourceZoom*h),n=1/b.desiredPixelFlow,f=1/Math.LN2;c-=b.compared.sourceZoom;const l=1/c;g=(g.ascensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(c))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*h*n*f*l*g-b.halfWindowSize*w*n*f*l+b.halfWindowSize*w*n*f*g/(c*c)};a.dtDescensionZoomOnly=function(b,c){return b.halfWindowSize/(c*b.desiredPixelFlow*Math.LN2)};
a.dtDescensionZoomPan=function(b,c,g){const h=Math.log(c/b.compared.targetZoom),w=1/b.desiredPixelFlow,n=1/Math.LN2,f=-c+b.compared.targetZoom,l=1/f;g=(-b.halfWindowPanAtZoom(c)-g.descensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(b.compared.targetZoom))/b.halfWindowPanAtZoom(1);return-b.halfWindowSize*h*w*n*l+b.halfWindowSize*h*w*n*g/(f*f)+b.halfWindowSize*w*n*l*g/c};a.dtPanion=function(b,c,g){return b.compared.pan*b.halfWindowSize*(g.ascensionFactor+g.descensionFactor-1)/(b.desiredPixelFlow*
b.halfWindowPanAtZoom(c*c))};a.tAscensionZoomOnly=function(b,c){return-b.halfWindowSize*Math.log(b.compared.sourceZoom/c)/(b.desiredPixelFlow*Math.LN2)};a.tAscensionZoomPan=function(b,c,g){const h=b.halfWindowPanAtZoom(c-b.compared.sourceZoom);return-b.halfWindowSize*(g.ascensionFactor*Math.LN2*b.compared.pan+h)*Math.log(b.compared.sourceZoom/c)/(b.desiredPixelFlow*Math.LN2*h)};a.tBaseLine=function(b){const c=Math.LN2*b.compared.pan,g=b.halfWindowPanAtZoom(b.compared.sourceZoom-b.compared.targetZoom),
h=b.halfWindowSize*Math.log(b.compared.sourceZoom/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2*g);return b.compared.sourceZoom<=b.compared.targetZoom?h*(c-g):h*(c+g)};a.tDescensionZoomOnly=function(b,c){return b.halfWindowSize*Math.log(c/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2)};a.tDescensionZoomPan=function(b,c,g){return b.halfWindowSize*(-b.halfWindowPanAtZoom(c)-g.descensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(b.compared.targetZoom))*Math.log(c/b.compared.targetZoom)/
(b.desiredPixelFlow*Math.LN2*b.halfWindowPanAtZoom(-c+b.compared.targetZoom))};a.tPanion=function(b,c,g){return-b.compared.pan*b.halfWindowSize*(g.ascensionFactor+g.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(c))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/AnimationController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/set ../../../../core/accessorSupport/decorators/subclass ../../../ViewAnimation ./CameraController".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m){a.AnimationController=function(z){function v(){return z.apply(this,arguments)||this}b._inheritsLoose(v,z);var q=v.prototype;q.onControllerStart=function(){this.state=m.State.Running;g.isSome(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())};q.updateStateFromViewAnimation=function(){!g.isSome(this.viewAnimation)||this.state!==m.State.Ready&&this.state!==m.State.Running||(this.viewAnimation.state===
d.State.FINISHED?this.finish():this.viewAnimation.state===d.State.STOPPED&&(this.state=m.State.Stopped))};q.onControllerEnd=function(){g.isSome(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===m.State.Finished?this.viewAnimation.finish():this.state===m.State.Stopped&&this.viewAnimation.stop());this._asyncResult&&(this.state===m.State.Finished?this._asyncResult.resolve():this._asyncResult.reject(h.createAbortError()))};q.finish=function(){this.finishController()};b._createClass(v,[{key:"canStop",
get:function(){return!0}},{key:"asyncResult",get:function(){return this._asyncResult},set:function(t){this._asyncResult&&(this._asyncResult.reject(h.createAbortError()),this._asyncResult=null);this.state===m.State.Finished||this.state===m.State.Stopped?this.state===m.State.Finished?t.resolve():t.reject(h.createAbortError()):this._asyncResult=t}}]);return v}(m.CameraController);a.AnimationController=c.__decorate([e.subclass("esri.views.3d.state.controllers.AnimationController")],a.AnimationController);
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/CameraController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,g,h,w,n,f,l){a.State=void 0;(function(k){k.Ready=
"ready";k.Rejected="rejected";k.Running="running";k.Stopped="stopped";k.Finished="finished"})(a.State||(a.State={}));a.CameraController=function(k){function e(){var m=k.apply(this,arguments)||this;m.state=a.State.Ready;return m}b._inheritsLoose(e,k);var d=e.prototype;d.stopController=function(){return this.canStop?(this.state=a.State.Stopped,!0):!1};d.finishController=function(){this.state=a.State.Finished};b._createClass(e,[{key:"active",get:function(){return this.state===a.State.Running}},{key:"isInteractive",
get:function(){return!1}},{key:"canStop",get:function(){return!1}},{key:"steppingFinished",get:function(){return!1}}]);return e}(g);c.__decorate([h.property({readOnly:!0})],a.CameraController.prototype,"active",null);c.__decorate([h.property()],a.CameraController.prototype,"state",void 0);a.CameraController=c.__decorate([l.subclass("esri.views.3d.state.controllers.CameraController")],a.CameraController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/utils/navigationUtils":function(){define("exports ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/axisAngle ../../../../geometry/support/coordinateSystem ../../../../geometry/support/plane ../../../../chunks/sphere ../../../../geometry/support/vector ../../../../geometry/support/vectorStacks ../../support/mathUtils ../../support/geometryUtils/ray ../../support/geometryUtils/sphere ../../webgl-engine/lib/Camera".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u){function E(qa,sa,ma){ma=h.fromRotation(q.sm4d.get(),ma[3],e.axis(ma));l.subtract(ha,qa.eye,sa);l.transformMat4(ha,ha,ma);qa.eye=l.add(ha,ha,sa);l.subtract(ha,qa.center,sa);l.transformMat4(ha,ha,ma);qa.center=l.add(ha,ha,sa);qa.up=l.transformMat4(ha,qa.up,ma)}function y(qa,sa){l.set(sa,0,0,0);for(const ma of qa)l.add(sa,sa,ma);l.scale(sa,sa,1/qa.length)}function A(qa,sa,ma,ra){return Math.sin(qa/l.length(sa))*(ma+ra.radius)}function p(qa,sa,ma,ra){ma=
r.fromScreenAtEye(sa,ma,ua);if(c.isNone(ma))return!1;z.closestPointOnSilhouette(qa,ma,N);return z.intersectRay(qa,ma,ra)?l.squaredDistance(N,ma.origin)<l.squaredDistance(ra,ma.origin)?(l.copy(ra,N),!1):!0:(l.subtract(R,sa.eye,sa.center),l.normalize(R,R),m.fromNormalAndOffset(R,-l.dot(l.normalize(R,R),N),S),m.intersectRay(S,ma,ra),!1)}function B(qa,sa,ma,ra,va,Ia){l.cross(xa,qa,sa);l.subtract(na,qa,sa);l.length(qa)<=va||!ra.aboveGround?(l.cross(ma,na,ra.eye),qa=l.dot(qa,sa)/(l.length(qa)*l.length(sa)),
Ia=Math.cos(b.clamp(t.cyclicalPI.normalize(b.deg2rad(Ia)),0,J)),sa=-b.acosClamped(qa)-Math.max(0,l.length(sa)-va)/(Ia*va)):(l.subtract(T,ra.eye,ra.center),l.cross(ma,na,T),sa=-l.length(na)/va);l.normalize(ma,ma);l.scale(ma,ma,l.length(xa));return sa}function D(qa,sa,ma,ra){ra=Math.cos(b.clamp(t.cyclicalPI.normalize(b.deg2rad(ra)),0,J));sa=sa>ma?-(sa-ma)/(ra*ma):sa<-ma?Math.PI-(sa+ma)/(ra*ma):b.acosClamped(sa/ma);return((qa>ma?-(qa-ma)/(ra*ma):qa<-ma?Math.PI-(qa+ma)/(ra*ma):b.acosClamped(qa/ma))-sa)*
ma}function C(qa,sa,ma,ra,va,Ia,Ja,Ha,Ta,db){Ta=D(qa[2],sa[2],Ja[3],Ta);sa=db?D(qa[0],sa[0],Ja[3],180):sa[0]-qa[0];qa=Math.sin(Ha)*sa-Math.cos(Ha)*Ta;Ha=Math.cos(Ha)*sa+Math.sin(Ha)*Ta;l.normalize(ha,va);va=db?qa/Math.sqrt(Math.abs(Ja[3]**2-l.dot(ma,ha)**2)):qa/Ja[3];ma=Ha/Math.sqrt(Math.abs(Ja[3]**2-l.dot(ma,ra)**2));n.set(Ia,va,ma)}function F(qa,sa,ma,ra,va,Ia,Ja,Ha,Ta,db){l.cross(xa,qa,sa);d.coordinateSystemFromOneAxisAndNormalVector(Ia.up,Ia.eye,aa,da,Y);d.coordinateSystemFromOneAxisAndNormalVector([0,
0,1],Ia.eye,V,W,U);l.copy(ma,W);l.copy(ra,V);l.normalize(ma,ma);l.scale(ma,ma,l.length(xa));d.vectorCoordinates(qa,l.normalize(da,da),l.normalize(Y,Y),l.normalize(aa,aa),ea);d.vectorCoordinates(sa,da,Y,aa,ja);C(ea,ja,qa,V,W,va,Ja,Ha,Ta,db)}function G(qa,sa,ma,ra,va,Ia,Ja){h.fromRotation(ca,va,ra);h.fromRotation(fa,Ja,Ia);h.multiply(ba,ca,fa);l.subtract(sa,qa,ma);l.transformMat4(sa,sa,ba);l.add(sa,sa,ma)}function L(qa,sa,ma,ra,va,Ia){h.fromRotation(ca,ra,ma);h.fromRotation(fa,Ia,va);h.multiply(ba,
ca,fa);l.subtract(ha,qa.eye,sa);l.transformMat4(ha,ha,ba);qa.eye=l.add(ha,ha,sa);l.subtract(ha,qa.center,sa);l.transformMat4(ha,ha,ba);qa.center=l.add(ha,ha,sa);l.subtract(ha,qa.up,sa);l.transformMat4(ha,ha,ba);qa.up=l.add(ha,ha,sa)}function H(qa,sa,ma,ra,va,Ia,Ja=Q.Pole,Ha=Q.Angle){qa=Math.abs(qa[2])<ma*Ja||Math.abs(sa)>ma;return(Math.abs(ra)>Math.PI-Ha||Math.abs(ra)<Ha)&&qa&&Ia.aboveGround&&va<Q.Tilt?!0:!1}function M(qa,sa,ma,ra,va,Ia){Ia?(e.fromPoints(ma,ra,ia),E(sa,qa,ia)):(ma=B(ma,ra,Da,sa,qa[3],
va),E(sa,qa,e.wrapAxisAngle(Da,ma)))}function K(qa,sa,ma,ra,va,Ia,Ja){const Ha=Ja?20:1;l.copy(Z,ra);pa.copyFrom(sa);let Ta;for(let db=0;db<Ha&&1E-12<l.squaredDistance(ma,Z);db++)if(ra=l.squaredDistance(ma,Z),F(ma,Z,W,V,la,pa,qa,va,Ia,Ja),L(pa,qa,V,la[1],W,la[0]),G(Z,Z,qa,V,la[1],W,la[0]),Ta=l.squaredDistance(ma,Z),Ta<ra||0===db)sa.copyFrom(pa);else break}const I=g.createScreenPointArray();a.NavigationMode=void 0;(function(qa){qa[qa.Vertical=0]="Vertical";qa[qa.Horizontal=1]="Horizontal"})(a.NavigationMode||
(a.NavigationMode={}));const O={Elevation:3E4,Angle:b.deg2rad(6)},Q={Pole:.95,Angle:b.deg2rad(18),Tilt:45},J=b.deg2rad(80),P=k.create(),N=k.create(),R=k.create(),S=m.create(),T=k.create(),V=k.create(),W=k.create(),U=k.create(),aa=k.create(),da=k.create(),Y=k.create(),ea=k.create(),ja=k.create(),la=f.create(),ia=e.create(),ca=w.create(),fa=w.create(),ba=w.create(),Z=k.create(),ha=k.create(),na=k.create(),pa=new u.default,xa=k.create(),Da=k.create(),ua={origin:k.create(),direction:k.create()},Fa={origin:k.create(),
direction:k.create()};a.DISTANCE_CLAMP_VALUES=[1,3E8];a.PIVOT_DISTANCE_MODIFIER=30;a.PreservingHeadingThreshold=Q;a.SCREEN_PIXEL_AREA=70;a.TiltThresholdPanningSpeed=J;a.VerticalPanTresholds=O;a.applyPanPlanar=function(qa,sa,ma){l.subtract(P,ma,sa);qa.eye=l.subtract(ha,qa.eye,P);qa.center=l.subtract(ha,qa.center,P)};a.applyPanSphericalDirectRotation=M;a.applyPanSphericalPreserveHeading=K;a.applyRotation=E;a.applyRotationWithTwoAxes=L;a.applyZoomOnSphere=function(qa,sa,ma){sa.getScreenCenter(I);x.intersectScreen(qa,
sa,I,ha)&&(sa.center=ha);qa=sa.distance;ma*=qa;1E-6>Math.abs(qa-ma)||(ma=l.scale(q.sv3d.get(),sa.viewForward,ma),sa.eye=l.subtract(ha,sa.center,ma))};a.applyZoomToPoint=function(qa,sa,ma,ra){const va=q.sv3d.get();ma=1-ma;l.subtract(va,sa,qa.eye);const Ia=l.length(va);let Ja=Ia*(1-ma);0<=ma&&Ja<ra&&(Ja=ra,ma=-(Ja-Ia)/Ia);1E-6>Math.abs(Ia-Ja)||(l.scale(va,va,ma),qa.eye=l.add(ha,qa.eye,va),qa.center=l.lerp(ha,qa.center,sa,ma))};a.centroid=y;a.centroidOnSphere=function(qa,sa,ma){y(sa,ma);l.normalize(ma,
ma);l.scale(ma,ma,qa)};a.decideNavigationMode=function(qa,sa,ma,ra){if(l.length(qa.eye)-ra.radius>O.Elevation)return a.NavigationMode.Horizontal;if(!ma)return a.NavigationMode.Vertical;r.fromScreenAtEye(qa,sa,Fa);return-Math.sign(qa.relativeElevation)*(.5*Math.PI+v.angle(qa.eye,Fa.direction))<O.Angle?a.NavigationMode.Vertical:a.NavigationMode.Horizontal};a.intersectPlaneFromScreenPoint=function(qa,sa,ma,ra){return m.intersectRay(qa,r.fromScreen(sa,ma,ua),ra)};a.intersectPlaneFromScreenPointAtEye=
function(qa,sa,ma,ra){return m.intersectRay(qa,r.fromScreenAtEye(sa,ma,ua),ra)};a.lengthFromPoints=D;a.normalizeCoordinate=function(qa,sa,ma){ma[0]=sa[0]/(qa.fullWidth/qa.pixelRatio);ma[1]=sa[1]/(qa.fullHeight/qa.pixelRatio);return ma};a.normalizeRotationDelta=function(qa){for(;qa>Math.PI;)qa-=2*Math.PI;for(;qa<-Math.PI;)qa+=2*Math.PI;return qa};a.offSurfaceTiltToEyeTiltGlobal=function(qa,sa,ma,ra){return A(Math.PI/2,sa,ma,ra)+(qa-Math.PI/2)};a.onSurfaceTiltToEyeTiltGlobal=A;a.panMotionToRotationMatrix=
function(qa,sa,ma,ra,va,Ia,Ja,Ha,Ta){if(H(qa.center,l.dot(qa.up,qa.center),l.length(qa.center),-t.cyclicalPI.normalize(b.deg2rad(Ia)),Ja,sa))switch(qa=-t.cyclicalPI.normalize(b.deg2rad(va)),{eye:va}=sa,d.coordinateSystemFromOneAxisAndNormalVector([0,0,1],va,V,W,U),va=ma.translation[0]*ra.pan,Ia="zoom"===Ta.mode?0:ma.translation[1]*ra.pan,sa=Math.max(Math.sqrt(Math.abs(1-l.dot(sa.center,V)**2/l.length(sa.center)**2)),.5),Ja=-Math.cos(qa)*Ia+Math.sin(qa)*va,h.rotate(Ha.pan.matrix,Ha.pan.matrix,(Math.sin(qa)*
Ia+Math.cos(qa)*va)/sa,V),Ha.pan.enabled=!0,Ta.mode){case "pan":h.rotate(Ha.pan.matrix,Ha.pan.matrix,Ja,W);Ha.pan.enabled=!0;break;case "zoom":Ha.zoom=-ma.translation[1]*ra.zoom}else{{const {eye:db,viewRight:fb}=sa;sa=l.cross(q.sv3d.get(),fb,db);qa=ma.translation[0]*ra.pan;0!==qa&&(h.rotate(Ha.pan.matrix,Ha.pan.matrix,-qa,sa),Ha.pan.enabled=!0);switch(Ta.mode){case "pan":ma=ma.translation[1]*ra.pan;0!==ma&&(h.rotate(Ha.pan.matrix,Ha.pan.matrix,ma,fb),Ha.pan.enabled=!0);break;case "zoom":Ha.zoom=-ma.translation[1]*
ra.zoom}}}};a.panToPosition=function(qa,sa,ma,ra,va,Ia,Ja){H(ma,l.dot(sa.up,ma),qa[3],-t.cyclicalPI.normalize(b.deg2rad(va)),Ia,sa,Q.Pole,Q.Angle)?K(qa,sa,ma,ra,-t.cyclicalPI.normalize(b.deg2rad(va)),Ia,Ja):M(qa,sa,ma,ra,Ia,Ja)};a.pickPointAndInitSphere=function(qa,sa,ma,ra,va){const Ia=k.create(),Ja=z.create();let Ha=!0,Ta=!0;qa.intersectScreen(ma,Ia)?Ja[3]=l.length(Ia):(Ta=!1,Ja[3]=sa.aboveGround?Math.max(l.length(sa.center),.9*va.radius):l.length(sa.eye)-sa.relativeElevation,ra?p(Ja,sa,ma,Ia):
Ha=x.intersectScreen(Ja,sa,ma,Ia));return{sphere:Ja,scenePickPoint:Ha?Ia:null,hasGeometryIntersection:Ta}};a.preserveHeadingThreshold=H;a.rotatePointAroundTwoAxes=G;a.rotationAngleAndAxisDirectRotation=B;a.rotationAnglesAndAxesHeadingPreserving=F;a.rotationAnglesHeadingPreserving=C;a.rotationFromPointsAroundAxis=function(qa,sa,ma){const ra=q.sv3d.get(),va=q.sv3d.get(),Ia=q.sv3d.get();l.copy(va,qa);l.copy(Ia,sa);qa=l.dot(va,ma);sa=l.dot(Ia,ma);l.scale(ra,ma,qa);l.subtract(va,va,ra);l.normalize(va,
va);l.scale(ra,ma,sa);l.subtract(Ia,Ia,ra);l.normalize(Ia,Ia);qa=l.dot(va,Ia);l.cross(ra,ma,va);ma=l.dot(Ia,ra);return Math.atan2(ma,qa)};a.sphereOrPlanePointFromScreenPoint=p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/geometryUtils/ray":function(){define("exports ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../geometry/support/vectorStacks".split(" "),function(a,b,c,g,h,w){function n(l,k,e){const d=c.castRenderScreenPointArray3(g.copy(w.sv3d.get(),
k));d[2]=0;if(!l.unprojectFromRenderScreen(d,e.origin))return null;k=c.castRenderScreenPointArray3(g.copy(w.sv3d.get(),k));k[2]=1;l=l.unprojectFromRenderScreen(k,w.sv3d.get());if(b.isNone(l))return null;h.subtract(e.direction,l,e.origin);return e}function f(l,k,e){h.copy(e.origin,l.eye);k=h.set(w.sv3d.get(),k[0],k[1],1);l=l.unprojectFromRenderScreen(k,w.sv3d.get());if(b.isNone(l))return null;h.subtract(e.direction,l,e.origin);return e}a.fromRender=n;a.fromRenderAtEye=f;a.fromScreen=function(l,k,e){return n(l,
l.screenToRender(k,c.castRenderScreenPointArray3(w.sv3d.get())),e)};a.fromScreenAtEye=function(l,k,e){return f(l,l.screenToRender(k,c.castRenderScreenPointArray3(w.sv3d.get())),e)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/geometryUtils/sphere":function(){define(["exports","../../../../geometry/support/ray","../../../../chunks/sphere","./ray"],function(a,b,c,g){const h=b.create();a.intersectScreen=function(w,n,f,l){n=g.fromScreenAtEye(n,f,h);return c.intersectRay(w,
n,l)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/time ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/set ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils ../../../camera/constraintUtils/common ../PointToPointAnimationController ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r){a.ZoomStepController=function(u){function E(){var A=u.apply(this,arguments)||this;A.zoomLocation=d.create();A.tmpCamera=new q.default;A.tmpRayDir=d.create();A.tmpCenter=d.create();A.constraintOptions={selection:z.ConstraintTypes.ALL,interactionType:z.InteractionType.ZOOM,interactionFactor:null,interactionStartCamera:new q.default,interactionDirection:null,tiltMode:z.TiltMode.TUMBLE};return A}b._inheritsLoose(E,u);var y=E.prototype;y.zoomStep=function(A,
p){if(this.active){var B=this.view.state,{interactionStartCamera:D}=this.constraintOptions;this.animation.finished?D.copyFrom(B.camera):this.animation.cameraAt(1,D);this.tmpCamera.copyFrom(B.camera);B=t.newIntersector(this.view.state.viewingMode);0<A?(this.intersectionHelper.intersectScreenFreePointFallback(p,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,B,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,
B,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:e.copy(this.zoomLocation,this.tmpCamera.center);A=.6**A;p=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),p[0],p[1],this.view.state.camera,60);B=Math.max(14*Math.abs(this.view.camera.position.z),20);if(p=p?Math.min(p,B):B)B=d.create(),e.subtract(B,this.zoomLocation,this.tmpCamera.eye),p<e.length(B)&&(e.normalize(B,B),e.add(this.zoomLocation,this.tmpCamera.eye,e.scale(B,B,p)));this._updateCamera(this.tmpCamera,
A,this.zoomLocation);this.begin(this.tmpCamera)}};y.animationSettings=function(){return{apex:null,duration:g.Milliseconds(600),easing:r.outExpo}};y._updateCamera=function(A,p,B){e.subtract(this.tmpRayDir,B,A.eye);const D=e.length(this.tmpRayDir);let C=D*p;const F=Math.max(4,1.01*A.nearFar[0]);1>=p&&C<F&&(C=F,p=C/D);1E-6>Math.abs(D-C)||(e.scale(this.tmpRayDir,this.tmpRayDir,p),A.eye=e.subtract(x,B,this.tmpRayDir),A.center=e.lerp(x,A.center,B,1-p),m.applyAll(this.view,A,this.constraintOptions))};return E}(v.PointToPointAnimationController);
a.ZoomStepController=c.__decorate([k.subclass("esri.views.3d.state.controllers.local.ZoomStepController")],a.ZoomStepController);const x=d.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/handlers/support":function(){define(["exports"],function(a){a.eventMatchesMousePointerAction=function(b,c){if("touch"===b.pointerType)return!1;switch(c){case "primary":return 0===b.button;case "secondary":return 2===b.button;case "tertiary":return 1===b.button}};a.eventMatchesPointerAction=
function(b,c){switch(c){case "primary":return"touch"===b.pointerType||0===b.button;case "secondary":return"touch"!==b.pointerType&&2===b.button;case "tertiary":return"touch"!==b.pointerType&&1===b.button}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/DragRotate":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/RotateController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(a,b,c,g,h,w){h=function(n){function f(l,k,e,d){var m=n.call(this,!0)||this;m.view=l;m.pointerAction=k;m.pivot=e;m.registerIncoming("drag",d,z=>m._handleDrag(z));return m}b._inheritsLoose(f,n);f.prototype._handleDrag=function(l){const k=l.data;if(!(1<k.pointers.size)&&w.eventMatchesMousePointerAction(l.data,this.pointerAction)){var e=c.createScreenPointArray(k.center.x,k.center.y);switch(k.action){case "start":this.cameraController&&(this.cameraController.end(),this.cameraController=null);
this.cameraController=new g.RotateController({view:this.view,pivot:this.pivot});this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(e);break;case "update":this.cameraController&&this.cameraController.update(e);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}l.stopPropagation()}};return f}(h.InputHandler);Object.defineProperty(a,"PivotPoint",{enumerable:!0,get:()=>g.PivotPoint});a.DragRotate=h;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/state/controllers/RotateController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../camera/constraintUtils ../../camera/constraintUtils/common ../Constraints ./InteractiveController ../utils/navigationUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y){a.PivotPoint=void 0;(function(p){p[p.CENTER=0]="CENTER";p[p.EYE=1]="EYE"})(a.PivotPoint||(a.PivotPoint={}));a.RotateController=function(p){function B(C){C=p.call(this,C)||this;C.view=null;C.pivot=a.PivotPoint.CENTER;C.lastPoint=z.create();C.tmpWorldUp=q.create();C.tmpViewDir=q.create();C.tmpRotCurPoint=z.create();C.tmpTransf=d.create();C.tmpAxis=q.create();C.tmpPivotPoint=q.create();C.pivotPos=q.create();C.constraintOptions={selection:x.ConstraintTypes.ALL,
interactionType:x.InteractionType.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:x.TiltMode.TUMBLE};return C}b._inheritsLoose(B,p);var D=B.prototype;D.initialize=function(){this.rotScale=this.pivot===a.PivotPoint.CENTER?3:1.5};D.begin=function(C){if(this.active){switch(this.pivot){case a.PivotPoint.EYE:v.copy(this.pivotPos,this.startCamera.eye);this.constraintOptions.interactionType=x.InteractionType.LOOK_AROUND;this.constraintOptions.tiltMode=x.TiltMode.LOOK_AROUND;
this.constraintOptions.selection=x.ConstraintTypes.NONE;break;case a.PivotPoint.CENTER:this.intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this.pivotPos)||v.copy(this.pivotPos,this.startCamera.center),this._constrainPivotPoint(C),this.startCamera.center=this.pivotPos,this.constraintOptions.interactionType=x.InteractionType.TUMBLE,this.constraintOptions.tiltMode=x.TiltMode.TUMBLE,this.constraintOptions.selection=x.ConstraintTypes.ALL&~x.ConstraintTypes.DISTANCE}this.constraintOptions.interactionStartCamera=
this.startCamera;y.normalizeCoordinate(this.startCamera,C,this.lastPoint)}};D._constrainPivotPoint=function(C){const F=this.startCamera,G=q.create();v.subtract(G,this.pivotPos,F.eye);let L=v.length(G);this.view.camera.position.hasZ&&(L=Math.min(L,7*Math.abs(this.view.camera.position.z)));var H=t.getReferenceEllipsoid(this.view.spatialReference),M=h.createScreenPointArray(F.width/F.pixelRatio*.5,F.height/F.pixelRatio*.5);H=y.decideNavigationMode(this.startCamera,M,!0,H);M=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),
F.fullWidth/F.pixelRatio*.5,F.fullHeight/F.pixelRatio*.5,F,225,90);C=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),C[0],C[1],F,90);if(void 0!==M||void 0!==C)M=void 0===M?C:M,C=void 0===C||H===y.NavigationMode.Horizontal?M:C,L=M>C?C:M;v.normalize(G,G);v.copy(this.pivotPos,v.add(this.tmpPivotPoint,F.eye,v.scale(this.tmpPivotPoint,G,L)))};D.update=function(C){if(this.active){switch(this.pivot){case a.PivotPoint.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,
C,this.currentCamera.center,this.pivotPos);break;case a.PivotPoint.CENTER:this.currentCamera.center=this.pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,C,this.currentCamera.eye,this.pivotPos)}r.applyAll(this.view,this.currentCamera,this.constraintOptions)}};D.end=function(){this.active&&this.finishController()};D._applyRotation=function(C,F,G,L){this.view.renderCoordsHelper.worldUpAtPosition(L,this.tmpWorldUp);y.normalizeCoordinate(C,F,this.tmpRotCurPoint);F=(this.lastPoint[1]-
this.tmpRotCurPoint[1])*this.rotScale;let H=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;v.subtract(this.tmpViewDir,G,L);G=v.length(this.tmpViewDir);G=g.acosClamped(v.dot(this.tmpViewDir,this.tmpWorldUp)/G);if(this.pivot===a.PivotPoint.EYE){const M=.5*Math.PI-G,K=.495*Math.PI;F=M-Math.max(-K,Math.min(K,M+-.5*F))}F=g.clamp(F+G,u.TiltDefault.min,u.TiltDefault.max)-G;v.cross(this.tmpAxis,C.up,this.tmpViewDir);this.pivot===a.PivotPoint.CENTER&&(H=-H);e.fromRotation(this.tmpTransf,H,this.tmpWorldUp);
e.rotate(this.tmpTransf,this.tmpTransf,F,this.tmpAxis);v.transformMat4(this.tmpViewDir,this.tmpViewDir,this.tmpTransf);C.up=v.transformMat4(A,C.up,this.tmpTransf);v.add(A,L,this.tmpViewDir);m.copy(this.lastPoint,this.tmpRotCurPoint);return A};b._createClass(B,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return B}(E.InteractiveController);c.__decorate([w.property({constructOnly:!0})],a.RotateController.prototype,"view",void 0);c.__decorate([w.property()],a.RotateController.prototype,
"pivot",void 0);a.RotateController=c.__decorate([k.subclass("esri.views.3d.state.controllers.RotateController")],a.RotateController);const A=q.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/InteractiveController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/set ../../../../core/accessorSupport/decorators/subclass ./CameraController ../../webgl-engine/lib/Camera".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){a.InteractiveController=function(d){function m(){var v=d.apply(this,arguments)||this;v.startCamera=new e.default;v.currentCamera=new e.default;return v}b._inheritsLoose(m,d);var z=m.prototype;z.stepController=function(v,q){q.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(q)};z.onControllerStart=function(v){this.state=k.State.Running;this.startCamera.copyFrom(v);this.currentCamera.copyFrom(v)};z.onControllerEnd=function(v){v.copyViewFrom(this.currentCamera)};
b._createClass(m,[{key:"isInteractive",get:function(){return!0}}]);return m}(k.CameraController);a.InteractiveController=c.__decorate([l.subclass("esri.views.3d.state.controllers.InteractiveController")],a.InteractiveController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/DragZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(a,b,c,g,h,w,n){w=function(f){function l(k,e,d){var m=f.call(this,!0)||this;m.view=k;m.pointerAction=e;m.registerIncoming("drag",d,z=>m._handleDrag(z));return m}b._inheritsLoose(l,f);l.prototype._handleDrag=function(k){const e=k.data;if(!(1<e.pointers.size)&&n.eventMatchesMousePointerAction(k.data,this.pointerAction)){var d=c.createScreenPointArray(e.center.x,e.center.y);switch(e.action){case "start":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=
this.view.state.isGlobal?new g.ZoomController({view:this.view}):new h.ZoomController({view:this.view});this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(d);break;case "update":this.cameraController&&this.cameraController.update(d);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}k.stopPropagation()}};return l}(w.InputHandler);a.DragZoom=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/global/ZoomController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/projectionEllipsoid ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/common ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils/ray ../../../camera/constraintUtils/surfaceCollision".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A){a.ZoomController=function(B){function D(F){F=B.call(this,F)||this;F.view=null;F.pickPoint=z.create();F.tmpP0=d.create();F.panAxisAngle=q.create();F.tmpRayDir=z.create();F.targetOnSphere=z.create();F.tmpRay={origin:z.create(),direction:z.create()};F.dragBeginPoint=h.createScreenPointArray();F.normalizedAnchorPoint=d.create();F.constraintOptions={selection:x.ConstraintTypes.ALL_EXCEPT_COLLISION,interactionType:x.InteractionType.ZOOM,interactionFactor:0,
interactionStartCamera:null,interactionDirection:null,tiltMode:x.TiltMode.TUMBLE};F.sphere=t.create();F.hasPickPoint=!1;return F}b._inheritsLoose(D,B);var C=D.prototype;C.begin=function(F){if(this.active){e.copy(this.dragBeginPoint,F);E.normalizeCoordinate(this.startCamera,F,this.normalizedAnchorPoint);var G=v.getReferenceEllipsoid(this.view.spatialReference),L=E.pickPointAndInitSphere(this.intersectionHelper,this.startCamera,F,!1,G);this.navMode=E.decideNavigationMode(this.startCamera,F,L.hasGeometryIntersection,
G);if(this.navMode===E.NavigationMode.Horizontal)this.hasPickPoint=!!L.scenePickPoint,this.pickPoint=L.scenePickPoint,this.sphere=L.sphere;else{y.fromScreenAtEye(this.startCamera,F,this.tmpRay);m.normalize(this.tmpRay.direction,this.tmpRay.direction);let H;this.view.camera.position.hasZ&&(H=Math.abs(this.view.camera.position.z));G=g.clamp(E.PIVOT_DISTANCE_MODIFIER*H,E.DISTANCE_CLAMP_VALUES[0],E.DISTANCE_CLAMP_VALUES[1]);F=this.view._stage.renderView.getMinimalDepthForArea(null,F[0],F[1],this.view.state.camera,
E.SCREEN_PIXEL_AREA);G=G>F?F:G;this.hasPickPoint=!0;m.scale(this.tmpRay.direction,this.tmpRay.direction,G);m.add(this.pickPoint,this.tmpRay.origin,this.tmpRay.direction)}this.constraintOptions.interactionStartCamera=this.startCamera}};C.update=function(F){if(this.active){this.currentCamera.eye=this.startCamera.eye;this.currentCamera.center=this.startCamera.center;this.currentCamera.up=this.startCamera.up;if(this.navMode===E.NavigationMode.Horizontal){m.subtract(this.tmpRayDir,this.currentCamera.center,
this.currentCamera.eye);var G=m.length(this.tmpRayDir);E.normalizeCoordinate(this.currentCamera,F,this.tmpP0);var L=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]),H=G*2**L;const M=this.view.state.constraints.minimumPoiDistance;0>L&&H<M&&(H=M);if(1E-6>Math.abs(G-H))return;this.hasPickPoint&&H<G&&(L=1-(1-H/G)*(1-this.sphere[3]/m.length(this.currentCamera.center)),this.currentCamera.center=m.scale(p,this.currentCamera.center,L));m.scale(this.tmpRayDir,this.tmpRayDir,-H/G);this.currentCamera.eye=m.add(p,
this.currentCamera.center,this.tmpRayDir);this.constraintOptions.interactionFactor=r.pixelDistanceToInteractionFactor(this.dragBeginPoint,F);r.applyAll(this.view,this.currentCamera,this.constraintOptions);this.hasPickPoint&&(E.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),q.fromPoints(this.pickPoint,this.targetOnSphere,this.panAxisAngle),E.applyRotation(this.currentCamera,this.sphere,this.panAxisAngle))}else{G=m.length(this.tmpRay.direction);
E.normalizeCoordinate(this.currentCamera,F,this.tmpP0);F=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);H=G*2**F;L=this.view.state.constraints.minimumPoiDistance;0>F&&H<L&&(H=L);if(1E-6>Math.abs(G-H))return;m.scale(this.tmpRayDir,this.tmpRay.direction,1-H/G);this.currentCamera.eye=m.add(p,this.currentCamera.eye,this.tmpRayDir);this.currentCamera.center=m.add(p,this.currentCamera.center,this.tmpRayDir)}A.applySurfaceCollisionConstraint(this.view,this.currentCamera)}};C.end=function(){this.active&&
this.finishController()};b._createClass(D,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return D}(u.InteractiveController);c.__decorate([w.property({constructOnly:!0})],a.ZoomController.prototype,"view",void 0);a.ZoomController=c.__decorate([k.subclass("esri.views.3d.state.controllers.global.ZoomController")],a.ZoomController);const p=z.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/plane ../../../camera/constraintUtils ../../../camera/constraintUtils/common ../InteractiveController ../../utils/navigationUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x){a.ZoomController=function(E){function y(p){p=E.call(this,p)||this;p.view=null;p.tmpP=z.create();p.tmpDir=z.create();p.tmpN=z.create();p.tmpP0=d.create();p.tmpPoi=z.create();p.tmpRayDir=z.create();p.dragBeginPoint=h.createScreenPointArray();p.normalizedAnchorPoint=d.create();p.constraintOptions={selection:t.ConstraintTypes.ALL,interactionType:t.InteractionType.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:z.create(),tiltMode:t.TiltMode.TUMBLE};
p.plane=v.create();return p}b._inheritsLoose(y,E);var A=y.prototype;A.begin=function(p){if(this.active){e.copy(this.dragBeginPoint,p);x.normalizeCoordinate(this.startCamera,p,this.normalizedAnchorPoint);this.intersectionHelper.intersectScreenFreePointFallback(p,this.tmpP);m.subtract(this.tmpDir,this.tmpP,this.startCamera.eye);m.normalize(this.tmpDir,this.tmpDir);var B;this.view.camera.position.hasZ&&(B=Math.abs(this.view.camera.position.z));B=g.clamp(x.PIVOT_DISTANCE_MODIFIER*B,x.DISTANCE_CLAMP_VALUES[0],
x.DISTANCE_CLAMP_VALUES[1]);p=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),p[0],p[1],this.view.state.camera,x.SCREEN_PIXEL_AREA);m.scale(this.tmpDir,this.tmpDir,B>p?p:B);m.add(this.tmpP,this.startCamera.eye,this.tmpDir);m.subtract(this.tmpN,this.startCamera.eye,this.startCamera.center);m.normalize(this.tmpN,this.tmpN);0>this.tmpN[1]&&m.negate(this.tmpN,this.tmpN);v.fromPositionAndNormal(this.tmpP,this.tmpN,this.plane);this.constraintOptions.interactionStartCamera=
this.startCamera}};A.update=function(p){if(this.active){x.intersectPlaneFromScreenPoint(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||m.copy(this.tmpPoi,this.currentCamera.center);x.normalizeCoordinate(this.currentCamera,p,this.tmpP0);var B=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);e.copy(this.normalizedAnchorPoint,this.tmpP0);m.subtract(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);var D=m.length(this.tmpRayDir),C=D*(1-B);m.copy(this.constraintOptions.interactionDirection,
this.tmpRayDir);m.scale(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,Math.sign(B)/D);var F=this.view.state.constraints.minimumPoiDistance;0<=B&&C<F&&(C=F,B=-(C-D)/D);1E-6>Math.abs(D-C)||(m.scale(this.tmpRayDir,this.tmpRayDir,B),this.currentCamera.eye=m.add(u,this.currentCamera.eye,this.tmpRayDir),m.lerp(u,this.currentCamera.center,this.tmpPoi,B),u[2]=this.tmpPoi[2]>this.startCamera.center[2]?Math.max(this.startCamera.center[2],u[2]):Math.min(this.startCamera.center[2],
u[2]),this.currentCamera.center=u,this.constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(this.dragBeginPoint,p),q.applyAll(this.view,this.currentCamera,this.constraintOptions))}};A.end=function(){this.active&&this.finishController()};b._createClass(y,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return y}(r.InteractiveController);c.__decorate([w.property({constructOnly:!0})],a.ZoomController.prototype,"view",void 0);a.ZoomController=c.__decorate([k.subclass("esri.views.3d.state.controllers.local.ZoomController")],
a.ZoomController);const u=z.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/GamepadNavigation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Handles ../../../../core/watchUtils ../../state/controllers/GamepadKeyboardController ../../../input/InputHandler".split(" "),function(a,b,c,g,h,w){w=function(n){function f(k){var e=n.call(this,!0)||this;e.view=k;e.watchHandles=new c;e.handle=e.registerIncoming("gamepad",d=>
e._handleEventGamepad(d));e.handle.pause();return e}b._inheritsLoose(f,n);var l=f.prototype;l.onInstall=function(k){n.prototype.onInstall.call(this,k);this.watchHandles.add([g.init(this.view.navigation.gamepad,"enabled",e=>{e?this.handle.resume():(this.handle.pause(),this.cameraControllerGamepad&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null))}),this.view.navigation.gamepad.watch("device",e=>{this.cameraControllerGamepad&&e&&this.cameraControllerGamepad.gamepadDevice!==
e&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null)})])};l.onUninstall=function(){this.watchHandles.removeAll();n.prototype.onUninstall.call(this)};l._handleEventGamepad=function(k){var e=this.view.navigation.gamepad.device;if(!e||k.data.device===e)if((e=this.cameraControllerGamepad&&this.cameraControllerGamepad.active)||h.GamepadKeyboardController.activatesFor(this.view,k.data))e||(e=new h.GamepadKeyboardController({view:this.view,gamepadDevice:k.data.device}),
this.view.state.switchCameraController(e)&&(this.cameraControllerGamepad=e)),this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===k.data.device&&this.cameraControllerGamepad.handleEventGamepad(k.data)};return f}(w.InputHandler);a.GamepadNavigation=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/GamepadKeyboardController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../../../geometry/support/ray ../../../../chunks/sphere ../../../../geometry/support/vectorStacks ../../camera/constraintUtils ../../camera/constraintUtils/common ../Constraints ./InteractiveController ../utils/navigationUtils ../utils/viewUtils ../../support/cameraUtils ../../support/cameraUtilsInternal ../../webgl-engine/lib/Camera ../../../navigation/gamepadAndKeyboardUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G){a.GamepadKeyboardController=function(P){function N(S){S=P.call(this,S)||this;S.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0};S.keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0];S.tmpCamera=new F.default;S.constraintOptions={selection:E.ConstraintTypes.ALL,interactionType:E.InteractionType.NONE,interactionStartCamera:new F.default,interactionFactor:0,interactionDirection:null,tiltMode:E.TiltMode.LOOK_AROUND};return S}b._inheritsLoose(N,
P);var R=N.prototype;R.handleEventGamepad=function(S){const T=G.extractTransformation(S,this.view.navigation.gamepad,this.transformation);("end"===S.action||G.isZeroTransformation(T))&&this.finishController()};R.activateDirection=function(S){this.keysButtonState[S]=1;G.extractTransformationKeyboard(this.keysButtonState,this.transformation)};R.deactivateDirection=function(S){this.keysButtonState[S]=0;S=G.extractTransformationKeyboard(this.keysButtonState,this.transformation);G.isZeroTransformation(S)&&
this.finishController()};R.onControllerStart=function(S){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z;this.headingStart=this.view.camera.heading;P.prototype.onControllerStart.call(this,S)};R._updateFilteredSurfaceElevation=function(S){this.filteredSurfaceElevation+=(this.view.pointsOfInterest.cameraOnSurface.location.z-this.filteredSurfaceElevation)*S};R.stepController=function(S,T){this._updateStartHeading();this._updateFilteredSurfaceElevation(S);this.currentCamera.copyViewFrom(T);
this._updateCameraCenter();this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera);this._calculateControlTransformation(S,this.currentCamera,I);this._applyDisabledMovementTypes(I);this._applyPan(I.pan);this._applyRotate(I.rotate);this._applyZoom(I.zoom);this._applyAscend(I.ascend);this.constraintOptions.interactionType=E.InteractionType.NONE;this.constraintOptions.selection=E.ConstraintTypes.COLLISION;u.applyAll(this.view,this.currentCamera,this.constraintOptions);P.prototype.stepController.call(this,
S,T)};R._updateStartHeading=function(){0!==this.transformation.heading&&(this.headingStart=this.view.camera.heading)};R._applyRotate=function(S){if(S.enabled){var T=this.currentCamera;z.subtract(O,T.center,T.eye);z.transformMat4(O,O,S.matrix);T.center=z.add(O,O,T.eye);T.up=z.transformMat4(O,T.up,S.matrix);this.constraintOptions.interactionType=E.InteractionType.LOOK_AROUND;this.constraintOptions.selection=E.ConstraintTypes.ALL_EXCEPT_COLLISION;u.applyAll(this.view,T,this.constraintOptions)}};R._applyPan=
function(S,T=this.currentCamera){S.enabled&&(T.eye=z.transformMat4(O,T.eye,S.matrix),T.center=z.transformMat4(O,T.center,S.matrix),this.view.state.isGlobal&&(T.up=z.transformMat4(O,T.up,S.matrix)),this.constraintOptions.interactionType=E.InteractionType.PAN,this.constraintOptions.selection=E.ConstraintTypes.ALL,u.applyAll(this.view,T,this.constraintOptions))};R._applyZoom=function(S){if(S){var T=this.currentCamera.viewForward;this.currentCamera.eye=z.add(O,this.currentCamera.eye,z.scale(x.sv3d.get(),
T,S));z.copy(Q,T);z.negate(Q,Q);this.constraintOptions.interactionDirection=Q;this.constraintOptions.interactionType=E.InteractionType.ZOOM;this.constraintOptions.selection=E.ConstraintTypes.ALL_EXCEPT_COLLISION;u.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=null}};R._applyAscend=function(S){if(S){var T=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,x.sv3d.get());this.constraintOptions.interactionDirection=z.copy(Q,
T);this.view.state.isGlobal?(T=z.length(this.currentCamera.eye),S=(T+S)/T,this.currentCamera.eye=z.scale(O,this.currentCamera.eye,S),this.currentCamera.center=z.scale(O,this.currentCamera.center,S)):(S=z.scale(x.sv3d.get(),T,S),this.currentCamera.eye=z.add(O,this.currentCamera.eye,S),this.currentCamera.center=z.add(O,this.currentCamera.center,S));this._updateCameraCenter();this.constraintOptions.interactionType=E.InteractionType.ASCEND;this.constraintOptions.selection=E.ConstraintTypes.COLLISION;
u.applyAll(this.view,this.currentCamera,this.constraintOptions)&&this._updateCameraCenter();this.constraintOptions.selection=E.ConstraintTypes.ALL_EXCEPT_COLLISION;u.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=null}};R._calculateControlTransformation=function(S,T,V){V.zoom=0;V.ascend=0;V.pan.enabled=!1;d.identity(V.pan.matrix);V.rotate.enabled=!1;d.identity(V.rotate.matrix);S=this._computeVelocities(S);this.view.state.isLocal?this._calculateControlTransformationLocal(S,
T,V):this._calculateControlTransformationGlobal(S,T,V)};R._updateCameraCenter=function(){this.currentCamera.center=this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(this.currentCamera.ray,this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,O)};R._calculateControlTransformationLocal=function(S,T,V){const {viewRight:W,viewForward:U}=T,aa=this.transformation;var da=this.view.navigation.gamepad,Y=z.set(x.sv3d.get(),U[0],U[1],0);z.normalize(Y,Y);var ea=aa.translation[0]*
S.pan;0!==ea&&(ea=z.scale(x.sv3d.get(),W,ea),d.translate(V.pan.matrix,V.pan.matrix,ea),V.pan.enabled=!0);switch(da.mode){case "pan":da=-aa.translation[1]*S.pan;0!==da&&(Y=z.scale(x.sv3d.get(),Y,da),d.translate(V.pan.matrix,V.pan.matrix,Y),V.pan.enabled=!0);V.zoom=aa.zoom*S.zoom;break;case "zoom":V.zoom=(-aa.translation[1]+aa.zoom)*S.zoom;break;default:g.neverReached(da.mode)}V.ascend=aa.translation[2]*S.ascend;Y=-aa.heading*S.rotate;0!==Y&&(d.rotate(V.rotate.matrix,V.rotate.matrix,Y,this.view.renderCoordsHelper.worldUpAtPosition(T.eye,
x.sv3d.get())),V.rotate.enabled=!0);S=aa.tilt*S.rotate;T=B.viewAngle(this.view.renderCoordsHelper,T.center,T.eye);if(T=h.clamp(T+S,y.TiltDefault.min,y.TiltDefault.max)-T)d.rotate(V.rotate.matrix,V.rotate.matrix,T,W),V.rotate.enabled=!0};R._calculateControlTransformationGlobal=function(S,T,V){const {eye:W,viewRight:U}=T,aa=this.transformation;var da=this.view.navigation.gamepad,Y=z.cross(x.sv3d.get(),U,W);z.normalize(Y,Y);z.negate(Y,Y);p.panMotionToRotationMatrix(this.startCamera,T,aa,S,this.view.camera.heading,
this.headingStart,this.view.camera.tilt,V,da);this.tmpCamera.copyFrom(this.currentCamera);this._applyPan(I.pan,this.tmpCamera);da=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;V.ascend=aa.translation[2]*S.ascend;Y=-aa.heading*S.rotate;0!==Y&&(d.rotate(V.rotate.matrix,V.rotate.matrix,Y,this.tmpCamera.eye),V.rotate.enabled=!0);T=this._clampTiltDeltaGlobalToValidRange(aa.tilt*S.rotate,T.ray,da);0!==T&&(d.rotate(V.rotate.matrix,V.rotate.matrix,T,this.tmpCamera.viewRight),
V.rotate.enabled=!0);V.zoom+=aa.zoom*S.zoom};R._clampTiltDeltaGlobalToValidRange=function(S,T,V){const W=q.getReferenceEllipsoid(this.view.spatialReference),U=p.onSurfaceTiltToEyeTiltGlobal(y.TiltDefault.min,T.origin,V,W);var aa=0;let da=0;aa=x.sv3d.get();this.view.renderCoordsHelper.intersectManifold(T,V,aa)?(aa=B.viewAngle(this.view.renderCoordsHelper,aa,T.origin),aa=p.onSurfaceTiltToEyeTiltGlobal(aa,T.origin,V,W),da=p.onSurfaceTiltToEyeTiltGlobal(y.TiltDefault.max,T.origin,V,W)):(r.closestPointOnSilhouette(r.fromRadius(V+
W.radius),T,aa),aa=h.acosClamped(-z.dot(T.direction,z.normalize(aa,aa))),aa=p.offSurfaceTiltToEyeTiltGlobal(aa,T.origin,V,W),da=p.offSurfaceTiltToEyeTiltGlobal(y.TiltDefault.max,T.origin,V,W));return h.clamp(aa+S,U,da)-aa};R._getPointAbsoluteSurfaceElevation=function(S,T,V){const {renderCoordsHelper:W}=this.view,U=W.getAltitude(S);T+=Math.abs(U-T);W.setAltitude(V,T,S);return T};R._clampedDistanceToSurface=function(S,T){const {renderCoordsHelper:V}=this.view,{camera:W}=this.view.state;var {direction:U}=
D.headingTiltToDirectionUp(this.view,T,0,80,J);U=V.intersectManifoldClosestSilhouette(t.wrap(T,U),S,x.sv3d.get());U=z.distance(T,U);S=V.intersectManifoldClosestSilhouette(t.wrap(T,z.direction(x.sv3d.get(),T,W.center)),S,x.sv3d.get());T=z.distance(T,S);return Math.min(U,T)};R._computeHeadingRotateRadius=function(S){const {renderCoordsHelper:T,state:V}=this.view,{camera:W,isGlobal:U}=V;var aa=T.intersectManifoldClosestSilhouette(W.ray,this.filteredSurfaceElevation,x.sv3d.get());if(U){const da=z.subtract(x.sv3d.get(),
S,aa);aa=z.length(da);z.scale(da,da,1/aa);S=z.normalize(x.sv3d.get(),S);S=h.acosClamped(z.dot(S,da));return aa*Math.sin(Math.min(H,S))}S=z.copy(x.sv3d.get(),S);T.setAltitude(S,this.filteredSurfaceElevation);return z.distance(aa,S)};R._minimumAscendVelocity=function(){return this.view.state.constraints.collision.enabled?0:5};R._computeVelocities=function(S){var T=this.filteredSurfaceElevation,V=T+q.getReferenceEllipsoid(this.view.spatialReference).radius;const {camera:W,isGlobal:U}=this.view.state;
var aa=x.sv3d.get();const da=this._getPointAbsoluteSurfaceElevation(W.eye,T,aa);var Y=this._clampedDistanceToSurface(T,aa);const ea=W.width/2,ja=.75*W.width,la=.75*W.width;var ia=Y*Math.tan(.5*W.fovX)/ea;V=ia/V;aa=ia/this._computeHeadingRotateRadius(aa);ia=(U?V:ia)*ja*S;T=da-T;T=Math.max(this._minimumAscendVelocity()*S,2**(ja*S/ea)*T-T);Y=2**(ja*S/ea)*Y-Y;S*=h.clamp(aa*la,M,K);return{pan:ia,ascend:T,zoom:Y,rotate:S}};R._applyDisabledMovementTypes=function(S){!w.isSome(this.disableMovements)||void 0!==
this.disableMovements.mode&&this.view.state.viewingMode!==this.disableMovements.mode||(S.zoom=this.disableMovements.zoom?0:S.zoom,S.ascend=this.disableMovements.ascend?0:S.ascend,S.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&d.identity(S.pan.matrix),S.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&d.identity(S.rotate.matrix))};N.activatesFor=function(S,T){S=G.extractTransformation(T,S.navigation.gamepad,L);return!("end"===T.action||G.isZeroTransformation(S))};
return N}(A.InteractiveController);c.__decorate([n.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"view",void 0);c.__decorate([n.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"gamepadDevice",void 0);c.__decorate([n.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"disableMovements",void 0);a.GamepadKeyboardController=c.__decorate([e.subclass("esri.views.3d.state.controllers.GamepadKeyboardController")],a.GamepadKeyboardController);const L=
{translation:[0,0,0],heading:0,tilt:0,zoom:0},H=h.deg2rad(80),M=h.deg2rad(30),K=h.deg2rad(80),I={zoom:0,ascend:0,pan:{enabled:!1,matrix:m.create()},rotate:{enabled:!1,matrix:m.create()}},O=v.create(),Q=v.create(),J=C.createDirectionUp();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/cameraUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Camera ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/promiseUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/Point ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/SpatialReference ../../../geometry/support/scaleUtils ../../ViewingMode ../camera/intersectionUtils ../../../chunks/cameraUtilsPlanar ../../../chunks/cameraUtilsSpherical ./earthUtils ./ElevationProvider ./mathUtils ../../support/spatialReferenceSupport".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y){function A(Y){return"global"===Y.viewingMode?r.cameraUtilsSpherical:t.cameraUtilsPlanar}function p(Y,ea,ja){const la=Y.state.camera,ia=la.width/2/la.pixelRatio;Y.renderCoordsHelper.viewingMode===v.ViewingMode.Global&&null!=ja&&(ea*=Math.cos(h.deg2rad(ja)));ea/=Y.renderCoordsHelper.unitInMeters;return ia/(96*39.37/ea)/Math.tan(la.fovX/2)}function B(Y,ea,ja){const la=Y.state.camera;ea=96*39.37/(la.width/2/la.pixelRatio/(ea*Math.tan(la.fovX/2)));
Y.renderCoordsHelper.viewingMode===v.ViewingMode.Global&&(ea/=Math.cos(h.deg2rad(ja)));return ea*=Y.renderCoordsHelper.unitInMeters}function D(Y,ea,ja,la,ia,ca){if(P(ca)){const fa=new da(ca.signal);I(Y,la.heading,la.tilt,ea,ja,ia,fa);fa.resolver.promise.then(ba=>{ba=J(Y,ba,la.fov);if(w.isNone(ba))ca.resolver.reject();else return ca.resolver.resolve(ba)},ba=>ca.resolver.reject(ba))}else return ea=I(Y,la.heading,la.tilt,ea,ja,ia),J(Y,ea,la.fov,ca)}function C(Y,ea,ja,la,ia){return A(Y).directionToHeadingTilt(ea,
ja,la,ia)}function F(Y,ea){return!!(Y.basemapTerrain&&Y.renderCoordsHelper.fromRenderCoords(ea,V,Y.spatialReference)&&w.unwrapOr(u.getElevationAtPoint(Y.elevationProvider,V),0)>V.z-1)}function G(Y,ea,ja){return L.apply(this,arguments)}function L(){L=b._asyncToGenerator(function*(Y,ea,ja){if(!Y.renderCoordsHelper.fromRenderCoords(ea,V,Y.spatialReference))return!1;Y=yield Y.elevationProvider.queryElevation(V.x,V.y,V.z,V.spatialReference,"ground",ja);return w.unwrapOr(Y,0)>V.z-1});return L.apply(this,
arguments)}function H(Y,ea,ja){return M.apply(this,arguments)}function M(){M=b._asyncToGenerator(function*(Y,ea,ja){const la=l.create();ea?ea instanceof k?(e.projectPointToVector(ea,la,Y.renderSpatialReference),null==ea.z&&null!=Y.basemapTerrain&&(ea=yield Y.elevationProvider.queryElevation(ea.x,ea.y,ea.z,ea.spatialReference,"ground",ja),w.isSome(ea)&&Y.renderCoordsHelper.setAltitude(la,ea))):f.copy(la,ea):f.copy(la,Y.state.camera.center);return la});return M.apply(this,arguments)}function K(Y,ea){const ja=
l.create();ea&&ea instanceof k?(e.projectPointToVector(ea,ja,Y.renderSpatialReference),null==ea.z&&null!=Y.basemapTerrain&&(ea=u.getElevationAtPoint(Y.elevationProvider,ea),w.isSome(ea)&&Y.renderCoordsHelper.setAltitude(ja,ea))):ea?f.copy(ja,ea):f.copy(ja,Y.state.camera.center);return ja}function I(Y,ea,ja,la,ia,ca,fa){const ba=la&&la instanceof k?la:null;if(P(fa))return H(Y,la,fa.signal).then(Z=>{O(Y,ea,ja,ba,Z,ia,ca,fa)},Z=>fa.resolver.reject(Z)),null;la=K(Y,la);return O(Y,ea,ja,ba,la,ia,ca,fa)}
function O(Y,ea,ja,la,ia,ca,fa,ba){if(w.isNone(la)&&(la=e.projectVectorToPoint(ia,Y.renderSpatialReference,Y.spatialReference||m.WGS84),w.isNone(la)))return null;ca=Math.max(ca,Y.state.constraints.minimumPoiDistance);var Z=Q(Y,ea,ja,ia,ca,fa);const ha=A(Y).eyeForCenterWithHeadingTilt,na=ha(ia,ca,Z.heading,Z.tilt);if(fa===a.OrientationMode.ADJUST&&"global"===Y.viewingMode&&0<ja){const pa=()=>{var xa=ca,Da=ca;var ua=Y.state.constraints.tilt(Da);Da=A(Y).eyeTiltToLookAtTilt(ja,ia,Da);Da=Math.min(Da,.5*
Math.PI);ua=ua.min*(1-.7)+.7*Da;xa=A(Y).lookAtTiltToEyeTilt(ua,ia,xa);fa=1>ja-xa?a.OrientationMode.LOCKED:a.OrientationMode.ADJUST;return O(Y,ea,xa,la,ia,ca,fa,ba)};Z=Y.map.ground.navigationConstraint;if(!Z||"stay-above"===Z.type){if(F(Y,na.eye))return pa();if(P(ba))return G(Y,na.eye,ba.signal).then(xa=>{if(xa)return pa();ba.resolver.resolve({eye:na.eye,up:na.up,center:l.clone(ia),heading:na.heading,tilt:na.tilt});return null}),null}}Z=!ba||P(ba)?{center:l.create(),eye:l.create(),up:l.create(),tilt:0,
heading:0}:ba;Z.eye=na.eye;Z.up=na.up;Z.center=l.clone(ia);Z.heading=na.heading;Z.tilt=na.tilt;P(ba)&&ba.resolver.resolve(Z);return Z}function Q(Y,ea,ja,la,ia,ca){var fa=0;if(ca=ca===a.OrientationMode.ADJUST)if(fa=Y.pointsOfInterest.centerOnSurfaceFrequent.distance,8<Math.log(ia/fa)/Math.LN2)ca=!0;else{var ba=Y.renderSpatialReference,Z=Y.spatialReference||m.WGS84;ca=e.projectVectorToPoint(la,ba,Z);ba=e.projectVectorToPoint(Y.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,ba,Z);w.isNone(ca)||
w.isNone(ba)?ca=!1:(fa*=Math.tan(.5*Y.state.camera.fov),ca=5<ba.distance(ca)/fa)}ca?(ea=0,ca=Y.state.constraints.tilt(ia),ca.max=Math.min(ca.max,.5*Math.PI),ca=ca.min*(1-.7)+.7*ca.max,ja=A(Y).eyeTiltToLookAtTilt(ja,la,ia),fa=Math.min(ja,ca)):fa=A(Y).eyeTiltToLookAtTilt(ja,la,ia);ja=fa=Y.state.constraints.clampTilt(ia,fa);ja=A(Y).lookAtTiltToEyeTilt(ja,la,ia);return{heading:ea,tilt:ja}}function J(Y,ea,ja,la){if(w.isNone(ea))return null;Y=e.projectVectorToPoint(ea.eye,Y.renderSpatialReference,Y.spatialReference||
m.WGS84);return w.isNone(Y)?null:w.isSome(la)?(la.position=Y,la.heading=ea.heading,la.tilt=ea.tilt,la.fov=ja,la):new c(Y,ea.heading,ea.tilt,ja)}function P(Y){return Y&&"resolver"in Y}const N=g.getLogger("esri.views.3d.support.cameraUtils"),R=l.create(),S=l.create(),T={heading:0,tilt:0},V=new k,W=new E.Cyclical(-2.0037508342788905E7,2.0037508342788905E7),U=new E.Cyclical(-180,180);a.OrientationMode=void 0;(function(Y){Y[Y.LOCKED=0]="LOCKED";Y[Y.ADJUST=1]="ADJUST"})(a.OrientationMode||(a.OrientationMode=
{}));const aa=l.create();let da=function(Y){this.signal=Y;this.resolver=n.createResolver()};a.AsyncContext=da;a.computeScale=function(Y,ea,ja){const la=Y.renderSpatialReference;ea||(ea=Y.state.camera);var ia=m.WGS84;ea instanceof c?(ia=ea.position.latitude,e.projectPointToVector(ea.position,R,la),e.projectPointToVector(ja,S,la),ea=f.distance(R,S)):(e.projectVectorToVector(ea.center,la,S,ia),ia=S[1],ea=ea.distance);return B(Y,ea,ia)};a.directionToHeadingTilt=C;a.distanceToScale=B;a.externalToInternal=
function(Y,ea){if(w.isNone(ea))return null;var ja=Y.renderSpatialReference;const la=A(Y).headingTiltToDirectionUp,ia=l.create();if(!e.projectPointToVector(ea.position,ia,ja))return null;ja=la(ia,ea.heading,ea.tilt);f.scale(ja.direction,ja.direction,Y.state.camera.distance);f.add(ja.direction,ja.direction,ia);Y=q.cameraOnContentAlongViewDirection(Y,ia,ja.direction,ja.up);Y.fov=h.deg2rad(ea.fov);return Y};a.fromCenterDistance=D;a.fromCenterScale=function(Y,ea,ja,la,ia,ca){ja=p(Y,ja,ea.latitude);return D(Y,
ea,ja,la,ia,ca)};a.fromExtent=function(Y,ea,ja,la,ia,ca=null){var fa=null!=ea.zmax&&null!=ea.zmin;let ba;if(Y.state.isGlobal){if(!y.isSpatialReferenceSupported(ea.spatialReference,v.ViewingMode.Global))return P(ca)&&ca.resolver.reject(),null;var Z=new k(ea.xmin,ea.ymin,ea.spatialReference);const pa=new k(ea.xmax,ea.ymax,ea.spatialReference),xa=ea.spatialReference.isGeographic?U:W;var ha=new k({x:xa.center(Z.x,pa.x),y:(pa.y+Z.y)/2,z:fa?(ea.zmax+ea.zmin)/2:null,spatialReference:ea.spatialReference});
const Da=d.getReferenceEllipsoid(ea.spatialReference);var na=x.getGreatCircleSpanAt(ha,Z,pa);ba=na.lon;na=na.lat;xa.diff(Z.x,pa.x)>xa.range/2&&(ba+=Da.halfCircumference);ba=Math.min(ba,Da.halfCircumference);na=Math.min(na,Da.halfCircumference)}else ha=w.unwrapOr(Y.renderSpatialReference,ea.spatialReference),ha.equals(ea.spatialReference)||(ea=e.project(ea,ha)),ba=ea.xmax-ea.xmin,na=ea.ymax-ea.ymin,ha=new k({x:ea.xmin+.5*ba,y:ea.ymin+.5*na,z:fa?(ea.zmax+ea.zmin)/2:null,spatialReference:ha});Z=Y.state.camera;
ea=Math.max(1/Math.tan(Z.fovX/2)*ba*.5,1/Math.tan(Z.fovY/2)*na*.5,1/Math.tan(Z.fov/2)*(fa?ea.zmax-ea.zmin:0)*.5)/1;if(P(ca))fa=new da(ca.signal),I(Y,ja,la,ha,ea,ia,fa),fa.resolver.promise.then(pa=>{pa=J(Y,pa,Y.camera.fov);if(w.isNone(pa))ca.resolver.reject();else return ca.resolver.resolve(pa)},pa=>ca.resolver.reject(pa));else return ja=I(Y,ja,la,ha,ea,ia),J(Y,ja,Y.camera.fov,ca)};a.getObserverForPointAtDistance=I;a.headingTiltToDirectionUp=function(Y,ea,ja,la,ia){return A(Y).headingTiltToDirectionUp(ea,
ja,la,ia)};a.internalToExternal=function(Y,ea,ja){const la=Y.renderSpatialReference,ia=C(Y,ea.eye,ea.viewForward,ea.up,T);Y=Y.spatialReference||m.WGS84;e.projectVectorToVector(ea.eye,la,aa,Y)||(Y=m.WGS84,e.projectVectorToVector(ea.eye,la,aa,Y));if(w.isNone(ja))return new c(new k(aa,Y),ia.heading,ia.tilt,h.rad2deg(ea.fov));ja.position.x=aa[0];ja.position.y=aa[1];ja.position.z=aa[2];ja.position.spatialReference=Y;ja.heading=ia.heading;ja.tilt=ia.tilt;ja.fov=h.rad2deg(ea.fov);return ja};a.observerToCamera=
J;a.scaleToDistance=p;a.scaleToResolution=function(Y,ea){return Y.spatialReference?z.getResolutionForScale(ea,Y.spatialReference):void 0};a.scaleToZoom=function(Y,ea){var ja;if(Y=null==(ja=Y.basemapTerrain)?void 0:ja.tilingScheme)return Y.levelAtScale(ea);N.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")};a.toExtent=function(Y,ea,ja){const la=e.projectVectorToPoint(ja,Y.renderSpatialReference,Y.spatialReference||m.WGS84);if(w.isNone(la))return null;var ia=Math.tan(ea.fovX/
2),ca=Math.tan(ea.fovY/2);ea=f.dist(ea.eye,ja);ia*=2*ea;ca*=2*ea;return"global"===Y.viewingMode?r.toExtent(Y,la,ia,ca):t.toExtent(Y,la,ia,ca)};a.zoomToScale=function(Y,ea){var ja;if(Y=null==(ja=Y.basemapTerrain)?void 0:ja.tilingScheme)return Y.scaleAtLevel(ea);N.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/cameraUtilsPlanar":function(){define("exports ../core/mathUtils ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/Extent ../geometry/projection ../views/3d/support/cameraUtilsInternal".split(" "),
function(a,b,c,g,h,w,n,f,l){function k(E,y,A,p=l.createDirectionUp()){const {direction:B,up:D}=p;c.fromZRotation(r,-b.deg2rad(y));c.rotateX(r,r,b.deg2rad(A));h.transformMat4(B,t,r);h.scale(B,B,-1);h.transformMat4(D,q,r);return p}function e(E,y,A,p){return l.directionToHeadingTilt(y,A,p,t,q)}function d(E,y,A,p){const B=k(E,A,p),D=w.create();h.scale(D,B.direction,-y);h.add(D,D,E);return{up:B.up,eye:D,heading:A,tilt:p}}function m(E){return b.rad2deg(E)}function z(E){return b.deg2rad(E)}function v(E,
y,A,p,B){const D=E.renderSpatialReference;E=E.map&&E.spatialReference||y.spatialReference;f.projectPointToVector(y,x,D);f.projectPointToVector(y,u,D);x[0]-=A/2;u[0]+=A/2;x[1]-=p/2;u[1]+=p/2;f.projectVectorToVector(x,D,x,E);f.projectVectorToVector(u,D,u,E);B?(B.xmin=x[0],B.ymin=x[1],B.xmax=u[0],B.ymax=u[1],B.spatialReference=E):B=new n(x[0],x[1],u[0],u[1],E);return B}const q=w.fromValues(0,1,0),t=w.fromValues(0,0,1),r=g.create(),x=w.create(),u=w.create();g=Object.freeze({__proto__:null,headingTiltToDirectionUp:k,
directionToHeadingTilt:e,eyeForCenterWithHeadingTilt:d,lookAtTiltToEyeTilt:m,eyeTiltToLookAtTilt:z,toExtent:v});a.cameraUtilsPlanar=g;a.directionToHeadingTilt=e;a.eyeForCenterWithHeadingTilt=d;a.eyeTiltToLookAtTilt=z;a.headingTiltToDirectionUp=k;a.lookAtTiltToEyeTilt=m;a.toExtent=v})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["exports","../../../core/mathUtils","../../../chunks/vec3","../../../chunks/vec3f64"],function(a,b,c,g){const h=g.create(),w=g.create();a.createDirectionUp=
function(){return{direction:g.create(),up:g.create()}};a.directionToHeadingTilt=function(n,f,l,k,e){let d=c.normalize(h,n),m=c.dot(d,k);const z=0<m;m=Math.abs(m);.99<m&&(m=Math.abs(c.dot(f,k)),.99>m?(c.copy(d,f),z&&c.scale(d,d,-1)):d=null);f=0;d&&(c.scale(w,k,c.dot(k,d)),c.subtract(d,d,w),f=c.dot(d,e)/(c.length(d)*c.length(e)),c.cross(w,d,e),f=(0<c.dot(w,k)?1:-1)*b.rad2deg(b.acosClamped(f)));n=b.rad2deg(b.acosClamped(-c.dot(k,n)/c.length(n)));if(!l)return{heading:f,tilt:n};l.heading=f;l.tilt=n;return l};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/cameraUtilsSpherical":function(){define("exports ../core/mathUtils ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/Extent ../geometry/projectionEllipsoid ../geometry/SpatialReference ../geometry/support/webMercatorUtils ../views/3d/support/cameraUtilsInternal ../views/3d/support/earthUtils ../views/3d/support/mathUtils".split(" "),function(a,b,c,g,h,w,n,f,l,k,e,d,m){function z(F,G,L,H=e.createDirectionUp()){h.cross(D,F,y);0===h.dot(D,
D)&&h.cross(D,F,A);c.fromRotation(B,-b.deg2rad(G),F);c.rotate(B,B,-b.deg2rad(L),D);const {up:M,direction:K}=H;h.cross(M,D,F);h.normalize(M,M);h.transformMat4(M,M,B);h.normalize(K,F);h.negate(K,K);h.transformMat4(K,K,B);return H}function v(F,G,L,H){const M=D,K=C;h.normalize(M,F);h.cross(C,M,y);0===h.dot(C,C)&&h.cross(C,M,A);h.cross(K,C,M);return e.directionToHeadingTilt(G,L,H,M,K)}function q(F,G,L,H){const M={eye:w.create(),up:null,tilt:H,heading:L},K=D;K[0]=F[0];K[1]=F[2];K[2]=-F[1];L=b.deg2rad(L);
var I=b.deg2rad(H);H=Math.sin(L);L=Math.cos(L);var O=Math.sin(I),Q=Math.cos(I);const J=h.length(K);if(1E-8>Math.abs(I))I=G+J;else{var P=J/O,N=b.asinClamped(G/P);I=P*Math.sin(Math.PI-I-N)}Q*=G;P=G*G*O*O;N=L*L*P;const R=I-Q,S=R*R;var T=N*(N+S-K[1]*K[1]);if(0>T)return h.scale(M.eye,K,I/J),M.tilt=0,M;var V=Math.sqrt(T);const W=K[1]*R;T=N+S;V=0<L?-V+W:V+W;if(1E-8>Math.abs(T))return 1E-8>J?(M.eye[0]=0,M.eye[1]=0,M.eye[2]=G):h.scale(M.eye,K,I/J),M.tilt=0,t(M.eye),r(M,F);M.eye[1]=V/T;G*=O;V=M.eye[1]*M.eye[1];
O=1-V;T=Math.sqrt(O);P=N*V+H*H*P-2*L*G*M.eye[1]*T*R+O*S;if(1E-8>Math.abs(P))return h.scale(M.eye,K,I/J),M.tilt=0,t(M.eye),r(M,F);M.eye[0]=(O*(I*K[0]-Q*K[0])-G*T*(K[0]*M.eye[1]*L+K[2]*H))/P;M.eye[2]=(O*(I*K[2]-Q*K[2])-G*T*(K[2]*M.eye[1]*L-K[0]*H))/P;h.scale(M.eye,M.eye,I);t(M.eye);return r(M,F)}function t(F){const G=F[1];F[1]=-F[2];F[2]=G}function r(F,G){G=z(G,F.heading,F.tilt);F.up=G.up;return F}function x(F,G,L){G=h.length(G);L=b.asinClamped(L/(Math.sqrt(L*L+G*G-2*L*G*Math.cos(Math.PI-F))/Math.sin(F)));
return b.rad2deg(F-L)}function u(F,G,L){F=b.deg2rad(F);G=h.length(G);return b.asinClamped(L/(G/Math.sin(F)))+F}function E(F,G,L,H,M){function K(J){const P=Math.PI/2;J=m.cyclical2PI.normalize(J,-P);J>P&&(J=Math.PI-J);return J}var I=G.latitude;var O=f.getReferenceEllipsoid(F.spatialReference).radius;G=G.longitude;var Q=d.getLonDeltaForDistance(I,L,O)/2;L=G-Q;G+=Q;I=b.deg2rad(I);I=(1+Math.sin(I))/(1-Math.sin(I));Q=(I+1)*Math.tan(H/O/2);I=1.5*Math.PI-2*Math.atan(.5*(Q+Math.sqrt(4*I+Q*Q)));H=I+H/O;I=K(I);
H=K(H);H<I&&(O=H,H=I,I=O);I=Math.max(b.rad2deg(I),-90);H=Math.min(b.rad2deg(H),90);G=p.monotonic(L,G);180<G-L&&(O=(G-L-180)/2,L+=O,G-=O);O=F.spatialReference&&F.spatialReference.isGeographic?F.spatialReference:l.WGS84;M?(M.xmin=L,M.ymin=I,M.xmax=G,M.ymax=H,M.spatialReference=O):M=new n(L,I,G,H,O);F.spatialReference&&F.spatialReference.isWebMercator&&k.geographicToWebMercator(M,!1,M);return M}const y=w.fromValues(0,0,1),A=h.normalize(w.create(),w.fromValues(1,1,1)),p=new m.Cyclical(-180,180),B=g.create(),
D=w.create(),C=w.create();g=Object.freeze({__proto__:null,headingTiltToDirectionUp:z,directionToHeadingTilt:v,eyeForCenterWithHeadingTilt:q,lookAtTiltToEyeTilt:x,eyeTiltToLookAtTilt:u,toExtent:E});a.cameraUtilsSpherical=g;a.directionToHeadingTilt=v;a.eyeForCenterWithHeadingTilt=q;a.eyeTiltToLookAtTilt=u;a.headingTiltToDirectionUp=z;a.lookAtTiltToEyeTilt=x;a.toExtent=E})},"esri/views/support/spatialReferenceSupport":function(){define(["exports","../../geometry/support/SupportedGCSWkids","../ViewingMode"],
function(a,b,c){a.isSpatialReferenceSupported=function(g,h){return null==g?!1:null==h?!0:h===c.ViewingMode.Local?g.isGeographic?g.isWGS84||g.wkid===b.SupportedGCSWkids.CGCS2000:!0:g.isWebMercator||g.isWGS84||g.wkid===b.SupportedGCSWkids.CGCS2000||g.wkid===b.SupportedGCSWkids.GCSMARS2000||g.wkid===b.SupportedGCSWkids.GCSMARS2000_SPHERE||g.wkid===b.SupportedGCSWkids.GCSMOON2000};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/gamepadAndKeyboardUtils":function(){define(["exports",
"../../chunks/vec3"],function(a,b){function c(g){let h=g*g;0>g&&(h*=-1);return h}a.extractTransformation=function(g,h,w){const n=g.state;g=g.device;h="forward-down"===h.tiltDirection?1:-1;"standard"===g.deviceType?(w.translation[0]=c(n.axes[0]),w.translation[1]=c(n.axes[1]),w.translation[2]=c(n.buttons[7])-c(n.buttons[6]),w.heading=c(n.axes[2]),w.tilt=c(n.axes[3])):"spacemouse"===g.deviceType&&(w.translation[0]=1.2*c(n.axes[0]),w.translation[1]=1.2*c(n.axes[1]),w.translation[2]=2*-c(n.axes[2]),w.heading=
1.2*c(n.axes[5]),w.tilt=1.2*c(n.axes[3]));w.tilt*=h;b.scale(w.translation,w.translation,1);return w};a.extractTransformationKeyboard=function(g,h){h.translation[0]=g[1]-g[0];h.translation[1]=g[3]-g[2];h.translation[2]=g[4]-g[5];h.heading=g[7]-g[6];h.tilt=g[8]-g[9];h.zoom=g[10]-g[11];return h};a.isZeroTransformation=function(g){return 0===g.translation[0]&&0===g.translation[1]&&0===g.translation[2]&&0===g.heading&&0===g.tilt&&0===g.zoom};a.quadraticAccentuation=c;a.resetTransformation=function(g){g.translation[0]=
0;g.translation[1]=0;g.translation[2]=0;g.heading=0;g.tilt=0;return g};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/KeyboardNavigation":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../ViewingMode","../../state/controllers/GamepadKeyboardController","../../../input/InputHandler"],function(a,b,c,g,h){var w;(function(n){n[n.LEFT=0]="LEFT";n[n.RIGHT=1]="RIGHT";n[n.FORWARD=2]="FORWARD";n[n.BACKWARD=3]="BACKWARD";n[n.UP=4]="UP";
n[n.DOWN=5]="DOWN";n[n.HEADINGLEFT=6]="HEADINGLEFT";n[n.HEADINGRIGHT=7]="HEADINGRIGHT";n[n.TILTUP=8]="TILTUP";n[n.TILTDOWN=9]="TILTDOWN";n[n.ZOOMIN=10]="ZOOMIN";n[n.ZOOMOUT=11]="ZOOMOUT"})(w||(w={}));h=function(n){function f(k,e){var d=n.call(this,!0)||this;d.view=k;d.disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:c.ViewingMode.Local};d.keyToNumber={[e.left]:w.LEFT,[e.right]:w.RIGHT,[e.forward]:w.FORWARD,[e.backward]:w.BACKWARD,[e.up]:w.UP,[e.down]:w.DOWN,[e.headingLeft]:w.HEADINGLEFT,
[e.headingRight]:w.HEADINGRIGHT,[e.tiltUp]:w.TILTUP,[e.tiltDown]:w.TILTDOWN,[e.zoomIn]:w.ZOOMIN,[e.zoomOut]:w.ZOOMOUT};d.registerIncoming("key-down",null,m=>d._handleKeyDown(m));d.registerIncoming("key-up",null,m=>d._handleKeyUp(m));d.registerIncoming("blur",null,()=>d._handleBlur());return d}b._inheritsLoose(f,n);var l=f.prototype;l._handleKeyDown=function(k){if(!k.data.native.ctrlKey&&!k.data.native.metaKey){var e=this.keyToNumber[k.data.key];null!=e&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||
(this.cameraControllerKeyboard=new g.GamepadKeyboardController({view:this.view,disableMovements:this.disableMovements}),this.view.state.switchCameraController(this.cameraControllerKeyboard)),this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(e),k.stopPropagation()))}};l._handleBlur=function(){this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.finishController(),this.cameraControllerKeyboard=null)};l._handleKeyUp=
function(k){if(!k.data.native.ctrlKey&&!k.data.native.metaKey){var e=this.keyToNumber[k.data.key];null!=e&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(e),k.stopPropagation())}};return f}(h.InputHandler);a.KeyboardNavigation=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler".split(" "),
function(a,b,c,g,h,w){w=function(n){function f(l,k){var e=n.call(this,!0)||this;e.view=l;e.registerIncoming("mouse-wheel",k,d=>e._handleMouseWheel(d));return e}b._inheritsLoose(f,n);f.prototype._handleMouseWheel=function(l){if(this.view.navigation.mouseWheelZoomEnabled){var k=l.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new g.ZoomStepController({view:this.view,mode:"interaction"}):new h.ZoomStepController({view:this.view,mode:"interaction"}),
this.view.state.switchCameraController(this.cameraController));this.cameraController.zoomStep(-1/60*k.deltaY,c.createScreenPointArray(k.x,k.y));l.preventDefault();l.stopPropagation()}};return f}(w.InputHandler);a.MouseWheelZoom=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../state/controllers/global/PinchAndPanController ../../state/controllers/local/PinchAndPanController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(a,b,c,g,h,w){h=function(n){function f(k,e,d){var m=n.call(this,!0)||this;m.view=k;m.pointerAction=e;m.lastEndTimestamp=0;m.lastTimestamp=0;m.registerIncoming("drag",d,z=>m._handleDrag(z));return m}b._inheritsLoose(f,n);var l=f.prototype;l._handleDrag=function(k){if("mouse"!==k.data.pointerType||w.eventMatchesMousePointerAction(k.data,this.pointerAction)){var e=k.timestamp-this.lastEndTimestamp;e=this.momentum&&this.momentum.active&&40>e;switch(k.data.action){case "start":case "update":if(e)break;
this.controller&&this.controller.active?2<k.data.timestamp-this.lastTimestamp&&(this.controller.update(k.data),this.lastTimestamp=k.timestamp):this._startController(k);break;case "end":case "removed":this._endController(k,!0);break;case "added":this._endController(k,!1),this._startController(k)}k.stopPropagation()}};l._endController=function(k,e){this.controller&&this.controller.active&&(this.lastEndTimestamp=k.timestamp,k=this.controller.end(k.data),e&&k&&(this.momentum=k,this.view.state.switchCameraController(this.momentum)));
this.controller=null};l._startController=function(k){this.controller=this._createController();this.view.state.switchCameraController(this.controller);this.controller.begin(k.data);this.lastTimestamp=k.timestamp};l._createController=function(){return this.view.state.isGlobal?new c.PinchAndPanController({view:this.view}):new g.PinchAndPanController({view:this.view})};return f}(h.InputHandler);a.PinchAndPanNavigation=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/projectionEllipsoid ../../../../../geometry/support/axisAngle ../../../../../geometry/support/plane ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/common ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../utils/navigationUtils ../../../support/mathUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H,M,K){a.PinchAndPanController=function(I){function O(J){J=I.call(this,J)||this;J.view=null;J.smoothRotation=new u.ExponentialFalloff(.05);J.rotationAxis=m.create();J.panningPlane=q.create();J.smoothScaling=new u.ExponentialFalloff(.05);J.zoomCenterScreen=h.createScreenPointArray();J.zoomMomentumEstimator=new K.ZoomMomentumEstimator;J.rotationMomentumEstimator=new M.RotationMomentumEstimator;J.panSphericalMomentumEstimator=new H.PanSphericalMomentumEstimator;
J.panPlanarMomentumEstimator=new L.PanPlanarMomentumEstimator;J.adjustedSphere=t.create();J.tmp3d=m.create();J.tmpScreenPointArray=h.createScreenPointArray();J.beginScreenPoint=h.createScreenPointArray();J.beginScenePoint=m.create();J.screenPickPoint=h.createScreenPointArray();J.navMode=C.NavigationMode.Horizontal;J.tmpInteractionDirection=m.create();J.constraintOptions={selection:x.ConstraintTypes.ALL,interactionType:x.InteractionType.NONE,interactionFactor:0,interactionStartCamera:new G.default,
interactionDirection:null,tiltMode:x.TiltMode.TUMBLE};return J}b._inheritsLoose(O,I);var Q=O.prototype;Q.begin=function(J){if(this.active){var P=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=P;this.rotationMomentumEstimator.enabled=P;this.panPlanarMomentumEstimator.enabled=P;this.panSphericalMomentumEstimator.enabled=P;this.beginHeading=-F.cyclicalPI.normalize(g.deg2rad(this.view.camera.heading));this.beginRadius=J.radius;this.pointerCount=J.pointers.size;this.beginAngle=
J.angle;this.smoothRotation.reset();h.screenPointObjectToArray(J.center,this.screenPickPoint);e.copy(this.beginScreenPoint,this.screenPickPoint);P=z.getReferenceEllipsoid(this.view.spatialReference);var N=C.pickPointAndInitSphere(this.intersectionHelper,this.startCamera,this.screenPickPoint,!0,P);this.scenePickPoint=N.scenePickPoint;this.sphere=N.sphere;d.copy(this.beginScenePoint,this.scenePickPoint);this.navMode=C.decideNavigationMode(this.startCamera,this.screenPickPoint,N.hasGeometryIntersection,
P);this.navMode===C.NavigationMode.Vertical&&this._preparePlanarPanMode(J);this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}};Q._preparePlanarPanMode=function(J){var P=d.negate(this.tmp3d,this.startCamera.viewForward);q.fromPositionAndNormal(this.scenePickPoint,P,this.panningPlane);var N=h.createScreenPointArray(this.screenPickPoint[0],0);P=m.create();var R=d.length(this.startCamera.eye);this.adjustedSphere[3]=R<this.sphere[3]?R-100:this.sphere[3];C.sphereOrPlanePointFromScreenPoint(this.adjustedSphere,
this.startCamera,N,P);N=h.createRenderScreenPointArray3();this.startCamera.projectToRenderScreen(P,N);this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],.9*N[1]);this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint)&&q.fromPositionAndNormal(this.scenePickPoint,q.normal(this.panningPlane),this.panningPlane);P=m.create();N=m.create();R=m.create();d.subtract(P,this.scenePickPoint,this.currentCamera.eye);d.normalize(P,P);var S=5*Math.max(Math.abs(this.view.camera.position.z),
50);const T=this.view._stage.renderView.getMinimalDepthForArea(null,this.screenPickPoint[0],this.screenPickPoint[1],this.view.state.camera,80);S=T?Math.min(T,S):S;d.copy(R,d.add(N,this.currentCamera.eye,d.scale(N,P,S)));this.panningPlane[3]=-d.dot(this.panningPlane,R);this.startCamera.center=d.add(N,this.startCamera.eye,d.scale(N,this.startCamera.viewForward,S));J=h.screenPointObjectToArray(J.center,this.tmpScreenPointArray);C.intersectPlaneFromScreenPointAtEye(this.panningPlane,this.startCamera,
J,this.beginScenePoint)};Q.update=function(J){if(this.active){this.currentCamera.copyFrom(this.startCamera);var P=1<J.pointers.size;this.navMode===C.NavigationMode.Horizontal?(P&&this._zoomSpherical(J),this._panningSpherical(J),P&&this._rotateSpherical(J)):(P&&this._zoomPlanar(J),this._panningPlanar(J),P&&this._rotatePlanar(J))}};Q.end=function(J){J.pointers.size===this.pointerCount&&this.update(J);this.finishController();if(J=this.zoomMomentumEstimator.evaluateMomentum())return this.navMode===C.NavigationMode.Horizontal?
new D.ZoomSphericalMomentumController({view:this.view,momentum:J,screenCenter:this.zoomCenterScreen,sceneCenter:this.beginScenePoint,radius:this.sphere[3]}):new B.ZoomPlanarMomentumController({view:this.view,momentum:J,zoomCenter:this.beginScenePoint});if(J=this.rotationMomentumEstimator.evaluateMomentum())return new p.RotationMomentumController({view:this.view,momentum:J,center:this.sphere,axis:this.rotationAxis});if(this.navMode===C.NavigationMode.Horizontal){if(J=this.panSphericalMomentumEstimator.evaluateMomentum())return new A.PanSphericalMomentumController({view:this.view,
momentum:J})}else if(J=this.panPlanarMomentumEstimator.evaluateMomentum())return new y.PanPlanarMomentumController({view:this.view,momentum:J});return null};Q._zoomSpherical=function(J){const P=this.beginRadius/J.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(J.radius,40),120);this.smoothScaling.update(P);C.applyZoomOnSphere(this.sphere,this.currentCamera,this.smoothScaling.value);h.screenPointObjectToArray(J.center,this.zoomCenterScreen);this.zoomMomentumEstimator.add(this.smoothScaling.value,
.001*J.timestamp);this.constraintOptions.interactionType=x.InteractionType.ZOOM;this.constraintOptions.interactionFactor=r.pixelDistanceToInteractionFactor(J.radius-this.beginRadius);r.applyAll(this.view,this.currentCamera,this.constraintOptions)};Q._panningSpherical=function(J){const P=h.screenPointObjectToArray(J.center,this.tmpScreenPointArray);C.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,P,this.tmp3d);C.preserveHeadingThreshold(this.beginScenePoint,d.dot(this.currentCamera.up,
this.beginScenePoint),this.sphere[3],this.beginHeading,this.view.camera.tilt,this.startCamera)?(C.applyPanSphericalPreserveHeading(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(P,this.tmp3d,.001*J.timestamp,this.startCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):(C.applyPanSphericalDirectRotation(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,
!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(P,this.tmp3d,.001*J.timestamp,this.startCamera,this.sphere[3],this.view.camera.tilt));this.constraintOptions.interactionType=x.InteractionType.PAN;this.constraintOptions.interactionFactor=r.pixelDistanceToInteractionFactor(this.screenPickPoint,P);r.applyAll(this.view,this.currentCamera,this.constraintOptions)};Q._rotateSpherical=function(J){d.normalize(this.rotationAxis,this.scenePickPoint);this.currentCamera.aboveGround||d.negate(this.rotationAxis,
this.rotationAxis);var P=this.smoothRotation.value,N=C.normalizeRotationDelta(J.angle-P);P+=N;this.smoothRotation.gain=.00125*Math.min(Math.max(J.radius,40),120);this.smoothRotation.update(P);N=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(N,.001*J.timestamp);C.applyRotation(this.currentCamera,this.sphere,v.wrapAxisAngle(this.rotationAxis,N));this.constraintOptions.interactionType=x.InteractionType.TUMBLE;this.constraintOptions.interactionFactor=r.pixelDistanceToInteractionFactor(J.radius*
P);r.applyAll(this.view,this.currentCamera,this.constraintOptions)};Q._panningPlanar=function(J){const P=h.screenPointObjectToArray(J.center,this.tmpScreenPointArray);C.intersectPlaneFromScreenPointAtEye(this.panningPlane,this.currentCamera,P,this.tmp3d)&&(C.applyPanPlanar(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(P,this.tmp3d,.001*J.timestamp),this.constraintOptions.interactionType=x.InteractionType.PAN,this.constraintOptions.interactionFactor=r.pixelDistanceToInteractionFactor(this.beginScreenPoint,
P),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),r.applyAll(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)};Q._zoomPlanar=function(J){const P=this.beginRadius/J.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(J.radius,40),120);this.smoothScaling.update(P);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*J.timestamp);C.applyZoomToPoint(this.currentCamera,
this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionType=x.InteractionType.ZOOM;this.constraintOptions.interactionFactor=r.pixelDistanceToInteractionFactor(J.radius-this.beginRadius);r.applyAll(this.view,this.currentCamera,this.constraintOptions)};Q._rotatePlanar=function(J){d.copy(this.rotationAxis,this.beginScenePoint);this.currentCamera.aboveGround||d.negate(this.rotationAxis,this.rotationAxis);var P=this.smoothRotation.value;
let N=J.angle-P;N=C.normalizeRotationDelta(N);this.smoothRotation.gain=.00125*Math.min(Math.max(J.radius,40),120);this.smoothRotation.update(P+N);P=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(P,.001*J.timestamp);C.applyRotation(this.currentCamera,this.sphere,v.wrapAxisAngle(this.rotationAxis,P));this.constraintOptions.interactionType=x.InteractionType.TUMBLE;this.constraintOptions.interactionFactor=r.pixelDistanceToInteractionFactor(J.radius*P);r.applyAll(this.view,
this.currentCamera,this.constraintOptions)};b._createClass(O,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return O}(E.InteractiveController);c.__decorate([w.property({constructOnly:!0})],a.PinchAndPanController.prototype,"view",void 0);a.PinchAndPanController=c.__decorate([k.subclass("esri.views.3d.state.controllers.global.PinchAndPanController")],a.PinchAndPanController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/util":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function g(w){this._gain=w}var h=g.prototype;h.reset=function(w){this._value=w};h.update=function(w){this._value=void 0===this._value?w:this._gain*w+(1-this._gain)*this._value};b._createClass(g,[{key:"gain",set:function(w){this._gain=w}},{key:"value",get:function(){return void 0===this._value?0:this._value}}]);return g}();a.ExponentialFalloff=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ./MomentumController ../../../camera/constraintUtils/common".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){a.PanPlanarMomentumController=function(z){function v(q){q=z.call(this,q)||this;q.interactionType=d.InteractionType.PAN;q.tmpPan=k.create();return q}b._inheritsLoose(v,z);v.prototype.momentumStep=function(q,t){q=this.momentum.value(q);l.scale(this.tmpPan,this.momentum.direction,q);t.eye=l.subtract(m,t.eye,this.tmpPan);t.center=l.subtract(m,t.center,this.tmpPan);this.constraintOptions.interactionDirection=this.tmpPan};return v}(e.MomentumController);c.__decorate([g.property({constructOnly:!0})],
a.PanPlanarMomentumController.prototype,"momentum",void 0);a.PanPlanarMomentumController=c.__decorate([f.subclass("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],a.PanPlanarMomentumController);const m=k.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../ViewAnimation ../../../camera/constraintUtils ../../../camera/constraintUtils/common ../AnimationController ../../../webgl-engine/lib/Camera".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m){a.MomentumController=function(z){function v(t){t=z.call(this,t)||this;t.view=null;t.beginCamera=new m.default;t.elapsedTimeSec=0;t.constraintOptions={selection:e.ConstraintTypes.ALL,interactionType:e.InteractionType.PAN,interactionFactor:0,interactionStartCamera:new m.default,interactionDirection:null,tiltMode:e.TiltMode.TUMBLE};return t}b._inheritsLoose(v,z);var q=v.prototype;q.initialize=function(){this.constraintOptions.interactionType=this.interactionType;this.viewAnimation=
new l};q.onControllerStart=function(t){this.beginCamera.copyFrom(t);this.constraintOptions.interactionStartCamera=this.beginCamera;z.prototype.onControllerStart.call(this,t)};q.stepController=function(t,r){r.copyViewFrom(this.beginCamera);this.elapsedTimeSec+=t;this.momentumStep(this.elapsedTimeSec,r);k.applyAll(this.view,r,this.constraintOptions)};b._createClass(v,[{key:"steppingFinished",get:function(){return this.momentum.isFinished(this.elapsedTimeSec)}}]);return v}(d.AnimationController);c.__decorate([g.property({constructOnly:!0})],
a.MomentumController.prototype,"view",void 0);a.MomentumController=c.__decorate([f.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],a.MomentumController);Object.defineProperty(a,"InteractionType",{enumerable:!0,get:()=>e.InteractionType});Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ./MomentumController ../../utils/navigationUtils ../../../camera/constraintUtils/common".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m){const z=k.create(),v=k.create();a.PanSphericalMomentumController=function(q){function t(r){r=q.call(this,r)||this;r.interactionType=m.InteractionType.PAN;return r}b._inheritsLoose(t,q);t.prototype.momentumStep=function(r,x){const u=this.momentum.value1(r);r=this.momentum.value2(r);l.copy(v,x.eye);l.normalize(v,v);l.cross(this.momentum.axis2,v,this.momentum.axis1);d.applyRotationWithTwoAxes(x,z,this.momentum.axis1,u,this.momentum.axis2,r)};return t}(e.MomentumController);
c.__decorate([g.property({constructOnly:!0})],a.PanSphericalMomentumController.prototype,"momentum",void 0);a.PanSphericalMomentumController=c.__decorate([f.subclass("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],a.PanSphericalMomentumController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ./MomentumController ../../utils/navigationUtils ../../../camera/constraintUtils/common".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m){a.RotationMomentumController=function(z){function v(q){q=z.call(this,q)||this;q.interactionType=m.InteractionType.TUMBLE;return q}b._inheritsLoose(v,z);v.prototype.momentumStep=function(q,t){q=this.momentum.value(q);d.applyRotation(t,this.center,k.wrapAxisAngle(this.axis,q))};b._createClass(v,[{key:"center",set:function(q){this._set("center",l.clone(q))}},{key:"axis",set:function(q){this._set("axis",l.clone(q))}}]);return v}(e.MomentumController);c.__decorate([g.property({constructOnly:!0})],
a.RotationMomentumController.prototype,"momentum",void 0);c.__decorate([g.property({constructOnly:!0})],a.RotationMomentumController.prototype,"center",null);c.__decorate([g.property({constructOnly:!0})],a.RotationMomentumController.prototype,"axis",null);a.RotationMomentumController=c.__decorate([f.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],a.RotationMomentumController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ./MomentumController ../../utils/navigationUtils ../../../camera/constraintUtils/common".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m){a.ZoomPlanarMomentumController=function(z){function v(q){q=z.call(this,q)||this;q.interactionType=m.InteractionType.ZOOM;q.constraintOptions.interactionDirection=k.create();return q}b._inheritsLoose(v,z);v.prototype.momentumStep=function(q,t){l.copy(this.constraintOptions.interactionDirection,t.eye);q=this.momentum.valueDelta(0,q);d.applyZoomToPoint(t,this.zoomCenter,q,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionDirection=l.direction(this.constraintOptions.interactionDirection,
t.eye,this.constraintOptions.interactionDirection)};b._createClass(v,[{key:"zoomCenter",set:function(q){this._set("zoomCenter",k.clone(q))}}]);return v}(e.MomentumController);c.__decorate([g.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"momentum",void 0);c.__decorate([g.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"zoomCenter",null);a.ZoomPlanarMomentumController=c.__decorate([f.subclass("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],
a.ZoomPlanarMomentumController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ./MomentumController ../../utils/navigationUtils ../../../camera/constraintUtils/common".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q){a.ZoomSphericalMomentumController=function(t){function r(u){u=t.call(this,u)||this;u.interactionType=q.InteractionType.ZOOM;u.radius=0;u.tmpSceneCenter=k.create();u.tmpZoomAxisAngle=e.create();u.sphere=d.create();return u}b._inheritsLoose(r,t);var x=r.prototype;x.initialize=function(){this.sphere[3]=this.radius};x.momentumStep=function(u,E){u=this.momentum.valueDelta(0,u);v.applyZoomOnSphere(this.sphere,E,u);this.constraintOptions.interactionType=q.InteractionType.ZOOM;
m.applyAll(this.view,E,this.constraintOptions);v.sphereOrPlanePointFromScreenPoint(this.sphere,E,this.screenCenter,this.tmpSceneCenter);e.fromPoints(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle);v.applyRotation(E,this.sphere,this.tmpZoomAxisAngle);this.constraintOptions.interactionType=q.InteractionType.PAN};b._createClass(r,[{key:"screenCenter",set:function(u){this._set("screenCenter",g.createScreenPointArray(u[0],u[1]))}},{key:"sceneCenter",set:function(u){this._set("sceneCenter",
k.clone(u))}}]);return r}(z.MomentumController);c.__decorate([h.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"momentum",void 0);c.__decorate([h.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"screenCenter",null);c.__decorate([h.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"sceneCenter",null);c.__decorate([h.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"radius",void 0);a.ZoomSphericalMomentumController=
c.__decorate([l.subclass("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],a.ZoomSphericalMomentumController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/vec3 ../../chunks/vec3f64 ./FilteredFiniteDifference ./Momentum".split(" "),function(a,b,c,g,h,w){let n=function(f){function l(k,e,d,m,z){k=f.call(this,k,e,d)||this;k.sceneVelocity=m;
k.direction=z;return k}b._inheritsLoose(l,f);l.prototype.value=function(k){return f.prototype.valueFromInitialVelocity.call(this,this.sceneVelocity,k)};return l}(w.Momentum);w=function(){function f(k=300,e=12,d=.84){this.minimumInitialVelocity=k;this.stopVelocity=e;this.friction=d;this.enabled=!0;this.time=new h.FilteredFiniteDifference(.6);this.screen=[new h.FilteredFiniteDifference(.4),new h.FilteredFiniteDifference(.4)];this.scene=[new h.FilteredFiniteDifference(.6),new h.FilteredFiniteDifference(.6),
new h.FilteredFiniteDifference(.6)];this.tmpDirection=g.create()}var l=f.prototype;l.add=function(k,e,d){!this.enabled||this.time.hasLastValue&&.015>this.time.computeDelta(d)||(this.screen[0].update(k[0]),this.screen[1].update(k[1]),this.scene[0].update(e[0]),this.scene[1].update(e[1]),this.scene[2].update(e[2]),this.time.update(d))};l.reset=function(){this.screen[0].reset();this.screen[1].reset();this.scene[0].reset();this.scene[1].reset();this.scene[2].reset();this.time.reset()};l.evaluateMomentum=
function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var k=this.screen[0].filteredDelta;const e=this.screen[1].filteredDelta;k=Math.sqrt(k*k+e*e)/this.time.filteredDelta;return Math.abs(k)<this.minimumInitialVelocity?null:this.createMomentum(k,this.stopVelocity,this.friction)};l.createMomentum=function(k,e,d){c.set(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);const m=c.length(this.tmpDirection);0<m&&c.scale(this.tmpDirection,
this.tmpDirection,1/m);return new n(k,e,d,m/this.time.filteredDelta,this.tmpDirection)};return f}();a.PanPlanarMomentum=n;a.PanPlanarMomentumEstimator=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function g(w){this.gain=w}var h=g.prototype;h.update=function(w){if(this.hasLastValue){const n=this.computeDelta(w);this._updateDelta(n)}this.lastValue=
w};h.reset=function(){this.filteredDelta=this.lastValue=void 0};h.computeDelta=function(w){return w-this.lastValue};h._updateDelta=function(w){this.filteredDelta=this.hasFilteredDelta?(1-this.gain)*this.filteredDelta+this.gain*w:w};b._createClass(g,[{key:"hasLastValue",get:function(){return void 0!==this.lastValue}},{key:"hasFilteredDelta",get:function(){return void 0!==this.filteredDelta}}]);return g}();a.FilteredFiniteDifference=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/Momentum":function(){define(["exports",
"../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function g(w,n,f){this._initialVelocity=w;this._stopVelocity=n;this._friction=f;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}var h=g.prototype;h.isFinished=function(w){return w>this.duration};h.value=function(w){return this.valueFromInitialVelocity(this._initialVelocity,w)};h.valueDelta=function(w,n){const f=this.value(w);return this.value(w+n)-f};h.valueFromInitialVelocity=
function(w,n){n=Math.min(n,this.duration);const f=1-this.friction;return w*(f**n-1)/Math.log(f)};b._createClass(g,[{key:"duration",get:function(){return this._duration}},{key:"friction",get:function(){return this._friction}}]);return g}();a.Momentum=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/vec2f64 ../../chunks/vec3 ../../chunks/vec3f64 ../3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),
function(a,b,c,g,h,w,n,f,l){let k=function(e){function d(z,v,q,t,r,x=0,u){z=e.call(this,z,v,q)||this;z.angularVelocity1=t;z.axis1=r;z.angularVelocity2=x;z.axis2=u;return z}b._inheritsLoose(d,e);var m=d.prototype;m.value1=function(z){return e.prototype.valueFromInitialVelocity.call(this,this.angularVelocity1,z)};m.value2=function(z){return e.prototype.valueFromInitialVelocity.call(this,this.angularVelocity2,z)};return d}(l.Momentum);l=function(){function e(m=300,z=12,v=.84){this.minimumInitialVelocity=
m;this.stopVelocity=z;this.friction=v;this.enabled=!0;this.tmpAxis1=h.create();this.tmpAxis2=h.create();this.tmpAngles=c.create();this.time=new n.FilteredFiniteDifference(.3);this.screen=[new n.FilteredFiniteDifference(.4),new n.FilteredFiniteDifference(.4)];this.angle1=new f.FilteredValue(.6);this.angle2=new f.FilteredValue(.6);this.axis1=h.create();this.axis2=h.create();this.lastScene=h.create()}var d=e.prototype;d.addMomentumDirectRotation=function(m,z,v,q,t,r){if(this.enabled){if(this.time.hasLastValue){if(.01>
this.time.computeDelta(v))return;q=w.rotationAngleAndAxisDirectRotation(this.lastScene,z,this.tmpAxis2,q,t,r);this.angle2.update(0);1E-5>g.squaredLength(this.tmpAxis2)?q=0:g.normalize(this.axis1,this.tmpAxis2);this.angle1.update(q);g.copy(this.lastScene,z)}this.screen[0].update(m[0]);this.screen[1].update(m[1]);this.time.update(v)}};d.addMomentumPreserveHeading=function(m,z,v,q,t,r,x){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(v))return;w.rotationAnglesAndAxesHeadingPreserving(this.lastScene,
z,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,q,t,r,x,!1);1E-5>g.squaredLength(this.tmpAxis2)?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),g.normalize(this.axis1,this.tmpAxis1),g.normalize(this.axis2,this.tmpAxis2));g.copy(this.lastScene,z)}this.screen[0].update(m[0]);this.screen[1].update(m[1]);this.time.update(v)}};d.reset=function(){this.screen[0].reset();this.screen[1].reset();this.angle1.reset();this.angle2.reset();
this.time.reset()};d.evaluateMomentum=function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var m=this.screen[0].filteredDelta;const z=this.screen[1].filteredDelta;m=Math.sqrt(m*m+z*z)/this.time.filteredDelta;return Math.abs(m)<this.minimumInitialVelocity?null:this.createMomentum(m,this.stopVelocity,this.friction)};d.createMomentum=function(m,z,v){return new k(m,z,v,this.angle1.filteredValue/this.time.filteredDelta,this.axis1,this.angle2.filteredValue/this.time.filteredDelta,this.axis2)};
return e}();a.PanSphericalMomentum=k;a.PanSphericalMomentumEstimator=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/FilteredValue":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function g(w){this.gain=w}var h=g.prototype;h.update=function(w){this.filteredValue=this.hasFilteredValue?(1-this.gain)*this.filteredValue+this.gain*w:w};h.reset=function(){this.filteredValue=void 0};b._createClass(g,[{key:"hasFilteredValue",
get:function(){return void 0!==this.filteredValue}}]);return g}();a.FilteredValue=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./MomentumEstimator"],function(a,b,c){c=function(g){function h(w=3,n=.01,f=.95,l=12){return g.call(this,w,n,f,l)||this}b._inheritsLoose(h,g);h.prototype.add=function(w,n){if(this.value.hasLastValue){const f=this.value.lastValue;for(w-=f;w>Math.PI;)w-=
2*Math.PI;for(;w<-Math.PI;)w+=2*Math.PI;w=f+w}g.prototype.add.call(this,w,n)};return h}(c.MomentumEstimator);a.RotationMomentumEstimator=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/MomentumEstimator":function(){define(["exports","../../core/mathUtils","./FilteredFiniteDifference","./Momentum"],function(a,b,c,g){let h=function(){function w(f=2.5,l=.01,k=.95,e=12){this.minimumInitialVelocity=f;this.stopVelocity=l;this.friction=k;this.maxVelocity=e;this.enabled=!0;this.value=
new c.FilteredFiniteDifference(.8);this.time=new c.FilteredFiniteDifference(.3)}var n=w.prototype;n.add=function(f,l){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(l))return;if(this.value.hasFilteredDelta){const k=this.value.computeDelta(f);0>this.value.filteredDelta*k&&this.value.reset()}}this.time.update(l);this.value.update(f)}};n.reset=function(){this.value.reset();this.time.reset()};n.evaluateMomentum=function(){if(!this.enabled||!this.value.hasFilteredDelta)return null;
let f=this.value.filteredDelta/this.time.filteredDelta;f=b.clamp(f,-this.maxVelocity,this.maxVelocity);return Math.abs(f)<this.minimumInitialVelocity?null:this.createMomentum(f,this.stopVelocity,this.friction)};n.createMomentum=function(f,l,k){return new g.Momentum(f,l,k)};return w}();a.MomentumEstimator=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./Momentum","./MomentumEstimator"],
function(a,b,c,g){let h=function(w){function n(l,k,e){return w.call(this,l,k,e)||this}b._inheritsLoose(n,w);var f=n.prototype;f.value=function(l){l=w.prototype.value.call(this,l);return Math.exp(l)};f.valueDelta=function(l,k){const e=w.prototype.value.call(this,l);l=w.prototype.value.call(this,l+k);return Math.exp(l-e)};return n}(c.Momentum);c=function(w){function n(l=2.5,k=.01,e=.95,d=12){return w.call(this,l,k,e,d)||this}b._inheritsLoose(n,w);var f=n.prototype;f.add=function(l,k){w.prototype.add.call(this,
Math.log(l),k)};f.createMomentum=function(l,k,e){return new h(l,k,e)};return n}(g.MomentumEstimator);a.ZoomMomentum=h;a.ZoomMomentumEstimator=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../../../geometry/support/plane ../../../camera/constraintUtils ../../../camera/constraintUtils/common ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D){const C=d.fromValues(0,0,1);var F=16/180*Math.PI;a.PinchAndPanController=function(G){function L(M){M=G.call(this,M)||this;M.view=null;M.rotationValueSmooth=new t.ExponentialFalloff(.05);M.scalingValueSmooth=new t.ExponentialFalloff(.05);M.planeHorizontal=z.create();M.planeVertical=z.create();M.rotationMomentumEstimator=new B.RotationMomentumEstimator;M.panMomentumEstimator=new p.PanPlanarMomentumEstimator(300,12,.9);M.zoomMomentumEstimator=
new D.ZoomMomentumEstimator;M.beginCenter=d.create();M.tmpPoints=[];M.beginCenterScreen=h.createScreenPointArray();M.tmpCentroid3d=d.create();M.tmpCentroid2d=h.createScreenPointArray();M.tmp2d=h.createScreenPointArray();M.constraintOptions={selection:q.ConstraintTypes.ALL,interactionType:q.InteractionType.NONE,interactionFactor:0,interactionStartCamera:new A.default,interactionDirection:null,tiltMode:q.TiltMode.TUMBLE};return M}b._inheritsLoose(L,G);var H=L.prototype;H.begin=function(M){if(this.active){var K=
this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=K;this.rotationMomentumEstimator.enabled=K;this.panMomentumEstimator.enabled=K;this.beginRadius=M.radius;this.pointerCount=M.pointers.size;this.beginAngle=M.angle;this.rotationValueSmooth.reset();this.scalingValueSmooth.reset();h.screenPointObjectToArray(M.center,this.beginCenterScreen);z.fromNormalAndOffset(C,0,this.planeHorizontal);K=d.create();this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,
K);var I=d.create();e.negate(I,this.startCamera.viewForward);var O=d.create();e.copy(O,C);var Q=e.dot(I,O);this.panMode=g.asinClamped(0>Q?-Q:Q)>=F?y.NavigationMode.Horizontal:y.NavigationMode.Vertical;z.setOffsetFromPoint(this.planeHorizontal,this.planeHorizontal,K);this.startCamera.aboveGround||z.negate(this.planeHorizontal,this.planeHorizontal);if(this.panMode===y.NavigationMode.Vertical){e.scale(O,O,Q);e.subtract(this.planeVertical,I,O);e.normalize(this.planeVertical,this.planeVertical);z.setOffsetFromPoint(this.planeVertical,
this.planeVertical,K);I=d.create();O=d.create();Q=d.create();e.subtract(I,K,this.currentCamera.eye);e.normalize(I,I);K=5*Math.max(Math.abs(this.view.camera.position.z),50);const J=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),this.beginCenterScreen[0],this.beginCenterScreen[1],this.view.state.camera,80);e.copy(Q,e.add(O,this.currentCamera.eye,e.scale(O,I,J?Math.min(J,K):K)));this.planeVertical[3]=-e.dot(this.planeVertical,Q);this.computePlanePoints(M.pointers,
this.planeVertical,this.startCamera,this.tmpPoints)}else this.computePlanePoints(M.pointers,this.planeHorizontal,this.startCamera,this.tmpPoints);y.centroid(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}};H.update=function(M){if(this.active){this.currentCamera.copyFrom(this.startCamera);var K=1<M.pointers.size,I=this.panMode===y.NavigationMode.Horizontal?this.planeHorizontal:this.planeVertical,O=this.beginCenter;if(K){var Q=this.beginRadius/
M.radius;this.scalingValueSmooth.gain=.001875*Math.min(Math.max(M.radius,40),120);this.scalingValueSmooth.update(Q);y.applyZoomToPoint(this.currentCamera,O,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*M.timestamp);this.constraintOptions.interactionType=q.InteractionType.ZOOM;this.constraintOptions.interactionFactor=v.pixelDistanceToInteractionFactor(Math.abs(M.radius-this.beginRadius));v.applyAll(this.view,
this.currentCamera,this.constraintOptions)}this.computePlanePoints(M.pointers,I,this.currentCamera,this.tmpPoints);y.centroid(this.tmpPoints,this.tmpCentroid3d);h.screenPointObjectToArray(M.center,this.tmpCentroid2d);y.applyPanPlanar(this.currentCamera,O,this.tmpCentroid3d);this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*M.timestamp);this.constraintOptions.interactionType=q.InteractionType.PAN;this.constraintOptions.interactionFactor=v.pixelDistanceToInteractionFactor(this.beginCenterScreen,
this.tmpCentroid2d);v.applyAll(this.view,this.currentCamera,this.constraintOptions);K&&(K=this.planeHorizontal,I=this.rotationValueSmooth.value,Q=y.normalizeRotationDelta(M.angle-I),I+=Q,this.rotationValueSmooth.gain=.00125*Math.min(Math.max(M.radius,40),120),this.rotationValueSmooth.update(I),I=this.rotationValueSmooth.value-this.beginAngle,this.rotationMomentumEstimator.add(I,.001*M.timestamp),y.applyRotation(this.currentCamera,O,m.wrapAxisAngle(K,I)),this.constraintOptions.interactionType=q.InteractionType.TUMBLE,
this.constraintOptions.interactionFactor=v.pixelDistanceToInteractionFactor(Math.abs(M.radius*I)),v.applyAll(this.view,this.currentCamera,this.constraintOptions))}};H.end=function(M){M.pointers.size===this.pointerCount&&this.update(M);this.finishController();return(M=this.zoomMomentumEstimator.evaluateMomentum())?new E.ZoomPlanarMomentumController({view:this.view,momentum:M,zoomCenter:this.beginCenter}):(M=this.rotationMomentumEstimator.evaluateMomentum())?new u.RotationMomentumController({view:this.view,
momentum:M,center:this.beginCenter,axis:z.normal(this.planeHorizontal)}):(M=this.panMomentumEstimator.evaluateMomentum())?new x.PanPlanarMomentumController({view:this.view,momentum:M}):null};H.computePlanePoints=function(M,K,I,O){O.length=M.size;const Q=this.tmp2d;let J=0;M.forEach(P=>{Q[0]=P.x;Q[1]=P.y;void 0===O[J]&&(O[J]=d.create());y.intersectPlaneFromScreenPointAtEye(K,I,Q,O[J]);J+=1});return O};b._createClass(L,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);
return L}(r.InteractiveController);c.__decorate([w.property({constructOnly:!0})],a.PinchAndPanController.prototype,"view",void 0);a.PinchAndPanController=c.__decorate([k.subclass("esri.views.3d.state.controllers.local.PinchAndPanController")],a.PinchAndPanController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../input/InputHandler"],function(a,b,c){c=
function(g){function h(w,n){var f=g.call(this,!0)||this;f.view=w;f.registerIncoming("pointer-down",n,()=>f.view.state.stopActiveCameraController());return f}b._inheritsLoose(h,g);return h}(c.InputHandler);a.PointerDownCancelAnimation=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./SingleKey"],function(a,b,c){c=function(g){function h(w,n,f){n=g.call(this,n,f)||this;
n.view=w;return n}b._inheritsLoose(h,g);h.prototype.activate=function(){this.view.goTo({heading:0}).catch(()=>{})};return h}(c.SingleKey);a.SingleKeyResetHeading=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/SingleKey":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../input/InputHandler"],function(a,b,c){c=function(g){function h(w,n){var f=g.call(this,!0)||this;f.key=w;f.registerIncoming("key-down",n,l=>f._handleKeyDown(l));
return f}b._inheritsLoose(h,g);h.prototype._handleKeyDown=function(w){w.data.key===this.key&&(this.activate(),w.stopPropagation())};return h}(c.InputHandler);a.SingleKey=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./SingleKey"],function(a,b,c){c=function(g){function h(w,n,f){n=g.call(this,n,f)||this;n.view=w;return n}b._inheritsLoose(h,g);h.prototype.activate=function(){this.view.goTo({tilt:0}).catch(()=>
{})};return h}(c.SingleKey);a.SingleKeyResetTilt=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/screenUtils","../../state/controllers/RotateController","../../../input/InputHandler"],function(a,b,c,g,h){h=function(w){function n(f,l=!1){var k=w.call(this,!0)||this;k.view=f;k.invert=l;k.registerIncoming("vertical-two-finger-drag",e=>k._handleTwoFinger(e));
return k}b._inheritsLoose(n,w);n.prototype._handleTwoFinger=function(f){var l,k,e;const d=c.createScreenPointArray(0,f.data.delta*(this.invert?-1:1));switch(f.data.action){case "begin":null==(l=this.cameraController)?void 0:l.end();this.cameraController=new g.RotateController({view:this.view,pivot:g.PivotPoint.CENTER});this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(d);break;case "update":null==(k=this.cameraController)?void 0:k.update(d);break;case "end":null==
(e=this.cameraController)?void 0:e.end(),this.cameraController=null}};return n}(h.InputHandler);a.TwoFingerTilt=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/BrowserEventSource":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ./keys ./gamepad/GamepadSource ../support/screenUtils".split(" "),function(a,b,c,g,h,w){const n=c("trident"),f=c("edge"),l=c("chrome"),k=c("ff"),e=c("safari");c=function(){function m(v,q){this.input=q;this._active={};
this._activePointerCaptures=new Set;this._keyDownState=new Set;this._eventId=1;this._browserTouchPanningEnabled=!1;this._element=v;v.getAttribute("tabindex")||v.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,
"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};this._updateTouchAction();this._element.addEventListener("keydown",this._preventAltKeyDefault);this._gamepadSource=new h.GamepadSource(v,this.input);this._gamepadSource.onEvent=t=>this._callback("gamepad",t)}var z=m.prototype;z.destroy=function(){this.activeEvents=this._callback=null;this._activePointerCaptures.forEach(v=>{this._releasePointerCaptureSafe(v)});this._gamepadSource&&(this._gamepadSource.destroy(),
this._gamepadSource=null);this._activePointerCaptures=null;this._removeTouchAction();this._element.removeEventListener("keydown",this._preventAltKeyDefault)};z.setPointerCapture=function(v,q){q?(this._element.setPointerCapture(v.pointerId),this._activePointerCaptures.add(v.pointerId)):(this._releasePointerCaptureSafe(v.pointerId),this._activePointerCaptures.delete(v.pointerId))};z._updateTouchAction=function(){this._element.classList.remove(this._browserTouchPanningEnabled?"esri-view-surface--touch-none":
"esri-view-surface--touch-pan");this._element.classList.add(this._browserTouchPanningEnabled?"esri-view-surface--touch-pan":"esri-view-surface--touch-none")};z._updateTouchEventHandling=function(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};z._removeTouchAction=function(){this._element.classList.remove("esri-view-surface--touch-none");this._element.classList.remove("esri-view-surface--touch-pan");
this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};z._releasePointerCaptureSafe=function(v){try{this._element.hasPointerCapture&&!this._element.hasPointerCapture(v)||this._element.releasePointerCapture(v)}catch(q){}};z._updateNormalizedPointerLikeEvent=function(v,q){v=w.createScreenPointFromNativeEvent(this._element,v);m.test.disableSubpixelCoordinates&&(v.x=Math.round(v.x),v.y=Math.round(v.y));q.x=v.x;q.y=v.y;return q};z._handleKey=function(v,q){const t=g.eventKey(q);
t&&"key-up"===v&&this._keyDownState.delete(t);q={native:q,key:t,repeat:t&&this._keyDownState.has(t)};t&&"key-down"===v&&this._keyDownState.add(q.key);this._callback(v,q)};z._handlePointer=function(v,q){q=this._updateNormalizedPointerLikeEvent(q,{native:q,x:0,y:0,pointerType:q.pointerType,button:q.button,buttons:q.buttons,eventId:this._eventId++});this._callback(v,q)};z._handlePointerPreventDefault=function(v,q){const t=this._updateNormalizedPointerLikeEvent(q,{native:q,x:0,y:0,pointerType:q.pointerType,
button:q.button,buttons:q.buttons,eventId:this._eventId++});q.preventDefault();this._callback(v,t)};z._handleMouseWheel=function(v,q){let t=q.deltaY;switch(q.deltaMode){case 0:if(n||f)t=t/document.documentElement.clientHeight*600;break;case 1:t*=30;break;case 2:t*=900}n||f?t*=.7:l||e?t*=.6:k&&(t*=1.375);const r=Math.abs(t);100<r&&(t=t/r*200/(1+Math.exp(-.02*(r-100))));q=this._updateNormalizedPointerLikeEvent(q,{native:q,x:0,y:0,deltaY:t});this._callback(v,q)};z._handlePointerCaptureLost=function(v,
q){this._activePointerCaptures.delete(q.pointerId);this._handleDefault(v,q)};z._handleDefault=function(v,q){const t={native:q};q.preventDefault();this._callback(v,t)};z._preventAltKeyDefault=function(v){"Alt"===v.key&&v.preventDefault()};z._preventMultiTouchPanning=function(v){1<v.touches.length&&v.preventDefault()};b._createClass(m,[{key:"browserTouchPanningEnabled",get:function(){return this._browserTouchPanningEnabled},set:function(v){this._browserTouchPanningEnabled=v;this._updateTouchAction();
this._updateTouchEventHandling()}},{key:"onEventReceived",set:function(v){this._callback=v}},{key:"activeEvents",set:function(v){for(const q in this._active)v&&v.has(q)||(this._element.removeEventListener(d[q],this._active[q]),delete this._active[q]);v&&v.forEach(q=>{if(!this._active[q]&&d[q]){const t=(this._eventHandlers[q]||this._handleDefault).bind(this,q);this._element.addEventListener(d[q],t);this._active[q]=t}});this._gamepadSource.hasEventListeners=v&&v.has("gamepad")}}]);return m}();c.test=
{disableSubpixelCoordinates:!1};const d={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};a.BrowserEventSource=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/gamepad/GamepadSource":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../core/scheduling","./GamepadInputDevice","./GamepadState"],function(a,b,c,g,h){let w=function(){function n(l,k){this.element=l;this.input=k;this._hasEventListeners=!1;this._onConnectGamepad=e=>{this._connectGamepad(e.gamepad)};this._onDisconnectGamepad=e=>{e=e.gamepad;const d=e.index,m=this.inputDevices[d];m&&(this._emitGamepadEvent(e,h.extractState(m),!1),this.inputDevices.splice(d,1),this.latestUpdate.splice(d,1),this.input.gamepad.devices.remove(m),
this.ensurePollingState())};this.frameTask=null;this.latestUpdate=[];this.inputDevices=[];this.callback=null;l=window.isSecureContext;if(this.supported="getGamepads"in window.navigator&&l)this._forEachGamepad(e=>this._connectGamepad(e)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState()}var f=n.prototype;f.destroy=function(){this.hasEventListeners=!1;this.supported&&(window.removeEventListener("gamepadconnected",
this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))};f._connectGamepad=function(l){const k=new g(l);"unknown"!==k.deviceType&&(this.inputDevices[l.index]=k,this.input.gamepad.devices.add(k));this.ensurePollingState()};f.ensurePollingState=function(){this.eventsEnabled?this._startPolling():this._stopPolling()};f._startPolling=function(){null==this.frameTask&&(this.frameTask=c.addFrameTask({update:()=>this._readGamepadState()}))};f._stopPolling=function(){null!=
this.frameTask&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=[])};f._readGamepadState=function(){const l=document.hasFocus(),k=this.element.contains(document.activeElement),e="document"===this.input.gamepad.enabledFocusMode&&!l||"view"===this.input.gamepad.enabledFocusMode&&!k;this._forEachGamepad(d=>{var m=this.inputDevices[d.index];if(m){var z=this.latestUpdate[d.index];m=h.extractState(m);var v=e||h.stateIdle(m);z&&(z.timestamp===d.timestamp||!z.active&&v||h.stateEqual(z.state,
m))||this._emitGamepadEvent(d,m,!v)}})};f._forEachGamepad=function(l){const k=window.navigator.getGamepads();for(let e=0;e<k.length;e++){const d=k[e];this._validate(d)&&l(d)}};f._emitGamepadEvent=function(l,k,e){var d=this.latestUpdate[l.index];if((d=d&&d.active)||e)this.latestUpdate[l.index]={timestamp:l.timestamp,state:k,active:e},this.callback&&this.callback({device:this.inputDevices[l.index],state:k,action:!d&&e?"start":d&&e?"update":"end"})};f._validate=function(l){if(!l||!l.connected)return!1;
for(let k=0;k<l.axes.length;k++)if(isNaN(l.axes[k]))return!1;return!0};b._createClass(n,[{key:"hasEventListeners",set:function(l){this._hasEventListeners!==l&&(this._hasEventListeners=l,this.ensurePollingState())}},{key:"eventsEnabled",get:function(){return this.supported&&0<this.inputDevices.length&&this._hasEventListeners}},{key:"onEvent",set:function(l){this.callback=l}}]);return n}();a.GamepadSource=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/gamepad/GamepadState":function(){define(["exports"],
function(a){a.extractState=function(b){const c=b.native;return c?{buttons:c.buttons.map(g=>g.pressed?g.value?g.value:1:0),axes:c.axes.map(g=>{{var h=b.axisThreshold;const w=Math.abs(g);g=w<h?0:Math.sign(g)*(w-h)/(1-h)}return g})}:{buttons:[],axes:[]}};a.stateEqual=function(b,c){if(b.axes.length!==c.axes.length||b.buttons.length!==c.buttons.length)return!1;for(var g=0;g<b.axes.length;g++)if(b.axes[g]!==c.axes[g])return!1;for(g=0;g<b.buttons.length;g++)if(b.buttons[g]!==c.buttons[g])return!1;return!0};
a.stateIdle=function(b){for(var c=0;c<b.axes.length;c++)if(0!==b.axes[c])return!1;for(c=0;c<b.buttons.length;c++)if(0!==b.buttons[c])return!1;return!0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/handlers/PreventContextMenu":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../InputHandler"],function(a,b,c){c=function(g){function h(){var w=g.call(this,!0)||this;w.registerIncoming("context-menu",n=>{n.data.native.preventDefault()});return w}b._inheritsLoose(h,
g);return h}(c.InputHandler);a.PreventContextMenu=c;a.default=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/recognizers/Drag":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/screenUtils ../../../core/time ../InputHandler ./support".split(" "),function(a,b,c,g,h,w){function n(e){const d=[];e.forEach(m=>{d.push(c.createScreenPoint(m.event.x,m.event.y))});return w.fitCircleLSQ(d)}function f(e){const d=n(e);let m=0;e.forEach(z=>{var v=k(z,d);
for(v-=z.lastAngle;v>Math.PI;)v-=2*Math.PI;for(;v<-Math.PI;)v+=2*Math.PI;v=z.lastAngle+v;z.lastAngle=v;m+=v-z.initialAngle});m/=e.size||1;return{angle:m,radius:d.radius,center:d.center}}function l(e){const d=new Map;e.forEach((m,z)=>d.set(z,m.event));return d}function k(e,d){e=e.event;return Math.atan2(e.y-d.center.y,e.x-d.center.x)}h=function(e){function d(z){var v=e.call(this,!1)||this;v.navigationTouch=z;v.startStateModifiers=new Set;v.activePointerMap=new Map;v.isDragging=!1;v.isCurrentDragSuppressed=
!1;v.drag=v.registerOutgoing("drag");v.registerIncoming("pointer-drag",v._handlePointerDrag.bind(b._assertThisInitialized(v)));v.registerIncoming("pointer-up",v._handlePointerUpAndPointerLost.bind(b._assertThisInitialized(v)));v.registerIncoming("pointer-capture-lost",v._handlePointerUpAndPointerLost.bind(b._assertThisInitialized(v)));v.registerIncoming("pointer-cancel",v._handlePointerUpAndPointerLost.bind(b._assertThisInitialized(v)));return v}b._inheritsLoose(d,e);var m=d.prototype;m._createPayload=
function(z,v,q,t){return{action:z,pointerType:this.pointerType,button:this.mouseButton,buttons:v.buttons,timestamp:t,pointers:l(this.activePointerMap),pointer:v,angle:q.angle,radius:q.radius,center:q.center}};m._addPointer=function(z){var v=z.native.pointerId;const q=f(this.activePointerMap).angle;z={event:z,initialAngle:0,lastAngle:0};this.activePointerMap.set(v,z);v=k(z,n(this.activePointerMap));z.initialAngle=v;z.lastAngle=v;this._updatePointerAngles(q)};m._updatePointer=function(z){if(!z||null!=
z.x||null!=z.y){var v=this.activePointerMap.get(z.native.pointerId);v?v.event=z:this._addPointer(z)}};m._removePointer=function(z){const v=f(this.activePointerMap).angle;this.activePointerMap.delete(z);this._updatePointerAngles(v)};m._updatePointerAngles=function(z){const v=f(this.activePointerMap);this.activePointerMap.forEach(q=>{q.initialAngle=k(q,v)-z;q.lastAngle=k(q,v)-z})};m._emitEvent=function(z,v,q){const t=f(this.activePointerMap);this.drag.emit(this._createPayload(z,v,t,q),void 0,this.startStateModifiers)};
m._handlePointerUpAndPointerLost=function(z){const v=z.data.native.pointerId,q=g.Milliseconds(z.timestamp);this.activePointerMap.get(v)&&(1===this.activePointerMap.size?(this._updatePointer(z.data),!this.isCurrentDragSuppressed&&this._emitEvent("end",z.data,q),this.isCurrentDragSuppressed=this.isDragging=!1,this._removePointer(v)):(this._removePointer(v),this._emitEvent("removed",z.data,g.Milliseconds(z.timestamp))))};m._handlePointerDrag=function(z){const v=z.data,q=v.currentEvent,t=g.Milliseconds(z.timestamp);
switch(v.action){case "start":case "update":this.isDragging?this.activePointerMap.has(q.native.pointerId)?(this._updatePointer(q),!this.isCurrentDragSuppressed&&this._emitEvent("update",q,t)):(this._addPointer(q),this._emitEvent("added",q,t),this.isCurrentDragSuppressed=this.isSuppressed):(this._updatePointer(q),this.pointerType=z.data.startEvent.pointerType,this.mouseButton=z.data.startEvent.button,this.startStateModifiers=z.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,
!this.isCurrentDragSuppressed&&this._emitEvent("start",q,t))}};b._createClass(d,[{key:"isSuppressed",get:function(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&"touch"===this.pointerType&&1===this.activePointerMap.size}}]);return d}(h.InputHandler);a.Button=void 0;(function(e){e[e.Left=0]="Left";e[e.Middle=1]="Middle";e[e.Right=2]="Right";e[e.Back=3]="Back";e[e.Forward=4]="Forward";e[e.Undefined=-1]="Undefined"})(a.Button||(a.Button={}));a.Drag=h;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/input/recognizers/support":function(){define(["exports","../../../core/screenUtils"],function(a,b){a.euclideanDistance=function(c,g){const h=g.x-c.x;c=g.y-c.y;return Math.sqrt(h*h+c*c)};a.fitCircleLSQ=function(c,g){g?(g.radius=0,g.center.x=0,g.center.y=0):g={radius:0,center:b.createScreenPoint()};if(0===c.length)return g;if(1===c.length)return g.center.x=c[0].x,g.center.y=c[0].y,g;if(2===c.length){const [q,t]=c,[r,x]=[t.x-q.x,t.y-q.y];g.radius=Math.sqrt(r*r+
x*x)/2;g.center.x=(q.x+t.x)/2;g.center.y=(q.y+t.y)/2;return g}let h=0,w=0;for(g=0;g<c.length;g++)h+=c[g].x,w+=c[g].y;h/=c.length;w/=c.length;var n=c.map(q=>q.x-h),f=c.map(q=>q.y-w);let l=g=0;var k=0,e=0,d=0,m=0,z=0;for(var v=0;v<n.length;v++){const q=n[v],t=f[v],r=q*q,x=t*t;g+=r;l+=x;k+=q*t;e+=r*q;d+=x*t;m+=q*x;z+=t*r}n=g;f=k;v=l;e=.5*(e+m);d=.5*(d+z);z=n*v-k*f;m=(e*v-d*f)/z;d=(n*d-k*e)/z;z=b.createScreenPoint(m+h,d+w);return{radius:Math.sqrt(m*m+d*d+(g+l)/c.length),center:z}};a.manhattanDistance=
function(c,g){return Math.abs(g.x-c.x)+Math.abs(g.y-c.y)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/recognizers/ImmediateDoubleClick":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/clock ../InputHandler ./SingleAndDoubleClick ./support".split(" "),function(a,b,c,g,h,w){g=function(n){function f(k=h.DefaultParameters.maximumDoubleClickDelay,e=h.DefaultParameters.maximumDoubleClickDistance,d=h.DefaultParameters.maximumDoubleTouchDelay,m=
h.DefaultParameters.maximumDoubleTouchDistance,z=c.clock){var v=n.call(this,!1)||this;v.maximumDoubleClickDelay=k;v.maximumDoubleClickDistance=e;v.maximumDoubleTouchDelay=d;v.maximumDoubleTouchDistance=m;v._clock=z;v._pointerState=new Map;v._immediateDoubleClick=v.registerOutgoing("immediate-double-click");v.registerIncoming("pointer-down",v._handlePointerDown.bind(b._assertThisInitialized(v)));v.registerIncoming("pointer-up",q=>{v._handlePointerLoss(q,"pointer-up")});v.registerIncoming("pointer-capture-lost",
q=>{v._handlePointerLoss(q,"pointer-capture-lost")});v.registerIncoming("pointer-cancel",q=>{v._handlePointerLoss(q,"pointer-cancel")});return v}b._inheritsLoose(f,n);var l=f.prototype;l.onUninstall=function(){this._pointerState.forEach(k=>{k.immediateDoubleClick&&k.immediateDoubleClick.timeoutHandle.remove()});n.prototype.onUninstall.call(this)};l._handlePointerDown=function(k){k=k.data;const e=this._pointerId(k);this._pointerState.has(e)||(this._pointerState.set(e,{downButton:k.native.button,immediateDoubleClick:null}),
this.startCapturingPointer(k.native))};l._handlePointerLoss=function(k,e){const d=k.data;var m=this._pointerId(d);if((m=this._pointerState.get(m))&&"pointer-up"===e&&m.downButton===d.native.button)if(e=m.immediateDoubleClick){e.timeoutHandle.remove();const z="touch"===k.data.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;w.manhattanDistance(e,k.data)>z?this._startImmediateDoubleClick(k,m):(this._immediateDoubleClick.emit(k.data,void 0,e.modifiers),this._removeState(d))}else this._startImmediateDoubleClick(k,
m)};l._startImmediateDoubleClick=function(k,e){e.immediateDoubleClick={x:k.data.x,y:k.data.y,modifiers:k.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(k.data),"touch"===k.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)}};l._pointerId=function(k){k=k.native;return"mouse"===k.pointerType?`${k.pointerId}:${k.button}`:`${k.pointerType}`};l._removeState=function(k){const e=this._pointerId(k);this._pointerState.delete(e);this.stopCapturingPointer(k.native);
this.refreshHasPendingInputs()};return f}(g.InputHandler);a.ImmediateDoubleClick=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/clock ../../../core/MapUtils ../../../core/maybe ../InputHandler ./support".split(" "),function(a,b,c,g,h,w,n){const f={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};
w=function(l){function k(d=f.maximumDoubleClickDelay,m=f.maximumDoubleClickDistance,z=f.maximumDoubleTouchDelay,v=f.maximumDoubleTouchDistance,q=c.clock){var t=l.call(this,!1)||this;t.maximumDoubleClickDelay=d;t.maximumDoubleClickDistance=m;t.maximumDoubleTouchDelay=z;t.maximumDoubleTouchDistance=v;t._clock=q;t._pointerState=new Map;t._click=t.registerOutgoing("click");t._doubleClick=t.registerOutgoing("double-click");t.registerIncoming("immediate-click",t._handleImmediateClick.bind(b._assertThisInitialized(t)));
t.registerIncoming("pointer-drag",t._handlePointerDrag.bind(b._assertThisInitialized(t)));t.registerIncoming("drag",t._handleDrag.bind(b._assertThisInitialized(t)));return t}b._inheritsLoose(k,l);var e=k.prototype;e.onUninstall=function(){this._pointerState.forEach(d=>d.doubleClickTimeout=h.removeMaybe(d.doubleClickTimeout))};e._pointerId=function(d){d=d.native;return"mouse"===d.pointerType?`${d.pointerId}:${d.button}`:`${d.pointerType}`};e._handleImmediateClick=function(d){const m=d.data,z=this._pointerId(m),
v=this._pointerState.get(z);if(v){const q="touch"===m.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;n.manhattanDistance(v.event.data,m)>q?(this._clearDoubleClickTimeout(z,!0),this._startClick(d)):(this._clearDoubleClickTimeout(z,!1),this._doubleClick.emit(v.event.data,void 0,v.event.modifiers))}else this._startClick(d)};e._startClick=function(d){const m=this._pointerId(d.data);this._pointerState.set(m,{event:d,doubleClickTimeout:this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(m),
"touch"===d.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)});this.refreshHasPendingInputs()};e._handlePointerDrag=function(d){d=this._pointerId(d.data.currentEvent);this._clearDoubleClickTimeout(d,!0)};e._handleDrag=function(d){d=this._pointerId(d.data.pointer);this._clearDoubleClickTimeout(d,!0)};e._clearDoubleClickTimeout=function(d,m){const z=this._pointerState.get(d);z&&(z.doubleClickTimeout.remove(),z.doubleClickTimeout=null,m&&this._doubleClickTimeoutExceeded(d),
this._pointerState.delete(d),this.refreshHasPendingInputs())};e._doubleClickTimeoutExceeded=function(d){const m=this._pointerState.get(d);this._click.emit(m.event.data,void 0,m.event.modifiers);m.doubleClickTimeout=null;this._pointerState.delete(d);this.refreshHasPendingInputs()};b._createClass(k,[{key:"hasPendingInputs",get:function(){return g.someMap(this._pointerState,d=>null!=d.doubleClickTimeout)}}]);return k}(w.InputHandler);a.DefaultParameters=f;a.SingleAndDoubleClick=w;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/clock","../InputHandler","./support"],function(a,b,c,g,h){const w={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};g=function(n){function f(k=w.maximumClickDelay,e=w.movementUntilMouseDrag,d=w.movementUntilPenDrag,m=w.movementUntilTouchDrag,z=w.holdDelay,v=c.clock){var q=
n.call(this,!1)||this;q.maximumClickDelay=k;q.movementUntilMouseDrag=e;q.movementUntilPenDrag=d;q.movementUntilTouchDrag=m;q.holdDelay=z;q._clock=v;q._pointerState=new Map;q._pointerDrag=q.registerOutgoing("pointer-drag");q._immediateClick=q.registerOutgoing("immediate-click");q._pointerHold=q.registerOutgoing("hold");q.registerIncoming("pointer-down",q._handlePointerDown.bind(b._assertThisInitialized(q)));q.registerIncoming("pointer-up",t=>{q._handlePointerLoss(t,"pointer-up")});q.registerIncoming("pointer-capture-lost",
t=>{q._handlePointerLoss(t,"pointer-capture-lost")});q.registerIncoming("pointer-cancel",t=>{q._handlePointerLoss(t,"pointer-cancel")});q._moveHandle=q.registerIncoming("pointer-move",q._handlePointerMove.bind(b._assertThisInitialized(q)));q._moveHandle.pause();return q}b._inheritsLoose(f,n);var l=f.prototype;l.onUninstall=function(){this._pointerState.forEach(k=>{null!=k.holdTimeout&&(k.holdTimeout.remove(),k.holdTimeout=null)});n.prototype.onUninstall.call(this)};l._handlePointerDown=function(k){const e=
k.data,d=e.native.pointerId;var m=null;0===this._pointerState.size&&(m=this._clock.setTimeout(()=>{const z=this._pointerState.get(d);z&&(z.isDragging||(this._pointerHold.emit(z.previousEvent,void 0,k.modifiers),z.holdEmitted=!0),z.holdTimeout=null)},this.holdDelay));m={startEvent:e,previousEvent:e,startTimestamp:k.timestamp,isDragging:!1,downButton:e.native.button,holdTimeout:m,modifiers:new Set};this._pointerState.set(d,m);this.startCapturingPointer(e.native);this._moveHandle.resume();1<this._pointerState.size&&
this._startDragging(k)};l._createPointerDragData=function(k,e,d){return{action:k,startEvent:e.startEvent,previousEvent:e.previousEvent,currentEvent:d}};l._handlePointerMove=function(k){const e=k.data,d=this._pointerState.get(e.native.pointerId);if(d){if(d.isDragging)this._pointerDrag.emit(this._createPointerDragData("update",d,e),void 0,d.modifiers);else{const m=h.euclideanDistance(e,d.startEvent),z=this._getDragThreshold(e.native.pointerType);m>z&&this._startDragging(k)}d.previousEvent=e}};l._getDragThreshold=
function(k){switch(k){case "touch":return this.movementUntilTouchDrag;case "pen":return this.movementUntilPenDrag;default:return this.movementUntilMouseDrag}};l._startDragging=function(k){const e=k.data,d=e.native.pointerId;this._pointerState.forEach(m=>{null!=m.holdTimeout&&(m.holdTimeout.remove(),m.holdTimeout=null);m.isDragging||(m.modifiers=k.modifiers,m.isDragging=!0,d===m.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",m,e)):this._pointerDrag.emit(this._createPointerDragData("start",
m,m.previousEvent),k.timestamp))})};l._handlePointerLoss=function(k,e){const d=k.data,m=d.native.pointerId,z=this._pointerState.get(m);z&&(null!=z.holdTimeout&&(z.holdTimeout.remove(),z.holdTimeout=null),z.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",z,"pointer-up"===e?d:z.previousEvent),void 0,z.modifiers):"pointer-up"===e&&z.downButton===d.native.button&&k.timestamp-z.startTimestamp<=this.maximumClickDelay&&!z.holdEmitted&&this._immediateClick.emit(d),this._pointerState.delete(m),
this.stopCapturingPointer(d.native),0===this._pointerState.size&&this._moveHandle.pause())};return f}(g.InputHandler);a.DefaultParameters=w;a.PointerClickHoldAndDrag=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../DragEventSeparator","../InputHandler"],function(a,b,c,g){g=function(h){function w(f=20,l=40){var k=h.call(this,!1)||this;k._threshold=f;k._maxDelta=l;k.state=
"ready";k.emittedArtificalEnd2=!1;k._vertical=k.registerOutgoing("vertical-two-finger-drag");k._artificalDrag=k.registerOutgoing("drag");k.dragEventSeparator=new c.DragEventSeparator({start:(e,d)=>k._observeStart(e,d),update:(e,d,m)=>k._observeUpdate(e,d,m),end:(e,d)=>k._observeEnd(d)});k.registerIncoming("drag",e=>k.dragEventSeparator.handle(e));return k}b._inheritsLoose(w,h);var n=w.prototype;n._observeStart=function(f,l){1===f&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",
button:l.data.button,buttons:l.data.buttons,pointerType:l.data.pointerType,timestamp:l.data.timestamp,pointers:l.data.pointers,pointer:l.data.pointer,angle:l.data.angle,radius:l.data.radius,center:l.data.center}),l.stopPropagation());this.state=2===f?"ready":"failed"};n._observeUpdate=function(f,l,k){"failed"!==this.state&&2===f&&("active"===this.state?(this._vertical.emit({delta:l.data.center.y-this._thresholdReachedCenter.y,action:"update"}),l.stopPropagation()):this._checkMovementWithinLimits(l.data,
k.data)?this._checkVerticalThresholdReached(l.data,k.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=l.data.center,this._artificalDrag.emit({action:"end",button:l.data.button,buttons:l.data.buttons,pointerType:l.data.pointerType,timestamp:l.data.timestamp,pointers:l.data.pointers,pointer:l.data.pointer,angle:l.data.angle,radius:l.data.radius,center:l.data.center}),this._vertical.emit({delta:l.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),l.stopPropagation()):
this.state="failed")};n._observeEnd=function(f){"active"===this.state&&(this._vertical.emit({delta:f.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",f.stopPropagation())};n._checkMovementWithinLimits=function(f,l){let k=-Infinity,e=Infinity,d=-Infinity,m=Infinity;l.pointers.forEach(r=>{k=Math.max(k,r.x);e=Math.min(e,r.x);d=Math.max(d,r.y);m=Math.min(m,r.y)});let z=-Infinity,v=Infinity,q=-Infinity,t=Infinity;f.pointers.forEach(r=>{z=Math.max(z,r.x);v=Math.min(v,r.x);
q=Math.max(q,r.y);t=Math.min(t,r.y)});return Math.abs(f.center.x-l.center.x)<this._threshold&&Math.abs(z-v-(k-e))<=this._maxDelta&&Math.abs(q-t-(d-m))<=this._maxDelta};n._checkVerticalThresholdReached=function(f,l){let k=Math.abs(f.center.y-l.center.y);f.pointers.forEach((e,d)=>{d=l.pointers.get(d);k=Math.min(k,Math.abs(e.y-d.y))});return k>=this._threshold};b._createClass(w,[{key:"failed",get:function(){return"failed"===this.state}}]);return w}(g.InputHandler);a.VerticalTwoFingerDrag=g;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/input/DragEventSeparator":function(){define(["exports"],function(a){let b=function(){function c(h){this.callbacks=h;this.currentCount=0;this.callbacks.condition||(this.callbacks.condition=()=>!0)}var g=c.prototype;g.handle=function(h){const w=h.data,n=w.pointers.size;switch(w.action){case "start":this.currentCount=n;this._emitStart(h);break;case "added":this._emitEnd(this.previousEvent);this.currentCount=n;this._emitStart(h);break;case "update":this._emitUpdate(h);
break;case "removed":this.startEvent&&this._emitEnd(this.previousEvent);this.currentCount=n;this._emitStart(h);break;case "end":this._emitEnd(h),this.currentCount=0}this.previousEvent=h};g._emitStart=function(h){this.startEvent=h;this.callbacks.condition(this.currentCount,h)&&this.callbacks.start(this.currentCount,h,this.startEvent)};g._emitUpdate=function(h){this.callbacks.condition(this.currentCount,h)&&this.callbacks.update(this.currentCount,h,this.startEvent)};g._emitEnd=function(h){this.callbacks.condition(this.currentCount,
h)&&this.callbacks.end(this.currentCount,h,this.startEvent);this.startEvent=null};return c}();a.DragEventSeparator=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/GraphicsDeconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Handles ../../../../core/MapUtils ../../../../core/maybe ../../../../core/watchUtils ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/set ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/boundedPlane ./Deconflictor ./enums ./LabelDeconflictor ../../../support/Scheduler".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r){function x(E){E=E.layer;return!(!E||!E.featureReduction||"selection"!==E.featureReduction.type)}function u(E){(E=E.graphics3DGraphics)&&E.forEach(y=>y.clearVisibilityFlag(q.VisibilityFlag.DECONFLICTION))}a.GraphicsDeconflictor=function(E){function y(){var p=E.apply(this,arguments)||this;p._handles=new g;p._contexts=new Map;p._viewState=new v.DeconflictorViewState;p.visibilityGroup=q.VisibilityGroup.GRAPHIC;p._iconMarginFactor=-.1;return p}b._inheritsLoose(y,
E);var A=y.prototype;A.initialize=function(){this._handles.add([this.view.watch("state.camera",()=>{this._updateViewState();this.setDirty()}),this.view.watch("map.ground.opacity",(p,B)=>{1!==p&&1!==B||this.setDirty()}),n.init(this.view,"slicePlane",()=>{this._updateSlicePlane();this._slicePlaneChanged()})]);this._frameTask=this.view.resourceController.scheduler.registerTask(r.TaskPriority.GRAPHICS_DECONFLICTOR,this);this._labels=new t.LabelDeconflictor({view:this.view,parent:this})};A.destroy=function(){this._labels.destroy();
this._labels=null;this._handles.destroy();this._handles=null;this._frameTask&&(this._frameTask.remove(),this._frameTask=null)};A.setDirty=function(){0<this._contexts.size&&(E.prototype.setDirty.call(this),this._labels.setDirty())};A.runTask=function(p){E.prototype.runTask.call(this,p);this.running||this._labels.setDirty()};A.setInitialIconVisibilityFlag=function(p,B){p=!(this._graphicSupportsDeconfliction(B)&&x(p));B.setVisibilityFlag(q.VisibilityFlag.DECONFLICTION,p,q.VisibilityGroup.GRAPHIC)};A._updateViewState=
function(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())};A._updateSlicePlane=function(){const p=this.view?this.view.slicePlane:null;w.isSome(p)&&z.transform(p,this._viewState.camera.viewMatrix,this._viewState.slicePlane);this._viewState.slicePlaneEnabled=w.isSome(p)};A._slicePlaneChanged=function(){h.someMap(this._contexts,(p,B)=>B.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()};A.addGraphicsOwner=function(p){let B=this._contexts.get(p);
null==B&&(B=new Map,this._contexts.set(p,B),this.setDirty());return{addGraphic:D=>this._addGraphic(p,B,D),removeGraphic:D=>this._removeGraphic(B,D),labelingInfoChange:()=>this._labels.enabledChanged(p,B),featureReductionChange:()=>this.enabledChanged(p,B),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(p,B),clear:()=>B.forEach(D=>this._removeGraphic(B,D.graphics3DGraphic))}};A.removeGraphicsOwner=function(p){const B=this._contexts.get(p);B&&(B.forEach(D=>this._removeGraphic(B,D.graphics3DGraphic)),
this._contexts.delete(p),this.setDirty())};A._addGraphic=function(p,B,D){const C=D.graphic.uid;D=new v.DeconflictorGraphic(D,p.symbolCreationContext.slicePlaneEnabled);B.set(C,D);x(p)&&this.addToActiveGraphics(D);p.labelsEnabled&&this._labels.addToActiveGraphics(D)};A._removeGraphic=function(p,B){B=B.graphic.uid;const D=p.get(B);D&&(this.removeFromActiveGraphics(D),this._labels.removeFromActiveGraphics(D),p.delete(B),this.setDirty())};A.enabledChanged=function(p,B){const D=x(p);D||u(p);this.modifyGraphics(B,
D)};A._slicePlaneEnabledChanged=function(p,B){const D=p.symbolCreationContext.slicePlaneEnabled;B.forEach(C=>C.slicePlaneEnabled=D);this.setDirty()};A.getGraphicsLayers=function(p){return p.graphics};A._graphicSupportsDeconfliction=function(p){if(p.isDraped)return!1;p=p.graphics;if(!p||!p.length)return!1;for(const B of p)if(this.layerSupportsDeconfliction(B))return!0;return!1};b._createClass(y,[{key:"labels",get:function(){return this._labels}},{key:"viewState",get:function(){return this._viewState}},
{key:"iconMarginFactor",get:function(){return this._iconMarginFactor},set:function(p){this._iconMarginFactor=p;this.setDirty()}}]);return y}(v.Deconflictor);a.GraphicsDeconflictor=c.__decorate([m.subclass("esri.views.3d.layers.graphics.GraphicsDeconflictor")],a.GraphicsDeconflictor);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/mathUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/projectionEllipsoid ../../../../geometry/support/aaBoundingRect ../../../../chunks/boundedPlane ../../../../geometry/support/ray ../../../../chunks/sphere ./deconflictorDebug ./enums ../../support/debugFlags ../../webgl-engine/lib/Camera ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H){function*M(ja){if(Map.prototype.entries){ja=ja.entries();for(let la=ja.next();!la.done;la=ja.next())yield la.value[1]}else yield*ja.values()}function*K(ja,la,ia){la.clear();ja.forEach((fa,ba)=>{const Z=la.pushNew();Z.id=ba;Z.prio=fa.info?-fa.info[ia].distance:Number.MAX_VALUE});yield;const ca=la.iterableSort((fa,ba)=>ba.prio-fa.prio);for(let fa=ca.next();!fa.done;fa=ca.next())yield;la.forAll(fa=>{const ba=ja.get(fa.id);ba&&(ja.delete(fa.id),
ja.set(fa.id,ba))});la.clear()}const I=t.create(),O=x.create(),Q=x.create(),J=t.create(),P=z.create(),N=p.create(),R=A.create(),S=t.create(),T=E.create();let V=function(){this.aabr=E.create();this.distance=0;this.visible=this.culled=!1},W=function(){function ja(){this.active=new Map;this.visible=new Map}ja.prototype.clear=function(){this.active.clear();this.visible.clear()};return ja}(),U=function(){},aa=function(){this.sortArray=new n({allocator:ja=>ja||new U})};a.State=void 0;(function(ja){ja[ja.Idle=
0]="Idle";ja[ja.Process=1]="Process";ja[ja.Sort=2]="Sort";ja[ja.Deconflict=3]="Deconflict";ja[ja.NumStates=4]="NumStates"})(a.State||(a.State={}));let da=function(){function ja(){this.camera=new F.default;this.slicePlane=y.create();this.slicePlaneEnabled=!1}ja.prototype.copyFrom=function(la){this.camera.copyFrom(la.camera);y.copy(la.slicePlane,this.slicePlane);this.slicePlaneEnabled=la.slicePlaneEnabled};return ja}();a.Deconflictor=function(ja){function la(){var ca=ja.apply(this,arguments)||this;
ca._dirty=!1;ca._runningViewState=new da;ca._state=a.State.Idle;ca.graphics=new W;ca.iterators=new aa;ca.accBinsNumX=15;ca.accBinsNumY=20;ca.accBinsSizeX=0;ca.accBinsSizeY=0;ca.accBins=null;ca.accNumTests=0;return ca}b._inheritsLoose(la,ja);var ia=la.prototype;ia.destroy=function(){this.graphics.clear();this.iterators=null};ia.setDirty=function(){!this._dirty&&0<this.graphics.active.size&&(this._dirty=!0,this.notifyChange("updating"))};ia.runTask=function(ca){switch(this._state){case a.State.Idle:this._startUpdate(),
ca.madeProgress();case a.State.Process:if(this._state=a.State.Process,!this._processActiveGraphics(ca))break;case a.State.Sort:if(this._state=a.State.Sort,!this._sortVisibleGraphics(ca))break;case a.State.Deconflict:if(this._state=a.State.Deconflict,!this._deconflictVisibleGraphics(ca))break;default:B.drawAccelerationStruct(this,this.graphics.visible),this._state=a.State.Idle,this.notifyChange("updating")}};ia.modifyGraphics=function(ca,fa){fa?ca.forEach(ba=>this.addToActiveGraphics(ba)):ca.forEach(ba=>
this.removeFromActiveGraphics(ba));this.setDirty()};ia.layerSupportsDeconfliction=function(ca){if(w.isNone(ca)||"object3d"!==ca.type)return!1;ca=ca.stageObject;return 1===(ca?ca.geometryRecords.length:0)&&ca.geometryRecords[0].material instanceof H.HUDMaterial?!0:!1};ia._startUpdate=function(){B.prepare(this.view);this._dirty=!1;this._runningViewState.copyFrom(this.viewState);const {fullWidth:ca,fullHeight:fa}=this._runningViewState.camera;this._initBins(ca,fa);this._resetIterators()};ia.addToActiveGraphics=
function(ca){ca.info[this.visibilityGroup]=new V;this.graphics.active.set(ca.graphics3DGraphic.graphic.uid,ca);this.setDirty()};ia.removeFromActiveGraphics=function(ca){this._removeFromVisibleGraphics(ca);{const fa=ca.graphics3DGraphic;fa.destroyed||fa.clearVisibilityFlag(D.VisibilityFlag.DECONFLICTION,this.visibilityGroup)}delete ca.info[this.visibilityGroup];this.graphics.active.delete(ca.graphics3DGraphic.graphic.uid);this.setDirty()};ia._addToVisibleGraphics=function(ca){this.graphics.visible.set(ca.graphics3DGraphic.graphic.uid,
ca)};ia._removeFromVisibleGraphics=function(ca){this.graphics.visible.delete(ca.graphics3DGraphic.graphic.uid)};ia._processActiveGraphics=function(ca){const fa=this._ensureActiveGraphicsIterator(),ba=m.invert(P,this._runningViewState.camera.projectionMatrix),Z="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&0<this._runningViewState.camera.relativeElevation?N:null;let ha=0;w.isSome(Z)&&(q.transformMat4(Z,t.ZEROS,this._runningViewState.camera.viewMatrix),Z[3]=u.getReferenceEllipsoid(this.view.spatialReference).radius,
ha=p.distanceToSilhouette(Z,t.ZEROS));for(;!ca.done;){ca.madeProgress();var na=fa.next();if(!0===na.done)return this._resetActiveGraphicsIterator(),!0;const pa=(na=na.value)&&na.info[this.visibilityGroup];pa&&(this._collectGraphics3DGraphics(na,ba,Z,ha),pa.culled?this._removeFromVisibleGraphics(na):this._addToVisibleGraphics(na))}return!1};ia._sortVisibleGraphics=function(ca){const fa=this._ensureSortGraphicsIterator();for(;!ca.done;){const ba=fa.next();ca.madeProgress();if(!0===ba.done)return this._resetSortGraphicsIterator(),
!0}return!1};ia._deconflictVisibleGraphics=function(ca){const fa=this._ensureVisibleGraphicsIterator(),ba=this.visibilityGroup===D.VisibilityGroup.LABEL;for(;!ca.done;){ca.madeProgress();var Z=fa.next();if(!0===Z.done)return this._resetVisibleGraphicsIterator(),!0;Z=Z.value;const na=Z.info[this.visibilityGroup];if(na&&!na.culled){var ha=Z.graphics3DGraphic;(ha=(!ba||ha.isVisible())&&!this._isConflicted(Z))&&this._addToBins(Z);na.visible=ha;this._setGraphicVisibility(Z,ha);B.drawPoly(na,ha)}}return!1};
ia._resetIterators=function(){this.iterators.active=null;this.iterators.visible=null;this.iterators.sort=null};ia._ensureActiveGraphicsIterator=function(){this.iterators.active||(this.iterators.active=M(this.graphics.active));return this.iterators.active};ia._resetActiveGraphicsIterator=function(){this.iterators.active=null};ia._ensureVisibleGraphicsIterator=function(){this.iterators.visible||(this.iterators.visible=M(this.graphics.visible));return this.iterators.visible};ia._resetVisibleGraphicsIterator=
function(){this.iterators.visible=null};ia._ensureSortGraphicsIterator=function(){this.iterators.sort||(this.iterators.sort=K(this.graphics.visible,this.iterators.sortArray,this.visibilityGroup));return this.iterators.sort};ia._resetSortGraphicsIterator=function(){this.iterators.sort=null};ia._collectGraphics3DGraphics=function(ca,fa,ba,Z){var ha=ca.graphics3DGraphic;if(!ha.destroyed){var na=ca.info[this.visibilityGroup];if(ha.isVisible(D.VisibilityGroup.GRAPHIC,D.VisibilityFlag.DECONFLICTION)){var pa=
this.getGraphicsLayers(ha);E.empty(na.aabr);ha=null;for(const xa of pa)if(this.layerSupportsDeconfliction(xa)){pa=xa.stageObject.geometryRecords[0].material;if(w.isNone(ha)){ha=this._getProjectionInfo(xa,fa,ea);if(ha.isOutsideScreen||this._isCulledBySlice(ca,I)||w.isSome(ba)&&this._isCulledByHorizon(ha,ba,Z)){na.culled=!0;return}!C.TESTS_DISABLE_OPTIMIZATIONS&&na.visible&&(ha.distance*=.7)}this._expandBoundingRect(na,xa,pa,ha)}w.isNone(ha)?na.culled=!0:(na.distance=ha.distance,na.culled=!1)}else na.culled=
!0}};ia._getProjectionInfo=function(ca,fa,ba){const Z=this._runningViewState.camera;ca=ca.stageObject;var ha=ca.geometryRecords[0];const na=ha.material;var pa=p.getCenter(ca.boundingVolumeWorldSpace.bounds);q.transformMat4(I,pa,Z.viewMatrix);pa=ha.geometry.vertexAttributes;ha=pa.get(L.VertexAttribute.NORMAL).data;pa=pa.get(L.VertexAttribute.AUXPOS1).data;na.applyShaderOffsetsView(I,ha,ca.transformation,pa,Z,ba.scaleInfo,I);r.set(O,I[0],I[1],I[2],1);r.transformMat4(Q,O,Z.projectionMatrix);q.scale(ba.positionNDC,
Q,1/Q[3]);na.applyShaderOffsetsNDC(ba.positionNDC,pa,Z,ba.positionNDC,J);ba.distanceWithoutPolygonOffset=Z.depthNDCToWorld(J[2]);ba.distance=J[2]===ba.positionNDC[2]?ba.distanceWithoutPolygonOffset:Z.depthNDCToWorld(ba.positionNDC[2]);r.set(Q,ba.positionNDC[0],ba.positionNDC[1],ba.positionNDC[2],1);r.transformMat4(O,Q,fa);r.scale(O,O,1/O[3]);q.set(ba.positionView,I[0],I[1],I[2]);return ba};ia._isCulledByHorizon=function(ca,fa,ba){q.copy(R.direction,ca.positionView);q.set(R.origin,0,0,0);return p.intersectRay(fa,
R,S)?ca.distanceWithoutPolygonOffset>ba:!1};ia._isCulledBySlice=function(ca,fa){return ca.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&y.extrusionContainsPoint(this._runningViewState.slicePlane,fa)};ia._expandBoundingRect=function(ca,fa,ba,{positionNDC:Z,scaleInfo:ha}){const na=this._runningViewState.camera;fa=fa.getScreenSize(Y);G.applyPrecomputedScaleFactor(fa,ha.factor,fa);fa[0]*=na.pixelRatio;fa[1]*=na.pixelRatio;ba=E.offset(ba.calculateRelativeScreenBounds(fa,ha.factorAlignment.scale,
T),h.lerp(0,na.fullWidth,.5+.5*Z[0]),h.lerp(0,na.fullHeight,.5+.5*Z[1]));Z=this.iconMarginFactor;0!==Z&&(Z*=Math.min(E.width(ba),E.height(ba)),ba[0]-=Z,ba[1]-=Z,ba[2]+=Z,ba[3]+=Z);E.expand(ca.aabr,ba,ca.aabr)};ia._isConflicted=function(ca){const fa=ca.graphics3DGraphic.graphic.uid;ca=ca.info[this.visibilityGroup];for(let ba=Math.floor(ca.aabr[0]/this.accBinsSizeX);ba<=Math.floor(ca.aabr[2]/this.accBinsSizeX);ba++)if(!(0>ba||ba>=this.accBinsNumX))for(let Z=Math.floor(ca.aabr[1]/this.accBinsSizeY);Z<=
Math.floor(ca.aabr[3]/this.accBinsSizeY);Z++){if(0>Z||Z>=this.accBinsNumY)continue;const ha=this.accBins[ba][Z];for(let na=0;na<ha.length;na++){const pa=ha.data[na],xa=pa.info[this.visibilityGroup];if(xa&&xa.visible&&pa.graphics3DGraphic.graphic.uid!==fa&&(this.accNumTests++,E.intersects(xa.aabr,ca.aabr)))return!0}}return!1};ia._initBins=function(ca,fa){if(null==this.accBins){this.accBins=[];for(var ba=0;ba<this.accBinsNumX;ba++){this.accBins.push([]);var Z=this.accBins[this.accBins.length-1];for(let ha=
0;ha<this.accBinsNumY;ha++)Z.push(new n)}}else for(ba=0;ba<this.accBinsNumX;ba++)for(Z=0;Z<this.accBinsNumY;Z++)this.accBins[ba][Z].clear();this.accBinsSizeX=ca/this.accBinsNumX;this.accBinsSizeY=fa/this.accBinsNumY;this.accNumTests=0};ia._addToBins=function(ca){var fa=ca.info[this.visibilityGroup],ba=Math.floor(fa.aabr[0]/this.accBinsSizeX);const Z=Math.floor(fa.aabr[2]/this.accBinsSizeX),ha=Math.floor(fa.aabr[1]/this.accBinsSizeY);for(fa=Math.floor(fa.aabr[3]/this.accBinsSizeY);ba<=Z;ba++)if(!(0>
ba||ba>=this.accBinsNumX))for(let na=ha;na<=fa;na++)0>na||na>=this.accBinsNumY||this.accBins[ba][na].push(ca)};ia._setGraphicVisibility=function(ca,fa){ca=ca.graphics3DGraphic;ca.destroyed||(ca.setVisibilityFlag(D.VisibilityFlag.DECONFLICTION,fa,this.visibilityGroup),this.visibilityGroup===D.VisibilityGroup.LABEL&&this.view.labeler.setLabelGraphicVisibility(ca,fa))};b._createClass(la,[{key:"dirty",get:function(){return this._dirty}},{key:"state",get:function(){return this._state}},{key:"updating",
get:function(){return this._state!==a.State.Idle||this._dirty}},{key:"updatingProgress",get:function(){if(!this.updating)return 1;const ca=this._state/a.State.NumStates;return this._dirty?.5*ca:ca}},{key:"running",get:function(){return this.view.ready&&null!=this.view.state&&this.updating}}]);return la}(g);c.__decorate([f.property({constructOnly:!0})],a.Deconflictor.prototype,"view",void 0);c.__decorate([f.property({type:Boolean,readOnly:!0})],a.Deconflictor.prototype,"updating",null);a.Deconflictor=
c.__decorate([d.subclass("esri.views.3d.layers.graphics.Deconflictor")],a.Deconflictor);const Y=v.create(),ea=new (function(){function ja(){this.positionView=t.create();this.positionNDC=t.create();this.distanceWithoutPolygonOffset=this.distance=0;this.scaleInfo={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}}}b._createClass(ja,[{key:"isOutsideScreen",get:function(){const la=this.positionNDC;return-1>la[0]||-1>la[1]||-1>la[2]||
1<=la[0]||1<=la[1]}}]);return ja}());a.DeconflictorGraphic=function(ja,la,ia={}){this.graphics3DGraphic=ja;this.slicePlaneEnabled=la;this.info=ia};a.DeconflictorViewState=da;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["exports","../../support/debugFlags"],function(a,b){function c(e,d,m,z,v){f&&(f(),f=null);const q=l.height,t=k;t.beginPath();t.lineWidth=1;t.strokeStyle=v;t.moveTo(e,q-m);t.lineTo(d,q-m);t.stroke();t.lineTo(d,
q-z);t.stroke();t.lineTo(d,q-m);t.stroke();t.lineTo(e,q-m);t.stroke();t.lineTo(e,q-m);t.stroke();t.closePath()}let g=!1,h=!1,w=!1,n=!1,f=null,l,k;a.drawAccelerationStruct=function(e,d){if(h&&k){f&&(f(),f=null);var m=k,z=0;for(let v=0;v<e.accBinsNumX;v++)for(let q=0;q<e.accBinsNumY;q++){const t=e.accBins[v][e.accBinsNumY-1-q];z+=t.length;const r=v*e.accBinsSizeX,x=(v+1)*e.accBinsSizeX,u=q*e.accBinsSizeY,E=(q+1)*e.accBinsSizeY;m.fillText(t.length.toFixed(),r+5,u+15);c(r,x,u,E,"blue")}m.fillText("total totalShownLabels: "+
z,70,40);m.fillText("total visible labels: "+d.size,70,50);m.fillText("total numTests: "+e.accNumTests,70,30)}};a.drawPoly=function(e,d){g&&(d&&w||!d&&n)&&c(e.aabr[0],e.aabr[2],e.aabr[1],e.aabr[3],d?"green":"red")};a.prepare=function(e){w=b.DECONFLICTOR_SHOW_VISIBLE;n=b.DECONFLICTOR_SHOW_INVISIBLE;g=w||n;h=b.DECONFLICTOR_SHOW_GRID;f=null;g||h?f=()=>{{null==l&&(l=document.createElement("canvas"),l.setAttribute("id","canvas2d"),e.surface.parentElement.style.position="relative",e.surface.parentElement.appendChild(l));
const d=e.height*e.pixelRatio;l.setAttribute("width",`${e.width*e.pixelRatio}px`);l.setAttribute("height",`${d}px`);l.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${e.width}px;height:${e.height}px`);k=l.getContext("2d");k.clearRect(0,0,e.width,e.height);k.font="12px Arial"}}:l&&(l.parentElement.removeChild(l),l=null)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/debugFlags":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,g,h,w,n,f){c=function(l){function k(){var e=l.apply(this,arguments)||this;e.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1;e.SCENEVIEW_LOCKING_LOG=!1;e.HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED=!0;e.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1;e.DECONFLICTOR_SHOW_VISIBLE=!1;e.DECONFLICTOR_SHOW_INVISIBLE=!1;e.DECONFLICTOR_SHOW_GRID=!1;e.LABELS_SHOW_BORDER=!1;e.TEXT_SHOW_BASELINE=!1;e.TEXT_SHOW_BORDER=!1;e.OVERLAY_DRAW_DEBUG_TEXTURE=!1;e.OVERLAY_SHOW_CENTER=!1;e.SHOW_POI=!1;e.TESTS_DISABLE_OPTIMIZATIONS=!1;
e.TESTS_DISABLE_FAST_UPDATES=!1;e.DRAW_MESH_GEOMETRY_NORMALS=!1;e.FEATURE_TILE_FETCH_SHOW_TILES=!1;e.FEATURE_TILE_TREE_SHOW_TILES=!1;e.TERRAIN_TILE_TREE_SHOW_TILES=!1;e.I3S_TREE_SHOW_TILES=!1;e.I3S_SHOW_MODIFICATIONS=!1;e.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1;e.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1;e.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1;e.LINE_WIREFRAMES=!1;return e}a._inheritsLoose(k,l);return k}(c);b.__decorate([g.property()],c.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0);
b.__decorate([g.property()],c.prototype,"SCENEVIEW_LOCKING_LOG",void 0);b.__decorate([g.property()],c.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED",void 0);b.__decorate([g.property()],c.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0);b.__decorate([g.property()],c.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0);b.__decorate([g.property()],c.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0);b.__decorate([g.property()],c.prototype,"DECONFLICTOR_SHOW_GRID",void 0);b.__decorate([g.property()],c.prototype,
"LABELS_SHOW_BORDER",void 0);b.__decorate([g.property()],c.prototype,"TEXT_SHOW_BASELINE",void 0);b.__decorate([g.property()],c.prototype,"TEXT_SHOW_BORDER",void 0);b.__decorate([g.property()],c.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0);b.__decorate([g.property()],c.prototype,"OVERLAY_SHOW_CENTER",void 0);b.__decorate([g.property()],c.prototype,"SHOW_POI",void 0);b.__decorate([g.property()],c.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0);b.__decorate([g.property()],c.prototype,"TESTS_DISABLE_FAST_UPDATES",
void 0);b.__decorate([g.property()],c.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);b.__decorate([g.property()],c.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);b.__decorate([g.property()],c.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);b.__decorate([g.property()],c.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0);b.__decorate([g.property()],c.prototype,"I3S_TREE_SHOW_TILES",void 0);b.__decorate([g.property()],c.prototype,"I3S_SHOW_MODIFICATIONS",void 0);b.__decorate([g.property()],c.prototype,
"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0);b.__decorate([g.property()],c.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0);b.__decorate([g.property()],c.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0);b.__decorate([g.property()],c.prototype,"LINE_WIREFRAMES",void 0);c=b.__decorate([f.subclass("esri.views.3d.support.DebugFlags")],c);return new c})},"esri/views/3d/layers/graphics/enums":function(){define(["exports"],function(a){a.VisibilityGroup=void 0;(function(b){b[b.GRAPHIC=
0]="GRAPHIC";b[b.LABEL=1]="LABEL";b[b._COUNT=2]="_COUNT"})(a.VisibilityGroup||(a.VisibilityGroup={}));a.VisibilityFlag=void 0;(function(b){b[b.USER_SETTING=0]="USER_SETTING";b[b.SCALE_RANGE=1]="SCALE_RANGE";b[b.FILTER=2]="FILTER";b[b.DECONFLICTION=3]="DECONFLICTION";b[b._COUNT=4]="_COUNT"})(a.VisibilityFlag||(a.VisibilityFlag={}));Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/mathUtils","../../../ViewingMode"],function(a,b,c,g){function h(d,m,z){const v=z.parameters;z=z.paddingPixelsOverride;k.scale=Math.min(v.divisor/(m-v.offset),1);k.factor=Math.abs(d*d*d);k.minPixelSize=v.minPixelSize;k.paddingPixels=z;return k}function w(d,m){return 0===d?m.minPixelSize:m.minPixelSize*(1+2*m.paddingPixels/d)}function n(d,m){return Math.max(c.lerp(d*m.scale,d,m.factor),w(d,m))}let f=function(){function d(z,v,q,t={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,
paddingPixels:0},r){this.viewingMode=z;this.description=v;this.ellipsoidRadius=q;this.parameters=t;this._paddingPixelsOverride=r;this.viewingMode===g.ViewingMode.Local?(this.coverageCompensation=this._surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this._surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}var m=d.prototype;
m.update=function(z){if(this.parameters&&this.parameters.camera.fovY===z.fovY&&this.parameters.camera.distance===z.distance)return!1;this._calculateParameters(z,this.ellipsoidRadius,this.parameters);return!0};m.overridePadding=function(z){return z!==this.paddingPixelsOverride?new d(this.viewingMode,this.description,this.ellipsoidRadius,this.parameters,z):this};m._calculateParameters=function(z,v,q){const {scaleStart:t,scaleFallOffRange:r,minPixelSize:x}=this.description,{fovY:u,distance:E}=z;var y=
this.calculateCurvatureDependentParameters(z,v);v=this.coverageCompensation(z,v,y);const {tiltAngle:A,scaleFallOffFactor:p}=y,B=Math.sin(A)*E,D=.5*Math.PI-A-u*(.5-t*v);y=B/Math.cos(D);v=(y-B/Math.cos(D+u*r*v)*p)/(1-p);q.camera.fovY=z.fovY;q.camera.distance=z.distance;q.offset=v;q.divisor=y-v;q.minPixelSize=x;return q};m._calculateCurvatureDependentParametersLocal=function(z,v,q=e){q.tiltAngle=this.description.curvatureDependent.min.tiltAngle;q.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor;
return q};m._calculateCurvatureDependentParametersGlobal=function(z,v,q=e){const t=this.description.curvatureDependent;z=1+z.distance/v;z=Math.sqrt(z*z-1);const [r,x]=[t.min.curvature,t.max.curvature];z=c.clamp((z-r)/(x-r),0,1);const [u,E]=[t.min,t.max];q.tiltAngle=c.lerp(u.tiltAngle,E.tiltAngle,z);q.scaleFallOffFactor=c.lerp(u.scaleFallOffFactor,E.scaleFallOffFactor,z);return q};m._surfaceCoverageCompensationLocal=function(z,v,q){return(z.fovY-q.tiltAngle)/z.fovY};m._surfaceCoverageCompensationGlobal=
function(z,v,q){const t=v*v;q=q.tiltAngle+.5*Math.PI;const {fovY:r,distance:x}=z;z=x*x+t-2*Math.cos(q)*x*v;const u=Math.sqrt(z);return(Math.acos(Math.sqrt(z-t)/u)-Math.asin(v/(u/Math.sin(q)))+.5*r)/r};b._createClass(d,[{key:"paddingPixelsOverride",get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels}}]);return d}();const l={curvatureDependent:{min:{curvature:c.deg2rad(10),tiltAngle:c.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:c.deg2rad(70),tiltAngle:c.deg2rad(40),
scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},k={scale:0,factor:0,minPixelSize:0,paddingPixels:0},e={tiltAngle:0,scaleFallOffFactor:0};a.applyPrecomputedScaleFactor=function(d,m,z=[0,0]){m=Math.min(Math.max(m.scale,w(d[1],m)/Math.max(1E-5,d[1])),1);z[0]=d[0]*m;z[1]=d[1]*m;return z};a.applyScaleFactor=n;a.getLabelSettings=function(d,m){const {curvatureDependent:z,scaleStart:v,scaleFallOffRange:q}=l;return new f(d,{curvatureDependent:{min:{curvature:z.min.curvature,tiltAngle:z.min.tiltAngle,
scaleFallOffFactor:.7},max:{curvature:z.max.curvature,tiltAngle:z.max.tiltAngle,scaleFallOffFactor:.95}},scaleStart:v,scaleFallOffRange:q,minPixelSize:14},m)};a.getSettings=function(d,m){return new f(d,l,m)};a.precomputeScaleFactor=function(d,m,z,v){d=h(d,m,z);d.minPixelSize=0;d.paddingPixels=0;d=n(1,d);v.scale=d;v.factor=0;v.minPixelSize=z.parameters.minPixelSize;v.paddingPixels=z.paddingPixelsOverride};a.scale=function(d,m,z,v){return n(d,h(m,z,v))};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../core/libs/gl-matrix-2/types/mat4 ../../../../geometry/support/aaBoundingRect ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/hud/HUD.glsl ../lib/geometryDataUtils ../lib/GLMaterialTexture ../lib/Material ../lib/RenderSlot ../lib/screenSizePerspectiveUtils ../lib/Util ../lib/VertexAttribute ./internal/bufferWriterUtils ./internal/MaterialUtil ./renderers/utils ../../../../chunks/HUDMaterial.glsl ../shaders/HUDMaterialTechnique".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L){function H(fa,ba,Z,ha=J){k.copy(ha,fa.anchorPos);ha[0]*=-ba[0];ha[1]*=-ba[1];ha[0]+=fa.screenOffset[0]*Z;ha[1]+=fa.screenOffset[1]*Z;return ha}function M(fa,ba,Z,ha,na,pa,xa,Da){ba=ba-na-(0<Da[0]?ha[0]*Da[0]:0);let ua=ba+ha[0]+2*na;Z=Z-na-(0<Da[1]?ha[1]*Da[1]:0);na=Z+ha[1]+2*na;xa.textureIsSignedDistanceField&&(xa=xa.distanceFieldBoundingBox,ba+=ha[0]*xa[0],Z+=ha[1]*xa[1],ua-=ha[0]*(1-xa[2]),na-=ha[1]*(1-xa[3]),ba-=pa,ua+=pa,Z-=
pa,na+=pa);return fa[0]>ba&&fa[0]<ua&&fa[1]>Z&&fa[1]<na}let K=function(fa){function ba(ha){ha=fa.call(this,ha,la)||this;ha.techniqueConfig=new L.HUDMaterialTechniqueConfiguration;return ha}b._inheritsLoose(ba,fa);var Z=ba.prototype;Z.getTechniqueConfig=function(ha,na){this.techniqueConfig.output=ha;this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled;this.techniqueConfig.verticalOffset=!!this.parameters.verticalOffset;this.techniqueConfig.screenSizePerspective=!!this.parameters.screenSizePerspective;
this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?r.HUDSpace.Screen:r.HUDSpace.World;this.techniqueConfig.polygonOffsetEnabled=this.parameters.polygonOffset;this.techniqueConfig.isDraped=this.parameters.isDraped;this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest;this.techniqueConfig.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled;this.techniqueConfig.sdf=this.parameters.textureIsSignedDistanceField;this.techniqueConfig.vvSize=
!!this.parameters.vvSizeEnabled;this.techniqueConfig.vvColor=!!this.parameters.vvColorEnabled;ha===t.ShaderOutput.Color&&(this.techniqueConfig.debugDrawLabelBorder=!!this.parameters.debugDrawLabelBorder);ha===t.ShaderOutput.Highlight&&(this.techniqueConfig.binaryHighlightOcclusion=this.parameters.binaryHighlightOcclusion);this.techniqueConfig.depthEnabled=this.parameters.depthEnabled;this.techniqueConfig.transparencyPassType=na.transparencyPassType;this.techniqueConfig.multipassGeometryEnabled=na.multipassGeometryEnabled;
this.techniqueConfig.multipassTerrainEnabled=na.multipassTerrainEnabled;this.techniqueConfig.cullAboveGround=na.cullAboveGround;return this.techniqueConfig};Z.intersect=function(ha,na,pa,xa,Da,ua,Fa,qa,sa){g.isSome(sa)?this._intersectDrapedHudGeometry(ha,ua,Fa,qa,sa):this._intersectHudGeometry(ha,na,pa,xa,Fa,qa)};Z._intersectDrapedHudGeometry=function(ha,na,pa,xa,Da){const ua=ha.vertexAttributes.get(B.VertexAttribute.POSITION),Fa=ha.vertexAttributes.get(B.VertexAttribute.SIZE),qa=this.parameters,
sa=G.calculateAnchorPosForRendering(qa);let ma=1;var ra=1;g.isSome(xa)&&(ra=xa(Y),ma=ra[0],ra=ra[5]);ma*=ha.screenToWorldRatio;ra*=ha.screenToWorldRatio;xa=2*ha.screenToWorldRatio;for(let Ia=0;Ia<ua.data.length/ua.size;Ia++){var va=Ia*ua.size;const Ja=ua.data[va];va=ua.data[va+1];const Ha=Ia*Fa.size;ea[0]=Fa.data[Ha]*ma;ea[1]=Fa.data[Ha+1]*ra;let Ta;qa.textureIsSignedDistanceField&&(Ta=qa.outlineSize*ha.screenToWorldRatio/2);M(na,Ja,va,ea,xa,Ta,qa,sa)&&pa(Da.dist,Da.normal,-1,!0)}};Z._intersectHudGeometry=
function(ha,na,pa,xa,Da,ua){if(xa.options.selectionMode&&xa.options.hud&&!F.isInstanceHidden(na)){na=this.parameters;var Fa=1,qa=1;w.fromMat4(V,pa);if(g.isSome(ua)){qa=ua(Y);Fa=qa[0];qa=qa[5];{ua=V;var sa=ua[0],ma=ua[1],ra=ua[2],va=ua[3],Ia=ua[4],Ja=ua[5],Ha=ua[6],Ta=ua[7],db=ua[8],fb=1/Math.sqrt(sa*sa+ma*ma+ra*ra);const ka=1/Math.sqrt(va*va+Ia*Ia+Ja*Ja),cb=1/Math.sqrt(Ha*Ha+Ta*Ta+db*db);ua[0]=sa*fb;ua[1]=ma*fb;ua[2]=ra*fb;ua[3]=va*ka;ua[4]=Ia*ka;ua[5]=Ja*ka;ua[6]=Ha*cb;ua[7]=Ta*cb;ua[8]=db*cb}}ua=
ha.vertexAttributes.get(B.VertexAttribute.POSITION);sa=ha.vertexAttributes.get(B.VertexAttribute.SIZE);ma=ha.vertexAttributes.get(B.VertexAttribute.NORMAL);ha=ha.vertexAttributes.get(B.VertexAttribute.AUXPOS1);p.assert(3<=ua.size);ra=xa.point;va=xa.camera;Ia=G.calculateAnchorPosForRendering(na);Fa*=va.pixelRatio;qa*=va.pixelRatio;Ja="screen"===this.parameters.centerOffsetUnits;for(Ha=0;Ha<ua.data.length/ua.size;Ha++)if(Ta=Ha*ua.size,d.set(P,ua.data[Ta],ua.data[Ta+1],ua.data[Ta+2]),d.transformMat4(P,
P,pa),Ta=Ha*sa.size,ea[0]=sa.data[Ta]*Fa,ea[1]=sa.data[Ta+1]*qa,d.transformMat4(P,P,va.viewMatrix),Ta=Ha*ha.size,d.set(aa,ha.data[Ta+0],ha.data[Ta+1],ha.data[Ta+2]),Ja||(P[0]+=aa[0],P[1]+=aa[1],0!==aa[2]&&(Ta=aa[2],d.normalize(aa,P),d.subtract(P,P,d.scale(aa,aa,Ta)))),Ta=Ha*ma.size,d.set(N,ma.data[Ta],ma.data[Ta+1],ma.data[Ta+2]),this._normalAndViewAngle(N,V,va,da),this._applyVerticalOffsetTransformationView(P,da,va,Q),va.applyProjection(P,R),-1<R[0]){Ta=Math.floor(R[0])+this.parameters.screenOffset[0];
db=Math.floor(R[1])+this.parameters.screenOffset[1];Ja&&(Ta+=aa[0],0!==aa[1]&&(db+=A.applyScaleFactor(aa[1],Q.factorAlignment)));A.applyPrecomputedScaleFactor(ea,Q.factor,ea);fb=1*va.pixelRatio;let ka;na.textureIsSignedDistanceField&&(ka=na.outlineSize*va.pixelRatio/2);M(ra,Ta,db,ea,fb,ka,na,Ia)&&(db=xa.ray,d.transformMat4(T,P,f.invert(U,va.viewMatrix)),R[0]=ra[0],R[1]=ra[1],va.unprojectFromRenderScreen(R,P)&&(Ta=m.create(),d.copy(Ta,db.direction),fb=1/d.length(Ta),d.scale(Ta,Ta,fb),db=d.distance(db.origin,
P)*fb,Da(db,Ta,-1,!0,1,T)))}}};Z.computeAttachmentOrigin=function(ha,na){var pa=ha.vertexAttributes;if(!pa)return!1;pa=pa.get(B.VertexAttribute.POSITION);ha=ha.indices.get(B.VertexAttribute.POSITION);return x.computeAttachmentOriginPoints(pa,ha,na)};Z.createBufferWriter=function(){return new ca(this)};Z._normalAndViewAngle=function(ha,na,pa,xa){z.isMat4(na)&&(na=w.fromMat4(W,na));d.transformMat3(xa.normal,ha,na);d.transformMat4(xa.normal,xa.normal,pa.viewInverseTransposeMatrix);xa.cosAngle=d.dot(S,
ja);return xa};Z._updateScaleInfo=function(ha,na,pa){const xa=this.parameters;xa.screenSizePerspective?A.precomputeScaleFactor(pa,na,xa.screenSizePerspective,ha.factor):(ha.factor.scale=1,ha.factor.factor=0,ha.factor.minPixelSize=0,ha.factor.paddingPixels=0);xa.screenSizePerspectiveAlignment?A.precomputeScaleFactor(pa,na,xa.screenSizePerspectiveAlignment,ha.factorAlignment):(ha.factorAlignment.factor=ha.factor.factor,ha.factorAlignment.scale=ha.factor.scale,ha.factorAlignment.minPixelSize=ha.factor.minPixelSize,
ha.factorAlignment.paddingPixels=ha.factor.paddingPixels)};Z.applyShaderOffsetsView=function(ha,na,pa,xa,Da,ua,Fa){na=this._normalAndViewAngle(na,pa,Da,da);this._applyVerticalGroundOffsetView(ha,na,Da,Fa);this._applyVerticalOffsetTransformationView(Fa,na,Da,ua);this._applyPolygonOffsetView(Fa,na,xa[3],Da,Fa);this._applyCenterOffsetView(Fa,xa,Fa);return Fa};Z.applyShaderOffsetsNDC=function(ha,na,pa,xa,Da){this._applyCenterOffsetNDC(ha,na,pa,xa);g.isSome(Da)&&d.copy(Da,xa);this._applyPolygonOffsetNDC(xa,
na,pa,xa);return xa};Z._applyPolygonOffsetView=function(ha,na,pa,xa,Da){var ua=xa.aboveGround?1:-1;pa=Math.sign(pa);0===pa&&(pa=ua);ua*=pa;if(0>=this.parameters.shaderPolygonOffset)return d.copy(Da,ha);na=c.clamp(Math.abs(na.cosAngle),.01,1);xa=1-Math.sqrt(1-na*na)/na/xa.viewport[2];0<ua?d.scale(Da,ha,xa):d.scale(Da,ha,1/xa);return Da};Z._applyVerticalGroundOffsetView=function(ha,na,pa,xa){const Da=d.length(ha),ua=pa.aboveGround?1:-1;pa=.5*pa.computeRenderPixelSizeAtDist(Da);na=d.scale(P,na.normal,
ua*pa);d.add(xa,ha,na);return xa};Z._applyVerticalOffsetTransformationView=function(ha,na,pa,xa){const Da=this.parameters;if(!Da.verticalOffset||!Da.verticalOffset.screenLength){if(Da.screenSizePerspective||Da.screenSizePerspectiveAlignment){var ua=d.length(ha);this._updateScaleInfo(xa,ua,na.cosAngle)}else xa.factor.scale=1,xa.factorAlignment.scale=1;return ha}ua=d.length(ha);pa=C.verticalOffsetAtDistance(pa,ua,Da.verticalOffset,na.cosAngle,Da.screenSizePerspectiveAlignment||Da.screenSizePerspective);
this._updateScaleInfo(xa,ua,na.cosAngle);d.scale(na.normal,na.normal,pa);return d.add(ha,ha,na.normal)};Z._applyCenterOffsetView=function(ha,na,pa){const xa="screen"!==this.parameters.centerOffsetUnits;pa!==ha&&d.copy(pa,ha);xa&&(pa[0]+=na[0],pa[1]+=na[1],na[2]&&(d.normalize(N,pa),d.add(pa,pa,d.scale(N,N,na[2]))));return pa};Z._applyCenterOffsetNDC=function(ha,na,pa,xa){const Da="screen"!==this.parameters.centerOffsetUnits;xa!==ha&&d.copy(xa,ha);Da||(xa[0]+=na[0]/pa.fullWidth*2,xa[1]+=na[1]/pa.fullHeight*
2);return xa};Z._applyPolygonOffsetNDC=function(ha,na,pa,xa){const Da=this.parameters.shaderPolygonOffset;ha!==xa&&d.copy(xa,ha);Da&&(ha=pa.aboveGround?1:-1,xa[2]-=(ha*Math.sign(na[3])||ha)*Da);return xa};Z.requiresSlot=function(ha){if(ha===y.RenderSlot.DRAPED_MATERIAL)return!0;const {drawInSecondSlot:na,occlusionTest:pa}=this.parameters;return ha===(na?y.RenderSlot.LABEL_MATERIAL:y.RenderSlot.HUD_MATERIAL)||pa&&ha===y.RenderSlot.OCCLUSION_PIXELS};Z.createGLMaterial=function(ha){return ha.output===
t.ShaderOutput.Color||ha.output===t.ShaderOutput.Alpha?new O(ha):ha.output===t.ShaderOutput.Highlight?new I(ha):null};Z.calculateRelativeScreenBounds=function(ha,na,pa=v.create()){H(this.parameters,ha,na,pa);pa[2]=pa[0]+ha[0];pa[3]=pa[1]+ha[1];return pa};return ba}(E.Material),I=function(fa){function ba(ha){return fa.call(this,{...ha,...ha.material.parameters})||this}b._inheritsLoose(ba,fa);var Z=ba.prototype;Z.updateParameters=function(ha){this.updateTexture(this._material.parameters.textureId);
return this.selectProgram(ha)};Z.selectProgram=function(ha){return this.ensureTechnique(L.HUDMaterialTechnique,ha)};Z.beginSlot=function(ha){return this.updateParameters(ha)};Z.bind=function(ha,na){this.bindTextures(na.program);this.bindTextureScale(na.program);na.bindPass(this._material.parameters,ha)};return ba}(u),O=function(fa){function ba(){return fa.apply(this,arguments)||this}b._inheritsLoose(ba,fa);var Z=ba.prototype;Z._isOcclusionSlot=function(ha){return ha.slot===y.RenderSlot.OCCLUSION_PIXELS&&
this._material.parameters.occlusionTest&&(this._output===t.ShaderOutput.Color||this._output===t.ShaderOutput.Alpha)};Z.selectProgram=function(ha){return this.ensureTechnique(L.HUDMaterialTechnique,ha,this._isOcclusionSlot(ha)?t.ShaderOutput.Occlusion:this._output)};Z.bind=function(ha,na){this._isOcclusionSlot(ha)||(this.bindTextures(na.program),this.bindTextureScale(na.program));na.bindPass(this._material.parameters,ha)};return ba}(I);const Q={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},
factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},J=e.create(),P=m.create(),N=m.create(),R=h.createRenderScreenPointArray3(),S=m.create(),T=m.create(),V=n.create(),W=n.create(),U=l.create(),aa=m.create(),da={normal:S,cosAngle:0},Y=l.create(),ea=[0,0],ja=m.fromValues(0,0,1),la={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,
vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:e.fromValues(.5,.5),shaderPolygonOffset:1E-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,pixelSnappingEnabled:!0,debugDrawLabelBorder:!1,
isDraped:!1,...E.DefaultMaterialParameters},ia=q.newLayout().vec3f(B.VertexAttribute.POSITION).vec3f(B.VertexAttribute.NORMAL).vec2f(B.VertexAttribute.UV0).vec4u8(B.VertexAttribute.COLOR).vec2f(B.VertexAttribute.SIZE).vec4f(B.VertexAttribute.AUXPOS1).vec4f(B.VertexAttribute.AUXPOS2);let ca=function(){function fa(Z){this.material=Z;this.vertexBufferLayout=ia}var ba=fa.prototype;ba.allocate=function(Z){return this.vertexBufferLayout.createBuffer(Z)};ba.elementCount=function(Z){return 6*Z.indices.get(B.VertexAttribute.POSITION).length};
ba.write=function(Z,ha,na,pa){D.writePosition(ha.indices.get(B.VertexAttribute.POSITION),ha.vertexAttributes.get(B.VertexAttribute.POSITION).data,Z.transformation,na.position,pa,6);D.writeNormal(ha.indices.get(B.VertexAttribute.NORMAL),ha.vertexAttributes.get(B.VertexAttribute.NORMAL).data,Z.invTranspTransformation,na.normal,pa,6);var xa=ha.vertexAttributes.get(B.VertexAttribute.UV0).data;if(null==xa||4>xa.length){xa=this.material.parameters;var Da=Z=0;var ua=xa.texCoordScale[0];xa=xa.texCoordScale[1]}else Z=
xa[0],Da=xa[1],ua=xa[2],xa=xa[3];ua=Math.min(1.99999,ua+1);xa=Math.min(1.99999,xa+1);var Fa=ha.indices.get(B.VertexAttribute.POSITION).length,qa=na.uv0,sa=pa;for(var ma=0;ma<Fa;++ma)qa.set(sa,0,Z),qa.set(sa,1,Da),sa+=1,qa.set(sa,0,ua),qa.set(sa,1,Da),sa+=1,qa.set(sa,0,ua),qa.set(sa,1,xa),sa+=1,qa.set(sa,0,ua),qa.set(sa,1,xa),sa+=1,qa.set(sa,0,Z),qa.set(sa,1,xa),sa+=1,qa.set(sa,0,Z),qa.set(sa,1,Da),sa+=1;D.writeColor(ha.indices.get(B.VertexAttribute.COLOR),ha.vertexAttributes.get(B.VertexAttribute.COLOR).data,
4,na.color,pa,6);Z=ha.indices.get(B.VertexAttribute.SIZE);Da=ha.vertexAttributes.get(B.VertexAttribute.SIZE).data;ua=Z.length;xa=na.size;Fa=pa;for(qa=0;qa<ua;++qa){sa=Da[2*Z[qa]];ma=Da[2*Z[qa]+1];for(let ra=0;6>ra;++ra)xa.set(Fa,0,sa),xa.set(Fa,1,ma),Fa+=1}ha.indices.get(B.VertexAttribute.AUXPOS1)&&ha.vertexAttributes.get(B.VertexAttribute.AUXPOS1)&&D.writeBufferVec4(ha.indices.get(B.VertexAttribute.AUXPOS1),ha.vertexAttributes.get(B.VertexAttribute.AUXPOS1).data,na.auxpos1,pa,6);ha.indices.get(B.VertexAttribute.AUXPOS2)&&
ha.vertexAttributes.get(B.VertexAttribute.AUXPOS2)&&D.writeBufferVec4(ha.indices.get(B.VertexAttribute.AUXPOS2),ha.vertexAttributes.get(B.VertexAttribute.AUXPOS2).data,na.auxpos2,pa,6)};return fa}();a.HUDMaterial=K;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/libs/gl-matrix-2/types/mat4":function(){define(["exports"],function(a){function b(g){return g instanceof Float32Array&&16<=g.length}function c(g){return Array.isArray(g)&&16<=g.length}a.isMat4=function(g){return b(g)||c(g)};
a.isMat4f32=b;a.isMat4f64=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions":function(){define(["exports"],function(a){a.ShaderOutput=void 0;var b=a.ShaderOutput||(a.ShaderOutput={});b[b.Color=0]="Color";b[b.Depth=1]="Depth";b[b.Normal=2]="Normal";b[b.Shadow=3]="Shadow";b[b.Highlight=4]="Highlight";b[b.Draped=5]="Draped";b[b.Occlusion=6]="Occlusion";b[b.Alpha=7]="Alpha";b[b.COUNT=8]="COUNT";Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl":function(){define(["exports","./HUDUniforms","../util/ScreenSizePerspective.glsl","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c,g,h){a.HUDSpace=void 0;(function(w){w[w.World=0]="World";w[w.Screen=1]="Screen";w[w.COUNT=2]="COUNT"})(a.HUDSpace||(a.HUDSpace={}));a.HUD=function(w,n){w.include(c.ScreenSizePerspective);w.attributes.add(h.VertexAttribute.POSITION,"vec3");w.attributes.add(h.VertexAttribute.NORMAL,
"vec3");w.attributes.add(h.VertexAttribute.AUXPOS1,"vec4");w.vertex.uniforms.add("proj","mat4");w.vertex.uniforms.add("view","mat4");w.vertex.uniforms.add("viewNormal","mat4");w.vertex.uniforms.add("viewport","vec4");w.vertex.uniforms.add("cameraPosition","vec3");w.vertex.uniforms.add("polygonOffset","float");w.vertex.uniforms.add("cameraGroundRelative","float");w.vertex.uniforms.add("pixelRatio","float");w.vertex.uniforms.add("perDistancePixelRatio","float");w.vertex.uniforms.add("renderTransparentlyOccludedHUD",
"float");n.verticalOffsetEnabled&&w.vertex.uniforms.add("verticalOffset","vec4");n.screenSizePerspectiveEnabled&&w.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4");w.vertex.uniforms.add("hudVisibilityTexture","sampler2D");w.vertex.constants.add("smallOffsetAngle","float",.984807753012208);w.vertex.code.add(g.glsl`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`);w.vertex.code.add(g.glsl`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`);n.isDraped||w.vertex.code.add(g.glsl`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`);w.vertex.code.add(g.glsl`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${n.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${n.screenSizePerspectiveEnabled?n.verticalOffsetEnabled||n.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen?"vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"":""}

      ${n.verticalOffsetEnabled?n.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight \x3d verticalOffset.x;":""}

      ${n.verticalOffsetEnabled?g.glsl`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${n.screenCenterOffsetUnitsEnabled!==a.HUDSpace.Screen?g.glsl`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${n.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen?n.screenSizePerspectiveEnabled?"float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY \x3d centerOffset.y;":""}

      ${n.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen?"posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `);w.vertex.code.add(g.glsl`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)};a.bindHUDUniforms=function(w,n){w.setUniform1f("renderTransparentlyOccludedHUD",n.renderTransparentlyOccludedHUD===b.HUDTransparentRenderStyle.OCCLUDED?1:n.renderTransparentlyOccludedHUD===b.HUDTransparentRenderStyle.NOTOCCLUDED?0:.75)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDUniforms":function(){define(["exports"],function(a){a.HUDTransparentRenderStyle=void 0;var b=a.HUDTransparentRenderStyle||(a.HUDTransparentRenderStyle={});
b[b.OCCLUDED=0]="OCCLUDED";b[b.NOTOCCLUDED=1]="NOTOCCLUDED";b[b.BOTH=2]="BOTH";b[b.COUNT=3]="COUNT";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../materials/internal/MaterialUtil"],function(a,b,c){a.ScreenSizePerspective=function(g){g.vertex.code.add(b.glsl`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`);g.vertex.code.add(b.glsl`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`);g.vertex.code.add(b.glsl`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`);g.vertex.code.add(b.glsl`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`);g.vertex.code.add(b.glsl`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`);g.vertex.code.add(b.glsl`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`);g.vertex.code.add(b.glsl`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)};a.bindScreenSizePerspectiveUniforms=function(g,h){h.screenSizePerspective&&(c.bindScreenSizePerspective(h.screenSizePerspective,g,"screenSizePerspective"),c.bindScreenSizePerspective(h.screenSizePerspectiveAlignment||h.screenSizePerspective,g,"screenSizePerspectiveAlignment"))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("exports ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../lib/basicInterfaces ../../lib/screenSizePerspectiveUtils ../../lib/Util ../../lib/VertexAttribute ../renderers/utils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){function d(B,D,C,F,G,L){if(!c.isNone(B)){var H=v(D,C,E);w.setMin(u,B.getBBMin());w.setMax(u,B.getBBMax());c.isSome(G)&&G.applyToAabb(u);if(q(u,D,H,F)){const {primitiveIndices:M,indices:K,position:I}=B;H=M?M.length:K.length/3;if(1E3<H&&(B=B.getChildren(),void 0!==B)){for(H=0;8>H;++H)void 0!==B[H]&&d(B[H],D,C,F,G,L);return}m(D,C,0,H,K,I,M,G,L)}}}function m(B,D,C,F,G,L,H,M,K){if(H){var I=L.data;L=L.stride||L.size;var O=B[0],Q=B[1];B=B[2];var J=D[0]-O,P=D[1]-Q;for(D=D[2]-
B;C<F;++C){var N=H[C],R=3*N,S=L*G[R++],T=I[S++],V=I[S++],W=I[S];S=L*G[R++];var U=I[S++],aa=I[S++],da=I[S];S=L*G[R];R=I[S++];var Y=I[S++];S=I[S];c.isSome(M)&&([T,V,W]=M.applyToVertex(T,V,W,C),[U,aa,da]=M.applyToVertex(U,aa,da,C),[R,Y,S]=M.applyToVertex(R,Y,S,C));U-=T;aa-=V;da-=W;R-=T;Y-=V;S-=W;var ea=P*S-Y*D,ja=D*R-S*J;const ia=J*Y-R*P;var la=U*ea+aa*ja+da*ia;if(!(Math.abs(la)<=Number.EPSILON)){T=O-T;V=Q-V;W=B-W;ea=T*ea+V*ja+W*ia;if(0<la){if(0>ea||ea>la)continue}else if(0<ea||ea<la)continue;ja=V*da-
aa*W;W=W*U-da*T;V=T*aa-U*V;T=J*ja+P*W+D*V;if(0<la){if(0>T||ea+T>la)continue}else if(0<T||ea+T<la)continue;W=(R*ja+Y*W+S*V)/la;0<=W&&(U=z(U,aa,da,R,Y,S,y),K(W,U,N,!1))}}}else{H=L.data;I=L.stride||L.size;L=B[0];O=B[1];Q=B[2];B=D[0]-L;J=D[1]-O;P=D[2]-Q;for(let ia=C,ca=3*C;ia<F;++ia)if(R=I*G[ca++],V=H[R++],W=H[R++],da=H[R],R=I*G[ca++],D=H[R++],C=H[R++],N=H[R],R=I*G[ca++],U=H[R++],aa=H[R++],R=H[R],c.isSome(M)&&([V,W,da]=M.applyToVertex(V,W,da,ia),[D,C,N]=M.applyToVertex(D,C,N,ia),[U,aa,R]=M.applyToVertex(U,
aa,R,ia)),D-=V,C-=W,N-=da,U-=V,aa-=W,R-=da,S=J*R-aa*P,T=P*U-R*B,la=B*aa-U*J,Y=D*S+C*T+N*la,!(Math.abs(Y)<=Number.EPSILON)){V=L-V;W=O-W;da=Q-da;S=V*S+W*T+da*la;if(0<Y){if(0>S||S>Y)continue}else if(0<S||S<Y)continue;T=W*N-C*da;da=da*D-N*V;W=V*C-D*W;V=B*T+J*da+P*W;if(0<Y){if(0>V||S+V>Y)continue}else if(0<V||S+V<Y)continue;da=(U*T+aa*da+R*W)/Y;0<=da&&(D=z(D,C,N,U,aa,R,y),K(da,D,ia,!1))}}}function z(B,D,C,F,G,L,H){g.set(A,B,D,C);g.set(p,F,G,L);g.cross(H,A,p);g.normalize(H,H);return H}function v(B,D,C){return g.set(C,
1/(D[0]-B[0]),1/(D[1]-B[1]),1/(D[2]-B[2]))}function q(B,D,C,F){return t(B,D,C,F,Infinity)}function t(B,D,C,F,G){var L=(B[0]-F-D[0])*C[0],H=(B[3]+F-D[0])*C[0];let M=Math.min(L,H);L=Math.max(L,H);H=(B[1]-F-D[1])*C[1];const K=(B[4]+F-D[1])*C[1];L=Math.min(L,Math.max(H,K));if(0>L)return!1;M=Math.max(M,Math.min(H,K));if(M>L)return!1;H=(B[2]-F-D[2])*C[2];B=(B[5]+F-D[2])*C[2];L=Math.min(L,Math.max(H,B));if(0>L)return!1;M=Math.max(M,Math.min(H,B));return M>L?!1:M<G}function r(B,D){D=D?r(D):{};for(const C in B){let F=
B[C];F&&F.forEach&&(F=x(F));null==F&&C in D||(D[C]=F)}return D}function x(B){const D=[];B.forEach(C=>D.push(C));return D}const u=w.create(),E=h.create(),y=h.create(),A=h.create(),p=h.create();a.bindScreenSizePerspective=function(B,D,C){if(B){var F=B.parameters;D.setUniform4f(C,F.divisor,F.offset,F.minPixelSize,B.paddingPixelsOverride)}};a.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};a.computeInvDir=v;a.computeNormal=z;a.copyParameters=r;a.intersectAabbInvDir=q;a.intersectAabbInvDirBefore=
t;a.intersectDrapedRenderLineGeometry=function(B,D,C,F,G,L){if(D.options.selectionMode){D=B.vertexAttributes.get(k.VertexAttribute.POSITION).data;var H=B.vertexAttributes.get(k.VertexAttribute.SIZE),M=F[0];F=F[1];B=(((H&&H.data[0])+G)/2+4)*B.screenToWorldRatio;G=Number.MAX_VALUE;H=0;for(let J=0;J<D.length-5;J+=3){var K=D[J],I=D[J+1],O=M-K,Q=F-I;K=D[J+3]-K;I=D[J+4]-I;const P=b.clamp((K*O+I*Q)/(K*K+I*I),0,1);O=K*P-O;Q=I*P-Q;Q=O*O+Q*Q;Q<G&&(G=Q,H=J/3)}G<B*B&&L(C.dist,C.normal,H,!1)}};a.intersectTriangleGeometry=
function(B,D,C,F,G,L,H){e.isInstanceHidden(D)||(B.boundingInfo?(l.assert(B.primitiveType===n.PrimitiveType.Triangle),d(B.boundingInfo,F,G,C.tolerance,L,H)):(D=B.indices.get(k.VertexAttribute.POSITION),B=B.vertexAttributes.get(k.VertexAttribute.POSITION),m(F,G,0,D.length/3,D,B,void 0,L,H)))};a.intersectTriangles=m;a.updateParameters=function(B,D){let C=!1;for(const F in D){const G=D[F];void 0!==G&&(C=!0,Array.isArray(G)?B[F]=G.slice():B[F]=G)}return C};a.verticalOffsetAtDistance=function(B,D,C,F,G){let L=
(C.screenLength||0)*B.pixelRatio;G&&(L=f.scale(L,F,D,G));return b.clamp(L*Math.tan(.5*B.fovY)/(.5*B.fullHeight)*D,C.minWorldLength||0,null!=C.maxWorldLength?C.maxWorldLength:Infinity)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GLMaterialTexture":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/promiseUtils","./basicInterfaces","./GLMaterial"],function(a,b,c,g,h){return function(w){function n(l){var k=
w.call(this,l)||this;k._numLoading=0;k._disposed=!1;k._textureRepository=l.textureRep;k._textureId=l.textureId;k._acquire(l.textureId,e=>k._texture=e);k._acquire(l.normalTextureId,e=>k._textureNormal=e);k._acquire(l.emissiveTextureId,e=>k._textureEmissive=e);k._acquire(l.occlusionTextureId,e=>k._textureOcclusion=e);k._acquire(l.metallicRoughnessTextureId,e=>k._textureMetallicRoughness=e);return k}a._inheritsLoose(n,w);var f=n.prototype;f.dispose=function(){this._texture=b.releaseMaybe(this._texture);
this._textureNormal=b.releaseMaybe(this._textureNormal);this._textureEmissive=b.releaseMaybe(this._textureEmissive);this._textureOcclusion=b.releaseMaybe(this._textureOcclusion);this._textureMetallicRoughness=b.releaseMaybe(this._textureMetallicRoughness);this._disposed=!0};f.ensureResources=function(l){return 0===this._numLoading?g.ResourceState.LOADED:g.ResourceState.LOADING};f.updateTexture=function(l){if(b.isNone(this._texture)||l!==this._texture.id)this._texture=b.releaseMaybe(this._texture),
this._textureId=l,this._acquire(this._textureId,k=>this._texture=k)};f.bindTextures=function(l){b.isSome(this._texture)&&l.bindTexture(this._texture.glTexture,"tex");b.isSome(this._textureNormal)&&l.bindTexture(this._textureNormal.glTexture,"normalTexture");b.isSome(this._textureEmissive)&&l.bindTexture(this._textureEmissive.glTexture,"texEmission");b.isSome(this._textureOcclusion)&&l.bindTexture(this._textureOcclusion.glTexture,"texOcclusion");b.isSome(this._textureMetallicRoughness)&&l.bindTexture(this._textureMetallicRoughness.glTexture,
"texMetallicRoughness")};f.bindTextureScale=function(l){const k=b.isSome(this._texture)?this._texture.glTexture:null;b.isSome(k)&&k.descriptor.textureCoordinateScaleFactor?l.setUniform2fv("textureCoordinateScaleFactor",k.descriptor.textureCoordinateScaleFactor):l.setUniform2f("textureCoordinateScaleFactor",1,1)};f._acquire=function(l,k){b.isNone(l)?k(null):(l=this._textureRepository.acquire(l),c.isPromiseLike(l)?(++this._numLoading,l.then(e=>{this._disposed?(b.releaseMaybe(e),k(null)):k(e)}).finally(()=>
--this._numLoading)):k(l))};return n}(h)})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./basicInterfaces"],function(a,b){return function(){function c(h){this._material=h.material;this._techniqueRep=h.techniqueRep;this._output=h.output}var g=c.prototype;g.dispose=function(){this._techniqueRep.release(this._technique)};g.ensureTechnique=function(h,w,n=this._output){return this._technique=this._techniqueRep.releaseAndAcquire(h,this._material.getTechniqueConfig(n,
w),this._technique)};g.ensureResources=function(h){return b.ResourceState.LOADED};a._createClass(c,[{key:"technique",get:function(){return this._technique}}]);return c}()})},"esri/views/3d/webgl-engine/lib/Material":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./ContentObject ./ContentObjectType ./DefaultVertexAttributeLocations ../materials/internal/MaterialUtil".split(" "),function(a,b,c,g,h,w,n){g=function(f){function l(e,d){var m=f.call(this)||
this;m.type=h.ContentObjectType.Material;m.supportsEdges=!1;m._visible=!0;m._renderPriority=0;m._insertOrder=0;m._vertexAttributeLocations=w.Default3D;m._parameters=n.copyParameters(e,d);m.validateParameters(m._parameters);return m}b._inheritsLoose(l,f);var k=l.prototype;k.dispose=function(){};k.update=function(e){return!1};k.setParameters=function(e){n.updateParameters(this._parameters,e)&&(this.validateParameters(this._parameters),this.parametersChanged())};k.validateParameters=function(e){};k.shouldRender=
function(e){return this.isVisible()&&this.isVisibleInPass(e.pass)&&0!==(this.renderOccluded&e.renderOccludedMask)};k.isVisibleInPass=function(e){return!0};k.isVisible=function(){return this._visible};k.parametersChanged=function(){c.isSome(this.repository)&&this.repository.materialChanged(this)};b._createClass(l,[{key:"parameters",get:function(){return this._parameters}},{key:"visible",get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}},
{key:"renderOccluded",get:function(){return this.parameters.renderOccluded}},{key:"renderPriority",get:function(){return this._renderPriority},set:function(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}},{key:"insertOrder",get:function(){return this._insertOrder},set:function(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())}},{key:"vertexAttributeLocations",get:function(){return this._vertexAttributeLocations}}]);return l}(g.ContentObject);
a.RenderOccludedFlag=void 0;(function(f){f[f.Occlude=1]="Occlude";f[f.Transparent=2]="Transparent";f[f.OccludeAndTransparent=4]="OccludeAndTransparent";f[f.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil";f[f.Opaque=16]="Opaque"})(a.RenderOccludedFlag||(a.RenderOccludedFlag={}));a.DefaultMaterialParameters={renderOccluded:a.RenderOccludedFlag.Occlude};a.Material=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/internal/bufferWriterUtils":function(){define(["exports",
"../../../../../chunks/mat4","../../../../../geometry/support/buffer/BufferView","../../lib/Util","../../lib/VertexAttribute"],function(a,b,c,g,h){function w(m,z,v,q){const t=v.typedBuffer;v=v.typedBufferStride;const r=m.length;q*=v;for(let x=0;x<r;++x){const u=2*m[x];t[q]=z[u];t[q+1]=z[u+1];q+=v}}function n(m,z,v,q,t){const r=v.typedBuffer;v=v.typedBufferStride;const x=m.length;q*=v;if(null==t||1===t)for(t=0;t<x;++t){var u=3*m[t];r[q]=z[u];r[q+1]=z[u+1];r[q+2]=z[u+2];q+=v}else for(u=0;u<x;++u){const E=
3*m[u];for(let y=0;y<t;++y)r[q]=z[E],r[q+1]=z[E+1],r[q+2]=z[E+2],q+=v}}function f(m,z,v,q,t=1){const r=v.typedBuffer;v=v.typedBufferStride;const x=m.length;q*=v;if(1===t)for(t=0;t<x;++t){var u=4*m[t];r[q]=z[u];r[q+1]=z[u+1];r[q+2]=z[u+2];r[q+3]=z[u+3];q+=v}else for(u=0;u<x;++u){const E=4*m[u];for(let y=0;y<t;++y)r[q]=z[E],r[q+1]=z[E+1],r[q+2]=z[E+2],r[q+3]=z[E+3],q+=v}}function l(m,z,v,q,t,r=1){if(v){var x=q.typedBuffer;q=q.typedBufferStride;var u=m.length,E=v[0],y=v[1],A=v[2],p=v[4],B=v[5],D=v[6],
C=v[8],F=v[9],G=v[10],L=v[12],H=v[13];v=v[14];t*=q;if(1===r)for(r=0;r<u;++r){var M=3*m[r],K=z[M],I=z[M+1];M=z[M+2];x[t]=E*K+p*I+C*M+L;x[t+1]=y*K+B*I+F*M+H;x[t+2]=A*K+D*I+G*M+v;t+=q}else for(K=0;K<u;++K){I=3*m[K];var O=z[I],Q=z[I+1];const J=z[I+2];I=E*O+p*Q+C*J+L;M=y*O+B*Q+F*J+H;O=A*O+D*Q+G*J+v;for(Q=0;Q<r;++Q)x[t]=I,x[t+1]=M,x[t+2]=O,t+=q}}else n(m,z,q,t,r)}function k(m,z,v,q,t,r=1){if(v){var x=q.typedBuffer;q=q.typedBufferStride;var u=m.length,E=v[0],y=v[1],A=v[2],p=v[4],B=v[5],D=v[6],C=v[8],F=v[9],
G=v[10];v=!b.isOrthoNormal(v);t*=q;if(1===r)for(r=0;r<u;++r){var L=3*m[r],H=z[L],M=z[L+1],K=z[L+2];L=E*H+p*M+C*K;var I=y*H+B*M+F*K;H=A*H+D*M+G*K;v&&(M=L*L+I*I+H*H,.999999>M&&1E-6<M&&(M=1/Math.sqrt(M),L*=M,I*=M,H*=M));x[t+0]=L;x[t+1]=I;x[t+2]=H;t+=q}else for(L=0;L<u;++L){I=3*m[L];M=z[I];K=z[I+1];const O=z[I+2];I=E*M+p*K+C*O;H=y*M+B*K+F*O;M=A*M+D*K+G*O;v&&(K=I*I+H*H+M*M,.999999>K&&1E-6<K&&(K=1/Math.sqrt(K),I*=K,H*=K,M*=K));for(K=0;K<r;++K)x[t+0]=I,x[t+1]=H,x[t+2]=M,t+=q}}else n(m,z,q,t,r)}function e(m,
z,v,q,t,r=1){if(v){var x=q.typedBuffer;q=q.typedBufferStride;var u=m.length,E=v[0],y=v[1],A=v[2],p=v[4],B=v[5],D=v[6],C=v[8],F=v[9],G=v[10];v=!b.isOrthoNormal(v);t*=q;if(1===r)for(r=0;r<u;++r){var L=4*m[r],H=z[L],M=z[L+1],K=z[L+2];L=z[L+3];var I=E*H+p*M+C*K,O=y*H+B*M+F*K;H=A*H+D*M+G*K;v&&(M=I*I+O*O+H*H,.999999>M&&1E-6<M&&(M=1/Math.sqrt(M),I*=M,O*=M,H*=M));x[t+0]=I;x[t+1]=O;x[t+2]=H;x[t+3]=L;t+=q}else for(L=0;L<u;++L){I=4*m[L];M=z[I];K=z[I+1];const Q=z[I+2];I=z[I+3];O=E*M+p*K+C*Q;H=y*M+B*K+F*Q;M=A*
M+D*K+G*Q;v&&(K=O*O+H*H+M*M,.999999>K&&1E-6<K&&(K=1/Math.sqrt(K),O*=K,H*=K,M*=K));for(K=0;K<r;++K)x[t+0]=O,x[t+1]=H,x[t+2]=M,x[t+3]=I,t+=q}}else f(m,z,q,t,r)}function d(m,z,v,q,t,r=1){const x=q.typedBuffer;q=q.typedBufferStride;const u=m.length;t*=q;if(1===r)if(4===v)for(r=0;r<u;++r)v=4*m[r],x[t]=z[v],x[t+1]=z[v+1],x[t+2]=z[v+2],x[t+3]=z[v+3],t+=q;else{if(3===v)for(r=0;r<u;++r)v=3*m[r],x[t]=z[v],x[t+1]=z[v+1],x[t+2]=z[v+2],x[t+3]=255,t+=q}else if(4===v)for(v=0;v<u;++v){var E=4*m[v];for(var y=0;y<
r;++y)x[t]=z[E],x[t+1]=z[E+1],x[t+2]=z[E+2],x[t+3]=z[E+3],t+=q}else if(3===v)for(v=0;v<u;++v)for(E=3*m[v],y=0;y<r;++y)x[t]=z[E],x[t+1]=z[E+1],x[t+2]=z[E+2],x[t+3]=255,t+=q}a.writeBufferFloat=function(m,z,v,q,t=1){const r=v.typedBuffer;v=v.typedBufferStride;const x=m.length;q*=v;if(1===t)for(t=0;t<x;++t)r[q]=z[m[t]],q+=v;else for(let u=0;u<x;++u){const E=z[m[u]];for(let y=0;y<t;y++)r[q]=E,q+=v}};a.writeBufferMat3f=function(m,z,v,q){const t=v.typedBuffer;v=v.typedBufferStride;const r=m.length;q*=v;
for(let x=0;x<r;++x){const u=9*m[x];for(let E=0;9>E;++E)t[q+E]=z[u+E];q+=v}};a.writeBufferMat4f=function(m,z,v,q){const t=v.typedBuffer;v=v.typedBufferStride;const r=m.length;q*=v;for(let x=0;x<r;++x){const u=16*m[x];for(let E=0;16>E;++E)t[q+E]=z[u+E];q+=v}};a.writeBufferVec2=w;a.writeBufferVec3=n;a.writeBufferVec4=f;a.writeColor=d;a.writeDefaultAttributes=function(m,z,v,q,t,r){for(const u of z.fieldNames){z=m.vertexAttributes.get(u);const E=m.indices.get(u);if(z&&E)switch(u){case h.VertexAttribute.POSITION:g.assert(3===
z.size);var x=t.getField(u,c.BufferViewVec3f);x&&l(E,z.data,v,x,r);break;case h.VertexAttribute.NORMAL:g.assert(3===z.size);(x=t.getField(u,c.BufferViewVec3f))&&k(E,z.data,q,x,r);break;case h.VertexAttribute.UV0:g.assert(2===z.size);(x=t.getField(u,c.BufferViewVec2f))&&w(E,z.data,x,r);break;case h.VertexAttribute.COLOR:g.assert(3===z.size||4===z.size);(x=t.getField(u,c.BufferViewVec4u8))&&d(E,z.data,z.size,x,r);break;case h.VertexAttribute.SYMBOLCOLOR:g.assert(3===z.size||4===z.size);(x=t.getField(u,
c.BufferViewVec4u8))&&d(E,z.data,z.size,x,r);break;case h.VertexAttribute.TANGENT:g.assert(4===z.size),(x=t.getField(u,c.BufferViewVec4f))&&e(E,z.data,q,x,r)}}};a.writeNormal=k;a.writePosition=l;a.writeTangent=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/HUDMaterial.glsl":function(){define("exports ./vec2 ./vec2f64 ./vec4f64 ../views/3d/layers/graphics/sdfPrimitives ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x){function u(p){const B=new r.ShaderBuilder;var D=p.signedDistanceFieldEnabled;B.include(f.AlignPixel);B.include(l.HUD,p);B.include(n.Slice,p);if(p.output===w.ShaderOutput.Occlusion)return B.include(k.HUDOcclusionPass,p),B;B.include(q.ScreenSizePerspective);B.fragment.include(v.RgbaFloatEncoding);B.fragment.include(z.ColorConversion);B.include(d.VisualVariables,p);B.varyings.add("vcolor","vec4");B.varyings.add("vtc","vec2");B.varyings.add("vsize","vec2");
p.binaryHighlightOcclusionEnabled&&B.varyings.add("voccluded","float");B.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4");D&&B.vertex.uniforms.add("outlineColor","vec4");p.screenSizePerspectiveEnabled&&B.vertex.uniforms.add("screenSizePerspective","vec4");(p.debugDrawLabelBorder||p.binaryHighlightOcclusionEnabled)&&B.varyings.add("debugBorderCoords","vec4");B.attributes.add(x.VertexAttribute.UV0,"vec2");B.attributes.add(x.VertexAttribute.COLOR,
"vec4");B.attributes.add(x.VertexAttribute.SIZE,"vec2");B.attributes.add(x.VertexAttribute.AUXPOS2,"vec4");B.vertex.code.add(t.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${p.screenSizePerspectiveEnabled?t.glsl`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:t.glsl`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${p.vvSize?"inputSize *\x3d vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${p.occlusionTestEnabled||p.binaryHighlightOcclusionEnabled?"bool visible \x3d testVisibilityHUD(posProj);":""}

      ${p.binaryHighlightOcclusionEnabled?"voccluded \x3d visible ? 0.0 : 1.0;":""}
    `);var C=t.glsl`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`;const F=p.pixelSnappingEnabled?D?t.glsl`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:t.glsl`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:t.glsl`posProj += quadOffset;`;B.vertex.code.add(t.glsl`
      ${p.occlusionTestEnabled?"if (visible) {":""}
      ${C}
      ${p.vvColor?"vcolor \x3d vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor \x3d color / 255.0 * materialColor;"}

      bool alphaDiscard = vcolor.a < ${t.glsl.float(m.symbolAlphaCutoff)};
      ${D?`alphaDiscard = alphaDiscard && outlineColor.a < ${t.glsl.float(m.symbolAlphaCutoff)};`:""}
      if (alphaDiscard) {
        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      } else {
        ${F}
        gl_Position = posProj;
      }

      vtc = uv * textureCoordinateScaleFactor;

      ${p.debugDrawLabelBorder?"debugBorderCoords \x3d vec4(uv01, 1.5 / combinedSize);":""}
      vsize = inputSize;
      ${p.occlusionTestEnabled?t.glsl`} else { vtc = vec2(0.0);
        ${p.debugDrawLabelBorder?"debugBorderCoords \x3d vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
    }
    `);B.fragment.uniforms.add("tex","sampler2D");D&&(B.fragment.uniforms.add("outlineColor","vec4"),B.fragment.uniforms.add("outlineSize","float"));C=p.debugDrawLabelBorder?t.glsl`(isBorder > 0.0 ? 0.0 : ${t.glsl.float(m.defaultMaskAlphaCutoff)})`:t.glsl.float(m.defaultMaskAlphaCutoff);D=t.glsl`
    ${p.debugDrawLabelBorder?t.glsl`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${D?t.glsl`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${t.glsl.float(h.DEFAULT_TEX_SIZE)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${C} ||
          fillPixelColor.a + outlinePixelColor.a < ${t.glsl.float(m.symbolAlphaCutoff)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${C}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:t.glsl`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${C}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${p.debugDrawLabelBorder?t.glsl`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;p.output===w.ShaderOutput.Alpha&&B.fragment.code.add(t.glsl`
      void main() {
        ${D}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `);p.output===w.ShaderOutput.Color&&B.fragment.code.add(t.glsl`
    void main() {
      ${D}
      ${p.frontFacePass?"gl_FragColor.rgb /\x3d gl_FragColor.a;":""}
    }
    `);p.output===w.ShaderOutput.Highlight&&(B.include(e.OutputHighlight),B.fragment.code.add(t.glsl`
    void main() {
      ${D}
      ${p.binaryHighlightOcclusionEnabled?t.glsl`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `));return B}function E(p,B,D){p.setUniform4fv("materialColor",B.color);B.textureIsSignedDistanceField&&(0>=B.outlineColor[3]||0>=B.outlineSize?(p.setUniform4fv("outlineColor",g.ZEROS),p.setUniform1f("outlineSize",0)):(p.setUniform4fv("outlineColor",B.outlineColor),p.setUniform1f("outlineSize",B.outlineSize)));p.setUniform2f("screenOffset",2*B.screenOffset[0]*D,2*B.screenOffset[1]*D);p.setUniform2fv("anchorPos",y(B))}function y(p,B=A){if(p.textureIsSignedDistanceField){var D=p.anchorPos;p=p.distanceFieldBoundingBox;
B[0]=D[0]*(p[2]-p[0])+p[0];B[1]=D[1]*(p[3]-p[1])+p[1]}else b.copy(B,p.anchorPos);return B}const A=c.create();c=Object.freeze({__proto__:null,build:u,bindHUDMaterialUniforms:E,calculateAnchorPosForRendering:y});a.HUDMaterialShader=c;a.bindHUDMaterialUniforms=E;a.build=u;a.calculateAnchorPosForRendering=y})},"esri/views/3d/layers/graphics/sdfPrimitives":function(){define(["exports","../../../../core/has","../../../../core/floatRGBA","../../webgl-engine/lib/Texture","../../../webgl/enums"],function(a,
b,c,g,h){function w(x,u=128,E=.5*u,y=0){switch(x){case "circle":return n(u,E);case "square":return f(u,E);case "cross":return k(u,E,y);case "x":return e(u,E,y);case "kite":return l(u,E);case "triangle":return d(u,E);case "arrow":return m(u,E);default:return n(u,E)}}function n(x,u){const E=x/2-.5;return r(x,q(E,E,u/2))}function f(x,u){return z(x,u,!1)}function l(x,u){return z(x,u,!0)}function k(x,u,E=0){return v(x,u,!1,E)}function e(x,u,E=0){return v(x,u,!0,E)}function d(x,u){return r(x,t(x/2,u,u/
2))}function m(x,u){const E=u/2,y=x/2,A=.8*u,p=q(y,(x-u)/2-A,Math.sqrt(A*A+E*E)),B=t(y,u,E);return r(x,(D,C)=>Math.max(B(D,C),-p(D,C)))}function z(x,u,E){E&&(u/=Math.SQRT2);return r(x,(y,A)=>{y=y-.5*x+.25;A=-A+.5*x-.75;if(E){const p=(y+A)/Math.SQRT2;A=(A-y)/Math.SQRT2;y=p}return Math.max(Math.abs(y),Math.abs(A))-.5*u})}function v(x,u,E,y=0){u-=y;E&&(u*=Math.SQRT2);const A=.5*u;return r(x,(p,B)=>{p-=.5*x;B=-B+.5*x-1;if(E){const D=(p+B)/Math.SQRT2;B=(B-p)/Math.SQRT2;p=D}p=Math.abs(p);B=Math.abs(B);
p=p>B?p>A?Math.sqrt((p-A)*(p-A)+B*B):B:B>A?Math.sqrt(p*p+(B-A)*(B-A)):p;return p-=y/2})}function q(x,u,E){return(y,A)=>{y-=x;A-=u;return Math.sqrt(y*y+A*A)-E}}function t(x,u,E){const y=Math.sqrt(u*u+E*E);return(A,p)=>{p=p-x+u/2+.75;return Math.max((u*(Math.abs(A-x)-E)+E*p)/y,-p)}}function r(x,u){const E=new Uint8Array(4*x*x);for(let y=0;y<x;y++)for(let A=0;A<x;A++){const p=A+x*y;let B=u(A,y);B=B/x+.5;c.packFloatRGBA(B,E,4*p)}return E}a.DEFAULT_SYMBOL_SIZE_RATIO=.5;a.DEFAULT_TEX_SIZE=128;a.createArrow=
m;a.createCircle=n;a.createCross=k;a.createKite=l;a.createPrimitive=w;a.createSquare=f;a.createTexture=function(x,u=128,E=.5*u,y=0){x=w(x,u,E,y);return new g.Texture(x,{mipmap:!1,wrap:{s:h.TextureWrapMode.CLAMP_TO_EDGE,t:h.TextureWrapMode.CLAMP_TO_EDGE},width:u,height:u,components:4,noUnpackFlip:!0})};a.createTriangle=d;a.createX=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/floatRGBA":function(){define(["exports","./mathUtils"],function(a,b){function c(f,l=0){let k=0;for(let e=
0;4>e;e++)k+=f[l+e]*w[e];return k}function g(f){return f-Math.floor(f)}const h=[1,256,65536,16777216],w=[1/256,1/65536,1/16777216,1/4294967296],n=c(new Uint8ClampedArray([255,255,255,255]));a.packFloatRGBA=function(f,l,k=0){f=b.clamp(f,0,n);for(let e=0;4>e;e++)l[k+e]=Math.floor(256*g(f*h[e]))};a.unpackFloatRGBA=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Texture":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/compilerUtils ../../../../core/Error ../../../../core/Evented ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../core/urlUtils ../../../../support/requestImageUtils ../../../../support/requestUtils ./basicInterfaces ./BasisUtil ./ContentObject ./ContentObjectType ./DDSUtil ./glUtil3D ./Util ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util ../../../webgl/capabilities/isWebGL2Context".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p){v=function(D){function C(G,L){var H=D.call(this)||this;H.data=G;H.type=q.ContentObjectType.Texture;H._glTexture=null;H._powerOfTwoStretchInfo=null;H._loadingPromise=null;H._loadingController=null;H.events=new h;H.params=L||{};H.params.mipmap=!1!==H.params.mipmap;H.params.noUnpackFlip=H.params.noUnpackFlip||!1;H.params.preMultiplyAlpha=H.params.preMultiplyAlpha||!1;H.params.wrap=H.params.wrap||{s:u.TextureWrapMode.REPEAT,t:u.TextureWrapMode.REPEAT};
H.params.powerOfTwoResizeMode=H.params.powerOfTwoResizeMode||m.PowerOfTwoResizeMode.STRETCH;H.estimatedTexMemRequired=C._estimateTexMemRequired(H.data,H.params);H._startPreload();return H}b._inheritsLoose(C,D);var F=C.prototype;F._startPreload=function(){const G=this.data;n.isNone(G)||(G instanceof HTMLVideoElement?this._startPreloadVideoElement(G):G instanceof HTMLImageElement&&this._startPreloadImageElement(G))};F._startPreloadVideoElement=function(G){k.isBlobProtocol(G.src)||"auto"===G.preload&&
G.crossOrigin||(G.preload="auto",G.crossOrigin="anonymous",G.src=G.src)};F._startPreloadImageElement=function(G){k.isDataProtocol(G.src)||k.isBlobProtocol(G.src)||G.crossOrigin||(G.crossOrigin="anonymous",G.src=G.src)};C._getDataDimensions=function(G){return G instanceof HTMLVideoElement?{width:G.videoWidth,height:G.videoHeight}:G};C._estimateTexMemRequired=function(G,L){if(n.isNone(G))return 0;if(l.isArrayBuffer(G)||l.isUint8Array(G))return L.encoding===C.KTX2_ENCODING?z.estimateMemoryKTX2(G,L.mipmap):
L.encoding===C.BASIS_ENCODING?z.estimateMemoryBasis(G,L.mipmap):G.byteLength;const {width:H,height:M}=G instanceof Image||G instanceof ImageData||G instanceof HTMLCanvasElement||G instanceof HTMLVideoElement?C._getDataDimensions(G):L;return(L.mipmap?4/3:1)*H*M*(L.components||4)||0};F.dispose=function(){this.data=void 0};F._createDescriptor=function(G){var L;return{target:u.TextureType.TEXTURE_2D,pixelFormat:u.PixelFormat.RGBA,dataType:u.PixelType.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,
samplingMode:this.params.mipmap?u.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:u.TextureSamplingMode.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:null!=(L=this.params.maxAnisotropy)?L:this.params.mipmap?G.parameters.maxMaxAnisotropy:1}};F.load=function(G,L){if(n.isSome(this._glTexture))return this._glTexture;if(n.isSome(this._loadingPromise))return this._loadingPromise;const H=this.data;return n.isNone(H)?this._glTexture=new y.Texture(G,this._createDescriptor(G),
null):"string"===typeof H?this._loadFromURL(G,L,H):H instanceof Image?this._loadFromImageElement(G,L,H):H instanceof HTMLVideoElement?this._loadFromVideoElement(G,L,H):H instanceof ImageData||H instanceof HTMLCanvasElement?this._loadFromImage(G,H,L):(l.isArrayBuffer(H)||l.isUint8Array(H))&&this.params.encoding===C.DDS_ENCODING?(this.data=void 0,this._loadFromDDSData(G,H)):(l.isArrayBuffer(H)||l.isUint8Array(H))&&this.params.encoding===C.KTX2_ENCODING?(this.data=void 0,this._loadFromKTX2(G,H)):(l.isArrayBuffer(H)||
l.isUint8Array(H))&&this.params.encoding===C.BASIS_ENCODING?(this.data=void 0,this._loadFromBasis(G,H)):l.isUint8Array(H)?this._loadFromPixelData(G,H):l.isArrayBuffer(H)?this._loadFromPixelData(G,new Uint8Array(H)):null};F.frameUpdate=function(G,L,H){if(!(this.data instanceof HTMLVideoElement)||n.isNone(this._glTexture)||this.data.readyState<B.HAVE_CURRENT_DATA||H===this.data.currentTime)return H;if(n.isSome(this._powerOfTwoStretchInfo)){const {framebuffer:M,vao:K,sourceTexture:I}=this._powerOfTwoStretchInfo;
I.setData(this.data);this._drawStretchedTexture(G,L,M,K,I,this._glTexture)}else{const {width:M,height:K}=this.data,{width:I,height:O}=this._glTexture.descriptor;M!==I||K!==O?this._glTexture.updateData(0,0,0,Math.min(M,I),Math.min(K,O),this.data):this._glTexture.setData(this.data)}this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap();return this.data.currentTime};F._loadFromDDSData=function(G,L){return this._glTexture=t.createDDSTexture(G,this._createDescriptor(G),L)};F._loadFromKTX2=
function(G,L){return this._loadAsync(()=>z.createTextureKTX2(G,this._createDescriptor(G),L).then(H=>this._glTexture=H))};F._loadFromBasis=function(G,L){return this._loadAsync(()=>z.createTextureBasis(G,this._createDescriptor(G),L).then(H=>this._glTexture=H))};F._loadFromPixelData=function(G,L){x.assert(0<this.params.width&&0<this.params.height);const H=this._createDescriptor(G);H.pixelFormat=1===this.params.components?u.PixelFormat.LUMINANCE:3===this.params.components?u.PixelFormat.RGB:u.PixelFormat.RGBA;
H.width=this.params.width;H.height=this.params.height;return this._glTexture=new y.Texture(G,H,L)};F._loadFromURL=function(G,L,H){var M=this;return this._loadAsync(function(){var K=b._asyncToGenerator(function*(I){const O=yield e.requestImage(H,{signal:I});f.throwIfAborted(I);return M._loadFromImage(G,O,L)});return function(I){return K.apply(this,arguments)}}())};F._loadFromImageElement=function(G,L,H){var M=this;return H.complete?this._loadFromImage(G,H,L):this._loadAsync(function(){var K=b._asyncToGenerator(function*(I){const O=
yield d.loadImageAsync(H,H.src,!1,I);f.throwIfAborted(I);return M._loadFromImage(G,O,L)});return function(I){return K.apply(this,arguments)}}())};F._loadFromVideoElement=function(G,L,H){return H.readyState>=B.HAVE_CURRENT_DATA?this._loadFromImage(G,H,L):this._loadFromVideoElementAsync(G,L,H)};F._loadFromVideoElementAsync=function(G,L,H){return this._loadAsync(M=>new Promise((K,I)=>{const O=()=>{H.removeEventListener("loadeddata",Q);H.removeEventListener("error",J);n.removeMaybe(P)},Q=()=>{H.readyState>=
B.HAVE_CURRENT_DATA&&(O(),K(this._loadFromImage(G,H,L)))},J=N=>{O();I(N||new g("Failed to load video"))};H.addEventListener("loadeddata",Q);H.addEventListener("error",J);const P=f.onAbort(M,()=>J(f.createAbortError()))}))};F._loadFromImage=function(G,L,H){const M=C._getDataDimensions(L);this.params.width=M.width;this.params.height=M.height;const K=this._createDescriptor(G);K.pixelFormat=3===this.params.components?u.PixelFormat.RGB:u.PixelFormat.RGBA;if(this._requiresPowerOfTwo(G,K)&&(!w.isPowerOfTwo(M.width)||
!w.isPowerOfTwo(M.height)))return this._glTexture=this._makePowerOfTwoTexture(G,L,M,K,H);K.width=M.width;K.height=M.height;return this._glTexture=new y.Texture(G,K,L)};F._loadAsync=function(G){const L=new AbortController;this._loadingController=L;const H=G(L.signal);this._loadingPromise=H;G=()=>{this._loadingController===L&&(this._loadingController=null);this._loadingPromise===H&&(this._loadingPromise=null)};H.then(G,G);return H};F._requiresPowerOfTwo=function(G,L){var H=u.TextureWrapMode.CLAMP_TO_EDGE;
H="number"===typeof L.wrapMode?L.wrapMode===H:L.wrapMode.s===H&&L.wrapMode.t===H;return!p(G.gl)&&(L.hasMipmap||!H)};F._makePowerOfTwoTexture=function(G,L,H,M,K){const {width:I,height:O}=H;H=w.nextHighestPowerOfTwo(I);const Q=w.nextHighestPowerOfTwo(O);M.width=H;M.height=Q;let J;switch(this.params.powerOfTwoResizeMode){case m.PowerOfTwoResizeMode.PAD:M.textureCoordinateScaleFactor=[I/H,O/Q];J=new y.Texture(G,M);J.updateData(0,0,0,I,O,L);break;case m.PowerOfTwoResizeMode.STRETCH:case null:case void 0:J=
this._stretchToPowerOfTwo(G,L,M,K());break;default:c.neverReached(this.params.powerOfTwoResizeMode)}M.hasMipmap&&J.generateMipmap();return J};F._stretchToPowerOfTwo=function(G,L,H,M){const K=new y.Texture(G,H),I=new E.FramebufferObject(G,{colorTarget:u.TargetType.TEXTURE,depthStencilTarget:u.DepthStencilTargetType.NONE},K);L=new y.Texture(G,{target:u.TextureType.TEXTURE_2D,pixelFormat:H.pixelFormat,dataType:u.PixelType.UNSIGNED_BYTE,wrapMode:u.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:u.TextureSamplingMode.LINEAR,
flipped:!!H.flipped,maxAnisotropy:8,preMultiplyAlpha:H.preMultiplyAlpha},L);H=r.createQuadVAO(G);const O=G.getBoundFramebufferObject();this._drawStretchedTexture(G,M,I,H,L,K);this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:H,sourceTexture:L,framebuffer:I}:(H.dispose(!0),L.dispose(),I.detachColorTexture(),I.dispose());G.bindFramebuffer(O);return K};F._drawStretchedTexture=function(G,L,H,M,K,I){G.bindFramebuffer(H);H=G.getViewport();G.setViewport(0,0,I.descriptor.width,I.descriptor.height);
L=G.useTechnique(L);L.setUniform4f("uColor",1,1,1,1);L.bindTexture(K,"tex");G.bindVAO(M);G.drawArrays(u.PrimitiveType.TRIANGLE_STRIP,0,A.vertexCount(M,"geometry"));G.bindFramebuffer(null);G.setViewport(H.x,H.y,H.width,H.height)};F.unload=function(){if(n.isSome(this._powerOfTwoStretchInfo)){const {framebuffer:G,vao:L,sourceTexture:H}=this._powerOfTwoStretchInfo;L.dispose(!0);H.dispose();G.dispose();this._powerOfTwoStretchInfo=this._glTexture=null}n.isSome(this._glTexture)&&(this._glTexture.dispose(),
this._glTexture=null);if(n.isSome(this._loadingController)){const G=this._loadingController;this._loadingPromise=this._loadingController=null;G.abort()}this.events.emit("unloaded")};b._createClass(C,[{key:"width",get:function(){return this.params.width}},{key:"height",get:function(){return this.params.height}},{key:"glTexture",get:function(){return this._glTexture}},{key:"requiresFrameUpdates",get:function(){return this.data instanceof HTMLVideoElement}}]);return C}(v.ContentObject);v.DDS_ENCODING=
"image/vnd-ms.dds";v.KTX2_ENCODING="image/ktx2";v.BASIS_ENCODING="image/x.basis";var B;(function(D){D[D.HAVE_NOTHING=0]="HAVE_NOTHING";D[D.HAVE_METADATA=1]="HAVE_METADATA";D[D.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA";D[D.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA";D[D.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(B||(B={}));a.Texture=v;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/BasisUtil":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../libs/basisu/BasisU ../../../../libs/basisu/TextureFormat ../../../webgl/enums ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,b,c,g,h,w,n,f){function l(){return k.apply(this,arguments)}function k(){k=b._asyncToGenerator(function*(){c.isNone(r)&&(r=g.getBasisTranscoder(),t=yield r);return r});return k.apply(this,arguments)}function e(x,u,E,y,A){u=f.getBytesPerElementFormat(u?w.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:w.CompressedTextureFormat.COMPRESSED_RGB8_ETC2);return Math.ceil(E*y*u*(A&&1<x?(4**x-1)/(3*4**(x-1)):1))}function d(x){return 1<=x.getNumImages()&&!x.isUASTC()}function m(x){return 1<=x.getFaces()&&
x.isETC1S()}function z(){z=b._asyncToGenerator(function*(x,u,E){c.isNone(t)&&(t=yield l());const y=new t.BasisFile(new Uint8Array(E));if(!d(y))return null;y.startTranscoding();x=q(x,u,y.getNumLevels(0),y.getHasAlpha(),y.getImageWidth(0,0),y.getImageHeight(0,0),(A,p)=>y.getImageTranscodedSizeInBytes(0,A,p),(A,p,B)=>y.transcodeImage(B,0,A,p,0,0));y.close();y.delete();return x});return z.apply(this,arguments)}function v(){v=b._asyncToGenerator(function*(x,u,E){c.isNone(t)&&(t=yield l());const y=new t.KTX2File(new Uint8Array(E));
if(!m(y))return null;y.startTranscoding();x=q(x,u,y.getLevels(),y.getHasAlpha(),y.getWidth(),y.getHeight(),(A,p)=>y.getImageTranscodedSizeInBytes(A,0,0,p),(A,p,B)=>y.transcodeImage(B,A,0,0,p,0,-1,-1));y.close();y.delete();return x});return v.apply(this,arguments)}function q(x,u,E,y,A,p,B,D){const {compressedTextureETC:C,compressedTextureS3TC:F}=x.capabilities,[G,L]=C?y?[h.TextureFormat.ETC2_RGBA,w.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC]:[h.TextureFormat.ETC1_RGB,w.CompressedTextureFormat.COMPRESSED_RGB8_ETC2]:
F?y?[h.TextureFormat.BC3_RGBA,w.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[h.TextureFormat.BC1_RGB,w.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT]:[h.TextureFormat.RGBA32,w.PixelFormat.RGBA];y=u.hasMipmap?E:Math.min(1,E);E=[];for(let H=0;H<y;H++)E.push(new Uint8Array(B(H,G))),D(H,G,E[H]);B=1<E.length;return new n.Texture(x,{...u,samplingMode:B?w.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:w.TextureSamplingMode.LINEAR,hasMipmap:B,internalFormat:L,width:A,height:p},{type:"compressed",
levels:E})}let t=null,r=null;a.createTextureBasis=function(x,u,E){return z.apply(this,arguments)};a.createTextureKTX2=function(x,u,E){return v.apply(this,arguments)};a.estimateMemoryBasis=function(x,u){if(c.isNone(t))return x.byteLength;x=new t.BasisFile(new Uint8Array(x));u=d(x)?e(x.getNumLevels(0),x.getHasAlpha(),x.getImageWidth(0,0),x.getImageHeight(0,0),u):0;x.close();x.delete();return u};a.estimateMemoryKTX2=function(x,u){if(c.isNone(t))return x.byteLength;x=new t.KTX2File(new Uint8Array(x));
u=m(x)?e(x.getLevels(),x.getHasAlpha(),x.getWidth(),x.getHeight(),u):0;x.close();x.delete();return u};a.loadBasis=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/libs/basisu/BasisU":function(){define(["require","exports","../../assets","../../core/maybe"],function(a,b,c,g){let h;b.getBasisTranscoder=function(){if(g.isNone(h)){const w=n=>c.getAssetUrl(`esri/libs/basisu/${n}`);h=(new Promise((n,f)=>a(["../../chunks/basis_transcoder"],n,f))).then(n=>n.basis_transcoder).then(({default:n})=>
n({locateFile:w}).then(f=>{f.initializeBasis();delete f.then;return f}))}return h};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/libs/basisu/TextureFormat":function(){define(["exports"],function(a){a.TextureFormat=void 0;var b=a.TextureFormat||(a.TextureFormat={});b[b.ETC1_RGB=0]="ETC1_RGB";b[b.ETC2_RGBA=1]="ETC2_RGBA";b[b.BC1_RGB=2]="BC1_RGB";b[b.BC3_RGBA=3]="BC3_RGBA";b[b.BC4_R=4]="BC4_R";b[b.BC5_RG=5]="BC5_RG";b[b.BC7_M6_RGB=6]="BC7_M6_RGB";b[b.BC7_M5_RGBA=7]="BC7_M5_RGBA";b[b.PVRTC1_4_RGB=
8]="PVRTC1_4_RGB";b[b.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA";b[b.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA";b[b.ATC_RGB=11]="ATC_RGB";b[b.ATC_RGBA=12]="ATC_RGBA";b[b.FXT1_RGB=17]="FXT1_RGB";b[b.PVRTC2_4_RGB=18]="PVRTC2_4_RGB";b[b.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA";b[b.ETC2_EAC_R11=20]="ETC2_EAC_R11";b[b.ETC2_EAC_RG11=21]="ETC2_EAC_RG11";b[b.RGBA32=13]="RGBA32";b[b.RGB565=14]="RGB565";b[b.BGR565=15]="BGR565";b[b.RGBA4444=16]="RGBA4444";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["exports",
"../../../../core/Logger","../../../../core/mathUtils","../../../webgl/enums","../../../webgl/Texture"],function(a,b,c,g,h){function w(d){return d.charCodeAt(0)+(d.charCodeAt(1)<<8)+(d.charCodeAt(2)<<16)+(d.charCodeAt(3)<<24)}function n(d,m){var z=new Int32Array(d,0,31);if(542327876!==z[0])return f.error("Invalid magic number in DDS header"),null;if(!(z[20]&4))return f.error("Unsupported format, must contain a FourCC code"),null;var v=z[21];let q;switch(v){case l:v=8;q=g.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT;
break;case k:v=16;q=g.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case e:v=16;q=g.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return f.error("Unsupported FourCC code:",String.fromCharCode(v&255,v>>8&255,v>>16&255,v>>24&255)),null}let t=1,r=z[4],x=z[3];if(0!==(r&3)||0!==(x&3))f.warn("Rounding up compressed texture size to nearest multiple of 4."),r=r+3&-4,x=x+3&-4;const u=r,E=x;z[2]&131072&&!1!==m&&(t=Math.max(1,z[7]));1===t||c.isPowerOfTwo(r)&&c.isPowerOfTwo(x)||
(f.warn("Ignoring mipmaps of non power of two sized compressed texture."),t=1);let y=z[1]+4;const A=[];for(let p=0;p<t;++p)z=(r+3>>2)*(x+3>>2)*v,m=new Uint8Array(d,y,z),A.push(m),y+=z,r=Math.max(1,r>>1),x=Math.max(1,x>>1);return{textureData:{type:"compressed",levels:A},internalFormat:q,width:u,height:E}}const f=b.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),l=w("DXT1"),k=w("DXT3"),e=w("DXT5");a.createDDSTexture=function(d,m,z){const {textureData:v,internalFormat:q,width:t,height:r}=n(z,m.hasMipmap);
m.samplingMode=1<v.levels.length?g.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:g.TextureSamplingMode.LINEAR;m.hasMipmap=1<v.levels.length;m.internalFormat=q;m.width=t;m.height=r;return new h.Texture(d,m,v)};a.createDDSTextureData=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl":function(){define("exports ../../../../../core/maybe ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../shaderModules/interfaces".split(" "),
function(a,b,c,g,h,w,n){function f(m,z,v,q){z.slicePlaneEnabled&&(b.isSome(v)?(h.copy(l,v.origin),h.copy(k,v.basis1),h.copy(e,v.basis2),b.isSome(q)&&b.isSome(q.origin)&&h.subtract(l,v.origin,q.origin),b.isSome(q)&&b.isSome(q.view)&&(z=b.isSome(q.origin)?c.translate(d,q.view,q.origin):q.view,h.add(k,k,l),h.add(e,e,l),h.transformMat4(l,l,z),h.transformMat4(k,k,z),h.transformMat4(e,e,z),h.subtract(k,k,l),h.subtract(e,e,l)),m.setUniform3fv("slicePlaneOrigin",l),m.setUniform3fv("slicePlaneBasis1",k),m.setUniform3fv("slicePlaneBasis2",
e)):(m.setUniform3fv("slicePlaneBasis1",w.ZEROS),m.setUniform3fv("slicePlaneBasis2",w.ZEROS),m.setUniform3fv("slicePlaneOrigin",w.ZEROS)))}const l=w.create(),k=w.create(),e=w.create(),d=g.create();a.Slice=function(m,z){if(z.slicePlaneEnabled){m.extensions.add("GL_OES_standard_derivatives");z.sliceEnabledForVertexPrograms&&(m.vertex.uniforms.add("slicePlaneOrigin","vec3"),m.vertex.uniforms.add("slicePlaneBasis1","vec3"),m.vertex.uniforms.add("slicePlaneBasis2","vec3"));m.fragment.uniforms.add("slicePlaneOrigin",
"vec3");m.fragment.uniforms.add("slicePlaneBasis1","vec3");m.fragment.uniforms.add("slicePlaneBasis2","vec3");var v=n.glsl`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,q=n.glsl`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`;q=z.sliceHighlightDisabled?n.glsl`#define highlightSlice(_color_, _pos_) (_color_)`:n.glsl`
        ${q}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `;z.sliceEnabledForVertexPrograms&&m.vertex.code.add(v);m.fragment.code.add(v);m.fragment.code.add(q)}else v=n.glsl`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`,z.sliceEnabledForVertexPrograms&&m.vertex.code.add(v),m.fragment.code.add(v)};a.bindSliceUniforms=f;a.bindSliceUniformsWithOrigin=function(m,z,v){f(m,z,v.slicePlane,{origin:v.origin})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl":function(){define(["exports","../output/ReadLinearDepth.glsl","../shading/MultipassGeometryTest.glsl","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],
function(a,b,c,g,h){a.HUDOcclusionPass=function(w,n){n.multipassGeometryEnabled&&w.vertex.include(c.multipassGeometryTest);n.multipassTerrainEnabled&&w.varyings.add("depth","float");w.vertex.code.add(h.glsl`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${n.multipassGeometryEnabled?h.glsl`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${n.multipassTerrainEnabled?"depth \x3d projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `);n.multipassTerrainEnabled&&w.fragment.include(b.ReadLinearDepth);w.fragment.uniforms.add("terrainDepthTexture","sampler2D");w.fragment.uniforms.add("nearFar","vec2");w.fragment.uniforms.add("inverseViewport","vec2");w.fragment.include(g.RgbaFloatEncoding);w.fragment.code.add(h.glsl`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${n.multipassTerrainEnabled?h.glsl`

          vec2 uv = gl_FragCoord.xy * inverseViewport;

          //Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          //Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl":function(){define(["exports","../output/ReadLinearDepth.glsl","../../shaderModules/interfaces"],function(a,b,c){a.bindMultipassGeometryTexture=function(g,h){h.multipassGeometryEnabled&&h.geometryLinearDepthTexture&&g.bindTexture(h.geometryLinearDepthTexture,"geometryDepthTexture")};a.multipassGeometryTest=function(g){g.include(b.ReadLinearDepth);g.uniforms.add("geometryDepthTexture",
"sampler2D");g.uniforms.add("nearFar","vec2");g.code.add(c.glsl`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl":function(){define(["exports","../../../../../../chunks/vec4f64","../../shaderModules/interfaces"],function(a,b,c){const g=b.fromValues(1,1,0,1),h=b.fromValues(1,0,1,1);a.OutputHighlight=function(w){w.fragment.uniforms.add("depthTex","sampler2D");w.fragment.uniforms.add("highlightViewportPixelSz","vec4");w.fragment.constants.add("occludedHighlightFlag","vec4",g).add("unoccludedHighlightFlag",
"vec4",h);w.fragment.code.add(c.glsl`void outputHighlight() {
vec4 fragCoord = gl_FragCoord;
float sceneDepth = texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;
if (fragCoord.z > sceneDepth + 5e-7) {
gl_FragColor = occludedHighlightFlag;
}
else {
gl_FragColor = unoccludedHighlightFlag;
}
}`)};a.bindOutputHighlight=function(w,n){w.bindTexture(n.highlightDepthTexture,"depthTex");w.setUniform4f("highlightViewportPixelSz",0,0,n.inverseViewport[0],n.inverseViewport[1])};a.occludedHighlightFlag=g;a.unoccludedHighlightFlag=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c){function g(h,w){w.vvSizeEnabled&&
(h.setUniform3fv("vvSizeMinSize",w.vvSizeMinSize),h.setUniform3fv("vvSizeMaxSize",w.vvSizeMaxSize),h.setUniform3fv("vvSizeOffset",w.vvSizeOffset),h.setUniform3fv("vvSizeFactor",w.vvSizeFactor));w.vvColorEnabled&&(h.setUniform1fv("vvColorValues",w.vvColorValues),h.setUniform4fv("vvColorColors",w.vvColorColors))}a.VisualVariables=function(h,w){w.vvInstancingEnabled&&(w.vvSize||w.vvColor)&&h.attributes.add(c.VertexAttribute.INSTANCEFEATUREATTRIBUTE,"vec4");w.vvSize?(h.vertex.uniforms.add("vvSizeMinSize",
"vec3"),h.vertex.uniforms.add("vvSizeMaxSize","vec3"),h.vertex.uniforms.add("vvSizeOffset","vec3"),h.vertex.uniforms.add("vvSizeFactor","vec3"),h.vertex.uniforms.add("vvSymbolRotationMatrix","mat3"),h.vertex.uniforms.add("vvSymbolAnchor","vec3"),h.vertex.code.add(b.glsl`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),h.vertex.code.add(b.glsl`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${w.vvInstancingEnabled?b.glsl`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):h.vertex.code.add(b.glsl`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`);w.vvColor?(h.vertex.constants.add("vvColorNumber","int",8),h.vertex.code.add(b.glsl`
      uniform float vvColorValues[vvColorNumber];
      uniform vec4 vvColorColors[vvColorNumber];

      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${w.vvInstancingEnabled?b.glsl`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):h.vertex.code.add(b.glsl`vec4 vvColor() { return vec4(1.0); }`)};a.bindVisualVariablesUniforms=g;a.bindVisualVariablesUniformsForSymbols=function(h,w){g(h,w);w.vvSizeEnabled&&(h.setUniform3fv("vvSymbolAnchor",w.vvSymbolAnchor),h.setUniformMatrix3fv("vvSymbolRotationMatrix",w.vvSymbolRotationMatrix))};a.bindVisualVariablesUniformsWithOpacity=function(h,w){g(h,w);w.vvOpacityEnabled&&(h.setUniform1fv("vvOpacityValues",w.vvOpacityValues),h.setUniform1fv("vvOpacityOpacities",w.vvOpacityOpacities))};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/basicInterfaces"],function(a,b,c){a.DiscardOrAdjustAlpha=function(g,h){const w=g.fragment;switch(h.alphaDiscardMode){case c.AlphaDiscardMode.Blend:w.code.add(b.glsl`
        #define discardOrAdjustAlpha(color) { if (color.a < ${b.glsl.float(.001)}) { discard; } }
      `);break;case c.AlphaDiscardMode.Opaque:w.code.add(b.glsl`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case c.AlphaDiscardMode.Mask:w.uniforms.add("textureAlphaCutoff","float");w.code.add(b.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case c.AlphaDiscardMode.MaskBlend:g.fragment.uniforms.add("textureAlphaCutoff","float"),g.fragment.code.add(b.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}};a.defaultMaskAlphaCutoff=.1;a.symbolAlphaCutoff=.001;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../core/shaderLibrary/hud/HUD.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/MultipassGeometryTest.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/ScreenSizePerspective.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../../../../chunks/HUDMaterial.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p){q=function(C){function F(){return C.apply(this,arguments)||this}c._inheritsLoose(F,C);var G=F.prototype;G.initializeProgram=function(L){var H=F.shader.get();const M=this.configuration;H=H.build({output:M.output,frontFacePass:M.transparencyPassType===r.TransparencyPassType.FrontFace,viewingMode:L.viewingMode,occlusionTestEnabled:M.occlusionTestEnabled,signedDistanceFieldEnabled:M.sdf,slicePlaneEnabled:M.slicePlaneEnabled,sliceHighlightDisabled:!1,
sliceEnabledForVertexPrograms:!0,debugDrawLabelBorder:M.debugDrawLabelBorder,binaryHighlightOcclusionEnabled:M.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:M.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:M.screenSizePerspective,verticalOffsetEnabled:M.verticalOffset,pixelSnappingEnabled:M.pixelSnappingEnabled,vvSize:M.vvSize,vvColor:M.vvColor,vvInstancingEnabled:!1,isDraped:M.isDraped,multipassGeometryEnabled:M.multipassGeometryEnabled,multipassTerrainEnabled:M.multipassTerrainEnabled,
cullAboveGround:M.cullAboveGround});return new E.Program(L.rctx,H,x.Default3D)};G.bindPass=function(L,H){z.bindProjectionMatrix(this.program,H.camera.projectionMatrix);this.program.setUniform1f("cameraGroundRelative",H.camera.aboveGround?1:-1);this.program.setUniform1f("perDistancePixelRatio",Math.tan(H.camera.fovY/2)/(H.camera.fullViewport[2]/2));this.program.setUniformMatrix4fv("viewNormal",H.camera.viewInverseTransposeMatrix);this.program.setUniform1f("polygonOffset",L.shaderPolygonOffset);n.bindVerticalOffsetUniforms(this.program,
L,H);m.bindScreenSizePerspectiveUniforms(this.program,L);this.program.setUniform1f("pixelRatio",H.camera.pixelRatio||1);z.bindViewport(this.program,H);this.configuration.output===h.ShaderOutput.Occlusion?(this.program.setUniform2fv("nearFar",H.camera.nearFar),this.program.setUniform2fv("inverseViewport",H.inverseViewport),k.bindMultipassGeometryTexture(this.program,H),e.bindMultipassTerrainTexture(this.program,H)):(f.bindHUDUniforms(this.program,H),y.bindHUDMaterialUniforms(this.program,L,H.camera.pixelRatio||
1),d.bindVisualVariablesUniforms(this.program,L),this.configuration.occlusionTestEnabled&&this.program.bindTexture(H.hudVisibilityTexture,"hudVisibilityTexture"));this.configuration.output===h.ShaderOutput.Highlight&&l.bindOutputHighlight(this.program,H)};G.bindDraw=function(L){z.bindView(this.program,L);z.bindCameraPosition(this.program,L.origin,L.camera.viewInverseTransposeMatrix);w.bindSliceUniformsWithOrigin(this.program,this.configuration,L);this.program.rebindTextures()};G._setPipelineState=
function(L){const H=this.configuration,M=L===r.TransparencyPassType.NONE;var K=L===r.TransparencyPassType.FrontFace;const I=A.CompareFunction.LEQUAL,O=this.configuration.polygonOffsetEnabled&&B;K=(M||K)&&H.output!==h.ShaderOutput.Highlight?(H.depthEnabled||H.output===h.ShaderOutput.Occlusion)&&p.defaultDepthWriteParams:null;return p.makePipelineState({blending:H.output===h.ShaderOutput.Color||H.output===h.ShaderOutput.Alpha||H.output===h.ShaderOutput.Highlight?M?D:u.oitBlending(L):null,depthTest:{func:I},
depthWrite:K,colorWrite:p.defaultColorWriteParams,polygonOffset:O})};G.initializePipeline=function(){return this._setPipelineState(this.configuration.transparencyPassType)};c._createClass(F,[{key:"primitiveType",get:function(){return this.configuration.output===h.ShaderOutput.Occlusion?A.PrimitiveType.POINTS:A.PrimitiveType.TRIANGLES}}]);return F}(q.ShaderTechnique);q.shader=new v.ReloadableShaderModule(y.HUDMaterialShader,()=>new Promise((C,F)=>a(["./HUDMaterial.glsl"],C,F)));const B={factor:0,units:-4},
D=p.simpleBlendingParams(A.BlendFactor.ONE,A.BlendFactor.ONE_MINUS_SRC_ALPHA);v=function(C){function F(){var G=C.apply(this,arguments)||this;G.output=h.ShaderOutput.Color;G.occlusionTestEnabled=!0;G.sdf=!1;G.vvSize=!1;G.vvColor=!1;G.verticalOffset=!1;G.screenSizePerspective=!1;G.screenCenterOffsetUnitsEnabled=f.HUDSpace.World;G.debugDrawLabelBorder=!1;G.binaryHighlightOcclusion=!0;G.slicePlaneEnabled=!1;G.polygonOffsetEnabled=!1;G.depthEnabled=!0;G.transparencyPassType=r.TransparencyPassType.NONE;
G.pixelSnappingEnabled=!0;G.isDraped=!1;G.multipassGeometryEnabled=!1;G.multipassTerrainEnabled=!1;G.cullAboveGround=!1;return G}c._inheritsLoose(F,C);return F}(t.ShaderTechniqueConfiguration);g.__decorate([t.parameter({count:h.ShaderOutput.COUNT})],v.prototype,"output",void 0);g.__decorate([t.parameter()],v.prototype,"occlusionTestEnabled",void 0);g.__decorate([t.parameter()],v.prototype,"sdf",void 0);g.__decorate([t.parameter()],v.prototype,"vvSize",void 0);g.__decorate([t.parameter()],v.prototype,
"vvColor",void 0);g.__decorate([t.parameter()],v.prototype,"verticalOffset",void 0);g.__decorate([t.parameter()],v.prototype,"screenSizePerspective",void 0);g.__decorate([t.parameter({count:f.HUDSpace.COUNT})],v.prototype,"screenCenterOffsetUnitsEnabled",void 0);g.__decorate([t.parameter()],v.prototype,"debugDrawLabelBorder",void 0);g.__decorate([t.parameter()],v.prototype,"binaryHighlightOcclusion",void 0);g.__decorate([t.parameter()],v.prototype,"slicePlaneEnabled",void 0);g.__decorate([t.parameter()],
v.prototype,"polygonOffsetEnabled",void 0);g.__decorate([t.parameter()],v.prototype,"depthEnabled",void 0);g.__decorate([t.parameter({count:r.TransparencyPassType.COUNT})],v.prototype,"transparencyPassType",void 0);g.__decorate([t.parameter()],v.prototype,"pixelSnappingEnabled",void 0);g.__decorate([t.parameter()],v.prototype,"isDraped",void 0);g.__decorate([t.parameter()],v.prototype,"multipassGeometryEnabled",void 0);g.__decorate([t.parameter()],v.prototype,"multipassTerrainEnabled",void 0);g.__decorate([t.parameter()],
v.prototype,"cullAboveGround",void 0);b.HUDMaterialTechnique=q;b.HUDMaterialTechniqueConfiguration=v;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl":function(){define(["exports","../../../../../ViewingMode","../util/ScreenSizePerspective.glsl","../../shaderModules/interfaces"],function(a,b,c,g){function h(n,f,l,k=w){k.screenLength=n.screenLength;k.perDistance=Math.tan(.5*f)/(.5*l);k.minWorldLength=n.minWorldLength;
k.maxWorldLength=n.maxWorldLength;return k}const w={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0};a.VerticalOffset=function(n,f){const l=n.vertex.code;f.verticalOffsetEnabled?(n.vertex.uniforms.add("verticalOffset","vec4"),f.screenSizePerspectiveEnabled&&(n.include(c.ScreenSizePerspective),n.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4")),l.add(g.glsl`
    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
      ${f.viewingMode===b.ViewingMode.Global?g.glsl`vec3 worldNormal = normalize(worldPos + localOrigin);`:g.glsl`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
      ${f.screenSizePerspectiveEnabled?g.glsl`
          float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
          float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:g.glsl`
          float verticalOffsetScreenHeight = verticalOffset.x;`}
      // Screen sized offset in world space, used for example for line callouts
      float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
      return worldNormal * worldOffset;
    }

    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      return worldPos + calculateVerticalOffset(worldPos, localOrigin);
    }
    `)):l.add(g.glsl`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)};a.bindVerticalOffsetUniforms=function(n,f,l){f.verticalOffset&&(f=h(f.verticalOffset,l.camera.fovY,l.camera.fullViewport[3]),n.setUniform4f("verticalOffset",f.screenLength*(l.camera.pixelRatio||1),f.perDistance,f.minWorldLength,f.maxWorldLength))};a.calculateVerticalOffsetFactors=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl":function(){define(["exports",
"../../shaderModules/interfaces"],function(a,b){a.bindMultipassTerrainTexture=function(c,g){g.multipassTerrainEnabled&&g.terrainLinearDepthTexture&&c.bindTexture(g.terrainLinearDepthTexture,"terrainDepthTexture")};a.multipassTerrainTest=function(c,g){c.fragment.uniforms.add("terrainDepthTexture","sampler2D");c.fragment.uniforms.add("nearFar","vec2");c.fragment.uniforms.add("inverseViewport","vec2");c.fragment.code.add(b.glsl`
    // Compare the linearized depths of fragment and terrain. Discard fragments on the wrong side of the terrain.
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){

      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${g.cullAboveGround?"\x3e":"\x3c\x3d"} terrainDepth){
        discard;
      }
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/OrderIndependentTransparency":function(){define(["exports","./basicInterfaces","../../../webgl/enums","../../../webgl/renderState"],function(a,b,c,g){const h=g.separateBlendingParams(c.BlendFactor.SRC_ALPHA,c.BlendFactor.ONE,c.BlendFactor.ONE_MINUS_SRC_ALPHA,c.BlendFactor.ONE_MINUS_SRC_ALPHA),w=g.simpleBlendingParams(c.BlendFactor.ONE,c.BlendFactor.ONE),n=g.simpleBlendingParams(c.BlendFactor.ZERO,c.BlendFactor.ONE_MINUS_SRC_ALPHA),
f={factor:-1,units:-2};a.OITPolygonOffset=f;a.OITPolygonOffsetLimit=5E5;a.blendingAlpha=n;a.blendingColor=w;a.blendingDefault=h;a.getOITPolygonOffset=function(l){return l?f:null};a.oitBlending=function(l){return l===b.TransparencyPassType.FrontFace?null:l===b.TransparencyPassType.Alpha?n:w};a.oitDepthTest=function(l,k=c.CompareFunction.LESS){return l===b.TransparencyPassType.NONE||l===b.TransparencyPassType.FrontFace?k:c.CompareFunction.LEQUAL};a.oitDepthWrite=function(l){return l===b.TransparencyPassType.FrontFace?
g.defaultDepthWriteParams:null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/LabelDeconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./Deconflictor ./enums ../../../support/Scheduler".split(" "),function(a,
b,c,g,h,w,n,f,l,k,e){a.LabelDeconflictor=function(d){function m(){var v=d.apply(this,arguments)||this;v.visibilityGroup=k.VisibilityGroup.LABEL;v.iconMarginFactor=0;v._lastDeconfliction=0;return v}b._inheritsLoose(m,d);var z=m.prototype;z.runTask=function(v){if(!this.parent.running){var q=performance.now();if(v.state===e.State.IDLE||2E3<q-this._lastDeconfliction)d.prototype.runTask.call(this,v),this.state===l.State.Idle&&(this._lastDeconfliction=q)}};z.enabledChanged=function(v,q){this.modifyGraphics(q,
v.labelsEnabled)};z.getGraphicsLayers=function(v){return v.labelGraphics};b._createClass(m,[{key:"viewState",get:function(){return this.parent.viewState}}]);return m}(l.Deconflictor);c.__decorate([g.property({constructOnly:!0})],a.LabelDeconflictor.prototype,"parent",void 0);a.LabelDeconflictor=c.__decorate([f.subclass("esri.views.3d.layers.graphics.LabelDeconflictor")],a.LabelDeconflictor);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Labeler":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Handles ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../layers/graphics/hydratedFeatures ../../../../layers/support/labelFormatUtils ../../../../layers/support/layerUtils ../../../../symbols/callouts/calloutUtils ./enums ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DGraphicCreationContext ./graphicSymbolUtils ./labelPlacement ./placementUtils ../../support/debugFlags ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextRenderer ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureAtlas ../../webgl-engine/lib/WebGLLayer ../../../support/Scheduler".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H,M){const K=n.getLogger("esri.views.3d.layers.graphics.Labeler");a.Labeler=function(O){function Q(){var P=O.apply(this,arguments)||this;P._dirty=!1;P._labels=new Map;P._labelsToAdd=new Map;P._labelsToRemove=new Map;P._labelingContexts=[];return P}b._inheritsLoose(Q,O);var J=Q.prototype;J.setup=function(){this.dispose();this._handles=new w;this._handles.add([this.view.watch("state.camera",()=>this.setDirty()),this.view.watch("pixelRatio",
()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(M.TaskPriority.LABELER,this)]);this._textTextureAtlas=new L.default({view:this.view});this._hudMaterialCollection=new C.MaterialCollection(this.view._stage);this._calloutMaterialCollection=new C.MaterialCollection(this.view._stage)};J.dispose=function(){this._handles=l.destroyMaybe(this._handles);this._textTextureAtlas=l.disposeMaybe(this._textTextureAtlas);this._hudMaterialCollection=l.disposeMaybe(this._hudMaterialCollection);
this._calloutMaterialCollection=l.disposeMaybe(this._calloutMaterialCollection);this._labelingContexts.length=0;this._labels.clear();this._labelsToAdd.clear();this._labelsToRemove.clear()};J._activateLabelingContext=function(P){P.labels.forEach((N,R)=>{this._labels.set(R,N);N.graphics3DGraphic.setVisibilityFlag(u.VisibilityFlag.USER_SETTING,!0,u.VisibilityGroup.LABEL)});P.active=!0};J._deactivateLabelingContext=function(P){P.labels.forEach((N,R)=>{N.graphics3DGraphic.setVisibilityFlag(u.VisibilityFlag.USER_SETTING,
!1,u.VisibilityGroup.LABEL);this.setLabelGraphicVisibility(N.graphics3DGraphic,!1);this._labels.delete(R)});P.active=!1};J._addLabelTextureToAtlas=function(P){for(const N of P.graphics3DGraphic.labelGraphics){if(!N._labelClass)continue;const R=P.textTextureResources.textRenderers[N._labelIndex];l.isSome(R)&&this._textTextureAtlas.addTextTexture(R,N.stageObject)}P.rendered=!0};J._removeLabelTextureFromAtlas=function(P){for(const N of P.graphics3DGraphic.labelGraphics){if(!N._labelClass)continue;const R=
P.textTextureResources.textRenderers[N._labelIndex];l.isSome(R)&&this._textTextureAtlas.removeTextTexture(R,N.stageObject)}P.rendered=!1};J.runTask=function(P){this._updateLabels(P);!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(P)};J._updateLabels=function(P){if(this._dirty){this._dirty=!1;for(const N of this._labelingContexts)if(N.active&&r.areLabelsVisible(N.layer)){if(!N.labelClassContexts||!N.labelClassContexts.length){if(null===N.labelClassContexts){this._deactivateLabelingContext(N);
continue}this._createLabelClassContext(N);if(N.labelClassPromise&&N.labelClassAbortController){this._dirty=!0;continue}if(!N.labelClassContexts||!N.labelClassContexts.length)continue}f.someMap(N.labelsToInitialize,(R,S)=>{this._ensureGraphics3DResources(R)&&(this._labels.set(S,R),this.deconflictor.setDirty(),P.madeProgress());if(R.visible&&R.textTextureResources.initialized||!R.visible&&R.hasGraphics3DResources)N.labelsToInitialize.delete(S),P.madeProgress();return P.done})&&(this._dirty=!0)}this._labelsToRemove.forEach(N=>
this._removeLabelTextureFromAtlas(N));this._labelsToAdd.forEach(N=>this._addLabelTextureToAtlas(N));this._labelsToRemove.clear();this._labelsToAdd.clear();this._dirty||this.notifyChange("updating")}};J._createLabelClassContextAsync=function(){var P=b._asyncToGenerator(function*(N){var R=this;const S=N.labelClassAbortController.signal;yield N.layer.when();k.throwIfAborted(S);N.scaleVisibility&&N.scaleVisibility.updateScaleRangeActive();const T=N.graphics3DCore;var V=T.layer;if((V=V.labelingInfo&&V.labelingInfo.filter(aa=>
!!aa.symbol))&&0!==V.length){var W=Array(V.length),U=!1;yield h.forEach(V,function(){var aa=b._asyncToGenerator(function*(da,Y){var ea=da.symbol;const ja=A.getGraphics3DSymbol(T.getOrCreateGraphics3DSymbol(ea));if(l.isNone(ja))K.error("Failed to create Graphics3DSymbol for label");else{yield ja.load();k.throwIfAborted(S);var la=null;x.hasCalloutSupport(ea)&&ea.hasVisibleCallout()&&(la=E.make(ea,T.symbolCreationContext),yield la.load(),k.throwIfAborted(S));ea=yield h.result(t.createLabelFunction(da,
N.layer.fieldsIndex,R.view.spatialReference));k.throwIfAborted(S);if(!0===ea.ok){const ia=yield R._createTextRenderParameters(ja.symbol);k.throwIfAborted(S);W[Y]={labelClass:da,labelFunction:ea.value,graphics3DSymbol:ja,graphics3DCalloutSymbolLayer:la,calloutSymbolLayerIndex:0,textRenderParameters:ia}}else K.error(`Label expression failed to evaluate: ${ea.error}`),U=!0}});return function(da,Y){return aa.apply(this,arguments)}}());k.throwIfAborted(S);U||(N.labelClassContexts=W)}});return function(N){return P.apply(this,
arguments)}}();J._createLabelClassContext=function(){var P=b._asyncToGenerator(function*(N){N.labelClassPromise||(N.labelClassPromise=this._createLabelClassContextAsync(N).catch(R=>{if(k.isAbortError(R))throw R;N.labelClassContexts=null}).then(()=>{N.labelClassAbortController=null;this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating"));return N.labelClassPromise});return function(N){return P.apply(this,arguments)}}();J._createTextRenderParameters=function(){var P=b._asyncToGenerator(function*(N){return(N=
N.symbolLayers.getItemAt(0))&&"text"===N.type?G.TextRenderParameters.fromSymbol(N,this.view.pixelRatio):null});return function(N){return P.apply(this,arguments)}}();J._destroyLabelClassContext=function(P){for(var N of P.labelClassContexts)--N.graphics3DSymbol.referenced,N.graphics3DSymbol=null;N=P.labelClassAbortController;P.labelClassAbortController=new AbortController;N&&N.abort();P.labelClassContexts=[];P.labelClassPromise=null;this.notifyChange("updating")};J._createTextSymbolGraphic=function(P,
N,R,S,T){P={text:P.text,centerOffset:R.centerOffset,translation:R.translation,elevationOffset:R.elevationOffset,screenOffset:R.screenOffset,centerOffsetUnits:R.centerOffsetUnits,horizontalPlacement:B.horizontalPlacementFromAnchor(R.anchor),verticalPlacement:B.verticalPlacementFromAnchor(R.anchor),verticalOffset:R.verticalOffset,debugDrawLabelBorder:D.LABELS_SHOW_BORDER,displayWidth:P.displayWidth,displayHeight:P.displayHeight};I.graphic=N;I.renderingInfo=null;I.layer=S;return T.createLabel(I,P,this._hudMaterialCollection,
this._textTextureAtlas)};J._createLineCalloutGraphic=function(P,N,R,S,T){N={symbol:N,translation:S.translation,elevationOffset:S.elevationOffset,screenOffset:S.screenOffset,centerOffset:S.centerOffset,centerOffsetUnits:S.centerOffsetUnits,materialCollection:this._calloutMaterialCollection};I.graphic=P;I.renderingInfo=N;I.layer=T;return R.createGraphics3DGraphic(I)};J._ensureGraphics3DResources=function(P){if(P.hasGraphics3DResources)return!1;const N=P.graphics3DGraphic;if(N.destroyed)return!1;this._ensureTextTextureResources(P);
const {textTextureResources:R}=P,S=P.labelingContext,T=S.labelClassContexts;if(!T||0===T.length||!S.emptySymbolLabelSupported&&0===N.graphics.length)return!1;var V=!1,W=N.graphic;const U=S.layer;var aa=r.areLabelsVisible(S.layer);const da=this.view._stage;for(let ea=0;ea<T.length;ea++){const ja=R.textRenderers[ea],la=R.labelPlacements[ea];if(l.isNone(ja)||l.isNone(la))continue;const ia=T[ea];var Y=ia.graphics3DSymbol;const ca=Y.symbol&&"label-3d"===Y.symbol.type?Y.symbol:null;if(Y=Y.symbolLayers[0]){Y.setElevationInfoOverride(S.elevationInfoOverride);
V=this._createTextSymbolGraphic(ja,W,la,U,Y);if(!V)return!1;V._labelClass=ia.labelClass;V._labelIndex=ea;N.addLabelGraphic(V,da,S.stageLayer);N.setVisibilityFlag(u.VisibilityFlag.USER_SETTING,aa,u.VisibilityGroup.LABEL);N.clearVisibilityFlag(u.VisibilityFlag.SCALE_RANGE,u.VisibilityGroup.LABEL);N.setVisibilityFlag(u.VisibilityFlag.DECONFLICTION,!1,u.VisibilityGroup.LABEL);V=!0;(aa=ia.graphics3DCalloutSymbolLayer)&&la.hasLabelVerticalOffset&&(aa.setElevationInfoOverride(S.elevationInfoOverride),W=
this._createLineCalloutGraphic(W,ca,aa,la,U),l.isSome(W)&&(ia.calloutSymbolLayerIndex=N.labelGraphics.length,N.addLabelGraphic(W,da,S.stageLayer)));break}}S.scaleVisibility&&V&&S.scaleVisibility.updateGraphicLabelScaleVisibility(N);return P.hasGraphics3DResources=!0};J._destroyGraphics3DResources=function(P){const N=P.labelingContext.labelClassContexts;for(const R of P.graphics3DGraphic.labelGraphics){if(null==R._labelClass)continue;const S=N[R._labelIndex].graphics3DSymbol.symbolLayers[0];if(null!=
S)S.onRemoveGraphic(R)}P.graphics3DGraphic.clearLabelGraphics();P.hasGraphics3DResources=!1};J._ensureTextTextureResources=function(P){const {textTextureResources:N}=P;if(!N.initialized){var R=P.labelingContext,S=R.labelClassContexts;if(S&&0!==S.length){var T=P.graphics3DGraphic.graphic;for(let U=0;U<S.length;U++){const aa=S[U];N.textRenderers[U]=null;N.labelPlacements[U]=null;if(!aa.textRenderParameters)continue;var V=aa.labelFunction;let da;if("arcade"===V.type)try{const Y=V.needsHydrationToEvaluate()?
q.hydrateGraphic(T,R.layer):T;da=V.evaluate(Y)}catch(Y){da=null}else da=V.evaluate(T);if(!l.isNone(da)&&""!==da&&!/^\s+$/.test(da)&&(V=aa.graphics3DSymbol,V.symbolLayers[0]&&(V=p.get({graphics3DGraphic:P.graphics3DGraphic,labelSymbol:V.symbol&&"label-3d"===V.symbol.type?V.symbol:null,labelClass:aa.labelClass,disablePlacement:R.disablePlacement}),!l.isNone(V)))){var W=B.horizontalPlacementFromAnchor(V.anchor);W=B.textRenderAlignmentFromHorizontalPlacement(W);N.textRenderers[U]=new F.TextRenderer(da,
W,aa.textRenderParameters);N.labelPlacements[U]=V}}N.initialized=!0}}};J._destroyTextTextureResources=function(P){({textTextureResources:P}=P);P.initialized=!1;P.textRenderers=[];P.labelPlacements=[]};J._addGraphic=function(P,N){const R={hasGraphics3DResources:!1,visible:!1,rendered:!1,labelingContext:P,graphics3DGraphic:N,textTextureResources:{initialized:!1,textRenderers:[],labelPlacements:[]}};N=N.graphic.uid;P.labels.set(N,R);P.labelsToInitialize.set(N,R);this.setDirty();this.deconflictor.setDirty()};
J._removeGraphic=function(P,N){N=N.graphic.uid;const R=P.labels.get(N);R&&(this._destroyGraphic(R,N),P.labels.delete(N),P.labelsToInitialize.delete(N),this.setDirty(),this.deconflictor.setDirty())};J._destroyGraphic=function(P,N){this._labels.has(N)&&(this._labels.delete(N),this._labelsToAdd.delete(N),this._labelsToRemove.delete(N));P.textTextureResources.initialized&&(this._removeLabelTextureFromAtlas(P),this._destroyTextTextureResources(P));P.hasGraphics3DResources&&this._destroyGraphics3DResources(P)};
J._labelingInfoChange=function(){var P=b._asyncToGenerator(function*(N,R){if(R)for(const S of R){if(R=N.labels.get(S))this._removeGraphic(N,R.graphics3DGraphic),this._addGraphic(N,R.graphics3DGraphic)}else return this._visibilityInfoChange(N),this._resetLabels(N),this._createLabelClassContext(N)});return function(N,R){return P.apply(this,arguments)}}();J._globalPropertyChanged=function(P,N){for(const R of N.labelClassContexts){const S=new Map;N.labels.forEach(T=>{T=T.graphics3DGraphic;S.set(T.graphic.uid,
T)});l.unwrap(R.graphics3DSymbol.symbolLayers[0]).globalPropertyChanged(P,S,T=>T.labelGraphics[0]);R.graphics3DCalloutSymbolLayer&&R.graphics3DCalloutSymbolLayer.globalPropertyChanged(P,S,T=>T.labelGraphics[R.calloutSymbolLayerIndex])}};J._visibilityInfoChange=function(P){const N=P.layer.labelsVisible;N&&!P.active&&this._activateLabelingContext(P);!N&&P.active&&this._deactivateLabelingContext(P);this.setDirty()};J._resetAllLabels=function(){for(const P of this._labelingContexts)this._resetLabels(P)};
J._resetLabels=function(P){P.labels.forEach((N,R)=>{this._destroyGraphic(N,R);N.visible=!1;N.rendered=!1;P.labelsToInitialize.set(R,N)});this._destroyLabelClassContext(P);this.setDirty();this.deconflictor.setDirty()};J._findLabelingContext=function(P){for(const N of this._labelingContexts)if(N.graphics3DCore===P)return N;return null};J.addGraphicsOwner=function(P,N,R){const S=R&&R.emptySymbolLabelSupported||!1,T=R&&R.elevationInfoOverride||null;R=R&&R.disablePlacement||null;if(!this._findLabelingContext(P)){var V=
P.layer,W={graphics3DCore:P,layer:V,scaleVisibility:N,emptySymbolLabelSupported:S,elevationInfoOverride:T,disablePlacement:R,active:V.labelsVisible,labelClassPromise:null,labelClassAbortController:new AbortController,labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new H.WebGLLayer({isPickable:!0},V.uid)};this.view._stage.add(W.stageLayer);this._labelingContexts.push(W);this.setDirty();return{addGraphic:U=>this._addGraphic(W,U),removeGraphic:U=>this._removeGraphic(W,U),featureReductionChange:()=>
{},layerLabelsEnabled:()=>r.areLabelsVisible(W.layer),labelingInfoChange:U=>this._labelingInfoChange(W,U),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",W),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",W),visibilityInfoChange:()=>this._visibilityInfoChange(W),reset:()=>this._resetLabels(W),clear:()=>{}}}};J.removeGraphicsOwner=function(P){const N=this._findLabelingContext(P);N&&(P=this._labelingContexts.indexOf(N),this._labelingContexts.splice(P,
1),N.labels.forEach(R=>this._removeGraphic(N,R.graphics3DGraphic)),this.view._stage.remove(N.stageLayer),N.stageLayer=null,this.setDirty())};J.setLabelGraphicVisibility=function(P,N){P=P.graphic.uid;const R=this._labels.get(P);R&&R.visible!==N&&(N&&!R.rendered?(this._labelsToAdd.set(P,R),this._labelsToRemove.delete(P),R.textTextureResources.initialized||R.labelingContext.labelsToInitialize.set(P,R)):!N&&R.rendered&&(this._labelsToRemove.set(P,R),this._labelsToAdd.delete(P)),R.visible=N,this.setDirty())};
J.setDirty=function(){!this._dirty&&0<this._labelingContexts.length&&(this._dirty=!0,this.notifyChange("updating"))};b._createClass(Q,[{key:"running",get:function(){var P;return this.view.ready&&(this._dirty||(null==(P=this._textTextureAtlas)?void 0:P.updating)||this.deconflictor.running)}},{key:"updating",get:function(){var P;return this._dirty||(null==(P=this._textTextureAtlas)?void 0:P.updating)||this.deconflictor.updating||this._labelingContexts.some(N=>N.labelClassPromise&&!!N.labelClassAbortController)}},
{key:"updatingProgress",get:function(){if(!this.updating||!this._textTextureAtlas)return 1;const P=0<this._labelingContexts.length?this._labelingContexts.reduce((N,R)=>N+(R.labelClassPromise&&R.labelClassAbortController?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*P+.5*this.deconflictor.updatingProgress}},{key:"test",get:function(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}}]);return Q}(g);
c.__decorate([e.property({constructOnly:!0})],a.Labeler.prototype,"view",void 0);c.__decorate([e.property({constructOnly:!0})],a.Labeler.prototype,"deconflictor",void 0);c.__decorate([e.property()],a.Labeler.prototype,"_textTextureAtlas",void 0);c.__decorate([e.property({type:Boolean,readOnly:!0})],a.Labeler.prototype,"updating",null);a.Labeler=c.__decorate([v.subclass("esri.views.3d.layers.graphics.Labeler")],a.Labeler);const I=new y(null,null,null);Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/layers/graphics/hydratedFeatures":function(){define("exports ../../Graphic ../../core/has ../../core/lang ../../core/maybe ../../core/typedArrayUtil ../../geometry/support/jsonUtils ./dehydratedFeatures".split(" "),function(a,b,c,g,h,w,n,f){function l(r){return"declaredClass"in r}function k(r){return"declaredClass"in r}function e(r){return"declaredClass"in r}function d(r){return h.isNone(r)?null:l(r)?r:n.fromJSON(m(r))}function m(r){const x=r.spatialReference.toJSON();switch(r.type){case "point":{const {x:u,
y:E,z:y,m:A}=r;return{x:u,y:E,z:y,m:A,spatialReference:x}}case "polygon":{const {rings:u,hasZ:E,hasM:y}=r;return{rings:z(u),hasZ:E,hasM:y,spatialReference:x}}case "polyline":{const {paths:u,hasZ:E,hasM:y}=r;return{paths:z(u),hasZ:E,hasM:y,spatialReference:x}}case "extent":{const {xmin:u,xmax:E,ymin:y,ymax:A,zmin:p,zmax:B,mmin:D,mmax:C,hasZ:F,hasM:G}=r;return{xmin:u,xmax:E,ymin:y,ymax:A,zmin:p,zmax:B,mmin:D,mmax:C,hasZ:F,hasM:G,spatialReference:x}}case "multipoint":{const {points:u,hasZ:E,hasM:y}=
r;return{points:t(u)?v(u):u,hasZ:E,hasM:y,spatialReference:x}}}}function z(r){return q(r)?r.map(x=>v(x)):r}function v(r){return r.map(x=>w.toArray(x))}function q(r){for(const x of r)if(0!==x.length)return t(x);return!1}function t(r){return r.length&&(w.isFloat32Array(r[0])||w.isFloat64Array(r[0]))}a.clonePoint=function(r,x){if(!r)return null;if(k(r)){if(null==x)return r.clone();if(k(x))return x.copy(r)}null!=x?(x.x=r.x,x.y=r.y,x.spatialReference=r.spatialReference,r.hasZ?(x.z=r.z,x.hasZ=r.hasZ):(x.z=
null,x.hasZ=!1),r.hasM?(x.m=r.m,x.hasM=!0):(x.m=null,x.hasM=!1)):(x=f.makeDehydratedPoint(r.x,r.y,r.z,r.spatialReference),r.hasM&&(x.m=r.m,x.hasM=!0));return x};a.hydrateGeometry=d;a.hydrateGraphic=function(r,x){if(!r)return null;if(e(r))return r;x=new b({layer:x,sourceLayer:x});x.visible=r.visible;x.symbol=g.clone(r.symbol);x.attributes=g.clone(r.attributes);x.geometry=d(r.geometry);return x};a.isHydratedGeometry=l;a.isHydratedGraphic=e;a.isHydratedPoint=k;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/layers/graphics/dehydratedFeatures":function(){define("exports ../../core/byteSizeEstimations ../../core/has ../../core/maybe ../../core/typedArrayUtil ../../core/uid ../../geometry/SpatialReference ../../geometry/support/aaBoundingBox ../../geometry/support/aaBoundingRect ../../geometry/support/quantizationUtils ../../geometry/support/typeUtils ../support/Field ./dehydratedFeatureComparison".split(" "),function(a,b,c,g,h,w,n,f,l,k,e,d,m){function z(u,E,y){if(g.isNone(u))return null;switch(E){case "point":return{x:u.x,
y:u.y,z:u.z,m:u.m,hasZ:null!=u.z,hasM:null!=u.m,type:"point",spatialReference:y};case "polyline":return{paths:u.paths,hasZ:!!u.hasZ,hasM:!!u.hasM,type:"polyline",spatialReference:y};case "polygon":return{rings:u.rings,hasZ:!!u.hasZ,hasM:!!u.hasM,type:"polygon",spatialReference:y};case "multipoint":return{points:u.points,hasZ:!!u.hasZ,hasM:!!u.hasM,type:"multipoint",spatialReference:y}}}function v(u){if(g.isNone(u))return 0;let E=32;switch(u.type){case "point":E+=42;break;case "polyline":case "polygon":{var y=
0;const A=2+(u.hasZ?1:0)+(u.hasM?1:0);u="polyline"===u.type?u.paths:u.rings;for(const p of u)y+=p.length;E+=8*y*A+64;E+=128*y;E=E+34+32*(u.length+1);break}case "multipoint":y=u.points.length;E+=8*y*(2+(u.hasZ?1:0)+(u.hasM?1:0))+64;E+=128*y;E=E+34+32;break;case "extent":E+=98;u.hasM&&(E+=32);u.hasZ&&(E+=32);break;case "mesh":E+=h.estimateSize(u.vertexAttributes.position),E+=h.estimateSize(u.vertexAttributes.normal),E+=h.estimateSize(u.vertexAttributes.uv),E+=h.estimateSize(u.vertexAttributes.tangent)}return E}
function q(u,E){f.empty(E);"mesh"===u.type&&(u=u.extent);switch(u.type){case "point":E[0]=E[3]=u.x;E[1]=E[4]=u.y;u.hasZ&&(E[2]=E[5]=u.z);break;case "polyline":for(var y=0;y<u.paths.length;y++)f.expandWithNestedArray(E,u.paths[y],u.hasZ);break;case "polygon":for(y=0;y<u.rings.length;y++)f.expandWithNestedArray(E,u.rings[y],u.hasZ);break;case "multipoint":f.expandWithNestedArray(E,u.points,u.hasZ);break;case "extent":E[0]=u.xmin,E[1]=u.ymin,E[3]=u.xmax,E[4]=u.ymax,null!=u.zmin&&(E[2]=u.zmin),null!=
u.zmax&&(E[5]=u.zmax)}}function t(u,E){l.empty(E);"mesh"===u.type&&(u=u.extent);switch(u.type){case "point":E[0]=E[2]=u.x;E[1]=E[3]=u.y;break;case "polyline":for(var y=0;y<u.paths.length;y++)l.expandWithNestedArray(E,u.paths[y]);break;case "polygon":for(y=0;y<u.rings.length;y++)l.expandWithNestedArray(E,u.rings[y]);break;case "multipoint":l.expandWithNestedArray(E,u.points);break;case "extent":E[0]=u.xmin,E[1]=u.ymin,E[2]=u.xmax,E[3]=u.ymax}}const r=f.create(),x=l.create();a.equals=m.equals;a.DehydratedFeatureClass=
function(u,E,y){this.uid=u;this.geometry=E;this.attributes=y;this.visible=!0;this.centroid=this.objectId=null};a.DehydratedFeatureSetClass=function(){this.exceededTransferLimit=!1;this.features=[];this.fields=[];this.hasZ=this.hasM=!1;this.transform=this.spatialReference=this.geohashFieldName=this.geometryProperties=this.globalIdFieldName=this.objectIdFieldName=this.geometryType=null};a.computeAABB=q;a.computeAABR=t;a.estimateGeometryObjectSize=v;a.estimateSize=function(u){let E;E=32+b.estimateAttributesObjectSize(u.attributes);
return E=E+3+(8+v(u.geometry))};a.expandAABB=function(u,E){q(u,r);f.expandWithAABB(E,r)};a.expandAABR=function(u,E){g.isSome(u)&&(t(u,x),l.expand(E,x,E))};a.fromFeatureSetJSON=function(u){const E=e.featureGeometryTypeKebabDictionary.fromJSON(u.geometryType),y=n.fromJSON(u.spatialReference),A=u.transform,p=u.features.map(B=>{var D=u.objectIdFieldName;B={uid:w.generateUID(),objectId:D&&B.attributes?B.attributes[D]:null,attributes:B.attributes,geometry:z(B.geometry,E,y),visible:!0};D=B.geometry;if(g.isSome(D)&&
A)switch(D.type){case "point":B.geometry=k.unquantizePoint(A,D,D,D.hasZ,D.hasM);break;case "multipoint":B.geometry=k.unquantizeMultipoint(A,D,D,D.hasZ,D.hasM);break;case "polygon":B.geometry=k.unquantizePolygon(A,D,D,D.hasZ,D.hasM);break;case "polyline":B.geometry=k.unquantizePolyline(A,D,D,D.hasZ,D.hasM);break;case "extent":B.geometry=D;break;case "mesh":B.geometry=D}return B});return{geometryType:E,features:p,spatialReference:y,fields:u.fields?u.fields.map(B=>d.fromJSON(B)):null,objectIdFieldName:u.objectIdFieldName,
globalIdFieldName:u.globalIdFieldName,geohashFieldName:u.geohashFieldName,geometryProperties:u.geometryProperties,hasZ:u.hasZ,hasM:u.hasM,exceededTransferLimit:u.exceededTransferLimit,transform:null}};a.fromJSONGeometry=z;a.getObjectId=function(u,E){return null!=u.objectId?u.objectId:u.attributes&&E?u.attributes[E]:null};a.hasGeometry=function(u){return g.isSome(u.geometry)};a.hasVertices=function(u){if(g.isNone(u))return!1;switch(u.type){case "extent":case "point":return!0;case "polyline":for(const E of u.paths)if(0<
E.length)return!0;return!1;case "polygon":for(const E of u.rings)if(0<E.length)return!0;return!1;case "multipoint":return 0<u.points.length;case "mesh":return!u.loaded||0<u.vertexAttributes.position.length}};a.isFeatureGeometry=function(u){return e.isFeatureGeometryType(u.type)};a.makeDehydratedPoint=function(u,E,y,A){return{x:u,y:E,z:y,hasZ:null!=y,hasM:!1,spatialReference:A,type:"point"}};a.numVertices=function(u){if(g.isNone(u))return 0;switch(u.type){case "point":return 1;case "polyline":var E=
0;for(var y of u.paths)E+=y.length;return E;case "polygon":y=0;for(E of u.rings)y+=E.length;return y;case "multipoint":return u.points.length;case "extent":return 2;case "mesh":return(u=u.vertexAttributes&&u.vertexAttributes.position)?u.length/3:0}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/quantizationUtils":function(){define(["exports","../../core/maybe","./jsonUtils"],function(a,b,c){function g({scale:C,translate:F},G){return Math.round((G-F[0])/C[0])}function h({scale:C,
translate:F},G){return Math.round((F[1]-G)/C[1])}function w(C,F,G){const L=[];let H,M,K,I;for(let O=0;O<G.length;O++){const Q=G[O];if(0<O){if(K=g(C,Q[0]),I=h(C,Q[1]),K!==H||I!==M)L.push(F(Q,K-H,I-M)),H=K,M=I}else H=g(C,Q[0]),M=h(C,Q[1]),L.push(F(Q,H,M))}return 0<L.length?L:null}function n(C,F,G,L){return w(C,G?L?D:B:L?B:p,F)}function f(C,F,G,L){const H=[];G=G?L?D:B:L?B:p;for(L=0;L<F.length;L++){const M=w(C,G,F[L]);M&&3<=M.length&&H.push(M)}return H.length?H:null}function l(C,F,G,L){const H=[];G=G?
L?D:B:L?B:p;for(L=0;L<F.length;L++){const M=w(C,G,F[L]);M&&2<=M.length&&H.push(M)}return H.length?H:null}function k({scale:C,translate:F},G){return G*C[0]+F[0]}function e({scale:C,translate:F},G){return F[1]-G*C[1]}function d(C,F,G){const L=Array(G.length);if(!G.length)return L;const [H,M]=C.scale;let K=k(C,G[0][0]);C=e(C,G[0][1]);L[0]=F(G[0],K,C);for(let I=1;I<G.length;I++){const O=G[I];K+=O[0]*H;C-=O[1]*M;L[I]=F(O,K,C)}return L}function m(C,F,G){const L=Array(G.length);for(let H=0;H<G.length;H++)L[H]=
d(C,F,G[H]);return L}function z(C,F,G,L){return d(C,G?L?D:B:L?B:p,F)}function v(C,F,G,L){return m(C,G?L?D:B:L?B:p,F)}function q(C,F,G,L){return m(C,G?L?D:B:L?B:p,F)}function t(C,F,G){let [L,H]=G[0],M=Math.min(L,F[0]),K=Math.min(H,F[1]),I=Math.max(L,F[2]);F=Math.max(H,F[3]);for(let O=1;O<G.length;O++){const [Q,J]=G[O];L+=Q;H+=J;0>Q&&(M=Math.min(M,L));0<Q&&(I=Math.max(I,L));0>J?K=Math.min(K,H):0<J&&(F=Math.max(F,H))}C[0]=M;C[1]=K;C[2]=I;C[3]=F;return C}function r(C,F){if(!F.length)return null;C[0]=
C[1]=Number.POSITIVE_INFINITY;C[2]=C[3]=Number.NEGATIVE_INFINITY;for(let G=0;G<F.length;G++)t(C,C,F[G]);return C}function x(C,F,G,L,H){F.xmin=g(C,G.xmin);F.ymin=h(C,G.ymin);F.xmax=g(C,G.xmax);F.ymax=h(C,G.ymax);F!==G&&(L&&(F.zmin=G.zmin,F.zmax=G.zmax),H&&(F.mmin=G.mmin,F.mmax=G.mmax));return F}function u(C,F,G,L,H){F.points=n(C,G.points,L,H);return F}function E(C,F,G,L,H){F.x=g(C,G.x);F.y=h(C,G.y);F!==G&&(L&&(F.z=G.z),H&&(F.m=G.m));return F}function y(C,F,G,L,H){C=f(C,G.rings,L,H);if(!C)return null;
F.rings=C;return F}function A(C,F,G,L,H){C=l(C,G.paths,L,H);if(!C)return null;F.paths=C;return F}const p=(C,F,G)=>[F,G],B=(C,F,G)=>[F,G,C[2]],D=(C,F,G)=>[F,G,C[2],C[3]];a.equals=function(C,F){if(C===F||null==C&&null==F)return!0;if(null==C||null==F)return!1;let G,L,H,M;C&&"upperLeft"===C.originPosition?(G=C.translate[0],L=C.translate[1],C=C.scale[0]):(G=b.isSome(C.extent)?C.extent.xmin:0,L=b.isSome(C.extent)?C.extent.ymax:0,C=C.tolerance);F&&"upperLeft"===F.originPosition?(H=F.translate[0],M=F.translate[1],
F=F.scale[0]):(H=b.isSome(F.extent)?F.extent.xmin:0,M=b.isSome(F.extent)?F.extent.ymax:0,F=F.tolerance);return G===H&&L===M&&C===F};a.getQuantizedBoundsCoordsArray=t;a.getQuantizedBoundsCoordsArrayArray=r;a.getQuantizedBoundsPaths=function(C){return r([0,0,0,0],C)};a.getQuantizedBoundsPoints=function(C){const F=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return t(F,F,C)};a.getQuantizedBoundsRings=function(C){return r([0,0,0,0],C)};a.quantizeBounds=
function(C,F,G){F[0]=g(C,G[0]);F[3]=h(C,G[1]);F[2]=g(C,G[2]);F[1]=h(C,G[3]);return F};a.quantizeExtent=x;a.quantizeGeometry=function(C,F){return C&&F?c.isPoint(F)?E(C,{},F,!1,!1):c.isPolyline(F)?A(C,{},F,!1,!1):c.isPolygon(F)?y(C,{},F,!1,!1):c.isMultipoint(F)?u(C,{},F,!1,!1):c.isExtent(F)?x(C,{},F,!1,!1):null:null};a.quantizeMultipoint=u;a.quantizePaths=l;a.quantizePoint=E;a.quantizePoints=n;a.quantizePolygon=y;a.quantizePolyline=A;a.quantizeRings=f;a.quantizeX=g;a.quantizeY=h;a.toQuantizationTransform=
function(C){return C?{originPosition:"upper-left"===C.originPosition?"upperLeft":"lower-left"===C.originPosition?"lowerLeft":C.originPosition,scale:C.tolerance?[C.tolerance,C.tolerance]:[1,1],translate:b.isSome(C.extent)?[C.extent.xmin,C.extent.ymax]:[0,0]}:null};a.unquantizeBounds=function(C,F,G){return G?(F[0]=k(C,G[0]),F[1]=e(C,G[3]),F[2]=k(C,G[2]),F[3]=e(C,G[1]),F):[k(C,F[0]),e(C,F[3]),k(C,F[2]),e(C,F[1])]};a.unquantizeCoordsArray=d;a.unquantizeCoordsArrayArray=m;a.unquantizeExtent=function(C,
F,G,L,H){F.xmin=k(C,G.xmin);F.ymin=e(C,G.ymin);F.xmax=k(C,G.xmax);F.ymax=e(C,G.ymax);F!==G&&(L&&(F.zmin=G.zmin,F.zmax=G.zmax),H&&(F.mmin=G.mmin,F.mmax=G.mmax));return F};a.unquantizeMultipoint=function(C,F,G,L,H){b.isSome(G)&&(F.points=z(C,G.points,L,H));return F};a.unquantizePaths=v;a.unquantizePoint=function(C,F,G,L,H){if(b.isNone(G))return F;F.x=k(C,G.x);F.y=e(C,G.y);F!==G&&(L&&(F.z=G.z),H&&(F.m=G.m));return F};a.unquantizePoints=z;a.unquantizePolygon=function(C,F,G,L,H){b.isSome(G)&&(F.rings=
q(C,G.rings,L,H));return F};a.unquantizePolyline=function(C,F,G,L,H){b.isSome(G)&&(F.paths=v(C,G.paths,L,H));return F};a.unquantizeRings=q;a.unquantizeX=k;a.unquantizeY=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/dehydratedFeatureComparison":function(){define(["exports","../../core/has","../../core/maybe"],function(a,b,c){function g(k,e){if(k===e)return!0;if(null==k||null==e||k.length!==e.length)return!1;for(let d=0;d<k.length;d++){const m=k[d],z=e[d];if(m.length!==
z.length)return!1;for(let v=0;v<m.length;v++)if(m[v]!==z[v])return!1}return!0}function h(k,e){if(k===e)return!0;if(null==k||null==e||k.length!==e.length)return!1;for(let d=0;d<k.length;d++)if(!g(k[d],e[d]))return!1;return!0}function w(k,e){return n(k.spatialReference,e.spatialReference)?k.x===e.x&&k.y===e.y&&k.z===e.z&&k.m===e.m:!1}function n(k,e){return k===e||k&&e&&k.equals(e)}function f(k,e){if(k===e)return!0;if(c.isNone(k)||c.isNone(e)||k.type!==e.type)return!1;switch(k.type){case "point":return w(k,
e);case "extent":return k=k.hasZ!==e.hasZ||k.hasM!==e.hasM?!1:n(k.spatialReference,e.spatialReference)?k.xmin===e.xmin&&k.ymin===e.ymin&&k.zmin===e.zmin&&k.xmax===e.xmax&&k.ymax===e.ymax&&k.zmax===e.zmax:!1,k;case "polyline":return k=k.hasZ!==e.hasZ||k.hasM!==e.hasM?!1:n(k.spatialReference,e.spatialReference)?h(k.paths,e.paths):!1,k;case "polygon":return k=k.hasZ!==e.hasZ||k.hasM!==e.hasM?!1:n(k.spatialReference,e.spatialReference)?h(k.rings,e.rings):!1,k;case "multipoint":return k=k.hasZ!==e.hasZ||
k.hasM!==e.hasM?!1:n(k.spatialReference,e.spatialReference)?g(k.points,e.points):!1,k;case "mesh":return!1}}function l(k,e){if(k===e)return!0;if(!k||!e)return!1;const d=Object.keys(k),m=Object.keys(e);if(d.length!==m.length)return!1;for(const z of d)if(k[z]!==e[z])return!1;return!0}a.equals=function(k,e){return k===e?!0:null!=k&&null!=e&&k.objectId===e.objectId&&f(k.geometry,e.geometry)&&l(k.attributes,e.attributes)?!0:!1};a.pointEquals=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/labelFormatUtils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../core/Error ../../core/Logger ../../intl/date ../../intl/number ./fieldUtils ./labelUtils ../../support/arcadeOnDemand".split(" "),
function(a,b,c,g,h,w,n,f,l,k){function e(){e=c._asyncToGenerator(function*(q,t,r){if(!q||!q.symbol)return z;const x=q.where,u=l.getLabelExpression(q);q=x?yield new Promise((E,y)=>a(["../../core/sql/WhereClause"],E,y)):null;if("arcade"===u.type){const E=yield k.createLabelExpression(u.expression,r,t);r={type:"arcade",evaluate(y){try{const A=E.evaluate({$feature:"attributes"in y?E.repurposeFeature(y):y});if(null!=A)return A.toString()}catch(A){m.error(new g("bad-arcade-expression","Encountered an error when evaluating label expression for feature",
{feature:y,expression:u}))}return null},needsHydrationToEvaluate(){return null==l.getSingleFieldArcadeExpression(u.expression)}}}else r={type:"simple",evaluate(E){return u.expression.replace(/{[^}]*}/g,y=>{var A=y.slice(1,-1);A=t.get(A);if(!A)return y;y=null;"attributes"in E?E&&E.attributes&&(y=E.attributes[A.name]):y=E.field(A.name);return null==y?"":d(y,A)})}};if(x){let E;try{E=q.WhereClause.create(x,t)}catch(A){return z}const y=r.evaluate;r.evaluate=A=>E.testFeature(A,"attributes"in A?void 0:v)?
y(A):null}return r});return e.apply(this,arguments)}function d(q,t){if(null==q)return"";const r=t.domain;if(r)if("codedValue"===r.type||"coded-value"===r.type)for(var x of r.codedValues){if(x.code===q)return x.name}else if("range"===r.type){x=+q;const u="range"in r?r.range[1]:r.maxValue;if(("range"in r?r.range[0]:r.minValue)<=x&&x<=u)return r.name}"date"===t.type||"esriFieldTypeDate"===t.type?q=w.formatDate(q,w.convertDateFormatToIntlOptions("short-date")):f.isNumericField(t)&&(q=n.formatNumber(+q));
return q?q:""}const m=h.getLogger("esri.layers.support.labelFormatUtils"),z={type:"simple",evaluate(){return null}},v={getAttribute(q,t){return q.field(t)}};b.createLabelFunction=function(q,t,r){return e.apply(this,arguments)};b.formatField=d;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["exports","../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(a,
b,c,g){const h=b.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory"),w={line:g.Graphics3DLineCalloutSymbolLayer};a.make=function(n,f){if(!c.hasCalloutSupport(n))return h.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${n.type}' does not support callouts`),null;if(!n.callout)return null;const l=w[n.callout.type];return l?new l(n,f):(h.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${n.callout.type}`),null)};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ./symbolComplexity ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Material ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x){e=function(p){function B(C,F){C=p.call(this,C,null,F,A)||this;C._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};C.ensureDrapedStatus(!1);return C}b._inheritsLoose(B,p);var D=B.prototype;D.doLoad=function(){var C=b._asyncToGenerator(function*(){this._material=new x.LineCalloutMaterial(this.materialParameters);this._context.stage.add(this._material)});return function(){return C.apply(this,arguments)}}();D.destroy=function(){p.prototype.destroy.call(this);
this._context.stage.remove(this._material);this._material=null};D._perInstanceMaterialParameters=function(C){const F=this.materialParameters;F.screenOffset=C.screenOffset||[0,0];F.centerOffsetUnits=C.centerOffsetUnits||"world";return F};D._defaultElevationInfoNoZ=function(){return y};D.createGraphics3DGraphic=function(C){const F=C.renderingInfo;C=C.graphic;const G=this.setGraphicElevationContext(C,new l.ElevationContext,F.elevationOffset||0);var L=F.symbol;const H="on-the-ground"===this._elevationContext.mode&&
("cim"===L.type||!L.symbolLayers.some(M=>"object"===M.type||"text"===M.type));if("label-3d"!==L.type&&H||"point-3d"===L.type&&L.symbolLayers.every(M=>"text"===M.type&&!w.textSymbolLayerSupportsVerticalOffset(M)))return null;L=d.computeCentroid(C.geometry);return g.isNone(L)?null:this._createAs3DShape(L,G,F,C.uid)};D.layerOpacityChanged=function(){if(g.isNone(this._material))return!0;this._material.setParameters(this.materialParameters);return!0};D.layerElevationInfoChanged=function(C,F,G){G=f.elevationModeChangeUpdateType(B.elevationModeChangeTypes,
G,this._elevationContext.mode);if(G!==f.SymbolUpdateType.UPDATE)return G;C.forEach(L=>{const H=F(L);g.isSome(H)&&this.updateGraphicElevationContext(L.graphic,H)});return G};D.slicePlaneEnabledChanged=function(){if(g.isNone(this._material))return!0;this._material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};D.physicalBasedRenderingChanged=function(){return!0};D.pixelRatioChanged=function(){return!0};D.setGraphicElevationContext=function(C,F,G=0){C=p.prototype.setGraphicElevationContext.call(this,
C,F);C.addOffsetRenderUnits(G);return C};D.updateGraphicElevationContext=function(C,F){this.setGraphicElevationContext(C,F.elevationContext,F.metadata.elevationOffset);F.needsElevationUpdates=f.needsElevationUpdates2D(F.elevationContext.mode)};D.computeComplexity=function(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:z.emptySymbolComplexity.memory}};D._createVertexData=function(C){const {translation:F,centerOffset:G}=C;return[[r.VertexAttribute.POSITION,
F?{size:3,data:[F[0],F[1],F[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0}],[r.VertexAttribute.NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[r.VertexAttribute.AUXPOS1,G?{size:4,data:[G[0],G[1],G[2],G[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0}]]};D._getOrCreateMaterial=function(C){const F=this._perInstanceMaterialParameters(C),G=x.LineCalloutMaterial.uniqueMaterialIdentifier(F);if(g.isSome(this._material)&&G===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};
if(C.materialCollection){let L=C.materialCollection.get(G);g.isNone(L)&&(L=new x.LineCalloutMaterial(F),C.materialCollection.add(G,L));return{material:L,isUnique:!1}}return{material:new x.LineCalloutMaterial(F),isUnique:!0}};D._createAs3DShape=function(C,F,G,L){var H=[new q.Geometry(this._createVertexData(G),E,v.PrimitiveType.Point)];const M=this._getOrCreateMaterial(G);L=m.createStageObjectForHUD(this._context,C,H,[M.material],F,this._context.layer.uid,L);if(null===L)return null;H=new k.Graphics3DObject3DGraphicLayer(this,
L.object,H,M.isUnique?[M.material]:null,null,n.perObjectElevationAligner,F);H.metadata={elevationOffset:G.elevationOffset||0};H.alignedSampledElevation=L.sampledElevation;H.needsElevationUpdates=f.needsElevationUpdates2D(F.mode);m.extendPointGraphicElevationContext(H,C,this._context.elevationProvider);return H};b._createClass(B,[{key:"materialParameters",get:function(){const C=this.symbol;var F=C.callout;const G=g.isSome(F.color)?c.toUnitRGBA(F.color):[0,0,0,0];G[3]*=this._getLayerOpacity();const L=
h.pt2px(F.size||0);let H=null;if(C.verticalOffset){const {screenLength:K,minWorldLength:I,maxWorldLength:O}=C.verticalOffset;H={screenLength:h.pt2px(K),minWorldLength:I||0,maxWorldLength:null!=O?O:Infinity}}F=g.isSome(F.border)&&g.isSome(F.border.color)?c.toUnitRGBA(F.border.color):null;const M="object"===C.symbolLayers.getItemAt(0).type;return{color:G,size:L,verticalOffset:H,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:
null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:F,occlusionTest:!M,shaderPolygonOffset:M?0:void 0,depthHUDAlignStart:"label-3d"===C.type,slicePlaneEnabled:this._context.slicePlaneEnabled,renderOccluded:t.DefaultMaterialParameters.renderOccluded}}}]);return B}(e.Graphics3DSymbolLayer);e.elevationModeChangeTypes={definedChanged:f.SymbolUpdateType.UPDATE,staysOnTheGround:f.SymbolUpdateType.UPDATE,onTheGroundChanged:f.SymbolUpdateType.RECREATE};const u=new Uint16Array([0]),E=[[r.VertexAttribute.POSITION,
u],[r.VertexAttribute.NORMAL,u],[r.VertexAttribute.AUXPOS1,u]],y={mode:"relative-to-ground",offset:0},A={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};a.Graphics3DLineCalloutSymbolLayer=e;a.default=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ./elevationAlignmentUtils ./graphicUtils ../../support/debugFlags ../../support/ElevationProvider ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){function m(E,y,A,p){let B=!1;const D=A.spatialReference;var C=E.geometry,F=E.getShaderTransformation();E=y.requiresSampledElevationInfo;q[0]=F[12];q[1]=F[13];q[2]=F[14];C.invalidateBoundingInfo();var G=C.getMutableAttribute(d.VertexAttribute.POSITION);F=G.data;var L=C.vertexAttributes.get(d.VertexAttribute.MAPPOS).data;C=G.size;G=F.length/C;L=new e.SamplePosition(L,D);let H=0,M=0;for(let K=0;K<G;K++){t[0]=F[H];t[1]=F[H+1];t[2]=F[H+2];f.evaluateElevationInfoAtPoint(L,
A,y,p,u);E&&(M+=u.sampledElevation);if(k.TESTS_DISABLE_OPTIMIZATIONS)F[H]=L.array[L.offset],F[H+1]=L.array[L.offset+1],F[H+2]=u.z,n.projectBuffer(F,D,H,F,p.spatialReference,H,1),F[H]-=q[0],F[H+1]-=q[1],F[H+2]-=q[2],B=!0;else{v[0]=F[H]+q[0];v[1]=F[H+1]+q[1];v[2]=F[H+2]+q[2];p.setAltitude(v,u.z);F[H]=v[0]-q[0];F[H+1]=v[1]-q[1];F[H+2]=v[2]-q[2];const I=.01/p.unitInMeters;if(Math.abs(t[0]-F[H])>=I||Math.abs(t[1]-F[H+1])>=I||Math.abs(t[2]-F[H+2])>=I)B=!0}H+=C;L.offset+=3}return{update:B,averageGeometrySampledElevation:M/
G}}const z=g.create(),v=w.create(),q=w.create(),t=w.create(),r=g.create(),x=w.create(),u=new f.SampleElevationInfo;a.perLodInstanceElevationAligner=function(E,y,A,p){var B=E.graphics3DSymbolLayer.lodRenderer;if(b.isNone(B))return 0;const D=y.centerPointInElevationSR;f.evaluateElevationInfoAtPoint(D,A,y,p,u);y="absolute-height"!==y.mode?u.sampledElevation:0;B=B.instanceData;E=E.instanceIndex;B.getGlobalTransform(E,r);A=h.set(x,r[12],r[13],r[14]);k.TESTS_DISABLE_OPTIMIZATIONS?(v[0]=D.x,v[1]=D.y,v[2]=
u.z,n.computeTranslationToOriginAndRotation(D.spatialReference,v,r,p.spatialReference)&&B.setGlobalTransform(E,r)):p.setAltitudeOfTransformation(u.z,r);p=.01/p.unitInMeters;(k.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(r[12]-A[0])>=p||Math.abs(r[13]-A[1])>=p||Math.abs(r[14]-A[2])>=p)&&B.setGlobalTransform(E,r);return y};a.perObjectElevationAligner=function(E,y,A,p){E=E.stageObject;const B=y.centerPointInElevationSR;let D=0;E.metadata.usesVerticalDistanceToGround?(f.evaluateElevationInfoAtPoint(B,A,y,p,
u),l.updateVertexAttributeAuxpos1w(E,u.verticalDistanceToGround),D=u.sampledElevation):(f.evaluateElevationInfoAtPoint(B,A,y,p,u),"absolute-height"!==y.mode&&(D=u.sampledElevation));y=c.copy(z,E.transformation);A=h.set(x,y[12],y[13],y[14]);k.TESTS_DISABLE_OPTIMIZATIONS?(v[0]=B.x,v[1]=B.y,v[2]=u.z,n.computeTranslationToOriginAndRotation(B.spatialReference,v,y,p.spatialReference)&&(E.transformation=y)):p.setAltitudeOfTransformation(u.z,y);p=.01/p.unitInMeters;if(Math.abs(y[12]-A[0])>=p||Math.abs(y[13]-
A[1])>=p||Math.abs(y[14]-A[2])>=p)E.transformation=y;return D};a.perVertexElevationAligner=function(E,y,A,p){E=E.stageObject;const B=E.geometryRecords;let D=0;for(const C of B){const {update:F,averageGeometrySampledElevation:G}=m(C,y,A,p);D+=G;F&&E.geometryVertexAttrsUpdated(C)}return D/B.length};a.sharedGeometryElevationAligner=function(E,y,A,p){E=E.stageObject;const B=E.geometryRecords;if(0===B.length)return 0;let D=0,C=null,F=0,G=!1;for(const L of B){const H=L.geometry.vertexAttributes.get(d.VertexAttribute.POSITION);
if(H!==C){const {update:M,averageGeometrySampledElevation:K}=m(L,y,A,p);F=K;C=H;G=M}G&&E.geometryVertexAttrsUpdated(L);D+=F}return D/B.length};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/elevationAlignmentUtils":function(){define("exports ../../../../core/compilerUtils ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../layers/graphics/dehydratedFeatureUtils ./graphicUtils ../../support/ElevationProvider".split(" "),
function(a,b,c,g,h,w,n,f,l,k){function e(t,r,x,u,E){const y=(f.isDehydratedPoint(t)?t.z:k.isSamplePosition(t)?t.array[t.offset+2]:t[2])||0;switch(x.mode){case "on-the-ground":x=c.unwrapOr(k.getElevationAtPoint(r,t,"ground"),0);E.verticalDistanceToGround=0;E.sampledElevation=x;E.z=x;break;case "relative-to-ground":t=c.unwrapOr(k.getElevationAtPoint(r,t,"ground"),0);x=x.geometryZWithOffset(y,u);E.verticalDistanceToGround=x;E.sampledElevation=t;E.z=x+t;break;case "relative-to-scene":t=c.unwrapOr(k.getElevationAtPoint(r,
t,"scene"),0);x=x.geometryZWithOffset(y,u);E.verticalDistanceToGround=x;E.sampledElevation=t;E.z=x+t;break;case "absolute-height":x=x.geometryZWithOffset(y,u);u=c.unwrapOr(k.getElevationAtPoint(r,t,"ground"),0);E.verticalDistanceToGround=x-u;E.sampledElevation=u;E.z=x;break;default:b.neverReached(x.mode),E.z=0}}let d=function(){this.z=this.sampledElevation=this.verticalDistanceToGround=0};a.SymbolUpdateType=void 0;(function(t){t[t.NONE=0]="NONE";t[t.UPDATE=1]="UPDATE";t[t.RECREATE=2]="RECREATE"})(a.SymbolUpdateType||
(a.SymbolUpdateType={}));const m={"absolute-height":{applyElevationAlignmentBuffer:function(t,r,x,u,E,y,A,p){y=p.calculateOffsetRenderUnits(A);p=p.featureExpressionInfoContext;r*=3;u*=3;for(A=0;A<E;++A){const B=t[r+1],D=t[r+2];x[u+0]=t[r+0];x[u+1]=B;x[u+2]=null==p?D+y:y;r+=3;u+=3}return 0},requiresAlignment:function(t){const r=t.featureExpressionInfoContext;return 0!==t.meterUnitOffset||null!=r}},"on-the-ground":{applyElevationAlignmentBuffer:function(t,r,x,u,E,y){let A=0;const p=y.spatialReference;
r*=3;u*=3;for(let B=0;B<E;++B){const D=t[r+0],C=t[r+1],F=c.unwrapOr(y.getElevation(D,C,t[r+2],p,"ground"),0);A+=F;x[u+0]=D;x[u+1]=C;x[u+2]=F;r+=3;u+=3}return A/E},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(t,r,x,u,E,y,A,p){let B=0;A=p.calculateOffsetRenderUnits(A);p=p.featureExpressionInfoContext;const D=y.spatialReference;r*=3;u*=3;for(let C=0;C<E;++C){const F=t[r+0],G=t[r+1],L=t[r+2],H=c.unwrapOr(y.getElevation(F,G,L,D,"ground"),0);B+=H;x[u+0]=F;x[u+1]=
G;x[u+2]=null==p?L+H+A:H+A;r+=3;u+=3}return B/E},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(t,r,x,u,E,y,A,p){let B=0;A=p.calculateOffsetRenderUnits(A);p=p.featureExpressionInfoContext;const D=y.spatialReference;r*=3;u*=3;for(let C=0;C<E;++C){const F=t[r+0],G=t[r+1],L=t[r+2],H=c.unwrapOr(y.getElevation(F,G,L,D,"scene"),0);B+=H;x[u+0]=F;x[u+1]=G;x[u+2]=null==p?L+H+A:H+A;r+=3;u+=3}return B/E},requiresAlignment:()=>!0}},z=h.create(),v=new d,q=w.create();a.SampleElevationInfo=
d;a.applyElevationAlignmentForHUD=function(t,r,x,u,E){e(r,x,E,u,v);l.updateVertexAttributeAuxpos1w(t,v.verticalDistanceToGround);x=v.sampledElevation;E=g.copy(z,t.transformation);q[0]=r.x;q[1]=r.y;q[2]=v.z;n.computeTranslationToOriginAndRotation(r.spatialReference,q,E,u.spatialReference)?t.transformation=E:console.warn("Could not locate symbol object properly, it might be misplaced");return x};a.applyPerVertexElevationAlignment=function(t,r,x,u,E,y,A,p,B,D,C){const F=m[C.mode];let G=0;if(n.projectBuffer(t,
r,x,u,B.spatialReference,E,p)&&(F.requiresAlignment(C)?(G=F.applyElevationAlignmentBuffer(u,E,y,A,p,B,D,C),t=y,E=A):t=u,n.projectBuffer(t,B.spatialReference,E,y,D.spatialReference,A,p)))return G};a.elevationModeChangeUpdateType=function(t,r,x){return null==r||null==x?t.definedChanged:"on-the-ground"===r&&"on-the-ground"===x?t.staysOnTheGround:r===x||"on-the-ground"!==r&&"on-the-ground"!==x?a.SymbolUpdateType.UPDATE:t.onTheGroundChanged};a.evaluateElevationAlignmentAtPoint=function(t,r,x,u){e(t,r,
x,u,v);return v.z};a.evaluateElevationInfoAtPoint=e;a.needsElevationUpdates2D=function(t){return"relative-to-ground"===t||"relative-to-scene"===t};a.needsElevationUpdates3D=function(t){return"absolute-height"!==t};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v){function q(x){var u=x.paths[0];if(!u||0===u.length)return null;u=d.getPointOnPath(u,d.getPathLength(u)/2);return m.makeDehydratedPoint(u[0],u[1],u[2],x.spatialReference)}function t(x,u,E){E=E?x:z.clonePoint(x);return u&&x?f.projectPoint(x,E,u)?E:null:E}function r(x){if(Array.isArray(x)){for(const u of x)if(!r(u))return!1;return!0}return null==x||0<=x}a.computeCentroid=function(x,u){if("point"===x.type)return t(x,u,!1);if(z.isHydratedGeometry(x))switch(x.type){case "extent":return t(x.center,
u,!1);case "polygon":return t(x.centroid,u,!1);case "polyline":return t(q(x),u,!0);case "mesh":return t(x.origin,u,!1)}else switch(x.type){case "extent":var E=isFinite(x.zmin);x=m.makeDehydratedPoint(.5*(x.xmax+x.xmin),.5*(x.ymax+x.ymin),E?.5*(x.zmax+x.zmin):void 0,x.spatialReference);return t(x,u,!0);case "polygon":return(E=x.rings[0])&&0!==E.length?(E=e.ringsCentroid(x.rings,x.hasZ),x=m.makeDehydratedPoint(E[0],E[1],E[2],x.spatialReference)):x=null,t(x,u,!0);case "polyline":return t(q(x),u,!0)}};
a.computeObjectRotation=function(x,u,E,y=g.create()){x=x||0;u=u||0;E=E||0;0!==x&&c.rotateZ(y,y,-x/180*Math.PI);0!==u&&c.rotateX(y,y,u/180*Math.PI);0!==E&&c.rotateY(y,y,E/180*Math.PI);return y};a.computeObjectScale=function(x=h.ONES,u,E,y=1){const A=Array(3);if(b.isNone(u)||b.isNone(E))A[0]=1,A[1]=1,A[2]=1;else{let B=0;for(let D=2;0<=D;D--){const C=x[D];let F;const G=null!=C,L=0===D&&!p&&!G,H=E[D];"symbol-value"===C||L?F=0!==H?u[D]/H:1:G&&"proportional"!==C&&isFinite(C)&&(F=0!==H?C/H:1);if(null!=F){var p=
A[D]=F;B=Math.max(B,Math.abs(F))}}for(x=2;0<=x;x--)null==A[x]?A[x]=p:0===A[x]&&(A[x]=.001*B)}for(p=2;0<=p;p--)A[p]/=y;return h.fromArray(A)};a.demResolutionForBoundingBox=function(x,u){return null!=u.minDemResolution?u.minDemResolution:l.isPoint(x)?u.minDemResolutionForPoints:.01*l.maximumDimension(x)};a.enlargeExtent=function(x,u,E,y=0){if(x){u||(u=k.create());let A=.5*x.width*(E-1);E=.5*x.height*(E-1);x.width<1E-7*x.height?A+=E/20:x.height<1E-7*x.width&&(E+=A/20);w.set(u,x.xmin-A-y,x.ymin-E-y,x.xmax+
A+y,x.ymax+E+y);return u}return null};a.isValidSize=r;a.mixinColorAndOpacity=function(x,u){const E=n.clone(n.ONES);b.isSome(x)&&(E[0]=x[0],E[1]=x[1],E[2]=x[2]);b.isSome(u)?E[3]=u:b.isSome(x)&&3<x.length&&(E[3]=x[3]);return E};a.overrideColor=function(x,u,E,y,A,p=[0,0,0,0]){for(let B=0;3>B;++B)b.isSome(x)&&null!=x[B]?p[B]=x[B]:b.isSome(E)&&null!=E[B]?p[B]=E[B]:p[B]=A[B];b.isSome(u)?p[3]=u:b.isSome(y)?p[3]=y:p[3]=A[3];return p};a.updateVertexAttributeAuxpos1w=function(x,u){for(let E=0;E<x.geometries.length;++E){const y=
x.geometries[E].getMutableAttribute(v.VertexAttribute.AUXPOS1);y&&y.data[3]!==u&&(y.data[3]=u,x.geometryVertexAttrsUpdated(x.geometryRecords[E]))}};a.validateSymbolLayerSize=function(x){null!=x.isPrimitive&&(x=[x.width,x.depth,x.height]);return r(x)?null:"Symbol sizes may not be negative values"};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../symbols/support/unitConversionUtils",
"./featureExpressionInfoUtils"],function(a,b,c,g,h){let w=function(){function n(){this._renderUnitOffset=this._meterUnitOffset=0;this._unit="meters";this._metersPerElevationInfoUnit=1;this.mode=this.centerPointInElevationSR=this._featureExpressionInfoContext=null}var f=n.prototype;f.reset=function(){this.mode=null;this._renderUnitOffset=this._meterUnitOffset=0;this._featureExpressionInfoContext=null;this.unit="meters"};f.addOffsetRenderUnits=function(l){this._renderUnitOffset+=l};f.geometryZWithOffset=
function(l,k){k=this.calculateOffsetRenderUnits(k);return null!=this.featureExpressionInfoContext?k:l+k};f.calculateOffsetRenderUnits=function(l){let k=this._meterUnitOffset;const e=this.featureExpressionInfoContext;null!=e&&(k+=h.execute(e)*this._metersPerElevationInfoUnit);return k/l.unitInMeters+this._renderUnitOffset};f.setFromElevationInfo=function(l){this.mode=l.mode;this.unit=g.supportsUnit(l.unit)?l.unit:"meters";this.offsetElevationInfoUnits=c.unwrapOr(l.offset,0)};f.updateFeatureExpressionInfoContext=
function(l,k,e){if(c.isNone(l))this._featureExpressionInfoContext=null;else{var d=l&&l.arcade;d&&c.isSome(k)&&c.isSome(e)?(this._featureExpressionInfoContext=h.clone(l),h.setContextFeature(this._featureExpressionInfoContext,h.createFeature(d.modules,k,e))):this._featureExpressionInfoContext=l}};n.fromElevationInfo=function(l){const k=new n;c.isSome(l)&&k.setFromElevationInfo(l);return k};b._createClass(n,[{key:"featureExpressionInfoContext",get:function(){return this._featureExpressionInfoContext}},
{key:"meterUnitOffset",get:function(){return this._meterUnitOffset}},{key:"unit",get:function(){return this._unit},set:function(l){this._unit=l;this._metersPerElevationInfoUnit=g.getMetersPerUnit(l)}},{key:"requiresSampledElevationInfo",get:function(){return"absolute-height"!==this.mode}},{key:"offsetMeters",set:function(l){this._meterUnitOffset=l;this._renderUnitOffset=0}},{key:"offsetElevationInfoUnits",set:function(l){this._meterUnitOffset=l*this._metersPerElevationInfoUnit;this._renderUnitOffset=
0}}]);return n}();a.ElevationContext=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Logger","../../../../layers/graphics/hydratedFeatures","../../../../support/arcadeOnDemand"],function(a,b,c,g,h){function w(){w=b._asyncToGenerator(function*(f,l,k){f=f&&f.expression;if("string"!==typeof f)return null;var e="0"===f?0:null;if(null!=e)return{cachedResult:e};
e=yield h.loadArcade();const d=e.arcadeUtils;f=d.createSyntaxTree(f);return d.dependsOnView(f)?(null!=k&&k.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:d.createFunction(f),context:d.createExecContext(null,{sr:l}),modules:e}}});return w.apply(this,arguments)}const n=c.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");a.clone=function(f){return{cachedResult:f.cachedResult,arcade:f.arcade?{func:f.arcade.func,context:f.arcade.modules.arcadeUtils.createExecContext(null,
{sr:f.arcade.context.spatialReference}),modules:f.arcade.modules}:null}};a.createContext=function(f,l,k){return w.apply(this,arguments)};a.createContextWithoutExpressionSupport=function(f){f=f&&f.expression;return"string"===typeof f&&(f="0"===f?0:null,null!=f)?{cachedResult:f}:null};a.createFeature=function(f,l,k){return f.arcadeUtils.createFeature(l.attributes,l.geometry,k)};a.execute=function(f){if(null!=f){if(null!=f.cachedResult)return f.cachedResult;var l=f.arcade;l=f.arcade.modules.arcadeUtils.executeFunction(l.func,
l.context);"number"!==typeof l&&(l=f.cachedResult=0);return l}return 0};a.extractExpressionInfo=function(f,l=!1){const k=(f=f&&f.featureExpressionInfo)&&f.expression;l||"0"===k||(f=null);return f};a.setContextFeature=function(f,l){null!=f&&null==f.cachedResult&&(l&&f.arcade?(l._geometry&&(l._geometry=g.hydrateGeometry(l._geometry)),f.arcade.modules.arcadeUtils.updateExecContext(f.arcade.context,l)):n.errorOncePerTick("Arcade support required but not provided"))};a.zeroContext={cachedResult:0};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/edgeRendering/interfaces".split(" "),function(a,b,c,g,h,w,n,f,l,k,e){function d(r){return r.isVisible?
r.parameters.transparent?e.Transparency.TRANSPARENT:e.Transparency.OPAQUE:e.Transparency.INVISIBLE}let m=function(){function r(u,E,y,A,p,B,D,C=null){this.graphics3DSymbolLayer=u;this.stageObject=E;this._uniqueGeometries=y;this._uniqueMaterials=A;this._sharedResource=p;this.elevationAligner=B;this.elevationContext=D;this._edgeState=C;this.type="object3d";this._stage=this._stageLayer=null;this._addedToStage=this._visible=!1;this.alignedSampledElevation=0;this.useObjectOriginAsAttachmentOrigin=this.needsElevationUpdates=
!1;this.graphics3DSymbolLayer=u;this.stageObject=E}var x=r.prototype;x.initialize=function(u,E){this._stageLayer=E;this._stage=u;u.addMany(this._uniqueMaterials);u.addMany(this._uniqueGeometries);u.add(this.stageObject)};x.destroy=function(){var u=this._stage;this._stageLayer&&(u.removeMany(this._uniqueMaterials),u.removeMany(this._uniqueGeometries));u.remove(this.stageObject);this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);u=this._stage.renderView.ensureEdgeView();
u.hasObject(this.stageObject)&&u.removeObject(this.stageObject);this.stageObject.dispose();c.isSome(this._sharedResource)&&this._sharedResource.release();this._visible=!1;this._stage=this._stageLayer=null};x.layerOpacityChanged=function(u,E){if(!c.isNone(this._edgeState)){var y=d(this._edgeState.baseMaterial),A=!1;for(const p of this._edgeState.edgeMaterials)p.objectTransparency!==y&&(p.objectTransparency=y,A=!0);A&&this._resetEdgeObject(E);this._stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,
[u])}};x.slicePlaneEnabledChanged=function(u,E){c.isNone(this._edgeState)||(this._stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{slicePlaneEnabled:u},!E),this._edgeState.properties.slicePlaneEnabled=u)};x.setVisibility=function(u){if(null!=this._stage&&this._visible!==u&&((this._visible=u)?this._addedToStage?this.stageObject.setVisible(!0):(this._stageLayer.add(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),c.isSome(this._edgeState))){const E=
this._stage.renderView.ensureEdgeView();E.hasObject(this.stageObject)?E.updateObjectVisibility(this.stageObject,u):u&&this._addOrUpdateEdgeObject(E,!1)}};x.alignWithElevation=function(u,E,y,A){null!=this.elevationAligner&&(c.isSome(y)&&f.setContextFeature(this.elevationContext.featureExpressionInfoContext,y),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,u,E),this._resetEdgeObject(A))};x.getCenterObjectSpace=function(u=h.create()){return g.copy(u,n.getCenter(this.stageObject.boundingVolumeObjectSpace.bounds))};
x.getBoundingBoxObjectSpace=function(u=w.create()){const E=this.stageObject.boundingVolumeObjectSpace;w.setMin(u,E.min);w.setMax(u,E.max);return u};x.computeAttachmentOrigin=function(u){if(this.useObjectOriginAsAttachmentOrigin){var E=this.stageObject.transformation;u.render.origin[0]+=E[12];u.render.origin[1]+=E[13];u.render.origin[2]+=E[14];u.render.num++}else for(E of this.stageObject.geometryRecords)E.computeAttachmentOrigin(q)&&(g.transformMat4(q,q,this.stageObject.transformation),g.add(u.render.origin,
u.render.origin,q),u.render.num++)};x.getProjectedBoundingBox=function(){var u=b._asyncToGenerator(function*(E,y,A,p,B){B=this.getBoundingBoxObjectSpace(B);var D=t,C=w.isPoint(B)?1:D.length;for(var F=0;F<C;F++){const G=D[F];v[0]=B[G[0]];v[1]=B[G[1]];v[2]=B[G[2]];g.transformMat4(v,v,this.stageObject.transformation);z[3*F]=v[0];z[3*F+1]=v[1];z[3*F+2]=v[2]}if(!E(z,0,C))return null;w.empty(B);E=null;this.calculateRelativeScreenBounds&&(E=this.calculateRelativeScreenBounds());for(D=0;D<3*C;D+=3){for(F=
0;3>F;F++)B[F]=Math.min(B[F],z[D+F]),B[F+3]=Math.max(B[F+3],z[D+F]);E&&A.push({location:z.slice(D,D+3),screenSpaceBoundingRect:E})}if(y&&y.service&&"absolute-height"!==this.elevationContext.mode){w.center(B,q);A="relative-to-scene"===this.elevationContext.mode?"scene":"ground";C=0;if(y.useViewElevation)C=c.unwrapOr(y.service.getElevation(q[0],q[1],A),0);else try{const G=l.demResolutionForBoundingBox(B,y);C=c.unwrapOr(yield y.service.queryElevation(q[0],q[1],p,G,A),0)}catch(G){}w.offset(B,0,0,-this.alignedSampledElevation+
C)}return B});return function(E,y,A,p,B){return u.apply(this,arguments)}}();x.addObjectState=function(u,E){u===k.Object3DState.Highlight&&E.addObject(this.stageObject,this.stageObject.highlight());u===k.Object3DState.MaskOccludee&&E.addObject(this.stageObject,this.stageObject.maskOccludee())};x.removeObjectState=function(u){u.removeObject(this.stageObject)};x._resetEdgeObject=function(u){if(!c.isNone(this._edgeState)){var E=this._stage.renderView.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(E,
u):E.removeObject(this.stageObject)}};x._addOrUpdateEdgeObject=function(u,E){const y=this._edgeState;if(!c.isNone(y)){var A=d(y.baseMaterial);for(const p of y.edgeMaterials)p.objectTransparency=A;u.addOrUpdateObject3D(this.stageObject,y.edgeMaterials,y.properties,!E).then(()=>{var p;return null==(p=this._stageLayer)?void 0:p.sync()})}};b._createClass(r,[{key:"isElevationSource",get:function(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}},{key:"visible",get:function(){return this._visible}}]);
return r}();const z=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],v=h.create(),q=h.create(),t=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];a.Graphics3DObject3DGraphicLayer=m;a.default=m;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/interfaces":function(){define(["exports"],function(a){a.Transparency=void 0;var b=a.Transparency||(a.Transparency={});b[b.INVISIBLE=0]="INVISIBLE";b[b.TRANSPARENT=1]="TRANSPARENT";b[b.OPAQUE=2]=
"OPAQUE";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ./graphicUtils ./interfaces ./Loadable ./symbolComplexity".split(" "),function(a,b,c,g,h,w,n,f,l,k,e,
d,m,z,v){function q(y,A){y=null!=y?A.attributes[y]:0;return null!=y&&isFinite(y)?y:0}function t(y){const A={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};y&&"visualVariables"in y&&y.visualVariables&&y.visualVariables.forEach(p=>{switch(p.type){case "color":A.color=!0;if(p.stops)for(let B=0;B<p.stops.length;B++){const D=p.stops[B].color;D&&(A.opacity=!0,1>D.a&&(A.opacityAlwaysOpaque=!1))}break;case "opacity":A.opacity=!0;A.opacityAlwaysOpaque=!1;break;case "size":A.size=!0}});return A}const r=
h.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");g=function(y){function A(B,D,C,F){var G=y.call(this,C.schedule)||this;G._context=C;G._elevationInfoOverride=null;G._ignoreDrivers=!1;G._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};G.complexity=null;G.logger=r;G._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};G.symbol=B;G.symbolLayer=D;G._renderPriority=F.renderPriority;G._renderPriorityStep=F.renderPriorityStep;G._elevationContext=new k.ElevationContext;
G.complexity=G.computeComplexity();G._ignoreDrivers=F.ignoreDrivers;G._ignoreDrivers||(G._drivenProperties=t(G._context.renderer));G._updateElevationContext();return G}b._inheritsLoose(A,y);var p=A.prototype;p.getCachedSize=function(){return null};p._drivenPropertiesChanged=function(B){if(this._ignoreDrivers)return!1;const D=this._drivenProperties;B=t(B);return B.color!==D.color||B.opacity!==D.opacity||B.opacityAlwaysOpaque!==D.opacityAlwaysOpaque||B.size!==D.size};p._logGeometryCreationWarnings=
function(B,D,C,F){const G="polygons"in B?B.polygons:null;F=`${F} geometry failed to be created`;let L=null;B.projectionSuccess?!D.length||1===D.length&&!D[0].length?L=`${F} (no ${C} were defined)`:Array.isArray(D)&&Array.isArray(D[0])?G&&0===G.length&&"rings"===C&&0<D.length&&2<D[0].length&&(L=`${F} (filled rings should use clockwise winding - try reversing the order of vertices)`):L=`${F} (${C} should be defined as a 2D array)`:L=`${F} (failed to project geometry to view spatial reference)`;L&&r.warnOncePerTick(L)};
p._validateGeometry=function(B,D=null,C=null){return w.isSome(D)&&!D.includes(B.type)?(this.logger.warn("unsupported geometry type for "+C+` symbol: ${B.type}`),!1):"point"!==B.type||isFinite(B.x)&&isFinite(B.y)?!0:(r.warn("point coordinate is not a valid number, graphic skipped"),!1)};p._defaultElevationInfoNoZ=function(){return x};p._defaultElevationInfoZ=function(){return u};p._updateElevationContext=function(){w.isSome(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),
this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()};p.getDefaultElevationInfo=function(B){return B.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()};p.getGeometryElevationMode=function(B,D=this.getDefaultElevationInfo(B)){return this._elevationContext.mode||
D.mode};p.setElevationInfoOverride=function(B){this._elevationInfoOverride=B;this._updateElevationContext()};p.setGraphicElevationContext=function(B,D){var C=w.unwrap(B.geometry);const F=this.getDefaultElevationInfo(C);D.unit=null!=this._elevationContext.unit?this._elevationContext.unit:F.unit;D.mode=this.getGeometryElevationMode(C,F);D.offsetMeters=w.unwrapOr(this._elevationContext.meterUnitOffset,w.unwrapOr(F.offset,0));if(C=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===D.mode)D.mode=
"relative-to-ground",D.offsetMeters=0;D.updateFeatureExpressionInfoContext(C?e.zeroContext:this._elevationContext.featureExpressionInfoContext,B,this._context.layer);return D};p.prepareSymbolLayerPatch=function(B){};p.updateGeometry=function(B,D){return!1};p.onRemoveGraphic=function(B){};p._getLayerOpacity=function(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity;const B=this._context.layer.opacity;return null==
B?1:B};p._getCombinedOpacity=function(B,D=E){let C=1;this.draped||(C*=this._getLayerOpacity());if(this._drivenProperties.opacity)return C;w.isSome(B)?C*=B.a:D.hasIntrinsicColor||(C=0);return C};p._getCombinedOpacityAndColor=function(B,D=E){D=this._getCombinedOpacity(B,D);if(this._drivenProperties.color)return d.mixinColorAndOpacity(null,D);B=w.isSome(B)?c.toUnitRGB(B):n.ONES;return d.mixinColorAndOpacity(B,D)};p._getVertexOpacityAndColor=function(B,D=null){B=d.mixinColorAndOpacity(this._drivenProperties.color?
B.color:null,this._drivenProperties.opacity?B.opacity:null);w.isSome(D)&&(B[0]*=D,B[1]*=D,B[2]*=D,B[3]*=D);return B};p.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};p.computeComplexity=function(){return v.defaultSymbolLayerComplexity(this.symbol,this.symbolLayer)};p.globalPropertyChanged=function(B,D,C){switch(B){case "opacity":return this.layerOpacityChanged(D,C);case "elevationInfo":return B=this._elevationContext.mode,this._updateElevationContext(),this.layerElevationInfoChanged(D,
C,B)===l.SymbolUpdateType.RECREATE?!1:!0;case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(D,C);case "physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case "pixelRatio":return this.pixelRatioChanged();default:return!1}};p.updateGraphics3DGraphicElevationInfo=function(B,D,C){let F=l.SymbolUpdateType.UPDATE;B.forEach(G=>{const L=D(G);w.isSome(L)?(this.setGraphicElevationContext(G.graphic,L.elevationContext),L.needsElevationUpdates=C(L.elevationContext.mode)):F=
l.SymbolUpdateType.RECREATE});return F};p.applyRendererDiff=function(B,D){return m.ApplyRendererDiffResult.Recreate_Symbol};p.getFastUpdateAttrValues=function(B){if(!this._fastUpdates.enabled)return null;const D=this._fastUpdates.visualVariables,C=D.size?q(D.size.field,B):0,F=D.color?q(D.color.field,B):0;B=D.opacity?q(D.opacity.field,B):0;return f.fromValues(C,F,B,0)};p.ensureDrapedStatus=function(B){if(null==this._draped)return this._draped=B,!0;B!==this.draped&&r.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary.");
return!1};b._createClass(A,[{key:"extentPadding",get:function(){return 0}},{key:"needsDrivenTransparentPass",get:function(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}},{key:"draped",get:function(){return this._draped}}]);return A}(z.Loadable);const x={mode:"on-the-ground",offset:0,unit:"meters"},u={mode:"absolute-height",offset:0,unit:"meters"},E={hasIntrinsicColor:!1};a.Graphics3DSymbolLayer=g;a.default=g;a.getAttributeValue=q;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/3d/layers/graphics/interfaces":function(){define(["exports"],function(a){a.ApplyRendererDiffResult=void 0;var b=a.ApplyRendererDiffResult||(a.ApplyRendererDiffResult={});b[b.Recreate_Symbol=0]="Recreate_Symbol";b[b.Recreate_Graphics=1]="Recreate_Graphics";b[b.Fast_Update=2]="Fast_Update";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Loadable":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe",
"../../../../core/promiseUtils"],function(a,b,c,g){let h=function(){function w(f){this.schedule=f;this._loadStatus=a.LoadStatus.LOADING;this.logger=null}var n=w.prototype;n.destroy=function(){this.abortLoad()};n.load=function(f,l){if(this._loadStatus===a.LoadStatus.LOADED)return f&&f(),c.unwrap(this._loader);if(this._loadStatus===a.LoadStatus.FAILED)return l&&l(this._loadError),c.unwrap(this._loader);c.isNone(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>
{this._abortController=null;this._loadStatus=a.LoadStatus.LOADED},k=>{this._loadError=k;this._abortController=null;this._loadStatus=a.LoadStatus.FAILED;!g.isAbortError(k)&&this.logger&&k.message&&this.logger.warn(k.message);throw k;}));this._loader.then(f,l).catch(()=>{});return this._loader};n.abortLoad=function(){c.isSome(this._abortController)?this._abortController=c.abortMaybe(this._abortController):this._loadStatus===a.LoadStatus.LOADING&&(this._loadStatus=a.LoadStatus.FAILED);this._loader=null};
b._createClass(w,[{key:"loadStatus",get:function(){return this._loadStatus}}]);return w}();a.LoadStatus=void 0;(function(w){w[w.LOADING=0]="LOADING";w[w.LOADED=1]="LOADED";w[w.FAILED=2]="FAILED"})(a.LoadStatus||(a.LoadStatus={}));a.Loadable=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/symbolComplexity":function(){define("exports ../../../../core/compilerUtils ../../../../core/maybe ../../../../symbols/support/ObjectSymbol3DLayerResource ./primitiveObjectSymbolUtils ../support/edgeUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/lib/lodRendering/LodResources".split(" "),
function(a,b,c,g,h,w,n,f){function l(q){let t=0,r=0,x=0,u=!1,E=0;const y={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const A of q)c.isNone(A)||(t+=A.primitivesPerFeature,r+=A.primitivesPerCoordinate,x+=A.drawCallsPerFeature,y.bytesPerFeature+=A.memory.bytesPerFeature,y.bytesPerFeatureLabel+=A.memory.bytesPerFeatureLabel,y.bytesPerCoordinate+=A.memory.bytesPerCoordinate,y.draped.bytesPerFeature+=A.memory.bytesPerFeature,
y.draped.bytesPerFeatureLabel+=A.memory.bytesPerFeatureLabel,y.draped.bytesPerCoordinate+=A.memory.bytesPerCoordinate,u=u||A.estimated,++E);return{primitivesPerFeature:t,primitivesPerCoordinate:r,drawCallsPerFeature:x,estimated:u,memory:y,numComplexities:E}}function k(q,t){const r=e(q,t);var x=w.hasEdges(t)?2:0;switch(t.type){case "extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:x,estimated:!1,memory:r};case "fill":return"mesh-3d"===q.type?{primitivesPerFeature:0,
primitivesPerCoordinate:0,drawCallsPerFeature:x,estimated:!1,memory:r}:c.isSome(t.outline)&&0<t.outline.size?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:r}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case "water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case "line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,
estimated:!1,memory:r};case "object":return t.resource&&t.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:r}:{...d(t.resource&&t.resource.primitive||g.defaultPrimitive),memory:r};case "path":{var u=q=0;switch(t.profile){case "circle":q=10;break;case "quad":q=4;break;default:b.neverReached(t.profile);return}switch(t.join){case "round":u=3;break;case "miter":case "bevel":u=1;break;default:b.neverReached(t.join);return}x=2*q;u=q*u*2;let E=-2*
u-x;switch(t.cap){case "none":break;case "butt":case "square":E+=2*(q-1);break;case "round":E+=2*(4*q+q);break;default:return}return{primitivesPerFeature:E,primitivesPerCoordinate:u+x,drawCallsPerFeature:0,estimated:!1,memory:r}}case "text":case "icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:r}}}function e(q,t){q="point-3d"===q.type;switch(t.type){case "extrude":return t.edges&&0<t.edges.size?v.EXTRUDE_EDGES:v.EXTRUDE;case "fill":return c.isSome(t.outline)&&
0<t.outline.size?v.FILL_OUTLINE:v.FILL;case "water":return v.FILL;case "line":return"round"===t.join?v.LINE_ROUND:v.LINE_MITER;case "path":switch(t.join){case "round":switch(t.profile){case "circle":return v.PATH_ROUND_CIRCLE;case "quad":return v.PATH_ROUND_QUAD;default:b.neverReached(t.profile);return}case "miter":case "bevel":switch(t.profile){case "circle":return v.PATH_MITER_CIRCLE;case "quad":return v.PATH_MITER_QUAD;default:b.neverReached(t.profile);return}default:b.neverReached(t.join);return}case "object":return q?
v.OBJECT_POINT:v.OBJECT_POLYGON;case "icon":case "text":return q?v.ICON_POINT:v.ICON_POLYGON}}function d(q){var t=z[q];if(t)return t;t=h.primitiveLodResources(q,null);t={primitivesPerFeature:f.geometriesFromLodLevelResources(t.levels[0]).reduce((r,x)=>r+x.indices.get(n.VertexAttribute.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1};return z[q]=t}const m={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,
bytesPerCoordinate:0,bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}},z={},v={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,
bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},
LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,
bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,
draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,
bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,
bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312}}};a.averageSymbolComplexities=function(q){q=l(q);0<q.numComplexities&&(q.primitivesPerFeature/=q.numComplexities,q.primitivesPerCoordinate/=q.numComplexities,q.drawCallsPerFeature/=q.numComplexities,q.memory.bytesPerFeature/=
q.numComplexities,q.memory.bytesPerFeatureLabel/=q.numComplexities,q.memory.bytesPerCoordinate/=q.numComplexities,q.memory.draped.bytesPerFeature/=q.numComplexities,q.memory.draped.bytesPerFeatureLabel/=q.numComplexities,q.memory.draped.bytesPerCoordinate/=q.numComplexities);return q};a.defaultSymbolComplexity=function(q){if("web-style"===q.type)return m;const t=q.symbolLayers.toArray().map(r=>k(q,r));return l(t)};a.defaultSymbolLayerComplexity=k;a.defaultSymbolLayerMemoryComplexity=e;a.emptySymbolComplexity=
m;a.memoryEstimators=v;a.totalSymbolComplexities=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define(["exports","../../../../core/has","../../webgl-engine/lib/GeometryUtil"],function(a,b,c){const g=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];a.isValidPrimitive=function(h){switch(h){case "sphere":case "cube":case "diamond":case "cylinder":case "cone":case "inverted-cone":case "tetrahedron":return!0}return!1};
a.primitiveLodResources=function(h,w){const n=(f,l,k=!1)=>({levels:f.map(e=>{const d=l(e.tesselation);k&&c.cgToGIS(d);return{components:[{geometry:d,material:w}],faceCount:d.indexCount/3,minScreenSpaceRadius:e.minScreenSpaceRadius}})});switch(h){case "sphere":return n([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],f=>c.createPolySphereGeometry(.5,
f,!0));case "cube":return n([{tesselation:0,minScreenSpaceRadius:0}],()=>c.createBoxGeometry(1));case "cone":return n(g,f=>c.createConeGeometry(1,.5,f,!1),!0);case "inverted-cone":return n(g,f=>c.createConeGeometry(1,.5,f,!0),!0);case "cylinder":return n(g,f=>c.createCylinderGeometry(1,.5,f,[0,0,1],[0,0,.5]));case "tetrahedron":return n([{tesselation:0,minScreenSpaceRadius:0}],()=>c.createTetrahedronGeometry(1),!0);case "diamond":return n([{tesselation:0,minScreenSpaceRadius:0}],()=>c.createDiamondGeometry(1),
!0)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/edgeUtils":function(){define("exports ../../../../Color ../../../../core/has ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec4f64 ./layerUtils ../../webgl-engine/lib/edgeRendering/interfaces".split(" "),function(a,b,c,g,h,w,n,f){function l(m,z){if(g.isNone(m))return null;const v=g.isSome(m.color)?w.fromArray(b.toUnitRGBA(m.color)):w.fromValues(0,0,0,0),q=h.pt2px(m.size),t=h.pt2px(m.extensionLength);
switch(m.type){case "solid":return k({color:v,size:q,extensionLength:t,...z});case "sketch":return{...d,color:v,size:q,extensionLength:t,...z,type:"sketch"}}}function k(m){return{...e,...m,type:"solid"}}const e={color:w.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:f.Transparency.OPAQUE},d={color:w.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:f.Transparency.OPAQUE};a.createMaterial=function(m,z){return l(m&&m.enabled&&m.edges||null,z)};a.createMaterialFromEdges=
l;a.createSolidEdgeMaterial=k;a.hasEdges=function(m){return m&&m.enabled&&(n.isExtrudeSymbol3DLayer(m)||n.isFillSymbol3DLayer(m))&&g.isSome(m.edges)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/layerUtils":function(){define(["exports"],function(a){a.isExtrudeSymbol3DLayer=function(b){return"extrude"===b.type};a.isFillSymbol3DLayer=function(b){return"fill"===b.type};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["exports",
"../../../../../core/arrayUtils"],function(a,b){function c(g){const h=[];g.components.forEach(w=>{h.push(w.geometry)});return b.unique(h)}a.computeFaceCount=function(g){return c(g).reduce((h,w)=>h+w.indexCount/3,0)};a.geometriesFromLodLevelResources=c;a.geometriesFromLodResources=function(g){const h=[];g.levels.forEach(w=>{w.components.forEach(n=>{h.push(n.geometry)})});return b.unique(h)};a.materialsFromLodResources=function(g){const h=[];g.levels.forEach(w=>{w.components.forEach(n=>{h.push(n.material)})});
return b.unique(h)};a.texturesFromLodResources=function(g){const h=[];g.levels.forEach(w=>{w.components.forEach(n=>{n.textures&&h.push(...n.textures)})});return b.unique(h)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/pointUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ./elevationAlignmentUtils ./graphicUtils ../../webgl-engine/lib/Object3D".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){const d=g.create();a.createStageObjectForHUD=function(m,z,v,q,t,r,x,u){const E=v?v.length:0;var y=m.clippingExtent;h.projectPointToVector(z,d,m.elevationProvider.spatialReference);if(b.isSome(y)&&!w.containsPoint(y,d))return null;h.projectPointToVector(z,d,m.renderCoordsHelper.spatialReference);y=m.localOriginFactory.getOrigin(d);r=new e.Object3D({castShadow:!1,metadata:{layerUid:r,graphicUid:x,usesVerticalDistanceToGround:!0}});for(x=0;x<E;x++)r.addGeometry(v[x],q[x],
c.IDENTITY,y,u);m=l.applyElevationAlignmentForHUD(r,z,m.elevationProvider,m.renderCoordsHelper,t);return{object:r,sampledElevation:m}};a.extendPointGraphicElevationContext=function(m,z,v){m=m.elevationContext;v=v.spatialReference;h.projectPointToVector(z,d,v);m.centerPointInElevationSR=f.makeDehydratedPoint(d[0],d[1],z.hasZ?d[2]:0,v)};a.geometryToRenderInfo=function(m,z,v,q,t){const r=new Float64Array(3*m.length),x=new Float64Array(r.length);m.forEach((u,E)=>{r[3*E]=u[0];r[3*E+1]=u[1];r[3*E+2]=2<
u.length?u[2]:0});z=l.applyPerVertexElevationAlignment(r,z,0,x,0,r,0,r.length/3,v,q,t);return{numVertices:m.length,position:r,mapPosition:x,projectionSuccess:null!=z,sampledElevation:z}};a.placePointOnGeometry=function(m){switch(m.type){case "point":return m;case "polygon":case "extent":return k.computeCentroid(m);case "polyline":var z=m.paths[0];if(!z||0===z.length)break;z=n.getPointOnPath(z,n.getPathLength(z)/2);return f.makeDehydratedPoint(z[0],z[1],z[2],m.spatialReference);case "mesh":return m.origin}return null};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/sphere ../../support/mathUtils ./basicInterfaces ./ContentObject ./ContentObjectType ./GeometryRecord ./Object3DStateID ./Util ../materials/renderers/utils".split(" "),function(a,b,c,g,h,w,n,
f,l,k,e,d,m,z,v,q){e=function(x){function u(y={}){var A=x.call(this)||this;A.type=d.ContentObjectType.Object;A._geometryRecords=[];A._geometries=[];A._objectTransformation=h.create();A._bvObjectSpace=new r;A._bvWorldSpace=new r;A._bvDirty=!0;A._hasVolatileTransformation=!1;A._visible=!0;A.castShadow=null!=y.castShadow?y.castShadow:!0;A.metadata=y.metadata;A.metadata&&A.metadata.isElevationSource&&(A.metadata.lastValidElevationBB=new t);A.transformation=h.create();const {geometries:p,materials:B,transformations:D,
origins:C}=y;if(!Array.isArray(p))return b._assertThisInitialized(A);v.assert(B.length===p.length,"Object3D: materials don't match geometries");v.assert(D.length===p.length,"Object3D: transformations don't match geometries");A._geometryRecords.length=p.length;A._geometries.length=p.length;for(y=0;y<p.length;y++)A._geometries[y]=p[y],A._geometryRecords[y]=m.GeometryRecord.pool.acquire(p[y],B[y],h.clone(D[y]),{highlights:null,occludees:null,visible:A._visible},C&&C[y]);return A}b._inheritsLoose(u,x);
var E=u.prototype;E.dispose=function(){this._geometryRecords.length=0;this._geometries.length=0};E.addGeometry=function(y,A,p,B,D){p=p?p:h.IDENTITY;this._geometries.push(y);y=m.GeometryRecord.pool.acquire(y,A,p,{highlights:null,occludees:null,visible:this._visible},B,D);this._geometryRecords.push(y);this._hasVolatileTransformation=this._hasVolatileTransformation||c.isSome(y.shaderTransformation);this._emit("objectGeometryAdded",{object:this,record:y});this._invalidateBoundingVolume();return y};E.removeGeometry=
function(y){const A=this._geometryRecords.splice(y,1)[0];this._hasVolatileTransformation=c.isSome(A.shaderTransformation)?this._geometryRecords.some(p=>c.isSome(p.shaderTransformation)):this._hasVolatileTransformation;A.dispose();this._geometries.splice(y,1);this._emit("objectGeometryRemoved",{object:this,record:A});this._invalidateBoundingVolume();return A};E.removeAllGeometries=function(){for(;0<this.geometryRecords.length;)this.removeGeometry(0)};E.geometryVertexAttrsUpdated=function(y){this._emit("vertexAttrsUpdated",
{object:this,record:y});this._invalidateBoundingVolume()};E.setVisible=function(y){if(this._visible!==y){this._visible=y;for(const A of this._geometryRecords)A.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}};E.maskOccludee=function(){const y=new z.Object3DStateID(k.Object3DState.MaskOccludee);for(const A of this._geometryRecords)A.instanceParameters.occludees=q.addObject3DStateID(A.instanceParameters.occludees,y);this._emit("occlusionChanged",this);return y};E.removeOcclude=
function(y){for(const A of this._geometryRecords)A.instanceParameters.occludees=q.removeObject3DStateID(A.instanceParameters.occludees,y);this._emit("occlusionChanged",this)};E.highlight=function(){const y=new z.Object3DStateID(k.Object3DState.Highlight);for(const A of this._geometryRecords)A.instanceParameters.highlights=q.addObject3DStateID(A.instanceParameters.highlights,y);this._emit("highlightChanged",this);return y};E.removeHighlight=function(y){for(const A of this._geometryRecords)A.instanceParameters.highlights=
q.removeObject3DStateID(A.instanceParameters.highlights,y);this._emit("highlightChanged",this)};E.getCombinedStaticTransformation=function(y,A){return g.multiply(c.unwrapOr(A,h.create()),this.transformation,y.getStaticTransformation())};E._getCombinedShaderTransformation=function(y,A){A=A||h.create();g.multiply(A,this.transformation,y.getShaderTransformation());return A};E.hasVolativeTransformation=function(){return this._hasVolatileTransformation};E._validateBoundingVolume=function(){if(this._bvDirty||
this._hasVolatileTransformation){this._bvObjectSpace.init();this._bvWorldSpace.init();for(var y=0;y<this._geometryRecords.length;++y){var A=this._geometryRecords[y],p=this._geometries[y].boundingInfo;c.isSome(p)&&(this._calculateTransformedBoundingVolume(p,this._bvObjectSpace,A.getShaderTransformation()),this._calculateTransformedBoundingVolume(p,this._bvWorldSpace,this._getCombinedShaderTransformation(A)))}w.lerp(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5);w.lerp(this._bvWorldSpace.bounds,
this._bvWorldSpace.min,this._bvWorldSpace.max,.5);y=n.create();A=n.create();p=l.maxScale(this.transformation);for(let F=0;F<this._geometryRecords.length;++F){var B=this._geometries[F].boundingInfo;if(!c.isNone(B)){var D=this._geometryRecords[F].getShaderTransformation(),C=l.maxScale(D);w.transformMat4(y,B.getCenter(),D);D=w.distance(y,this._bvObjectSpace.bounds);B=B.getBSRadius()*C;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],D+B);w.transformMat4(A,y,this.transformation);C=
w.distance(A,this._bvWorldSpace.bounds);this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],C+B*p)}}this._bvDirty=!1}};E._calculateTransformedBoundingVolume=function(y,A,p){const B=y.getBBMin();y=y.getBBMax();const D=n.clone(B),C=n.clone(y);w.transformMat4(D,D,p);w.transformMat4(C,C,p);for(var F=0;3>F;++F)A.min[F]=Math.min(A.min[F],D[F],C[F]),A.max[F]=Math.max(A.max[F],D[F],C[F]);for(F=0;3>F;++F){w.copy(D,B);w.copy(C,y);D[F]=y[F];C[F]=B[F];w.transformMat4(D,D,p);w.transformMat4(C,C,
p);for(let G=0;3>G;++G)A.min[G]=Math.min(A.min[G],D[G],C[G]),A.max[G]=Math.max(A.max[G],D[G],C[G])}};E._invalidateBoundingVolume=function(){this._bvDirty=!0;c.isSome(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)};E._emit=function(y,A){c.isSome(this._parentLayer)&&this._parentLayer.events.emit(y,A)};b._createClass(u,[{key:"geometryRecords",get:function(){return this._geometryRecords}},{key:"geometries",get:function(){return this._geometries}},{key:"transformation",
get:function(){return this._objectTransformation},set:function(y){g.copy(this._objectTransformation,y);this._invalidateBoundingVolume();this._emit("objectTransformation",this)}},{key:"parentLayer",get:function(){return this._parentLayer},set:function(y){v.assert(null==this._parentLayer||null==y,"Object3D can only be added to a single Layer");this._parentLayer=y}},{key:"isVisible",get:function(){return this._visible}},{key:"boundingVolumeWorldSpace",get:function(){this._validateBoundingVolume();return this._bvWorldSpace}},
{key:"boundingVolumeObjectSpace",get:function(){this._validateBoundingVolume();return this._bvObjectSpace}},{key:"test",get:function(){const y=this;return{hasGeometry:A=>-1<y._geometries.indexOf(A),getGeometryIndex:A=>y._geometries.indexOf(A)}}}]);return u}(e.ContentObject);let t=function(){function x(){this.min=n.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this.max=n.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}x.prototype.isEmpty=function(){return this.max[0]<
this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]};return x}(),r=function(x){function u(){var E=x.apply(this,arguments)||this;E.bounds=f.create();return E}b._inheritsLoose(u,x);u.prototype.init=function(){w.set(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);w.set(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);f.clear(this.bounds)};return u}(t);a.Object3D=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GeometryRecord":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/uid ../../../../chunks/vec3".split(" "),
function(a,b,c,g,h,w){let n=function(){function f(){this._disposed=!1}var l=f.prototype;l.acquire=function(k,e,d,m,z,v){this.id=h.generateUID();this.geometry=k;this.material=e;this.transformation=d;this.instanceParameters=m;this.origin=z;this._shaderTransformation=v;this._disposed=!1};l.release=function(){this._disposed=!1};l.dispose=function(){this._disposed=!0};l.getStaticTransformation=function(){return this.transformation};l.getShaderTransformation=function(){return c.isSome(this._shaderTransformation)?
this._shaderTransformation(this.transformation):this.transformation};l.computeAttachmentOrigin=function(k){return(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,k):this.geometry.computeAttachmentOrigin(k))?(w.transformMat4(k,k,this.getStaticTransformation()),!0):!1};b._createClass(f,[{key:"disposed",get:function(){return this._disposed}},{key:"shaderTransformation",get:function(){return this._shaderTransformation}}]);return f}();n.pool=new g(n);a.GeometryRecord=
n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Object3DStateID":function(){define(["exports","../../../../core/uid"],function(a,b){a.Object3DStateID=function(c){this.channel=c;this.id=b.generateUID()};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec2f32 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/hud/HUD.glsl ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./internal/bufferWriterUtils ../shaders/LineCalloutTechnique".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){let m=function(x){function u(y){y=x.call(this,y,v)||this;y.techniqueConfig=new d.LineCalloutTechniqueConfiguration;y._uniqueMaterialIdentifier=u.uniqueMaterialIdentifier(y.parameters);return y}b._inheritsLoose(u,x);var E=u.prototype;E.getPassParameters=function(){return this.parameters};E.getTechniqueConfig=function(y,A){y=(null==A?void 0:A.slot)!==l.RenderSlot.LINE_CALLOUTS;this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest;this.techniqueConfig.verticalOffset=
!!this.parameters.verticalOffset;this.techniqueConfig.screenSizePerspective=!!this.parameters.screenSizePerspective;this.techniqueConfig.depthHudEnabled=y;this.techniqueConfig.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart;this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?w.HUDSpace.Screen:w.HUDSpace.World;this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled;this.techniqueConfig.multipassGeometryEnabled=A?A.multipassGeometryEnabled:
!1;return this.techniqueConfig};E.intersect=function(){};E.requiresSlot=function(y){switch(y){case l.RenderSlot.LINE_CALLOUTS:case l.RenderSlot.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1};E.createGLMaterial=function(y){return y.output===h.ShaderOutput.Color?new z(y):null};E.createBufferWriter=function(){return new r};E.validateParameters=function(y){y=u.uniqueMaterialIdentifier(y);y!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=y)};u.uniqueMaterialIdentifier=function(y){return JSON.stringify({screenOffset:y.screenOffset||
[0,0],centerOffsetUnits:y.centerOffsetUnits||"world"})};b._createClass(u,[{key:"uniqueMaterialIdentifier",get:function(){return this._uniqueMaterialIdentifier}}]);return u}(f.Material),z=function(x){function u(){return x.apply(this,arguments)||this}b._inheritsLoose(u,x);var E=u.prototype;E.updateParameters=function(y){return this.ensureTechnique(d.LineCalloutTechnique,y)};E.beginSlot=function(y){return this.updateParameters(y)};E.bind=function(y,A){A.bindPass(this._material.getPassParameters(),y)};
return u}(n);const v={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1E-5,depthHUDAlignStart:!1,centerOffsetUnits:"world",slicePlaneEnabled:!1,...f.DefaultMaterialParameters},q=g.newLayout().vec3f(k.VertexAttribute.POSITION).vec3f(k.VertexAttribute.NORMAL).vec2f(k.VertexAttribute.UV0).vec4f(k.VertexAttribute.AUXPOS1),t=[c.fromValues(0,0),c.fromValues(1,0),c.fromValues(0,1),c.fromValues(1,0),c.fromValues(1,
1),c.fromValues(0,1)];let r=function(){function x(){this.vertexBufferLayout=q}var u=x.prototype;u.allocate=function(E){return this.vertexBufferLayout.createBuffer(E)};u.elementCount=function(E){return 6*E.indices.get(k.VertexAttribute.POSITION).length};u.write=function(E,y,A,p){e.writePosition(y.indices.get(k.VertexAttribute.POSITION),y.vertexAttributes.get(k.VertexAttribute.POSITION).data,E.transformation,A.position,p,6);e.writeNormal(y.indices.get(k.VertexAttribute.NORMAL),y.vertexAttributes.get(k.VertexAttribute.NORMAL).data,
E.invTranspTransformation,A.normal,p,6);e.writeBufferVec4(y.indices.get(k.VertexAttribute.AUXPOS1),y.vertexAttributes.get(k.VertexAttribute.AUXPOS1).data,A.auxpos1,p,6);for(E=0;E<t.length;++E)A.uv0.setVec(p+E,t[E])};return x}();a.LineCalloutMaterial=m;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/vec2f32":function(){define(["exports"],function(a){function b(){return new Float32Array(2)}function c(v){const q=new Float32Array(2);q[0]=v[0];q[1]=v[1];return q}function g(v,q){const t=
new Float32Array(2);t[0]=v;t[1]=q;return t}function h(v,q){return new Float32Array(v,q,2)}function w(){return b()}function n(){return g(1,1)}function f(){return g(1,0)}function l(){return g(0,1)}const k=b(),e=n(),d=f(),m=l(),z=Object.freeze({__proto__:null,create:b,clone:c,fromValues:g,createView:h,zeros:w,ones:n,unitX:f,unitY:l,ZEROS:k,ONES:e,UNIT_X:d,UNIT_Y:m});a.ONES=e;a.UNIT_X=d;a.UNIT_Y=m;a.ZEROS=k;a.clone=c;a.create=b;a.createView=h;a.fromValues=g;a.ones=n;a.unitX=f;a.unitY=l;a.vec2f32=z;a.zeros=
w})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../core/shaderLibrary/hud/HUD.glsl ../core/shaderLibrary/shading/MultipassGeometryTest.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Program ../materials/internal/MaterialUtil ../../../../chunks/LineCallout.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r){e=function(x){function u(){return x.apply(this,arguments)||this}c._inheritsLoose(u,x);var E=u.prototype;E.initializeProgram=function(y){var A=u.shader.get();const p=this.configuration;A=A.build({occlusionTestEnabled:p.occlusionTestEnabled,verticalOffsetEnabled:p.verticalOffset,screenSizePerspectiveEnabled:p.screenSizePerspective,depthHudEnabled:p.depthHudEnabled,depthHudAlignStartEnabled:p.depthHudAlignStartEnabled,screenCenterOffsetUnitsEnabled:p.screenCenterOffsetUnitsEnabled,
slicePlaneEnabled:p.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,viewingMode:y.viewingMode,isDraped:!1,multipassGeometryEnabled:p.multipassGeometryEnabled});return new z.Program(y.rctx,A,m.Default3D)};E.bindPass=function(y,A){l.bindProjectionMatrix(this.program,A.camera.projectionMatrix);q.bindLineCalloutUniforms(this.program,y,A.camera.pixelRatio||1);w.bindVerticalOffsetUniforms(this.program,y,A);n.bindHUDUniforms(this.program,A);this.program.setUniform2fv("nearFar",
A.camera.nearFar);this.program.setUniform2fv("inverseViewport",A.inverseViewport);f.bindMultipassGeometryTexture(this.program,A);this.program.bindTexture(A.hudVisibilityTexture,"hudVisibilityTexture");this.program.setUniform1f("cameraGroundRelative",A.camera.aboveGround?1:-1);this.program.setUniform1f("polygonOffset",y.shaderPolygonOffset);l.bindViewport(this.program,A);this.program.setUniform1f("perDistancePixelRatio",Math.tan(A.camera.fovY/2)/(A.camera.fullViewport[2]/2));this.program.setUniformMatrix4fv("viewNormal",
A.camera.viewInverseTransposeMatrix);this.program.setUniform2f("pixelToNDC",2/A.camera.fullViewport[2],2/A.camera.fullViewport[3]);this.program.setUniform1f("lineSize",Math.ceil(y.size)*(A.camera.pixelRatio||1));v.bindScreenSizePerspective(y.screenSizePerspective,this.program,"screenSizePerspectiveAlignment")};E.bindDraw=function(y){l.bindView(this.program,y);l.bindCameraPosition(this.program,y.origin,y.camera.viewInverseTransposeMatrix);h.bindSliceUniformsWithOrigin(this.program,this.configuration,
y);this.program.rebindTextures()};E.setPipelineState=function(y){y=y?t.CompareFunction.ALWAYS:t.CompareFunction.LESS;return this.configuration.depthHudEnabled?r.makePipelineState({depthTest:{func:y},depthWrite:r.defaultDepthWriteParams}):r.makePipelineState({blending:r.separateBlendingParams(t.BlendFactor.ONE,t.BlendFactor.SRC_ALPHA,t.BlendFactor.ONE_MINUS_SRC_ALPHA,t.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:y},colorWrite:r.defaultColorWriteParams})};E.initializePipeline=function(){return this.setPipelineState(this.configuration.multipassGeometryEnabled)};
return u}(e.ShaderTechnique);e.shader=new k.ReloadableShaderModule(q.LineCalloutShader,()=>new Promise((x,u)=>a(["./LineCallout.glsl"],x,u)));k=function(x){function u(){var E=x.apply(this,arguments)||this;E.occlusionTestEnabled=!0;E.verticalOffset=!1;E.screenSizePerspective=!1;E.depthHudEnabled=!1;E.depthHudAlignStartEnabled=!1;E.screenCenterOffsetUnitsEnabled=n.HUDSpace.World;E.slicePlaneEnabled=!1;E.multipassGeometryEnabled=!1;return E}c._inheritsLoose(u,x);return u}(d.ShaderTechniqueConfiguration);
g.__decorate([d.parameter()],k.prototype,"occlusionTestEnabled",void 0);g.__decorate([d.parameter()],k.prototype,"verticalOffset",void 0);g.__decorate([d.parameter()],k.prototype,"screenSizePerspective",void 0);g.__decorate([d.parameter()],k.prototype,"depthHudEnabled",void 0);g.__decorate([d.parameter()],k.prototype,"depthHudAlignStartEnabled",void 0);g.__decorate([d.parameter({count:n.HUDSpace.COUNT})],k.prototype,"screenCenterOffsetUnitsEnabled",void 0);g.__decorate([d.parameter()],k.prototype,
"slicePlaneEnabled",void 0);g.__decorate([d.parameter()],k.prototype,"multipassGeometryEnabled",void 0);b.LineCalloutTechnique=e;b.LineCalloutTechniqueConfiguration=k;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/LineCallout.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,g,h,w,n,f){function l(m){const z=new n.ShaderBuilder;z.include(c.AlignPixel);z.include(g.HUD,m);z.include(b.Slice,m);z.attributes.add(f.VertexAttribute.UV0,"vec2");z.vertex.uniforms.add("lineSize","float").add("pixelToNDC","vec2").add("borderSize","float").add("screenOffset","vec2");z.varyings.add("coverageSampling","vec4");z.varyings.add("lineSizes","vec2");m.multipassGeometryEnabled&&z.varyings.add("depth","float");z.vertex.code.add(w.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${m.occlusionTestEnabled?w.glsl`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${m.screenSizePerspectiveEnabled?w.glsl`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:w.glsl`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${m.multipassGeometryEnabled?"depth \x3d posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${m.depthHudEnabled?m.depthHudAlignStartEnabled?w.glsl`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:w.glsl`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${m.screenSizePerspectiveEnabled?w.glsl`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:w.glsl`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `);z.fragment.uniforms.add("uColor","vec4");z.fragment.uniforms.add("borderColor","vec4");m.multipassGeometryEnabled&&(z.fragment.include(h.multipassGeometryTest,m),z.fragment.uniforms.add("inverseViewport","vec2"));z.fragment.code.add(w.glsl`
    void main() {
      ${m.multipassGeometryEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${m.depthHudEnabled?w.glsl`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:w.glsl`
      // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you
      // need to divide by finalAlpha). We avoid the division here by setting the
      // appropriate blending function in the material.
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `);return z}function k(m,z,v){e(m,"uColor",z.color);m.setUniform1f("pixelRatio",v);m.setUniform2f("screenOffset",z.screenOffset[0]*v,z.screenOffset[1]*v);null!==z.borderColor?(e(m,"borderColor",z.borderColor),m.setUniform1f("borderSize",v)):(m.setUniform4f("borderColor",0,0,0,0),m.setUniform1f("borderSize",0))}function e(m,z,v){3===v.length?m.setUniform4f(z,v[0],v[1],v[2],1):m.setUniform4fv(z,v)}const d=Object.freeze({__proto__:null,build:l,bindLineCalloutUniforms:k});a.LineCalloutShader=d;a.bindLineCalloutUniforms=
k;a.build=l})},"esri/views/3d/layers/graphics/Graphics3DGraphicCreationContext":function(){define(function(){return function(a,b,c){this.graphic=a;this.renderingInfo=b;this.layer=c}})},"esri/views/3d/layers/graphics/graphicSymbolUtils":function(){define(["exports","./Graphics3DSymbol","./Graphics3DWebStyleSymbol"],function(a,b,c){a.getGraphics3DSymbol=function(g){return g instanceof c?g.graphics3DSymbol:g instanceof b?g:null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ./Graphics3DGraphic ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayerFactory ./interfaces ./Loadable ./symbolComplexity".split(" "),
function(a,b,c,g,h,w,n,f,l,k){const e={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};return function(d){function m(v,q,t){var r=d.call(this,q.schedule)||this;r._symbol=v;r._context=q;r._backgroundLayers=t;r._destroyed=!1;r.symbolLayers=[];r.referenced=0;r._extentPadding=0;return r}a._inheritsLoose(m,d);var z=m.prototype;z.doLoad=function(){var v=a._asyncToGenerator(function*(q){var t=this;let r=this._symbol.symbolLayers;this._extentPadding=0;this._backgroundLayers&&(r=this._backgroundLayers.concat(r));
const x=r.length;for(;this.symbolLayers.length<r.length;)this.symbolLayers.push(null);this.symbolLayers.length=r.length;const u=[];for(let E=0;E<x;E++){const y=r.getItemAt(E);if(!1===y.enabled)continue;e.renderPriority=1-(1+E)/x;e.renderPriorityStep=1/x;e.ignoreDrivers=y._ignoreDrivers;const A=n.make(this.symbol,y,this._context,e);u.push(g.onAbortOrThrow(q,()=>{this.symbolLayers[E]=null;A.destroy()}));this.symbolLayers[E]=A}yield b.forEach(this.symbolLayers,function(){var E=a._asyncToGenerator(function*(y,
A){if(c.isSome(y))try{yield y.load(),t._extentPadding+=Math.max(t._extentPadding,y.extentPadding)}catch{t.symbolLayers[A]=null}});return function(y,A){return E.apply(this,arguments)}}());for(const E of u)null==E?void 0:E.remove();u.length=0;g.throwIfAborted(q);if(this.symbolLayers.length&&!this.symbolLayers.some(E=>!!E))throw Error();});return function(q){return v.apply(this,arguments)}}();z.getSymbolLayerSize=function(v){v=this.symbolLayers[v];return c.isSome(v)?v.getCachedSize():null};z.createGraphics3DGraphic=
function(v,q){const t=v.graphic,r=Array(this.symbolLayers.length);for(let x=0;x<this.symbolLayers.length;x++){const u=this.symbolLayers[x];r[x]=c.isSome(u)?u.createGraphics3DGraphic(v):null}return new h(t,q||this,r,v.layer,this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null)};z.globalPropertyChanged=function(v,q){const t=this.symbolLayers.length;for(let r=0;r<t;r++){const x=
this.symbolLayers[r],u=E=>{E=E.graphics[r];return E instanceof w.Graphics3DObject3DGraphicLayer?E:null};if(c.isSome(x)&&!x.globalPropertyChanged(v,q,u))return!1}return!0};z.applyRendererDiff=function(v,q){return this.loadStatus!==l.LoadStatus.LOADED?f.ApplyRendererDiffResult.Recreate_Symbol:this.symbolLayers.reduce((t,r)=>t!==f.ApplyRendererDiffResult.Recreate_Symbol&&c.isSome(r)?Math.min(t,r.applyRendererDiff(v,q)):t,f.ApplyRendererDiffResult.Fast_Update)};z.prepareSymbolPatch=function(v){if(this.loadStatus!==
l.LoadStatus.FAILED&&"partial"===v.diff.type){var q=v.diff.diff;if(q.symbolLayers&&"partial"===q.symbolLayers.type){var t=q.symbolLayers.diff;this.symbolLayers.forEach((r,x)=>{if(!c.isNone(r)){var u=t[x];if(u){const E={diff:u,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};r.prepareSymbolLayerPatch(E);v.symbolStatePatches.push(...E.symbolLayerStatePatches);E.graphics3DGraphicPatches.length&&v.graphics3DGraphicPatches.push((y,A)=>{const p=y.graphics[x];c.isSome(p)&&E.graphics3DGraphicPatches.forEach(B=>
B(p,A))})}}})}}};z.updateGeometry=function(v,q){for(let t=0;t<this.symbolLayers.length;t++){const r=this.symbolLayers[t];if(c.isNone(r))continue;const x=v.graphics[t];if(c.isNone(x)||!r.updateGeometry(x,q))return!1}return!0};z.onRemoveGraphic=function(v){for(let q=0;q<this.symbolLayers.length;q++){const t=this.symbolLayers[q];if(c.isNone(t))continue;const r=v.graphics[q];if(c.isSome(r))t.onRemoveGraphic(r)}};z.getFastUpdateStatus=function(){let v=0,q=0,t=0;this.symbolLayers.forEach(r=>{c.isNone(r)||
(r.loadStatus===l.LoadStatus.LOADING?v++:r.isFastUpdatesEnabled()?t++:q++)});return{loading:v,slow:q,fast:t}};z.destroy=function(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{d.prototype.destroy.call(this);for(const v of this.symbolLayers)c.isSome(v)&&v.destroy();this.symbolLayers.length=0;this._destroyed=!0}};a._createClass(m,[{key:"symbol",get:function(){return this._symbol},set:function(v){this._symbol=v;for(let q=0;q<v.symbolLayers.length;q++){const t=
this.symbolLayers[q];c.isNone(t)||(t.symbol=v,t.symbolLayer=v.symbolLayers.items[q])}}},{key:"extentPadding",get:function(){return this._extentPadding}},{key:"complexity",get:function(){return k.totalSymbolComplexities(this.symbolLayers.map(v=>c.get(v,"complexity")))}},{key:"destroyed",get:function(){return this._destroyed}}]);return m}(l.Loadable)})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/maybe ../../../../core/ObjectPool ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Polygon ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ./enums ./featureExpressionInfoUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t){const r=new h(Array,u=>d.set(u,d.ZERO),null,10,5),x=m.create();return function(){function u(y,A,p,B,D){this.graphic=y;this.graphics3DSymbol=A;this.graphics=p;this._labelGraphics=[];this._auxiliaryGraphics=[];{var C=q.VisibilityFlag._COUNT;const F=Array(q.VisibilityGroup._COUNT);for(let G=0;G<F.length;G++)F[G]=Array(C);C=F}this._visibilityFlags=C;this._featureExpressionFeature=null;this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1};this._extent=null;
this.isElevationSource=!1;++A.referenced;this._featureExpressionFeature=D?t.createFeature(D,y,B):null;for(const F of p)g.isSome(F)&&(this.isElevationSource=this.isElevationSource||F.isElevationSource)}var E=u.prototype;E.initialize=function(y,A,p){this._layer=A;this._stage=y;this._forEachSymbolLayerGraphic(B=>{B.initialize(y,A,p);B.setVisibility(this.isVisible())})};E.destroy=function(){this._forEachSymbolLayerGraphic(y=>y.destroy());this._auxiliaryGraphics=this.graphics=null;--this.graphics3DSymbol.referenced;
this.graphics3DSymbol=null};E.clearLabelGraphics=function(){this._forEachLabelGraphic(y=>y.destroy());this._labelGraphics.length=0};E.addLabelGraphic=function(y,A,p){this._labelGraphics.push(y);y.initialize(A,p);y.setVisibility(this.isVisible(q.VisibilityGroup.LABEL))};E.addAuxiliaryGraphic=function(y){this._auxiliaryGraphics.push(y);this._layer&&(y.initialize(this._stage,this._layer),y.setVisibility(this.isVisible()))};E.isVisible=function(y=q.VisibilityGroup.GRAPHIC,A){for(let p=0;p<=y;p++){const B=
this._visibilityFlags[p];for(let D=0;D<B.length;++D)if(!1===B[D]&&D!==A)return!1}return!0};E.hasVisibilityFlag=function(y,A){return null!=this._visibilityFlags[A][y]};E.setVisibilityFlag=function(y,A,p){const B=this.isVisible(p);this._visibilityFlags[p][y]=A;const D=this.isVisible(p);if(B===D)return!1;if(p===q.VisibilityGroup.LABEL)this._forEachLabelGraphic(C=>C.setVisibility(D));else{this._forEachSymbolLayerGraphic(F=>F.setVisibility(D));const C=this.isVisible(q.VisibilityGroup.LABEL);this._forEachLabelGraphic(F=>
F.setVisibility(C))}return!0};E.clearVisibilityFlag=function(y,A=q.VisibilityGroup.GRAPHIC){return this.setVisibilityFlag(y,void 0,A)};E.computeExtent=function(y){if(!this._extent){var A=this.graphic.geometry;if(g.isNone(A))return!1;this._extent=m.create();z.computeAABR(A,this._extent);A=A.spatialReference;if(!A.equals(y)&&!e.projectBoundingRect(this._extent,A,this._extent,y))return this._extent=null,!1}return!0};E.getAsOptimizedGeometry=function(y,A){if(g.isSome(this._optimizedGeometry.geometry)&&
this._optimizedGeometry.hasZ===y&&this._optimizedGeometry.hasM===A)return this._optimizedGeometry.geometry;this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,y,A);this._optimizedGeometry.hasZ=y;this._optimizedGeometry.hasM=A;return this._optimizedGeometry.geometry};E._convertGraphicToOptimizedGeometry=function(y,A,p){y=y.geometry;if("mesh"===y.type||"extent"===y.type)y=k.fromExtent("mesh"===y.type?y.extent:y);return v.convertFromGeometry(y,A,p)};E.computeAttachmentOrigin=
function(){const y={render:{origin:l.create(),num:0},draped:{origin:n.create(),num:0}};for(const A of this.graphics)g.isNone(A)||A.computeAttachmentOrigin(y);y.render.num&&f.scale(y.render.origin,y.render.origin,1/y.render.num);y.draped.num&&w.scale(y.draped.origin,y.draped.origin,1/y.draped.num);return y};E.getProjectedBoundingBox=function(){var y=a._asyncToGenerator(function*(A,p,B,D,C){C||(C={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]});C.boundingBox?d.empty(C.boundingBox):
C.boundingBox=d.empty();C.requiresDrapedElevation=!1;yield b.forEach(this.graphics,function(){var F=a._asyncToGenerator(function*(G){if(!g.isNone(G)){var L="draped"===G.type?p:A,H=r.acquire();G=yield G.getProjectedBoundingBox(L,B,C.screenSpaceObjects,D,H);isFinite(G[2])&&isFinite(G[5])||(C.requiresDrapedElevation=!0);G&&d.expandWithAABB(C.boundingBox,H);r.release(H)}});return function(G){return F.apply(this,arguments)}}());return d.allFinite(C.boundingBox)||m.allFinite(d.toRect(C.boundingBox,x))?
C:null});return function(A,p,B,D,C){return y.apply(this,arguments)}}();E.needsElevationUpdates=function(){for(const y of this.graphics)if(g.isSome(y)&&("object3d"===y.type||"lod-instance"===y.type)&&y.needsElevationUpdates)return!0;for(const y of this._labelGraphics)if(y&&y.needsElevationUpdates)return!0;return!1};E.alignWithElevation=function(y,A,p){this._forEachRenderedGraphic(B=>{"object3d"!==B.type&&"lod-instance"!==B.type||B.alignWithElevation(y,A,this._featureExpressionFeature,p)})};E.addObjectStateSet=
function(y,A){this._forEachSymbolLayerGraphic(p=>p.addObjectState(y,A))};E.removeObjectState=function(y){this._forEachSymbolLayerGraphic(A=>A.removeObjectState(y))};E._forEachGraphicList=function(y,A){y.forEach(p=>p&&A(p))};E._forEachSymbolLayerGraphic=function(y){this._forEachGraphicList(this.graphics,y);this._forEachGraphicList(this._auxiliaryGraphics,y)};E._forEachLabelGraphic=function(y){this._forEachGraphicList(this._labelGraphics,y)};E._forEachRenderedGraphic=function(y){this._forEachSymbolLayerGraphic(y);
this._forEachLabelGraphic(y)};a._createClass(u,[{key:"labelGraphics",get:function(){return this._labelGraphics}},{key:"extent",get:function(){return this._extent}},{key:"destroyed",get:function(){return null==this.graphics}},{key:"isDraped",get:function(){let y=!1;this._forEachSymbolLayerGraphic(A=>{"draped"===A.type&&(y=!0)});return y}},{key:"usedMemory",get:function(){let y=c.estimateAttributesObjectSize(this.graphic.attributes);this._forEachSymbolLayerGraphic(A=>{const p=A.graphics3DSymbolLayer.complexity;
g.isNone(p)||(A="draped"===A.type?p.memory.draped:p.memory,y+=A.bytesPerFeature,A.bytesPerCoordinate&&(y+=z.numVertices(this.graphic.geometry)*A.bytesPerCoordinate))});return y}}]);return u}()})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("exports ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer ./Graphics3DWaterSymbolLayer".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){const d=b.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory"),m={icon:g.Graphics3DIconSymbolLayer,object:n.Graphics3DObjectSymbolLayer,line:h.Graphics3DLineSymbolLayer,path:f.Graphics3DPathSymbolLayer,fill:l.Graphics3DPolygonFillSymbolLayer,extrude:c.Graphics3DExtrudeSymbolLayer,text:k.Graphics3DTextSymbolLayer,water:e.Graphics3DWaterSymbolLayer},z={"mesh-3d":{fill:w.Graphics3DMeshFillSymbolLayer}};a.make=function(v,q,t,r){const x=z[v.type]&&z[v.type][q.type]||
m[q.type];return x?new x(v,q,t,r):(d.error("GraphicsLayerFactory#make",`unknown symbol type ${q.type}`),null)};a.setSymbolClass=function(v,q){m[v]=q};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/maybe ../../../../chunks/earcut ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec32 ../../../../renderers/support/renderingInfoUtils ../../../ViewingMode ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./polygonUtils ../support/edgeUtils ../../support/debugFlags ../../support/ElevationProvider ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H,M){function K(la,ia,ca,fa){var ba=new Uint32Array(la.length);fa=[[H.VertexAttribute.POSITION,{size:3,data:ca.positions,exclusive:!0}],[H.VertexAttribute.NORMAL,{size:3,data:ca.normals,exclusive:!0}],[H.VertexAttribute.COLOR,{size:4,data:fa,exclusive:!0}],[H.VertexAttribute.SIZE,{size:1,data:ca.heights,exclusive:!0}]];ba=[[H.VertexAttribute.POSITION,la],[H.VertexAttribute.NORMAL,la],[H.VertexAttribute.COLOR,ba]];ca.elevation&&(fa.push([H.VertexAttribute.MAPPOS,
{size:3,data:ca.elevation}]),ba.push([H.VertexAttribute.MAPPOS,la]));return new G.Geometry(fa,ba,F.PrimitiveType.Triangle,ia)}function I(la,ia,ca,fa,ba,Z,ha,na,pa,xa,Da,ua,Fa,qa){let sa=0;var ma=2*fa.count;{var ra=fa.index,va=fa.count,Ia=ca.length/3,Ja=pa;k.copy(da,Fa);const Ha=0<ua?1:-1;ra*=3;let Ta=Ja;Fa=3*Ta;let db=Ja+va;Ja=3*db;for(let fb=0;fb<va;++fb)qa&&(da[0]=la[ra+0],da[1]=la[ra+1],da[2]=la[ra+2],k.normalize(da,da)),ba[Fa+0]=la[ra+0],ba[Fa+1]=la[ra+1],ba[Fa+2]=la[ra+2],Z[Fa+0]=ia[ra+0],Z[Fa+
1]=ia[ra+1],Z[Fa+2]=ia[ra+2],ha[Fa+0]=-Ha*da[0],ha[Fa+1]=-Ha*da[1],ha[Fa+2]=-Ha*da[2],na[Ta]=0,ba[Ja+0]=la[ra+0]+ua*da[0],ba[Ja+1]=la[ra+1]+ua*da[1],ba[Ja+2]=la[ra+2]+ua*da[2],Z[Ja+0]=ia[ra+0],Z[Ja+1]=ia[ra+1],Z[Ja+2]=ia[ra+2],ha[Ja+0]=Ha*da[0],ha[Ja+1]=Ha*da[1],ha[Ja+2]=Ha*da[2],na[db]=ua,Fa+=3,Ja+=3,ra+=3,Ta+=1,db+=1;Fa=ra=0;Ja=3*ma;la=0>ua?ja:ea;ia=0>ua?ea:ja;for(qa=0;qa<Ia;++qa)Da[Fa+0]=ca[ra+la[0]],Da[Fa+1]=ca[ra+la[1]],Da[Fa+2]=ca[ra+la[2]],xa[Ja+0]=ca[ra+ia[0]]+va,xa[Ja+1]=ca[ra+ia[1]]+va,
xa[Ja+2]=ca[ra+ia[2]]+va,Fa+=3,Ja+=3,ra+=3}pa+=2*fa.count;ma=0;Q(ba,Z,na,ha,sa,fa.pathLengths[0],fa.count,pa,xa,ma,ua);pa+=4*fa.pathLengths[0];ma+=2*fa.pathLengths[0];sa+=fa.pathLengths[0];for(ca=1;ca<fa.pathLengths.length;++ca)Q(ba,Z,na,ha,sa,fa.pathLengths[ca],fa.count,pa,xa,ma,ua),pa+=4*fa.pathLengths[ca],ma+=2*fa.pathLengths[ca],sa+=fa.pathLengths[ca]}function O(la,ia,ca,fa,ba,Z,ha){fa[Z]=fa[ha];ha*=3;Z*=3;la[Z+0]=la[ha+0];la[Z+1]=la[ha+1];la[Z+2]=la[ha+2];ia[Z+0]=ia[ha+0];ia[Z+1]=ia[ha+1];ia[Z+
2]=ia[ha+2];ca[Z+0]=ba[0];ca[Z+1]=ba[1];ca[Z+2]=ba[2]}function Q(la,ia,ca,fa,ba,Z,ha,na,pa,xa,Da){let ua=ba,Fa=ba+1,qa=ba+ha,sa=ba+ha+1,ma=na,ra=na+1,va=na+2*Z;na=na+2*Z+1;0>Da&&(ua=ba+ha+1,sa=ba);xa*=3;for(let fb=0;fb<Z;++fb){fb===Z-1&&(0<Da?(Fa=ba,sa=ba+ha):(Fa=ba,ua=ba+ha));var Ia=la,Ja=ua,Ha=Fa,Ta=qa,db=N;Ja*=3;Ha*=3;Ta*=3;k.set(R,Ia[Ja++],Ia[Ja++],Ia[Ja++]);k.set(S,Ia[Ha++],Ia[Ha++],Ia[Ha++]);k.set(T,Ia[Ta++],Ia[Ta++],Ia[Ta++]);k.subtract(V,S,R);k.subtract(W,T,R);k.cross(db,W,V);k.normalize(db,
db);O(la,ia,fa,ca,N,ma,ua);O(la,ia,fa,ca,N,ra,Fa);O(la,ia,fa,ca,N,va,qa);O(la,ia,fa,ca,N,na,sa);pa[xa++]=ma;pa[xa++]=va;pa[xa++]=na;pa[xa++]=ma;pa[xa++]=na;pa[xa++]=ra;ua++;Fa++;qa++;sa++;ma+=2;ra+=2;va+=2;na+=2}}function J(la,ia,ca,fa){la=la.stageObject;const ba=la.geometryRecords,Z=ba.length,ha="absolute-height"!==ia.mode;let na=0;const pa=la.transformation,xa=f.invert(l.create(),pa);for(let ua=0;ua<Z;ua+=2){const Fa=ba[ua].geometry,qa=Fa.getMutableAttribute(H.VertexAttribute.POSITION).data,sa=
Fa.vertexAttributes.get(H.VertexAttribute.SIZE).data;var Da=Fa.vertexAttributes.get(H.VertexAttribute.MAPPOS).data;Da=new C.SamplePosition(Da);const ma=qa.length/3;let ra=0,va=!1,Ia=0;const Ja=ca.spatialReference;for(let Ha=0;Ha<ma;Ha++){U[0]=qa[ra];U[1]=qa[ra+1];U[2]=qa[ra+2];r.evaluateElevationInfoAtPoint(Da,ca,ia,fa,Y);ha&&(Ia+=Y.sampledElevation);D.TESTS_DISABLE_OPTIMIZATIONS?(k.set(aa,Da.array[Da.offset+0],Da.array[Da.offset+1],Y.z+sa[ra/3]),fa.toRenderCoords(aa,Ja,aa)):(k.set(aa,qa[ra+0],qa[ra+
1],qa[ra+2]),k.transformMat4(aa,aa,pa),fa.setAltitude(aa,Y.z+sa[ra/3]));k.transformMat4(aa,aa,xa);qa[ra]=aa[0];qa[ra+1]=aa[1];qa[ra+2]=aa[2];const Ta=.01/fa.unitInMeters;if(Math.abs(U[0]-qa[ra])>=Ta||Math.abs(U[1]-qa[ra+1])>=Ta||Math.abs(U[2]-qa[ra+2])>=Ta)va=!0;Da.offset+=3;ra+=3}va&&(Fa.invalidateBoundingInfo(),la.geometryVertexAttrsUpdated(ba[ua]),ba[ua+1].geometry.invalidateBoundingInfo(),la.geometryVertexAttrsUpdated(ba[ua+1]));na+=Ia/ma}return na/Z}const P=["polygon","extent"];E=function(la){function ia(fa,
ba,Z,ha){fa=la.call(this,fa,ba,Z,ha)||this;fa.ensureDrapedStatus(!1);return fa}b._inheritsLoose(ia,la);var ca=ia.prototype;ca.doLoad=function(){var fa=b._asyncToGenerator(function*(){if(!this._drivenProperties.size){var ba=y.validateSymbolLayerSize(this._getSymbolSize());if(ba)throw new c("graphics3dextrudesymbollayer:invalid-size",ba);}ba=g.get(this.symbolLayer,"material","color");var Z=this._getCombinedOpacityAndColor(ba);ba=e.fromArray(Z);Z=Z[3];const ha=1>Z||this.needsDrivenTransparentPass;ba=
{usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:ba,ambient:ba,opacity:Z,transparent:ha,cullFace:ha?F.CullFaceOptions.None:F.CullFaceOptions.Back,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new M.DefaultMaterial(ba);this._bottomMaterial=new M.DefaultMaterial({...ba,cullFace:F.CullFaceOptions.Back});this._context.stage.add(this._material);this._context.stage.add(this._bottomMaterial)});
return function(){return fa.apply(this,arguments)}}();ca.destroy=function(){la.prototype.destroy.call(this);this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))};ca.createGraphics3DGraphic=function(fa){const ba=fa.graphic;if(!this._validateGeometry(ba.geometry,P,this.symbolLayer.type))return null;const Z=this._getVertexOpacityAndColor(fa.renderingInfo,255),ha=this.setGraphicElevationContext(ba,new x.ElevationContext);return this._createAs3DShape(ba,
fa.renderingInfo,Z,ha,ba.uid)};ca.layerOpacityChanged=function(fa,ba){var Z=g.get(this.symbolLayer,"material","color");Z=this._getCombinedOpacity(Z);const ha=1>Z||this.needsDrivenTransparentPass;this._material.setParameters({opacity:Z,transparent:ha});this._bottomMaterial.setParameters({opacity:Z,transparent:ha});const na=this._getLayerOpacity();fa.forEach(pa=>{pa=ba(pa);g.isSome(pa)&&pa.layerOpacityChanged(na,this._context.isAsync)});return!0};ca.layerElevationInfoChanged=function(fa,ba){return this.updateGraphics3DGraphicElevationInfo(fa,
ba,r.needsElevationUpdates3D)};ca.slicePlaneEnabledChanged=function(fa,ba){this._material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled});this._bottomMaterial.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled});fa.forEach(Z=>{Z=ba(Z);g.isSome(Z)&&Z.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)});return!0};ca.physicalBasedRenderingChanged=function(){this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});
this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});return!0};ca.pixelRatioChanged=function(){return!0};ca._getExtrusionSize=function(fa){if(fa.size&&this._drivenProperties.size){var ba;fa=null!=(ba=q.getDriverAxisSizeValue(fa.size,2))?ba:0}else fa=this._getSymbolSize();return fa/=this._context.renderCoordsHelper.unitInMeters};ca.applyRendererDiff=function(fa,ba){return this._drivenPropertiesChanged(ba)?A.ApplyRendererDiffResult.Recreate_Symbol:
A.ApplyRendererDiffResult.Recreate_Graphics};ca._getSymbolSize=function(){var fa;return null!=(fa=this.symbolLayer.size)?fa:1};ca._createAs3DShape=function(fa,ba,Z,ha,na){var pa=p.geometryAsPolygon(fa.geometry);if(g.isNone(pa))return null;fa=p.geometryToRenderInfo(pa,this._context.elevationProvider,this._context.renderCoordsHelper,ha);this._logGeometryCreationWarnings(fa,pa.rings,"rings","ExtrudeSymbol3DLayer");if(0===pa.rings.length||!pa.rings.some(Aa=>0<Aa.length))return null;var xa=y.computeCentroid(pa);
if(g.isNone(xa))return null;var Da=[];const ua=[],Fa=[],qa=m.create(),sa=l.create(),ma=e.create(),ra=this._context.renderCoordsHelper.viewingMode===t.ViewingMode.Global;ra||this._context.renderCoordsHelper.worldUpAtPosition(null,ma);d.computeTranslationToOriginAndRotation(pa.spatialReference,[xa.x,xa.y,0],sa,this._context.renderCoordsHelper.spatialReference);pa=l.create();f.invert(pa,sa);xa=n.create();w.normalFromMat4(xa,pa);const {polygons:va,mapPosition:Ia,position:Ja}=fa;var Ha=Ja.length/3;const Ta=
new Float64Array(18*Ha),db=new Float64Array(18*Ha),fb=new Float64Array(18*Ha);Ha=new Float64Array(6*Ha);let ka=0;for(let Aa=0;Aa<va.length;++Aa){var cb=va[Aa];const Na=cb.count;if(this._context.clippingExtent&&(m.empty(qa),m.expandWithBuffer(qa,cb.mapPosition),!m.intersectsClippingArea(qa,this._context.clippingExtent)))continue;const Ua=h.earcut(cb.mapPosition,cb.holeIndices,3);if(0===Ua.length)continue;const Ya=new Uint32Array(6*Na+Ua.length);var Ca=new Uint32Array(Ua.length),Ka=6*Na,Oa=3*Ta.BYTES_PER_ELEMENT;
Oa=new z.BufferViewVec3f64(Ta.buffer,ka*Oa,Oa,(ka+Ka)*Oa);var wa=3*db.BYTES_PER_ELEMENT;wa=new z.BufferViewVec3f64(db.buffer,ka*wa,wa,(ka+Ka)*wa);const ya=new Float64Array(fb.buffer,3*ka*fb.BYTES_PER_ELEMENT,3*Ka);Ka=new Float64Array(Ha.buffer,1*ka*Ha.BYTES_PER_ELEMENT,1*Ka);const La=this._getExtrusionSize(ba);I(Ja,Ia,Ua,cb,Oa.typedBuffer,ya,wa.typedBuffer,Ka,0,Ya,Ca,La,ma,ra);v.transformMat4(Oa,Oa,pa);v.transformMat3(wa,wa,xa);ka+=6*Na;cb=K(Ya,Ya.length-Ca.length,{positions:Oa.typedBuffer,elevation:ya,
normals:wa.typedBuffer,heights:Ka},Z);Da.push(cb);ua.push(this._material);Fa.push(l.IDENTITY);Ca=K(Ca,0,{positions:Oa.typedBuffer,elevation:ya,normals:wa.typedBuffer,heights:Ka},Z);Da.push(Ca);ua.push(this._bottomMaterial);Fa.push(l.IDENTITY)}if(0===Da.length)return null;ba=new L.Object3D({geometries:Da,materials:ua,transformations:Fa,metadata:{layerUid:this._context.layer.uid,graphicUid:na,isElevationSource:!0}});ba.transformation=sa;Z=B.createMaterial(this.symbolLayer,{opacity:this._getLayerOpacity()});
Z=g.isSome(Z)?{baseMaterial:this._material,edgeMaterials:[Z],properties:{mergeGeometries:!0,slicePlaneEnabled:this._context.slicePlaneEnabled}}:null;Da=new u.Graphics3DObject3DGraphicLayer(this,ba,Da,null,null,J,ha,Z);Da.alignedSampledElevation=fa.sampledElevation;Da.needsElevationUpdates=r.needsElevationUpdates3D(ha.mode);return Da};return ia}(E.Graphics3DSymbolLayer);const N=e.create(),R=e.create(),S=e.create(),T=e.create(),V=e.create(),W=e.create(),U=e.create(),aa=e.create(),da=e.create(),Y=new r.SampleElevationInfo,
ea=[0,2,1],ja=[0,1,2];a.Graphics3DExtrudeSymbolLayer=E;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/earcut":function(){define(["exports"],function(a){var b={exports:{}};(function(c){(function(g){g=g();void 0!==g&&(c.exports=g)})(function(){function g(D,C,F){F=F||2;var G=C&&C.length,L=G?C[0]*F:D.length,H=h(D,0,L,F,!0),M=[];if(!H||H.next===H.prev)return M;var K;if(G){var I=H;var O=F;H=[];var Q;G=0;for(Q=C.length;G<Q;G++){var J=C[G]*O;var P=G<Q-1?C[G+1]*O:D.length;J=h(D,J,P,O,!1);
J===J.next&&(J.steiner=!0);H.push(m(J))}H.sort(l);for(G=0;G<H.length;G++)O=H[G],C=I,(I=e(O,C))?(Q=E(I,O),O=w(I,I.next),Q=k(Q),w(Q,Q.next),O=k(O),I=k(C===I?O:C)):I=C,I=w(I,I.next);H=I}if(D.length>80*F){var N=K=D[0];var R=G=D[1];for(O=F;O<L;O+=F)C=D[O],I=D[O+1],C<N&&(N=C),I<R&&(R=I),C>K&&(K=C),I>G&&(G=I);K=Math.max(K-N,G-R);K=0!==K?1/K:0}n(H,M,F,N,R,K);return M}function h(D,C,F,G,L){if(L===0<B(D,C,F,G))for(L=C;L<F;L+=G)var H=y(L,D[L],D[L+1],H);else for(L=F-G;L>=C;L-=G)H=y(L,D[L],D[L+1],H);H&&q(H,H.next)&&
(D=H.next,A(H),H=D);return H}function w(D,C){if(!D)return D;C||(C=D);do{var F=!1;if(D.steiner||!q(D,D.next)&&0!==v(D.prev,D,D.next))D=D.next;else{C=D.prev;A(D);D=C;if(D===D.next)break;F=!0}}while(F||D!==C);return C}function n(D,C,F,G,L,H,M){if(D){if(!M&&H){var K=D,I=K;do null===I.z&&(I.z=d(I.x,I.y,G,L,H)),I.prevZ=I.prev,I=I.nextZ=I.next;while(I!==K);I.prevZ.nextZ=null;I.prevZ=null;K=I;var O,Q,J,P,N=1;do{I=K;var R=K=null;for(Q=0;I;){Q++;var S=I;for(O=J=0;O<N&&(J++,S=S.nextZ,S);O++);for(P=N;0<J||0<
P&&S;)0!==J&&(0===P||!S||I.z<=S.z)?(O=I,I=I.nextZ,J--):(O=S,S=S.nextZ,P--),R?R.nextZ=O:K=O,O.prevZ=R,R=O;I=S}R.nextZ=null;N*=2}while(1<Q)}for(K=D;D.prev!==D.next;){I=D.prev;S=D.next;if(H)R=f(D,G,L,H);else a:if(R=D,Q=R.prev,J=R,N=R.next,0<=v(Q,J,N))R=!1;else{for(O=R.next.next;O!==R.prev;){if(z(Q.x,Q.y,J.x,J.y,N.x,N.y,O.x,O.y)&&0<=v(O.prev,O,O.next)){R=!1;break a}O=O.next}R=!0}if(R)C.push(I.i/F),C.push(D.i/F),C.push(S.i/F),A(D),K=D=S.next;else if(D=S,D===K){if(!M)n(w(D),C,F,G,L,H,1);else if(1===M){D=
w(D);M=C;K=F;I=D;do S=I.prev,R=I.next.next,!q(S,R)&&t(S,I,I.next,R)&&u(S,R)&&u(R,S)&&(M.push(S.i/K),M.push(I.i/K),M.push(R.i/K),A(I),A(I.next),I=D=R),I=I.next;while(I!==D);D=w(I);n(D,C,F,G,L,H,2)}else if(2===M)a:{M=D;do{for(K=M.next.next;K!==M.prev;){if(I=M.i!==K.i){R=R=R=R=void 0;I=M;S=K;if(R=I.next.i!==S.i&&I.prev.i!==S.i){b:{R=I;do{if(R.i!==I.i&&R.next.i!==I.i&&R.i!==S.i&&R.next.i!==S.i&&t(R,R.next,I,S)){R=!0;break b}R=R.next}while(R!==I);R=!1}R=!R}if(R){if(R=u(I,S)&&u(S,I)){R=I;Q=!1;J=(I.x+S.x)/
2;N=(I.y+S.y)/2;do R.y>N!==R.next.y>N&&R.next.y!==R.y&&J<(R.next.x-R.x)*(N-R.y)/(R.next.y-R.y)+R.x&&(Q=!Q),R=R.next;while(R!==I);R=Q}R=R&&(v(I.prev,I,S.prev)||v(I,S.prev,S))||q(I,S)&&0<v(I.prev,I,I.next)&&0<v(S.prev,S,S.next)}I=R}if(I){D=E(M,K);M=w(M,M.next);D=w(D,D.next);n(M,C,F,G,L,H);n(D,C,F,G,L,H);break a}K=K.next}M=M.next}while(M!==D)}break}}}}function f(D,C,F,G){var L=D.prev,H=D.next;if(0<=v(L,D,H))return!1;var M=L.x>D.x?L.x>H.x?L.x:H.x:D.x>H.x?D.x:H.x,K=L.y>D.y?L.y>H.y?L.y:H.y:D.y>H.y?D.y:
H.y,I=d(L.x<D.x?L.x<H.x?L.x:H.x:D.x<H.x?D.x:H.x,L.y<D.y?L.y<H.y?L.y:H.y:D.y<H.y?D.y:H.y,C,F,G);C=d(M,K,C,F,G);F=D.prevZ;for(G=D.nextZ;F&&F.z>=I&&G&&G.z<=C;){if(F!==D.prev&&F!==D.next&&z(L.x,L.y,D.x,D.y,H.x,H.y,F.x,F.y)&&0<=v(F.prev,F,F.next))return!1;F=F.prevZ;if(G!==D.prev&&G!==D.next&&z(L.x,L.y,D.x,D.y,H.x,H.y,G.x,G.y)&&0<=v(G.prev,G,G.next))return!1;G=G.nextZ}for(;F&&F.z>=I;){if(F!==D.prev&&F!==D.next&&z(L.x,L.y,D.x,D.y,H.x,H.y,F.x,F.y)&&0<=v(F.prev,F,F.next))return!1;F=F.prevZ}for(;G&&G.z<=C;){if(G!==
D.prev&&G!==D.next&&z(L.x,L.y,D.x,D.y,H.x,H.y,G.x,G.y)&&0<=v(G.prev,G,G.next))return!1;G=G.nextZ}return!0}function l(D,C){return D.x-C.x}function k(D){if(D.next.prev===D)return D;let C=D;do{const F=C.next;if(F.prev===C||F===C||F===D)break;C=F}while(1);return C}function e(D,C){var F=C,G=D.x,L=D.y,H=-Infinity;do{if(L<=F.y&&L>=F.next.y&&F.next.y!==F.y){var M=F.x+(L-F.y)*(F.next.x-F.x)/(F.next.y-F.y);if(M<=G&&M>H){H=M;if(M===G){if(L===F.y)return F;if(L===F.next.y)return F.next}var K=F.x<F.next.x?F:F.next}}F=
F.next}while(F!==C);if(!K)return null;if(G===H)return K;C=K;M=K.x;var I=K.y,O=Infinity;F=K;do{if(G>=F.x&&F.x>=M&&G!==F.x&&z(L<I?G:H,L,M,I,L<I?H:G,L,F.x,F.y)){var Q=Math.abs(L-F.y)/(G-F.x);var J;if((J=u(F,D))&&!(J=Q<O)&&(J=Q===O)&&!(J=F.x>K.x)&&(J=F.x===K.x)){J=K;var P=F;J=0>v(J.prev,J,P.prev)&&0>v(P.next,J,J.next)}J&&(K=F,O=Q)}F=F.next}while(F!==C);return K}function d(D,C,F,G,L){D=32767*(D-F)*L;C=32767*(C-G)*L;D=(D|D<<8)&16711935;D=(D|D<<4)&252645135;D=(D|D<<2)&858993459;C=(C|C<<8)&16711935;C=(C|
C<<4)&252645135;C=(C|C<<2)&858993459;return(D|D<<1)&1431655765|((C|C<<1)&1431655765)<<1}function m(D){var C=D,F=D;do{if(C.x<F.x||C.x===F.x&&C.y<F.y)F=C;C=C.next}while(C!==D);return F}function z(D,C,F,G,L,H,M,K){return 0<=(L-M)*(C-K)-(D-M)*(H-K)&&0<=(D-M)*(G-K)-(F-M)*(C-K)&&0<=(F-M)*(H-K)-(L-M)*(G-K)}function v(D,C,F){return(C.y-D.y)*(F.x-C.x)-(C.x-D.x)*(F.y-C.y)}function q(D,C){return D.x===C.x&&D.y===C.y}function t(D,C,F,G){var L=x(v(D,C,F)),H=x(v(D,C,G)),M=x(v(F,G,D)),K=x(v(F,G,C));return L!==H&&
M!==K||0===L&&r(D,F,C)||0===H&&r(D,G,C)||0===M&&r(F,D,G)||0===K&&r(F,C,G)?!0:!1}function r(D,C,F){return C.x<=Math.max(D.x,F.x)&&C.x>=Math.min(D.x,F.x)&&C.y<=Math.max(D.y,F.y)&&C.y>=Math.min(D.y,F.y)}function x(D){return 0<D?1:0>D?-1:0}function u(D,C){return 0>v(D.prev,D,D.next)?0<=v(D,C,D.next)&&0<=v(D,D.prev,C):0>v(D,C,D.prev)||0>v(D,D.next,C)}function E(D,C){var F=new p(D.i,D.x,D.y),G=new p(C.i,C.x,C.y),L=D.next,H=C.prev;D.next=C;C.prev=D;F.next=L;L.prev=F;G.next=F;F.prev=G;H.next=G;G.prev=H;return G}
function y(D,C,F,G){D=new p(D,C,F);G?(D.next=G.next,D.prev=G,G.next.prev=D,G.next=D):(D.prev=D,D.next=D);return D}function A(D){D.next.prev=D.prev;D.prev.next=D.next;D.prevZ&&(D.prevZ.nextZ=D.nextZ);D.nextZ&&(D.nextZ.prevZ=D.prevZ)}function p(D,C,F){this.i=D;this.x=C;this.y=F;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function B(D,C,F,G){for(var L=0,H=F-G;C<F;C+=G)L+=(D[H]-D[C])*(D[C+1]+D[H+1]),H=C;return L}g.deviation=function(D,C,F,G){var L=C&&C.length,H=Math.abs(B(D,
0,L?C[0]*F:D.length,F));if(L){L=0;for(var M=C.length;L<M;L++)H-=Math.abs(B(D,C[L]*F,L<M-1?C[L+1]*F:D.length,F))}for(L=C=0;L<G.length;L+=3){M=G[L]*F;var K=G[L+1]*F,I=G[L+2]*F;C+=Math.abs((D[M]-D[I])*(D[K+1]-D[M+1])-(D[M]-D[K])*(D[I+1]-D[M+1]))}return 0===H&&0===C?0:Math.abs((C-H)/H)};g.flatten=function(D){for(var C=D[0][0].length,F={vertices:[],holes:[],dimensions:C},G=0,L=0;L<D.length;L++){for(var H=0;H<D[L].length;H++)for(var M=0;M<C;M++)F.vertices.push(D[L][H][M]);0<L&&(G+=D[L-1].length,F.holes.push(G))}return F};
return g})})(b);a.earcut=b.exports})},"esri/chunks/vec32":function(){define(["exports","../geometry/support/buffer/math/common"],function(a,b){function c(l,k,e){if(l.count!==k.count)b.mathLogger.error("source and destination buffers need to have the same number of elements");else{var d=l.count,m=e[0],z=e[1],v=e[2],q=e[4],t=e[5],r=e[6],x=e[8],u=e[9],E=e[10],y=e[12],A=e[13];e=e[14];var p=l.typedBuffer;l=l.typedBufferStride;var B=k.typedBuffer;k=k.typedBufferStride;for(let C=0;C<d;C++){const F=C*l;var D=
C*k;const G=B[D],L=B[D+1];D=B[D+2];p[F]=m*G+q*L+x*D+y;p[F+1]=z*G+t*L+u*D+A;p[F+2]=v*G+r*L+E*D+e}}}function g(l,k,e){if(l.count!==k.count)b.mathLogger.error("source and destination buffers need to have the same number of elements");else{var d=l.count,m=e[0],z=e[1],v=e[2],q=e[3],t=e[4],r=e[5],x=e[6],u=e[7];e=e[8];var E=l.typedBuffer;l=l.typedBufferStride;var y=k.typedBuffer;k=k.typedBufferStride;for(let p=0;p<d;p++){const B=p*l;var A=p*k;const D=y[A],C=y[A+1];A=y[A+2];E[B]=m*D+q*C+x*A;E[B+1]=z*D+t*
C+u*A;E[B+2]=v*D+r*C+e*A}}}function h(l,k,e){const d=Math.min(l.count,k.count),m=l.typedBuffer;l=l.typedBufferStride;const z=k.typedBuffer;k=k.typedBufferStride;for(let v=0;v<d;v++){const q=v*l,t=v*k;m[q]=e*z[t];m[q+1]=e*z[t+1];m[q+2]=e*z[t+2]}}function w(l,k){const e=Math.min(l.count,k.count),d=l.typedBuffer;l=l.typedBufferStride;const m=k.typedBuffer;k=k.typedBufferStride;for(let q=0;q<e;q++){const t=q*l;var z=q*k;const r=m[z],x=m[z+1];z=m[z+2];var v=Math.sqrt(r*r+x*x+z*z);0<v&&(v=1/v,d[t]=v*r,
d[t+1]=v*x,d[t+2]=v*z)}}function n(l,k,e){const d=Math.min(l.count,k.count),m=l.typedBuffer;l=l.typedBufferStride;const z=k.typedBuffer;k=k.typedBufferStride;for(let v=0;v<d;v++){const q=v*l,t=v*k;m[q]=z[t]>>e;m[q+1]=z[t+1]>>e;m[q+2]=z[t+2]>>e}}const f=Object.freeze({__proto__:null,transformMat4:c,transformMat3:g,scale:h,normalize:w,shiftRight:n});a.normalize=w;a.scale=h;a.shiftRight=n;a.transformMat3=g;a.transformMat4=c;a.vec3=f})},"esri/geometry/support/buffer/math/common":function(){define(["exports",
"../../../../core/Logger"],function(a,b){b=b.getLogger("esri.views.3d.support.buffer.math");a.mathLogger=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/support/renderingInfoUtils":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../Color","../../core/maybe","../visualVariables/support/visualVariableUtils"],function(a,b,c,g,h){function w(k,e){if(!k||k.symbol)return null;e=e&&e.renderer;return k&&g.isSome(e)&&e.getObservationRenderer?e.getObservationRenderer(k):
e}function n(k,e){return f.apply(this,arguments)}function f(){f=b._asyncToGenerator(function*(k,e){if(g.isSome(k.symbol))return k.symbol;const d=w(k,e);return g.isSome(d)&&d.getSymbolAsync(k,{...e,abortOptions:{signal:e.signal}})});return f.apply(this,arguments)}function l(){l=b._asyncToGenerator(function*(k,e){var d=w(k,e),m=yield n(k,e);if(!m)return null;m={renderer:d,symbol:m};if(!(d&&"visualVariables"in d&&d.visualVariables))return m;e=h.getVisualVariableValues(d,k,e);k=["proportional","proportional",
"proportional"];for(const {variable:z,value:v}of e)"color"===z.type?m.color=c.toUnitRGBA(v):"size"===z.type?"outline"===z.target?m.outlineSize=v:(e=z.axis,d=z.useSymbolValue?"symbol-value":v,"width"===e?k[0]=d:"depth"===e?k[1]=d:"height"===e?k[2]=d:k[0]="width-and-depth"===e?k[1]=d:k[1]=k[2]=d):"opacity"===z.type?m.opacity=v:"rotation"===z.type&&"tilt"===z.axis?m.tilt=v:"rotation"===z.type&&"roll"===z.axis?m.roll=v:"rotation"===z.type&&(m.heading=v);if(isFinite(k[0])||isFinite(k[1])||isFinite(k[2]))m.size=
k;return m});return l.apply(this,arguments)}a.getDriverAxisSizeValue=function(k,e=0){k=k[e];return"number"===typeof k&&isFinite(k)?k:null};a.getDriverAxisSizeValueAny=function(k){for(let e=0;3>e;e++){const d=k[e];if("number"===typeof d)return isFinite(d)?d:0}return 0};a.getRenderer=w;a.getRenderingInfo=function(k,e){const d=w(k,e);if(g.isSome(k.symbol))var m=k.symbol;else m=w(k,e),m=g.isSome(m)&&"dot-density"!==m.type?m.getSymbol(k,e):null;if(g.isNone(m))return null;m={renderer:d,symbol:m};if(g.isNone(d)||
!("visualVariables"in d)||!d.visualVariables)return m;e=h.getVisualVariableValues(d,k,e);k=["proportional","proportional","proportional"];for(const {variable:z,value:v}of e)switch(z.type){case "color":m.color=v.toRgba();break;case "size":if("outline"===z.target)m.outlineSize=v;else switch(e=z.useSymbolValue?"symbol-value":v,z.axis){case "width":k[0]=e;break;case "depth":k[1]=e;break;case "height":k[2]=e;break;case "width-and-depth":k[0]=k[1]=e;break;default:k[0]=k[1]=k[2]=e}break;case "opacity":m.opacity=
v;break;case "rotation":switch(z.axis){case "tilt":m.tilt=v;break;case "roll":m.roll=v;break;default:m.heading=v}}if("proportional"!==k[0]||"proportional"!==k[1]||"proportional"!==k[2])m.size=k;return m};a.getRenderingInfoAsync=function(k,e){return l.apply(this,arguments)};a.getSymbolAsync=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/polygonUtils":function(){define("exports ../../../../geometry ../../../../core/maybe ../../../../geometry/projection ../../../../geometry/support/triangulationUtils ./elevationAlignmentUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute ../../../../geometry/Extent ../../../../geometry/Polygon".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){function d(z,v,q){const t=[];for(const {index:r,count:x}of z){if(1>=x)continue;z=3*r;const u=z+3*x;t.push({index:r,count:x,position:v.subarray(z,u),mapPosition:q?q.subarray(z,u):void 0})}return t}function m(z,v,q){const t=[];for(const {index:r,count:x,holeIndices:u,pathLengths:E}of z){if(1>=x)continue;z=3*r;const y=z+3*x,A=u.map(p=>p-r);t.push({index:r,count:x,holeIndices:A,pathLengths:E,position:v.subarray(z,y),mapPosition:q?q.subarray(z,y):void 0})}return t}a.createColorGeometry=
function(z){const v=[[l.VertexAttribute.POSITION,z.indices]],q=[[l.VertexAttribute.POSITION,{size:3,data:z.attributeData.position,exclusive:!0}]];c.isSome(z.attributeData.color)&&(q.push([l.VertexAttribute.COLOR,{size:4,data:z.attributeData.color,exclusive:!0}]),v.push([l.VertexAttribute.COLOR,new Uint32Array(z.indices.length)]));c.isSome(z.attributeData.uvMapSpace)&&(q.push([l.VertexAttribute.UVMAPSPACE,{size:4,data:z.attributeData.uvMapSpace,exclusive:!0}]),v.push([l.VertexAttribute.UVMAPSPACE,
z.indices]));c.isSome(z.attributeData.boundingRect)&&(q.push([l.VertexAttribute.BOUNDINGRECT,{size:9,data:z.attributeData.boundingRect,exclusive:!0}]),v.push([l.VertexAttribute.BOUNDINGRECT,z.indices]));c.isSome(z.attributeData.mapPosition)&&(q.push([l.VertexAttribute.MAPPOS,{size:3,data:z.attributeData.mapPosition,exclusive:!0}]),v.push([l.VertexAttribute.MAPPOS,z.indices]));return new f.Geometry(q,v)};a.createWaterGeometry=function(z){const v=[[l.VertexAttribute.POSITION,z.indices],[l.VertexAttribute.UV0,
z.indices]],q=[[l.VertexAttribute.POSITION,{size:3,data:z.attributeData.position,exclusive:!0}],[l.VertexAttribute.UV0,{size:2,data:z.attributeData.uv0,exclusive:!0}]];c.isSome(z.attributeData.mapPosition)&&(q.push([l.VertexAttribute.MAPPOS,{size:3,data:z.attributeData.mapPosition,exclusive:!0}]),v.push([l.VertexAttribute.MAPPOS,z.indices]));return new f.Geometry(q,v)};a.geometryAsPolygon=function(z){switch(z.type){case "extent":if(z instanceof k)return e.fromExtent(z);break;case "polygon":return z}return null};
a.geometryToRenderInfo=function(z,v,q,t){const r=h.pathsToTriangulationInfo(z.rings,z.hasZ,h.CounterClockwiseMode.CCW_IS_HOLE),x=new Float64Array(r.position.length);z=w.applyPerVertexElevationAlignment(r.position,z.spatialReference,0,x,0,r.position,0,r.position.length/3,v,q,t);v=null!=z;return{position:r.position,mapPosition:x,polygons:m(r.polygons,r.position,x),outlines:d(r.outlines,r.position,x),projectionSuccess:v,sampledElevation:z}};a.geometryToRenderInfoDraped=function(z,v){const q=h.pathsToTriangulationInfo(z.rings,
!1,h.CounterClockwiseMode.CCW_IS_HOLE);z=g.projectBuffer(q.position,z.spatialReference,0,q.position,v,0,q.position.length/3);for(v=2;v<q.position.length;v+=3)q.position[v]=n.DRAPED_Z;return{position:q.position,polygons:m(q.polygons,q.position),outlines:d(q.outlines,q.position),projectionSuccess:z}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/triangulationUtils":function(){define(["exports","../../chunks/earcut","./coordsUtils","./meshUtils/deduplicate"],function(a,b,
c,g){function h(f,l,k){if(1===f.length)return f[0];l=new Float64Array(l);k=new Uint32Array(k);let e=0,d=0,m=0;for(const z of f){for(f=0;f<z.position.length;f++)l[e++]=z.position[f];for(f=0;f<z.faces.length;f++)k[d++]=z.faces[f]+m;m=e/3}return{position:l,faces:k}}function w(f,l,k){const e=f.length,d=Array(e),m=Array(e),z=Array(e);let v=0,q=0,t=0;var r=0;for(var x=0;x<e;++x)r+=f[x].length;r=new Float64Array(3*r);x=0;for(let A=e-1;0<=A;A--){var u=f[A],E=k===a.CounterClockwiseMode.CCW_IS_HOLE?!c.isClockwise(u,
!1,!1):!1;if(E&&1!==e)d[v++]=u;else{var y=u.length;for(let p=0;p<v;++p)y+=d[p].length;y={index:x,pathLengths:Array(v+1),count:y,holeIndices:Array(v)};y.pathLengths[0]=u.length;0<u.length&&(z[t++]={index:x,count:u.length});x=E?n(u,u.length-1,-1,r,x,u.length,l):n(u,0,1,r,x,u.length,l);for(u=0;u<v;++u)E=d[u],y.holeIndices[u]=x,y.pathLengths[u+1]=E.length,0<E.length&&(z[t++]={index:x,count:E.length}),x=n(E,0,1,r,x,E.length,l);v=0;0<y.count&&(m[q++]=y)}}for(f=0;f<v;++f)k=d[f],0<k.length&&(z[t++]={index:x,
count:k.length}),x=n(k,0,1,r,x,k.length,l);q<e&&(m.length=q);t<e&&(z.length=t);return{position:r,polygons:m,outlines:z}}function n(f,l,k,e,d,m,z){d*=3;for(let v=0;v<m;++v){const q=f[l];e[d++]=q[0];e[d++]=q[1];e[d++]=z?q[2]:0;l+=k}return d/3}a.CounterClockwiseMode=void 0;(function(f){f[f.NONE=0]="NONE";f[f.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(a.CounterClockwiseMode||(a.CounterClockwiseMode={}));a.pathsToTriangulationInfo=w;a.triangulate=function(f){f=w(f.rings,f.hasZ,a.CounterClockwiseMode.CCW_IS_HOLE);
const l=[];let k=0,e=0;for(var d of f.polygons){const z=d.index,v=new Float64Array(f.position.buffer,3*z*f.position.BYTES_PER_ELEMENT,3*d.count);var m=d.holeIndices.map(q=>q-z);m=new Uint32Array(b.earcut(v,m,3));l.push({position:v,faces:m});k+=v.length;e+=m.length}d=h(l,k,e);f=g.deduplicate(d.position.buffer,6,{originalIndices:d.faces});d.position=new Float64Array(f.buffer);d.faces=f.indices;return d};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/meshUtils/deduplicate":function(){define(["exports",
"../../../core/mathUtils"],function(a,b){let c=null;a.deduplicate=function(g,h,w){var n,f=g.byteLength/(4*h),l=new Uint32Array(g,0,f*h);g=new Uint32Array(f);var k=null!=(n=null==w?void 0:w.minReduction)?n:0;const e=(n=(null==w?void 0:w.originalIndices)||null)?n.length:0;var d=(null==w?void 0:w.componentOffsets)||null;w=0;if(d)for(var m=0;m<d.length-1;m++){var z=d[m+1]-d[m];z>w&&(w=z)}else w=f;var v=Math.floor(1.1*w)+1;if(null==c||c.length<2*v)c=new Uint32Array(b.nextHighestPowerOfTwo(2*v));for(w=
0;w<2*v;w++)c[w]=0;w=0;z=(m=!!d&&!!n)?e:f;var q=m?new Uint32Array(e):null,t=0!==k?Math.ceil(7.84*1.96/(k*k)*k*(1-k)):z,r=1,x=d?d[1]:z;for(var u=0;u<z;u++){if(u===t){var E=1-w/u;if(E+1.96*Math.sqrt(E*(1-E)/u)<k)return null;t*=2}if(u===x){for(x=0;x<2*v;x++)c[x]=0;if(n)for(x=d[r-1];x<d[r];x++)q[x]=g[n[x]];x=d[++r]}E=m?n[u]:u;const B=E*h;var y=0;for(var A=0;A<h;A++)y=l[B+A]+y|0,y=y+(y<<11)+(y>>>2)|0;y>>>=0;A=y%v;let D=w;for(;0!==c[2*A+1];){if(c[2*A]===y){const C=c[2*A+1]-1;var p=C*h;a:{for(let F=0;F<
h;F++)if(l[B+F]!==l[p+F]){p=!1;break a}p=!0}if(p){D=g[C];break}}A++;A>=v&&(A-=v)}D===w&&(c[2*A]=y,c[2*A+1]=E+1,w++);g[E]=D}if(0!==k&&1-w/f<k)return null;if(m){for(f=d[r-1];f<q.length;f++)q[f]=g[n[f]];g=q}f=new Uint32Array(h*w);w=0;for(r=0;r<z;r++)if(g[r]===w){k=l;d=(m?n[r]:r)*h;v=f;q=w*h;t=h;for(u=0;u<t;u++)v[q+u]=k[d+u];w++}if(n&&!m){h=new Uint32Array(e);for(l=0;l<h.length;l++)h[l]=g[n[l]];g=h}return{buffer:f.buffer,indices:g,uniqueCount:w}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/OverlayRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/Handles ../../../core/Logger ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/SetUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/vec2f64 ../../../chunks/vec3f64 ../../../chunks/mat4f64 ../../ViewingMode ../layers/interfaces ../support/debugFlags ./interfaces ./Overlay ./OverlayFramebufferObject ./OverlayRenderTarget ../webgl-engine/core/shaderTechnique/ShaderTechniqueRepository ../webgl-engine/lib/AutoDisposable ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/Camera ../webgl-engine/lib/DrapedHeatmapRenderer ../webgl-engine/lib/GLMaterialRepository ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/GridLocalOriginFactory ../webgl-engine/lib/Intersector ../webgl-engine/lib/IntersectorInterfaces ../webgl-engine/lib/Material ../webgl-engine/lib/ModelDirtyTypes ../webgl-engine/lib/RenderContext ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/lib/TextureTechnique ../webgl-engine/lighting/Lightsources ../webgl-engine/lighting/SceneLighting ../webgl-engine/materials/StippleTextureRepository ../../../chunks/Compositing.glsl ../webgl-engine/shaders/CompositingTechnique ../../support/Scheduler ../../webgl/enums ../../webgl/Texture ../../webgl/Util".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H,M,K,I,O,Q,J,P,N,R,S,T,V,W,U,aa,da,Y,ea,ja,la,ia,ca,fa){function ba(Fa,qa,sa,ma,ra,va,Ia){const Ja={layerUid:va,graphicUid:Ia,triangleNr:qa};qa=Ha=>{Ha.set(P.IntersectorType.OVERLAY,Ja,Fa.dist,Fa.normal,Fa.transformation,sa,ma)};(null==ra.results.min.drapedLayerOrder||sa>=ra.results.min.drapedLayerOrder)&&(null==ra.results.min.dist||ra.results.ground.dist<=ra.results.min.dist)&&qa(ra.results.min);ra.options.store!==P.StoreResults.MIN&&
(null==ra.results.max.drapedLayerOrder||sa<ra.results.max.drapedLayerOrder)&&(null==ra.results.max.dist||ra.results.ground.dist>ra.results.max.dist)&&qa(ra.results.max);ra.options.store===P.StoreResults.ALL&&(va=J.newIntersectorResult(ra.ray),qa(va),ra.results.all.push(va))}const Z=n.getLogger("esri.views.3d.webgl-engine.lib.OverlayRenderer");a.OverlayRenderer=function(Fa){function qa(ma){ma=Fa.call(this,ma)||this;ma._overlays=null;ma._overlayRenderTarget=null;ma._hasHighlights=!1;ma._rendersOccluded=
!1;ma._hasWater=!1;ma._lighting=new da.SceneLighting;ma._handles=new w;ma._frameTask=la.ImmediateTask;ma._layerRenderers=new Map;ma._sortedLayerRenderersDirty=!1;ma._sortedLayerRenderers=new k;ma._geometries=new Map;ma.worldToPCSRatio=1;ma.events=new h;ma.longitudeCyclical=null;return ma}b._inheritsLoose(qa,Fa);var sa=qa.prototype;sa.initialize=function(){const ma=this.view._stage.renderView;this._rctx=ma.renderingContext;this._renderContext=new S.OverlayRenderContext(this._rctx);const ra=ma.waterTextureRepository;
this._stippleTextureRepository=new Y.StippleTextureRepository(ma.renderingContext);this._shaderTechniqueRepository=new G.ShaderTechniqueRepository({rctx:this._rctx,viewingMode:y.ViewingMode.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:ra});this._handles.add([d.init(ra,"loadingState",()=>this.events.emit("content-changed")),d.init(this,"spatialReference",va=>this._localOrigins=new Q.GridLocalOriginFactory(va))]);this._materialRepository=new I.GLMaterialRepository(ma.textureRepository,
this._shaderTechniqueRepository,va=>{0<(va.renderOccluded&ua)!==this._rendersOccluded&&this._updateRendersOccluded();this.events.emit("content-changed");this.notifyChange("updating")},()=>this.events.emit("content-changed"));this._lighting.groundLightingFactor=1;this._lighting.globalFactor=0;this._lighting.set([new aa.AmbientLight(u.fromValues(1,1,1))]);this._bindParameters={slot:V.RenderSlot.DRAPED_MATERIAL,highlightDepthTexture:O.createEmptyDepthTexture(this._rctx),camera:pa,inverseViewport:x.create(),
origin:null,screenToWorldRatio:null,screenToPCSRatio:null,shadowMappingEnabled:!1,slicePlane:null,ssaoEnabled:!1,hasOccludees:!1,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMatrix:E.IDENTITY,ssrEnabled:!1,lighting:this._lighting,transparencyPassType:H.TransparencyPassType.NONE,terrainLinearDepthTexture:null,geometryLinearDepthTexture:null,multipassTerrainEnabled:!1,cullAboveGround:!1,multipassGeometryEnabled:!1,highlightColorTexture:null,cloudsCompositionParams:null,hasFillLights:!0};
this._frameTask=this.view.resourceController.scheduler.registerTask(la.TaskPriority.STAGE,this);this._handles.add(this._frameTask)};sa.dispose=function(){this._handles.destroy();this._layerRenderers.forEach(ma=>ma.destroy());this._layerRenderers.clear();this._debugTextureTechnique=l.releaseMaybe(this._debugTextureTechnique);this._debugPatternTexture=l.disposeMaybe(this._debugPatternTexture);this._bindParameters.highlightDepthTexture=l.disposeMaybe(this._bindParameters.highlightDepthTexture);this._shaderTechniqueRepository=
l.disposeMaybe(this._shaderTechniqueRepository);this._temporaryFBO=l.disposeMaybe(this._temporaryFBO);this._quadVAO=l.disposeMaybe(this._quadVAO);this.disposeOverlays()};sa.collectUnusedRenderTargetMemory=function(ma){let ra=!1;if(l.isSome(this._overlayRenderTarget))for(const va of this._overlayRenderTarget.renderTargets)ra=this._overlayRenderTarget.validateUsageForTarget(this.overlays[0].validTargets[va.type]||!this.overlays[1].validTargets[va.type],va,ma)||ra;return ra};sa.ensureDrapeTargets=function(ma){l.isSome(this._overlays)&&
this._overlays.forEach(ra=>{ra.hasTargetWithoutRasterImage=e.someSet(ma,va=>va.drapeTargetType===A.DrapeTargetType.WithoutRasterImage)})};sa.ensureDrapeSources=function(ma){l.isSome(this._overlays)&&this._overlays.forEach(ra=>{ra.hasDrapedFeatureSource=f.someMap(ma,(va,Ia)=>Ia.drapeSourceType===A.DrapeSourceType.Features);ra.hasDrapedRasterSource=f.someMap(ma,(va,Ia)=>Ia.drapeSourceType===A.DrapeSourceType.RasterImage)})};sa.ensureOverlays=function(ma,ra){l.isNone(this._overlays)&&(this._overlayRenderTarget=
new F.OverlayRenderTarget(this._rctx),this._overlays=[new D.Overlay(B.OverlayIndex.INNER,this._overlayRenderTarget),new D.Overlay(B.OverlayIndex.OUTER,this._overlayRenderTarget)]);this.ensureDrapeTargets(ma);this.ensureDrapeSources(ra)};sa.disposeOverlays=function(){this._overlays=null;this._overlayRenderTarget=l.disposeMaybe(this._overlayRenderTarget);this.events.emit("textures-disposed")};sa.runTask=function(ma,ra=()=>!0){this._frameTask.processQueue(ma);ma.done||this._processLayers(ma,ra)};sa._processLayers=
function(ma,ra){let va=!1;for(const [Ia,Ja]of this._layerRenderers){if(ma.done)break;if(Ia.destroyed||ra(Ia))Ja.commitChanges()&&(va=!0,ma.madeProgress()),Ja.isEmpty&&(this._sortedLayerRenderersDirty=va=!0,this._layerRenderers.delete(Ia),this._handles.remove(Ia),Ja.destroy())}this._updateSortedLayerRenderers();va&&(l.isSome(this._overlays)&&0===this._layerRenderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),
this._updateHasWater())};sa.processSyncLayers=function(){this._processLayers(la.noBudget,ma=>ma.updatePolicy===H.UpdatePolicy.SYNC)};sa.addGeometries=function(ma,ra,va,Ia=!1){for(const Ja of ma)l.isNone(Ja.origin)&&(Ja.origin=this._localOrigins.getOrigin(Ja.boundingSphere)),this._geometries.set(Ja.id,Ja);this._ensureLayerRenderer(ra,Ia).add(ma);va===R.ModelDirty.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(ma,ra)};sa.removeGeometries=function(ma,ra,va){for(var Ia of ma)this._geometries.delete(l.unwrap(Ia.id));
if(Ia=this._layerRenderers.get(ra))Ia.remove(ma),va===R.ModelDirty.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(ma,ra)};sa.updateGeometries=function(ma,ra,va){const Ia=this._layerRenderers.get(ra);if(Ia)switch(Ia.modify(ma,va),va){case R.ModelDirty.State.TRANSFORMATION:case R.ModelDirty.State.VERTEXATTRS:return this._notifyGraphicGeometryChanged(ma,ra);case R.ModelDirty.State.VISIBILITIES:return this._notifyGraphicVisibilityChanged(ma,ra)}else Z.warn("Attempted to update geometry for nonexistent layer")};
sa._notifyGraphicGeometryChanged=function(ma,ra){if(!l.isNone(ra.notifyGraphicGeometryChanged))for(const Ia of ma)if(ma=Ia.graphicUid,l.isSome(ma)&&ma!==va){ra.notifyGraphicGeometryChanged(ma);var va=ma}};sa._notifyGraphicVisibilityChanged=function(ma,ra){if(!l.isNone(ra.notifyGraphicVisibilityChanged))for(const Ia of ma)if(ma=Ia.graphicUid,l.isSome(ma)&&ma!==va){ra.notifyGraphicVisibilityChanged(ma);var va=ma}};sa.updateHighlights=function(ma,ra){(ra=this._layerRenderers.get(ra))?ra.modify(ma,R.ModelDirty.State.HIGHLIGHTS):
Z.warn("Attempted to update highlights for nonexistent layer")};sa.isEmpty=function(){return 0===this._geometries.size&&!p.OVERLAY_DRAW_DEBUG_TEXTURE};sa.updateAnimation=function(ma){let ra=!1;this._layerRenderers.forEach(va=>ra=va.updateAnimation(ma)||ra);return ra};sa.updateLayerOrder=function(){this._sortedLayerRenderersDirty=!0};sa.drawTarget=function(ma,ra,va){const Ia=ma.canvasGeometries;if(0===Ia.numViews)return!1;this._screenToWorldRatio=va*ma.mapUnitsPerPixel;const Ja=ra.renderPass;if(this.isEmpty()||
Ja===T.RenderPass.MATERIAL_HIGHLIGHT&&!this.hasHighlights||Ja===T.RenderPass.MATERIAL_NORMAL&&!this.hasWater||!ma.hasSomeSizedView())return!1;const Ha=ra.fbo;if(!Ha.isValid())return!1;const Ta=2*ma.resolution,db=ma.resolution;Ha.resize(Ta,db);const fb=this._rctx;pa.pixelRatio=ma.pixelRatio*va;this._renderContext.pass=Ja;this._bindParameters.screenToWorldRatio=this._screenToWorldRatio;this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio;this._bindParameters.slot=Ja===
T.RenderPass.MATERIAL_NORMAL?V.RenderSlot.DRAPED_WATER:V.RenderSlot.DRAPED_MATERIAL;ma.applyViewport(this._rctx);Ha.bind(fb);ma.index===B.OverlayIndex.INNER&&(fb.setClearColor(0,0,0,0),fb.clearSafe(ia.ClearBufferBit.COLOR_BUFFER_BIT));const ka=ra.type===B.RenderTargetType.ColorNoRasterImage?a.DrawPassOption.ExcludeRasterImage:ra.type===B.RenderTargetType.Occluded?a.DrawPassOption.OccludedOnly:a.DrawPassOption.Normal;ka===a.DrawPassOption.OccludedOnly&&(this._renderContext.renderOccludedMask=ua);if(p.OVERLAY_DRAW_DEBUG_TEXTURE&&
ka!==a.DrawPassOption.OccludedOnly)for(ra=0;ra<Ia.numViews;ra++)this._setViewParameters(Ia.extents[ra],ma,pa),this._drawDebugTexture(ma.resolution,na[ma.index]);0<this._layerRenderers.size&&this._sortedLayerRenderers.forAll(({overlayLayer:cb,renderer:Ca})=>{if(ka!==a.DrawPassOption.ExcludeRasterImage||cb.drapeSourceType!==A.DrapeSourceType.RasterImage){({fullOpacity:cb}=cb);var Ka=l.isSome(cb)&&1>cb&&Ja===T.RenderPass.MATERIAL;Ka&&(this.bindTemporaryFramebuffer(this._rctx,Ta,db),fb.clearSafe(ia.ClearBufferBit.COLOR_BUFFER_BIT));
for(let Oa=0;Oa<Ia.numViews;Oa++)this._setViewParameters(Ia.extents[Oa],ma,pa),Ca.render(this._renderContext,this._bindParameters);Ka&&l.isSome(this._temporaryFBO)&&(Ha.bind(fb),this.view._stage.renderView.compositingHelper.composite(this._temporaryFBO.getTexture(),ja.AlphaMode.PremultipliedAlpha,cb,ea.CompositingFunction.OverlayWithTransparency,ma.index))}});fb.bindFramebuffer(null);Ha.generateMipMap();this._renderContext.resetRenderOccludedMask();return!0};sa.bindTemporaryFramebuffer=function(ma,
ra,va){l.isNone(this._temporaryFBO)&&(this._temporaryFBO=new C.OverlayFramebufferObject(ma,!1));this._temporaryFBO.resize(ra,va);this._temporaryFBO.bind(ma)};sa.reloadShaders=function(){var ma=b._asyncToGenerator(function*(){yield this._shaderTechniqueRepository.reloadAll()});return function(){return ma.apply(this,arguments)}}();sa.intersect=function(ma,ra,va,Ia){let Ja=0;this._geometries.forEach(Ha=>{if(!Ia||Ia(Ha)){this._intersectRenderGeometry(Ha,va,ra,0,ma,Ja);var Ta=this.longitudeCyclical;Ta&&
(Ha.boundingSphere[0]-Ha.boundingSphere[3]<Ta.min&&this._intersectRenderGeometry(Ha,va,ra,Ta.range,ma,Ja),Ha.boundingSphere[0]+Ha.boundingSphere[3]>Ta.max&&this._intersectRenderGeometry(Ha,va,ra,-Ta.range,ma,Ja));Ja++}})};sa._intersectRenderGeometry=function(ma,ra,va,Ia,Ja,Ha){if(ma.instanceParameters.visible){var Ta=0;l.isSome(ma.transformation)&&(Ia+=ma.transformation[12],Ta=ma.transformation[13]);xa[0]=va[0]-Ia;xa[1]=va[1]-Ta;xa[2]=1;Da[0]=va[0]-Ia;Da[1]=va[1]-Ta;Da[2]=0;ma.screenToWorldRatio=
this._screenToWorldRatio;ma.material.intersect(ma,null,ma.getShaderTransformation(),Ja,xa,Da,(db,fb,ka)=>{ba(ra,ka,ma.material.renderPriority,Ha,Ja,ma.layerUid,ma.graphicUid)},ma.calculateShaderTransformation,ra)}};sa._ensureLayerRenderer=function(ma,ra){let va=this._layerRenderers.get(ma);va&&ra===va instanceof K.DrapedHeatmapRenderer||(va=ra?new K.DrapedHeatmapRenderer({rctx:this._rctx,materialRepository:this._materialRepository}):new W.SortedRenderGeometryRenderer({rctx:this._rctx,materialRepository:this._materialRepository}),
this._layerRenderers.set(ma,va),this._sortedLayerRenderersDirty=!0,"fullOpacity"in ma&&this._handles.add(ma.watch("fullOpacity",()=>this.events.emit("content-changed")),ma),this._handles.add(d.init(va,"updating",()=>this.notifyChange("updating")),ma));return va};sa._updateSortedLayerRenderers=function(){if(this._sortedLayerRenderersDirty&&(this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers.clear(),0!==this._layerRenderers.size)){var ma=this.view.map.allLayers;this._layerRenderers.forEach((ra,
va)=>{const Ia=ma.indexOf(va.layer);this._sortedLayerRenderers.push(new ha(va,ra,0>Ia?Infinity:Ia))});this._sortedLayerRenderers.sort((ra,va)=>ra.index-va.index)}};sa._setViewParameters=function(ma,ra,va){va.viewport[0]=va.viewport[1]=0;va.viewport[2]=va.viewport[3]=ra.resolution;r.ortho(va.projectionMatrix,0,ma[2]-ma[0],0,ma[3]-ma[1],va.near,va.far);r.fromTranslation(va.viewMatrix,[-ma[0],-ma[1],0]);this._renderContext.camera=va;this._bindParameters.camera=va;this._bindParameters.inverseViewport[0]=
1/va.fullViewport[2];this._bindParameters.inverseViewport[1]=1/va.fullViewport[3]};sa._updateHasWater=function(){const ma=f.someMap(this._layerRenderers,ra=>ra.hasWater);ma!==this._hasWater&&(this._hasWater=ma,this.events.emit("has-water",ma))};sa._updateHasHighlights=function(){const ma=f.someMap(this._layerRenderers,ra=>ra.hasHighlights);ma!==this._hasHighlights&&(this._hasHighlights=ma,this.events.emit("has-highlights",ma))};sa._updateRendersOccluded=function(){const ma=f.someMap(this._layerRenderers,
ra=>ra.rendersOccluded);ma!==this._rendersOccluded&&(this._rendersOccluded=ma,this.events.emit("renders-occluded",ma))};sa._drawDebugTexture=function(ma,ra){this._ensureDebugPatternResources(ma,ma);ma=this._rctx;const va=ma.useTechnique(this._debugTextureTechnique);va.setUniform4f("uColor",ra[0],ra[1],ra[2],1);va.bindTexture(this._debugPatternTexture,"tex");ma.bindVAO(this._quadVAO);ma.drawArrays(ia.PrimitiveType.TRIANGLE_STRIP,0,fa.vertexCount(this._quadVAO,"geometry"))};sa._ensureDebugPatternResources=
function(ma,ra){if(!this._debugPatternTexture){var va=new Uint8Array(ma*ra*4),Ia=0;for(let Ja=0;Ja<ra;Ja++)for(let Ha=0;Ha<ma;Ha++){const Ta=Math.floor(Ha/10),db=Math.floor(Ja/10);2>Ta||2>db||10*Ta>ma-20||10*db>ra-20?(va[Ia++]=255,va[Ia++]=255,va[Ia++]=255,va[Ia++]=255):(va[Ia++]=255,va[Ia++]=255,va[Ia++]=255,Ta&1&&db&1?va[Ia++]=Ha&1^Ja&1?0:255:va[Ia++]=Ta&1^db&1?0:128)}this._debugPatternTexture=new ca.Texture(this._rctx,{target:ia.TextureType.TEXTURE_2D,pixelFormat:ia.PixelFormat.RGBA,dataType:ia.PixelType.UNSIGNED_BYTE,
samplingMode:ia.TextureSamplingMode.NEAREST,width:ma,height:ra},va);ma=new U.TextureTechniqueConfiguration;ma.hasAlpha=!0;this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(U.TextureTechnique,ma);this._quadVAO=O.createQuadVAO(this._rctx)}};b._createClass(qa,[{key:"updating",get:function(){return this._sortedLayerRenderersDirty||this._frameTask.updating||f.someMap(this._layerRenderers,ma=>ma.updating)}},{key:"hasOverlays",get:function(){return l.isSome(this._overlays)&&l.isSome(this._overlayRenderTarget)}},
{key:"gpuMemoryUsage",get:function(){return l.isSome(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}},{key:"overlays",get:function(){return l.unwrapOr(this._overlays,[])}},{key:"running",get:function(){return this.updating}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return this._rendersOccluded}},{key:"test",get:function(){return{layerRenderers:this._layerRenderers}}}]);
return qa}(L.AutoDisposableMixin(g));c.__decorate([m.property()],a.OverlayRenderer.prototype,"_frameTask",void 0);c.__decorate([m.property()],a.OverlayRenderer.prototype,"_sortedLayerRenderersDirty",void 0);c.__decorate([L.autoDispose()],a.OverlayRenderer.prototype,"_shaderTechniqueRepository",void 0);c.__decorate([L.autoDispose()],a.OverlayRenderer.prototype,"_stippleTextureRepository",void 0);c.__decorate([m.property({constructOnly:!0})],a.OverlayRenderer.prototype,"view",void 0);c.__decorate([m.property()],
a.OverlayRenderer.prototype,"worldToPCSRatio",void 0);c.__decorate([m.property()],a.OverlayRenderer.prototype,"spatialReference",void 0);c.__decorate([m.property({type:Boolean,readOnly:!0})],a.OverlayRenderer.prototype,"updating",null);a.OverlayRenderer=c.__decorate([t.subclass("esri.views.3d.terrain.OverlayRenderer")],a.OverlayRenderer);a.DrawPassOption=void 0;(function(Fa){Fa[Fa.Normal=0]="Normal";Fa[Fa.OccludedOnly=1]="OccludedOnly";Fa[Fa.ExcludeRasterImage=2]="ExcludeRasterImage"})(a.DrawPassOption||
(a.DrawPassOption={}));let ha=function(Fa,qa,sa){this.overlayLayer=Fa;this.renderer=qa;this.index=sa};const na=[[1,.5,.5],[.5,.5,1]],pa=new M.default;pa.near=1;pa.far=1E4;pa.relativeElevation=null;const xa=u.create(),Da=u.create(),ua=N.RenderOccludedFlag.OccludeAndTransparent;a.DRAPED_Z=-2;a.overlayRenderOccludedFlag=ua;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/interfaces":function(){define(["exports"],function(a){a.DrapeSourceType=void 0;(function(b){b[b.RasterImage=
0]="RasterImage";b[b.Features=1]="Features"})(a.DrapeSourceType||(a.DrapeSourceType={}));a.DrapeTargetType=void 0;(function(b){b[b.WithRasterImage=0]="WithRasterImage";b[b.WithoutRasterImage=1]="WithoutRasterImage"})(a.DrapeTargetType||(a.DrapeTargetType={}));a.DrapeSourceRegistration=void 0;(function(b){b[b.LAYER_VIEW=0]="LAYER_VIEW";b[b.EXTERNAL=1]="EXTERNAL"})(a.DrapeSourceRegistration||(a.DrapeSourceRegistration={}));Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/interfaces":function(){define(["exports"],
function(a){a.OverlayIndex=void 0;(function(b){b[b.INNER=0]="INNER";b[b.OUTER=1]="OUTER"})(a.OverlayIndex||(a.OverlayIndex={}));a.PatchType=void 0;(function(b){b[b.REGULAR=0]="REGULAR";b[b.HAS_NORTH_POLE=1]="HAS_NORTH_POLE";b[b.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE";b[b.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"})(a.PatchType||(a.PatchType={}));a.LODSnapping=void 0;(function(b){b[b.OFF=0]="OFF";b[b.ON=1]="ON"})(a.LODSnapping||(a.LODSnapping={}));a.RenderTargetType=void 0;(function(b){b[b.Color=0]="Color";b[b.ColorNoRasterImage=
1]="ColorNoRasterImage";b[b.Highlight=2]="Highlight";b[b.Water=3]="Water";b[b.Occluded=4]="Occluded"})(a.RenderTargetType||(a.RenderTargetType={}));a.TextureUpdate=void 0;(function(b){b[b.FADING=0]="FADING";b[b.IMMEDIATE=1]="IMMEDIATE";b[b.UNFADED=2]="UNFADED"})(a.TextureUpdate||(a.TextureUpdate={}));Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/Overlay":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../geometry/support/aaBoundingRect ./interfaces ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/LocalOriginFactory".split(" "),
function(a,b,c,g,h,w,n){a.OverlaySource=void 0;(function(k){k[k.None=0]="None";k[k.ColorAndWater=1]="ColorAndWater";k[k.Highlight=2]="Highlight";k[k.Occluded=3]="Occluded"})(a.OverlaySource||(a.OverlaySource={}));let f=function(){function k(d,m){this.index=d;this.renderTargets=m;this.extent=g.create();this.resolution=0;this.renderLocalOrigin=n.fromValues(0,0,0,"O");this.mapUnitsPerPixel=this.pixelRatio=1;this.canvasGeometries=new l;this.validTargets=null;this.hasTargetWithoutRasterImage=this.hasDrapedRasterSource=
this.hasDrapedFeatureSource=!1;this.index=d;this.validTargets=Array(m.renderTargets.length).fill(!1)}var e=k.prototype;e.getValidTarget=function(d){return this.validTargets[d]?this.renderTargets.getTarget(d):null};e.getColorTexture=function(d){return(d=d===a.OverlaySource.ColorAndWater?this.renderTargets.getTarget(h.RenderTargetType.Color):d===a.OverlaySource.Highlight?this.renderTargets.getTarget(h.RenderTargetType.Highlight):this.renderTargets.getTarget(h.RenderTargetType.Occluded))?d.getTexture():
null};e.getNormalTexture=function(d){return(d=d===a.OverlaySource.ColorAndWater?this.renderTargets.getTarget(h.RenderTargetType.Water):null)?d.getTexture():null};e.draw=function(d,m){const z=this.computeRenderTargetValidityBitfield(),v=this.needsColorWithoutRasterImage;for(const q of this.renderTargets.renderTargets)this.validTargets[q.type]=q.type===h.RenderTargetType.ColorNoRasterImage&&!1===v?!1:d.drawTarget(this,q,m);d=this.computeRenderTargetValidityBitfield();return z^d?w.ValidationState.CHANGED:
w.ValidationState.UNCHANGED};e.computeRenderTargetValidityBitfield=function(){const d=this.validTargets;return+d[h.RenderTargetType.Color]|+d[h.RenderTargetType.ColorNoRasterImage]<<1|+d[h.RenderTargetType.Highlight]<<2|+d[h.RenderTargetType.Water]<<3|+d[h.RenderTargetType.Occluded]<<4};e.setupGeometryViewsCyclical=function(d){this.setupGeometryViewsDirect();var m=.001*d.range;if(this.extent[0]-m<=d.min){const z=this.canvasGeometries.extents[this.canvasGeometries.numViews++];g.offset(this.extent,
d.range,0,z)}this.extent[2]+m>=d.max&&(m=this.canvasGeometries.extents[this.canvasGeometries.numViews++],g.offset(this.extent,-d.range,0,m))};e.setupGeometryViewsDirect=function(){this.canvasGeometries.numViews=1;g.copy(this.canvasGeometries.extents[0],this.extent)};e.hasSomeSizedView=function(){for(let d=0;d<this.canvasGeometries.numViews;d++){const m=this.canvasGeometries.extents[d];if(m[0]!==m[2]&&m[1]!==m[3])return!0}return!1};e.applyViewport=function(d){d.setViewport(this.index===h.OverlayIndex.INNER?
0:this.resolution,0,this.resolution,this.resolution)};b._createClass(k,[{key:"needsColorWithoutRasterImage",get:function(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}}]);return k}(),l=function(){this.extents=[g.create(),g.create(),g.create()];this.numViews=0};a.Overlay=f;a.computeOverlayResolution=function(k,e,d){return Math.min(c.nextHighestPowerOfTwo(Math.max(k,e)+256),d)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/LocalOriginFactory":function(){define(["exports",
"../../../../chunks/vec3f64"],function(a,b){let c=function(g,h){this.vec3=g;this.id=h};a.LocalOrigin=c;a.fromValues=function(g,h,w,n){return new c(b.fromValues(g,h,w),n)};a.fromVector=function(g,h){return new c(b.clone(g),h)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/OverlayFramebufferObject":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/vec2f32 ../../webgl/enums ../../webgl/FramebufferObject".split(" "),function(a,
b,c,g,h,w){let n=function(){function f(k,e){this.size=g.create();this._fbo=null;this._fbo=new w.FramebufferObject(k,{colorTarget:h.TargetType.TEXTURE,depthStencilTarget:h.DepthStencilTargetType.NONE},{target:h.TextureType.TEXTURE_2D,pixelFormat:h.PixelFormat.RGBA,dataType:h.PixelType.UNSIGNED_BYTE,wrapMode:h.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:h.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,hasMipmap:e,maxAnisotropy:8,width:0,height:0})}var l=f.prototype;l.dispose=function(){this._fbo=c.disposeMaybe(this._fbo)};
l.getTexture=function(){return this._fbo?this._fbo.colorTexture:null};l.isValid=function(){return null!==this._fbo};l.resize=function(k,e){this.size[0]=k;this.size[1]=e;this._fbo.resize(this.size[0],this.size[1])};l.bind=function(k){k.bindFramebuffer(this._fbo)};l.generateMipMap=function(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()};l.disposeRenderTargetMemory=function(){var k;null==(k=this._fbo)?void 0:k.resize(0,0)};b._createClass(f,[{key:"gpuMemoryUsage",
get:function(){var k,e;return null!=(k=null==(e=this._fbo)?void 0:e.gpuMemoryUsage)?k:0}}]);return f}();a.OverlayFramebufferObject=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/OverlayRenderTarget":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./interfaces","./OverlayFramebufferObject","../webgl-engine/lib/RenderPass"],function(a,b,c,g,h){let w=function(){function n(l){const k=(e,d,m=!0)=>({type:d,fbo:new g.OverlayFramebufferObject(l,m),renderPass:e,
valid:!1,lastUsed:Infinity});this.renderTargets=[k(h.RenderPass.MATERIAL,c.RenderTargetType.Color),k(h.RenderPass.MATERIAL,c.RenderTargetType.ColorNoRasterImage),k(h.RenderPass.MATERIAL_HIGHLIGHT,c.RenderTargetType.Highlight,!1),k(h.RenderPass.MATERIAL_NORMAL,c.RenderTargetType.Water),k(h.RenderPass.MATERIAL,c.RenderTargetType.Occluded)]}var f=n.prototype;f.getTarget=function(l){return this.renderTargets[l].fbo};f.dispose=function(){for(const l of this.renderTargets)l.fbo.dispose()};f.disposeRenderTargetMemory=
function(){for(const l of this.renderTargets)l.fbo.disposeRenderTargetMemory()};f.validateUsageForTarget=function(l,k,e){if(l)k.lastUsed=e;else if(1E3<e-k.lastUsed)k.fbo.disposeRenderTargetMemory(),k.lastUsed=Infinity;else if(Infinity>k.lastUsed)return!0;return!1};b._createClass(n,[{key:"gpuMemoryUsage",get:function(){return this.renderTargets.reduce((l,k)=>l+k.fbo.gpuMemoryUsage,0)}}]);return n}();a.OverlayRenderTarget=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueRepository":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../../core/NestedMap"],function(a,b,c,g){let h=function(n){this.technique=n;this.refZeroFrame=this.refCount=0},w=function(){function n(l){this._context=l;this._perConstructorInstances=new g.NestedMap;this._frameCounter=0;this._keepAliveFrameCount=-1}var f=n.prototype;f.dispose=function(){this._perConstructorInstances.forEach(l=>l.forEach(k=>k.technique.destroy()));this._perConstructorInstances.clear()};f.acquire=
function(l,k){const e=k.key;let d=this._perConstructorInstances.get(l,e);if(c.isNone(d)){const m=new l(this._context,k,()=>this.release(m));d=new h(m);this._perConstructorInstances.set(l,e,d)}++d.refCount;return d.technique};f.releaseAndAcquire=function(l,k,e){if(c.isSome(e)){if(k.key===e.key)return e;this.release(e)}return this.acquire(l,k)};f.release=function(l){c.isNone(l)||this._perConstructorInstances.empty||(l=this._perConstructorInstances.get(l.constructor,l.key),c.isNone(l)||(--l.refCount,
0===l.refCount&&(l.refZeroFrame=this._frameCounter)))};f.frameUpdate=function(){this._frameCounter++;-1!==this._keepAliveFrameCount&&this._perConstructorInstances.forEach((l,k)=>{l.forEach((e,d)=>{0===e.refCount&&e.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(e.technique.destroy(),this._perConstructorInstances.delete(k,d))})})};f.reloadAll=function(){var l=b._asyncToGenerator(function*(){var k=this;const e=[];this._perConstructorInstances.forEach((d,m)=>{const z=function(){var v=b._asyncToGenerator(function*(q,
t){if(t=t.shader)yield t.reload(),q.forEach(r=>{r.technique.reload(k._context)})});return function(q,t){return v.apply(this,arguments)}}();e.push(z(d,m))});yield Promise.all(e)});return function(){return l.apply(this,arguments)}}();b._createClass(n,[{key:"viewingMode",get:function(){return this._context.viewingMode}},{key:"constructionContext",get:function(){return this._context}}]);return n}();a.ShaderTechniqueRepository=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/NestedMap":function(){define(["exports",
"../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function g(){this._outer=new Map}var h=g.prototype;h.clear=function(){this._outer.clear()};h.get=function(w,n){var f;return null==(f=this._outer.get(w))?void 0:f.get(n)};h.set=function(w,n,f){const l=this._outer.get(w);l?l.set(n,f):this._outer.set(w,new Map([[n,f]]))};h.delete=function(w,n){const f=this._outer.get(w);f&&(f.delete(n),0===f.size&&this._outer.delete(w))};h.forEach=function(w){this._outer.forEach((n,f)=>w(n,f))};b._createClass(g,
[{key:"empty",get:function(){return 0===this._outer.size}}]);return g}();a.NestedMap=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/AutoDisposable":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){const c=h=>function(w){function n(){var f=w.apply(this,arguments)||this;f._isDisposed=!1;return f}b._inheritsLoose(n,w);n.prototype.dispose=function(){for(const l of null!=(f=this._managedDisposables)?f:[]){var f;f=this[l];
this[l]=null;f&&"function"===typeof f.dispose&&f.dispose()}this._isDisposed=!0};b._createClass(n,[{key:"isDisposed",get:function(){return this._isDisposed}}]);return n}(h);let g=function(h){function w(){return h.apply(this,arguments)||this}b._inheritsLoose(w,h);return w}(c(function(){return function(){}}()));a.AutoDisposable=g;a.AutoDisposableMixin=c;a.autoDispose=function(){return(h,w)=>{if(!h.hasOwnProperty("_managedDisposables")){var n,f;h._managedDisposables=null!=(n=null==(f=h._managedDisposables)?
void 0:f.slice())?n:[]}h._managedDisposables.unshift(w)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/DrapedHeatmapRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/set ../../../../core/accessorSupport/decorators/subclass ../../../ViewingMode ./glUtil3D ./SortedRenderGeometryRenderer ../materials/HeatmapDensityMaterial ../shaders/HeatmapTechnique ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x){function u(E){return z.isHeatMapDensityMaterial(E.material)}a.DrapedHeatmapRenderer=function(E){function y(){var p=E.apply(this,arguments)||this;p.type="draped-heatmap";return p}b._inheritsLoose(y,E);var A=y.prototype;A.initialize=function(){E.prototype.initialize.call(this);var p={colorTarget:q.TargetType.TEXTURE,depthStencilTarget:q.DepthStencilTargetType.NONE,width:0,height:0},{capabilities:B}=this.rctx,{R32F:D}=B.colorBufferFloat;({textureFloatLinear:B}=
B.textureFloat);D=null!=D;this._densityMap=new t.FramebufferObject(this.rctx,p,{target:q.TextureType.TEXTURE_2D,pixelFormat:D?q.PixelFormat.RED:q.PixelFormat.RGBA,internalFormat:D?q.SizedPixelFormat.R32F:q.PixelFormat.RGBA,dataType:q.PixelType.FLOAT,samplingMode:B?q.TextureSamplingMode.LINEAR:q.TextureSamplingMode.NEAREST,wrapMode:q.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0});this._quad=d.createQuadVAO(this.rctx);this._colorRamp=p=new r.Texture(this.rctx,{target:q.TextureType.TEXTURE_2D,pixelFormat:q.PixelFormat.RGBA,
dataType:q.PixelType.UNSIGNED_BYTE,samplingMode:q.TextureSamplingMode.LINEAR,wrapMode:q.TextureWrapMode.CLAMP_TO_EDGE,width:1,height:1},new Uint8ClampedArray(4));this._technique=new v.HeatmapTechnique({rctx:this.rctx,viewingMode:e.ViewingMode.Local},new v.HeatmapTechniqueConfiguration);this._heatmapParameters={colorRamp:p,densityMap:this._densityMap.colorTexture,searchRadius:1,minDensity:0,maxDensity:100,fieldTotal:0}};A.destroy=function(){this._technique=g.releaseMaybe(this._technique);this._densityMap=
g.disposeMaybe(this._densityMap);this._quad=g.disposeMaybe(this._quad);this._colorRamp=g.disposeMaybe(this._colorRamp)};A.add=function(p){E.prototype.add.call(this,p)};A.remove=function(p){E.prototype.remove.call(this,p)};A.render=function(p,B){var D=this._heatmapDensityMaterialRenderers,C=D.length;if(!(1>C)){var F=this.rctx.getBoundFramebufferObject(),G=this.rctx.getViewport(),L=D[0].material.parameters,{pixelRatio:H}=L,M=Math.ceil(G.width*H);H=Math.ceil(G.height*H);this._densityMap.resize(M,H);
this.rctx.bindFramebuffer(this._densityMap);this.rctx.setViewport(0,0,M,H);this.rctx.clear(q.ClearBufferBit.COLOR_BUFFER_BIT);M=!1;for(H=0;H<C;H++){const P=D[H];P.material.shouldRender(p)&&(M=M||P.materialRenderer.render(B.slot,p.pass,B))}this.rctx.bindFramebuffer(F);this.rctx.setViewport(G.x,G.y,G.width,G.height);if(M){var {searchRadius:K,minDensity:I,maxDensity:O,fieldTotal:Q,colorRampData:J}=L;p=this._heatmapParameters;p.searchRadius=K;p.fieldTotal=Q;p.searchRadius=K;p.minDensity=I;p.maxDensity=
O;g.isSome(J)&&J!==this._colorRampData&&({colorRamp:D}=p,C=J.length/4,C!==D.descriptor.width&&D.resize(C,1),D.setData(J),this._colorRampData=J);this.rctx.bindVAO(this._quad);this.rctx.useProgram(this._technique.program);this._technique.bindPipelineState(this.rctx);this._technique.bindPass(p,B);this.rctx.drawArrays(this._technique.primitiveType,0,x.vertexCount(this._quad,"geometry"))}}};b._createClass(y,[{key:"hasHighlights",get:function(){return!1}},{key:"hasWater",get:function(){return!1}},{key:"rendersOccluded",
get:function(){return!1}},{key:"_heatmapDensityMaterialRenderers",get:function(){return this._sortedMaterialRenderers.filter(u)}}]);return y}(m.SortedRenderGeometryRenderer);a.DrapedHeatmapRenderer=c.__decorate([k.subclass("esri.views.3d.webgl-engine.lib.DrapedHeatmapRenderer")],a.DrapedHeatmapRenderer);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/SortedRenderGeometryRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/MapUtils ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./ChangeSet ./rendererUtils ../materials/renderers/MergedRenderer".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z){a.SortedRenderGeometryRenderer=function(q){function t(){var x=q.apply(this,arguments)||this;x._pending=new v;x._changes=new d.ChangeSet;x._materialRenderers=new Map;x._sortedMaterialRenderers=new w;x._hasHighlights=!1;x._hasWater=!1;return x}b._inheritsLoose(t,q);var r=t.prototype;r.destroy=function(){this._changes.prune();this._materialRenderers.forEach(x=>x.dispose());this._materialRenderers.clear();this._sortedMaterialRenderers.clear()};r.commitChanges=function(){if(!this.updating)return!1;
this._processAddsRemoves();let x=!1,u=!1,E=!1;m.splitRenderGeometryChangeSetByMaterial(this._changes).forEach((y,A)=>{let p=this._materialRenderers.get(A);!p&&0<y.adds.length&&(p=new z.MergedRenderer(this.rctx,this.materialRepository,A),this._materialRenderers.set(A,p),E=u=x=!0);if(p){var B=u||p.hasHighlights,D=E||p.hasWater;p.modify(y);u=u||B!==p.hasHighlights;E=E||D!==p.hasWater;p.isEmpty&&(this._materialRenderers.delete(A),p.dispose(),x=!0)}});this._changes.clear();x&&this._updateSortedMaterialRenderers();
u&&(this._hasHighlights=h.someMap(this._materialRenderers,y=>y.hasHighlights));E&&(this._hasWater=h.someMap(this._materialRenderers,y=>y.hasWater));this.notifyChange("updating");return!0};r.add=function(x){if(0!==x.length){var u=this._pending.empty;for(const E of x)this._pending.adds.add(E);u&&this.notifyChange("updating")}};r.remove=function(x){const u=this._pending.empty;for(const E of x)this._pending.adds.has(E)?(this._pending.removed.add(E),this._pending.adds.delete(E)):this._pending.removed.has(E)||
this._pending.removes.add(E);u&&!this._pending.empty&&this.notifyChange("updating")};r.modify=function(x,u){const E=0===this._changes.updates.length;for(const y of x)x=this._changes.updates.pushNew(),x.renderGeometry=y,x.updateType=u;E&&0<this._changes.updates.length&&this.notifyChange("updating")};r.updateAnimation=function(x){let u=!1;this._sortedMaterialRenderers.forAll(({materialRenderer:E})=>u=E.updateAnimation(x)||u);return u};r.render=function(x,u){for(let E=0;E<this._sortedMaterialRenderers.length;E++){const y=
this._sortedMaterialRenderers.data[E];y.material.shouldRender(x)&&y.materialRenderer.render(u.slot,x.pass,u)}};r._updateSortedMaterialRenderers=function(){this._sortedMaterialRenderers.clear();let x=0;this._materialRenderers.forEach((u,E)=>{E.insertOrder=x++;this._sortedMaterialRenderers.push({material:E,materialRenderer:u})});this._sortedMaterialRenderers.sort((u,E)=>{const y=E.material.renderPriority-u.material.renderPriority;return 0!==y?y:u.material.insertOrder-E.material.insertOrder})};r._processAddsRemoves=
function(){this._changes.adds.clear();this._changes.removes.clear();this._changes.adds.pushArray(Array.from(this._pending.adds));this._changes.removes.pushArray(Array.from(this._pending.removes));for(let x=0;x<this._changes.updates.length;)this._pending.has(this._changes.updates.data[x].renderGeometry)?this._changes.updates.removeUnorderedIndex(x):x++;this._pending.clear()};b._createClass(t,[{key:"updating",get:function(){return!this._pending.empty||0<this._changes.updates.length}},{key:"hasHighlights",
get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return h.someMap(this._materialRenderers,x=>x.rendersOccluded)}},{key:"isEmpty",get:function(){return!this.updating&&0===this._materialRenderers.size}},{key:"test",get:function(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}}]);return t}(g);c.__decorate([n.property()],a.SortedRenderGeometryRenderer.prototype,"rctx",void 0);c.__decorate([n.property()],
a.SortedRenderGeometryRenderer.prototype,"materialRepository",void 0);c.__decorate([n.property()],a.SortedRenderGeometryRenderer.prototype,"updating",null);a.SortedRenderGeometryRenderer=c.__decorate([e.subclass("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],a.SortedRenderGeometryRenderer);let v=function(){function q(){this.adds=new Set;this.removes=new Set;this.removed=new Set}var t=q.prototype;t.has=function(r){return this.adds.has(r)||this.removes.has(r)||this.removed.has(r)};
t.clear=function(){this.adds.clear();this.removes.clear();this.removed.clear()};b._createClass(q,[{key:"empty",get:function(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}}]);return q}();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ChangeSet":function(){define(["exports","../../../../core/PooledArray"],function(a,b){let c=function(){function h(){this.adds=new b;this.removes=new b;this.updates=new b({allocator:n=>n||new g,deallocator:n=>
{n.renderGeometry=null;return n}})}var w=h.prototype;w.clear=function(){this.adds.clear();this.removes.clear();this.updates.clear()};w.prune=function(){this.adds.prune();this.removes.prune();this.updates.prune()};return h}(),g=function(){};a.ChangeSet=c;a.MaterialChangeSet=function(){this.adds=[];this.removes=[];this.updates=[]};a.RenderGeometryUpdate=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/rendererUtils":function(){define(["exports","./ChangeSet"],function(a,
b){a.splitRenderGeometryChangeSetByMaterial=function(c){const g=new Map,h=w=>{let n=g.get(w);n||(n=new b.MaterialChangeSet,g.set(w,n));return n};c.removes.forAll(w=>{1<=w.data.indexCount&&h(w.material).removes.push(w)});c.adds.forAll(w=>{1<=w.data.indexCount&&h(w.material).adds.push(w)});c.updates.forAll(w=>{1<=w.renderGeometry.data.indexCount&&h(w.renderGeometry.material).updates.push(w)});return g};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/renderers/MergedRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/MapUtils ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../support/buffer/glUtil ../../lib/GLMaterials ../../lib/Material ../../lib/ModelDirtyTypes ../../lib/RenderPass ../../lib/Util ../WaterMaterial ./Instance ./MergedGeometryBuffer ./MergedGeometryBufferPool ./utils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r){function x(H,M){const K=new Map;for(const I of H)u(K,I,!0);for(const I of M)u(K,I,!1);return K}function u(H,M,K){const I=M.origin;if(!g.isNone(I)){var O=H.get(I.id);null==O&&(O=new p(I.vec3),H.set(I.id,O));K?O.toAdd.push(M):O.toRemove.push(M)}}function E(H,M){let K;if(!H.some(O=>{if(O.to-O.from<M)return!1;K=O;return!0}))return null;const I=K.from;K.from+=M;K.from>=K.to&&H.removeUnordered(K);return I}function y(H){const M=new Map;H.forAll(I=>M.set(I.from,
I));let K=!0;for(;K;)K=!1,H.forEach(I=>{const O=M.get(I.to);O&&(I.to=O.to,M.delete(O.from),H.removeUnordered(O),K=!0)})}let A=function(){function H(K,I,O){this._rctx=K;this._materialRepository=I;this._material=O;this.type="MergedRenderer";this._dataByOrigin=new Map;this._renderCommandData=new h;this._hasOccludees=this._hasHighlights=!1;this._glMaterials=new l.GLMaterials(this._material,this._materialRepository);this._bufferWriter=O.createBufferWriter();this._bufferPool=new t.MergedGeometryBufferPool(K,
O.vertexAttributeLocations,f.glLayout(this._bufferWriter.vertexBufferLayout))}var M=H.prototype;M.dispose=function(){this._glMaterials.destroy();this._dataByOrigin.forEach(K=>K.buffer.dispose());this._dataByOrigin.clear();this._bufferPool.dispose()};M.modify=function(K){this._updateGeometries(K.updates);this._addAndRemoveGeometries(K.adds,K.removes);this._updateRenderCommands()};M._addAndRemoveGeometries=function(K,I){const O=this._bufferWriter,Q=O.vertexBufferLayout.stride/4,J=this._dataByOrigin,
P=x(K,I);P.forEach((N,R)=>{P.delete(R);var S=N.toAdd.reduce((U,aa)=>U+O.elementCount(aa.data),0);let T=J.get(R);if(null==T)m.assert(0===N.toRemove.length),T=new B(N.origin,new q.MergedGeometryBuffer(this._bufferPool,S*Q)),J.set(R,T);else if(0===N.toAdd.length&&T.instances.size===N.toRemove.length){T.buffer.dispose();J.delete(R);return}let V=0;T.instances.forEach(U=>V+=U.to-U.from);R=N.toRemove.reduce((U,aa)=>U+O.elementCount(aa.data),0);R=(V+S-R)*Q;S=C;R<T.buffer.size/2?this._removeAndRebuild(T,N.toRemove,
Q,R,S):0<N.toRemove.length&&this._remove(T,N.toRemove,Q,S);0<N.toAdd.length&&(R=F,m.setMatrixTranslation3(R,-N.origin[0],-N.origin[1],-N.origin[2]),this._add(T,N.toAdd,Q,R,S));const W=T.buffer.vao.vertexBuffers.geometry;y(S);S.forAll(({from:U,to:aa})=>{U<aa&&(U*=4,W.setSubData(T.buffer.array,U,U,4*aa))});S.clear();T.drawCommandsDirty=!0})};M._updateGeometries=function(K){const I=this._bufferWriter,O=I.vertexBufferLayout.stride/4;for(const Q of K){K=Q.renderGeometry;const J=this._dataByOrigin.get(K.origin.id),
P=J&&J.instances.get(K.id);if(!P)break;const N=Q.updateType;N&e.ModelDirty.State.VISIBILITIES&&(P.isVisible=K.instanceParameters.visible);if(N&(e.ModelDirty.State.HIGHLIGHTS|e.ModelDirty.State.VISIBILITIES)){const R=K.instanceParameters.visible;P.hasHighlights=!!K.instanceParameters.highlights&&R}N&e.ModelDirty.State.OCCLUDEES&&(P.hasOccludees=!!K.instanceParameters.occludees);if(N&(e.ModelDirty.State.VERTEXATTRS|e.ModelDirty.State.TRANSFORMATION)){const {array:R,vao:S}=J.buffer;r.calculateTransformRelativeToOrigin(K,
G,L);I.write({transformation:G,invTranspTransformation:L},K.data,I.vertexBufferLayout.createView(R.buffer),P.from);m.assert(P.from+I.elementCount(K.data)===P.to,"material VBO layout has changed");S.vertexBuffers.geometry.setSubData(R,P.from*O*4,P.from*O*4,P.to*O*4)}J.drawCommandsDirty=!0}};M._updateRenderCommands=function(){this._hasOccludees=this._hasHighlights=!1;this._dataByOrigin.forEach(I=>{I.hasHiddenInstances=!1;I.hasHighlights=!1;I.hasOccludees=!1;c.someMap(I.instances,O=>{O.isVisible?(O.hasHighlights&&
(this._hasHighlights=!0,I.hasHighlights=!0),O.hasOccludees&&(this._hasOccludees=!0,I.hasOccludees=!0)):I.hasHiddenInstances=!0;return I.hasHiddenInstances&&I.hasHighlights&&I.hasOccludees})});const K=I=>{I.drawCommandsDefault=null;I.drawCommandsHighlight=null;I.drawCommandsOccludees=null;I.drawCommandsShadowHighlightRest=null;if(0!==I.instances.size)if(I.hasOccludees||I.hasHighlights||I.hasHiddenInstances){var O=v.sortInstancesByRange(I.instances);I.drawCommandsDefault=[];I.drawCommandsHighlight=
[];I.drawCommandsOccludees=[];I.drawCommandsShadowHighlightRest=[];for(const Q of O)Q.isVisible&&(Q.hasOccludees?v.addOrMerge(I.drawCommandsOccludees,Q):v.addOrMerge(I.drawCommandsDefault,Q),Q.hasHighlights?v.addOrMerge(I.drawCommandsHighlight,Q):v.addOrMerge(I.drawCommandsShadowHighlightRest,Q))}else I.drawCommandsDefault=[{first:0,count:4*I.buffer.size/this._bufferWriter.vertexBufferLayout.stride}]};this._dataByOrigin.forEach(I=>{I.drawCommandsDirty&&(K(I),I.drawCommandsDirty=!1)})};M.updateAnimation=
function(K){return this._material.update(K)};M.requiresSlot=function(K,I){return null==K||this._material.requiresSlot(K,I)};M.render=function(K,I,O){if(!this.requiresSlot(K,I))return!1;const Q=I===d.RenderPass.MATERIAL_HIGHLIGHT||I===d.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT;if(Q&&!this._hasHighlights)return!1;const J=I===d.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,P=!(Q||J);this._dataByOrigin.forEach(S=>{if(!Q||S.hasHighlights){var T=(Q?S.drawCommandsHighlight:J&&(S.hasOccludees||S.hasHighlights||
S.hasHiddenInstances)?S.drawCommandsShadowHighlightRest:S.drawCommandsDefault)||null,V=P&&S.drawCommandsOccludees||null;(g.isSome(T)||g.isSome(V))&&this._renderCommandData.push(new D(S.origin,S.buffer,T,V))}});if(0===this._renderCommandData.length)return!1;const N=this._rctx;I=this._glMaterials.load(N,I);if(g.isNone(I))return this._renderCommandData.clear(),!1;const R=I.beginSlot(O);N.useTechnique(R,K,!1);I.bind(O,R);this._renderCommandData.forAll(({origin:S,buffer:T,renderCommands:V,occludeeCommands:W})=>
{O.origin=S;R.bindDraw(O);R.ensureAttributeLocations(T.vao);N.bindVAO(T.vao);S=R.primitiveType;g.isSome(V)&&this._renderCommands(N,S,V);g.isSome(W)&&(R.bindPipelineState(N,K,!0),this._renderCommands(N,S,W),R.bindPipelineState(N,K,!1))});this._renderCommandData.clear();return!0};M._renderCommands=function(K,I,O){for(let Q=0;Q<O.length;Q++)K.drawArrays(I,O[Q].first,O[Q].count)};M._removeAndRebuild=function(K,I,O,Q,J){for(var P of I)K.instances.delete(P.id);var N=v.sortInstancesByRange(K.instances);
K.instances.clear();I=K.buffer.size;Q=K.buffer.alloc(Q);P=0;for(const R of N){N=R.from*O;const S=R.to*O;Q.copy(P,N,S);R.from=P/O;P+=S-N;R.to=P/O;K.instances.set(R.id,R)}J.push(new v.BufferRange(0,Q.hasNewBuffer?K.buffer.array.length:I));Q.dispose();K.buffer.erase(P,J.back().to);K.holes.clear()};M._remove=function(K,I,O,Q){for(const J of I){I=J.id;const P=K.instances.get(I),N=P.from*O,R=P.to*O;K.buffer.erase(N,R);K.holes.push(new v.BufferRange(P.from,P.to));K.instances.delete(I);Q.push(new v.BufferRange(N,
R))}y(K.holes)};M._add=function(K,I,O,Q,J){if(0!==I.length){var P=this._bufferWriter,N=P.vertexBufferLayout.createView(K.buffer.array.buffer),R=0<K.holes.length,S=Number.MAX_SAFE_INTEGER,T=Number.MIN_SAFE_INTEGER;for(const W of I){var V=g.isSome(W.transformation)?w.multiply(G,Q,W.transformation):Q;w.invert(L,V);const U=w.transpose(L,L);I=P.elementCount(W.data);const aa=I*O;let da=E(K.holes,I);g.isNone(da)&&(da=K.buffer.size/O,K.buffer.grow(aa),N=P.vertexBufferLayout.createView(K.buffer.array.buffer));
P.write({transformation:V,invTranspTransformation:U},W.data,N,da);V=W.instanceParameters.visible;I=new v.Instance(W.id,da,da+I,V,!!W.instanceParameters.highlights&&V,!!W.instanceParameters.occludees);m.assert(null==K.instances.get(W.id));K.instances.set(W.id,I);R?J.push(new v.BufferRange(I.from*O,I.to*O)):(S=Math.min(I.from,S),T=Math.max(I.to,T))}R||J.push(new v.BufferRange(S*O,T*O))}};b._createClass(H,[{key:"isEmpty",get:function(){return 0===this._dataByOrigin.size}},{key:"hasHighlights",get:function(){return this._hasHighlights}},
{key:"hasOccludees",get:function(){return this._hasOccludees}},{key:"hasWater",get:function(){return!this.isEmpty&&this._material instanceof z.WaterMaterial}},{key:"rendersOccluded",get:function(){return!this.isEmpty&&this._material.renderOccluded!==k.RenderOccludedFlag.Occlude}},{key:"test",get:function(){return{material:this._material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}]);return H}(),p=function(H){this.origin=H;this.toAdd=[];this.toRemove=[]},B=function(H,M){this.origin=
H;this.buffer=M;this.instances=new Map;this.holes=new h({deallocator:null});this.drawCommandsDirty=this.hasOccludees=this.hasHighlights=this.hasHiddenInstances=!1},D=function(H,M,K,I){this.origin=H;this.buffer=M;this.renderCommands=K;this.occludeeCommands=I};const C=new h({deallocator:null}),F=n.create(),G=n.create(),L=n.create();a.MergedRenderer=A;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GLMaterials":function(){define(["exports","../../../../core/maybe",
"../core/shaderLibrary/ShaderOutputOptions","./basicInterfaces","./RenderPass"],function(a,b,c,g,h){function w(f){switch(f){default:case h.RenderPass.MATERIAL:return c.ShaderOutput.Color;case h.RenderPass.MATERIAL_ALPHA:return c.ShaderOutput.Alpha;case h.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL:return c.ShaderOutput.Shadow;case h.RenderPass.MATERIAL_NORMAL:return c.ShaderOutput.Normal;case h.RenderPass.MATERIAL_DEPTH:return c.ShaderOutput.Depth;case h.RenderPass.MATERIAL_HIGHLIGHT:return c.ShaderOutput.Highlight;
case h.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:return c.ShaderOutput.Shadow;case h.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return c.ShaderOutput.Shadow}}let n=function(){function f(k,e){this._material=k;this._repository=e;this._map=new Map}var l=f.prototype;l.destroy=function(){this._map.forEach((k,e)=>{b.isSome(k)&&this._repository.release(this._material,w(e))})};l.load=function(k,e){this._map.has(e)||this._map.set(e,this._repository.acquire(this._material,w(e)));e=this._map.get(e);if(b.isSome(e)){if(e.ensureResources(k)===
g.ResourceState.LOADED)return e;this._repository.requestRender()}return null};return f}();a.GLMaterials=n;a.outputFromPass=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ModelDirtyTypes":function(){define(["exports"],function(a){a.ModelDirty=void 0;(function(b){(function(c){c[c.ADD=1]="ADD";c[c.UPDATE=2]="UPDATE";c[c.REMOVE=4]="REMOVE"})(b.Geometry||(b.Geometry={}));(function(c){c[c.VISIBILITIES=1]="VISIBILITIES";c[c.VERTEXATTRS=2]="VERTEXATTRS";c[c.TRANSFORMATION=
4]="TRANSFORMATION";c[c.HIGHLIGHTS=8]="HIGHLIGHTS";c[c.OCCLUDEES=16]="OCCLUDEES"})(b.State||(b.State={}))})(a.ModelDirty||(a.ModelDirty={}));Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/WaterMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/ShaderOutputOptions ../lib/AnimationTimer ../lib/GLMaterials ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ./WaterGLMaterial ./WaterTechnique ./internal/DefaultBufferWriter ./internal/MaterialUtil ./internal/waterMaterialUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m){w=function(z){function v(t){t=z.call(this,t,m.defaultWaterMaterialParameters)||this;t._techniqueConfig=new k.WaterTechniqueConfiguration;t.animation=new g.AnimationTimer;return t}b._inheritsLoose(v,z);var q=v.prototype;q.getTechniqueConfig=function(t,r){this._techniqueConfig.output=t;this._techniqueConfig.writeDepth=this.parameters.writeDepth;this._techniqueConfig.receiveShadows=this.parameters.receiveShadows;this._techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled;
this._techniqueConfig.transparent=this.parameters.transparent;this._techniqueConfig.useSSR=this.parameters.ssrEnabled;this._techniqueConfig.isDraped=this.parameters.isDraped;this._techniqueConfig.transparencyPassType=r.transparencyPassType;this._techniqueConfig.enableOffset=r.camera.relativeElevation<n.OITPolygonOffsetLimit;this._techniqueConfig.multipassTerrainEnabled=r.multipassTerrainEnabled;this._techniqueConfig.cullAboveGround=r.cullAboveGround;return this._techniqueConfig};q.update=function(t){this.animation.enabled=
35E3>Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*Math.min(t.camera.relativeElevation,t.camera.distance);t=this.animation.advance(t);return this.animation.enabled&&t};q.intersect=function(t,r,x,u,E,y,A){d.intersectTriangleGeometry(t,r,u,E,y,void 0,A)};q.requiresSlot=function(t,r){switch(h.outputFromPass(r)){case c.ShaderOutput.Normal:return t===f.RenderSlot.DRAPED_WATER;case c.ShaderOutput.Color:if(this.parameters.isDraped)return t===f.RenderSlot.DRAPED_MATERIAL;break;
case c.ShaderOutput.Highlight:return t===f.RenderSlot.OPAQUE_MATERIAL||t===f.RenderSlot.DRAPED_MATERIAL}r=f.RenderSlot.OPAQUE_MATERIAL;this.parameters.transparent&&(r=this.parameters.writeDepth?f.RenderSlot.TRANSPARENT_MATERIAL:f.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);return t===r};q.createGLMaterial=function(t){if(t.output===c.ShaderOutput.Color&&this.parameters.isDraped)return t.output=c.ShaderOutput.Draped,new l.WaterGLMaterial(t);switch(t.output){case c.ShaderOutput.Color:case c.ShaderOutput.Normal:case c.ShaderOutput.Highlight:case c.ShaderOutput.Alpha:return new l.WaterGLMaterial(t)}return null};
q.createBufferWriter=function(){return new e.DefaultBufferWriter(e.PositionUVLayout)};return v}(w.Material);a.WaterMaterial=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/WaterGLMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/ShaderOutputOptions ../lib/basicInterfaces ../lib/GLMaterial ./WaterTechnique".split(" "),function(a,b,c,g,h,w){h=function(n){function f(){return n.apply(this,arguments)||this}
b._inheritsLoose(f,n);var l=f.prototype;l.updateParameters=function(k){return this.ensureTechnique(w.WaterTechnique,k)};l.setElapsedTimeUniform=function(k){k.setUniform1f("timeElapsed",.001*this._material.animation.time*this._material.parameters.animationSpeed)};l._updateShadowState=function(k){k.shadowMappingEnabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:k.shadowMappingEnabled})};l._updateSSRState=function(k){k.ssrEnabled!==this._material.parameters.ssrEnabled&&
this._material.setParameters({ssrEnabled:k.ssrEnabled})};l.ensureResources=function(k){const e=this._techniqueRep.constructionContext.waterTextureRepository;e.ready||e.updating||e.loadTextures(k);return e.ready?g.ResourceState.LOADED:g.ResourceState.LOADING};l.beginSlot=function(k){this._output===c.ShaderOutput.Color&&(this._updateShadowState(k),this._updateSSRState(k));return this.updateParameters(k)};l.bind=function(k,e){e.bindPass(this._material.parameters,k);this._output!==c.ShaderOutput.Normal&&
this._output!==c.ShaderOutput.Color||this.setElapsedTimeUniform(e.program)};return f}(h);a.WaterGLMaterial=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/WaterTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../environment/CloudsComposition ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/shading/ScreenSpaceReflections.glsl ../core/shaderLibrary/shading/WaterDistortion.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../../../../chunks/WaterSurface.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B){r=function(D){function C(G,L,H){L=D.call(this,G,L,H)||this;L._textureRepository=G.waterTextureRepository;return L}c._inheritsLoose(C,D);var F=C.prototype;F.initializeProgram=function(G){var L=C.shader.get();const H=this.configuration;L=L.build({oitEnabled:H.transparencyPassType===u.TransparencyPassType.Color,output:H.output,viewingMode:G.viewingMode,slicePlaneEnabled:H.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,
receiveShadows:H.receiveShadows,pbrMode:d.PBRMode.Water,useCustomDTRExponentForWater:!0,ssrEnabled:H.useSSR,cloudsReflectionsEnabled:h("enable-feature:clouds-reflections"),highStepCount:!0,multipassTerrainEnabled:H.multipassTerrainEnabled,cullAboveGround:H.cullAboveGround});return new A.Program(G.rctx,L,E.Default3D)};F.bindPass=function(G,L){q.bindProjectionMatrix(this.program,L.camera.projectionMatrix);L.multipassTerrainEnabled&&(this.program.setUniform2fv("nearFar",L.camera.nearFar),this.program.setUniform2fv("inverseViewport",
L.inverseViewport),e.bindMultipassTerrainTexture(this.program,L));this.configuration.output===f.ShaderOutput.Color&&(L.lighting.setUniforms(this.program,!1,!1),z.bindSSRUniforms(this.program,L),h("enable-feature:clouds-reflections")&&w.isSome(L.cloudsCompositionParams)&&n.bindCloudsComposition(this.program,L.camera,L.cloudsCompositionParams));if(this.configuration.output===f.ShaderOutput.Color||this.configuration.output===f.ShaderOutput.Normal)v.bindWaterDistortionUniforms(this.program,G),this._textureRepository.bind(this.program);
this.program.setUniform4fv("waterColor",G.color);this.configuration.output===f.ShaderOutput.Highlight&&k.bindOutputHighlight(this.program,L)};F.bindDraw=function(G){q.bindView(this.program,G);this.program.rebindTextures();this.configuration.output!==f.ShaderOutput.Color&&this.configuration.output!==f.ShaderOutput.Alpha||q.bindCameraPosition(this.program,G.origin,G.camera.viewInverseTransposeMatrix);this.configuration.output===f.ShaderOutput.Color&&m.bindReadShadowMapUniforms(this.program,G);this.configuration.output!==
f.ShaderOutput.Color&&this.configuration.output!==f.ShaderOutput.Alpha&&this.configuration.output!==f.ShaderOutput.Highlight||l.bindSliceUniformsWithOrigin(this.program,this.configuration,G)};F._setPipelineState=function(G){const L=this.configuration,H=G===u.TransparencyPassType.NONE,M=G===u.TransparencyPassType.FrontFace;return B.makePipelineState({blending:L.output!==f.ShaderOutput.Normal&&L.output!==f.ShaderOutput.Highlight&&L.transparent?H?y.blendingDefault:y.oitBlending(G):null,depthTest:{func:y.oitDepthTest(G)},
depthWrite:H?L.writeDepth&&B.defaultDepthWriteParams:y.oitDepthWrite(G),colorWrite:B.defaultColorWriteParams,polygonOffset:H||M?null:y.getOITPolygonOffset(L.enableOffset)})};F.initializePipeline=function(){return this._setPipelineState(this.configuration.transparencyPassType)};return C}(r.ShaderTechnique);r.shader=new t.ReloadableShaderModule(p.WaterSurface,()=>new Promise((D,C)=>a(["../shaders/WaterSurface.glsl"],D,C)));t=function(D){function C(){var F=D.apply(this,arguments)||this;F.output=f.ShaderOutput.Color;
F.receiveShadows=!1;F.slicePlaneEnabled=!1;F.transparent=!1;F.enableOffset=!0;F.writeDepth=!1;F.useSSR=!1;F.isDraped=!1;F.transparencyPassType=u.TransparencyPassType.NONE;F.multipassTerrainEnabled=!1;F.cullAboveGround=!1;return F}c._inheritsLoose(C,D);return C}(x.ShaderTechniqueConfiguration);g.__decorate([x.parameter({count:f.ShaderOutput.COUNT})],t.prototype,"output",void 0);g.__decorate([x.parameter()],t.prototype,"receiveShadows",void 0);g.__decorate([x.parameter()],t.prototype,"slicePlaneEnabled",
void 0);g.__decorate([x.parameter()],t.prototype,"transparent",void 0);g.__decorate([x.parameter()],t.prototype,"enableOffset",void 0);g.__decorate([x.parameter()],t.prototype,"writeDepth",void 0);g.__decorate([x.parameter()],t.prototype,"useSSR",void 0);g.__decorate([x.parameter()],t.prototype,"isDraped",void 0);g.__decorate([x.parameter({count:u.TransparencyPassType.COUNT})],t.prototype,"transparencyPassType",void 0);g.__decorate([x.parameter()],t.prototype,"multipassTerrainEnabled",void 0);g.__decorate([x.parameter()],
t.prototype,"cullAboveGround",void 0);b.WaterTechnique=r;b.WaterTechniqueConfiguration=t;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl":function(){define(["exports","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,b,c){a.ReadShadowMap=function(g){g.fragment.include(b.RgbaFloatEncoding);g.fragment.uniforms.add("shadowMapTex","sampler2D");g.fragment.uniforms.add("numCascades","int");g.fragment.uniforms.add("cascadeDistances",
"vec4");g.fragment.uniforms.add("shadowMapMatrix","mat4",4);g.fragment.uniforms.add("depthHalfPixelSz","float");g.fragment.code.add(c.glsl`int chooseCascade(float _linearDepth, out mat4 mat) {
vec4 distance = cascadeDistances;
float depth = _linearDepth;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture2D(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {
float texSize = 0.5 / halfPixelSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, depthHalfPixelSz, shadowMapTex);
}`)};a.bindReadShadowMapUniforms=function(g,h){h.shadowMappingEnabled&&(h.shadowMap.bind(g),h.shadowMap.bindView(g,h.origin))};a.bindReadShadowMapView=function(g,h){h.shadowMappingEnabled&&h.shadowMap.bindView(g,h.origin)};a.bindReadShadowMapViewCustomOrigin=function(g,h,w){h.shadowMappingEnabled&&h.shadowMap.bindView(g,w)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl":function(){define(["exports","../output/ReadLinearDepth.glsl",
"./Reprojection.glsl","../../shaderModules/interfaces"],function(a,b,c,g){a.ScreenSpaceReflections=function(h,w){h.fragment.uniforms.add("nearFar","vec2");h.fragment.uniforms.add("depthMapView","sampler2D");h.fragment.uniforms.add("view","mat4");h.fragment.uniforms.add("invResolutionHeight","float");h.fragment.include(b.ReadLinearDepth);h.include(c.Reprojection);h.fragment.code.add(g.glsl`
  const int maxSteps = ${w.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
          return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)};a.bindSSRUniforms=function(h,w){w.ssrEnabled&&(h.bindTexture(w.linearDepthTexture,"depthMapView"),h.setUniform2fv("nearFar",w.camera.nearFar),h.setUniformMatrix4fv("view",w.camera.viewMatrix),h.setUniform1f("invResolutionHeight",1/w.camera.height),c.bindReprojectionUniforms(h,w))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Reprojection.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.Reprojection=
function(c){c.fragment.uniforms.add("lastFrameColorMap","sampler2D");c.fragment.uniforms.add("reprojectionMatrix","mat4");c.fragment.uniforms.add("proj","mat4");c.fragment.code.add(b.glsl`vec2 reprojectionCoordinate(vec3 projectionCoordinate)
{
vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
reprojectedCoord.xy /= reprojectedCoord.w;
return reprojectedCoord.xy * 0.5 + 0.5;
}`)};a.bindReprojectionUniforms=function(c,g){c.bindTexture(g.lastFrameColorTexture,"lastFrameColorMap");c.setUniformMatrix4fv("reprojectionMatrix",g.reprojectionMatrix);c.setUniformMatrix4fv("proj",g.camera.projectionMatrix)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl":function(){define(["exports","./FoamRendering.glsl","../../shaderModules/interfaces"],function(a,b,c){a.WaterDistortion=function(g){g.fragment.uniforms.add("texWaveNormal",
"sampler2D");g.fragment.uniforms.add("texWavePerturbation","sampler2D");g.fragment.uniforms.add("waveParams","vec4");g.fragment.uniforms.add("waveDirection","vec2");g.include(b.FoamIntensity);g.fragment.code.add(c.glsl`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)};a.bindWaterDistortionUniforms=function(g,h){g.setUniform4f("waveParams",h.waveStrength,h.waveTextureRepeat,h.flowStrength,h.flowOffset);g.setUniform2f("waveDirection",h.waveDirection[0]*h.waveVelocity,h.waveDirection[1]*h.waveVelocity)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/FoamRendering.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.FoamColor=function(c){c.fragment.code.add(b.glsl`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)};a.FoamIntensity=function(c){c.fragment.code.add(b.glsl`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/WaterSurface.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateMainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u){function E(A){const p=new x.ShaderBuilder;p.include(h.Transform,{linearDepth:!1});p.attributes.add(u.VertexAttribute.POSITION,"vec3");p.attributes.add(u.VertexAttribute.UV0,"vec2");p.vertex.uniforms.add("proj","mat4").add("view","mat4").add("localOrigin","vec3");p.vertex.uniforms.add("waterColor","vec4");if(A.output===c.ShaderOutput.Color||A.output===c.ShaderOutput.Alpha)p.include(e.NormalUtils,A),p.include(b.ForwardLinearDepth,A),p.varyings.add("vuv",
"vec2"),p.varyings.add("vpos","vec3"),p.varyings.add("vnormal","vec3"),p.varyings.add("vtbnMatrix","mat3"),p.fragment.uniforms.add("localOrigin","vec3"),A.multipassTerrainEnabled&&p.varyings.add("depth","float"),p.vertex.code.add(r.glsl`
      void main(void) {
        if (waterColor.a < ${r.glsl.float(q.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${A.multipassTerrainEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${A.output===c.ShaderOutput.Color?"forwardLinearDepth();":""}
      }
    `);A.multipassTerrainEnabled&&(p.fragment.include(n.ReadLinearDepth),p.include(k.multipassTerrainTest,A));A.output===c.ShaderOutput.Alpha&&(p.include(g.Slice,A),p.fragment.uniforms.add("waterColor","vec4"),p.fragment.code.add(r.glsl`
        void main() {
          discardBySlice(vpos);
          ${A.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `));A.output===c.ShaderOutput.Color&&(p.include(l.EvaluateMainLighting),p.include(f.EvaluateAmbientLighting,{pbrMode:d.PBRMode.Disabled,lightingSphericalHarmonicsOrder:2}),p.include(v.WaterDistortion,A),p.include(g.Slice,A),A.receiveShadows&&p.include(m.ReadShadowMap,A),p.include(z.Water,A),p.fragment.uniforms.add("waterColor","vec4").add("lightingMainDirection","vec3").add("lightingMainIntensity","vec3").add("lightingSpecularStrength","float").add("lightingEnvironmentStrength","float").add("cameraPosition",
"vec3").add("timeElapsed","float").add("view","mat4"),p.fragment.include(t.ColorConversion),p.fragment.code.add(r.glsl`
      void main() {
        discardBySlice(vpos);
        ${A.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${A.receiveShadows?r.glsl`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${A.oitEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));A.output===c.ShaderOutput.Normal&&(p.include(e.NormalUtils,A),p.include(v.WaterDistortion,A),p.include(g.Slice,A),p.varyings.add("vpos","vec3"),p.varyings.add("vuv","vec2"),p.vertex.code.add(r.glsl`
        void main(void) {
          if (waterColor.a < ${r.glsl.float(q.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),p.fragment.uniforms.add("timeElapsed","float"),p.fragment.code.add(r.glsl`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`));A.output===c.ShaderOutput.Draped&&(p.varyings.add("vpos","vec3"),p.vertex.code.add(r.glsl`
        void main(void) {
          if (waterColor.a < ${r.glsl.float(q.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),p.fragment.uniforms.add("waterColor","vec4"),p.fragment.code.add(r.glsl`void main() {
gl_FragColor = waterColor;
}`));A.output===c.ShaderOutput.Highlight&&(p.include(w.OutputHighlight),p.varyings.add("vpos","vec3"),p.vertex.code.add(r.glsl`
      void main(void) {
        if (waterColor.a < ${r.glsl.float(q.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),p.include(g.Slice,A),p.fragment.code.add(r.glsl`void main() {
discardBySlice(vpos);
outputHighlight();
}`));return p}const y=Object.freeze({__proto__:null,build:E});a.WaterSurface=y;a.build=E})},"esri/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl":function(){define(["exports","./ShaderOutputOptions","../shaderModules/interfaces"],function(a,b,c){a.ForwardLinearDepth=function(g,h){h.output===b.ShaderOutput.Color&&h.receiveShadows?(g.varyings.add("linearDepth","float"),g.vertex.code.add(c.glsl`void forwardLinearDepth() { linearDepth = gl_Position.w; }`)):h.output===b.ShaderOutput.Depth||
h.output===b.ShaderOutput.Shadow?(g.varyings.add("linearDepth","float"),g.vertex.uniforms.add("nearFar","vec2"),g.vertex.code.add(c.glsl`void forwardLinearDepth() {
linearDepth = (-position_view().z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)):g.vertex.code.add(c.glsl`void forwardLinearDepth() {}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl":function(){define(["exports","../../../../../ViewingMode","../../shaderModules/interfaces"],function(a,b,c){a.NormalUtils=function(g,h){h.viewingMode===b.ViewingMode.Global?g.vertex.code.add(c.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):g.vertex.code.add(c.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`);h.viewingMode===b.ViewingMode.Global?g.vertex.code.add(c.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):g.vertex.code.add(c.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl":function(){define("exports ./FoamRendering.glsl ./Gamma.glsl ./PhysicallyBasedRendering.glsl ./ScreenSpaceReflections.glsl ../util/CloudsParallaxShading.glsl ../../shaderModules/interfaces".split(" "),function(a,b,c,g,h,w,n){a.Water=function(f,l){f.include(g.PhysicallyBasedRendering,l);f.include(c.Gamma);f.include(b.FoamColor);l.cloudsReflectionsEnabled&&f.include(w.CloudsParallaxShading);
l.ssrEnabled&&f.include(h.ScreenSpaceReflections,l);f.fragment.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3E5).add("ssrHeightFadeEnd","float",5E5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",
[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]);f.fragment.code.add(n.glsl`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`);f.fragment.code.add(n.glsl`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`);l.cloudsReflectionsEnabled&&f.fragment.code.add(n.glsl`vec4 cloudsColor = crossFade == 0 ? renderCloud(reflectedWorld, position) : renderCloudCrossFade(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * (1.0 - totalFadeInOut);`);l.ssrEnabled?f.fragment.code.add(n.glsl`vec4 viewPosition = vec4(positionView.xyz, 1.0);
vec3 viewDir = normalize(viewPosition.xyz);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view *vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);
reflectionHit = clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod*0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor + reflSea * seaColorMod + specular  + foam);`):f.fragment.code.add(n.glsl`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`);l.cloudsReflectionsEnabled?l.ssrEnabled?f.fragment.code.add(n.glsl`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):f.fragment.code.add(n.glsl`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):f.fragment.code.add(n.glsl`return waterRenderedColor;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl":function(){define(["exports","./AnalyticalSkyModel.glsl","./PhysicallyBasedRenderingParameters.glsl","./PiUtils.glsl","../../shaderModules/interfaces"],function(a,b,c,g,h){a.PhysicallyBasedRendering=function(w,n){const f=w.fragment.code;w.include(g.PiUtils);if(n.pbrMode===c.PBRMode.Water||n.pbrMode===c.PBRMode.WaterOnIntegratedMesh)f.add(h.glsl`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${n.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),f.add(h.glsl`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),f.add(h.glsl`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),f.add(h.glsl`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),f.add(h.glsl`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`);else if(n.pbrMode===c.PBRMode.Normal||n.pbrMode===c.PBRMode.Schematic)w.include(b.AnalyticalSkyModel),f.add(h.glsl`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),f.add(h.glsl`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),f.add(h.glsl`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`),f.add(h.glsl`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),f.add(h.glsl`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),f.add(h.glsl`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/AnalyticalSkyModel.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.AnalyticalSkyModel=function(c){c=c.fragment.code;c.add(b.glsl`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`);c.add(b.glsl`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`);c.add(b.glsl`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/internal/DefaultBufferWriter":function(){define(["exports","../../../support/buffer/InterleavedLayout","../../lib/VertexAttribute","./bufferWriterUtils"],function(a,b,c,g){const h=b.newLayout().vec3f(c.VertexAttribute.POSITION),w=b.newLayout().vec3f(c.VertexAttribute.POSITION).vec2f(c.VertexAttribute.UV0);b=b.newLayout().vec3f(c.VertexAttribute.POSITION).vec4u8(c.VertexAttribute.COLOR);let n=function(){function f(k){this.vertexBufferLayout=
k}var l=f.prototype;l.allocate=function(k){return this.vertexBufferLayout.createBuffer(k)};l.elementCount=function(k){return k.indices.get(c.VertexAttribute.POSITION).length};l.write=function(k,e,d,m){g.writeDefaultAttributes(e,this.vertexBufferLayout,k.transformation,k.invTranspTransformation,d,m)};return f}();a.DefaultBufferWriter=n;a.PositionColorLayout=b;a.PositionLayout=h;a.PositionUVLayout=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/internal/waterMaterialUtils":function(){define(["exports",
"../../../../../chunks/vec2f64","../../lib/Material"],function(a,b,c){b={waveStrength:.06,waveTextureRepeat:32,waveDirection:b.fromValues(1,0),waveVelocity:.05,flowStrength:.015,flowOffset:-.5,animationSpeed:.35,color:[0,0,0,0],transparent:!0,writeDepth:!0,slicePlaneEnabled:!1,isDraped:!1,receiveShadows:!0,ssrEnabled:!1,...c.DefaultMaterialParameters};a.defaultWaterMaterialParameters=b;a.wavePresets={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,
perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,
waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/renderers/Instance":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){function c(n,f){return n.from===f.from?n.to-f.to:n.from-f.from}let g=function(n){this.first=n.from;this.count=n.to-n.from},h=function(n=0,f=0){this.from=n;this.to=f},w=function(n){function f(l,k,e,d,m,z){k=n.call(this,k,e)||this;k.id=l;k.isVisible=d;k.hasHighlights=m;k.hasOccludees=z;return k}b._inheritsLoose(f,n);return f}(h);
a.BufferRange=h;a.DrawCommand=g;a.Instance=w;a.addOrMerge=function(n,f){if(0===n.length)n.push(new g(f));else{var l=n[n.length-1];l.first+l.count>=f.from?l.count=f.from-l.first+f.to-f.from:n.push(new g(f))}};a.sortInstancesByRange=function(n){return Array.from(n.values()).sort(c)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/renderers/MergedGeometryBuffer":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){function c(h,
w,n){return w<=n?h>=n?h:65536*Math.ceil(Math.max(2*h,n)/65536):h<=2*n?h:65536*Math.ceil(n/65536)}let g=function(){function h(n,f){this._pool=n;this._size=0;this._buffer=n.newBuffer(65536*Math.ceil(f/65536))}var w=h.prototype;w.dispose=function(){this._buffer=this._pool.deleteBuffer(this._buffer);this._size=0};w.release=function(){this.erase(0,this._size);this.dispose()};w.grow=function(n){this._resize(this._size+n,!0).dispose()};w.alloc=function(n){return this._resize(n,!1)};w._resize=function(n,
f){let l;const k=c(this._buffer.length,this._size,n);if(this._buffer.length!==k){const d=this._pool.newBuffer(k);f&&(d.array.set(this._buffer.array.subarray(0,Math.min(this._size,k))),d.vao.vertexBuffers.geometry.setSubData(d.array,0,0,d.array.byteLength));l=this._buffer;this._buffer=d}const e=this._size;this._size=n;return l?{dispose:()=>{l.array.fill(0,0,e);this._pool.deleteBuffer(l)},copy:(d,m,z)=>this._buffer.array.set(l.array.subarray(m,z),d),hasNewBuffer:!0}:{dispose:()=>{},copy:(d,m,z)=>{d!==
m&&this._buffer.array.copyWithin(d,m,z)},hasNewBuffer:!1}};w.erase=function(n,f){this._buffer.array.fill(0,n,f)};b._createClass(h,[{key:"vao",get:function(){return this._buffer.vao}},{key:"array",get:function(){return this._buffer.array}},{key:"size",get:function(){return this._size}}]);return h}();a.MergedGeometryBuffer=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/renderers/MergedGeometryBufferPool":function(){define(["exports","../../../../../core/maybe",
"../../../../../core/MemCache","../../../../../core/uid","../../lib/StaticFloat32ArrayObject"],function(a,b,c,g,h){function w(l,k){if(k===c.RemoveMode.ALL)l.forEach(e=>e.dispose());else return k=l.pop(),l=l.length*k.array.byteLength,k.dispose(),l}const n=c.MIN_PRIORITY+1;let f=function(){function l(e,d,m){this._rctx=e;this._locations=d;this._layout=m;this._cache=e.newCache(`MergedRenderer pool ${g.generateUID()}`,w)}var k=l.prototype;k.dispose=function(){this._cache.destroy()};k.newBuffer=function(e){const d=
e.toString(),m=this._cache.pop(d);return b.isSome(m)?(e=m.pop(),0<m.length&&this._cache.put(d,m,e.array.byteLength*m.length,n),e):new h.StaticFloat32ArrayObject(this._rctx,this._locations,this._layout,e)};k.deleteBuffer=function(e){const d=e.array.byteLength,m=e.array.length.toString(),z=this._cache.pop(m);b.isSome(z)?(z.push(e),this._cache.put(m,z,d*z.length,-1)):this._cache.put(m,[e],d,-1);return null};return l}();a.MergedGeometryBufferPool=f;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/webgl-engine/lib/StaticFloat32ArrayObject":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../webgl/BufferObject","../../../webgl/enums","../../../webgl/VertexArrayObject"],function(a,b,c,g,h){let w=function(){function n(f,l,k,e){this.vao=new h.VertexArrayObject(f,l,{geometry:k},{geometry:c.BufferObject.createVertex(f,g.Usage.STATIC_DRAW)});this.array=new Float32Array(e);this.vao.vertexBuffers.geometry.setSize(this.array.byteLength)}n.prototype.dispose=
function(){this.vao.dispose(!0)};b._createClass(n,[{key:"length",get:function(){return this.array.length}}]);return n}();a.StaticFloat32ArrayObject=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/HeatmapDensityMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/RenderPass ../lib/RenderSlot ../lib/VertexAttribute ./internal/bufferWriterUtils ../shaders/HeatmapDensityTechnique".split(" "),
function(a,b,c,g,h,w,n,f,l,k){const e={searchRadius:128,resolutionForScale:0,colorRampData:null,isAttributeDriven:!1,minDensity:0,maxDensity:100,fieldTotal:0,pixelRatio:1,...h.DefaultMaterialParameters};let d=function(t){function r(u){u=t.call(this,u,e)||this;u._techniqueConfig=new k.HeatmapDensityTechniqueConfiguration;return u}b._inheritsLoose(r,t);var x=r.prototype;x.requiresSlot=function(u,E){return u===n.RenderSlot.DRAPED_MATERIAL&&E===w.RenderPass.MATERIAL};x.getTechniqueConfig=function(){this._techniqueConfig.isAttributeDriven=
this.parameters.isAttributeDriven;return this._techniqueConfig};x.createGLMaterial=function(u){return new m(u)};x.intersect=function(){};x.createBufferWriter=function(){return new z(this.parameters.isAttributeDriven?q:v)};return r}(h.Material),m=function(t){function r(u){return t.call(this,u)||this}b._inheritsLoose(r,t);var x=r.prototype;x.beginSlot=function(u){return this.updateParameters(u)};x.updateParameters=function(u){return this.ensureTechnique(k.HeatmapDensityTechnique,u)};x.bind=function(u,
E){E.bindPass(this._material.parameters,u)};return r}(g),z=function(){function t(x){this.vertexBufferLayout=x}var r=t.prototype;r.allocate=function(x){return this.vertexBufferLayout.createBuffer(x)};r.elementCount=function(x){return 6*x.indices.get(f.VertexAttribute.POSITION).length};r.write=function(x,u,E,y){l.writePosition(u.indices.get(f.VertexAttribute.POSITION),u.vertexAttributes.get(f.VertexAttribute.POSITION).data,x.transformation,E.position,y,6);x=u.indices.get(f.VertexAttribute.POSITION).length;
const A=E.uv0;let p=y;for(let B=0;B<x;++B)A.setValues(p++,-1,-1),A.setValues(p++,1,-1),A.setValues(p++,1,1),A.setValues(p++,1,1),A.setValues(p++,-1,1),A.setValues(p++,-1,-1);(E="featureAttribute"in E?E.featureAttribute:null)&&l.writeBufferFloat(u.indices.get(f.VertexAttribute.FEATUREATTRIBUTE),u.vertexAttributes.get(f.VertexAttribute.FEATUREATTRIBUTE).data,E,y,6)};return t}();const v=c.newLayout().vec3f(f.VertexAttribute.POSITION).vec2f(f.VertexAttribute.UV0),q=v.clone().f32(f.VertexAttribute.FEATUREATTRIBUTE);
Object.defineProperty(a,"RadiusMode",{enumerable:!0,get:()=>k.RadiusMode});a.HeatmapDensityMaterial=d;a.isHeatMapDensityMaterial=function(t){return t instanceof d};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/HeatmapDensityTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../renderers/support/heatmapUtils ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HeatmapDensity.glsl ../../../webgl/enums ../../../webgl/renderState ../../../webgl/Texture".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q){b.RadiusMode=void 0;(function(t){t[t.Screen=0]="Screen";t[t.World=1]="World"})(b.RadiusMode||(b.RadiusMode={}));l=function(t){function r(u,E,y){E=t.call(this,u,E,y)||this;E._kernelBlurRadius=1;const {R32F:A,textureFloatLinear:p}=u.rctx.capabilities.textureFloat;y=null!=A;E._kernelTextureChannels=y?1:4;E._floatInterpolationDisabled=!p;E._kernel=new q.Texture(u.rctx,{target:z.TextureType.TEXTURE_2D,pixelFormat:y?z.PixelFormat.RED:z.PixelFormat.RGBA,internalFormat:y?
z.SizedPixelFormat.R32F:z.PixelFormat.RGBA,dataType:z.PixelType.FLOAT,samplingMode:z.TextureSamplingMode.NEAREST,wrapMode:z.TextureWrapMode.CLAMP_TO_EDGE,width:1,height:1});return E}c._inheritsLoose(r,t);var x=r.prototype;x.initializeProgram=function(u){const E=r.shader.get().build({isAttributeDriven:this.configuration.isAttributeDriven,mode:this.configuration.mode});return new d.Program(u.rctx,E,e.Default3D)};x.initializePipeline=function(){return v.makePipelineState({blending:v.simpleBlendingParams(z.BlendFactor.ONE,
z.BlendFactor.ONE,z.BlendOperation.ADD),colorWrite:v.defaultColorWriteParams,depthTest:null,depthWrite:null})};x.bindPass=function(u,E){const {camera:y}=E,{mode:A}=this.configuration;n.bindProjectionMatrix(this.program,y.projectionMatrix);switch(A){case m.HeatmapMode.KernelDensity:this._bindKernelDensityPass(u,E);break;case m.HeatmapMode.GaussianBlur:this._bindGaussianBlurPass(u,E)}};x.bindDraw=function(u){n.bindView(this.program,u)};x._bindKernelDensityPass=function({searchRadius:u,resolutionForScale:E},
{camera:y,screenToWorldRatio:A}){0!==E&&(u/=A/E);this.program.setUniform1f("radius",u*y.pixelRatio/y.fullViewport[2])};x._bindGaussianBlurPass=function({searchRadius:u,resolutionForScale:E},{camera:y,screenToWorldRatio:A}){u=Math.round(u);A=3*(0===E?u:u*E/A);0===E||this._floatInterpolationDisabled?this._kernel.setSamplingMode(z.TextureSamplingMode.NEAREST):this._kernel.setSamplingMode(z.TextureSamplingMode.LINEAR);this._kernelBlurRadius!==u&&this._recomputeKernel(u);this.program.setUniform1f("radius",
2*A*y.pixelRatio/y.fullViewport[2]);this.program.bindTexture(this._kernel,"kernel")};x._recomputeKernel=function(u){const E=w.createKernel(u),y=Math.ceil(E.length/2),A=this._kernelTextureChannels,p=new Float32Array(y*A);for(let B=0;B<y;++B){const D=E[y-1-B];for(let C=0;C<A;++C)p[B*A+C]=D}this._kernel.resize(y,1);this._kernel.setData(p);this._kernelBlurRadius=u};x.destroy=function(){this._kernel=h.disposeMaybe(this._kernel);t.prototype.destroy.call(this)};return r}(l.ShaderTechnique);l.shader=new f.ReloadableShaderModule(m.HeatmapDensityShader,
()=>new Promise((t,r)=>a(["./HeatmapDensity.glsl"],t,r)));f=function(t){function r(){var x=t.apply(this,arguments)||this;x.isAttributeDriven=!1;x.mode=m.HeatmapMode.GaussianBlur;return x}c._inheritsLoose(r,t);return r}(k.ShaderTechniqueConfiguration);g.__decorate([k.parameter()],f.prototype,"isAttributeDriven",void 0);g.__decorate([k.parameter()],f.prototype,"mode",void 0);Object.defineProperty(b,"HeatmapMode",{enumerable:!0,get:()=>m.HeatmapMode});b.HeatmapDensityTechnique=l;b.HeatmapDensityTechniqueConfiguration=
f;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/renderers/support/heatmapUtils":function(){define(["exports","../../core/mathUtils"],function(a,b){function c(f,l,k,e,d){f=new Uint32Array(f*f);l="buffer"in l?l:new Float64Array(l);k="buffer"in k?new Uint32Array(k.buffer):new Uint32Array((new Uint8Array(k)).buffer);d=k.length/(d-e);for(let m=0;m<l.length;m++)f[m]=k[b.clamp(Math.floor((l[m]-e)*d),0,k.length-1)];return f.buffer}function g(f){const l=Math.round(3*f),k=2*f*f,e=new Float64Array(2*
l+1);for(let d=0;d<=e.length;d++)e[d]=Math.exp(-((d-l)**2)/k)/Math.sqrt(2*Math.PI)*(f/2);return e}function h(f,l){return"function"===typeof f?f:f?"string"===typeof l?k=>-1*+k[f]:k=>+k[f]+l:()=>1}function w(f,l){return null!=f?"string"===typeof l?k=>-1*+k.readAttribute(f):k=>+k.readAttribute(f)+l:k=>1}const n=(()=>{if(!("document"in globalThis))return()=>null;const f=document.createElement("canvas"),l=f.getContext("2d");f.height=512;f.width=1;return k=>{l.clearRect(0,0,1,f.height);const e=l.createLinearGradient(0,
0,0,f.height);for(const {ratio:d,color:m}of k)e.addColorStop(Math.max(d,.001),`rgba(${m.r}, ${m.g}, ${m.b}, ${m.a})`);l.fillStyle=e;l.fillRect(0,0,1,f.height);return l.getImageData(0,0,1,f.height).data}})();a.calculateHeatmapIntensityInfo=function(f,l,k,e){const {blurRadius:d,fieldOffset:m,field:z}=l;l=new Float64Array(k*e);const v=g(d),q=Math.round(3*d);let t=Number.NEGATIVE_INFINITY;const r=h(z,m);for(const {geometry:u,attributes:E}of f){f=u.x-q;const y=u.y-q,A=Math.max(0,f);var x=Math.max(0,y);
const p=Math.min(e,u.y+q),B=Math.min(k,u.x+q),D=+r(E);for(let C=x;C<p;C++){const F=v[C-y];for(let G=A;G<B;G++)x=l[C*k+G]+=F*v[G-f]*D,x>t&&(t=x)}}return{matrix:l.buffer,max:t}};a.calculateHeatmapIntensityInfoReaders=function(f,l,k,e){const {blurRadius:d,fieldOffset:m,field:z}=l;l=new Float64Array(k*e);const v=g(d),q=Math.round(3*d);let t=Number.NEGATIVE_INFINITY;const r=w(z,m),x=new Set;for(const A of f)for(f=A.getCursor();f.next();){var u=f.getObjectId();if(x.has(u))continue;x.add(u);var E=f.readLegacyPointGeometry();
if(-128>E.x||E.x>=k+128||-128>E.y||E.y>e+128)continue;u=+r(f);const p=Math.round(E.x)-q,B=Math.round(E.y)-q,D=Math.max(0,p);var y=Math.max(0,B);const C=Math.min(e,Math.round(E.y)+q);E=Math.min(k,Math.round(E.x)+q);for(let F=y;F<C;F++){const G=v[F-B];for(let L=D;L<E;L++)y=l[F*k+L]+=G*v[L-p]*u,y>t&&(t=y)}}return{matrix:l.buffer,max:t}};a.createHeatmapImageData=c;a.createKernel=g;a.createValueFunction=h;a.createValueFunctionCursor=w;a.drawHeatmap=function(f,l,k,e,d,m){f.canvas.width=f.canvas.height=
l;f.clearRect(0,0,l,l);const z=f.getImageData(0,0,l,l);k&&e&&z.data.set(new Uint8ClampedArray(c(l,k,e,d,m)));f.putImageData(z,0,0)};a.generateGradient=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/HeatmapDensity.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/lib/VertexAttribute"],function(a,b,c,g){function h(n){const f=new c.ShaderBuilder,{mode:l,
isAttributeDriven:k}=n;f.attributes.add(g.VertexAttribute.POSITION,"vec3");f.attributes.add(g.VertexAttribute.UV0,"vec2");n.isAttributeDriven&&(f.attributes.add(g.VertexAttribute.FEATUREATTRIBUTE,"float"),f.varyings.add("attributeValue","float"));f.varyings.add("unitCirclePos","vec2");f.vertex.uniforms.add("radius","float");f.vertex.uniforms.add("proj","mat4");f.vertex.uniforms.add("view","mat4");f.vertex.code.add(b.glsl`
    void main() {
      unitCirclePos = uv0;

      vec4 posProj = proj * (view * vec4(${g.VertexAttribute.POSITION}, 1.0));
      vec4 quadOffset = vec4(unitCirclePos * radius, 0.0, 0.0);

      ${k?b.glsl`attributeValue = ${g.VertexAttribute.FEATUREATTRIBUTE};`:""}
      gl_Position = posProj + quadOffset;
    }
  `);l===a.HeatmapMode.KernelDensity?f.fragment.code.add(b.glsl`
      void main() {
        float radiusRatioSquared = dot(unitCirclePos, unitCirclePos);
        if (radiusRatioSquared > 1.0) {
          discard;
        }

        float oneMinusRadiusRatioSquared = 1.0 - radiusRatioSquared;
        float density = oneMinusRadiusRatioSquared * oneMinusRadiusRatioSquared ${k?b.glsl` * attributeValue`:""};
        gl_FragColor = vec4(density);
      }
    `):l===a.HeatmapMode.GaussianBlur&&(f.fragment.uniforms.add("kernel","sampler2D"),f.fragment.code.add(b.glsl`
    void main() {
      float radiusRatioSquared = dot(unitCirclePos, unitCirclePos);
      if (radiusRatioSquared > 1.0) {
        discard;
      }

      vec2 uv = abs(unitCirclePos);
      vec2 uvX = vec2(uv.x, 0.5);
      vec2 uvY = vec2(uv.y, 0.5);
      float intensity = texture2D(kernel, uvX).r * texture2D(kernel, uvY).r${k?b.glsl` * attributeValue`:""};
      gl_FragColor = vec4(intensity);
    }
  `));return f}a.HeatmapMode=void 0;(function(n){n[n.GaussianBlur=0]="GaussianBlur";n[n.KernelDensity=1]="KernelDensity"})(a.HeatmapMode||(a.HeatmapMode={}));const w=Object.freeze({__proto__:null,get HeatmapMode(){return a.HeatmapMode},build:h});a.HeatmapDensityShader=w;a.build=h})},"esri/views/3d/webgl-engine/shaders/HeatmapTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../../../../chunks/Heatmap.glsl ../../../webgl/enums ../../../webgl/renderState ../../../../chunks/HeatmapDensity.glsl".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z){w=function(v){function q(r,x){var u;return u=v.call(this,r,x,()=>u.destroy())||this}c._inheritsLoose(q,v);var t=q.prototype;t.initializeProgram=function(r){const x=q.shader.get().build({mode:this.configuration.mode});return new k.Program(r.rctx,x,f.Default3D)};t.initializePipeline=function(r){return m.makePipelineState({blending:l.blendingDefault,colorWrite:m.defaultColorWriteParams,depthTest:null,depthWrite:null})};t.bindPass=function(r,x){const {densityMap:u,
colorRamp:E,maxDensity:y,minDensity:A,searchRadius:p}=r;this.program.bindTexture(u,"densityMap");this.program.bindTexture(E,"tex");this.configuration.mode===z.HeatmapMode.KernelDensity&&this.program.setUniform1f("densityMultiplier",3/(p*p*Math.PI));this.program.setUniform1f("densityNormalizer",1/(y-A));this.program.setUniform1f("minDensity",A)};c._createClass(q,[{key:"primitiveType",get:function(){return d.PrimitiveType.TRIANGLE_STRIP}}]);return q}(w.ShaderTechnique);w.shader=new h.ReloadableShaderModule(e.HeatmapShader,
()=>new Promise((v,q)=>a(["./Heatmap.glsl"],v,q)));h=function(v){function q(){var t=v.apply(this,arguments)||this;t.mode=z.HeatmapMode.GaussianBlur;return t}c._inheritsLoose(q,v);return q}(n.ShaderTechniqueConfiguration);g.__decorate([n.parameter()],h.prototype,"mode",void 0);Object.defineProperty(b,"HeatmapMode",{enumerable:!0,get:()=>z.HeatmapMode});b.HeatmapTechnique=w;b.HeatmapTechniqueConfiguration=h;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/Heatmap.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/basicInterfaces ./HeatmapDensity.glsl".split(" "),
function(a,b,c,g,h,w,n){function f(k){const e=new h.ShaderBuilder;({mode:k}=k);e.include(b.ScreenSpacePass);e.include(c.DiscardOrAdjustAlpha,{alphaDiscardMode:w.AlphaDiscardMode.Blend});e.fragment.uniforms.add("densityMap","sampler2D");e.fragment.uniforms.add("tex","sampler2D");e.fragment.uniforms.add("densityNormalizer","float");e.fragment.uniforms.add("minDensity","float");k===n.HeatmapMode.KernelDensity&&e.fragment.uniforms.add("densityMultiplier","float");e.fragment.code.add(g.glsl`
    void main() {
      float density = texture2D(densityMap, uv).r${k===n.HeatmapMode.KernelDensity?g.glsl` * densityMultiplier`:""};
      float densityRatio = (density - minDensity) * densityNormalizer;

      vec4 color = texture2D(tex, vec2(clamp(densityRatio, 0.0, 1.0), 0.5));

      discardOrAdjustAlpha(color);
      gl_FragColor = color;
    }
  `);return e}const l=Object.freeze({__proto__:null,build:f,get HeatmapMode(){return n.HeatmapMode}});a.HeatmapShader=l;a.build=f})},"esri/views/3d/webgl-engine/lib/GLMaterialRepository":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/maybe ../../../../core/NestedMap ./Util".split(" "),function(a,b,c,g,h,w){const n=c.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository");let f=function(){function l(e){this._glMaterial=e;this.refCnt=
0;this._glMaterial=e}var k=l.prototype;k.incRefCnt=function(){++this.refCnt};k.decRefCnt=function(){--this.refCnt;w.assert(0<=this.refCnt)};k.getRefCnt=function(){return this.refCnt};b._createClass(l,[{key:"glMaterial",get:function(){return this._glMaterial}}]);return l}();c=function(){function l(e,d,m,z){this._textureRepository=e;this._techniqueRepository=d;this.materialChanged=m;this.requestRender=z;this._id2glMaterialRef=new h.NestedMap}var k=l.prototype;k.dispose=function(){this._textureRepository.dispose()};
k.acquire=function(e,d){this._ownMaterial(e);var m=this._id2glMaterialRef.get(d,e.id);g.isNone(m)&&(m=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:d}),m=new f(m),this._id2glMaterialRef.set(d,e.id,m));m.incRefCnt();return m.glMaterial};k.release=function(e,d){const m=this._id2glMaterialRef.get(d,e.id);g.isSome(m)&&(m.decRefCnt(),0===m.getRefCnt()&&(g.disposeMaybe(m.glMaterial),this._id2glMaterialRef.delete(d,e.id)))};k._ownMaterial=
function(e){g.isSome(e.repository)&&e.repository!==this&&n.error("Material is already owned by a different material repository");e.repository=this};return l}();a.GLMaterialRepository=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":function(){define("exports ../../../../core/maybe ../../../../core/uid ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ./basicInterfaces ./Geometry ./LocalOriginFactory ./Object3D ./VertexAttribute ./WebGLLayer ../materials/RibbonLineMaterial".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z){function v(x){t=x}let q=function(){function x(E,y=125E4){this._originSR=E;this._gridSize=y;this._origins=new Map;this._objects=new Map;this._rootOriginId="root/"+c.generateUID()}var u=x.prototype;u.getOrigin=function(E){const y=this._origins.get(this._rootOriginId);if(null==y){if(b.isSome(t))return this._origins.set(this._rootOriginId,k.fromValues(t[0],t[1],t[2],this._rootOriginId)),this.getOrigin(E);E=k.fromValues(E[0]+Math.random()-.5,E[1]+Math.random()-.5,
E[2]+Math.random()-.5,this._rootOriginId);this._origins.set(this._rootOriginId,E);return E}var A=this._gridSize;const p=Math.round(E[0]/A),B=Math.round(E[1]/A),D=Math.round(E[2]/A),C=`${p}/${B}/${D}`;let F=this._origins.get(C);const G=.5*A;h.subtract(r,E,y.vec3);r[0]=Math.abs(r[0]);r[1]=Math.abs(r[1]);r[2]=Math.abs(r[2]);if(r[0]<G&&r[1]<G&&r[2]<G)return F&&(A=Math.max(...r),h.subtract(r,E,F.vec3),r[0]=Math.abs(r[0]),r[1]=Math.abs(r[1]),r[2]=Math.abs(r[2]),Math.max(...r)<A)?F:y;F||(F=k.fromValues(p*
A,B*A,D*A,C),this._origins.set(C,F));return F};u._drawOriginBox=function(E,y=[1,1,0,1]){const A=window.view,p=A._stage;var B=y.toString();if(!this._objects.has(B)){this._material=new z.RibbonLineMaterial({width:2,color:y});p.add(this._material);y=new m.WebGLLayer({isPickable:!1});var D=new e.Object3D({castShadow:!1});p.add(D);y.add(D);p.add(y);this._objects.set(B,D)}B=this._objects.get(B);y=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0];D=y.length;const C=Array(3*D),F=new Uint16Array(2*(D-1)),G=.5*this._gridSize;
for(let L=0;L<D;L++)C[3*L]=E[0]+(y[L]&1?G:-G),C[3*L+1]=E[1]+(y[L]&2?G:-G),C[3*L+2]=E[2]+(y[L]&4?G:-G),0<L&&(F[2*L]=L-1,F[2*L+1]=L);n.projectBuffer(C,this._originSR,0,C,A.renderSpatialReference,0,D);E=new l.Geometry([[d.VertexAttribute.POSITION,{size:3,data:C,exclusive:!0}]],[[d.VertexAttribute.POSITION,F]],f.PrimitiveType.Line);p.add(E);B.addGeometry(E,this._material,g.IDENTITY)};return x}(),t=null;const r=w.create();a.GridLocalOriginFactory=q;a.default=v;a.setTestRootOrigin=v;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/WebGLLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/PooledArray ./basicInterfaces ./ContentObject ./ContentObjectType ./DirtyEvents ./Octree".split(" "),function(a,b,c,g,h,w,n,f,l,k,e){f=function(d){function m(v,q=""){var t,r,x;var u=d.call(this)||this;u.apiLayerUid=q;u.type=l.ContentObjectType.Layer;u.events=new c;u.isSliceable=
!1;u._objects=new w;u._stageHandles=new g;u.apiLayerUid=q;u.isVisible=null!=(t=null==v?void 0:v.isVisible)?t:!0;u.isPickable=null!=(r=null==v?void 0:v.isPickable)?r:!0;u.updatePolicy=null!=(x=null==v?void 0:v.updatePolicy)?x:n.UpdatePolicy.ASYNC;return u}b._inheritsLoose(m,d);var z=m.prototype;z.destroy=function(){this.detachStage();this._stage=null};z.attachStage=function(v){this.detachStage();this._stage=v;for(const q of k.DirtyEventNames)this._stageHandles.add(this.events.on(q,t=>v.handleEvent(q,
t)))};z.detachStage=function(){this._stageHandles.removeAll();this.invalidateSpatialQueryAccelerator()};z.add=function(v){this._objects.push(v);v.parentLayer=this;this.events.emit("layerObjectAdded",{layer:this,object:v});h.isSome(this._octree)&&this._octree.add([v])};z.remove=function(v){this._objects.removeUnordered(v)&&(v.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:v}),h.isSome(this._octree)&&this._octree.remove([v]))};z.addMany=function(v){this._objects.pushArray(v);
for(const q of v)q.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:v});h.isSome(this._octree)&&this._octree.add(v)};z.removeMany=function(v){const q=[];this._objects.removeUnorderedMany(v,v.length,q);if(0!==q.length){for(const t of q)t.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:q});h.isSome(this._octree)&&this._octree.remove(q)}};z.sync=function(){h.isSome(this._stage)&&this.updatePolicy!==n.UpdatePolicy.SYNC&&this._stage.syncLayer(this.id)};
z.notifyObjectBBChanged=function(v,q){h.isSome(this._octree)&&this._octree.update(v,q)};z.getSpatialQueryAccelerator=function(){h.isNone(this._octree)&&50<this._objects.length&&this._createOctree();return this._octree};z.shaderTransformationChanged=function(){this.invalidateSpatialQueryAccelerator();this.events.emit("shaderTransformationChanged",this)};z.invalidateSpatialQueryAccelerator=function(){this._octree=h.destroyMaybe(this._octree)};z._createOctree=function(){this._octree=new e.default(v=>
v.boundingVolumeWorldSpace.bounds);this._octree.add(this._objects.data,this._objects.length)};b._createClass(m,[{key:"objects",get:function(){return this._objects}}]);return m}(f.ContentObject);a.WebGLLayer=f;a.isWebGLLayer=function(d){return h.isSome(d)&&d.type===l.ContentObjectType.Layer};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/DirtyEvents":function(){define(["exports"],function(a){a.DirtyEventNames="layerObjectAdded layerObjectRemoved layerObjectsAdded layerObjectsRemoved shaderTransformationChanged objectTransformation visibilityChanged occlusionChanged highlightChanged objectGeometryAdded objectGeometryRemoved vertexAttrsUpdated".split(" ");
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Octree":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../chunks/sphere ./Util".split(" "),function(a,b,c,g,h,w,n,f,l,k,e){function d(Q,J,P){P[0]=Q[0]+J;P[1]=Q[1]+J;P[2]=Q[2]+J}function m(Q,
J,P,N){if(1===J)Q=P(Q[0]),k.copy(Q,N);else{D[0]=Infinity;D[1]=Infinity;D[2]=Infinity;C[0]=-Infinity;C[1]=-Infinity;C[2]=-Infinity;for(let V=0;V<J;V++){var R=P(Q[V]);if(t(R[3])){var S=D,T=R;S[0]=Math.min(S[0],T[0]-T[3]);S[1]=Math.min(S[1],T[1]-T[3]);S[2]=Math.min(S[2],T[2]-T[3]);S=C;S[0]=Math.max(S[0],R[0]+R[3]);S[1]=Math.max(S[1],R[1]+R[3]);S[2]=Math.max(S[2],R[2]+R[3])}}w.lerp(N,D,C,.5);N[3]=Math.max(C[0]-D[0],C[1]-D[1],C[2]-D[2])/2}}function z(Q,J,P){if(!I.length)for(var N=0;8>N;++N)I.push({index:0,
distance:0});for(N=0;8>N;++N){const R=u[N];I.data[N].index=N;I.data[N].distance=q(Q,J,R)}I.sort((R,S)=>R.distance-S.distance);for(Q=0;8>Q;++Q)P[Q]=I.data[Q].index}function v(Q,J){let P=Infinity,N=null;for(let R=0;8>R;++R){const S=q(Q,J,E[R]);S<P&&(P=S,N=E[R])}return N}function q(Q,J,P){return J*(Q[0]*P[0]+Q[1]*P[1]+Q[2]*P[2])}function t(Q){return!isNaN(Q)&&-Infinity!==Q&&Infinity!==Q&&0<Q}let r=function(){function Q(P,N){this._objectToBoundingSphere=P;this._maximumObjectsPerNode=10;this._maximumDepth=
20;this._degenerateObjects=new Set;this._root=new x;this._objectCount=0;N&&(void 0!==N.maximumObjectsPerNode&&(this._maximumObjectsPerNode=N.maximumObjectsPerNode),void 0!==N.maximumDepth&&(this._maximumDepth=N.maximumDepth))}var J=Q.prototype;J.destroy=function(){this._degenerateObjects.clear();x.clearPool();A[0]=null;F.prune();I.prune()};J.add=function(P,N=P.length){this._objectCount+=N;this._grow(P,N);const R=x.acquire();for(let S=0;S<N;S++){const T=P[S];this._isDegenerate(T)?this._degenerateObjects.add(T):
(R.init(this._root),this._add(T,R))}x.release(R)};J.remove=function(P,N=null){this._objectCount-=P.length;const R=x.acquire();for(const S of P)P=c.isSome(N)?N:k.copy(this._objectToBoundingSphere(S),G),t(P[3])?(R.init(this._root),this._remove(S,P,R)):this._degenerateObjects.delete(S);x.release(R);this._shrink()};J.update=function(P,N){if(t(N[3])||!this._isDegenerate(P))A[0]=P,P=A,this.remove(P,N),this.add(P)};J.forEachAlongRay=function(P,N,R){const S=l.wrap(P,N);this._forEachNode(this._root,T=>{if(!this._intersectsNode(S,
T))return!1;T=T.node;T.terminals.forAll(V=>{this._intersectsObject(S,V)&&R(V)});null!==T.residents&&T.residents.forAll(V=>{this._intersectsObject(S,V)&&R(V)});return!0})};J.forEachAlongRayWithVerticalOffset=function(P,N,R,S){const T=l.wrap(P,N);this._forEachNode(this._root,V=>{if(!this._intersectsNodeWithOffset(T,V,S))return!1;V=V.node;V.terminals.forAll(W=>{this._intersectsObjectWithOffset(T,W,S)&&R(W)});null!==V.residents&&V.residents.forAll(W=>{this._intersectsObjectWithOffset(T,W,S)&&R(W)});return!0})};
J.forEach=function(P){this._forEachNode(this._root,N=>{N=N.node;N.terminals.forAll(P);null!==N.residents&&N.residents.forAll(P);return!0});this._degenerateObjects.forEach(P)};J.forEachDegenerateObject=function(P){this._degenerateObjects.forEach(P)};J.findClosest=function(P,N,R,S=()=>!0,T=Infinity){let V=Infinity,W=Infinity,U=null;const aa=v(P,N),da=Y=>{--T;if(S(Y)){var ea=this._objectToBoundingSphere(Y);if(f.intersectsSphere(R,ea)){var ja=q(P,N,k.getCenter(ea)),la=ja-ea[3];ea=ja+ea[3];la<V&&(V=la,
W=ea,U=Y)}}};this._forEachNodeDepthOrdered(this._root,Y=>{if(0>=T||!f.intersectsSphere(R,Y.bounds))return!1;w.scale(B,aa,Y.halfSize);w.add(B,B,Y.bounds);if(q(P,N,B)>W)return!1;Y=Y.node;Y.terminals.forAll(ea=>da(ea));null!==Y.residents&&Y.residents.forAll(ea=>da(ea));return!0},P,N);return U};J.forEachInDepthRange=function(P,N,R,S,T,V,W){let U=-Infinity,aa=Infinity;const da={setRange:ia=>{R===a.DepthOrder.FRONT_TO_BACK?(U=Math.max(U,ia.near),aa=Math.min(aa,ia.far)):(U=Math.max(U,-ia.far),aa=Math.min(aa,
-ia.near))}};da.setRange(S);const Y=q(N,R,P),ea=v(N,R),ja=v(N,-R),la=ia=>{if(W(ia)){var ca=this._objectToBoundingSphere(ia),fa=k.getCenter(ca);fa=q(N,R,fa)-Y;var ba=fa+ca[3];fa-ca[3]>aa||ba<U||!f.intersectsSphere(V,ca)||T(ia,da)}};this._forEachNodeDepthOrdered(this._root,ia=>{if(!f.intersectsSphere(V,ia.bounds))return!1;w.scale(B,ea,ia.halfSize);w.add(B,B,ia.bounds);if(q(N,R,B)-Y>aa)return!1;w.scale(B,ja,ia.halfSize);w.add(B,B,ia.bounds);if(q(N,R,B)-Y<U)return!1;ia=ia.node;ia.terminals.forAll(ca=>
la(ca));null!==ia.residents&&ia.residents.forAll(ca=>la(ca));return!0},N,R)};J.forEachNode=function(P){this._forEachNode(this._root,N=>P(N.node,N.bounds,N.halfSize))};J._intersectsNode=function(P,N){d(N.bounds,2*-N.halfSize,D);d(N.bounds,2*N.halfSize,C);return e.rayBoxTest(P.origin,P.direction,D,C)};J._intersectsNodeWithOffset=function(P,N,R){d(N.bounds,2*-N.halfSize,D);d(N.bounds,2*N.halfSize,C);R.applyToMinMax(D,C);return e.rayBoxTest(P.origin,P.direction,D,C)};J._intersectsObject=function(P,N){N=
this._objectToBoundingSphere(N);return 0<N[3]?k.intersectsRay(N,P):!0};J._intersectsObjectWithOffset=function(P,N,R){N=this._objectToBoundingSphere(N);return 0<N[3]?k.intersectsRay(R.applyToBoundingSphere(N),P):!0};J._forEachNode=function(P,N){P=x.acquire().init(P);const R=[P];for(;0!==R.length;){P=R.pop();if(N(P)&&!P.isLeaf())for(let S=0;S<P.node.children.length;S++)P.node.children[S]&&R.push(x.acquire().init(P).advance(S));x.release(P)}};J._forEachNodeDepthOrdered=function(P,N,R,S=a.DepthOrder.FRONT_TO_BACK){P=
x.acquire().init(P);const T=[P];for(z(R,S,O);0!==T.length;){P=T.pop();if(N(P)&&!P.isLeaf())for(R=7;0<=R;--R)S=O[R],P.node.children[S]&&T.push(x.acquire().init(P).advance(S));x.release(P)}};J._remove=function(P,N,R){F.clear();N=R.advanceTo(N,(S,T)=>{F.push(S.node);F.push(T)})?R.node.terminals:R.node.residents;N.removeUnordered(P);if(0===N.length)for(P=F.length-2;0<=P&&this._purge(F.data[P],F.data[P+1]);P-=2);};J._nodeIsEmpty=function(P){if(0!==P.terminals.length)return!1;if(null!==P.residents)return 0===
P.residents.length;for(let N=0;N<P.children.length;N++)if(P.children[N])return!1;return!0};J._purge=function(P,N){0<=N&&(P.children[N]=null);return this._nodeIsEmpty(P)?(null===P.residents&&(P.residents=new h({shrink:!0})),!0):!1};J._add=function(P,N){N.advanceTo(this._objectToBoundingSphere(P))?N.node.terminals.push(P):(N.node.residents.push(P),N.node.residents.length>this._maximumObjectsPerNode&&N.depth<this._maximumDepth&&this._split(N))};J._split=function(P){const N=P.node.residents;P.node.residents=
null;for(let R=0;R<N.length;R++){const S=x.acquire().init(P);this._add(N.getItemAt(R),S);x.release(S)}};J._grow=function(P,N){0!==N&&(m(P,N,R=>this._objectToBoundingSphere(R),L),t(L[3])&&!this._fitsInsideTree(L)&&(this._nodeIsEmpty(this._root.node)?(k.copy(L,this._root.bounds),this._root.halfSize=1.25*L[3]):(P=this._rootBoundsForRootAsSubNode(L),this._placingRootViolatesMaxDepth(P)?this._rebuildTree(L,P):this._growRootAsSubNode(P),x.release(P))))};J._rebuildTree=function(P,N){w.copy(H,N.bounds);H[3]=
N.halfSize;m([P,H],2,R=>R,M);P=x.acquire().init(this._root);this._root.initFrom(null,M,1.25*M[3]);this._forEachNode(P,R=>{this.add(R.node.terminals.data,R.node.terminals.length);null!==R.node.residents&&this.add(R.node.residents.data,R.node.residents.length);return!0});x.release(P)};J._placingRootViolatesMaxDepth=function(P){const N=Math.log(P.halfSize/this._root.halfSize)*Math.LOG2E;let R=0;this._forEachNode(this._root,S=>{R=Math.max(R,S.depth);return R+N<=this._maximumDepth});return R+N>this._maximumDepth};
J._rootBoundsForRootAsSubNode=function(P){var N=P[3];let R=-Infinity;const S=this._root.bounds,T=this._root.halfSize;for(var V=0;3>V;V++){var W=Math.max(0,Math.ceil((S[V]-T-(P[V]-N))/(2*T)));const U=Math.max(0,Math.ceil((P[V]+N-(S[V]+T))/(2*T)))+1;R=Math.max(R,2**Math.ceil(Math.log(W+U)*Math.LOG2E));K[V].min=W;K[V].max=U}for(P=0;3>P;P++)N=K[P].min,V=K[P].max,W=(R-(N+V))/2,N+=Math.ceil(W),V+=Math.floor(W),p[P]=S[P]-T-N*T*2+(V+N)*T;p[3]=R*T*y;return x.acquire().initFrom(null,p,R*T,0)};J._growRootAsSubNode=
function(P){const N=this._root.node;w.copy(L,this._root.bounds);L[3]=this._root.halfSize;this._root.init(P);P.advanceTo(L,null,!0);P.node.children=N.children;P.node.residents=N.residents;P.node.terminals=N.terminals};J._shrink=function(){for(;;){const P=this._findShrinkIndex();if(-1===P)break;this._root.advance(P);this._root.depth=0}};J._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let P=null;const N=this._root.node.children;let R=0,S=0;for(;S<N.length&&
null==P;)R=S++,P=N[R];for(;S<N.length;)if(N[S++])return-1;return R};J._isDegenerate=function(P){P=this._objectToBoundingSphere(P)[3];return!t(P)};J._fitsInsideTree=function(P){const N=this._root.bounds,R=this._root.halfSize;return P[3]<=R&&P[0]>=N[0]-R&&P[0]<=N[0]+R&&P[1]>=N[1]-R&&P[1]<=N[1]+R&&P[2]>=N[2]-R&&P[2]<=N[2]+R};b._createClass(Q,[{key:"bounds",get:function(){return this._root.bounds}},{key:"halfSize",get:function(){return this._root.halfSize}},{key:"root",get:function(){return this._root.node}},
{key:"maximumObjectsPerNode",get:function(){return this._maximumObjectsPerNode}},{key:"maximumDepth",get:function(){return this._maximumDepth}},{key:"objectCount",get:function(){return this._objectCount}}]);return Q}(),x=function(){function Q(){this.bounds=k.create();this.halfSize=0;this.initFrom(null,null,0,0)}var J=Q.prototype;J.init=function(P){return this.initFrom(P.node,P.bounds,P.halfSize,P.depth)};J.initFrom=function(P,N,R,S=this.depth){this.node=c.isSome(P)?P:Q.createEmptyNode();c.isSome(N)&&
k.copy(N,this.bounds);this.halfSize=R;this.depth=S;return this};J.advance=function(P){let N=this.node.children[P];N||(N=Q.createEmptyNode(),this.node.children[P]=N);this.node=N;this.halfSize/=2;this.depth++;P=u[P];this.bounds[0]+=P[0]*this.halfSize;this.bounds[1]+=P[1]*this.halfSize;this.bounds[2]+=P[2]*this.halfSize;this.bounds[3]=this.halfSize*y;return this};J.advanceTo=function(P,N,R=!1){for(;;){if(this.isTerminalFor(P))return N&&N(this,-1),!0;if(this.isLeaf()){if(!R)return N&&N(this,-1),!1;this.node.residents=
null}const S=this._childIndex(P);N&&N(this,S);this.advance(S)}};J.isLeaf=function(){return null!=this.node.residents};J.isTerminalFor=function(P){return P[3]>this.halfSize/2};J._childIndex=function(P){const N=this.bounds;return(N[0]<P[0]?1:0)+(N[1]<P[1]?2:0)+(N[2]<P[2]?4:0)};Q.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new h({shrink:!0}),residents:new h({shrink:!0})}};Q.acquire=function(){return Q._pool.acquire()};Q.release=function(P){Q._pool.release(P)};
Q.clearPool=function(){Q._pool.prune()};return Q}();x._pool=new g(x);a.DepthOrder=void 0;(function(Q){Q[Q.FRONT_TO_BACK=1]="FRONT_TO_BACK";Q[Q.BACK_TO_FRONT=-1]="BACK_TO_FRONT"})(a.DepthOrder||(a.DepthOrder={}));const u=[n.fromValues(-1,-1,-1),n.fromValues(1,-1,-1),n.fromValues(-1,1,-1),n.fromValues(1,1,-1),n.fromValues(-1,-1,1),n.fromValues(1,-1,1),n.fromValues(-1,1,1),n.fromValues(1,1,1)],E=[n.fromValues(-1,-1,-1),n.fromValues(-1,-1,1),n.fromValues(-1,1,-1),n.fromValues(-1,1,1),n.fromValues(1,-1,
-1),n.fromValues(1,-1,1),n.fromValues(1,1,-1),n.fromValues(1,1,1)],y=Math.sqrt(3),A=[null],p=k.create(),B=n.create(),D=n.create(),C=n.create(),F=new h,G=k.create(),L=k.create(),H=k.create(),M=k.create(),K=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],I=new h,O=[0,0,0,0,0,0,0,0];a.default=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/frustum ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../lib/geometryDataUtils ../lib/GLMaterial ../lib/GLMaterials ../lib/Material ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./VisualVariableMaterialParameters ./renderers/utils ../../../../chunks/RibbonLine.glsl ../shaders/RibbonLineTechnique".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B){function D(ca,fa,ba,Z,ha){for(let na=0;na<ha;na++)ba[Z++]=ca[fa++];return Z}function C(ca,fa,ba){fa=fa.get(E.VertexAttribute.POSITION).data;ba=ba?ba.get(E.VertexAttribute.POSITION):null;return ca.isClosed?ba?2<ba.length:6<fa.length:!1}const F=c.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");var G;(function(ca){ca[ca.LEFT_JOIN_START=-2]="LEFT_JOIN_START";ca[ca.LEFT_JOIN_END=-1]="LEFT_JOIN_END";ca[ca.LEFT_CAP_START=-4]=
"LEFT_CAP_START";ca[ca.LEFT_CAP_END=-5]="LEFT_CAP_END";ca[ca.RIGHT_JOIN_START=2]="RIGHT_JOIN_START";ca[ca.RIGHT_JOIN_END=1]="RIGHT_JOIN_END";ca[ca.RIGHT_CAP_START=4]="RIGHT_CAP_START";ca[ca.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(G||(G={}));c=function(ca){function fa(Z){Z=ca.call(this,Z,H)||this;Z._vertexAttributeLocations=B.ribbonVertexAttributeLocations;Z.techniqueConfig=new B.RibbonLineTechniqueConfiguration;Z.layout=Z.createLayout();return Z}b._inheritsLoose(fa,ca);var ba=fa.prototype;ba.isClosed=
function(Z,ha){return this.parameters.isClosed?ha?2<ha.length:6<Z.length:!1};ba.dispose=function(){};ba.getPassParameters=function(){return this.parameters};ba.getTechniqueConfig=function(Z,ha){this.techniqueConfig.output=Z;this.techniqueConfig.draped=ha.slot===x.RenderSlot.DRAPED_MATERIAL;Z=h.isSome(this.parameters.stipplePattern);this.techniqueConfig.stippleEnabled=Z;this.techniqueConfig.stippleOffColorEnabled=Z&&h.isSome(this.parameters.stippleOffColor);this.techniqueConfig.stippleScaleWithLineWidth=
Z&&this.parameters.stippleScaleWithLineWidth;this.techniqueConfig.stipplePreferContinuous=Z&&this.parameters.stipplePreferContinuous;this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled;this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees;this.techniqueConfig.roundJoins="round"===this.parameters.join;this.techniqueConfig.capType=this.parameters.cap;this.techniqueConfig.transparent=this.parameters.transparent;this.techniqueConfig.polygonOffset=this.parameters.polygonOffset;
this.techniqueConfig.writeDepth=this.parameters.writeDepth;this.techniqueConfig.vvColor=this.parameters.vvColorEnabled;this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled;this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled;this.techniqueConfig.innerColorEnabled=0<this.parameters.innerWidth&&h.isSome(this.parameters.innerColor);this.techniqueConfig.falloffEnabled=0<this.parameters.falloff;this.techniqueConfig.occluder=this.parameters.renderOccluded===r.RenderOccludedFlag.OccludeAndTransparentStencil;
this.techniqueConfig.transparencyPassType=ha.transparencyPassType;this.techniqueConfig.multipassTerrainEnabled=ha.multipassTerrainEnabled;this.techniqueConfig.cullAboveGround=ha.cullAboveGround;this.techniqueConfig.wireframe=this.parameters.wireframe;return this.techniqueConfig};ba.intersect=function(Z,ha,na,pa,xa,Da,ua,Fa,qa){h.isSome(qa)?this._intersectDrapedLineGeometry(Z,pa,qa,Da,ua):this._intersectLineGeometry(Z,ha,na,pa,ua)};ba._intersectDrapedLineGeometry=function(Z,ha,na,pa,xa){if(ha.options.selectionMode){ha=
Z.vertexAttributes.get(E.VertexAttribute.POSITION).data;var Da=Z.vertexAttributes.get(E.VertexAttribute.SIZE),ua=this.parameters.width;this.parameters.vvSizeEnabled?(Da=Z.vertexAttributes.get(E.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0],ua*=g.clamp(this.parameters.vvSizeOffset[0]+Da*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])):Da&&(ua*=Da.data[0]);Da=pa[0];pa=pa[1];Z=(ua/2+4)*Z.screenToWorldRatio;ua=Number.MAX_VALUE;var Fa=0;for(let va=0;va<
ha.length-5;va+=3){var qa=ha[va],sa=ha[va+1],ma=Da-qa,ra=pa-sa;qa=ha[va+3]-qa;sa=ha[va+4]-sa;const Ia=g.clamp((qa*ma+sa*ra)/(qa*qa+sa*sa),0,1);ma=qa*Ia-ma;ra=sa*Ia-ra;ra=ma*ma+ra*ra;ra<ua&&(ua=ra,Fa=va/3)}ua<Z*Z&&xa(na.dist,na.normal,Fa,!1)}};ba._intersectLineGeometry=function(Z,ha,na,pa,xa){if(pa.options.selectionMode&&!A.isInstanceHidden(ha))if(u.isTranslationMatrix(na)){var Da=Z.vertexAttributes,ua=Da.get(E.VertexAttribute.POSITION).data;ha=this.parameters.width;if(this.parameters.vvSizeEnabled){var Fa=
Da.get(E.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0];ha*=g.clamp(this.parameters.vvSizeOffset[0]+Fa*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else Da.has(E.VertexAttribute.SIZE)&&(ha*=Da.get(E.VertexAttribute.SIZE).data[0]);var qa=pa.camera,sa=J;n.copy(sa,pa.point);Fa=ha*qa.pixelRatio/2+4*qa.pixelRatio;f.set(da[0],sa[0]-Fa,sa[1]+Fa,0);f.set(da[1],sa[0]+Fa,sa[1]+Fa,0);f.set(da[2],sa[0]+Fa,sa[1]-Fa,0);f.set(da[3],sa[0]-Fa,sa[1]-Fa,0);for(ha=
0;4>ha;ha++)if(!qa.unprojectFromRenderScreen(da[ha],Y[ha]))return;d.fromPoints(qa.eye,Y[0],Y[1],ea);d.fromPoints(qa.eye,Y[1],Y[2],ja);d.fromPoints(qa.eye,Y[2],Y[3],la);d.fromPoints(qa.eye,Y[3],Y[0],ia);var ma=Number.MAX_VALUE;ha=0;Z=C(this.parameters,Da,Z.indices)?ua.length-2:ua.length-5;for(Da=0;Da<Z;Da+=3){K[0]=ua[Da]+na[12];K[1]=ua[Da+1]+na[13];K[2]=ua[Da+2]+na[14];var ra=(Da+3)%ua.length;I[0]=ua[ra]+na[12];I[1]=ua[ra+1]+na[13];I[2]=ua[ra+2]+na[14];if(!(0>d.signedDistance(ea,K)&&0>d.signedDistance(ea,
I)||0>d.signedDistance(ja,K)&&0>d.signedDistance(ja,I)||0>d.signedDistance(la,K)&&0>d.signedDistance(la,I)||0>d.signedDistance(ia,K)&&0>d.signedDistance(ia,I))){qa.projectToRenderScreen(K,P);qa.projectToRenderScreen(I,N);if(0>P[2]&&0<N[2])f.subtract(O,K,I),ra=qa.frustum,ra=-d.signedDistance(ra[k.PlaneIndex.NEAR],K)/f.dot(O,d.normal(ra[k.PlaneIndex.NEAR])),f.scale(O,O,ra),f.add(K,K,O),qa.projectToRenderScreen(K,P);else if(0<P[2]&&0>N[2])f.subtract(O,I,K),ra=qa.frustum,ra=-d.signedDistance(ra[k.PlaneIndex.NEAR],
I)/f.dot(O,d.normal(ra[k.PlaneIndex.NEAR])),f.scale(O,O,ra),f.add(I,I,O),qa.projectToRenderScreen(I,N);else if(0>P[2]&&0>N[2])continue;P[2]=0;N[2]=0;ra=e.distance2(e.fromPoints(P,N,T),sa);ra<ma&&(ma=ra,f.copy(R,K),f.copy(S,I),ha=Da/3)}}na=pa.rayBegin;pa=pa.rayEnd;ma<Fa*Fa&&(ua=Number.MAX_VALUE,e.closestLineSegmentPoint(e.fromPoints(R,S,T),e.fromPoints(na,pa,V),Q)&&(f.subtract(Q,Q,na),ua=f.length(Q),f.scale(Q,Q,1/ua),ua/=f.distance(na,pa)),xa(ua,Q,ha,!1))}else F.error("intersection assumes a translation-only matrix")};
ba.computeAttachmentOrigin=function(Z,ha){const na=Z.vertexAttributes;if(!na)return null;Z=Z.indices;const pa=na.get(E.VertexAttribute.POSITION);return v.computeAttachmentOriginLines(pa,Z?Z.get(E.VertexAttribute.POSITION):null,Z&&C(this.parameters,na,Z),ha)};ba.createLayout=function(){const Z=m.newLayout().vec3f(E.VertexAttribute.POSITION).f32(E.VertexAttribute.SUBDIVISIONFACTOR).vec2f(E.VertexAttribute.UV0).vec3f(E.VertexAttribute.AUXPOS1).vec3f(E.VertexAttribute.AUXPOS2);this.parameters.vvSizeEnabled?
Z.f32(E.VertexAttribute.SIZEFEATUREATTRIBUTE):Z.f32(E.VertexAttribute.SIZE);this.parameters.vvColorEnabled?Z.f32(E.VertexAttribute.COLORFEATUREATTRIBUTE):Z.vec4f(E.VertexAttribute.COLOR);this.parameters.vvOpacityEnabled&&Z.f32(E.VertexAttribute.OPACITYFEATUREATTRIBUTE);return Z};ba.createBufferWriter=function(){return new M(this.layout,this.parameters)};ba.requiresSlot=function(Z,ha){if(Z===x.RenderSlot.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===r.RenderOccludedFlag.OccludeAndTransparentStencil)return Z===
x.RenderSlot.OPAQUE_MATERIAL||Z===x.RenderSlot.OCCLUDER_MATERIAL||Z===x.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL;ha=t.outputFromPass(ha);return ha===z.ShaderOutput.Color||ha===z.ShaderOutput.Alpha?Z===(this.parameters.writeDepth?x.RenderSlot.TRANSPARENT_MATERIAL:x.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):Z===x.RenderSlot.OPAQUE_MATERIAL};ba.createGLMaterial=function(Z){return Z.output===z.ShaderOutput.Color||Z.output===z.ShaderOutput.Alpha||Z.output===z.ShaderOutput.Highlight||Z.output===
z.ShaderOutput.Depth?new L(Z):null};ba.validateParameters=function(Z){"miter"!==Z.join&&(Z.miterLimit=0);this._requiresTransparent(Z)&&(Z.transparent=!0)};ba._requiresTransparent=function(Z){return!!(1>(Z.color&&Z.color[3])||0<Z.innerWidth&&this._colorRequiresTransparent(Z.innerColor)||Z.stipplePattern&&this._colorRequiresTransparent(Z.stippleOffColor)||0<Z.falloff)};ba._colorRequiresTransparent=function(Z){return h.isSome(Z)&&1>Z[3]&&0<Z[3]};return fa}(r.Material);let L=function(ca){function fa(){return ca.apply(this,
arguments)||this}b._inheritsLoose(fa,ca);var ba=fa.prototype;ba.updateParameters=function(Z){return this.ensureTechnique(B.RibbonLineTechnique,Z)};ba._updateOccludeeState=function(Z){Z.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:Z.hasOccludees})};ba.beginSlot=function(Z){this._output!==z.ShaderOutput.Color&&this._output!==z.ShaderOutput.Alpha||this._updateOccludeeState(Z);return this.updateParameters(Z)};ba.bind=function(Z,ha){ha.bindPass(this._material.getPassParameters(),
Z)};return fa}(q);const H={width:0,color:[1,1,1,1],join:"miter",cap:p.CapType.BUTT,miterLimit:5,writeDepth:!0,polygonOffset:!1,stipplePattern:null,stippleOffColor:null,stippleScaleWithLineWidth:!1,stipplePreferContinuous:!0,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,isClosed:!1,falloff:0,innerWidth:0,innerColor:null,sceneHasOcludees:!1,wireframe:!1,...r.DefaultMaterialParameters,...y.VisualVariableDefaultMaterialParameters};let M=function(){function ca(ba,Z){this.parameters=Z;this.numJoinSubdivisions=
0;this.vertexBufferLayout=ba;ba=Z.stipplePattern?1:0;switch(this.parameters.join){case "miter":case "bevel":this.numJoinSubdivisions=ba;break;case "round":this.numJoinSubdivisions=p.NUM_ROUND_JOIN_SUBDIVISIONS+ba}}var fa=ca.prototype;fa._isClosed=function(ba){return C(this.parameters,ba.vertexAttributes,ba.indices)};fa.allocate=function(ba){return this.vertexBufferLayout.createBuffer(ba)};fa.elementCount=function(ba){var Z=ba.indices.get(E.VertexAttribute.POSITION).length/2+1;ba=this._isClosed(ba);
Z=(ba?2:4)+((ba?Z:Z-1)-(ba?0:1))*(2*this.numJoinSubdivisions+4);Z+=2;this.parameters.wireframe&&(Z=2+4*(Z-2));return Z};fa.write=function(ba,Z,ha,na){var pa;const xa=W,Da=U,ua=aa,Fa=Z.vertexAttributes.get(E.VertexAttribute.POSITION).data;var qa=Z.indices&&Z.indices.get(E.VertexAttribute.POSITION);const sa=null==(pa=Z.vertexAttributes.get(E.VertexAttribute.DISTANCETOSTART))?void 0:pa.data;qa&&qa.length!==2*(Fa.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let ma=1,ra=0;this.parameters.vvSizeEnabled?
ra=Z.vertexAttributes.get(E.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0]:Z.vertexAttributes.has(E.VertexAttribute.SIZE)&&(ma=Z.vertexAttributes.get(E.VertexAttribute.SIZE).data[0]);let va=[1,1,1,1],Ia=0;this.parameters.vvColorEnabled?Ia=Z.vertexAttributes.get(E.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:Z.vertexAttributes.has(E.VertexAttribute.COLOR)&&(va=Z.vertexAttributes.get(E.VertexAttribute.COLOR).data);let Ja=0;this.parameters.vvOpacityEnabled&&(Ja=Z.vertexAttributes.get(E.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]);
pa=Fa.length/3;ba=ba.transformation;const Ha=new Float32Array(ha.buffer);qa=this.vertexBufferLayout.stride/4;let Ta=na*qa;na=Ta;let db=0;const fb=sa?(Oa,wa,Aa)=>db=sa[Aa]:(Oa,wa,Aa)=>db+=f.distance(Oa,wa),ka=(Oa,wa,Aa,Na,Ua,Ya,ya)=>{Ha[Ta++]=wa[0];Ha[Ta++]=wa[1];Ha[Ta++]=wa[2];Ha[Ta++]=Na;Ha[Ta++]=ya;Ha[Ta++]=Ua;Ha[Ta++]=Oa[0];Ha[Ta++]=Oa[1];Ha[Ta++]=Oa[2];Ha[Ta++]=Aa[0];Ha[Ta++]=Aa[1];Ha[Ta++]=Aa[2];this.parameters.vvSizeEnabled?Ha[Ta++]=ra:Ha[Ta++]=ma;this.parameters.vvColorEnabled?Ha[Ta++]=Ia:
(Oa=Math.min(4*Ya,va.length-4),Ha[Ta++]=va[Oa+0],Ha[Ta++]=va[Oa+1],Ha[Ta++]=va[Oa+2],Ha[Ta++]=va[Oa+3]);this.parameters.vvOpacityEnabled&&(Ha[Ta++]=Ja)};Ta+=qa;f.set(Da,Fa[0],Fa[1],Fa[2]);ba&&f.transformMat4(Da,Da,ba);if(Z=this._isClosed(Z)){var cb=Fa.length-3;f.set(xa,Fa[cb],Fa[cb+1],Fa[cb+2]);ba&&f.transformMat4(xa,xa,ba)}else f.set(ua,Fa[3],Fa[4],Fa[5]),ba&&f.transformMat4(ua,ua,ba),ka(Da,Da,ua,1,G.LEFT_CAP_START,0,0),ka(Da,Da,ua,1,G.RIGHT_CAP_START,0,0),f.copy(xa,Da),f.copy(Da,ua);cb=Z?0:1;const Ca=
Z?pa:pa-1;for(let Oa=cb;Oa<Ca;Oa++){var Ka=(Oa+1)%pa*3;f.set(ua,Fa[Ka+0],Fa[Ka+1],Fa[Ka+2]);ba&&f.transformMat4(ua,ua,ba);fb(xa,Da,Oa);ka(xa,Da,ua,0,G.LEFT_JOIN_END,Oa,db);ka(xa,Da,ua,0,G.RIGHT_JOIN_END,Oa,db);Ka=this.numJoinSubdivisions;for(let wa=0;wa<Ka;++wa){const Aa=(wa+1)/(Ka+1);ka(xa,Da,ua,Aa,G.LEFT_JOIN_END,Oa,db);ka(xa,Da,ua,Aa,G.RIGHT_JOIN_END,Oa,db)}ka(xa,Da,ua,1,G.LEFT_JOIN_START,Oa,db);ka(xa,Da,ua,1,G.RIGHT_JOIN_START,Oa,db);f.copy(xa,Da);f.copy(Da,ua)}Z?(f.set(ua,Fa[3],Fa[4],Fa[5]),
ba&&f.transformMat4(ua,ua,ba),db=fb(xa,Da,Ca),ka(xa,Da,ua,0,G.LEFT_JOIN_END,cb,db),ka(xa,Da,ua,0,G.RIGHT_JOIN_END,cb,db)):(db=fb(xa,Da,Ca),ka(xa,Da,Da,0,G.LEFT_CAP_END,Ca,db),ka(xa,Da,Da,0,G.RIGHT_CAP_END,Ca,db));D(Ha,na+qa,Ha,na,qa);Ta=D(Ha,Ta-qa,Ha,Ta,qa);this.parameters.wireframe&&this._addWireframeVertices(ha,na,Ta,qa)};fa._addWireframeVertices=function(ba,Z,ha,na){const pa=new Float32Array(ba.buffer,ha*Float32Array.BYTES_PER_ELEMENT);ba=new Float32Array(ba.buffer,Z*Float32Array.BYTES_PER_ELEMENT,
ha-Z);Z=0;for(ha=0;ha<ba.length-1;ha+=2*na)Z=D(ba,ha,pa,Z,na),Z=D(ba,ha+2*na,pa,Z,na),Z=D(ba,ha+1*na,pa,Z,na),Z=D(ba,ha+2*na,pa,Z,na),Z=D(ba,ha+1*na,pa,Z,na),Z=D(ba,ha+3*na,pa,Z,na)};return ca}();const K=l.create(),I=l.create(),O=l.create(),Q=l.create(),J=l.create(),P=w.createRenderScreenPointArray3(),N=w.createRenderScreenPointArray3(),R=l.create(),S=l.create(),T=e.create(),V=e.create(),W=l.create(),U=l.create(),aa=l.create(),da=[w.createRenderScreenPointArray3(),w.createRenderScreenPointArray3(),
w.createRenderScreenPointArray3(),w.createRenderScreenPointArray3()],Y=[l.create(),l.create(),l.create(),l.create()],ea=d.create(),ja=d.create(),la=d.create(),ia=d.create();a.RibbonLineMaterial=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/VisualVariableMaterialParameters":function(){define(["exports","../../../../chunks/mat3f64","../../../../chunks/vec3f32"],function(a,b,c){b={vvSizeEnabled:!1,vvSizeMinSize:c.fromValues(1,1,1),vvSizeMaxSize:c.fromValues(100,
100,100),vvSizeOffset:c.fromValues(0,0,0),vvSizeFactor:c.fromValues(1,1,1),vvSizeValue:c.fromValues(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:b.create()};a.VisualVariableDefaultMaterialParameters=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/RibbonLine.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z){function v(t){const r=new m.ShaderBuilder,x=t.capType!==a.CapType.BUTT,u=t.capType===a.CapType.ROUND,E=t.stippleEnabled&&u,y=t.falloffEnabled||E,A=t.innerColorEnabled||u,p=t.stippleEnabled&&t.stippleScaleWithLineWidth||u,B=t.stippleEnabled&&t.stippleScaleWithLineWidth,D=t.stippleEnabled||u;r.include(l.PiUtils);r.include(g.RibbonVertexPosition,t);r.include(n.LineStipple,{...t,stippleRequiresStretchMeasure:!0});t.output===b.ShaderOutput.Depth&&r.include(h.OutputDepth,
t);r.vertex.uniforms.add("proj","mat4").add("view","mat4").add("nearFar","vec2").add("pixelRatio","float").add("miterLimit","float").add("screenSize","vec2").add("inverseProjectionMatrix","mat4");r.vertex.constants.add("LARGE_HALF_FLOAT","float",65500);r.attributes.add(z.VertexAttribute.POSITION,"vec3");r.attributes.add(z.VertexAttribute.SUBDIVISIONFACTOR,"float");r.attributes.add(z.VertexAttribute.UV0,"vec2");r.attributes.add(z.VertexAttribute.AUXPOS1,"vec3");r.attributes.add(z.VertexAttribute.AUXPOS2,
"vec3");r.varyings.add("vColor","vec4");r.varyings.add("vpos","vec3");r.varyings.add("linearDepth","float");t.multipassTerrainEnabled&&r.varyings.add("depth","float");p&&r.varyings.add("vLineWidth","float");B&&r.varyings.add("vLineSizeInv","float");A&&r.varyings.add("vLineDistance","float");y&&r.varyings.add("vLineDistanceNorm","float");t.falloffEnabled&&r.fragment.uniforms.add("falloff","float");t.innerColorEnabled&&(r.fragment.uniforms.add("innerColor","vec4"),r.fragment.uniforms.add("innerWidth",
"float"));u&&(r.varyings.add("vSegmentSDF","float"),r.varyings.add("vReverseSegmentSDF","float"));r.vertex.code.add(d.glsl`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`);r.vertex.code.add(d.glsl`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= screenSize / posNdc.w;
return posNdc;
}`);r.vertex.code.add(d.glsl`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${t.multipassTerrainEnabled?"depth \x3d pos.z;":""}
      linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `);r.vertex.code.add(d.glsl`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${p?d.glsl`vLineWidth = lineWidth;`:""}
      ${B?d.glsl`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);

      clipAndTransform(pos, prev, next, isStartVertex);

      vec2 left = (pos.xy - prev.xy);
      vec2 right = (next.xy - pos.xy);

      float leftLen = length(left);
      float rightLen = length(right);
  `);D&&r.vertex.code.add(d.glsl`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${u?d.glsl`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `);r.vertex.code.add(d.glsl`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`);t.roundJoins?r.vertex.code.add(d.glsl`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${t.stippleEnabled?d.glsl`min(1.0, subdivisionFactor * ${d.glsl.float(1.5)})`:d.glsl`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):r.vertex.code.add(d.glsl`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);r.vertex.code.add(d.glsl`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${x?d.glsl`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `);r.vertex.code.add(d.glsl`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${y||A?d.glsl`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${A?d.glsl`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${y?d.glsl`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `);u&&r.vertex.code.add(d.glsl`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`);t.stippleEnabled&&(t.draped||r.vertex.code.add(d.glsl`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.vertex.code.add(d.glsl`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),t.draped?r.vertex.code.add(d.glsl`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):r.vertex.code.add(d.glsl`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.vertex.code.add(d.glsl`
      float patternLength = ${t.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `));r.vertex.code.add(d.glsl`
      // Convert back into NDC
      pos.xy = (pos.xy / screenSize) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${t.wireframe&&!t.draped?"pos.z -\x3d 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
    }
  }
  `);t.multipassTerrainEnabled&&(r.fragment.include(w.ReadLinearDepth),r.include(f.multipassTerrainTest,t));r.include(c.Slice,t);r.fragment.uniforms.add("intrinsicColor","vec4");r.fragment.include(e.ColorConversion);r.fragment.code.add(d.glsl`
  void main() {
    discardBySlice(vpos);
    ${t.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
  `);t.wireframe?r.fragment.code.add(d.glsl`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(u&&r.fragment.code.add(d.glsl`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${d.glsl.float(k.symbolAlphaCutoff)}) {
        discard;
      }
    `),E?r.fragment.code.add(d.glsl`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${d.glsl.float(k.symbolAlphaCutoff)}, stippleCoverage);
      `):r.fragment.code.add(d.glsl`float stippleAlpha = getStippleAlpha();`),r.fragment.code.add(d.glsl`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);
vec4 color = intrinsicColor * vColor;`),t.innerColorEnabled&&r.fragment.code.add(d.glsl`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`),r.fragment.code.add(d.glsl`vec4 finalColor = blendStipple(color, stippleAlpha);`),t.falloffEnabled&&r.fragment.code.add(d.glsl`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`));r.fragment.code.add(d.glsl`
    if (finalColor.a < ${d.glsl.float(k.symbolAlphaCutoff)}) {
      discard;
    }

    ${t.output===b.ShaderOutput.Alpha?d.glsl`gl_FragColor = vec4(finalColor.a);`:""}
    ${t.output===b.ShaderOutput.Color?d.glsl`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===b.ShaderOutput.Color&&t.oitEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
    ${t.output===b.ShaderOutput.Highlight?d.glsl`gl_FragColor = vec4(1.0);`:""}
    ${t.output===b.ShaderOutput.Depth?d.glsl`outputDepth(linearDepth);`:""}
  }
  `);return r}a.CapType=void 0;(function(t){t[t.BUTT=0]="BUTT";t[t.SQUARE=1]="SQUARE";t[t.ROUND=2]="ROUND";t[t.COUNT=3]="COUNT"})(a.CapType||(a.CapType={}));const q=Object.freeze({__proto__:null,NUM_ROUND_JOIN_SUBDIVISIONS:1,get CapType(){return a.CapType},build:v});a.NUM_ROUND_JOIN_SUBDIVISIONS=1;a.RibbonLineShader=q;a.build=v})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],
function(a,b,c){a.RibbonVertexPosition=function(g,h){g.vertex.uniforms.add("intrinsicWidth","float");h.vvSize?(g.attributes.add(c.VertexAttribute.SIZEFEATUREATTRIBUTE,"float"),g.vertex.uniforms.add("vvSizeMinSize","vec3"),g.vertex.uniforms.add("vvSizeMaxSize","vec3"),g.vertex.uniforms.add("vvSizeOffset","vec3"),g.vertex.uniforms.add("vvSizeFactor","vec3"),g.vertex.code.add(b.glsl`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(g.attributes.add(c.VertexAttribute.SIZE,"float"),g.vertex.code.add(b.glsl`float getSize(){
return intrinsicWidth * size;
}`));h.vvOpacity?(g.attributes.add(c.VertexAttribute.OPACITYFEATUREATTRIBUTE,"float"),g.vertex.constants.add("vvOpacityNumber","int",8),g.vertex.code.add(b.glsl`uniform float vvOpacityValues[vvOpacityNumber];
uniform float vvOpacityOpacities[vvOpacityNumber];
float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):g.vertex.code.add(b.glsl`vec4 applyOpacity( vec4 color ){
return color;
}`);h.vvColor?(g.attributes.add(c.VertexAttribute.COLORFEATUREATTRIBUTE,"float"),g.vertex.constants.add("vvColorNumber","int",8),g.vertex.code.add(b.glsl`uniform float vvColorValues[vvColorNumber];
uniform vec4 vvColorColors[vvColorNumber];
vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(g.attributes.add(c.VertexAttribute.COLOR,"vec4"),g.vertex.code.add(b.glsl`vec4 getColor(){
return applyOpacity(color);
}`))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl":function(){define(["exports","../ShaderOutputOptions","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,b,c,g){a.OutputDepth=function(h,w){h.fragment.include(c.RgbaFloatEncoding);w.output===b.ShaderOutput.Shadow?(h.extensions.add("GL_OES_standard_derivatives"),h.fragment.code.add(g.glsl`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 2.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`)):w.output===b.ShaderOutput.Depth&&h.fragment.code.add(g.glsl`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl":function(){define(["exports","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,b,c){const g=c.glsl.float(.4);a.LineStipple=function(h,w){h.constants.add("stippleAlphaColorDiscard","float",.001);h.constants.add("stippleAlphaHighlightDiscard","float",.5);if(w.stippleEnabled){{const n=!(w.draped&&w.stipplePreferContinuous);h.fragment.include(b.RgbaFloatEncoding);
h.vertex.uniforms.add("stipplePatternPixelSize","float");h.vertex.uniforms.add("pixelRatio","float");w.draped?h.vertex.uniforms.add("worldToScreenRatio","float"):(h.vertex.uniforms.add("worldToScreenPerDistanceRatio","float"),h.vertex.uniforms.add("cameraPosition","vec3"),h.vertex.code.add(c.glsl`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`));h.varyings.add("vStippleDistance","float");w.stippleRequiresClamp&&h.varyings.add("vStippleDistanceLimits","vec2");w.stippleRequiresStretchMeasure&&h.varyings.add("vStipplePatternStretch","float");h.vertex.code.add(c.glsl`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${g};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `);h.vertex.code.add(c.glsl`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`);h.vertex.code.add(c.glsl`
    if (segmentLengthPseudoScreen >= ${n?"patternLength":"1e4"}) {
  `);h.vertex.code.add(c.glsl`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${w.stippleRequiresStretchMeasure?c.glsl`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `);h.fragment.uniforms.add("stipplePatternTexture","sampler2D");h.fragment.uniforms.add("stipplePatternSDFNormalizer","float");h.fragment.uniforms.add("stipplePatternTextureSize","float");h.fragment.uniforms.add("stipplePatternPixelSizeInv","float");w.stippleOffColorEnabled&&h.fragment.uniforms.add("stippleOffColor","vec4");h.fragment.code.add(c.glsl`float padTexture(float u) {
return (u * stipplePatternTextureSize + 1.0)/(stipplePatternTextureSize + 2.0);
}`);h.fragment.code.add(c.glsl`
    float getStippleSDF(out bool isClamped) {
      ${w.stippleRequiresClamp?c.glsl`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:c.glsl`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${w.stippleScaleWithLineWidth?c.glsl`u *= vLineSizeInv;`:""}
      u = padTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${w.stippleRequiresStretchMeasure?c.glsl`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:c.glsl`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${w.stippleScaleWithLineWidth?c.glsl`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:c.glsl`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `);w.stippleOffColorEnabled?h.fragment.code.add(c.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`):h.fragment.code.add(c.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}}else h.fragment.code.add(c.glsl`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/RibbonLineTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../chunks/mat4 ../../../../geometry/support/vectorStacks ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/OrderIndependentTransparency ../lib/Program ../lib/RenderSlot ../lib/StencilUtils ../lib/VertexAttribute ../../../../chunks/RibbonLine.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B){const D=new Map([[y.VertexAttribute.POSITION,0],[y.VertexAttribute.SUBDIVISIONFACTOR,1],[y.VertexAttribute.UV0,2],[y.VertexAttribute.AUXPOS1,3],[y.VertexAttribute.AUXPOS2,4],[y.VertexAttribute.SIZE,6],[y.VertexAttribute.SIZEFEATUREATTRIBUTE,6],[y.VertexAttribute.COLOR,5],[y.VertexAttribute.COLORFEATUREATTRIBUTE,5],[y.VertexAttribute.OPACITYFEATUREATTRIBUTE,7]]);v=function(F){function G(H,M,K){M=F.call(this,H,M,K)||this;M.stippleTextureRepository=
H.stippleTextureRepository;return M}c._inheritsLoose(G,F);var L=G.prototype;L.initializeProgram=function(H){var M=G.shader.get();const K=this.configuration;M=M.build({oitEnabled:K.transparencyPassType===t.TransparencyPassType.Color,output:K.output,slicePlaneEnabled:K.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,draped:K.draped,stippleEnabled:this.stippleEnabled,stippleOffColorEnabled:K.stippleOffColorEnabled,stippleRequiresClamp:!0,stippleScaleWithLineWidth:K.stippleScaleWithLineWidth,
stipplePreferContinuous:K.stipplePreferContinuous,capType:K.capType,roundJoins:K.roundJoins,vvColor:K.vvColor,vvSize:K.vvSize,vvInstancingEnabled:!0,vvOpacity:K.vvOpacity,falloffEnabled:K.falloffEnabled,innerColorEnabled:K.innerColorEnabled,multipassTerrainEnabled:K.multipassTerrainEnabled,cullAboveGround:K.cullAboveGround,wireframe:K.wireframe});return new x.Program(H.rctx,M,D)};L.destroy=function(){F.prototype.destroy.call(this);this.stippleTextureRepository.release(this.stipplePattern);this.stippleTextureBind=
this.stipplePattern=null};L.bindPass=function(H,M){m.bindProjectionMatrix(this.program,M.camera.projectionMatrix);this.configuration.output===f.ShaderOutput.Highlight&&k.bindOutputHighlight(this.program,M);M.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",M.inverseViewport),e.bindMultipassTerrainTexture(this.program,M));this.program.setUniform1f("intrinsicWidth",H.width);this.program.setUniform4fv("intrinsicColor",H.color);this.program.setUniform1f("miterLimit","miter"!==H.join?
0:H.miterLimit);this.program.setUniform2fv("nearFar",M.camera.nearFar);this.program.setUniform1f("pixelRatio",M.camera.pixelRatio);this.program.setUniform2f("screenSize",M.camera.fullViewport[2],M.camera.fullViewport[3]);d.bindVisualVariablesUniformsWithOpacity(this.program,H);if(this.stipplePattern!==H.stipplePattern){var K=H.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,K);this.stipplePattern=K}if(this.stippleEnabled){const {pixelSize:I,sdfNormalizer:O,
pixels:Q}=h.isSome(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",O);this.program.setUniform1f("stipplePatternTextureSize",Q);this.program.setUniform1f("stipplePatternPixelSize",I);this.program.setUniform1f("stipplePatternPixelSizeInv",1/I);this.configuration.draped?this.program.setUniform1f("worldToScreenRatio",1/M.screenToPCSRatio):this.program.setUniform1f("worldToScreenPerDistanceRatio",
1/M.camera.perScreenPixelRatio);this.configuration.stippleOffColorEnabled&&(K=h.unwrap(H.stippleOffColor),this.program.setUniform4f("stippleOffColor",K[0],K[1],K[2],3<K.length?K[3]:1))}this.configuration.falloffEnabled&&this.program.setUniform1f("falloff",H.falloff);this.configuration.innerColorEnabled&&(this.program.setUniform4fv("innerColor",h.unwrapOr(H.innerColor,H.color)),this.program.setUniform1f("innerWidth",H.innerWidth*M.camera.pixelRatio))};L.bindDraw=function(H){m.bindView(this.program,
H);this.stippleEnabled&&!this.configuration.draped&&m.bindCameraPosition(this.program,H.origin,H.camera.viewInverseTransposeMatrix);l.bindSliceUniforms(this.program,this.configuration,H.slicePlane,{origin:H.origin,view:H.camera.viewMatrix});this.program.setUniformMatrix4fv("inverseProjectionMatrix",w.invert(n.sm4d.get(),H.camera.projectionMatrix));this.program.rebindTextures()};L._makePipelineState=function(H,M){const K=this.configuration,I=H===t.TransparencyPassType.NONE,O=H===t.TransparencyPassType.FrontFace;
return B.makePipelineState({blending:K.output===f.ShaderOutput.Color||K.output===f.ShaderOutput.Alpha?I?r.blendingDefault:r.oitBlending(H):null,depthTest:{func:r.oitDepthTest(H)},depthWrite:I?K.writeDepth&&B.defaultDepthWriteParams:r.oitDepthWrite(H),colorWrite:B.defaultColorWriteParams,stencilWrite:K.sceneHasOcludees?E.stencilWriteMaskOn:null,stencilTest:K.sceneHasOcludees?M?E.stencilToolMaskBaseParams:E.stencilBaseAllZerosParams:null,polygonOffset:I||O?K.polygonOffset&&C:r.OITPolygonOffset})};L.initializePipeline=
function(){const H=this.configuration,M=H.polygonOffset&&C;H.occluder&&(this._occluderPipelineTransparent=B.makePipelineState({blending:r.blendingDefault,polygonOffset:M,depthTest:E.depthCompareAlways,depthWrite:null,colorWrite:B.defaultColorWriteParams,stencilWrite:null,stencilTest:E.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=B.makePipelineState({blending:r.blendingDefault,polygonOffset:M,depthTest:E.depthCompareAlways,depthWrite:null,colorWrite:B.defaultColorWriteParams,
stencilWrite:E.stencilWriteMaskOff,stencilTest:E.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=B.makePipelineState({blending:null,polygonOffset:M,depthTest:E.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:E.stencilWriteMaskOn,stencilTest:E.stencilToolMaskBaseParams}));this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0);return this._makePipelineState(this.configuration.transparencyPassType,!1)};L.getPipelineState=function(H,
M){return M?this._occludeePipelineState:this.configuration.occluder?H===u.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:H===u.RenderSlot.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:F.prototype.getPipelineState.call(this,H,M)};c._createClass(G,[{key:"stippleEnabled",get:function(){return this.configuration.stippleEnabled&&this.configuration.output!==f.ShaderOutput.Highlight}},{key:"primitiveType",get:function(){return this.configuration.wireframe?
p.PrimitiveType.LINES:p.PrimitiveType.TRIANGLE_STRIP}}]);return G}(v.ShaderTechnique);v.shader=new z.ReloadableShaderModule(A.RibbonLineShader,()=>new Promise((F,G)=>a(["./RibbonLine.glsl"],F,G)));const C={factor:0,units:-4};z=function(F){function G(){var L=F.apply(this,arguments)||this;L.output=f.ShaderOutput.Color;L.occluder=!1;L.slicePlaneEnabled=!1;L.transparent=!1;L.polygonOffset=!1;L.writeDepth=!1;L.draped=!1;L.stippleEnabled=!1;L.stippleOffColorEnabled=!1;L.stippleScaleWithLineWidth=!1;L.stipplePreferContinuous=
!0;L.capType=A.CapType.BUTT;L.roundJoins=!1;L.vvSize=!1;L.vvColor=!1;L.vvOpacity=!1;L.falloffEnabled=!1;L.innerColorEnabled=!1;L.sceneHasOcludees=!1;L.transparencyPassType=t.TransparencyPassType.NONE;L.multipassTerrainEnabled=!1;L.cullAboveGround=!1;L.wireframe=!1;return L}c._inheritsLoose(G,F);return G}(q.ShaderTechniqueConfiguration);g.__decorate([q.parameter({count:f.ShaderOutput.COUNT})],z.prototype,"output",void 0);g.__decorate([q.parameter()],z.prototype,"occluder",void 0);g.__decorate([q.parameter()],
z.prototype,"slicePlaneEnabled",void 0);g.__decorate([q.parameter()],z.prototype,"transparent",void 0);g.__decorate([q.parameter()],z.prototype,"polygonOffset",void 0);g.__decorate([q.parameter()],z.prototype,"writeDepth",void 0);g.__decorate([q.parameter()],z.prototype,"draped",void 0);g.__decorate([q.parameter()],z.prototype,"stippleEnabled",void 0);g.__decorate([q.parameter()],z.prototype,"stippleOffColorEnabled",void 0);g.__decorate([q.parameter()],z.prototype,"stippleScaleWithLineWidth",void 0);
g.__decorate([q.parameter()],z.prototype,"stipplePreferContinuous",void 0);g.__decorate([q.parameter({count:A.CapType.COUNT})],z.prototype,"capType",void 0);g.__decorate([q.parameter()],z.prototype,"roundJoins",void 0);g.__decorate([q.parameter()],z.prototype,"vvSize",void 0);g.__decorate([q.parameter()],z.prototype,"vvColor",void 0);g.__decorate([q.parameter()],z.prototype,"vvOpacity",void 0);g.__decorate([q.parameter()],z.prototype,"falloffEnabled",void 0);g.__decorate([q.parameter()],z.prototype,
"innerColorEnabled",void 0);g.__decorate([q.parameter()],z.prototype,"sceneHasOcludees",void 0);g.__decorate([q.parameter({count:t.TransparencyPassType.COUNT})],z.prototype,"transparencyPassType",void 0);g.__decorate([q.parameter()],z.prototype,"multipassTerrainEnabled",void 0);g.__decorate([q.parameter()],z.prototype,"cullAboveGround",void 0);g.__decorate([q.parameter()],z.prototype,"wireframe",void 0);b.RibbonLineTechnique=v;b.RibbonLineTechniqueConfiguration=z;b.ribbonVertexAttributeLocations=
D;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/StencilUtils":function(){define(["exports","./basicInterfaces","../../../webgl/enums"],function(a,b,c){const g={func:c.CompareFunction.LESS},h={function:{func:c.CompareFunction.ALWAYS,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.ZERO}},w={function:{func:c.CompareFunction.ALWAYS,
ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.REPLACE}},n={function:{func:c.CompareFunction.EQUAL,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.KEEP}};b={function:{func:c.CompareFunction.NOTEQUAL,ref:b.StencilBits.OutlineVisualElementMask,
mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.KEEP}};a.depthCompareAlways={func:c.CompareFunction.ALWAYS};a.depthCompareLess=g;a.renderWhenBitIsNotSet=f=>({function:{func:c.CompareFunction.NOTEQUAL,ref:f,mask:f},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.KEEP}});a.replaceBitWhenDepthTestPasses=f=>({function:{func:c.CompareFunction.ALWAYS,ref:f,mask:f},operation:{fail:c.StencilOperation.KEEP,
zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.REPLACE}});a.stencilBaseAllZerosParams=h;a.stencilToolMaskBaseParams=w;a.stencilToolMaskOccluderParams=n;a.stencilToolTransparentOccluderParams=b;a.stencilWriteMaskOff={mask:0};a.stencilWriteMaskOn={mask:255};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ./Camera ./Material ./RenderPass ./RenderSlot".split(" "),function(a,
b,c,g,h,w){let n=function(){function k(e){this.rctx=e;this.camera=null;this.lastFrameCamera=new c.default;this.pass=h.RenderPass.MATERIAL;this.slot=w.RenderSlot.OPAQUE_MATERIAL;this.highlightDepthTexture=null;this.renderOccludedMask=l;this.hasOccludees=!1;this.hasFillLights=!0}k.prototype.resetRenderOccludedMask=function(){this.renderOccludedMask=l};b._createClass(k,[{key:"isHighlightPass",get:function(){return this.pass===h.RenderPass.MATERIAL_HIGHLIGHT}}]);return k}(),f=function(k){function e(d,
m,z,v,q,t){d=k.call(this,d)||this;d.offscreenRenderingHelper=m;d.scenelightingData=z;d.shadowMap=v;d.ssaoHelper=q;d.sliceHelper=t;return d}b._inheritsLoose(e,k);return e}(n);const l=g.RenderOccludedFlag.Occlude|g.RenderOccludedFlag.OccludeAndTransparent|g.RenderOccludedFlag.OccludeAndTransparentStencil;a.OverlayRenderContext=n;a.RenderContext=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../chunks/TextureOnly.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ./DefaultVertexAttributeLocations ./Program ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){n=function(m){function z(){return m.apply(this,arguments)||this}c._inheritsLoose(z,m);var v=z.prototype;v.initializeProgram=function(q){const t=z.shader.get().build();return new k.Program(q.rctx,t,l.Default3D)};v.initializePipeline=function(){return this.configuration.hasAlpha?d.makePipelineState({blending:d.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:d.defaultColorWriteParams}):
d.makePipelineState({colorWrite:d.defaultColorWriteParams})};return z}(n.ShaderTechnique);n.shader=new w.ReloadableShaderModule(h.TextureOnlyShader,()=>new Promise((m,z)=>a(["../core/shaderLibrary/util/TextureOnly.glsl"],m,z)));h=function(m){function z(){var v=m.apply(this,arguments)||this;v.hasAlpha=!1;return v}c._inheritsLoose(z,m);return z}(f.ShaderTechniqueConfiguration);g.__decorate([f.parameter()],h.prototype,"hasAlpha",void 0);b.TextureTechnique=n;b.TextureTechniqueConfiguration=h;Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/chunks/TextureOnly.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],function(a,b,c,g){function h(){const n=new g.ShaderBuilder;n.include(b.ScreenSpacePass);n.fragment.uniforms.add("tex","sampler2D");n.fragment.uniforms.add("uColor","vec4");n.fragment.code.add(c.glsl`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`);return n}const w=Object.freeze({__proto__:null,build:h});a.TextureOnlyShader=w;a.build=h})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./Lightsources ./SphericalHarmonics".split(" "),function(a,b,c,g,h,w){let n=function(){function l(){this._shOrder=2;this._ambientBoost=.4;this._oldSunlight={direction:g.create(),ambient:{color:g.create(),intensity:1},diffuse:{color:g.create(),
intensity:1}};this.groundLightingFactor=this.globalFactor=.5;this._sphericalHarmonics=new h.SphericalHarmonicsAmbientLight;this._mainLight={intensity:g.create(),direction:g.fromValues(1,0,0),castShadows:!1,specularStrength:1,environmentStrength:1}}var k=l.prototype;k.setLightDirectionUniform=function(e){e.setUniform3fv("lightingMainDirection",this._mainLight.direction)};k.setUniforms=function(e,d,m){e.setUniform1f("lightingFixedFactor",d?(1-this.groundLightingFactor)*(1-this.globalFactor):0);e.setUniform1f("lightingGlobalFactor",
this.globalFactor);this.setLightDirectionUniform(e);e.setUniform3fv("lightingMainIntensity",this._mainLight.intensity);e.setUniform1f("lightingSpecularStrength",this._mainLight.specularStrength);e.setUniform1f("lightingEnvironmentStrength",this._mainLight.environmentStrength);e.setUniform1f("ambientBoostFactor",this._ambientBoost);e.setUniform1b("hasFillLights",m);d=this._sphericalHarmonics;0===this._shOrder?e.setUniform3f("lightingAmbientSH0",d.r[0],d.g[0],d.b[0]):1===this._shOrder?(e.setUniform4f("lightingAmbientSH_R",
d.r[0],d.r[1],d.r[2],d.r[3]),e.setUniform4f("lightingAmbientSH_G",d.g[0],d.g[1],d.g[2],d.g[3]),e.setUniform4f("lightingAmbientSH_B",d.b[0],d.b[1],d.b[2],d.b[3])):2===this._shOrder&&(e.setUniform3f("lightingAmbientSH0",d.r[0],d.g[0],d.b[0]),e.setUniform4f("lightingAmbientSH_R1",d.r[1],d.r[2],d.r[3],d.r[4]),e.setUniform4f("lightingAmbientSH_G1",d.g[1],d.g[2],d.g[3],d.g[4]),e.setUniform4f("lightingAmbientSH_B1",d.b[1],d.b[2],d.b[3],d.b[4]),e.setUniform4f("lightingAmbientSH_R2",d.r[5],d.r[6],d.r[7],d.r[8]),
e.setUniform4f("lightingAmbientSH_G2",d.g[5],d.g[6],d.g[7],d.g[8]),e.setUniform4f("lightingAmbientSH_B2",d.b[5],d.b[6],d.b[7],d.b[8]))};k.set=function(e){w.combineLights(e,this._shOrder,this._mainLight,this._sphericalHarmonics);c.copy(this._oldSunlight.direction,this._mainLight.direction);e=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*e;this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*e;this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*
e;c.scale(this._oldSunlight.diffuse.color,this._mainLight.intensity,e);c.copy(f,this._oldSunlight.diffuse.color);c.scale(f,f,this._ambientBoost*this.globalFactor);c.add(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,f)};b._createClass(l,[{key:"lightingMainDirection",get:function(){return this._mainLight.direction}},{key:"old",get:function(){return this._oldSunlight}}]);return l}();const f=g.create();a.SceneLighting=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../lib/LongVectorMath ./Lightsources".split(" "),
function(a,b,c,g,h,w){function n(u){return(u+1)*(u+1)}function f(u){return b.clamp(Math.floor(Math.sqrt(u)-1),0,2)}function l(u,E,y){const A=u[0],p=u[1];u=u[2];y=y||[];y.length=n(E);0<=E&&(y[0]=.28209479177);1<=E&&(y[1]=.4886025119*A,y[2]=.4886025119*u,y[3]=.4886025119*p);2<=E&&(y[4]=1.09254843059*A*p,y[5]=1.09254843059*p*u,y[6]=.31539156525*(3*u*u-1),y[7]=1.09254843059*A*u,y[8]=.54627421529*(A*A-p*p));return y}function k(u,E){u=n(u);E=E||{r:[],g:[],b:[]};E.r.length=E.g.length=E.b.length=u;for(let y=
0;y<u;y++)E.r[y]=E.g[y]=E.b[y]=0;return E}function e(u,E){const y=f(E.r.length);for(const A of u)c.negate(r,A.direction),l(r,y,q),h.elementwiseProduct(q,x),h.scalarProduct(q,A.intensity[0],t),h.add(E.r,t),h.scalarProduct(q,A.intensity[1],t),h.add(E.g,t),h.scalarProduct(q,A.intensity[2],t),h.add(E.b,t);return E}function d(u,E){l(r,0,q);for(const y of u)E.r[0]+=q[0]*x[0]*y.intensity[0]*4*Math.PI,E.g[0]+=q[0]*x[0]*y.intensity[1]*4*Math.PI,E.b[0]+=q[0]*x[0]*y.intensity[2]*4*Math.PI;return E}const m=[],
z=[],v=[],q=[0],t=[0],r=g.create(),x=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];a.combineLights=function(u,E,y,A){k(E,A);c.set(y.intensity,0,0,0);E=!1;m.length=0;z.length=0;v.length=0;for(const p of u)p instanceof w.MainLight&&!E?(c.copy(y.direction,p.direction),c.copy(y.intensity,p.intensity),y.specularStrength=p.specularStrength,y.environmentStrength=p.environmentStrength,y.castShadows=p.castShadows,E=!0):p instanceof w.MainLight||p instanceof w.FillLight?m.push(p):
p instanceof w.AmbientLight?z.push(p):p instanceof w.SphericalHarmonicsAmbientLight&&v.push(p);e(m,A);d(z,A);for(const p of v)h.add(A.r,p.r),h.add(A.g,p.g),h.add(A.b,p.b)};a.computeCoefficients=l;a.initSHCoefficients=k;a.numberOfCoefficients=n;a.orderFromNumberOfCoefficients=f;a.projectAmbientLights=d;a.projectFillLights=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["exports"],function(a){a.add=function(b,c,g){g=g||b;g.length=
b.length;for(let h=0;h<b.length;h++)g[h]=b[h]+c[h];return g};a.dotProduct=function(b,c){let g=0;for(let h=0;h<b.length;h++)g+=b[h]*c[h];return g};a.elementwiseProduct=function(b,c,g){g=g||b;g.length=b.length;for(let h=0;h<b.length;h++)g[h]=b[h]*c[h];return g};a.scalarProduct=function(b,c,g){g=g||b;g.length=b.length;for(let h=0;h<b.length;h++)g[h]=b[h]*c;return g};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/StippleTextureRepository":function(){define(["exports",
"../../../../core/floatRGBA","../../../../core/maybe","../../../webgl/enums","../../../webgl/Texture"],function(a,b,c,g,h){function w(f,l){var k=f.map(q=>Math.round(q*l)),e=1/l;f=Math.floor(k.reduce((q,t)=>q+t));var d=k.reduce((q,t)=>Math.max(q,t));d=(Math.floor(.5*(d-1))+.5)*e;var m=[];let z=1;for(var v of k){for(let q=0;q<v;q++)m.push(z*(Math.min(q,v-1-q)+.5)*e/d*.5+.5);z=-z}v=Math.round(k[0]/2);v=[...m.slice(v),...m.slice(0,v)];k=f+2;e=new Uint8Array(4*k);m=4;for(const q of v)b.packFloatRGBA(q,
e,m),m+=4;e.copyWithin(0,m-4,m);e.copyWithin(m,4,8);return{encodedData:e,sdfNormalizer:d,paddedPixels:k,pixels:f}}let n=function(){function f(k){this._rctx=k;this.cache=new Map}var l=f.prototype;l.dispose=function(){this.cache.forEach(k=>k.texture=c.disposeMaybe(k.texture));this.cache.clear()};l._acquire=function(k){if(c.isNone(k))return null;const e=this._patternId(k);var d=this.cache.get(e);if(d)return d.refCount++,d.bind;d=k.pixelRatio;const {encodedData:m,sdfNormalizer:z,pixels:v,paddedPixels:q}=
w(k.pattern,d),t=v/d,r={refCount:1,texture:null,bind:x=>{c.isNone(r.texture)&&(r.texture=new h.Texture(this._rctx,{width:q,height:1,internalFormat:g.PixelFormat.RGBA,pixelFormat:g.PixelFormat.RGBA,dataType:g.PixelType.UNSIGNED_BYTE,wrapMode:g.TextureWrapMode.CLAMP_TO_EDGE},m));x.bindTexture(r.texture,"stipplePatternTexture");return{pixelSize:t,sdfNormalizer:z,pixels:v}}};this.cache.set(e,r);return r.bind};l.release=function(k){if(!c.isNone(k)){k=this._patternId(k);var e=this.cache.get(k);e&&(e.refCount--,
0===e.refCount&&(c.isSome(e.texture)&&e.texture.dispose(),this.cache.delete(k)))}};l.swap=function(k,e){e=this._acquire(e);this.release(k);return e};l._patternId=function(k){return`${k.pattern.join(",")}-r${k.pixelRatio}`};return f}();a.StippleTextureRepository=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/Compositing.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],
function(a,b,c,g){function h(n){const f=new g.ShaderBuilder;f.include(b.ScreenSpacePass);f.fragment.uniforms.add("tex","sampler2D");n.function===a.CompositingFunction.Standard&&(n.hasOpacityFactor?(f.fragment.uniforms.add("opacity","float"),f.fragment.code.add(c.glsl`void main() {
gl_FragColor = texture2D(tex, uv) * opacity;
}`)):f.fragment.code.add(c.glsl`void main() {
gl_FragColor = texture2D(tex, uv);
}`));n.function===a.CompositingFunction.OverlayWithTransparency&&(f.fragment.uniforms.add("overlayIdx","int"),n.hasOpacityFactor&&f.fragment.uniforms.add("opacity","float"),f.fragment.code.add(c.glsl`
      void main() {
        vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
        gl_FragColor = texture2D(tex, overlayUV) ${n.hasOpacityFactor?"* opacity":""};
      }`));n.function===a.CompositingFunction.TransparentToHUDVisibility&&f.fragment.code.add(c.glsl`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`);n.function===a.CompositingFunction.Transparency&&(f.fragment.uniforms.add("colorTexture","sampler2D"),f.fragment.uniforms.add("alphaTexture","sampler2D"),f.fragment.uniforms.add("frontFaceTexture","sampler2D"),f.fragment.code.add(c.glsl`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`));return f}a.CompositingFunction=void 0;(function(n){n[n.Standard=0]="Standard";n[n.TransparentToHUDVisibility=1]="TransparentToHUDVisibility";n[n.Transparency=2]="Transparency";n[n.OverlayWithTransparency=3]="OverlayWithTransparency";n[n.COUNT=4]="COUNT"})(a.CompositingFunction||(a.CompositingFunction={}));const w=Object.freeze({__proto__:null,get CompositingFunction(){return a.CompositingFunction},build:h});a.CompositingShader=w;a.build=h})},"esri/views/3d/webgl-engine/shaders/CompositingTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/Compositing.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){b.AlphaMode=void 0;(function(m){m[m.None=0]="None";m[m.Alpha=1]="Alpha";m[m.PremultipliedAlpha=2]="PremultipliedAlpha";m[m.COUNT=3]="COUNT"})(b.AlphaMode||(b.AlphaMode={}));w=function(m){function z(){return m.apply(this,arguments)||this}c._inheritsLoose(z,m);var v=z.prototype;v.initializeProgram=function(q){const t=z.shader.get().build(this.configuration);return new l.Program(q.rctx,t,f.Default3D)};v.initializePipeline=function(){if(this.configuration.function===
k.CompositingFunction.TransparentToHUDVisibility)return d.makePipelineState({colorWrite:{r:!1,g:!0,b:!1,a:!1}});switch(this.configuration.alphaMode){case b.AlphaMode.None:return d.makePipelineState({colorWrite:d.defaultColorWriteParams});case b.AlphaMode.Alpha:return d.makePipelineState({blending:d.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:d.defaultColorWriteParams});default:return d.makePipelineState({blending:d.simpleBlendingParams(e.BlendFactor.ONE,
e.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:d.defaultColorWriteParams})}};return z}(w.ShaderTechnique);w.shader=new h.ReloadableShaderModule(k.CompositingShader,()=>new Promise((m,z)=>a(["./Compositing.glsl"],m,z)));h=function(m){function z(){var v=m.apply(this,arguments)||this;v.function=k.CompositingFunction.Standard;v.alphaMode=b.AlphaMode.None;v.hasOpacityFactor=!1;return v}c._inheritsLoose(z,m);return z}(n.ShaderTechniqueConfiguration);g.__decorate([n.parameter({count:k.CompositingFunction.COUNT})],
h.prototype,"function",void 0);g.__decorate([n.parameter({count:b.AlphaMode.COUNT})],h.prototype,"alphaMode",void 0);g.__decorate([n.parameter()],h.prototype,"hasOpacityFactor",void 0);b.CompositingTechnique=w;b.CompositingTechniqueConfiguration=h;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/util/AlphaDiscard.glsl ../lib/basicInterfaces ../lib/GLMaterialTexture ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderPass ../lib/RenderSlot ../lib/VertexAttribute ../lib/verticalOffsetUtils ./internal/bufferWriterUtils ./internal/MaterialUtil ../shaders/DefaultMaterialTechnique ../shaders/RealisticTreeTechnique".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A){function p(Q){let J=f.newLayout();J=Q.instancedDoublePrecision?J.vec3f(r.VertexAttribute.MODELORIGINHI).vec3f(r.VertexAttribute.MODELORIGINLO).mat3f(r.VertexAttribute.MODEL).mat3f(r.VertexAttribute.MODELNORMAL):J.mat4f(r.VertexAttribute.MODEL).mat4f(r.VertexAttribute.MODELNORMAL);Q.instanced&&-1<Q.instanced.indexOf("color")&&(J=J.vec4f(r.VertexAttribute.INSTANCECOLOR));Q.instanced&&-1<Q.instanced.indexOf("featureAttribute")&&(J=J.vec4f(r.VertexAttribute.INSTANCEFEATUREATTRIBUTE));
return J}let B=function(Q){function J(N){var R=Q.call(this,N,C)||this;R.supportsEdges=!0;R.techniqueConfig=new y.DefaultMaterialTechniqueConfiguration;{var S=R.parameters;const T=S.textureId||S.normalTextureId||S.metallicRoughnessTextureId||S.emissiveTextureId||S.occlusionTextureId,V=f.newLayout().vec3f(r.VertexAttribute.POSITION).vec3f(r.VertexAttribute.NORMAL);S.vertexTangents&&V.vec4f(r.VertexAttribute.TANGENT);T&&V.vec2f(r.VertexAttribute.UV0);S.vertexColors&&V.vec4u8(r.VertexAttribute.COLOR);
S.symbolColors&&V.vec4u8(r.VertexAttribute.SYMBOLCOLOR);S=V}R.vertexBufferLayout=S;R.instanceBufferLayout=N.instanced?p(R.parameters):null;return R}b._inheritsLoose(J,Q);var P=J.prototype;P.isVisibleInPass=function(N){return N===q.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL||N===q.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT||N===q.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT?this.parameters.castShadows:!0};P.isVisible=function(){var N=this.parameters;if(!Q.prototype.isVisible.call(this)||0===N.layerOpacity)return!1;
var R=N.instanced;const S=N.vertexColors,T=N.symbolColors;R=!!R&&-1<R.indexOf("color");const V=N.vvColorEnabled,W="replace"===N.colorMixMode,U=0<N.opacity;N=N.externalColor&&0<N.externalColor[3];return S&&(R||V||T)?W?!0:U:S?W?N:U:R||V||T?W?!0:U:W?N:U};P.getTechniqueConfig=function(N,R){this.techniqueConfig.output=N;this.techniqueConfig.hasNormalTexture=!!this.parameters.normalTextureId;this.techniqueConfig.hasColorTexture=!!this.parameters.textureId;this.techniqueConfig.vertexTangents=this.parameters.vertexTangents;
this.techniqueConfig.instanced=!!this.parameters.instanced;this.techniqueConfig.instancedDoublePrecision=this.parameters.instancedDoublePrecision;this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled;this.techniqueConfig.verticalOffset=null!==this.parameters.verticalOffset;this.techniqueConfig.screenSizePerspective=null!==this.parameters.screenSizePerspective;this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled;this.techniqueConfig.sliceHighlightDisabled=this.parameters.sliceHighlightDisabled;
this.techniqueConfig.alphaDiscardMode=this.parameters.textureAlphaMode;this.techniqueConfig.normalsTypeDerivate="screenDerivative"===this.parameters.normals?!0:!1;this.techniqueConfig.transparent=this.parameters.transparent;this.techniqueConfig.writeDepth=this.parameters.writeDepth;c.isSome(this.parameters.customDepthTest)&&(this.techniqueConfig.customDepthTest=this.parameters.customDepthTest);this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees;this.techniqueConfig.cullFace=this.parameters.slicePlaneEnabled?
d.CullFaceOptions.None:this.parameters.cullFace;this.techniqueConfig.multipassTerrainEnabled=R.multipassTerrainEnabled;this.techniqueConfig.cullAboveGround=R.cullAboveGround;this.techniqueConfig.hasModelTransformation=c.isSome(this.parameters.modelTransformation);if(N===l.ShaderOutput.Color||N===l.ShaderOutput.Alpha)this.techniqueConfig.vertexColors=this.parameters.vertexColors,this.techniqueConfig.symbolColors=this.parameters.symbolColors,this.techniqueConfig.doubleSidedMode=this.parameters.treeRendering?
k.NormalsDoubleSidedMode.WindingOrder:this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?k.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?k.NormalsDoubleSidedMode.WindingOrder:k.NormalsDoubleSidedMode.None,this.techniqueConfig.instancedColor=!!this.parameters.instanced&&-1<this.parameters.instanced.indexOf("color"),this.techniqueConfig.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,
this.techniqueConfig.receiveAmbientOcclusion=R.ssaoEnabled?this.parameters.receiveSSAO:!1,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this.techniqueConfig.usePBR=this.parameters.usePBR,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.parameters.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=
!!this.parameters.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this.techniqueConfig.isSchematic=this.parameters.usePBR&&this.parameters.isSchematic,this.techniqueConfig.transparencyPassType=R.transparencyPassType,this.techniqueConfig.enableOffset=R.camera.relativeElevation<v.OITPolygonOffsetLimit;return this.techniqueConfig};P.intersect=function(N,R,S,T,V,W,U){if(null!==this.parameters.verticalOffset){const da=
T.camera;h.set(I,S[12],S[13],S[14]);S=null;switch(T.viewingMode){case n.ViewingMode.Global:S=h.normalize(M,I);break;case n.ViewingMode.Local:S=h.copy(M,H)}let Y=0;if(null!==this.parameters.verticalOffset){var aa=h.subtract(O,I,da.eye);const ea=h.length(aa);aa=h.scale(aa,aa,1/ea);let ja=null;this.parameters.screenSizePerspective&&(ja=h.dot(S,aa));Y+=E.verticalOffsetAtDistance(da,ea,this.parameters.verticalOffset,ja,this.parameters.screenSizePerspective)}h.scale(S,S,Y);h.transformMat3(K,S,T.transform.inverseRotation);
V=h.subtract(G,V,K);W=h.subtract(L,W,K)}E.intersectTriangleGeometry(N,R,T,V,W,x.getVerticalOffsetObject3D(T.verticalOffset),U)};P.requiresSlot=function(N){return N===(this.parameters.transparent?this.parameters.writeDepth?t.RenderSlot.TRANSPARENT_MATERIAL:t.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:t.RenderSlot.OPAQUE_MATERIAL)||N===t.RenderSlot.DRAPED_MATERIAL};P.createGLMaterial=function(N){return N.output===l.ShaderOutput.Color||N.output===l.ShaderOutput.Alpha||N.output===l.ShaderOutput.Depth||
N.output===l.ShaderOutput.Normal||N.output===l.ShaderOutput.Shadow||N.output===l.ShaderOutput.Highlight?new D(N):null};P.createBufferWriter=function(){return new F(this.vertexBufferLayout,this.instanceBufferLayout)};return J}(z.Material),D=function(Q){function J(N){return Q.call(this,{...N,...N.material.parameters})||this}b._inheritsLoose(J,Q);var P=J.prototype;P.updateParameters=function(N){const R=this._material.parameters;this.updateTexture(R.textureId);return this.ensureTechnique(R.treeRendering?
A.RealisticTreeTechnique:y.DefaultMaterialTechnique,N)};P._updateShadowState=function(N){N.shadowMappingEnabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:N.shadowMappingEnabled})};P._updateOccludeeState=function(N){N.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:N.hasOccludees})};P.beginSlot=function(N){if(this._output===l.ShaderOutput.Color||this._output===l.ShaderOutput.Alpha)this._updateShadowState(N),
this._updateOccludeeState(N);return this.updateParameters(N)};P.bind=function(N,R){R.bindPass(this._material.parameters,N);this.bindTextures(R.program)};return J}(m);const C={textureId:void 0,initTextureTransparent:!1,isSchematic:!1,usePBR:!1,normalTextureId:void 0,vertexTangents:!1,occlusionTextureId:void 0,emissiveTextureId:void 0,metallicRoughnessTextureId:void 0,emissiveFactor:[0,0,0],mrrFactors:[0,1,.5],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,
layerOpacity:1,vertexColors:!1,symbolColors:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:d.CullFaceOptions.Back,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,fillLightsEnabled:!0,receiveShadows:!0,castShadows:!0,shadowMappingEnabled:!1,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,sliceHighlightDisabled:!1,offsetTransparentBackfaces:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,
1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:g.create(),modelTransformation:null,transparent:!1,writeDepth:!0,customDepthTest:d.DepthTestFunction.Less,textureAlphaMode:d.AlphaDiscardMode.Blend,textureAlphaCutoff:e.defaultMaskAlphaCutoff,textureAlphaPremultiplied:!1,sceneHasOcludees:!1,...z.DefaultMaterialParameters};let F=function(){function Q(P,
N){this.vertexBufferLayout=P;this.instanceBufferLayout=N}var J=Q.prototype;J.allocate=function(P){return this.vertexBufferLayout.createBuffer(P)};J.elementCount=function(P){return P.indices.get(r.VertexAttribute.POSITION).length};J.write=function(P,N,R,S){u.writeDefaultAttributes(N,this.vertexBufferLayout,P.transformation,P.invTranspTransformation,R,S)};return Q}();const G=w.create(),L=w.create(),H=w.fromValues(0,0,1),M=w.create(),K=w.create(),I=w.create(),O=w.create();a.DefaultMaterial=B;a.getInstanceBufferLayout=
p;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/interfaces"],function(a,b,c){a.NormalsDoubleSidedMode=void 0;(function(g){g[g.None=0]="None";g[g.View=1]="View";g[g.WindingOrder=2]="WindingOrder";g[g.COUNT=3]="COUNT"})(a.NormalsDoubleSidedMode||(a.NormalsDoubleSidedMode={}));a.Normals=function(g,h){g=g.fragment;g.code.add(c.glsl`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`);switch(h.doubleSidedMode){case a.NormalsDoubleSidedMode.None:g.code.add(c.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case a.NormalsDoubleSidedMode.View:g.code.add(c.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case a.NormalsDoubleSidedMode.WindingOrder:g.code.add(c.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:b.neverReached(h.doubleSidedMode);case a.NormalsDoubleSidedMode.COUNT:}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/maybe ../../../../chunks/vec3f64 ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/DoublePrecision.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../materials/internal/MaterialUtil ../../../../chunks/DefaultMaterial.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H,M,K){const I=h.getLogger("esri.views.3d.webgl-engine.shaders.DefaultTechnique");h=function(O){function Q(){return O.apply(this,arguments)||this}c._inheritsLoose(Q,O);var J=Q.prototype;J.initializeProgram=function(P){var N=Q.shader.get();const R=this.configuration;N=N.build({oitEnabled:R.transparencyPassType===B.TransparencyPassType.Color,output:R.output,viewingMode:P.viewingMode,receiveShadows:R.receiveShadows,slicePlaneEnabled:R.slicePlaneEnabled,
sliceHighlightDisabled:R.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:R.symbolColors,vvSize:R.vvSize,vvColor:R.vvColor,vvInstancingEnabled:!0,instanced:R.instanced,instancedColor:R.instancedColor,instancedDoublePrecision:R.instancedDoublePrecision,pbrMode:R.usePBR?R.isSchematic?t.PBRMode.Schematic:t.PBRMode.Normal:t.PBRMode.Disabled,hasMetalnessAndRoughnessTexture:R.hasMetalnessAndRoughnessTexture,hasEmissionTexture:R.hasEmissionTexture,hasOcclusionTexture:R.hasOcclusionTexture,
hasNormalTexture:R.hasNormalTexture,hasColorTexture:R.hasColorTexture,hasModelTransformation:R.hasModelTransformation,receiveAmbientOcclusion:R.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:R.normalsTypeDerivate?e.NormalAttributeType.ScreenDerivative:e.NormalAttributeType.Attribute,doubleSidedMode:R.doubleSidedMode,vertexTangents:R.vertexTangents,attributeTextureCoordinates:R.hasMetalnessAndRoughnessTexture||R.hasEmissionTexture||R.hasOcclusionTexture||R.hasNormalTexture||R.hasColorTexture?
d.TextureCoordinateAttributeType.Default:d.TextureCoordinateAttributeType.None,textureAlphaPremultiplied:R.textureAlphaPremultiplied,attributeColor:R.vertexColors,screenSizePerspectiveEnabled:R.screenSizePerspective,verticalOffsetEnabled:R.verticalOffset,offsetBackfaces:R.offsetBackfaces,doublePrecisionRequiresObfuscation:u.doublePrecisionRequiresObfuscation(P.rctx),alphaDiscardMode:R.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:R.multipassTerrainEnabled,cullAboveGround:R.cullAboveGround});
return new F.Program(P.rctx,N,D.Default3D)};J.bindPass=function(P,N){var R,S;E.bindProjectionMatrix(this.program,N.camera.projectionMatrix);const T=this.configuration.output;this.configuration.hasModelTransformation&&(w.isSome(P.modelTransformation)?this.program.setUniformMatrix4fv("model",P.modelTransformation):I.warnOnce("hasModelTransformation true, but no modelTransformation found."));(this.configuration.output===f.ShaderOutput.Depth||N.multipassTerrainEnabled||T===f.ShaderOutput.Shadow)&&this.program.setUniform2fv("nearFar",
N.camera.nearFar);N.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",N.inverseViewport),v.bindMultipassTerrainTexture(this.program,N));T===f.ShaderOutput.Alpha&&(this.program.setUniform1f("opacity",P.opacity),this.program.setUniform1f("layerOpacity",P.layerOpacity),this.program.setUniform4fv("externalColor",P.externalColor),this.program.setUniform1i("colorMixMode",L.colorMixModes[P.colorMixMode]));T===f.ShaderOutput.Color?(N.lighting.setUniforms(this.program,!1,N.hasFillLights),
this.program.setUniform3fv("ambient",P.ambient),this.program.setUniform3fv("diffuse",P.diffuse),this.program.setUniform4fv("externalColor",P.externalColor),this.program.setUniform1i("colorMixMode",L.colorMixModes[P.colorMixMode]),this.program.setUniform1f("opacity",P.opacity),this.program.setUniform1f("layerOpacity",P.layerOpacity),this.configuration.usePBR&&t.bindPBRUniforms(this.program,P,this.configuration.isSchematic)):T===f.ShaderOutput.Highlight&&z.bindOutputHighlight(this.program,N);x.bindVisualVariablesUniformsForSymbols(this.program,
P);m.bindVerticalOffsetUniforms(this.program,P,N);L.bindScreenSizePerspective(P.screenSizePerspective,this.program,"screenSizePerspectiveAlignment");P.textureAlphaMode!==B.AlphaDiscardMode.Mask&&P.textureAlphaMode!==B.AlphaDiscardMode.MaskBlend||this.program.setUniform1f("textureAlphaCutoff",P.textureAlphaCutoff);null==(R=N.shadowMap)?void 0:R.bind(this.program);null==(S=N.ssaoHelper)?void 0:S.bind(this.program,N.camera)};J.bindDraw=function(P){const N=this.configuration.instancedDoublePrecision?
n.fromValues(P.camera.viewInverseTransposeMatrix[3],P.camera.viewInverseTransposeMatrix[7],P.camera.viewInverseTransposeMatrix[11]):P.origin;E.bindViewCustomOrigin(this.program,N,P.camera.viewMatrix);this.program.rebindTextures();(this.configuration.output===f.ShaderOutput.Color||this.configuration.output===f.ShaderOutput.Alpha||this.configuration.output===f.ShaderOutput.Depth&&this.configuration.screenSizePerspective||this.configuration.output===f.ShaderOutput.Normal&&this.configuration.screenSizePerspective||
this.configuration.output===f.ShaderOutput.Highlight&&this.configuration.screenSizePerspective)&&E.bindCameraPosition(this.program,N,P.camera.viewInverseTransposeMatrix);this.configuration.output===f.ShaderOutput.Normal&&this.program.setUniformMatrix4fv("viewNormal",P.camera.viewInverseTransposeMatrix);this.configuration.instancedDoublePrecision&&k.bindCustomOrigin(this.program,N);l.bindSliceUniforms(this.program,this.configuration,P.slicePlane,{origin:N});this.configuration.output===f.ShaderOutput.Color&&
r.bindReadShadowMapViewCustomOrigin(this.program,P,N)};J._convertDepthTestFunction=function(P){return P===B.DepthTestFunction.Lequal?M.CompareFunction.LEQUAL:M.CompareFunction.LESS};J._setPipeline=function(P,N){const R=this.configuration,S=P===B.TransparencyPassType.NONE,T=P===B.TransparencyPassType.FrontFace;return K.makePipelineState({blending:R.output!==f.ShaderOutput.Color&&R.output!==f.ShaderOutput.Alpha||!R.transparent?null:S?C.blendingDefault:C.oitBlending(P),culling:(R.cullFace?R.cullFace!==
B.CullFaceOptions.None:R.slicePlaneEnabled?!1:!R.transparent&&!R.doubleSidedMode)&&K.cullingParams(R.cullFace),depthTest:{func:C.oitDepthTest(P,this._convertDepthTestFunction(R.customDepthTest))},depthWrite:S||T?R.writeDepth&&K.defaultDepthWriteParams:null,colorWrite:K.defaultColorWriteParams,stencilWrite:R.sceneHasOcludees?G.stencilWriteMaskOn:null,stencilTest:R.sceneHasOcludees?N?G.stencilToolMaskBaseParams:G.stencilBaseAllZerosParams:null,polygonOffset:S||T?null:C.getOITPolygonOffset(R.enableOffset)})};
J.initializePipeline=function(){this._occludeePipelineState=this._setPipeline(this.configuration.transparencyPassType,!0);return this._setPipeline(this.configuration.transparencyPassType,!1)};J.getPipelineState=function(P,N){return N?this._occludeePipelineState:O.prototype.getPipelineState.call(this,P,N)};return Q}(A.ShaderTechnique);h.shader=new y.ReloadableShaderModule(H.DefaultMaterialShader,()=>new Promise((O,Q)=>a(["./DefaultMaterial.glsl"],O,Q)));y=function(O){function Q(){var J=O.apply(this,
arguments)||this;J.output=f.ShaderOutput.Color;J.alphaDiscardMode=B.AlphaDiscardMode.Opaque;J.doubleSidedMode=q.NormalsDoubleSidedMode.None;J.isSchematic=!1;J.vertexColors=!1;J.offsetBackfaces=!1;J.symbolColors=!1;J.vvSize=!1;J.vvColor=!1;J.verticalOffset=!1;J.receiveShadows=!1;J.slicePlaneEnabled=!1;J.sliceHighlightDisabled=!1;J.receiveAmbientOcclusion=!1;J.screenSizePerspective=!1;J.textureAlphaPremultiplied=!1;J.hasColorTexture=!1;J.usePBR=!1;J.hasMetalnessAndRoughnessTexture=!1;J.hasEmissionTexture=
!1;J.hasOcclusionTexture=!1;J.hasNormalTexture=!1;J.instanced=!1;J.instancedColor=!1;J.instancedDoublePrecision=!1;J.vertexTangents=!1;J.normalsTypeDerivate=!1;J.writeDepth=!0;J.sceneHasOcludees=!1;J.transparent=!1;J.enableOffset=!0;J.cullFace=B.CullFaceOptions.None;J.transparencyPassType=B.TransparencyPassType.NONE;J.multipassTerrainEnabled=!1;J.cullAboveGround=!1;J.hasModelTransformation=!1;J.customDepthTest=B.DepthTestFunction.Less;return J}c._inheritsLoose(Q,O);return Q}(p.ShaderTechniqueConfiguration);
g.__decorate([p.parameter({count:f.ShaderOutput.COUNT})],y.prototype,"output",void 0);g.__decorate([p.parameter({count:B.AlphaDiscardMode.COUNT})],y.prototype,"alphaDiscardMode",void 0);g.__decorate([p.parameter({count:q.NormalsDoubleSidedMode.COUNT})],y.prototype,"doubleSidedMode",void 0);g.__decorate([p.parameter()],y.prototype,"isSchematic",void 0);g.__decorate([p.parameter()],y.prototype,"vertexColors",void 0);g.__decorate([p.parameter()],y.prototype,"offsetBackfaces",void 0);g.__decorate([p.parameter()],
y.prototype,"symbolColors",void 0);g.__decorate([p.parameter()],y.prototype,"vvSize",void 0);g.__decorate([p.parameter()],y.prototype,"vvColor",void 0);g.__decorate([p.parameter()],y.prototype,"verticalOffset",void 0);g.__decorate([p.parameter()],y.prototype,"receiveShadows",void 0);g.__decorate([p.parameter()],y.prototype,"slicePlaneEnabled",void 0);g.__decorate([p.parameter()],y.prototype,"sliceHighlightDisabled",void 0);g.__decorate([p.parameter()],y.prototype,"receiveAmbientOcclusion",void 0);
g.__decorate([p.parameter()],y.prototype,"screenSizePerspective",void 0);g.__decorate([p.parameter()],y.prototype,"textureAlphaPremultiplied",void 0);g.__decorate([p.parameter()],y.prototype,"hasColorTexture",void 0);g.__decorate([p.parameter()],y.prototype,"usePBR",void 0);g.__decorate([p.parameter()],y.prototype,"hasMetalnessAndRoughnessTexture",void 0);g.__decorate([p.parameter()],y.prototype,"hasEmissionTexture",void 0);g.__decorate([p.parameter()],y.prototype,"hasOcclusionTexture",void 0);g.__decorate([p.parameter()],
y.prototype,"hasNormalTexture",void 0);g.__decorate([p.parameter()],y.prototype,"instanced",void 0);g.__decorate([p.parameter()],y.prototype,"instancedColor",void 0);g.__decorate([p.parameter()],y.prototype,"instancedDoublePrecision",void 0);g.__decorate([p.parameter()],y.prototype,"vertexTangents",void 0);g.__decorate([p.parameter()],y.prototype,"normalsTypeDerivate",void 0);g.__decorate([p.parameter()],y.prototype,"writeDepth",void 0);g.__decorate([p.parameter()],y.prototype,"sceneHasOcludees",
void 0);g.__decorate([p.parameter()],y.prototype,"transparent",void 0);g.__decorate([p.parameter()],y.prototype,"enableOffset",void 0);g.__decorate([p.parameter({count:B.CullFaceOptions.COUNT})],y.prototype,"cullFace",void 0);g.__decorate([p.parameter({count:B.TransparencyPassType.COUNT})],y.prototype,"transparencyPassType",void 0);g.__decorate([p.parameter()],y.prototype,"multipassTerrainEnabled",void 0);g.__decorate([p.parameter()],y.prototype,"cullAboveGround",void 0);g.__decorate([p.parameter()],
y.prototype,"hasModelTransformation",void 0);g.__decorate([p.parameter({count:B.DepthTestFunction.COUNT})],y.prototype,"customDepthTest",void 0);b.DefaultMaterialTechnique=h;b.DefaultMaterialTechniqueConfiguration=y;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl":function(){define("exports ../../../../../../chunks/vec3f64 ../ShaderOutputOptions ../util/DoublePrecision.glsl ../../shaderModules/interfaces ../../../lib/VertexAttribute ../../../../../webgl/doublePrecisionUtils".split(" "),
function(a,b,c,g,h,w,n){const f=b.create(),l=b.create();a.InstancedDoublePrecision=function(k,e){e.instanced&&e.instancedDoublePrecision&&(k.attributes.add(w.VertexAttribute.MODELORIGINHI,"vec3"),k.attributes.add(w.VertexAttribute.MODELORIGINLO,"vec3"),k.attributes.add(w.VertexAttribute.MODEL,"mat3"),k.attributes.add(w.VertexAttribute.MODELNORMAL,"mat3"));e.instancedDoublePrecision&&(k.vertex.include(g.DoublePrecision,e),k.vertex.uniforms.add("viewOriginHi","vec3"),k.vertex.uniforms.add("viewOriginLo",
"vec3"));const d=[h.glsl`
    vec3 calculateVPos() {
      ${e.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `,h.glsl`
    vec3 subtractOrigin(vec3 _pos) {
      ${e.instancedDoublePrecision?h.glsl`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `,h.glsl`
    vec3 dpNormal(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `,h.glsl`
    vec3 dpNormalView(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `,e.vertexTangents?h.glsl`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${e.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `:h.glsl``];k.vertex.code.add(d[0]);k.vertex.code.add(d[1]);k.vertex.code.add(d[2]);e.output===c.ShaderOutput.Normal&&k.vertex.code.add(d[3]);k.vertex.code.add(d[4])};a.InstancedDoublePrecisionUniforms=function(){};a.bindCustomOrigin=function(k,e){n.encodeDoubleArraySplit(e,f,l,3);k.setUniform3fv("viewOriginHi",f);k.setUniform3fv("viewOriginLo",l)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DoublePrecision.glsl":function(){define(["exports",
"../../../../../../core/has","../../shaderModules/interfaces"],function(a,b,c){a.DoublePrecision=function({code:g},h){h.doublePrecisionRequiresObfuscation?g.add(c.glsl`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):g.add(c.glsl`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)};a.doublePrecisionRequiresObfuscation=function(g){return b("force-double-precision-obfuscation")?!0:g.driverTest.doublePrecisionRequiresObfuscation};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl":function(){define(["exports","../util/DecodeNormal.glsl","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c,g){a.NormalAttributeType=void 0;(function(h){h[h.Attribute=0]="Attribute";h[h.CompressedAttribute=
1]="CompressedAttribute";h[h.Ground=2]="Ground";h[h.ScreenDerivative=3]="ScreenDerivative";h[h.COUNT=4]="COUNT"})(a.NormalAttributeType||(a.NormalAttributeType={}));a.NormalAttribute=function(h,w){w.normalType===a.NormalAttributeType.Attribute&&(h.attributes.add(g.VertexAttribute.NORMAL,"vec3"),h.vertex.code.add(c.glsl`vec3 normalModel() {
return normal;
}`));w.normalType===a.NormalAttributeType.CompressedAttribute&&(h.include(b.DecodeNormal),h.attributes.add(g.VertexAttribute.NORMALCOMPRESSED,"vec2"),h.vertex.code.add(c.glsl`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`));w.normalType===a.NormalAttributeType.ScreenDerivative&&(h.extensions.add("GL_OES_standard_derivatives"),h.fragment.code.add(c.glsl`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DecodeNormal.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.DecodeNormal=function(c){const g=b.glsl`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;c.fragment.code.add(g);c.vertex.code.add(g)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/DefaultMaterial.glsl":function(){define("exports ../views/ViewingMode ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/HeaderComment.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H,M){function K(O){const Q=new H.ShaderBuilder,J=Q.vertex.code,P=Q.fragment.code;Q.include(F.HeaderComment,{name:"Default Material Shader",output:O.output});Q.vertex.uniforms.add("proj","mat4").add("view","mat4").add("cameraPosition","vec3").add("localOrigin","vec3");const N=O.hasModelTransformation;N&&Q.vertex.uniforms.add("model","mat4");Q.include(k.PositionAttribute);Q.varyings.add("vpos","vec3");Q.include(D.VisualVariables,O);
Q.include(f.InstancedDoublePrecision,O);Q.include(v.VerticalOffset,O);if(O.output===h.ShaderOutput.Color||O.output===h.ShaderOutput.Alpha)Q.include(l.NormalAttribute,O),Q.include(n.Transform,{linearDepth:!1,hasModelTransformation:N}),O.normalType===l.NormalAttributeType.Attribute&&O.offsetBackfaces&&Q.include(g.Offset),Q.include(r.ComputeNormalTexture,O),Q.include(z.VertexNormal,O),O.instancedColor&&Q.attributes.add(M.VertexAttribute.INSTANCECOLOR,"vec4"),Q.varyings.add("localvpos","vec3"),Q.include(d.TextureCoordinateAttribute,
O),Q.include(c.ForwardLinearDepth,O),Q.include(e.SymbolColor,O),Q.include(m.VertexColor,O),Q.vertex.uniforms.add("externalColor","vec4"),Q.varyings.add("vcolorExt","vec4"),O.multipassTerrainEnabled&&Q.varyings.add("depth","float"),J.add(L.glsl`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${O.instancedColor?"vcolorExt *\x3d instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${L.glsl.float(C.symbolAlphaCutoff)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        }
        else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${O.normalType===l.NormalAttributeType.Attribute?L.glsl`
          vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${O.vertexTangents?"vTangent \x3d dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${N?"model,":""} vpos);
          ${O.normalType===l.NormalAttributeType.Attribute&&O.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${O.multipassTerrainEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
      }
    `);O.output===h.ShaderOutput.Alpha&&(Q.include(w.Slice,O),Q.include(C.DiscardOrAdjustAlpha,O),O.multipassTerrainEnabled&&(Q.fragment.include(t.ReadLinearDepth),Q.include(E.multipassTerrainTest,O)),Q.fragment.uniforms.add("cameraPosition","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),O.hasColorTexture&&Q.fragment.uniforms.add("tex","sampler2D"),Q.fragment.include(G.MixExternalColor),P.add(L.glsl`
      void main() {
        discardBySlice(vpos);
        ${O.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${O.hasColorTexture?L.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        ${O.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:L.glsl`vec4 texColor = vec4(1.0);`}
        ${O.attributeColor?L.glsl`
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:L.glsl`
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        gl_FragColor = vec4(opacity_);
      }
    `));O.output===h.ShaderOutput.Color&&(Q.include(w.Slice,O),Q.include(u.EvaluateSceneLighting,O),Q.include(x.EvaluateAmbientOcclusion,O),Q.include(C.DiscardOrAdjustAlpha,O),O.receiveShadows&&Q.include(B.ReadShadowMap,O),O.multipassTerrainEnabled&&(Q.fragment.include(t.ReadLinearDepth),Q.include(E.multipassTerrainTest,O)),Q.fragment.uniforms.add("cameraPosition","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),O.hasColorTexture&&
Q.fragment.uniforms.add("tex","sampler2D"),Q.include(p.PhysicallyBasedRenderingParameters,O),Q.include(A.PhysicallyBasedRendering,O),Q.fragment.include(G.MixExternalColor),Q.include(y.Normals,O),P.add(L.glsl`
      void main() {
        discardBySlice(vpos);
        ${O.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${O.hasColorTexture?L.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        ${O.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:L.glsl`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${O.normalType===l.NormalAttributeType.ScreenDerivative?L.glsl`
        vec3 normal = screenDerivativeNormal(localvpos);`:L.glsl`
        shadingParams.normalView = vNormalWorld;
        vec3 normal = shadingNormal(shadingParams);`}
        ${O.pbrMode===p.PBRMode.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${O.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":O.viewingMode===b.ViewingMode.Global?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${O.attributeColor?L.glsl`
        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:L.glsl`
        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        ${O.hasNormalTexture?L.glsl`
              mat3 tangentSpace = ${O.vertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
              vec3 shadedNormal = computeTextureNormal(tangentSpace, vuv0);`:"vec3 shadedNormal \x3d normal;"}
        ${O.pbrMode===p.PBRMode.Normal||O.pbrMode===p.PBRMode.Schematic?O.viewingMode===b.ViewingMode.Global?L.glsl`vec3 normalGround = normalize(vpos + localOrigin);`:L.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:L.glsl``}
        ${O.pbrMode===p.PBRMode.Normal||O.pbrMode===p.PBRMode.Schematic?L.glsl`
            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:"vec3 shadedColor \x3d evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);"}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${O.oitEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));Q.include(q.DefaultMaterialAuxiliaryPasses,O);return Q}const I=Object.freeze({__proto__:null,build:K});a.DefaultMaterialShader=I;a.build=K})},"esri/views/3d/webgl-engine/core/shaderLibrary/Offset.glsl":function(){define(["exports","../shaderModules/interfaces"],function(a,b){a.Offset=function(c){c.vertex.code.add(b.glsl`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c){a.PositionAttribute=function(g){g.attributes.add(c.VertexAttribute.POSITION,"vec3");g.vertex.code.add(b.glsl`vec3 positionModel() { return position; }`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl":function(){define(["exports",
"../../../collections/Component/Material/shader/DecodeSymbolColor.glsl","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c,g){a.SymbolColor=function(h,w){w.symbolColor?(h.include(b.DecodeSymbolColor),h.attributes.add(g.VertexAttribute.SYMBOLCOLOR,"vec4"),h.varyings.add("colorMixMode","mediump float")):h.fragment.uniforms.add("colorMixMode","int");w.symbolColor?h.vertex.code.add(c.glsl`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`):h.vertex.code.add(c.glsl`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/DecodeSymbolColor.glsl":function(){define(["exports","../../../../../layers/support/symbolColorUtils","../../../../core/shaderModules/interfaces"],function(a,b,c){a.DecodeSymbolColor=function(g){g.vertex.code.add(c.glsl`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${c.glsl.int(b.ColorMixModeEnum.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${c.glsl.int(b.ColorMixModeEnum.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${c.glsl.int(b.ColorMixModeEnum.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${c.glsl.int(b.ColorMixModeEnum.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["exports","../../../../core/mathUtils","../../../../core/maybe"],function(a,b,c){a.ColorMixModeEnum=void 0;(function(g){g[g.Multiply=1]="Multiply";g[g.Ignore=2]="Ignore";g[g.Replace=3]="Replace";g[g.Tint=4]="Tint"})(a.ColorMixModeEnum||(a.ColorMixModeEnum={}));a.encodeSymbolColor=function(g,h,w){if(c.isNone(g)||h===a.ColorMixModeEnum.Ignore)w[0]=255,w[1]=255,w[2]=255,w[3]=255;
else{var n=b.clamp(Math.round(85*g[3]),0,85);h=0===n||h===a.ColorMixModeEnum.Tint?0:h===a.ColorMixModeEnum.Replace?85:170;w[0]=b.clamp(Math.round(255*g[0]),0,255);w[1]=b.clamp(Math.round(255*g[1]),0,255);w[2]=b.clamp(Math.round(255*g[2]),0,255);w[3]=n+h}};a.parseColorMixMode=function(g){switch(g){case "multiply":return a.ColorMixModeEnum.Multiply;case "ignore":return a.ColorMixModeEnum.Ignore;case "replace":return a.ColorMixModeEnum.Replace;case "tint":return a.ColorMixModeEnum.Tint;default:return a.ColorMixModeEnum.Multiply}};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c){a.VertexColor=function(g,h){h.attributeColor?(g.attributes.add(c.VertexAttribute.COLOR,"vec4"),g.varyings.add("vColor","vec4"),g.vertex.code.add(b.glsl`void forwardVertexColor() { vColor = color; }`),g.vertex.code.add(b.glsl`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):
g.vertex.code.add(b.glsl`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl":function(){define(["exports","../../../../../ViewingMode","./NormalAttribute.glsl","./VertexPosition.glsl","../../shaderModules/interfaces"],function(a,b,c,g,h){a.VertexNormal=function(w,n){n.normalType===c.NormalAttributeType.Attribute||n.normalType===c.NormalAttributeType.CompressedAttribute?(w.include(c.NormalAttribute,n),w.varyings.add("vNormalWorld",
"vec3"),w.varyings.add("vNormalView","vec3"),w.vertex.uniforms.add("transformNormalGlobalFromModel","mat3"),w.vertex.uniforms.add("transformNormalViewFromGlobal","mat3"),w.vertex.code.add(h.glsl`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`)):n.normalType===c.NormalAttributeType.Ground?(w.include(g.VertexPosition,n),w.varyings.add("vNormalWorld","vec3"),w.vertex.code.add(h.glsl`
    void forwardNormal() {
      vNormalWorld = ${n.viewingMode===b.ViewingMode.Global?h.glsl`normalize(vPositionWorldCameraRelative);`:h.glsl`vec3(0.0, 0.0, 1.0);`}
    }
    `)):w.vertex.code.add(h.glsl`void forwardNormal() {}`)};a.bindVertexNormalUniforms=function(w,n){w.setUniformMatrix4fv("viewNormal",n)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl":function(){define("exports ../../../../../../chunks/mat3f64 ../../../../../../chunks/mat4f64 ../../../../../../chunks/vec3f64 ./PositionAttribute.glsl ../util/DoublePrecision.glsl ../../shaderModules/interfaces".split(" "),function(a,
b,c,g,h,w,n){a.VertexPosition=function(f,l){f.include(h.PositionAttribute);f.vertex.include(w.DoublePrecision,l);f.varyings.add("vPositionWorldCameraRelative","vec3");f.varyings.add("vPosition_view","vec3");f.vertex.uniforms.add("transformWorldFromModelRS","mat3");f.vertex.uniforms.add("transformWorldFromModelTH","vec3");f.vertex.uniforms.add("transformWorldFromModelTL","vec3");f.vertex.uniforms.add("transformWorldFromViewTH","vec3");f.vertex.uniforms.add("transformWorldFromViewTL","vec3");f.vertex.uniforms.add("transformViewFromCameraRelativeRS",
"mat3");f.vertex.uniforms.add("transformProjFromView","mat4");f.vertex.code.add(n.glsl`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}
vec3 position_view() {
return transformViewFromCameraRelativeRS * positionWorldCameraRelative();
}
void forwardPosition() {
vPositionWorldCameraRelative = positionWorldCameraRelative();
vPosition_view = position_view();
gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
}
vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`);f.fragment.uniforms.add("transformWorldFromViewTL","vec3");f.fragment.code.add(n.glsl`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)};a.VertexPositionModelTransform=function(){this.transformWorldFromModelRS=b.create();this.transformWorldFromModelTH=g.create();this.transformWorldFromModelTL=g.create()};a.VertexPositionViewProjectionTransform=function(){this.transformWorldFromViewTH=g.create();this.transformWorldFromViewTL=g.create();this.transformViewFromCameraRelativeRS=b.create();this.transformProjFromView=c.create()};a.bindModelTransform=function(f,l){f.setUniformMatrix3fv("transformWorldFromModelRS",l.transformWorldFromModelRS);
f.setUniform3fv("transformWorldFromModelTH",l.transformWorldFromModelTH);f.setUniform3fv("transformWorldFromModelTL",l.transformWorldFromModelTL)};a.bindViewProjTransform=function(f,l){f.setUniform3fv("transformWorldFromViewTH",l.transformWorldFromViewTH);f.setUniform3fv("transformWorldFromViewTL",l.transformWorldFromViewTL);f.setUniformMatrix4fv("transformProjFromView",l.transformProjFromView);f.setUniformMatrix3fv("transformViewFromCameraRelativeRS",l.transformViewFromCameraRelativeRS)};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl":function(){define("exports ../ShaderOutputOptions ../Slice.glsl ../Transform.glsl ../attributes/NormalAttribute.glsl ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexNormal.glsl ../output/OutputDepth.glsl ../output/OutputHighlight.glsl ../shading/VisualVariables.glsl ../util/AlphaDiscard.glsl ../../shaderModules/interfaces".split(" "),function(a,b,c,g,h,w,n,f,l,
k,e,d){a.DefaultMaterialAuxiliaryPasses=function(m,z){const v=m.vertex.code,q=m.fragment.code,t=z.hasModelTransformation;if(z.output===b.ShaderOutput.Depth||z.output===b.ShaderOutput.Shadow)m.include(g.Transform,{linearDepth:!0,hasModelTransformation:t}),m.include(w.TextureCoordinateAttribute,z),m.include(k.VisualVariables,z),m.include(f.OutputDepth,z),m.include(c.Slice,z),m.vertex.uniforms.add("nearFar","vec2"),m.varyings.add("depth","float"),z.hasColorTexture&&m.fragment.uniforms.add("tex","sampler2D"),
v.add(d.glsl`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPositionWithDepth(proj, view, ${t?"model,":""} vpos, nearFar, depth);
        forwardTextureCoordinates();
      }
    `),m.include(e.DiscardOrAdjustAlpha,z),q.add(d.glsl`
      void main(void) {
        discardBySlice(vpos);
        ${z.hasColorTexture?d.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputDepth(depth);
      }
    `);z.output===b.ShaderOutput.Normal&&(m.include(g.Transform,{linearDepth:!1,hasModelTransformation:t}),m.include(h.NormalAttribute,z),m.include(n.VertexNormal,z),m.include(w.TextureCoordinateAttribute,z),m.include(k.VisualVariables,z),z.hasColorTexture&&m.fragment.uniforms.add("tex","sampler2D"),m.vertex.uniforms.add("viewNormal","mat4"),m.varyings.add("vPositionView","vec3"),v.add(d.glsl`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        ${z.normalType===h.NormalAttributeType.Attribute?d.glsl`
        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${t?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),m.include(c.Slice,z),m.include(e.DiscardOrAdjustAlpha,z),q.add(d.glsl`
      void main() {
        discardBySlice(vpos);
        ${z.hasColorTexture?d.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}

        ${z.normalType===h.NormalAttributeType.ScreenDerivative?d.glsl`
            vec3 normal = screenDerivativeNormal(vPositionView);`:d.glsl`
            vec3 normal = normalize(vNormalWorld);
            if (gl_FrontFacing == false) normal = -normal;`}
        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
      }
    `));z.output===b.ShaderOutput.Highlight&&(m.include(g.Transform,{linearDepth:!1,hasModelTransformation:t}),m.include(w.TextureCoordinateAttribute,z),m.include(k.VisualVariables,z),z.hasColorTexture&&m.fragment.uniforms.add("tex","sampler2D"),v.add(d.glsl`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${t?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),m.include(c.Slice,z),m.include(e.DiscardOrAdjustAlpha,z),m.include(l.OutputHighlight),q.add(d.glsl`
      void main() {
        discardBySlice(vpos);
        ${z.hasColorTexture?d.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputHighlight();
      }
    `))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl":function(){define("exports ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexTextureCoordinates.glsl ./Normals.glsl ../../shaderModules/interfaces ../../../lib/VertexAttribute".split(" "),function(a,b,c,g,h,w){a.ComputeNormalTexture=function(n,f){const l=n.fragment;f.vertexTangents?(n.attributes.add(w.VertexAttribute.TANGENT,"vec4"),n.varyings.add("vTangent",
"vec4"),f.doubleSidedMode===g.NormalsDoubleSidedMode.WindingOrder?l.code.add(h.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):l.code.add(h.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(n.extensions.add("GL_OES_standard_derivatives"),l.code.add(h.glsl`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`));f.attributeTextureCoordinates!==b.TextureCoordinateAttributeType.None&&(n.include(c.VertexTextureCoordinates,f),l.uniforms.add("normalTexture","sampler2D"),l.uniforms.add("normalTextureSize","vec2"),l.code.add(h.glsl`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${f.supportsTextureAtlas?"vtc.size \x3d normalTextureSize;":""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.EvaluateAmbientOcclusion=function(c,g){c=c.fragment;g.receiveAmbientOcclusion?(c.uniforms.add("ssaoTex","sampler2D"),c.uniforms.add("viewportPixelSz","vec4"),c.code.add(b.glsl`float evaluateAmbientOcclusion() {
return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}
float evaluateAmbientOcclusionInverse() {
float ssao = texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
return viewportPixelSz.z < 0.0 ? 1.0 : ssao;
}`)):c.code.add(b.glsl`float evaluateAmbientOcclusion() { return 0.0; }
float evaluateAmbientOcclusionInverse() { return 1.0; }`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl":function(){define("exports ../../../../../ViewingMode ./EvaluateAmbientLighting.glsl ./EvaluateAmbientOcclusion.glsl ./EvaluateMainLighting.glsl ./PhysicallyBasedRendering.glsl ./PhysicallyBasedRenderingParameters.glsl ./PiUtils.glsl ./ReadShadowMap.glsl ../../shaderModules/interfaces".split(" "),function(a,
b,c,g,h,w,n,f,l,k){a.EvaluateSceneLighting=function(e,d){const m=e.fragment;e.include(h.EvaluateMainLighting);e.include(g.EvaluateAmbientOcclusion,d);d.pbrMode!==n.PBRMode.Disabled&&e.include(w.PhysicallyBasedRendering,d);e.include(c.EvaluateAmbientLighting,d);d.receiveShadows&&e.include(l.ReadShadowMap,d);m.uniforms.add("lightingGlobalFactor","float");m.uniforms.add("ambientBoostFactor","float");m.uniforms.add("hasFillLights","bool");e.include(f.PiUtils);m.code.add(k.glsl`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${d.pbrMode===n.PBRMode.Disabled?"":"const vec3 GROUND_REFLECTANCE \x3d vec3(0.2);"}
  `);m.code.add(k.glsl`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${d.viewingMode===b.ViewingMode.Global?k.glsl`normalize(vPosWorld)`:k.glsl`vec3(0.0, 0.0, 1.0)`}, lightingMainDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `);m.code.add(k.glsl`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;
}`);if(d.pbrMode===n.PBRMode.Disabled||d.pbrMode===n.PBRMode.WaterOnIntegratedMesh)m.code.add(k.glsl`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);else if(d.pbrMode===n.PBRMode.Normal||d.pbrMode===n.PBRMode.Schematic)m.code.add(k.glsl`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 mainLightDirection = lightingMainDirection;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),m.code.add(k.glsl`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),m.code.add(k.glsl`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),m.code.add(k.glsl`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),m.code.add(k.glsl`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${d.pbrMode===n.PBRMode.Schematic?k.glsl`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:k.glsl`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/HeaderComment.glsl":function(){define(["exports","../ShaderOutputOptions","../../shaderModules/interfaces","../../../../../webgl/checkWebGLError"],function(a,b,c,g){a.HeaderComment=function(h,w){w=c.glsl`
  /*
  *  ${w.name}
  *  ${w.output===b.ShaderOutput.Color?"RenderOutput: Color":w.output===b.ShaderOutput.Depth?"RenderOutput: Depth":w.output===b.ShaderOutput.Shadow?"RenderOutput: Shadow":w.output===b.ShaderOutput.Normal?"RenderOutput: Normal":w.output===b.ShaderOutput.Highlight?"RenderOutput: Highlight":""}
  */
  `;g.webglValidateShadersEnabled()&&(h.fragment.code.add(w),h.vertex.code.add(w))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl":function(){define(["exports","../../../../layers/support/symbolColorUtils","./ColorConversion.glsl","../../shaderModules/interfaces"],function(a,b,c,g){a.MixExternalColor=function(h){h.include(c.ColorConversion);h.code.add(g.glsl`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${g.glsl.int(b.ColorMixModeEnum.Multiply)}) {
        return allMixed;
      }
      else if (mode == ${g.glsl.int(b.ColorMixModeEnum.Ignore)}) {
        return internalMixed;
      }
      else if (mode == ${g.glsl.int(b.ColorMixModeEnum.Replace)}) {
        return externalColor;
      }
      else {
        // tint (or something invalid)
        float vIn = rgb2v(internalMixed);
        vec3 hsvTint = rgb2hsv(externalColor);
        vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
        return hsv2rgb(hsvOut);
      }
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${g.glsl.int(b.ColorMixModeEnum.Ignore)}) {
        return internalMixed;
      }
      else if (mode == ${g.glsl.int(b.ColorMixModeEnum.Replace)}) {
        return externalOpacity;
      }
      else {
        // multiply or tint (or something invalid)
        return allMixed;
      }
    }
  `)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/RealisticTreeTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../../../../chunks/RealisticTree.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/util/DoublePrecision.glsl ../core/shaderTechnique/ReloadableShaderModule ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/Program ./DefaultMaterialTechnique".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z){z=function(v){function q(){return v.apply(this,arguments)||this}c._inheritsLoose(q,v);q.prototype.initializeProgram=function(t){var r=q.shader.get();const x=this.configuration;r=r.build({oitEnabled:x.transparencyPassType===e.TransparencyPassType.Color,output:x.output,viewingMode:t.viewingMode,receiveShadows:x.receiveShadows,slicePlaneEnabled:x.slicePlaneEnabled,sliceHighlightDisabled:x.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:x.symbolColors,
vvSize:x.vvSize,vvColor:x.vvColor,vvInstancingEnabled:!0,instanced:x.instanced,instancedColor:x.instancedColor,instancedDoublePrecision:x.instancedDoublePrecision,pbrMode:x.usePBR?f.PBRMode.Normal:f.PBRMode.Disabled,hasMetalnessAndRoughnessTexture:!1,hasEmissionTexture:!1,hasOcclusionTexture:!1,hasNormalTexture:!1,hasColorTexture:x.hasColorTexture,hasModelTransformation:!1,receiveAmbientOcclusion:x.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:g.NormalAttributeType.Attribute,
doubleSidedMode:n.NormalsDoubleSidedMode.WindingOrder,vertexTangents:!1,attributeTextureCoordinates:x.hasColorTexture?h.TextureCoordinateAttributeType.Default:h.TextureCoordinateAttributeType.None,textureAlphaPremultiplied:x.textureAlphaPremultiplied,attributeColor:x.vertexColors,screenSizePerspectiveEnabled:x.screenSizePerspective,verticalOffsetEnabled:x.verticalOffset,offsetBackfaces:x.offsetBackfaces,doublePrecisionRequiresObfuscation:l.doublePrecisionRequiresObfuscation(t.rctx),alphaDiscardMode:x.alphaDiscardMode,
supportsTextureAtlas:!1,multipassTerrainEnabled:x.multipassTerrainEnabled,cullAboveGround:x.cullAboveGround});return new m.Program(t.rctx,r,d.Default3D)};return q}(z.DefaultMaterialTechnique);z.shader=new k.ReloadableShaderModule(w.RealisticTreeShader,()=>new Promise((v,q)=>a(["../core/shaderLibrary/default/RealisticTree.glsl"],v,q)));b.RealisticTreeTechnique=z;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/RealisticTree.glsl":function(){define("exports ../views/ViewingMode ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F){function G(H){const M=new C.ShaderBuilder,K=M.vertex.code,I=M.fragment.code;M.vertex.uniforms.add("proj","mat4").add("view","mat4").add("cameraPosition","vec3").add("localOrigin","vec3");M.include(k.PositionAttribute);M.varyings.add("vpos","vec3");M.include(A.VisualVariables,H);M.include(f.InstancedDoublePrecision,H);M.include(z.VerticalOffset,H);if(H.output===h.ShaderOutput.Color||H.output===h.ShaderOutput.Alpha)M.include(l.NormalAttribute,
H),M.include(n.Transform,{linearDepth:!1}),H.offsetBackfaces&&M.include(g.Offset),H.instancedColor&&M.attributes.add(F.VertexAttribute.INSTANCECOLOR,"vec4"),M.varyings.add("vNormalWorld","vec3"),M.varyings.add("localvpos","vec3"),H.multipassTerrainEnabled&&M.varyings.add("depth","float"),M.include(d.TextureCoordinateAttribute,H),M.include(c.ForwardLinearDepth,H),M.include(e.SymbolColor,H),M.include(m.VertexColor,H),M.vertex.uniforms.add("externalColor","vec4"),M.varyings.add("vcolorExt","vec4"),K.add(D.glsl`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${H.instancedColor?"vcolorExt *\x3d instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${D.glsl.float(p.symbolAlphaCutoff)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          }
          else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${H.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${H.multipassTerrainEnabled?D.glsl`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `);H.output===h.ShaderOutput.Alpha&&(M.include(w.Slice,H),M.include(p.DiscardOrAdjustAlpha,H),H.multipassTerrainEnabled&&(M.fragment.include(q.ReadLinearDepth),M.include(x.multipassTerrainTest,H)),M.fragment.uniforms.add("cameraPosition","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),M.fragment.uniforms.add("view","mat4"),H.hasColorTexture&&M.fragment.uniforms.add("tex","sampler2D"),M.fragment.include(B.MixExternalColor),I.add(D.glsl`
      void main() {
        discardBySlice(vpos);
        ${H.multipassTerrainEnabled?D.glsl`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${H.hasColorTexture?D.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        ${H.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:D.glsl`vec4 texColor = vec4(1.0);`}
        ${H.attributeColor?D.glsl`
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:D.glsl`
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}

        gl_FragColor = vec4(opacity_);
      }
    `));H.output===h.ShaderOutput.Color&&(M.include(w.Slice,H),M.include(r.EvaluateSceneLighting,H),M.include(t.EvaluateAmbientOcclusion,H),M.include(p.DiscardOrAdjustAlpha,H),H.receiveShadows&&M.include(y.ReadShadowMap,H),H.multipassTerrainEnabled&&(M.fragment.include(q.ReadLinearDepth),M.include(x.multipassTerrainTest,H)),M.fragment.uniforms.add("cameraPosition","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),M.fragment.uniforms.add("view",
"mat4"),H.hasColorTexture&&M.fragment.uniforms.add("tex","sampler2D"),M.include(E.PhysicallyBasedRenderingParameters,H),M.include(u.PhysicallyBasedRendering,H),M.fragment.include(B.MixExternalColor),I.add(D.glsl`
      void main() {
        discardBySlice(vpos);
        ${H.multipassTerrainEnabled?D.glsl`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${H.hasColorTexture?D.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        ${H.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:D.glsl`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${H.pbrMode===E.PBRMode.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${H.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":H.viewingMode===b.ViewingMode.Global?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${H.attributeColor?D.glsl`
        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:D.glsl`
        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        ${D.glsl`
        vec3 shadedNormal = normalize(vNormalWorld);
        albedo_ *= 1.2;
        vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
        float alignmentLightView = clamp(dot(viewForward, -lightingMainDirection), 0.0, 1.0);
        float transmittance = 1.0 - clamp(dot(viewForward, shadedNormal), 0.0, 1.0);
        float treeRadialFalloff = vColor.r;
        float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
        additionalLight += backLightFactor * lightingMainIntensity;`}
        ${H.pbrMode===E.PBRMode.Normal||H.pbrMode===E.PBRMode.Schematic?H.viewingMode===b.ViewingMode.Global?D.glsl`vec3 normalGround = normalize(vpos + localOrigin);`:D.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:D.glsl``}
        ${H.pbrMode===E.PBRMode.Normal||H.pbrMode===E.PBRMode.Schematic?D.glsl`
            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:"vec3 shadedColor \x3d evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);"}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${H.oitEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));M.include(v.DefaultMaterialAuxiliaryPasses,H);return M}const L=Object.freeze({__proto__:null,build:G});a.RealisticTreeShader=L;a.build=G})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../symbols ../../../../core/asyncUtils ../../../../core/Error ../../../../core/has ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../support/arcadeOnDemand ../../../../symbols/support/IconSymbol3DLayerResource ../../../../symbols/support/utils ../../../2d/arcade/callExpressionWithFeature ./constants ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./placementUtils ./pointUtils ./sdfPrimitives ../support/FastSymbolUpdates ../../terrain/OverlayRenderer ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial ../../../../symbols/CIMSymbol".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H,M,K,I,O,Q,J,P,N,R,S,T,V){function W(la){return l.isSome(la)?"cross"===la||"x"===la:!1}const U=m.create(),aa=v.fromValues(0,0,1);h=O.DEFAULT_TEX_SIZE;const da=O.DEFAULT_SYMBOL_SIZE_RATIO,Y=[da/2,da/2,1-da/2,1-da/2];h=[h*da,h*da];L=function(la){function ia(fa,ba,Z,ha){fa=la.call(this,fa,ba,Z,ha)||this;fa._cimLayers=null;fa._cimSymbolMaterials=new Map;fa._cimSymbolTextures=new Map;fa._cimMaterialParametersInfo=null;fa._cimRequiredFields=
null;fa._cimScaleFactorOrFunction=null;fa._size=null;fa._symbolTextureRatio=1;fa._outlineSize=0;fa._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0};return fa}c._inheritsLoose(ia,la);var ca=ia.prototype;ca.getCachedSize=function(){return{size:this._getIconSize()}};ca.doLoad=function(){var fa=c._asyncToGenerator(function*(ba){this._validateOrThrow();const Z=this._prepareMaterialParameters();var ha=this._getPrimitive();if(l.isSome(ha))this._prepareResourcesPrimitive(Z,ha);else{ha=
y.getIconHref(this.symbol,this.symbolLayer);const na=d.dataComponents(ha);na&&"application/json"===na.mediaType?yield this._prepareResourcesCIM(Z,JSON.parse(na.data),ba):yield this._prepareResourcesHref(Z,ha,ba)}});return function(ba){return fa.apply(this,arguments)}}();ca._validateOrThrow=function(){if(!this._drivenProperties.size){var fa=H.validateSymbolLayerSize(this._getIconSize());if(fa)throw new n("graphics3diconsymbollayer:invalid-size",fa);}};ca._getIconSize=function(){var fa=this.symbolLayer;
fa=Math.round(null!=fa.size?e.pt2px(fa.size):16);return this._drivenProperties.size?Math.max(fa,64):fa};ca._generateTextureCIM=function(fa){const ba=this._getGraphicHash(fa);let Z=""===ba?null:this._cimSymbolTextures.get(ba);Z||(fa=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,fa,"esriGeometryPoint",{scaleFactor:this._cimScaleFactorOrFunction},null,null),this._cimMaterialParametersInfo.anchorPos=this._getAnchorPos("relative",fa.anchorPosition),Z=new S.Texture(fa.imageData,
{width:fa.imageData.width,height:fa.imageData.height,powerOfTwoResizeMode:P.PowerOfTwoResizeMode.PAD}),this._cimSymbolTextures.set(ba,Z),this._context.stage.add(Z));return Z};ca._computeSize=function(fa,ba){fa=fa.width/fa.height;return 1<fa?[ba,Math.round(ba/fa)]:[Math.round(ba*fa),ba]};ca._prepareMaterialParameters=function(){const fa={anchorPos:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},ba=this.symbol;if(ba&&"point-3d"===ba.type&&ba.hasVisibleVerticalOffset()){const {screenLength:Z,
minWorldLength:ha,maxWorldLength:na}=ba.verticalOffset;fa.verticalOffset={screenLength:e.pt2px(Z),minWorldLength:ha||0,maxWorldLength:null!=na?na:Infinity}}this._context.screenSizePerspectiveEnabled&&(fa.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);fa.occlusionTest=!0;fa.slicePlaneEnabled=this._context.slicePlaneEnabled;return fa};ca._prepareResourcesPrimitive=function(fa,ba){var Z=this._getOutlineSize();if(W(ba)&&0===Z)throw Error("Nothing to render");this._outlineSize=
Z;fa.color=this._getFillColor();fa.outlineColor=this._getOutlineColor();fa.outlineSize=this._outlineSize;Z=this._context.sharedResources.textures.fromData(ba,()=>O.createTexture(ba));this._texture=Z.texture;this._releaseTexture=Z;fa.textureIsSignedDistanceField=!0;fa.distanceFieldBoundingBox=Y;fa.textureId=this._texture.id;Z=this._getIconSize();this._size=[Z,Z];this._symbolTextureRatio=1/da;this._createMaterialAndAddToStage(fa,this._context.stage)};ca._prepareResourcesHref=function(){var fa=c._asyncToGenerator(function*(ba,
Z,ha){if(!f("esri-canvas-svg-support")&&d.isSVG(Z))throw new n("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)");this._outlineSize=this._getOutlineSize();ba.color=this._getFillColor();ba.outlineColor=this._getOutlineColor();ba.outlineSize=this._outlineSize;ba.textureIsSignedDistanceField=!1;const na=this._getIconSize();ha=yield w.result(this._context.sharedResources.textures.fromUrl(Z,na*this._context.graphicsCoreOwner.view.pixelRatio,
{signal:ha}));if(!1===ha.ok)throw k.throwIfAbortError(ha.error),new n("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${Z})`);this._releaseTexture=ha.value;Z=ha.value.texture;this._size=this._computeSize(Z.params,na);ba.textureId=Z.id;this._createMaterialAndAddToStage(ba,this._context.stage)});return function(ba,Z,ha){return fa.apply(this,arguments)}}();ca._prepareResourcesCIM=function(){var fa=c._asyncToGenerator(function*(ba,Z,ha){Z=new V({data:Z});
if(!this._context.sharedResources.cimSymbolRasterizer){var na=(yield new Promise((ua,Fa)=>a(["../../../../symbols/cim/CIMSymbolRasterizer"],ua,Fa))).CIMSymbolRasterizer;k.throwIfAborted(ha);this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new na(this._context.renderCoordsHelper.spatialReference,!0))}na=this._context.layer.fields?this._context.layer.fields.map(ua=>ua.toJSON()):null;this._cimLayers=yield this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(Z,
na,this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:ha});let pa;if(this._context.renderer&&"dictionary"===this._context.renderer.type&&this._context.renderer.scaleExpression)if(Z=this._context.renderer,isNaN(Z.scaleExpression)){const ua=yield u.createRendererExpression(Z.scaleExpression,this._context.layer.spatialReference,na);pa=(Fa,qa,sa)=>{Fa=A(ua,Fa,{$view:sa},"esriGeometryPoint",qa);return null!==Fa?Fa:1}}else var xa=
Number(Z.scaleExpression);this._cimScaleFactorOrFunction=xa||pa||1;xa=this._context.renderer?yield this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];k.throwIfAborted(ha);const Da=this._context.layer.fieldsIndex;this._cimRequiredFields=xa.map(ua=>Da.get(ua).name);this._cimMaterialParametersInfo=ba;this._cimMaterialParametersInfo.color=this._getFillColor();this._cimMaterialParametersInfo.outlineColor=[0,0,0,0];this._cimMaterialParametersInfo.outlineSize=0;this._cimMaterialParametersInfo.textureIsSignedDistanceField=
!1});return function(ba,Z,ha){return fa.apply(this,arguments)}}();ca._getPrimitive=function(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||E.defaultPrimitive};ca._getOutlineSize=function(){var fa=0;fa=this.symbolLayer;if(l.isSome(fa.outline)&&null!=fa.outline.size)return Math.max(e.pt2px(fa.outline.size),0);fa=this._getPrimitive();fa=W(fa)?1.5:0;return Math.max(fa,0)};ca._getOutlineColor=function(){const fa=this._getLayerOpacity(),
ba=l.get(this.symbolLayer,"outline","color");if(l.isSome(ba)){const Z=g.toUnitRGB(ba);return[Z[0],Z[1],Z[2],ba.a*fa]}return[0,0,0,0]};ca._getFillColor=function(){if(W(this._getPrimitive()))return p.TRANSPARENT_UNIT;const fa=l.isNone(this._getPrimitive()),ba=l.get(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(ba,{hasIntrinsicColor:fa})};ca._getAnchorPos=function(fa,ba){return"relative"===fa?z.fromValues((ba.x||0)+.5,-(ba.y||0)+.5):fa in K.namedAnchorToHUDMaterialAnchorPos?
K.namedAnchorToHUDMaterialAnchorPos[fa]:K.namedAnchorToHUDMaterialAnchorPos.center};ca._createMaterialAndAddToStage=function(fa,ba){this._fastUpdates=this._cimLayers?{enabled:!1}:Q.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled&&Object.assign(fa,this._fastUpdates.materialParameters);if(this._cimLayers){let Z=this._cimSymbolMaterials.get(fa.textureId);Z||(Z=new T.HUDMaterial(fa),this._cimSymbolMaterials.set(fa.textureId,Z),ba.add(Z));
return Z}this._material=new T.HUDMaterial(fa);ba.add(this._material);return this._material};ca._setDrapingDependentMaterialParameters=function(){this.draped&&(this._forEachMaterial(fa=>{fa.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,slicePlaneEnabled:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())};ca.destroy=function(){la.prototype.destroy.call(this);this._forEachMaterial(fa=>this._context.stage.remove(fa));this._material=null;this._cimSymbolMaterials.clear();
this._cimSymbolTextures.forEach(fa=>this._context.stage.remove(fa));this._cimSymbolTextures.clear();this._releaseTexture=l.releaseMaybe(this._releaseTexture)};ca._getScaleFactor=function(fa,ba){if(this._drivenProperties.size&&fa.size){for(let Z=0;3>Z;Z++){const ha=fa.size[Z];ha&&"symbol-value"!==ha&&"proportional"!==ha&&(fa.size[Z]=e.pt2px(ha))}if("symbol-value"===fa.size[0])return 1;if(isFinite(+fa.size[0]))return+fa.size[0]/ba;if(isFinite(+fa.size[2]))return+fa.size[2]/ba}return 1};ca.createGraphics3DGraphic=
function(fa){const ba=fa.graphic;if(!this._validateGeometry(ba.geometry))return null;let Z;if(this._cimLayers){if(!this._cimLayers.length)return null;var ha=this._generateTextureCIM(ba);Z=this._createMaterialAndAddToStage({textureId:ha.id,...this._cimMaterialParametersInfo},this._context.stage);var na=[ha.params.width,ha.params.height]}else na=this._size,Z=l.unwrap(this._material);ha=I.placePointOnGeometry(ba.geometry);if(l.isNone(ha))return this.logger.warn(`unsupported geometry type for icon symbol: ${ba.geometry.type}`),
null;var pa=fa.renderingInfo;const xa=this._getVertexOpacityAndColor(pa);let Da=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(Da=this._getScaleFactor(pa,na[0]>na[1]?na[0]:na[1]));Da*=this._symbolTextureRatio;na=[na[0]*Da,na[1]*Da];pa=this.setGraphicElevationContext(ba,new C.ElevationContext);this.ensureDrapedStatus("on-the-ground"===pa.mode)&&this._setDrapingDependentMaterialParameters();return this.draped?this._createAsOverlay(ba,ha,Z,xa,na,fa.layer.uid):this._createAs3DShape(ba,
ha,Z,xa,na,pa,ba.uid)};ca.layerOpacityChanged=function(){const fa=this._getFillColor(),ba=this._getOutlineColor();this._forEachMaterial(Z=>{Z.setParameters({color:fa});Z.setParameters({outlineColor:ba})});return!0};ca.layerElevationInfoChanged=function(fa,ba,Z){const ha=this._elevationContext.mode;Z=D.elevationModeChangeUpdateType(ia.elevationModeChangeTypes,Z,ha);if(Z!==D.SymbolUpdateType.UPDATE)return Z;const na=D.needsElevationUpdates2D(ha)||"absolute-height"===ha;return this.updateGraphics3DGraphicElevationInfo(fa,
ba,()=>na)};ca.slicePlaneEnabledChanged=function(){this.draped||this._forEachMaterial(fa=>{fa.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled})});return!0};ca.physicalBasedRenderingChanged=function(){return!0};ca.pixelRatioChanged=function(){return this._getPrimitive()?!0:!1};ca.applyRendererDiff=function(fa,ba){for(const Z in fa.diff)switch(Z){case "visualVariables":if(Q.updateFastSymbolUpdatesState(this._fastUpdates,ba,this._fastVisualVariableConvertOptions()))l.isSome(this._material)&&
this._material.setParameters(this._fastUpdates.materialParameters);else return M.ApplyRendererDiffResult.Recreate_Symbol;break;default:return M.ApplyRendererDiffResult.Recreate_Symbol}return M.ApplyRendererDiffResult.Fast_Update};ca._defaultElevationInfoNoZ=function(){return ea};ca._createAs3DShape=function(fa,ba,Z,ha,na,pa,xa){const Da=this.getFastUpdateAttrValues(fa);fa=Da?Fa=>Q.evaluateModelTransform(this._fastUpdates.materialParameters,Da,Fa):null;ha=[N.createPointGeometry(aa,null,ha,na,ja,null,
Da)];xa=I.createStageObjectForHUD(this._context,ba,ha,[Z],pa,this._context.layer.uid,xa,fa);if(null===xa)return null;const ua=new G.Graphics3DObject3DGraphicLayer(this,xa.object,ha,null,null,B.perObjectElevationAligner,pa);ua.alignedSampledElevation=xa.sampledElevation;ua.needsElevationUpdates=D.needsElevationUpdates2D(pa.mode)||"absolute-height"===pa.mode;ua.getScreenSize=this._createScreenSizeGetter(na,fa);ua.calculateRelativeScreenBounds=Fa=>Z.calculateRelativeScreenBounds(ua.getScreenSize(),1,
Fa);I.extendPointGraphicElevationContext(ua,ba,this._context.elevationProvider);return ua};ca._createAsOverlay=function(fa,ba,Z,ha,na,pa){Z.renderPriority=this._renderPriority;const xa=t.create();r.projectPointToVector(ba,xa,this._context.overlaySR);xa[2]=J.DRAPED_Z;ba=this._context.clippingExtent;if(l.isSome(ba)&&!x.containsPoint(ba,xa))return null;const Da=this.getFastUpdateAttrValues(fa);ba=Da?Fa=>Q.evaluateModelTransform(this._fastUpdates.materialParameters,Da,Fa):null;ha=N.createPointGeometry(aa,
xa,ha,na,null,null,Da);fa=new R.RenderGeometry(ha,Z,{layerUid:pa,graphicUid:fa.uid,calculateShaderTransformation:ba});xa[3]=0;q.copy(fa.boundingSphere,xa);const ua=new F(this,[fa],null);ua.getScreenSize=this._createScreenSizeGetter(na,ba);ua.calculateRelativeScreenBounds=Fa=>Z.calculateRelativeScreenBounds(ua.getScreenSize(),1,Fa);return ua};ca._createScreenSizeGetter=function(fa,ba){const Z=this._outlineSize+2;if(this._fastUpdates.enabled){const ha=fa[0]/this._symbolTextureRatio,na=fa[1]/this._symbolTextureRatio;
return(pa=z.create())=>{const xa=ba(U);pa[0]=xa[0]*ha+Z;pa[1]=xa[5]*na+Z;return pa}}{const ha=fa[0]/this._symbolTextureRatio+Z,na=fa[1]/this._symbolTextureRatio+Z;return(pa=z.create())=>{pa[0]=ha;pa[1]=na;return pa}}};ca._fastVisualVariableConvertOptions=function(){var fa=this._size[0]>this._size[1]?this._size[0]:this._size[1];const ba=v.fromValues(fa,fa,fa),Z=e.px2pt(1);fa*=Z;fa=v.fromValues(fa,fa,fa);return{modelSize:ba,symbolSize:fa,unitInMeters:Z,transformation:{anchor:v.ZEROS,scale:v.ONES,rotation:v.ZEROS}}};
ca._getGraphicHash=function(fa){let ba="";for(const Z of this._cimRequiredFields)ba+=Z+fa.attributes[Z];return ba};ca._forEachMaterial=function(fa){l.isSome(this._material)&&fa(this._material);this._cimSymbolMaterials.forEach(fa)};c._createClass(ia,[{key:"test",get:function(){return{material:this._material}}}]);return ia}(L.Graphics3DSymbolLayer);L.PRIMITIVE_SIZE=h;L.elevationModeChangeTypes={definedChanged:D.SymbolUpdateType.UPDATE,staysOnTheGround:D.SymbolUpdateType.NONE,onTheGroundChanged:D.SymbolUpdateType.RECREATE};
const ea={mode:"relative-to-ground",offset:0},ja=t.fromValues(0,0,0,1);b.Graphics3DIconSymbolLayer=L;b.default=L;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/2d/arcade/callExpressionWithFeature":function(){define(["../../../core/Error","../../../core/Logger","../../../geometry/support/quantizationUtils"],function(a,b,c){function g(w){const n={};switch(w){case "esriGeometryPoint":return(f,l,k,e)=>c.unquantizePoint(l,n,f,k,e);case "esriGeometryPolygon":return(f,l,k,e)=>c.unquantizePolygon(l,
n,f,k,e);case "esriGeometryPolyline":return(f,l,k,e)=>c.unquantizePolyline(l,n,f,k,e);case "esriGeometryMultipoint":return(f,l,k,e)=>c.unquantizeMultipoint(l,n,f,k,e);default:return b.getLogger("esri.views.2d.support.arcadeOnDemand").error(new a("mapview-arcade",`Unable to handle geometryType: ${w}`)),f=>f}}const h=new Map;return function(w,n,f,l,k){if(w.referencesGeometry()&&k){{const {transform:e,hasZ:d,hasM:m}=k;h.has(l)||h.set(l,g(l));l=h.get(l)(n.geometry,e,d,m);n={...n,geometry:l}}}n=w.repurposeFeature(n);
try{return w.evaluate({...f,$feature:n})}catch(e){return b.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",e),null}}})},"esri/views/3d/layers/graphics/constants":function(){define(["exports","../../../../chunks/vec4f64"],function(a,b){const c=b.ZEROS;b=b.ONES;a.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2;a.TRANSPARENT_UNIT=c;a.WHITE_UNIT=b;a.defaultIconElevationOffset=1;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ModelDirtyTypes".split(" "),
function(a,b,c,g,h,w,n,f,l){let k=function(){function z(q,t,r){this.graphics3DSymbolLayer=q;this.renderGeometries=t;this.boundingBox=r;this.type="draped";this.stage=null;this._addedToStage=this._visible=!1;this._graphicsCoreOwner=null;this.isElevationSource=!1}var v=z.prototype;v.initialize=function(q,t,r){this.stage=q;this._graphicsCoreOwner=r;this._overlayRenderer=this._graphicsCoreOwner.view.basemapTerrain.overlayManager.renderer};v.setVisibility=function(q){if(null!=this.stage&&this._visible!==
q)if((this._visible=q)&&!this._addedToStage)this._addedToStage=!0,this._overlayRenderer.addGeometries(this.renderGeometries,this._graphicsCoreOwner,l.ModelDirty.Geometry.ADD);else if(q||this._addedToStage){for(const t of this.renderGeometries)t.instanceParameters.visible=this._visible;this._overlayRenderer.updateGeometries(this.renderGeometries,this._graphicsCoreOwner,l.ModelDirty.State.VISIBILITIES)}};v.destroy=function(){this.stage&&this._addedToStage&&this._overlayRenderer.removeGeometries(this.renderGeometries,
this._graphicsCoreOwner,l.ModelDirty.Geometry.REMOVE);this._visible=this._addedToStage=!1;this.stage=null};v.getCenterObjectSpace=function(q=g.create()){return c.set(q,0,0,0)};v.getBoundingBoxObjectSpace=function(q=h.create()){return h.empty(q)};v.addObjectState=function(q,t){q===f.Object3DState.Highlight&&(this.renderGeometries.forEach(r=>{const x=r.addHighlight();t.addRenderGeometry(r,x,this)}),this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._graphicsCoreOwner))};
v.removeObjectState=function(q){this.renderGeometries.forEach(t=>{q.removeRenderGeometry(t)})};v.removeRenderGeometryObjectState=function(q,t){q.removeHighlight(t);this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._graphicsCoreOwner)};v.computeAttachmentOrigin=function(q){for(const t of this.renderGeometries)t.computeAttachmentOrigin(m)&&(q.draped.origin[0]+=m[0],q.draped.origin[1]+=m[1],q.draped.num++)};v.getProjectedBoundingBox=function(){var q=a._asyncToGenerator(function*(t,
r,x,u,E){h.empty(E);for(let y=0;y<this.renderGeometries.length;y++)this._getRenderGeometryProjectedBoundingRect(this.renderGeometries[y],t,e,x),h.expandWithRect(E,e);if(r){h.center(E,m);let y;t=n.demResolutionForBoundingBox(E,r);try{y=yield r.service.queryElevation(m[0],m[1],u,t,"ground")}catch(A){}b.isSome(y)&&(E[2]=Math.min(E[2],y),E[5]=Math.max(E[5],y))}return E});return function(t,r,x,u,E){return q.apply(this,arguments)}}();v._getRenderGeometryProjectedBoundingRect=function(q,t,r,x){if(this.boundingBox)h.set(d,
this.boundingBox);else{q=q.boundingSphere;const u=q[3];d[0]=q[0]-u;d[1]=q[1]-u;d[2]=q[2]-u;d[3]=q[0]+u;d[4]=q[1]+u;d[5]=q[2]+u}t(d,0,2);this.calculateRelativeScreenBounds&&x.push({location:h.center(d),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return h.toRect(d,r)};return z}();const e=w.create(),d=h.create(),m=g.create();return k})},"esri/views/3d/layers/graphics/placementUtils":function(){define(["exports","../../../../chunks/vec2f64","../../webgl-engine/lib/TextRenderer"],function(a,
b,c){b={"bottom-left":b.fromValues(0,0),bottom:b.fromValues(.5,0),"bottom-right":b.fromValues(1,0),left:b.fromValues(0,.5),center:b.fromValues(.5,.5),right:b.fromValues(1,.5),"top-left":b.fromValues(0,1),top:b.fromValues(.5,1),"top-right":b.fromValues(1,1)};a.anchorFromPlacements=function(g,h){switch(h){case "bottom":return"left"===g?"bottom-left":"right"===g?"bottom-right":"bottom";case "center":return g;case "top":return"left"===g?"top-left":"right"===g?"top-right":"top"}};a.horizontalPlacementFromAlignment=
function(g){return"justify"===g?"center":g};a.horizontalPlacementFromAnchor=function(g){switch(g){case "bottom-left":case "left":case "top-left":return"left";case "bottom":case "center":case "top":return"center";case "bottom-right":case "right":case "top-right":return"right"}};a.horizontalPlacementToAnchorX={left:0,center:.5,right:1};a.namedAnchorToHUDMaterialAnchorPos=b;a.textRenderAlignmentFromHorizontalPlacement=function(g){switch(g){case "left":return c.TextRenderAlignment.Left;case "right":return c.TextRenderAlignment.Right;
default:return c.TextRenderAlignment.Center}};a.verticalPlacementFromAlignment=function(g){return"middle"===g?"center":g};a.verticalPlacementFromAnchor=function(g){switch(g){case "bottom-left":case "bottom":case "bottom-right":return"bottom";case "left":case "center":case "right":return"center";case "top-left":case "top":case "top-right":return"top"}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextRenderer":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/mathUtils","../../../../core/maybe","../../support/debugFlags"],function(a,b,c,g,h){function w(e,d,m){e.canvas||(e.canvas=document.createElement("canvas"));e.canvas.width=d;e.canvas.height=m;return e.canvas}let n=function(){function e(m,z,v,q=2048){this.text=m;this._alignment=z;this._parameters=v;this.maxSize=q;this._textWidths=[];this._lineWidths=[];this._heightMetrics=this._displayWidth=this._renderPixelRatio=null;this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${m}`;
this._lines=m.split(/\r?\n/)}var d=e.prototype;d._getLineXOffset=function(m){switch(this._alignment){case a.TextRenderAlignment.Left:return this.backgroundHorizontalPadding;case a.TextRenderAlignment.Center:return(this.displayWidth-this._lineWidths[m])/2;case a.TextRenderAlignment.Right:return this.displayWidth-this.backgroundHorizontalPadding-this._lineWidths[m]}};d.render=function(m,z=0,v=0){m.save();z/=this.renderPixelRatio;v/=this.renderPixelRatio;const q=z,t=v;var r=this.haloSize,x=this.firstLineYOffset;
z+=r;v+=x+this.baselinePosition;const u=0<this.haloSize;u&&this._renderHalo(m,q,t,r,x);this._setFontProperties(m,this.renderedFontSize);for(r=0;r<this._lines.length;++r){const E=this._lines[r],y=this._getLineXOffset(r);u&&(m.globalCompositeOperation="destination-out",m.fillStyle="rgb(0, 0, 0)",this._fillText(m,E,z+y,v),this._renderLineDecoration(m,z+y,v,this._textWidths[r]));m.globalCompositeOperation="source-over";m.fillStyle=this._parameters.textStyle;this._fillText(m,E,z+this._getLineXOffset(r),
v);this._renderLineDecoration(m,z+y,v,this._textWidths[r]);v+=this.lineSpacing}if(h.TEXT_SHOW_BASELINE)for(m.strokeStyle="rgb(255, 0, 255, 0.5)",m.setLineDash([2,2]),m.lineWidth=1,z=t+x,v=0;v<this._lines.length;++v)x=z+this.baselinePosition,this._drawLine(m,[q,x],[q+this.displayWidth,x]),z+=this.lineSpacing;h.TEXT_SHOW_BORDER&&(m.strokeStyle="rgb(255, 0, 255, 0.5)",m.setLineDash([]),m.lineWidth=1,this._drawBox(m,[q,t],[this.displayWidth,this.displayHeight]));this.hasBackground&&(this._roundedRect(m,
q,t,this._parameters.definition.background.borderRadius*this.renderPixelRatio),m.globalCompositeOperation="destination-over",m.fillStyle=this._parameters.backgroundStyle,m.fill());m.restore()};d._renderLineDecoration=function(m,z,v,q,t=!1){if("none"!==this._parameters.definition.font.decoration&&0!==q){var r=Math.max(this._parameters.definition.size/16,1);switch(this._parameters.definition.font.decoration){case "underline":v+=2*r;break;case "line-through":v-=.33*this.baselinePosition}var x=t?this.haloSize:
0;m.strokeStyle=t?this._parameters.haloStyle:this._parameters.textStyle;m.lineWidth=this._toRenderUnit(r+2*x);m.beginPath();m.moveTo(this._toRenderUnit(z-x),this._toRenderUnit(v));m.lineTo(this._toRenderUnit(z+q+x),this._toRenderUnit(v));m.stroke()}};d._roundedRect=function(m,z,v,q){z=this._toRenderUnit(z);v=this._toRenderUnit(v);const t=this.renderedWidth,r=this.renderedHeight;0===q?m.rect(z,v,t,r):(q=c.clamp(q,0,Math.floor(r/2)),m.beginPath(),m.moveTo(z,v+q),m.arcTo(z,v,z+q,v,q),m.lineTo(z+t-q,
v),m.arcTo(z+t,v,z+t,v+q,q),m.lineTo(z+t,v+r-q),m.arcTo(z+t,v+r,z+t-q,v+r,q),m.lineTo(z+q,v+r),m.arcTo(z,v+r,z,v+r-q,q),m.closePath())};d._renderHalo=function(m,z,v,q,t){const r=this.renderedWidth,x=this.renderedHeight,u=w(l,Math.max(r,512),Math.max(x,512)),E=u.getContext("2d");E.clearRect(0,0,r,x);this._setFontProperties(E,this.renderedFontSize);E.fillStyle=this._parameters.haloStyle;E.strokeStyle=this._parameters.haloStyle;var y=3>this.renderedHaloSize;E.lineJoin=y?"miter":"round";y?this._renderHaloEmulated(E,
q,t):this._renderHaloNative(E,q,t);t+=this.baselinePosition;for(y=0;y<this._lines.length;++y){const A=this._getLineXOffset(y);this._renderLineDecoration(E,q+A,t,this._textWidths[y],!0);t+=this.lineSpacing}m.globalAlpha=this._parameters.definition.halo.color[3];m.drawImage(u,0,0,r,x,this._toRenderUnit(z),this._toRenderUnit(v),r,x);m.globalAlpha=1};d._renderHaloEmulated=function(m,z,v){v+=this.baselinePosition;for(let q=0;q<this._lines.length;++q){const t=this._lines[q],r=this._getLineXOffset(q);for(const [x,
u]of f)this._fillText(m,t,z+r+this.haloSize*x,v+this.haloSize*u);v+=this.lineSpacing}};d._renderHaloNative=function(m,z,v){const q=2*this.haloSize;v+=this.baselinePosition;for(let t=0;t<this._lines.length;++t){const r=this._lines[t],x=this._getLineXOffset(t);for(let u=0;5>u;u++)m.lineWidth=this._toRenderUnit((.6+.1*u)*q),this._strokeText(m,r,z+x,v);v+=this.lineSpacing}};d._setFontProperties=function(m,z){m.font=this._parameters.fontString(z);m.textAlign="left";m.textBaseline="alphabetic"};d._ensureTextWidth=
function(){if(g.isSome(this._displayWidth))return this._displayWidth;const m=w(l,512,512).getContext("2d");this._setFontProperties(m,this.fontSize);let z=2*this.haloSize;var v=this._parameters.definition.font;if("italic"===v.style||"oblique"===v.style||"bold"===v.weight||"bolder"===v.weight)z+=.3*m.measureText("A").width;this._textWidths.length=0;v=this._lineWidths.length=0;for(const q of this._lines){const t=m.measureText(q).width,r=t+z;this._textWidths.push(t);this._lineWidths.push(r);v=Math.max(v,
r)}return this._displayWidth=v};d._ensureHeightMetrics=function(){if(g.isNone(this._heightMetrics)){var m=w(l,512,512).getContext("2d");this._setFontProperties(m,this.fontSize);const z=m.measureText(this.text+k),v=this.hasBackground?m.measureText(this._lines[0]):z;m=1===this._lines.length?v:this.hasBackground?m.measureText(this._lines[this._lines.length-1]):z;this._heightMetrics={paddingTop:z.actualBoundingBoxAscent-v.actualBoundingBoxAscent,paddingBottom:z.actualBoundingBoxDescent-m.actualBoundingBoxDescent,
lineHeight:z.actualBoundingBoxAscent+z.actualBoundingBoxDescent,baselinePosition:z.actualBoundingBoxAscent}}return this._heightMetrics};d._toRenderUnit=function(m){return m*this.renderPixelRatio};d._toRoundedRenderUnit=function(m){return Math.round(m*this.renderPixelRatio)};d._fillText=function(m,z,v,q){m.fillText(z,this._toRenderUnit(v),this._toRenderUnit(q))};d._strokeText=function(m,z,v,q){m.strokeText(z,this._toRenderUnit(v),this._toRenderUnit(q))};d._drawLine=function(m,z,v){m.beginPath();m.moveTo(this._toRoundedRenderUnit(z[0])+
.5,this._toRoundedRenderUnit(z[1])+.5);m.lineTo(this._toRoundedRenderUnit(v[0])+.5,this._toRoundedRenderUnit(v[1])+.5);m.stroke()};d._drawBox=function(m,z,v){var q=this._toRenderUnit(z[0]);z=this._toRenderUnit(z[1]);var t=this._toRenderUnit(v[0]);const r=this._toRenderUnit(v[1]);v=Math.floor(q)+.5;q=Math.ceil(q+t)-.5;t=Math.floor(z)+.5;z=Math.ceil(z+r)-.5;m.beginPath();m.moveTo(v,t);m.lineTo(q,t);m.lineTo(q,z);m.lineTo(v,z);m.lineTo(v,t);m.stroke()};b._createClass(e,[{key:"displayWidth",get:function(){return Math.ceil(this._ensureTextWidth()+
2*this.backgroundHorizontalPadding)}},{key:"displayHeight",get:function(){return Math.ceil(this.lineSpacing*(this._lines.length-1)+this.lineHeight+2*this.haloSize+this.backgroundTopPadding+this.backgroundBottomPadding)}},{key:"renderedWidth",get:function(){return Math.ceil(this._toRenderUnit(this.displayWidth))}},{key:"renderedHeight",get:function(){return Math.ceil(this._toRenderUnit(this.displayHeight))}},{key:"firstRenderedBaselinePosition",get:function(){return this._toRenderUnit(this.firstLineYOffset+
this.baselinePosition)}},{key:"firstLineYOffset",get:function(){return this.backgroundTopPadding+this.haloSize}},{key:"heightMetrics",get:function(){return this._ensureHeightMetrics()}},{key:"lineSpacing",get:function(){return(this.lineHeight+this.linePadding)*this._parameters.definition.lineSpacingFactor}},{key:"lineHeight",get:function(){return this.heightMetrics.lineHeight}},{key:"linePadding",get:function(){return.2*this.lineHeight}},{key:"baselinePosition",get:function(){return this.heightMetrics.baselinePosition}},
{key:"renderedFontSize",get:function(){return this._toRenderUnit(this.fontSize)}},{key:"fontSize",get:function(){return this._parameters.definition.size}},{key:"renderedHaloSize",get:function(){return this._toRenderUnit(this.haloSize)}},{key:"haloSize",get:function(){return this._parameters.haloSize}},{key:"backgroundHorizontalPadding",get:function(){return this.hasBackground?this._parameters.definition.background.padding[0]:0}},{key:"backgroundVerticalPadding",get:function(){return this.hasBackground?
this._parameters.definition.background.padding[1]:0}},{key:"backgroundTopPadding",get:function(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingTop)}},{key:"backgroundBottomPadding",get:function(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingBottom)}},{key:"hasBackground",get:function(){return!!this._parameters.backgroundStyle}},{key:"renderPixelRatio",get:function(){if(g.isNone(this._renderPixelRatio)){const m=this._parameters.definition.pixelRatio;
this._renderPixelRatio=0<this.maxSize?Math.min(m,Math.min(this.maxSize/this.displayWidth,this.maxSize/this.displayHeight)):m}return this._renderPixelRatio}}]);return e}();const f=[];for(let e=0;360>e;e+=22.5)f.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);a.TextRenderAlignment=void 0;(function(e){e[e.Left=0]="Left";e[e.Center=1]="Center";e[e.Right=2]="Right"})(a.TextRenderAlignment||(a.TextRenderAlignment={}));const l={canvas:null},k=(()=>{let e="";for(let d=32;127>d;d++)e+=String.fromCharCode(d);
return e})();a.TextRenderer=n;a.default=n;a.getTextHelperCanvas=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../renderers/support/lengthUtils ../../support/debugFlags".split(" "),function(a,b,c,g,h,w,n,f,l,
k,e){function d(H){return null!==H&&void 0!==H}function m(H){return"number"===typeof H}function z(H){return"string"===typeof H}function v(H,M){H&&H.push(M)}function q(H,M,K,I=n.create()){H=H||0;M=M||0;K=K||0;0!==H&&w.rotateZ(I,I,-H/180*Math.PI);0!==M&&w.rotateX(I,I,M/180*Math.PI);0!==K&&w.rotateY(I,I,K/180*Math.PI);return I}function t(H,M,K,I,O){const Q=H.minSize,J=H.maxSize;if(H.expression)return v(O,"Could not convert size info: expression not supported"),!1;if(H.useSymbolValue)return H=I.symbolSize[K],
M.minSize[K]=H,M.maxSize[K]=H,M.offset[K]=M.minSize[K],M.factor[K]=0,M.type[K]=a.FastSizeType.DefinedSize,!0;if(d(H.field)){if(d(H.stops)){if(2===H.stops.length&&m(H.stops[0].size)&&m(H.stops[1].size))return r(H.stops[0].size,H.stops[1].size,H.stops[0].value,H.stops[1].value,M,K),M.type[K]=a.FastSizeType.DefinedSize,!0;v(O,"Could not convert size info: stops only supported with 2 elements");return!1}if(m(Q)&&m(J)&&d(H.minDataValue)&&d(H.maxDataValue))return r(Q,J,H.minDataValue,H.maxDataValue,M,K),
M.type[K]=a.FastSizeType.DefinedSize,!0;if(null!=k.meterIn[H.valueUnit])return M.minSize[K]=-Infinity,M.maxSize[K]=Infinity,M.offset[K]=0,M.factor[K]=1/k.meterIn[H.valueUnit],M.type[K]=a.FastSizeType.DefinedSize,!0;if("unknown"===H.valueUnit)return v(O,"Could not convert size info: proportional size not supported"),!1;v(O,"Could not convert size info: scale-dependent size not supported");return!1}if(!d(H.field)){if(H.stops&&H.stops[0]&&m(H.stops[0].size))return M.minSize[K]=H.stops[0].size,M.maxSize[K]=
H.stops[0].size,M.offset[K]=M.minSize[K],M.factor[K]=0,M.type[K]=a.FastSizeType.DefinedSize,!0;if(m(Q))return M.minSize[K]=Q,M.maxSize[K]=Q,M.offset[K]=Q,M.factor[K]=0,M.type[K]=a.FastSizeType.DefinedSize,!0}v(O,"Could not convert size info: unsupported variant of sizeInfo");return!1}function r(H,M,K,I,O,Q){I=0<Math.abs(I-K)?(M-H)/(I-K):0;O.minSize[Q]=0<I?H:M;O.maxSize[Q]=0<I?M:H;O.offset[Q]=H-K*I;O.factor[Q]=I}function x(H,M,K,I){if(H.normalizationField||H.valueRepresentation)return v(I,"Could not convert size info: unsupported property"),
null;var O=H.field;if(null!=O&&!z(O))return v(I,"Could not convert size info: field is not a string"),null;if(!M.size)M.size={field:H.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[a.FastSizeType.Undefined,a.FastSizeType.Undefined,a.FastSizeType.Undefined]};else if(H.field)if(!M.size.field)M.size.field=H.field;else if(H.field!==M.size.field)return v(I,"Could not convert size info: multiple fields in use"),null;switch(H.axis){case "width":return(O=t(H,M.size,0,K,I))?M:null;
case "height":return(O=t(H,M.size,2,K,I))?M:null;case "depth":return(O=t(H,M.size,1,K,I))?M:null;case "width-and-depth":return(O=t(H,M.size,0,K,I))&&t(H,M.size,1,K,I),O?M:null;case null:case void 0:case "all":return(O=(O=(O=t(H,M.size,0,K,I))&&t(H,M.size,1,K,I))&&t(H,M.size,2,K,I))?M:null;default:return v(I,`Could not convert size info: unknown axis "${H.axis}""`),null}}function u(H,M,K){for(let I=0;3>I;++I){let O=M.unitInMeters;H.type[I]===a.FastSizeType.DefinedSize&&(O*=M.modelSize[I],H.type[I]=
a.FastSizeType.DefinedScale);H.minSize[I]/=O;H.maxSize[I]/=O;H.offset[I]/=O;H.factor[I]/=O}if(H.type[0]!==a.FastSizeType.Undefined)M=0;else if(H.type[1]!==a.FastSizeType.Undefined)M=1;else if(H.type[2]!==a.FastSizeType.Undefined)M=2;else return v(K,"No size axis contains a valid size or scale"),!1;for(K=0;3>K;++K)H.type[K]===a.FastSizeType.Undefined&&(H.minSize[K]=H.minSize[M],H.maxSize[K]=H.maxSize[M],H.offset[K]=H.offset[M],H.factor[K]=H.factor[M],H.type[K]=H.type[M]);return!0}function E(H,M,K){H[4*
M]=K.r/255;H[4*M+1]=K.g/255;H[4*M+2]=K.b/255;H[4*M+3]=K.a}function y(H,M,K){if(H.normalizationField)return v(K,"Could not convert color info: unsupported property"),null;if(z(H.field))if(H.stops){if(8<H.stops.length)return v(K,"Could not convert color info: too many color stops"),null;M.color={field:H.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};H=H.stops;for(K=0;8>K;++K){const I=H[Math.min(K,H.length-1)];M.color.values[K]=I.value;E(M.color.colors,
K,I.color)}}else return v(K,"Could not convert color info: missing stops or colors"),null;else if(H.stops&&0<=H.stops.length)for(H=H.stops&&0<=H.stops.length&&H.stops[0].color,M.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},K=0;8>K;K++)M.color.values[K]=Infinity,E(M.color.colors,K,H);else return v(K,"Could not convert color info: no field and no colors/stops"),null;return M}function A(H,M,K){if(H.normalizationField)return v(K,
"Could not convert opacity info: unsupported property"),null;if(z(H.field))if(H.stops){if(8<H.stops.length)return v(K,"Could not convert opacity info: too many opacity stops"),null;M.opacity={field:H.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};H=H.stops;for(K=0;8>K;++K){const I=H[Math.min(K,H.length-1)];M.opacity.values[K]=I.value;M.opacity.opacityValues[K]=I.opacity}}else return v(K,"Could not convert opacity info: missing stops or opacities"),null;else if(H.stops&&0<=H.stops.length)for(H=
H.stops&&0<=H.stops.length&&H.stops[0].opacity,M.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},K=0;8>K;K++)M.opacity.values[K]=Infinity,M.opacity.opacityValues[K]=H;else return v(K,"Could not convert opacity info: no field and no opacities/stops"),null;return M}function p(H,M,K){H=2===K&&"arithmetic"===H.rotationType;M.offset[K]=H?90:0;M.factor[K]=H?-1:1;M.type[K]=1}function B(H,M,K){if(!z(H.field))return v(K,"Could not convert rotation info: field is not a string"),
null;if(!M.rotation)M.rotation={field:H.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(H.field)if(!M.rotation.field)M.rotation.field=H.field;else if(H.field!==M.rotation.field)return v(K,"Could not convert rotation info: multiple fields in use"),null;switch(H.axis){case "tilt":return p(H,M.rotation,0),M;case "roll":return p(H,M.rotation,1),M;case null:case void 0:case "heading":return p(H,M.rotation,2),M;default:return v(K,`Could not convert rotation info: unknown axis "${H.axis}""`),null}}
function D(H,M,K){if(!H)return null;const I=!M.supportedTypes||!!M.supportedTypes.size,O=!M.supportedTypes||!!M.supportedTypes.color,Q=!M.supportedTypes||!!M.supportedTypes.rotation,J=!!M.supportedTypes&&!!M.supportedTypes.opacity,P=H.reduce((N,R)=>{if(!N)return N;if(R.valueExpression)return v(K,"Could not convert visual variables: arcade expressions not supported"),null;switch(R.type){case "size":return I?x(R,N,M,K):N;case "color":return O?y(R,N,K):N;case "opacity":return J?A(R,N,K):null;case "rotation":return Q?
B(R,N,K):N;default:return null}},{size:null,color:null,opacity:null,rotation:null});return 0<H.length&&P&&!P.size&&!P.color&&!P.opacity&&!P.rotation||P&&P.size&&!u(P.size,M,K)?null:P}function C(H,M,K){if(!!H!==!!M||H&&H.field!==M.field)return!1;if(H&&"rotation"===K)for(K=0;3>K;K++)if(H.type[K]!==M.type[K]||H.offset[K]!==M.offset[K]||H.factor[K]!==M.factor[K])return!1;return!0}function F(H,M){const K={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,
vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},I=H&&null!=H.size;H&&H.size?(K.vvSizeEnabled=!0,K.vvSizeMinSize=H.size.minSize,K.vvSizeMaxSize=H.size.maxSize,K.vvSizeOffset=H.size.offset,K.vvSizeFactor=H.size.factor):H&&I&&(K.vvSizeValue=M.transformation.scale);H&&I&&(K.vvSymbolAnchor=M.transformation.anchor,K.vvSymbolRotationMatrix=h.create(),w.identity(L),q(M.transformation.rotation[2],
M.transformation.rotation[0],M.transformation.rotation[1],L),g.fromMat4(K.vvSymbolRotationMatrix,L));H&&H.color&&(K.vvColorEnabled=!0,K.vvColorValues=H.color.values,K.vvColorColors=H.color.colors);H&&H.opacity&&(K.vvOpacityEnabled=!0,K.vvOpacityValues=H.opacity.values,K.vvOpacityOpacities=H.opacity.opacityValues);return K}a.FastSizeType=void 0;(function(H){H[H.Undefined=0]="Undefined";H[H.DefinedSize=1]="DefinedSize";H[H.DefinedScale=2]="DefinedScale"})(a.FastSizeType||(a.FastSizeType={}));a.FastRotationType=
void 0;(function(H){H[H.Undefined=0]="Undefined";H[H.DefinedAngle=1]="DefinedAngle"})(a.FastRotationType||(a.FastRotationType={}));var G;(function(H){const M=n.create(),K=l.create();H.evaluateModelTransform=function(I,O,Q){if(!I.vvSizeEnabled)return Q;w.copy(M,Q);Q=I.vvSymbolRotationMatrix;w.set(L,Q[0],Q[1],Q[2],0,Q[3],Q[4],Q[5],0,Q[6],Q[7],Q[8],0,0,0,0,1);w.multiply(M,M,L);for(Q=0;3>Q;++Q)K[Q]=c.clamp(I.vvSizeOffset[Q]+O[0]*I.vvSizeFactor[Q],I.vvSizeMinSize[Q],I.vvSizeMaxSize[Q]);w.scale(M,M,K);
w.translate(M,M,I.vvSymbolAnchor);return M};H.evaluateModelTransformScale=function(I,O,Q){if(!O.vvSizeEnabled)return f.set(I,1,1,1);for(let J=0;3>J;++J)I[J]=c.clamp(O.vvSizeOffset[J]+Q[0]*O.vvSizeFactor[J],O.vvSizeMinSize[J],O.vvSizeMaxSize[J]);return I}})(G||(G={}));const L=n.create();b=G.evaluateModelTransform;G=G.evaluateModelTransformScale;a.convertVisualVariables=D;a.evaluateModelTransform=b;a.evaluateModelTransformScale=G;a.getMaterialParams=F;a.initFastSymbolUpdatesState=function(H,M){return!H||
e.TESTS_DISABLE_FAST_UPDATES?{enabled:!1}:(H=D(H.visualVariables,M))?{enabled:!0,visualVariables:H,materialParameters:F(H,M),requiresShaderTransformation:H&&null!=H.size}:{enabled:!1}};a.updateFastSymbolUpdatesState=function(H,M,K){if(!M||!H.enabled)return!1;const I=H.visualVariables;M=D(M.visualVariables,K);if(!(M&&C(I.size,M.size,"size")&&C(I.color,M.color,"color")&&C(I.rotation,M.rotation,"rotation")&&C(I.opacity,M.opacity,"opacity")))return!1;H.visualVariables=M;H.materialParameters=F(M,K);H.requiresShaderTransformation=
M&&null!=M.size;return!0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/uid ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec4f64 ../../support/mathUtils ./basicInterfaces ./geometryDataUtils ./InstanceParameters ./Object3DStateID ./VertexAttribute ../materials/renderers/utils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v){let q=function(){function r(u,E,y={}){this.data=u;this.material=E;this.boundingSphere=f.create();this.instanceParameters=new d.InstanceParameters;this._transformation=w.create();this._shaderTransformationDirty=!0;this.layerUid=c.unwrapOr(y.layerUid,null);this.graphicUid=c.unwrapOr(y.graphicUid,null);this.id=y.id?y.id:g.generateUID();this.boundingInfo=c.unwrapOr(y.boundingInfo,null);this.calculateShaderTransformation=c.unwrapOr(this.calculateShaderTransformation,
null);this.castShadow=y.castShadow?y.castShadow:!1}var x=r.prototype;x.updateTransformation=function(u){u(this._transformation);this._shaderTransformationDirty=!0;this.computeBoundingSphere(this._transformation,this.boundingSphere)};x.shaderTransformationChanged=function(){this._shaderTransformationDirty=!0};x.computeBoundingSphere=function(u,E,y=l.maxScale(u)){c.isNone(this.boundingInfo)||(n.transformMat4(E,this.boundingInfo.getCenter(),u),E[3]=this.boundingInfo.getBSRadius()*y)};x.getShaderTransformation=
function(){if(c.isNone(this.calculateShaderTransformation))return c.unwrapOr(this.transformation,w.IDENTITY);this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=w.create()),h.copy(this._shaderTransformation,this.calculateShaderTransformation(c.unwrapOr(this.transformation,w.IDENTITY))),this._shaderTransformationDirty=!1);return this._shaderTransformation};x.computeAttachmentOrigin=function(u){if(this.material.computeAttachmentOrigin)return this.material.computeAttachmentOrigin(this,
u)?(c.isSome(this._transformation)&&n.transformMat4(u,u,this._transformation),!0):!1;const E=this.indices.get(z.VertexAttribute.POSITION),y=this.vertexAttributes.get(z.VertexAttribute.POSITION);return e.computeAttachmentOriginTriangles(y,E,u)?(c.isSome(this._transformation)&&n.transformMat4(u,u,this._transformation),!0):!1};x.addHighlight=function(){const u=new m.Object3DStateID(k.Object3DState.Highlight),E=this.instanceParameters;E.highlights=v.addObject3DStateID(E.highlights,u);return u};x.removeHighlight=
function(u){const E=this.instanceParameters;E.highlights=v.removeObject3DStateID(E.highlights,u)};b._createClass(r,[{key:"transformation",get:function(){return this._transformation}},{key:"hasShaderTransformation",get:function(){return c.isSome(this.calculateShaderTransformation)}},{key:"primitiveType",get:function(){return this.data.primitiveType}},{key:"indices",get:function(){return this.data.indices}},{key:"vertexAttributes",get:function(){return this.data.vertexAttributes}}]);return r}(),t=function(r){function x(){return r.apply(this,
arguments)||this}b._inheritsLoose(x,r);return x}(q);a.RenderGeometry=q;a.ValidatedRenderGeometry=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/InstanceParameters":function(){define(["exports"],function(a){a.InstanceParameters=function(){this.visible=!0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../core/Error ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../renderers/support/renderingInfoUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./interfaces ./lineUtils ../support/FastSymbolUpdates ../support/markerUtils ../../support/debugFlags ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/LineMarkerMaterial ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/RibbonLineMaterial ../../../../geometry/Extent ../../../../geometry/Polygon".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G){const L=["polyline","polygon","extent"];c=function(M){function K(O,Q,J,P){O=M.call(this,O,Q,J,P)||this;O._uniformSize=1;return O}b._inheritsLoose(K,M);var I=K.prototype;I.doLoad=function(){var O=b._asyncToGenerator(function*(){this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}};this._fastUpdates=
this._context.renderer&&this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?u.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};if(!this._drivenProperties.size){const Q=null!=this.symbolLayer.size?this.symbolLayer.size:w.px2pt(1);if(0>Q)throw new g("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._uniformSize=Q}this._markerTexture=E.prepareMarkerResources(this._context.sharedResources.textures,
this.symbolLayer.marker)});return function(){return O.apply(this,arguments)}}();I._getMaterialParameters=function(O,Q=!1){var J,P=h.applySome(this.symbolLayer.marker,R=>R.color);const N=h.applySome(this.symbolLayer.material,R=>R.color);P=this._getCombinedOpacityAndColor(Q&&P||N);this._patternHidesLine&&!Q&&(P[3]=0);Q=P[3];O={width:this._computeMaterialWidth(null==(J=this.symbolLayer)?void 0:J.size),color:P,polygonOffset:!0,join:this.symbolLayer.join||"miter",cap:x.parseCapType(this.symbolLayer.cap||
"butt"),transparent:1>Q||this.needsDrivenTransparentPass,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:O,stipplePattern:D.getStipplePatternForLinePattern(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?{...O,...this._fastUpdates.materialParameters}:O};I.destroy=function(){M.prototype.destroy.call(this);this._forEachMaterial(O=>this._context.stage.remove(O));this._markerMaterial=this._wireframeRingMaterial=this._wireframeLineMaterial=
this._ringMaterial=this._lineMaterial=null;this._markerTexture=h.releaseMaybe(this._markerTexture)};I._getDrivenSize=function(O){return this._drivenProperties.size&&O.size?w.pt2px(e.getDriverAxisSizeValueAny(O.size)):1};I._getSizeFeatureAttributeData=function(O){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?t.getAttributeValue(this._fastUpdates.visualVariables.size.field,O):null};I._getDrivenColor=function(O){const Q=l.fromValues(1,1,1,1);this._drivenProperties.color&&O.color&&
(Q[0]=O.color[0],Q[1]=O.color[1],Q[2]=O.color[2],0<O.color.length&&(Q[3]=O.color[3]));this._drivenProperties.opacity&&O.opacity&&(Q[3]=O.opacity);return Q};I._getColorFeatureAttributeData=function(O){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?t.getAttributeValue(this._fastUpdates.visualVariables.color.field,O):null};I._getOpacityFeatureAttributeData=function(O){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?t.getAttributeValue(this._fastUpdates.visualVariables.opacity.field,
O):null};I.createGraphics3DGraphic=function(O){const Q=O.graphic;if(!this._validateGeometry(Q.geometry,L,this.symbolLayer.type))return null;const J=this.setGraphicElevationContext(Q,new z.ElevationContext);this.ensureDrapedStatus("on-the-ground"===J.mode);return this.draped?this._createAsOverlay(O,this._context.layer.uid):this._createAs3DShape(O,J,Q.uid)};I.applyRendererDiff=function(O,Q){for(const J in O.diff)switch(J){case "visualVariables":if(u.updateFastSymbolUpdatesState(this._fastUpdates,Q,
this._vvConvertOptions))this._forEachMaterial(P=>P.setParameters(this._fastUpdates.materialParameters));else return r.ApplyRendererDiffResult.Recreate_Symbol;break;default:return r.ApplyRendererDiffResult.Recreate_Symbol}return r.ApplyRendererDiffResult.Fast_Update};I.prepareSymbolLayerPatch=function(O){var Q,J;if("partial"===O.diff.type){var P=O.diff.diff,N={};"complete"===(null==(Q=P.size)?void 0:Q.type)&&(N.width=this._computeMaterialWidth(P.size.newValue),delete P.size);"complete"===(null==(J=
P.cap)?void 0:J.type)&&(N.cap=x.parseCapType(h.unwrapOr(P.cap.newValue,"butt")),delete P.cap);Q=this._prepareMarkerPatch(O,P);this._prepareMaterialPatch(O,P,Q);O.symbolLayerStatePatches.push(()=>this._forEachMaterial(R=>R.setParameters(N)))}};I.layerOpacityChanged=function(){this._forEachMaterial((O,Q)=>this._updateMaterialLayerOpacity(O,Q));return!0};I._forEachMaterial=function(O){h.isSome(this._lineMaterial)&&O(this._lineMaterial);h.isSome(this._ringMaterial)&&O(this._ringMaterial);h.isSome(this._wireframeLineMaterial)&&
O(this._wireframeLineMaterial);h.isSome(this._wireframeRingMaterial)&&O(this._wireframeRingMaterial);h.isSome(this._markerMaterial)&&O(this._markerMaterial,!0)};I._updateMaterialLayerOpacity=function(O,Q=!1){const J=O.parameters.color,P=h.get(this.symbolLayer,"material","color");Q=this._patternHidesLine&&!Q?0:this._getCombinedOpacity(P);O.setParameters({color:[J[0],J[1],J[2],Q],transparent:1>Q||this.needsDrivenTransparentPass})};I.layerElevationInfoChanged=function(O,Q,J){const P=this._elevationContext.mode;
J=m.elevationModeChangeUpdateType(K.elevationModeChangeTypes,J,P);if(J!==m.SymbolUpdateType.UPDATE)return J;const N=m.needsElevationUpdates2D(P);return this.updateGraphics3DGraphicElevationInfo(O,Q,()=>N)};I.slicePlaneEnabledChanged=function(){const O={slicePlaneEnabled:this._context.slicePlaneEnabled};this._forEachMaterial(Q=>Q.setParameters(O));return!0};I.physicalBasedRenderingChanged=function(){return!0};I.pixelRatioChanged=function(){return!0};I._getGeometryAsPolygonOrPolyline=function(O){switch(O.type){case "extent":if(O instanceof
F)return G.fromExtent(O);break;case "polygon":case "polyline":return O}return null};I._createAs3DShape=function(O,Q,J){const P=this._getGeometryAsPolygonOrPolyline(O.graphic.geometry);var N="polygon"===P.type?P.rings:P.paths,R=[];const S=[],T=[],V=k.create(),W=x.geometryToRenderInfo(P,this._context.elevationProvider,this._context.renderCoordsHelper,Q);this._logGeometryCreationWarnings(W,N,"polygon"===P.type?"rings":"paths","LineSymbol3DLayer");for(N=0;N<W.lines.length;N++){const {position:U,mapPosition:aa}=
W.lines[N];if(h.isSome(this._context.clippingExtent)&&(k.empty(V),k.expandWithBuffer(V,aa),!k.intersectsClippingArea(V,this._context.clippingExtent)))continue;const da=this._createGeometry(O,U,aa,P.type,H.ELEVATED);R.push(da);S.push("polygon"===P.type?this.ringMaterial:this.lineMaterial);T.push(n.IDENTITY);y.LINE_WIREFRAMES&&(R.push(da.cloneShallow()),S.push("polygon"===P.type?this.wireframeRingMaterial:this.wireframeLineMaterial),T.push(n.IDENTITY));const Y=this.markerMaterial;h.isSome(Y)&&(R.push(da.cloneShallow()),
S.push(Y),T.push(n.IDENTITY))}if(0===R.length)return null;O=new A.Object3D({geometries:R,materials:S,transformations:T,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:J}});R=new q.Graphics3DObject3DGraphicLayer(this,O,R,null,null,d.sharedGeometryElevationAligner,Q);R.alignedSampledElevation=W.sampledElevation;R.needsElevationUpdates=m.needsElevationUpdates2D(Q.mode);return R};I._createGeometry=function(O,Q,J,P,N){const R=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color;
return x.createGeometry({overlayInfo:N===H.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:"polygon"===P?x.RemoveDuplicateStartEnd.REMOVE:x.RemoveDuplicateStartEnd.KEEP,uniformSize:this._uniformSize,attributeData:{position:Q,mapPosition:J,size:this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?null:this._getDrivenSize(O.renderingInfo),color:R?null:this._getDrivenColor(O.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(O.graphic),
colorFeature:this._getColorFeatureAttributeData(O.graphic),opacityFeature:this._getOpacityFeatureAttributeData(O.graphic)}})};I._createAsOverlay=function(O,Q){const J=O.graphic,P=this._getGeometryAsPolygonOrPolyline(J.geometry);var N="polygon"===P.type?P.rings:P.paths;const R="polygon"===P.type?this.ringMaterial:this.lineMaterial;R.renderPriority=this._renderPriority;const S=y.LINE_WIREFRAMES?"polygon"===P.type?this.wireframeRingMaterial:this.wireframeLineMaterial:null,T=this.markerMaterial;h.isSome(S)&&
(S.renderPriority=this._renderPriority-.001);h.isSome(T)&&(T.renderPriority=this._renderPriority-.002);const V=[],W=k.create(),U=k.empty();var aa=x.geometryToRenderInfoDraped(P,this._context.overlaySR);this._logGeometryCreationWarnings(aa,N,"polygon"===P.type?"rings":"paths","LineSymbol3DLayer");for(const da of aa.lines){k.empty(W);k.expandWithBuffer(W,da.position);if(!k.intersectsClippingArea(W,this._context.clippingExtent))continue;k.expandWithAABB(U,W);const Y=this._createGeometry(O,da.position,
null,P.type,H.DRAPED);N=ea=>{ea=new p.RenderGeometry(Y,ea,{layerUid:Q,graphicUid:J.uid});V.push(ea);return ea};if(h.isSome(T)){aa=N(T);const ea=h.unwrap(this.symbolLayer.marker).placement;"begin"!==ea&&"begin-end"!==ea||k.expandWithBuffer(W,da.position,0,1);"end"!==ea&&"begin-end"!==ea||k.expandWithBuffer(W,da.position,da.position.length-3,1);this._updateBoundingSphere(aa,W)}aa=N(R);this._updateBoundingSphere(aa,W);y.LINE_WIREFRAMES&&(N=N(S),this._updateBoundingSphere(N,W))}return new v(this,V,U)};
I._updateBoundingSphere=function(O,Q){f.set(O.boundingSphere,.5*(Q[0]+Q[3]),.5*(Q[1]+Q[4]),0,.5*Math.sqrt((Q[3]-Q[0])*(Q[3]-Q[0])+(Q[4]-Q[1])*(Q[4]-Q[1])))};I._computeMaterialWidth=function(O){O=h.unwrapOr(O,w.px2pt(1));return this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?w.pt2px(1):1:w.pt2px(O)};I._prepareMaterialPatch=function(O,Q,J){var P=Q.material;h.isNone(P)||"collection"===P.type||(P="complete"===P.type?h.applySome(P.newValue,N=>N.color):"complete"===
P.diff.color.type?P.diff.color.newValue:null,P=this._getCombinedOpacityAndColor(P),J&&this._patchMaterialColor(l.clone(P),this._markerMaterial,O),this._patternHidesLine&&(P[3]=0),this._patchMaterialColor(P,this._lineMaterial,O),delete Q.material)};I._prepareMarkerPatch=function(O,Q){var J=Q.marker;if(h.isNone(J)||"partial"!==J.type||h.isSome(J.diff.style)||h.isSome(J.diff.placement)||h.isSome(J.diff.color)&&"complete"!==J.diff.color.type)return!1;J=J.diff.color;if(h.isNone(J))return delete Q.marker,
h.isNone(this.symbolLayer)||h.isNone(this.symbolLayer.marker)||h.isNone(this.symbolLayer.marker.color);J=h.unwrap(J.newValue);if(h.isNone(J))return delete Q.marker,!0;this._patchMaterialColor(this._getCombinedOpacityAndColor(J),this._markerMaterial,O);delete Q.marker;return!1};I._patchMaterialColor=function(O,Q,J){if(!h.isNone(Q)){var P=O[3];J.symbolLayerStatePatches.push(()=>Q.setParameters({color:O,transparent:1>P||this.needsDrivenTransparentPass}))}};b._createClass(K,[{key:"lineMaterial",get:function(){h.isNone(this._lineMaterial)&&
(this._lineMaterial=new C.RibbonLineMaterial(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterial));return this._lineMaterial}},{key:"ringMaterial",get:function(){h.isNone(this._ringMaterial)&&(this._ringMaterial=new C.RibbonLineMaterial(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterial));return this._ringMaterial}},{key:"wireframeLineMaterial",get:function(){h.isNone(this._wireframeLineMaterial)&&(this._wireframeLineMaterial=new C.RibbonLineMaterial({...this._getMaterialParameters(!1),
wireframe:!0}),this._context.stage.add(this._wireframeLineMaterial));return this._wireframeLineMaterial}},{key:"wireframeRingMaterial",get:function(){h.isNone(this._wireframeRingMaterial)&&(this._wireframeRingMaterial=new C.RibbonLineMaterial({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterial));return this._wireframeRingMaterial}},{key:"markerMaterial",get:function(){h.isNone(this._markerMaterial)&&h.isSome(this.symbolLayer.marker)&&h.isSome(this._markerTexture)&&
(this._markerMaterial=new B.LineMarkerMaterial({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id}),this._context.stage.add(this._markerMaterial));return this._markerMaterial}},{key:"_patternHidesLine",get:function(){const O=this.symbolLayer.pattern;return h.isSome(O)&&"style"===O.type&&"none"===O.style}}]);return K}(t.Graphics3DSymbolLayer);c.elevationModeChangeTypes={definedChanged:m.SymbolUpdateType.RECREATE,staysOnTheGround:m.SymbolUpdateType.NONE,
onTheGroundChanged:m.SymbolUpdateType.RECREATE};var H;(function(M){M[M.DRAPED=0]="DRAPED";M[M.ELEVATED=1]="ELEVATED"})(H||(H={}));a.Graphics3DLineSymbolLayer=c;a.default=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/lineUtils":function(){define("exports ../../../../core/has ../../../../core/maybe ../../../../core/typedArrayUtil ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/support/triangulationUtils ../../../ViewingMode ./constants ./elevationAlignmentUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute ../../../../chunks/RibbonLine.glsl".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r){function x(y,A,p){const B=[];for(const {index:D,count:C}of y){if(1>=C)continue;y=3*D;const F=y+3*C;B.push({position:A.subarray(y,F),mapPosition:p?p.subarray(y,F):void 0})}return B}a.RemoveDuplicateStartEnd=void 0;(function(y){y[y.KEEP=0]="KEEP";y[y.REMOVE=1]="REMOVE"})(a.RemoveDuplicateStartEnd||(a.RemoveDuplicateStartEnd={}));const u=n.create(),E=n.create();a.createGeometry=function(y){const A=[],p=[];{const {attributeData:{position:H},removeDuplicateStartEnd:M}=
y;var B=H.length;B=(B=H[0]===H[B-3]&&H[1]===H[B-2]&&H[2]===H[B-1])&&M===a.RemoveDuplicateStartEnd.REMOVE;var D=H.length/3-(B?1:0),C=new Uint32Array(2*(D-1)),F=B?g.slice(H,0,H.length-3):H,G=0;for(var L=0;L<D-1;L++)C[G++]=L,C[G++]=L+1;p.push([t.VertexAttribute.POSITION,{size:3,data:F,exclusive:B}]);A.push([t.VertexAttribute.POSITION,C])}D=p[0][1].data;B=new Uint16Array(A[0][1].length);C=y.attributeData.mapPosition;c.isNone(C)||(A.push([t.VertexAttribute.MAPPOS,A[0][1]]),p.push([t.VertexAttribute.MAPPOS,
{size:3,data:C}]));c.isSome(y.attributeData.colorFeature)||(p.push([t.VertexAttribute.COLOR,{size:4,data:c.unwrapOr(y.attributeData.color,d.WHITE_UNIT)}]),A.push([t.VertexAttribute.COLOR,B]));c.isSome(y.attributeData.sizeFeature)||(p.push([t.VertexAttribute.SIZE,{size:1,data:[c.unwrapOr(y.attributeData.size,1)]}]),A.push([t.VertexAttribute.SIZE,B]));C=y.attributeData.colorFeature;c.isNone(C)||(p.push([t.VertexAttribute.COLORFEATUREATTRIBUTE,{size:1,data:new Float32Array([C])}]),A.push([t.VertexAttribute.COLOR,
B]));C=y.attributeData.sizeFeature;c.isNone(C)||(p.push([t.VertexAttribute.SIZEFEATUREATTRIBUTE,{size:1,data:new Float32Array([C])}]),A.push([t.VertexAttribute.SIZEFEATUREATTRIBUTE,B]));C=y.attributeData.opacityFeature;c.isNone(C)||(p.push([t.VertexAttribute.OPACITYFEATUREATTRIBUTE,{size:1,data:new Float32Array([C])}]),A.push([t.VertexAttribute.OPACITYFEATUREATTRIBUTE,B]));if(!c.isNone(y.overlayInfo)&&y.overlayInfo.renderCoordsHelper.viewingMode===e.ViewingMode.Global&&y.overlayInfo.spatialReference.isGeographic){B=
new Float64Array(D.length);y=l.getReferenceEllipsoid(y.overlayInfo.spatialReference);for(C=0;C<B.length;C+=3)f.lonLatToWebMercatorComparable(D,C,B,C,y);y=D.length/3;D=new Float32Array(y+1);C=u;F=E;L=G=0;w.set(C,B[L++],B[L++],B[L++]);D[0]=0;for(let H=1;H<y+1;++H)H===y&&(L=0),w.set(F,B[L++],B[L++],B[L++]),G+=h.dist(C,F),D[H]=G,[C,F]=[F,C];p.push([t.VertexAttribute.DISTANCETOSTART,{size:1,data:D}]);A.push([t.VertexAttribute.DISTANCETOSTART,A[0][1]])}return new q.Geometry(p,A,v.PrimitiveType.Line)};a.geometryToRenderInfo=
function(y,A,p,B){const {position:D,outlines:C}=k.pathsToTriangulationInfo("polygon"===y.type?y.rings:y.paths,y.hasZ,"polygon"===y.type?k.CounterClockwiseMode.CCW_IS_HOLE:k.CounterClockwiseMode.NONE),F=new Float64Array(D.length);y=m.applyPerVertexElevationAlignment(D,y.spatialReference,0,F,0,D,0,D.length/3,A,p,B);A=null!=y;return{lines:A?x(C,D,F):[],projectionSuccess:A,sampledElevation:y}};a.geometryToRenderInfoDraped=function(y,A){const {position:p,outlines:B}=k.pathsToTriangulationInfo("polygon"===
y.type?y.rings:y.paths,!1,"polygon"===y.type?k.CounterClockwiseMode.CCW_IS_HOLE:k.CounterClockwiseMode.NONE);y=f.projectBuffer(p,y.spatialReference,0,p,A,0,p.length/3);for(A=2;A<p.length;A+=3)p[A]=z.DRAPED_Z;return{lines:y?x(B,p):[],projectionSuccess:y}};a.parseCapType=function(y){switch(y){case "butt":return r.CapType.BUTT;case "square":return r.CapType.SQUARE;case "round":return r.CapType.ROUND;default:return null}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/markerUtils":function(){define(["exports",
"../../../../core/maybe","../graphics/sdfPrimitives"],function(a,b,c){function g(w,n){return w.fromData(n,()=>c.createTexture(n,64,32,6.4))}function h(w){return"diamond"===w?"kite":w}a.MARKER_SYMBOL_SIZE=32;a.MARKER_TEXTURE_SIZE=64;a.MARKER_THICKNESS=6.4;a.parseLineMarkerStyle=h;a.prepareMarkerResources=function(w,n){return b.isSome(n)?g(w,h(n.style)):null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/LineMarkerMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../lib/GLMaterials ../lib/GLMaterialTexture ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./VisualVariableMaterialParameters ../shaders/LineMarkerTechnique".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m){let z=function(u){function E(A){A=u.call(this,A,q)||this;A._vertexAttributeLocations=m.markerVertexAttributeLocations;A.techniqueConfig=new m.LineMarkerTechniqueConfiguration;A.layout=A.createLayout();return A}b._inheritsLoose(E,u);var y=E.prototype;y.dispose=function(){};y.getTechniqueConfig=function(A,p){this.techniqueConfig.output=A;this.techniqueConfig.draped=p.slot===k.RenderSlot.DRAPED_MATERIAL;this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled;
this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees;this.techniqueConfig.transparent=this.parameters.transparent;this.techniqueConfig.writeDepth=this.parameters.writeDepth;this.techniqueConfig.vvColor=this.parameters.vvColorEnabled;this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled;this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled;this.techniqueConfig.occluder=this.parameters.renderOccluded===l.RenderOccludedFlag.OccludeAndTransparentStencil;this.techniqueConfig.transparencyPassType=
p.transparencyPassType;this.techniqueConfig.multipassTerrainEnabled=p.multipassTerrainEnabled;this.techniqueConfig.cullAboveGround=p.cullAboveGround;return this.techniqueConfig};y.intersect=function(){};y.createLayout=function(){const A=h.newLayout().vec3f(e.VertexAttribute.POSITION).vec2f(e.VertexAttribute.UV0).vec3f(e.VertexAttribute.AUXPOS1);this.parameters.vvSizeEnabled?A.f32(e.VertexAttribute.SIZEFEATUREATTRIBUTE):A.f32(e.VertexAttribute.SIZE);this.parameters.vvColorEnabled?A.f32(e.VertexAttribute.COLORFEATUREATTRIBUTE):
A.vec4f(e.VertexAttribute.COLOR);this.parameters.vvOpacityEnabled&&A.f32(e.VertexAttribute.OPACITYFEATUREATTRIBUTE);return A};y.createBufferWriter=function(){return new t(this.layout,this.parameters)};y.requiresSlot=function(A,p){if(A===k.RenderSlot.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===l.RenderOccludedFlag.OccludeAndTransparentStencil)return A===k.RenderSlot.OPAQUE_MATERIAL||A===k.RenderSlot.OCCLUDER_MATERIAL||A===k.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL;p=n.outputFromPass(p);
return p===w.ShaderOutput.Color||p===w.ShaderOutput.Alpha?A===(this.parameters.writeDepth?k.RenderSlot.TRANSPARENT_MATERIAL:k.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):A===k.RenderSlot.OPAQUE_MATERIAL};y.createGLMaterial=function(A){return A.output===w.ShaderOutput.Color||A.output===w.ShaderOutput.Alpha||A.output===w.ShaderOutput.Highlight||A.output===w.ShaderOutput.Depth?new v(A):null};y.validateParameters=function(A){A.color&&1>A.color[3]&&(A.transparent=!0)};return E}(l.Material),v=
function(u){function E(A){return u.call(this,{...A,...A.material.parameters})||this}b._inheritsLoose(E,u);var y=E.prototype;y.updateParameters=function(A){this.updateTexture(this._material.parameters.textureId);return this.ensureTechnique(m.LineMarkerTechnique,A)};y._updateOccludeeState=function(A){A.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:A.hasOccludees})};y.beginSlot=function(A){this._output!==w.ShaderOutput.Color&&this._output!==
w.ShaderOutput.Alpha||this._updateOccludeeState(A);return this.updateParameters(A)};y.bind=function(A,p){this.bindTextures(p.program);this.bindTextureScale(p.program);p.bindPass(this._material.parameters,A)};return E}(f);const q={width:0,color:[1,1,1,1],placement:"end",textureId:null,writeDepth:!0,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,sceneHasOcludees:!1,...l.DefaultMaterialParameters,...d.VisualVariableDefaultMaterialParameters};let t=function(){function u(y,A){this.vertexBufferLayout=
y;this.parameters=A}var E=u.prototype;E.allocate=function(y){return this.vertexBufferLayout.createBuffer(y)};E.elementCount=function(){return"begin-end"===this.parameters.placement?12:6};E.write=function(y,A,p,B){const D=A.vertexAttributes.get(e.VertexAttribute.POSITION).data,C=D.length/3;let F=1,G=0;this.parameters.vvSizeEnabled?G=A.vertexAttributes.get(e.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0]:A.vertexAttributes.has(e.VertexAttribute.SIZE)&&(F=A.vertexAttributes.get(e.VertexAttribute.SIZE).data[0]);
let L=[1,1,1,1],H=0;this.parameters.vvColorEnabled?H=A.vertexAttributes.get(e.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:A.vertexAttributes.has(e.VertexAttribute.COLOR)&&(L=A.vertexAttributes.get(e.VertexAttribute.COLOR).data);let M=0;this.parameters.vvOpacityEnabled&&(M=A.vertexAttributes.get(e.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]);const K=y.transformation,I=new Float32Array(p.buffer);let O=this.vertexBufferLayout.stride/4*B;const Q=(P,N,R,S)=>{I[O++]=P[0];I[O++]=P[1];I[O++]=P[2];
I[O++]=R[0];I[O++]=R[1];I[O++]=N[0];I[O++]=N[1];I[O++]=N[2];this.parameters.vvSizeEnabled?I[O++]=G:I[O++]=F;this.parameters.vvColorEnabled?I[O++]=H:(P=Math.min(4*S,L.length-4),I[O++]=L[P+0],I[O++]=L[P+1],I[O++]=L[P+2],I[O++]=L[P+3]);this.parameters.vvOpacityEnabled&&(I[O++]=M)};let J;(function(P){P[P.ASCENDING=1]="ASCENDING";P[P.DESCENDING=-1]="DESCENDING"})(J||(J={}));y=(P,N)=>{const R=c.set(r,D[3*P],D[3*P+1],D[3*P+2]),S=x;let T=P+N;do c.set(S,D[3*T],D[3*T+1],D[3*T+2]),T+=N;while(c.equals(R,S)&&
0<=T&&T<C);K&&(c.transformMat4(R,R,K),c.transformMat4(S,S,K));Q(R,S,[-1,-1],P);Q(R,S,[1,-1],P);Q(R,S,[1,1],P);Q(R,S,[-1,-1],P);Q(R,S,[1,1],P);Q(R,S,[-1,1],P)};A=this.parameters.placement;"begin"!==A&&"begin-end"!==A||y(0,J.ASCENDING);"end"!==A&&"begin-end"!==A||y(C-1,J.DESCENDING)};return u}();const r=g.create(),x=g.create();a.LineMarkerMaterial=z;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/LineMarkerTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../chunks/mat4 ../../../../geometry/support/vectorStacks ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/OrderIndependentTransparency ../lib/Program ../lib/RenderSlot ../lib/StencilUtils ../lib/VertexAttribute ../../../../chunks/LineMarker.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A){const p=new Map([[E.VertexAttribute.POSITION,0],[E.VertexAttribute.UV0,2],[E.VertexAttribute.AUXPOS1,3],[E.VertexAttribute.SIZE,6],[E.VertexAttribute.SIZEFEATUREATTRIBUTE,6],[E.VertexAttribute.COLOR,5],[E.VertexAttribute.COLORFEATUREATTRIBUTE,5],[E.VertexAttribute.OPACITYFEATUREATTRIBUTE,7]]);z=function(B){function D(F,G,L){return B.call(this,F,G,L)||this}c._inheritsLoose(D,B);var C=D.prototype;C.initializeProgram=function(F){var G=D.shader.get();
const L=this.configuration;G=G.build({oitEnabled:L.transparencyPassType===q.TransparencyPassType.Color,output:L.output,slicePlaneEnabled:L.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,draped:L.draped,vvColor:L.vvColor,vvSize:L.vvSize,vvInstancingEnabled:!0,vvOpacity:L.vvOpacity,multipassTerrainEnabled:L.multipassTerrainEnabled,cullAboveGround:L.cullAboveGround});return new r.Program(F.rctx,G,p)};C.bindPass=function(F,G){d.bindProjectionMatrix(this.program,G.camera.projectionMatrix);
this.configuration.output===n.ShaderOutput.Highlight&&l.bindOutputHighlight(this.program,G);G.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",G.inverseViewport),k.bindMultipassTerrainTexture(this.program,G));this.program.setUniform1f("intrinsicWidth",F.width);this.program.setUniform4fv("intrinsicColor",F.color);this.program.setUniform2fv("nearFar",G.camera.nearFar);this.program.setUniform1f("pixelRatio",G.camera.pixelRatio);this.program.setUniform2f("screenSize",G.camera.fullViewport[2],
G.camera.fullViewport[3]);e.bindVisualVariablesUniformsWithOpacity(this.program,F)};C.bindDraw=function(F){d.bindView(this.program,F);f.bindSliceUniforms(this.program,this.configuration,F.slicePlane,{origin:F.origin,view:F.camera.viewMatrix});this.program.setUniformMatrix4fv("inverseProjectionMatrix",h.invert(w.sm4d.get(),F.camera.projectionMatrix));this.program.rebindTextures()};C._makePipelineState=function(F,G){const L=this.configuration,H=F===q.TransparencyPassType.NONE;return A.makePipelineState({blending:L.output===
n.ShaderOutput.Color||L.output===n.ShaderOutput.Alpha?H?t.blendingDefault:t.oitBlending(F):null,depthTest:{func:t.oitDepthTest(F)},depthWrite:H?L.writeDepth&&A.defaultDepthWriteParams:t.oitDepthWrite(F),colorWrite:A.defaultColorWriteParams,stencilWrite:L.sceneHasOcludees?u.stencilWriteMaskOn:null,stencilTest:L.sceneHasOcludees?G?u.stencilToolMaskBaseParams:u.stencilBaseAllZerosParams:null,polygonOffset:{factor:0,units:-10}})};C.initializePipeline=function(){this.configuration.occluder&&(this._occluderPipelineTransparent=
A.makePipelineState({blending:t.blendingDefault,depthTest:u.depthCompareAlways,depthWrite:null,colorWrite:A.defaultColorWriteParams,stencilWrite:null,stencilTest:u.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=A.makePipelineState({blending:t.blendingDefault,depthTest:u.depthCompareAlways,depthWrite:null,colorWrite:A.defaultColorWriteParams,stencilWrite:u.stencilWriteMaskOff,stencilTest:u.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=A.makePipelineState({blending:null,
depthTest:u.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:u.stencilWriteMaskOn,stencilTest:u.stencilToolMaskBaseParams}));this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0);return this._makePipelineState(this.configuration.transparencyPassType,!1)};C.getPipelineState=function(F,G){return G?this._occludeePipelineState:this.configuration.occluder?F===x.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:F===x.RenderSlot.OCCLUDER_MATERIAL?
this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:B.prototype.getPipelineState.call(this,F,G)};return D}(z.ShaderTechnique);z.shader=new m.ReloadableShaderModule(y.LineMarkerShader,()=>new Promise((B,D)=>a(["./LineMarker.glsl"],B,D)));m=function(B){function D(){var C=B.apply(this,arguments)||this;C.output=n.ShaderOutput.Color;C.occluder=!1;C.slicePlaneEnabled=!1;C.transparent=!1;C.writeDepth=!1;C.draped=!1;C.vvSize=!1;C.vvColor=!1;C.vvOpacity=!1;C.sceneHasOcludees=!1;C.transparencyPassType=
q.TransparencyPassType.NONE;C.multipassTerrainEnabled=!1;C.cullAboveGround=!1;return C}c._inheritsLoose(D,B);return D}(v.ShaderTechniqueConfiguration);g.__decorate([v.parameter({count:n.ShaderOutput.COUNT})],m.prototype,"output",void 0);g.__decorate([v.parameter()],m.prototype,"occluder",void 0);g.__decorate([v.parameter()],m.prototype,"slicePlaneEnabled",void 0);g.__decorate([v.parameter()],m.prototype,"transparent",void 0);g.__decorate([v.parameter()],m.prototype,"writeDepth",void 0);g.__decorate([v.parameter()],
m.prototype,"draped",void 0);g.__decorate([v.parameter()],m.prototype,"vvSize",void 0);g.__decorate([v.parameter()],m.prototype,"vvColor",void 0);g.__decorate([v.parameter()],m.prototype,"vvOpacity",void 0);g.__decorate([v.parameter()],m.prototype,"sceneHasOcludees",void 0);g.__decorate([v.parameter({count:q.TransparencyPassType.COUNT})],m.prototype,"transparencyPassType",void 0);g.__decorate([v.parameter()],m.prototype,"multipassTerrainEnabled",void 0);g.__decorate([v.parameter()],m.prototype,"cullAboveGround",
void 0);b.LineMarkerTechnique=z;b.LineMarkerTechniqueConfiguration=m;b.markerVertexAttributeLocations=p;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/LineMarker.glsl":function(){define("exports ../views/3d/layers/support/markerUtils ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z){function v(t){const r=new m.ShaderBuilder;r.include(h.RibbonVertexPosition,t);t.output===c.ShaderOutput.Depth&&r.include(w.OutputDepth,t);r.fragment.include(e.RgbaFloatEncoding);r.vertex.uniforms.add("proj","mat4").add("view","mat4").add("nearFar","vec2").add("pixelRatio","float").add("screenSize","vec2").add("inverseProjectionMatrix","mat4");r.fragment.uniforms.add("tex","sampler2D");r.attributes.add(z.VertexAttribute.POSITION,"vec3");r.attributes.add(z.VertexAttribute.UV0,
"vec2");r.attributes.add(z.VertexAttribute.AUXPOS1,"vec3");r.varyings.add("vColor","vec4");r.varyings.add("vpos","vec3");r.varyings.add("vUV","vec2");r.varyings.add("vSize","float");r.varyings.add("linearDepth","float");t.multipassTerrainEnabled&&r.varyings.add("depth","float");r.vertex.code.add(d.glsl`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}`);r.vertex.code.add(d.glsl`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= screenSize / posNdc.w;
return posNdc;
}`);r.vertex.code.add(d.glsl`
    void clipAndTransform(inout vec4 pos, inout vec4 prev) {
      float vnp = nearFar[0] * 0.99;

      if (prev.z > -nearFar[0]) {
        //previous behind ncp
        prev = mix(pos, prev, interp(vnp, pos, prev));
      }

      ${t.multipassTerrainEnabled?"depth \x3d pos.z;":""}
      linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

      pos = projectAndScale(pos);
      prev = projectAndScale(prev);
    }
  `);r.vertex.code.add(d.glsl`
    void main(void) {
      float coverage = 1.0;

      // Check for special value of uv0.y which is used by the Renderer when graphics
      // are removed before the VBO is recompacted. If this is the case, then we just
      // project outside of clip space.
      if (uv0.y == 0.0) {
        // Project out of clip space
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
      }
      else {
        float lineSize = getSize();
        float lineWidth = max(lineSize, 1.0) * pixelRatio;

        vec4 pos  = view * vec4(position.xyz, 1.0);
        vec4 prev = view * vec4(auxpos1.xyz, 1.0);
        clipAndTransform(pos, prev);

        // normalize vector along line segment
        vec2 segment = pos.xy - prev.xy;
        float segmentLen = length(segment);
        segment = (segmentLen > 0.001) ? segment / segmentLen : vec2(0.0, 0.0);

        // displace according to position in the texture
        vec2 displacementDirU = uv0.x * PERPENDICULAR(segment);
        vec2 displacementDirV = uv0.y * segment;

        vSize = ${d.glsl.float(b.MARKER_TEXTURE_SIZE/b.MARKER_THICKNESS)} * lineWidth;
        pos.xy += displacementDirU * vSize + displacementDirV * vSize;

        // Convert back into NDC
        pos.xy = (pos.xy / screenSize) * pos.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        vColor = getColor();
        vColor.a *= coverage;

        // transform final position to camera space for slicing
        vpos = (inverseProjectionMatrix * pos).xyz;
        gl_Position = pos;
      }
    }
  `);t.multipassTerrainEnabled&&(r.fragment.include(n.ReadLinearDepth),r.include(f.multipassTerrainTest,t));r.include(g.Slice,t);r.fragment.uniforms.add("intrinsicColor","vec4");r.fragment.include(k.ColorConversion);r.fragment.code.add(d.glsl`
  void main() {
    discardBySlice(vpos);
    ${t.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    // Offset texture coordinate s.t. we sample texel centers
    float texelSize = ${d.glsl.float(1/b.MARKER_TEXTURE_SIZE)};
    vec2 samplePos = vUV + vec2(0.5, -0.5) * texelSize;

    // Evaluate sdf
    float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
    float distance = sdf * vSize;

    // Grow by a halfpixel to make sure the line is fully covered by the cross marker
    // (otherwise there will be a halo if they are different colours)
    distance -= 0.5;

    finalColor.a *= clamp(0.5 - distance, 0.0, 1.0);

    if (finalColor.a < ${d.glsl.float(l.symbolAlphaCutoff)}) {
      discard;
    }

    ${t.output===c.ShaderOutput.Alpha?d.glsl`gl_FragColor = vec4(finalColor.a);`:""}
    ${t.output===c.ShaderOutput.Color?d.glsl`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===c.ShaderOutput.Color&&t.oitEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
    ${t.output===c.ShaderOutput.Highlight?d.glsl`gl_FragColor = vec4(1.0);`:""}
    ${t.output===c.ShaderOutput.Depth?d.glsl`outputDepth(linearDepth);`:""}
  }
  `);return r}const q=Object.freeze({__proto__:null,build:v});a.LineMarkerShader=q;a.build=v})},"esri/views/3d/webgl-engine/materials/lineStippleUtils":function(){define(["exports","../../../../core/maybe"],function(a,b){function c(n,f=2){return b.isNone(n)?n:{pattern:n.slice(),pixelRatio:f}}function g(n){return b.isSome(n)?c(w[n],8):null}const h={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},w={dash:h.dash,"dash-dot":[...h.dash,...h.dot],dot:h.dot,"long-dash":h["long-dash"],
"long-dash-dot":[...h["long-dash"],...h.dot],"long-dash-dot-dot":[...h["long-dash"],...h.dot,...h.dot],none:null,"short-dash":h["short-dash"],"short-dash-dot":[...h["short-dash"],...h["short-dot"]],"short-dash-dot-dot":[...h["short-dash"],...h["short-dot"],...h["short-dot"]],"short-dot":h["short-dot"],solid:null};a.createStipplePattern=c;a.createStipplePatternSimple=function(n,f=2){return{pattern:[n,n],pixelRatio:f}};a.getStipplePatternForLinePattern=function(n){return b.isSome(n)&&"style"===n.type?
g(n.style):null};a.getStipplePatternForPatternStyle=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/has ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/MeshComponent ../../../../geometry/support/MeshMaterialMetallicRoughness ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec32 ../../../../geometry/support/meshUtils/projection ../../../../layers/graphics/dehydratedFeatures ../../../ViewingMode ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ../support/edgeUtils ../support/symbolColorUtils ../../support/debugFlags ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/geometryDataUtils ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/NativeLineMaterial ../../../webgl/enums".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H,M,K,I,O,Q,J,P){const N=["mesh"];g=function(ja){function la(ca,fa,ba,Z){ca=ja.call(this,ca,fa,ba,Z)||this;ca._materials=new Map;ca._textures=new Map;ca.ensureDrapedStatus(!1);return ca}b._inheritsLoose(la,ja);var ia=la.prototype;ia.doLoad=function(){var ca=b._asyncToGenerator(function*(){G.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new J.NativeLineMaterial({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new J.NativeLineMaterial({color:[0,
1,1,1]}))});return function(){return ca.apply(this,arguments)}}();ia.destroy=function(){ja.prototype.destroy.call(this);this._context.stage.removeMany(Array.from(this._materials.values(),ca=>ca.material));this._context.stage.removeMany(Array.from(this._textures.values()));this._materials.clear();this._textures.clear()};ia.createGraphics3DGraphic=function(ca){const fa=ca.graphic;if(!this._validateGeometry(fa.geometry,N,"fill on mesh-3d"))return null;const ba=this.setGraphicElevationContext(fa,new p.ElevationContext);
return this._createAs3DShape(fa,ca.renderingInfo,ba,fa.uid)};ia.layerOpacityChanged=function(ca,fa){const ba=this._getLayerOpacity();this._materials.forEach(Z=>{Z.material.setParameters({layerOpacity:ba});const ha=Z.material.parameters;this._setMaterialTransparentParameter(ha,Z);Z.material.setParameters({transparent:ha.transparent})});ca.forEach(Z=>{Z=fa(Z);h.isSome(Z)&&Z.layerOpacityChanged(ba,this._context.isAsync)});return!0};ia.layerElevationInfoChanged=function(ca,fa){return this.updateGraphics3DGraphicElevationInfo(ca,
fa,A.needsElevationUpdates3D)};ia.slicePlaneEnabledChanged=function(ca,fa){this._materials.forEach(ba=>{ba.material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled})});ca.forEach(ba=>{ba=fa(ba);h.isSome(ba)&&ba.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)});return!0};ia.physicalBasedRenderingChanged=function(){const ca=this._usePBR();this._materials.forEach(fa=>fa.material.setParameters({usePBR:ca}));return!0};ia.pixelRatioChanged=function(){return!0};
ia._requiresSymbolVertexColors=function(){return this._drivenProperties.color||this._drivenProperties.opacity};ia._colorOrTextureUid=function(ca){return h.isNone(ca)?"-":ca instanceof c?ca.toHex():ca.contentHash};ia._materialPropertiesDefault=function(ca,fa){const ba=this._requiresSymbolVertexColors(),Z=!!ca.vertexAttributes.color;ca=!!ca.vertexAttributes.tangent;return{hasSymbolVertexColors:ba,hasVertexColors:Z,hasVertexTangents:ca,uid:`vc:${Z},vt:${ca},vct${fa},svc:${ba}`}};ia._materialProperties=
function(ca,fa,ba){ca=this._materialPropertiesDefault(ca,ba);if(!fa.material)return ca;const {color:Z,colorTexture:ha,normalTexture:na,doubleSided:pa,alphaCutoff:xa,alphaMode:Da}=fa.material;ba=this._colorOrTextureUid(Z);var ua=this._colorOrTextureUid(ha),Fa=this._colorOrTextureUid(na);ca.color=Z;ca.colorTexture=ha;ca.normalTexture=na;ca.uid=`${ca.uid},cmuid:${ba},ctmuid:${ua},ntmuid:${Fa},ds:${pa},ac:${xa},am:${Da}`;if(fa.material instanceof q){const {metallic:qa,roughness:sa,metallicRoughnessTexture:ma,
emissiveColor:ra,emissiveTexture:va,occlusionTexture:Ia}=fa.material;fa=this._colorOrTextureUid(ma);ba=this._colorOrTextureUid(ra);ua=this._colorOrTextureUid(va);Fa=this._colorOrTextureUid(Ia);ca.metallic=qa;ca.roughness=sa;ca.metallicRoughnessTexture=ma;ca.emissiveColor=ra;ca.emissiveTexture=va;ca.occlusionTexture=Ia;ca.uid=`${ca.uid},mrm:${qa},mrr:${sa},mrt:${fa},emuid:${ba},etmuid:${ua},otmuid:${Fa}`}return ca};ia._setInternalColorValueParameters=function(ca,fa){fa.diffuse=c.toUnitRGB(ca);fa.opacity=
ca.a};ia._getLoadableTextureResource=function(ca){return ca.data?ca.data:ca.url};ia._getInternalTextureId=function(ca){ca=this._getInternalTexture(ca,L.AlphaDiscardMode.Opaque);return h.isSome(ca)?ca.id:null};ia._getInternalTexture=function(ca,fa){const ba=this._getLoadableTextureResource(ca);if(!ba)return null;const Z=`${ca.contentHash}/${fa}`;let ha=this._textures.get(Z);ha||(ha=new I.Texture(ba,{mipmap:!0,wrap:this._castTextureWrap(ca.wrap),noUnpackFlip:!0,preMultiplyAlpha:fa!==L.AlphaDiscardMode.Opaque}),
this._textures.set(Z,ha),this._context.stage.add(ha),this._context.stage.loadImmediate(ha));return ha};ia._castTextureWrap=function(ca="repeat"){return"string"===typeof ca?(ca=this._castTextureWrapIndividual(ca),{s:ca,t:ca}):{s:this._castTextureWrapIndividual(ca.horizontal),t:this._castTextureWrapIndividual(ca.vertical)}};ia._castTextureWrapIndividual=function(ca){switch(ca){case "clamp":return P.TextureWrapMode.CLAMP_TO_EDGE;case "mirror":return P.TextureWrapMode.MIRRORED_REPEAT;default:return P.TextureWrapMode.REPEAT}};
ia._setInternalMaterialParameters=function(ca,fa){h.isSome(ca.color)&&this._setInternalColorValueParameters(ca.color,fa);if(h.isSome(ca.colorTexture)){const ba=this._getInternalTexture(ca.colorTexture,fa.textureAlphaMode);h.isSome(ba)?(fa.textureId=ba.id,fa.textureAlphaPremultiplied=!!ba.params.preMultiplyAlpha):fa.textureId=void 0}h.isSome(ca.normalTexture)&&(fa.normalTextureId=this._getInternalTextureId(ca.normalTexture));h.isSome(ca.emissiveColor)&&(fa.emissiveFactor=c.toUnitRGB(ca.emissiveColor));
h.isSome(ca.emissiveTexture)&&(fa.emissiveTextureId=this._getInternalTextureId(ca.emissiveTexture));h.isSome(ca.occlusionTexture)&&(fa.occlusionTextureId=this._getInternalTextureId(ca.occlusionTexture));h.isSome(ca.metallicRoughnessTexture)&&(fa.metallicRoughnessTextureId=this._getInternalTextureId(ca.metallicRoughnessTexture))};ia._setExternalMaterialParameters=function(ca){var fa=this._drivenProperties.color;let ba=h.isSome(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;
fa?ca.externalColor=d.ONES:(fa=h.isSome(this.symbolLayer.material)?this.symbolLayer.material.color:null,h.isSome(fa)?ca.externalColor=c.toUnitRGBA(fa):(ba=null,ca.externalColor=d.ONES));ba&&(ca.colorMixMode=ba);ca.castShadows=!!this.symbolLayer.castShadows};ia._hasTransparentVertexColors=function(ca){ca=ca.vertexAttributes.color;if(h.isNone(ca))return!1;for(let fa=3;fa<ca.length;fa+=4)if(255!==ca[fa])return!0;return!1};ia._getOrCreateMaterial=function(ca,fa){var ba,Z,ha,na=null==(ba=fa.material)?
void 0:ba.color;ba=null==(Z=fa.material)?void 0:Z.colorTexture;Z=null==(ha=fa.material)?void 0:ha.alphaMode;ha="blend"===Z;na="opaque"!==Z&&(this._hasTransparentVertexColors(ca)||h.isSome(na)&&1>na.a||h.isSome(ba)&&ba.transparent||ha);ca=this._materialProperties(ca,fa,na);if(ha=this._materials.get(ca.uid))return ha.material;na={material:null,isComponentTransparent:na,alphaMode:fa.material?fa.material.alphaMode:"opaque"};ha=null==ca.metallicRoughnessTexture&&null==ca.metallic&&null==ca.roughness;ba=
{usePBR:this._usePBR(),isSchematic:ha,vertexColors:ca.hasVertexColors,symbolColors:ca.hasSymbolVertexColors,vertexTangents:ca.hasVertexTangents,ambient:e.ZEROS,diffuse:e.ONES,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:L.CullFaceOptions.None,layerOpacity:this._getLayerOpacity(),slicePlaneEnabled:this._context.slicePlaneEnabled,initTextureTransparent:!0};ha||(ba.mrrFactors=[null!=ca.metallic?ca.metallic:1,null!=ca.roughness?ca.roughness:1,.5]);fa.material&&(ba.doubleSided=fa.material.doubleSided,
ba.cullFace=fa.material.doubleSided?L.CullFaceOptions.None:L.CullFaceOptions.Back,ba.textureAlphaCutoff=fa.material.alphaCutoff);this._setExternalMaterialParameters(ba);this._setMaterialTransparentParameter(ba,na);this._setInternalMaterialParameters(ca,ba);fa=new Q.DefaultMaterial(ba);na.material=fa;this._materials.set(ca.uid,na);this._context.stage.add(fa);return fa};ia._usePBR=function(){return this._context.physicalBasedRenderingEnabled};ia._setMaterialTransparentParameter=function(ca,fa){ca.transparent=
this.needsDrivenTransparentPass||fa.isComponentTransparent||1>ca.layerOpacity||1>ca.opacity||ca.externalColor&&1>ca.externalColor[3];ca.textureAlphaMode="auto"===fa.alphaMode?ca.transparent?L.AlphaDiscardMode.MaskBlend:L.AlphaDiscardMode.Opaque:"opaque"===fa.alphaMode?L.AlphaDiscardMode.Opaque:"mask"===fa.alphaMode?L.AlphaDiscardMode.Mask:L.AlphaDiscardMode.Blend};ia._addDebugNormals=function(ca,fa,ba,Z){var ha=fa.length,na=ca.spatialReference.isGeographic?20015077/180:1;const pa=.1*Math.max(ca.extent.width*
na,ca.extent.height*na,ca.extent.zmax-ca.extent.zmin),xa=[],Da=[];ca=[];na=[];for(let ra=0;ra<ha;ra++){var ua=fa[ra],Fa=ua.vertexAttributes.get(O.VertexAttribute.POSITION),qa=ua.vertexAttributes.get(O.VertexAttribute.NORMAL);const va=ua.indices.get(O.VertexAttribute.POSITION);ua=ua.indices.get(O.VertexAttribute.NORMAL);Fa=Fa.data;qa=qa.data;for(let Ia=0;Ia<va.length;Ia++){var sa=3*va[Ia];const Ja=3*ua[Ia];for(var ma=0;3>ma;ma++)xa.push(Fa[sa+ma]);for(ma=0;3>ma;ma++)xa.push(Fa[sa+ma]+qa[Ja+ma]*pa);
Da.push(Da.length);Da.push(Da.length);if(0===Ia%3){this._calculateFaceNormal(Fa,va,Ia,W);this._getFaceVertices(Fa,va,Ia,S,T,V);k.add(S,S,T);k.add(S,S,V);k.scale(S,S,1/3);for(sa=0;3>sa;sa++)ca.push(S[sa]);for(sa=0;3>sa;sa++)ca.push(S[sa]+W[sa]*pa);na.push(na.length);na.push(na.length)}}}ha=new H.Geometry([[O.VertexAttribute.POSITION,{data:xa,size:3,exclusive:!0}]],[[O.VertexAttribute.POSITION,new Uint32Array(Da)]],L.PrimitiveType.Line);fa.push(ha);ba.push(this._debugVertexNormalMaterial);Z.push(l.clone(Z[0]));
ha=new H.Geometry([[O.VertexAttribute.POSITION,{data:ca,size:3,exclusive:!0}]],[[O.VertexAttribute.POSITION,new Uint32Array(na)]],L.PrimitiveType.Line);fa.push(ha);ba.push(this._debugFaceNormalMaterial);Z.push(l.clone(Z[0]))};ia._createAs3DShape=function(ca,fa,ba,Z){ca=ca.geometry;if("mesh"!==ca.type)return null;fa=this._createGeometryInfo(ca,fa);if(!fa)return null;const {geometries:ha,materials:na,transformations:pa,objectTransformation:xa}=fa;G.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(ca,
ha,na,pa);Z=new K.Object3D({geometries:ha,materials:na,transformations:pa,metadata:{layerUid:this._context.layer.uid,graphicUid:Z}});Z.transformation=xa;fa=this._createEdgeMaterial();fa=h.isSome(fa)?{baseMaterial:na[0],edgeMaterials:[fa],properties:{mergeGeometries:!0,slicePlaneEnabled:this._context.slicePlaneEnabled}}:null;fa=new B.Graphics3DObject3DGraphicLayer(this,Z,ha,null,null,y.perObjectElevationAligner,ba,fa);fa.needsElevationUpdates=A.needsElevationUpdates3D(ba.mode);fa.useObjectOriginAsAttachmentOrigin=
!0;fa.elevationContext.centerPointInElevationSR=this._getCenterPointInElevationSR(Z);fa.alignedSampledElevation=y.perObjectElevationAligner(fa,fa.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper);return fa};ia._getCenterPointInElevationSR=function(ca){const fa=u.makeDehydratedPoint(0,0,0,this._context.elevationProvider.spatialReference);m.projectVectorToDehydratedPoint([ca.transformation[12],ca.transformation[13],ca.transformation[14]],this._context.renderCoordsHelper.spatialReference,
fa);return fa};ia._createComponentNormals=function(ca,fa,ba,Z){switch(ba.shading||"flat"){case "source":return this._createComponentNormalsSource(ca,fa,ba,Z);case "flat":return this._createComponentNormalsFlat(ca,Z);case "smooth":return this._createComponentNormalsSmooth(ca,Z)}};ia._createComponentNormalsSource=function(ca,fa,ba,Z){if(h.isNone(fa))return this._createComponentNormalsFlat(ca,Z);let ha=!1;if(!ba.trustSourceNormals)for(ba=0;ba<Z.length;ba+=3){this._calculateFaceNormal(ca,Z,ba,W);for(let na=
0;3>na;na++){const pa=3*Z[ba+na];S[0]=fa[pa+0];S[1]=fa[pa+1];S[2]=fa[pa+2];0>k.dot(W,S)&&(fa[pa+0]=-fa[pa+0],fa[pa+1]=-fa[pa+1],fa[pa+2]=-fa[pa+2],ha=!0)}}return{normals:fa,indices:Z,didFlipNormals:ha}};ia._createComponentNormalsFlat=function(ca,fa){const ba=new Float32Array(fa.length),Z=new Uint32Array(3*fa.length);for(let ha=0;ha<fa.length;ha+=3){const na=this._calculateFaceNormal(ca,fa,ha,W);for(let pa=0;3>pa;pa++)ba[ha+pa]=na[pa],Z[ha+pa]=ha/3}return{normals:ba,indices:Z,didFlipNormals:!1}};ia._createComponentNormalsSmooth=
function(ca,fa){const ba={};for(var Z=0;Z<fa.length;Z+=3){var ha=this._calculateFaceNormal(ca,fa,Z,W);for(var na=0;3>na;na++){var pa=fa[Z+na];let xa=ba[pa];xa||(xa={normal:e.create(),count:0},ba[pa]=xa);k.add(xa.normal,xa.normal,ha);xa.count++}}ca=new Float32Array(3*fa.length);Z=new Uint32Array(3*fa.length);for(ha=0;ha<fa.length;ha++){na=ba[fa[ha]];1!==na.count&&(k.normalize(na.normal,na.normal),na.count=1);for(pa=0;3>pa;pa++)ca[3*ha+pa]=na.normal[pa];Z[ha]=ha}return{normals:ca,indices:Z,didFlipNormals:!1}};
ia._getFaceVertices=function(ca,fa,ba,Z,ha,na){const pa=3*fa[ba+0],xa=3*fa[ba+1];fa=3*fa[ba+2];Z[0]=ca[pa+0];Z[1]=ca[pa+1];Z[2]=ca[pa+2];ha[0]=ca[xa+0];ha[1]=ca[xa+1];ha[2]=ca[xa+2];na[0]=ca[fa+0];na[1]=ca[fa+1];na[2]=ca[fa+2]};ia._calculateFaceNormal=function(ca,fa,ba,Z){this._getFaceVertices(ca,fa,ba,S,T,V);k.subtract(T,T,S);k.subtract(V,V,S);k.cross(S,T,V);k.normalize(Z,S);return Z};ia._getOrCreateComponents=function(ca){return h.unwrapOr(ca.components,Y)};ia._createPositionBuffer=function(ca,
fa){let ba=ca.vertexAttributes.position;const Z=fa.reprojection===ea.ECEF?fa.transformBeforeProject:null;h.isSome(Z)&&(ba=x.transformPosition(ba,new Float64Array(ba.length),Z));if(fa.reprojection===ea.NONE)return fa.needsBufferCopy?new Float64Array(ba):ba;fa=h.isSome(Z)?ba:new Float64Array(ba.length);m.projectBuffer(ba,ca.spatialReference,0,fa,this._context.renderCoordsHelper.spatialReference,0,ba.length/3);return fa};ia._createNormalBuffer=function(ca,fa,ba){let Z=ca.vertexAttributes.normal;if(h.isNone(Z))return null;
var ha=ba.reprojection===ea.ECEF?ba.transformBeforeProject:null;h.isSome(ha)&&(Z=x.transformNormal(Z,new Float32Array(Z.length),ha));if("local"===this._context.graphicsCoreOwner.view.viewingMode||ba.reprojection===ea.NONE)return ba.needsBufferCopy&&ca.vertexAttributes.normal===Z?new Float32Array(Z):Z;ba=ca.vertexAttributes.position;ha=h.isSome(ha)?Z:new Float32Array(Z.length);return x.projectNormalToPCPF(Z,ba,fa,ca.spatialReference,ha)};ia._createTangentBuffer=function(ca,fa,ba){let Z=ca.vertexAttributes.tangent;
if(h.isNone(Z))return null;var ha=ba.reprojection===ea.ECEF?ba.transformBeforeProject:null;h.isSome(ha)&&(Z=x.transformTangent(Z,new Float32Array(Z.length),ha));if("local"===this._context.graphicsCoreOwner.view.viewingMode||ba.reprojection===ea.NONE)return ba.needsBufferCopy&&ca.vertexAttributes.normal===Z?new Float32Array(Z):Z;ba=ca.vertexAttributes.position;ha=h.isSome(ha)?Z:new Float32Array(Z.length);return x.projectTangentToPCPF(Z,ba,fa,ca.spatialReference,ha)};ia._createColorBuffer=function(ca){return ca.vertexAttributes.color};
ia._createSymbolColorBuffer=function(ca){if(this._requiresSymbolVertexColors()){ca=this._getVertexOpacityAndColor(ca);const fa=F.parseColorMixMode(h.get(this.symbolLayer,"material","colorMixMode")),ba=new Uint8Array(4);F.encodeSymbolColor(ca,fa,ba);return ba}return null};ia._createBuffers=function(ca,fa){var ba=ca.vertexAttributes&&ca.vertexAttributes.position;if(!ba)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;var Z=ca.vertexAttributes.normal;const ha=ca.vertexAttributes.uv;
var na=ca.vertexAttributes.tangent;if(h.isSome(Z)&&Z.length!==ba.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(h.isSome(na)&&na.length/4!==ba.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(h.isSome(ha)&&ha.length/2!==ba.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),
null;na=this._computeReprojectionInfo(ca);ba=this._createPositionBuffer(ca,na);Z=this._createColorBuffer(ca);fa=this._createSymbolColorBuffer(fa);const pa=this._createNormalBuffer(ca,ba,na),xa=this._createTangentBuffer(ca,ba,na);ca=na.reprojection===ea.NONE&&h.isSome(na.objectTransformation)?na.objectTransformation:this._transformOriginLocal(ca,ba,pa,xa);na=na.reprojection===ea.NONE&&h.isSome(na.geometryTransformation)?na.geometryTransformation:l.create();return{positionBuffer:ba,normalBuffer:pa,
tangentBuffer:xa,uvBuffer:ha,colorBuffer:Z,symbolColorBuffer:fa,objectTransformation:ca,geometryTransformation:na}};ia._computeReprojectionInfo=function(ca){var fa=h.isSome(ca.transform);const ba=fa&&ca.transform.geographic?ea.NONE:this._context.renderCoordsHelper.viewingMode===E.ViewingMode.Local?ea.NONE:ea.ECEF;if(fa){if(ba===ea.NONE)return fa=l.create(),m.computeTranslationToOriginAndRotation(ca.spatialReference,ca.transform.origin,fa,this._context.renderCoordsHelper.spatialReference),ca=l.clone(ca.transform.localMatrix),
{reprojection:ba,objectTransformation:fa,geometryTransformation:ca,needsBufferCopy:!1};fa=f.fromTranslation(l.create(),ca.transform.origin);f.multiply(fa,fa,ca.transform.localMatrix);return{reprojection:ba,transformBeforeProject:fa,needsBufferCopy:!0}}return{reprojection:ba,needsBufferCopy:!0}};ia._transformOriginLocal=function(ca,fa,ba,Z){const ha=this._context.renderCoordsHelper.spatialReference;var na=ca.anchor;R[0]=na.x;R[1]=na.y;R[2]=na.z;na=l.create();m.computeTranslationToOriginAndRotation(ca.spatialReference,
R,na,ha);ca=t.BufferViewVec3f64.fromTypedArray(fa);f.invert(U,na);r.transformMat4(ca,ca,U);if(h.isSome(ba)||h.isSome(Z))w.fromMat4(aa,na),w.transpose(aa,aa),h.isSome(ba)&&(ba=t.BufferViewVec3f.fromTypedArray(ba),r.transformMat3(ba,ba,aa)),h.isSome(Z)&&(Z=t.BufferViewVec3f.fromTypedArray(Z,4*Z.BYTES_PER_ELEMENT),r.transformMat3(Z,Z,aa));return na};ia._validateFaces=function(ca,fa){ca=ca.vertexAttributes.position.length/3;if(fa=fa.faces){let ba=-1;for(let Z=0;Z<fa.length;Z++){const ha=fa[Z];ha>ba&&
(ba=ha)}if(ca<=ba)return this.logger.warn(`Vertex index ${ba} is out of bounds of the mesh position buffer`),!1}else if(0!==ca%3)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0};ia._getOrCreateFaces=function(ca,fa){return fa.faces?fa.faces:M.generateDefaultIndexArray(ca.vertexAttributes.position.length/3)};ia._isOutsideClippingArea=function(ca){if(!this._context.clippingExtent)return!1;
var fa=ca.vertexAttributes&&ca.vertexAttributes.position;if(!fa)return!1;const ba=this._context.elevationProvider.spatialReference,Z=fa.length/3;ca.spatialReference.equals(ba)||(fa=new Float64Array(fa.length),m.projectBuffer(ca.vertexAttributes.position,ca.spatialReference,0,fa,ba,0,Z));z.empty(da);z.expandWithBuffer(da,fa,0,Z);return!z.intersectsClippingArea(da,this._context.clippingExtent)};ia._createGeometryInfo=function(ca,fa){if(!m.canProjectWithoutEngine(ca.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),
null;if(this._isOutsideClippingArea(ca))return null;fa=this._createBuffers(ca,fa);if(h.isNone(fa))return null;const {positionBuffer:ba,uvBuffer:Z,colorBuffer:ha,symbolColorBuffer:na,normalBuffer:pa,tangentBuffer:xa,objectTransformation:Da,geometryTransformation:ua}=fa;var Fa=this._getOrCreateComponents(ca);fa=[];const qa=[],sa=[];let ma=!1;for(const va of Fa){if(!this._validateFaces(ca,va))return null;Fa=this._getOrCreateFaces(ca,va);if(0===Fa.length)continue;var ra=this._createComponentNormals(ba,
pa,va,Fa);ra.didFlipNormals&&(ma=!0);const Ia=[[O.VertexAttribute.POSITION,{size:3,data:ba,exclusive:!0}],[O.VertexAttribute.NORMAL,{size:3,data:ra.normals,exclusive:!0}]];ra=[[O.VertexAttribute.POSITION,Fa],[O.VertexAttribute.NORMAL,ra.indices]];h.isSome(ha)&&(Ia.push([O.VertexAttribute.COLOR,{size:4,data:ha,exclusive:!0}]),ra.push([O.VertexAttribute.COLOR,Fa]));h.isSome(na)&&(Ia.push([O.VertexAttribute.SYMBOLCOLOR,{size:4,data:na,exclusive:!0}]),ra.push([O.VertexAttribute.SYMBOLCOLOR,new Uint16Array(Fa.length)]));
h.isSome(Z)&&(Ia.push([O.VertexAttribute.UV0,{size:2,data:Z,exclusive:!0}]),ra.push([O.VertexAttribute.UV0,Fa]));h.isSome(xa)&&(Ia.push([O.VertexAttribute.TANGENT,{size:4,data:xa,exclusive:!0}]),ra.push([O.VertexAttribute.TANGENT,Fa]));Fa=new H.Geometry(Ia,ra);fa.push(Fa);qa.push(ua);sa.push(this._getOrCreateMaterial(ca,va))}ma&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");
return{geometries:fa,transformations:qa,materials:sa,objectTransformation:Da}};ia._createEdgeMaterial=function(){const ca={opacity:this._getLayerOpacity()};return C.createMaterial(this.symbolLayer,ca)};return la}(D.Graphics3DSymbolLayer);const R=e.create(),S=e.create(),T=e.create(),V=e.create(),W=e.create(),U=l.create(),aa=n.create(),da=z.create(),Y=[new v];var ea;(function(ja){ja[ja.NONE=0]="NONE";ja[ja.ECEF=1]="ECEF"})(ea||(ea={}));a.Graphics3DMeshFillSymbolLayer=g;a.default=g;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/geometry/support/MeshComponent":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/ensureType ./MeshMaterial ./MeshMaterialMetallicRoughness ./MeshVertexAttributes".split(" "),function(a,b,c,g,h,w,n,f,l,k,e,d){var m;
const z=h.getLogger("esri.geometry.support.MeshComponent");c=m=function(v){function q(r){r=v.call(this,r)||this;r.faces=null;r.material=null;r.shading="source";r.trustSourceNormals=!1;return r}a._inheritsLoose(q,v);q.from=function(r){return l.ensureClass(m,r)};var t=q.prototype;t.castFaces=function(r){return d.castArray(r,Uint32Array,[Uint16Array],{loggerTag:".faces\x3d",stride:3},z)};t.castMaterial=function(r){return r&&"object"===typeof r&&("metallic"in r||"roughness"in r||"metallicRoughnessTexture"in
r)?l.ensureClass(e,r):l.ensureClass(k,r)};t.clone=function(){return new m({faces:g.clone(this.faces),shading:this.shading,material:g.clone(this.material),trustSourceNormals:this.trustSourceNormals})};t.cloneWithDeduplication=function(r,x){r={faces:g.clone(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(r,x):null,trustSourceNormals:this.trustSourceNormals};return new m(r)};return q}(c.JSONSupport);b.__decorate([w.property({json:{write:!0}})],c.prototype,
"faces",void 0);b.__decorate([n.cast("faces")],c.prototype,"castFaces",null);b.__decorate([w.property({type:k,json:{write:!0}})],c.prototype,"material",void 0);b.__decorate([n.cast("material")],c.prototype,"castMaterial",null);b.__decorate([w.property({type:String,json:{write:!0}})],c.prototype,"shading",void 0);b.__decorate([w.property({type:Boolean})],c.prototype,"trustSourceNormals",void 0);return c=m=b.__decorate([f.subclass("esri.geometry.support.MeshComponent")],c)})},"esri/geometry/support/MeshMaterial":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/JSONSupport ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./MeshTexture".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){var d;g=d=function(m){function z(q){q=m.call(this,q)||this;q.color=null;q.colorTexture=null;q.normalTexture=null;q.alphaMode="auto";q.alphaCutoff=.5;q.doubleSided=!0;return q}a._inheritsLoose(z,m);var v=z.prototype;v.clone=function(){return this.cloneWithDeduplication(null,new Map)};v.cloneWithDeduplication=function(q,t){const r=h.isSome(q)?q.get(this):null;if(r)return r;t=new d(this.clonePropertiesWithDeduplication(t));h.isSome(q)&&q.set(this,t);return t};v.clonePropertiesWithDeduplication=
function(q){return{color:h.isSome(this.color)?this.color.clone():null,colorTexture:h.isSome(this.colorTexture)?this.colorTexture.cloneWithDeduplication(q):null,normalTexture:h.isSome(this.normalTexture)?this.normalTexture.cloneWithDeduplication(q):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}};return z}(g.JSONSupport);b.__decorate([w.property({type:c,json:{write:!0}})],g.prototype,"color",void 0);b.__decorate([w.property({type:e,json:{write:!0}})],g.prototype,
"colorTexture",void 0);b.__decorate([w.property({type:e,json:{write:!0}})],g.prototype,"normalTexture",void 0);b.__decorate([w.property({nonNullable:!0,json:{write:!0}})],g.prototype,"alphaMode",void 0);b.__decorate([w.property({nonNullable:!0,json:{write:!0}})],g.prototype,"alphaCutoff",void 0);b.__decorate([w.property({nonNullable:!0,json:{write:!0}})],g.prototype,"doubleSided",void 0);return g=d=b.__decorate([k.subclass("esri.geometry.support.MeshMaterial")],g)})},"esri/geometry/support/MeshTexture":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../chunks/persistableUrlUtils ../../views/support/screenshotUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){var m;const z=new WeakMap;let v=0;c=m=function(q){function t(x){x=q.call(this,x)||this;x.wrap="repeat";return x}a._inheritsLoose(t,q);var r=t.prototype;r.writeData=function(x,u,E,y){x instanceof HTMLImageElement?(x={type:"image-element",src:e.toJSON(x.src,y),crossOrigin:x.crossOrigin},u[E]=x):x instanceof HTMLCanvasElement?(x=x.getContext("2d").getImageData(0,0,x.width,x.height),x={type:"canvas-element",imageData:this._encodeImageData(x)},u[E]=x):x instanceof HTMLVideoElement?
(x={type:"video-element",src:e.toJSON(x.src,y),autoplay:x.autoplay,loop:x.loop,muted:x.muted,crossOrigin:x.crossOrigin,preload:x.preload},u[E]=x):(x={type:"image-data",imageData:this._encodeImageData(x)},u[E]=x)};r.readData=function(x){switch(x.type){case "image-element":var u=new Image;u.src=x.src;u.crossOrigin=x.crossOrigin;return u;case "canvas-element":return x=this._decodeImageData(x.imageData),u=document.createElement("canvas"),u.width=x.width,u.height=x.height,u.getContext("2d").putImageData(x,
0,0),u;case "image-data":return this._decodeImageData(x.imageData);case "video-element":return u=document.createElement("video"),u.src=x.src,u.crossOrigin=x.crossOrigin,u.autoplay=x.autoplay,u.loop=x.loop,u.muted=x.muted,u.preload=x.preload,u}};r.clone=function(){const x={url:this.url,data:this.data,wrap:this._cloneWrap()};return new m(x)};r.cloneWithDeduplication=function(x){var u=x.get(this);if(u)return u;u=this.clone();x.set(this,u);return u};r._cloneWrap=function(){return"string"===typeof this.wrap?
this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}};r._encodeImageData=function(x){let u="";for(let E=0;E<x.data.length;E++)u+=String.fromCharCode(x.data[E]);return{data:btoa(u),width:x.width,height:x.height}};r._decodeImageData=function(x){const u=atob(x.data),E=new Uint8ClampedArray(u.length);for(let y=0;y<u.length;y++)E[y]=u.charCodeAt(y);return d.wrapImageData(E,x.width,x.height)};r._imageDataContainsTransparent=function(x){for(let u=3;u<x.data.length;u+=4)if(255!==x.data[u])return!0;
return!1};t.from=function(x){return"string"===typeof x?new m({url:x}):x instanceof HTMLImageElement||x instanceof HTMLCanvasElement||x instanceof ImageData||x instanceof HTMLVideoElement?new m({data:x}):n.ensureClass(m,x)};a._createClass(t,[{key:"url",get:function(){return this._get("url")||null},set:function(x){this._set("url",x);x&&this._set("data",null)}},{key:"data",get:function(){return this._get("data")||null},set:function(x){this._set("data",x);x&&this._set("url",null)}},{key:"transparent",
get:function(){var x=this.data,u=this.url;return x instanceof HTMLCanvasElement?this._imageDataContainsTransparent(x.getContext("2d").getImageData(0,0,x.width,x.height)):x instanceof ImageData?this._imageDataContainsTransparent(x):u&&(x=u.substr(u.length-4,4).toLowerCase(),u=u.substr(0,15).toLocaleLowerCase(),".png"===x||"data:image/png;"===u)?!0:!1},set:function(x){null!=x?this._override("transparent",x):this._clearOverride("transparent")}},{key:"contentHash",get:function(){const x="string"===typeof this.wrap?
this.wrap:"object"===typeof this.wrap?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",u=(E="")=>`d:${E},t:${this.transparent},w:${x}`;if(null!=this.url)return u(this.url);if(null!=this.data){if(this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement)return u(this.data.src);z.has(this.data)||z.set(this.data,++v);return u(z.get(this.data))}return u()}}]);return t}(g.JSONSupport);b.__decorate([h.property({type:String,json:{write:e.write}})],c.prototype,"url",null);b.__decorate([h.property({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),
h.property()],c.prototype,"data",null);b.__decorate([k.writer("data")],c.prototype,"writeData",null);b.__decorate([f.reader("data")],c.prototype,"readData",null);b.__decorate([h.property({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],c.prototype,"transparent",null);b.__decorate([h.property({json:{write:!0}})],c.prototype,"wrap",void 0);b.__decorate([h.property({readOnly:!0})],c.prototype,"contentHash",null);return c=m=b.__decorate([l.subclass("esri.geometry.support.MeshTexture")],
c)})},"esri/views/support/screenshotUtils":function(){define(["exports","../../core/has","../../core/mathUtils"],function(a,b,c){function g(q,t){const {format:r,quality:x,rotation:u,disableDecorations:E}=q||{};var y=l(q,t.padding);var A=t.width-y.left-y.right;t=t.height-y.top-y.bottom;y={x:0,y:0,width:A,height:t};if(q&&q.area){null!=q.area.x&&(y.x=Math.floor(q.area.x));null!=q.area.y&&(y.y=Math.floor(q.area.y));var p=null!=q.area.width?Math.floor(q.area.width):null,B=null!=q.area.height?Math.floor(q.area.height):
null;y.width=A-y.x;y.height=t-y.y;null!=p&&null!=B?(y.width=Math.min(y.width,p),y.height=Math.min(y.height,B)):null==p&&null!=B?(p=Math.min(y.width,p),y.height*=p/y.width,y.width=p):null!=p&&null==B&&(p=Math.min(y.height,B),y.width*=p/y.height,y.height=p)}y=f(y,q);p=Math.floor(Math.max(y.x,0));B=Math.floor(Math.max(y.y,0));A={x:p,y:B,width:Math.floor(Math.min(y.width,A-p)),height:Math.floor(Math.min(y.height,t-B))};t=A.width/A.height;y=y.width/y.height;y!==t&&(y>t?(t=Math.floor(A.width/y),A={x:A.x,
y:Math.floor(A.y+(A.height-t)/2),width:A.width,height:t}):(t=Math.floor(A.height*y),A={x:Math.floor(A.x+(A.width-t)/2),y:A.y,width:t,height:A.height}));const {width:D,height:C}=n(q,A);t=k(r);y=z[t];y=c.clamp(null!=x?x:y,0,100);return{format:t,quality:y,area:A,width:D,height:C,rotation:u,disableDecorations:!!E,ignoreBackground:!(!q||!q.ignoreBackground),ignorePadding:!(!q||!q.ignorePadding)}}function h(q,t){return q.toDataURL(m[t.format],t.quality/100)}function w(q,t,r){r||(e||(e=document.createElement("canvas"),
e.width=1,e.height=1),r=e);return r.getContext("2d").createImageData(q,t)}function n(q,t){if(!q)return t;const r=q.width;q=q.height;if(null!=r&&null!=q)return{width:Math.floor(r),height:Math.floor(q)};if(null==r&&null==q)return t;t=t.width/t.height;return null==q?{width:Math.floor(r),height:Math.floor(r/t)}:{width:Math.floor(q*t),height:Math.floor(q)}}function f(q,t){if(!t||null==t.width||null==t.height)return q;t=t.width/t.height;const r=q.width/q.height;if(r===t)return q;if(r<t)return t=Math.floor(q.height*
t),q.x-=(t-q.width)/2,q.width=t,q;t=Math.floor(q.width/t);q.y-=(t-q.height)/2;q.height=t;return q}function l(q,t){return!t||q&&q.ignorePadding?v:t}function k(q){switch(q){case "png":case "jpg":case "jpeg":return q;case null:case void 0:return"png";default:return"png"}}let e=null,d=!0;const m={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},z={png:100,jpg:98,jpeg:98},v={top:0,right:0,bottom:0,left:0};a.completeUserSettings=g;a.createEmptyImageData=function(q,t,r){if(!q||!t)throw Error("Cannot construct image data without dimensions");
if(d)try{return new ImageData(q,t)}catch(x){d=!1}return w(q,t,r)};a.encodeResult=function(q,t,r,x){if(x.premultipliedAlpha){{var u=q.data;const y=u.length;for(let A=0;A<y;A+=4){var E=u[A+3];0<E&&(E/=255,u[A+0]/=E,u[A+1]/=E,u[A+2]/=E)}}}r.width=q.width;r.height=q.height;u=r.getContext("2d");u.putImageData(q,0,0);x.flipY&&(u.save(),u.globalCompositeOperation="copy",u.scale(1,-1),u.translate(0,-u.canvas.height),u.drawImage(u.canvas,0,0),u.restore());q=u.getImageData(0,0,q.width,q.height);t=h(r,t);r.width=
0;r.height=0;return{dataUrl:t,data:q}};a.getFormatAndQuality=function(q,t){q=k(q);const r=z[q];t=c.clamp(null!=t?t:r,0,100);return{format:q,quality:t}};a.getMaximumResolutionScale=function(q,t){return t/Math.max(q[0],q[1])};a.resampleHermite=function(q,t,r,x=0,u=0,E=q.width-x,y=q.height-u,A=!1){const {data:p}=q,{width:B,height:D,data:C}=t;E/=B;y/=D;const F=Math.ceil(E/2),G=Math.ceil(y/2);q=q.width;for(let M=0;M<D;M++)for(let K=0;K<B;K++){const I=4*(K+(A?D-M-1:M)*B);let O=0,Q=0,J=0,P=0,N=0,R=0;const S=
(M+.5)*y;for(let T=Math.floor(M*y);T<(M+1)*y;T++){var L=Math.abs(S-(T+.5))/G;const V=(K+.5)*E;L*=L;for(let W=Math.floor(K*E);W<(K+1)*E;W++){var H=Math.abs(V-(W+.5))/F;H=Math.sqrt(L+H*H);if(1<=H)continue;H=2*H*H*H-3*H*H+1;const U=4*(x+W+(u+T)*q);R+=H*p[U+3];Q+=H;!r&&255>p[U+3]&&(H=H*p[U+3]/255);J+=H*p[U];P+=H*p[U+1];N+=H*p[U+2];O+=H}}C[I]=J/O;C[I+1]=P/O;C[I+2]=N/O;C[I+3]=R/Q}return t};a.screenshotSuperSampleSettings=function(q,t,r){if(!t)return q;const {framebufferWidth:x,framebufferHeight:u,pixelRatio:E,
region:y}=q;t=l(q,r);r=t.left+t.right;const A=t.top+t.bottom,p=x-r,B=u-A,D=Math.min(8,Math.min((2048-r)/p,(2048-A)/B));return 1.5>D?q:{...q,framebufferWidth:Math.round(p*D)+r,framebufferHeight:Math.round(B*D)+A,pixelRatio:E*D,resample:{region:{x:Math.round((y.x-t.left)*D)+t.left,y:Math.round((y.y-t.top)*D)+t.top,width:Math.round(y.width*D),height:Math.round(y.height*D)},width:x,height:u}}};a.toDataUrl=h;a.toRenderSettings=function(q,t){const r=g(q,t),x=r.area,u=r.width/x.width,E=l(r,t.padding),y=
E.left+E.right,A=E.top+E.bottom;return{framebufferWidth:Math.floor((t.width-y)*u+y),framebufferHeight:Math.floor((t.height-A)*u+A),region:{x:Math.floor(x.x*u)+E.left,y:Math.floor(x.y*u)+E.top,width:r.width,height:r.height},format:r.format,quality:r.quality,rotation:r.rotation,pixelRatio:u,layers:q&&q.layers?q.layers:[],disableDecorations:r.disableDecorations,ignoreBackground:r.ignoreBackground,ignorePadding:r.ignorePadding}};a.wrapImageData=function(q,t,r,x){if(!t||!r)throw Error("Cannot construct image data without dimensions");
if(d)try{return new ImageData(q,t,r)}catch(u){d=!1}t=w(t,r,x);t.data.set(q,0);return t};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/MeshMaterialMetallicRoughness":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./MeshMaterial ./MeshTexture".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){var d;w=d=function(m){function z(q){q=m.call(this,q)||this;q.emissiveColor=null;q.emissiveTexture=null;q.occlusionTexture=null;q.metallic=1;q.roughness=1;q.metallicRoughnessTexture=null;return q}a._inheritsLoose(z,m);var v=z.prototype;v.clone=function(){return this.cloneWithDeduplication(null,new Map)};v.cloneWithDeduplication=function(q,t){const r=g.isSome(q)?q.get(this):null;if(r)return r;t=new d(this.clonePropertiesWithDeduplication(t));g.isSome(q)&&q.set(this,t);
return t};v.clonePropertiesWithDeduplication=function(q){return{...m.prototype.clonePropertiesWithDeduplication.call(this,q),emissiveColor:g.isSome(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:g.isSome(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(q):null,occlusionTexture:g.isSome(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(q):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:g.isSome(this.metallicRoughnessTexture)?
this.metallicRoughnessTexture.cloneWithDeduplication(q):null}};return z}(k);b.__decorate([h.property({type:c,json:{write:!0}})],w.prototype,"emissiveColor",void 0);b.__decorate([h.property({type:e,json:{write:!0}})],w.prototype,"emissiveTexture",void 0);b.__decorate([h.property({type:e,json:{write:!0}})],w.prototype,"occlusionTexture",void 0);b.__decorate([h.property({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],w.prototype,"metallic",void 0);b.__decorate([h.property({type:Number,
nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],w.prototype,"roughness",void 0);b.__decorate([h.property({type:e,json:{write:!0}})],w.prototype,"metallicRoughnessTexture",void 0);return w=d=b.__decorate([l.subclass("esri.geometry.support.MeshMaterialMetallicRoughness")],w)})},"esri/geometry/support/MeshVertexAttributes":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,g,h,w,n,f,l){function k(v,q,t,r){const {loggerTag:x,stride:u}=q;return 0!==v.length%u?(r.error(x,`Invalid array length, expected a multiple of ${u}`),new t([])):v}function e(v,q,t,r,x){if(!v)return v;if(v instanceof q)return k(v,r,q,x);for(const u of t)if(v instanceof u)return k(new q(v),r,q,x);if(Array.isArray(v))return k(new q(v),r,q,x);t=t.map(u=>`'${u.name}'`);x.error(`Failed to set property, expected one of ${t}, but got ${v.constructor.name}`);return new q([])}function d(v,q,
t){{const r=Array(v.length);for(let x=0;x<v.length;x++)r[x]=v[x];v=r}q[t]=v}var m;const z=w.getLogger("esri.geometry.support.MeshVertexAttributes");a.MeshVertexAttributes=m=function(v){function q(r){r=v.call(this,r)||this;r.color=null;r.position=new Float64Array(0);r.uv=null;r.normal=null;r.tangent=null;return r}b._inheritsLoose(q,v);var t=q.prototype;t.castColor=function(r){return e(r,Uint8Array,[Uint8ClampedArray],{loggerTag:".color\x3d",stride:4},z)};t.castPosition=function(r){r&&r instanceof Float32Array&&
z.warn(".position\x3d","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array");return e(r,Float64Array,[Float32Array],{loggerTag:".position\x3d",stride:3},z)};t.castUv=function(r){return e(r,Float32Array,[Float64Array],{loggerTag:".uv\x3d",stride:2},z)};t.castNormal=function(r){return e(r,Float32Array,[Float64Array],{loggerTag:".normal\x3d",stride:3},z)};t.castTangent=function(r){return e(r,Float32Array,[Float64Array],
{loggerTag:".tangent\x3d",stride:4},z)};t.clone=function(){const r={position:h.clone(this.position),uv:h.clone(this.uv),normal:h.clone(this.normal),tangent:h.clone(this.tangent),color:h.clone(this.color)};return new m(r)};t.clonePositional=function(){const r={position:h.clone(this.position),normal:h.clone(this.normal),tangent:h.clone(this.tangent),uv:this.uv,color:this.color};return new m(r)};return q}(g.JSONSupport);c.__decorate([n.property({json:{write:d}})],a.MeshVertexAttributes.prototype,"color",
void 0);c.__decorate([f.cast("color")],a.MeshVertexAttributes.prototype,"castColor",null);c.__decorate([n.property({nonNullable:!0,json:{write:d}})],a.MeshVertexAttributes.prototype,"position",void 0);c.__decorate([f.cast("position")],a.MeshVertexAttributes.prototype,"castPosition",null);c.__decorate([n.property({json:{write:d}})],a.MeshVertexAttributes.prototype,"uv",void 0);c.__decorate([f.cast("uv")],a.MeshVertexAttributes.prototype,"castUv",null);c.__decorate([n.property({json:{write:d}})],a.MeshVertexAttributes.prototype,
"normal",void 0);c.__decorate([f.cast("normal")],a.MeshVertexAttributes.prototype,"castNormal",null);c.__decorate([n.property({json:{write:d}})],a.MeshVertexAttributes.prototype,"tangent",void 0);c.__decorate([f.cast("tangent")],a.MeshVertexAttributes.prototype,"castTangent",null);a.MeshVertexAttributes=m=c.__decorate([l.subclass("esri.geometry.support.MeshVertexAttributes")],a.MeshVertexAttributes);a.castArray=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/meshUtils/projection":function(){define("exports ../../../core/Logger ../../../core/maybe ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../projection ../../projectionEllipsoid ../spatialReferenceUtils ../webMercatorUtils ../buffer/BufferView ../../../chunks/vec32".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z){function v(p,B,D,C,F,G){if(B){var L=D.count,H=k.getSphericalPCPF(F);if(t(F))for(D=0;D<L;D++)C.getVec(D,u),B.getVec(D,E),l.computeTranslationToOriginAndRotation(H,u,y,H),g.fromMat4(A,y),p===x.FROM_PCPF&&g.transpose(A,A),n.transformMat3(E,E,A),G.setVec(D,E);else for(F=0;F<L;F++){C.getVec(F,u);B.getVec(F,E);l.computeTranslationToOriginAndRotation(H,u,y,H);g.fromMat4(A,y);var M=d.y2lat(D.get(F,1));M=Math.cos(M);p===x.TO_PCPF&&(M=1/M);A[0]*=M;A[1]*=M;A[2]*=M;A[3]*=
M;A[4]*=M;A[5]*=M;p===x.FROM_PCPF&&g.transpose(A,A);n.transformMat3(E,E,A);n.normalize(E,E);G.setVec(F,E)}return G}}function q(p){return t(p)||p.isWebMercator}function t(p){return p.isWGS84||e.isCGCS2000(p)||e.isMars(p)||e.isMoon(p)}const r=b.getLogger("esri.geometry.support.meshUtils.normalProjection");var x;(function(p){p[p.TO_PCPF=0]="TO_PCPF";p[p.FROM_PCPF=1]="FROM_PCPF"})(x||(x={}));const u=f.create(),E=f.create(),y=w.create(),A=h.create();a.projectFromPCPF=function(p,B,D){l.projectBuffer(p,
k.getSphericalPCPF(D),0,B,D,0,p.length/3);return B};a.projectNormalFromPCPF=function(p,B,D,C,F){if(!q(C))return r.error("Cannot convert to spatial reference from PCPF"),F;v(x.FROM_PCPF,m.BufferViewVec3f.fromTypedArray(p),m.BufferViewVec3f64.fromTypedArray(B),m.BufferViewVec3f64.fromTypedArray(D),C,m.BufferViewVec3f.fromTypedArray(F));return F};a.projectNormalToPCPF=function(p,B,D,C,F){if(!q(C))return r.error("Cannot convert spatial reference to PCPF"),F;v(x.TO_PCPF,m.BufferViewVec3f.fromTypedArray(p),
m.BufferViewVec3f64.fromTypedArray(B),m.BufferViewVec3f64.fromTypedArray(D),C,m.BufferViewVec3f.fromTypedArray(F));return F};a.projectTangentFromPCPF=function(p,B,D,C,F){if(!q(C))return r.error("Cannot convert to spatial reference from PCPF"),F;v(x.FROM_PCPF,m.BufferViewVec3f.fromTypedArray(p,16),m.BufferViewVec3f64.fromTypedArray(B),m.BufferViewVec3f64.fromTypedArray(D),C,m.BufferViewVec3f.fromTypedArray(F,16));for(B=3;B<p.length;B+=4)F[B]=p[B];return F};a.projectTangentToPCPF=function(p,B,D,C,F){if(!q(C))return r.error("Cannot convert spatial reference to PCPF"),
F;v(x.TO_PCPF,m.BufferViewVec3f.fromTypedArray(p,4*Float32Array.BYTES_PER_ELEMENT),m.BufferViewVec3f64.fromTypedArray(B),m.BufferViewVec3f64.fromTypedArray(D),C,m.BufferViewVec3f.fromTypedArray(F,4*Float32Array.BYTES_PER_ELEMENT));for(B=3;B<p.length;B+=4)F[B]=p[B];return F};a.projectToPCPF=function(p,B,D){l.projectBuffer(p,B,0,D,k.getSphericalPCPF(B),0,p.length/3);return D};a.transformNormal=function(p,B,D){if(c.isNone(p))return B;g.normalFromMat4(A,D);p=m.BufferViewVec3f.fromTypedArray(p);D=m.BufferViewVec3f.fromTypedArray(B);
z.transformMat3(D,p,A);g.isOrthoNormal(A)||z.normalize(D,D);return B};a.transformPosition=function(p,B,D){if(c.isNone(p))return B;p=m.BufferViewVec3f64.fromTypedArray(p);const C=m.BufferViewVec3f64.fromTypedArray(B);z.transformMat4(C,p,D);return B};a.transformTangent=function(p,B,D){if(c.isNone(p))return B;g.normalFromMat4(A,D);D=m.BufferViewVec3f.fromTypedArray(p,4*Float32Array.BYTES_PER_ELEMENT);const C=m.BufferViewVec3f.fromTypedArray(B,4*Float32Array.BYTES_PER_ELEMENT);z.transformMat3(C,D,A);
g.isOrthoNormal(A)||z.normalize(C,C);if(p!==B)for(D=3;D<p.length;D+=4)B[D]=p[D];return B};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/frustum ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../../../../geometry/support/buffer/BufferView ../core/shaderLibrary/ShaderOutputOptions ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./internal/bufferWriterUtils ./internal/DefaultBufferWriter ./internal/MaterialUtil ./renderers/utils ../shaders/NativeLineTechnique".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p){const B=c.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");var D;(function(da){da[da.START=0]="START";da[da.END=1]="END"})(D||(D={}));c=function(da){function Y(ja){ja=da.call(this,ja,G)||this;ja._techniqueConfig=new p.NativeLineTechniqueConfiguration;return ja}b._inheritsLoose(Y,da);var ea=Y.prototype;ea.getTechniqueConfig=function(ja,la){this._techniqueConfig.output=ja;this._techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled;
this._techniqueConfig.vertexColors=this.parameters.vertexColors;this._techniqueConfig.transparent=1>this.parameters.color[3]||1>this.parameters.width;this._techniqueConfig.draped=la.slot===t.RenderSlot.DRAPED_MATERIAL;ja=g.isSome(this.parameters.stipplePattern);this._techniqueConfig.stippleEnabled=ja;this._techniqueConfig.stippleOffColorEnabled=ja&&g.isSome(this.parameters.stippleOffColor);this._techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees;this._techniqueConfig.stipplePreferContinuous=
this.parameters.stipplePreferContinuous;return this._techniqueConfig};ea.getPassParameters=function(){return this.parameters};ea.intersect=function(ja,la,ia,ca,fa,ba,Z,ha,na){g.isSome(na)?y.intersectDrapedRenderLineGeometry(ja,ca,na,ba,1,Z):this._intersectLineGeometry(ja,la,ia,ca,Z)};ea._intersectLineGeometry=function(ja,la,ia,ca,fa){if(ca.options.selectionMode&&!A.isInstanceHidden(la))if(r.isTranslationMatrix(ia)){var ba=ja.vertexAttributes.get(x.VertexAttribute.POSITION).data,Z=ca.camera,ha=R;w.copy(ha,
ca.point);n.set(S[0],ha[0]-2,ha[1]+2,0);n.set(S[1],ha[0]+2,ha[1]+2,0);n.set(S[2],ha[0]+2,ha[1]-2,0);n.set(S[3],ha[0]-2,ha[1]-2,0);for(ja=0;4>ja;ja++)if(!Z.unprojectFromRenderScreen(S[ja],T[ja]))return;e.fromPoints(Z.eye,T[0],T[1],V);e.fromPoints(Z.eye,T[1],T[2],W);e.fromPoints(Z.eye,T[2],T[3],U);e.fromPoints(Z.eye,T[3],T[0],aa);la=Number.MAX_VALUE;ja=0;for(let pa=0;pa<ba.length-5;pa+=3)if(L[0]=ba[pa]+ia[12],L[1]=ba[pa+1]+ia[13],L[2]=ba[pa+2]+ia[14],H[0]=ba[pa+3]+ia[12],H[1]=ba[pa+4]+ia[13],H[2]=ba[pa+
5]+ia[14],!(0>e.signedDistance(V,L)&&0>e.signedDistance(V,H)||0>e.signedDistance(W,L)&&0>e.signedDistance(W,H)||0>e.signedDistance(U,L)&&0>e.signedDistance(U,H)||0>e.signedDistance(aa,L)&&0>e.signedDistance(aa,H))){Z.projectToRenderScreen(L,I);Z.projectToRenderScreen(H,O);if(0>I[2]&&0<O[2]){n.subtract(M,L,H);var na=Z.frustum;na=-e.signedDistance(na[l.PlaneIndex.NEAR],L)/n.dot(M,e.normal(na[l.PlaneIndex.NEAR]));n.scale(M,M,na);n.add(L,L,M);Z.projectToRenderScreen(L,I)}else if(0<I[2]&&0>O[2])n.subtract(M,
H,L),na=Z.frustum,na=-e.signedDistance(na[l.PlaneIndex.NEAR],H)/n.dot(M,e.normal(na[l.PlaneIndex.NEAR])),n.scale(M,M,na),n.add(H,H,M),Z.projectToRenderScreen(H,O);else if(0>I[2]&&0>O[2])continue;I[2]=0;O[2]=0;na=k.distance2(k.fromPoints(I,O,P),ha);na<la&&(la=na,n.copy(Q,L),n.copy(J,H),ja=pa/3)}ia=ca.rayBegin;ca=ca.rayEnd;4>la&&(la=Number.MAX_VALUE,k.closestLineSegmentPoint(k.fromPoints(Q,J,P),k.fromPoints(ia,ca,N),K)&&(n.subtract(K,K,ia),la=n.length(K),n.scale(K,K,1/la),la/=n.distance(ia,ca)),fa(la,
K,ja,!1))}else B.error("intersection assumes a translation-only matrix")};ea.computeAttachmentOrigin=function(ja,la){ja=ja.vertexAttributes;if(!ja)return!1;ja=ja.get(x.VertexAttribute.POSITION);return z.computeAttachmentOriginLines(ja,null,!1,la)};ea.requiresSlot=function(ja){return ja===t.RenderSlot.OPAQUE_MATERIAL||ja===t.RenderSlot.DRAPED_MATERIAL};ea.createGLMaterial=function(ja){return ja.output===m.ShaderOutput.Color||ja.output===m.ShaderOutput.Highlight?new C(ja):null};ea.createBufferWriter=
function(){const ja=this.parameters.vertexColors?E.PositionColorLayout:E.PositionLayout;return g.isNone(this.parameters.stipplePattern)?new E.DefaultBufferWriter(ja):new F(ja.clone().vec3f(x.VertexAttribute.AUXPOS1).vec2f(x.VertexAttribute.UV0))};return Y}(q.Material);let C=function(da){function Y(){return da.apply(this,arguments)||this}b._inheritsLoose(Y,da);var ea=Y.prototype;ea.updateParameters=function(ja){return this.ensureTechnique(p.NativeLineTechnique,ja)};ea._updateOccludeeState=function(ja){ja.hasOccludees!==
this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:ja.hasOccludees})};ea.beginSlot=function(ja){this._output===m.ShaderOutput.Color&&this._updateOccludeeState(ja);return this.updateParameters(ja)};ea.bind=function(ja,la){la.bindPass(this._material.getPassParameters(),ja)};return Y}(v),F=function(){function da(ea){this.vertexBufferLayout=ea}var Y=da.prototype;Y.allocate=function(ea){return this.vertexBufferLayout.createBuffer(ea)};Y.elementCount=function(ea){return ea.indices.get(x.VertexAttribute.POSITION).length};
Y.write=function(ea,ja,la,ia){u.writeDefaultAttributes(ja,this.vertexBufferLayout,ea.transformation,ea.invTranspTransformation,la,ia);this._writeAuxpos1(ea,ja,la,ia);this._writeUV0(ea,ja,la,ia)};Y._writeAuxpos1=function(ea,ja,la,ia){var ca=la.getField(x.VertexAttribute.AUXPOS1,d.BufferViewVec3f);la=ja.indices.get(x.VertexAttribute.POSITION);ja=ja.vertexAttributes.get(x.VertexAttribute.POSITION).data;ea=ea.transformation;const fa=ca.typedBufferStride;ca=ca.typedBuffer;ia*=fa;for(let Z=0;Z<la.length-
1;Z+=2)for(const ha of[1,0]){var ba=3*la[Z+ha];const na=ja[ba],pa=ja[ba+1];ba=ja[ba+2];const xa=ea[1]*na+ea[5]*pa+ea[9]*ba+ea[13],Da=ea[2]*na+ea[6]*pa+ea[10]*ba+ea[14];ca[ia]=ea[0]*na+ea[4]*pa+ea[8]*ba+ea[12];ca[ia+1]=xa;ca[ia+2]=Da;ia+=fa}};Y._writeUV0=function(ea,ja,la,ia){var ca,fa=la.getField(x.VertexAttribute.UV0,d.BufferViewVec2f),ba=ja.indices.get(x.VertexAttribute.POSITION);la=ja.vertexAttributes.get(x.VertexAttribute.POSITION).data;const Z=null==(ca=ja.vertexAttributes.get(x.VertexAttribute.DISTANCETOSTART))?
void 0:ca.data;ea=ea.transformation;ja=fa.typedBufferStride;fa=fa.typedBuffer;ia*=ja;let ha=0;fa[ia]=D.START;fa[ia+1]=ha;ia+=ja;ca=3*ba[0];ca=n.set(L,la[ca],la[ca+1],la[ca+2]);ea&&n.transformMat4(ca,ca,ea);const na=H,pa=ba.length-1;let xa=1;const Da=Z?(Fa,qa,sa)=>ha=Z[sa]:(Fa,qa,sa)=>ha+=n.distance(Fa,qa);for(let Fa=1;Fa<pa;Fa+=2){var ua=3*ba[Fa];n.set(na,la[ua],la[ua+1],la[ua+2]);ea&&n.transformMat4(na,na,ea);Da(ca,na,xa++);for(ua=0;2>ua;++ua)fa[ia]=1-ua,fa[ia+1]=ha,ia+=ja;n.copy(ca,na)}ba=3*ba[pa];
n.set(na,la[ba],la[ba+1],la[ba+2]);ea&&n.transformMat4(na,na,ea);Da(ca,na,xa);fa[ia]=D.END;fa[ia+1]=ha};return da}();const G={color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleOffColor:null,stipplePreferContinuous:!0,sceneHasOcludees:!1,...q.DefaultMaterialParameters},L=f.create(),H=f.create(),M=f.create(),K=f.create(),I=h.createRenderScreenPointArray3(),O=h.createRenderScreenPointArray3(),Q=f.create(),J=f.create(),P=k.create(),N=k.create(),R=f.create(),S=[h.createRenderScreenPointArray3(),
h.createRenderScreenPointArray3(),h.createRenderScreenPointArray3(),h.createRenderScreenPointArray3()],T=[f.create(),f.create(),f.create(),f.create()],V=e.create(),W=e.create(),U=e.create(),aa=e.create();a.NativeLineMaterial=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/NativeLineTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../../chunks/NativeLine.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r){e=function(x){function u(y,A,p){A=x.call(this,y,A,p)||this;A.stipplePattern=null;A.stippleTextureBind=null;A.stippleTextureRepository=y.stippleTextureRepository;return A}c._inheritsLoose(u,x);var E=u.prototype;E.initializeProgram=function(y){var A=u.shader.get();const p=this.configuration;A=A.build({output:p.output,attributeColor:p.vertexColors,slicePlaneEnabled:p.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,draped:p.draped,
stippleEnabled:this.stippleEnabled,stippleOffColorEnabled:p.stippleOffColorEnabled,stippleRequiresClamp:!1,stippleScaleWithLineWidth:!1,stipplePreferContinuous:p.stipplePreferContinuous});return new z.Program(y.rctx,A,m.Default3D)};E.destroy=function(){x.prototype.destroy.call(this);this.stippleTextureRepository.release(this.stipplePattern);this.stippleTextureBind=this.stipplePattern=null};E.bindPass=function(y,A){l.bindProjectionMatrix(this.program,A.camera.projectionMatrix);if(this.stipplePattern!==
y.stipplePattern){const p=y.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,p);this.stipplePattern=p}if(this.stippleEnabled){const {pixelSize:p,sdfNormalizer:B,pixels:D}=h.isSome(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",B);this.program.setUniform1f("stipplePatternTextureSize",D);this.program.setUniform1f("stipplePatternPixelSize",p);this.program.setUniform1f("stipplePatternPixelSizeInv",
1/p);this.program.setUniform1f("pixelRatio",A.camera.pixelRatio);this.configuration.draped?this.program.setUniform1f("worldToScreenRatio",1/A.screenToPCSRatio):this.program.setUniform1f("worldToScreenPerDistanceRatio",1/A.camera.perScreenPixelRatio);this.program.setUniform2f("ndcToPixel",A.camera.fullViewport[2]/2,A.camera.fullViewport[3]/2)}this.program.setUniform4fv("constantColor",y.color);this.program.setUniform1f("alphaCoverage",Math.min(1,y.width*A.camera.pixelRatio));this.configuration.stippleOffColorEnabled&&
(y=h.unwrap(y.stippleOffColor),this.program.setUniform4f("stippleOffColor",y[0],y[1],y[2],3<y.length?y[3]:1));this.configuration.output===w.ShaderOutput.Highlight&&f.bindOutputHighlight(this.program,A)};E.bindDraw=function(y){l.bindView(this.program,y);this.stippleEnabled&&!this.configuration.draped&&l.bindCameraPosition(this.program,y.origin,y.camera.viewInverseTransposeMatrix);n.bindSliceUniformsWithOrigin(this.program,this.configuration,y);this.program.rebindTextures()};E.initializePipeline=function(){const y=
this.configuration,A=r.separateBlendingParams(t.BlendFactor.SRC_ALPHA,t.BlendFactor.ONE,t.BlendFactor.ONE_MINUS_SRC_ALPHA,t.BlendFactor.ONE_MINUS_SRC_ALPHA),p=(B,D=null,C=null)=>r.makePipelineState({blending:D,depthTest:v.depthCompareLess,depthWrite:C,colorWrite:r.defaultColorWriteParams,stencilWrite:y.sceneHasOcludees?v.stencilWriteMaskOn:null,stencilTest:y.sceneHasOcludees?B?v.stencilToolMaskBaseParams:v.stencilBaseAllZerosParams:null});return y.output===w.ShaderOutput.Color?(this._occludeePipelineState=
p(!0,y.transparent||this.stippleEnabled?A:null,r.defaultDepthWriteParams),p(!1,y.transparent||this.stippleEnabled?A:null,r.defaultDepthWriteParams)):p(!1)};E.getPipelineState=function(y,A){return A?this._occludeePipelineState:x.prototype.getPipelineState.call(this,y,A)};c._createClass(u,[{key:"stippleEnabled",get:function(){return this.configuration.stippleEnabled&&this.configuration.output!==w.ShaderOutput.Highlight}},{key:"primitiveType",get:function(){return t.PrimitiveType.LINES}}]);return u}(e.ShaderTechnique);
e.shader=new k.ReloadableShaderModule(q.NativeLineShader,()=>new Promise((x,u)=>a(["./NativeLine.glsl"],x,u)));k=function(x){function u(){var E=x.apply(this,arguments)||this;E.output=w.ShaderOutput.Color;E.slicePlaneEnabled=!1;E.vertexColors=!1;E.transparent=!1;E.draped=!1;E.stippleEnabled=!1;E.stippleOffColorEnabled=!1;E.stipplePreferContinuous=!0;E.sceneHasOcludees=!1;return E}c._inheritsLoose(u,x);return u}(d.ShaderTechniqueConfiguration);g.__decorate([d.parameter({count:w.ShaderOutput.COUNT})],
k.prototype,"output",void 0);g.__decorate([d.parameter()],k.prototype,"slicePlaneEnabled",void 0);g.__decorate([d.parameter()],k.prototype,"vertexColors",void 0);g.__decorate([d.parameter()],k.prototype,"transparent",void 0);g.__decorate([d.parameter()],k.prototype,"draped",void 0);g.__decorate([d.parameter()],k.prototype,"stippleEnabled",void 0);g.__decorate([d.parameter()],k.prototype,"stippleOffColorEnabled",void 0);g.__decorate([d.parameter()],k.prototype,"stipplePreferContinuous",void 0);g.__decorate([d.parameter()],
k.prototype,"sceneHasOcludees",void 0);b.NativeLineTechnique=e;b.NativeLineTechniqueConfiguration=k;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/NativeLine.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){function d(z){const v=new k.ShaderBuilder;v.include(g.Transform,{linearDepth:!1});v.include(h.VertexColor,z);v.include(n.LineStipple,{...z,stippleRequiresStretchMeasure:!1});v.vertex.uniforms.add("proj","mat4").add("view","mat4");z.stippleEnabled&&(v.vertex.uniforms.add("ndcToPixel","vec2"),v.attributes.add(e.VertexAttribute.UV0,"vec2"),v.attributes.add(e.VertexAttribute.AUXPOS1,"vec3"));v.attributes.add(e.VertexAttribute.POSITION,"vec3");v.varyings.add("vpos","vec3");
v.vertex.code.add(l.glsl`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`);z.stippleEnabled&&(v.vertex.code.add(l.glsl`vec4 vpos2 = transformPosition(proj, view, auxpos1);
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),z.draped||v.vertex.code.add(l.glsl`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),v.vertex.code.add(l.glsl`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),z.draped?v.vertex.code.add(l.glsl`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):v.vertex.code.add(l.glsl`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),v.vertex.code.add(l.glsl`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`));v.vertex.code.add(l.glsl`}`);z.output===b.ShaderOutput.Highlight&&v.include(w.OutputHighlight);v.include(c.Slice,z);v.fragment.uniforms.add("constantColor","vec4").add("alphaCoverage","float");v.fragment.code.add(l.glsl`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${z.attributeColor?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${l.glsl.float(f.symbolAlphaCutoff)}) {
      discard;
    }

    ${z.output===b.ShaderOutput.Color?l.glsl`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${z.output===b.ShaderOutput.Highlight?l.glsl`outputHighlight();`:""}
  }
  `);return v}const m=Object.freeze({__proto__:null,build:d});a.NativeLineShader=m;a.build=d})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../symbols/support/ObjectSymbol3DLayerResource ../../../../symbols/support/symbolLayerUtils3D ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DLodInstanceGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./Loadable ./lodResourceUtils ./objectResourceUtils ./pointUtils ./primitiveObjectSymbolUtils ./symbolComplexity ../support/FastSymbolUpdates ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/lib/lodRendering/LodRenderer ../../webgl-engine/lib/lodRendering/LodResources ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H,M,K){x=function(N){function R(T,V,W,U){T=N.call(this,T,V,W,U)||this;T._resources=null;T._optionalFields=[];T._instanceIndexToGraphicUid=new Map;T.hasLoadedPBRTextures=!1;T.ensureDrapedStatus(!1);T.hasLoadedPBRTextures=W.physicalBasedRenderingEnabled;return T}b._inheritsLoose(R,N);var S=R.prototype;S.getCachedSize=function(){const [T,V,W]=g.isSome(this._resources)?this._resources.symbolSize:[1,1,1];return{width:T,depth:V,height:W}};
S.doLoad=function(){var T=b._asyncToGenerator(function*(V){if(!this._drivenProperties.size&&u.validateSymbolLayerSize(this.symbolLayer))throw Error();const W=this.symbolLayer;this._resources=this.isPrimitive?yield this._createResourcesForPrimitive(W.resource?W.resource.primitive:m.defaultPrimitive,V):yield this._createResourcesForUrl(W.resource.href,V);this.layerOpacityChanged();this.slicePlaneEnabledChanged();this.physicalBasedRenderingChanged();this.complexity=this.computeComplexity()});return function(V){return T.apply(this,
arguments)}}();S._setMaterialTransparencyParams=function(T,V=g.get(this.symbolLayer,"material","color")){V=this._getCombinedOpacity(V);const W=1>V||this.needsDrivenTransparentPass;T.transparent=W;T.opacity=V;T.cullFace=W?G.CullFaceOptions.None:G.CullFaceOptions.Back;return T};S._createResourcesForPrimitive=function(){var T=b._asyncToGenerator(function*(V,W){if(!D.isValidPrimitive(V))throw Error(`Unknown object symbol primitive: ${V}`);var U=this.symbolLayer;const aa=d.create(z.objectSymbolLayerPrimitiveBoundingBox(V)),
da=l.fromArray(d.size(aa)),Y=l.fromArray(z.objectSymbolLayerSizeWithResourceSize(da,U)),ea=f.length(Y);var ja={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,instanced:["transformation"],ambient:l.ONES,diffuse:l.ONES,slicePlaneEnabled:this._context.slicePlaneEnabled,sliceHighlightDisabled:!0,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive};const la=ja.usePBR;this._setMaterialTransparencyParams(ja);const ia=this.symbol;if("point-3d"===
ia.type&&ia.verticalOffset){const {screenLength:ca,minWorldLength:fa,maxWorldLength:ba}=ia.verticalOffset;ja.verticalOffset={screenLength:h.pt2px(ca),minWorldLength:fa||0,maxWorldLength:null!=ba?ba:Infinity};ja.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(ja.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);this._drivenProperties.color?ja.externalColor=k.ONES:(U=g.isSome(U.material)&&U.material.color,U=g.isSome(U)?c.toUnitRGBA(U):k.ONES,ja.externalColor=
U);this._fastUpdates=F.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(aa,Y,da,g.none));this._fastUpdates.enabled?(Object.assign(ja,this._fastUpdates.materialParameters),ja.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(ja.instanced.push("color"),this._optionalFields.push("color"));ja=new K.DefaultMaterial(ja);ja=D.primitiveLodResources(V,ja);if(!ja)throw Error(`Unknown object symbol primitive: ${V}`);
V=M.materialsFromLodResources(ja).map(ca=>({opacity:1,transparent:ca.parameters.transparent}));U=yield this._createStageResources(ja,la);W=yield this._createLodRenderer(ja,W);return{lodResources:ja,lodRenderer:W,stageResources:U,symbolSize:Y,extentPadding:ea,isEsriSymbolResource:!1,isWosr:!1,originalMaterialParameters:V,physicalBasedRenderingEnabled:la,resourceBoundingBox:aa,resourceSize:da,dispose:g.none,pivotOffset:g.none}});return function(V,W){return T.apply(this,arguments)}}();S._createResourcesForUrl=
function(){var T=b._asyncToGenerator(function*(V,W){var U=["transformation"],aa={materialParamsMixin:{instanced:U,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=F.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(g.none,g.none,g.none,g.none));this._fastUpdates.enabled?(Object.assign(aa.materialParamsMixin,
this._fastUpdates.materialParameters),U.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(U.push("color"),this._optionalFields.push("color"));U=this.symbol;if("point-3d"===U.type&&U.verticalOffset){const {screenLength:xa,minWorldLength:Da,maxWorldLength:ua}=U.verticalOffset;aa.materialParamsMixin.verticalOffset={screenLength:h.pt2px(xa),minWorldLength:Da||0,maxWorldLength:null!=ua?ua:Infinity};aa.materialParamsMixin.castShadows=!1}aa.signal=W;aa.usePBR=
this._context.physicalBasedRenderingEnabled;U=aa.usePBR;var da=yield p.fetch(V,aa);V=da.isEsriSymbolResource;aa=da.isWosr;const Y=da.remove,ea=A.makeLodResources(da.lods);A.fillEstimatedMinScreenSpaceRadius(ea);ea.levels.sort((xa,Da)=>xa.minScreenSpaceRadius-Da.minScreenSpaceRadius);ea.levels[0].minScreenSpaceRadius=Math.min(2,ea.levels[0].minScreenSpaceRadius);const ja=this._context,la=this._getExternalColorParameters(this.symbolLayer.material);var ia=g.get(this.symbolLayer,"material","color");const ca=
this._getCombinedOpacity(ia,{hasIntrinsicColor:!0}),fa=this.needsDrivenTransparentPass;var ba=M.materialsFromLodResources(ea);ia=M.materialsFromLodResources(ea).map(xa=>({opacity:xa.parameters.opacity||1,transparent:xa.parameters.transparent}));ba.forEach(xa=>{const Da=xa.parameters;xa.setParameters(la);const ua=Da.opacity*ca;xa.setParameters({opacity:ua,transparent:1>ua||fa||Da.transparent});ja.screenSizePerspectiveEnabled&&xa.setParameters({screenSizePerspective:ja.sharedResources.screenSizePerspectiveSettings})});
da=da.referenceBoundingBox;const Z=l.fromArray(d.size(da)),ha=l.fromArray(ea.levels[0].pivotOffset),na=l.fromArray(z.objectSymbolLayerSizeWithResourceSize(Z,this.symbolLayer)),pa=f.length(na);F.updateFastSymbolUpdatesState(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(da,na,Z,ha))&&ba.forEach(xa=>xa.setParameters(this._fastUpdates.materialParameters));ba=yield this._createStageResources(ea,U);W=yield this._createLodRenderer(ea,W);return{lodResources:ea,lodRenderer:W,
stageResources:ba,symbolSize:na,extentPadding:pa,isEsriSymbolResource:V,isWosr:aa,originalMaterialParameters:ia,physicalBasedRenderingEnabled:U,resourceBoundingBox:da,resourceSize:Z,dispose:Y,pivotOffset:ha}});return function(V,W){return T.apply(this,arguments)}}();S._createStageResources=function(){var T=b._asyncToGenerator(function*(V,W){const U=this._context.stage,aa=M.materialsFromLodResources(V);W!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged();U.addMany(aa);
W=M.texturesFromLodResources(V);U.addMany(W);yield U.load(W);V=M.geometriesFromLodResources(V);U.addMany(V);return{materials:aa,textures:W,geometries:V}});return function(V,W){return T.apply(this,arguments)}}();S._createLodRenderer=function(){var T=b._asyncToGenerator(function*(V,W){const U=this._context.stage;V=new H.LodRenderer(V,this._optionalFields,{layerUid:this._context.layer.uid,graphicUid:aa=>this._instanceIndexToGraphicUid.get(aa),notifyGraphicGeometryChanged:aa=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(aa)),
notifyGraphicVisibilityChanged:aa=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(aa))},this._fastUpdates.enabled?{applyTransform:(aa,da,Y)=>{aa.getFeatureAttribute(da,J);w.copy(Y,F.evaluateModelTransform(this._fastUpdates.materialParameters,J,Y))},scaleFactor:(aa,da,Y)=>{da.getFeatureAttribute(Y,J);return F.evaluateModelTransformScale(aa,this._fastUpdates.materialParameters,J)}}:null);V.slicePlaneEnabled=this._context.slicePlaneEnabled;yield U.addRenderPlugin(V.slots,
V,W);return V});return function(V,W){return T.apply(this,arguments)}}();S._getExternalColorParameters=function(T){const V={};this._drivenProperties.color?V.externalColor=k.ONES:g.isSome(T)&&g.isSome(T.color)?V.externalColor=c.toUnitRGBA(T.color):(V.externalColor=k.ONES,V.colorMixMode="ignore");return V};S.destroy=function(){N.prototype.destroy.call(this);if(g.isSome(this._resources)){const T=this._context.stage;T.removeRenderPlugin(this._resources.lodRenderer);const V=this._resources.stageResources;
T.removeMany(V.materials);T.removeMany(V.textures);T.removeMany(V.geometries);g.isSome(this._resources.dispose)&&this._resources.dispose();this._resources=null}};S.createGraphics3DGraphic=function(T){const V=T.graphic;if(!this._validateGeometry(V.geometry))return null;const W=B.placePointOnGeometry(V.geometry);if(g.isNone(W))return this.logger.warn(`unsupported geometry type for icon symbol: ${V.geometry.type}`),null;const U=this.setGraphicElevationContext(V,new t.ElevationContext);return this._createAs3DShape(V,
W,T.renderingInfo,U,V.uid)};S.notifyDestroyGraphicLayer=function(T){this._instanceIndexToGraphicUid.delete(T.instanceIndex)};S.graphicLayerToGraphicId=function(){return 0};S.layerOpacityChanged=function(){if(g.isNone(this._resources))return!0;const T=this._drivenProperties.opacity,V=!this.isPrimitive,W=this._resources.stageResources.materials,U=this._resources.originalMaterialParameters;for(let Y=0;Y<W.length;Y++){const ea=W[Y];var aa=g.get(this.symbolLayer,"material","color"),da=U[Y];aa=this._getCombinedOpacity(aa,
{hasIntrinsicColor:V})*da.opacity;da=1>aa||T||da.transparent;ea.setParameters({opacity:aa,transparent:da});this.isPrimitive&&ea.setParameters({cullFace:da?G.CullFaceOptions.None:G.CullFaceOptions.Back})}return!0};S.layerElevationInfoChanged=function(T,V){return this.updateGraphics3DGraphicElevationInfo(T,V,q.needsElevationUpdates3D)};S.slicePlaneEnabledChanged=function(){if(g.isNone(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const T of this._resources.stageResources.materials)T.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled});
return!0};S.physicalBasedRenderingChanged=function(){if(g.isNone(this._resources))return!0;const {stageResources:T,isWosr:V}=this._resources;for(const W of T.materials)this.isPrimitive?W.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):V||W.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return!1===this.hasLoadedPBRTextures&&!0===this._context.physicalBasedRenderingEnabled?(this.hasLoadedPBRTextures=!0,!1):!0};S.pixelRatioChanged=
function(){return!0};S.applyRendererDiff=function(T,V){if(g.isNone(this._resources))return E.ApplyRendererDiffResult.Recreate_Symbol;const {stageResources:{materials:W},lodRenderer:U,resourceBoundingBox:aa,symbolSize:da,resourceSize:Y,pivotOffset:ea}=this._resources;for(const ja in T.diff)switch(ja){case "visualVariables":if(F.updateFastSymbolUpdatesState(this._fastUpdates,V,this._fastVisualVariableConvertOptions(aa,da,Y,ea))){for(const la of W)la.setParameters(this._fastUpdates.materialParameters);
U.notifyShaderTransformationChanged()}else return E.ApplyRendererDiffResult.Recreate_Symbol;break;default:return E.ApplyRendererDiffResult.Recreate_Symbol}return E.ApplyRendererDiffResult.Fast_Update};S.computeComplexity=function(){if(g.isNone(this._resources))return N.prototype.computeComplexity.call(this);const T=M.geometriesFromLodLevelResources(this._resources.lodResources.levels[0]).reduce((W,U)=>W+U.indices.get(L.VertexAttribute.POSITION).length,0)/3,V=C.defaultSymbolLayerMemoryComplexity(this.symbol,
this.symbolLayer);return{primitivesPerFeature:T,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:V}};S._hasLodRenderer=function(){return g.isSome(this._resources)};S._createAs3DShape=function(T,V,W,U,aa){if(!this._hasLodRenderer()||g.isNone(this._resources))return null;T=this.getFastUpdateAttrValues(T);const da=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?u.mixinColorAndOpacity(W.color,W.opacity):null;var Y=this._context.clippingExtent;e.projectPointToVector(V,I,this._context.elevationProvider.spatialReference);
if(g.isSome(Y)&&!d.containsPoint(Y,I))return null;Y=this._requiresTerrainElevation(U);const ea=this._computeGlobalTransform(V,U,Q,P);W=this._computeLocalTransform(this._resources,this.symbolLayer,W,O);const ja=this._resources.lodRenderer.instanceData,la=ja.addInstance();this._instanceIndexToGraphicUid.set(la,aa);ja.setLocalTransform(la,W,!1);ja.setGlobalTransform(la,ea);T&&ja.setFeatureAttribute(la,T);da&&ja.setColor(la,da);aa=new r(this,la,v.perLodInstanceElevationAligner,U);Y&&(aa.alignedSampledElevation=
P.sampledElevation);aa.needsElevationUpdates=q.needsElevationUpdates3D(U.mode);B.extendPointGraphicElevationContext(aa,V,this._context.elevationProvider);return aa};S._computeGlobalTransform=function(T,V,W,U){q.evaluateElevationInfoAtPoint(T,this._context.elevationProvider,V,this._context.renderCoordsHelper,U);I[0]=T.x;I[1]=T.y;I[2]=U.z;e.computeTranslationToOriginAndRotation(T.spatialReference,I,W,this._context.renderCoordsHelper.spatialReference);return W};S._computeLocalTransform=function(T,V,
W,U){w.identity(U);this._applyObjectRotation(W,!1,U);this._applyObjectRotation(V,!0,U);this._applyObjectScale(T,W,U);this._applyAnchor(T,V,U);return U};S._applyObjectScale=function(T,V,W){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(T=u.computeObjectScale(this._drivenProperties.size&&V.size?V.size:T.symbolSize,T.symbolSize,T.resourceSize,this._context.renderCoordsHelper.unitInMeters),1===T[0]&&1===T[1]&&1===T[2]||w.scale(W,W,T))};S.prepareSymbolLayerPatch=function(T){if("partial"===
T.diff.type){var V=T.diff.diff;this._preparePatchTransform(T,V);this._preparePatchColor(T,V)}};S.updateGeometry=function(T,V){if(g.isNone(this._resources))return!0;const W=V&&B.placePointOnGeometry(V);if(g.isNone(W))return!1;V=this.getGeometryElevationMode(V);if(T.elevationContext.mode!==V)return!1;this._computeGlobalTransform(W,T.elevationContext,Q,P);this._requiresTerrainElevation(T.elevationContext)&&(T.alignedSampledElevation=P.sampledElevation);this._resources.lodRenderer.instanceData.setGlobalTransform(T.instanceIndex,
Q,!0);B.extendPointGraphicElevationContext(T,W,this._context.elevationProvider);return!0};S._preparePatchTransform=function(T,V){if((V.heading||V.tilt||V.roll||V.width||V.height||V.depth||V.anchor||V.anchorPosition)&&!g.isNone(this._resources)){var W=(fa,ba,Z)=>g.unwrapOr(null!=fa&&"complete"===fa.type?fa.newValue:ba,Z),U=W(V.heading,this.symbolLayer.heading,0),aa=W(V.tilt,this.symbolLayer.tilt,0),da=W(V.roll,this.symbolLayer.roll,0),Y=W(V.width,this.symbolLayer.width,void 0),ea=W(V.height,this.symbolLayer.height,
void 0),ja=W(V.depth,this.symbolLayer.depth,void 0),la=W(V.anchor,this.symbolLayer.anchor,void 0);W=W(V.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete V.heading;delete V.tilt;delete V.roll;delete V.width;delete V.height;delete V.depth;delete V.anchor;delete V.anchorPosition;var ia={heading:U,tilt:aa,roll:da,anchor:la,anchorPosition:W},ca=this._resources;this.loadStatus===y.LoadStatus.LOADED&&T.symbolLayerStatePatches.push(()=>{ca.symbolSize=l.fromArray(z.objectSymbolLayerSizeWithResourceSize(ca.resourceSize,
{width:Y,height:ea,depth:ja,isPrimitive:this.symbolLayer.isPrimitive}))});T.graphics3DGraphicPatches.push((fa,ba)=>{ba=this._computeLocalTransform(ca,ia,ba,O);ca.lodRenderer.instanceData.setLocalTransform(fa.instanceIndex,ba,!0)})}};S._preparePatchColor=function(T,V){if(V.material&&"partial"===V.material.type&&(V=V.material.diff,V.color&&"complete"===V.color.type&&null!=V.color.newValue&&null!=V.color.oldValue)){var W=V.color.newValue,U=g.isSome(W)?c.toUnitRGBA(W):k.ONES;delete V.color;var aa=this._resources;
g.isNone(aa)||T.graphics3DGraphicPatches.push(da=>{this._hasPerInstanceColor()?(aa.lodRenderer.instanceData.setColor(da.instanceIndex,U),da=this._setMaterialTransparencyParams({},W)):da=this._setMaterialTransparencyParams({externalColor:U},W);for(const Y of aa.stageResources.materials)Y.setParameters(da)})}};S._requiresTerrainElevation=function(T){return"absolute-height"!==T.mode};S._applyObjectRotation=function(T,V,W){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&
V))return u.computeObjectRotation(T.heading,T.tilt,T.roll,W)};S._computeAnchor=function(T,V,W){const U=l.create();switch(W.anchor){case "center":f.copy(U,d.center(T));f.negate(U,U);break;case "top":V=d.center(T);f.set(U,-V[0],-V[1],-T[5]);break;case "bottom":V=d.center(T);f.set(U,-V[0],-V[1],-T[2]);break;case "relative":V=d.center(T);T=d.size(T);W=(W=W.anchorPosition)?l.fromValues(W.x,W.y,W.z):l.ZEROS;f.multiply(U,T,W);f.add(U,U,V);f.negate(U,U);break;default:g.isSome(V)?f.negate(U,V):f.copy(U,l.ZEROS)}return U};
S._applyAnchor=function(T,V,W){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(T=this._computeAnchor(T.resourceBoundingBox,T.pivotOffset,V))&&w.translate(W,W,T)};S._hasPerInstanceColor=function(){return this._drivenProperties.color||this._drivenProperties.opacity};S._fastVisualVariableConvertOptions=function(T,V,W,U){const aa=g.isSome(T)?l.fromArray(d.size(T)):l.ONES;T=g.isSome(T)?this._computeAnchor(T,U,this.symbolLayer):l.ZEROS;U=this._context.renderCoordsHelper.unitInMeters;
W=u.computeObjectScale(g.isSome(V)?V:void 0,V,W,U);const da=l.fromValues(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:aa,symbolSize:g.isSome(V)?V:l.ONES,unitInMeters:U,transformation:{anchor:T,scale:W,rotation:da}}};b._createClass(R,[{key:"extentPadding",get:function(){return g.isSome(this._resources)?this._resources.extentPadding:0}},{key:"isPrimitive",get:function(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}},{key:"lodRenderer",
get:function(){return g.get(this._resources,"lodRenderer")}}]);return R}(x.Graphics3DSymbolLayer);const I=l.create(),O=n.create(),Q=n.create(),J=k.create(),P=new q.SampleElevationInfo;a.Graphics3DObjectSymbolLayer=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Object3DStateID".split(" "),
function(a,b,c,g,h,w,n,f,l,k){let e=function(){function t(x,u,E,y){this.graphics3DSymbolLayer=x;this.instanceIndex=u;this.elevationAligner=E;this.elevationContext=y;this.type="lod-instance";this._highlights=new Set;this.alignedSampledElevation=0;this.needsElevationUpdates=this.isElevationSource=!1}var r=t.prototype;r.initialize=function(){};r.setVisibility=function(x){const u=this.lodRenderer.instanceData;x!==u.getVisible(this.instanceIndex)&&u.setVisible(this.instanceIndex,x)};r.destroy=function(){null!=
this.instanceIndex&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))};r.alignWithElevation=function(x,u,E){this.elevationAligner&&(n.setContextFeature(this.elevationContext.featureExpressionInfoContext,E),x=this.elevationAligner(this,this.elevationContext,x,u),b.isSome(x)&&(this.alignedSampledElevation=x))};r.getCenterObjectSpace=function(x=h.create()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,
q);return g.transformMat4(x,this.lodRenderer.baseBoundingSphere.center,q)};r.getBoundingBoxObjectSpace=function(x=w.create()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,q);const u=this.lodRenderer.baseBoundingBox;w.empty(x);for(let E=0;8>E;++E)g.set(m,0===(E&1)?u[0]:u[3],0===(E&2)?u[1]:u[4],0===(E&4)?u[2]:u[5]),g.transformMat4(m,m,q),w.expandWithVec3(x,m);return x};r.computeAttachmentOrigin=function(x){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,
q);x.render.origin[0]+=q[12];x.render.origin[1]+=q[13];x.render.origin[2]+=q[14];x.render.num++};r.getProjectedBoundingBox=function(){var x=a._asyncToGenerator(function*(u,E,y,A,p){p=this.getBoundingBoxObjectSpace(p);var B=v;const D=w.isPoint(p)?1:B.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,q);for(var C=0;C<D;C++){const F=B[C];m[0]=p[F[0]];m[1]=p[F[1]];m[2]=p[F[2]];g.transformMat4(m,m,q);d[3*C]=m[0];d[3*C+1]=m[1];d[3*C+2]=m[2]}if(!u(d,0,D))return null;w.empty(p);u=
null;this.calculateRelativeScreenBounds&&(u=this.calculateRelativeScreenBounds());for(B=0;B<3*D;B+=3){for(C=0;3>C;C++)p[C]=Math.min(p[C],d[B+C]),p[C+3]=Math.max(p[C+3],d[B+C]);u&&y.push({location:d.slice(B,B+3),screenSpaceBoundingRect:u})}if(E&&(w.center(p,z),"absolute-height"!==this.elevationContext.mode)){let F;y=f.demResolutionForBoundingBox(p,E);try{F=yield E.service.queryElevation(z[0],z[1],A,y,"ground")}catch(G){}b.isSome(F)&&w.offset(p,0,0,-this.alignedSampledElevation+F)}return p});return function(u,
E,y,A,p){return x.apply(this,arguments)}}();r.addObjectState=function(x,u){x===l.Object3DState.Highlight&&(x=new k.Object3DStateID(x),this._addHighlightId(x),u.addExternal(E=>{this._removeHighlightId(E)},x))};r.removeObjectState=function(x){this._highlights.forEach(u=>x.remove(u))};r._addHighlightId=function(x){this._highlights.add(x);this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)};r._removeHighlightId=function(x){this._highlights.delete(x);this.lodRenderer.instanceData.setHighlight(this.instanceIndex,
0<this._highlights.size)};a._createClass(t,[{key:"lodRenderer",get:function(){return this.graphics3DSymbolLayer.lodRenderer}}]);return t}();const d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],m=h.create(),z=h.create(),v=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],q=c.create();return e})},"esri/views/3d/layers/graphics/lodResourceUtils":function(){define(["exports","../../webgl-engine/lib/lodRendering/LodResources"],function(a,b){function c(h){const w=[];h.stageResources.geometries.forEach((n,
f)=>{w.push({material:h.stageResources.materials[f],geometry:n,textures:h.stageResources.textures})});return{components:w,minScreenSpaceRadius:h.lodThreshold,pivotOffset:h.pivotOffset}}function g(h,w=.05){h=b.computeFaceCount(h);return Math.sqrt(h/(w*Math.PI))}a.estimateMinScreenSpaceRadius=g;a.fillEstimatedMinScreenSpaceRadius=function(h){h.levels.forEach(w=>{w.minScreenSpaceRadius||(w.minScreenSpaceRadius=g(w))})};a.makeLodLevelResources=c;a.makeLodResources=function(h){return{levels:h.map(w=>c(w))}};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/devEnvironmentUtils ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec32 ../../../../chunks/vec42 ../../../../geometry/support/buffer/utils ../../glTF/DefaultLoadingContext ../../glTF/loader ../../glTF/internal/indexUtils ./wosrLoader ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/DefaultMaterial_COLOR_GAMMA ../../../webgl/enums ../../../../chunks/vec22 ../../../../chunks/vec43 ../../../../chunks/vec33".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G){function L(){L=b._asyncToGenerator(function*(K,I){var O=H(c.adjustStaticAGOUrl(K));if("wosr"===O.fileType)return K=yield I.cache?I.cache.loadWOSR(O.url,I):x.load(O.url,I),O=x.processLoadResult(K,I),{lods:[O],referenceBoundingBox:O.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:K.remove};K=yield I.cache?I.cache.loadGLTF(O.url,I,I.usePBR):t.load(new q.DefaultLoadingContext(I.streamDataRequester),O.url,I,I.usePBR);var Q=g.get(K.model.meta,
"ESRI_proxyEllipsoid");if(K.meta.isEsriSymbolResource&&g.isSome(Q)&&-1!==K.meta.uri.indexOf("/RealisticTrees/"))a:for(var J=0;J<K.model.lods.length;++J){var P=K.model.lods[J];K.customMeta.esriTreeRendering=!0;for(var N of P.parts){P=N.attributes.normal;if(g.isNone(P))break a;const S=N.attributes.position,T=S.count,V=k.create(),W=k.create(),U=k.create(),aa=v.createBuffer(d.BufferViewVec4u8,T),da=v.createBuffer(d.BufferViewVec3f,T),Y=n.invert(f.create(),N.transform);for(let ea=0;ea<T;ea++){S.getVec(ea,
W);P.getVec(ea,V);l.transformMat4(W,W,N.transform);l.subtract(U,W,Q.center);l.divide(U,U,Q.radius);const ja=U[2];var R=l.length(U);R=Math.min(.45+.55*R*R,1);l.divide(U,U,Q.radius);l.transformMat4(U,U,Y);l.normalize(U,U);J+1!==K.model.lods.length&&1<K.model.lods.length&&(-1<ja?l.lerp(U,U,V,.2):l.lerp(U,U,V,Math.min(-4*ja-3.8,1)));da.setVec(ea,U);aa.set(ea,0,255*R);aa.set(ea,1,255*R);aa.set(ea,2,255*R);aa.set(ea,3,255)}N.attributes.normal=da;N.attributes.color=aa}}N=K.meta.isEsriSymbolResource?{usePBR:I.usePBR,
isSchematic:!1,treeRendering:K.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:I.usePBR,isSchematic:!1,mrrFactors:[0,1,.5]};I={...I.materialParamsMixin,treeRendering:K.customMeta.esriTreeRendering};if(null!=O.specifiedLodIndex)return Q=M(K,N,I,O.specifiedLodIndex),J=Q[0].boundingBox,0!==O.specifiedLodIndex&&(J=M(K,N,I,0)[0].boundingBox),{lods:Q,referenceBoundingBox:J,isEsriSymbolResource:K.meta.isEsriSymbolResource,isWosr:!1,remove:K.remove};O=M(K,N,I);return{lods:O,referenceBoundingBox:O[0].boundingBox,
isEsriSymbolResource:K.meta.isEsriSymbolResource,isWosr:!1,remove:K.remove}});return L.apply(this,arguments)}function H(K){const I=K.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return I?{fileType:"gltf",url:I[1],specifiedLodIndex:null!=I[4]?Number(I[4]):null}:K.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:K,specifiedLodIndex:null}:{fileType:"unknown",url:K,specifiedLodIndex:null}}function M(K,I,O,Q){const J=K.model,P=w.create(),N=[],R=new Map,S=new Map;J.lods.forEach((T,V)=>{if(void 0===Q||
V===Q){var W={name:T.name,stageResources:{textures:[],materials:[],geometries:[]},lodThreshold:g.isSome(T.lodThreshold)?T.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:e.empty()};N.push(W);T.parts.forEach(U=>{var aa=U.material+(U.attributes.normal?"_normal":"")+(U.attributes.color?"_color":"")+(U.attributes.texCoord0?"_texCoord0":"")+(U.attributes.tangent?"_tangent":"");const da=J.materials.get(U.material),Y=g.isSome(U.attributes.texCoord0);var ea=g.isSome(U.attributes.normal);
a:{switch(da.alphaMode){case "BLEND":var ja=u.AlphaDiscardMode.Blend;break a;case "MASK":ja=u.AlphaDiscardMode.Mask;break a;case "OPAQUE":case null:case void 0:ja=u.AlphaDiscardMode.Opaque;break a}ja=void 0}if(!R.has(aa)){if(Y){if(g.isSome(da.textureColor)&&!S.has(da.textureColor)){var la=J.textures.get(da.textureColor);S.set(da.textureColor,new y.Texture(la.data,{...la.parameters,preMultiplyAlpha:ja!==u.AlphaDiscardMode.Opaque}))}g.isSome(da.textureNormal)&&!S.has(da.textureNormal)&&(la=J.textures.get(da.textureNormal),
S.set(da.textureNormal,new y.Texture(la.data,la.parameters)));g.isSome(da.textureOcclusion)&&!S.has(da.textureOcclusion)&&(la=J.textures.get(da.textureOcclusion),S.set(da.textureOcclusion,new y.Texture(la.data,la.parameters)));g.isSome(da.textureEmissive)&&!S.has(da.textureEmissive)&&(la=J.textures.get(da.textureEmissive),S.set(da.textureEmissive,new y.Texture(la.data,la.parameters)));g.isSome(da.textureMetallicRoughness)&&!S.has(da.textureMetallicRoughness)&&(la=J.textures.get(da.textureMetallicRoughness),
S.set(da.textureMetallicRoughness,new y.Texture(la.data,la.parameters)))}la=da.color[0]**(1/B.COLOR_GAMMA);var ia=da.color[1]**(1/B.COLOR_GAMMA),ca=da.color[2]**(1/B.COLOR_GAMMA),fa=da.emissiveFactor[0]**(1/B.COLOR_GAMMA);const ba=da.emissiveFactor[1]**(1/B.COLOR_GAMMA),Z=da.emissiveFactor[2]**(1/B.COLOR_GAMMA),ha=g.isSome(da.textureColor)&&Y?S.get(da.textureColor):null;R.set(aa,new p.DefaultMaterial({...I,transparent:ja===u.AlphaDiscardMode.Blend,customDepthTest:u.DepthTestFunction.Lequal,textureAlphaMode:ja,
textureAlphaCutoff:da.alphaCutoff,diffuse:[la,ia,ca],ambient:[la,ia,ca],opacity:da.opacity,doubleSided:da.doubleSided,doubleSidedType:"winding-order",cullFace:da.doubleSided?u.CullFaceOptions.None:u.CullFaceOptions.Back,vertexColors:!!U.attributes.color,vertexTangents:!!U.attributes.tangent,normals:ea?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,fillLightsEnabled:!0,textureId:g.isSome(ha)?ha.id:void 0,colorMixMode:da.colorMixMode,normalTextureId:g.isSome(da.textureNormal)&&Y?S.get(da.textureNormal).id:
void 0,textureAlphaPremultiplied:g.isSome(ha)&&!!ha.params.preMultiplyAlpha,occlusionTextureId:g.isSome(da.textureOcclusion)&&Y?S.get(da.textureOcclusion).id:void 0,emissiveTextureId:g.isSome(da.textureEmissive)&&Y?S.get(da.textureEmissive).id:void 0,metallicRoughnessTextureId:g.isSome(da.textureMetallicRoughness)&&Y?S.get(da.textureMetallicRoughness).id:void 0,emissiveFactor:[fa,ba,Z],mrrFactors:[da.metallicFactor,da.roughnessFactor,I.mrrFactors[2]],isSchematic:!1,...O}))}a:{ea=U.indices||U.attributes.position.count;
switch(U.primitiveType){case D.PrimitiveType.TRIANGLES:ea=r.trianglesToTriangles(ea);break a;case D.PrimitiveType.TRIANGLE_STRIP:ea=r.triangleStripToTriangles(ea);break a;case D.PrimitiveType.TRIANGLE_FAN:ea=r.triangleFanToTriangles(ea);break a}ea=void 0}ja=ea;ea=U.attributes.position.count;la=v.createBuffer(d.BufferViewVec3f,ea);m.transformMat4(la,U.attributes.position,U.transform);la=[[A.VertexAttribute.POSITION,{data:la.typedBuffer,size:la.elementCount,exclusive:!0}]];ia=[[A.VertexAttribute.POSITION,
ja]];g.isSome(U.attributes.normal)&&(ca=v.createBuffer(d.BufferViewVec3f,ea),h.normalFromMat4(P,U.transform),m.transformMat3(ca,U.attributes.normal,P),la.push([A.VertexAttribute.NORMAL,{data:ca.typedBuffer,size:ca.elementCount,exclusive:!0}]),ia.push([A.VertexAttribute.NORMAL,ja]));g.isSome(U.attributes.tangent)&&(ca=v.createBuffer(d.BufferViewVec4f,ea),h.normalFromMat4(P,U.transform),z.transformMat3(ca,U.attributes.tangent,P),la.push([A.VertexAttribute.TANGENT,{data:ca.typedBuffer,size:ca.elementCount,
exclusive:!0}]),ia.push([A.VertexAttribute.TANGENT,ja]));g.isSome(U.attributes.texCoord0)&&(ca=v.createBuffer(d.BufferViewVec2f,ea),C.normalizeIntegerBuffer(ca,U.attributes.texCoord0),la.push([A.VertexAttribute.UV0,{data:ca.typedBuffer,size:ca.elementCount,exclusive:!0}]),ia.push([A.VertexAttribute.UV0,ja]));g.isSome(U.attributes.color)&&(ca=v.createBuffer(d.BufferViewVec4u8,ea),4===U.attributes.color.elementCount?U.attributes.color instanceof d.BufferViewVec4f?z.scale(ca,U.attributes.color,255):
U.attributes.color instanceof d.BufferViewVec4u8?F.copy(ca,U.attributes.color):U.attributes.color instanceof d.BufferViewVec4u16&&z.scale(ca,U.attributes.color,1/256):(F.fill(ca,255,255,255,255),fa=new d.BufferViewVec3u8(ca.buffer,0,4),U.attributes.color instanceof d.BufferViewVec3f?m.scale(fa,U.attributes.color,255):U.attributes.color instanceof d.BufferViewVec3u8?G.copy(fa,U.attributes.color):U.attributes.color instanceof d.BufferViewVec3u16&&m.scale(fa,U.attributes.color,1/256)),la.push([A.VertexAttribute.COLOR,
{data:ca.typedBuffer,size:ca.elementCount,exclusive:!0}]),ia.push([A.VertexAttribute.COLOR,ja]));U=new E.Geometry(la,ia);W.stageResources.geometries.push(U);W.stageResources.materials.push(R.get(aa));Y&&(g.isSome(da.textureColor)&&W.stageResources.textures.push(S.get(da.textureColor)),g.isSome(da.textureNormal)&&W.stageResources.textures.push(S.get(da.textureNormal)),g.isSome(da.textureOcclusion)&&W.stageResources.textures.push(S.get(da.textureOcclusion)),g.isSome(da.textureEmissive)&&W.stageResources.textures.push(S.get(da.textureEmissive)),
g.isSome(da.textureMetallicRoughness)&&W.stageResources.textures.push(S.get(da.textureMetallicRoughness)));W.numberOfVertices+=ea;aa=U.boundingInfo;g.isSome(aa)&&(e.expandWithVec3(W.boundingBox,aa.getBBMin()),e.expandWithVec3(W.boundingBox,aa.getBBMax()))})}});return N}a.fetch=function(K,I){return L.apply(this,arguments)};a.gltfToEngineResources=M;a.parseUrl=H;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/devEnvironmentUtils":function(){define(["exports"],function(a){const b=/^devext.arcgis.com$/,
c=/^qaext.arcgis.com$/,g=/^[\w-]*\.mapsdevext.arcgis.com$/,h=/^[\w-]*\.mapsqa.arcgis.com$/,w=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,b,c,/^jsapps.esri.com$/,g,h];a.adjustStaticAGOUrl=function(n,f){return n?(f=f||globalThis.location.hostname)?null!=f.match(b)||null!=f.match(g)?n.replace("static.arcgis.com","staticdev.arcgis.com"):null!=f.match(c)||null!=f.match(h)?n.replace("static.arcgis.com","staticqa.arcgis.com"):n:n:n};a.isDevEnvironment=function(n){n=n||globalThis.location.hostname;return w.some(f=>
{var l;return null!=(null==(l=n)?void 0:l.match(f))})};a.isTelemetryDevEnvironment=function(n){n=n||globalThis.location.hostname;return[/^zrh-.+?\.esri\.com$/].concat(w).some(f=>{var l;return null!=(null==(l=n)?void 0:l.match(f))})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/vec42":function(){define(["exports","../geometry/support/buffer/math/common"],function(a,b){function c(f,l,k){if(f.count!==l.count)b.mathLogger.error("source and destination buffers need to have the same number of elements");
else{var e=f.count,d=k[0],m=k[1],z=k[2],v=k[3],q=k[4],t=k[5],r=k[6],x=k[7],u=k[8],E=k[9],y=k[10],A=k[11],p=k[12],B=k[13],D=k[14];k=k[15];var C=f.typedBuffer;f=f.typedBufferStride;var F=l.typedBuffer;l=l.typedBufferStride;for(let L=0;L<e;L++){const H=L*f;var G=L*l;const M=F[G],K=F[G+1],I=F[G+2];G=F[G+3];C[H]=d*M+q*K+u*I+p*G;C[H+1]=m*M+t*K+E*I+B*G;C[H+2]=z*M+r*K+y*I+D*G;C[H+3]=v*M+x*K+A*I+k*G}}}function g(f,l,k){if(f.count!==l.count)b.mathLogger.error("source and destination buffers need to have the same number of elements");
else{var e=f.count,d=k[0],m=k[1],z=k[2],v=k[3],q=k[4],t=k[5],r=k[6],x=k[7];k=k[8];var u=f.typedBuffer;f=f.typedBufferStride;var E=l.typedBuffer;l=l.typedBufferStride;for(let A=0;A<e;A++){const p=A*f;var y=A*l;const B=E[y],D=E[y+1],C=E[y+2];y=E[y+3];u[p]=d*B+v*D+r*C;u[p+1]=m*B+q*D+x*C;u[p+2]=z*B+t*D+k*C;u[p+3]=y}}}function h(f,l,k){const e=Math.min(f.count,l.count),d=f.typedBuffer;f=f.typedBufferStride;const m=l.typedBuffer;l=l.typedBufferStride;for(let z=0;z<e;z++){const v=z*f,q=z*l;d[v]=k*m[q];d[v+
1]=k*m[q+1];d[v+2]=k*m[q+2];d[v+3]=k*m[q+3]}}function w(f,l,k){const e=Math.min(f.count,l.count),d=f.typedBuffer;f=f.typedBufferStride;const m=l.typedBuffer;l=l.typedBufferStride;for(let z=0;z<e;z++){const v=z*f,q=z*l;d[v]=m[q]>>k;d[v+1]=m[q+1]>>k;d[v+2]=m[q+2]>>k;d[v+3]=m[q+3]>>k}}const n=Object.freeze({__proto__:null,transformMat4:c,transformMat3:g,scale:h,shiftRight:w});a.scale=h;a.shiftRight=w;a.transformMat3=g;a.transformMat4=c;a.vec4=n})},"esri/geometry/support/buffer/utils":function(){define("exports ./types ../../../chunks/mat32 ../../../chunks/mat42 ../../../chunks/scalar ../../../chunks/vec22 ../../../chunks/vec33 ../../../chunks/vec43".split(" "),
function(a,b,c,g,h,w,n,f){a.mat3=c.mat3;a.mat4=g.mat4;a.scalar=h.scalar;a.vec2=w.vec2;a.vec3=n.vec3;a.vec4=f.vec4;a.createBuffer=function(l,k){return new l(new ArrayBuffer(k*l.ElementCount*b.elementTypeSize(l.ElementType)))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/mat32":function(){define(["exports"],function(a){function b(g,h,w){const n=g.typedBuffer;g=g.typedBufferStride;const f=h.typedBuffer,l=h.typedBufferStride;h=w?w.count:h.count;let k=(w&&w.dstIndex?w.dstIndex:0)*g;
w=(w&&w.srcIndex?w.srcIndex:0)*l;for(let e=0;e<h;++e){for(let d=0;9>d;++d)n[k+d]=f[w+d];k+=g;w+=l}}const c=Object.freeze({__proto__:null,copy:b});a.copy=b;a.mat3=c})},"esri/chunks/mat42":function(){define(["exports"],function(a){function b(g,h,w){const n=g.typedBuffer;g=g.typedBufferStride;const f=h.typedBuffer,l=h.typedBufferStride;h=w?w.count:h.count;let k=(w&&w.dstIndex?w.dstIndex:0)*g;w=(w&&w.srcIndex?w.srcIndex:0)*l;for(let e=0;e<h;++e){for(let d=0;16>d;++d)n[k+d]=f[w+d];k+=g;w+=l}}const c=Object.freeze({__proto__:null,
copy:b});a.copy=b;a.mat4=c})},"esri/chunks/scalar":function(){define(["exports"],function(a){function b(h,w,n){const f=h.typedBuffer;h=h.typedBufferStride;const l=w.typedBuffer,k=w.typedBufferStride;w=n?n.count:w.count;let e=(n&&n.dstIndex?n.dstIndex:0)*h;n=(n&&n.srcIndex?n.srcIndex:0)*k;for(let d=0;d<w;++d)f[e]=l[n],e+=h,n+=k}function c(h,w){const n=h.count;w||(w=new h.TypedArrayConstructor(n));for(let f=0;f<n;f++)w[f]=h.get(f);return w}const g=Object.freeze({__proto__:null,copy:b,makeDense:c});
a.copy=b;a.makeDense=c;a.scalar=g})},"esri/chunks/vec22":function(){define(["exports","../geometry/support/buffer/types"],function(a,b){function c(n,f,l){const k=n.typedBuffer;n=n.typedBufferStride;const e=f.typedBuffer,d=f.typedBufferStride;f=l?l.count:f.count;let m=(l&&l.dstIndex?l.dstIndex:0)*n;l=(l&&l.srcIndex?l.srcIndex:0)*d;for(let z=0;z<f;++z)k[m]=e[l],k[m+1]=e[l+1],m+=n,l+=d}function g(n,f,l){const k=n.typedBuffer,e=n.typedBufferStride,d=f.typedBuffer,m=f.typedBufferStride,z=l?l.count:f.count;
let v=(l&&l.dstIndex?l.dstIndex:0)*e,q=(l&&l.srcIndex?l.srcIndex:0)*m;if(b.isInteger(f.elementType))if(l=b.maximumValue(f.elementType),b.isSigned(f.elementType))for(f=0;f<z;++f)k[v]=Math.max(d[q]/l,-1),k[v+1]=Math.max(d[q+1]/l,-1),v+=e,q+=m;else for(f=0;f<z;++f)k[v]=d[q]/l,k[v+1]=d[q+1]/l,v+=e,q+=m;else c(n,f,l);return n}function h(n,f,l,k){var e,d;const m=n.typedBuffer,z=n.typedBufferStride;n=null!=(e=null==k?void 0:k.count)?e:n.count;k=(null!=(d=null==k?void 0:k.dstIndex)?d:0)*z;for(d=0;d<n;++d)m[k]=
f,m[k+1]=l,k+=z}const w=Object.freeze({__proto__:null,copy:c,normalizeIntegerBuffer:g,fill:h});a.copy=c;a.fill=h;a.normalizeIntegerBuffer=g;a.vec2=w})},"esri/chunks/vec33":function(){define(["exports"],function(a){function b(h,w,n){const f=h.typedBuffer;h=h.typedBufferStride;const l=w.typedBuffer,k=w.typedBufferStride;w=n?n.count:w.count;let e=(n&&n.dstIndex?n.dstIndex:0)*h;n=(n&&n.srcIndex?n.srcIndex:0)*k;for(let d=0;d<w;++d)f[e]=l[n],f[e+1]=l[n+1],f[e+2]=l[n+2],e+=h,n+=k}function c(h,w,n,f,l){var k,
e;const d=h.typedBuffer,m=h.typedBufferStride;h=null!=(k=null==l?void 0:l.count)?k:h.count;l=(null!=(e=null==l?void 0:l.dstIndex)?e:0)*m;for(e=0;e<h;++e)d[l]=w,d[l+1]=n,d[l+2]=f,l+=m}const g=Object.freeze({__proto__:null,copy:b,fill:c});a.copy=b;a.fill=c;a.vec3=g})},"esri/chunks/vec43":function(){define(["exports"],function(a){function b(h,w,n){const f=h.typedBuffer;h=h.typedBufferStride;const l=w.typedBuffer,k=w.typedBufferStride;w=n?n.count:w.count;let e=(n&&n.dstIndex?n.dstIndex:0)*h;n=(n&&n.srcIndex?
n.srcIndex:0)*k;for(let d=0;d<w;++d)f[e]=l[n],f[e+1]=l[n+1],f[e+2]=l[n+2],f[e+3]=l[n+3],e+=h,n+=k}function c(h,w,n,f,l,k){var e,d;const m=h.typedBuffer,z=h.typedBufferStride;h=null!=(e=null==k?void 0:k.count)?e:h.count;k=(null!=(d=null==k?void 0:k.dstIndex)?d:0)*z;for(d=0;d<h;++d)m[k]=w,m[k+1]=n,m[k+2]=f,m[k+3]=l,k+=z}const g=Object.freeze({__proto__:null,copy:b,fill:c});a.copy=b;a.fill=c;a.vec4=g})},"esri/views/3d/glTF/DefaultLoadingContext":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../request ../../../core/asyncUtils ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils".split(" "),
function(a,b,c,g,h,w,n,f){let l=function(){function e(m){this.streamDataRequester=m}var d=e.prototype;d.loadJSON=function(){var m=b._asyncToGenerator(function*(z,v){return this._load("json",z,v)});return function(z,v){return m.apply(this,arguments)}}();d.loadBinary=function(){var m=b._asyncToGenerator(function*(z,v){return f.isDataProtocol(z)?(n.throwIfAborted(v),f.dataToArrayBuffer(z)):this._load("binary",z,v)});return function(z,v){return m.apply(this,arguments)}}();d.loadImage=function(){var m=
b._asyncToGenerator(function*(z,v){return this._load("image",z,v)});return function(z,v){return m.apply(this,arguments)}}();d._load=function(){var m=b._asyncToGenerator(function*(z,v,q){if(w.isNone(this.streamDataRequester))return(yield c(v,{responseType:k[z]})).data;z=yield g.result(this.streamDataRequester.request(v,z,q));if(!0===z.ok)return z.value;n.throwIfAbortError(z.error);throw new h("",`Request for resource failed: ${z.error}`);});return function(z,v,q){return m.apply(this,arguments)}}();
return e}();const k={image:"image",binary:"array-buffer",json:"json"};a.DefaultLoadingContext=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/loader":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/mat4f64 ./DefaultErrorContext ./LoaderResult ./internal/Resource ../../webgl/enums".split(" "),function(a,b,c,g,h,w,n,f){function l(){l=b._asyncToGenerator(function*(r,x,u={},E=!0){const y=yield n.Resource.load(r,v,x,u),
A=`gltf_${z++}`,p={lods:[],materials:new Map,textures:new Map,meta:k(y)};r=!(!y.json.asset.extras||"symbolResource"!==y.json.asset.extras.ESRI_type);const B=new Map;yield e(y,function(){var D=b._asyncToGenerator(function*(C,F,G,L){var H;const M=null!=(H=B.get(G))?H:0;B.set(G,M+1);var K=void 0!==C.mode?C.mode:f.PrimitiveType.TRIANGLES;H=K===f.PrimitiveType.TRIANGLES||K===f.PrimitiveType.TRIANGLE_STRIP||K===f.PrimitiveType.TRIANGLE_FAN?K:null;if(c.isNone(H))v.warnUnsupported("Unsupported primitive mode ("+
t[K]+"). Skipping primitive.");else if(y.hasPositions(C)){K=y.getPositionData(C,u);var I=y.getMaterial(C,u,E),O=y.hasNormals(C)?y.getNormalData(C,u):null,Q=y.hasTangents(C)?y.getTangentData(C,u):null,J=y.hasTextureCoordinates(C)?y.getTextureCoordinates(C,u):null,P=y.hasVertexColors(C)?y.getVertexColors(C,u):null;C=y.getIndexData(C,u);F={transform:g.clone(F),attributes:{position:yield K,normal:O?yield O:null,texCoord0:J?yield J:null,color:P?yield P:null,tangent:Q?yield Q:null},indices:yield C,primitiveType:H,
material:m(p,yield I,A)};C=null;c.isSome(p.meta)&&c.isSome(p.meta.ESRI_lod)&&"screenSpaceRadius"===p.meta.ESRI_lod.metric&&(C=p.meta.ESRI_lod.thresholds[G]);p.lods[G]=p.lods[G]||{parts:[],name:L,lodThreshold:C};p.lods[G].parts[M]=F}else v.warn("Skipping primitive without POSITION vertex attribute.")});return function(C,F,G,L){return D.apply(this,arguments)}}());for(const D of p.lods)D.parts=D.parts.filter(C=>!!C);return{model:p,meta:{isEsriSymbolResource:r,uri:y.uri},customMeta:{}}});return l.apply(this,
arguments)}function k(r){let x=null;r.json.nodes.forEach(u=>{u=u.extras;c.isSome(u)&&(u.ESRI_proxyEllipsoid||u.ESRI_lod)&&(x=u)});return x}function e(r,x){return d.apply(this,arguments)}function d(){d=b._asyncToGenerator(function*(r,x){function u(D,C){return E.apply(this,arguments)}function E(){E=b._asyncToGenerator(function*(D,C){const F=y.nodes[D];D=r.getNodeTransform(D);v.warnUnsupportedIf(null!=F.weights,"Morph targets are not supported.");if(null!=F.mesh){const G=y.meshes[F.mesh];for(const L of G.primitives)B.push(x(L,
D,C,G.name))}for(const G of F.children||[])B.push(u(G,C))});return E.apply(this,arguments)}const y=r.json;var A=y.scenes[y.scene||0].nodes;const p=1<A.length,B=[];for(const D of A)A=y.nodes[D],B.push(u(D,0)),A.extensions&&A.extensions.MSFT_lod&&Array.isArray(A.extensions.MSFT_lod.ids)&&!p&&A.extensions.MSFT_lod.ids.forEach((C,F)=>u(C,F+1));yield Promise.all(B)});return d.apply(this,arguments)}function m(r,x,u){const E=A=>{const p=`${u}_tex_${A&&A.id}${A&&A.name?"_"+A.name:""}`;if(A&&!r.textures.has(p)){const B=
w.makeTextureSource(A.data,{wrap:{s:A.wrapS,t:A.wrapT},mipmap:q.some(D=>D===A.minFilter),noUnpackFlip:!0});r.textures.set(p,B)}return p},y=`${u}_mat_${x.id}_${x.name}`;r.materials.has(y)||(x=w.makeMaterialParameters({color:[x.color[0],x.color[1],x.color[2]],opacity:x.color[3],alphaMode:x.alphaMode,alphaCutoff:x.alphaCutoff,doubleSided:x.doubleSided,colorMixMode:x.ESRI_externalColorMixMode,textureColor:x.colorTexture?E(x.colorTexture):void 0,textureNormal:x.normalTexture?E(x.normalTexture):void 0,
textureOcclusion:x.occlusionTexture?E(x.occlusionTexture):void 0,textureEmissive:x.emissiveTexture?E(x.emissiveTexture):void 0,textureMetallicRoughness:x.metallicRoughnessTexture?E(x.metallicRoughnessTexture):void 0,emissiveFactor:[x.emissiveFactor[0],x.emissiveFactor[1],x.emissiveFactor[2]],metallicFactor:x.metallicFactor,roughnessFactor:x.roughnessFactor}),r.materials.set(y,x));return y}let z=0;const v=new h.DefaultErrorContext,q=[f.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,f.TextureSamplingMode.LINEAR_MIPMAP_NEAREST],
t="POINTS LINES LINE_LOOP LINE_STRIP TRIANGLES TRIANGLE_STRIP TRIANGLE_FAN".split(" ");a.load=function(r,x){return l.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/DefaultErrorContext":function(){define(["exports","../../../core/Error","../../../core/Logger"],function(a,b,c){const g=c.getLogger("esri.views.3d.glTF");c=function(){function h(){}var w=h.prototype;w.error=function(n){throw new b("gltf-loader-error",n);};w.errorUnsupported=function(n){throw new b("gltf-loader-unsupported-feature",
n);};w.errorUnsupportedIf=function(n,f){n&&this.errorUnsupported(f)};w.assert=function(n,f){n||this.error(f)};w.warn=function(n){g.warn(n)};w.warnUnsupported=function(n){this.warn("[Unsupported Feature] "+n)};w.warnUnsupportedIf=function(n,f){n&&this.warnUnsupported(f)};return h}();a.DefaultErrorContext=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/LoaderResult":function(){define(["exports","../../webgl/enums"],function(a,b){a.makeMaterialParameters=function(c={}){return{color:[1,
1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...c}};a.makeTextureSource=function(c,g={}){return{data:c,parameters:{wrap:{s:b.TextureWrapMode.REPEAT,t:b.TextureWrapMode.REPEAT,...g.wrap},noUnpackFlip:!0,mipmap:!1,...g}}};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/glTF/internal/Resource":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/compilerUtils ../../../../core/MapUtils ../../../../core/urlUtils ../../../../core/Version ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf64 ../../../../geometry/support/buffer/BufferView ../../../../chunks/scalar ./BinaryStreamReader ./enums ./fillDefaults ./pathUtils ../../../webgl/enums".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t){function r(L){switch(L.componentType){case t.DataType.BYTE:return new e.BufferViewVec2i8(L.raw,L.byteOffset,L.byteStride,L.byteOffset+L.byteStride*L.entryCount);case t.DataType.UNSIGNED_BYTE:return new e.BufferViewVec2u8(L.raw,L.byteOffset,L.byteStride,L.byteOffset+L.byteStride*L.entryCount);case t.DataType.SHORT:return new e.BufferViewVec2i16(L.raw,L.byteOffset,L.byteStride,L.byteOffset+L.byteStride*L.entryCount);case t.DataType.UNSIGNED_SHORT:return new e.BufferViewVec2u16(L.raw,
L.byteOffset,L.byteStride,L.byteOffset+L.byteStride*L.entryCount);case t.DataType.UNSIGNED_INT:return new e.BufferViewVec2u32(L.raw,L.byteOffset,L.byteStride,L.byteOffset+L.byteStride*L.entryCount);case t.DataType.FLOAT:return new e.BufferViewVec2f(L.raw,L.byteOffset,L.byteStride,L.byteOffset+L.byteStride*L.entryCount);default:c.neverReached(L.componentType)}}function x(L){return u.apply(this,arguments)}function u(){u=b._asyncToGenerator(function*(L){return new Promise((H,M)=>{const K=new Blob([L]),
I=new FileReader;I.onload=()=>{H(JSON.parse(I.result))};I.onerror=O=>{M(O)};I.readAsText(K)})});return u.apply(this,arguments)}function E(L,H){return y.apply(this,arguments)}function y(){y=b._asyncToGenerator(function*(L,H){return new Promise((M,K)=>{const I=new Blob([L],{type:H}),O=URL.createObjectURL(I),Q=new Image;Q.addEventListener("load",()=>{URL.revokeObjectURL(O);"decode"in Q?Q.decode().then(()=>M(Q),()=>M(Q)):M(Q)});Q.addEventListener("error",J=>{URL.revokeObjectURL(O);K(J)});Q.src=O})});
return y.apply(this,arguments)}let A=function(){function L(M,K,I,O,Q){this.context=M;this.errorContext=K;this.uri=I;this.json=O;this.glbBuffer=Q;this.bufferLoaders=new Map;this.textureLoaders=new Map;this.textureCache=new Map;this.materialCache=new Map;this.nodeParentMap=new Map;this.nodeTransformCache=new Map;this.baseUri=q.splitURI(this.uri).dirPart;this._checkVersionSupported();this._checkRequiredExtensionsSupported();K.errorUnsupportedIf(null==O.scenes,"Scenes must be defined.");K.errorUnsupportedIf(null==
O.meshes,"Meshes must be defined");K.errorUnsupportedIf(null==O.nodes,"Nodes must be defined.");this._computeNodeParents()}L.load=function(){var M=b._asyncToGenerator(function*(K,I,O,Q){if(h.isDataProtocol(O)){var J=h.dataComponents(O);if("model/gltf-binary"!==J.mediaType)try{const P=JSON.parse(J.isBase64?atob(J.data):J.data);return new L(K,I,O,P)}catch{}J=h.dataToArrayBuffer(O);if(L._isGLBData(J))return this._fromGLBData(K,I,O,J)}if(O.endsWith(".gltf"))return Q=yield K.loadJSON(O,Q),new L(K,I,O,
Q);J=yield K.loadBinary(O,Q);if(L._isGLBData(J))return this._fromGLBData(K,I,O,J);Q=yield K.loadJSON(O,Q);return new L(K,I,O,Q)});return function(K,I,O,Q){return M.apply(this,arguments)}}();L._isGLBData=function(M){M=new m.BinaryStreamReader(M);return 4<=M.remainingBytes()&&1179937895===M.readUint32()};L._fromGLBData=function(){var M=b._asyncToGenerator(function*(K,I,O,Q){Q=yield L._parseGLBData(I,Q);return new L(K,I,O,Q.json,Q.binaryData)});return function(K,I,O,Q){return M.apply(this,arguments)}}();
L._parseGLBData=function(){var M=b._asyncToGenerator(function*(K,I){const O=new m.BinaryStreamReader(I);K.assert(12<=O.remainingBytes(),"GLB binary data is insufficiently large.");var Q=O.readUint32(),J=O.readUint32();const P=O.readUint32();K.assert(1179937895===Q,"Magic first 4 bytes do not fit to expected GLB value.");K.assert(I.byteLength>=P,"GLB binary data is smaller than header specifies.");K.errorUnsupportedIf(2!==J,"An unsupported GLB container version was detected. Only version 2 is supported.");
I=0;let N,R;for(;8<=O.remainingBytes();)Q=O.readUint32(),J=O.readUint32(),0===I?(K.assert(1313821514===J,"First GLB chunk must be JSON."),K.assert(0<=Q,"No JSON data found."),N=yield x(O.readUint8Array(Q))):1===I?(K.errorUnsupportedIf(5130562!==J,"Second GLB chunk expected to be BIN."),R=O.readUint8Array(Q)):K.warnUnsupported("More than 2 GLB chunks detected. Skipping."),I+=1;N||K.error("No GLB JSON chunk detected.");return{json:N,binaryData:R}});return function(K,I){return M.apply(this,arguments)}}();
var H=L.prototype;H.getBuffer=function(){var M=b._asyncToGenerator(function*(K,I){const O=this.json.buffers[K],Q=this.errorContext;if(null==O.uri)return Q.assert(null!=this.glbBuffer,"GLB buffer not present"),this.glbBuffer;K=yield this._getBufferLoader(K,I);Q.assert(K.byteLength===O.byteLength,"Buffer byte lengths should match.");return K});return function(K,I){return M.apply(this,arguments)}}();H._getBufferLoader=function(){var M=b._asyncToGenerator(function*(K,I){const O=this.bufferLoaders.get(K);
if(O)return O;I=this.context.loadBinary(this._resolveUri(this.json.buffers[K].uri),I).then(Q=>new Uint8Array(Q));this.bufferLoaders.set(K,I);return I});return function(K,I){return M.apply(this,arguments)}}();H.getAccessor=function(){var M=b._asyncToGenerator(function*(K,I){var O=this.errorContext;O.errorUnsupportedIf(!this.json.accessors,"Accessors missing.");K=this.json.accessors[K];O.errorUnsupportedIf(null==(null==K?void 0:K.bufferView),"Some accessor does not specify a bufferView.");O.errorUnsupportedIf(K.type in
[z.AttributeType.MAT2,z.AttributeType.MAT3,z.AttributeType.MAT4],`AttributeType ${K.type} is not supported`);O=this.json.bufferViews[K.bufferView];I=yield this.getBuffer(O.buffer,I);const Q=C[K.type],J=F[K.componentType],P=Q*J,N=O.byteStride||P;return{raw:I.buffer,byteStride:N,byteOffset:I.byteOffset+(O.byteOffset||0)+(K.byteOffset||0),entryCount:K.count,isDenselyPacked:N===P,componentCount:Q,componentByteSize:J,componentType:K.componentType,min:K.min,max:K.max,normalized:!!K.normalized}});return function(K,
I){return M.apply(this,arguments)}}();H.getIndexData=function(){var M=b._asyncToGenerator(function*(K,I){if(null==K.indices)return null;K=yield this.getAccessor(K.indices,I);if(K.isDenselyPacked)switch(K.componentType){case t.DataType.UNSIGNED_BYTE:return new Uint8Array(K.raw,K.byteOffset,K.entryCount);case t.DataType.UNSIGNED_SHORT:return new Uint16Array(K.raw,K.byteOffset,K.entryCount);case t.DataType.UNSIGNED_INT:return new Uint32Array(K.raw,K.byteOffset,K.entryCount)}else switch(K.componentType){case t.DataType.UNSIGNED_BYTE:return d.makeDense(this._wrapAccessor(e.BufferViewUint8,
K));case t.DataType.UNSIGNED_SHORT:return d.makeDense(this._wrapAccessor(e.BufferViewUint16,K));case t.DataType.UNSIGNED_INT:return d.makeDense(this._wrapAccessor(e.BufferViewUint32,K))}});return function(K,I){return M.apply(this,arguments)}}();H.getPositionData=function(){var M=b._asyncToGenerator(function*(K,I){const O=this.errorContext;O.errorUnsupportedIf(null==K.attributes.POSITION,"No POSITION vertex data found.");K=yield this.getAccessor(K.attributes.POSITION,I);O.errorUnsupportedIf(K.componentType!==
t.DataType.FLOAT,"Expected type FLOAT for POSITION vertex attribute, but found "+G[K.componentType]);O.errorUnsupportedIf(3!==K.componentCount,"POSITION vertex attribute must have 3 components, but found "+K.componentCount.toFixed());return this._wrapAccessor(e.BufferViewVec3f,K)});return function(K,I){return M.apply(this,arguments)}}();H.getNormalData=function(){var M=b._asyncToGenerator(function*(K,I){const O=this.errorContext;O.assert(null!=K.attributes.NORMAL,"No NORMAL vertex data found.");K=
yield this.getAccessor(K.attributes.NORMAL,I);O.errorUnsupportedIf(K.componentType!==t.DataType.FLOAT,"Expected type FLOAT for NORMAL vertex attribute, but found "+G[K.componentType]);O.errorUnsupportedIf(3!==K.componentCount,"NORMAL vertex attribute must have 3 components, but found "+K.componentCount.toFixed());return this._wrapAccessor(e.BufferViewVec3f,K)});return function(K,I){return M.apply(this,arguments)}}();H.getTangentData=function(){var M=b._asyncToGenerator(function*(K,I){const O=this.errorContext;
O.assert(null!=K.attributes.TANGENT,"No TANGENT vertex data found.");K=yield this.getAccessor(K.attributes.TANGENT,I);O.errorUnsupportedIf(K.componentType!==t.DataType.FLOAT,"Expected type FLOAT for TANGENT vertex attribute, but found "+G[K.componentType]);O.errorUnsupportedIf(4!==K.componentCount,"TANGENT vertex attribute must have 4 components, but found "+K.componentCount.toFixed());return new e.BufferViewVec4f(K.raw,K.byteOffset,K.byteStride,K.byteOffset+K.byteStride*K.entryCount)});return function(K,
I){return M.apply(this,arguments)}}();H.getTextureCoordinates=function(){var M=b._asyncToGenerator(function*(K,I){const O=this.errorContext;O.assert(null!=K.attributes.TEXCOORD_0,"No TEXCOORD_0 vertex data found.");K=yield this.getAccessor(K.attributes.TEXCOORD_0,I);O.errorUnsupportedIf(2!==K.componentCount,"TEXCOORD_0 vertex attribute must have 2 components, but found "+K.componentCount.toFixed());if(K.componentType===t.DataType.FLOAT)return this._wrapAccessor(e.BufferViewVec2f,K);O.errorUnsupportedIf(!K.normalized,
"Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return r(K)});return function(K,I){return M.apply(this,arguments)}}();H.getVertexColors=function(){var M=b._asyncToGenerator(function*(K,I){const O=this.errorContext;O.assert(null!=K.attributes.COLOR_0,"No COLOR_0 vertex data found.");K=yield this.getAccessor(K.attributes.COLOR_0,I);O.errorUnsupportedIf(4!==K.componentCount&&3!==K.componentCount,"COLOR_0 attribute must have 3 or 4 components, but found "+K.componentCount.toFixed());
if(4===K.componentCount){if(K.componentType===t.DataType.FLOAT)return this._wrapAccessor(e.BufferViewVec4f,K);if(K.componentType===t.DataType.UNSIGNED_BYTE)return this._wrapAccessor(e.BufferViewVec4u8,K);if(K.componentType===t.DataType.UNSIGNED_SHORT)return this._wrapAccessor(e.BufferViewVec4u16,K)}else if(3===K.componentCount){if(K.componentType===t.DataType.FLOAT)return this._wrapAccessor(e.BufferViewVec3f,K);if(K.componentType===t.DataType.UNSIGNED_BYTE)return this._wrapAccessor(e.BufferViewVec3u8,
K);if(K.componentType===t.DataType.UNSIGNED_SHORT)return this._wrapAccessor(e.BufferViewVec3u16,K)}O.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+G[K.componentType])});return function(K,I){return M.apply(this,arguments)}}();H.hasPositions=function(M){return void 0!==M.attributes.POSITION};H.hasNormals=function(M){return void 0!==M.attributes.NORMAL};H.hasVertexColors=function(M){return void 0!==M.attributes.COLOR_0};H.hasTextureCoordinates=function(M){return void 0!==M.attributes.TEXCOORD_0};
H.hasTangents=function(M){return void 0!==M.attributes.TANGENT};H.getMaterial=function(){var M=b._asyncToGenerator(function*(K,I,O){var Q=this.materialCache.get(K.material);if(!Q){Q=null!=K.material?v.material(this.json.materials[K.material]):v.material();const J=Q.pbrMetallicRoughness,P=this.hasVertexColors(K),N=this.getTexture(J.baseColorTexture,I),R=this.getTexture(Q.normalTexture,I),S=O?this.getTexture(Q.occlusionTexture,I):null,T=O?this.getTexture(Q.emissiveTexture,I):null;I=O?this.getTexture(J.metallicRoughnessTexture,
I):null;K=null!=K.material?K.material:-1;Q={alphaMode:Q.alphaMode,alphaCutoff:Q.alphaCutoff,color:J.baseColorFactor,doubleSided:!!Q.doubleSided,colorTexture:yield N,normalTexture:yield R,name:Q.name,id:K,occlusionTexture:yield S,emissiveTexture:yield T,emissiveFactor:Q.emissiveFactor,metallicFactor:J.metallicFactor,roughnessFactor:J.roughnessFactor,metallicRoughnessTexture:yield I,vertexColors:P,ESRI_externalColorMixMode:Q.extras.ESRI_externalColorMixMode}}return Q});return function(K,I,O){return M.apply(this,
arguments)}}();H.getTexture=function(){var M=b._asyncToGenerator(function*(K,I){if(!K)return null;this.errorContext.errorUnsupportedIf(0!==(K.texCoord||0),"Only TEXCOORD with index 0 is supported.");const O=K.index,Q=this.errorContext;K=this.json.textures[O];const J=v.textureSampler(null!=K.sampler?this.json.samplers[K.sampler]:{});Q.errorUnsupportedIf(null==K.source,"Source is expected to be defined for a texture.");const P=this.json.images[K.source],N=yield this._loadTextureImageData(O,K,I);return g.getOrCreateMapValue(this.textureCache,
O,()=>{const R=T=>33071===T||33648===T||10497===T,S=T=>{Q.error(`Unexpected TextureSampler WrapMode: ${T}. Using default REPEAT(10497).`);return 10497};return{data:N,wrapS:R(J.wrapS)?J.wrapS:S(J.wrapS),wrapT:R(J.wrapT)?J.wrapT:S(J.wrapT),minFilter:J.minFilter,name:P.name,id:O}})});return function(K,I){return M.apply(this,arguments)}}();H.getNodeTransform=function(M){if(void 0===M)return B;var K=this.nodeTransformCache.get(M);if(!K){K=this.getNodeTransform(this._getNodeParent(M));const I=this.json.nodes[M];
if(I.matrix)K=n.multiply(f.create(),K,I.matrix);else if(I.translation||I.rotation||I.scale)K=f.clone(K),I.translation&&n.translate(K,K,I.translation),I.rotation&&(D[3]=l.getAxisAngle(D,I.rotation),n.rotate(K,K,D[3],D)),I.scale&&n.scale(K,K,I.scale);this.nodeTransformCache.set(M,K)}return K};H._wrapAccessor=function(M,K){return new M(K.raw,K.byteOffset,K.byteStride,K.byteOffset+K.byteStride*(K.entryCount-1)+K.componentByteSize*K.componentCount)};H._resolveUri=function(M){return h.makeAbsolute(M,this.baseUri)};
H._getNodeParent=function(M){return this.nodeParentMap.get(M)};H._checkVersionSupported=function(){const M=w.Version.parse(this.json.asset.version,"glTF");p.validate(M)};H._checkRequiredExtensionsSupported=function(){const M=this.json,K=this.errorContext;M.extensionsRequired&&0!==M.extensionsRequired.length&&K.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+M.extensionsRequired.join(", "))};H._computeNodeParents=function(){this.json.nodes.forEach((M,
K)=>{M.children&&M.children.forEach(I=>{this.nodeParentMap.set(I,K)})})};H._loadTextureImageData=function(){var M=b._asyncToGenerator(function*(K,I,O){const Q=this.textureLoaders.get(K);if(Q)return Q;I=this._createTextureLoader(I,O);this.textureLoaders.set(K,I);return I});return function(K,I,O){return M.apply(this,arguments)}}();H._createTextureLoader=function(){var M=b._asyncToGenerator(function*(K,I){K=this.json.images[K.source];if(K.uri)return this.context.loadImage(this._resolveUri(K.uri),I);
const O=this.errorContext;O.errorUnsupportedIf(null==K.bufferView,"Image bufferView must be defined.");O.errorUnsupportedIf(null==K.mimeType,"Image mimeType must be defined.");const Q=this.json.bufferViews[K.bufferView];I=yield this.getBuffer(Q.buffer,I);O.errorUnsupportedIf(null!=Q.byteStride,"byteStride not supported for image buffer");return E(new Uint8Array(I.buffer,I.byteOffset+(Q.byteOffset||0),Q.byteLength),K.mimeType)});return function(K,I){return M.apply(this,arguments)}}();return L}();const p=
new w.Version(2,0,"glTF"),B=n.fromXRotation(f.create(),Math.PI/2),D=k.create(),C={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},F={[t.DataType.BYTE]:1,[t.DataType.UNSIGNED_BYTE]:1,[t.DataType.SHORT]:2,[t.DataType.UNSIGNED_SHORT]:2,[t.DataType.FLOAT]:4,[t.DataType.UNSIGNED_INT]:4},G={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"};a.Resource=A;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/Version":function(){define(["exports","./Error"],function(a,
b){let c=function(){function g(w,n,f=""){this.major=w;this.minor=n;this._context=f}var h=g.prototype;h.lessThan=function(w,n){return this.major<w||w===this.major&&this.minor<n};h.since=function(w,n){return!this.lessThan(w,n)};h.validate=function(w){if(this.major!==w.major)throw new b((this._context&&this._context+":")+"unsupported-version",`Required major ${this._context&&this._context+" "}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:w});};h.clone=function(){return new g(this.major,
this.minor,this._context)};g.parse=function(w,n=""){const [f,l]=w.split(".");var k=/^\s*\d+\s*$/;if(!f||!f.match||!f.match(k))throw new b((n&&n+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:w});if(!l||!l.match||!l.match(k))throw new b((n&&n+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:w});w=parseInt(f,10);k=parseInt(l,10);return new g(w,k,n)};return g}();a.Version=c;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/3d/glTF/internal/BinaryStreamReader":function(){define(["exports"],function(a){let b=function(){function c(h){this.data=h;this.offset4=0;this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}var g=c.prototype;g.readUint32=function(){const h=this.offset4;this.offset4+=1;return this.dataUint32[h]};g.readUint8Array=function(h){const w=4*this.offset4;this.offset4+=h/4;return new Uint8Array(this.data,w,h)};g.remainingBytes=function(){return this.data.byteLength-
4*this.offset4};return c}();a.BinaryStreamReader=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/internal/enums":function(){define(["exports"],function(a){a.AttributeType=void 0;(function(b){b.SCALAR="SCALAR";b.VEC2="VEC2";b.VEC3="VEC3";b.VEC4="VEC4";b.MAT2="MAT2";b.MAT3="MAT3";b.MAT4="MAT4"})(a.AttributeType||(a.AttributeType={}));a.BufferViewTarget=void 0;(function(b){b[b.ARRAY_BUFFER=34962]="ARRAY_BUFFER";b[b.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(a.BufferViewTarget||
(a.BufferViewTarget={}));Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/internal/fillDefaults":function(){define(["exports","../../../../core/compilerUtils","../../../webgl/enums"],function(a,b,c){const g={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},h={pbrMetallicRoughness:g,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},w={ESRI_externalColorMixMode:"tint"},n={magFilter:c.TextureSamplingMode.LINEAR,minFilter:c.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,
wrapS:c.TextureWrapMode.REPEAT,wrapT:c.TextureWrapMode.REPEAT};a.material=(f={})=>{const l={...g,...f.pbrMetallicRoughness};var k={...w,...f.extras};switch(k.ESRI_externalColorMixMode){case "multiply":case "tint":case "ignore":case "replace":break;default:b.neverReached(k.ESRI_externalColorMixMode),k.ESRI_externalColorMixMode="tint"}return{...h,...f,pbrMetallicRoughness:l,extras:k}};a.textureSampler=f=>({...n,...f});Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/internal/pathUtils":function(){define(["exports"],
function(a){a.splitURI=function(b){let c,g;b.replace(/^(.*\/)?([^/]*)$/,(h,w,n)=>{c=w||"";g=n||"";return""});return{dirPart:c,filePart:g}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/glTF/internal/indexUtils":function(){define(["exports","../../../../core/typedArrayUtil","../../webgl-engine/lib/geometryDataUtils"],function(a,b,c){a.triangleFanToTriangles=function(g){var h="number"===typeof g?g:g.length;if(3>h)return new Uint16Array(0);h-=2;const w=65536>=h?new Uint16Array(3*
h):new Uint32Array(3*h);if("number"===typeof g){g=0;for(var n=0;n<h;++n)w[g++]=0,w[g++]=n+1,w[g++]=n+2;return w}{n=g[0];let f=g[1],l=0;for(let k=0;k<h;++k){const e=g[k+2];w[l++]=n;w[l++]=f;f=w[l++]=e}return w}};a.triangleStripToTriangles=function(g){var h="number"===typeof g?g:g.length;if(3>h)return new Uint16Array(0);h-=2;const w=65536>=h?new Uint16Array(3*h):new Uint32Array(3*h);if("number"===typeof g){g=0;for(var n=0;n<h;n+=1)0===n%2?(w[g++]=n,w[g++]=n+1):(w[g++]=n+1,w[g++]=n),w[g++]=n+2}else{n=
0;for(let e=0;e<h;e+=1)if(0===e%2){var f=g[e],l=g[e+1],k=g[e+2];w[n++]=f;w[n++]=l;w[n++]=k}else f=g[e+1],l=g[e],k=g[e+2],w[n++]=f,w[n++]=l,w[n++]=k}return w};a.trianglesToTriangles=function(g,h=c.generateDefaultIndexArray){return"number"===typeof g?h(g):b.isUint16Array(g)||b.isUint8Array(g)?new Uint32Array(g):g};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/wosrLoader":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../request ../../../../core/asyncUtils ../../../../core/Error ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/Version ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../support/requestImageUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial ../../../webgl/enums".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t){function r(){r=b._asyncToGenerator(function*(L,H){L=yield x(L,H);H=yield B(L.textureDefinitions,H);return{resource:L,textures:H}});return r.apply(this,arguments)}function x(L,H){return u.apply(this,arguments)}function u(){u=b._asyncToGenerator(function*(L,H){const M=n.isSome(H)&&H.streamDataRequester;if(M)return E(L,M,H);L=yield g.result(c(L,n.unwrap(H)));if(!0===L.ok)return L.value.data;f.throwIfAbortError(L.error);A(L.error)});return u.apply(this,arguments)}
function E(L,H,M){return y.apply(this,arguments)}function y(){y=b._asyncToGenerator(function*(L,H,M){L=yield g.result(H.request(L,"json",M));if(!0===L.ok)return L.value;f.throwIfAbortError(L.error);A(L.error.details.url)});return y.apply(this,arguments)}function A(L){throw new h("",`Request for object resource failed: ${L}`);}function p(L){const H=e.empty();L.forEach(M=>{M=M.boundingInfo;n.isSome(M)&&(e.expandWithVec3(H,M.getBBMin()),e.expandWithVec3(H,M.getBBMax()))});return H}function B(L,H){return D.apply(this,
arguments)}function D(){D=b._asyncToGenerator(function*(L,H){const M=[];for(const O in L){var K=L[O],I=K.images[0].data;if(!I){F.warn("Externally referenced texture data is not yet supported");continue}I=K.encoding+";base64,"+I;const Q="/textureDefinitions/"+O,J="rgba"===K.channels?K.alphaChannelUsage||"transparency":"none",P={noUnpackFlip:!0,wrap:{s:t.TextureWrapMode.REPEAT,t:t.TextureWrapMode.REPEAT},preMultiplyAlpha:C(J)!==m.AlphaDiscardMode.Opaque};K=n.isSome(H)&&H.disableTextures?Promise.resolve(null):
d.requestImage(I,H);M.push(K.then(N=>({refId:Q,image:N,params:P,alphaChannelUsage:J})))}L=yield Promise.all(M);H={};for(const O of L)H[O.refId]=O;return H});return D.apply(this,arguments)}function C(L){switch(L){case "mask":return m.AlphaDiscardMode.Mask;case "maskAndTransparency":return m.AlphaDiscardMode.MaskBlend;case "none":return m.AlphaDiscardMode.Opaque;case "transparency":return m.AlphaDiscardMode.Blend;default:return m.AlphaDiscardMode.Blend}}const F=w.getLogger("esri.views.3d.layers.graphics.objectResourceUtils"),
G=new l.Version(1,2,"wosr");a.createTextureResources=B;a.load=function(L,H){return r.apply(this,arguments)};a.processLoadResult=function(L,H){const M=[],K=[],I=[],O=[],Q=L.resource;var J=l.Version.parse(Q.version||"1.0","wosr");G.validate(J);J=Q.model.name;const P=Q.model.geometries,N=Q.materialDefinitions;L=L.textures;let R=0;const S=new Map;for(let ea=0;ea<P.length;ea++){var T=P[ea],V=T,W=V.params,U=W.topology;var aa=!0;W.vertexAttributes||(F.warn("Geometry must specify vertex attributes"),aa=!1);
switch(W.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:U=W.faces;if(!U)F.warn("Indexed geometries must specify faces"),aa=!1;else if(W.vertexAttributes)for(const ja in W.vertexAttributes)(W=U[ja])&&W.values?(null!=W.valueType&&"UInt32"!==W.valueType&&(F.warn(`Unsupported indexed geometry indices type '${W.valueType}', only UInt32 is currently supported`),aa=!1),null!=W.valuesPerElement&&1!==W.valuesPerElement&&(F.warn(`Unsupported indexed geometry values per element '${W.valuesPerElement}', only 1 is currently supported`),
aa=!1)):(F.warn(`Indexed geometry does not specify face indices for '${ja}' attribute`),aa=!1);break;default:F.warn(`Unsupported topology '${U}'`),aa=!1}V.params.material||(F.warn("Geometry requires material"),aa=!1);V=V.params.vertexAttributes;for(const ja in V)V[ja].values||(F.warn("Geometries with externally defined attributes are not yet supported"),aa=!1);if(aa){aa=T.params;aa={id:1,material:aa.material,texture:aa.texture,region:aa.texture};W=T.params.vertexAttributes;V=[];for(const ja in W)U=
W[ja],V.push([ja,{data:U.values,size:U.valuesPerElement,exclusive:!0}]);W=[];if("PerAttributeArray"!==T.params.topology){T=T.params.faces;for(const ja in T)W.push([ja,new Uint32Array(T[ja].values)])}if((T=L&&L[aa.texture])&&!S.has(aa.texture)){const {image:ja,params:la}=T;U=new v.Texture(ja,la);O.push(U);S.set(aa.texture,U)}U=(U=S.get(aa.texture))?U.id:void 0;var da=I[aa.material]?I[aa.material][aa.texture]:null;if(!da){da=aa.material.substring(aa.material.lastIndexOf("/")+1);da=N[da].params;1===
da.transparency&&(da.transparency=0);var Y=T&&T.alphaChannelUsage;Y=0<da.transparency||"transparency"===Y||"maskAndTransparency"===Y;const ja=T?C(T.alphaChannelUsage):void 0;T={ambient:k.fromArray(da.diffuse),diffuse:k.fromArray(da.diffuse),opacity:1-(da.transparency||0),transparent:Y,textureAlphaMode:ja,textureAlphaCutoff:.33,textureId:U,initTextureTransparent:!0,doubleSided:!0,cullFace:m.CullFaceOptions.None,colorMixMode:da.externalColorMixMode||"tint",textureAlphaPremultiplied:T?!!T.params.preMultiplyAlpha:
!1};n.isSome(H)&&H.materialParamsMixin&&Object.assign(T,H.materialParamsMixin);da=new q.DefaultMaterial(T);I[aa.material]||(I[aa.material]={});I[aa.material][aa.texture]=da}K.push(da);aa=new z.Geometry(V,W);R+=W.position?W.position.length:0;M.push(aa)}}return{name:J,stageResources:{textures:O,materials:K,geometries:M},pivotOffset:Q.model.pivotOffset,boundingBox:p(M),numberOfVertices:R,lodThreshold:null}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial_COLOR_GAMMA":function(){define(["exports"],
function(a){a.COLOR_GAMMA=2.1;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../chunks/mat4f64 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/vec4f64 ../../../support/debugFlags ../../../support/buffer/glUtil ../../core/shaderLibrary/output/OutputHighlight.glsl ../Camera ../DefaultVertexAttributeLocations ../IntersectorInterfaces ../Octree ../RenderPass ../RenderSlot ../Util ./InstanceData ./InstanceOctree ./LevelSelector ./LodLevel ./RenderInstanceData ../../materials/DefaultMaterial ../../materials/internal/MaterialUtil ../../materials/renderers/utils ../../../../webgl/Util".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F){function G(P,N,R){const S=P.allocateHead();P=P.view;C.encodeDoubleVec3(N.modelOrigin,R,P.modelOriginHi,P.modelOriginLo,S);P.model.copyFrom(S,N.model,R);P.modelNormal.copyFrom(S,N.modelNormal,R);N.color&&P.color&&P.color.copyFrom(S,N.color,R);N.featureAttribute&&P.featureAttribute&&P.featureAttribute.copyFrom(S,N.featureAttribute,R)}let L=function(P){const N=P.baseBoundingSphere.radius;P=P.levels.map(R=>R.minScreenSpaceRadius);return new y.LevelSelector(N,
P)},H=function(){function P(R,S,T,V){this.type=v.IntersectorType.LOD;this.isGround=!1;this._inverseViewport=w.create();this._levels=[];this._defaultRenderInstanceData=[];this._highlightRenderInstanceData=[];this._instanceIndex=0;this._slicePlane=!1;this._enableLevelSelection=!0;this._lastCamera=new m.default;this._updateCyclesWithStaticCamera=-1;this._needFullCycle=!1;this.slots=[r.RenderSlot.OPAQUE_PLUGIN,r.RenderSlot.TRANSPARENT_PLUGIN];this.canRender=!0;this._symbol=R;this._optionalFields=S;this._metadata=
T;this._instanceBufferLayout=B.getInstanceBufferLayout({instancedDoublePrecision:!0,instanced:S});this._glInstanceBufferLayout=e.glLayout(this._instanceBufferLayout,1);this._instanceData=new u.InstanceData(this._optionalFields,V);this._instanceData.on("instance-added",()=>this._requestUpdateCycle());this._instanceData.on("instance-removed",()=>this._requestUpdateCycle());this._instanceData.on("instance-transform-changed",W=>{this._requestUpdateCycle();this._metadata.notifyGraphicGeometryChanged(W.index)});
this._instanceData.on("instance-visibility-changed",W=>{this._requestUpdateCycle(!0);this._metadata.notifyGraphicVisibilityChanged(W.index)});this._instanceData.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0));this._enableLevelSelection=1<this._symbol.levels.length}var N=P.prototype;N.initializeRenderContext=function(){var R=b._asyncToGenerator(function*(S,T){this._context=S;const V=S.renderContext.rctx,W=yield Promise.allSettled(this._symbol.levels.map(aa=>{this._defaultRenderInstanceData.push(new p.RenderInstanceData(V,
this._instanceBufferLayout));this._highlightRenderInstanceData.push(new p.RenderInstanceData(V,this._instanceBufferLayout));return A.LodLevel.create(S,aa,T)})),U=W.map(aa=>"fulfilled"===aa.status?aa.value:null).filter(aa=>aa);if(g.isAborted(T)||U.length!==W.length){U.forEach(aa=>aa.destroy());g.throwIfAborted(T);for(const aa of W)if("rejected"===aa.status)throw aa.reason;}this._levels=U;this._levelSelector=L(this)});return function(S,T){return R.apply(this,arguments)}}();N.uninitializeRenderContext=
function(){this._invalidateOctree();this._levels.forEach(R=>R.destroy());this._defaultRenderInstanceData.forEach(R=>R.destroy());this._highlightRenderInstanceData.forEach(R=>R.destroy())};N.prepareRender=function(R,S){k.LOD_INSTANCE_RENDERER_DISABLE_UPDATES||(this._enableLevelSelection&&(R=S.equals(this._lastCamera),this._lastCamera.copyFrom(S),R||this._requestUpdateCycle()),R=this._needFullCycle?this._instanceData.size:2E3,this._needFullCycle=!1,this._updateInstances(S,R),this.needsUpdates&&this._context.requestRender())};
N.render=function(R){var S,T,V,W;const U=R.slot===r.RenderSlot.OPAQUE_PLUGIN?r.RenderSlot.OPAQUE_MATERIAL:R.slot===r.RenderSlot.TRANSPARENT_PLUGIN?r.RenderSlot.TRANSPARENT_MATERIAL:null;if(U&&this.baseMaterial.isVisible()&&this.baseMaterial.isVisibleInPass(R.pass)){var aa=R.camera;this._inverseViewport[0]=1/aa.fullViewport[2];this._inverseViewport[1]=1/aa.fullViewport[3];aa={slot:U,origin:[0,0,0],camera:aa,inverseViewport:this._inverseViewport,shadowMap:R.shadowMap,shadowMappingEnabled:R.shadowMap.enabled,
ssaoHelper:R.ssaoHelper,ssaoEnabled:R.ssaoHelper.enabled,screenToWorldRatio:null,screenToPCSRatio:null,slicePlane:R.sliceHelper&&R.sliceHelper.plane,hudVisibilityTexture:null!=(S=null==(T=R.offscreenRenderingHelper)?void 0:T.hudVisibilityTexture)?S:null,highlightDepthTexture:null!=(V=null==(W=R.offscreenRenderingHelper)?void 0:W.depthTexture)?V:null,hasOccludees:!1,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMatrix:h.IDENTITY,ssrEnabled:!1,lighting:R.scenelightingData,transparencyPassType:R.transparencyPassType,
terrainLinearDepthTexture:R.multipassTerrainParams.terrainLinearDepthTexture,geometryLinearDepthTexture:R.multipassGeometryParams.geometryLinearDepthTexture,multipassTerrainEnabled:R.multipassTerrainParams.multipassTerrainEnabled,cullAboveGround:R.multipassTerrainParams.cullAboveGround,multipassGeometryEnabled:R.multipassGeometryParams.multipassGeometryEnabled,highlightColorTexture:null,cloudsCompositionParams:null,hasFillLights:R.hasFillLights};R.rctx.bindVAO();S=R.pass!==t.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT;
R.pass!==t.RenderPass.MATERIAL_HIGHLIGHT&&R.pass!==t.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT&&this._renderComponents(R,U,aa,this._defaultRenderInstanceData);S&&this._renderComponents(R,U,aa,this._highlightRenderInstanceData)}};N.intersect=function(R,S,T,V){if(this.baseMaterial.isVisible()){var W=f.create();n.subtract(W,V,T);var U=aa=>{this._instanceData.getCombinedModelTransform(aa,I);R.transform.set(I);n.transformMat4(O,T,R.transform.inverse);n.transformMat4(Q,V,R.transform.inverse);const da=
this._instanceData.getState(aa),Y=this._instanceData.getLodLevel(aa);x.assert(da&u.StateFlags.ACTIVE,"invalid instance state");x.assert(0<=Y&&Y<this._levels.length,"invaid lod level");this._levels[Y].intersect(R,S,O,Q,aa,this._metadata)};this.baseMaterial.parameters.verticalOffset?this.octree.forEach(U):this.octree.forEachAlongRay(T,W,U)}};N.queryDepthRange=function(R){return this._queryDepthRangeOctree(R)};N.notifyShaderTransformationChanged=function(){this._invalidateOctree()};N._requestUpdateCycle=
function(R=!1){this._updateCyclesWithStaticCamera=-1;R&&(this._needFullCycle=!0);this.needsUpdates&&this._context.requestRender()};N._invalidateOctree=function(){this._octree&&(this._octree.destroy(),this._octree=null)};N._buildOctree=function(){const R=new E.InstanceOctree(this._instanceData,this.baseBoundingSphere);var S=this._instanceData;S=S.view?S.view.state:null;for(let T=0;T<this._instanceData.capacity;++T)S.get(T)&u.StateFlags.ACTIVE&&R.addInstance(T);return R};N._queryDepthRangeOctree=function(R){var S=
R.eye;const T=R.viewForward;var V=this.octree.findClosest(T,q.DepthOrder.FRONT_TO_BACK,R.frustum);const W=this.octree.findClosest(T,q.DepthOrder.BACK_TO_FRONT,R.frustum);return null!=V&&null!=W?(this._instanceData.view.boundingSphere.getVec(V,K),n.subtract(K,K,S),V=n.dot(K,T)-K[3],this._instanceData.view.boundingSphere.getVec(W,K),n.subtract(K,K,S),S=n.dot(K,T)+K[3],{near:Math.max(R.near,V),far:Math.min(R.far,S)}):{near:Infinity,far:-Infinity}};N._startUpdateCycle=function(){this._updateCyclesWithStaticCamera++;
this._defaultRenderInstanceData.forEach(R=>{R.startUpdateCylce()});this._highlightRenderInstanceData.forEach(R=>{R.startUpdateCylce()});this.needsUpdates&&this._context.requestRender()};N._updateInstances=function(R,S){const T=this._enableLevelSelection,V=this._levelSelector;V.updateCamera(R);this._defaultRenderInstanceData.forEach(ea=>{ea.beginUpdate()});this._highlightRenderInstanceData.forEach(ea=>{ea.beginUpdate()});R=this._instanceData;const W=this._instanceData.view,U=R.capacity;let aa=this._instanceIndex;
S=Math.min(R.size,S);for(let ea=0;ea<S;++ea){0===aa&&this._startUpdateCycle();const ja=W.state.get(aa);var da=0;if(ja&u.StateFlags.ALLOCATED){var Y=W.lodLevel.get(aa);ja&u.StateFlags.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[Y].freeTail();ja&u.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[Y].freeTail();ja&u.StateFlags.REMOVE?R.freeInstance(aa):ja&u.StateFlags.VISIBLE?(Y=0,T&&(W.modelOrigin.getVec(aa,M),Y=V.selectLevel(M,R.getCombinedMedianScaleFactor(aa))),da=ja&~(u.StateFlags.ACTIVE|
u.StateFlags.TRANSFORM_CHANGED),0<=Y&&(ja&u.StateFlags.HIGHLIGHT?(G(this._highlightRenderInstanceData[Y],W,aa),da|=u.StateFlags.HIGHLIGHT_ACTIVE):(G(this._defaultRenderInstanceData[Y],W,aa),da|=u.StateFlags.DEFAULT_ACTIVE)),W.state.set(aa,da),W.lodLevel.set(aa,Y)):(da=ja&~(u.StateFlags.ACTIVE|u.StateFlags.TRANSFORM_CHANGED),W.state.set(aa,da));this._octree&&(Y=!!(ja&u.StateFlags.ACTIVE),da=!!(da&u.StateFlags.ACTIVE),!Y&&da?this._octree.addInstance(aa):Y&&!da?this._octree.removeInstance(aa):Y&&da&&
ja&u.StateFlags.TRANSFORM_CHANGED&&(this._octree.removeInstance(aa),this._octree.addInstance(aa)));aa=(aa+1)%U}else aa=(aa+1)%U,S++}this._instanceIndex=aa;this._defaultRenderInstanceData.forEach(ea=>{ea.endUpdate()});this._highlightRenderInstanceData.forEach(ea=>{ea.endUpdate()})};N._renderComponents=function(R,S,T,V){this.levels.forEach((W,U)=>{W.components.forEach(aa=>{this._renderComponent(R,S,T,V[U],aa,U)})})};N._renderComponent=function(R,S,T,V,W,U){if(0!==V.size&&W.material.requiresSlot(S)){var {rctx:aa,
pass:da}=R,Y=W.glMaterials.load(aa,da);if(!c.isNone(Y)){var ea=Y.beginSlot(T);S=aa.useTechnique(ea,S);Y.bind(T,ea);aa.bindVAO(W.vao);ea.ensureAttributeLocations(W.vao);R.isHighlightPass&&d.bindOutputHighlight(S,T);ea.bindDraw(T);k.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&R.pass===t.RenderPass.MATERIAL&&(S.setUniform4fv("externalColor",J[Math.min(U,J.length-1)]),S.setUniform1i("colorMixMode",D.colorMixModes.replace));var ja=aa.capabilities.instancing;R=V.capacity;T=V.headIndex;U=V.tailIndex;Y=V.firstIndex;
var la=this._glInstanceBufferLayout;S=(ia,ca)=>{F.bindVertexBufferLayout(aa,z.Default3D,V.buffer,la,ia);ja.drawArraysInstanced(ea.primitiveType,0,W.vertexCount,ca-ia);F.unbindVertexBufferLayout(aa,z.Default3D,V.buffer,la)};W.material.parameters.transparent&&null!=Y?T>U?(x.assert(Y>=U&&Y<=T,"invalid firstIndex"),S(Y,T),S(U,Y)):T<U&&(Y<=T?(x.assert(0<=Y&&Y<=T,"invalid firstIndex"),S(Y,T),S(U,R),S(0,Y)):(x.assert(Y>=U&&Y<=R,"invalid firstIndex"),S(Y,R),S(0,T),S(U,Y))):T>U?S(U,T):T<U&&(S(0,T),S(U,R));
aa.bindVAO(null)}}};b._createClass(P,[{key:"levels",get:function(){return this._levels}},{key:"baseBoundingBox",get:function(){return this._levels[this._levels.length-1].boundingBox}},{key:"baseBoundingSphere",get:function(){return this._levels[this._levels.length-1].boundingSphere}},{key:"baseMaterial",get:function(){return this._levels[this._levels.length-1].components[0].material}},{key:"slicePlaneEnabled",get:function(){return this._slicePlane},set:function(R){this._slicePlane=R}},{key:"layerUid",
get:function(){return this._metadata.layerUid}},{key:"instanceData",get:function(){return this._instanceData}},{key:"memoryUsage",get:function(){const R={cpu:0,gpu:0};this._defaultRenderInstanceData.forEach(S=>{S=S.memoryUsage;R.cpu+=S.cpu;R.gpu+=S.gpu});this._highlightRenderInstanceData.forEach(S=>{S=S.memoryUsage;R.cpu+=S.cpu;R.gpu+=S.gpu});return R}},{key:"renderStats",get:function(){const R=this._instanceData.size,S=[];this._levels.forEach((T,V)=>{V=this._defaultRenderInstanceData[V].size+this._highlightRenderInstanceData[V].size;
T=T.triangleCount;S.push({renderedInstances:V,renderedTriangles:V*T,trianglesPerInstance:T})});return{totalInstances:R,renderedInstances:S.reduce((T,V)=>T+V.renderedInstances,0),renderedTriangles:S.reduce((T,V)=>T+V.renderedTriangles,0),levels:S}}},{key:"needsTransparentPass",get:function(){return this._levels.some(R=>R.components.some(S=>S.material.requiresSlot(r.RenderSlot.TRANSPARENT_MATERIAL)))}},{key:"needsHighlight",get:function(){return this._highlightRenderInstanceData.some(R=>0<R.size)}},
{key:"needsUpdates",get:function(){return 0<this._instanceData.size&&1>this._updateCyclesWithStaticCamera}},{key:"octree",get:function(){this._octree||(this._octree=this._buildOctree());return this._octree}}]);return P}();const M=f.create(),K=l.create(),I=h.create(),O=f.create(),Q=f.create(),J=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]];a.LodRenderer=H;a.setLevelSelectorFactory=function(P){L=P};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/Evented ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/buffer/BufferView ../../../support/mathUtils ../../../support/buffer/InterleavedLayout ../Util ../VertexAttribute".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z){a.StateFlags=void 0;(function(u){u[u.ALLOCATED=1]="ALLOCATED";u[u.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE";u[u.VISIBLE=4]="VISIBLE";u[u.HIGHLIGHT=8]="HIGHLIGHT";u[u.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE";u[u.REMOVE=32]="REMOVE";u[u.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED";u[u.ACTIVE=18]="ACTIVE"})(a.StateFlags||(a.StateFlags={}));let v=function(u){this.localTransform=u.getField(z.VertexAttribute.LOCALTRANSFORM,k.BufferViewMat4f64);this.globalTransform=u.getField(z.VertexAttribute.GLOBALTRANSFORM,
k.BufferViewMat4f64);this.modelOrigin=u.getField(z.VertexAttribute.MODELORIGIN,k.BufferViewVec3f64);this.model=u.getField(z.VertexAttribute.MODEL,k.BufferViewMat3f);this.modelNormal=u.getField(z.VertexAttribute.MODELNORMAL,k.BufferViewMat3f);this.modelScaleFactors=u.getField(z.VertexAttribute.MODELSCALEFACTORS,k.BufferViewVec2f);this.boundingSphere=u.getField(z.VertexAttribute.BOUNDINGSPHERE,k.BufferViewVec4f64);this.color=u.getField(z.VertexAttribute.COLOR,k.BufferViewVec4f);this.featureAttribute=
u.getField(z.VertexAttribute.FEATUREATTRIBUTE,k.BufferViewVec4f);this.state=u.getField(z.VertexAttribute.STATE,k.BufferViewUint8);this.lodLevel=u.getField(z.VertexAttribute.LODLEVEL,k.BufferViewUint8)};c=function(u){function E(A,p){var B=u.call(this)||this;B._capacity=0;B._size=0;B._next=0;{let D=d.newLayout().mat4f64(z.VertexAttribute.LOCALTRANSFORM).mat4f64(z.VertexAttribute.GLOBALTRANSFORM).vec4f64(z.VertexAttribute.BOUNDINGSPHERE).vec3f64(z.VertexAttribute.MODELORIGIN).mat3f(z.VertexAttribute.MODEL).mat3f(z.VertexAttribute.MODELNORMAL).vec2f(z.VertexAttribute.MODELSCALEFACTORS);
0<=A.indexOf("color")&&(D=D.vec4f(z.VertexAttribute.COLOR));0<=A.indexOf("featureAttribute")&&(D=D.vec4f(z.VertexAttribute.FEATUREATTRIBUTE));A=D=D.u8(z.VertexAttribute.STATE).u8(z.VertexAttribute.LODLEVEL).alignTo(8)}B._layout=A;B._shaderTransformation=p;return B}b._inheritsLoose(E,u);var y=E.prototype;y.addInstance=function(){this._size+1>this._capacity&&this._grow();const A=this._findSlot();this._view.state.set(A,a.StateFlags.ALLOCATED);this._size++;this.emit("instance-added",{index:A});return A};
y.removeInstance=function(A){const p=this._view.state;m.assert(0<=A&&A<this._capacity&&p.get(A)&a.StateFlags.ALLOCATED,"invalid instance handle");this._getStateFlag(A,a.StateFlags.ACTIVE)?this._setStateFlags(A,a.StateFlags.REMOVE):this.freeInstance(A);this.emit("instance-removed",{index:A})};y.freeInstance=function(A){const p=this._view.state;m.assert(0<=A&&A<this._capacity&&p.get(A)&a.StateFlags.ALLOCATED,"invalid instance handle");p.set(A,0);this._size--};y.setLocalTransform=function(A,p,B=!0){this._view.localTransform.setMat(A,
p);B&&this.updateModelTransform(A)};y.getLocalTransform=function(A,p){this._view.localTransform.getMat(A,p)};y.setGlobalTransform=function(A,p,B=!0){this._view.globalTransform.setMat(A,p);B&&this.updateModelTransform(A)};y.getGlobalTransform=function(A,p){this._view.globalTransform.getMat(A,p)};y.updateModelTransform=function(A){const p=this._view;var B=q;const D=t;p.localTransform.getMat(A,r);p.globalTransform.getMat(A,x);const C=w.multiply(x,x,r);f.set(B,C[12],C[13],C[14]);p.modelOrigin.setVec(A,
B);g.fromMat4(D,C);p.model.setMat(A,D);B=e.scaleFromMatrix(q,C);B.sort();p.modelScaleFactors.set(A,0,B[1]);p.modelScaleFactors.set(A,1,B[2]);g.invert(D,D);g.transpose(D,D);p.modelNormal.setMat(A,D);this._setStateFlags(A,a.StateFlags.TRANSFORM_CHANGED);this.emit("instance-transform-changed",{index:A})};y.getModelTransform=function(A,p){const B=this._view;B.model.getMat(A,t);B.modelOrigin.getVec(A,q);p[0]=t[0];p[1]=t[1];p[2]=t[2];p[3]=0;p[4]=t[3];p[5]=t[4];p[6]=t[5];p[7]=0;p[8]=t[6];p[9]=t[7];p[10]=
t[8];p[11]=0;p[12]=q[0];p[13]=q[1];p[14]=q[2];p[15]=1};y.applyShaderTransformation=function(A,p){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,A,p)};y.getCombinedModelTransform=function(A,p){this.getModelTransform(A,p);this._shaderTransformation&&this._shaderTransformation.applyTransform(this,A,p);return p};y.getCombinedLocalTransform=function(A,p){this._view.localTransform.getMat(A,p);this._shaderTransformation&&this._shaderTransformation.applyTransform(this,A,p);return p};
y.getCombinedMaxScaleFactor=function(A){let p=this._view.modelScaleFactors.get(A,1);this._shaderTransformation&&(A=this._shaderTransformation.scaleFactor(q,this,A),p*=Math.max(A[0],A[1],A[2]));return p};y.getCombinedMedianScaleFactor=function(A){let p=this._view.modelScaleFactors.get(A,0);this._shaderTransformation&&(A=this._shaderTransformation.scaleFactor(q,this,A),A.sort(),p*=A[1]);return p};y.getModel=function(A,p){this._view.model.getMat(A,p)};y.setFeatureAttribute=function(A,p){this._view.featureAttribute.setVec(A,
p)};y.getFeatureAttribute=function(A,p){this._view.featureAttribute.getVec(A,p)};y.setColor=function(A,p){this._view.color.setVec(A,p)};y.getColor=function(A,p){this._view.color.getVec(A,p)};y.setVisible=function(A,p){p!==this.getVisible(A)&&(this._setStateFlag(A,a.StateFlags.VISIBLE,p),this.emit("instance-visibility-changed",{index:A}))};y.getVisible=function(A){return this._getStateFlag(A,a.StateFlags.VISIBLE)};y.setHighlight=function(A,p){p!==this.getHighlight(A)&&(this._setStateFlag(A,a.StateFlags.HIGHLIGHT,
p),this.emit("instance-highlight-changed",{index:A}))};y.getHighlight=function(A){return this._getStateFlag(A,a.StateFlags.HIGHLIGHT)};y.getState=function(A){return this._view.state.get(A)};y.getLodLevel=function(A){return this._view.lodLevel.get(A)};y.countFlags=function(A){let p=0;for(let B=0;B<this._capacity;++B)this.getState(B)&A&&++p;return p};y._setStateFlags=function(A,p){const B=this._view.state;p|=B.get(A);B.set(A,p)};y._clearStateFlags=function(A,p){const B=this._view.state;p=B.get(A)&~p;
B.set(A,p)};y._setStateFlag=function(A,p,B){B?this._setStateFlags(A,p):this._clearStateFlags(A,p)};y._getStateFlag=function(A,p){return!!(this._view.state.get(A)&p)};y._grow=function(){const A=Math.max(1024,Math.floor(2*this._capacity)),p=this._layout.createBuffer(A);if(this._buffer){const B=new Uint8Array(this._buffer.buffer);(new Uint8Array(p.buffer)).set(B)}this._capacity=A;this._buffer=p;this._view=new v(this._buffer)};y._findSlot=function(){const A=this._view.state;let p=this._next;for(;A.get(p)&
a.StateFlags.ALLOCATED;)p=(p+1)%this._capacity;this._next=(p+1)%this._capacity;return p};b._createClass(E,[{key:"capacity",get:function(){return this._capacity}},{key:"size",get:function(){return this._size}},{key:"buffer",get:function(){return this._buffer.buffer}},{key:"view",get:function(){return this._view}}]);return E}(c);const q=l.create(),t=h.create(),r=n.create(),x=n.create();a.InstanceData=c;a.InstanceDataView=v;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/sphere ../../../support/mathUtils ../Octree".split(" "),
function(a,b,c,g,h,w,n){n=function(f){function l(e,d){var m=f.call(this,z=>h.wrap(m._instanceData.view.boundingSphere.getVec(z,m._tmpSphere)),{maximumDepth:25})||this;m._tmpSphere=h.create();m._tmpMat4=c.create();m._instanceData=e;m._boundingSphere=d;return m}b._inheritsLoose(l,f);var k=l.prototype;k.addInstance=function(e){const d=this._instanceData.view.boundingSphere,m=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);g.transformMat4(this._tmpSphere,this._boundingSphere.center,m);this._tmpSphere[3]=
this._boundingSphere.radius*w.maxScale(m);d.setVec(e,this._tmpSphere);this.add([e])};k.removeInstance=function(e){this.remove([e])};return l}(n.default);a.InstanceOctree=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":function(){define(["exports","../Camera"],function(a,b){let c=function(){function g(w,n){this.thresholdScale=1;this._camera=new b.default;this._worldSpaceRadius=w;this._thresholds=n.map(f=>f)}var h=g.prototype;h.updateCamera=
function(w){this._camera.copyFrom(w)};h.selectLevel=function(w,n){w=this._camera.computeScreenPixelSizeAt(w);n=this._worldSpaceRadius*n/w;w=this._thresholds;let f=-1;for(let l=0;l<w.length;++l)n>=w[l]*this.thresholdScale&&(f=l);return f};return g}();a.LevelSelector=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodLevel":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ./LodComponentData".split(" "),
function(a,b,c,g,h,w,n){let f=function(){function l(e,d){this.minScreenSpaceRadius=e;this.components=d}l.create=function(){var e=b._asyncToGenerator(function*(d,m,z){const v=yield Promise.allSettled(m.components.map(t=>d.schedule(()=>new n.LodComponentData(d,t),z))),q=v.map(t=>"fulfilled"===t.status?t.value:null).filter(t=>t);if(g.isAborted(z)||q.length!==v.length){q.forEach(t=>t.destroy());g.throwIfAborted(z);for(const t of v)if("rejected"===t.status)throw t.reason;}return new l(m.minScreenSpaceRadius,
q)});return function(d,m,z){return e.apply(this,arguments)}}();var k=l.prototype;k.destroy=function(){this.components.forEach(e=>e.destroy())};k.intersect=function(e,d,m,z,v,q){this.components.forEach(t=>t.intersect(e,d,m,z,v,q))};b._createClass(l,[{key:"boundingBox",get:function(){if(c.isNone(this._boundingBox)){const e=w.empty();this.components.forEach(d=>{c.isSome(d.boundingInfo)&&(w.expandWithVec3(e,d.boundingInfo.bbMin),w.expandWithVec3(e,d.boundingInfo.bbMax))});this._boundingBox=e}return this._boundingBox}},
{key:"boundingSphere",get:function(){if(c.isNone(this._boundingSphere)){const e=this.boundingBox,d=h.create();w.center(e,d);this._boundingSphere={center:d,radius:.5*w.diameter(e)}}return this._boundingSphere}},{key:"triangleCount",get:function(){return this.components.reduce((e,d)=>e+d.triangleCount,0)}}]);return l}();a.LodLevel=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodComponentData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../support/buffer/glUtil ../DefaultVertexAttributeLocations ../GLMaterials ../Intersector ../IntersectorInterfaces ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),
function(a,b,c,g,h,w,n,f,l,k){let e=function(){function d(z,v){const q=z.renderContext.rctx,{geometry:t,material:r}=v;this._materialRepository=z.materialRep;r.setParameters({instancedDoublePrecision:!0});z=r.createBufferWriter();v=z.vertexBufferLayout;const x=z.elementCount(t),u=z.allocate(x);z.write({},t,u,0);this.geometry=t;this.material=r;this.glMaterials=new h.GLMaterials(r,this._materialRepository);this.vertexBufferLayout=v;this.vbo=f.BufferObject.createVertex(q,l.Usage.STATIC_DRAW,u.buffer);
this.vao=new k.VertexArrayObject(q,g.Default3D,{geometry:c.glLayout(v)},{geometry:this.vbo});this.vertexCount=x}var m=d.prototype;m.destroy=function(){this.glMaterials.destroy();this.vbo.dispose();this.vao.dispose()};m.intersect=function(z,v,q,t,r,x){const u=this.geometry.id;this.material.intersect(this.geometry,null,z.transform.transform,z,q,t,(E,y,A,p,B)=>{0<=E&&(null==v||v(z.rayBegin,z.rayEnd,E))&&(A={layerUid:x.layerUid,graphicUid:x.graphicUid(r),geometryId:u,triangleNr:A},(null==z.results.min.drapedLayerOrder||
B>=z.results.min.drapedLayerOrder)&&(null==z.results.min.dist||E<z.results.min.dist)&&z.results.min.set(n.IntersectorType.LOD,A,E,y,z.transform.transform,B),z.options.store!==n.StoreResults.MIN&&(null==z.results.max.drapedLayerOrder||B>=z.results.max.drapedLayerOrder)&&(null==z.results.max.dist||E>z.results.max.dist)&&z.results.max.set(n.IntersectorType.LOD,A,E,y,z.transform.transform,B),z.options.store===n.StoreResults.ALL&&(p=w.newIntersectorResult(z.results.min.ray),p.set(n.IntersectorType.LOD,
A,E,y,z.transform.transform,B),z.results.all.push(p)))})};b._createClass(d,[{key:"boundingInfo",get:function(){return this.geometry.boundingInfo}},{key:"triangleCount",get:function(){return this.vertexCount/3}}]);return d}();a.LodComponentData=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../geometry/support/buffer/BufferView ../Util ../VertexAttribute ./BackedBufferObject".split(" "),
function(a,b,c,g,h,w){let n=function(l){this.modelOriginHi=l.getField(h.VertexAttribute.MODELORIGINHI,c.BufferViewVec3f);this.modelOriginLo=l.getField(h.VertexAttribute.MODELORIGINLO,c.BufferViewVec3f);this.model=l.getField(h.VertexAttribute.MODEL,c.BufferViewMat3f);this.modelNormal=l.getField(h.VertexAttribute.MODELNORMAL,c.BufferViewMat3f);this.color=l.getField(h.VertexAttribute.INSTANCECOLOR,c.BufferViewVec4f);this.featureAttribute=l.getField(h.VertexAttribute.INSTANCEFEATUREATTRIBUTE,c.BufferViewVec4f)},
f=function(){function l(e,d){this._tailIndex=this._headIndex=0;this._captureFirstIndex=!0;this._updating=!1;this._prevHeadIndex=0;this._resized=!1;this._rctx=e;this._instanceBufferLayout=d;this._elementSize=d.stride;this._capacity=1}var k=l.prototype;k.destroy=function(){this._buffer&&this._buffer.destroy()};k.reset=function(){this._tailIndex=this._headIndex=0;this._firstIndex=null};k.startUpdateCylce=function(){this._captureFirstIndex=!0};k.beginUpdate=function(){g.assert(!this._updating,"already updating");
this._updating=!0;this._prevHeadIndex=this._headIndex};k.endUpdate=function(){g.assert(this._updating,"not updating");this.size<.3*this.capacity&&this._shrink();this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex);this._updating=!1};k.allocateHead=function(){g.assert(this._updating,"not updating");this.isFull&&this._grow();const e=this.headIndex;this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1);this._incrementHead();
g.assert(this._headIndex!==this._tailIndex,"invalid pointers");return e};k.freeTail=function(){g.assert(this._updating,"not updating");g.assert(0<this.size,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail();e&&(this._firstIndex=this._tailIndex)};k._grow=function(){this._resize(Math.max(1024,Math.floor(2*this._capacity)))};k._shrink=function(){this._resize(Math.max(1024,Math.floor(.5*this._capacity)))};k._resize=function(e){g.assert(this._updating,"not updating");if(e!==
this._capacity){var d=new w(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const m=this.size,z=this._compactInstances(d);g.assert(z===m,"invalid compaction");this._buffer.destroy();this._tailIndex=0;this._headIndex=z;this._prevHeadIndex=0}this._resized=!0;this._capacity=e;this._buffer=d;this._view=new n(this._instanceBufferLayout.createView(this._buffer.array))}};k._compactInstances=function(e){const d=
this._headIndex,m=this._tailIndex;return m<d?(this._buffer.copyRange(m,d,e),d-m):m>d?(this._buffer.copyRange(m,this._capacity,e),0<d&&this._buffer.copyRange(0,d,e,this._capacity-m),d+(this._capacity-m)):0};k._incrementHead=function(e=1){this._headIndex=(this._headIndex+e)%this._capacity};k._incrementTail=function(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity};k._transferRange=function(e,d){e<d?this._buffer.transferRange(e,d):e>d&&(0<d&&this._buffer.transferRange(0,d),this._buffer.transferRange(e,
this._capacity))};b._createClass(l,[{key:"buffer",get:function(){return this._buffer.buffer}},{key:"view",get:function(){return this._view}},{key:"capacity",get:function(){return this._capacity}},{key:"size",get:function(){const e=this._headIndex,d=this._tailIndex;return e>=d?e-d:e+this._capacity-d}},{key:"isEmpty",get:function(){return this._headIndex===this._tailIndex}},{key:"isFull",get:function(){return this._tailIndex===(this._headIndex+1)%this._capacity}},{key:"headIndex",get:function(){return this._headIndex}},
{key:"tailIndex",get:function(){return this._tailIndex}},{key:"firstIndex",get:function(){return this._firstIndex}},{key:"memoryUsage",get:function(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}}]);return l}();a.RenderInstanceData=f;a.RenderInstanceDataView=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../webgl/BufferObject","../../../../webgl/enums"],
function(a,b,c){return function(){function g(w,n,f){this._elementSize=n;this._buffer=b.BufferObject.createVertex(w,c.Usage.STATIC_DRAW);this.resize(f)}var h=g.prototype;h.destroy=function(){this._buffer.dispose()};h.copyRange=function(w,n,f,l=0){w=new Uint8Array(this.array,w*this.elementSize,(n-w)*this.elementSize);(new Uint8Array(f.array,l*this.elementSize)).set(w)};h.transferAll=function(){this._buffer.setData(this._array)};h.transferRange=function(w,n){w*=this._elementSize;this._buffer.setSubData(this._array,
w,w,n*this._elementSize)};h.resize=function(w){const n=w*this._elementSize,f=new ArrayBuffer(n);this._array&&(w>=this._capacity?(new Uint8Array(f)).set(new Uint8Array(this._array)):(new Uint8Array(f)).set((new Uint8Array(this._array)).subarray(0,w*this._elementSize)));this._array=f;this._buffer.setSize(n);this._capacity=w};a._createClass(g,[{key:"elementSize",get:function(){return this._elementSize}},{key:"capacity",get:function(){return this._capacity}},{key:"array",get:function(){return this._array}},
{key:"buffer",get:function(){return this._buffer}},{key:"memoryUsage",get:function(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}}]);return g}()})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat2 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ../support/FastSymbolUpdates ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/PathGeometry ../../webgl-engine/lib/pathGeometryUtils ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/PathMaterial".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C){function F(N,R,S){switch(R){case "world":for(const T of N.vertices)l.add(Q,T.pos,N.offset),S.worldUpAtPosition(Q,O),T.setFrameFromUpVector(O),T.computeRotationAxisAndAngleFromUpVector();break;case "path":l.add(Q,N.vertices[0].pos,N.offset);S.worldUpAtPosition(Q,O);B.computeMinimumRotationTangentFrame(N,O);for(const T of N.vertices)N=Math.sign(l.dot(T.frame.right,T.vRight)),l.cross(T.rotationFrame.up,T.vRight,T.vLeft),l.scale(T.rotationFrame.up,
T.rotationFrame.up,N),l.normalize(T.rotationFrame.up,T.rotationFrame.up),R=l.dot(T.rotationFrame.up,T.frame.up),S=l.dot(T.rotationFrame.up,T.frame.right),l.scale(Q,T.frame.up,-S),l.scale(J,T.frame.right,R),l.add(Q,Q,J),l.normalize(T.rotationFrame.right,Q),B.vertexSpaceToProfileSpace(T.rotationRight,T.frame,T.rotationFrame.right),l.negate(Q,T.vLeft),T.rotationAngle=-N*(Math.PI-g.acosClamped(l.dot(Q,T.vRight))),0<Math.abs(T.rotationAngle)&&(N=g.reciprocalClamped(Math.cos(.5*T.rotationAngle)),w.set(T.miterStretch,
1+(N-1)*T.rotationRight[0]*T.rotationRight[0],(N-1)*T.rotationRight[0]*T.rotationRight[1],(N-1)*T.rotationRight[0]*T.rotationRight[1],1+(N-1)*T.rotationRight[1]*T.rotationRight[1])),T.maxStretchDistance=Math.abs(Math.min(T.vLeftLength,T.vRightLength)*g.reciprocalClamped(Math.cos(.5*(Math.PI-T.rotationAngle))))}}function G(N,R,S){switch(N){case "symbol-value":return S;case "proportional":return R;default:return N}}function L(N,R,S,T){N=N.stageObject;const V=N.geometryRecords;var W=0;K.spatialReference=
T.spatialReference;for(const ea of V){const ja=ea.geometry;if(!p.isPathGeometry(ja))continue;const la=ja.path,ia=la.builder.path;I.spatialReference=ja.geometrySR;{var U=ia;var aa=R,da=S,Y=T;let ca=0;for(const fa of U.vertices)v.evaluateElevationInfoAtPoint(fa.posES,da,aa,Y,P),ca+=P.sampledElevation,l.add(O,fa.pos,U.offset),Y.setAltitude(O,P.z),l.subtract(fa.pos,O,U.offset);U.updatePathVertexInformation();U=ca/U.vertices.length}W+=U;"world"!==ja.upVectorAlignment&&F(ia,ja.upVectorAlignment,T);la.onPathChanged();
ja.invalidateBoundingInfo();N.geometryVertexAttrsUpdated(ea)}return W/V.length}const H=["polyline"];let M=function(N){function R(T,V,W,U){T=N.call(this,T,V,W,U)||this;T._intrinsicSize=f.fromValues(1,1);T.upVectorAlignment="path";T.stencilWidth=.1;T.ensureDrapedStatus(!1);return T}b._inheritsLoose(R,N);var S=R.prototype;S.doLoad=function(){var T=b._asyncToGenerator(function*(){const V=h.isSome(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,W=h.isSome(this.symbolLayer.height)?
this.symbolLayer.height:V;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[V,1,W],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}};this._fastUpdates=this._context.renderer&&this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?E.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};var U=this.symbolLayer.anchor||
"center";this.upVectorAlignment="path";"heading"===this.symbolLayer.profileRotation&&(this.upVectorAlignment="world");var aa=this.symbolLayer.profile||"circle";switch(aa){default:this._profile=B.Profile.circle(10);break;case "quad":this._profile=B.Profile.rect()}var da=[0,0];"center"!==U&&(da={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[U],this._profile.translate(da[0],da[1]));switch(this.symbolLayer.join||"simple"){case "round":this._extruder=new B.MiterExtruder(0,3);break;case "bevel":this._extruder=
new B.MiterExtruder(0,1);break;case "miter":this._extruder=new B.MiterExtruder(.8*Math.PI,1);break;default:this._extruder=new B.SimpleExtruder}U=this.symbolLayer.cap||"butt";switch(U){case "none":this._startCap=new B.NoCapBuilder;this._endCap=new B.NoCapBuilder;break;default:this._startCap=new B.TriangulationCapBuilder(this._profile,0);this._endCap=new B.TriangulationCapBuilder(this._profile,0,!0);break;case "square":this._startCap=new B.TriangulationCapBuilder(this._profile,-.5);this._endCap=new B.TriangulationCapBuilder(this._profile,
.5,!0);break;case "round":aa="quad"===aa?!0:!1,this._startCap=new B.RoundCapBuilder({profile:this._profile,flip:!1,breakNormals:aa,subdivisions:3}),this._endCap=new B.RoundCapBuilder({profile:this._profile,flip:!0,breakNormals:aa,subdivisions:3})}aa=h.get(this.symbolLayer,"material","color");da=this._getCombinedOpacityAndColor(aa);aa=e.fromArray(da);da=da[3];const Y=1>da||this.needsDrivenTransparentPass;U={diffuse:aa,ambient:aa,opacity:da,transparent:Y,vertexColors:!1,slicePlaneEnabled:this._context.slicePlaneEnabled,
castShadows:this.symbolLayer.castShadows,cullFace:Y||"none"===U?y.CullFaceOptions.None:y.CullFaceOptions.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(n.set(this._intrinsicSize,V,W),!x.isValidSize(this._intrinsicSize[0])||!x.isValidSize(this._intrinsicSize[1])))throw new c("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||n.scale(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters);
this._fastUpdates.enabled?(Object.assign(U,this._fastUpdates.materialParameters,{size:[this._intrinsicSize[0],this._intrinsicSize[1],0]}),this._material=new C.PathMaterial(U)):(U.vertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new D.DefaultMaterial(U));this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});this._context.stage.add(this._material)});return function(){return T.apply(this,arguments)}}();S.destroy=function(){N.prototype.destroy.call(this);
this._context.stage.remove(this._material);this._material=null};S.createGraphics3DGraphic=function(T){const V=T.graphic;if(!this._validateGeometry(V.geometry,H,this.symbolLayer.type))return null;const W=this.setGraphicElevationContext(V,new q.ElevationContext);return this._createAs3DShape(V,T.renderingInfo,W,V.uid)};S.layerOpacityChanged=function(){var T=h.get(this.symbolLayer,"material","color");T=this._getCombinedOpacity(T);this._material.setParameters({opacity:T,transparent:1>T||this.needsDrivenTransparentPass});
return!0};S.layerElevationInfoChanged=function(T,V){return this.updateGraphics3DGraphicElevationInfo(T,V,v.needsElevationUpdates3D)};S.slicePlaneEnabledChanged=function(){this._material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};S.physicalBasedRenderingChanged=function(){this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});return!0};S.pixelRatioChanged=function(){return!0};S.applyRendererDiff=function(T,V){for(const W in T.diff)switch(W){case "visualVariables":if(E.updateFastSymbolUpdatesState(this._fastUpdates,
V,this._vvConvertOptions))this._material.setParameters(this._fastUpdates.materialParameters);else return u.ApplyRendererDiffResult.Recreate_Symbol;break;default:return u.ApplyRendererDiffResult.Recreate_Symbol}return u.ApplyRendererDiffResult.Fast_Update};S.getVertexData=function(T){let V=0;const W=T.paths,U=[],aa=T.spatialReference,da=this._context.elevationProvider.spatialReference,Y=this._context.renderCoordsHelper.spatialReference;for(var ea of W)V+=ea.length;ea=new Float64Array(3*V);const ja=
new Float64Array(3*V),la=new Float64Array(3*V);let ia=0;for(const ca of W){U.push({index:ia,numVertices:ca.length});for(const fa of ca)ea[ia++]=fa[0],ea[ia++]=fa[1],ea[ia++]=T.hasZ?fa[2]:0}T=!0;aa.equals(da)?this._copyVertices(ea,0,ja,0,V):T=d.projectBuffer(ea,aa,0,ja,da,0,V);da.equals(Y)?this._copyVertices(ja,0,la,0,V):d.projectBuffer(ja,da,0,la,Y,0,V);return{pathVertexDataInfos:U,vertexDataGS:ea,vertexDataES:ja,vertexDataRS:la,projectionSuccess:T,terrainElevation:0}};S._copyVertices=function(T,
V,W,U,aa){V*=3;U*=3;for(let da=0;da<aa;++da)W[U++]=T[V++],W[U++]=T[V++],W[U++]=T[V++]};S._createAs3DShape=function(T,V,W,U){var aa=T.geometry,da=[];const Y=[],ea=[],ja=aa.spatialReference,la=m.create(),ia=this._context.renderCoordsHelper;I.spatialReference=ja;const ca=this.getVertexData(aa);if(!ca.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(0<ca.pathVertexDataInfos.length){for(aa=0;aa<ca.pathVertexDataInfos.length;++aa){var fa=
ca.pathVertexDataInfos[aa],ba=fa.index;fa=fa.numVertices;if(2>fa)continue;if(h.isSome(this._context.clippingExtent)&&(m.empty(la),m.expandWithBuffer(la,ca.vertexDataES,3*ba,fa),!m.intersectsClippingArea(la,this._context.clippingExtent)))continue;var Z=[];for(var ha=ba;ha<ba+3*fa;){const xa=ha++,Da=ha++,ua=ha++,Fa=new B.PathVertex;l.set(Fa.posGS,ca.vertexDataGS[xa],ca.vertexDataGS[Da],ca.vertexDataGS[ua]);l.set(Fa.posES,ca.vertexDataES[xa],ca.vertexDataES[Da],ca.vertexDataES[ua]);const qa=v.evaluateElevationAlignmentAtPoint(Fa.posES,
this._context.elevationProvider,W,ia);l.set(O,ca.vertexDataRS[xa],ca.vertexDataRS[Da],ca.vertexDataRS[ua]);ia.setAltitude(O,qa);l.set(Fa.pos,O[0],O[1],O[2]);Z.push(Fa)}ba=new B.Path(Z);F(ba,this.upVectorAlignment,this._context.renderCoordsHelper);ba=new B.Builder(ba,this._profile,this._extruder,this._startCap,this._endCap);fa=null;this._fastUpdates.enabled?(ha=this._fastUpdates.visualVariables,fa=ha.size?r.getAttributeValue(ha.size.field,T):0,Z=ha.color?r.getAttributeValue(ha.color.field,T):0,ha=
ha.opacity?r.getAttributeValue(ha.opacity.field,T):0,fa=new B.FastUpdatePathGeometry(ba,fa,Z,ha)):(fa=[this._intrinsicSize[0],this._intrinsicSize[1]],this._drivenProperties.size&&(fa[0]*=G(V.size[0],"symbol-value"===V.size[2]?this.symbolLayer.height||0:V.size[2],this.symbolLayer.width||0),fa[1]*=G(V.size[2],"symbol-value"===V.size[0]?this.symbolLayer.width||0:V.size[0],this.symbolLayer.height||0)),Z=null,this._drivenProperties.color&&(Z=V.color),this._drivenProperties.opacity&&null!=V.opacity&&(Z=
Z?[Z[0],Z[1],Z[2],V.opacity]:[1,1,1,V.opacity]),ba=new B.StaticPathGeometry(ba),ba.bake(fa),Z&&ba.bakeVertexColors(Z),fa=ba);const {vertexAttributes:na,indices:pa}=fa.createGeometryData();ba=new p.PathGeometry(na,pa,fa,ja,this.upVectorAlignment,this.stencilWidth);da.push(ba);Y.push(this._material);ea.push(fa.xform)}if(0<da.length)return T=new A.Object3D({geometries:da,materials:Y,transformations:ea,metadata:{layerUid:this._context.layer.uid,graphicUid:U}}),da=new t.Graphics3DObject3DGraphicLayer(this,
T,da,null,null,L,W),da.alignedSampledElevation=ca.terrainElevation,da.needsElevationUpdates=v.needsElevationUpdates3D(W.mode),da}else 0!==aa.paths.length&&aa.paths.some(na=>0<na.length)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null};return R}(r.Graphics3DSymbolLayer);const K=z.makeDehydratedPoint(0,0,0,null),I=z.makeDehydratedPoint(0,0,0,null),O=e.create(),Q=k.create(),J=k.create(),P=new v.SampleElevationInfo;a.Graphics3DPathSymbolLayer=M;
a.NUM_CIRCLE_PROFILE_SUBDIVISIONS=10;a.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS=3;a.NUM_ROUND_JOIN_SUBDIVISIONS=3;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/mat2":function(){define(["exports","./common"],function(a,b){function c(B,D){B[0]=D[0];B[1]=D[1];B[2]=D[2];B[3]=D[3];return B}function g(B){B[0]=1;B[1]=0;B[2]=0;B[3]=1;return B}function h(B,D,C,F,G){B[0]=D;B[1]=C;B[2]=F;B[3]=G;return B}function w(B,D){if(B===D){const C=D[1];B[1]=D[2];B[2]=C}else B[0]=D[0],B[1]=D[2],B[2]=D[1],
B[3]=D[3];return B}function n(B,D){const C=D[0],F=D[1],G=D[2];D=D[3];let L=C*D-G*F;if(!L)return null;L=1/L;B[0]=D*L;B[1]=-F*L;B[2]=-G*L;B[3]=C*L;return B}function f(B,D){const C=D[0];B[0]=D[3];B[1]=-D[1];B[2]=-D[2];B[3]=C;return B}function l(B){return B[0]*B[3]-B[2]*B[1]}function k(B,D,C){const F=D[0],G=D[1],L=D[2];D=D[3];const H=C[0],M=C[1],K=C[2];C=C[3];B[0]=F*H+L*M;B[1]=G*H+D*M;B[2]=F*K+L*C;B[3]=G*K+D*C;return B}function e(B,D,C){const F=D[0],G=D[1],L=D[2];D=D[3];const H=Math.sin(C);C=Math.cos(C);
B[0]=F*C+L*H;B[1]=G*C+D*H;B[2]=F*-H+L*C;B[3]=G*-H+D*C;return B}function d(B,D,C){const F=D[1],G=D[2],L=D[3],H=C[0];C=C[1];B[0]=D[0]*H;B[1]=F*H;B[2]=G*C;B[3]=L*C;return B}function m(B,D){const C=Math.sin(D);D=Math.cos(D);B[0]=D;B[1]=C;B[2]=-C;B[3]=D;return B}function z(B,D){B[0]=D[0];B[1]=0;B[2]=0;B[3]=D[1];return B}function v(B){return"mat2("+B[0]+", "+B[1]+", "+B[2]+", "+B[3]+")"}function q(B){return Math.sqrt(B[0]**2+B[1]**2+B[2]**2+B[3]**2)}function t(B,D,C,F){B[2]=F[2]/F[0];C[0]=F[0];C[1]=F[1];
C[3]=F[3]-B[2]*C[1];return[B,D,C]}function r(B,D,C){B[0]=D[0]+C[0];B[1]=D[1]+C[1];B[2]=D[2]+C[2];B[3]=D[3]+C[3];return B}function x(B,D,C){B[0]=D[0]-C[0];B[1]=D[1]-C[1];B[2]=D[2]-C[2];B[3]=D[3]-C[3];return B}function u(B,D){return B[0]===D[0]&&B[1]===D[1]&&B[2]===D[2]&&B[3]===D[3]}function E(B,D){const C=B[0],F=B[1],G=B[2];B=B[3];const L=D[0],H=D[1],M=D[2];D=D[3];return Math.abs(C-L)<=b.EPSILON*Math.max(1,Math.abs(C),Math.abs(L))&&Math.abs(F-H)<=b.EPSILON*Math.max(1,Math.abs(F),Math.abs(H))&&Math.abs(G-
M)<=b.EPSILON*Math.max(1,Math.abs(G),Math.abs(M))&&Math.abs(B-D)<=b.EPSILON*Math.max(1,Math.abs(B),Math.abs(D))}function y(B,D,C){B[0]=D[0]*C;B[1]=D[1]*C;B[2]=D[2]*C;B[3]=D[3]*C;return B}function A(B,D,C,F){B[0]=D[0]+C[0]*F;B[1]=D[1]+C[1]*F;B[2]=D[2]+C[2]*F;B[3]=D[3]+C[3]*F;return B}const p=Object.freeze({__proto__:null,copy:c,identity:g,set:h,transpose:w,invert:n,adjoint:f,determinant:l,multiply:k,rotate:e,scale:d,fromRotation:m,fromScaling:z,str:v,frob:q,LDU:t,add:r,subtract:x,exactEquals:u,equals:E,
multiplyScalar:y,multiplyScalarAndAdd:A,mul:k,sub:x});a.LDU=t;a.add=r;a.adjoint=f;a.copy=c;a.determinant=l;a.equals=E;a.exactEquals=u;a.frob=q;a.fromRotation=m;a.fromScaling=z;a.identity=g;a.invert=n;a.mat2=p;a.mul=k;a.multiply=k;a.multiplyScalar=y;a.multiplyScalarAndAdd=A;a.rotate=e;a.scale=d;a.set=h;a.str=v;a.sub=x;a.subtract=x;a.transpose=w})},"esri/views/3d/webgl-engine/lib/PathGeometry":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./Geometry"],function(a,b,c){c=
function(g){function h(w,n,f,l,k,e){w=g.call(this,w,n)||this;w.path=f;w.geometrySR=l;w.upVectorAlignment=k;w.stencilWidth=e;return w}b._inheritsLoose(h,g);return h}(c.Geometry);a.PathGeometry=c;a.isPathGeometry=function(g){return"upVectorAlignment"in g};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/pathGeometryUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../chunks/mat2 ../../../../chunks/mat2f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/plane ../../../../geometry/support/ray ./GeometryUtil ./VertexAttribute ../materials/internal/MaterialUtil".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q){function t(){return{up:e.create(),right:e.create()}}let r=function(){function V(){this.pos=e.create();this.posES=e.create();this.posGS=e.create();this.vRight=e.create();this.vLeft=e.create();this.frame=t();this.rotationFrame=t();this.rotationRight=l.create();this.rotationAngle=0;this.miterStretch=h.create()}var W=V.prototype;W.setFrameFromUpVector=function(U){k.copy(this.frame.up,U);k.add(J,this.vLeft,this.vRight);k.normalize(J,J);k.scale(Q,this.frame.up,
k.dot(J,this.frame.up));k.subtract(R,J,Q);k.normalize(R,R);k.cross(this.frame.right,R,this.frame.up)};W.computeRotationAxisAndAngleFromUpVector=function(){k.copy(this.rotationFrame.up,this.frame.up);k.copy(this.rotationFrame.right,this.frame.right);f.set(this.rotationRight,1,0);k.scale(Q,this.frame.up,k.dot(this.frame.up,this.vLeft));k.subtract(Q,this.vLeft,Q);k.negate(Q,Q);k.normalize(Q,Q);k.scale(J,this.frame.up,k.dot(this.frame.up,this.vRight));k.subtract(J,this.vRight,J);k.normalize(J,J);k.cross(P,
this.rotationFrame.up,this.vLeft);this.rotationAngle=Math.sign(k.dot(P,this.vRight))*(Math.PI-c.acosClamped(k.dot(Q,J)));if(0<Math.abs(this.rotationAngle)){const U=c.reciprocalClamped(Math.cos(.5*this.rotationAngle));g.set(this.miterStretch,1+(U-1),0,0,1)}this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*(Math.PI-this.rotationAngle)))};return V}(),x=function(){function V(){this.vertices=[];this.vertexIndices=[];this.vertexNormals=[];this.poles=[];this.poleIndices=
[];this.uvIndices=this.uvs=null}var W=V.prototype;W.addVertex=function(U,aa){this.vertices.push(l.clone(U));this.vertexNormals.push(l.clone(aa));return this.vertices.length-1};W.addUV=function(U){this.uvs||(this.uvs=[],this.uvIndices=[]);this.uvs.push(U);return this.uvs.length-1};W.addPole=function(U,aa=null){this.poles.push({position:l.clone(U),normal:aa?l.clone(aa):null});return this.poles.length-1};W.addSegment=function(U,aa=null,da=null){this.vertexIndices.push(U.v0);this.vertexIndices.push(U.v1);
aa&&(this.uvIndices.push(aa.v0),this.uvIndices.push(aa.v1));da&&(this.poleIndices.push(da.v0),this.poleIndices.push(da.v1))};W.hasUV=function(){return null!=this.uvs};W.translate=function(U,aa){for(const da of this.vertices)da[0]+=U,da[1]+=aa;for(const da of this.poles)da.position[0]+=U,da.position[1]+=aa};V.circle=function(U=20){const aa=new V,da={v0:0,v1:0};aa.addPole(l.fromValues(0,0));for(var Y=0;Y<U;++Y){var ea=2*Y*Math.PI/U,ja=Math.cos(ea);const la=Math.sin(ea);ea=l.fromValues(.5*ja,.5*la);
ja=l.fromValues(ja,la);aa.addVertex(ea,ja);aa.addUV(Y/U)}aa.addUV(1);for(Y=0;Y<U-1;++Y)ja={v0:Y,v1:Y+1},aa.addSegment(ja,ja,da);aa.addSegment({v0:U-1,v1:0},{v0:U-1,v1:U},da);return aa};V.rect=function(){const U=new V,aa=l.fromValues(-.5,-.5),da=l.fromValues(.5,-.5),Y=l.fromValues(.5,.5),ea=l.fromValues(-.5,.5),ja=l.fromValues(0,-1),la=l.fromValues(1,0),ia=l.fromValues(0,1),ca=l.fromValues(-1,0);U.addUV(0);U.addUV(1);U.addPole(l.fromValues(0,.5),ia);U.addPole(l.fromValues(0,.5));U.addPole(l.fromValues(0,
-.5));U.addPole(l.fromValues(0,-.5),ja);const fa={v0:0,v1:1};U.addVertex(aa,ja);U.addVertex(da,ja);U.addSegment({v0:0,v1:1},fa,{v0:3,v1:3});U.addVertex(da,la);U.addVertex(Y,la);U.addSegment({v0:2,v1:3},fa,{v0:2,v1:1});U.addVertex(Y,ia);U.addVertex(ea,ia);U.addSegment({v0:4,v1:5},fa,{v0:0,v1:0});U.addVertex(ea,ca);U.addVertex(aa,ca);U.addSegment({v0:6,v1:7},fa,{v0:1,v1:2});return U};b._createClass(V,[{key:"numSegments",get:function(){return this.vertexIndices.length/2}}]);return V}(),u=function(){function V(W){this.vertices=
[];this.offset=e.create();this.xform=n.create();this.vertices=W;k.copy(this.offset,this.vertices[Math.floor((W.length-1)/2)].pos);for(const U of this.vertices)k.subtract(U.pos,U.pos,this.offset);w.translate(this.xform,this.xform,this.offset);this.updatePathVertexInformation()}V.prototype.updatePathVertexInformation=function(){const W=this.vertices.length;let U=this.vertices[0];U.index=0;k.set(U.vLeft,0,0,0);U.vLeftLength=0;k.subtract(U.vRight,this.vertices[1].pos,U.pos);U.vRightLength=k.length(U.vRight);
k.normalize(U.vRight,U.vRight);let aa=U;for(let da=1;da<W;++da)U=this.vertices[da],U.index=da,k.copy(U.vLeft,aa.vRight),U.vLeftLength=aa.vRightLength,da<W-1?(k.subtract(U.vRight,this.vertices[da+1].pos,U.pos),U.vRightLength=k.length(U.vRight),k.normalize(U.vRight,U.vRight)):(k.copy(U.vRight,U.vLeft),U.vRightLength=U.vLeftLength),aa=U};return V}(),E=function(){function V(){}var W=V.prototype;W.numProfilesPerJoin=function(){return 1};W.extrude=function(U,aa,da){for(let Y=0;Y<aa.vertices.length;++Y)da(U.index,
U.frame,aa.vertices[Y],aa.vertexNormals[Y],!1)};return V}(),y=function(){function V(U=.8*Math.PI,aa=1){this.cutoffAngle=U;this.numBendSubdivisions=aa}var W=V.prototype;W.numProfilesPerJoin=function(){return this.numBendSubdivisions+1};W.extrude=function(U,aa,da){var Y=S;if(Math.abs(U.rotationAngle)>=this.cutoffAngle)for(var ea=0;ea<this.numBendSubdivisions+1;++ea){w.fromRotation(T,.5*-U.rotationAngle+ea*U.rotationAngle/this.numBendSubdivisions,U.rotationFrame.up);var ja=Y,la=U.frame,ia=T;k.transformMat4(ja.up,
la.up,ia);k.transformMat4(ja.right,la.right,ia);for(ja=0;ja<aa.vertices.length;++ja)0<=f.dot(aa.vertices[ja],U.rotationRight)*U.rotationAngle?da(U.index,Y,aa.vertices[ja],aa.vertexNormals[ja],!1):(f.transformMat2(K,aa.vertices[ja],U.miterStretch),da(U.index,U.frame,K,aa.vertexNormals[ja],!0))}else for(Y=0;Y<this.numBendSubdivisions+1;++Y)for(ea=0;ea<aa.vertices.length;++ea)ja=0<=f.dot(aa.vertices[ea],U.rotationRight)*U.rotationAngle,f.transformMat2(K,aa.vertices[ea],U.miterStretch),da(U.index,U.frame,
K,aa.vertexNormals[ea],ja?!1:!0)};return V}();const A={generateUV:!1};let p=function(){function V(){}V.prototype.rebuildConnectingProfileGeometry=function(W,U,aa){for(let da=0;da<U.vertices.length;++da)aa(W.index,W.frame,U.vertices[da],U.vertexNormals[da],0,0)};return V}(),B=function(V){function W(){return V.call(this)||this}b._inheritsLoose(W,V);var U=W.prototype;U.getNumVertices=function(){return 0};U.getNumIndices=function(){return 0};U.rebuildCapGeometry=function(){};U.buildTopology=function(){};
return W}(p),D=function(V){function W(aa,da=0,Y=!1){var ea=V.call(this)||this;ea.profile=aa;ea.profilePlaneOffset=da;ea.flip=Y;return ea}b._inheritsLoose(W,V);var U=W.prototype;U.getNumVertices=function(){return this.profile.vertices.length};U.getNumIndices=function(){return 3*this.profile.numSegments};U.rebuildConnectingProfileGeometry=function(aa,da,Y){for(let ea=0;ea<da.vertices.length;++ea)Y(aa.index,aa.frame,da.vertices[ea],da.vertexNormals[ea],this.profilePlaneOffset,0)};U.rebuildCapGeometry=
function(aa,da){const Y=I;f.set(Y,0,0);const ea=this.flip?1:-1;for(let ja=0;ja<this.profile.vertices.length;++ja)da(aa.index,aa.frame,this.profile.vertices[ja],Y,this.profilePlaneOffset,ea)};U.buildTopology=function(aa,da){aa=this.vertexBufferStart+this.profile.vertexIndices[0];for(let Y=1;Y<this.profile.numSegments;++Y){const ea=this.vertexBufferStart+this.profile.vertexIndices[2*Y],ja=this.vertexBufferStart+this.profile.vertexIndices[2*Y+1];this.flip?da(ja,ea,aa):da(aa,ea,ja)}};return W}(p),C=function(V){function W(aa){var da=
V.call(this)||this;da.flip=!1;da.sign=0;da.breakNormals=!1;da.numSegments=3;da.profile=aa.profile;da.flip=aa.flip;da.sign=da.flip?1:-1;da.breakNormals=aa.breakNormals;da.numSegments=aa.subdivisions;return da}b._inheritsLoose(W,V);var U=W.prototype;U.getNumVertices=function(){let aa=0;aa=this.profile.vertices.length*(this.numSegments-1);this.breakNormals&&(aa+=this.profile.vertices.length);return aa+=this.profile.poles.length};U.getNumIndices=function(){let aa;aa=2*this.profile.numSegments*(this.numSegments-
1);for(let da=0;da<this.profile.numSegments;++da)aa=this.profile.poleIndices[this.profile.vertexIndices[2*da]]===this.profile.poleIndices[this.profile.vertexIndices[2*da+1]]?aa+1:aa+2;return 3*aa};U.rebuildCapGeometry=function(aa,da){const Y=aa.frame,ea=.5*this.sign,ja=K,la=I;f.set(la,0,0);for(var ia=0;ia<this.profile.poles.length;++ia){var ca=this.profile.poles[ia];ca.normal?da(aa.index,Y,ca.position,ca.normal,ea,0):da(aa.index,Y,ca.position,la,ea,this.sign)}if(this.breakNormals)for(ia=0;ia<this.profile.vertices.length;++ia)da(aa.index,
Y,this.profile.vertices[ia],this.profile.vertexNormals[ia],0,0);for(ia=0;ia<this.numSegments-1;++ia){var fa=(1-(ia+1)/this.numSegments)*Math.PI*.5;ca=Math.sin(fa);fa=Math.cos(fa);for(let ba=0;ba<this.profile.vertices.length;++ba){const Z=this.profile.poles[this.profile.poleIndices[ba]];f.subtract(ja,this.profile.vertices[ba],Z.position);f.scale(ja,ja,ca);Z.normal?(f.add(ja,ja,Z.position),da(aa.index,Y,ja,Z.normal,ea*fa,0)):(f.normalize(la,ja),f.scale(la,la,ca),f.add(ja,ja,Z.position),da(aa.index,
Y,ja,la,ea*fa,this.sign*fa))}}};U.buildTopology=function(aa,da){aa=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex;const Y=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let ea=0;ea<this.profile.numSegments;++ea){const ja=this.profile.vertexIndices[2*ea],la=this.profile.vertexIndices[2*ea+1],ia=this.vertexBufferStart+this.profile.poleIndices[ja],ca=
this.vertexBufferStart+this.profile.poleIndices[la];let fa=aa+ja,ba=aa+la;for(let Z=0;Z<this.numSegments-1;++Z){const ha=Y+Z*this.profile.vertices.length+ja,na=Y+Z*this.profile.vertices.length+la;this.flip?(da(ha,ba,fa),da(ba,ha,na)):(da(fa,ba,ha),da(na,ha,ba));fa=ha;ba=na}this.flip?(da(ia,ba,fa),ia!==ca&&da(ia,ca,ba)):(da(fa,ba,ia),ia!==ca&&da(ba,ca,ia))}};return W}(p),F=function(){function V(U,aa,da,Y,ea,ja=A){this.options=ja;this.numUVTotal=this.numNormalsTotal=this.numVerticesTotal=this.numExtrusionProfiles=
this._triangleCount=this._extrusionVertexCount=0;this.profile=aa;this.path=U;this.extruder=da;this.startCap=Y;this.endCap=ea;U=this.path.vertices.length-2;this.numExtrusionProfiles=da.numProfilesPerJoin()*U+2;this.numNormalsTotal=this.numVerticesTotal=aa.vertices.length*this.numExtrusionProfiles;this.startCap.vertexBufferStart=this.numVerticesTotal;aa=this.startCap.getNumVertices();this.numVerticesTotal+=aa;this.numNormalsTotal+=aa;this.endCap.vertexBufferStart=this.numVerticesTotal;aa=this.endCap.getNumVertices();
this.numVerticesTotal+=aa;this.numNormalsTotal+=aa;this.pathVertexData=new Float32Array(1*this.numVerticesTotal);this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal);this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal);this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal);this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal));this.originData=new Float32Array(3*this.path.vertices.length);
this._rebuildGeometry();this.buildTopology()}var W=V.prototype;W.emitVertex=function(U,aa,da,Y,ea){this.profileRightAxisData[4*this._extrusionVertexCount]=aa.right[0];this.profileRightAxisData[4*this._extrusionVertexCount+1]=aa.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+2]=aa.right[2];this.profileUpAxisData[4*this._extrusionVertexCount]=aa.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+1]=aa.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+2]=aa.up[2];this.profileVertexAndNormalData[4*
this._extrusionVertexCount]=da[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=da[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=Y[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=Y[1];this.pathVertexData[this._extrusionVertexCount]=U;ea?(U=this.path.vertices[U],this.profileRightAxisData[4*this._extrusionVertexCount+3]=U.rotationRight[0]*U.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=U.rotationRight[1]*U.maxStretchDistance):
(this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0);++this._extrusionVertexCount};W.emitCapVertex=function(U,aa,da,Y,ea,ja){this.profileRightAxisData[4*this._extrusionVertexCount]=aa.right[0];this.profileRightAxisData[4*this._extrusionVertexCount+1]=aa.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+2]=aa.right[2];this.profileUpAxisData[4*this._extrusionVertexCount]=aa.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+
1]=aa.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+2]=aa.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount]=da[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=da[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=Y[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=Y[1];this.pathVertexData[this._extrusionVertexCount]=U;this.profileRightAxisData[4*this._extrusionVertexCount+3]=ea;this.profileUpAxisData[4*this._extrusionVertexCount+
3]=ja;++this._extrusionVertexCount};W.emitTriangle=function(U,aa,da){this.vertexIndices[3*this._triangleCount]=U;this.vertexIndices[3*this._triangleCount+1]=aa;this.vertexIndices[3*this._triangleCount+2]=da;this.pathVertexIndices[3*this._triangleCount]=this.pathVertexData[U];this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[aa];this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[da];this.normalIndices[3*this._triangleCount]=U;this.normalIndices[3*this._triangleCount+
1]=aa;this.normalIndices[3*this._triangleCount+2]=da;++this._triangleCount};W._rebuildGeometry=function(){var U=(Y,ea,ja,la,ia)=>this.emitVertex(Y,ea,ja,la,ia);const aa=(Y,ea,ja,la,ia,ca)=>this.emitCapVertex(Y,ea,ja,la,ia,ca);this._extrusionVertexCount=0;for(var da of this.path.vertices)this.originData[3*da.index]=da.pos[0],this.originData[3*da.index+1]=da.pos[1],this.originData[3*da.index+2]=da.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,aa);for(da=1;da<
this.path.vertices.length-1;++da)this.extruder.extrude(this.path.vertices[da],this.profile,U);this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,aa);this.startCap.rebuildCapGeometry(this.path.vertices[0],aa);this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],aa);if(this.profile.hasUV()&&this.options.generateUV)for(U=0;U<this.profile.uvs.length;++U)this.uvData[2*U]=this.profile.uvs[U],this.uvData[2*U+1]=0};W.buildTopology=
function(){const U=(ja,la,ia)=>this.emitTriangle(ja,la,ia);this._triangleCount=0;const aa=this.profile.vertices.length,da=this.profile.numSegments,Y=this.numExtrusionProfiles-1;var ea=da*Y*6;this.startCap.indexBufferStart=ea;this.startCap.firstProfileVertexIndex=0;ea+=this.startCap.getNumIndices();this.endCap.indexBufferStart=ea;this.endCap.firstProfileVertexIndex=aa*(this.numExtrusionProfiles-1);ea+=this.endCap.getNumIndices();this.vertexIndices=new Uint32Array(ea);this.normalIndices=new Uint32Array(ea);
this.pathVertexIndices=new Uint32Array(ea);this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(ea));for(ea=0;ea<da;++ea){const ja=this.profile.vertexIndices[2*ea],la=this.profile.vertexIndices[2*ea+1];for(let ia=0;ia<Y;++ia){const ca=ia*aa+ja,fa=(ia+1)*aa+la,ba=ia*aa+la;U(ca,(ia+1)*aa+ja,fa);U(ca,fa,ba)}}this.startCap.buildTopology(this.path.vertices[0],U);this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],U)};W.onPathChanged=function(){this._rebuildGeometry()};
return V}(),G=function(){function V(W){this.builder=W}V.prototype.onPathChanged=function(){this.builder.onPathChanged()};b._createClass(V,[{key:"xform",get:function(){return this.builder.path.xform}}]);return V}(),L=function(V){function W(aa){aa=V.call(this,aa)||this;aa.vertexAttributePosition=null;aa.vertexAttributeNormal=null;aa.vertexAttributeColor=null;aa.vertexAttributePosition=new Float32Array(3*aa.builder.numVerticesTotal);aa.vertexAttributeNormal=new Float32Array(3*aa.builder.numNormalsTotal);
aa.vertexAttributeColor=new Uint8Array(4);aa.vertexAttributeColor[0]=255;aa.vertexAttributeColor[1]=255;aa.vertexAttributeColor[2]=255;aa.vertexAttributeColor[3]=255;return aa}b._inheritsLoose(W,V);var U=W.prototype;U.bakeVertexColors=function(aa){this.vertexAttributeColor[0]=255*aa[0];this.vertexAttributeColor[1]=255*aa[1];this.vertexAttributeColor[2]=255*aa[2];this.vertexAttributeColor[3]=255*(3<aa.length?aa[3]:1)};U.bake=function(aa){this.size=aa;for(let ja=0;ja<this.builder.numVerticesTotal;++ja){var da=
this.builder.pathVertexData[ja],Y=0===da||da===this.builder.path.vertices.length-1;da*=3;var ea=M;k.set(ea,this.builder.originData[da++],this.builder.originData[da++],this.builder.originData[da]);da=4*ja;const la=Q,ia=K,ca=J,fa=P,ba=N;let Z=0,ha=0;k.set(fa,this.builder.profileRightAxisData[da],this.builder.profileRightAxisData[da+1],this.builder.profileRightAxisData[da+2]);k.set(ba,this.builder.profileUpAxisData[da],this.builder.profileUpAxisData[da+1],this.builder.profileUpAxisData[da+2]);f.set(ia,
this.builder.profileVertexAndNormalData[da]*aa[0],this.builder.profileVertexAndNormalData[da+1]*aa[1]);if(Y)k.cross(ca,ba,fa),Z=this.builder.profileRightAxisData[da+3]*aa[0],ha=this.builder.profileUpAxisData[da+3];else{Y=I;const na=O;f.set(Y,this.builder.profileRightAxisData[da+3],this.builder.profileUpAxisData[da+3]);const pa=f.length(Y);f.normalize(Y,Y);const xa=f.dot(ia,Y);if(Math.abs(xa)>pa){f.set(na,-Y[1],Y[0]);const Da=f.dot(ia,na);f.scale(Y,Y,pa*Math.sign(xa));f.scale(na,na,Da);f.add(ia,Y,
na)}k.set(ca,0,0,0)}k.set(la,fa[0]*ia[0]+ba[0]*ia[1],fa[1]*ia[0]+ba[1]*ia[1],fa[2]*ia[0]+ba[2]*ia[1]);this.vertexAttributePosition[3*ja]=ea[0]+la[0]+ca[0]*Z;this.vertexAttributePosition[3*ja+1]=ea[1]+la[1]+ca[1]*Z;this.vertexAttributePosition[3*ja+2]=ea[2]+la[2]+ca[2]*Z;ea=K;f.set(ea,this.builder.profileVertexAndNormalData[da+2],this.builder.profileVertexAndNormalData[da+3]);this.vertexAttributeNormal[3*ja]=fa[0]*ea[0]+ba[0]*ea[1]+ca[0]*ha;this.vertexAttributeNormal[3*ja+1]=fa[1]*ea[0]+ba[1]*ea[1]+
ca[1]*ha;this.vertexAttributeNormal[3*ja+2]=fa[2]*ea[0]+ba[2]*ea[1]+ca[2]*ha}};U.createGeometryData=function(){const aa=[[v.VertexAttribute.POSITION,this.builder.vertexIndices],[v.VertexAttribute.NORMAL,this.builder.normalIndices]],da=[[v.VertexAttribute.POSITION,{size:3,data:this.vertexAttributePosition,exclusive:!0}],[v.VertexAttribute.NORMAL,{size:3,data:this.vertexAttributeNormal,exclusive:!0}]];this.vertexAttributeColor&&(aa.push([v.VertexAttribute.COLOR,new Uint32Array(this.builder.vertexIndices.length)]),
da.push([v.VertexAttribute.COLOR,{size:4,data:this.vertexAttributeColor}]));return{vertexAttributes:da,indices:aa}};U.onPathChanged=function(){V.prototype.onPathChanged.call(this);this.bake(this.size)};U.intersect=function(aa,da,Y){const ea=this.builder.vertexIndices;q.intersectTriangles(aa,da,0,ea.length/3,ea,{size:3,data:this.vertexAttributePosition},void 0,void 0,Y)};return W}(G),H=function(V){function W(U,aa,da,Y){var ea=V.call(this,U)||this;ea.sizeAttributeValue=aa;ea.colorAttributeValue=da;
ea.opacityAttributeValue=Y;ea.vvData=null;ea.baked=new L(U);ea.vvData=new Float32Array(4*ea.builder.path.vertices.length);for(U=0;U<ea.builder.path.vertices.length;++U)ea.vvData[4*U]=aa,ea.vvData[4*U+1]=da,ea.vvData[4*U+2]=Y,ea.vvData[4*U+3]=0===U||U===ea.builder.path.vertices.length-1?1:0;return ea}b._inheritsLoose(W,V);W.prototype.createGeometryData=function(){return{vertexAttributes:[[v.VertexAttribute.POSITION,{size:3,data:this.builder.originData,exclusive:!0}],[v.VertexAttribute.PROFILERIGHT,
{size:4,data:this.builder.profileRightAxisData,exclusive:!0}],[v.VertexAttribute.PROFILEUP,{size:4,data:this.builder.profileUpAxisData,exclusive:!0}],[v.VertexAttribute.PROFILEVERTEXANDNORMAL,{size:4,data:this.builder.profileVertexAndNormalData,exclusive:!0}],[v.VertexAttribute.FEATUREVALUE,{size:4,data:this.vvData,exclusive:!0}]],indices:[[v.VertexAttribute.POSITION,this.builder.pathVertexIndices],[v.VertexAttribute.PROFILERIGHT,this.builder.vertexIndices],[v.VertexAttribute.PROFILEUP,this.builder.vertexIndices],
[v.VertexAttribute.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[v.VertexAttribute.FEATUREVALUE,this.builder.pathVertexIndices]]}};return W}(G);const M=e.create(),K=l.create(),I=l.create(),O=l.create(),Q=e.create(),J=e.create(),P=e.create(),N=e.create(),R=e.create(),S=t(),T=n.create();a.Builder=F;a.CapBuilder=p;a.Extruder=function(){};a.FastUpdatePathGeometry=H;a.MiterExtruder=y;a.NoCapBuilder=B;a.Path=u;a.PathGeometryData=G;a.PathVertex=r;a.Profile=x;a.RoundCapBuilder=C;a.SimpleExtruder=E;
a.StaticPathGeometry=L;a.TriangulationCapBuilder=D;a.computeMinimumRotationTangentFrame=function(V,W){let U=null;const aa=V.vertices.length,da=e.create(),Y=e.create(),ea=e.create(),ja=e.create(),la=e.create(),ia=e.create(),ca=d.create();let fa=V.vertices[0];k.copy(Y,W);k.set(da,0,1,0);z.makeOrthoBasisDirUpFallback(fa.vRight,Y,da,da,ea,Y,.99619469809);k.copy(fa.frame.up,Y);k.copy(fa.frame.right,ea);U=fa;for(W=1;W<aa;++W){fa=V.vertices[W];k.add(la,fa.vLeft,fa.vRight);let ba=k.length(la);0<ba?(ba=1/
Math.sqrt(ba),la[0]*=ba,la[1]*=ba,la[2]*=ba):(la[0]=fa.vRight[0],la[1]=fa.vRight[1],la[2]=fa.vRight[2]);k.add(ia,U.pos,U.frame.up);d.fromPositionAndNormal(fa.pos,la,ca);d.intersectRay(ca,m.wrap(ia,fa.vLeft),ja)?(k.subtract(ja,ja,fa.pos),k.normalize(Y,ja),k.cross(ea,la,Y),k.normalize(ea,ea)):z.makeOrthoBasisDirUpFallback(la,U.frame.up,U.frame.right,da,ea,Y,.99619469809);k.copy(fa.frame.up,Y);k.copy(fa.frame.right,ea);U=fa}};a.makeFrame=t;a.profileSpaceToVertexSpace=function(V,W,U){V[0]=U[0]*W.right[0]+
U[1]*W.up[0];V[1]=U[0]*W.right[1]+U[1]*W.up[1];V[2]=U[0]*W.right[2]+U[1]*W.up[2]};a.vertexSpaceToProfileSpace=function(V,W,U){f.set(V,k.dot(U,W.right),k.dot(U,W.up))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/mat2f64":function(){define(["exports"],function(a){function b(){return[1,0,0,1]}function c(n){return[n[0],n[1],n[2],n[3]]}function g(n,f,l,k){return[n,f,l,k]}function h(n,f){return new Float64Array(n,f,4)}const w=Object.freeze({__proto__:null,create:b,clone:c,fromValues:g,
createView:h});a.clone=c;a.create=b;a.createView=h;a.fromValues=g;a.mat2f64=w})},"esri/views/3d/webgl-engine/materials/PathMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/shading/Normals.glsl ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/PathGeometry ../lib/RenderPass ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./PathTechnique ./VisualVariableMaterialParameters ./internal/bufferWriterUtils ./internal/MaterialUtil".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E){let y=function(D){function C(G){G=D.call(this,G,p)||this;G.supportsEdges=!0;G._vertexAttributeLocations=r.pathVertexAttributeLocations;G.techniqueConfig=new r.PathTechniqueConfiguration;G.vertexBufferLayout=C.getVertexBufferLayout(G.parameters);return G}b._inheritsLoose(C,D);var F=C.prototype;F.getTechniqueConfig=function(G,L){this.techniqueConfig.output=G;this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled;this.techniqueConfig.vvColor=this.parameters.vvColorEnabled;
this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled;this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled;this.techniqueConfig.transparent=this.parameters.transparent;this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees;if(G===f.ShaderOutput.Color||G===f.ShaderOutput.Alpha)this.techniqueConfig.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?l.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===
this.parameters.doubleSidedType?l.NormalsDoubleSidedMode.WindingOrder:l.NormalsDoubleSidedMode.None,this.techniqueConfig.receiveShadows=this.parameters.receiveShadows,this.techniqueConfig.receiveSSAO=L.ssaoEnabled?this.parameters.receiveSSAO:!1;this.techniqueConfig.transparencyPassType=L.transparencyPassType;this.techniqueConfig.multipassTerrainEnabled=L.multipassTerrainEnabled;this.techniqueConfig.cullAboveGround=L.cullAboveGround;return this.techniqueConfig};F.getPassParameters=function(){return this.parameters};
F.isVisibleInPass=function(G){return G===z.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL||G===z.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT||G===z.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT?this.parameters.castShadows:!0};F.isVisible=function(){const G=this.parameters;return D.prototype.isVisible.call(this)?0<G.opacity:!1};F.intersect=function(G,L,H,M,K,I,O){if(m.isPathGeometry(G)){L=G.path;H=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){var Q=this.parameters.vvSizeOffset,
J=this.parameters.vvSizeFactor;const P=this.parameters.vvSizeMinSize,N=this.parameters.vvSizeMaxSize,R=L.sizeAttributeValue;H[0]*=c.clamp(Q[0]+R*J[0],P[0],N[0]);H[1]*=c.clamp(Q[2]+R*J[2],P[2],N[2])}Q=Math.max(H[0],H[1]);G=G.boundingInfo;g.isNone(G)?this._intersectTriangles(L,H,K,I,O):(G=h.fromValues(G.bbMin[0]-Q,G.bbMin[1]-Q,G.bbMin[2]-Q,G.bbMax[0]+Q,G.bbMax[1]+Q,G.bbMax[2]+Q),Q=[I[0]-K[0],I[1]-K[1],I[2]-K[2]],J=Math.sqrt(Q[0]*Q[0]+Q[1]*Q[1]+Q[2]*Q[2]),E.intersectAabbInvDir(G,K,[J/Q[0],J/Q[1],J/Q[2]],
M.tolerance)&&this._intersectTriangles(L,H,K,I,O))}};F._intersectTriangles=function(G,L,H,M,K){G.baked.size&&G.baked.size[0]===L[0]&&G.baked.size[1]===L[1]||G.baked.bake(L);G.baked.intersect(H,M,K)};F.computeAttachmentOrigin=function(G,L){G=G.vertexAttributes;if(!G)return null;G=G.get(t.VertexAttribute.POSITION);return k.computeAttachmentOriginLines(G,null,!1,L)};F.createBufferWriter=function(){return new B(this.vertexBufferLayout)};F.requiresSlot=function(G){return G===(this.parameters.transparent?
v.RenderSlot.TRANSPARENT_MATERIAL:v.RenderSlot.OPAQUE_MATERIAL)||G===v.RenderSlot.DRAPED_MATERIAL};F.createGLMaterial=function(G){return G.output===f.ShaderOutput.Color||G.output===f.ShaderOutput.Alpha||G.output===f.ShaderOutput.Depth||G.output===f.ShaderOutput.Normal||G.output===f.ShaderOutput.Highlight||G.output===f.ShaderOutput.Shadow&&this.parameters.castShadows?new A(G):null};C.getVertexBufferLayout=function(G){let L=n.newLayout().vec3f(t.VertexAttribute.POSITION).vec4f(t.VertexAttribute.PROFILERIGHT).vec4f(t.VertexAttribute.PROFILEUP).vec4f(t.VertexAttribute.PROFILEVERTEXANDNORMAL);
if(G.vvColorEnabled||G.vvSizeEnabled||G.vvOpacityEnabled)L=L.vec4f(t.VertexAttribute.FEATUREVALUE);return L};return C}(d.Material),A=function(D){function C(){return D.apply(this,arguments)||this}b._inheritsLoose(C,D);var F=C.prototype;F.updateParameters=function(G){return this.ensureTechnique(r.PathTechnique,G)};F._updateOccludeeState=function(G){G.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:G.hasOccludees})};F._updateShadowState=function(G){(g.isNone(this.technique)||
G.shadowMappingEnabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:G.shadowMappingEnabled})};F.beginSlot=function(G){if(this._output===f.ShaderOutput.Color||this._output===f.ShaderOutput.Alpha)this._updateShadowState(G),this._updateOccludeeState(G);return this.updateParameters(G)};F.bind=function(G,L){L.bindPass(this._material.getPassParameters(),G)};return C}(e);const p={size:[1,1,1],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],opacity:1,
doubleSided:!1,doubleSidedType:"normal",receiveSSAO:!0,receiveShadows:!1,castShadows:!0,slicePlaneEnabled:!1,transparent:!1,sceneHasOcludees:!1,...x.VisualVariableDefaultMaterialParameters,...d.DefaultMaterialParameters};let B=function(){function D(F){this.vertexBufferLayout=F}var C=D.prototype;C.allocate=function(F){return this.vertexBufferLayout.createBuffer(F)};C.elementCount=function(F){return F.indices.get(t.VertexAttribute.POSITION).length};C.write=function(F,G,L,H){const M=K=>{if(G.vertexAttributes.has(K)){const I=
G.vertexAttributes.get(K),O=G.indices.get(K);q.assert(4===I.size);const Q=L.getField(K,w.BufferViewVec4f);if(Q)u.writeBufferVec4(O,I.data,Q,H);else throw Error("unable to acquire view for "+K);}};M(t.VertexAttribute.PROFILERIGHT);M(t.VertexAttribute.PROFILEUP);M(t.VertexAttribute.PROFILEVERTEXANDNORMAL);this.vertexBufferLayout.hasField(t.VertexAttribute.FEATUREVALUE)&&M(t.VertexAttribute.FEATUREVALUE);u.writeDefaultAttributes(G,this.vertexBufferLayout,F.transformation,F.invTranspTransformation,L,
H)};return D}();a.PathMaterial=y;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/PathTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/attributes/PathVertexPosition.glsl ../core/shaderLibrary/attributes/VertexNormal.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/VertexAttribute ../../../../chunks/Path.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A){const p=new Map([[E.VertexAttribute.POSITION,0],[E.VertexAttribute.PROFILERIGHT,1],[E.VertexAttribute.PROFILEUP,2],[E.VertexAttribute.PROFILEVERTEXANDNORMAL,3],[E.VertexAttribute.FEATUREVALUE,4]]);v=function(B){function D(){return B.apply(this,arguments)||this}c._inheritsLoose(D,B);var C=D.prototype;C.initializeProgram=function(F){var G=D.shader.get();const L=this.configuration;G=G.build({oitEnabled:L.transparencyPassType===t.TransparencyPassType.Color,
output:L.output,viewingMode:F.viewingMode,slicePlaneEnabled:L.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:L.receiveShadows,vvSize:L.vvSize,vvColor:L.vvColor,vvInstancingEnabled:!0,vvOpacity:L.vvOpacity,pbrMode:e.PBRMode.Disabled,useCustomDTRExponentForWater:!1,receiveAmbientOcclusion:L.receiveSSAO,doubleSidedMode:L.doubleSidedMode,multipassTerrainEnabled:L.multipassTerrainEnabled,cullAboveGround:L.cullAboveGround});return new x.Program(F.rctx,G,p)};
C.bindPass=function(F,G){var L,H;m.bindProjectionMatrix(this.program,G.camera.projectionMatrix);this.program.setUniform3fv("size",F.size);G.multipassTerrainEnabled&&(this.program.setUniform2fv("nearFar",G.camera.nearFar),this.program.setUniform2fv("inverseViewport",G.inverseViewport),l.bindMultipassTerrainTexture(this.program,G));this.configuration.output!==h.ShaderOutput.Color&&this.configuration.output!==h.ShaderOutput.Alpha||this.program.setUniform1f("opacity",F.opacity);this.configuration.output===
h.ShaderOutput.Color?(G.lighting.setUniforms(this.program,!1,!1),this.program.setUniform3fv("ambient",F.ambient),this.program.setUniform3fv("diffuse",F.diffuse),this.program.setUniform3fv("specular",F.specular),this.program.setUniform1f("opacity",F.opacity)):this.configuration.output!==h.ShaderOutput.Depth&&this.configuration.output!==h.ShaderOutput.Shadow||this.program.setUniform2fv("nearFar",G.camera.nearFar);n.setVVUniforms(this.program,F);null==(L=G.shadowMap)?void 0:L.bind(this.program);null==
(H=G.ssaoHelper)?void 0:H.bind(this.program,G.camera)};C.bindDraw=function(F){m.bindView(this.program,F);w.bindSliceUniformsWithOrigin(this.program,this.configuration,F);this.program.rebindTextures();this.configuration.output!==h.ShaderOutput.Color&&this.configuration.output!==h.ShaderOutput.Alpha||m.bindCameraPosition(this.program,F.origin,F.camera.viewInverseTransposeMatrix);this.configuration.output===h.ShaderOutput.Color&&d.bindReadShadowMapView(this.program,F);this.configuration.output===h.ShaderOutput.Normal&&
f.bindVertexNormalUniforms(this.program,F.camera.viewInverseTransposeMatrix)};C._setPipelineState=function(F){const G=this.configuration,L=F===t.TransparencyPassType.NONE,H=F===t.TransparencyPassType.FrontFace;return A.makePipelineState({blending:G.output!==h.ShaderOutput.Color&&G.output!==h.ShaderOutput.Alpha||!G.transparent?null:L?r.blendingDefault:r.oitBlending(F),culling:(G.slicePlaneEnabled?!1:!G.transparent&&G.doubleSidedMode!==k.NormalsDoubleSidedMode.None)&&A.frontFaceCullingParams,depthTest:{func:r.oitDepthTest(F)},
depthWrite:L||H?A.defaultDepthWriteParams:null,colorWrite:A.defaultColorWriteParams,stencilWrite:G.sceneHasOcludees?u.stencilWriteMaskOn:null,stencilTest:G.sceneHasOcludees?u.stencilBaseAllZerosParams:null,polygonOffset:L||H?null:r.OITPolygonOffset})};C.initializePipeline=function(){return this._setPipelineState(this.configuration.transparencyPassType)};return D}(v.ShaderTechnique);v.shader=new z.ReloadableShaderModule(y.PathShader,()=>new Promise((B,D)=>a(["../shaders/Path.glsl"],B,D)));z=function(B){function D(){var C=
B.apply(this,arguments)||this;C.output=h.ShaderOutput.Color;C.doubleSidedMode=k.NormalsDoubleSidedMode.None;C.receiveShadows=!1;C.receiveSSAO=!1;C.vvSize=!1;C.vvColor=!1;C.vvOpacity=!1;C.slicePlaneEnabled=!1;C.transparent=!1;C.sceneHasOcludees=!1;C.transparencyPassType=t.TransparencyPassType.NONE;C.multipassTerrainEnabled=!1;C.cullAboveGround=!1;return C}c._inheritsLoose(D,B);return D}(q.ShaderTechniqueConfiguration);g.__decorate([q.parameter({count:h.ShaderOutput.COUNT})],z.prototype,"output",void 0);
g.__decorate([q.parameter({count:k.NormalsDoubleSidedMode.COUNT})],z.prototype,"doubleSidedMode",void 0);g.__decorate([q.parameter()],z.prototype,"receiveShadows",void 0);g.__decorate([q.parameter()],z.prototype,"receiveSSAO",void 0);g.__decorate([q.parameter()],z.prototype,"vvSize",void 0);g.__decorate([q.parameter()],z.prototype,"vvColor",void 0);g.__decorate([q.parameter()],z.prototype,"vvOpacity",void 0);g.__decorate([q.parameter()],z.prototype,"slicePlaneEnabled",void 0);g.__decorate([q.parameter()],
z.prototype,"transparent",void 0);g.__decorate([q.parameter()],z.prototype,"sceneHasOcludees",void 0);g.__decorate([q.parameter({count:t.TransparencyPassType.COUNT})],z.prototype,"transparencyPassType",void 0);g.__decorate([q.parameter()],z.prototype,"multipassTerrainEnabled",void 0);g.__decorate([q.parameter()],z.prototype,"cullAboveGround",void 0);b.PathTechnique=v;b.PathTechniqueConfiguration=z;b.pathVertexAttributeLocations=p;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl":function(){define(["exports",
"./PositionAttribute.glsl","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c,g){a.PathVertexPosition=function(h,w){h.attributes.add(g.VertexAttribute.FEATUREVALUE,"vec4");h.vertex.code.add(c.glsl`bool isCapVertex() {
return featureValue.w == 1.0;
}`);h.vertex.uniforms.add("size","vec3");w.vvSize?(h.vertex.uniforms.add("vvSizeMinSize","vec3"),h.vertex.uniforms.add("vvSizeMaxSize","vec3"),h.vertex.uniforms.add("vvSizeOffset","vec3"),h.vertex.uniforms.add("vvSizeFactor","vec3"),h.vertex.code.add(c.glsl`vec2 getSize() {
return size.xy*clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
}`)):h.vertex.code.add(c.glsl`vec2 getSize(){
return size.xy;
}`);w.vvOpacity?(h.vertex.constants.add("vvOpacityNumber","int",8),h.vertex.code.add(c.glsl`uniform float vvOpacityValues[vvOpacityNumber];
uniform float vvOpacityOpacities[vvOpacityNumber];
vec4 applyOpacity(vec4 color) {
float value = featureValue.z;
if (value <= vvOpacityValues[0]) {
return vec4( color.xyz, vvOpacityOpacities[0]);
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
}
}
return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
}`)):h.vertex.code.add(c.glsl`vec4 applyOpacity(vec4 color){
return color;
}`);w.vvColor?(h.vertex.constants.add("vvColorNumber","int",8),h.vertex.code.add(c.glsl`uniform float vvColorValues[vvColorNumber];
uniform vec4 vvColorColors[vvColorNumber];
vec4 getColor() {
float value = featureValue.y;
if (value <= vvColorValues[0]) {
return applyOpacity(vvColorColors[0]);
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
}
}
return applyOpacity(vvColorColors[vvColorNumber - 1]);
}`)):h.vertex.code.add(c.glsl`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`);h.include(b.PositionAttribute);h.attributes.add(g.VertexAttribute.PROFILERIGHT,"vec4");h.attributes.add(g.VertexAttribute.PROFILEUP,"vec4");h.attributes.add(g.VertexAttribute.PROFILEVERTEXANDNORMAL,"vec4");h.vertex.code.add(c.glsl`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`);h.vertex.code.add(c.glsl`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`);h.vertex.code.add(c.glsl`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`);h.vertex.code.add(c.glsl`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)};a.setVVUniforms=function(h,w){w.vvSizeEnabled&&(h.setUniform3fv("vvSizeMinSize",w.vvSizeMinSize),h.setUniform3fv("vvSizeMaxSize",w.vvSizeMaxSize),h.setUniform3fv("vvSizeOffset",w.vvSizeOffset),h.setUniform3fv("vvSizeFactor",w.vvSizeFactor));w.vvColorEnabled&&(h.setUniform1fv("vvColorValues",w.vvColorValues),h.setUniform4fv("vvColorColors",w.vvColorColors));w.vvOpacityEnabled&&(h.setUniform1fv("vvOpacityValues",w.vvOpacityValues),h.setUniform1fv("vvOpacityOpacities",w.vvOpacityOpacities))};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/chunks/Path.glsl":function(){define("exports ../views/ViewingMode ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x){function u(y){const A=new x.ShaderBuilder;A.vertex.uniforms.add("proj","mat4").add("view","mat4").add("cameraPosition","vec3").add("localOrigin","vec3");A.varyings.add("vpos","vec3");A.include(n.PathVertexPosition,y);if(y.output===g.ShaderOutput.Color||y.output===g.ShaderOutput.Alpha)A.include(w.Transform,{linearDepth:!1}),y.receiveShadows&&A.include(q.ReadShadowMap,y),A.include(c.ForwardLinearDepth,y),A.varyings.add("vnormal","vec3"),A.varyings.add("vcolor",
"vec4"),y.multipassTerrainEnabled&&A.varyings.add("depth","float"),A.vertex.code.add(r.glsl`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${y.multipassTerrainEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${y.output===g.ShaderOutput.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `);y.multipassTerrainEnabled&&(A.fragment.include(k.ReadLinearDepth),A.include(m.multipassTerrainTest,y));y.output===g.ShaderOutput.Alpha&&(A.include(h.Slice,y),A.fragment.uniforms.add("cameraPosition","vec3"),A.fragment.uniforms.add("localOrigin","vec3"),A.fragment.uniforms.add("opacity","float"),A.fragment.code.add(r.glsl`
      void main() {
        discardBySlice(vpos);
        ${y.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `));y.output===g.ShaderOutput.Color&&(A.include(h.Slice,y),A.include(d.EvaluateSceneLighting,y),A.include(e.EvaluateAmbientOcclusion,y),y.receiveShadows&&A.include(q.ReadShadowMap,y),A.include(z.Normals,y),A.fragment.uniforms.add("cameraPosition","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("specular","vec3").add("opacity","float"),A.fragment.include(t.ColorConversion),A.fragment.code.add(r.glsl`
      void main() {
        discardBySlice(vpos);
        ${y.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        shadingParams.normalView = vnormal;
        vec3 normal = shadingNormal(shadingParams);
        float ssao = evaluateAmbientOcclusionInverse();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${y.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":y.viewingMode===b.ViewingMode.Global?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
        float combinedOpacity = vcolor.a * opacity;
        albedo += 0.25 * specular; // don't completely ignore specular for now

        vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
        gl_FragColor = vec4(shadedColor, combinedOpacity);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${y.oitEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));if(y.output===g.ShaderOutput.Depth||y.output===g.ShaderOutput.Shadow)A.include(w.Transform,{linearDepth:!0}),A.vertex.uniforms.add("nearFar","vec2"),A.varyings.add("depth","float"),A.vertex.code.add(r.glsl`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),A.include(h.Slice,y),A.include(f.OutputDepth,y),A.fragment.uniforms.add("timeElapsed","float"),A.fragment.code.add(r.glsl`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);y.output===g.ShaderOutput.Normal&&(A.include(w.Transform,{linearDepth:!1}),A.include(v.NormalUtils,y),A.vertex.uniforms.add("viewNormal","mat4"),A.varyings.add("vnormal","vec3"),A.vertex.code.add(r.glsl`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),A.include(h.Slice,y),A.fragment.uniforms.add("waterColor","vec4"),A.fragment.code.add(r.glsl`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`));y.output===g.ShaderOutput.Highlight&&(A.include(w.Transform,{linearDepth:!1}),A.include(v.NormalUtils,y),A.vertex.uniforms.add("viewNormal","mat4"),A.varyings.add("vnormal","vec3"),A.vertex.code.add(r.glsl`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),A.include(h.Slice,y),A.include(l.OutputHighlight),A.fragment.code.add(r.glsl`void main() {
discardBySlice(vpos);
outputHighlight();
}`));return A}const E=Object.freeze({__proto__:null,build:u});a.PathShader=E;a.build=u})},"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/earcut ../../../../chunks/mat4f64 ../../../../chunks/vec4 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ./polygonUtils ../support/patternUtils ../support/uvUtils ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D){const C=["polyline","polygon","extent"];v=function(H){function M(I,O,Q,J){I=H.call(this,I,O,Q,J)||this;I._needsUV=!1;I._hasOutline=!1;return I}b._inheritsLoose(M,H);var K=M.prototype;K.doLoad=function(){var I=b._asyncToGenerator(function*(){});return function(){return I.apply(this,arguments)}}();K._ensureMaterials=function(){this._ensureFillMaterial();this._ensureOutlineMaterial()};K._ensureFillMaterial=function(){if(!g.isSome(this._material)){var I=
g.get(this.symbolLayer,"material","color");I=this._getCombinedOpacityAndColor(I);this._material=x.createMaterial(this.symbolLayer,{color:I,transparent:1>I[3]||this.needsDrivenTransparentPass,polygonOffset:!1,vertexColors:!0,writeLinearDepth:!0,slicePlaneEnabled:this._context.slicePlaneEnabled},{isDraped:this.draped});this._needsUV=this._material instanceof B.PatternMaterial;this._context.stage.add(this._material)}};K._ensureOutlineMaterial=function(){const I=this.symbolLayer.outline;!g.isSome(this._outlineMaterial)&&
this._isValidOutline(I)&&(this._hasOutline=!0,this._outlineMaterial=(O=>{const Q=p.getStipplePatternForLinePattern(I.pattern);return new D.RibbonLineMaterial({width:O,color:this._getOutlineColor(),polygonOffset:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:Q,stippleScaleWithLineWidth:!0,cap:t.parseCapType(I.patternCap||"butt")})})(h.pt2px(I.size)),this._context.stage.add(this._outlineMaterial))};K._isValidOutline=function(I){return g.isSome(I)&&I.size&&0<I.size&&
g.isSome(I.color)&&(g.isNone(I.pattern)||"style"!==I.pattern.type||"none"!==I.pattern.style)};K.destroy=function(){H.prototype.destroy.call(this);this._context.stage.remove(this._material);this._material=null;this._context.stage.remove(this._outlineMaterial);this._outlineMaterial=null};K.createGraphics3DGraphic=function(I){const O=I.graphic;if(!this._validateGeometry(O.geometry,C,this.symbolLayer.type))return null;I=this._getVertexOpacityAndColor(I.renderingInfo,255);const Q=this.setGraphicElevationContext(O,
new d.ElevationContext);this.ensureDrapedStatus("on-the-ground"===Q.mode);this._ensureMaterials();return this.draped?this._createAsOverlay(O,I):this._createAs3DShape(O,I,Q)};K.layerOpacityChanged=function(){if(g.isSome(this._material)){var I=this._material.parameters.color,O=g.get(this.symbolLayer,"material","color");O=this._getCombinedOpacity(O);this._material.setParameters({color:[I[0],I[1],I[2],O],transparent:1>O||this.needsDrivenTransparentPass})}g.isSome(this._outlineMaterial)&&(I=this._outlineMaterial.parameters.color,
this._outlineMaterial.setParameters({color:[I[0],I[1],I[2],this._getOutlineOpacity()]}));return!0};K.layerElevationInfoChanged=function(I,O,Q){const J=this._elevationContext.mode;Q=e.elevationModeChangeUpdateType(M.elevationModeChangeTypes,Q,J);if(Q!==e.SymbolUpdateType.UPDATE)return Q;const P=e.needsElevationUpdates2D(J);return this.updateGraphics3DGraphicElevationInfo(I,O,()=>P)};K.slicePlaneEnabledChanged=function(){g.isSome(this._material)&&this._material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled});
g.isSome(this._outlineMaterial)&&this._outlineMaterial.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};K.physicalBasedRenderingChanged=function(){return!0};K.pixelRatioChanged=function(){return!0};K._createAs3DShape=function(I,O,Q){const J=r.geometryAsPolygon(I.geometry);if(g.isNone(J))return null;G.renderData=r.geometryToRenderInfo(J,this._context.elevationProvider,this._context.renderCoordsHelper,Q);G.color=O;O=G.renderData.position.length/3;this._needsUV&&(G.uvMapSpace=
new Float32Array(4*O),G.boundingRect=new Float64Array(9*O));G.outNum=0;G.outGeometries=[];G.outTransforms=[];G.outMaterials=[];this._createAs3DShapeFill(G);this._hasOutline&&this._createAs3DShapeOutline(G);this._logGeometryCreationWarnings(G.renderData,J.rings,"rings","FillSymbol3DLayer");if(0===G.outNum)return null;this._needsUV&&u.createMapSpaceUVCoords(k.BufferViewVec4f.fromTypedArray(G.uvMapSpace),k.BufferViewVec3f64.fromTypedArray(G.renderData.position),this._context.renderCoordsHelper,k.BufferViewMat3f64.fromTypedArray(G.boundingRect));
I=new E.Object3D({geometries:G.outGeometries,materials:G.outMaterials,transformations:G.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:I.uid}});I=new z.Graphics3DObject3DGraphicLayer(this,I,G.outGeometries,null,null,x.uvElevationAligner,Q);I.alignedSampledElevation=G.renderData.sampledElevation;I.needsElevationUpdates=e.needsElevationUpdates2D(Q.mode);return I};K._createAs3DShapeFill=function(I){var O=I.renderData.polygons;for(const {position:Q,mapPosition:J,holeIndices:P,
index:N,count:R}of O){if(g.isSome(this._context.clippingExtent)&&(l.empty(F),l.expandWithBuffer(F,J),!l.intersectsClippingArea(F,this._context.clippingExtent)))continue;O=w.earcut(J,P,3);0!==O.length&&(O=new Uint32Array(O),O=r.createColorGeometry({indices:O,attributeData:{position:Q,color:I.color,mapPosition:J,uvMapSpace:this._needsUV?new Float32Array(I.uvMapSpace.buffer,4*N*I.uvMapSpace.BYTES_PER_ELEMENT,4*R):null,boundingRect:this._needsUV?new Float64Array(I.boundingRect.buffer,9*N*I.boundingRect.BYTES_PER_ELEMENT,
9*R):null}}),I.outGeometries.push(O),I.outMaterials.push(g.unwrap(this._material)),I.outTransforms.push(n.IDENTITY),I.outNum++)}};K._createAs3DShapeOutline=function(I){if(this._hasOutline){var O=I.renderData.outlines;for(let Q=0;Q<O.length;++Q){const {mapPosition:J,position:P}=O[Q];if(g.isSome(this._context.clippingExtent)&&(l.empty(F),l.expandWithBuffer(F,J),!l.intersectsClippingArea(F,this._context.clippingExtent)))continue;const N=t.createGeometry({overlayInfo:null,removeDuplicateStartEnd:t.RemoveDuplicateStartEnd.REMOVE,
attributeData:{position:P,mapPosition:J}}),R=N.vertexAttributes.get(A.VertexAttribute.POSITION);R.data===P&&(R.data=new Float64Array(P));I.outGeometries.push(N);I.outMaterials.push(g.unwrap(this._outlineMaterial));I.outTransforms.push(n.IDENTITY);I.outNum++}}};K._createAsOverlay=function(I,O){const Q=r.geometryAsPolygon(I.geometry);if(g.isNone(Q))return null;g.unwrap(this._material).renderPriority=this._renderPriority+this._renderPriorityStep/2;g.isSome(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=
this._renderPriority);L.renderData=r.geometryToRenderInfoDraped(Q,this._context.overlaySR);L.color=O;O=L.renderData.position.length/3;this._needsUV&&(L.uvMapSpace=new Float32Array(4*O));L.outNum=0;L.outGeometries=[];L.outBoundingBox=l.empty();L.layerUid=this._context.layer.uid;L.graphicsUid=I.uid;this._createAsOverlayFill(L);this._hasOutline&&this._createAsOverlayOutline(L);this._logGeometryCreationWarnings(L.renderData,Q.rings,"rings","FillSymbol3DLayer");if(0===L.outNum)return null;this._needsUV&&
u.createMapSpaceUVCoordsDraped(k.BufferViewVec4f.fromTypedArray(L.uvMapSpace),k.BufferViewVec3f64.fromTypedArray(L.renderData.position),this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode);return 0<L.outNum?new m(this,L.outGeometries,L.outBoundingBox):null};K._createAsOverlayFill=function(I){var O=I.renderData.polygons;for(const {position:Q,holeIndices:J,index:P,count:N}of O){l.empty(F);l.expandWithBuffer(F,Q);if(!l.intersectsClippingArea(F,this._context.clippingExtent))continue;
O=w.earcut(Q,J,3);if(0===O.length)continue;l.expandWithAABB(I.outBoundingBox,F);O=new Uint32Array(O);O=r.createColorGeometry({indices:O,attributeData:{position:Q,color:I.color,uvMapSpace:this._needsUV?new Float32Array(I.uvMapSpace.buffer,4*P*I.uvMapSpace.BYTES_PER_ELEMENT,4*N):null}});O=new y.RenderGeometry(O,g.unwrap(this._material),{layerUid:I.layerUid,graphicUid:I.graphicsUid});const R=F;f.set(O.boundingSphere,.5*(R[0]+R[3]),.5*(R[1]+R[4]),0,.5*Math.sqrt((R[3]-R[0])*(R[3]-R[0])+(R[4]-R[1])*(R[4]-
R[1])));I.outGeometries.push(O);I.outNum++}};K._createAsOverlayOutline=function(I){if(this._hasOutline){var O=I.renderData.outlines;for(let J=0;J<O.length;++J){var {position:Q}=O[J];l.empty(F);l.expandWithBuffer(F,Q);if(!l.intersectsClippingArea(F,this._context.clippingExtent))continue;l.expandWithAABB(I.outBoundingBox,F);Q=t.createGeometry({overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:t.RemoveDuplicateStartEnd.REMOVE,
attributeData:{position:Q}});Q=new y.RenderGeometry(Q,g.unwrap(this._outlineMaterial),{layerUid:I.layerUid,graphicUid:I.graphicsUid});const P=F;f.set(Q.boundingSphere,.5*(P[0]+P[3]),.5*(P[1]+P[4]),0,.5*Math.sqrt((P[3]-P[0])*(P[3]-P[0])+(P[4]-P[1])*(P[4]-P[1])));I.outGeometries.push(Q);I.outNum++}}};K._getOutlineOpacity=function(){const I=g.get(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(g.isSome(I)?I.a:0)};K._getOutlineColor=function(){const I=g.get(this.symbolLayer,
"outline","color"),O=this._getOutlineOpacity();return q.mixinColorAndOpacity(g.isSome(I)?c.toUnitRGB(I):null,O)};b._createClass(M,[{key:"test",get:function(){return{createAsOverlay:(I,O)=>this._createAsOverlay(I,O),createAs3DShape:(I,O,Q)=>this._createAs3DShape(I,O,Q)}}}]);return M}(v.Graphics3DSymbolLayer);v.elevationModeChangeTypes={definedChanged:e.SymbolUpdateType.RECREATE,staysOnTheGround:e.SymbolUpdateType.NONE,onTheGroundChanged:e.SymbolUpdateType.RECREATE};const F=l.create(),G={renderData:null,
color:null,uvMapSpace:null,boundingRect:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},L={renderData:null,color:null,uvMapSpace:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};a.Graphics3DPolygonFillSymbolLayer=v;a.default=v;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/patternUtils":function(){define("exports ../../../../core/has ../../../../core/maybe ../../../../chunks/vec4f64 ../../../../geometry/support/buffer/BufferView ../graphics/ElevationAligners ./uvUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/ColorMaterial ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/PatternStyle".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){function d(q,t,r){if(c.isSome(q)){if("none"===q.style||"solid"===q.style)return"none"===q.style&&(t.color=g.fromValues(0,0,0,0),t.transparent=!0),new l.ColorMaterial(t);t.style=m(q.style);t.draped=r.isDraped;return new k.PatternMaterial(t)}return new l.ColorMaterial(t)}function m(q){switch(q){case "horizontal":return e.Style.Horizontal;case "vertical":return e.Style.Vertical;case "cross":return e.Style.Cross;case "forward-diagonal":return e.Style.ForwardDiagonal;case "backward-diagonal":return e.Style.BackwardDiagonal;
case "diagonal-cross":return e.Style.DiagonalCross}}function z(q){return q.material instanceof k.PatternMaterial&&!q.material.parameters.draped}function v(q,t){if(z(q)){var r=q.geometry.vertexAttributes;q=r.get(f.VertexAttribute.POSITION).data;const x=r.get(f.VertexAttribute.UVMAPSPACE).data;r=r.get(f.VertexAttribute.BOUNDINGRECT).data;n.createMapSpaceUVCoords(h.BufferViewVec4f.fromTypedArray(x),h.BufferViewVec3f64.fromTypedArray(q),t,h.BufferViewMat3f64.fromTypedArray(r))}}a.createMaterial=function(q,
t,r){return d(q&&q.pattern||null,t,r)};a.createMaterialFromPattern=d;a.parsePatternStyle=m;a.requiresUVUpdates=z;a.updateMapSpaceUVCoords=v;a.uvElevationAligner=function(q,t,r,x){t=w.perVertexElevationAligner(q,t,r,x);q=q.stageObject.geometryRecords;for(r=0;r<q.length;r++)v(q[r],x);return t};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/uvUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/support/plane ../../../../geometry/support/buffer/BufferView ../../../ViewingMode".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){function m(H,M,K,I,O,Q,J){w.set(H,M*O[0]+K*Q[0]+I*J[0],M*O[1]+K*Q[1]+I*J[1],M*O[2]+K*Q[2]+I*J[2])}const z=n.create(),v=n.create(),q=k.create(),t=n.create(),r=n.create(),x=n.create(),u=h.create(),E=h.create(),y=h.create(),A=n.create(),p=n.create(),B=n.create(),D=c.create(),C=n.create(),F=n.create(),G=n.create(),L=n.create();a.createMapSpaceUVCoords=function(H,M,K,I,O=1){w.set(t,1,0,0);w.set(r,0,1,0);w.set(x,0,0,1);w.set(L,0,0,0);for(var Q=0;Q<M.count-1;Q++)M.getVec(Q,
v),w.add(L,L,v);w.scale(z,L,1/(M.count-1));Q=M.count-1;if(Q=k.fromManyPointsSampleAt(M,q,0,Math.floor(Q/3),Math.floor(2/3*Q))){b.isSome(K)?(K.basisMatrixAtPosition(z,D),w.set(C,D[0],D[1],D[2]),w.set(F,D[4],D[5],D[6]),w.set(G,D[8],D[9],D[10])):(w.set(C,1,0,0),w.set(F,0,1,0),w.set(G,0,0,1));K=k.normal(q);0>w.dot(K,G)&&w.scale(K,K,-1);w.copy(x,K);Q=w.dot(K,F);var J=w.dot(K,C);Math.abs(Q)<Math.abs(J)?(w.scaleAndAdd(t,C,K,-J),w.normalize(t,t),w.cross(r,t,K),w.normalize(r,r),w.scale(r,r,-1)):(w.scaleAndAdd(r,
F,K,-Q),w.normalize(r,r),w.cross(t,r,K),w.normalize(t,t))}g.set(u,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);g.set(E,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(K=0;K<M.count;K++)M.getVec(K,v),Q=w.dot(t,v),J=w.dot(r,v),u[0]=Math.min(u[0],Q),u[1]=Math.min(u[1],J),E[0]=Math.max(E[0],Q),E[1]=Math.max(E[1],J);K=w.dot(x,z);m(A,u[0],u[1],K,t,r,x);m(p,E[0],u[1],K,t,r,x);m(B,u[0],E[1],K,t,r,x);w.subtract(p,p,A);w.scale(p,p,.5);w.subtract(B,B,A);w.scale(B,B,.5);w.add(A,A,p);w.add(A,A,B);
K=u[1]%O;y[0]=u[0]-u[0]%O;y[1]=u[1]-K;for(K=0;K<M.count;K++)for(M.getVec(K,v),H.setValues(K,(w.dot(t,v)-y[0])/O,(w.dot(r,v)-y[1])/O,y[0]/O,y[1]/O),Q=0;3>Q;Q++)I.set(K,Q,A[Q]),I.set(K,Q+3,p[Q]),I.set(K,Q+6,B[Q])};a.createMapSpaceUVCoordsDraped=function(H,M,K,I,O=1){if(K.isGeographic&&I===d.ViewingMode.Global){I=new Float64Array(M.typedBuffer.length);const Q=3*M.count;K=l.getReferenceEllipsoid(K);for(let J=0;J<Q;J+=3)f.lonLatToWebMercatorComparable(M.typedBuffer,J,I,J,K);M=e.BufferViewVec3f64.fromTypedArray(I)}g.set(u,
Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(I=0;I<M.count;I++)M.getVec(I,v),u[0]=Math.min(u[0],v[0]),u[1]=Math.min(u[1],v[1]);I=u[1]%O;y[0]=u[0]-u[0]%O;y[1]=u[1]-I;for(I=0;I<M.count;I++)M.getVec(I,v),H.setValues(I,(v[0]-y[0])/O,(v[1]-y[1])/O,y[0]/O,y[1]/O)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/ShaderOutputOptions ../lib/basicInterfaces ../lib/GLMaterial ../lib/GLMaterials ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ./internal/DefaultBufferWriter ./internal/MaterialUtil ../shaders/ColorMaterialTechnique".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){let m=function(q){function t(x){x=q.call(this,x,v)||this;x.supportsEdges=!0;x.techniqueConfig=new d.ColorMaterialTechniqueConfiguration;return x}b._inheritsLoose(t,q);var r=t.prototype;r.getTechniqueConfig=function(x,u){this.techniqueConfig.output=x;this.techniqueConfig.cullFace=this.parameters.cullFace;this.techniqueConfig.vertexColors=this.parameters.vertexColors;this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled;this.techniqueConfig.transparent=
this.parameters.transparent;this.techniqueConfig.polygonOffset=this.parameters.polygonOffset;this.techniqueConfig.writeDepth=this.parameters.writeDepth;this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees;this.techniqueConfig.transparencyPassType=u.transparencyPassType;this.techniqueConfig.enableOffset=u.camera.relativeElevation<f.OITPolygonOffsetLimit;this.techniqueConfig.multipassTerrainEnabled=u.multipassTerrainEnabled;this.techniqueConfig.cullAboveGround=u.cullAboveGround;return this.techniqueConfig};
r.getPassParameters=function(){return this.parameters};r.intersect=function(x,u,E,y,A,p,B){e.intersectTriangleGeometry(x,u,y,A,p,void 0,B)};r.requiresSlot=function(x,u){return x===l.RenderSlot.DRAPED_MATERIAL?!0:w.outputFromPass(u)===c.ShaderOutput.Highlight?x===l.RenderSlot.OPAQUE_MATERIAL:x===(this.parameters.transparent?this.parameters.writeDepth?l.RenderSlot.TRANSPARENT_MATERIAL:l.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:l.RenderSlot.OPAQUE_MATERIAL)};r.createGLMaterial=function(x){return x.output===
c.ShaderOutput.Color||x.output===c.ShaderOutput.Alpha||x.output===c.ShaderOutput.Highlight||x.output===c.ShaderOutput.Depth&&this.parameters.writeLinearDepth?new z(x):null};r.createBufferWriter=function(){return new k.DefaultBufferWriter(k.PositionColorLayout)};return t}(n.Material),z=function(q){function t(){return q.apply(this,arguments)||this}b._inheritsLoose(t,q);var r=t.prototype;r.updateParameters=function(x){return this.ensureTechnique(d.ColorMaterialTechnique,x)};r._updateOccludeeState=function(x){x.hasOccludees!==
this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:x.hasOccludees})};r.beginSlot=function(x){this._output!==c.ShaderOutput.Color&&this._output!==c.ShaderOutput.Alpha||this._updateOccludeeState(x);return this.updateParameters(x)};r.bind=function(x,u){u.bindPass(this._material.getPassParameters(),x)};return t}(h);const v={color:[1,1,1,1],transparent:!1,writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:g.CullFaceOptions.None,
sceneHasOcludees:!1,...n.DefaultMaterialParameters};a.ColorMaterial=m;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../../../../chunks/ColorMaterial.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x){e=function(E){function y(){return E.apply(this,arguments)||this}c._inheritsLoose(y,E);var A=y.prototype;A.initializeProgram=function(p){var B=y.shader.get();const D=this.configuration;B=B.build({output:D.output,oitEnabled:D.transparencyPassType===m.TransparencyPassType.Color,attributeColor:D.vertexColors,slicePlaneEnabled:D.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,multipassTerrainEnabled:D.multipassTerrainEnabled,
cullAboveGround:D.cullAboveGround});return new q.Program(p.rctx,B,z.Default3D)};A.bindPass=function(p,B){l.bindProjectionMatrix(this.program,B.camera.projectionMatrix);this.program.setUniform4fv("eColor",p.color);this.configuration.output===h.ShaderOutput.Highlight&&n.bindOutputHighlight(this.program,B);(this.configuration.output===h.ShaderOutput.Depth||B.multipassTerrainEnabled)&&this.program.setUniform2fv("nearFar",B.camera.nearFar);B.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",
B.inverseViewport),f.bindMultipassTerrainTexture(this.program,B))};A.bindDraw=function(p){l.bindView(this.program,p);this.program.rebindTextures();w.bindSliceUniformsWithOrigin(this.program,this.configuration,p)};A._createPipeline=function(p,B){const D=this.configuration,C=p===m.TransparencyPassType.NONE,F=p===m.TransparencyPassType.FrontFace;return x.makePipelineState({blending:D.output!==h.ShaderOutput.Color&&D.output!==h.ShaderOutput.Alpha||!D.transparent?null:C?v.blendingDefault:v.oitBlending(p),
culling:x.cullingParams(D.cullFace),depthTest:{func:v.oitDepthTest(p)},depthWrite:C||F?D.writeDepth&&x.defaultDepthWriteParams:null,colorWrite:x.defaultColorWriteParams,stencilWrite:D.sceneHasOcludees?t.stencilWriteMaskOn:null,stencilTest:D.sceneHasOcludees?B?t.stencilToolMaskBaseParams:t.stencilBaseAllZerosParams:null,polygonOffset:C||F?D.polygonOffset&&u:v.getOITPolygonOffset(D.enableOffset)})};A.initializePipeline=function(){this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,
!0);return this._createPipeline(this.configuration.transparencyPassType,!1)};A.getPipelineState=function(p,B){return B?this._occludeePipelineState:E.prototype.getPipelineState.call(this,p,B)};return y}(e.ShaderTechnique);e.shader=new k.ReloadableShaderModule(r.ColorMaterialShader,()=>new Promise((E,y)=>a(["./ColorMaterial.glsl"],E,y)));const u={factor:1,units:1};k=function(E){function y(){var A=E.apply(this,arguments)||this;A.output=h.ShaderOutput.Color;A.cullFace=m.CullFaceOptions.None;A.slicePlaneEnabled=
!1;A.vertexColors=!1;A.transparent=!1;A.polygonOffset=!1;A.enableOffset=!0;A.writeDepth=!0;A.sceneHasOcludees=!1;A.transparencyPassType=m.TransparencyPassType.NONE;A.multipassTerrainEnabled=!1;A.cullAboveGround=!1;return A}c._inheritsLoose(y,E);return y}(d.ShaderTechniqueConfiguration);g.__decorate([d.parameter({count:h.ShaderOutput.COUNT})],k.prototype,"output",void 0);g.__decorate([d.parameter({count:m.CullFaceOptions.COUNT})],k.prototype,"cullFace",void 0);g.__decorate([d.parameter()],k.prototype,
"slicePlaneEnabled",void 0);g.__decorate([d.parameter()],k.prototype,"vertexColors",void 0);g.__decorate([d.parameter()],k.prototype,"transparent",void 0);g.__decorate([d.parameter()],k.prototype,"polygonOffset",void 0);g.__decorate([d.parameter()],k.prototype,"enableOffset",void 0);g.__decorate([d.parameter()],k.prototype,"writeDepth",void 0);g.__decorate([d.parameter()],k.prototype,"sceneHasOcludees",void 0);g.__decorate([d.parameter({count:m.TransparencyPassType.COUNT})],k.prototype,"transparencyPassType",
void 0);g.__decorate([d.parameter()],k.prototype,"multipassTerrainEnabled",void 0);g.__decorate([d.parameter()],k.prototype,"cullAboveGround",void 0);b.ColorMaterialTechnique=e;b.ColorMaterialTechniqueConfiguration=k;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/ColorMaterial.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z){function v(t){const r=new m.ShaderBuilder,x=t.output===b.ShaderOutput.Depth;r.include(g.Transform,{linearDepth:x});r.include(h.VertexColor,t);r.vertex.uniforms.add("proj","mat4").add("view","mat4");r.attributes.add(z.VertexAttribute.POSITION,"vec3");r.varyings.add("vpos","vec3");t.multipassTerrainEnabled&&r.varyings.add("depth","float");x&&(r.include(w.OutputDepth,t),r.vertex.uniforms.add("nearFar","vec2"),r.varyings.add("linearDepth","float"));r.vertex.code.add(d.glsl`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${t.multipassTerrainEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${x?d.glsl`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:d.glsl`transformPosition(proj, view, vpos);`}
    }
  `);r.include(c.Slice,t);r.fragment.include(e.ColorConversion);t.multipassTerrainEnabled&&(r.fragment.include(f.ReadLinearDepth),r.include(l.multipassTerrainTest,t));r.fragment.uniforms.add("eColor","vec4");t.output===b.ShaderOutput.Highlight&&r.include(n.OutputHighlight);r.fragment.code.add(d.glsl`
  void main() {
    discardBySlice(vpos);
    ${t.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${t.attributeColor?"vColor * eColor;":"eColor;"}

    if (fColor.a < ${d.glsl.float(k.symbolAlphaCutoff)}) {
      discard;
    }

    ${t.output===b.ShaderOutput.Alpha?d.glsl`gl_FragColor = vec4(fColor.a);`:""}

    ${t.output===b.ShaderOutput.Color?d.glsl`gl_FragColor = highlightSlice(fColor, vpos); ${t.oitEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}`:""}
    ${t.output===b.ShaderOutput.Highlight?d.glsl`outputHighlight();`:""};
    ${t.output===b.ShaderOutput.Depth?d.glsl`outputDepth(linearDepth);`:""};
  }
  `);return r}const q=Object.freeze({__proto__:null,build:v});a.ColorMaterialShader=q;a.build=v})},"esri/views/3d/webgl-engine/materials/PatternMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry/support/buffer/BufferView ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../lib/basicInterfaces ../lib/GLMaterial ../lib/GLMaterials ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./PatternStyle ./internal/bufferWriterUtils ./internal/DefaultBufferWriter ./internal/MaterialUtil ../shaders/PatternTechnique".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r){let x=function(A){function p(D){D=A.call(this,D,y)||this;D.supportsEdges=!0;D._vertexAttributeLocations=r.patternVertexAttributeLocations;D.techniqueConfig=new r.PatternTechniqueConfiguration;return D}b._inheritsLoose(p,A);var B=p.prototype;B.getTechniqueConfig=function(D,C){this.techniqueConfig.output=D;this.techniqueConfig.cullFace=this.parameters.cullFace;this.techniqueConfig.vertexColors=this.parameters.vertexColors;this.techniqueConfig.slicePlaneEnabled=
this.parameters.slicePlaneEnabled;this.techniqueConfig.polygonOffset=this.parameters.polygonOffset;this.techniqueConfig.writeDepth=this.parameters.writeDepth;this.techniqueConfig.style=this.parameters.style;this.techniqueConfig.patternSpacing=this.parameters.patternSpacing;this.techniqueConfig.lineWidth=this.parameters.lineWidth;this.techniqueConfig.draped=this.parameters.draped;this.techniqueConfig.transparencyPassType=C.transparencyPassType;this.techniqueConfig.enableOffset=C.camera.relativeElevation<
k.OITPolygonOffsetLimit;this.techniqueConfig.multipassTerrainEnabled=C.multipassTerrainEnabled;this.techniqueConfig.cullAboveGround=C.cullAboveGround;return this.techniqueConfig};B.getPassParameters=function(){return this.parameters};B.intersect=function(D,C,F,G,L,H,M){t.intersectTriangleGeometry(D,C,G,L,H,void 0,M)};B.requiresSlot=function(D,C){return D===e.RenderSlot.DRAPED_MATERIAL?!0:f.outputFromPass(C)===h.ShaderOutput.Highlight?D===e.RenderSlot.OPAQUE_MATERIAL:D===(this.parameters.writeDepth?
e.RenderSlot.TRANSPARENT_MATERIAL:e.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL)};B.createGLMaterial=function(D){return D.output===h.ShaderOutput.Color||D.output===h.ShaderOutput.Alpha||D.output===h.ShaderOutput.Highlight||D.output===h.ShaderOutput.Depth&&this.parameters.writeLinearDepth?new u(D):null};B.createBufferWriter=function(){const D=g.newLayout().vec3f(m.VertexAttribute.POSITION).vec4u8(m.VertexAttribute.COLOR).vec4f(m.VertexAttribute.UVMAPSPACE);this.parameters.draped||D.mat3f(m.VertexAttribute.BOUNDINGRECT);
return new E(D)};return p}(l.Material),u=function(A){function p(){return A.apply(this,arguments)||this}b._inheritsLoose(p,A);var B=p.prototype;B.updateParameters=function(D){return this.ensureTechnique(r.PatternTechnique,D)};B._updateOccludeeState=function(D){D.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:D.hasOccludees})};B.beginSlot=function(D){this._output!==h.ShaderOutput.Color&&this._output!==h.ShaderOutput.Alpha||this._updateOccludeeState(D);
return this.updateParameters(D)};B.bind=function(D,C){C.bindPass(this._material.getPassParameters(),D)};return p}(n),E=function(A){function p(){return A.apply(this,arguments)||this}b._inheritsLoose(p,A);var B=p.prototype;B.write=function(D,C,F,G){for(const H of this.vertexBufferLayout.fieldNames){const M=C.vertexAttributes.get(H),K=C.indices.get(H);if(M&&K)switch(H){case m.VertexAttribute.POSITION:d.assert(3===M.size);var L=F.getField(H,c.BufferViewVec3f);L&&v.writePosition(K,M.data,D.transformation,
L,G);break;case m.VertexAttribute.COLOR:d.assert(3===M.size||4===M.size);(L=F.getField(H,c.BufferViewVec4u8))&&v.writeColor(K,M.data,M.size,L,G);break;case m.VertexAttribute.UVMAPSPACE:d.assert(4===M.size);(L=F.getField(H,c.BufferViewVec4f))&&v.writeBufferVec4(K,M.data,L,G);break;case m.VertexAttribute.BOUNDINGRECT:d.assert(9===M.size),(L=F.getField(H,c.BufferViewMat3f))&&this.writeBoundingRect(K,M.data,D.transformation,L,G)}}};B.writeBoundingRect=function(D,C,F,G,L){const H=G.typedBuffer;G=G.typedBufferStride;
const M=D.length;L*=G;for(let I=0;I<M;++I){const O=9*D[I];var K=C[O];const Q=C[O+1],J=C[O+2];H[L]=F[0]*K+F[4]*Q+F[8]*J+F[12];H[L+1]=F[1]*K+F[5]*Q+F[9]*J+F[13];H[L+2]=F[2]*K+F[6]*Q+F[10]*J+F[14];for(K=3;9>K;++K)H[L+K]=C[O+K];L+=G}};return p}(q.DefaultBufferWriter);const y={color:[1,1,1,1],writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:w.CullFaceOptions.None,sceneHasOcludees:!1,style:z.Style.Cross,patternSpacing:10,lineWidth:1,draped:!0,...l.DefaultMaterialParameters};
a.PatternMaterial=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/PatternStyle":function(){define(["exports"],function(a){a.Style=void 0;var b=a.Style||(a.Style={});b[b.Horizontal=0]="Horizontal";b[b.Vertical=1]="Vertical";b[b.Cross=2]="Cross";b[b.ForwardDiagonal=3]="ForwardDiagonal";b[b.BackwardDiagonal=4]="BackwardDiagonal";b[b.DiagonalCross=5]="DiagonalCross";b[b.COUNT=6]="COUNT";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/PatternTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/VertexAttribute ../materials/PatternStyle ../../../../chunks/Pattern.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u){e=function(A){function p(){return A.apply(this,arguments)||this}c._inheritsLoose(p,A);var B=p.prototype;B.initializeProgram=function(D){var C=p.shader.get();const F=this.configuration;C=C.build({output:F.output,attributeColor:F.vertexColors,slicePlaneEnabled:F.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,style:F.style,patternSpacing:F.patternSpacing,lineWidth:F.lineWidth,draped:F.draped,oitEnabled:F.transparencyPassType===
m.TransparencyPassType.Color,multipassTerrainEnabled:F.multipassTerrainEnabled,cullAboveGround:F.cullAboveGround});return new v.Program(D.rctx,C,y)};B.bindPass=function(D,C){l.bindProjectionMatrix(this.program,C.camera.projectionMatrix);this.program.setUniform4fv("uColor",D.color);this.configuration.draped?(this.program.setUniform1f("worldToScreenRatio",1/C.screenToPCSRatio),this.program.setUniform1f("texelSize",1/C.camera.pixelRatio)):this.program.setUniform1f("worldToScreenPerDistanceRatio",1/C.camera.perScreenPixelRatio);
this.configuration.output===h.ShaderOutput.Highlight&&n.bindOutputHighlight(this.program,C);(this.configuration.output===h.ShaderOutput.Depth||C.multipassTerrainEnabled)&&this.program.setUniform2fv("nearFar",C.camera.nearFar);C.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",C.inverseViewport),f.bindMultipassTerrainTexture(this.program,C))};B.bindDraw=function(D){l.bindView(this.program,D);l.bindCameraPosition(this.program,D.origin,D.camera.viewInverseTransposeMatrix);w.bindSliceUniformsWithOrigin(this.program,
this.configuration,D);this.program.rebindTextures()};B._setPipelineState=function(D,C){const F=this.configuration,G=D===m.TransparencyPassType.NONE,L=D===m.TransparencyPassType.FrontFace;return u.makePipelineState({blending:F.output===h.ShaderOutput.Color||F.output===h.ShaderOutput.Alpha?G?z.blendingDefault:z.oitBlending(D):null,culling:u.cullingParams(F.cullFace),depthTest:{func:z.oitDepthTest(D)},depthWrite:G?F.writeDepth&&u.defaultDepthWriteParams:z.oitDepthWrite(D),colorWrite:u.defaultColorWriteParams,
stencilWrite:F.sceneHasOcludees?q.stencilWriteMaskOn:null,stencilTest:F.sceneHasOcludees?C?q.stencilToolMaskBaseParams:q.stencilBaseAllZerosParams:null,polygonOffset:G||L?F.polygonOffset&&E:z.getOITPolygonOffset(F.enableOffset)})};B.initializePipeline=function(){this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0);return this._setPipelineState(this.configuration.transparencyPassType,!1)};B.getPipelineState=function(D,C){return C?this._occludeePipelineState:
A.prototype.getPipelineState.call(this,D,C)};return p}(e.ShaderTechnique);e.shader=new k.ReloadableShaderModule(x.PatternShader,()=>new Promise((A,p)=>a(["./Pattern.glsl"],A,p)));const E={factor:1,units:1};k=function(A){function p(){var B=A.apply(this,arguments)||this;B.output=h.ShaderOutput.Color;B.cullFace=m.CullFaceOptions.None;B.slicePlaneEnabled=!1;B.vertexColors=!1;B.polygonOffset=!1;B.writeDepth=!0;B.sceneHasOcludees=!1;B.enableOffset=!0;B.transparencyPassType=m.TransparencyPassType.NONE;B.multipassTerrainEnabled=
!1;B.cullAboveGround=!1;return B}c._inheritsLoose(p,A);return p}(d.ShaderTechniqueConfiguration);g.__decorate([d.parameter({count:h.ShaderOutput.COUNT})],k.prototype,"output",void 0);g.__decorate([d.parameter({count:m.CullFaceOptions.COUNT})],k.prototype,"cullFace",void 0);g.__decorate([d.parameter()],k.prototype,"slicePlaneEnabled",void 0);g.__decorate([d.parameter()],k.prototype,"vertexColors",void 0);g.__decorate([d.parameter()],k.prototype,"polygonOffset",void 0);g.__decorate([d.parameter()],
k.prototype,"writeDepth",void 0);g.__decorate([d.parameter()],k.prototype,"sceneHasOcludees",void 0);g.__decorate([d.parameter({count:r.Style.COUNT})],k.prototype,"style",void 0);g.__decorate([d.parameter()],k.prototype,"patternSpacing",void 0);g.__decorate([d.parameter()],k.prototype,"lineWidth",void 0);g.__decorate([d.parameter()],k.prototype,"enableOffset",void 0);g.__decorate([d.parameter()],k.prototype,"draped",void 0);g.__decorate([d.parameter({count:m.TransparencyPassType.COUNT})],k.prototype,
"transparencyPassType",void 0);g.__decorate([d.parameter()],k.prototype,"multipassTerrainEnabled",void 0);g.__decorate([d.parameter()],k.prototype,"cullAboveGround",void 0);const y=new Map([[t.VertexAttribute.POSITION,0],[t.VertexAttribute.COLOR,3],[t.VertexAttribute.UVMAPSPACE,4],[t.VertexAttribute.BOUNDINGRECT,5]]);b.PatternTechnique=e;b.PatternTechniqueConfiguration=k;b.patternVertexAttributeLocations=y;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/Pattern.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/materials/PatternStyle".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v){function q(x){const u=new m.ShaderBuilder;x.draped||u.extensions.add("GL_OES_standard_derivatives");const E=x.output===b.ShaderOutput.Depth;u.include(g.Transform,{linearDepth:E});u.include(h.VertexColor,x);u.vertex.uniforms.add("proj","mat4");u.vertex.uniforms.add("view","mat4");E&&(u.include(w.OutputDepth,x),u.vertex.uniforms.add("nearFar","vec2"),u.varyings.add("linearDepth","float"));x.draped?u.vertex.uniforms.add("worldToScreenRatio","float"):(u.vertex.uniforms.add("worldToScreenPerDistanceRatio",
"float"),u.vertex.uniforms.add("cameraPosition","vec3"),u.attributes.add(z.VertexAttribute.BOUNDINGRECT,"mat3"));u.attributes.add(z.VertexAttribute.POSITION,"vec3");u.attributes.add(z.VertexAttribute.UVMAPSPACE,"vec4");u.varyings.add("vpos","vec3");u.varyings.add("vuv","vec2");x.multipassTerrainEnabled&&u.varyings.add("depth","float");const y=x.style===v.Style.ForwardDiagonal||x.style===v.Style.BackwardDiagonal||x.style===v.Style.DiagonalCross;y&&u.vertex.code.add(d.glsl`
      const mat2 rotate45 = mat2(${d.glsl.float(.70710678118)}, ${d.glsl.float(-.70710678118)},
                                 ${d.glsl.float(.70710678118)}, ${d.glsl.float(.70710678118)});
    `);x.draped||(u.vertex.code.add(d.glsl`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),u.vertex.code.add(d.glsl`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),u.vertex.code.add(d.glsl`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${d.glsl.float(.08715574274)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `));u.vertex.code.add(d.glsl`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${y?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${y?" * rotate45":""};

      ${x.draped?"":d.glsl`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${d.glsl.float(x.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);u.vertex.code.add(d.glsl`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${x.multipassTerrainEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${E?d.glsl`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:d.glsl`transformPosition(proj, view, vpos);`}
    }
  `);u.include(c.Slice,x);u.fragment.include(e.ColorConversion);u.fragment.uniforms.add("uColor","vec4");x.draped&&u.fragment.uniforms.add("texelSize","float");x.output===b.ShaderOutput.Highlight&&u.include(n.OutputHighlight);x.multipassTerrainEnabled&&(u.fragment.include(f.ReadLinearDepth),u.include(l.multipassTerrainTest,x));x.output!==b.ShaderOutput.Highlight&&(u.fragment.code.add(d.glsl`
      const float lineWidth = ${d.glsl.float(x.lineWidth)};
      const float spacing = ${d.glsl.float(x.patternSpacing)};
      const float spacingINV = ${d.glsl.float(1/x.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),x.draped||u.fragment.code.add(d.glsl`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`));u.fragment.code.add(d.glsl`
    void main() {
      discardBySlice(vpos);
      ${x.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${x.attributeColor?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${x.output!==b.ShaderOutput.Highlight?d.glsl`color.a *= ${t(x)};`:""}

      if (color.a < ${d.glsl.float(k.symbolAlphaCutoff)}) {
        discard;
      }

      ${x.output===b.ShaderOutput.Alpha?d.glsl`gl_FragColor = vec4(color.a);`:""}

      ${x.output===b.ShaderOutput.Color?d.glsl`gl_FragColor = color; ${x.oitEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}`:""}
      ${x.output===b.ShaderOutput.Highlight?d.glsl`outputHighlight();`:""}
      ${x.output===b.ShaderOutput.Depth?d.glsl`outputDepth(linearDepth);`:""};
    }
  `);return u}function t(x){function u(E){return x.draped?d.glsl`coverage(vuv.${E}, texelSize)`:d.glsl`sample(vuv.${E})`}switch(x.style){case v.Style.ForwardDiagonal:case v.Style.Horizontal:return u("y");case v.Style.BackwardDiagonal:case v.Style.Vertical:return u("x");case v.Style.DiagonalCross:case v.Style.Cross:return d.glsl`
        1.0 - (1.0 - ${u("x")}) * (1.0 - ${u("y")})
      `;default:return"0.0"}}const r=Object.freeze({__proto__:null,build:q});a.PatternShader=r;a.build=q})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../chunks/vec2f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./placementUtils ./pointUtils ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureFactory ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u){function E(D,C,F){D&&D.forEach(G=>{const L=C(G);g.isSome(L)&&F(L,G.graphic)})}function y(D,C){if("baseline"===C.verticalPlacement)return C=v.horizontalPlacementToAnchorX[C.horizontalPlacement],D=g.isSome(D)?D.baselineAnchorY:0,n.fromValues(C,D);D=v.anchorFromPlacements(C.horizontalPlacement,C.verticalPlacement);return v.namedAnchorToHUDMaterialAnchorPos[D]}const A=[0,0,1];m=function(D){function C(G,L,H,M){G=D.call(this,G,L,H,M)||this;G._elevationOptions=
{supportsOffsetAdjustment:!0,supportsOnTheGround:!1};G.ensureDrapedStatus(!1);return G}b._inheritsLoose(C,D);var F=C.prototype;F.doLoad=function(){var G=b._asyncToGenerator(function*(){if(!this._drivenProperties.size){const L=z.validateSymbolLayerSize(this.symbolLayer.size);if(L)throw new c("graphics3dtextsymbollayer:invalid-size",L);}yield this._createTextRenderParameters()});return function(){return G.apply(this,arguments)}}();F._createTextRenderParameters=function(){var G=b._asyncToGenerator(function*(){this._textRenderParameters=
yield r.TextRenderParameters.fromSymbol(this.symbolLayer,this._context.graphicsCoreOwner.view.pixelRatio)});return function(){return G.apply(this,arguments)}}();F.destroy=function(){D.prototype.destroy.call(this)};F.createGraphics3DGraphic=function(G){G=G.graphic;const L=q.placePointOnGeometry(G.geometry);if(g.isNone(L))return this.logger.warn(`unsupported geometry type for text symbol: ${G.geometry.type}`),null;const H=this.symbolLayer.text;if(g.isNone(H)||""===H)return null;var M=f.hasCalloutSupport(this.symbol)&&
this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(g.isSome(M)&&!f.textSymbolLayerSupportsVerticalOffset(this.symbolLayer))return this.logger.errorOncePerTick("Callouts and vertical offset on text symbols are currently only supported with 'center' "+`horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;M={...B,verticalOffset:M,horizontalPlacement:v.horizontalPlacementFromAlignment(this.symbolLayer.horizontalAlignment),verticalPlacement:v.verticalPlacementFromAlignment(this.symbolLayer.verticalAlignment)};
return this._createAs3DShape(G,L,H,M)};F.createLabel=function(G,L,H,M){G=G.graphic;const K=q.placePointOnGeometry(G.geometry);if(g.isNone(K))return this.logger.warn(`unsupported geometry type for label: ${G.geometry.type}`),null;const I=L.text;return!I||/^\s+$/.test(I)?null:this._createAs3DShape(G,K,I,L,H,M)};F.setGraphicElevationContext=function(G,L,H=0){G=D.prototype.setGraphicElevationContext.call(this,G,L);G.addOffsetRenderUnits(H);return G};F.layerOpacityChanged=function(){this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");
return!1};F.layerElevationInfoChanged=function(G,L){E(G,L,(H,M)=>{this.updateGraphicElevationContext(M,H)});return k.SymbolUpdateType.UPDATE};F.slicePlaneEnabledChanged=function(G,L){E(G,L,H=>{for(const M of H.stageObject.geometryRecords)M.material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled})});return!0};F.physicalBasedRenderingChanged=function(){return!0};F.pixelRatioChanged=function(){return!1};F.updateGraphicElevationContext=function(G,L){this.setGraphicElevationContext(G,
L.elevationContext,L.metadata.elevationOffset);L.needsElevationUpdates=k.needsElevationUpdates2D(L.elevationContext.mode)||"absolute-height"===L.elevationContext.mode};F._defaultElevationInfoNoZ=function(){return p};F._createAs3DShape=function(G,L,H,M,K,I){const O=this.setGraphicElevationContext(G,new e.ElevationContext,M.elevationOffset);var Q="polyline"===g.get(G.geometry,"type");G=G.uid;let J=null;var P=null;if(g.isNone(I)){P=v.textRenderAlignmentFromHorizontalPlacement(M.horizontalPlacement);
J=new x(H,P,this._textRenderParameters);let T=null;P=this._context.sharedResources.textures.fromData(J.key,()=>g.unwrap(J).create(),()=>{g.isSome(T)&&T.release()});var N=this._context.stage.renderView.textureRepository.acquire(P.texture.id);if(g.isNone(N)||h.isPromiseLike(N))return P.release(),null;T=N}N=y(J,M);N={occlusionTest:!0,screenOffset:M.screenOffset,anchorPos:N,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:M.centerOffsetUnits,debugDrawLabelBorder:M.debugDrawLabelBorder,drawInSecondSlot:!0};
g.isSome(P)&&(N.textureId=P.texture.id);g.isSome(I)&&(N.textureId=I.id);if(g.isSome(M.verticalOffset)){const {screenLength:T,minWorldLength:V,maxWorldLength:W}=M.verticalOffset;N.verticalOffset={screenLength:w.pt2px(T),minWorldLength:V||0,maxWorldLength:null!=W?W:Infinity}}if(this._context.screenSizePerspectiveEnabled){const {screenSizePerspectiveSettings:T,screenSizePerspectiveSettingsLabels:V}=this._context.sharedResources;N.screenSizePerspective=V.overridePadding(this._textRenderParameters.haloSize+
this._textRenderParameters.definition.background.padding[0]);N.screenSizePerspectiveAlignment=T}Q&&(N.shaderPolygonOffset=1E-4);N.slicePlaneEnabled=this._context.slicePlaneEnabled;g.isSome(K)?(Q=JSON.stringify(N),I=K.get(Q),g.isNone(I)&&(I=new u.HUDMaterial(N),K.add(Q,I))):I=new u.HUDMaterial(N);I=[I];Q=M.translation;N=g.isSome(J)?[J.displayWidth,J.displayHeight]:[0,0];Q=[t.createPointGeometry(A,Q,null,N,M.centerOffset,[0,0],null)];G=q.createStageObjectForHUD(this._context,L,Q,I,O,this._context.layer.uid,
G);if(null===G)return null;K=new d.Graphics3DObject3DGraphicLayer(this,G.object,Q,g.isNone(K)?I:null,P,l.perObjectElevationAligner,O);K.alignedSampledElevation=G.sampledElevation;K.needsElevationUpdates=k.needsElevationUpdates2D(O.mode)||"absolute-height"===O.mode;const {displayWidth:R,displayHeight:S}=g.isSome(J)?J:M;K.getScreenSize=(T=n.create())=>{T[0]=R;T[1]=S;return T};K.metadata={labelText:H,elevationOffset:M.elevationOffset};q.extendPointGraphicElevationContext(K,L,this._context.elevationProvider);
return K};return C}(m.Graphics3DSymbolLayer);const p={mode:"relative-to-ground",offset:0},B={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],horizontalPlacement:"center",verticalPlacement:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawLabelBorder:!1,displayWidth:0,displayHeight:0};a.Graphics3DTextSymbolLayer=m;a.default=m;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextRenderParameters":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/Logger ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec4f64".split(" "),
function(a,b,c,g,h,w,n){const f=g.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters");g=function(){function l(e){this.definition=e;this.key=JSON.stringify(e);this.haloSize=Math.round(e.halo.size);this.textStyle=this._colorToRGBA(e.color);this.haloStyle=this._colorToRGB(e.halo.color);this.backgroundStyle=0!==e.background.color[3]?this._colorToRGBA(e.background.color):null}var k=l.prototype;k.fontString=function(e){const d=this.definition.font;return`${d.style} ${d.weight} ${e}px ${d.family}, sans-serif`};
k._colorToRGB=function(e){return`rgb(${e.slice(0,3).map(d=>Math.floor(255*d)).toString()})`};k._colorToRGBA=function(e){return`rgba(${e.slice(0,3).map(d=>Math.floor(255*d)).toString()},${e[3]})`};l.fromSymbol=function(){var e=b._asyncToGenerator(function*(d,m=1){var z=h.get(d,"material","color");const v=h.mapOr(z,n.ZEROS,c.toUnitRGBA);z=h.mapOr(d.size,12,w.pt2px);const q=d.lineHeight,t=h.isSome(d.background)?c.toUnitRGBA(d.background.color):n.ZEROS,r={family:h.mapOr(d.font,"sans-serif",u=>u.family),
decoration:h.mapOr(d.font,"none",u=>u.decoration),weight:h.mapOr(d.font,"normal",u=>u.weight),style:h.mapOr(d.font,"normal",u=>u.style)};var x=d.halo;x=h.isSome(x)&&h.isSome(x.color)&&0<x.size?{size:w.pt2px(x.size),color:c.toUnitRGBA(x.color)}:{size:0,color:n.ZEROS};d=new l({color:v,size:z,background:{color:t,padding:h.isSome(d.background)?[.65*z,.5*z]:[0,0],borderRadius:h.isSome(d.background)?.375*z:0},lineSpacingFactor:q,font:r,halo:x,pixelRatio:m});m=d.fontString(z);try{yield document.fonts.load(m)}catch(u){f.warnOnce(`Failed to preload font '${m}'. Some text symbology may be rendered using the default browser font.`)}return d});
return function(d){return e.apply(this,arguments)}}();return l}();a.TextRenderParameters=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextTextureFactory":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./basicInterfaces","./TextRenderer","./Texture","../../../webgl/enums"],function(a,b,c,g,h){const w={canvas:null};return function(){function n(f,l,k){this._renderer=new c.TextRenderer(f,l,k)}n.prototype.create=function(){const f=c.getTextHelperCanvas(w,
this._renderer.renderedWidth,this._renderer.renderedHeight),l=f.getContext("2d");l.save();this._renderer.render(l,0,0);l.restore();return new g.Texture(f,{wrap:{s:h.TextureWrapMode.CLAMP_TO_EDGE,t:h.TextureWrapMode.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:b.PowerOfTwoResizeMode.PAD})};a._createClass(n,[{key:"key",get:function(){return this._renderer.key}},{key:"baselineAnchorY",get:function(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}},
{key:"displayWidth",get:function(){return this._renderer.displayWidth}},{key:"displayHeight",get:function(){return this._renderer.displayHeight}}]);return n}()})},"esri/views/3d/layers/graphics/Graphics3DWaterSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/unitUtils ../../../../chunks/earcut ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec4 ../../../../chunks/common ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./polygonUtils ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/WaterMaterial ../../webgl-engine/materials/internal/waterMaterialUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p){const B=["polyline","polygon","extent"];x=function(M){function K(O,Q,J,P){return M.call(this,O,Q,J,P)||this}b._inheritsLoose(K,M);var I=K.prototype;I.doLoad=function(){var O=b._asyncToGenerator(function*(){});return function(){return O.apply(this,arguments)}}();I.destroy=function(){M.prototype.destroy.call(this);this._context.stage.remove(this._material);this._material=null};I.createGraphics3DGraphic=function(O){O=O.graphic;if(!this._validateGeometry(O.geometry,
B,this.symbolLayer.type))return null;const Q=this.setGraphicElevationContext(O,new q.ElevationContext);this.ensureDrapedStatus("on-the-ground"===Q.mode);this.ensureMaterial();return this.draped?this._createAsOverlay(O):this._createAs3DShape(O,Q,O.uid)};I.ensureMaterial=function(){if(!g.isSome(this._material)){var O={...p.defaultWaterMaterialParameters},Q=this.symbolLayer.color;g.isSome(Q)&&(O.color=c.toUnitRGBA(Q));Q=this._getCombinedOpacity(Q,{hasIntrinsicColor:!0});O.color=[O.color[0],O.color[1],
O.color[2],Q];O.transparent=1>Q||this.needsDrivenTransparentPass;O.waveDirection=g.isSome(this.symbolLayer.waveDirection)?K.headingVectorFromAngle(this.symbolLayer.waveDirection):l.fromValues(0,0);Q=p.wavePresets[this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize];O.waveStrength=Q.waveStrength;O.waveTextureRepeat=Q.textureRepeat;O.waveVelocity=Q.waveVelocity;O.flowStrength=Q.perturbationStrength;O.slicePlaneEnabled=this._context.slicePlaneEnabled;O.isDraped=this.draped;this._material=
new A.WaterMaterial(O);this._context.stage.add(this._material)}};I.layerOpacityChanged=function(){if(g.isNone(this._material))return!0;const O=this._material.parameters.color,Q=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0});this._material.setParameters({color:[O[0],O[1],O[2],Q],transparent:1>Q||this.needsDrivenTransparentPass});return!0};I.layerElevationInfoChanged=function(O,Q,J){const P=this._elevationContext.mode;J=v.elevationModeChangeUpdateType(K.elevationModeChangeTypes,
J,P);if(J!==v.SymbolUpdateType.UPDATE)return J;const N=v.needsElevationUpdates2D(P);return this.updateGraphics3DGraphicElevationInfo(O,Q,()=>N)};I.slicePlaneEnabledChanged=function(){g.isSome(this._material)&&this._material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};I.physicalBasedRenderingChanged=function(){return!0};I.pixelRatioChanged=function(){return!0};I._createAs3DShape=function(O,Q,J){O=u.geometryAsPolygon(O.geometry);if(g.isNone(O))return null;L.renderData=
u.geometryToRenderInfo(O,this._context.elevationProvider,this._context.renderCoordsHelper,Q);const P=L.renderData.position.length/3;L.uvCoords=new Float64Array(2*P);L.outNum=0;L.outGeometries=[];L.outTransforms=[];L.outMaterials=[];this._create3DShapeGeometries(L);this._logGeometryCreationWarnings(L.renderData,O.rings,"rings","WaterSymbol3DLayer");if(0===L.outNum)return null;this._createUVCoordsFromVertices(L.uvCoords,L.renderData.mapPosition,P,this._context.elevationProvider.spatialReference);J=
new E.Object3D({geometries:L.outGeometries,materials:L.outMaterials,transformations:L.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:J}});J=new r.Graphics3DObject3DGraphicLayer(this,J,L.outGeometries,null,null,z.perVertexElevationAligner,Q);J.alignedSampledElevation=L.renderData.sampledElevation;J.needsElevationUpdates=v.needsElevationUpdates2D(Q.mode);return J};I._createUVCoordsFromVertices=function(O,Q,J,P){P=h.getMetersPerUnitForSR(P);m.empty(C);for(var N=0;N<
J;N++)f.set(F,Q[3*N],Q[3*N+1]),m.expandPointInPlace(C,F);k.scale(C,C,P);N=C[1]%K.unitSizeOfTexture;D[0]=C[0]-C[0]%K.unitSizeOfTexture;D[1]=C[1]-N;for(N=0;N<J;N++)O[2*N]=(Q[3*N]*P-D[0])/K.unitSizeOfTexture,O[2*N+1]=(Q[3*N+1]*P-D[1])/K.unitSizeOfTexture};I._create3DShapeGeometries=function(O){var Q=O.renderData.polygons;const J=O.uvCoords;for(const {count:P,index:N,position:R,mapPosition:S,holeIndices:T}of Q){if(g.isSome(this._context.clippingExtent)&&(d.empty(G),d.expandWithBuffer(G,S),!d.intersectsClippingArea(G,
this._context.clippingExtent)))continue;Q=w.earcut(S,T,3);if(0===Q.length)continue;Q=new Uint32Array(Q);const V=new Float64Array(J.buffer,2*N*J.BYTES_PER_ELEMENT,2*P);Q=u.createWaterGeometry({indices:Q,attributeData:{position:R,uv0:V,mapPosition:S}});O.outGeometries.push(Q);O.outMaterials.push(g.unwrap(this._material));O.outTransforms.push(n.IDENTITY);O.outNum++}};I._createAsOverlay=function(O){const Q=u.geometryAsPolygon(O.geometry);if(g.isNone(Q))return null;g.unwrap(this._material).renderPriority=
this._renderPriority;H.renderData=u.geometryToRenderInfoDraped(Q,this._context.overlaySR);const J=H.renderData.position.length/3;H.uvCoords=new Float64Array(2*J);H.outNum=0;H.outGeometries=[];H.outBoundingBox=d.empty();H.layerUid=this._context.layer.uid;H.graphicsUid=O.uid;this._createAsOverlayWater(H);this._logGeometryCreationWarnings(H.renderData,Q.rings,"rings","WaterSymbol3DLayer");if(0===H.outNum)return null;this._createUVCoordsFromVertices(H.uvCoords,H.renderData.position,J,this._context.overlaySR);
return 0<H.outNum?new t(this,H.outGeometries,H.outBoundingBox):null};I._createAsOverlayWater=function(O){const Q=O.uvCoords;var J=O.renderData.polygons;for(const {position:N,holeIndices:R,index:S,count:T}of J)if(d.empty(G),d.expandWithBuffer(G,N),d.intersectsClippingArea(G,this._context.clippingExtent)&&(d.expandWithAABB(O.outBoundingBox,G),J=w.earcut(N,R,3),0!==J.length)){J=new Uint32Array(J);var P=new Float64Array(Q.buffer,2*S*Q.BYTES_PER_ELEMENT,2*T);J=u.createWaterGeometry({indices:J,attributeData:{position:N,
uv0:P}});J=new y.RenderGeometry(J,g.unwrap(this._material),{layerUid:O.layerUid,graphicUid:O.graphicsUid});P=G;k.set(J.boundingSphere,.5*(P[0]+P[3]),.5*(P[1]+P[4]),0,.5*Math.sqrt((P[3]-P[0])*(P[3]-P[0])+(P[4]-P[1])*(P[4]-P[1])));O.outGeometries.push(J);O.outNum++}};K.headingVectorFromAngle=function(O){const Q=l.create();O=e.toRadian(O);Q[0]=Math.sin(O);Q[1]=Math.cos(O);return Q};b._createClass(K,[{key:"test",get:function(){return{create3DShape:O=>this._createAs3DShape(O.graphic,O.elevationContext,
O.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}}]);return K}(x.Graphics3DSymbolLayer);x.unitSizeOfTexture=100;x.elevationModeChangeTypes={definedChanged:v.SymbolUpdateType.RECREATE,staysOnTheGround:v.SymbolUpdateType.NONE,onTheGroundChanged:v.SymbolUpdateType.RECREATE};const D=l.create(),C=m.create(),F=l.create(),G=d.create(),L={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},H={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,
outGeometries:null,outMaterials:null,outTransforms:null};a.Graphics3DWaterSymbolLayer=x;a.default=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","./interfaces","./Loadable","./symbolComplexity"],function(a,b,c,g,h){return function(w){function n(l,k,e){k=w.call(this,k)||this;k.symbol=l;k.convert=e;k.graphics3DSymbol=null;k.referenced=0;return k}
a._inheritsLoose(n,w);var f=n.prototype;f.getSymbolLayerSize=function(l){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(l):null};f.doLoad=function(){var l=a._asyncToGenerator(function*(k){k=yield this.symbol.fetchSymbol({signal:k});k.id=this.symbol.id;this.graphics3DSymbol=this.convert(k);b.isSome(this.graphics3DSymbol)&&(yield this.graphics3DSymbol.load())});return function(k){return l.apply(this,arguments)}}();f.createGraphics3DGraphic=function(l){return b.isSome(this.graphics3DSymbol)?
this.graphics3DSymbol.createGraphics3DGraphic(l,this):null};f.globalPropertyChanged=function(l,k){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.globalPropertyChanged(l,k):!1};f.applyRendererDiff=function(l,k){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(l,k):c.ApplyRendererDiffResult.Recreate_Symbol};f.prepareSymbolPatch=function(l){b.isSome(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(l)};f.updateGeometry=function(l,k){return b.isSome(this.graphics3DSymbol)?
this.graphics3DSymbol.updateGeometry(l,k):!1};f.onRemoveGraphic=function(){};f.getFastUpdateStatus=function(){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}};f.destroy=function(){b.isSome(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy();this.graphics3DSymbol=void 0;w.prototype.destroy.call(this)};a._createClass(n,[{key:"symbolLayers",get:function(){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}},{key:"extentPadding",
get:function(){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}},{key:"complexity",get:function(){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:h.emptySymbolComplexity}},{key:"destroyed",get:function(){return void 0===this.graphics3DSymbol}}]);return n}(g.Loadable)})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("exports ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox ./graphicSymbolUtils ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){function d(B){B=k.getGraphics3DSymbol(B.graphics3DGraphic.graphics3DSymbol);return g.isSome(B)?B.symbol.symbolLayers.getItemAt(0):null}function m(B,D){var C=D.graphics3DGraphic.graphic.geometry;if(g.isNone(C))return null;if(g.isSome(D.disablePlacement))return D.labelClass.labelPlacement?(u.warnOncePerTick(z(B.placement,D.disablePlacement.logEntityDescription)),v(D)):B;C=C.type;switch(C){case "polyline":case "polygon":case "extent":case "multipoint":if(D.labelClass.labelPlacement)return u.warnOncePerTick(z(B.placement,
`'${C}' geometries`)),v(D)}return B}function z(B,D){return`the requested label placement '${B}' is currently unsupported for ${D} in SceneView`}function v(B){const D=B.graphics3DGraphic.graphic.geometry;if(g.isNone(D))return null;switch(D.type){case "polyline":case "extent":case "multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case "polygon":return B=d(B),g.isSome(B)&&"extrude"===B.type?E["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"};
case "point":return E["above-center"];case "mesh":return E["above-center"]}}function q(B,D=A){({graphics3DGraphic:B}=B);B=B.graphics[0];(B=g.isSome(B)?B.stageObject.geometryRecords[0].material:null)&&B instanceof e.HUDMaterial?(B=B.parameters.anchorPos,D[0]=2*(B[0]-.5),D[1]=2*(B[1]-.5)):(D[0]=0,D[1]=0);return D}function t(B,D,C){C=g.isSome(C)?C.getBoundingBoxObjectSpace(p):p;C=n.fromValues(C[3]-C[0],C[4]-C[1],C[5]-C[2]);B.centerOffset[0]=Math.sqrt(C[0]*C[0]+C[1]*C[1])/2*D.normalizedOffset[0];const F=
B.translation[2],G=C[2]/2*D.normalizedOffset[1];B.translation[2]=0;B.elevationOffset=F+G;C=w.length(C);B.centerOffset[2]=C/2*D.normalizedOffset[2]}function r(B){const D=B.labelClass.labelPlacement,{labelSymbol:C,graphics3DGraphic:F}=B;var G=k.getGraphics3DSymbol(F.graphics3DSymbol);G=g.applySome(G,L=>"point-3d"===L.symbol.type?L.symbol:null);B=E[D]||v(B);if(g.isSome(G)&&G.supportsCallout()&&G.hasVisibleVerticalOffset()&&!F.isDraped)return{placement:null,hasLabelVerticalOffset:!1,verticalOffset:x(G.verticalOffset),
anchor:null,normalizedOffset:null};if(C&&C.hasVisibleVerticalOffset()&&(g.isNone(G)||!G.supportsCallout()||!G.verticalOffset||F.isDraped)){a:switch(B.placement){case "above-center":G=!0;break a;default:G=!1}return G?{placement:"above-center",verticalOffset:x(C.verticalOffset),anchor:"bottom",normalizedOffset:[0,B.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(u.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+
D+" placement)"),null)}return{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function x(B){const {screenLength:D,minWorldLength:C,maxWorldLength:F}=B;return{screenLength:D,minWorldLength:C,maxWorldLength:F}}const u=c.getLogger("esri.views.3d.layers.graphics.labelPlacement"),E={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",
normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",
normalizedOffset:[1,0,0],anchor:"left"}};b={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],
"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const B in b){const D=E[B];b[B].forEach(C=>{E[C]=D})}Object.freeze&&(Object.freeze(E),Object.keys(E).forEach(function(B){Object.freeze(E[B]);Object.freeze(E[B].normalizedOffset)}));const y=[0,0],A=[0,0],p=l.create();a.get=function(B){var D=r(B);if(g.isNone(D))return null;if(D.anchor)var C=D;else{C=B.labelClass.labelPlacement;var F=E[C],G=F||v(B);C&&!F&&u.warnOncePerTick(`the requested label placement '${C}' is not currently supported in SceneView`);
C=m(G,B)}if(g.isNone(C))return null;F=!!D.hasLabelVerticalOffset;D={anchor:C.anchor,verticalOffset:D.verticalOffset,screenOffset:h.create(),centerOffset:f.fromValues(0,0,0,-1),centerOffsetUnits:"world",translation:n.create(),elevationOffset:0,hasLabelVerticalOffset:F};F=B.graphics3DGraphic.graphic.geometry;if(g.isNone(F))B=null;else{switch(F.type){case "point":G=d(B);if(!g.isNone(G))switch(F=B.graphics3DGraphic.graphics[0],g.isSome(F)?F.getCenterObjectSpace(D.translation):w.set(D.translation,0,0,
0),G.type){case "icon":case "text":({graphics3DGraphic:G}=B);F=g.isSome(F)?F.getScreenSize():null;!G.isDraped&&g.isSome(F)?(B=q(B),y[0]=F[0]/2*(C.normalizedOffset[0]-B[0]),y[1]=F[1]/2*(C.normalizedOffset[1]-B[1]),D.screenOffset[0]=y[0],D.hasLabelVerticalOffset?(D.centerOffset[1]=y[1],D.centerOffsetUnits="screen"):D.screenOffset[1]=y[1]):D.hasLabelVerticalOffset||"center"===D.anchor||(E[B.labelClass.labelPlacement]&&u.warnOncePerTick(`the requested placement '${C.placement}' is currently unsupported for draped graphics`),
D.anchor="center");break;case "object":t(D,C,F)}break;case "polygon":F=d(B);if(!g.isNone(F))switch(F.type){case "extrude":B=B.graphics3DGraphic.graphics[0],g.isSome(B)?(B.getBoundingBoxObjectSpace(p),l.center(p,D.translation),D.translation[2]=l.height(p)/2):w.set(D.translation,0,0,0),t(D,C,B)}break;case "mesh":t(D,C,B.graphics3DGraphic.graphics[0])}B=D}return B};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["exports"],function(a){let b=
function(){function c(h){this._stage=h;this._materials=new Map}var g=c.prototype;g.get=function(h){return this._materials.get(h)};g.add=function(h,w){this._materials.set(h,w);this._stage.add(w)};g.dispose=function(){this._stage.removeMany(Array.from(this._materials.values()));this._materials.clear()};return c}();a.MaterialCollection=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/MapUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./ContentObjectType ./VertexAttribute ../../../support/Scheduler ../../../webgl/enums ../../../webgl/Texture".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x){var u;a.TextTextureAtlas=u=function(y){function A(B){B=y.call(this,B)||this;B.type=v.ContentObjectType.Texture;B.id=l.generateUID();B.events=new h;B._glTexture=null;B.needsClear=!1;B.elementsToAddOrUpdate=new Map;B.elementsToRemove=new Map;B.elementsToRender=new Map;B.elements=new Map;B.stageObjects=new Map;B.updating=!1;return B}b._inheritsLoose(A,y);var p=A.prototype;p.initialize=function(){this.stage=this.view._stage;this.canvas=this._create2DCanvas();
this.ctx=this.canvas.getContext("2d");this.stage.add(this);const B=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(B);this._update2DCanvasSize();this._resetAtlasCursor()};p.unload=function(){this._glTexture=f.disposeMaybe(this._glTexture);this.updating=!1;this.events.emit("unloaded")};p._createDescriptor=function(B){return{target:r.TextureType.TEXTURE_2D,pixelFormat:r.PixelFormat.RGBA,dataType:r.PixelType.UNSIGNED_BYTE,wrapMode:r.TextureWrapMode.CLAMP_TO_EDGE,
flipped:!0,samplingMode:r.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:B.parameters.maxMaxAnisotropy}};p.load=function(B){if(f.isSome(this._glTexture))return this._glTexture;this._glTexture=new x.Texture(B,this._createDescriptor(B),this.canvas);this.frameWorker=this.view.resourceController.scheduler.registerTask(t.TaskPriority.TEXT_TEXTURE_ATLAS,this);this.setDirty();return this._glTexture};p.dispose=function(){this.elementsToRender=this.elementsToRemove=
this.elementsToAddOrUpdate=this.elements=null;this.frameWorker=f.removeMaybe(this.frameWorker);this._glTexture&&(this.stage.remove(this),this._glTexture=f.disposeMaybe(this._glTexture));this.canvas.width=0;this.canvas.height=0;this.ctx=this.canvas=null};p._create2DCanvas=function(){const B=document.createElement("canvas");B.setAttribute("id","canvas2d");B.setAttribute("style","display:none");B.setAttribute("width",(512).toString());B.setAttribute("height",(512).toString());return B};p._update2DCanvasSize=
function(){this.canvas.setAttribute("width",this.atlas.size.width.toString());this.canvas.setAttribute("height",this.atlas.size.height.toString())};p._createAtlasRegion=function(B=512){this.atlas={size:{width:B,height:B},cursor:{x:0,y:0},lineHeight:0}};p._computeAtlasResolution=function(B,D){B=Math.max(B,D);B=n.nextHighestPowerOfTwo(B+256);return B=Math.min(B,4096)};p._resizeAtlas=function(B,D){D=D||B;const C=this.atlas;C.size.width=B;C.size.height=D;f.isSome(this._glTexture)&&this._glTexture.resize(B,
D);this._update2DCanvasSize()};p._resetAtlasCursor=function(){const B=this.atlas;B.cursor.x=2;B.cursor.y=4;B.lineHeight=0;this.needsClear=!0};p._getAtlasUsage=function(){const B=this.atlas;return(B.cursor.x+B.cursor.y*B.size.width)/(B.size.width*B.size.height)};p._getExpectedAtlasUsage=function(){const B=this.elementsToRemove.size,D=this.elementsToAddOrUpdate.size,C=this.elements.size;return this._getAtlasUsage()/C*(C+D-B)};p._addAtlasElement=function(B,D,C,F){const G=this.atlas,{renderedWidth:L,
renderedHeight:H,displayWidth:M,displayHeight:K}=B.textRenderer;B.placement.offset.x=G.cursor.x;B.placement.offset.y=G.cursor.y;B.placement.size.width=L;B.placement.size.height=H;B.placement.size.displayWidth=M;B.placement.size.displayHeight=K;B.placement.uvMinMax=[B.placement.offset.x/G.size.width,1-(B.placement.offset.y+H)/G.size.height,(B.placement.offset.x+L)/G.size.width,1-B.placement.offset.y/G.size.height];G.cursor.x+=C;G.lineHeight=Math.max(G.lineHeight,F);this.elements.set(D,B)};p._removeAtlasElement=
function(B){if(B&&this.elements.has(B.textId)){const D=B.placement.offset,C=B.placement.size;this.ctx.clearRect(D.x,D.y,C.width,C.height);this.elements.delete(B.textId)}};p._ensureStageObjects=function(B){var D=this.stageObjects.get(B);if(D)return D;D=new Set;this.stageObjects.set(B,D);return D};p._addStageObject=function(B,D){this._ensureStageObjects(B).add(D)};p._removeStageObject=function(B,D){(B=this.stageObjects.get(B))&&B.delete(D)&&(D.geometries[0].vertexAttributes.get(q.VertexAttribute.SIZE).data=
[0,0],D.geometryVertexAttrsUpdated(D.geometryRecords[0]))};p._processAddition=function(B,D){const C=this.atlas;var F=B.textId;const G=B.textRenderer.renderedWidth+2,L=B.textRenderer.renderedHeight+2+2;if(C.cursor.x+G<C.size.width&&C.cursor.y+L<C.size.height)this._addAtlasElement(B,F,G,L),this.elementsToRender.set(F,B),this.elementsToAddOrUpdate.delete(F);else if(C.cursor.y+L+C.lineHeight<C.size.height)C.cursor.x=2,C.cursor.y+=C.lineHeight,C.lineHeight=0,this._addAtlasElement(B,F,G,L),this.elementsToRender.set(F,
B),this.elementsToAddOrUpdate.delete(F);else{B=this._getExpectedAtlasUsage();(F=.85<B&&4096>C.size.width)&&this._resizeAtlas(2*C.size.width,2*C.size.height);if(!D||!F&&.95<B&&4096===C.size.width)return this._processRemovals(),E.OK;this._repack();return E.REPACK}return E.OK};p._processRemovals=function(){this.elementsToRemove.forEach((B,D)=>{const C=this.stageObjects.get(D);C&&0!==C.size||this._removeAtlasElement(B);C&&0===C.size&&this.stageObjects.delete(D)});this.elementsToRemove.clear()};p._repack=
function(){this._processRemovals();this.elements.forEach((B,D)=>{B.rendered=!1;this.elementsToAddOrUpdate.set(D,B)});this.elements.clear();this._resetAtlasCursor();this.elementsToRender.clear()};p._processRenderingRequest=function(B){this.ctx.clearRect(B.placement.offset.x,B.placement.offset.y,B.placement.size.width,B.placement.size.height);B.textRenderer.render(this.ctx,B.placement.offset.x,B.placement.offset.y);const D=this.stageObjects.get(B.textId);D&&D.forEach(C=>{C.geometries[0].vertexAttributes.get(q.VertexAttribute.UV0).data=
new Float32Array(B.placement.uvMinMax);C.geometries[0].vertexAttributes.get(q.VertexAttribute.SIZE).data=[B.placement.size.displayWidth,B.placement.size.displayHeight];C.geometryVertexAttrsUpdated(C.geometryRecords[0])});B.rendered=!0};p.runTask=function(B,D=!0){if(this._glTexture){var C=!1;w.someMap(this.elementsToAddOrUpdate,(G,L)=>(G=this.elements.get(L))&&G.rendered?((G=this.stageObjects.get(L))&&G.forEach(H=>{const M=H.geometries[0].vertexAttributes,K=this.elements.get(L);M.get(q.VertexAttribute.UV0).data=
new Float32Array(K.placement.uvMinMax);M.get(q.VertexAttribute.SIZE).data=new Float32Array([K.placement.size.displayWidth,K.placement.size.displayHeight]);H.geometryVertexAttrsUpdated(H.geometryRecords[0])}),this.elementsToAddOrUpdate.delete(L),!1):this._processAddition(this.elementsToAddOrUpdate.get(L),D)===E.REPACK?C=!0:!1);if(C)this.runTask(t.noBudget,!1);else{var F=!1;0<this.elementsToRender.size&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1);
w.someMap(this.elementsToRender,(G,L)=>{this._processRenderingRequest(G);this.elementsToRender.delete(L);F=!0;B.madeProgress();return B.done});F&&f.isSome(this._glTexture)&&this._glTexture.setData(this.canvas);this.updating=0<this.elementsToRender.size;!this.updating&&u.test.orderedRepackingEnabled&&this.repackOrdered()}}};p.addTextTexture=function(B,D){const C=B.key;this.elementsToAddOrUpdate.has(C)||this.elementsToAddOrUpdate.set(C,{textId:C,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,
displayHeight:0},uvMinMax:[]},textRenderer:B,rendered:!1});this._addStageObject(C,D);this.elementsToRemove.delete(C);this.setDirty()};p.removeTextTexture=function(B,D){B=B.key;this.elementsToRemove.set(B,this.elements.get(B));this._removeStageObject(B,D)};p.setDirty=function(){this._glTexture&&(this.updating=!0)};p.repackOrdered=function(){if(0!==this.elements.size){var B=[];this.elements.forEach((C,F)=>B.push({element:C,key:F}));var D=!0;for(let C=0;C<B.length-1;C++)if(0<B[C].key.localeCompare(B[C+
1].key)){D=!1;break}if(!D||this.elementsToRemove.size){B.sort((C,F)=>C.key.localeCompare(F.key));this.elements.clear();for(const {element:C,key:F}of B)this.elements.set(F,C);this._repack();this.setDirty()}}};b._createClass(A,[{key:"width",get:function(){return this.atlas.size.width}},{key:"height",get:function(){return this.atlas.size.height}},{key:"requiresFrameUpdates",get:function(){return!1}},{key:"glTexture",get:function(){return this._glTexture}},{key:"running",get:function(){return this.updating}},
{key:"test",get:function(){const {elements:B,stageObjects:D,elementsToRemove:C,atlas:F}=this,G=this;return{elements:B,stageObjects:D,elementsToRemove:C,atlas:F,_resizeAtlas:(L,H)=>G._resizeAtlas(L,H),run:(L,H)=>G.runTask(L,H)}}}]);return A}(g);a.TextTextureAtlas.test={orderedRepackingEnabled:!1};c.__decorate([k.property({constructOnly:!0})],a.TextTextureAtlas.prototype,"view",void 0);c.__decorate([k.property({type:Boolean})],a.TextTextureAtlas.prototype,"updating",void 0);a.TextTextureAtlas=u=c.__decorate([z.subclass("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],
a.TextTextureAtlas);var E;(function(y){y[y.OK=0]="OK";y[y.REPACK=1]="REPACK"})(E||(E={}));a.default=a.TextTextureAtlas;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/ObjectResourceCache":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Handles ../../../../core/handleUtils ../../../../core/maybe ../../../../core/promiseUtils ../../glTF/DefaultLoadingContext ../../glTF/loader ./wosrLoader".split(" "),function(a,b,c,g,h,w,n,
f,l){let k=function(){function d(){this.gltfCache=new Map;this.wosrCache=new Map;this.evictHandles=new c}var m=d.prototype;m.loadGLTF=function(z,v,q){return this._fromCache(this.gltfCache,q?`gltfPBR:${z}`:`gltf:${z}`,t=>f.load(new n.DefaultLoadingContext(t.streamDataRequester),z,t,q),v)};m.loadWOSR=function(z,v){return this._fromCache(this.wosrCache,`wosr:${z}:${v.disableTextures}`,q=>l.load(z,q),v)};m.destroy=function(){this.evictHandles.destroy();this.gltfCache.clear();this.wosrCache.clear()};m._fromCache=
function(z,v,q,t){return new Promise((r,x)=>{if(w.isAborted(t))x(w.createAbortError());else{var u=w.onAbort(t,()=>{this._remove(z,v);x(w.createAbortError())}),E=z.get(v);if(E)this.evictHandles.remove(v),E.refCount++,E.item.then(r,x);else{E=new AbortController;var y={refCount:1,abortController:E,item:q({...t,signal:E.signal}).then(A=>{y.abortController=null;A.remove=()=>this._remove(z,v);return A})};z.set(v,y);y.item.then(A=>{h.isSome(u)&&u.remove();r(A)},A=>{h.isSome(u)&&u.remove();x(A)})}}})};m._remove=
function(z,v){const q=z.get(v);q&&(q.refCount--,0===q.refCount&&this.evictHandles.add(g.timeoutHandle(()=>{z.delete(v);h.isSome(q.abortController)&&q.abortController.abort()},e),v))};b._createClass(d,[{key:"size",get:function(){return this.wosrCache.size+this.gltfCache.size}}]);return d}(),e=1E4;a.ObjectResourceCache=k;a.test={overrideEvictDelay(d){e=d;return{remove(){e=1E4}}}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Collection ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/PooledArray ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ./FeatureTileDescriptor3D ./FeatureTileMeasurements3D ../../support/extentUtils ../../../support/Scheduler".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u){const E=n.getLogger("esri.views.3d.layers.support.FeatureTileTree3D");a.FeatureTileTree3D=function(p){function B(C){C=p.call(this,C)||this;C.tiles=new h;C.tileSize=512;C._idToTile=new Map;C._handles=new w;C._clients=new Set;C._dirty=!1;C._newTiles=new l;return C}b._inheritsLoose(B,p);var D=B.prototype;D.initialize=function(){this._handles.add(this.watch(["tilingScheme","tileSize"],()=>this._reset(),!0));this._handles.add(k.init(this,["tileSize","cameraOnSurface.location",
"tilingScheme","viewState.contentCamera","focus.location"],()=>this._setDirty(),!0));this.scheduler&&(this._frameWorker=this.scheduler.registerTask(u.TaskPriority.FEATURE_TILE_TREE,this))};D.destroy=function(){this._frameWorker=f.removeMaybe(this._frameWorker);this._handles=f.destroyMaybe(this._handles)};D.addClient=function(){const C=y++;this._clients.add(C);1===this._clients.size&&this._setDirty();return{remove:()=>this._removeClient(C)}};D._removeClient=function(C){this._clients.delete(C);this._hasClients||
this._clear()};D._setDirty=function(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(u.noBudget))};D._clear=function(){this.tiles.removeAll();this._idToTile.clear();this._reset();this._dirty=!1;this.notifyChange("updating")};D.runTask=function(C){this._dirty=!1;this._pendingTiles||(this._startUpdate(),f.isSome(this._frameWorker)&&(this._frameWorker.priority=u.TaskPriority.FEATURE_TILE_TREE_ACTIVE));this._subdivideTilesForView(C);
!this._pendingTiles&&f.isSome(this._frameWorker)&&(this._frameWorker.priority=u.TaskPriority.FEATURE_TILE_TREE);this.notifyChange("updating")};D._startUpdate=function(){this.suspended||(this.tilingScheme?(this._tileMeasurements||(this._tileMeasurements=new r.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize})),this._tileMeasurements.begin(this.viewState.contentCamera,this.focus.location,this.cameraOnSurface.location.z),this._pendingTiles=
this._getRootTiles()):this._clear())};D._reset=function(){this._newTiles.clear();this._pendingTiles=this._tileMeasurements=null;this._setDirty()};D._getRootTiles=function(){return this.rootTileIds.map(C=>new t.FeatureTileDescriptor3D(C[0],C[1],C[2],this.tilingScheme))};D._purgeHorizonTiles=function(C){C.sort((F,G)=>{F=F.measures.screenRect;G=G.measures.screenRect;return F[1]+F[3]-(G[1]+G[3])});q.empty(A);for(let F=0;F<C.length;F++)if(q.expand(A,C.data[F].measures.screenRect,A),10<q.height(A))return C.data.slice(F,
C.length);return[]};D._subdivideTilesForView=function(C){if(this._pendingTiles){for(;0<this._pendingTiles.length&&!C.done;){const F=this._pendingTiles.pop();C.madeProgress();if(!this.filterExtentRect||q.intersects(this.filterExtentRect,F.extent))this._tileMeasurements.updateTile(F),F.measures.visibility!==t.Visibility.INVISIBLE&&(F.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(F.lij[0]+1),this._pendingTiles.push(...F.getChildren())):this._newTiles.push(F))}0===this._pendingTiles.length&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),
this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}};D._updateTiles=function(C){for(var F of this.tiles.items)F.used=!1;C=C.filter(G=>{const L=this._idToTile.get(G.id);L?(L.copyMeasurementsFrom(G),L.used=!0):this._idToTile.set(G.id,G);return!L});F=this.tiles.items.filter(G=>G.used?!1:(this._idToTile.delete(G.id),!0));this.tiles.removeMany(F);this.tiles.addMany(C);this._sortTiles()};D._sortTiles=function(){this.viewState.fixedContentCamera||this.tiles.sort((C,F)=>C.measures.visibility!==
F.measures.visibility?C.measures.visibility===t.Visibility.VISIBLE_ON_SURFACE?-1:1:C.measures.distance-F.measures.distance);this.tiles.forEach((C,F)=>C.loadPriority=F)};b._createClass(B,[{key:"tilingScheme",get:function(){const C=this.tilingSchemeOwner.tilingScheme;return C?C.clone():null}},{key:"filterExtent",set:function(C){if(f.isSome(C)&&!C.spatialReference.equals(this.viewState.spatialReference))E.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");
else{var F=this._get("filterExtent");F===C||f.isSome(F)&&C&&F.equals(C)||(C=f.isSome(C)?C.clone():null,this._set("filterExtent",C),this._setDirty())}}},{key:"filterExtentRect",get:function(){if(f.isNone(this.filterExtent)||!this.tilingScheme)return null;const C=q.create();x.toBoundingRect(this.filterExtent,C,this.tilingScheme.spatialReference);return C}},{key:"rootTileIds",get:function(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]}},{key:"suspended",
set:function(C){C!==this._get("suspended")&&(this._set("suspended",C),this._setDirty())}},{key:"updating",get:function(){return this._dirty||!!this._pendingTiles}},{key:"_hasClients",get:function(){return 0<this._clients.size}},{key:"running",get:function(){return this.updating}}]);return B}(g);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"scheduler",void 0);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"renderCoordsHelper",void 0);c.__decorate([e.property({constructOnly:!0})],
a.FeatureTileTree3D.prototype,"tilingSchemeOwner",void 0);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"cameraOnSurface",void 0);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"focus",void 0);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"viewState",void 0);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"terrain",void 0);c.__decorate([e.property()],a.FeatureTileTree3D.prototype,"tiles",
void 0);c.__decorate([e.property()],a.FeatureTileTree3D.prototype,"tileSize",void 0);c.__decorate([e.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"tilingScheme",null);c.__decorate([e.property()],a.FeatureTileTree3D.prototype,"filterExtent",null);c.__decorate([e.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"filterExtentRect",null);c.__decorate([e.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"rootTileIds",null);c.__decorate([e.property({value:!1})],a.FeatureTileTree3D.prototype,
"suspended",null);c.__decorate([e.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"updating",null);a.FeatureTileTree3D=c.__decorate([v.subclass("esri.views.3d.layers.support.FeatureTileTree3D")],a.FeatureTileTree3D);let y=0;const A=q.create();a.default=a.FeatureTileTree3D;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileDescriptor3D":function(){define(["exports","../../../../geometry/support/aaBoundingRect"],function(a,b){let c=function(){function g(w,
n,f,l=null){this.lij=[0,0,0];this.extent=b.create();this.loadPriority=this.resolution=0;this.measures={visibility:a.Visibility.VISIBLE_ON_SURFACE,screenRect:b.create(),distance:0,shouldSplit:!1};this.used=!1;l&&this.acquire(w,n,f,l)}var h=g.prototype;h.acquire=function(w,n,f,l){this.tilingScheme=l;this.id=g.id(w,n,f);this.lij[0]=w;this.lij[1]=n;this.lij[2]=f;l.getExtent(w,n,f,this.extent);this.resolution=l.resolutionAtLevel(w)};h.release=function(){this.tilingScheme=null};h.getChildren=function(w){const n=
this.lij[0]+1,f=2*this.lij[1],l=2*this.lij[2];if(!w)return[new g(n,f,l,this.tilingScheme),new g(n,f+1,l,this.tilingScheme),new g(n,f,l+1,this.tilingScheme),new g(n,f+1,l+1,this.tilingScheme)];w[0].acquire(n,f,l,this.tilingScheme);w[1].acquire(n,f+1,l,this.tilingScheme);w[2].acquire(n,f,l+1,this.tilingScheme);w[3].acquire(n,f+1,l+1,this.tilingScheme);return w};h.copyMeasurementsFrom=function(w){this.measures.visibility=w.measures.visibility;this.measures.shouldSplit=w.measures.shouldSplit;this.measures.distance=
w.measures.distance;b.copy(w.measures.screenRect,this.measures.screenRect)};g.id=function(w,n,f){return`${w}/${n}/${f}`};return g}();a.Visibility=void 0;(function(g){g[g.INVISIBLE=0]="INVISIBLE";g[g.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED";g[g.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(a.Visibility||(a.Visibility={}));a.FeatureTileDescriptor3D=c;a.default=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("exports ../../../../core/screenUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/frustum ../../../../geometry/support/plane ../../../../geometry/support/triangle ./FeatureTileDescriptor3D ./FeatureTileVisibility3D ../../webgl-engine/lib/Camera".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){let d=function(){function u(y){this.camera=new e.default;this.focusOnMap=[0,0];this.screenRect=h.create();this.tileSize=y.tileSize;this.renderCoordsHelper=y.renderCoordsHelper;this.tilingScheme=y.tilingScheme;this.visibility=new k.FeatureTileVisibility3D(y.renderCoordsHelper)}var E=u.prototype;E.begin=function(y,A,p){this.camera.copyFrom(y);this.surfaceElevation=p;this.focusOnMap[0]=A.x;this.focusOnMap[1]=A.y;h.fromValues(0,0,y.fullWidth,y.fullHeight,this.screenRect);
this.visibility.begin(this.camera,p)};E.end=function(){this.visibility.end()};E.updateTile=function(y){y.measures.visibility=this.visibility.calculate(y);y.measures.distance=h.distance(y.extent,this.focusOnMap);y.measures.visibility!==l.Visibility.INVISIBLE&&this._updateScreenMeasure(y)};E._updateScreenMeasure=function(y){const A=y.measures.screenRect;h.empty(A);let p=0;const B=y.lij[0]+2,D=y.lij[1]<<2,C=y.lij[2]<<2;var F=this._tileSizeWithBias(y);F*=F;for(let G=0;4>G;G++)for(let L=0;4>L;L++)if(p+=
this._computeScreenArea(y,B,D+G,C+L,A),p>F){y.measures.shouldSplit=!0;return}y.measures.shouldSplit=!1};E._tileSizeWithBias=function(y){return y.measures.visibility===l.Visibility.VISIBLE_WHEN_EXTENDED?5*this.tileSize:this.tileSize};E._computeScreenArea=function(y,A,p,B,D){this._projectToScreen(A,p,B,y.measures.visibility===l.Visibility.VISIBLE_WHEN_EXTENDED,z);h.empty(m);for(y=0;4>y;y++)h.expandPointInPlace(m,z[y]);h.expand(D,m,D);return f.areaPoints2d(z[0],z[1],z[2])+f.areaPoints2d(z[0],z[2],z[3])};
E._projectToScreen=function(y,A,p,B,D){this.tilingScheme.ensureMaxLod(y);this.tilingScheme.getExtent(y,A,p,v);this._toRenderCoords(v,0,3,t[0]);this._toRenderCoords(v,2,3,t[1]);this._toRenderCoords(v,2,1,t[2]);this._toRenderCoords(v,0,1,t[3]);B&&(this._projectToPlane(t,this.camera.frustum[w.PlaneIndex.NEAR]),this._projectToPlane(t,this.camera.frustum[w.PlaneIndex.TOP]),this._projectToPlane(t,this.camera.frustum[w.PlaneIndex.BOTTOM]));for(y=0;4>y;y++)this.camera.projectToRenderScreen(t[y],x),this.camera.renderToScreen(x,
D[y])};E._projectToPlane=function(y,A){for(var p=0;4>p;p++)r[p]=n.signedDistance(A,y[p]);p=Math.max(r[0],r[1],r[2],r[3]);if(0<p)for(A=c.scale(q,n.normal(A),-p),p=0;4>p;p++)c.add(y[p],y[p],A)};E._toRenderCoords=function(y,A,p,B){q[0]=y[A];q[1]=y[p];q[2]=this.surfaceElevation;this.renderCoordsHelper.toRenderCoords(q,this.tilingScheme.spatialReference,B);return B};return u}();const m=h.create(),z=[b.createScreenPointArray(),b.createScreenPointArray(),b.createScreenPointArray(),b.createScreenPointArray()],
v=h.create(),q=g.create(),t=[g.create(),g.create(),g.create(),g.create()],r=[0,0,0,0],x=b.createRenderScreenPointArray3();a.FeatureTileMeasurements3D=d;a.default=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("exports ../../../../core/mathUtils ../../../../core/ObjectPool ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../../../geometry/support/frustum ../../../../geometry/support/plane ../../../../geometry/support/ray ../../../ViewingMode ./FeatureTileDescriptor3D ../../state/Frustum ../../support/FrustumExtentIntersection".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m){let z=function(){function x(E){this.renderCoordsHelper=E;this.surfaceElevation=0;this.cache=new Map;this.frustum=new d.Frustum(E);this.extendedFrustum=new d.Frustum(E);this.intersector=new m.FrustumExtentIntersection({renderCoordsHelper:E});this.renderCoordsHelper=E}var u=x.prototype;u.begin=function(E,y){this.surfaceElevation=y;this.aboveGround=this.renderCoordsHelper.getAltitude(E.eye)>y;this.frustum.update(E);this._shortenFrustumFarPlane(this.frustum);this._updateExtendedFrustum(E)};
u.end=function(){this.cache.clear()};u.calculate=function(E){if(this.allTilesInvisible)return e.Visibility.INVISIBLE;const y=this.renderCoordsHelper.viewingMode===k.ViewingMode.Global&&2<=E.lij[0]&&6>E.lij[0],A=this._getOrCalculateSingleTileVisibility(E,!y);return A!==e.Visibility.INVISIBLE&&y?this._calculateAggregatedChildrenVisibility(E):A};u._shortenFrustumFarPlane=function(E){var y=d.Frustum.nearFarLineIndices;const A=E.mutablePoints;for(const p of y){const [B,D]=p;y=A[B];g.subtract(v,A[D],y);
g.scale(v,v,.95);g.add(A[D],y,v)}E.updatePoints(A)};u._calculateAggregatedChildrenVisibility=function(E){let y=e.Visibility.INVISIBLE;var A=this.cache.get(E.id);if(null!=A)return A;A=r.acquire();E.getChildren(A);for(const p of A){const B=this.calculate(p);if(B!==e.Visibility.INVISIBLE&&(y=B,B===e.Visibility.VISIBLE_ON_SURFACE))break}r.release(A);this.cache.set(E.id,y);return y};u._getOrCalculateSingleTileVisibility=function(E,y){var A=this.cache.get(E.id);if(null!=A)return A;A=this._calculateSingleTileVisibility(E);
y&&this.cache.set(E.id,A);return A};u._calculateSingleTileVisibility=function(E){if(!this.aboveGround&&this.renderCoordsHelper.viewingMode===k.ViewingMode.Global&&12>E.lij[0]){if(this._calculateSingleTileVisibilitySided(E,!1)===e.Visibility.INVISIBLE)return this._calculateSingleTileVisibilitySided(E,!0)}else return this._calculateSingleTileVisibilitySided(E,this.aboveGround)};u._calculateSingleTileVisibilitySided=function(E,y){this.intersector.update(E.extent,E.tilingScheme.spatialReference,this.surfaceElevation,
y);E=w.getReferenceEllipsoid(E.tilingScheme.spatialReference).radius;return this.intersector.isVisibleInFrustum(this.extendedFrustum,E)?this.intersector.isVisibleInFrustum(this.frustum,E,!0)?e.Visibility.VISIBLE_ON_SURFACE:e.Visibility.VISIBLE_WHEN_EXTENDED:e.Visibility.INVISIBLE};u._updateExtendedFrustum=function(E){this.extendedFrustum.update(E);this._shortenFrustumFarPlane(this.extendedFrustum);var y=this.renderCoordsHelper.worldUpAtPosition(E.eye,v);this.aboveGround||g.negate(y,y);y=b.acosClamped(-g.dot(y,
E.viewForward));this.allTilesInvisible=y>(Math.PI+E.fovY)/2;if(!this.allTilesInvisible&&(this.hasExtendedFrustum=y>E.fovY/2)){E=this._extendedFrustumParameters();y=this.extendedFrustum.mutablePoints;for(let A=0;4>A;A++){const p=E.pointIndices[A],B=y[p],D=this.renderCoordsHelper.getAltitude(B);if(E.needsAltitudeAdjustment(D)){this.renderCoordsHelper.worldUpAtPosition(B,v);switch(p){case n.PointIndex.FAR_BOTTOM_LEFT:case n.PointIndex.FAR_TOP_LEFT:case n.PointIndex.NEAR_BOTTOM_LEFT:case n.PointIndex.NEAR_TOP_LEFT:f.projectVector(this.extendedFrustum.planes[n.PlaneIndex.LEFT],
v,v);break;case n.PointIndex.FAR_BOTTOM_RIGHT:case n.PointIndex.FAR_TOP_RIGHT:case n.PointIndex.NEAR_BOTTOM_RIGHT:case n.PointIndex.NEAR_TOP_RIGHT:f.projectVector(this.extendedFrustum.planes[n.PlaneIndex.RIGHT],v,v)}g.scale(v,v,E.direction);this.renderCoordsHelper.intersectInfiniteManifold(l.wrap(B,v),E.zWithMargin,B)}}this.extendedFrustum.updatePoints(y);f.fromPoints(y[n.PointIndex.NEAR_BOTTOM_LEFT],y[n.PointIndex.NEAR_BOTTOM_RIGHT],y[n.PointIndex.NEAR_TOP_RIGHT],q);f.fromPoints(y[n.PointIndex.NEAR_BOTTOM_RIGHT],
y[n.PointIndex.NEAR_TOP_RIGHT],y[n.PointIndex.NEAR_TOP_LEFT],t);0>g.dot(f.normal(q),f.normal(t))&&(E=this.extendedFrustum.mutablePoints,this.aboveGround?[E[n.PointIndex.NEAR_BOTTOM_LEFT],E[n.PointIndex.NEAR_BOTTOM_RIGHT]]=[E[n.PointIndex.NEAR_BOTTOM_RIGHT],E[n.PointIndex.NEAR_BOTTOM_LEFT]]:[E[n.PointIndex.NEAR_TOP_LEFT],E[n.PointIndex.NEAR_TOP_RIGHT]]=[E[n.PointIndex.NEAR_TOP_RIGHT],E[n.PointIndex.NEAR_TOP_LEFT]],this.extendedFrustum.updatePoints(E))}};u._extendedFrustumParameters=function(){return this.aboveGround?
this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()};u._extendedFrustumParametersAboveSurface=function(){const E=this.surfaceElevation-1;return{zWithMargin:E,pointIndices:d.Frustum.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment(y){return y>E}}};u._extendedFrustumParametersBelowSurface=function(){const E=this.surfaceElevation+1;return{zWithMargin:E,pointIndices:d.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment(y){return y<E}}};
return x}();const v=h.create(),q=f.create(),t=f.create(),r=new c(Array,x=>{4!==x.length&&(x[0]=new e.FeatureTileDescriptor3D,x[1]=new e.FeatureTileDescriptor3D,x[2]=new e.FeatureTileDescriptor3D,x[3]=new e.FeatureTileDescriptor3D)},x=>{x[0].release();x[1].release();x[2].release();x[3].release()});a.FeatureTileVisibility3D=z;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/Frustum":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/vec3",
"../../../chunks/vec3f64","../../../geometry/support/frustum"],function(a,b,c,g,h){function w(f,l,k){f.origin=l;f.endpoint=k;c.direction(f.direction,l,k)}let n=function(){function f(k){this.renderCoordsHelper=k;this.frustum=h.create();this._points=h.createPoints();this.lines=Array(12);this._origin=g.create();this._direction=g.create();this._altitude=null;for(k=0;12>k;k++)this.lines[k]={origin:null,direction:g.create(),endpoint:null}}var l=f.prototype;l.update=function(k){h.fromMatrix(k.viewMatrix,
k.projectionMatrix,this.frustum,this._points);c.copy(this._origin,k.eye);c.copy(this._direction,k.viewForward);this._altitude=this.renderCoordsHelper.getAltitude(this._origin);this._updateLines()};l.updatePoints=function(k){for(let e=0;e<this._points.length;e++)c.copy(this._points[e],k[e]);h.computePlanes(this.frustum,this._points);this._updateLines()};l.intersectsSphere=function(k){return h.intersectsSphere(this.frustum,k)};l.intersectsRay=function(k){return h.intersectsRay(this.frustum,k)};l.intersectsLineSegment=
function(k,e){return h.intersectsLineSegment(this.frustum,k,e)};l.intersectsPoint=function(k){return h.intersectsPoint(this.frustum,k)};l._updateLines=function(){const k=this._points;for(let e=0;4>e;e++){const d=e+4;w(this.lines[e],k[e],k[d]);w(this.lines[e+4],k[e],3===e?k[0]:k[e+1]);w(this.lines[e+8],k[d],3===e?k[4]:k[d+1])}};b._createClass(f,[{key:"planes",get:function(){return this.frustum}},{key:"points",get:function(){return this._points}},{key:"mutablePoints",get:function(){return this._points}},
{key:"direction",get:function(){return this._direction}},{key:"altitude",get:function(){return this._altitude}}]);return f}();n.planePointIndices=h.planePointIndices;n.nearFarLineIndices=[[h.PointIndex.NEAR_BOTTOM_LEFT,h.PointIndex.FAR_BOTTOM_LEFT],[h.PointIndex.NEAR_BOTTOM_RIGHT,h.PointIndex.FAR_BOTTOM_RIGHT],[h.PointIndex.NEAR_TOP_RIGHT,h.PointIndex.FAR_TOP_RIGHT],[h.PointIndex.NEAR_TOP_LEFT,h.PointIndex.FAR_TOP_LEFT]];a.Frustum=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/FrustumExtentIntersection":function(){define("exports ../../../core/compilerUtils ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/lineSegment ../../../geometry/support/plane ../../../geometry/support/ray ../../ViewingMode ./intersectionUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t){const r=.5*Math.PI,x=r/Math.PI*180;let u=function(){function F(L){this.renderCoordsHelper=L.renderCoordsHelper;this.extent=Array(4);this.planes=Array(6);this.maxSpan=0;this.center={origin:n.create(),direction:n.create()};for(L=0;4>L;L++)this.extent[L]={origin:n.create(),direction:n.create(),cap:{next:null,direction:n.create()}},this.planes[L]=z.create();this.planes[d.PlaneIndex.NEAR]=z.create();this.planes[d.PlaneIndex.FAR]=z.create();this.planesWithoutFar=
this.planes.slice(0,5)}var G=F.prototype;G.update=function(L,H,M,K=!0){const I=this.extent;this._toRenderBoundingExtent(L,H,M);w.add(this.center.origin,I[0].origin,I[2].origin);w.scale(this.center.origin,this.center.origin,.5);this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction);K||w.scale(this.center.direction,this.center.direction,-1);for(M=0;4>M;M++){const O=I[M];this.renderCoordsHelper.worldUpAtPosition(O.origin,O.direction);const Q=I[3===M?0:M+1];O.cap.next=Q.origin;
w.direction(O.cap.direction,O.origin,Q.origin);z.fromVectorsAndPoint(O.direction,O.cap.direction,O.origin,this.planes[M]);K||w.scale(O.direction,O.direction,-1)}z.fromVectorsAndPoint(I[0].cap.direction,I[1].cap.direction,I[0].origin,this.planes[d.PlaneIndex.NEAR]);K?z.negate(this.planes[d.PlaneIndex.NEAR],this.planes[d.PlaneIndex.FAR]):(z.copy(this.planes[d.PlaneIndex.FAR],this.planes[d.PlaneIndex.NEAR]),z.negate(this.planes[d.PlaneIndex.NEAR],this.planes[d.PlaneIndex.NEAR]));this.maxSpan=Math.max(Math.abs(L[0]-
L[2]),Math.abs(L[1]-L[3]));this.maxSpanSpatialReference=H;this.minGlobalAltitude=.9*l.getReferenceEllipsoid(this.maxSpanSpatialReference).radius};G.isVisibleInFrustum=function(L,H,M=!1){if(null==L)return!1;if(this.renderCoordsHelper.viewingMode===q.ViewingMode.Global){if(this.maxSpan>(this.maxSpanSpatialReference.isGeographic?x:r*H))return!0;if(L.altitude>=this.minGlobalAltitude)return this._isVisibleInFrustumGlobal(L)}if(0===this.maxSpan)return H=this.extent[0],!M&&L.intersectsRay(v.wrap(H.origin,
H.direction))?!0:!1;for(H=0;H<this.extent.length;H++){var K=this.extent[H];if(!M&&L.intersectsRay(v.wrap(K.origin,K.direction))||L.intersectsLineSegment(m.fromPoints(K.origin,K.cap.next,C),K.cap.direction))return!0}M=M?this.planes:this.planesWithoutFar;for(H=0;H<L.lines.length;H++)if(K=L.lines[H],t.frustumLineSegment(M,K.origin,K.endpoint,K.direction))return!0;return!1};G._toRenderBoundingExtentGlobal=function(L,H,M){e.center(L,y);y[2]=M;f.computeTranslationToOriginAndRotation(H,y,A,this.renderCoordsHelper.spatialReference);
g.invert(p,A);k.empty(B);for(const {x0:K,x1:I,y0:O,y1:Q}of E)for(let J=0;5>J;J++){const P=J/4;y[0]=c.lerp(L[K],L[I],P);y[1]=c.lerp(L[O],L[Q],P);y[2]=M;f.projectVectorToVector(y,H,y,this.renderCoordsHelper.spatialReference);w.transformMat4(y,y,p);k.expandWithVec3(B,y)}w.set(this.extent[0].origin,B[0],B[1],B[2]);w.set(this.extent[1].origin,B[3],B[1],B[2]);w.set(this.extent[2].origin,B[3],B[4],B[2]);w.set(this.extent[3].origin,B[0],B[4],B[2]);for(L=0;4>L;++L)w.transformMat4(this.extent[L].origin,this.extent[L].origin,
A)};G._toRenderBoundingExtentLocal=function(L,H,M){f.projectBoundingRect(L,H,D,this.renderCoordsHelper.spatialReference);w.set(this.extent[0].origin,D[0],D[1],M);w.set(this.extent[1].origin,D[2],D[1],M);w.set(this.extent[2].origin,D[2],D[3],M);w.set(this.extent[3].origin,D[0],D[3],M)};G._toRenderBoundingExtent=function(L,H,M){switch(this.renderCoordsHelper.viewingMode){case q.ViewingMode.Global:this._toRenderBoundingExtentGlobal(L,H,M);break;case q.ViewingMode.Local:this._toRenderBoundingExtentLocal(L,
H,M);break;default:b.neverReached(this.renderCoordsHelper.viewingMode)}};G._isVisibleInFrustumGlobal=function(L){if(0>w.dot(this.center.direction,L.direction))return!0;for(let H=0;4>H;H++)if(0>w.dot(this.extent[H].direction,L.direction))return!0;return!1};return F}();const E=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],y=n.create(),A=h.create(),p=h.create(),B=k.create(),D=e.create(),C=m.create();a.FrustumExtentIntersection=u;a.default=u;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/support/extentUtils":function(){define(["exports","../../../core/maybe","../../../chunks/vec3f64","../../../geometry/projection"],function(a,b,c,g){const h=c.create();a.projectToBoundingBox=function(w,n,f){if(b.isNone(w)||b.isNone(f))return!1;let l;h[0]=null!=w.xmin?w.xmin:0;h[1]=null!=w.ymin?w.ymin:0;h[2]=null!=w.zmin?w.zmin:0;l=g.projectBuffer(h,w.spatialReference,0,n,f,0,1);h[0]=null!=w.xmax?w.xmax:0;h[1]=null!=w.ymax?w.ymax:0;h[2]=null!=w.zmax?w.zmax:
0;l=l&&g.projectBuffer(h,w.spatialReference,0,n,f,3,1);null==w.xmin&&(n[0]=-Infinity);null==w.ymin&&(n[1]=-Infinity);null==w.zmin&&(n[2]=-Infinity);null==w.xmax&&(n[3]=Infinity);null==w.ymax&&(n[4]=Infinity);null==w.zmax&&(n[5]=Infinity);return l};a.toBoundingRect=function(w,n,f){if(b.isNone(w)||b.isNone(f))return!1;let l;h[0]=null!=w.xmin?w.xmin:0;h[1]=null!=w.ymin?w.ymin:0;h[2]=null!=w.zmin?w.zmin:0;l=g.projectBuffer(h,w.spatialReference,0,h,f,0,1);n[0]=h[0];n[1]=h[1];h[0]=null!=w.xmax?w.xmax:0;
h[1]=null!=w.ymax?w.ymax:0;h[2]=null!=w.zmax?w.zmax:0;l=l&&g.projectBuffer(h,w.spatialReference,0,h,f,0,1);n[2]=h[0];n[3]=h[1];null==w.xmin&&(n[0]=-Infinity);null==w.ymin&&(n[1]=-Infinity);null==w.xmax&&(n[2]=Infinity);null==w.ymax&&(n[3]=Infinity);return l};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/ViewState":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/watch ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../ViewAnimation ../../ViewingMode ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/PropertiesPool ../webgl-engine/lib/Camera".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u){c=function(p){function B(){var C=p.apply(this,arguments)||this;C._propertiesPool=new x.PropertiesPool({camera:u.default},a._assertThisInitialized(C));C._lastSeenCameraProjectionValues=new u.default;C.events=new g;C.viewingMode=v.ViewingMode.Global;C._cameraChanged=!1;C.updateQueue=[];C.processingUpdates=!1;return C}a._inheritsLoose(B,p);var D=B.prototype;D.init=function(C,F){this._set("viewingMode",C);this._set("spatialReference",F);this._set("constraints",
new q.default({mode:this.viewingMode}))};D.exit=function(){this.cameraController=null;this._propertiesPool.destroy();this._propertiesPool=new x.PropertiesPool({camera:u.default},this)};D.createInitialCamera=function(){if(this.viewingMode===v.ViewingMode.Global){const C=m.getReferenceEllipsoid(this.spatialReference).radius;this.camera=new u.default(d.fromValues(4*C,0,0),d.fromValues(C,0,0),d.fromValues(0,0,1))}else this.camera=new u.default(d.fromValues(0,0,100),d.fromValues(0,0,0),d.fromValues(0,
1,0))};D.switchCameraController=function(C){this.cameraController=C;return C.state!==r.State.Rejected};D.stopActiveCameraController=function(){return this.cameraController&&!this.cameraController.stopController()?!1:!0};D.updateCamera=function(C){this.updateQueue.push(C);this._processUpdateQueue()};D._processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=!0;var C=this.updateQueue.shift();E.copyFrom(this._get("camera"));C(E);this.camera=E;this.processingUpdates=
!1;this._processUpdateQueue()}};D._cameraProjectionChanged=function(C,F){return C.fov!==F.fov||C.fullViewport[0]!==F.fullViewport[0]||C.fullViewport[1]!==F.fullViewport[1]||C.fullViewport[2]!==F.fullViewport[2]||C.fullViewport[3]!==F.fullViewport[3]||C.padding[u.PaddingSide.TOP]!==F.padding[u.PaddingSide.TOP]||C.padding[u.PaddingSide.RIGHT]!==F.padding[u.PaddingSide.RIGHT]||C.padding[u.PaddingSide.BOTTOM]!==F.padding[u.PaddingSide.BOTTOM]||C.padding[u.PaddingSide.LEFT]!==F.padding[u.PaddingSide.LEFT]?
!0:!1};a._createClass(B,[{key:"animation",get:function(){return this.cameraController instanceof t.AnimationController&&h.isSome(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}},{key:"camera",get:function(){return this._get("camera")},set:function(C){C!==E&&E.copyFrom(C);E.computeUp(this.viewingMode);y.camera=E;this.events.emit("before-camera-change",y);C=this._get("camera");this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,E)&&(this._lastSeenCameraProjectionValues.copyFrom(E),
A.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",A));if(!C||!C.equals(E))if(this._set("camera",this._propertiesPool.get("camera").copyFrom(E)),this._cameraChanged=!C||!C.almostEquals(E)){const F=e.afterDispatch(()=>{this._cameraChanged=!1;F.remove()})}}},{key:"contentCamera",get:function(){return h.isSome(this._contentCamera)?this._contentCamera:this.camera},set:function(C){this._contentCamera=h.isSome(C)?C.clone():null}},{key:"fixedContentCamera",get:function(){return!!h.isSome(this._contentCamera)}},
{key:"isGlobal",get:function(){return this.viewingMode===v.ViewingMode.Global}},{key:"isLocal",get:function(){return this.viewingMode===v.ViewingMode.Local}},{key:"navigating",get:function(){return!(!this.cameraController||!this.cameraController.isInteractive)}},{key:"stationary",get:function(){return!this._cameraChanged&&!this.navigating}},{key:"cameraController",get:function(){return this._get("cameraController")},set:function(C){this.stopActiveCameraController()?(C&&(C.watch("state",F=>{if(F===
r.State.Finished||F===r.State.Stopped)this._set("cameraController",null),this.updateCamera(G=>C.onControllerEnd(G))},!0),C.onControllerStart(this.camera)),this._set("cameraController",C)):C&&(C.state=r.State.Rejected)}}]);return B}(c);b.__decorate([w.property({readOnly:!0,type:z})],c.prototype,"animation",null);b.__decorate([w.property({type:u.default})],c.prototype,"camera",null);b.__decorate([w.property({})],c.prototype,"_contentCamera",void 0);b.__decorate([w.property({type:u.default})],c.prototype,
"contentCamera",null);b.__decorate([w.property({readOnly:!0})],c.prototype,"fixedContentCamera",null);b.__decorate([w.property({readOnly:!0})],c.prototype,"constraints",void 0);b.__decorate([w.property({readOnly:!0})],c.prototype,"events",void 0);b.__decorate([w.property({readOnly:!0})],c.prototype,"isGlobal",null);b.__decorate([w.property({readOnly:!0})],c.prototype,"isLocal",null);b.__decorate([w.property({readOnly:!0})],c.prototype,"viewingMode",void 0);b.__decorate([w.property({readOnly:!0})],
c.prototype,"spatialReference",void 0);b.__decorate([w.property({readOnly:!0})],c.prototype,"navigating",null);b.__decorate([w.property({readOnly:!0})],c.prototype,"stationary",null);b.__decorate([w.property()],c.prototype,"_cameraChanged",void 0);b.__decorate([w.property()],c.prototype,"cameraController",null);b=c=b.__decorate([k.subclass("esri.views.3d.state.ViewState")],c);const E=new u.default,y={camera:null},A={camera:null};return b})},"esri/views/3d/support/PropertiesPool":function(){define(["exports",
"../../../core/ReentrantObjectPool","../../../core/accessorSupport/watch"],function(a,b,c){let g=function(){function h(n,f){this.owner=f;this.properties={};this.afterDispatchHandle=null;for(const l in n)f=new b.ReentrantObjectPool(n[l],null,null,2,2),this.properties[l]={pool:f,acquired:[]};this.afterDispatchHandle=c.afterDispatch(()=>this._release())}var w=h.prototype;w.destroy=function(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);for(const n in this.properties){const f=
this.properties[n];for(const l of f.acquired)c.isValueInUse(l)||f.pool.release(l);f.pool.destroy();f.pool=null;f.acquired=null}this.owner=this.properties=null};w.get=function(n){const f=this.owner._get(n);n=this.properties[n];let l=n.pool.acquire();for(n.acquired.push(l);l===f;)n.acquired.push(l),l=n.pool.acquire();return l};w._release=function(){for(const n in this.properties){const f=this.properties[n];let l=0;for(const k of f.acquired)c.isValueInUse(k)?f.acquired[l++]=k:f.pool.release(k);f.acquired.length=
l}};return h}();a.PropertiesPool=g;a.default=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/ViewStateManager":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Camera ../../../Viewpoint ../../../core/Accessor ../../../core/Handles ../../../core/Logger ../../../core/maybe ../../../core/scheduling ../../../core/screenUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/Extent ../../../geometry/Point ../../../geometry/support/webMercatorUtils ../../ViewingMode ../camera/constraintUtils ../camera/intersectionUtils ./ConstraintsManager ./Frustum ./GoToOperation ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/PropertiesPool ../support/viewpointUtils ../webgl-engine/lib/Camera".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H,M,K,I){const O=n.getLogger("esri.views.3d.state.ViewStateManager");h=function(T){function V(U){U=T.call(this,U)||this;U.propertiesPool=new M.PropertiesPool({frustum:F.Frustum},a._assertThisInitialized(U));U.handles=new w;U.cameraSetByUser=!1;U.gotoOperation=null;U.ready=!1;U.updateDevicePixelRatio=null;U.test={contentCameraResetState:new Map};return U}a._inheritsLoose(V,T);var W=V.prototype;W.installContentCameraReset=function(U){this.handles.remove("contentCameraReset");
this.test.contentCameraResetState.clear();if(!this.view.state.fixedContentCamera)return!1;const aa=this.zoom,da=this.view.state.camera.distance**2,Y=r.fromArray(this.view.state.camera.center),ea=U.sticky?this.contentCamera.clone():null;this.handles.add([this.watch("contentCamera",()=>{U.sticky||(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear())}),this.watch("zoom",ja=>{this.test.contentCameraResetState.set("view.zoom",Math.abs(ja-aa)/2);2<Math.abs(ja-aa)?this.contentCamera=
null:this.view.state.fixedContentCamera||(this.contentCamera=ea)}),this.view.state.watch("camera",ja=>{ja=t.squaredDistance(Y,ja.center);this.test.contentCameraResetState.set("camera.center",ja/da);ja>da?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=ea)})],"contentCameraReset");return!0};W._paddingToArray=function(U,aa,da){U?x.set(da,U.top||0,U.right||0,U.bottom||0,U.left||0):x.set(da,0,0,0,0);for(U=0;4>U;U++)da[U]=Math.round(da[U]*aa)};W.initialize=function(){this.handles.add([e.on(this.view,
"state.events","before-camera-change",U=>this._updateElevation(U.camera))]);e.once(this.view.state,"camera",U=>this._updateElevation(U),!0);this.handles.add(l.addFrameTask({prepare:()=>this._prepareFrame()}));this.handles.add(this.view.state.watch("cameraController",()=>{this.cameraSetByUser=!0;this.handles.remove("pending-initial-view")}));this.handles.add(e.on(this.view,"state.events","camera-projection-changed",()=>this.notifyChange("scale")))};W.destroy=function(){this.deinit();this.handles&&
(this.handles.destroy(),this.handles=null);this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};W.init=function(){this.constraintsManager=new C.default({view:this.view});this._prepareFrame();var U=this._getInitialProperties();this.cameraSetByUser=!1;this._set("ready",!0);for(const aa of U)this.set(aa.name,aa.value);this.cameraSetByUser||((U=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent)&&this.isCompatible(U)?this._setInitialView(U):this.view.state.viewingMode===
p.ViewingMode.Local&&this.handles.add(e.whenOnce(this.view.basemapTerrain,"ready",()=>{this.handles.remove("pending-initial-view");this._setInitialView(this.view.dataExtent)}),"pending-initial-view"))};W.deinit=function(){this._cancelGoToOperation();this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this.cameraSetByUser=!1,this.handles.remove("pending-initial-view"),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=
null))};W.goTo=function(){var U=a._asyncToGenerator(function*(aa,da){da={animate:!0,...da};f.isSome(this.gotoOperation)&&this.gotoOperation.abort(da.animate);this.gotoOperation=new G.GoToOperation(aa,da,this.view);this.view.resourceController.scheduler.stopFrame();return this.gotoOperation});return function(aa,da){return U.apply(this,arguments)}}();W.debugSetCameraOnContent=function(){this.setStateCamera(D.cameraOnContentAlongViewDirection(this.view),{applyConstraints:!1})};W.step=function(U){const aa=
this.view.state,da=aa&&this.view.state.cameraController;da&&(aa.updateCamera(Y=>{da.stepController(U,Y)}),da.steppingFinished&&da.finishController())};W._cancelGoToOperation=function(){f.isSome(this.gotoOperation)&&(this.gotoOperation.abort(),this.gotoOperation=null)};W._getInitialProperties=function(){const U=new Set,aa=[];for(const {propertyName:da,overrides:Y}of J){const ea=U.has(da),ja=this._isOverridden(da);!ea&&ja&&aa.push({name:da,value:this._get(da)});this._clearOverride(da);(ea||ja)&&Y.forEach(la=>
U.add(la))}return aa};W._setInitialView=function(U){if(!f.isNone(U)&&!this.cameraSetByUser)if(U instanceof c)this.setStateCamera(H.externalToInternal(this.view,U),{applyConstraints:!1});else if(U instanceof g)if(U.targetGeometry instanceof E){var aa=H.fromExtent(this.view,U.targetGeometry,0,.5,H.OrientationMode.LOCKED);f.isSome(aa)&&this.setStateCamera(H.externalToInternal(this.view,aa),{applyConstraints:!0})}else aa={applyConstraints:!U.camera},U=this._viewpointToCamera(U),this.setStateCamera(U,
aa);else aa=H.fromExtent(this.view,U,0,.5,H.OrientationMode.LOCKED),f.isSome(aa)&&this.setStateCamera(H.externalToInternal(this.view,aa),{applyConstraints:!0})};W._updatePropertyBeforeReady=function(U,aa){if(this.ready)return!1;this._override(U,aa);aa&&-1!==Q.indexOf(U)&&this._override("hasInitialView",!0);return!0};W.isCompatible=function(U){return f.isNone(U)?!1:U instanceof g?U.camera?this.isCompatible(U.camera):this.isCompatible(U.targetGeometry):U instanceof c?this.isCompatible(U.position):U.spatialReference&&
A.canProject(U.spatialReference,this.view.spatialReference)};W._getPreservingHeadingTilt=function(U=P){this.cameraSetByUser?(U.heading=this.camera.heading,U.tilt=this.camera.tilt):(U.heading=0,U.tilt=.5);return U};W._centerPointAtDistanceToCamera=function(U,aa,da=R){const {heading:Y,tilt:ea}=this._getPreservingHeadingTilt();U=H.getObserverForPointAtDistance(this.view,Y,ea,U,aa,H.OrientationMode.ADJUST);if(f.isNone(U))return null;da.copyFrom(this.view.state.camera);da.eye=U.eye;da.center=U.center;
da.up=U.up;return da};W._centerToCamera=function(U){const aa=this.view.pointsOfInterest.centerOnContent;aa.runTask();return this._centerPointAtDistanceToCamera(U,aa.distance)};W._extentToCamera=function(U){const {heading:aa,tilt:da}=this._getPreservingHeadingTilt();U=H.fromExtent(this.view,U,aa,da,H.OrientationMode.ADJUST,N);return f.isSome(U)?H.externalToInternal(this.view,U):null};W._scaleToCamera=function(U){if(null==U)return null;const aa=this.view.pointsOfInterest.centerOnContent;aa.runTask();
const da=aa.renderLocation;U=H.scaleToDistance(this.view,U,aa.location.latitude);return this._centerPointAtDistanceToCamera(da,U)};W._zoomToCamera=function(U){return this._scaleToCamera(H.zoomToScale(this.view,U))};W._viewpointToCamera=function(U){return H.externalToInternal(this.view,K.toCamera(this.view,U))};W.setStateCamera=function(U,aa){if(f.isNone(U)||!this.view.state.stopActiveCameraController())return!1;this.cameraSetByUser=!0;aa.doNotCancelGoToOperation||this._cancelGoToOperation();this.view.state.updateCamera(da=>
{aa.positionAndOrientationOnly?(da.eye=U.eye,da.center=U.center,da.up=U.up):da.copyFrom(U);aa.applyConstraints&&B.applyAll(this.view,da)});aa.applyConstraints||(this.view.state.cameraController=new L.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:U}));return!0};W._prepareFrame=function(){const {container:U,canvas:aa}=this.view;if(U&&aa){f.isSome(this.updateDevicePixelRatio)&&this.updateDevicePixelRatio();var da=this.view.pixelRatio,Y=Math.round(U.clientWidth*da),ea=Math.round(U.clientHeight*
da);if(0!==Y&&0!==ea){if(aa.width!==Y||aa.height!==ea)aa.width=Y,aa.height=ea;if(this.view.state){const ja=this.view.state.camera;if(ja.fullWidth!==Y||ja.fullHeight!==ea||ja.pixelRatio!==da)R.copyFrom(ja),R.pixelRatio!==da&&(this._paddingToArray(this.padding,da,S),R.padding=S),R.fullWidth=Y,R.fullHeight=ea,R.pixelRatio=da,this.view.state.camera=R}}}};W._updateElevation=function(U){var aa=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference;const da=this.view.renderCoordsHelper.getAltitude(U.eye);
aa=aa?D.surfaceElevationBelowRenderLocation(this.view,U.eye):0;U.relativeElevation=da-aa};a._createClass(V,[{key:"camera",get:function(){const U=this._get("camera");if(!this.ready)return U;const aa=H.internalToExternal(this.view,this.view.state.camera);return aa&&U&&aa.equals(U)?U:aa},set:function(U){this._updatePropertyBeforeReady("camera",U)||(this.view.elevationProvider.enableElevationCache(!0),this.setStateCamera(H.externalToInternal(this.view,U),{applyConstraints:!1})||O.error("#camera\x3d",
"Invalid camera",U),this.view.elevationProvider.enableElevationCache(!1))}},{key:"contentCamera",get:function(){const U=this._get("contentCamera");if(!this.ready)return U;const aa=H.internalToExternal(this.view,this.view.state.contentCamera);return aa&&U&&aa.equals(U)?U:aa},set:function(U){this._updatePropertyBeforeReady("contentCamera",U)||(U=H.externalToInternal(this.view,U),f.isNone(U)?this.view.state.contentCamera=null:(this._updateElevation(U),this.view.state.contentCamera=U))}},{key:"center",
get:function(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")},set:function(U){this._updatePropertyBeforeReady("center",U)||(U?this.isCompatible(U)?this.setStateCamera(this._centerToCamera(U),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():O.error("#center\x3d","Invalid center",U):O.error("#center\x3d","Center has an incompatible spatial reference (center: "+(U.spatialReference?U.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+
")",U):O.error("#center\x3d","Center may not be null or undefined"))}},{key:"extent",get:function(){if(!this.ready)return this._get("extent");var U=this.view;U=H.toExtent(U,U.state.camera,U.pointsOfInterest.centerOnContent.renderLocation);return f.isSome(U)?U:this._get("extent")},set:function(U){this._updatePropertyBeforeReady("extent",U)||(U?this.isCompatible(U)?this.setStateCamera(this._extentToCamera(U),{applyConstraints:!0})||O.error("#extent\x3d","Invalid extent",U):O.error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+
(U.spatialReference?U.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",U):O.error("#extent\x3d","Extent may not be null or undefined"))}},{key:"frustum",get:function(){const U=this.propertiesPool.get("frustum");U.renderCoordsHelper=this.view.renderCoordsHelper;U.update(this.view.state.camera);return U}},{key:"hasInitialView",get:function(){return!!this.view.get("map.initialViewProperties.viewpoint")}},{key:"scale",get:function(){if(this.ready){const U=this.view.pointsOfInterest.centerOnContent;
return H.distanceToScale(this.view,U.distance,U.location.latitude)}return this._get("scale")},set:function(U){this._updatePropertyBeforeReady("scale",U)||this.setStateCamera(this._scaleToCamera(U),{applyConstraints:!0})||O.error("#scale\x3d","Invalid scale",U)}},{key:"padding",get:function(){if(!this.ready)return this._get("padding");var U=this.view.state.camera,aa=U.padding;const da=U.pixelRatio;U=this._get("padding");const Y=Math.round(aa[I.PaddingSide.TOP]/da),ea=Math.round(aa[I.PaddingSide.RIGHT]/
da),ja=Math.round(aa[I.PaddingSide.BOTTOM]/da);aa=Math.round(aa[I.PaddingSide.LEFT]/da);return null!=U&&U.top===Y&&U.right===ea&&U.bottom===ja&&U.left===aa?U:{top:Y,right:ea,bottom:ja,left:aa}},set:function(U){this._updatePropertyBeforeReady("padding",U)||(this._paddingToArray(U,this.view.state.camera.pixelRatio,S),this.view.state.updateCamera(aa=>aa.padding=S))}},{key:"screenCenter",get:function(){const U=this.padding;return k.createScreenPoint((this.view.width-(U.left+U.right))/2+U.left,(this.view.height-
(U.top+U.bottom))/2+U.top)}},{key:"viewpoint",get:function(){return this.ready?K.fromCamera(this.view,this.camera):this._get("viewpoint")},set:function(U){if(!this._updatePropertyBeforeReady("viewpoint",U))if(U)if(this.isCompatible(U))this.setStateCamera(this._viewpointToCamera(U),{applyConstraints:!U.camera})||O.error("#viewpoint\x3d","Invalid viewpoint",U);else{var aa=f.isSome(U.camera)?U.camera.position:U.targetGeometry;aa=f.isSome(aa)&&aa.spatialReference;O.error("#viewpoint\x3d","Viewpoint has an incompatible spatial reference (viewpoint: "+
(aa?aa.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",U)}else O.error("#viewpoint\x3d","Viewpoint may not be null or undefined")}},{key:"zoom",get:function(){return this.ready?H.scaleToZoom(this.view,this.scale):this._get("zoom")},set:function(U){this._updatePropertyBeforeReady("zoom",U)||this.setStateCamera(this._zoomToCamera(U),{applyConstraints:!0})||O.error("#zoom\x3d","Invalid zoom",U)}}]);return V}(h);b.__decorate([d.property({type:c,dependsOn:["view.state.camera","ready"]})],h.prototype,
"camera",null);b.__decorate([d.property({type:c,dependsOn:["view.state.contentCamera","ready"]})],h.prototype,"contentCamera",null);b.__decorate([d.property({type:y})],h.prototype,"center",null);b.__decorate([d.property({type:E})],h.prototype,"extent",null);b.__decorate([d.property({readOnly:!0})],h.prototype,"frustum",null);b.__decorate([d.property({readOnly:!0})],h.prototype,"hasInitialView",null);b.__decorate([d.property({readOnly:!0,type:Boolean})],h.prototype,"ready",void 0);b.__decorate([d.property({type:Number})],
h.prototype,"scale",null);b.__decorate([d.property()],h.prototype,"padding",null);b.__decorate([d.property({readOnly:!0})],h.prototype,"screenCenter",null);b.__decorate([d.property({constructOnly:!0})],h.prototype,"view",void 0);b.__decorate([d.property({type:g})],h.prototype,"viewpoint",null);b.__decorate([d.property({type:Number})],h.prototype,"zoom",null);b.__decorate([d.property({constructOnly:!0})],h.prototype,"updateDevicePixelRatio",void 0);b=h=b.__decorate([q.subclass("esri.views.3d.state.ViewStateManager")],
h);const Q="camera viewpoint extent scale center zoom".split(" "),J=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],P={heading:0,tilt:0},N=new c,R=new I.default,S=u.create();return b})},"esri/views/3d/state/ConstraintsManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../ViewingMode ../camera/constraintUtils ../camera/intersectionUtils ../camera/constraintUtils/common ./NearFarHeuristic ./SurfaceCollisionConstraint".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x){a.ConstraintsManager=function(u){function E(A){var p=u.call(this,A)||this;p._handles=new h;p.nearFarHeuristic=r.createNearFarHeuristic(A.view.state.viewingMode,A.view.basemapTerrain,A.view.renderCoordsHelper.spatialReference);return p}b._inheritsLoose(E,u);var y=E.prototype;y.initialize=function(){this._handles.add([this.view.watch(["constraints.clipDistance.near","constraints.clipDistance.far"],()=>this._clipDistanceNearFarChanged()),this.view.watch("constraints.clipDistance.mode",
()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",A=>this._updateCameraNearFar(A.camera)),this.view.watch("renderDataExtent",()=>this._updateNearFar(),!0),this.view.watch(["constraints.altitude.min","constraints.altitude.max"],()=>this._updateAltitude(),!0),this.view.watch("constraints.tilt.max",()=>this._updateTiltMax(),!0),this.view.watch("constraints.tilt.mode",()=>this._updateTilt(),!0),this.view.watch("state.camera",()=>this._updateTiltAutoMax(),!0),this.view.watch(["map.ground.navigationConstraint.type",
"constraints.collision.enabled"],()=>this._updateCollision(),!0)]);this.view.state.isLocal&&this._handles.add(f.init(this.view,"renderDataExtent",A=>this._updateLocalSurfaceDistance(A)));this._updateNearFar();this.view.state.viewingMode!==z.ViewingMode.Local&&this._updateAltitude();this._updateTilt();this._updateCollision();this._set("surfaceCollisionConstraint",new x.default({view:this.view}))};y.destroy=function(){this._handles=n.destroyMaybe(this._handles);this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),
this._set("surfaceCollisionConstraint",null))};y._clipDistanceNearFarChanged=function(){var A;const p=null==(A=this.view.constraints)?void 0:A.clipDistance;p&&"auto"!==p.mode&&this.view.state.updateCamera(B=>{this._updateCameraNearFarManual(B,p);return!0})};y._updateNearFar=function(){this.view.state.updateCamera(A=>{this._updateCameraNearFar(A);return!0})};y._updateCameraNearFar=function(A){const p=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(p?p.mode:"auto")?this._updateCameraNearFarManual(A,
p):this._updateCameraNearFarAuto(A,p)};y._updateCameraNearFarAuto=function(A,p){this.nearFarHeuristic.compute(A.eye,A.center,this.view.renderDataExtent,q.surfaceElevationBelowRenderLocation(this.view,A.eye),A);p&&p.autoUpdate(A.near,A.far)};y._updateCameraNearFarManual=function(A,p){p&&(A.near=p.near,A.far=p.far)};y._updateCollision=function(){var A,p,B;const D=null==(A=this.view.map)?void 0:null==(p=A.ground)?void 0:null==(B=p.navigationConstraint)?void 0:B.type;A=D?"stay-above"===D:!0;p=this.view.state.constraints.collision;
A!==p.enabled&&((p.enabled=A)&&this._reapplyConstraints(t.ConstraintTypes.COLLISION),(A=this.view.constraints&&this.view.constraints.tilt)&&"auto"!==A.mode||this._updateTiltAuto())};y._updateAltitude=function(){const A=this.view.constraints&&this.view.constraints.altitude;this.view.state.constraints.altitude=A&&this.view.state.viewingMode!==z.ViewingMode.Local?{min:A.min,max:A.max}:null;this._reapplyConstraints()};y._updateTiltMax=function(){const A=this.view.constraints&&this.view.constraints.tilt;
A&&"auto"!==A.mode&&(this._updateTiltManual(A),this._reapplyConstraints())};y._updateTilt=function(){const A=this.view.constraints&&this.view.constraints.tilt;"manual"===(A?A.mode:"auto")?this._updateTiltManual(A):this._updateTiltAuto();this._reapplyConstraints()};y._updateTiltManual=function(A){const p=this.view.state.constraints;p.tilt=p.createConstantMaxTilt(w.deg2rad(A.max))};y._updateTiltAuto=function(){const A=this.view.state.constraints;A.tilt=A.createDefaultTilt();this._updateTiltAutoMax()};
y._updateTiltAutoMax=function(){const A=this.view.constraints&&this.view.constraints.tilt;if(A&&"auto"===A.mode){var p=this.view.state.constraints;p.tilt&&(p=p.tilt(this.view.state.camera.distance).max,A.autoUpdate(w.rad2deg(p)))}};y._updateLocalSurfaceDistance=function(A){if(!n.isNone(A)){var p=Math.max(A.width,A.height);0>=p||(A.hasZ&&(p=Math.max(p,A.zmax-A.zmin)),A=this.view.state,p=3*p/Math.atan(A.camera.fov/2),p!==A.constraints.distance&&(A.constraints.distance=p))}};y._reapplyConstraints=function(A=
t.ConstraintTypes.ALL){this.view.state.updateCamera(p=>v.applyAll(this.view,p,{selection:A,interactionType:t.InteractionType.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:t.TiltMode.TUMBLE}))};return E}(g);c.__decorate([l.property({constructOnly:!0})],a.ConstraintsManager.prototype,"view",void 0);c.__decorate([l.property({readOnly:!0})],a.ConstraintsManager.prototype,"surfaceCollisionConstraint",void 0);a.ConstraintsManager=c.__decorate([m.subclass("esri.views.3d.state.ConstraintsManager")],
a.ConstraintsManager);a.default=a.ConstraintsManager;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/NearFarHeuristic":function(){define("exports ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/Extent ../../../geometry/projectionEllipsoid ../../ViewingMode".split(" "),function(a,b,c,g,h,w,n,f,l){function k(v,q,t,r){t=2/t;v/q>t?(r.far=v,r.near=r.far/q):(r.near=t,r.far=r.near*q);return r}let e=
function(){function v(q,t){this.elevationProvider=q;this._referenceEllipsoid=f.getReferenceEllipsoid(t);this.unitInMeters=g.getMetersPerUnitForSR(t,this._referenceEllipsoid.metersPerDegree)}v.prototype.compute=function(q,t,r,x,u){u||(u={near:0,far:0});var E=q[2]*this.unitInMeters,y=E;x=E-x;var A=this.elevationProvider?this.elevationProvider.elevationBounds:null;A&&(E=0<=x?y-this.unitInMeters*A.min:this.unitInMeters*A.max-y);r=c.isSome(r)?r:new n({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0});y=Math.max(r.xmax-
r.xmin,r.ymax-r.ymin,4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin));h.subtract(z,t,q);m[0]=0<z[0]?r.xmax:r.xmin;m[1]=0<z[1]?r.ymax:r.ymin;m[2]=0<z[2]?y/2:-y/2;h.subtract(m,m,q);h.normalize(z,z);q=1.1*h.dot(m,z)*this.unitInMeters;t=Math.sqrt(E*(E+2*this._referenceEllipsoid.radius));r=Math.max(r.xmax-r.xmin,r.ymax-r.ymin);A=1E-4*r*this.unitInMeters;E=b.clamp((E-A)/(.001*r*this.unitInMeters-A),0,1);E=b.lerp(t,q,E*E*E);E*=Math.max(Math.log(Math.abs(x)),1);E=Math.min(E,Math.max(34064E4,y));E/=this.unitInMeters;
return k(E,2E4,this.unitInMeters,u)};return v}(),d=function(){function v(q){this._referenceEllipsoid=f.getReferenceEllipsoid(q)}v.prototype.compute=function(q,t,r,x,u){u||(u={near:0,far:0});q=h.length(q)-this._referenceEllipsoid.radius;q=Math.max(Math.abs(q-x),Math.abs(q));x=Math.sqrt(q*(q+2*(this._referenceEllipsoid.radius+Math.min(0,x))));q=b.clamp(2E4-(Math.log(q)-7.983)/9.011*19E3,1E3,2E4);return k(1.2*x,q,1,u)};return v}();const m=w.create(),z=w.create();a.createNearFarHeuristic=function(v,q,
t){return v===l.ViewingMode.Global?new d(t):new e(q,t)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../camera/constraintUtils ../camera/intersectionUtils ../camera/constraintUtils/surfaceCollision".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m){a.SurfaceCollisionConstraint=function(z){function v(t){t=z.call(this,t)||this;t.handles=new h;return t}b._inheritsLoose(v,z);var q=v.prototype;q.initialize=function(){this.handles.add(this.view.basemapTerrain.on("elevation-change",t=>this._handleElevationChangeEvent(t)))};q.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};q._handleElevationChangeEvent=function(t){this.view.state.cameraController||d.eyeWithinExtent(this.view,this.view.state.camera,
t.extent,t.spatialReference)&&this._applyToCurrentCamera()};q._applyToCurrentCamera=function(){this.view.state.updateCamera(t=>{m.applySurfaceCollisionConstraint(this.view,t,m.Mode.EYE_AND_CENTER)})};return v}(g);c.__decorate([w.property({constructOnly:!0})],a.SurfaceCollisionConstraint.prototype,"view",void 0);a.SurfaceCollisionConstraint=c.__decorate([k.subclass("esri.views.3d.state.ElevationCollisionConstraint")],a.SurfaceCollisionConstraint);a.default=a.SurfaceCollisionConstraint;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/state/GoToOperation":function(){define("exports ../../../Camera ../../../Viewpoint ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/watchUtils ../camera/constraintUtils ./controllers/CameraController ./controllers/PointToPointAnimationController ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/viewpointUtils ../camera/constraintUtils/surfaceCollision".split(" "),function(a,b,c,g,h,w,n,f,
l,k,e,d,m,z){let v=function(){function q(r,x,u){this.target=r;this.options=x;this.view=u;this.state="pending";this.animationController=this.abortController=null;this.promise=new Promise((E,y)=>{this.resolveCallback=E;this.rejectCallback=y;E=new AbortController;if(h.isSome(this.options.signal))w.onAbort(this.options.signal,()=>{this.abort()});this.abortController=E;this.waitForReady()})}var t=q.prototype;t.then=function(r,x){return this.promise.then(r,x)};t.catch=function(r){return this.promise.catch(r)};
t.resolve=function(r){this.state="finished";return this.resolveCallback(r)};t.reject=function(r){this.state="finished";return this.rejectCallback(r)};t.abort=function(r=!1){switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":this.reject(w.createAbortError());break;case "wait-for-animation-finish":!r&&h.isSome(this.animationController)&&this.view.state.cameraController===this.animationController&&this.animationController.active&&this.animationController.stopController(),
this.reject(w.createAbortError())}};t.waitForReady=function(){this.state="wait-for-ready";this.view.ready?this.createViewPoint():n.whenOnce(this.view,"ready",this.abortController.signal).then(()=>{this.createViewPoint()},r=>{this.reject(r)})};t.createViewPoint=function(){"finished"!==this.state&&(this.state="wait-for-viewpoint",this.animationController=this.options.animate?this._getAnimationController():null,m.create(this.view,this.target,this.abortController.signal).then(r=>{"finished"!==this.state&&
(r=this._getCameraFromViewpoint(r),h.isNone(r)||(this.options.animate?h.isNone(this.animationController)||this.startAnimation(r,this.animationController):(this.view.stateManager.setStateCamera(r.camera,{applyConstraints:!r.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve())))},r=>{this.reject(r)}))};t._getCameraFromViewpoint=function(r){const x=!!(this.target instanceof c&&this.target.camera||this.target instanceof b);var u=r.camera;if(h.isNone(u))return null;
if(!this.view.stateManager.isCompatible(u))return r=(r=u.position)&&r.spatialReference,this.reject(new g("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${r?r.wkid:"none"}, view: ${this.view.spatialReference.wkid})`,{camera:u})),null;u=d.externalToInternal(this.view,u);return h.isNone(u)?(this.reject(new g("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:r,camera:u,isFullySpecified:x}};t.startAnimation=function(r,
x){this.state="wait-for-animation-finish";const u=x.viewAnimation;if(h.isNone(u))this.reject(new g("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));else{u.update(r.viewpoint,"running");if(!x.active||h.isNone(x.viewAnimation)||x.viewAnimation.target!==r.viewpoint||this.view.state.cameraController!==x)return this.abort();if(r.isFullySpecified){var E=new e.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:r.camera});z.applySurfaceCollisionConstraint(this.view,
r.camera,z.Mode.EYE_AND_CENTER)}else f.applyAll(this.view,r.camera);x.begin(r.camera,this.options);var y=A=>{if(!h.isNone(this.view.state))switch(x.state){case l.State.Finished:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.resolve()}break;case l.State.Ready:case l.State.Rejected:case l.State.Running:case l.State.Stopped:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.reject(A)}}};
u.when(()=>{const A=this.view.state.cameraController;E&&(A&&A.active?A instanceof k.PointToPointAnimationController&&h.isSome(A.viewAnimation)&&A.viewAnimation.target===r.viewpoint&&(this.view.state.cameraController=E):h.isSome(x.viewAnimation)&&x.viewAnimation.target===r.viewpoint&&"finished"===x.state&&(this.view.state.cameraController=E))},A=>y(A));x.asyncResult={resolve:()=>y(),reject:A=>y(A)}}};t._getAnimationController=function(){let r;var x=null;x=this.view.state.cameraController;x instanceof
k.PointToPointAnimationController&&(x.updateStateFromViewAnimation(),x.active&&(r=x,x=r.viewAnimation));return null!=r||(r=new k.PointToPointAnimationController({view:this.view,mode:"animation"}),x=r.viewAnimation,this.view.state.switchCameraController(r))?r:(h.isSome(x)&&x.stop(),this.reject(new g("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)};return q}();a.GoToOperation=v;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Handles ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../camera/constraintUtils ../../camera/intersectionUtils ./CameraController ../../camera/constraintUtils/surfaceCollision".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m){a.SurfaceCollisionCorrectionController=function(z){function v(t){t=z.call(this,t)||this;t.handles=new g;return t}b._inheritsLoose(v,z);var q=v.prototype;q.onControllerStart=function(){this.state=d.State.Running;this.handles.add(this.view.basemapTerrain.on("elevation-change",t=>this._handleElevationChangeEvent(t)));this._applyCorrection()};q.onControllerEnd=function(){this.handles.removeAll()};q.stepController=function(){};q._handleElevationChangeEvent=function(t){e.eyeWithinExtent(this.view,
this.desiredCamera,t.extent,t.spatialReference)&&this._applyCorrection()};q._applyCorrection=function(){this.view.state.updateCamera(t=>{t.copyViewFrom(this.desiredCamera);m.applySurfaceCollisionConstraint(this.view,t,m.Mode.EYE_AND_CENTER)||this.constraintEnabled||(this.state=d.State.Stopped)})};b._createClass(v,[{key:"desiredCamera",set:function(t){this._set("desiredCamera",t.clone())}},{key:"canStop",get:function(){return!0}},{key:"constraintEnabled",get:function(){return this.view.state.constraints.collision.enabled}}]);
return v}(d.CameraController);c.__decorate([h.property({constructOnly:!0})],a.SurfaceCollisionCorrectionController.prototype,"view",void 0);c.__decorate([h.property({constructOnly:!0})],a.SurfaceCollisionCorrectionController.prototype,"desiredCamera",null);a.SurfaceCollisionCorrectionController=c.__decorate([l.subclass("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],a.SurfaceCollisionCorrectionController);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/viewpointUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Camera ../../../geometry ../../../Graphic ../../../Viewpoint ../../../core/asyncUtils ../../../core/has ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ./cameraUtils ./ElevationProvider ./mathUtils ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/Extent ../../../geometry/Geometry".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G){function L(ma){return 360-B.cyclicalDeg.normalize(ma)}function H(ma){return B.cyclicalDeg.normalize(360-ma)}function M(ma){k.isSome(ma)&&ma.resolver&&ma.resolver.reject();return null}function K(ma,ra,va,Ia=null){if(!ra)return M(Ia);var Ja=ma.spatialReference||C.WGS84;if(k.isSome(ra.camera)){ma=E.project(ra.camera.position,Ja);if(k.isNone(ma))return M(Ia);ra=ra.camera.clone();ra.position=ma;ma=ra;k.isSome(Ia)&&Ia.resolver&&Ia.resolver.resolve(ma);
return ma}if(k.isNone(ra.targetGeometry))return M(Ia);var Ha=ra.get("targetGeometry.spatialReference");if(Ha&&!E.canProject(Ha,Ja))return M(Ia);Ja=A.internalToExternal(ma,ma.state.camera);Ha=A.OrientationMode.ADJUST;null!=ra.rotation&&(Ja.heading=L(ra.rotation),Ha=A.OrientationMode.LOCKED);null!=va&&(Ja.tilt=va);if("point"===ra.targetGeometry.type){const Ta=ra.targetGeometry;va=ra.targetGeometry.clone();ra=null!=ra.scale?A.scaleToDistance(ma,ra.scale,Ta.latitude):ma.state.camera.distance;return A.fromCenterDistance(ma,
va,ra,Ja,Ha,Ia)}return A.fromExtent(ma,ra.targetGeometry.extent,Ja.heading,Ja.tilt,Ha,Ia)}function I(){I=b._asyncToGenerator(function*(ma,ra,va){if(ra&&ma.spatialReference){var Ia={target:null};if("declaredClass"in ra||Array.isArray(ra))Ia.target=ra;else{for(var Ja in ra)Ia[Ja]=ra[Ja];ra.center&&!Ia.target&&(Ia.target=ra.center)}ra=Ia}else ra=null;if(!ra)throw new l("viewpointutils-create:no-target","Missing target for creating viewpoint");Ia=new c({fov:ma.camera.fov});Ja=new w({camera:Ia});if(ra.target instanceof
w)return ma=yield V(ma,ra.target,ra,va,Ja),fa(ma);if(ra.target instanceof c)return fa(U(ma,ra.target,Ja));var Ha=null!=ra.scale||null!=ra.zoom;if(ra.target instanceof F){var Ta=ra.target.xmin===ra.target.xmax||ra.target.ymin===ra.target.ymax;return Ha||Ta?fa(yield aa(ma,ra,ra.target.center,Ia,va,Ja)):fa(yield ja(ma,ra,ra.target,Ia,va,Ja))}Ta={boundingBox:r.empty(),hasZ:!1,screenSpaceObjects:[]};var db=Ha?A.scaleToResolution(ma,O(ma,ra)):void 0;yield S(ma,ra.target,db,Ta);if(isFinite(Ta.boundingBox[0])){r.center(Ta.boundingBox,
ba);qa.x=ba[0];qa.y=ba[1];qa.z=ba[2];qa.spatialReference=ma.spatialReference;isFinite(qa.z)&&Ta.hasZ?db=r.isPoint(Ta.boundingBox):(qa.z=void 0,db=x.isPoint(r.toRect(Ta.boundingBox,pa)));if(Ha||db)return fa(yield aa(ma,ra,qa,Ia,va,Ja));Ha=Ta.screenSpaceObjects;if(Ha.length){db=Number.NEGATIVE_INFINITY;for(let fb=0;fb<Ha.length;fb++){const ka=Ha[fb].screenSpaceBoundingRect;db=Math.max(db,Math.abs(ka[0]),Math.abs(ka[1]),Math.abs(ka[2]),Math.abs(ka[3]))}Ha=.66-db/Math.min(ma.width,ma.height)*2}else Ha=
.66;return fa(yield ia(ma,ra,qa,Ta.boundingBox,Ha,Ia,va,Ja))}return ra.position?(va=y.cameraOnContentAlongViewDirection(ma),v.copy(xa,va.viewForward),A.directionToHeadingTilt(ma,va.eye,xa,va.up,Fa),Ia.position=new D(ra.position),Ia.heading=null!=ra.heading?ra.heading:Fa.heading,Ia.tilt=null!=ra.tilt?ra.tilt:Fa.tilt,ma=J(ma,null,Ia,Ja),fa(ma)):fa(yield Y(ma,ra,Ia,va,Ja))});return I.apply(this,arguments)}function O(ma,ra){return null==ra.scale&&null!=ra.zoom?A.zoomToScale(ma,ra.zoom):ra.scale}function Q(ma,
ra){let va=!1;null!=ra.heading?(ma.heading=ra.heading,va=!0):null!=ra.rotation&&(ma.heading=L(ra.rotation),va=!0);null!=ra.tilt&&(ma.tilt=ra.tilt,va=!0);null!=ra.fov&&(ma.fov=ra.fov);return va}function J(ma,ra,va,Ia){const Ja=ma.spatialReference||C.WGS84;ra=k.isSome(ra)?ra:A.externalToInternal(ma,va);if(k.isNone(ra))return Ia;Ia.targetGeometry=t.projectVectorToPoint(ra.center,ma.renderSpatialReference,Ja);Ia.scale=A.computeScale(ma,ra);Ia.rotation=H(va.heading);Ia.camera=va;return Ia}function P(ma,
ra,va){if(ra){if(!E.canProject(ra.spatialReference,ma.spatialReference))throw new l("viewpointutils:incompatible-spatialreference",`Spatial reference (${ra.spatialReference?ra.spatialReference.wkid:"unknown"}) is incompatible with the view (${ma.spatialReference.wkid})`,{geometry:ra});var Ia=[];if(!ra.hasZ&&ma.basemapTerrain){switch(ra.type){case "point":var Ja=ra;break;case "multipoint":case "polyline":Ja=ra.extent.center;break;case "mesh":Ja=ra.origin;break;case "extent":Ja=ra.center;break;case "polygon":Ja=
ra.centroid}Ja&&E.canProject(Ja,ma.basemapTerrain.spatialReference)?ba[2]=k.unwrapOr(p.getElevationAtPoint(ma.elevationProvider,Ja),0):ba[2]=0}(0,sa[ra.type])(ra,Ta=>{Ia.push(Ta[0],Ta[1],Ta[2])},ba);var Ha=Ia.length/3;if(0!==Ha&&(Ja=Array(Ia.length),t.projectBuffer(Ia,ra.spatialReference,0,Ja,ma.spatialReference,0,Ha)))for(ra.hasZ&&(va.hasZ=!0),ma=0;ma<Ja.length;ma+=3)ra.hasZ?(ba[0]=Ja[ma+0],ba[1]=Ja[ma+1],ba[2]=Ja[ma+2]):(ba[0]=Ja[ma+0],ba[1]=Ja[ma+1]),r.expandWithVec3(va.boundingBox,ba)}}function N(ma,
ra,va,Ia){return R.apply(this,arguments)}function R(){R=b._asyncToGenerator(function*(ma,ra,va,Ia){const Ja=yield n.result(ma.whenViewForGraphic(ra));if(!1!==Ja.ok&&!k.isNone(Ja.value)&&"whenGraphicBounds"in Ja.value)if(va=yield n.result(Ja.value.whenGraphicBounds(ra,{minDemResolution:va})),!1===va.ok)P(ma,ra.geometry,Ia);else{var {screenSpaceObjects:Ha,boundingBox:Ta}=va.value;r.expandWithAABB(Ia.boundingBox,Ta);Ha&&Ha.forEach(db=>{Ia.screenSpaceObjects.push(db)});isFinite(Ta[2])&&(Ia.hasZ=!0)}else P(ma,
ra.geometry,Ia)});return R.apply(this,arguments)}function S(ma,ra,va,Ia){return T.apply(this,arguments)}function T(){T=b._asyncToGenerator(function*(ma,ra,va,Ia){if(Array.isArray(ra)&&2===ra.length){const Ja=ra[0],Ha=ra[1];if("number"===typeof Ja&&"number"===typeof Ha){qa.x=Ja;qa.y=Ha;qa.z=void 0;qa.spatialReference=ma.spatialReference.isGeographic?ma.spatialReference:C.WGS84;P(ma,qa,Ia);return}}ra&&"function"===typeof ra.map?yield e.eachAlways(ra.map(Ja=>S(ma,Ja,va,Ia))):ra instanceof G?P(ma,ra,
Ia):ra instanceof h&&(yield N(ma,ra,va,Ia))});return T.apply(this,arguments)}function V(ma,ra,va,Ia,Ja){return W.apply(this,arguments)}function W(){W=b._asyncToGenerator(function*(ma,ra,va,Ia,Ja){if(k.isSome(ra.camera))return U(ma,ra.camera,Ja);Ja.scale=ra.scale;Ja.rotation=ra.rotation;Ja.targetGeometry=k.isSome(ra.targetGeometry)?ra.targetGeometry.clone():null;Ja.camera=null;null!=va.heading?Ja.rotation=H(va.heading):null!=va.rotation&&(Ja.rotation=va.rotation);ra=O(ma,va);null!=ra&&(Ja.scale=ra);
Ia=new A.AsyncContext(Ia);K(ma,Ja,va.tilt,Ia);Ja.camera=yield Ia.resolver.promise;return Ja});return W.apply(this,arguments)}function U(ma,ra,va){const Ia=E.project(ra.position,ma.spatialReference);if(k.isNone(Ia))return null;ra=ra.clone();ra.fov=ma.camera.fov;ra.position=Ia;return J(ma,null,ra,va)}function aa(ma,ra,va,Ia,Ja,Ha){return da.apply(this,arguments)}function da(){da=b._asyncToGenerator(function*(ma,ra,va,Ia,Ja,Ha){if(k.isNone(va))throw new l("createfromcenter","invalid point");Ha.targetGeometry=
va.clone();const Ta=y.cameraOnContentAlongViewDirection(ma);if(ra.position)return va=Ha.targetGeometry,Ja=ma.renderSpatialReference,t.projectPointToVector(ra.position,Da,Ja),t.projectPointToVector(va,ua,Ja),Ha.targetGeometry=new D(va),Ia.position=new D(ra.position),v.subtract(xa,ua,Da),A.directionToHeadingTilt(ma,Da,xa,Ta.up,Ia),Ha.scale=A.distanceToScale(ma,v.distance(Da,ua),Ha.targetGeometry.latitude),Ha.rotation=H(Ia.heading),Ha.camera=Ia,Ha;if(ra.zoomFactor){var db=Ta.distance/ra.zoomFactor;const fb=
v.scale(ba,Ta.viewForward,-db);Ta.eye=v.add(ba,Ta.center,fb);Ha.scale=A.distanceToScale(ma,db,va.latitude)}A.internalToExternal(ma,Ta,Ia);db=Q(Ia,ra)?A.OrientationMode.LOCKED:A.OrientationMode.ADJUST;ra.zoomFactor||(Ha.scale=O(ma,ra),null==Ha.scale&&(t.projectPointToVector(va,ba,ma.renderSpatialReference),u.intersectsPoint(Ta.frustum,ba)?Ha.scale=A.distanceToScale(ma,v.distance(Ta.eye,ba),va.latitude):Ha.scale=A.computeScale(ma,Ta)),ra=new A.AsyncContext(Ja),A.fromCenterScale(ma,Ha.targetGeometry,
Ha.scale,Ia,db,ra),Ha.camera=yield ra.resolver.promise);return Ha});return da.apply(this,arguments)}function Y(ma,ra,va,Ia,Ja){return ea.apply(this,arguments)}function ea(){ea=b._asyncToGenerator(function*(ma,ra,va,Ia,Ja){var Ha=y.cameraOnContentAlongViewDirection(ma);Ha=t.projectVectorToPoint(Ha.center,ma.renderSpatialReference,ma.spatialReference);return aa(ma,ra,Ha,va,Ia,Ja)});return ea.apply(this,arguments)}function ja(ma,ra,va,Ia,Ja,Ha){return la.apply(this,arguments)}function la(){la=b._asyncToGenerator(function*(ma,
ra,va,Ia,Ja,Ha){Ha.targetGeometry=va.clone();const Ta=y.cameraOnContentAlongViewDirection(ma);A.internalToExternal(ma,Ta,Ia);ra=Q(Ia,ra)?A.OrientationMode.LOCKED:A.OrientationMode.ADJUST;Ja=new A.AsyncContext(Ja);A.fromExtent(ma,va,Ia.heading,Ia.tilt,ra,Ja);Ha.camera=yield Ja.resolver.promise;return Ha});return la.apply(this,arguments)}function ia(ma,ra,va,Ia,Ja,Ha,Ta,db){return ca.apply(this,arguments)}function ca(){ca=b._asyncToGenerator(function*(ma,ra,va,Ia,Ja,Ha,Ta,db){db.targetGeometry=va.clone();
const fb=y.cameraOnContentAlongViewDirection(ma);var ka=0;va.hasZ?ka=va.z:ma.basemapTerrain&&(ka=k.unwrap(p.getElevationAtPoint(ma.elevationProvider,va)));v.set(ba,va.x,va.y,ka);t.computeTranslationToOriginAndRotation(ma.spatialReference,ba,Z,ma.renderSpatialReference);d.fromMat4(ha,Z);d.transpose(ha,ha);r.empty(na);va=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(var cb=0;cb<va.length;cb++){const Ca=va[cb];let Ka=Ia[Ca[2]];isFinite(Ka)||(Ka=ka);v.set(ba,Ia[Ca[0]],Ia[Ca[1]],
Ka);t.projectVectorToVector(ba,ma.spatialReference,ba,ma.renderSpatialReference);r.expandWithVec3(na,v.transformMat3(ba,ba,ha))}Ia=r.width(na);ka=r.height(na);va=r.depth(na);cb=1/Math.tan(fb.fovY/2);Ja=Math.max(.5*Math.sqrt(Ia*Ia+va*va)*Math.max(cb,1/Math.tan(fb.fovX/2))+.5*ka,.5*ka*cb+.5*Math.max(Ia,va))/Ja;A.internalToExternal(ma,fb,Ha);ra=Q(Ha,ra)?A.OrientationMode.LOCKED:A.OrientationMode.ADJUST;db.scale=A.distanceToScale(ma,Ja,db.targetGeometry.latitude);Ta=new A.AsyncContext(Ta);A.fromCenterScale(ma,
db.targetGeometry,db.scale,Ha,ra,Ta);db.camera=yield Ta.resolver.promise;return db});return ca.apply(this,arguments)}function fa(ma){ma&&k.isSome(ma.camera)&&(ma.rotation=H(ma.camera.heading));return ma}const ba=q.create(),Z=z.create(),ha=m.create(),na=r.create(),pa=x.create(),xa=q.create(),Da=q.create(),ua=q.create(),Fa={heading:0,tilt:0},qa=new D,sa={point(ma,ra,va){va[0]=ma.x;va[1]=ma.y;ma.hasZ&&(va[2]=ma.z);ra(va)},polygon(ma,ra,va){const Ia=ma.hasZ;for(let Ja=0;Ja<ma.rings.length;Ja++){const Ha=
ma.rings[Ja];for(let Ta=0;Ta<Ha.length;Ta++)va[0]=Ha[Ta][0],va[1]=Ha[Ta][1],Ia&&(va[2]=Ha[Ta][2]),ra(va)}},polyline(ma,ra,va){const Ia=ma.hasZ;for(let Ja=0;Ja<ma.paths.length;Ja++){const Ha=ma.paths[Ja];for(let Ta=0;Ta<Ha.length;Ta++)va[0]=Ha[Ta][0],va[1]=Ha[Ta][1],Ia&&(va[2]=Ha[Ta][2]),ra(va)}},multipoint(ma,ra,va){const Ia=ma.points;ma=ma.hasZ;for(let Ja=0;Ja<Ia.length;Ja++)va[0]=Ia[Ja][0],va[1]=Ia[Ja][1],ma&&(va[2]=Ia[Ja][2]),ra(va)},extent(ma,ra,va){ma.hasZ?(ra(v.set(va,ma.xmin,ma.ymin,ma.zmin)),
ra(v.set(va,ma.xmax,ma.ymin,ma.zmin)),ra(v.set(va,ma.xmin,ma.ymax,ma.zmin)),ra(v.set(va,ma.xmax,ma.ymax,ma.zmin)),ra(v.set(va,ma.xmin,ma.ymin,ma.zmax)),ra(v.set(va,ma.xmax,ma.ymin,ma.zmax)),ra(v.set(va,ma.xmin,ma.ymax,ma.zmax)),ra(v.set(va,ma.xmax,ma.ymax,ma.zmax))):(ra(v.set(va,ma.xmin,ma.ymin,va[2])),ra(v.set(va,ma.xmax,ma.ymin,va[2])),ra(v.set(va,ma.xmin,ma.ymax,va[2])),ra(v.set(va,ma.xmax,ma.ymax,va[2])))},mesh(ma,ra,va){if(ma=ma.vertexAttributes&&ma.vertexAttributes.position)for(let Ia=0;Ia<
ma.length;Ia+=3)ra(v.set(va,ma[Ia+0],ma[Ia+1],ma[Ia+2]))}};a.create=function(ma,ra,va){return I.apply(this,arguments)};a.fromCamera=function(ma,ra,va=null){k.isNone(va)&&(va=new w);return J(ma,null,ra.clone(),va)};a.headingToRotation=H;a.rotationToHeading=L;a.toCamera=K;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/state/helpers/SceneIntersectionHelper":function(){define("exports ../../../../core/maybe ../../../../core/PooledArray ../../../../core/screenUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ../../../../geometry/support/vectorStacks ../../../ViewingMode ../../support/geometryUtils/ray ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/intersectorUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m){function z(u){q&&q.viewingMode===u||(q=e.newIntersector(u));return q}let v=function(){function u(y,A,p){this.viewingMode=y;this._forEachLayer=A;this.view=p;this.externalIntersectionHandlers=new c;this.tolerance=e.DEFAULT_TOLERANCE;this.tmpRay=n.create();this.validateHUDIntersector=e.newIntersector(this.viewingMode);this.validateHUDIntersector.options.hud=!1}var E=u.prototype;E.intersectScreen=function(y,A){return this.intersectRay(this._getPickRay(y,this.tmpRay),
z(this.viewingMode),A)};E.intersectScreenFreePointFallback=function(y,A){return this.intersectRayFreePointFallback(this._getPickRay(y,this.tmpRay),A)};E.intersectRayFreePointFallback=function(y,A){return this.intersectRay(y,z(this.viewingMode),A)||this._intersectRayFreePointLocal(y,A)};E.intersectRay=function(y,A,p,B){A.options.selectionMode=!1;A.options.store=d.StoreResults.MIN;this.computeIntersection(y,A,B);return A.results.min?A.results.min.getIntersectionPoint(p):!1};E.getCenterRayWithSubpixelOffset=
function(y,A,p=.5,B=.5){y.getRenderCenter(x,p,B);x[0]+=.0466;x[1]-=.0123;return k.fromRenderAtEye(y,x,A)};E.intersectIntersectorScreen=function(y,A,p){this.computeIntersection(this._getPickRay(y,this.tmpRay),A,p)};E.intersectToolIntersectorScreen=function(y,A,p){y=this._getPickRay(y,this.tmpRay);this.intersectToolIntersectorRay(y,A,p)};E.intersectToolIntersectorRay=function(y,A,p){A.options.selectionMode=!0;this.computeIntersection(y,A,p);const B=A.results.min;this.view.basemapTerrain&&this.view.basemapTerrain.opaque||
m.isValidIntersectorResult(B)&&B.intersector!==d.IntersectorType.TERRAIN||(A.options.selectionMode=!1,this.computeIntersection(y,A,p))};E.setTolerance=function(y=e.DEFAULT_TOLERANCE){this.tolerance=y};E.addIntersectionHandler=function(y){this.externalIntersectionHandlers.push(y);this.externalIntersectionHandlers.sort((A,p)=>A.type===d.IntersectorType.TERRAIN?1:p.type===d.IntersectorType.TERRAIN?-1:0)};E.removeIntersectionHandler=function(y){this.externalIntersectionHandlers.removeUnordered(y);this.externalIntersectionHandlers.sort((A,
p)=>A.type===d.IntersectorType.TERRAIN?1:p.type===d.IntersectorType.TERRAIN?-1:0)};E._getPickRay=function(y,A){return k.fromScreen(this.view.state.camera,y,A)};E._intersectRayFreePointLocal=function(y,A){if(this.viewingMode!==l.ViewingMode.Local||b.isNone(y))return!1;var p=this.view.renderDataExtent;if(b.isNone(p))return h.add(A,y.origin,h.normalize(f.sv3d.get(),y.direction)),!0;var B=Math.max(p.xmax-p.xmin,p.ymax-p.ymin,8*Math.max(p.xmax-p.xmin,p.ymax-p.ymin));if(0===B)return h.add(A,y.origin,h.normalize(f.sv3d.get(),
y.direction)),!0;var D=this.view.state.camera;const C=Math.max(0,p.xmin-D.eye[0],D.eye[0]-p.xmax);p=Math.max(0,p.ymin-D.eye[1],D.eye[1]-p.ymax);D=B/Math.max(1,Math.max(0,Math.log(B/(Math.abs(D.relativeElevation)+Number.MIN_VALUE)))**2);D=Math.max(D,Math.min(Math.sqrt(C*C+p*p),B));B=h.scale(f.sv3d.get(),y.direction,D/h.length(y.direction));h.add(A,y.origin,B);return!0};E.intersectElevationFromScreen=function(y,A,p=0,B=null){return this._intersectElevation(this._getPickRay(y,this.tmpRay),A,p,B)};E._intersectElevation=
function(y,A,p=0,B=null){if(b.isNone(y))return null;var D=b.isSome(A)?A.mode:"absolute-height",C=b.isSome(A)?b.unwrapOr(A.offset,0):0,F="on-the-ground"!==D?C+p:0;A=F/this.view.renderCoordsHelper.unitInMeters;if("absolute-height"===D)return this.view.renderCoordsHelper.intersectInfiniteManifold(y,F,r)?(p=this.view.computeMapPointFromVec3d(r),p.z-=C,p):null;C=this.view.state.camera;const G=g.castRenderScreenPointArray3(f.sv3d.get());C.projectToRenderScreen(y.origin,G);F=new t(null,this._forEachLayer);
const L=this.view.slicePlane,H=b.isSome(L)?m.sliceFilterPredicate(L):null,M=e.newIntersector(this.viewingMode);M.options.store=d.StoreResults.MIN;M.options.verticalOffset=A;A=y.origin;y=h.add(f.sv3d.get(),A,y.direction);M.reset(A,y,C);M.point=G;const K=b.isSome(B)?"type"in B&&"graphics"===B.type?I=>I.metadata.layerUid!==B.uid:I=>I.metadata.graphicUid!==B.uid:null;switch(D){case "relative-to-scene":M.intersect(F.layers,G,this.tolerance,null,I=>(b.isNone(K)||K(I))&&I.metadata&&I.metadata.isElevationSource);
this.externalIntersectionHandlers.forAll(I=>{I.type!==d.IntersectorType.I3S&&I.type!==d.IntersectorType.TERRAIN||I.intersect(M,I.slicePlaneEnabled?H:null,M.rayBegin,M.rayEnd,G)});break;case "on-the-ground":case "relative-to-ground":this.externalIntersectionHandlers.forAll(I=>{I.isGround&&I.intersect(M,I.slicePlaneEnabled?H:null,M.rayBegin,M.rayEnd,G)})}return M.results.min.getIntersectionPoint(r)?(D=this.view.computeMapPointFromVec3d(r),D.z=p,D):null};E.computeIntersection=function(y,A,p){if(!b.isNone(y)){var B=
this.view.state.camera,D=g.castRenderScreenPointArray3(f.sv3d.get());B.projectToRenderScreen(y.origin,D);var C=new t(p,this._forEachLayer);A.options.selectOpaqueTerrainOnly=!p||!("include"in p||"exclude"in p);var F=y.origin,G=h.add(f.sv3d.get(),y.origin,y.direction);A.reset(F,G,B);A.intersect(C.layers,D,this.tolerance);y=this.view.slicePlane;var L=b.isSome(y)?m.sliceFilterPredicate(y):null;A.intersect(C.sliceableLayers,D,this.tolerance,L);var H=p&&(p.requiresGroundFeedback||p.enableDraped);this.externalIntersectionHandlers.forAll(M=>
{A.options.isFiltered=!C.filterLayerUid(M.layerUid);(M.isGround&&H||!A.options.isFiltered)&&M.intersect(A,M.slicePlaneEnabled?L:null,F,G,D)});y=f.sv3d.get();if(p&&p.enableDraped&&A.results.ground.getIntersectionPoint(y)){p=this.view.basemapTerrain.overlayManager.renderer;const M=this.view.renderCoordsHelper.spatialReference,K=f.sv3d.get();this.view.renderCoordsHelper.fromRenderCoords(y,K,this.view.spatialReference);K[2]=b.unwrapOr(this.view.elevationProvider.getElevation(y[0],y[1],y[2],M,"ground"),
0);p.intersect(A,K,A.results.ground,I=>C.filterRenderGeometry(I))}A.sortResults();y=A.results.hud;if(m.isHudIntersectorResult(y)){const M=g.castRenderScreenPointArray3(f.sv3d.get()),K=f.sv3d.get(),I=f.sv3d.get();this._unprojectHUDResultRay(y.target.center,M,K,I);p=h.distance(y.target.center,K)/h.distance(K,I)*.99;this.validateHUDIntersector.reset(K,I,B);this.validateHUDIntersector.intersect(C.layers,M,this.tolerance);this.validateHUDIntersector.intersect(C.sliceableLayers,M,this.tolerance,L);this.externalIntersectionHandlers.forAll(O=>
{C.filterLayerUid(O.layerUid)&&O.intersect(this.validateHUDIntersector,O.slicePlaneEnabled?L:null,K,I,M)});B=this.validateHUDIntersector.results.min;if(null==B.dist||p<=B.dist)A.results.min.copy(y),A.results.all.splice(0,0,y)}}};E._unprojectHUDResultRay=function(y,A,p,B){const D=this.view.state.camera;D.projectToRenderScreen(y,A);y=g.castRenderScreenPointArray3(f.sv3d.get());y[0]=A[0];y[1]=A[1];y[2]=0;D.unprojectFromRenderScreen(y,p);y[2]=1;D.unprojectFromRenderScreen(y,B)};return u}(),q,t=function(){function u(y,
A){this.layers=[];this.sliceableLayers=[];this.include=null==y?void 0:y.include;this.exclude=null==y?void 0:y.exclude;A(p=>{p.isPickable&&this.filterLayerUid(p.apiLayerUid)&&(p.isSliceable?this.sliceableLayers:this.layers).push(p)})}var E=u.prototype;E.filterLayerUid=function(y){const {include:A,exclude:p}=this;return b.isNone(y)?null==A&&null==p:(null==A||A.has(y))&&(null==p||!p.has(y))};E.filterRenderGeometry=function(y){return this.filterLayerUid(y.layerUid)};return u}();const r=w.create(),x=g.createRenderScreenPointArray3();
a.SceneIntersectionHelper=v;a.isIntersectionHandler=function(u){return"object"===typeof u&&"intersect"in u};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/CombinedElevationProvider":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../layers/graphics/ElevationQuery".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m){function z(v,q,t,r,x,u,E){for(const y of q)q=y.getElevation(t,r,x,u,E),w.isSome(q)&&(v=w.isSome(v)?Math.max(q,v):q);return v}a.CombinedElevationProvider=function(v){function q(r){r=v.call(this,r)||this;r.im=[];r.ground=[];r.scene=[];r.handles=new Map;r.lastElevationQuery=null;r.elevationCacheEnabled=!1;return r}b._inheritsLoose(q,v);var t=q.prototype;t.destroy=function(){this._elevationQuery=w.destroyMaybe(this._elevationQuery)};t.enableElevationCache=function(r){r||
(this.lastElevationQuery=null);this.elevationCacheEnabled=r};t.getElevation=function(r,x,u,E,y){if(this.elevationCacheEnabled&&null!=this.lastElevationQuery){var A=this.lastElevationQuery;if(r===A.x&&x===A.y&&u===A.z&&E.equals(A.spatialReference)&&y===A.queryContext)return A.result}A=z(null,this.im,r,x,u,E,y);w.isNone(A)&&(A=z(A,this.ground,r,x,u,E,y));"scene"===y&&(A=z(A,this.scene,r,x,u,E,y));this.elevationCacheEnabled&&(this.lastElevationQuery={x:r,y:x,z:u,spatialReference:E,queryContext:y,result:A});
return A};t.queryElevation=function(r,x,u,E,y,A=null,p=0){const B=n.createResolver();this.elevationQuery.queryElevation(r,x,A,p).then(D=>{"scene"===y&&(D=z(D,this.scene,r,x,u,E,y));B.resolve(D)}).catch(D=>{n.isAbortError(D)?B.reject(D):B.resolve(this.getElevation(r,x,u,E,y))});return B.promise};t.register=function(r,x){this.handles.set(x,x.on("elevation-change",u=>this.emit("elevation-change",u)));this[r].push(x)};t.unregister=function(r){this.handles.has(r)&&(this.handles.get(r).remove(),this.handles.delete(r));
for(const x of[this.im,this.ground,this.scene]){const u=x.indexOf(r);-1<u&&x.splice(u,1)}};b._createClass(q,[{key:"elevationQuery",get:function(){w.isNone(this._elevationQuery)&&(this._elevationQuery=new m.ElevationQuery(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4}));return this._elevationQuery}}]);return q}(h.EventedMixin(g));c.__decorate([f.property({constructOnly:!0})],a.CombinedElevationProvider.prototype,
"view",void 0);c.__decorate([f.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],a.CombinedElevationProvider.prototype,"spatialReference",void 0);a.CombinedElevationProvider=c.__decorate([d.subclass("esri.views.3d.support.CombinedElevationProvider")],a.CombinedElevationProvider);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../core/arrayUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../support/Scheduler ../../../../geometry/Multipoint".split(" "),
function(a,b,c,g,h,w,n,f){c=function(){function k(d,m){this.spatialReference=d;this.view=m}var e=k.prototype;e.getElevation=function(d,m,z){return this.view.elevationProvider.getElevation(d,m,0,this.spatialReference,z)};e.queryElevation=function(){var d=b._asyncToGenerator(function*(m,z,v,q,t){return this.view.elevationProvider.queryElevation(m,z,0,this.spatialReference,t,v,q)});return function(m,z,v,q,t){return d.apply(this,arguments)}}();return k}();let l=function(){function k(d,m,z,v){this.spatialReference=
m;this._getElevationQueryProvider=z;this._queries=[];this._queryOptions={...v,ignoreInvisibleLayers:!0};this._frameTask=d.registerTask(n.TaskPriority.ELEVATION_QUERY,this)}var e=k.prototype;e.destroy=function(){this._frameTask.remove()};e.queryElevation=function(d,m,z,v=0){return new Promise((q,t)=>{const r={x:d,y:m,minDemResolution:v,result:{resolve:q,reject:t},signal:z};this._queries.push(r);w.onAbort(z,()=>{g.remove(this._queries,r);t(w.createAbortError())})})};e.runTask=function(){const d=this._queries;
this._queries=[];const m=this._getElevationQueryProvider();if(m){var z=d.map(r=>[r.x,r.y]),v=d.reduce((r,x)=>Math.min(r,x.minDemResolution),Infinity);z=new f({points:z,spatialReference:this.spatialReference});var q=1<d.length&&d.some(r=>!!r.signal)?new AbortController:null,t=h.isSome(q)?q.signal:d[0].signal;if(h.isSome(q)){let r=0;d.forEach(x=>w.onAbort(x.signal,()=>{r++;x.result.reject(w.createAbortError());r===d.length&&q.abort()}))}m.queryElevation(z,{...this._queryOptions,minDemResolution:v,signal:t}).then(r=>
{d.forEach((x,u)=>{h.isSome(x.signal)&&x.signal.aborted?x.result.reject(w.createAbortError()):x.result.resolve(r.geometry.points[u][2])})}).catch(r=>{d.forEach(x=>x.result.reject(r))})}else d.forEach(r=>r.result.reject())};b._createClass(k,[{key:"running",get:function(){return 0<this._queries.length}},{key:"test",get:function(){const d=this;return{update:()=>0<d._queries.length&&d.runTask()}}}]);return k}();a.ElevationQuery=l;a.ViewElevationProvider=c;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/support/DisplayQualityProfile":function(){define(["../../../core/has"],function(a){function b(){const g=!!a("esri-mobile"),h=!!a("ios");return{low:{graphics3D:{maxTotalNumberOfFeatures:25E3,maxTotalNumberOfPrimitives:85E4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25E3},sceneService:{"3dObject":{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},
pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5,polygonLodFactor:g?.8:1,polylineLodFactor:g?1.2:1.5,snapshotAvailable:!h},
heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5E4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:g},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!a("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,
memoryLimit:g?600:750,additionalCacheMemory:g?0:150,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5,polygonLodFactor:g?1.2:2,polylineLodFactor:g?1.2:2,snapshotAvailable:!h},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5E4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},
uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!a("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:g?900:1500,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:g?null:4096,maximumPixelRatio:g?1:null}}}let c=function(){function g(){}g.isValidProfile=function(h){return h in g.profiles};g.getDefaultProfile=function(){return a("trident")||
a("esri-iPhone")?"low":"medium"};g.apply=function(h,w){h=g.profiles[h];w.graphics3D.maxTotalNumberOfFeatures=h.graphics3D.maxTotalNumberOfFeatures;w.graphics3D.maxTotalNumberOfPrimitives=h.graphics3D.maxTotalNumberOfPrimitives;w.graphics3D.polygonLodFactor=h.graphics3D.polygonLodFactor;w.graphics3D.polylineLodFactor=h.graphics3D.polylineLodFactor;w.graphics3D.snapshotAvailable=h.graphics3D.snapshotAvailable;{const n=w.sceneService["3dObject"],f=h.sceneService["3dObject"];n.lodFactor=f.lodFactor;n.lodCrossfadeinDuration=
f.lodCrossfadeinDuration;n.lodCrossfadeoutDuration=f.lodCrossfadeoutDuration;n.lodCrossfadeUncoveredDuration=f.lodCrossfadeUncoveredDuration}w.sceneService.point.lodFactor=h.sceneService.point.lodFactor;w.sceneService.integratedMesh.lodFactor=h.sceneService.integratedMesh.lodFactor;w.sceneService.pointCloud.lodFactor=h.sceneService.pointCloud.lodFactor;w.sceneService.uncompressedTextureDownsamplingEnabled=h.sceneService.uncompressedTextureDownsamplingEnabled;w.tiledSurface.lodBias=h.tiledSurface.lodBias;
w.tiledSurface.angledSplitBias=h.tiledSurface.angledSplitBias;w.tiledSurface.reduceTileLevelDifferences=h.tiledSurface.reduceTileLevelDifferences;w.tiledSurface.textureFadeDuration=h.tiledSurface.textureFadeDuration;w.heatmap.pixelRatio=h.heatmap.pixelRatio;w.heatmap.maxTotalNumberOfFeatures=h.heatmap.maxTotalNumberOfFeatures;w.antialiasingEnabled=h.antialiasingEnabled;w.physicallyBasedRenderingEnabled=h.physicalBasedRenderingEnabled;w.highQualityTransparency=h.highQualityTransparency;w.memoryLimit=
h.memoryLimit;w.additionalCacheMemory=h.additionalCacheMemory;w.frameRate=h.frameRate;w.maximumRenderResolution=h.maximumRenderResolution;w.maximumPixelRatio=h.maximumPixelRatio};return g}();c.debug={reset(){const g=b();for(const h in g)c.profiles[h]=g[h]}};(c||(c={})).profiles=b();return c})},"esri/views/3d/support/HighlightOptions":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec4f32".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){g=function(d){function m(){var z=d.apply(this,arguments)||this;z.color=new c([0,255,255]);z.haloColor=null;z.haloOpacity=1;z.fillOpacity=.25;z.shadowOpacity=.4;z.shadowColor=new c([0,0,0]);z.shadowDifference=.2;return z}a._inheritsLoose(m,d);m.toEngineOptions=function(z){const v=c.toUnitRGBA(z.color),q=h.isSome(z.haloColor)?c.toUnitRGBA(z.haloColor):v,t=c.toUnitRGBA(z.shadowColor);return{color:e.fromValues(v[0],v[1],v[2],v[3]),haloColor:e.fromValues(q[0],q[1],q[2],
q[3]),haloOpacity:z.haloOpacity,haloOpacityOccluded:.25*z.haloOpacity,fillOpacity:z.fillOpacity,fillOpacityOccluded:.25*z.fillOpacity,shadowOpacity:z.shadowOpacity,shadowColor:e.fromValues(t[0],t[1],t[2],t[3]),occludedShadowOpacity:z.shadowOpacity*(1-z.shadowDifference)}};return m}(g);b.__decorate([w.property({type:c})],g.prototype,"color",void 0);b.__decorate([w.property({type:c})],g.prototype,"haloColor",void 0);b.__decorate([w.property()],g.prototype,"haloOpacity",void 0);b.__decorate([w.property()],
g.prototype,"fillOpacity",void 0);b.__decorate([w.property()],g.prototype,"shadowOpacity",void 0);b.__decorate([w.property({type:c})],g.prototype,"shadowColor",void 0);b.__decorate([w.property()],g.prototype,"shadowDifference",void 0);return g=b.__decorate([k.subclass("esri.views.3d.support.HighlightOptions")],g)})},"esri/chunks/vec4f32":function(){define(["exports"],function(a){function b(){return new Float32Array(4)}function c(x){const u=new Float32Array(4);u[0]=x[0];u[1]=x[1];u[2]=x[2];u[3]=x[3];
return u}function g(x,u,E,y){const A=new Float32Array(4);A[0]=x;A[1]=u;A[2]=E;A[3]=y;return A}function h(x,u){return new Float32Array(x,u,4)}function w(){return b()}function n(){return g(1,1,1,1)}function f(){return g(1,0,0,0)}function l(){return g(0,1,0,0)}function k(){return g(0,0,1,0)}function e(){return g(0,0,0,1)}const d=b(),m=n(),z=f(),v=l(),q=k(),t=e(),r=Object.freeze({__proto__:null,create:b,clone:c,fromValues:g,createView:h,zeros:w,ones:n,unitX:f,unitY:l,unitZ:k,unitW:e,ZEROS:d,ONES:m,UNIT_X:z,
UNIT_Y:v,UNIT_Z:q,UNIT_W:t});a.ONES=m;a.UNIT_W=t;a.UNIT_X=z;a.UNIT_Y=v;a.UNIT_Z=q;a.ZEROS=d;a.clone=c;a.create=b;a.createView=h;a.fromValues=g;a.ones=n;a.unitW=e;a.unitX=f;a.unitY=l;a.unitZ=k;a.vec4f32=r;a.zeros=w})},"esri/views/3d/support/MapCoordsHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../core/Error ../../../core/unitUtils ../../../geometry/projectionEllipsoid ../../../portal/support/geometryServiceUtils ../../../rest/geometryService/project ../../../rest/support/ProjectParameters ../../../geometry/Point ../../../geometry/SpatialReference".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){c=function(){function d(m,z){this.spatialReference=z;this.unitInMeters=h.getMetersPerUnitForSR(this.spatialReference,w.getReferenceEllipsoid(this.spatialReference).metersPerDegree);this._geometryServiceURLPromise=n.getGeometryServiceURL(m&&m.get("portalItem")).catch(()=>{throw new g("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config");})}d.prototype.toGeographic=function(){var m=b._asyncToGenerator(function*(z){var v=yield this._geometryServiceURLPromise;
let q=!0;Array.isArray(z[0])&&"number"!==typeof z[0]||(z=[z],q=!1);z=z.map(t=>t instanceof k?t:new k(t,this.spatialReference));z=new l({geometries:z,outSpatialReference:e.WGS84});v=(yield f.project(v,z)).map(t=>"point"===t.type?[t.x,t.y]:void 0);return q?v:v[0]});return function(z){return m.apply(this,arguments)}}();return d}();a.MapCoordsHelper=c;a.default=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/portal/support/geometryServiceUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../config ../../core/Error ../Portal ../../rest/geometryService/project ../../rest/support/ProjectParameters".split(" "),
function(a,b,c,g,h,w,n){function f(){return l.apply(this,arguments)}function l(){l=b._asyncToGenerator(function*(e=null,d){var m,z;if(c.geometryServiceUrl)return c.geometryServiceUrl;if(!e)throw new g("internal:geometry-service-url-not-configured");e="portal"in e?e.portal||h.getDefault():e;yield e.load({signal:d});d=null==(m=e.helperServices)?void 0:null==(z=m.geometry)?void 0:z.url;if(!d)throw new g("internal:geometry-service-url-not-configured");return d});return l.apply(this,arguments)}function k(){k=
b._asyncToGenerator(function*(e,d,m=null,z){m=yield f(m,z);const v=new n;v.geometries=[e];v.outSpatialReference=d;if((e=yield w.project(m,v,{signal:z}))&&Array.isArray(e)&&1===e.length)return e[0];throw new g("internal:geometry-service-projection-failed");});return k.apply(this,arguments)}a.getGeometryServiceURL=f;a.projectGeometry=function(e,d){return k.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/geometryService/project":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils ../utils ./utils ../support/ProjectParameters".split(" "),
function(a,b,c,g,h,w,n,f){function l(){l=b._asyncToGenerator(function*(e,d,m){d=k(d);e=w.parseUrl(e);const z={...e.query,f:"json",...d.toJSON()},v=d.outSpatialReference,q=h.getJsonType(d.geometries[0]);d=w.asValidOptions(z,m);return c(e.path+"/project",d).then(({data:{geometries:t}})=>n.decodeGeometries(t,q,v))});return l.apply(this,arguments)}const k=g.ensureType(f);a.project=function(e,d,m){return l.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/geometryService/utils":function(){define(["exports",
"../../geometry/support/jsonUtils"],function(a,b){a.decodeGeometries=function(c,g,h){const w=b.getGeometryType(g);return c.map(n=>{n=w.fromJSON(n);n.spatialReference=h;return n})};a.encodeGeometries=function(c){return{geometryType:b.getJsonType(c[0]),geometries:c.map(g=>g.toJSON())}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/support/ProjectParameters":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils".split(" "),
function(a,b,c,g,h,w,n,f,l){c=function(k){function e(d){d=k.call(this,d)||this;d.geometries=null;d.outSpatialReference=null;d.transformation=null;d.transformForward=null;return d}a._inheritsLoose(e,k);e.prototype.toJSON=function(){const d=this.geometries.map(function(v){return v.toJSON()}),m=this.geometries[0],z={};z.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON());z.inSR=m.spatialReference.wkid||JSON.stringify(m.spatialReference.toJSON());z.geometries=JSON.stringify({geometryType:l.getJsonType(m),
geometries:d});this.transformation&&(z.transformation=this.transformation.wkid||JSON.stringify(this.transformation));null!=this.transformForward&&(z.transformForward=this.transformForward);return z};return e}(c.JSONSupport);b.__decorate([g.property()],c.prototype,"geometries",void 0);b.__decorate([g.property({json:{read:{source:"outSR"}}})],c.prototype,"outSpatialReference",void 0);b.__decorate([g.property()],c.prototype,"transformation",void 0);b.__decorate([g.property()],c.prototype,"transformForward",
void 0);return c=b.__decorate([f.subclass("esri.rest.support.ProjectParameters")],c)})},"esri/views/3d/support/QualitySettings":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,g,h,w,n,f){let l=function(v){function q(){var t=v.apply(this,
arguments)||this;t.minTotalNumberOfFeatures=2E3;t.maxTotalNumberOfFeatures=5E4;t.maxTotalNumberOfPrimitives=17E5;t.snapshotAvailable=!0;t.polygonLodFactor=1;t.polylineLodFactor=1;return t}a._inheritsLoose(q,v);return q}(c);b.__decorate([g.property()],l.prototype,"minTotalNumberOfFeatures",void 0);b.__decorate([g.property()],l.prototype,"maxTotalNumberOfFeatures",void 0);b.__decorate([g.property()],l.prototype,"maxTotalNumberOfPrimitives",void 0);b.__decorate([g.property()],l.prototype,"snapshotAvailable",
void 0);b.__decorate([g.property()],l.prototype,"polygonLodFactor",void 0);b.__decorate([g.property()],l.prototype,"polylineLodFactor",void 0);l=b.__decorate([f.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],l);let k=function(v){function q(){var t=v.apply(this,arguments)||this;t.lodFactor=1;return t}a._inheritsLoose(q,v);return q}(c);b.__decorate([g.property()],k.prototype,"lodFactor",void 0);k=b.__decorate([f.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],
k);let e=function(v){function q(){var t=v.apply(this,arguments)||this;t.lodCrossfadeinDuration=0;t.lodCrossfadeoutDuration=0;t.lodCrossfadeUncoveredDuration=0;return t}a._inheritsLoose(q,v);return q}(k);e=b.__decorate([f.subclass("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],e);let d=function(v){function q(){var t=v.apply(this,arguments)||this;t["3dObject"]=new e;t.point=new k;t.integratedMesh=new k;t.pointCloud=new k;t.uncompressedTextureDownsamplingEnabled=!1;return t}a._inheritsLoose(q,
v);return q}(c);b.__decorate([g.property({type:e})],d.prototype,"3dObject",void 0);b.__decorate([g.property({type:k})],d.prototype,"point",void 0);b.__decorate([g.property({type:k})],d.prototype,"integratedMesh",void 0);b.__decorate([g.property({type:k})],d.prototype,"pointCloud",void 0);b.__decorate([g.property()],d.prototype,"uncompressedTextureDownsamplingEnabled",void 0);d=b.__decorate([f.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],d);let m=function(v){function q(){var t=
v.apply(this,arguments)||this;t.lodBias=0;t.angledSplitBias=1;t.reduceTileLevelDifferences=!0;t.textureFadeDuration=500;return t}a._inheritsLoose(q,v);return q}(c);b.__decorate([g.property()],m.prototype,"lodBias",void 0);b.__decorate([g.property()],m.prototype,"angledSplitBias",void 0);b.__decorate([g.property()],m.prototype,"reduceTileLevelDifferences",void 0);b.__decorate([g.property()],m.prototype,"textureFadeDuration",void 0);m=b.__decorate([f.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],
m);let z=function(v){function q(){var t=v.apply(this,arguments)||this;t.pixelRatio=1;t.maxTotalNumberOfFeatures=5E4;return t}a._inheritsLoose(q,v);return q}(c);b.__decorate([g.property()],z.prototype,"pixelRatio",void 0);b.__decorate([g.property()],z.prototype,"maxTotalNumberOfFeatures",void 0);z=b.__decorate([f.subclass("esri.views.3d.support.QualitySettings.HeatmapSettings")],z);c=function(v){function q(){var t=v.apply(this,arguments)||this;t.graphics3D=new l;t.sceneService=new d;t.tiledSurface=
new m;t.heatmap=new z;t.antialiasingEnabled=!0;t.physicallyBasedRenderingEnabled=!1;t.highQualityTransparency=!0;return t}a._inheritsLoose(q,v);return q}(c);b.__decorate([g.property({type:l})],c.prototype,"graphics3D",void 0);b.__decorate([g.property({type:d})],c.prototype,"sceneService",void 0);b.__decorate([g.property({type:m})],c.prototype,"tiledSurface",void 0);b.__decorate([g.property({type:z})],c.prototype,"heatmap",void 0);b.__decorate([g.property()],c.prototype,"antialiasingEnabled",void 0);
b.__decorate([g.property()],c.prototype,"physicallyBasedRenderingEnabled",void 0);b.__decorate([g.property()],c.prototype,"highQualityTransparency",void 0);b.__decorate([g.property()],c.prototype,"memoryLimit",void 0);b.__decorate([g.property()],c.prototype,"additionalCacheMemory",void 0);b.__decorate([g.property()],c.prototype,"frameRate",void 0);b.__decorate([g.property()],c.prototype,"maximumRenderResolution",void 0);b.__decorate([g.property()],c.prototype,"maximumPixelRatio",void 0);return c=
b.__decorate([f.subclass("esri.views.3d.support.QualitySettings.QualitySettings")],c)})},"esri/views/3d/support/RenderCoordsHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/unitUtils ../../../chunks/mat4 ../../../chunks/vec3 ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/Axis ../../../geometry/support/coordinateSystem ../../../geometry/support/plane ../../../geometry/support/vectorStacks ../../../layers/graphics/dehydratedFeatureUtils ../../ViewingMode ../../support/spatialReferenceSupport".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v){function q(r){if(v.isSpatialReferenceSupported(r,z.ViewingMode.Global))return 1;r=k.renderSRFromViewSR(!1,r);return g.getMetersPerUnitForSR(r)}let t=function(){function r(u,E,y,A){this.viewingMode=u;this.spatialReference=E;this.unitInMeters=y;this.coordinateSystem=A;this._coordinateSystem=k.create(A)}var x=r.prototype;x.getAltitude=function(u){return k.altitudeAt(this.coordinateSystem,u)};x.setAltitude=function(u,E,y=u){return k.setAltitudeAt(this.coordinateSystem,
y,E,u)};x.setAltitudeOfTransformation=function(u,E){k.setAltitudeOfTransformation(this.coordinateSystem,E,u,E)};x.worldUpAtPosition=function(u,E){return k.normalAt(this.coordinateSystem,u,E)};x.worldBasisAtPosition=function(u,E,y){return k.axisAt(this.coordinateSystem,u,E,y)};x.basisMatrixAtPosition=function(u,E){const y=this.worldBasisAtPosition(u,l.Axis.X,d.sv3d.get()),A=this.worldBasisAtPosition(u,l.Axis.Y,d.sv3d.get());u=this.worldBasisAtPosition(u,l.Axis.Z,d.sv3d.get());h.set(E,y[0],y[1],y[2],
0,A[0],A[1],A[2],0,u[0],u[1],u[2],0,0,0,0,1);return E};x.intersectManifoldClosestSilhouette=function(u,E,y){k.elevate(this.coordinateSystem,E,this._coordinateSystem);k.intersectRayClosestSilhouette(this._coordinateSystem,u,y);return y};x.intersectManifold=function(u,E,y){k.elevate(this.coordinateSystem,E,this._coordinateSystem);E=d.sv3d.get();return k.intersectRay(this._coordinateSystem,u,E)?w.copy(y,E):null};x.intersectInfiniteManifold=function(u,E,y){if(this.viewingMode===z.ViewingMode.Global)return this.intersectManifold(u,
E,y);k.elevate(this.coordinateSystem,E,this._coordinateSystem);E=this._coordinateSystem.value;const A=d.sv3d.get();return e.intersectRay(E.plane,u,A)?w.copy(y,A):null};x.toRenderCoords=function(u,E,y){return m.isDehydratedPoint(u)?n.projectPointToVector(u,E,this.spatialReference):n.projectVectorToVector(u,E,y,this.spatialReference)};x.fromRenderCoords=function(u,E,y=null){return m.isDehydratedPoint(E)?(c.isSome(y)&&(E.spatialReference=y),n.projectVectorToDehydratedPoint(u,this.spatialReference,E)):
E instanceof f?n.projectVectorToPoint(u,this.spatialReference,E):n.projectVectorToVector(u,this.spatialReference,E,y)?E:null};r.create=function(u,E){switch(u){case z.ViewingMode.Local:return new r(z.ViewingMode.Local,E,g.getMetersPerUnitForSR(E),k.createLocal());case z.ViewingMode.Global:return new r(z.ViewingMode.Global,E,1,k.createGlobal(E))}};r.renderUnitScaleFactor=function(u,E){return q(u)/q(E)};b._createClass(r,[{key:"extent",set:function(u){u&&k.setExtent(this.coordinateSystem,u,this.coordinateSystem)}}]);
return r}();a.RenderCoordsHelper=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/ResourceController":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/scheduling ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./index ./MemoryController ./StreamDataLoader ../../support/Scheduler".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t){a.ResourceControllerMain=function(x){function u(){var E=x.apply(this,arguments)||this;E.updating=!1;return E}b._inheritsLoose(u,x);return u}(g);c.__decorate([l.property({readOnly:!0})],a.ResourceControllerMain.prototype,"updating",void 0);a.ResourceControllerMain=c.__decorate([m.subclass("esri.views.3d.support.ResourceController")],a.ResourceControllerMain);var r;(function(x){let u=function(E){function y(){var p=E.apply(this,arguments)||this;p._scheduler=
null;p._memoryController=null;p._streamDataLoader=null;p._cameraChangeTime=0;p._handles=new h;p._frameTask=null;p._scheduleTask=t.ImmediateTask;p._state=t.State.IDLE;return p}b._inheritsLoose(y,E);var A=y.prototype;A.initialize=function(){this._cameraChangeTime=this.now();this._scheduler=t.newScheduler(this.now);this._memoryController=v.newMemoryController(this.view);this._streamDataLoader=new q.StreamDataLoader;this._streamDataLoader.setup(z.maxDownloadSlots,z.downloadSlotsPerClient,this._scheduler);
this._handles.add([this.view.watch("state.camera",(p,B)=>this._cameraChangedHandler(p,B),!0),this.view.watch("stationary",()=>this._stationaryChangedHandler()),this._memoryController.events.on("updating-changed",()=>this.notifyChange("updating"))]);this._frameTask=n.addFrameTask({update:p=>this._frame(p)});this._scheduleTask=this._scheduler.registerTask(t.TaskPriority.RESOURCE_CONTROLLER)};A.destroy=function(){this._handles=w.destroyMaybe(this._handles);this._scheduleTask.remove();this._frameTask=
w.removeMaybe(this._frameTask);this._streamDataLoader=w.destroyMaybe(this._streamDataLoader);this._memoryController=w.destroyMaybe(this._memoryController);this._scheduler=w.destroyMaybe(this._scheduler)};A.schedule=function(p,B,D){return this._scheduleTask.schedule(p,B,D)};A.createStreamDataRequester=function(p){const B=this._streamDataLoader;return{request(D,C,F){return B.request(D,C,p,F)},get busy(){return!B.hasDownloadSlots(p)}}};A._frame=function(p){if(!this.view.suspended){if(this.view.stateManager&&
(this.view.stateManager.step(f.secondsFromMilliseconds(p.deltaTime)),!this._scheduler))return;this._updateState();this._scheduler.state=this._state;this._scheduler.updateBudget(p)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update()}};A._cameraChangedHandler=function(p,B){p&&B&&p.almostEquals(B)||(this._cameraChangeTime=this._scheduler.now,this._updateState(),this._scheduler.state=this._state)};A._stationaryChangedHandler=function(){this.memoryController.resetStableQuality()};
A._updateState=function(){this.view.animation?this._state=t.State.ANIMATING:this.view.interacting?this._state=t.State.INTERACTING:(this._state===t.State.ANIMATING&&(this._cameraChangeTime=0),this._state=300>=this._scheduler.now-this._cameraChangeTime?t.State.INTERACTING:t.State.IDLE)};b._createClass(y,[{key:"updating",get:function(){var p,B;return!!(null!=(p=this._memoryController)&&p.updating||null!=(B=this._streamDataLoader)&&B.updating)}},{key:"scheduler",get:function(){return this._scheduler}},
{key:"memoryController",get:function(){return this._memoryController}},{key:"test",get:function(){return{getQueueStats:p=>this._streamDataLoader.test.loadQueue.getStatsForType(p),state:this._state}}}]);return y}(a.ResourceControllerMain);c.__decorate([l.property({constructOnly:!0})],u.prototype,"view",void 0);c.__decorate([l.property({constructOnly:!0})],u.prototype,"now",void 0);c.__decorate([l.property()],u.prototype,"_scheduler",void 0);c.__decorate([l.property()],u.prototype,"_memoryController",
void 0);c.__decorate([l.property()],u.prototype,"_streamDataLoader",void 0);c.__decorate([l.property({readOnly:!0})],u.prototype,"updating",null);u=c.__decorate([m.subclass("esri.views.3d.support.ResourceController")],u);x.ResourceController=u})(r||(r={}));a.newResourceController=function(x,u=()=>performance.now()){return new r.ResourceController({view:x,now:u})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/index":function(){define(["exports"],function(a){a.ClientType=
void 0;(function(c){c[c.ELEVATION=0]="ELEVATION";c[c.BASEMAP=1]="BASEMAP";c[c.I3S_INDEX=2]="I3S_INDEX";c[c.I3S_DATA=3]="I3S_DATA";c[c.SYMBOLOGY=4]="SYMBOLOGY"})(a.ClientType||(a.ClientType={}));const b=(()=>{const c=[];c[a.ClientType.ELEVATION]=10;c[a.ClientType.BASEMAP]=10;c[a.ClientType.I3S_INDEX]=10;c[a.ClientType.I3S_DATA]=10;c[a.ClientType.SYMBOLOGY]=5;return c})();a.downloadSlotsPerClient=b;a.maxDownloadSlots=30;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/MemoryController":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Evented ../../../core/Logger ../../../core/maybe ../../../core/MemCache ../layers/support/MemoryManagedLayerView".split(" "),
function(a,b,c,g,h,w,n){const f=g.getLogger("esri.views.3d.support.MemoryController");let l=function(){function k(d){this._view=d;this.events=new c;this.minQuality=.1;this._maxMemory=500;this._additionalCacheMemory=100;this._quality=1;this._downscaleMemoryUsed=this._stableQuality=0;this._canFastRecover=!1;this._memoryPredicted=this._memoryUsed=0;this._cacheStorage=new w.MemCacheStorage;this._numQualityChanges=0;this._updating=!1}var e=k.prototype;e.destroy=function(){this.events=null;this._cacheStorage.destroy()};
e.newCache=function(d,m){return new w.MemCache(d,this._cacheStorage,m)};e.disableMemCache=function(){this._additionalCacheMemory=-4096};e.resetStableQuality=function(){this._stableQuality=0};e.update=function(){this._updateMemory();if(!(0>=this._memoryPredicted)||this._updating){var d=this._layersUpdating();if(.6>this._memoryPredicted&&this._canFastRecover)this._stableQuality=this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._updateQuality(1);else if(d){if(1.1<this._memoryPredicted||1<this._memoryUsed)0<
this._stableQuality?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1)}else this._downscaleMemoryUsed=0,1<this._memoryUsed?(this._stableQuality=0,this._canFastRecover=!1,d=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(.75>
this._memoryUsed&&1>this._quality?(this._stableQuality=this._quality,d=this._updateQuality(this._quality+.05)):1>this._quality&&(this._canFastRecover=!0));this.updating!==d&&(this._updating=d,this.events.emit("updating-changed",this.updating))}};e._updateQuality=function(d){d=Math.min(Math.max(d,this.minQuality),1);if(d===this._quality)return!1;this._quality=d;this.events.emit("quality-changed",this._quality);++this._numQualityChanges;return!0};e._layersUpdating=function(){return this._view.allLayerViews.some(d=>
!!d.updating)};e._updateMemory=function(){let d=0,m=0;this._view.basemapTerrain&&this._view.basemapTerrain.getUsedMemory&&(d+=this._view.basemapTerrain.getUsedMemory());var z=this._view._stage&&this._view._stage.renderView&&this._view._stage.renderView.edgeView;h.isSome(z)&&(d+=z.usedMemory);this._view.allLayerViews&&this._view.allLayerViews.forEach(q=>{if(n.isMemoryManagedLayerView(q)){const t=q.ignoresMemoryFactor()?this._quality:1;d+=q.getUsedMemory()*t;m+=q.getUnloadedMemory()*t}});var v=null==
this._warnMemoryUsage||Math.round(10*d)!==Math.round(10*this._warnMemoryUsage);z=1048576*this._maxMemory;if(d>z&&v){this._warnMemoryUsage=d;v=t=>(t/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB";const q=Math.round(100*this._quality);f.warn(`Memory Limit exceeded! Limit: ${v(z)} Current: ${v(d)} Projected: ${v(d+m)} Quality: ${q}%`)}this._memoryUsed=d/z;this._memoryPredicted=(d+m)/z;this._cacheStorage.maxSize=Math.max(0,z-d+1048576*this._additionalCacheMemory);this.events.emit("memory-used",
this._memoryUsed)};b._createClass(k,[{key:"maxMemory",get:function(){return this._maxMemory},set:function(d){null!=d&&0<d&&(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<d&&this._updateQuality(1),this._maxMemory=d)}},{key:"additionalCacheMemory",set:function(d){null!=d&&0<=d&&(this._additionalCacheMemory=d)}},{key:"memoryFactor",get:function(){return this._quality}},{key:"updating",get:function(){return this._updating}},{key:"usedMemory",get:function(){return this._memoryUsed}},{key:"test",
get:function(){const d=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const m=d._numQualityChanges;d._numQualityChanges=0;return m}}}}]);return k}();a.newMemoryController=function(k){return new l(k)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/MemoryManagedLayerView":function(){define(["exports"],function(a){a.isMemoryManagedLayerView=function(b){return"function"===typeof b.getUsedMemory};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/support/StreamDataLoader":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../request ../../../core/Accessor ../../../core/arrayUtils ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./AsyncWorkerQueue ../webgl-engine/lib/Util ../../support/Scheduler".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q){function t(E){if(2>E.byteLength)return"unknown";E=new Uint8Array(E,0,E.byteLength);return 137===E[0]&&80===E[1]?"image/png":71===E[0]&&73===E[1]?"image/gif":66===E[0]&&77===E[1]?"image/bmp":255===E[0]&&216===E[1]?"image/jpeg":"unknown"}a.StreamDataLoader=function(E){function y(){var p=E.apply(this,arguments)||this;p._tasks=new Map;p._onLoadQueue=[];p._doneQueue=[];p.updating=!1;return p}b._inheritsLoose(y,E);var A=y.prototype;A.setup=function(p,B,D){this._loadQueue=
new z.AsyncWorkerQueue((C,F)=>this._startLoading(C,F),(C,F)=>this._doneLoadingCB(C,F),p,B);D&&(this._frameTask=D.registerTask(q.TaskPriority.STREAM_DATA_LOADER,this))};A.destroy=function(){this._frameTask=l.removeMaybe(this._frameTask);this._tasks.forEach(p=>l.abortMaybe(p.abortController));this._loadQueue=l.destroyMaybe(this._loadQueue);this._tasks=this._doneQueue=this._onLoadQueue=null};A.hasDownloadSlots=function(p){return this._loadQueue.hasQuota(p)};A.request=function(p,B,D,C={}){const F=k.createResolver();
F.__signal=l.isSome(C)?C.signal:null;const G=this._createOrUpdateTask(p,B,D,C,F);k.onAbort(C,()=>this._cancelRequest(G,F));return F.promise};A._createTask=function(p,B,D,C,F,G){p=new u(p,B,D,C,F);this._updateTask(p,G);this._tasks.set(F,p);1===this._tasks.size&&this._set("updating",!0);this._loadQueue.push(p);return p};A._cancelRequest=function(p,B){w.removeUnordered(p.resolvers,B);B.reject(k.createAbortError());0===p.resolvers.length&&(p.status===a.TaskStatus.DOWNLOADING&&(p.status=a.TaskStatus.CANCELLED,
this._loadQueue.cancel(p),p.abortController.abort(),p.request=null,p.abortController=null),p.status=a.TaskStatus.CANCELLED,this._tasks.delete(p.key),0===this._tasks.size&&this._set("updating",!1))};A._updateTask=function(p,B){p.resolvers.push(B)};A._createOrUpdateTask=function(p,B,D,C,F){const G=`${l.isSome(C)&&C.uid||p}:${B}:${D}`,L=this._tasks.get(G);return L?(this._updateTask(L,F),L):this._createTask(p,C,B,D,G,F)};A._doneLoadingCB=function(p,B){this._loadQueue&&(v.assert(p.status===a.TaskStatus.DOWNLOADING),
p.status=a.TaskStatus.DOWNLOADED,this._frameTask?this._doneQueue.push({task:p,err:B}):this._doneLoading(p,B))};A.runTask=function(p){for(;!p.done&&0<this._onLoadQueue.length;){var B=this._onLoadQueue.shift();k.throwIfAborted(B.task.abortController);B.task.abortController=null;B.callback(B.task);p.madeProgress()}for(;!p.done&&0<this._doneQueue.length;)B=this._doneQueue.shift(),B.task.status!==a.TaskStatus.DOWNLOADED&&(B.err=B.err||k.createAbortError()),this._doneLoading(B.task,B.err),p.madeProgress()};
A._doneLoading=function(p,B){if(B&&!k.isAbortError(B)&&0<p.numRetries)--p.numRetries,this._loadQueue.push(p);else{var D=p.result instanceof HTMLImageElement?0:p.resolvers.length;for(const C of p.resolvers)if(B)k.isAbortError(B)?C.reject(B):C.reject(new n("stream-data-loader:request-error",`Failed to request resource at '${p.url}'. ${B}`,{url:p.url,error:B}));else{--D;const F=0>=D?p.result:f.clone(p.result);C.resolve(F)}this._tasks.delete(p.key);0===this._tasks.size&&this._set("updating",!1)}};A._startLoading=
function(p,B){if(p.status===a.TaskStatus.CANCELLED)return!1;p.startTime=performance.now();p.status=a.TaskStatus.DOWNLOADING;let D,C;switch(p.docType){case "binary":C="array-buffer";D=0;break;case "image":C="image";break;case "image+type":C="array-buffer";break;default:C="json"}p.abortController=new AbortController;const F=p.abortController.signal;p.request=g(p.url,{...p.options,responseType:C,timeout:D,signal:F});let G=()=>{};const L=M=>{p.duration=performance.now()-p.startTime;p.size=M instanceof
ArrayBuffer?M.byteLength:p.size||0;p.result=M;this._frameTask?this._onLoadQueue.push({callback:B,task:p}):(p.abortController=null,B(p))},H=M=>{p.status===a.TaskStatus.DOWNLOADING&&B(p,M);G()};if("image+type"!==p.docType)return p.request.then(M=>L(M.data),H),!0;p.request.then(M=>{M=M.data;const K=t(M);C="image";p.size=M.byteLength;if("unknown"===K)p.request=g(p.url,{responseType:C,timeout:D,signal:F}),p.request.then(O=>L(O.data),H);else{M=new Blob([M],{type:K});var I=window.URL.createObjectURL(M);
G=()=>window.URL.revokeObjectURL(I);p.request=g(I,{responseType:C,timeout:D,signal:F});p.request.then(O=>L(new x(O.data,K,G)),H)}},H);return!0};b._createClass(y,[{key:"running",get:function(){return 0<this._doneQueue.length||0<this._onLoadQueue.length}},{key:"test",get:function(){return{loadQueue:this._loadQueue}}}]);return y}(h);c.__decorate([e.property({readOnly:!0})],a.StreamDataLoader.prototype,"updating",void 0);a.StreamDataLoader=c.__decorate([m.subclass("esri.views.3d.support.StreamDataLoader")],
a.StreamDataLoader);const r={numRetries:0};let x=function(){function E(y,A,p){this.image=y;this.type=A;this.release=p}b._createClass(E,[{key:"isOpaque",get:function(){return"image/jpeg"===this.type}}]);return E}(),u=function(E){function y(A,p,B,D,C){D=E.call(this,D)||this;D.url=A;D.options=p;D.docType=B;D.key=C;D.result=null;D.status=a.TaskStatus.QUEUED;D.request=null;D.abortController=null;D.resolvers=[];D.startTime=0;D.numRetries=r.numRetries;return D}b._inheritsLoose(y,E);return y}(z.BaseTask);
a.TaskStatus=void 0;(function(E){E[E.QUEUED=1]="QUEUED";E[E.DOWNLOADING=2]="DOWNLOADING";E[E.DOWNLOADED=3]="DOWNLOADED";E[E.CANCELLED=4]="CANCELLED"})(a.TaskStatus||(a.TaskStatus={}));a.ImageWithType=x;a.test=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/AsyncWorkerQueue":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../webgl-engine/lib/Util"],function(a,b,c){let g=function(n){this.typeWorkerQuota=n;this.tasks=[];this.numWorkers=0;this.statistics=
new h},h=function(){this.speed=this.duration=this.size=this.requests=0},w=function(){function n(l,k,e,d){this._workerFunc=l;this._callbackFunc=k;this._maxTotalNumWorkers=e;this._totalNumWorkers=0;this._clients=d.map(m=>new g(m))}var f=n.prototype;f.hasQuota=function(l){return(l=this._clients[l])?this._totalNumWorkers<this._maxTotalNumWorkers||l.numWorkers+l.tasks.length<l.typeWorkerQuota:!1};f.push=function(l){const k=this._clients[l.client];k&&(this._totalNumWorkers<this._maxTotalNumWorkers?(k.numWorkers++,
this._totalNumWorkers++,this._workerFunc(l,(e,d)=>this._taskCallback(e,d))):k.tasks.push(l))};f.cancel=function(l){this._taskFinished(l);l._cancelled=!0};f.destroy=function(){this._clients.length=0};f._taskFinished=function(l){const k=this._clients[l.client];this._totalNumWorkers--;k.numWorkers--;k.statistics.requests++;k.statistics.size+=l.size||0;k.statistics.duration+=l.duration||0;k.statistics.speed=0<k.statistics.duration?k.statistics.size/k.statistics.duration:0;c.assert(0<=k.numWorkers);this._next()};
f._next=function(){for(const l of this._clients)if(l&&l.numWorkers<l.typeWorkerQuota&&this._processQueue(l))return;for(const l of this._clients)if(l&&this._processQueue(l))break};f._processQueue=function(l){for(;0<l.tasks.length;)if(this._workerFunc(l.tasks.shift(),(k,e)=>this._taskCallback(k,e)))return l.numWorkers++,this._totalNumWorkers++,!0;return!1};f._taskCallback=function(l,k){l._cancelled||(this._callbackFunc(l,k),this._taskFinished(l))};f.getStatsForType=function(l){return(l=this._clients[l])?
{quota:l.typeWorkerQuota,workers:l.numWorkers,queueSize:l.tasks.length,requestStats:l.statistics}:null};b._createClass(n,[{key:"test",get:function(){const l=this;return{set workerFunc(k){l._workerFunc=k}}}}]);return n}();a.AsyncWorkerQueue=w;a.BaseTask=function(n){this.client=n;this._cancelled=!1;this.duration=this.size=0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/SceneViewPerformanceInfo":function(){define(["../../../core/byteSizeEstimations","../../../core/maybe",
"../layers/support/MemoryManagedLayerView","./LayerPerformanceInfo","../terrain/terrainUtils"],function(a,b,c,g,h){return function(w){this.usedMemory=this.totalMemory=0;this.quality=1;this.edgesMemory=this.terrainMemory=this.load=0;this.layerPerformanceInfos=[];var n=w.resourceController.memoryController;this.totalMemory=n.maxMemory*a.ByteSizeUnit.MEGABYTES;this.usedMemory=Math.round(n.usedMemory*this.totalMemory);this.quality=n.memoryFactor;this.load=w.resourceController.scheduler.load;this.terrainMemory=
w.basemapTerrain?w.basemapTerrain.getUsedMemory():0;n=w._stage&&w._stage.renderView&&w._stage.renderView.edgeView;this.edgesMemory=b.isSome(n)?n.usedMemory:0;w.allLayerViews.items.forEach(f=>{(c.isMemoryManagedLayerView(f)||h.isSurfaceLayerView(f))&&this.layerPerformanceInfos.push(new g(f,w))});this.layerPerformanceInfos.sort((f,l)=>l.memory-f.memory)}})},"esri/views/3d/support/LayerPerformanceInfo":function(){define(["../layers/support/PerformanceInfoLayerView","../terrain/terrainUtils"],function(a,
b){return function(c,g){this.layer=null;this.displayedNumberOfFeatures=this.memory=0;this.totalNumberOfFeatures=this.maximumNumberOfFeatures=null;this.layer=c.layer;this.memory=b.isSurfaceLayerView(c)?g.basemapTerrain.getUsedMemoryForLayerView(c):c.getUsedMemory();a.isPerformanceInfoLayerView(c)&&(c=c.performanceInfo,this.displayedNumberOfFeatures=c.displayedNumberOfFeatures,this.maximumNumberOfFeatures=c.maximumNumberOfFeatures,this.totalNumberOfFeatures=c.totalNumberOfFeatures)}})},"esri/views/3d/layers/support/PerformanceInfoLayerView":function(){define(["exports"],
function(a){a.isPerformanceInfoLayerView=function(b){return"performanceInfo"in b};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/terrainUtils":function(){define("exports ../../../core/Collection ../../../core/maybe ../../../geometry/support/spatialReferenceUtils ../../../layers/support/layerUtils ../../ViewingMode ../support/StreamDataLoader ../../../chunks/terrainUtilsPlanar ../../../chunks/terrainUtilsSpherical".split(" "),function(a,b,c,g,h,w,n,f,l){function k(p){return"vector-tile"===
(null==p?void 0:p.type)}function e(p){return"imagery-tile"===(null==p?void 0:p.type)||"wcs"===(null==p?void 0:p.type)}function d(p){return"imagery-tile-3d"===(null==p?void 0:p.type)}function m(p){return"tile-3d"===(null==p?void 0:p.type)}function z(p){return"vector-tile-3d"===(null==p?void 0:p.type)}function v(p){return"wmts-3d"===(null==p?void 0:p.type)}function q(p){return"elevation-3d"===(null==p?void 0:p.type)}function t(p,B,D,C){return u[C].checkIfTileInfoSupportedForViewSR(p,D,B)}function r(p,
B,D){p=h.getTileMaxtrixSetFromActiveLayer(p);if(c.isSome(p))if(b.isCollection(p)){if(p=p.find(C=>null==t(C.tileInfo,C.fullExtent,B,D)))return{tileInfo:p.tileInfo,fullExtent:p.fullExtent}}else return{tileInfo:p.tileInfo,fullExtent:p.fullExtent};return{tileInfo:null,fullExtent:null}}function x(p){return p.isWGS84||p.isWebMercator||g.isCGCS2000(p)||!g.isEarth(p)}const u={[w.ViewingMode.Global]:l.terrainUtilsSpherical,[w.ViewingMode.Local]:f.terrainUtilsPlanar},E=80/180*Math.PI,y=110/180*Math.PI,A={force512VTL:!1};
a.checkIfTileInfoSupportedForView=t;a.computeSkirtScale=function(p,B,D){const C=u[p.viewingMode];if(C.isInsideExtent(p,B))var F=c.unwrapOr(p.getElevation(B[0],B[1],B[1],p.spatialReference),0);else{if(!C.isInsideExtent(p,B,1.2))return 0;var G=p.getTileWithElevation(B[0],B[1],B[1],p.spatialReference);F=c.isSome(G)?G.elevationBounds[0]:p.elevationBounds.min;G=c.isSome(G)?G.elevationBounds[1]:p.elevationBounds.max;F=.5*(F+G);p=C.tiltToExtentEdge(p,B,F);if(p>E&&p<y)return 0}B=B[2]-F;return Math.abs(B)<
D?0:0>B?-1:1};a.getLayerWithExtentRange=function(p){return d(p)?{fullExtent:p.fullExtent,minScale:p.layer.minScale,maxScale:p.layer.maxScale,tilemapCache:null}:p.layer};a.getTileInfoAndExtentFromWMTSLayer=r;a.getTiledLayerInfo=function(p,B,D){var C=null;let F=null;if(h.isWMTSLayer(p))p=r(p,B,D),C=p.tileInfo,F=p.fullExtent;else if(F=e(p)?p.getCompatibleFullExtent(B):p.fullExtent,C=D===w.ViewingMode.Local,e(p))C=p.getCompatibleTileInfo(B,F,C);else if(k(p)){C=C&&!x(B)||A.force512VTL;const G=p.tileInfo.spatialReference.isGeographic;
C=C?p.tileInfo:p.tileInfo.getOrCreateCompatible(256,G?1:2)}else C=p.tileInfo;return c.isSome(C)&&c.isSome(F)&&null==t(C,F,B,D)?{tileInfo:C,fullExtent:F}:null};a.isElevationLayerView=q;a.isImageryTileLayerView=d;a.isImageryTileRenderInfo=function(p){var B;p=null==p?void 0:null==(B=p.sourceLayerInfo)?void 0:B.data;return c.isSome(p)&&"type"in p&&"raster-tile"===p.type};a.isProjectableRasterLayer=e;a.isRasterTileRenderInfo=function(p){var B;p=null==p?void 0:null==(B=p.sourceLayerInfo)?void 0:B.data;
return p instanceof HTMLImageElement||p instanceof n.ImageWithType||p instanceof HTMLCanvasElement||p instanceof ImageData};a.isSurfaceLayerView=function(p){return p&&(m(p)||d(p)||q(p)||z(p)||v(p))};a.isTextureTileRenderInfo=function(p){var B;p=null==p?void 0:null==(B=p.sourceLayerInfo)?void 0:B.data;return c.isSome(p)&&"type"in p&&"tile-texture"===p.type};a.isTileLayerView=m;a.isVectorTileLayer=k;a.isVectorTileLayerView=z;a.isVectorTileRenderInfo=function(p){var B;p=null==p?void 0:null==(B=p.sourceLayerInfo)?
void 0:B.data;return c.isSome(p)&&"type"in p&&"vector-tile"===p.type};a.isWMTSLayerView=v;a.releaseTileData=function(p){c.isSome(p)&&"release"in p&&p.release();return null};a.test=A;a.useFetchTileForLayer=function(p){return p.fetchTile&&!1!==p.hasOverriddenFetchTile};a.vtlAssumes256PixelSizeAsDefault=x;a.weakAssert=function(p,B){p||console.warn("Terrain: "+B)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/terrainUtilsPlanar":function(){define("exports ../core/Error ../core/maybe ./vec3 ./vec3f64 ../geometry/projection ../geometry/support/aaBoundingRect ../views/3d/terrain/TerrainConst ../views/3d/terrain/TilingScheme".split(" "),
function(a,b,c,g,h,w,n,f,l){function k(r,x,u=0){r=r.extent;return c.isNone(r)?!1:0===u?n.containsPoint(r,x):n.containsPointWithMargin(r,x,u*Math.min(r[2]-r[0],r[3]-r[1]))}function e(r,x,u,E){g.copy(z,u);z[E]=x[E];E=g.subtract(z,z,x);var y=g.subtract(v,r,x);y=g.dot(y,E);const A=g.dot(E,E);x=0>=y?x:A<=y?u:g.add(z,x,g.scale(E,E,y/A));r=g.subtract(z,r,x);return Math.PI/2-Math.atan(r[2]/Math.sqrt(r[0]*r[0]+r[1]*r[1]))}function d(r,x,u){r=r.extent;if(c.isNone(r))return 0;q[0]=r[0];q[1]=r[1];q[2]=u;t[0]=
r[2];t[1]=r[3];t[2]=u;r=u=Infinity;x[0]<q[0]?u=e(x,q,t,0):x[0]>t[0]&&(u=e(x,t,q,0));x[1]<q[1]?r=e(x,q,t,1):x[1]>t[1]&&(r=e(x,t,q,1));return Math.min(u,r)}function m(r,x,u){if(c.isNone(r))return l.getMissingTileInfoError();if(r.spatialReference.isGeographic&&!w.canProjectToWGS84ComparableLonLat(r.spatialReference))return new b("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");var E=l.default.checkUnsupported(r);if(c.isSome(E))return E;
{var y=r.lods;E=y[0].resolution*2**y[0].level;var A=[E*r.size[0],E*r.size[1]];const p=[r.origin.x,r.origin.y];u=n.fromExtent(u);const B=n.create();l.default.computeRowColExtent(u,A,p,B);A=(B[2]-B[0])*(B[3]-B[1]);A>f.MAX_ROOT_TILES?(y=y[0].scale*2**y[0].level,E=Math.max((u[3]-u[1])/r.size[1],(u[2]-u[0])/r.size[0])*y/E,u=Math.floor(Math.log(E)/Math.log(10)),E=Math.ceil(E/10**u)*10**u,E=new b("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(y).toLocaleString()+
") is too large for the layer's extent. Suggested scale: 1:"+E.toLocaleString()+".",{level0Scale:y,suggestedLevel0Scale:E,requiredNumRootTiles:A,allowedNumRootTiles:f.MAX_ROOT_TILES})):E=null}if(E)return E;r=r.spatialReference;return!x||r.equals(x)||x.isWGS84&&r.isWebMercator?null:new b("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}const z=h.create(),v=h.create(),q=h.create(),t=h.create();h=Object.freeze({__proto__:null,isInsideExtent:k,
tiltToExtentEdge:d,checkIfTileInfoSupportedForViewSR:m});a.checkIfTileInfoSupportedForViewSR=m;a.isInsideExtent=k;a.terrainUtilsPlanar=h;a.tiltToExtentEdge=d})},"esri/chunks/terrainUtilsSpherical":function(){define("exports ../core/Error ../core/maybe ../geometry/projection ../geometry/support/spatialReferenceUtils ../views/3d/terrain/TilingScheme".split(" "),function(a,b,c,g,h,w){function n(){return!0}function f(){return 0}function l(e,d){if(c.isNone(e))return w.getMissingTileInfoError();const m=
e.lods.length-1,z=e.spatialReference,v=g.canProjectToWGS84ComparableLonLat(z)||h.isMars(z)||h.isMoon(z);if(z.isWebMercator){if(!w.default.makeWebMercatorAuxiliarySphere(m).compatibleWith(e))return new b("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(v){if(!w.default.makeGCSWithTileSize(e.spatialReference,e.size[0],m).compatibleWith(e))return e.spatialReference.isWGS84?new b("tilingscheme:incompatible-global-wgs84",
"The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new b("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}else return new b("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(d&&!e.spatialReference.equals(d))return new b("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}
const k=Object.freeze({__proto__:null,isInsideExtent:n,tiltToExtentEdge:f,checkIfTileInfoSupportedForViewSR:l});a.checkIfTileInfoSupportedForViewSR=l;a.isInsideExtent=n;a.terrainUtilsSpherical=k;a.tiltToExtentEdge=f})},"esri/views/3d/support/SharedSymbolResources":function(){define("exports ../../../core/arrayUtils ../../../core/Handles ../../../geometry/projectionEllipsoid ./index ./StreamTextureCollection ../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl/enums".split(" "),function(a,b,
c,g,h,w,n,f){let l=function(){function e(m){this.streamDataRequester=this.textures=null;this.graphicsOwners=[];this.cimSymbolRasterizer=this.screenSizePerspectiveHandles=null;this.viewState=m.viewState;this.view=m.view;this.pointsOfInterest=m.pointsOfInterest;this.objectResourceCache=m.objectResourceCache;this.streamDataRequester=m.resourceController.createStreamDataRequester(h.ClientType.SYMBOLOGY);this.textures=new w.StreamTextureCollection(this.streamDataRequester,m.view._stage,{preMultiplyAlpha:!0,
wrap:{s:f.TextureWrapMode.CLAMP_TO_EDGE,t:f.TextureWrapMode.CLAMP_TO_EDGE}},m.resourceController.scheduler);const z=g.getReferenceEllipsoid(this.view.spatialReference).radius;this.screenSizePerspectiveSettings=n.getSettings(m.viewingMode,z);this.screenSizePerspectiveSettingsLabels=n.getLabelSettings(m.viewingMode,z)}var d=e.prototype;d.destroy=function(){this.textures.destroy();this.streamDataRequester=this.textures=null};d.addGraphicsOwner=function(m){if(!m)return{remove(){}};this.graphicsOwners.push(m);
const z="layer"in m?m.watch("layer.screenSizePerspectiveEnabled",()=>this._updateScreenSizePerspectiveEnabled()):null;this._updateScreenSizePerspectiveEnabled();return{remove:()=>{z&&(z.remove(),b.removeUnordered(this.graphicsOwners,m),this._updateScreenSizePerspectiveEnabled())}}};d._updateScreenSizePerspectiveEnabled=function(){var m=this.graphicsOwners.some(z=>!0===z.get("layer.screenSizePerspectiveEnabled"));m&&!this.screenSizePerspectiveHandles?(this.screenSizePerspectiveHandles=new c,m=()=>
this._updateScreenSizePerspectiveSettings(),this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch("distance",m,!0),this.viewState.events.on("camera-projection-changed",m)]),this._updateScreenSizePerspectiveSettings()):!m&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)};d._updateScreenSizePerspectiveSettings=function(){k.distance=this.pointsOfInterest.centerOnSurfaceInfrequent.distance;k.fovY=
this.viewState.camera.fovY;this.screenSizePerspectiveSettings.update(k);this.screenSizePerspectiveSettingsLabels.update(k);this.view._stage.renderView.requestRender()};return e}();const k={distance:0,fovY:0};a.SharedSymbolResources=l;a.default=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/StreamTextureCollection":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils ./TextureCollection ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/Texture".split(" "),
function(a,b,c,g,h,w,n,f){w=function(l){function k(d,m,z,v){m=l.call(this,m,v)||this;m._streamDataRequester=d;m._parameters=z;return m}b._inheritsLoose(k,l);var e=k.prototype;e.fromUrl=function(){var d=b._asyncToGenerator(function*(m,z,v){var q=this;g.throwIfAborted(v);const t=c.isSome(v)&&v.signal,r=this.makeUid(m,z);let x=this._textureRequests.get(r);if(!x){v=new AbortController;const u=this._streamDataRequester.request(m,"image",{uid:r,signal:v.signal});x={referenceCount:0,texture:null,textureAsync:null,
abortController:v};this._textureRequests.set(r,x);x.textureAsync=u.then(function(){var E=b._asyncToGenerator(function*(y){y=q._createTexture(m,y,z);x.texture=y;x.abortController=null;q._stage.add(y);yield q._stage.load(y);return{uid:r,texture:y,release:()=>q._release(r)}});return function(y){return E.apply(this,arguments)}}(),E=>{x.abortController=null;throw E;})}x.referenceCount++;return(new Promise((u,E)=>{g.onAbort(t,()=>{E(g.createAbortError())});x.textureAsync.then(u,E)})).catch(u=>{this._release(r);
throw u;})});return function(m,z,v){return d.apply(this,arguments)}}();e._createTexture=function(d,m,z){const v={...this._parameters,powerOfTwoResizeMode:n.PowerOfTwoResizeMode.PAD};if(h.isSVG(d)){if(z||0===m.width&&0===m.height)d=m.width?m.height/m.width:1,z=z||64,1<d?(m.width=Math.round(z/d),m.height=z):(m.width=z,m.height=Math.round(z*d));this._stage.renderView&&this._stage.renderView.renderingContext.driverTest.svgAlwaysPremultipliesAlpha&&(v.preMultiplyAlpha=!1)}v.width=m.width;v.height=m.height;
return new f.Texture(m,v)};return k}(w.TextureCollection);a.StreamTextureCollection=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/maybe ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ../debugFlags ../debugUtils ../PropertiesPool ../geometryUtils/ray ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./Focus ./StableSurfaceCenter ./SurfaceGeometryUpdates ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/verticalOffsetUtils ../../../support/Scheduler".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G){a.PointsOfInterest=function(I){function O(J){J=I.call(this,J)||this;J._handles=new h;J._tmpRay=v.create();J._centerRayDirty=!0;J._surfaceAltitudeAtCenter=0;J._surfaceAltitudeAtCenterDirty=!0;J._contentAltitudeAtCenter=0;J._contentAltitudeAtCenterDirty=!0;J._propertiesPool=new r.PropertiesPool({renderPointOfView:L},b._assertThisInitialized(J));J.renderPointOfView=z.create();J._pois=[];J._debugCenters=new Map;return J}b._inheritsLoose(O,
I);var Q=O.prototype;Q.initialize=function(){var J;const {state:P,basemapTerrain:N,renderCoordsHelper:R,map:S}=this.view;this._surfaceIntersector=D.newIntersector(P.viewingMode);this._surfaceIntersector.options.backfacesTerrain=P.isGlobal?!1:!0;this._surfaceIntersector.options.invisibleTerrain=!1;this._surfaceIntersector.options.store=C.StoreResults.MIN;this._contentIntersector=D.newIntersector(P.viewingMode);var T=()=>this._estimateSurfaceAltitudeAtCenter();const V=this.view.resourceController.scheduler,
W=w.unwrap(null==(J=this.view.basemapTerrain)?void 0:J.elevationQueryCache);J={state:P,scheduler:V,surface:N,renderCoordsHelper:R};this._set("centerOnSurfaceInfrequent",new E.default({...J,task:G.TaskPriority.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:T}));this._set("centerOnSurfaceFrequent",new E.default({...J,task:G.TaskPriority.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:T}));this._set("contentCenterOnSurface",new E.default({...J,task:G.TaskPriority.POINT_OF_INTEREST_INFREQUENT,
estimateSurfaceAltitudeAtCenter:T,cameraName:"contentCamera"}));this._set("centerOnContent",new E.default({...J,task:G.TaskPriority.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()}));this._set("cameraOnSurface",new u.default({...J,cache:W,task:G.TaskPriority.POINT_OF_INTEREST_INFREQUENT,map:S}));this._set("contentCameraOnSurface",new u.default({...J,cache:W,task:G.TaskPriority.POINT_OF_INTEREST_INFREQUENT,map:S,cameraName:"contentCamera"}));this._set("surfaceGeometryUpdates",
new B.SurfaceGeometryUpdates({...J,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}));this._set("contentGeometryUpdates",new y.ContentGeometryUpdates({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:R}));this._set("surfaceOrigin",new p.StableSurfaceCenter({cache:W,view:this.view}));this._set("focus",new A.default({state:P,scheduler:V,surface:N,renderCoordsHelper:R,centerOnSurface:this.contentCenterOnSurface,estimateSurfaceIntersectionAtRenderPoint:(U,
aa)=>this._estimateSurfaceIntersectionAtRenderPoint(U,this.view.state.contentCamera,aa)}));this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.contentCenterOnSurface,this.cameraOnSurface,this.contentCameraOnSurface,this.focus);T=this.view.graphics;this._debugCenters.set(this.centerOnContent,new t.PointGraphics(T,"red","CenterOnContent"));this._debugCenters.set(this.centerOnSurfaceFrequent,new t.PointGraphics(T,"red","CenterOnSurface"));this._debugCenters.set(this.centerOnSurfaceInfrequent,
new t.PointGraphics(T,"red","CenterOnSurface"));this._debugCenters.set(this.contentCenterOnSurface,new t.PointGraphics(T,"red","ContentCenterOnSurface"));this._debugCenters.set(this.cameraOnSurface,new t.PointGraphics(T,"blue","CameraOnSurface"));this._debugCenters.set(this.contentCameraOnSurface,new t.PointGraphics(T,"blue","ContentCameraOnSurface"));this._debugCenters.set(this.focus,new t.PointGraphics(T,"green","Focus"));this._handles.add([P.watch("camera",U=>this._cameraChanged(U),!0),N.watch("extent",
()=>this._updateCenterPointsOfInterest()),n.whenFalse(N,"updating",()=>this._updateCenterPointsOfInterest(),!0),this.surfaceGeometryUpdates.events.on("request-update",()=>this._updateCenterPointsOfInterest()),this.contentGeometryUpdates.events.on("request-update",()=>this._updateCenterOnContent()),n.init(q,"SHOW_POI",U=>this._setDebug(U))]);this._cameraChanged(this.view.state.camera);for(const U of this._pois)U.runTask()};Q.destroy=function(){this._setDebug(!1);this._handles.destroy();this._propertiesPool.destroy();
for(const J of this._pois)J.destroy();this.surfaceOrigin.destroy()};Q._estimateContentAltitudeAtCenter=function(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const J=this.centerRay;if(w.isNone(J))return this._contentAltitudeAtCenter;this.view.sceneIntersectionHelper.intersectRay(J,this._contentIntersector,H,K)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(H):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter();
return this._contentAltitudeAtCenter};Q._estimateSurfaceAltitudeAtCenter=function(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const J=this.centerRay;if(w.isNone(J))return this._surfaceAltitudeAtCenter;const P=J.origin,N=m.add(H,J.origin,J.direction);this._surfaceIntersector.resetWithRay(J,this.view.state.camera);this.view.basemapTerrain.intersect(this._surfaceIntersector,null,P,N);this._surfaceIntersector.results.min.getIntersectionPoint(H)&&
(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(H));return this._surfaceAltitudeAtCenter};Q._estimateSurfaceIntersectionAtRenderPoint=function(J,P,N){J=x.fromRenderAtEye(P,J,M);if(w.isNone(J))return null;const R=J.origin,S=m.add(H,J.origin,J.direction);this._surfaceIntersector.resetWithRay(J,P);this.view.basemapTerrain.intersect(this._surfaceIntersector,null,R,S);return this._surfaceIntersector.results.min.getIntersectionPoint(N)?N:null};Q._cameraChanged=function(J){this._updateCenterPointsOfInterest();
J=J.eye;m.exactEquals(this.renderPointOfView,J)||this._set("renderPointOfView",m.copy(this._propertiesPool.get("renderPointOfView"),J))};Q._updateCenterPointsOfInterest=function(){this._contentAltitudeAtCenterDirty=this._surfaceAltitudeAtCenterDirty=this._centerRayDirty=!0;for(const J of this._pois)J.updateRenderLocation()};Q._updateCenterOnContent=function(){this._contentAltitudeAtCenterDirty=!0;this.centerOnContent.updateRenderLocation()};Q._setDebug=function(J){if(J)for(const P of this._pois)this._handles.add(n.init(P,
"renderLocation",N=>this._debugCenters.get(P).show(N,P.renderCoordsHelper.spatialReference)),"debug");else this._debugCenters.forEach(P=>P.hide()),this._handles.remove("debug")};b._createClass(O,[{key:"updating",get:function(){var J;return!!(null!=(J=this.surfaceGeometryUpdates)&&J.updating||this._pois.some(P=>P.updating))}},{key:"centerRay",get:function(){this._centerRayDirty&&(this._centerRay=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,this._tmpRay),this._centerRayDirty=
!1);return this._centerRay}},{key:"test",get:function(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const J of this._pois)J.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}}]);return O}(g);c.__decorate([f.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnContent",void 0);c.__decorate([f.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnSurfaceFrequent",void 0);c.__decorate([f.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnSurfaceInfrequent",
void 0);c.__decorate([f.property({readOnly:!0})],a.PointsOfInterest.prototype,"contentCenterOnSurface",void 0);c.__decorate([f.property({readOnly:!0})],a.PointsOfInterest.prototype,"cameraOnSurface",void 0);c.__decorate([f.property({readOnly:!0})],a.PointsOfInterest.prototype,"contentCameraOnSurface",void 0);c.__decorate([f.property({readOnly:!0})],a.PointsOfInterest.prototype,"focus",void 0);c.__decorate([f.property({readOnly:!0})],a.PointsOfInterest.prototype,"renderPointOfView",void 0);c.__decorate([f.property({readOnly:!0})],
a.PointsOfInterest.prototype,"surfaceOrigin",void 0);c.__decorate([f.property({readOnly:!0})],a.PointsOfInterest.prototype,"contentGeometryUpdates",void 0);c.__decorate([f.property({readOnly:!0})],a.PointsOfInterest.prototype,"surfaceGeometryUpdates",void 0);c.__decorate([f.property({constructOnly:!0})],a.PointsOfInterest.prototype,"view",void 0);c.__decorate([f.property({readOnly:!0})],a.PointsOfInterest.prototype,"updating",null);a.PointsOfInterest=c.__decorate([d.subclass("esri.views.3d.support.PointsOfInterest")],
a.PointsOfInterest);const L=Array,H=z.create(),M=v.create(),K={exclude:new Set([F.TERRAIN_ID])};a.default=a.PointsOfInterest;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/debugUtils":function(){define("exports ../../../geometry ../../../Graphic ../../../symbols ../../../core/maybe ../../../geometry/Polygon ../../../symbols/FillSymbol3DLayer ../../../symbols/PolygonSymbol3D ../../../geometry/Point ../../../symbols/PointSymbol3D ../../../symbols/IconSymbol3DLayer ../../../symbols/TextSymbol3DLayer".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){b=function(){function m(v,q,t=""){this.graphics=v;this._symbol=new k({symbolLayers:[new e({material:{color:q},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new d({text:t,halo:{color:"white",size:1/.75},material:{color:q},size:12})]})}var z=m.prototype;z.show=function(v,q){h.isNone(q)||(this.hide(),v=new l({x:v[0],y:v[1],z:v[2],spatialReference:q}),this._graphic=new c({geometry:v,symbol:this._symbol}),this.graphics.add(this._graphic))};z.hide=
function(){h.isSome(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)};return m}();g=function(){function m(v,q,t=""){this.graphics=v;this._graphics=[];this._outline=new f({symbolLayers:[new n({material:{color:[0,0,0,0]},outline:{color:q,size:2}})]});this._text=new k({symbolLayers:[new d({text:t,halo:{color:"white",size:1/.75},material:{color:q},size:12})]})}var z=m.prototype;z.show=function(v){this.hide();const q=new l({x:v.xmin,y:v.ymin,z:v.zmax,spatialReference:v.spatialReference});
this._graphics.push(new c({geometry:w.fromExtent(v),symbol:this._outline}));this._graphics.push(new c({geometry:q,symbol:this._text}));this.graphics.addMany(this._graphics)};z.hide=function(){this.graphics.removeMany(this._graphics);this._graphics.length=0};return m}();a.ExtentGraphics=g;a.PointGraphics=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../cameraUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q){const t=Array;a.CameraOnSurface=function(x){function u(y){y=x.call(this,y)||this;y._dirty=!1;y._propertiesPool=new v.PropertiesPool({location:m,renderLocation:t},b._assertThisInitialized(y));y._estimatedSurfaceAltitude=0;y._pendingElevationQueryController=null;y.cameraName="camera";y.renderLocation=d.create();y.tmpPoint=new m;return y}b._inheritsLoose(u,x);var E=u.prototype;E.initialize=function(){this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,
this));this.runTask();if(this.map){const y=()=>this._setDirty();this.handles.add(h.on(this.map,"ground.layers","change",y,y,y))}this._updateRenderLocation()};E.destroy=function(){this._cancelPendingRequest();this._propertiesPool.destroy();this._propertiesPool=null};E.updateRenderLocation=function(){this._setDirty();this._updateRenderLocation()};E._setDirty=function(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))};E._cancelPendingRequest=function(){const y=this._pendingElevationQueryController;
y&&(this._pendingElevationQueryController=null,y.abort(),this.notifyChange("updating"))};E.runTask=function(){this._cancelPendingRequest();this._dirty=!1;this.notifyChange("updating");if(this.map&&this.map.ground){this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this.tmpPoint,this.state.spatialReference);var y=new AbortController;this.map.ground.queryElevation(this.tmpPoint,{signal:y.signal,cache:this.cache}).then(A=>this._updateSurfaceAltitude(A.geometry.z)).catch(A=>{g.isAbortError(A)||
this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===y&&(this._pendingElevationQueryController=null,this.notifyChange("updating"));y=null});this._pendingElevationQueryController=y}else this._updateSurfaceAltitude(0)};E._updateSurfaceAltitude=function(y){this._estimatedSurfaceAltitude!==y&&(this._estimatedSurfaceAltitude=y,this._updateRenderLocation())};E._updateRenderLocation=function(){this.renderCoordsHelper.setAltitude(r,this._estimatedSurfaceAltitude,
this._camera.eye);e.exactEquals(this._get("renderLocation"),r)||this._set("renderLocation",e.copy(this._propertiesPool.get("renderLocation"),r))};b._createClass(u,[{key:"_camera",get:function(){return this.state[this.cameraName]}},{key:"location",get:function(){const y=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,y,this.state.spatialReference);return y}},{key:"scale",get:function(){const y=this._camera,A=e.distance(y.eye,this.renderLocation);return z.distanceToScale({renderCoordsHelper:this.renderCoordsHelper,
state:{camera:y}},A,0)}},{key:"updating",get:function(){return this._dirty||null!=this._pendingElevationQueryController}},{key:"running",get:function(){return!this._pendingElevationQueryController&&this._dirty}}]);return u}(q.PointOfInterest);c.__decorate([w.property({constructOnly:!0})],a.CameraOnSurface.prototype,"scheduler",void 0);c.__decorate([w.property({constructOnly:!0})],a.CameraOnSurface.prototype,"cache",void 0);c.__decorate([w.property({constructOnly:!0})],a.CameraOnSurface.prototype,
"task",void 0);c.__decorate([w.property({constructOnly:!0})],a.CameraOnSurface.prototype,"cameraName",void 0);c.__decorate([w.property({readOnly:!0})],a.CameraOnSurface.prototype,"location",null);c.__decorate([w.property({constructOnly:!0})],a.CameraOnSurface.prototype,"map",void 0);c.__decorate([w.property({readOnly:!0})],a.CameraOnSurface.prototype,"renderLocation",void 0);c.__decorate([w.property({readOnly:!0})],a.CameraOnSurface.prototype,"scale",null);c.__decorate([w.property({readOnly:!0})],
a.CameraOnSurface.prototype,"updating",null);a.CameraOnSurface=c.__decorate([k.subclass("esri.views.3d.support.CameraOnSurface")],a.CameraOnSurface);const r=d.create();a.default=a.CameraOnSurface;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,g,h,w,n,f,l,k){a.PointOfInterest=function(e){function d(m){m=e.call(this,m)||this;m.handles=new h;return m}b._inheritsLoose(d,e);d.prototype.destroy=function(){this.handles.destroy()};return d}(g);c.__decorate([w.property({constructOnly:!0})],a.PointOfInterest.prototype,"renderCoordsHelper",void 0);c.__decorate([w.property({constructOnly:!0})],a.PointOfInterest.prototype,"surface",void 0);c.__decorate([w.property({constructOnly:!0})],a.PointOfInterest.prototype,"state",void 0);a.PointOfInterest=
c.__decorate([k.subclass("esri.views.3d.support.PointOfInterest")],a.PointOfInterest);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/support/aaBoundingRect ../debugFlags ../PropertiesPool ./PointOfInterest".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x){const u=Array;a.CenterOnSurface=function(p){function B(C){C=p.call(this,C)||this;C._propertiesPool=new r.PropertiesPool({location:m,renderLocation:u},b._assertThisInitialized(C));C._currentSurfaceAltitude=0;C._latestSurfaceAltitude=0;C.cameraName="camera";C.distance=0;C.renderLocation=d.create();C.updating=!1;return C}b._inheritsLoose(B,p);var D=B.prototype;D.initialize=function(){this._frameWorker=this.scheduler.registerTask(this.task,this);this.runTask()};
D.destroy=function(){this._frameWorker=h.removeMaybe(this._frameWorker);this._propertiesPool=h.destroyMaybe(this._propertiesPool)};D.updateRenderLocation=function(){this.updating=!0;this._updateRenderLocation()};D.runTask=function(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this._updateRenderLocation();this.updating=!1};D._updateRenderLocation=function(){const C=E;let F=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,C);var G=this._currentSurfaceAltitude!==
this._latestSurfaceAltitude;!F&&G&&(F=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,C))&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude);G=y;F&&this._latestSurfaceAltitudeChangesDistanceSignificantly(C,G)&&(e.copy(C,G),this._currentSurfaceAltitude=this._latestSurfaceAltitude);F?this.distance=e.distance(this._camera.eye,C):(e.scale(C,this._camera.viewForward,this._get("distance")),e.add(C,C,this._camera.eye));e.exactEquals(this._get("renderLocation"),C)||this._set("renderLocation",
e.copy(this._propertiesPool.get("renderLocation"),C))};D._calculateSurfaceIntersection=function(C,F){var G=this._camera;if(!this.renderCoordsHelper.intersectManifold(G.ray,C,F))return!1;if(this.state.isGlobal){const L=v.getReferenceEllipsoid(this.renderCoordsHelper.spatialReference).radius;C=L+C;const H=e.squaredLength(G.eye),M=H<C*C,K=e.distance(G.eye,F);M&&K>L/4&&(e.scale(F,G.viewForward,C-Math.sqrt(H)),e.add(F,F,G.eye))}else G=this.surface.ready?this.surface.extent:null,h.isSome(G)&&z.projectBoundingRect(G,
this.surface.spatialReference,A,this.renderCoordsHelper.spatialReference)&&(F[0]=g.clamp(F[0],A[0],A[2]),F[1]=g.clamp(F[1],A[1],A[3]));return!0};D._latestSurfaceAltitudeChangesDistanceSignificantly=function(C,F){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||null==C)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,F)){if(t.TESTS_DISABLE_OPTIMIZATIONS)return!0;const G=this._camera.eye;C=e.distance(G,C);F=e.distance(G,F);if(.05<Math.abs(F-C)/C)return!0}return!1};
b._createClass(B,[{key:"_camera",get:function(){return this.state[this.cameraName]}},{key:"location",get:function(){const C=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,C,this.state.spatialReference);return C}},{key:"estimatedSurfaceAltitude",get:function(){return this._latestSurfaceAltitude}},{key:"running",get:function(){return this.updating}}]);return B}(x.PointOfInterest);c.__decorate([w.property({constructOnly:!0})],a.CenterOnSurface.prototype,
"scheduler",void 0);c.__decorate([w.property({constructOnly:!0})],a.CenterOnSurface.prototype,"task",void 0);c.__decorate([w.property({constructOnly:!0})],a.CenterOnSurface.prototype,"cameraName",void 0);c.__decorate([w.property()],a.CenterOnSurface.prototype,"distance",void 0);c.__decorate([w.property({constructOnly:!0})],a.CenterOnSurface.prototype,"estimateSurfaceAltitudeAtCenter",void 0);c.__decorate([w.property({readOnly:!0})],a.CenterOnSurface.prototype,"location",null);c.__decorate([w.property({readOnly:!0})],
a.CenterOnSurface.prototype,"renderLocation",void 0);c.__decorate([w.property()],a.CenterOnSurface.prototype,"updating",void 0);a.CenterOnSurface=c.__decorate([k.subclass("esri.views.3d.support.CenterOnSurface")],a.CenterOnSurface);const E=d.create(),y=d.create(),A=q.create();a.default=a.CenterOnSurface;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["exports","../../../../core/Evented","../../../../core/Handles"],
function(a,b,c){let g=function(){function w(f){this.handles=new c;this.events=new b;this.contentLayerViews=f.contentLayerViews;this.handles.add(this.contentLayerViews.on("change",l=>this._layerViewsChanged(l)));this._layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}var n=w.prototype;n.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};n._layerViewsChanged=function(f){f.added.forEach(l=>{"esri.views.3d.layers.SceneLayerView3D"===
l.declaredClass&&this.handles.add(l.on("visible-geometry-changed",()=>this._contentChanged()),l.uid)});f.removed.forEach(l=>this.handles.remove(l.uid))};n._contentChanged=function(){this.events.emit("request-update",h)};return w}();const h={};a.ContentGeometryUpdates=g;a.default=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/Focus":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/support/ray ../PropertiesPool ./PointOfInterest ../../webgl-engine/lib/Camera ../../../support/Scheduler".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r){const x=Array;a.Focus=function(A){function p(D){D=A.call(this,D)||this;D._propertiesPool=new v.PropertiesPool({location:m,renderLocation:x},b._assertThisInitialized(D));D._dirty=!0;D.renderLocation=D._propertiesPool.get("renderLocation");return D}b._inheritsLoose(p,A);var B=p.prototype;B.initialize=function(){this.handles.add([this.centerOnSurface.watch("renderLocation",()=>this.updateRenderLocation()),this.state.watch("contentCamera",()=>this.updateRenderLocation())]);
this.scheduler&&this.handles.add(this.scheduler.registerTask(r.TaskPriority.POINT_OF_INTEREST_FREQUENT,this))};B.destroy=function(){this._propertiesPool.destroy();this._propertiesPool=null};B.runTask=function(){var D=this._get("renderLocation");const C=this.centerOnSurface.renderLocation;var F=this.renderCoordsHelper,G=this.state.contentCamera;this._dirty=!1;F.worldUpAtPosition(C,u);F=Math.max(0,(Math.acos(e.dot(u,G.viewForward))-.5*Math.PI)*(G.aboveGround?1:-1));Number.isNaN(F)?D&&e.equals(D,C)||
(D=this._propertiesPool.get("renderLocation"),e.copy(D,C),this._set("renderLocation",D)):(F=1-g.clamp(F/(.5*Math.PI),0,1),F*=F*F,this._calculateScreenHorizontalEdgeOnSurface(y),G=this._propertiesPool.get("renderLocation"),e.lerp(G,C,y,F),D&&e.equals(D,G)||this._set("renderLocation",G))};B._calculateScreenHorizontalEdgeOnSurface=function(D){const C=this.state.contentCamera;var F=C.getRenderCenter(h.createRenderScreenPointArray3());F[1]=C.aboveGround?C.padding[t.PaddingSide.BOTTOM]:C.fullHeight-C.padding[t.PaddingSide.TOP];
if(this.estimateSurfaceIntersectionAtRenderPoint(F,D))return D;const G=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);return C.unprojectFromRenderScreen(F,E)&&(e.subtract(E,E,C.eye),F=e.normalize(E,E),this.renderCoordsHelper.intersectManifold(z.wrap(C.eye,F),G,D))?D:this.renderCoordsHelper.setAltitude(D,G,C.eye)};B.updateRenderLocation=function(){this._dirty=!0};b._createClass(p,[{key:"updating",get:function(){return this._dirty||this.centerOnSurface.updating}},{key:"location",
get:function(){const D=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,D,this.state.spatialReference);return D}},{key:"running",get:function(){return this._dirty}}]);return p}(q.PointOfInterest);c.__decorate([w.property()],a.Focus.prototype,"_dirty",void 0);c.__decorate([w.property({constructOnly:!0})],a.Focus.prototype,"scheduler",void 0);c.__decorate([w.property({constructOnly:!0})],a.Focus.prototype,"centerOnSurface",void 0);c.__decorate([w.property({constructOnly:!0})],
a.Focus.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0);c.__decorate([w.property({readOnly:!0})],a.Focus.prototype,"updating",null);c.__decorate([w.property({readOnly:!0})],a.Focus.prototype,"location",null);c.__decorate([w.property({readOnly:!0})],a.Focus.prototype,"renderLocation",void 0);a.Focus=c.__decorate([k.subclass("esri.views.3d.support.CenterOnSurface")],a.Focus);const u=d.create(),E=d.create(),y=d.create();a.default=a.Focus;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/support/aaBoundingRect".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q){a.StableSurfaceCenter=function(t){function r(u){u=t.call(this,u)||this;u.location=null;u._updateController=null;u._handles=new h;return u}b._inheritsLoose(r,t);var x=r.prototype;x.initialize=function(){this.view.state.isLocal&&(this._handles.add([this.watch(["surfaceView.spatialReference","surfaceView.extent"],()=>this._update()),f.on(this,"surface.layers","change",()=>this._update())]),this._update())};x.destroy=function(){this._handles.destroy()};x._update=
function(){this._updateController&&(this._updateController.abort(),this._updateController=null);if(this.surfaceView&&!w.isNone(this.surfaceView.extent)&&this.surfaceView.spatialReference){var u=q.center(this.surfaceView.extent);u=new v({x:u[0],y:u[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(u,{noDataValue:0,signal:this._updateController.signal,
cache:this.cache}).then(E=>{this._updateController=null;this._set("location",E.geometry)}).catch(E=>{n.isAbortError(E)||E&&"elevation-query:invalid-layer"===E.name||console.error("StableSurfaceCenter failed to update: ",E)})):this._set("location",u)}else this._set("location",null)};b._createClass(r,[{key:"renderLocation",get:function(){if(!this.location)return null;const u=z.create();this.view.renderCoordsHelper.toRenderCoords(this.location,u);return u}}]);return r}(g);c.__decorate([l.property({constructOnly:!0})],
a.StableSurfaceCenter.prototype,"view",void 0);c.__decorate([l.property({constructOnly:!0})],a.StableSurfaceCenter.prototype,"cache",void 0);c.__decorate([l.property({readOnly:!0,aliasOf:"view.map.ground"})],a.StableSurfaceCenter.prototype,"surface",void 0);c.__decorate([l.property({readOnly:!0,aliasOf:"view.basemapTerrain"})],a.StableSurfaceCenter.prototype,"surfaceView",void 0);c.__decorate([l.property({readOnly:!0})],a.StableSurfaceCenter.prototype,"location",void 0);c.__decorate([l.property({readOnly:!0})],
a.StableSurfaceCenter.prototype,"renderLocation",null);a.StableSurfaceCenter=c.__decorate([m.subclass("esri.views.3d.terrain.StableSurfaceCenter")],a.StableSurfaceCenter);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../support/Scheduler".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v){a.SurfaceGeometryUpdates=function(u){function E(){var A=u.apply(this,arguments)||this;A.handles=new w;A._tileGeometryUpdateExtent=z.empty();A._tileGeometryUpdateSpatialReference=null;A.events=new h;A.updating=!1;return A}b._inheritsLoose(E,u);var y=E.prototype;y.initialize=function(){this.handles.add([this.surface.on("elevation-change",A=>this._tileGeometryChanged(A)),this.scheduler.registerTask(v.TaskPriority.SURFACE_GEOMETRY_UPDATES,this)])};y.destroy=function(){this.handles=
n.destroyMaybe(this.handles)};y.runTask=function(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",q),z.empty(this._tileGeometryUpdateExtent),this._set("updating",!1))};y._tileGeometryChanged=function(A){this._tileGeometryUpdateSpatialReference=A.spatialReference;z.expand(this._tileGeometryUpdateExtent,A.tile.extent,this._tileGeometryUpdateExtent);this._set("updating",!0)};y._furthestCenterOnSurface=
function(){let A=this.centerOnSurfaces[0];for(let p=1;p<this.centerOnSurfaces.length;p++){const B=this.centerOnSurfaces[p];B.distance>A.distance&&(A=B)}return A};y._centerIntersectsExtent=function(A,p){const B=this.state.camera.eye,D=x,C=this._furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(B,t,p);this.renderCoordsHelper.fromRenderCoords(C.renderLocation,r,p);t[0]<r[0]?(D[0]=t[0],D[2]=r[0]):(D[0]=r[0],D[2]=t[0]);t[1]<r[1]?(D[1]=t[1],D[3]=r[1]):(D[1]=r[1],D[3]=t[1]);return z.intersects(D,
A)};b._createClass(E,[{key:"running",get:function(){return this.updating}}]);return E}(g);c.__decorate([f.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"state",void 0);c.__decorate([f.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"centerOnSurfaces",void 0);c.__decorate([f.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"renderCoordsHelper",void 0);c.__decorate([f.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"scheduler",void 0);
c.__decorate([f.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"surface",void 0);c.__decorate([f.property({readOnly:!0})],a.SurfaceGeometryUpdates.prototype,"updating",void 0);a.SurfaceGeometryUpdates=c.__decorate([d.subclass("esri.views.3d.support.SurfaceGeometryUpdates")],a.SurfaceGeometryUpdates);const q={},t=m.create(),r=m.create(),x=z.empty();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TerrainSurface":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/arrayUtils ../../../core/CollectionFlattener ../../../core/Evented ../../../core/Handles ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/aliasOf ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../layers/mixins/RefreshableLayer ../../../layers/support/ElevationQueryTileCache ../../../layers/support/layerUtils ../../../layers/support/LercDecoder ../../2d/engine/vectorTiles/VectorTile ../layers/ElevationLayerView3D ../support/cameraUtils ../support/debugFlags ../support/extentUtils ../support/index ../support/updatingProperties ./ElevationBounds ./ElevationData ./ExtentHelper ./interfaces ./LayerClass ./OverlayManager ./PlanarPatch ./RenderOrder ./SphericalPatch ./TerrainConst ./TerrainRenderer ./TerrainSurfacePerformanceInfo ./terrainUtils ./Tile ./TilePerLayerInfo ./TileUpdate ./tileUtils ./TilingSchemeLogic ./UpsampleInfo ../webgl-engine/lib/basicInterfaces ../../support/Scheduler ../../support/WatchUpdatingTracking".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H,M,K,I,O,Q,J,P,N,R,S,T,V,W,U,aa,da,Y,ea,ja,la,ia,ca,fa,ba,Z,ha,na,pa,xa,Da,ua,Fa,qa){function sa(fb,ka){return fb[0]===ka[0]&&fb[1]===ka[1]&&fb[2]===ka[2]}function ma(fb){return fb.isLeaf?!1:fb.children[0].shouldLoad||fb.children[1].shouldLoad||fb.children[2].shouldLoad||fb.children[3].shouldLoad||ma(fb.children[0])||ma(fb.children[1])||ma(fb.children[2])||ma(fb.children[3])}const ra=k.getLogger("esri.views.3d.terrain.TerrainSurface");
h=function(fb){function ka(Ca){var Ka=fb.call(this,Ca)||this;Ka._elevationBounds=new V.ElevationBounds;Ka._iteratorPool=new m(pa.IteratorPreorder,Oa=>Oa.remove=()=>Ka._iteratorPool.release(Oa));Ka._postorderIterator=new pa.IteratorPostorder;Ka._hasPendingUpdates=!1;Ka._pendingUpdates=0;Ka._asyncWorkItems=0;Ka._allTilesDirty=!0;Ka._allTilesSorted=!0;Ka._visible=!1;Ka._usedMemory=-1;Ka._performanceInfo=new fa;Ka._viewChanged=!1;Ka._inFrameTask=!1;Ka._viewChangeUpdateDirty=!1;Ka._eyePosRenderSR=D.create();
Ka._eyePosSurfaceSR=D.create();Ka._splitLimits=new Z.SplitLimits;Ka._snapLevel=Infinity;Ka._frustum=H.create();Ka._viewProjectionMatrix=p.create();Ka._layerViews=[[],[]];Ka._layerIndexByUid=[new Map,new Map];Ka._basemapLayerViewHandles=new Map;Ka._handles=new l;Ka._watchUpdatingTracking=new qa.WatchUpdatingTracking;Ka._frameTask=Fa.ImmediateTask;Ka._allTiles=new z;Ka._upsampleInfoPool=new m(Da.UpsampleInfo);Ka._rootTilesExtent=L.create();Ka._maxNumUpdating=1;Ka.maxTextureScale=1.2;Ka.backgroundImage=
ia.DEFAULT_TILE_BACKGROUND;Ka.backgroundColor=null;Ka._layerViewsDirty=!1;return Ka}b._inheritsLoose(ka,fb);var cb=ka.prototype;cb.initialize=function(){this._lercDecoder=O.acquireDecoder(this.view.resourceController);this._tilePool=this.view.state.isLocal?new m(ea.PlanarPatch):new m(la.SphericalPatch);var Ca=this.view.resourceController.memoryController;this._upsampleMapCache=Ca.newCache("esri.views.3d.terrain.upsample",Ka=>Ka.unloadMapData());this._elevationQueryCache=new K.ElevationQueryTileCache(Ca.newCache("elevation-query"));
this._set("overlayManager",new Y.OverlayManager({surface:this}));this._handles.add([this.watch("overlayManager.hasHighlights",Ka=>this._renderer.setNeedsHighlight(Ka)),this.watch("overlayManager.rendersOccluded",Ka=>this._renderer.setRenderOccludedOverlay(Ka))],"overlayManager");this._renderer=new ca({overlayRenderer:this.overlayManager.renderer,ellipsoidRadius:G.getReferenceEllipsoid(this.view.spatialReference).radius,stage:this.view._stage,allTiles:this._allTiles});this._handles.add([t.init(this,
"baseOpacity",Ka=>{this._handleLayerViewChanges();this._updateBaseOpacity(Ka)},!0),t.init(this,"_background",()=>{this._handleLayerViewChanges();this._renderer.setTileBackground(this._background)},!0),this.view.watch("pointsOfInterest",Ka=>{this._renderer.pointsOfInterest=Ka;this._watchUpdatingTracking.removeAll();Ka&&this._watchUpdatingTracking.add(()=>Ka.focus.renderLocation,()=>()=>this._allTilesSorted=!1)}),t.init(N,"TERRAIN_TILE_TREE_SHOW_TILES",Ka=>{Ka&&!this._treeDebugger?(new Promise((Oa,
wa)=>a(["../layers/support/TerrainTileTree3DDebugger"],Oa,wa))).then(({TerrainTileTree3DDebugger:Oa})=>{!this._treeDebugger&&N.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new Oa({view:this.view}))}):Ka||(this._treeDebugger=d.destroyMaybe(this._treeDebugger))})]);this._extentHelper=U.create(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:this.view.spatialReference});Ca=this.view.defaultsFromMap?new n({getCollections:()=>{var Ka,Oa,wa;return null==
(Ka=this.view)?void 0:null==(Oa=Ka.defaultsFromMap)?void 0:null==(wa=Oa.mapCollections)?void 0:wa.map(({layers:Aa})=>Aa)},getChildrenFunction:Ka=>Ka&&"layers"in Ka?Ka.layers:null}):this.view.map.allLayers;Ca=new xa.TilingSchemeLogic({layers:Ca,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",Ca);this._updateTilingScheme();this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(S.ClientType.ELEVATION);
this._mapDataRequester=this.view.resourceController.createStreamDataRequester(S.ClientType.BASEMAP);this._frameTask=this.view.resourceController.scheduler.registerTask(Fa.TaskPriority.TERRAIN_SURFACE,this);this.view.resourceController.memoryController.events.on("quality-changed",()=>this._viewChangeUpdate());this._handles.add([t.init(this._extentHelper,"stencilEnabledExtents",Ka=>this._renderer.setStencilEnabledLayerExtents(Ka)),this.tilingSchemeLogic.watch("tilingScheme",()=>this._updateTilingScheme(),
!0),t.init(this,"extent",()=>this._updateRootTiles()),this.view.on("resize",()=>this._viewChangeUpdate()),this.view.watch("state.camera",()=>this._viewChangeUpdate(),!0),this.view.watch("state.contentCamera",()=>this.view.state.fixedContentCamera&&this._viewChangeUpdate(),!0),this.view.watch("qualitySettings.tiledSurface.lodBias",()=>this._viewChangeUpdate()),t.init(this.view,"qualitySettings.tiledSurface.textureFadeDuration",Ka=>this._renderer.textureFadingEnabled=0<Ka),this.view.watch("lodSnapping",
()=>this._viewChangeUpdate()),q.watch(()=>this._userClippingExtent,()=>this._updateClippingExtent(),q.sync)]);this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0));this._layerViewsDirty=!0;this._handleLayerViewChanges()};cb.destroy=function(){this._frameTask.remove();this._handles.destroy();this._watchUpdatingTracking.destroy();this._lercDecoder=d.releaseMaybe(this._lercDecoder);this._removeAllTiles();this._upsampleMapCache=d.destroyMaybe(this._upsampleMapCache);
this._elevationQueryCache=d.destroyMaybe(this._elevationQueryCache);this._set("tilingSchemeLogic",d.destroyMaybe(this.tilingSchemeLogic));this._extentHelper=d.destroyMaybe(this._extentHelper);this._basemapLayerViewHandles.forEach((Ca,Ka)=>this._unregisterTiledLayerView(Ka));this._mapDataRequester=this._elevationDataRequester=null;this._set("overlayManager",d.destroyMaybe(this.overlayManager));this._tilePool=d.destroyMaybe(this._tilePool);Z.Tile.prune();this._treeDebugger&&(this._treeDebugger.destroy(),
this._treeDebugger=null);this._renderer=d.destroyMaybe(this._renderer);this._iteratorPool=d.destroyMaybe(this._iteratorPool);this._set("view",null);this._upsampleInfoPool=d.destroyMaybe(this._upsampleInfoPool);Q.printAllocations();ha.printAllocations()};cb.intersect=function(Ca,Ka,Oa,wa){this._renderer.intersect(Ca,Ka,Oa,wa)};cb.getElevation=function(Ca,Ka,Oa,wa){Ca=this.getTileWithElevation(Ca,Ka,Oa,wa,va);return d.isNone(Ca)?null:W.sampleElevation(va[0],va[1],Ca.renderData.geometryState.samplerData)};
cb.getTileWithElevation=function(Ca,Ka,Oa,wa,Aa=va){var Na;const Ua=this.rootTiles;if(d.isNone(Ua)||!Ua.length||0===Ua[0].layerInfo[da.LayerClass.ELEVATION].length)return null;Aa[0]=Ca;Aa[1]=Ka;Aa[2]=Oa;if(!F.projectVectorToVector(Aa,wa,Aa,null==(Na=this.tilingScheme)?void 0:Na.spatialReference))return ra.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(let Ya of Ua)if(Ya.containsPoint(Aa)){for(;Ya&&!Ya.rendered&&!Ya.isLeaf;)Ca=0,Aa[0]>
.5*(Ya.extent[0]+Ya.extent[2])&&(Ca+=1),Aa[1]<.5*(Ya.extent[1]+Ya.extent[3])&&(Ca+=2),Ya=Ya.children[Ca];if((Aa=Ya.renderData)&&Aa.geometryState.samplerData)return Ya;break}return null};cb.getScale=function(Ca){if(this.tilingScheme){if(!F.projectPointToVector(Ca,va,this.spatialReference))return ra.error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;Ca=this.rootTiles;if(d.isSome(Ca))for(let Ka of Ca)if(Ka.containsPoint(va)){for(;null!=Ka.children[0];)Ca=
0,va[0]>Ka.children[0].extent[2]&&(Ca+=1),va[1]<Ka.children[0].extent[1]&&(Ca+=2),Ka=Ka.children[Ca];return this._getLodBiasCorrectedScale(Ka.level)}}return 1E100};cb.getSphereScale=function(Ca,Ka){if(!this.tilingScheme)return null;if(!F.projectPointToVector(Ca,va,this.spatialReference))return ra.error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;va[3]=Ka;let Oa=null;const wa=Aa=>{if(Aa&&L.intersectsSphere(Aa.extent,va))if(null!=Aa.children[0])for(const Na of Aa.children)wa(Na);
else Aa=this._getLodBiasCorrectedScale(Aa.level),Oa=null==Oa?Aa:Math.min(Oa,Aa)};Ca=this.rootTiles;if(d.isSome(Ca))for(const Aa of Ca)wa(Aa);return Oa};cb.queryVisibleScaleRange=function(Ca,Ka,Oa,wa){Ka=Ka?this.tilingScheme.levelAtScale(Ka):0;Oa=Oa?this.tilingScheme.levelAtScale(Oa):Infinity;const Aa=this.lodBias;this._renderer.queryVisibleLevelRange(Ca,Ka+Aa,Oa+Aa,wa)};cb._updateBaseOpacity=function(Ca){const Ka=this._renderer.opaque;this._renderer.opaque=1<=Ca;this._renderer.isTransparent=this._allTransparentSurfaceLayers();
Ca=Ka===this._renderer.opaque?aa.TextureUpdate.UNFADED:aa.TextureUpdate.IMMEDIATE;if(Ca===aa.TextureUpdate.IMMEDIATE){var Oa,wa;null==(Oa=this.view)?void 0:null==(wa=Oa._stage)?void 0:wa.renderView.setRenderParameters({opaqueTerrain:this.opaque})}this._updateTileTextures(Ca)};cb._updateTilingScheme=function(){const Ca=this.tilingSchemeLogic.tilingScheme;Ca!==this.tilingScheme&&(ba.weakAssert(!!Ca,"tiling scheme cannot be reset to undefined"),this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",
Ca),this._updateClippingExtent(),Ca&&(this._updateTiledLayers(),this._renderer.setTileSize(Ca.pixelSize),this.overlayManager.setSpatialReference(Ca.spatialReference),this._updateRootTiles()))};cb._acquireTile=function(Ca,Ka,Oa,wa){const Aa=this._tilePool.acquire();Ja[0]=Ca;Ja[1]=Ka;Ja[2]=Oa;Aa.init(Ja,wa,this);return Aa};cb._updateRootTiles=function(){const {extent:Ca,tilingScheme:Ka}=this;if(Ka){var Oa=Ia,wa=Ka.rootTilesInExtent(Ca,Oa,5*ia.MAX_ROOT_TILES);if(d.isSome(this.rootTiles)){if(wa.length>
ia.MAX_ROOT_TILES){ra.warn(ia.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);return}const Aa=this.rootTiles.map(Ua=>Ua.lij),Na=w.difference(Aa,wa,sa);if(0<Na.removed.length||0<Na.added.length){const Ua=this.rootTiles.filter(Ya=>-1<Na.removed.findIndex(ya=>sa(ya,Ya.lij))?(this._purgeTile(Ya),!1):!0);Na.added.forEach(Ya=>Ua.push(this._newRootTile(Ya)));this._setRootTiles(Ua)}}else wa.length>ia.MAX_ROOT_TILES&&(ra.warn(ia.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),wa=Ka.rootTilesInExtent(Ca,Oa,ia.MAX_ROOT_TILES)),
this._setRootTiles(wa.map(Aa=>this._newRootTile(Aa)));L.equals(Oa,this._rootTilesExtent)||(this._rootTilesExtent=L.create(Oa));this.visible=!0;this._viewChangeUpdate();this.overlayManager.setPlacementDirty();this.notifyChange("ready")}};cb._newRootTile=function(Ca){Ca=this._acquireTile(0,Ca[1],Ca[2],null);Ca.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===na.TileUpdate.SPLIT&&Ca.setPendingUpdate(na.TileUpdate.SPLIT);this._loadTile(Ca);return Ca};cb._setRootTiles=function(Ca){this._set("rootTiles",
Ca);this._allTiles.clear();if(d.isSome(Ca)){const Ka=this._iteratorPool.acquire();for(Ka.reset(Ca);!Ka.done;)this._allTiles.push(Ka.next());Ka.remove()}this._renderer.setRootTiles(this.rootTiles);this._updateTilesVisibility(Ca)};cb._runViewChangeUpdateIfDirty=function(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())};cb._viewChangeUpdate=function(){this.view&&!this.suspended&&this.tilingScheme&&this._visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:
(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateSkirts(),this._updateTilesVisibility(this.rootTiles)))};cb._updateClippingStatus=function(Ca){Ca.updateClippingStatus(this.extent)&&Ca.resetPendingUpdate(na.TileUpdate.GEOMETRY)&&this._updateTileGeometry(Ca)};cb._updateTilesVisibility=function(Ca){if(!d.isNone(Ca)){var Ka=pa.hasLoadableSiblings(Ca),Oa=Ka?this._elevationBounds.min:Infinity;Ka=Ka?this._elevationBounds.max:-Infinity;var wa=this.view.state.fixedContentCamera,
Aa=this.extent,Na=this._viewProjectionMatrix;this.setTileTreeDirty();var Ua=this._iteratorPool.acquire();for(Ua.reset(Ca);!Ua.done;){Ca=Ua.next();Ca.updateClippingStatus(Aa)&&Ca.resetPendingUpdate(na.TileUpdate.GEOMETRY)&&this._updateTileGeometry(Ca);Ca.setPendingUpdate(na.TileUpdate.RENDERDATA);const Ya=Ca.computeVisibility();wa||Ya?(Ca.updateScreenDepth(Na),Ca.renderData&&(Oa=Math.min(Ca.elevationBounds[0],Oa),Ka=Math.max(Ca.elevationBounds[1],Ka))):Ua.skipSubtree()}Ua.remove();this._allTilesDirty=
this._viewChanged=!0;isFinite(Oa)&&isFinite(Ka)&&(this._elevationBounds.min!==Oa||this._elevationBounds.max!==Ka)&&(this._elevationBounds.min=Oa,this._elevationBounds.max=Ka,this.emit("elevation-bounds-change",null))}};cb._updateViewDependentParameters=function(){const Ca=this.view.state.camera,Ka=this.view.state.contentCamera,Oa=Math.tan(.5*Ka.fovX),wa=Math.tan(.5*Ka.fovY),Aa=this.tilingScheme.pixelSize,Na=2**-this.lodBias*Ca.pixelRatio;this._splitLimits.aboveGround=Ca.aboveGround;this._splitLimits.fovX=
Oa;this._splitLimits.fovY=wa;this._splitLimits.relativeWidthLimit=Aa/Ca.width*this.maxTextureScale*Na;this._splitLimits.relativeHeightLimit=Aa/Ca.height*this.maxTextureScale*Na;this._splitLimits.maxLod=this.tilingScheme.getMaxLod();this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias;this.view.state.fixedContentCamera?(d.isNone(this._splitLimits.frustum)&&(this._splitLimits.frustum=H.create()),H.copy(this._splitLimits.frustum,Ka.frustum)):this._splitLimits.frustum=
null;H.copy(this._frustum,Ca.frustum);A.multiply(this._viewProjectionMatrix,Ka.projectionMatrix,Ka.viewMatrix);B.copy(this._eyePosRenderSR,Ka.eye);F.projectVectorToVector(Ca.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)};cb._updateSkirts=function(){const Ca=this.view.state.camera;this.skirtScale=ba.computeSkirtScale(this,this._eyePosSurfaceSR,this.view.state.constraints.collision.enabled?0:1.11*Ca.near)};cb._updateRenderData=function(Ca){Ca.rendered&&!Ca.shouldLoad&&
(ma(Ca)?this._loadChildren(Ca):Ca.isLeaf&&Ca.parent&&Ca.parent.shouldLoad&&this._loadParent(Ca))};cb._updateTileGeometry=function(Ca){Ca.updateVisibility();this._renderer.updateTileGeometry(Ca);this._elevationUpdate(Ca);this._usedMemory=-1};cb._updateTileTexture=function(Ca,Ka){const Oa=Ca.resetPendingUpdate(na.TileUpdate.TEXTURE_FADING)?na.TileUpdate.TEXTURE_FADING:Ca.resetPendingUpdate(na.TileUpdate.TEXTURE_NOFADING)?na.TileUpdate.TEXTURE_NOFADING:!1;Oa&&(this._renderer.updateTileTexture(Ca,Oa),
this._usedMemory=-1,Ka.madeProgress())};cb._elevationUpdate=function(Ca){Ta.spatialReference=this.spatialReference;Ta.tile=Ca;Ta.extent=Ca.extent;this.emit("elevation-change",Ta);L.containsPoint(Ca.extent,this._eyePosSurfaceSR)&&this._updateSkirts()};cb.runTask=function(Ca){this._handleLayerViewChanges(Ca);this._frameTask.processQueue(Ca);this._inFrameTask=!0;this._pendingUpdates=0;this._hasPendingUpdates=!1;this._updateTileStatus(Ca);this._sortTiles(Ca);const Ka=!this.view.state.fixedContentCamera;
this._mergeAndSplit(Ca,Ka);Ca.run(()=>this._updateElevation(Ca));Ca.run(()=>this._updateTextures(Ca));Ka||this._mergeAndSplit(Ca,!0);this._inFrameTask=!1;this._runViewChangeUpdateIfDirty();Ca.done&&this.requestUpdate();this.notifyChange("updatingProgressValue")};cb._updateTileStatus=function(Ca){if(this._viewChanged&&this.rootTiles&&!Ca.done){this._viewChanged=!1;var Ka=this._iteratorPool.acquire();for(Ka.reset(this.rootTiles);!Ka.done;){var Oa=Ka.next();if(Oa.loadable){var wa=Oa.shouldSplit(this._splitLimits,
this._eyePosRenderSR,this.lodSnapping);if(wa===na.TileUpdate.SPLIT){Oa.resetPendingUpdate(na.TileUpdate.MERGE);Oa.isLeaf&&(Oa.setPendingUpdate(na.TileUpdate.SPLIT),Ka.skipSubtree());continue}Oa.resetPendingUpdate(na.TileUpdate.SPLIT)&&Oa.updateAgentSuspension();wa===na.TileUpdate.VSPLITMERGE&&Oa.updateAgents(da.LayerClass.ELEVATION)}Ka.skipSubtree();if(!Oa.isLeaf){Oa.setPendingUpdate(na.TileUpdate.MERGE);Oa.resetPendingUpdate(na.TileUpdate.SPLIT);wa=this._iteratorPool.acquire();wa.resetOne(Oa);for(Oa=
wa.next();!wa.done;Oa=wa.next())this._updateClippingStatus(Oa),Oa.updateVisibility(),Oa.loadable&&Oa.updateScreenDepth(this._viewProjectionMatrix);wa.remove()}}Ka.remove();this.requestUpdate();Ca.madeProgress()}};cb._sortTiles=function(Ca){Ca.done||this._allTilesSorted||(pa.sortTilesByPOI(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),Ca.madeProgress())};cb._mergeAndSplit=function(Ca,Ka){if(!this.suspended&&!Ca.done&&
this._allTilesDirty){this._allTilesDirty=!1;this.requestUpdate();for(var Oa=0;!Ca.done;){let wa=!1;Oa=0;const Aa=!this._allTiles.some(Na=>{Oa+=Na.usedMemory;if(Na.resetPendingUpdate(na.TileUpdate.MERGE)){if(!Ka)return Na.setPendingUpdate(na.TileUpdate.MERGE),Ca.done;this._mergeTile(Na);wa=!0;Ca.madeProgress()}else Na.resetPendingUpdate(na.TileUpdate.SPLIT)&&(this._splitTile(Na),wa=!0,Ca.madeProgress());!Ca.done&&Na.resetPendingUpdate(na.TileUpdate.RENDERDATA)&&(this._updateRenderData(Na),Ca.madeProgress());
return Ca.done});wa&&(this._allTilesSorted=!1,this._allTilesDirty=!0);if(Aa){this._usedMemory=Oa;if(!wa)break;this._updateTilesVisibility(this.rootTiles)}else this._allTilesDirty=!0}0===Oa&&(this._allTilesDirty=!0);this._sortTiles(Ca)}};cb._updateElevation=function(Ca){this._allTiles.some(Ka=>{Ka.resetPendingUpdate(na.TileUpdate.GEOMETRY)&&(this._updateTileGeometry(Ka),this._updateTileTexture(Ka,Ca),Ca.madeProgress());return Ca.done});return Ca.hasProgressed};cb._updateTextures=function(Ca){this._allTiles.some(Ka=>
{this._updateTileTexture(Ka,Ca);return Ca.done});return Ca.hasProgressed};cb._updateClippingExtent=function(){this.spatialReference&&(this.updateTileOverlayParams(ua.RenderRequestType.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())};cb._getLodBiasCorrectedScale=function(Ca){const Ka=this.tilingScheme.levels;Ca=e.clamp(Ca-this.lodBias,0,Ka.length-1);const Oa=Ca-Math.floor(Ca);return Ka[Math.floor(Ca)].scale*(1-Oa)+Ka[Math.ceil(Ca)].scale*Oa};cb._removeAllTiles=function(){d.isSome(this.rootTiles)&&
(this.rootTiles.forEach(Ca=>this._purgeTile(Ca)),this._setRootTiles(null),this.notifyChange("ready"));this._allTiles.clear();this.visible=!1};cb._purgeChildTiles=function(Ca){if(Ca.isLeaf)return!1;let Ka=this._purgeTile(Ca.children[0]);Ka=this._purgeTile(Ca.children[1])||Ka;Ka=this._purgeTile(Ca.children[2])||Ka;Ka=this._purgeTile(Ca.children[3])||Ka;Ca.unsetChildren();return Ka};cb._purgeTile=function(Ca){const Ka=this._purgeChildTiles(Ca)||Ca.rendered;this._allTiles.removeUnordered(Ca);Ca.unload(this._renderer);
this._tilePool.release(Ca);return Ka};cb._splitTile=function(Ca){ba.weakAssert(Ca.isLeaf,"tile that is already split should not be split again!");const Ka=Ca.level+1,Oa=2*Ca.lij[1],wa=2*Ca.lij[2];Ca.setChildren(this._createTile(Ka,Oa,wa,Ca),this._createTile(Ka,Oa,wa+1,Ca),this._createTile(Ka,Oa+1,wa,Ca),this._createTile(Ka,Oa+1,wa+1,Ca));Ca.setPendingUpdate(na.TileUpdate.RENDERDATA);Ca.updateAgentSuspension();this._allTiles.pushArray(Ca.children);this._allTilesDirty=!0;this._emitTileScaleChange(Ca,
Ka);++this._performanceInfo.numSplit};cb._emitTileScaleChange=function(Ca,Ka=Ca.level){db.spatialReference=this.spatialReference;db.extent=Ca.extent;db.scale=this._getLodBiasCorrectedScale(Ka);this.emit("scale-change",db)};cb._createTile=function(Ca,Ka,Oa,wa){ba.weakAssert(!!wa,"_createTile sanity check");Ca=this._acquireTile(Ca,Ka,Oa,wa);Ca.updateClippingStatus(this.extent);Ca.loadable&&(Ca.updateScreenDepth(this._viewProjectionMatrix),Ca.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===
na.TileUpdate.SPLIT&&Ca.setPendingUpdate(na.TileUpdate.SPLIT));return Ca};cb._mergeTile=function(Ca){ba.weakAssert(!Ca.hasPendingUpdate(na.TileUpdate.SPLIT),"_mergeTile sanity check");this._purgeChildTiles(Ca)&&(ba.weakAssert(!Ca.renderData,"_mergeTile sanity check"),this._loadTile(Ca));this._allTilesDirty=!0;++this._performanceInfo.numMerged;this._emitTileScaleChange(Ca)};cb._loadChildren=function(Ca){ba.weakAssert(Ca.rendered,"parent should be rendered");Ca.unload(this._renderer);this._loadTile(Ca.children[0]);
this._loadTile(Ca.children[1]);this._loadTile(Ca.children[2]);this._loadTile(Ca.children[3])};cb._loadParent=function(Ca){Ca=Ca.parent;this._unloadChildren(Ca);this._loadTile(Ca)};cb._unloadChildren=function(Ca){Ca.isLeaf||(this._unloadChildren(Ca.children[0]),Ca.children[0].unload(this._renderer),this._unloadChildren(Ca.children[1]),Ca.children[1].unload(this._renderer),this._unloadChildren(Ca.children[2]),Ca.children[2].unload(this._renderer),this._unloadChildren(Ca.children[3]),Ca.children[3].unload(this._renderer))};
cb._loadTile=function(Ca){Ca.load(this._renderer);Ca.setPendingUpdate(na.TileUpdate.RENDERDATA);this.requestUpdate();this._allTilesDirty=!0;this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(Ca);this._elevationUpdate(Ca)};cb._elevationDataArrived=function(Ca,Ka,Oa){Oa=new W.ElevationData(Ca.lij,Ca.extent,Oa);Ca.dataArrived(Ka,da.LayerClass.ELEVATION,Oa);Oa=[Ca];Ca=Ca.level;const wa=this._iteratorPool.acquire();for(wa.reset(Oa);!wa.done;){const Aa=wa.next();
Aa.findElevationBoundsForLayer(Ka,Ca);Aa.computeElevationBounds()}wa.remove();this._updateTilesVisibility(Oa)};cb._handleLayerViewChanges=function(Ca=Fa.noBudget){if(this._layerViewsDirty){var Ka=this._layerViewsDirty=!1,Oa=new Set,wa=-1;for(const Na of this.view.allLayerViews.items)if(Oa.add(Na.uid),ba.isSurfaceLayerView(Na))if(this._basemapLayerViewHandles.has(Na.uid)){var Aa=this._layerClassFromLayerView(Na);Aa=this._layerIndexByUid[Aa].get(Na.uid);Aa<wa&&(Ka=!0);wa=Aa}else this._registerTiledLayerView(Na),
Na.layer.loaded&&(Ka=!0);this._basemapLayerViewHandles.forEach((Na,Ua)=>{Oa.has(Ua)||(this._unregisterTiledLayerView(Ua),Ka=!0)});Ka&&this._updateTiledLayers();this._renderer.isTransparent=this._allTransparentSurfaceLayers();Ca.madeProgress()}};cb._allTransparentSurfaceLayers=function(){var Ca,Ka;let Oa=0===(null==(Ca=this.view.map)?void 0:null==(Ka=Ca.ground)?void 0:Ka.opacity);for(const wa of this.view.allLayerViews.items)if(ba.isSurfaceLayerView(wa)&&!ba.isElevationLayerView(wa)&&!I.isBaseLayer(wa.layer)&&
0!==wa.fullOpacity){Oa=!1;break}return Oa};cb._layerClassFromLayerView=function(Ca){return ba.isElevationLayerView(Ca)?da.LayerClass.ELEVATION:da.LayerClass.MAP};cb._registerTiledLayerView=function(Ca){const Ka=[],Oa=this._layerClassFromLayerView(Ca);Ka.push(Ca.watch("suspended",()=>this._updateTiledLayers()));Ka.push(Ca.watch("fullOpacity",()=>this._updateTileTextures(aa.TextureUpdate.UNFADED)));Ka.push(Ca.layer.watch("effectiveScaleRange",()=>this._restartAllAgents(Oa)));Ca.on("data-changed",()=>
{const wa=this._layerIndexByUid[Oa].get(Ca.uid);null!=wa&&this._invalidateLayerData(wa,Oa)});this._basemapLayerViewHandles.set(Ca.uid,Ka)};cb._unregisterTiledLayerView=function(Ca){const Ka=this._basemapLayerViewHandles.get(Ca);if(Ka){for(let Oa=0;Oa<Ka.length;Oa++)Ka[Oa].remove();this._basemapLayerViewHandles.delete(Ca)}};cb._updateTiledLayers=function(){if(this.tilingScheme&&!this.view.suspended){var Ca=this.view.allLayerViews,Ka=[[],[]],Oa=null,wa=L.empty();Ca.forEach(Na=>{var Ua=Na.layer;if(Ua&&
!Na.suspended&&ba.isSurfaceLayerView(Na)){var Ya=Na.fullExtent;Ya?(L.expand(wa,Ya,wa),Ua=this._layerClassFromLayerView(Na),Ua===da.LayerClass.MAP&&(Ya=Na.displayLevelRange,Infinity!==Ya.maxLevel&&(null===Oa||Ya.maxLevel>Oa)&&(Oa=Ya.maxLevel)),Ka[Ua].push(Na)):ra.warn("Terrain: Map or elevation layer does not have fullExtent: "+Ua.id)}});for(const Na of da.LayerClasses){var Aa=this._layerViews[Na];Ca=Ka[Na];Ca.reverse();const Ua=Ca.length;let Ya=Aa.length!==Ua;const ya=Array(Ua),La=Array(Aa.length);
this._layerIndexByUid[Na].clear();for(let Va=0;Va<Ua;Va++){this._layerIndexByUid[Na].set(Ca[Va].uid,Va);const hb=Aa.indexOf(Ca[Va]);ya[Va]=hb;Va!==hb&&(Ya=!0);-1<hb&&(La[hb]=Va)}if(Ya){Aa=this._postorderIterator;for(Aa.reset(this.rootTiles);!Aa.done;)Aa.next().modifyLayers(La,ya,Na);this._layerViews[Na]=Ca;this._restartAllAgents(Na);this._updateTilesVisibility(this.rootTiles)}}this.tilingScheme.ensureMaxLod(Oa)&&this._viewChangeUpdate()}};cb._restartAllAgents=function(Ca){const Ka=this._postorderIterator;
for(Ka.reset(this.rootTiles);!Ka.done;){const Oa=Ka.next();Oa.restartAgents(Ca);Ca===da.LayerClass.ELEVATION&&Oa.computeElevationBounds()}};cb.layerViewByIndex=function(Ca,Ka){return this._layerViews[Ka][Ca]};cb.numLayers=function(Ca){return this._layerViews[Ca].length};cb._updateTileTextures=function(Ca){this._allTiles.forAll(Ka=>{Ka.updateAgents(da.LayerClass.MAP);Ca===aa.TextureUpdate.IMMEDIATE?this.renderer.updateTileTexture(Ka,na.TileUpdate.TEXTURE_NOFADING):Ka.updateRenderData(da.LayerClass.MAP,
Ca)});this._renderer.isTransparent=this._allTransparentSurfaceLayers()};cb._invalidateLayerData=function(Ca,Ka){this._allTiles.forAll(Oa=>Oa.removeLayerAgent(Ca,Ka));this._allTiles.forAll(Oa=>Oa.invalidateLayerData(Ca,Ka))};cb.setTileTreeDirty=function(){this._allTilesDirty=!0};cb.requestRender=function(Ca=ua.RenderRequestType.UPDATE){this.renderer.setNeedsRender(Ca)};cb.requestUpdate=function(){1===++this._pendingUpdates&&(this._hasPendingUpdates=!0)};cb.requestTileData=function(Ca,Ka,Oa,wa){const Aa=
this.layerViewByIndex(Ka,Oa);Ka=Aa.layer;if(!Ka.tilemapCache||ba.isVectorTileLayerView(Aa))return this._requestTileData(Ca,Oa,Aa,wa);++this._asyncWorkItems;return Ka.tilemapCache.fetchAvailability(Ca.lij[0],Ca.lij[1],Ca.lij[2],{...wa,timeout:6E3}).then(()=>--this._asyncWorkItems).catch(Na=>{--this._asyncWorkItems;v.isAbortError(Na)||this._dataMissing(Ca,Oa,Aa,{notInTilemap:!0});throw Na;}).then(()=>this._frameTask.schedule(()=>this._requestTileData(Ca,Oa,Aa,wa),wa.signal))};cb._requestTileData=function(Ca,
Ka,Oa,wa){return Ka===da.LayerClass.ELEVATION?this._requestElevationTileData(Ca,Oa,wa):this._requestMapTileData(Ca,Oa,wa)};cb._requestElevationTileData=function(Ca,Ka,Oa){if(ba.isElevationLayerView(Ka)){var wa=Ua=>{--this._asyncWorkItems;if(!v.isAborted(Oa)){var Ya=this._layerIndexByUid[da.LayerClass.ELEVATION].get(Ka.uid);null==Ya?ra.warn("TerrainSurface: received data from unknown layer %d %s",da.LayerClass.ELEVATION,Ca.lij.toString()):(this._usedMemory=-1,this.requestUpdate(),this._elevationDataArrived(Ca,
Ya,Ua))}},Aa=Ua=>{--this._asyncWorkItems;v.isAbortError(Ua)||(this._dataMissing(Ca,da.LayerClass.ELEVATION,Ka,Ua),this.requestUpdate())};++this._asyncWorkItems;if(ba.useFetchTileForLayer(Ka.layer))return Ka.layer.fetchTile(Ca.lij[0],Ca.lij[1],Ca.lij[2],{noDataValue:ia.ELEVATION_NODATA_VALUE,signal:Oa.signal}).then(Ua=>{v.isAborted(Oa)?(ra.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),Aa(v.createAbortError())):
this._frameTask.schedule(()=>wa(Ua),Oa.signal,Aa)},Aa);var Na=Ka.getTileUrl(Ca.lij[0],Ca.lij[1],Ca.lij[2]);return this._elevationDataRequester.request(Na,"binary",Oa).then(Ua=>this._lercDecoder.decode(Ua,{noDataValue:ia.ELEVATION_NODATA_VALUE},Oa.signal)).then(Ua=>{wa({values:Ua.pixelData,width:Ua.width,height:Ua.height,noDataValue:Ua.noDataValue,minValue:Ua.minValue,maxValue:Ua.maxValue})},Aa)}ba.weakAssert(!1,"_requestElevationTileData can only be called for elevation layer views")};cb._requestMapTileData=
function(Ca,Ka,Oa){if(Ka instanceof J)return Promise.reject();++this._asyncWorkItems;const wa=(ya,La)=>{--this._asyncWorkItems;ba.releaseTileData(La);v.isAborted(Oa)||(this._dataMissing(Ca,da.LayerClass.MAP,Ka,ya),this.requestUpdate())},Aa=ya=>La=>wa(La,ya),Na=ya=>this._frameTask.schedule(()=>{--this._asyncWorkItems;this.requestUpdate();v.isAborted(Oa)?ba.releaseTileData(ya):this._mapTileDataArrived(Ca,Ka,ya)},Oa.signal,Aa(ya)).catch(Aa(ya)),Ua=(ya,La=null)=>this._frameTask.schedule(()=>wa(ya,La));
if(ba.isVectorTileLayerView(Ka)){var Ya=Ka.schemaHelper.getLevelRowColumn(Ca.lij);return Ka.fetchTile(Ya[0],Ya[1],Ya[2],Oa).then(Na,Ua)}if(ba.isImageryTileLayerView(Ka))return Ka.fetchTile(Ca.lij[0],Ca.lij[1],Ca.lij[2],Oa).then(Na,Ua);if(ba.isTileLayerView(Ka)&&ba.useFetchTileForLayer(Ka.layer))return Ka.layer.fetchTile(Ca.lij[0],Ca.lij[1],Ca.lij[2],Oa).then(ya=>{v.isAborted(Oa)?(ra.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),
Ua(v.createAbortError())):Na(ya)},Ua);Ya=Ka.getTileUrl(Ca.lij[0],Ca.lij[1],Ca.lij[2]);M.isRefreshableLayer(Ka.layer)&&Ka.layer.refreshTimestamp&&(Ya+=`${Ya.includes("?")?"\x26":"?"}_ts=${Ka.layer.refreshTimestamp}`);return this._mapDataRequester.request(Ya,Ka.hasMixedImageFormats?"image+type":"image",Oa).then(Na,Ua)};cb._mapTileDataArrived=function(Ca,Ka,Oa){Ka=this._layerIndexByUid[da.LayerClass.MAP].get(Ka.uid);null!=Ka?Ca.dataArrived(Ka,da.LayerClass.MAP,Oa):(ba.releaseTileData(Oa),ra.warn("TerrainSurface: received data from unknown layer"))};
cb._dataMissing=function(Ca,Ka,Oa,wa){Oa=this._layerIndexByUid[Ka].get(Oa.uid);null!=Oa?Ca.dataMissing(Oa,Ka,wa):ra.warn("TerrainSurface: received data from unknown layer")};cb.updateTileOverlayParams=function(Ca){this.rootTiles&&this.overlayManager&&(this._allTiles.forAll(Ka=>{Ka.renderData&&this.overlayManager.setTileParameters(Ka)}),this._renderer.setNeedsRender(Ca))};cb.getUsedMemory=function(){if(!this.tilingScheme)return 0;-1===this._usedMemory&&(this._usedMemory=0,this._allTiles.forAll(Ca=>
this._usedMemory+=Ca.usedMemory));return this._usedMemory};cb.getUsedMemoryForLayerView=function(Ca){let Ka=0;const Oa=this._layerClassFromLayerView(Ca),wa=this._layerIndexByUid[Oa].get(Ca.uid);this._allTiles.forAll(Aa=>Ka+=Aa.getUsedMemoryForLayer(Oa,wa));return Ka};cb.getTile=function(Ca){if(d.isNone(Ca)||d.isNone(this.rootTiles))return null;const Ka=Ca.split("/").map(Na=>+Na);if(0===Ka[0])return this.rootTiles.find(Na=>Na.lij[1]===Ka[1]&&Na.lij[2]===Ka[2]);Ca=2**Ka[0];const Oa=Math.floor(Ka[1]/
Ca),wa=Math.floor(Ka[2]/Ca);let Aa;this.rootTiles.some(Na=>Na.lij[1]===Oa&&Na.lij[2]===wa?(Aa=Na,!0):!1);if(Aa){for(Ca=1<<Ka[0]-1;Aa.lij[0]<Ka[0];){let Na=Ka[1]&Ca?2:0;0<(Ka[2]&Ca)&&Na++;if(!Aa.children[Na])return null;Aa=Aa.children[Na];Ca>>=1}ba.weakAssert(Aa.lij[0]===Ka[0]&&Aa.lij[1]===Ka[1]&&Aa.lij[2]===Ka[2],"not the right tile?");return Aa}return null};b._createClass(ka,[{key:"renderer",get:function(){return this._renderer}},{key:"frustum",get:function(){return this._frustum}},{key:"snapLevel",
get:function(){var Ca,Ka,Oa=null==(Ca=this.view.pointsOfInterest)?void 0:null==(Ka=Ca.contentCameraOnSurface)?void 0:Ka.scale;Oa&&(Ca=this.view.state.contentCamera,Ca=P.directionToHeadingTilt(this.view,Ca.eye,Ca.viewForward,Ca.up).tilt,90<Ca&&(Ca=180-Ca),Ca=2*(Ca/90)**2,Oa=P.scaleToZoom(this.view,Oa)-Ca,.25<Math.abs(this._snapLevel-Oa)&&(Math.round(Oa)!==Math.round(this._snapLevel)&&(this._viewChanged=!0),this._snapLevel=Oa));return Math.round(this._snapLevel)}},{key:"lodSnapping",get:function(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?
aa.LODSnapping.ON:aa.LODSnapping.OFF}},{key:"upsampleInfoPool",get:function(){return this._upsampleInfoPool}},{key:"upsampleMapCache",get:function(){return this._upsampleMapCache}},{key:"elevationQueryCache",get:function(){return this._elevationQueryCache}},{key:"mapTileRequester",get:function(){return this._mapDataRequester}},{key:"_userClippingExtent",get:function(){var {spatialReference:Ca}=this,{clippingArea:Ka}=this.view;if(d.isNone(Ka)||d.isNone(Ca))return null;const Oa=L.create();Ca=R.toBoundingRect(Ka,
Oa,Ca)?Oa:null;Ka=this._get("extent");return L.equals(Ca,Ka)?Ka:Ca}},{key:"extent",get:function(){const Ca=L.intersection(this.groundExtent,this._userClippingExtent,L.create()),Ka=this._get("extent");return L.equals(Ca,Ka)?Ka:Ca}},{key:"groundExtent",get:function(){return d.isSome(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}},{key:"_tilingSchemeExtent",get:function(){var Ca;return null==(Ca=this.tilingSchemeLogic)?void 0:Ca.extent}},{key:"updating",get:function(){this._hasPendingUpdates||
(this._maxNumUpdating=1);return!!((this._watchUpdatingTracking.updating||this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||0<this._asyncWorkItems||!this._allTilesSorted||this._renderer.updating||this._layerViewsDirty)&&this.ready&&!this.suspended||this.overlayManager.updating||this._frameTask.updating)}},{key:"updatingProgressValue",get:function(){this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating);return 1-this._pendingUpdates/this._maxNumUpdating}},{key:"viewingMode",
get:function(){return this.view.state.viewingMode}},{key:"ready",get:function(){return d.isSome(this.rootTiles)}},{key:"renderOrder",set:function(Ca){this._renderer.renderOrder=Ca;this._set("renderOrder",Ca)}},{key:"skirtScale",get:function(){return this._renderer.skirtScale},set:function(Ca){this._renderer.skirtScale=Ca}},{key:"spatialReference",get:function(){var Ca,Ka;return null!=(Ca=null==(Ka=this.tilingScheme)?void 0:Ka.spatialReference)?Ca:null}},{key:"_background",get:function(){return null!=
this.backgroundColor?this.backgroundColor:this.backgroundImage}},{key:"slicePlaneEnabled",set:function(Ca){var Ka,Oa;this._renderer.slicePlaneEnabled=Ca;this._set("slicePlaneEnabled",Ca);null==(Ka=this.view)?void 0:null==(Oa=Ka._stage)?void 0:Oa.renderView.setRenderParameters({opaqueTerrain:this.opaque})}},{key:"velvetOverground",set:function(Ca){Ca!==this.velvetOverground&&(this._renderer.velvetOverground=Ca);this._set("velvetOverground",Ca)}},{key:"visible",set:function(Ca){Ca!==this._visible&&
(this._visible=Ca,this._renderer.setVisibility(Ca),this.suspended=!Ca)}},{key:"opaque",get:function(){return this._renderer.opaque}},{key:"suspended",set:function(Ca){this._set("suspended",Ca);this._viewChangeUpdate()}},{key:"elevationBounds",get:function(){return this._elevationBounds}},{key:"running",get:function(){return this.updating&&this.ready&&!this.suspended}},{key:"lodBias",get:function(){return this.view.qualitySettings.tiledSurface.lodBias-(1-this.view.resourceController.memoryController.memoryFactor)*
ia.MAX_MEMORY_LOD_BIAS}},{key:"performanceInfo",get:function(){const Ca=this._performanceInfo;Ca.numNodes=this._allTiles.length;Ca.numLeaves=Ca.numVisible=Ca.numRendered=Ca.numLoadedPerLevel.length=Ca.numRenderedPerLevel.length=0;this._allTiles.forAll(Ka=>{Ka.isLeaf&&Ca.numLeaves++;const Oa=Ka.level;Ka.renderData&&(Ca.numLoadedPerLevel[Oa]=(Ca.numLoadedPerLevel[Oa]||0)+1);Ka.visible&&(Ca.numVisible++,Ka.rendered&&(Ca.numRenderedPerLevel[Oa]=(Ca.numRenderedPerLevel[Oa]||0)+1,Ca.numRendered++))});return Ca}},
{key:"test",get:function(){const Ca=this;return{renderer:Ca._renderer,lercDecoder:Ca._lercDecoder,forceReload:()=>{d.isSome(Ca.rootTiles)&&(Ca._mergeTile(Ca.rootTiles[0]),Ca._viewChangeUpdate())},getTiles:()=>Ca._allTiles.toArray(),getRenderedTiles(){Ha.clear();Ca._allTiles.forAll(Oa=>{Oa.visible&&Oa.rendered&&Ha.push(Oa)});const Ka=Ha.toArray();pa.sortTiles(Ca.renderOrder,Ka);return Ka},lockTilingScheme(Ka,Oa){Ca._extentHelper.defaultTiledLayersExtent=Oa;Ca.tilingSchemeLogic.test.lockTilingScheme(Ka)}}}}]);
return ka}(f.EventedMixin(h));c.__decorate([E.property()],h.prototype,"_renderer",void 0);c.__decorate([E.property()],h.prototype,"_hasPendingUpdates",void 0);c.__decorate([E.property()],h.prototype,"_asyncWorkItems",void 0);c.__decorate([E.property()],h.prototype,"_allTilesDirty",void 0);c.__decorate([E.property()],h.prototype,"_allTilesSorted",void 0);c.__decorate([E.property()],h.prototype,"_viewChanged",void 0);c.__decorate([E.property({readOnly:!0})],h.prototype,"_watchUpdatingTracking",void 0);
c.__decorate([E.property()],h.prototype,"_frameTask",void 0);c.__decorate([E.property({readOnly:!0})],h.prototype,"snapLevel",null);c.__decorate([E.property({readOnly:!0})],h.prototype,"lodSnapping",null);c.__decorate([E.property({constructOnly:!0})],h.prototype,"view",void 0);c.__decorate([E.property()],h.prototype,"_userClippingExtent",null);c.__decorate([E.property()],h.prototype,"_rootTilesExtent",void 0);c.__decorate([E.property({readOnly:!0})],h.prototype,"extent",null);c.__decorate([E.property({readOnly:!0})],
h.prototype,"groundExtent",null);c.__decorate([E.property({readOnly:!0})],h.prototype,"_tilingSchemeExtent",null);c.__decorate([E.property({readOnly:!0})],h.prototype,"updating",null);c.__decorate([E.property(T.updatingProgress)],h.prototype,"updatingProgress",void 0);c.__decorate([E.property({readOnly:!0})],h.prototype,"updatingProgressValue",null);c.__decorate([E.property()],h.prototype,"_maxNumUpdating",void 0);c.__decorate([E.property({aliasOf:"view.map.ground.opacity"})],h.prototype,"baseOpacity",
void 0);c.__decorate([E.property({readOnly:!0})],h.prototype,"overlayManager",void 0);c.__decorate([E.property({readOnly:!0})],h.prototype,"viewingMode",null);c.__decorate([E.property()],h.prototype,"maxTextureScale",void 0);c.__decorate([E.property({readOnly:!0})],h.prototype,"ready",null);c.__decorate([E.property({value:ja.RenderOrder.FRONT_TO_BACK})],h.prototype,"renderOrder",null);c.__decorate([E.property({readOnly:!0})],h.prototype,"rootTiles",void 0);c.__decorate([E.property({readOnly:!0})],
h.prototype,"spatialReference",null);c.__decorate([E.property()],h.prototype,"backgroundImage",void 0);c.__decorate([E.property({type:g,aliasOf:"view.map.ground.surfaceColor"})],h.prototype,"backgroundColor",void 0);c.__decorate([E.property()],h.prototype,"_background",null);c.__decorate([E.property({value:!1})],h.prototype,"slicePlaneEnabled",null);c.__decorate([E.property({readOnly:!0})],h.prototype,"tilingScheme",void 0);c.__decorate([E.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],
h.prototype,"tilingSchemeLocked",void 0);c.__decorate([E.property({readOnly:!0})],h.prototype,"tilingSchemeLogic",void 0);c.__decorate([E.property({value:!0})],h.prototype,"velvetOverground",null);c.__decorate([r.aliasOf("_renderer.wireframe")],h.prototype,"wireframe",void 0);c.__decorate([E.property({value:!1})],h.prototype,"suspended",null);c.__decorate([E.property({readOnly:!0,aliasOf:"view.qualitySettings.tiledSurface.textureFadeDuration"})],h.prototype,"textureFadeDuration",void 0);c.__decorate([E.property()],
h.prototype,"_layerViewsDirty",void 0);c.__decorate([r.aliasOf("_renderer.renderPatchBorders")],h.prototype,"renderPatchBorders",void 0);c.__decorate([r.aliasOf("_renderer.renderingDisabled")],h.prototype,"renderingDisabled",void 0);c=h=c.__decorate([y.subclass("esri.views.3d.terrain.TerrainSurface")],h);const va=C.create(),Ia=L.create(),Ja=[0,0,0],Ha=new z,Ta={spatialReference:null,tile:null,extent:null,context:"ground"},db={spatialReference:null,extent:null,scale:0};return c})},"esri/layers/support/ElevationQueryTileCache":function(){define(["exports"],
function(a){let b=function(){function c(h){this.store=h}var g=c.prototype;g.destroy=function(){this.store.destroy()};g.get=function(h){return this.store.get(h)};g.put=function(h,w){this.store.put(h,w,w.values.byteLength+256)};return c}();a.ElevationQueryTileCache=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/LercDecoder":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe","../../core/workers/WorkerHandle"],function(a,b,c,g){let h=function(n){function f(k=
null){var e=n.call(this,"LercWorker","_decode",k,{strategy:"dedicated"})||this;e.schedule=k;e.ref=0;return e}b._inheritsLoose(f,n);var l=f.prototype;l.decode=function(k,e,d){return k&&0!==k.byteLength?this.invoke({buffer:k,options:e},d):Promise.resolve(null)};l.getTransferList=function(k){return[k.buffer]};l.release=function(){0>=--this.ref&&(w.forEach((k,e)=>{k===this&&w.delete(e)}),this.destroy())};return f}(g.WorkerHandle);const w=new Map;a.acquireDecoder=function(n=null){let f=w.get(c.unwrap(n));
f||(c.isSome(n)?(f=new h(l=>n.schedule(l)),w.set(n,f)):(f=new h,w.set(null,f)));++f.ref;return f};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/workers/WorkerHandle":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../arrayUtils ../handleUtils ../Logger ../maybe ../promiseUtils ./workers".split(" "),function(a,b,c,g,h,w,n,f){const l=h.getLogger("esri.core.workers.WorkerHandle");h=function(){function k(d,m,z,v={}){this._mainMethod=m;this._listeners=[];this._promise=
f.open(d,{...v,schedule:z}).then(q=>{if(void 0===this._thread){this._thread=q;this._promise=null;v.hasInitialize&&this.broadcast({},"initialize");for(const t of this._listeners)this._connectListener(t)}else q.close()});this._promise.catch(q=>l.error(`Failed to initialize ${d} worker: ${q}`))}var e=k.prototype;e.on=function(d,m){const z={removed:!1,eventName:d,callback:m,threadHandle:null};this._listeners.push(z);this._connectListener(z);return g.makeHandle(()=>{z.removed=!0;c.remove(this._listeners,
z);this._thread&&w.isSome(z.threadHandle)&&z.threadHandle.remove()})};e.destroy=function(){this._thread&&(this._thread.close(),this._thread=null);this._promise=null};e.invoke=function(d,m){return this.invokeMethod(this._mainMethod,d,m)};e.invokeMethod=function(d,m,z){if(this._thread){const v=this.getTransferList(m,d);return this._thread.invoke(d,m,{transferList:v,signal:z})}return this._promise?this._promise.then(()=>{n.throwIfAborted(z);return this.invokeMethod(d,m,z)}):Promise.reject(null)};e.broadcast=
function(d,m){return this._thread?Promise.all(this._thread.broadcast(m,d)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(d,m)):Promise.reject()};e._connectListener=function(d){this._thread&&this._thread.on(d.eventName,d.callback).then(m=>{d.removed||(d.threadHandle=m)})};b._createClass(k,[{key:"promise",get:function(){return this._promise}}]);return k}();a.WorkerHandle=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ./enums ./RenderBucket ./decluttering/config ../webgl/TiledDisplayObject".split(" "),
function(a,b,c,g,h,w,n,f,l){l=function(e){function d(z,v,q,t,r,x,u=null){v=e.call(this,z,v,q,t,r,4096,4096)||this;v._memCache=u;v.type="vector-tile";v._referenced=0;v._hasSymbolBuckets=!1;v._memoryUsedByLayerData=0;v.layerData=new Map;v.layerCount=0;v.status="loading";v.allSymbolsFadingOut=!1;v.lastOpacityUpdate=0;v.symbols=new Map;v.isCoverage=!1;v.neededForCoverage=!1;v.decluttered=!1;v.invalidating=!1;v.parentTile=null;v.childrenTiles=new Set;v._processed=!1;v._referenced=1;v.styleRepository=x;
v.id=z.id;return v}b._inheritsLoose(d,e);var m=d.prototype;m.setData=function(z){this.changeDataImpl(z);this.requestRender();this.ready();this.invalidating=!1;this._processed=!0};m.deleteLayerData=function(z){let v=!1;for(const q of z)this.layerData.has(q)&&(z=this.layerData.get(q),this._memoryUsedByLayerData-=z.memoryUsed,z.type===w.BucketType.SYMBOL&&this.symbols.has(q)&&(this.symbols.delete(q),v=!0),z.destroy(),this.layerData.delete(q),this.layerCount--);c.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,
this,this._memoryUsedByLayerData);v&&this.emit("symbols-changed");this.requestRender()};m.processed=function(){return this._processed};m.hasData=function(){return 0<this.layerCount};m.dispose=function(){"unloaded"!==this.status&&(k.delete(this),d._destroyRenderBuckets(this.layerData),this.layerData=null,this._memoryUsedByLayerData=this.layerCount=0,this.destroy(),this.status="unloaded")};m.release=function(){return 0===--this._referenced?(this.dispose(),this.stage=null,!0):!1};m.retain=function(){++this._referenced};
m.changeDataImpl=function(z){let v=!1;if(z){const {bucketsWithData:q,emptyBuckets:t}=z;z=this._createRenderBuckets(q);if(t&&0<t.byteLength){const r=new Uint32Array(t);for(const x of r)this._deleteLayerData(x)}for(const [r,x]of z)this._deleteLayerData(r),x.type===w.BucketType.SYMBOL&&(this.symbols.set(r,x.symbols),v=!0),this._memoryUsedByLayerData+=x.memoryUsed,this.layerData.set(r,x),this.layerCount++;c.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=
!1;for(const [,q]of this.layerData)q.type===w.BucketType.SYMBOL&&(this._hasSymbolBuckets=!0);v&&this.emit("symbols-changed")};m.attachWithContext=function(z){this.stage={context:z,trashDisplayObject(v){v.processDetach()},untrashDisplayObject(){return!1}}};m.setTransform=function(z,v){e.prototype.setTransform.call(this,z,v);var q=v/(z.resolution*z.pixelRatio);v=this.width/this.rangeX*q;q*=this.height/this.rangeY;const t=[0,0];z.toScreen(t,[this.x,this.y]);const r=this.transforms.tileUnitsToPixels;
g.identity(r);g.translate(r,r,t);g.rotate(r,r,Math.PI*z.rotation/180);g.scale(r,r,[v,q,1])};m._createTransforms=function(){return{dvs:h.create(),tileMat3:h.create(),tileUnitsToPixels:h.create()}};d._destroyRenderBuckets=function(z){if(z){var v=new Set;z.forEach(q=>{v.has(q)||(q.destroy(),v.add(q))});z.clear()}};m._createRenderBuckets=function(z){const v=new Map,q=new Map;for(const t of z){z=this._deserializeBucket(t,q);for(const r of z.layerUIDs)v.set(r,z)}return v};m._deserializeBucket=function(z,
v){let q=v.get(z);if(q)return q;switch((new Uint32Array(z))[0]){case w.BucketType.FILL:q=new n.FillRenderBucket(z,this.styleRepository);break;case w.BucketType.LINE:q=new n.LineRenderBucket(z,this.styleRepository);break;case w.BucketType.SYMBOL:q=new n.SymbolRenderBucket(z,this.styleRepository,this);break;case w.BucketType.CIRCLE:q=new n.CircleRenderBucket(z,this.styleRepository)}v.set(z,q);return q};m._deleteLayerData=function(z){if(this.layerData.has(z)){var v=this.layerData.get(z);this._memoryUsedByLayerData-=
v.memoryUsed;v.destroy();this.layerData.delete(z);this.layerCount--}};b._createClass(d,[{key:"hasSymbolBuckets",get:function(){return this._hasSymbolBuckets}},{key:"isFading",get:function(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<f.FADE_DURATION}},{key:"isHoldingForFade",get:function(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<f.FADE_DURATION)}},{key:"wasRequested",get:function(){return"errored"===this.status||
"loaded"===this.status||"reloading"===this.status}},{key:"referenced",get:function(){return this._referenced}},{key:"memoryUsage",get:function(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}}]);return d}(l.TiledDisplayObject);const k=new Map;a.VectorTile=l;a.printAllocations=function(){k.forEach((e,d)=>{console.log(`\n${d.key}:`);e[0].forEach(m=>console.log(m));console.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");e[1].forEach(m=>console.log(m))})};Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/chunks/mat3f32":function(){define(["exports"],function(a){function b(){const n=new Float32Array(9);n[0]=1;n[4]=1;n[8]=1;return n}function c(n){const f=new Float32Array(9);f[0]=n[0];f[1]=n[1];f[2]=n[2];f[3]=n[3];f[4]=n[4];f[5]=n[5];f[6]=n[6];f[7]=n[7];f[8]=n[8];return f}function g(n,f,l,k,e,d,m,z,v){const q=new Float32Array(9);q[0]=n;q[1]=f;q[2]=l;q[3]=k;q[4]=e;q[5]=d;q[6]=m;q[7]=z;q[8]=v;return q}function h(n,f){return new Float32Array(n,f,9)}const w=Object.freeze({__proto__:null,
create:b,clone:c,fromValues:g,createView:h});a.clone=c;a.create=b;a.createView=h;a.fromValues=g;a.mat3f32=w})},"esri/views/2d/engine/vectorTiles/enums":function(){define(["exports"],function(a){a.MemoryBufferType=void 0;(function(b){b[b.UNKNOWN=0]="UNKNOWN";b[b.FILL_VERTEX=1]="FILL_VERTEX";b[b.FILL_DD_VERTEX=2]="FILL_DD_VERTEX";b[b.FILL_INDEX=3]="FILL_INDEX";b[b.OUTLINE_VERTEX=4]="OUTLINE_VERTEX";b[b.OUTLINE_DD_VERTEX=5]="OUTLINE_DD_VERTEX";b[b.OUTLINE_INDEX=6]="OUTLINE_INDEX";b[b.LINE_VERTEX=7]=
"LINE_VERTEX";b[b.LINE_DD_VERTEX=8]="LINE_DD_VERTEX";b[b.LINE_INDEX=9]="LINE_INDEX";b[b.ICON_VERTEX=10]="ICON_VERTEX";b[b.ICON_DD_VERTEX=11]="ICON_DD_VERTEX";b[b.ICON_INDEX=12]="ICON_INDEX";b[b.TEXT_VERTEX=13]="TEXT_VERTEX";b[b.TEXT_DD_VERTEX=14]="TEXT_DD_VERTEX";b[b.TEXT_INDEX=15]="TEXT_INDEX";b[b.CIRCLE_VERTEX=16]="CIRCLE_VERTEX";b[b.CIRCLE_INDEX=17]="CIRCLE_INDEX"})(a.MemoryBufferType||(a.MemoryBufferType={}));a.BucketType=void 0;(function(b){b[b.FILL=1]="FILL";b[b.LINE=2]="LINE";b[b.SYMBOL=3]=
"SYMBOL";b[b.CIRCLE=4]="CIRCLE"})(a.BucketType||(a.BucketType={}));a.DrawPhase=void 0;(function(b){b[b.BACKGROUND=0]="BACKGROUND";b[b.OPAQUE=1]="OPAQUE";b[b.TRANSLUCENT=2]="TRANSLUCENT";b[b.SYMBOLS=3]="SYMBOLS";b[b.HITTEST=4]="HITTEST"})(a.DrawPhase||(a.DrawPhase={}));a.ShaderProgramType=void 0;(function(b){b[b.BACKGROUND=0]="BACKGROUND";b[b.FILL=1]="FILL";b[b.OUTLINE=2]="OUTLINE";b[b.LINE=3]="LINE";b[b.ICON=4]="ICON";b[b.CIRCLE=5]="CIRCLE";b[b.TEXT=6]="TEXT";b[b.TILEINFO=7]="TILEINFO"})(a.ShaderProgramType||
(a.ShaderProgramType={}));a.StyleUpdateType=void 0;(function(b){b[b.PAINTER_CHANGED=0]="PAINTER_CHANGED";b[b.LAYOUT_CHANGED=1]="LAYOUT_CHANGED";b[b.LAYER_CHANGED=2]="LAYER_CHANGED";b[b.LAYER_REMOVED=3]="LAYER_REMOVED";b[b.SPRITES_CHANGED=4]="SPRITES_CHANGED"})(a.StyleUpdateType||(a.StyleUpdateType={}));Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./enums ./decluttering/util ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),
function(a,b,c,g,h,w,n,f){let l=function(){function z(q,t){this.layerUIDs=[];this.isDestroyed=!1;this.data=q;this.memoryUsed=q.byteLength;let r=1;q=new Uint32Array(q);this.layerUIDs=[];const x=q[r++];for(let u=0;u<x;u++)this.layerUIDs[u]=q[r++];this.bufferDataOffset=r;t&&(this.layer=t.getStyleLayerByUID(this.layerUIDs[0]))}var v=z.prototype;v.destroy=function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)};v.prepareForRendering=function(q){c.isNone(this.data)||(this.doPrepareForRendering(q,
this.data,this.bufferDataOffset),this.data=null)};b._createClass(z,[{key:"isPreparedForRendering",get:function(){return c.isNone(this.data)}},{key:"offset",get:function(){return this.bufferDataOffset}}]);return z}(),k=function(z){function v(t,r){r=z.call(this,t,r)||this;r.type=g.BucketType.LINE;r.lineIndexStart=0;r.lineIndexCount=0;t=new Uint32Array(t);let x=r.bufferDataOffset;r.lineIndexStart=t[x++];r.lineIndexCount=t[x++];const u=t[x++];if(0<u){const E=new Map;for(let y=0;y<u;y++){const A=t[x++],
p=t[x++],B=t[x++];E.set(A,[p,B])}r.patternMap=E}r.bufferDataOffset=x;return r}b._inheritsLoose(v,z);var q=v.prototype;q.hasData=function(){return 0<this.lineIndexCount};q.triangleCount=function(){return this.lineIndexCount/3};q.doDestroy=function(){c.isSome(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose();c.isSome(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose();c.isSome(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose();this.lineIndexBuffer=this.lineVertexBuffer=this.lineVertexArrayObject=
null;this.memoryUsed=0};q.doPrepareForRendering=function(t,r,x){r=new Uint32Array(r);var u=new Int32Array(r.buffer);const E=r[x++];this.lineVertexBuffer=w.BufferObject.createVertex(t,n.Usage.STATIC_DRAW,new Int32Array(u.buffer,4*x,E));x+=E;u=r[x++];this.lineIndexBuffer=w.BufferObject.createIndex(t,n.Usage.STATIC_DRAW,new Uint32Array(r.buffer,4*x,u));x+=u;x=this.layer.lineMaterial;this.lineVertexArrayObject=new f.VertexArrayObject(t,x.getAttributeLocations(),x.getLayoutInfo(),{geometry:this.lineVertexBuffer},
this.lineIndexBuffer)};return v}(l),e=function(z){function v(t,r){r=z.call(this,t,r)||this;r.type=g.BucketType.FILL;r.fillIndexStart=0;r.fillIndexCount=0;r.outlineIndexStart=0;r.outlineIndexCount=0;t=new Uint32Array(t);let x=r.bufferDataOffset;r.fillIndexStart=t[x++];r.fillIndexCount=t[x++];r.outlineIndexStart=t[x++];r.outlineIndexCount=t[x++];const u=t[x++];if(0<u){const E=new Map;for(let y=0;y<u;y++){const A=t[x++],p=t[x++],B=t[x++];E.set(A,[p,B])}r.patternMap=E}r.bufferDataOffset=x;return r}b._inheritsLoose(v,
z);var q=v.prototype;q.hasData=function(){return 0<this.fillIndexCount||0<this.outlineIndexCount};q.triangleCount=function(){return(this.fillIndexCount+this.outlineIndexCount)/3};q.doDestroy=function(){c.isSome(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose();c.isSome(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose();c.isSome(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose();this.fillIndexBuffer=this.fillVertexBuffer=this.fillVertexArrayObject=null;c.isSome(this.outlineVertexArrayObject)&&
this.outlineVertexArrayObject.dispose();c.isSome(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose();c.isSome(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose();this.outlineIndexBuffer=this.outlineVertexBuffer=this.outlineVertexArrayObject=null;this.memoryUsed=0};q.doPrepareForRendering=function(t,r,x){r=new Uint32Array(r);var u=new Int32Array(r.buffer),E=r[x++];this.fillVertexBuffer=w.BufferObject.createVertex(t,n.Usage.STATIC_DRAW,new Int32Array(u.buffer,4*x,E));x+=E;E=r[x++];
this.fillIndexBuffer=w.BufferObject.createIndex(t,n.Usage.STATIC_DRAW,new Uint32Array(r.buffer,4*x,E));x+=E;E=r[x++];this.outlineVertexBuffer=w.BufferObject.createVertex(t,n.Usage.STATIC_DRAW,new Int32Array(u.buffer,4*x,E));x+=E;u=r[x++];this.outlineIndexBuffer=w.BufferObject.createIndex(t,n.Usage.STATIC_DRAW,new Uint32Array(r.buffer,4*x,u));x+=u;r=this.layer;x=r.fillMaterial;r=r.outlineMaterial;this.fillVertexArrayObject=new f.VertexArrayObject(t,x.getAttributeLocations(),x.getLayoutInfo(),{geometry:this.fillVertexBuffer},
this.fillIndexBuffer);this.outlineVertexArrayObject=new f.VertexArrayObject(t,r.getAttributeLocations(),r.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)};return v}(l),d=function(z){function v(t,r,x){r=z.call(this,t,r)||this;r.type=g.BucketType.SYMBOL;r.iconPerPageElementsMap=new Map;r.glyphPerPageElementsMap=new Map;r.symbolInstances=[];r.isIconSDF=!1;r.opacityChanged=!1;r.lastOpacityUpdate=0;r.symbols=[];const u=new Uint32Array(t),E=new Int32Array(t);t=new Float32Array(t);
let y=r.bufferDataOffset;r.isIconSDF=!!u[y++];var A=u[y++];for(var p=0;p<A;p++){var B=u[y++],D=u[y++],C=u[y++];r.iconPerPageElementsMap.set(B,[D,C])}A=u[y++];for(p=0;p<A;p++)B=u[y++],D=u[y++],C=u[y++],r.glyphPerPageElementsMap.set(B,[D,C]);A=u[y++];p=u[y++];r.iconOpacity=new Int32Array(A);r.textOpacity=new Int32Array(p);y=h.deserializeSymbols(u,E,t,y,r.symbols,x);r.bufferDataOffset=y;return r}b._inheritsLoose(v,z);var q=v.prototype;q.hasData=function(){return 0<this.iconPerPageElementsMap.size||0<
this.glyphPerPageElementsMap.size};q.triangleCount=function(){let t=0;for(const [,r]of this.iconPerPageElementsMap)t+=r[1];for(const [,r]of this.glyphPerPageElementsMap)t+=r[1];return t/3};q.doDestroy=function(){c.isSome(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose();c.isSome(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose();c.isSome(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose();c.isSome(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose();this.iconIndexBuffer=
this.iconOpacityBuffer=this.iconVertexBuffer=this.iconVertexArrayObject=null;c.isSome(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose();c.isSome(this.textVertexBuffer)&&this.textVertexBuffer.dispose();c.isSome(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose();c.isSome(this.textIndexBuffer)&&this.textIndexBuffer.dispose();this.textIndexBuffer=this.textOpacityBuffer=this.textVertexBuffer=this.textVertexArrayObject=null;this.memoryUsed=0};q.updateOpacityInfo=function(){if(this.opacityChanged){this.opacityChanged=
!1;var t=c.unwrap(this.iconOpacity),r=c.unwrap(this.iconOpacityBuffer);0<t.length&&t.byteLength===r.size&&r.setSubData(t);t=c.unwrap(this.textOpacity);r=c.unwrap(this.textOpacityBuffer);0<t.length&&t.byteLength===r.size&&r.setSubData(t)}};q.doPrepareForRendering=function(t,r,x){r=new Uint32Array(r);var u=new Int32Array(r.buffer),E=r[x++];this.iconVertexBuffer=w.BufferObject.createVertex(t,n.Usage.STATIC_DRAW,new Int32Array(u.buffer,4*x,E));x+=E;E=r[x++];this.iconIndexBuffer=w.BufferObject.createIndex(t,
n.Usage.STATIC_DRAW,new Uint32Array(r.buffer,4*x,E));x+=E;E=r[x++];this.textVertexBuffer=w.BufferObject.createVertex(t,n.Usage.STATIC_DRAW,new Int32Array(u.buffer,4*x,E));x+=E;u=r[x++];this.textIndexBuffer=w.BufferObject.createIndex(t,n.Usage.STATIC_DRAW,new Uint32Array(r.buffer,4*x,u));x+=u;this.iconOpacityBuffer=w.BufferObject.createVertex(t,n.Usage.STATIC_DRAW,c.unwrap(this.iconOpacity).buffer);this.textOpacityBuffer=w.BufferObject.createVertex(t,n.Usage.STATIC_DRAW,c.unwrap(this.textOpacity).buffer);
r=this.layer;x=r.iconMaterial;r=r.textMaterial;this.iconVertexArrayObject=new f.VertexArrayObject(t,x.getAttributeLocations(),x.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer);this.textVertexArrayObject=new f.VertexArrayObject(t,r.getAttributeLocations(),r.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)};return v}(l),m=function(z){function v(t,r){r=z.call(this,t,r)||this;r.type=g.BucketType.CIRCLE;
r.circleIndexStart=0;r.circleIndexCount=0;t=new Uint32Array(t);let x=r.bufferDataOffset;r.circleIndexStart=t[x++];r.circleIndexCount=t[x++];r.bufferDataOffset=x;return r}b._inheritsLoose(v,z);var q=v.prototype;q.hasData=function(){return 0<this.circleIndexCount};q.triangleCount=function(){return this.circleIndexCount/3};q.doDestroy=function(){c.isSome(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose();c.isSome(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose();c.isSome(this.circleIndexBuffer)&&
this.circleIndexBuffer.dispose();this.circleIndexBuffer=this.circleVertexBuffer=this.circleVertexArrayObject=null;this.memoryUsed=0};q.doPrepareForRendering=function(t,r,x){r=new Uint32Array(r);var u=new Int32Array(r.buffer);const E=r[x++];this.circleVertexBuffer=w.BufferObject.createVertex(t,n.Usage.STATIC_DRAW,new Int32Array(u.buffer,4*x,E));x+=E;u=r[x++];this.circleIndexBuffer=w.BufferObject.createIndex(t,n.Usage.STATIC_DRAW,new Uint32Array(r.buffer,4*x,u));x+=u;x=this.layer.circleMaterial;this.circleVertexArrayObject=
new f.VertexArrayObject(t,x.getAttributeLocations(),x.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)};return v}(l);a.CircleRenderBucket=m;a.FillRenderBucket=e;a.LineRenderBucket=k;a.RenderBucketBase=l;a.SymbolRenderBucket=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../enums","./core"],function(a,b,c,g,
h){let w=function(k){this.tile=k;this.parent=null;this.children=new Set},n=function(){function k(){this.nodes=new Map;this.roots=new Set}var e=k.prototype;e.create=function(d){const m=new w(d);let z;const v=[];this.nodes.forEach(q=>{this._canConnectDirectly(m,q)&&v.push(q);!z&&this._canConnectDirectly(q,m)&&(z=q)});if(z){for(const q of v)z.children.delete(q),m.children.add(q),q.parent=m;z.children.add(m);m.parent=z}else{this.roots.add(m);for(const q of v)m.children.add(q),q.parent=m,this.roots.delete(q)}this.nodes.set(d.key.id,
m);return m};e.destroy=function(d){c.isSome(d.parent)?(d.parent.children.delete(d),d.children.forEach(m=>{c.isSome(d.parent)&&d.parent.children.add(m)})):this.roots.delete(d);d.children.forEach(m=>{(m.parent=d.parent)||this.roots.add(m)});this.nodes.delete(d.tile.key.id)};e.clear=function(){this.roots.clear();this.nodes.clear()};e._canConnectDirectly=function(d,m){let {level:z,row:v,col:q}=m.tile.key;for({world:m}=m.tile.key;0<z;){z--;v>>=1;q>>=1;if(d.tile.key.level===z&&d.tile.key.row===v&&d.tile.key.col===
q&&d.tile.key.world===m)return!0;if(this.nodes.has(`${z}/${v}/${q}/${m}`))break}return!1};return k}(),f=function(){function k(){this._tileGraph=new n;this._tileArray=null}var e=k.prototype;e.has=function(d){return"string"===typeof d?this._tileGraph.nodes.has(d):this._tileGraph.nodes.has(d.key.id)};e.getAll=function(){this._tileArray||(this._tileArray=[],this._tileGraph.nodes.forEach(d=>{this._tileArray.push(d.tile)}));return this._tileArray};e.getRoots=function(){const d=[];this._tileGraph.roots.forEach(m=>
{d.push(m.tile)});return d};e.getParent=function(d){d=this._tileGraph.nodes.get("string"===typeof d?d:d.key.id);return c.isSome(d.parent)&&d.parent.tile};e.getChildren=function(d){const m=[];this._tileGraph.nodes.get("string"===typeof d?d:d.key.id).children.forEach(z=>{m.push(z.tile)});return m};e.get=function(d){return this._tileGraph.nodes.get(d).tile};e.removeKey=function(d){d=this._tileGraph.nodes.get(d);this._tileGraph.destroy(d);this._tileArray=null};e.forEach=function(d){this._tileGraph.nodes.forEach((m,
z)=>d(m.tile,z))};e.add=function(d){this._tileGraph.create(d);this._tileArray=null};e.remove=function(d){d=this._tileGraph.nodes.get(d.key.id);this._tileGraph.destroy(d);this._tileArray=null};e.clear=function(){this._tileGraph.clear();this._tileArray=[]};return k}(),l=function(){function k(d,m,z){this._rows=Math.ceil(m/z);this._columns=Math.ceil(d/z);this._cellSize=z;this.cells=Array(this._rows);for(d=0;d<this._rows;d++)for(this.cells[d]=Array(this._columns),m=0;m<this._columns;m++)this.cells[d][m]=
[]}var e=k.prototype;e.getCell=function(d,m){m=Math.min(Math.max(Math.floor(m/this._cellSize),0),this._rows-1);d=Math.min(Math.max(Math.floor(d/this._cellSize),0),this._columns-1);return this.cells[m]&&this.cells[m][d]||null};e.getCellSpan=function(d,m,z,v){return[Math.min(Math.max(Math.floor(d/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(m/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(z/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(v/this._cellSize),
0),this.rows-1)]};b._createClass(k,[{key:"cellSize",get:function(){return this._cellSize}},{key:"columns",get:function(){return this._columns}},{key:"rows",get:function(){return this._rows}}]);return k}();a.GridIndex=l;a.TileForest=f;a.TileGraph=n;a.TileNode=w;a.deserializeSymbols=function(k,e,d,m,z,v){const q=e[m++];for(let x=0;x<q;x++){const u=new h.VTLSymbol(v);u.xTile=e[m++];u.yTile=e[m++];u.hash=e[m++];u.priority=e[m++];var t=e[m++];for(var r=0;r<t;r++){const E=e[m++],y=e[m++],A=e[m++],p=e[m++],
B=!!e[m++],D=e[m++],C=d[m++],F=d[m++],G=e[m++],L=e[m++];u.colliders.push({xTile:E,yTile:y,dxPixels:A,dyPixels:p,hard:B,partIndex:D,width:G,height:L,minLod:C,maxLod:F})}t=k[m++];for(r=0;r<t;r++)u.textVertexRanges.push([k[m++],k[m++]]);t=k[m++];for(r=0;r<t;r++)u.iconVertexRanges.push([k[m++],k[m++]]);z.push(u)}return m};a.tileCoordChange=function(k,e,d,m,z,v){d-=z;if(0<=d)return(e>>d)+(m-(v<<d))*(k>>d);d=-d;return e-(v-(m<<d))*(k>>d)<<d};a.writeOpacityToBuffers=function(k,e,d){for(const [x,u]of k.symbols){{var m=
k,z=e,v=d,q=u;const E=m.layerData.get(x);if(E.type===g.BucketType.SYMBOL){for(const y of q){q=y.unique;var t=void 0;if(y.selectedForRendering){var r=q.parts[0];t=r.startOpacity;r=r.targetOpacity;m.allSymbolsFadingOut=m.allSymbolsFadingOut&&0===r;t=v?Math.floor(127*t)|r<<7:r?255:0;t|=t<<24|t<<16|t<<8}else t=0;for(const [A,p]of y.iconVertexRanges)for(r=A;r<A+p;r+=4)E.iconOpacity[r/4]=t;y.selectedForRendering?(t=q.parts[1],q=t.startOpacity,t=t.targetOpacity,m.allSymbolsFadingOut=m.allSymbolsFadingOut&&
0===t,q=v?Math.floor(127*q)|t<<7:t?255:0,t=q<<24|q<<16|q<<8|q):t=0;for(const [A,p]of y.textVertexRanges)for(q=A;q<A+p;q+=4)E.textOpacity[q/4]=t}E.lastOpacityUpdate=z;E.opacityChanged=!0}}}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["exports"],function(a){a.VTLSymbol=function(b){this.hash=this.yTile=this.xTile=0;this.priority=1;this.colliders=[];this.textVertexRanges=[];this.iconVertexRanges=[];this.tile=b};a.VTLUniqueSymbol=
function(){this.tileSymbols=[];this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}];this.show=!1};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/config":function(){define(["exports"],function(a){a.COLLISION_GRID_CELL_SIZE=32;a.DECLUTTER_BUDGET=1.5;a.DECLUTTER_TILES=!0;a.FADE_DURATION=200;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/mat3","../DisplayObject","../../tiling/TileKey"],function(a,b,c,g,h){g=function(w){function n(l,k,e,d,m,z=d,v=m){var q=w.call(this)||this;q.triangleCountReportedInDebug=0;q.triangleCount=0;q.texture=null;q.key=new h(l);q.x=k;q.y=e;q.width=d;q.height=m;q.rangeX=z;q.rangeY=v;return q}b._inheritsLoose(n,w);var f=n.prototype;f.destroy=function(){this.texture&&(this.texture.dispose(),this.texture=null)};f.setTransform=function(l,k){k/=
l.resolution*l.pixelRatio;const e=this.transforms.tileMat3,[d,m]=l.toScreenNoRotation([0,0],[this.x,this.y]);c.set(e,this.width/this.rangeX*k,0,0,0,this.height/this.rangeY*k,0,d,m,1);c.multiply(this.transforms.dvs,l.displayViewMat3,e)};return n}(g.DisplayObject);a.TiledDisplayObject=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/DisplayObject":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Evented ../../../core/has ../../../core/maybe ../../../core/promiseUtils".split(" "),
function(a,b,c,g,h,w){const n=1/g("mapview-transitions-duration");c=function(f){function l(){var e=f.apply(this,arguments)||this;e._fadeOutResolver=null;e._fadeInResolver=null;e._clips=null;e.computedVisible=!0;e.computedOpacity=1;e.fadeTransitionEnabled=!1;e.inFadeTransition=!1;e._isReady=!1;e._opacity=1;e._stage=null;e._visible=!0;return e}b._inheritsLoose(l,f);var k=l.prototype;k._getTransforms=function(){h.isNone(this._transforms)&&(this._transforms=this._createTransforms());return this._transforms};
k.fadeIn=function(){if(this._fadeInResolver)return this._fadeInResolver.promise;this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null);this.computedOpacity=0;this.fadeTransitionEnabled=!0;this._fadeInResolver=w.createResolver();this.requestRender();return this._fadeInResolver.promise};k.fadeOut=function(){if(this._fadeOutResolver)return this._fadeOutResolver.promise;this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this.fadeTransitionEnabled=!0;this._fadeOutResolver=
w.createResolver();this.requestRender();return this._fadeOutResolver.promise};k.beforeRender=function(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)};k.afterRender=function(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)};k.remove=function(){var e;null==(e=this.parent)?void 0:e.removeChild(this)};k.setTransform=function(e){};
k.processRender=function(e){this.stage&&this.computedVisible&&this.doRender(e)};k.requestRender=function(){this.stage&&this.stage.requestRender()};k.processDetach=function(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null);this.onDetach();this.emit("detach")};k.updateTransitionProperties=function(e,d){if(this.fadeTransitionEnabled){d=this._fadeOutResolver||!this.visible?0:this.opacity;const m=this.computedOpacity;
m===d?this.computedVisible=this.visible:(e*=n,this.computedOpacity=m>d?Math.max(d,m-e):Math.min(d,m+e),this.computedVisible=0<this.computedOpacity,e=d===this.computedOpacity,this.inFadeTransition=!e,e||this.requestRender())}else this.computedOpacity=this.opacity,this.computedVisible=this.visible};k.onAttach=function(){};k.onDetach=function(){};k.doRender=function(e){};k.ready=function(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())};b._createClass(l,[{key:"clips",get:function(){return this._clips},
set:function(e){this._clips=e;this.requestRender()}},{key:"isReady",get:function(){return this._isReady}},{key:"opacity",get:function(){return this._opacity},set:function(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}},{key:"stage",get:function(){return this._stage},set:function(e){if(this._stage!==e){var d=this._stage;(this._stage=e)?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):d.trashDisplayObject(this)}}},{key:"transforms",
get:function(){return this._getTransforms()}},{key:"visible",get:function(){return this._visible},set:function(e){this._visible!==e&&(this._visible=e,this.requestRender())}}]);return l}(c);a.DisplayObject=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/tiling/TileKey":function(){define(["../../../chunks/_rollupPluginBabelHelpers","../../../core/ObjectPool"],function(a,b){let c=function(){function g(w,n,f,l){this.set(w,n,f,l)}g.getId=function(w,n,f,l){return"object"===typeof w?
`${w.level}/${w.row}/${w.col}/${w.world}`:`${w}/${n}/${f}/${l}`};var h=g.prototype;h.acquire=function(w,n,f,l){this.set(w,n,f,l)};h.contains=function(w){const n=w.level-this.level;return this.row===w.row>>n&&this.col===w.col>>n&&this.world===w.world};h.equals=function(w){return this.level===w.level&&this.row===w.row&&this.col===w.col&&this.world===w.world};h.clone=function(){return new g(this)};h.release=function(){this.world=this.col=this.row=this.level=0};h.set=function(w,n,f,l){if(null==w)this.world=
this.col=this.row=this.level=0;else if("object"===typeof w)this.level=w.level||0,this.row=w.row||0,this.col=w.col||0,this.world=w.world||0;else if("string"===typeof w){const [k,e,d,m]=w.split("/");this.level=parseFloat(k);this.row=parseFloat(e);this.col=parseFloat(d);this.world=parseFloat(m)}else this.level=+w,this.row=+n,this.col=+f,this.world=+l||0;return this};h.toString=function(){return`${this.level}/${this.row}/${this.col}/${this.world}`};h.getParentKey=function(){return 0>=this.level?null:
new g(this.level-1,this.row>>1,this.col>>1,this.world)};h.getChildKeys=function(){const w=this.level+1,n=this.row<<1,f=this.col<<1,l=this.world;return[new g(w,n,f,l),new g(w,n,f+1,l),new g(w,n+1,f,l),new g(w,n+1,f+1,l)]};h.compareRowMajor=function(w){return this.row<w.row?-1:this.row>w.row?1:this.col<w.col?-1:this.col>w.col?1:0};a._createClass(g,[{key:"key",get:function(){return this}},{key:"id",get:function(){return this.toString()},set:function(w){this.set(w)}},{key:"hash",get:function(){return(this.world&
3)<<30|(this.col&4095)<<22|(this.row&4095)<<8|this.level&63}}]);return g}();c.pool=new b(c,null,null,25,50);return c})},"esri/views/3d/layers/ElevationLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./LayerView3D ./TiledLayerView3D ../../layers/LayerView".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){h=function(d){function m(){var z=d.apply(this,arguments)||this;z.type="elevation-3d";return z}a._inheritsLoose(m,d);m.prototype.initialize=function(){var z,v,q,t;const r=null==(z=this.view)?void 0:null==(v=z.map)?void 0:v.allLayers;z=r&&r.includes(this.layer);var x=(v=null==(x=this.view)?void 0:null==(q=x.map)?void 0:null==(t=q.ground)?void 0:t.layers)&&v.includes(this.layer);z&&!x&&(x=new c("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added to layers in map.ground"),
this.addResolvingPromise(Promise.reject(x)));this._addTilingSchemeMatchPromise()};return m}(k.TiledLayerView3D(l.LayerView3D(e)));b.__decorate([g.property()],h.prototype,"layer",void 0);b.__decorate([g.property({readOnly:!0,aliasOf:"layer.tileInfo"})],h.prototype,"tileInfo",void 0);return h=b.__decorate([f.subclass("esri.views.3d.layers.ElevationLayerView3D")],h)})},"esri/views/3d/layers/LayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/heightModelInfoUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k){a.LayerView3D=e=>{e=function(d){function m(){var v=d.apply(this,arguments)||this;v.slicePlaneEnabled=!1;v.supportsHeightUnitConversion=!1;return v}b._inheritsLoose(m,d);var z=m.prototype;z.postscript=function(v){d.prototype.postscript.call(this,v);k.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())};z._validateHeightModelInfo=function(){var v=b._asyncToGenerator(function*(){var q=g.whenTrueOnce(this.view.defaultsFromMap,"heightModelInfoReady");
this.handles.add(q);yield q;if(q=k.rejectLayerError(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion))throw q;});return function(){return v.apply(this,arguments)}}();z.canResume=function(){const v=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return d.prototype.canResume.call(this)&&(!v||!v.minScale||!v.maxScale||v.minScale>=v.maxScale)};z.getSuspendInfo=function(){const v=d.prototype.getSuspendInfo.call(this),q=this.layer&&"effectiveScaleRange"in
this.layer?this.layer.effectiveScaleRange:null;q&&q.minScale&&q.maxScale&&q.minScale<q.maxScale&&(v.outsideScaleRange=!0);return v};return m}(e);c.__decorate([h.property()],e.prototype,"view",void 0);c.__decorate([h.property()],e.prototype,"slicePlaneEnabled",void 0);return e=c.__decorate([l.subclass("esri.views.3d.layers.LayerView3D")],e)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/TiledLayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../support/updatingProperties ../terrain/terrainUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m){a.TiledLayerView3D=z=>{z=function(v){function q(){return v.apply(this,arguments)||this}b._inheritsLoose(q,v);var t=q.prototype;t.getTileUrl=function(r,x,u){return this.layer.getTileUrl(r,x,u)};t._addTilingSchemeMatchPromise=function(){if(h.isNone(this.fullExtent))return this.addResolvingPromise(Promise.reject(new g("tilingscheme:extent-not-defined","This layer doesn't define a fullExtent.")));var r=this._getTileInfoSupportError(this.tileInfo,this.fullExtent);if(h.isSome(r))return this.addResolvingPromise(Promise.reject(r));
r=w.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeLocked").then(()=>{const x=this._getTileInfoCompatibilityError(this.tileInfo,this.view.basemapTerrain.tilingScheme);if(x)throw x;});this.addResolvingPromise(r)};t._getTileInfoSupportError=function(r,x){if(r=m.checkIfTileInfoSupportedForView(r,x,this.view.spatialReference,this.view.state.viewingMode)){x={layer:this.layer,error:r};switch(r.name){case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":case "tilingscheme:local-unsupported-spatial-reference":r=
new g("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",x);break;default:r=new g("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",x)}return r}return null};t._getTileInfoCompatibilityError=function(r,x){return x.compatibleWith(r)?null:new g("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")};t.levelRangeFromScaleRange=
function(r,x){const u={minLevel:0,maxLevel:Infinity};var E=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!E)return u;const y=E.levels[0];E=A=>{A=Math.log(y.scale/A)/Math.LN2;return 1E-9>.5-Math.abs(.5-A%1)?Math.round(A):Math.ceil(A)};null!=r&&0<r&&(u.minLevel=Math.max(0,E(r)));null!=x&&0<x&&(u.maxLevel=Math.max(0,E(x)));return u};t.isUpdating=function(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)};b._createClass(q,[{key:"imageFormatIsOpaque",
get:function(){return!1}},{key:"fullExtent",get:function(){return this.layer.fullExtent}},{key:"isOpaque",get:function(){return 1<=this.fullOpacity&&this.imageFormatIsOpaque}},{key:"dataLevelRange",get:function(){const r=this.tileInfo.lods;return this.levelRangeFromScaleRange(r[0].scale,r[r.length-1].scale)}},{key:"displayLevelRange",get:function(){var r=this.tileInfo.lods;r=this.levelRangeFromScaleRange(this.layer.minScale||r[0].scale,this.layer.maxScale||r[r.length-1].scale);this.layer.maxScale&&
r.maxLevel++;return r}}]);return q}(z);c.__decorate([n.property({readOnly:!0})],z.prototype,"imageFormatIsOpaque",null);c.__decorate([n.property({readOnly:!0})],z.prototype,"updating",void 0);c.__decorate([n.property(d.updatingProgress)],z.prototype,"updatingProgress",void 0);c.__decorate([n.property(d.updatingProgressValue)],z.prototype,"updatingProgressValue",void 0);c.__decorate([n.property()],z.prototype,"fullExtent",null);c.__decorate([n.property({readOnly:!0})],z.prototype,"isOpaque",null);
c.__decorate([n.property({readOnly:!0})],z.prototype,"dataLevelRange",null);c.__decorate([n.property({readOnly:!0})],z.prototype,"displayLevelRange",null);c.__decorate([n.property()],z.prototype,"layer",void 0);c.__decorate([n.property()],z.prototype,"tileInfo",void 0);return z=c.__decorate([e.subclass("esri.views.3d.layers.TiledLayerView3D")],z)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/updatingProperties":function(){define(["exports"],function(a){a.updatingProgress=
{readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};a.updatingProgressValue={value:.5,readOnly:!0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/ElevationBounds":function(){define(["exports"],function(a){let b=function(){function c(g=0,h=0){this.min=g;this.max=h;this.level=0;this.hasNoDataValues=!1}c.prototype.copyFrom=function(g){this.min=g.min;this.max=g.max;this.level=g.level;this.hasNoDataValues=g.hasNoDataValues};return c}();a.ElevationBounds=
b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/ElevationData":function(){define(["exports","../../../core/mathUtils","../../../core/maybe","../support/mathUtils","./TerrainConst"],function(a,b,c,g,h){let w=function(){function n(l,k,e){this.type="elevation";this.samplerData=null;this.level=l[0];this.i=l[1];this.j=l[2];this.extent=k;l=e.noDataValue;const d=e.values;let m=Infinity,z=-Infinity,v=!0,q=!1;for(let t=0;t<d.length;t++){const r=d[t];r!==l?(m=r<m?r:m,z=r>z?r:z,
v=!1):q=!0}v&&(z=m=0);this.samplerData={pixelData:e.values,width:e.width,height:e.height,noDataValue:l,safeWidth:.99999999*(e.width-1),dx:(e.width-1)/(k[2]-k[0]),dy:(e.width-1)/(k[3]-k[1]),x0:k[0],y1:k[3]};this.bounds=[m,-3E38<z?z:0];this.hasNoDataValues=q}var f=n.prototype;f.release=function(){this.bounds=this.samplerData=null};f.computeMinMaxValue=function(l,k,e,d){d.min=Infinity;d.max=-Infinity;d.hasNoDataValues=!1;l-=this.level;if(0>=l)return d;var m=2**l;if(Math.floor(k/m)!==this.i||Math.floor(e/
m)!==this.j)return d;var z=Infinity,v=-Infinity,q=this.samplerData.width,t=this.samplerData.pixelData,r=.5*h.ELEVATION_NODATA_VALUE;l=(q-1)/m;e=(e-this.j*m)*l;let x=(k-this.i*m)*l;if(1>l){const y=Math.floor(e),A=Math.floor(x);var u=y+A*q;k=t[u];m=t[u+1];var E=t[u+q];u=t[u+q+1];if(k+m+E+u<r)return z=e-y,r=x-A,v=g.bilerp(k,m,E,u,z,r),q=g.bilerp(k,m,E,u,z+l,r),t=g.bilerp(k,m,E,u,z,r+l),l=g.bilerp(k,m,E,u,z+l,r+l),d.min=Math.min(v,q,t,l),d.max=Math.max(v,q,t,l),d;e=y;x=A;l=1}else e=Math.floor(e),x=Math.floor(x),
l=Math.ceil(l);for(k=e;k<=e+l;k++)for(m=x;m<=x+l;m++)E=t[k+m*q],E<r?(z=Math.min(z,E),v=Math.max(v,E)):d.hasNoDataValues=!0;d.min=z;d.max=v;return d};return n}();a.ElevationData=w;a.sampleElevation=function(n,f,l){if(c.isNone(l))return null;for(const z of l){if(!z)continue;var k=z.safeWidth;l=b.clamp(z.dy*(z.y1-f),0,k);k=b.clamp(z.dx*(n-z.x0),0,k);const v=Math.floor(l),q=Math.floor(k);var e=z.width,d=v*e+q,m=z.pixelData;const t=m[d],r=m[d+1];d+=e;e=m[d];m=m[d+1];if(t+e+r+m<.5*h.ELEVATION_NODATA_VALUE)return l-=
v,k-=q,n=t+(r-t)*k,n+(e+(m-e)*k-n)*l}return null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/ExtentHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../layers/support/layerUtils ../../ViewingMode ./TerrainConst ./terrainUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t){function r(E,y){return w.isSome(E)&&!E.spatialReference.equals(y)?d.projectWithoutEngine(E,E.spatialReference,y):E}a.ExtentHelper=function(E){function y(p){p=E.call(this,p)||this;p._handles=new h;return p}b._inheritsLoose(y,E);var A=y.prototype;A.initialize=function(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])};A.destroy=function(){this._handles.destroy();this._handles=null};A._computeStencilEnabledExtents=
function(){const p=[];this.layerViews.forEach(B=>{B=B.layer;"IntegratedMeshLayer"===B.operationalLayerType&&null!=this.viewSpatialReference&&(B=r(B.fullExtent,this.viewSpatialReference),w.isSome(B)&&p.push(m.fromExtent(B)))});return p};b._createClass(y,[{key:"layerViewsExtent",get:function(){return this._computeLayerViewsExtent()}},{key:"tiledLayersExtent",get:function(){return this._computeTiledLayersExtent()}},{key:"stencilEnabledExtents",get:function(){return this._computeStencilEnabledExtents()}}]);
return y}(g);c.__decorate([n.property({readOnly:!0})],a.ExtentHelper.prototype,"layerViewsExtent",null);c.__decorate([n.property({readOnly:!0})],a.ExtentHelper.prototype,"tiledLayersExtent",null);c.__decorate([n.property({readOnly:!0})],a.ExtentHelper.prototype,"stencilEnabledExtents",null);c.__decorate([n.property()],a.ExtentHelper.prototype,"viewSpatialReference",void 0);c.__decorate([n.property()],a.ExtentHelper.prototype,"tilingScheme",void 0);c.__decorate([n.property()],a.ExtentHelper.prototype,
"defaultTiledLayersExtent",void 0);c.__decorate([n.property({constructOnly:!0})],a.ExtentHelper.prototype,"layers",void 0);c.__decorate([n.property({constructOnly:!0})],a.ExtentHelper.prototype,"layerViews",void 0);a.ExtentHelper=c.__decorate([e.subclass("esri.views.3d.terrain.ExtentHelper")],a.ExtentHelper);let x=function(E){function y(){return E.apply(this,arguments)||this}b._inheritsLoose(y,E);var A=y.prototype;A._computeLayerViewsExtent=function(){return this._globalExtent};A._computeTiledLayersExtent=
function(){return this._globalExtent};b._createClass(y,[{key:"_globalExtent",get:function(){return this.viewSpatialReference.isWebMercator?q.WEBMERCATOR_WORLD_EXTENT:q.GEOGRAPHIC_WORLD_EXTENT}}]);return y}(a.ExtentHelper);x=c.__decorate([e.subclass("esri.views.3d.terrain.ExtentHelperGlobal")],x);let u=function(E){function y(){return E.apply(this,arguments)||this}b._inheritsLoose(y,E);var A=y.prototype;A._computeLayerViewsExtent=function(){const p=m.empty(),B=this.viewSpatialReference;this.layerViews.forEach(F=>
{const G=F.layer;!F.isResolved()||"graphics"===G.type&&G.internal||(F=r("fullExtentInLocalViewSpatialReference"in F&&F.fullExtentInLocalViewSpatialReference||F.layer.fullExtent,B),m.expand(p,F,p))});const D=m.allFinite(p)?p:null,C=this._get("layerViewsExtent");return m.equals(D,C)?C:D};A._computeTiledLayersExtent=function(){const p=this.tilingScheme;if(!p)return null;const B=this.viewSpatialReference,D=m.empty();this.layers.forEach(G=>{if(G.loaded&&z.isTiledLayer(G)){const M=t.getTiledLayerInfo(G,
B,v.ViewingMode.Local);if(!w.isNone(M)){var {tileInfo:L,fullExtent:H}=M;(w.isSome(L)&&t.isProjectableRasterLayer(G)&&w.isSome(H)||w.isSome(L)&&p.compatibleWith(L)&&w.isSome(H)&&H.spatialReference.equals(p.spatialReference))&&m.expand(D,H,D)}}});m.expand(D,this.defaultTiledLayersExtent,D);const C=m.allFinite(D)?D:null,F=this._get("tiledLayersExtent");return m.equals(C,F)?F:C};return y}(a.ExtentHelper);u=c.__decorate([e.subclass("esri.views.3d.terrain.ExtentHelperLocal")],u);a.create=function(E,y){return E===
v.ViewingMode.Global?new x(y):new u(y)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/LayerClass":function(){define(["exports"],function(a){a.LayerClass=void 0;var b=a.LayerClass||(a.LayerClass={});b[b.ELEVATION=0]="ELEVATION";b[b.MAP=1]="MAP";a.LayerClasses=[a.LayerClass.ELEVATION,a.LayerClass.MAP];Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/OverlayManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/has ../../../core/mathUtils ../../../core/maybe ../../../core/scheduling ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec2 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../../../geometry/support/ray ../../../chunks/sphere ../../../geometry/support/vector ../../../geometry/support/webMercatorUtils ../layers/interfaces ../state/utils/viewUtils ../support/debugFlags ../support/debugUtils ../support/mathUtils ./interfaces ./Overlay ./OverlayRenderer ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/Intersector ../webgl-engine/lib/LocalOriginFactory ../webgl-engine/parts/requireUtils ../../support/Scheduler".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H,M,K,I,O,Q,J,P,N){const R=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let S;a.OverlayManager=function(ea){function ja(ia){ia=ea.call(this,ia)||this;ia._handles=new h;ia._spatialReference=null;ia._renderSR=null;ia._overlaySREqualsRenderSR=!0;ia._drapeSources=new Map;ia._drapeTargets=new Set;ia._placementDirty=!1;ia._contentUpdated=!1;ia._drawTexturesDirty=
!1;ia._drawTexturesAnimateDirty=!1;ia._layerViewsDirty=!0;ia._hasUnusedRenderTargets=!1;ia._longitudeCyclical=null;ia._latestOriginId=0;ia._maxResolution=w("esri-mobile")?2048:4096;ia._animationTimeLast=0;return ia}b._inheritsLoose(ja,ea);var la=ja.prototype;la.initialize=function(){const ia=this.view;this.renderer=new I.OverlayRenderer({view:ia,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference});this._groundIntersector=Q.newIntersector(this.view.state.viewingMode);this._groundIntersector.options.backfacesTerrain=
!0;this._groundIntersector.options.invisibleTerrain=!0;this._groundIntersector.options.hud=!1;this._handles.add([this.renderer.events.on("has-highlights",()=>{this._setDrawTexturesDirty();this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",ca=>{var fa;return null==(fa=ia._stage)?void 0:fa.renderView.setRenderParameters({hasOverlayWater:ca})}),this.renderer.events.on("renders-occluded",()=>{this._setDrawTexturesDirty();this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",
()=>this._setDrawTexturesDirty()),this.renderer.events.on("textures-disposed",()=>this.updateDrapeTargets()),ia.watch(["pointsOfInterest.renderPointOfView","pointsOfInterest.centerOnSurfaceFrequent.location","pixelRatio"],()=>this.setPlacementDirty()),this.surface.on("elevation-change",()=>this.setPlacementDirty()),ia.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0),ia.watch("graphicsView",()=>this._layerViewsDirty=!0),ia.on("resize",()=>this.setPlacementDirty()),l.addFrameTask({preRender:ca=>
{this._contentUpdated=!1;this.renderer.processSyncLayers();this._updateLayerViews();this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(ca),this._drawOverlayTextures(this.renderer.overlays,O.RenderRequestType.UPDATE));this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}}),ia.resourceController.scheduler.registerTask(N.TaskPriority.OVERLAY,this),ia._stage.renderView.events.on("force-camera-for-screenshot",ca=>{this._updateOverlays(ca,O.RenderRequestType.BACKGROUND);this.renderer.hasOverlays&&
this._drawOverlayTextures(this.renderer.overlays,O.RenderRequestType.BACKGROUND,ca)})]);this._updateLayerViews()};la.destroy=function(){this._drapeSources.forEach((ia,ca)=>this.unregisterDrapeSource(ca));this._drapeTargets.forEach(ia=>this._unregisterDrapeTarget(ia));this.renderer.dispose();this._handles&&(this._handles.destroy(),this._handles=null);f.isSome(S)&&(S.hide(),S=null)};la.setSpatialReference=function(ia){this._spatialReference=ia;this.renderer.spatialReference=ia;this._longitudeCyclical=
null;const ca=this.view.renderSpatialReference;f.isSome(ia)&&f.isSome(ca)?(this._renderSR=ca,this._overlaySREqualsRenderSR=ia.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=ia.isWebMercator?new H.Cyclical(-2.0037508342787E7,2.0037508342787E7):new H.Cyclical(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()};la._updateLayerViews=function(){if(this._layerViewsDirty){var ia=
new Set;for(var ca of this.view.allLayerViews.items)ia.add(ca.uid),"drapeSourceType"in ca&&!this._drapeSources.has(ca)&&this._registerDrapeSource(ca,C.DrapeSourceRegistration.LAYER_VIEW),"drapeTargetType"in ca&&!this._drapeTargets.has(ca)&&this._registerDrapeTarget(ca);ca=this.view.graphicsView;f.isSome(ca)&&!this._drapeSources.has(ca)&&(this._registerDrapeSource(ca,C.DrapeSourceRegistration.LAYER_VIEW),ia.add(ca.uid));this._drapeSources.forEach((fa,ba)=>{fa!==C.DrapeSourceRegistration.LAYER_VIEW||
ia.has(ba.uid)||this.unregisterDrapeSource(ba)});this._drapeTargets.forEach(fa=>{ia.has(fa.uid)||this._unregisterDrapeTarget(fa)});this.renderer.updateLayerOrder();this._setDrawTexturesDirty();this._layerViewsDirty=!1}};la.registerDrapeSource=function(ia){this._registerDrapeSource(ia,C.DrapeSourceRegistration.EXTERNAL)};la._registerDrapeSource=function(ia,ca){this._drapeSources.set(ia,ca);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);this._updateDrapeSourceExtent(ia);this._setContentDirty();
this.notifyChange("running")};la._updateDrapeSourceExtent=function(ia){2===this.renderer.overlays.length&&f.isSome(ia.setDrapingExtent)&&f.isSome(this._spatialReference)&&ia.setDrapingExtent(this.renderer.overlays,this._spatialReference)};la.unregisterDrapeSource=function(ia){this._drapeSources.has(ia)&&(this._drapeSources.delete(ia),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))};la._registerDrapeTarget=function(ia){this._drapeTargets.add(ia);
this._updateDrapeTarget(ia);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)};la.updateDrapeTargets=function(){this._drapeTargets.forEach(ia=>this._updateDrapeTarget(ia))};la._updateDrapeTarget=function(ia){ia.setDrapingTextures(this.renderer.overlays)};la._unregisterDrapeTarget=function(ia){this._drapeTargets.delete(ia);this.renderer.ensureDrapeTargets(this._drapeTargets)};la._setContentDirty=function(){this.setPlacementDirty();this._setDrawTexturesDirty()};la.setPlacementDirty=
function(){this._placementDirty=!0};la.runTask=function(){this._updateOverlays(this.view.state.camera,O.RenderRequestType.UPDATE)};la._updateOverlays=function(ia,ca){if(this._spatialReference){this._updateLayerViews();var fa=K.computeOverlayResolution(ia.fullWidth,ia.fullHeight,this._maxResolution);this._computeOverlayExtents(ia,fa,W);var ba=y.width(W.inner)/y.width(W.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);ia=this._updateOverlay(M.OverlayIndex.INNER,W.inner,fa,
1*W.pixelRatioAdjustment,W.mapUnitsPerPixel);fa=this._updateOverlay(M.OverlayIndex.OUTER,W.outer,fa,ba*W.pixelRatioAdjustment,W.mapUnitsPerPixel);if(ia===Y.EXTENT||fa===Y.EXTENT)this._drapeSources.forEach((Z,ha)=>this._updateDrapeSourceExtent(ha)),this.surface.updateTileOverlayParams(ca);ia===Y.NONE&&fa===Y.NONE||this._setDrawTexturesDirty();this._placementDirty=!1}};la._updateOverlay=function(ia,ca,fa,ba,Z){if(0===this.renderer.overlays.length)return Y.NONE;ia=this.renderer.overlays[ia];const ha=
ia.mapUnitsPerPixel;ia.mapUnitsPerPixel=Z;ia.pixelRatio=ba;{ba=ia.extent;const na=G.TESTS_DISABLE_OPTIMIZATIONS?0:1E-5*Math.max(ca[2]-ca[0],ca[3]-ca[1],ba[2]-ba[0],ba[3]-ba[1]);ba=Math.abs(ba[0]-ca[0])<=na&&Math.abs(ba[1]-ca[1])<=na&&Math.abs(ba[2]-ca[2])<=na&&Math.abs(ba[3]-ca[3])<=na}if(ba&&fa===ia.resolution)return ha===Z?Y.NONE:Y.RERENDER_ONLY;y.copy(ia.extent,ca);ia.resolution=fa;ca=y.center(ia.extent);ia.renderLocalOrigin=J.fromValues(ca[0],ca[1],0,`OV_${this._latestOriginId++}`);return Y.EXTENT};
la.setTileParameters=function(ia){const ca=ia.renderData.overlay;if(0<this.renderer.overlays.length){const fa=this.renderer.overlays[M.OverlayIndex.INNER],ba=this.renderer.overlays[M.OverlayIndex.OUTER];ia=y.intersection(ia.extent,this.surface.extent,U);this._rectInsideRect(fa.extent,ia)||this._rectanglesOverlap(ia,fa.extent)||this._rectanglesOverlap(ia,ba.extent)?(this._setTileOverlayData(ia,M.OverlayIndex.INNER,ca),this._setTileOverlayData(ia,M.OverlayIndex.OUTER,ca)):(this._clearTileOverlayData(M.OverlayIndex.INNER,
ca),this._clearTileOverlayData(M.OverlayIndex.OUTER,ca))}else this._clearTileOverlayData(M.OverlayIndex.INNER,ca),this._clearTileOverlayData(M.OverlayIndex.OUTER,ca)};la.overlayPixelSizeInMapUnits=function(ia){if(0===this.renderer.overlays.length)return 0;const ca=this.renderer.overlays[M.OverlayIndex.INNER],fa=this.renderer.overlays[M.OverlayIndex.OUTER];ia=this._pointIsInExtent(ia,ca.extent)?ca:fa;return(ia.extent[2]-ia.extent[0])/ia.resolution};la._setTileOverlayData=function(ia,ca,fa){if(0!==
this.renderer.overlays.length){var ba=this.renderer.overlays[ca].extent,Z=y.width(ba),ha=y.height(ba),na=ia[0];if(this._longitudeCyclical){na=this._longitudeCyclical.minimalMonotonic(ba[0],na);const pa=this._longitudeCyclical.minimalMonotonic(ba[0],ia[2]);na>pa&&(na=pa-(ia[2]-ia[0]))}fa.setScale(ca,y.width(ia)/Z,y.height(ia)/ha);fa.setOffset(ca,(na-ba[0])/Z,(ia[1]-ba[1])/ha)}};la._clearTileOverlayData=function(ia,ca){ca.setScale(ia,-1,-1);ca.setOffset(ia,-1,-1)};la.reloadShaders=function(){var ia=
b._asyncToGenerator(function*(){P.removeLoadedShaderModules();yield this.renderer.reloadShaders();this._setDrawTexturesDirty();this.runTask()});return function(){return ia.apply(this,arguments)}}();la._dispatchAnimationUpdate=function(ia){const ca=k.Milliseconds(ia.time-this._animationTimeLast);if(ca>=this.surface.view._stage.renderView.animationTimestep||f.isSome(this.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty)this.renderer.updateAnimation({dt:ca,forcedTime:this.forcedAnimationTime,
camera:this.view.state.camera})&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=ia.time};la._setDrawTexturesDirty=function(){this.renderer.hasOverlays?this._drawTexturesDirty=this._contentUpdated=!0:this.setPlacementDirty()};la._intersectGroundFromView=function(ia,ca,fa,ba){fa=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(ia,da,ca,fa);if(f.isNone(fa))return!1;ca=fa.origin;fa=q.add(V,fa.origin,fa.direction);this._groundIntersector.reset(ca,fa,ia);this._groundIntersector.intersect([],
null);this.view.basemapTerrain.intersect(this._groundIntersector,null,ca,fa);return this._groundIntersector.results.min.getIntersectionPoint(ba)};la._findHorizonBasedPointOfInterest=function(ia,ca){var fa=.5;fa=this.view.renderCoordsHelper.getAltitude(ia.eye);const ba=this.view.pointsOfInterest.centerOnSurfaceFrequent;var Z=n.clamp(ba.estimatedSurfaceAltitude,ia.aboveGround?-Infinity:fa+1E-5,ia.aboveGround?fa-1E-5:Infinity);fa=ia.aboveGround;if("global"===this.view.viewingMode){var ha=V;p.closestPointOnSilhouette(p.fromRadius(E.getReferenceEllipsoid(this.view.spatialReference).radius+
Z),A.wrap(ia.eye,ia.viewForward),ha);q.subtract(ha,ha,ia.eye);Z=H.cyclicalPI.normalize(B.angleAroundAxis(ia.viewForward,ha,ia.viewRight))/ia.fovY+.5;ha=0>=Z||1<=Z?.5:.55;fa=fa?ha*Z:Z+ha*(1-Z)}else Z=x.fromValues(0,Math.tan(.5*Math.PI-Math.acos(-ia.viewForward[2])),1,0),Z=r.transformMat4(Z,Z,ia.projectionMatrix)[1],Z=n.clamp(.5+.5*Z,0,1),fa=1===Z||0===Z?.5:fa?.55*Z:1-.55*(1-Z);return this._intersectGroundFromView(ia,.5,fa,ca)?q.sqrDist(ca,ia.eye)<ba.distance*ba.distance:!1};la._computeOverlayExtents=
function(ia,ca,fa){var ba=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,Z=t.create();this._findHorizonBasedPointOfInterest(ia,Z)||q.copy(Z,ba);var ha=Math.max(.1,q.distance(ia.eye,Z));ba=F.viewAngle(this.view.renderCoordsHelper,ba,ia.eye);const na=Math.PI/2-Math.abs(ba-Math.PI/2);G.OVERLAY_SHOW_CENTER?(f.isNone(S)&&(S=new L.PointGraphics(this.view.graphics,"red")),S.show(Z,this._renderSR)):f.isSome(S)&&S.hide();this._overlaySREqualsRenderSR||u.projectVectorToVector(Z,this._renderSR,
Z,this._spatialReference);ba=this.surface.extent;var pa=!this._isSpherical&&f.isSome(this._spatialReference)&&this._spatialReference.isGeographic,xa=pa&&f.isSome(this._spatialReference)?1/E.getReferenceEllipsoid(this._spatialReference).metersPerDegree:1;ha=ia.perRenderPixelRatio*ha*xa;fa.mapUnitsPerPixel=ha/this._worldToPCSRatio;ha=ca*ha/2;var Da=!1;pa=pa?90:Infinity;this._isSpherical&&f.isSome(ba)&&f.isSome(this._spatialReference)&&(this._spatialReference.isWebMercator?(ha/=Math.cos(D.y2lat(Z[1])),
pa=ba[3]):(Da=!0,ha/=E.getReferenceEllipsoid(this._spatialReference).metersPerDegree,pa=90),ha>=pa&&(ha=pa,Z[1]=0,this._spatialReference.isWebMercator&&(Z[0]=0)));xa=1;Da&&(xa=1/Math.max(.2,Math.cos(Math.abs(n.deg2rad(Z[1])))),180<ha*xa&&(xa=180/ha),fa.mapUnitsPerPixel*=xa);Da=Math.log(2)/12;ha=Math.exp(Math.round(Math.log(ha)/Da)*Da);const ua=ha*xa;Da=.5*ca/(32*ua);var Fa=.5*ca/(32*ha);Z[0]=Math.round(Z[0]*Da)/Da;Z[1]=Math.round(Z[1]*Fa)/Fa;Da=fa.inner;Da[0]=Z[0]-ua;Da[1]=Z[1]-ha;Da[2]=Z[0]+ua;Da[3]=
Z[1]+ha;this._isSpherical&&this._shiftExtentToFitBounds(Da,Infinity,pa);Fa=fa.outer;6*ua>y.width(ba)?y.copy(Fa,f.unwrap(ba)):na<=.25*Math.PI?(Fa[0]=Da[0]-ua,Fa[1]=Da[1]-ha,Fa[2]=Da[2]+ua,Fa[3]=Da[3]+ha):(u.projectVectorToVector(ia.eye,this._renderSR,V,this._spatialReference),v.subtract(T,Z,V),ia=-Math.atan2(T[1],T[0])+.125*Math.PI,0>ia&&(ia+=2*Math.PI),r.scale(T,R[Math.floor(ia/(.25*Math.PI))],2*ha),T[0]*=xa,T[2]*=xa,r.add(Fa,Da,T));this._isSpherical?(Fa[0]=this._longitudeCyclical.clamp(Fa[0]),Fa[2]=
this._longitudeCyclical.clamp(Fa[2]),Fa[1]=Math.max(Fa[1],-pa),Fa[3]=Math.min(Fa[3],pa)):(ia=y.intersection(Da,ba,U),Z=y.intersection(Fa,ba,aa),y.contains(ia,Z)&&(Fa[2]=Fa[0],Fa[3]=Fa[1]));ca=Math.abs(Da[2]-Da[0])/ca;fa.mapUnitsPerPixel=Math.max(fa.mapUnitsPerPixel,ca);fa.pixelRatioAdjustment=fa.mapUnitsPerPixel/ca};la._drawOverlayTextures=function(ia,ca,fa=this.view.state.camera){if(0!==ia.length&&(this._drawTexturesDirty||this._drawTexturesAnimateDirty)){var ba=this._drawTexturesDirty;this._drawTexturesAnimateDirty=
this._drawTexturesDirty=!1;var Z=this._drawOverlay(ia[M.OverlayIndex.INNER],fa);ia=this._drawOverlay(ia[M.OverlayIndex.OUTER],fa);Z!==O.ValidationState.CHANGED&&ia!==O.ValidationState.CHANGED||this.surface.updateTileOverlayParams(O.RenderRequestType.UPDATE);this._collectUnusedRenderTargetMemory();this.updateDrapeTargets();ba?(this.surface.requestRender(ca),ca===O.RenderRequestType.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(O.RenderRequestType.BACKGROUND)}};la._drawOverlay=function(ia,
ca){this._longitudeCyclical?ia.setupGeometryViewsCyclical(this._longitudeCyclical):ia.setupGeometryViewsDirect();return ia.draw(this.renderer,ca.pixelRatio)};la._collectUnusedRenderTargetMemory=function(){this._hasUnusedRenderTargets=!1;if(this.renderer.hasOverlays){const ia=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(ia)}};la._rectanglesOverlap=function(ia,ca){return f.isNone(ia)?!1:this._longitudeCyclical?(this._longitudeCyclical.contains(ca[0],ca[2],
ia[0])||this._longitudeCyclical.contains(ca[0],ca[2],ia[2])||this._longitudeCyclical.contains(ia[0],ia[2],ca[0]))&&!(ia[1]>ca[3]||ia[3]<ca[1]):y.intersects(ia,ca)};la._rectInsideRect=function(ia,ca){return f.isNone(ca)?!1:this._longitudeCyclical?this._longitudeCyclical.contains(ia[0],ia[2],ca[0])&&this._longitudeCyclical.contains(ia[0],ia[2],ca[2])&&ca[1]>ia[1]&&ca[3]<ia[3]:y.contains(ia,ca)};la._pointIsInExtent=function(ia,ca){if(this._longitudeCyclical)return this._longitudeCyclical.contains(ca[0],
ca[2],ia.x)&&ia.y>=ca[1]&&ia.y<=ca[3];const fa=ia.x;ia=ia.y;return fa>ca[0]&&fa<ca[2]&&ia>ca[1]&&ia<ca[3]};la._shiftExtentToFitBounds=function(ia,ca,fa){let ba=0,Z=0;ia[0]<-ca?ba=ia[0]+ca:ia[2]>ca&&(ba=ca-ia[2]);ia[1]<-fa?Z=ia[1]+fa:ia[3]>fa&&(Z=fa-ia[3]);y.offset(ia,ba,Z)};b._createClass(ja,[{key:"running",get:function(){return(this._placementDirty||this._layerViewsDirty)&&(0<this._drapeSources.size||0<this.view.graphics.length||G.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&
this.surface.ready}},{key:"_isSpherical",get:function(){return this.view.state.isGlobal}},{key:"_worldToPCSRatio",get:function(){return f.isSome(this._spatialReference)&&this._spatialReference.isGeographic&&!this.view.state.isLocal?E.getReferenceEllipsoid(this._spatialReference).metersPerDegree:1}},{key:"view",get:function(){return this.surface.view}},{key:"updating",get:function(){return this.running||this.renderer.updating||this._contentUpdated}},{key:"hasHighlights",get:function(){return this.renderer.hasHighlights}},
{key:"rendersOccluded",get:function(){return this.renderer.rendersOccluded}},{key:"hasOverlays",get:function(){return this.renderer.hasOverlays}},{key:"gpuMemoryUsage",get:function(){return this.renderer.gpuMemoryUsage}},{key:"test",get:function(){return{renderer:this.renderer,update:()=>this.runTask()}}}]);return ja}(g);c.__decorate([e.property()],a.OverlayManager.prototype,"_spatialReference",void 0);c.__decorate([e.property({readOnly:!0})],a.OverlayManager.prototype,"running",null);c.__decorate([e.property()],
a.OverlayManager.prototype,"_placementDirty",void 0);c.__decorate([e.property()],a.OverlayManager.prototype,"_contentUpdated",void 0);c.__decorate([e.property()],a.OverlayManager.prototype,"_layerViewsDirty",void 0);c.__decorate([e.property()],a.OverlayManager.prototype,"_isSpherical",null);c.__decorate([e.property()],a.OverlayManager.prototype,"_worldToPCSRatio",null);c.__decorate([e.property()],a.OverlayManager.prototype,"renderer",void 0);c.__decorate([e.property({constructOnly:!0})],a.OverlayManager.prototype,
"surface",void 0);c.__decorate([e.property({readOnly:!0,aliasOf:"surface.suspended"})],a.OverlayManager.prototype,"suspended",void 0);c.__decorate([e.property({readOnly:!0})],a.OverlayManager.prototype,"updating",null);c.__decorate([e.property({type:Boolean})],a.OverlayManager.prototype,"hasHighlights",null);c.__decorate([e.property({type:Boolean})],a.OverlayManager.prototype,"rendersOccluded",null);a.OverlayManager=c.__decorate([z.subclass("esri.views.3d.terrain.OverlayManager")],a.OverlayManager);
const T=x.create(),V=t.create(),W={inner:y.create(),outer:y.create(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},U=y.create(),aa=y.create(),da=A.create();var Y;(function(ea){ea[ea.NONE=0]="NONE";ea[ea.EXTENT=1]="EXTENT";ea[ea.RERENDER_ONLY=2]="RERENDER_ONLY"})(Y||(Y={}));Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/parts/requireUtils":function(){define(["exports"],function(a){a.removeLoadedShaderModules=function(){var b;const c=null==(b=globalThis.require)?void 0:
b.modules;if(c){b=Object.keys(c);for(const g of b)-1!==g.search(".glsl")&&delete c[g]}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/PlanarPatch":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/spatialReferenceUtils ./PatchGeometryFactory ./Tile ../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m){let z=function(q){function t(x,u,E){var y=q.call(this)||this;y.horizontalScaleFactor=1;y.isWebmercatorOnPlateeCaree=!1;y.extentInRenderSR=f.create();void 0!==x&&y.init(x,u,E);return y}b._inheritsLoose(t,q);var r=t.prototype;r.init=function(x,u,E){q.prototype.init.call(this,x,u,E);u=E.view.renderSpatialReference;x=E.spatialReference;this.horizontalScaleFactor=E=(u=c.isSome(u)&&k.isPlateCarree(u))&&x.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this.isWebmercatorOnPlateeCaree=
u&&x.isWebMercator;x=this.extentInRenderSR;u=this.extent;if(this.isWebmercatorOnPlateeCaree)E=g.fromValues(u[0],u[1],0),h.projectVectorToVector(E,w.WebMercator,E,w.PlateCarree),u=g.fromValues(u[2],u[3],0),h.projectVectorToVector(u,w.WebMercator,u,w.PlateCarree),x[0]=E[0],x[1]=E[1],x[2]=u[0],x[3]=u[1];else for(let y=0;4>y;++y)x[y]=u[y]*E;this.centerAtSeaLevel[0]=.5*(x[0]+x[2]);this.centerAtSeaLevel[1]=.5*(x[1]+x[3]);this.centerAtSeaLevel[2]=0;this._edgeLen=Math.max(x[2]-x[0],x[3]-x[1]);this._edgeLen2=
this._edgeLen*this._edgeLen;this.updateRadiusAndCenter()};r.updateRadiusAndCenter=function(){this._updateCenter();var x=this.extentInRenderSR;const u=.5*(x[2]-x[0]);x=.5*(x[3]-x[1]);this._center[d.CenterPosition.MIDDLE][3]=Math.max(Math.sqrt(u*u+x*x),.5*(this.elevationBounds[0]-this.elevationBounds[1]))};r._isVisible=function(x){return l.intersectsAABB(x,this._aabb())};r._aabb=function(){const x=this.extentInRenderSR;return n.wrap(x[0],x[1],this.elevationBounds[0],x[2],x[3],this.elevationBounds[1])};
r.intersectsRay=function(x,u,E,y,A){v[0]=1/u[0];v[1]=1/u[1];v[2]=1/u[2];u=A*(this.extent[2]-this.extent[0])*this.horizontalScaleFactor*.1;return m.intersectAabbInvDirBefore(this._aabb(),x,v,E+u,y)};r.createGeometry=function(x,u){e.createPlanarGlobePatch(x,this.extent,u,this.horizontalScaleFactor,this.isWebmercatorOnPlateeCaree,this.renderData);this.setMemoryDirty()};r.getDefaultVerticesPerRowOnLevel=function(){return 9>this.level?3:2};return t}(d.Tile);const v=g.create();a.PlanarPatch=z;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/terrain/PatchGeometryFactory":function(){define("exports ../../../core/mathUtils ../../../core/maybe ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/Ellipsoid ../../../geometry/support/buffer/BufferPool ../support/buffer/InterleavedLayout ./ElevationData ./interfaces ./TerrainConst ../webgl-engine/lib/VertexAttribute ../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v){function q(G,L,H,M){const K=H===d.PatchType.HAS_NORTH_POLE||H===d.PatchType.HAS_BOTH_POLES,I=L+(M?1024:0)+(K?2048:0);var O=A.get(I);if(!O){{O=L-1;const S=L*L;var Q=4*O;let T=6*S,V=6*Q,W=6*(2*O+O-1);M&&(T*=2,V*=2,W*=2);Q=65536<S+Q?new Uint32Array(T+V):new Uint16Array(T+V);let U=0,aa=0,da=T;for(let Y=0;Y<=O;Y++){let ea=0;K&&(ea=0===Y?W:Y===O?-W:0);da+=ea;for(let ja=0;ja<=O;ja++){var J=x(ja,Y,O);if(c.isSome(J)){var P=0===Y&&ja!==O?1:ja===O&&Y!==O?O+1:Y===O&&0!==
ja?-1:0===ja&&0!==Y?-(O+1):0;if(0!==P){var N=U,R=S+J;J=S+(0===ja&&1===Y?0:J+1);P=U+P;M?(Q[da++]=N,Q[da++]=R,Q[da++]=R,Q[da++]=J,Q[da++]=J,Q[da++]=N,Q[da++]=J,Q[da++]=P,Q[da++]=P,Q[da++]=N,Q[da++]=N,Q[da++]=J):(Q[da++]=N,Q[da++]=R,Q[da++]=J,Q[da++]=J,Q[da++]=P,Q[da++]=N)}}++U;ja<O&&Y<O&&(N=Y*(O+1)+ja,R=N+1,P=R+(O+1),J=P-1,M?(Q[aa++]=N,Q[aa++]=R,Q[aa++]=R,Q[aa++]=P,Q[aa++]=P,Q[aa++]=N,Q[aa++]=P,Q[aa++]=J,Q[aa++]=J,Q[aa++]=N,Q[aa++]=N,Q[aa++]=P):(Q[aa++]=N,Q[aa++]=R,Q[aa++]=P,Q[aa++]=P,Q[aa++]=J,Q[aa++]=
N))}da-=ea}O=new y(Q,T,V)}A.set(I,O)}G.indices=O.values;G.numSurfaceIndices=O.numSurfaceIndices;G.numSkirtIndices=O.numSkirtIndices;G.numWithoutSkirtIndices=G.numSurfaceIndices+(H===d.PatchType.REGULAR?0:6*(L-1)*(M?2:1))}function t(G,L,H,M){G<M[0]&&(M[0]=G);G>M[3]&&(M[3]=G);L<M[1]&&(M[1]=L);L>M[4]&&(M[4]=L);H<M[2]&&(M[2]=H);H>M[5]&&(M[5]=H)}function r(G,L){const H=L>G?1:0;return 2+4*H+(1-2*H)*(G+L)}function x(G,L,H){return 0===L?G:G===H?H+L:L===H?3*H-G:0===G&&0<L?4*H-L:null}const u=k.newLayout().vec3f(z.VertexAttribute.POSITION).vec2f(z.VertexAttribute.UV0),
E=new l.BufferPool(G=>u.createBuffer(G),G=>G.count);let y=function(G,L,H){this.values=G;this.numSurfaceIndices=L;this.numSkirtIndices=H};const A=new Map,p=Array(m.MAX_PATCH_TESSELATION+1),B=Array(m.MAX_PATCH_TESSELATION+1),D=Array(m.MAX_PATCH_TESSELATION+1),C=Array(m.MAX_PATCH_TESSELATION+1),F=g.create();a.PatchGeometry=function(){this.vertexAttributes=this.indices=null;this.boundingBox=n.empty();this.skirtLength=this.numVertsPerRow=this.numWithoutSkirtIndices=this.numSkirtIndices=this.numSurfaceIndices=
0;this.uvOffsetAndScale=w.create()};a.clearCaches=function(){E.clear();A.clear()};a.createPlanarGlobePatch=function(G,L,H,M,K,I){const O=L[0],Q=L[1],J=L[2]-O,P=L[3]-Q,N=G.clippingArea,R=c.isSome(N)?Math.max(0,(N[0]-L[0])/J):0,S=c.isSome(N)?Math.max(0,(N[1]-L[1])/P):0,T=c.isSome(N)?Math.min(1,(N[2]-L[0])/J):1;L=c.isSome(N)?Math.min(1,(N[3]-L[1])/P):1;const V=T>R?1/(T-R):1,W=L>S?1/(L-S):1,U=-R*V,aa=-S*W,da=J*M*.1,Y=G.numVertsPerSide-1,ea=G.numVertsPerSide*G.numVertsPerSide,ja=E.acquire(ea+4*Y),la=ja.position.typedBuffer,
ia=ja.uv0.typedBuffer,ca=I.geometryInfo.boundingBox;n.empty(ca);let fa=0;const ba=f.earth.radius,Z=G.samplerData,ha=c.isSome(Z)&&Z.some(ua=>c.isSome(ua))?(ua,Fa)=>e.sampleElevation(ua,Fa,Z):()=>0;for(let ua=0;ua<=Y;ua++){var na=ua/Y;let Fa=aa+na*W;na=Q+na*P;c.isSome(N)&&(na<N[1]?(na=N[1],Fa=0):na>N[3]&&(na=N[3],Fa=1));const qa=(K?(Math.PI/2-2*Math.atan(Math.exp(-na/ba)))*ba:na*M)-H[1];for(let sa=0;sa<=Y;sa++){var pa=sa/Y;let ma=U+pa*V;pa=O+pa*J;c.isSome(N)&&(pa<N[0]?(pa=N[0],ma=0):pa>N[2]&&(pa=N[2],
ma=1));var xa=ha(pa,na);pa=pa*M-H[0];xa-=H[2];t(pa,qa,xa,ca);var Da=m.GEOMETRY_VERTEX_STRIDE*fa;la[Da+0]=pa;la[Da+1]=qa;la[Da+2]=xa;ia[Da+0]=ma;ia[Da+1]=Fa;Da=x(sa,ua,Y);c.isSome(Da)&&(Da=m.GEOMETRY_VERTEX_STRIDE*(ea+Da),la[Da+0]=pa,la[Da+1]=qa,la[Da+2]=xa,ia[Da+0]=r(ma,Fa),ia[Da+1]=da);++fa}}I.geometryInfo.numVertsPerRow=G.numVertsPerSide;I.geometryInfo.vertexAttributes=ja;I.geometryInfo.skirtLength=da;h.set(I.geometryInfo.uvOffsetAndScale,R,S,T-R,L-S);q(I.geometryInfo,G.numVertsPerSide,d.PatchType.REGULAR,
G.wireframe);I.intersectionData=null;I.skirtIntersectionData=null};a.createSphericalGlobePatch=function(G,L,H,M,K,I,O,Q){var J=K[0];const P=K[1];var N=K[2];K=K[3];const R=.1*O.radius*(K-P),S=G.numVertsPerSide-1,T=G.numVertsPerSide*G.numVertsPerSide,V=I&&(Q===d.PatchType.HAS_SOUTH_POLE||Q===d.PatchType.HAS_BOTH_POLES),W=I&&(Q===d.PatchType.HAS_NORTH_POLE||Q===d.PatchType.HAS_BOTH_POLES),U=E.acquire(T+4*S),aa=U.position.typedBuffer,da=U.uv0.typedBuffer,Y=M.geometryInfo.boundingBox;n.empty(Y);var ea=
L[2]-L[0];const ja=L[3]-L[1];var la=N-J;N=H[0];const ia=H[1];H=H[2];for(var ca=0;ca<=S;ca++){var fa=ca/S,ba=J+fa*la;p[ca]=Math.sin(ba);B[ca]=Math.cos(ba);D[ca]=fa;C[ca]=L[0]+fa*ea}J=0;const Z=G.samplerData;ea=c.isSome(Z)&&Z.some(ua=>c.isSome(ua))?(ua,Fa)=>e.sampleElevation(C[ua],Fa,Z):()=>0;for(la=0;la<=S;la++){ca=la/S;var ha=b.lerp(P,K,ca);fa=Math.cos(ha);ba=Math.sin(ha);I?(ha=O.halfSemiMajorAxis*Math.log((1+ba)/(1-ba)),ca=(ha-L[1])/ja):ha=180*ha/Math.PI;for(let ua=0;ua<=S;ua++){const Fa=D[ua];var na=
p[ua],pa=B[ua],xa=O.radius+ea(ua,ha);pa=pa*fa*xa-N;na=na*fa*xa-ia;xa=ba*xa-H;t(pa,na,xa,Y);var Da=m.GEOMETRY_VERTEX_STRIDE*J;aa[Da+0]=pa;aa[Da+1]=na;aa[Da+2]=xa;da[Da+0]=Fa;da[Da+1]=ca;Da=x(ua,la,S);if(c.isSome(Da)){Da=m.GEOMETRY_VERTEX_STRIDE*(T+Da);const qa=V&&0===la?-1:W&&la===S?1:0;pa=0===qa?pa:-N;na=0===qa?na:-ia;xa=0===qa?xa:O.radius*qa-H;aa[Da+0]=pa;aa[Da+1]=na;aa[Da+2]=xa;da[Da+0]=0===qa?r(Fa,ca):Fa;da[Da+1]=0===qa?R:ca;0!==qa&&t(pa,na,xa,Y)}++J}}M.geometryInfo.numVertsPerRow=G.numVertsPerSide;
M.geometryInfo.vertexAttributes=U;M.geometryInfo.skirtLength=R;h.set(M.geometryInfo.uvOffsetAndScale,0,0,1,1);q(M.geometryInfo,G.numVertsPerSide,I?Q:d.PatchType.REGULAR,G.wireframe);M.intersectionData=null;M.skirtIntersectionData=null};a.getGlobalSkirtGeometry=function(G,L,H,M,K,I){const O=M.position,Q=M.uv0;M=new Map;L*=3;H=3*H-L;const J=new Uint32Array(H);let P=0;for(let R=0;R<H;++R){const S=G[R+L];if(M.has(S))J[R]=M.get(S);else{const T=P++;M.set(S,T);J[R]=T}}const N=new Float64Array(3*P);M.forEach((R,
S)=>{let T=O.get(S,0),V=O.get(S,1),W=O.get(S,2);if(2<=Q.get(S,0)){S=T+I[0];const U=V+I[1],aa=W+I[2],da=K/Math.sqrt(S*S+U*U+aa*aa);T+=S*da;V+=U*da;W+=aa*da}N[3*R]=T;N[3*R+1]=V;N[3*R+2]=W});return{vertices:N,indices:J}};a.intersectSkirtsGlobal=function(G,L,H,M,K,I,O,Q,J,P){const N=I.position;I=I.uv0;const R=G[0],S=G[1];G=G[2];const T=L[0]-R,V=L[1]-S;L=L[2]-G;H*=3;for(M*=3;H<M;H+=3){var W=K[H],U=K[H+1],aa=K[H+2],da=N.get(W,0),Y=N.get(W,1),ea=N.get(W,2),ja=N.get(U,0),la=N.get(U,1),ia=N.get(U,2),ca=N.get(aa,
0),fa=N.get(aa,1),ba=N.get(aa,2);if(2<=I.get(W,0)){W=da+Q[0];var Z=Y+Q[1],ha=ea+Q[2];const na=O/Math.sqrt(W*W+Z*Z+ha*ha);da+=W*na;Y+=Z*na;ea+=ha*na}2<=I.get(U,0)&&(U=ja+Q[0],W=la+Q[1],Z=ia+Q[2],ha=O/Math.sqrt(U*U+W*W+Z*Z),ja+=U*ha,la+=W*ha,ia+=Z*ha);2<=I.get(aa,0)&&(aa=ca+Q[0],U=fa+Q[1],W=ba+Q[2],Z=O/Math.sqrt(aa*aa+U*U+W*W),ca+=aa*Z,fa+=U*Z,ba+=W*Z);c.isSome(J)&&([da,Y,ea]=J.applyToVertex(da,Y,ea),[ja,la,ia]=J.applyToVertex(ja,la,ia),[ca,fa,ba]=J.applyToVertex(ca,fa,ba));ja-=da;la-=Y;ia-=ea;ca-=
da;fa-=Y;ba-=ea;U=V*ba-fa*L;W=L*ca-ba*T;Z=T*fa-ca*V;aa=ja*U+la*W+ia*Z;if(!(Math.abs(aa)<=Number.EPSILON)){da=R-da;Y=S-Y;ea=G-ea;U=da*U+Y*W+ea*Z;if(0<aa){if(0>U||U>aa)continue}else if(0<U||U<aa)continue;W=Y*ia-la*ea;ea=ea*ja-ia*da;Y=da*la-ja*Y;da=T*W+V*ea+L*Y;if(0<aa){if(0>da||U+da>aa)continue}else if(0<da||U+da<aa)continue;ea=(ca*W+fa*ea+ba*Y)/aa;0<=ea&&(Y=v.computeNormal(ja,la,ia,ca,fa,ba,F),P(ea,Y))}}};a.intersectSkirtsLocal=function(G,L,H,M,K,I,O,Q,J){const P=I.position;I=I.uv0;const N=G[0],R=
G[1];G=G[2];const S=L[0]-N,T=L[1]-R;L=L[2]-G;H*=3;for(M*=3;H<M;H+=3){var V=K[H],W=K[H+1],U=K[H+2],aa=P.get(V,0),da=P.get(V,1),Y=P.get(V,2),ea=P.get(W,0),ja=P.get(W,1),la=P.get(W,2),ia=P.get(U,0),ca=P.get(U,1),fa=P.get(U,2);2<=I.get(V,0)&&(Y+=O);2<=I.get(W,0)&&(la+=O);2<=I.get(U,0)&&(fa+=O);c.isSome(Q)&&([aa,da,Y]=Q.applyToVertex(aa,da,Y),[ea,ja,la]=Q.applyToVertex(ea,ja,la),[ia,ca,fa]=Q.applyToVertex(ia,ca,fa));V=ea-aa;ja-=da;la-=Y;ia-=aa;ca-=da;fa-=Y;U=T*fa-ca*L;ea=L*ia-fa*S;const ba=S*ca-ia*T;W=
V*U+ja*ea+la*ba;if(!(Math.abs(W)<=Number.EPSILON)){aa=N-aa;da=R-da;Y=G-Y;U=aa*U+da*ea+Y*ba;if(0<W){if(0>U||U>W)continue}else if(0<U||U<W)continue;ea=da*la-ja*Y;Y=Y*V-la*aa;da=aa*ja-V*da;aa=S*ea+T*Y+L*da;if(0<W){if(0>aa||U+aa>W)continue}else if(0<aa||U+aa<W)continue;Y=(ia*ea+ca*Y+fa*da)/W;0<=Y&&(V=v.computeNormal(V,ja,la,ia,ca,fa,F),J(Y,V))}}};a.releaseGeometry=function(G){E.release(G.vertexAttributes);G.vertexAttributes=null;G.indices=null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/support/buffer/BufferPool":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../core/PooledArray"],function(a,b,c){let g=function(){function h(n,f){this._factoryCallback=n;this._lengthCallback=f;this._pool=new Map}var w=h.prototype;w.acquire=function(n){if(!h.test.disabled){var f=this._pool.get(n);if(f&&0!==f.length)return f.pop()}try{return this._factoryCallback(n)}catch(l){f=window.performance&&window.performance.memory;let k="";f&&(k=`\n  totalJSHeapSize: ${f.totalJSHeapSize}, usedJSHeapSize: ${f.usedJSHeapSize}, jsHeapSizeLimit: ${f.jsHeapSizeLimit}`);
console.log("Array allocation of size "+n+" failed: "+l+k);throw l;}};w.release=function(n){if(!h.test.disabled){var f=this._lengthCallback(n),l=this._pool.get(f);l||(l=new c({shrink:!0}),this._pool.set(f,l));l.push(n)}};w.clear=function(){this._pool.clear()};b._createClass(h,[{key:"test",get:function(){return{size:this._pool.size}}}]);return h}();g.test={disabled:!1};a.BufferPool=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/Tile":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../core/ObjectPool ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../../../chunks/sphere ../../2d/engine/vectorTiles/VectorTile ../support/StreamDataLoader ./ElevationBounds ./ElevationTileAgent ./interfaces ./LayerClass ./MapTileAgent ./RasterTile ./TerrainConst ./terrainUtils ./TileAgent ./TilePerLayerInfo ./TileTexture ./TileUpdate ./tileUtils ../../webgl/Util".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F){function G(J){J.dispose();J instanceof q.ElevationTileAgent?O.release(J):J instanceof x.MapTileAgent&&I.release(J)}const L=l.create(),H=l.create(),M=l.create();let K=function(){function J(){this.lij=[0,0,0];this._children=[null,null,null,null];this._pendingUpdates=0;this._dirty=!0;this._previouslyRendered=!1;this.extent=e.create();this._elevationBounds=n.create();this.layerInfo=[[],[]];this.extentInRadians=e.create();this.centerAtSeaLevel=
l.create();this._center=[l.create(),d.create(),l.create()];this.up=l.unitZ();this._intersectsClippingArea=this._isWithinClippingArea=!0;this._maxTesselation=0;this._usedMemory=-1;this._curvatureHeight=this._edgeLen2=this._edgeLen=this.renderOrder=this._screenDepth=this._mapDataRefCount=this._mapTileMemory=0}J.prune=function(){I.prune(0);O.prune(0);p.TilePerLayerInfo.prune()};var P=J.prototype;P.computeVisibility=function(){this._dirty=!1;const N=this._intersectsClippingArea&&this._isVisible(this.surface.frustum);
N!==this._visible&&(this._visible=N,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setNeedsRender(),this.updateAgentSuspension());return this._visible};P.init=function(N,R,S){this.lij[0]=N[0];this.lij[1]=N[1];this.lij[2]=N[2];this.ellipsoid=k.getReferenceEllipsoid(S.tilingScheme.spatialReference);S.tilingScheme.getExtent(N[0],N[1],N[2],this.extent);S.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians);this._intersectsClippingArea=this._isWithinClippingArea=
!0;this._clippingArea=null;this._mapDataRefCount=0;S.upsampleMapCache.pop(this.key);this._edgeLen2=this._edgeLen=0;this._center[a.CenterPosition.MIDDLE][3]=0;this.vlevel=N?N[0]:0;R&&R.elevationBounds?w.copy(this._elevationBounds,R.elevationBounds):w.set(this._elevationBounds,0,0);this._pendingUpdates=0;this.renderData=null;this._screenDepth=0;this._previouslyRendered=this._visible=!1;this._parent=R;this.unsetChildren();this._surface=S;this.updateVisibility();for(const T of r.LayerClasses){N=S.numLayers(T);
R=this.layerInfo[T];for(const V of R)V.release();R.length=N;for(let V=0;V<N;V++)R[V]=p.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool),T===r.LayerClass.ELEVATION&&this.findElevationBoundsForLayer(V,-1)}this.computeElevationBounds();this._maxTesselation=Math.min(S.tilingScheme.pixelSize,E.MAX_PATCH_TESSELATION)};P.release=function(){y.weakAssert(!this.renderData,"tile.renderData was not unloaded");this._surface.upsampleMapCache.pop(this.key);for(const N of r.LayerClasses){for(const R of this.layerInfo[N])R.release();
this.layerInfo[N].length=0}this._surface=this._parent=null;this._usedMemory=-1};P.refMapData=function(){++this._mapDataRefCount;this.isCached||this._surface.upsampleMapCache.pop(this.key)};P.unrefMapData=function(){--this._mapDataRefCount;if(this.isCached){const N=this.cachedMemory;0<N&&(this._surface.upsampleMapCache.put(this.key,this,N),this.setMemoryDirty())}};P.setMemoryDirty=function(){this._usedMemory=-1};P._updateMemoryUsed=function(){this._mapTileMemory=this._usedMemory=0;const N=this.cpuImageMemorySize;
for(const {data:R}of this.layerInfo[r.LayerClass.MAP])R instanceof B?this._mapTileMemory+=F.getGpuMemoryUsage(R.texture):R instanceof HTMLImageElement||R instanceof z.ImageWithType?this._mapTileMemory+=N:R instanceof u.RasterTile&&(this._mapTileMemory+=R.memoryUsage);for(const R of this.layerInfo[r.LayerClass.ELEVATION])this._usedMemory+=R.data?N:0;this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemory+=F.getGpuMemoryUsage(this.renderData.textureDescriptor));
this.isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this.cachedMemory)};P.getUsedMemoryForLayer=function(N,R){R=this.layerInfo[N][R];if(!R||!R.data)return 0;if(N===r.LayerClass.MAP&&!this.isCached){N=R.data;if(N instanceof B)return F.getGpuMemoryUsage(N.texture);if(N instanceof HTMLImageElement||N instanceof z.ImageWithType)return this.cpuImageMemorySize;if(N instanceof m.VectorTile||N instanceof u.RasterTile)return N.memoryUsage}else if(N===r.LayerClass.ELEVATION)return this.cpuImageMemorySize;
return 0};P.updateScreenDepth=function(N){var R=this._center[a.CenterPosition.MIDDLE];const S=R[0],T=R[1];R=R[2];const V=N[2]*S+N[6]*T+N[10]*R+N[14];this._screenDepth=0>V?0:V/(N[3]*S+N[7]*T+N[11]*R+N[15])};P.shouldSplit=function(N,R,S){if(g.isSome(N.frustum)&&(!this._intersectsClippingArea||!this._isVisible(N.frustum)))return D.TileUpdate.NONE;const T=this.level;f.subtract(L,this._center[a.CenterPosition.MIDDLE],R);var V=f.squaredLength(L);let W=a.CenterPosition.MIDDLE;f.subtract(H,this._center[a.CenterPosition.TOP],
R);var U=f.squaredLength(H);U<V&&(V=U,W=a.CenterPosition.TOP);f.subtract(H,this._center[a.CenterPosition.BOTTOM],R);U=f.squaredLength(H);U<V&&(V=U,W=a.CenterPosition.BOTTOM);if(this._edgeLen2>V&&T<N.maxLod)return D.TileUpdate.SPLIT;V=Math.sqrt(V);const aa=this._edgeLen/(N.fovX*V*2);U=()=>{const ea=T+Math.ceil(-Math.log2(N.relativeWidthLimit/aa));return ea!==this.vlevel?(this.vlevel=ea,D.TileUpdate.VSPLITMERGE):D.TileUpdate.NONE_HIT_MAXLOD};if(S===t.LODSnapping.ON&&1===this._surface.snapLevel-T)return T>=
N.maxLod?U():D.TileUpdate.SPLIT;const da=f.dot(this.up,L);S=this._elevationBounds[1]-this._elevationBounds[0];const Y=S/this.edgeLen;return N.aboveGround&&0<da&&.001>Y&&0<da/V-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-Y?D.TileUpdate.NONE:aa<N.relativeWidthLimit?this.vlevel!==this.level?(this.vlevel=this.level,D.TileUpdate.VSPLITMERGE):D.TileUpdate.NONE:T>=N.maxLod?U():6<T&&(f.subtract(H,this._center[W],R),f.scale(M,this.up,da),f.subtract(M,M,H),U=f.squaredLength(M),U>this.radius*
this.radius&&(f.scale(M,M,this.radius/Math.sqrt(U)),f.add(M,M,this._center[W]),f.subtract(M,R,M),Math.min(1,(Math.abs(f.dot(M,this.up))+.5*S+this._curvatureHeight)/f.length(M))*(this._edgeLen/(N.fovY*V*2))<.1/N.angledSplitBias*N.relativeHeightLimit))?D.TileUpdate.NONE:D.TileUpdate.SPLIT};P.setChildren=function(N,R,S,T){y.weakAssert(!!(N&&R&&S&&T),"Null child passed");this._children[0]=N;this._children[1]=R;this._children[2]=S;this._children[3]=T};P.unsetChildren=function(){this._children[0]=null;
this._children[1]=null;this._children[2]=null;this._children[3]=null};P.load=function(N){this.refMapData();for(const R of r.LayerClasses)this._createOrUpdateAgents(0,R);N.loadTile(this)};P.unload=function(N){N.unloadTile(this);for(const R of r.LayerClasses){N=this.layerInfo[R];for(const S of N)S.loadingAgent&&S.loadingAgent!==A.TILE_AGENT_DONE&&(G(S.loadingAgent),S.loadingAgent=null),S.pendingUpdates=0}this.resetPendingUpdate(D.TileUpdate.GEOMETRY);this.resetPendingUpdate(D.TileUpdate.TEXTURE_NOFADING);
this.resetPendingUpdate(D.TileUpdate.TEXTURE_FADING);this.unrefMapData()};P.unloadMapData=function(){const N=this.layerInfo[r.LayerClass.MAP];for(const R of N)R.loadingAgent&&R.loadingAgent!==A.TILE_AGENT_DONE&&(G(R.loadingAgent),R.loadingAgent=null),R.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture();this.setMemoryDirty()};P.updateClippingStatus=function(N){if(e.equals(N,this._clippingArea))return!1;var R=this._intersectsClippingArea;const S=this._isWithinClippingArea;g.isSome(N)?
(this._intersectsClippingArea=this.intersectsExtent(N),this._isWithinClippingArea=this._isWithinExtent(N)):this._isWithinClippingArea=this._intersectsClippingArea=!0;this._clippingArea=N;this.updateVisibility();N=S&&this._isWithinClippingArea;R=!S&&!R&&!this._isWithinClippingArea&&!this._intersectsClippingArea;!this.renderData||N||R||this.setPendingUpdate(D.TileUpdate.GEOMETRY);return!0};P.updateVisibility=function(){this._dirty=!0;this._surface.setTileTreeDirty()};P.getLayerInfo=function(N,R){return this.layerInfo[R][N]};
P.hasLayerData=function(N,R){N=this.layerInfo[R][N];return!(!N||!N.data||N.dataInvalidated)};P._isSuspended=function(N){return this.hasPendingUpdate(D.TileUpdate.SPLIT)?!0:N===r.LayerClass.ELEVATION?!1:!this.loadable};P.hasPendingUpdate=function(N){return(this._pendingUpdates&N)===N};P.setPendingUpdate=function(N){this._pendingUpdates|=N;N===D.TileUpdate.SPLIT||N===D.TileUpdate.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()};P.resetPendingUpdate=function(N){return this.hasPendingUpdate(N)?
(this._pendingUpdates&=~N,!0):!1};P.requestLayerData=function(N,R,S){const T=this.layerInfo[R][N];if(T.waitingAgents.has(S))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),S.tile.lij.toString(),R,N),!0;T.waitingAgents.push(S);if(T.data&&!T.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),S.tile.lij.toString(),R,N),S.dataArrived(this),!0;if(T.requestPromise)return!0;
g.abortMaybe(T.requestAbort);T.requestAbort=new AbortController;const V=this._surface.requestTileData(this,N,R,T.requestAbort);if(!V)return T.requestAbort=null,!1;N=()=>{T.requestPromise===V&&(T.requestPromise=null,T.requestAbort=null)};T.requestPromise=V;V.then(N,N);return!0};P.hasLij=function(N){return this.lij[0]===N[0]&&this.lij[1]===N[1]&&this.lij[2]===N[2]};P.findByLij=function(N){return this.hasLij(N)?this:this.isLeaf?null:(N=this._children[0].findByLij(N)||this._children[1].findByLij(N)||
this._children[2].findByLij(N)||this._children[3].findByLij(N))?N:null};P.distanceToSquared=function(N){return f.squaredLength(f.subtract(M,this._center[a.CenterPosition.MIDDLE],N))};P.containsPoint=function(N){const R=this.extent;return N[0]>=R[0]&&N[1]>=R[1]&&N[0]<=R[2]&&N[1]<=R[3]};P.unrequestLayerData=function(N,R,S){N=this.layerInfo[R][N];R=N.waitingAgents;S=null!=R.removeUnordered(S);y.weakAssert(S,"agent has not requested this piece of map data");1>R.length&&(N.abortRequest(),this._updateMemoryUsed())};
P.dataArrived=function(N,R,S){N=this.layerInfo[R][N];N.data=S;N.dataInvalidated=!1;N.waitingAgents.forAll(T=>T.dataArrived(this));N.waitingAgents.clear();this._updateMemoryUsed()};P.dataMissing=function(N,R,S){S.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${R}/${N} error ${S}`);N=this.layerInfo[R][N];N.dataMissing=!0;N.waitingAgents.forAll(T=>T.dataMissing());N.waitingAgents.clear();this._updateMemoryUsed()};P.updateRenderData=function(N,R){switch(N){case r.LayerClass.MAP:return this._updateTexture(R);
case r.LayerClass.ELEVATION:return this._updateGeometry()}};P._updateTexture=function(N){this.renderData&&(this.resetPendingUpdate(N===t.TextureUpdate.FADING?D.TileUpdate.TEXTURE_NOFADING:D.TileUpdate.TEXTURE_FADING),this.setPendingUpdate(N===t.TextureUpdate.FADING?D.TileUpdate.TEXTURE_FADING:D.TileUpdate.TEXTURE_NOFADING))};P._updateGeometry=function(){this.setPendingUpdate(D.TileUpdate.GEOMETRY);for(const N of this.layerInfo[r.LayerClass.ELEVATION])N.pendingUpdates|=D.TileUpdate.GEOMETRY};P.invalidateLayerData=
function(N,R){this.layerInfo[R][N].invalidateSourceData();this.restartAgents(R)};P.computeElevationBounds=function(){w.set(this._elevationBounds,Number.MAX_VALUE,-Number.MAX_VALUE);const N=this.layerInfo[r.LayerClass.ELEVATION];let R=!0;for(const S of N)g.isSome(S.elevationBounds)&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],S.elevationBounds.min),this._elevationBounds[1]=Math.max(this._elevationBounds[1],S.elevationBounds.max),S.elevationBounds.hasNoDataValues||(R=!1));R&&(this._elevationBounds[0]=
Math.min(this._elevationBounds[0],0),this._elevationBounds[1]=Math.max(this._elevationBounds[1],0));this.updateRadiusAndCenter();this._surface.setTileTreeDirty()};P._updateCenter=function(){f.scale(M,this.up,.5*(this._elevationBounds[0]+this._elevationBounds[1]));f.add(this._center[a.CenterPosition.MIDDLE],this.centerAtSeaLevel,M);f.scale(M,this.up,this._elevationBounds[0]);f.add(this._center[a.CenterPosition.TOP],this.centerAtSeaLevel,M);f.scale(M,this.up,this._elevationBounds[1]);f.add(this._center[a.CenterPosition.BOTTOM],
this.centerAtSeaLevel,M)};P.findElevationBoundsForLayer=function(N,R){const S=this.layerInfo[r.LayerClass.ELEVATION][N];if(!(g.isSome(S.elevationBounds)&&S.elevationBounds.level>=R)&&(R=this._surface.layerViewByIndex(N,r.LayerClass.ELEVATION),R=y.getLayerWithExtentRange(R),C.fallsWithinLayer(this,R,!1))){R=Q;var T=!1;if(S.data)N=S.data,R.min=N.bounds[0],R.max=N.bounds[1],R.hasNoDataValues=N.hasNoDataValues,R.level=this.lij[0],T=!0;else{let V=0,W,U;for(let aa=this._parent;aa&&(!U||V<E.getElevationDesiredResolutionLevel(this.level))&&
!(V=this.vlevel-aa.level,W=U||W,U=aa.layerInfo[r.LayerClass.ELEVATION][N].data,!U&&W&&V>=E.getElevationDesiredResolutionLevel(this.level));aa=aa.parent);if(U=U||W)U.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],R),Infinity!==R.min&&(R.level=U.level,T=!0)}T&&(g.isNone(S.elevationBounds)&&(S.elevationBounds=new v.ElevationBounds),S.elevationBounds.copyFrom(R))}};P.modifyLayers=function(N,R,S){S=this.layerInfo[S];for(var T of S)T.loadingAgent&&T.loadingAgent!==A.TILE_AGENT_DONE&&(G(T.loadingAgent),
T.loadingAgent=null),T.waitingAgents.clear();for(T=0;T<S.length;++T)void 0===N[T]&&S[T].release();N=Array(...S);T=R.length;S.length=T;for(let V=0;V<T;V++){const W=R[V];S[V]=-1<W?N[W]:p.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool)}this._updateMemoryUsed()};P.restartAgents=function(N){this.renderData&&(this._createOrUpdateAgents(0,N),this.updateRenderData(N,t.TextureUpdate.FADING))};P.updateAgents=function(N){if(this.renderData){const R=this.layerInfo[N];for(const S of R)S.loadingAgent===
A.TILE_AGENT_DONE&&(S.loadingAgent=null);this._createOrUpdateAgents(0,N)}};P.updateAgentSuspension=function(){for(const N of r.LayerClasses){const R=this._isSuspended(N);for(const S of this.layerInfo[N])S.loadingAgent&&S.loadingAgent!==A.TILE_AGENT_DONE&&(S.loadingAgent.setSuspension(R),S.loadingAgent===A.TILE_AGENT_DONE&&this.updateRenderData(N,t.TextureUpdate.FADING))}};P.removeLayerAgent=function(N,R){N=this.layerInfo[R][N];N.loadingAgent&&N.loadingAgent!==A.TILE_AGENT_DONE&&N.loadingAgent.dispose();
N.loadingAgent=null};P.agentDone=function(N,R){const S=this.layerInfo[R][N];S.loadingAgent=A.TILE_AGENT_DONE;S.data||S.upsampleInfo||this._createOrUpdateAgents(N+1,R)};P._createOrUpdateAgents=function(N,R){const S=this._isSuspended(R),T=this.layerInfo[R];for(;N<T.length;++N){const aa=T[N];var V=!1;const da=this._surface.layerViewByIndex(N,R);var W=y.getLayerWithExtentRange(da);if(aa.loadingAgent)C.fallsWithinLayer(this,W,!1)?(aa.loadingAgent!==A.TILE_AGENT_DONE&&aa.loadingAgent.setSuspension(S),aa.loadingAgent!==
A.TILE_AGENT_DONE&&(V=aa.loadingAgent.update())):aa.dispose();else if(C.fallsWithinLayer(this,W,!1)){{V=N;W=R;var U=S;const Y=W===r.LayerClass.ELEVATION?O.acquire():I.acquire();Y.init(this,V,W,U);V=Y}aa.loadingAgent=V;(V=aa.loadingAgent.startLoading())?aa.loadingAgent===A.TILE_AGENT_DONE&&this.setPendingUpdate(D.TileUpdate.GEOMETRY):(G(aa.loadingAgent),aa.loadingAgent=A.TILE_AGENT_DONE)}aa.loadingAgent===A.TILE_AGENT_DONE&&this.updateRenderData(R,t.TextureUpdate.FADING);if(V&&da.isOpaque)break}};
P._isWithinExtent=function(N){const R=this.extent;return R[0]>=N[0]&&N[2]>=R[2]&&R[1]>=N[1]&&N[3]>=R[3]};P.intersectsExtent=function(N){const R=this.extent;return R[2]>=N[0]&&N[2]>=R[0]&&R[3]>=N[1]&&N[3]>=R[1]};P.getElevationBasedVerticesPerRow=function(N){const R=this.vlevel-this.level;N=Math.max(this.level-N,E.getElevationDesiredResolutionLevel(this.level)-R);return c.clamp((this.maxTesselation>>N)+1,2,this.maxTesselation+1)};b._createClass(J,[{key:"usedMemory",get:function(){-1===this._usedMemory&&
this._updateMemoryUsed();return this._usedMemory+(this.isCached?0:this.mapTileMemory)}},{key:"cachedMemory",get:function(){return this.isCached?this.mapTileMemory:0}},{key:"mapTileMemory",get:function(){-1===this._usedMemory&&this._updateMemoryUsed();let N=this._mapTileMemory;for(const {data:R}of this.layerInfo[r.LayerClass.MAP])R instanceof m.VectorTile&&(N+=R.memoryUsage);return N}},{key:"isCached",get:function(){return!this.shouldLoad&&0>=this._mapDataRefCount}},{key:"maxTesselation",get:function(){return this._maxTesselation}},
{key:"isWithinClippingArea",get:function(){return this._isWithinClippingArea}},{key:"intersectsClippingArea",get:function(){return this._intersectsClippingArea}},{key:"clippingArea",get:function(){return this._clippingArea}},{key:"parent",get:function(){return this._parent}},{key:"children",get:function(){return this._children}},{key:"surface",get:function(){return this._surface}},{key:"elevationBounds",get:function(){return this._elevationBounds}},{key:"level",get:function(){return this.lij[0]}},
{key:"key",get:function(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}},{key:"edgeLen",get:function(){return this._edgeLen}},{key:"radius",get:function(){return this._center[a.CenterPosition.MIDDLE][3]}},{key:"screenDepth",get:function(){return this._screenDepth}},{key:"visible",get:function(){this._dirty&&this.computeVisibility();return this._visible}},{key:"loadable",get:function(){return this.visible||this._surface.view.state.fixedContentCamera}},{key:"rendered",get:function(){const N=
!!this.renderData;N!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=N,this._surface.renderer.setNeedsRender());return N}},{key:"shouldLoad",get:function(){if(!this.loadable)return!1;if(this._surface.lodSnapping===t.LODSnapping.ON){const N=this.level-this._surface.snapLevel;if(0===N)return!0;if(1===N)return!1}return this.isLeaf}},{key:"cpuImageMemorySize",get:function(){const N=this._surface.tilingScheme.pixelSize;return N*N*4}},{key:"updating",
get:function(){if(this.hasPendingUpdates)return!0;for(const N of r.LayerClasses){const R=this.layerInfo[N];for(const S of R)if(S.loadingAgent&&S.loadingAgent!==A.TILE_AGENT_DONE&&S.loadingAgent.updating)return!0}return!1}},{key:"hasPendingUpdates",get:function(){return 0!==this._pendingUpdates}},{key:"isLeaf",get:function(){return null==this._children[0]}},{key:"test",get:function(){return{cachedMemory:this.cachedMemory}}}]);return J}();const I=new h(x.MapTileAgent),O=new h(q.ElevationTileAgent),
Q=new v.ElevationBounds;a.CenterPosition=void 0;(function(J){J[J.TOP=0]="TOP";J[J.MIDDLE=1]="MIDDLE";J[J.BOTTOM=2]="BOTTOM"})(a.CenterPosition||(a.CenterPosition={}));a.SplitLimits=function(){this.angledSplitBias=this.maxLod=this.relativeHeightLimit=this.relativeWidthLimit=this.fovY=this.fovX=0;this.aboveGround=!0};a.Tile=K;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/ElevationTileAgent":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./TerrainConst",
"./TileAgent"],function(a,b,c,g){g=function(h){function w(){var n=h.apply(this,arguments)||this;n._scaleRangeEnabled=!1;return n}b._inheritsLoose(w,h);b._createClass(w,[{key:"_desiredMinLevelDelta",get:function(){return c.getElevationDesiredResolutionLevel(this.tile.level)-(this.tile.vlevel-this.tile.level)}},{key:"_progressiveLevelModulo",get:function(){return 0}}]);return w}(g.TileAgent);a.ElevationTileAgent=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TileAgent":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ./interfaces ./TerrainConst ./terrainUtils ./tileUtils".split(" "),
function(a,b,c,g,h,w,n){let f=function(){function e(){}var d=e.prototype;d.init=function(m,z,v,q){this.tile=m;this._layerIdx=z;this._layerClass=v;this._suspended=q;this._tileLayerInfo=m.getLayerInfo(z,v);this._tileRequested=null;m=this._findAncestorWithData();this._setUpsampleTile(m)};d.startLoading=function(){return this._requestNext()};d.dispose=function(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null);this._tileLayerInfo=
this.tile=null};d.setSuspension=function(m){m!==this._suspended&&((this._suspended=m)?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())};d.update=function(){const m=this._findAncestorWithData();this._setUpsampleTile(m);return this._requestNext()};d.dataArrived=function(m){this._setUpsampleTile(m);this._tileRequested=null;m===this.tile?this.tile.updateRenderData(this._layerClass,g.TextureUpdate.FADING):
this._requestNext()};d.dataMissing=function(){this._tileRequested=null;this._tileLayerInfo.data=null;this._requestNext()};d._agentDone=function(){this.tile.agentDone(this._layerIdx,this._layerClass);this.dispose()};d._requestNext=function(){if(this._suspended)return!0;const m=this._findNextDownload();if(this._tileRequested){if(m===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this);this._tileRequested=null}c.isSome(m)?m.requestLayerData(this._layerIdx,
this._layerClass,this)&&(this._tileRequested=m):this._agentDone();return!!this._tileRequested};d._findNextDownload=function(){const m=this._layerIdx,z=this._layerClass;var v=this.tile.surface.layerViewByIndex(m,z);const q=w.getLayerWithExtentRange(v),{minLevel:t,maxLevel:r}=v.dataLevelRange;v=this._desiredMinLevelDelta;const x=this._progressiveLevelModulo+v,u=this._scaleRangeEnabled?n.fallsWithinLayer:()=>!0;let E=this.tile;const y=E.level;let A;var p=this._tileLayerInfo.upsampleInfo;p=p?p.tile.level:
-1;const B=c.get(q,"tilemapCache");for(;E&&u(E,q,!1)&&E.level>=t;){const D=E.level,C=y-D,F=E.layerInfo[z][m];if(F.data&&C>=v){D>p&&this._setUpsampleTile(E);F.dataInvalidated&&(A=E);break}if((c.isNone(B)||"unavailable"!==B.getAvailability(E.lij[0],E.lij[1],E.lij[2]))&&D<=r&&!F.data&&!F.dataMissing){if(c.isNone(A)||E.level===t||0===D%h.PROGRESSIVE_LOADING_MODULO||y-A.level<v)A=E;if(C>=x)break}E=E.parent}c.isSome(A)&&y-A.level<v&&this._tileLayerInfo.upsampleInfo&&(A=null);return A};d._findAncestorWithData=
function(){const m=this.tile.vlevel,z=this._desiredMinLevelDelta;let v;for(let q=this.tile;q;q=q.parent)if(q.hasLayerData(this._layerIdx,this._layerClass)){if(m-q.level>=z)return q;v=q}return v};d._setUpsampleTile=function(m){this._tileLayerInfo.setUpsampleInfo(this.tile,m);this.tile.updateRenderData(this._layerClass,g.TextureUpdate.FADING)};b._createClass(e,[{key:"updating",get:function(){return!!this._tileRequested}},{key:"test",get:function(){return{findNextDownload:()=>this._findNextDownload(),
tileLayerInfo:this._tileLayerInfo}}}]);return e}();var l=function(e){function d(){return e.apply(this,arguments)||this}b._inheritsLoose(d,e);d.prototype.dispose=function(){};b._createClass(d,[{key:"_desiredMinLevelDelta",get:function(){throw k;}},{key:"_progressiveLevelModulo",get:function(){throw k;}}]);return d}(f);const k=Error("Abstract method called on TileAgent");l=new l;a.TILE_AGENT_DONE=l;a.TileAgent=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/tileUtils":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../core/PooledArray"],function(a,b,c,g){function h(l,k){k(l);if(!l.isLeaf)for(const e of l.children)h(e,k)}function w(l,k,e){l=l.screenDepth;k=k.screenDepth;return l<k?-e:l>k?e:0}let n=function(){function l(){this._queue=new g;this._last=null;this.remove=()=>{}}var k=l.prototype;k.resetOne=function(e){this._queue.clear();this._queue.push(e);this._last=null};k.reset=function(e=null){this._queue.clear();c.isSome(e)&&this._queue.pushArray(e);
this._last=null};k.skipSubtree=function(){this._last=null};k.next=function(){this._last&&!this._last.isLeaf&&this._queue.pushArray(this._last.children);return this._last=this._queue.pop()};b._createClass(l,[{key:"done",get:function(){return 0===this._queue.length&&(!this._last||this._last.isLeaf)}}]);return l}(),f=function(){function l(){this.q=new g}var k=l.prototype;k.reset=function(e){this.q.clear();if(!c.isNone(e))for(this.q.pushArray(e),e=0;e<this.q.length;++e){const d=this.q.data[e];d.isLeaf||
this.q.pushArray(d.children)}};k.next=function(){return this.q.pop()};b._createClass(l,[{key:"done",get:function(){return 0===this.q.length}}]);return l}();a.IteratorPostorder=f;a.IteratorPreorder=n;a.compareTiles=w;a.computeUpsampleInfo=function(l,k,e){let d=1,m=0,z=0;for(;l!==k;)if(d*=.5,m*=.5,z*=.5,l.lij[2]&1&&(m+=.5),0===(l.lij[1]&1)&&(z+=.5),l=l.parent,null==l)throw Error("tile was not a descendant of upsampleTile");e.init(k,m,z,d)};a.fallsWithinLayer=function(l,k,e){if(c.isNone(k)||c.isNone(k.fullExtent))return!1;
const d=k.fullExtent,m=l.extent;if(e){if(m[0]<d.xmin||m[1]<d.ymin||m[2]>d.xmax||m[3]>d.ymax)return!1}else if(d.xmin>m[2]||d.ymin>m[3]||d.xmax<m[0]||d.ymax<m[1])return!1;l=l.surface.tilingScheme.levels[l.level].scale;return 0<k.minScale&&l>1.00000001*k.minScale||0<k.maxScale&&l<.99999999*k.maxScale?!1:!0};a.hasLoadableSiblings=function(l){for(let k=0;k<l.length;k++){const e=l[k],d=e.parent;if(d)for(let m=0;4>m;m++){const z=d.children[m];if(z&&z!==e&&z.loadable)return!0}}return!1};a.sortTiles=function(l,
k){k.sort((e,d)=>w(e,d,l))};a.sortTilesByPOI=function(l,k){const e=new Map;l.forAll(d=>e.set(d.lij,d.distanceToSquared(k)));l.sort((d,m)=>e.get(d.lij)-e.get(m.lij))};a.tilesAreRelated=function(l,k){if(!l||!k||l[0]===k[0])return!1;const e=l[0]<k[0],d=e?l:k;l=e?k:l;k=1<<l[0]-d[0];return Math.floor(l[1]/k)===d[1]&&Math.floor(l[2]/k)===d[2]};a.traverseTilesPreorder=function(l,k){if(Array.isArray(l))for(let e=0;e<l.length;e++)h(l[e],k);else h(l,k)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/MapTileAgent":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","./TerrainConst","./TileAgent"],function(a,b,c,g){g=function(h){function w(){var n=h.call(this)||this;n._scaleRangeEnabled=!0;return n}b._inheritsLoose(w,h);b._createClass(w,[{key:"_desiredMinLevelDelta",get:function(){return 0}},{key:"_progressiveLevelModulo",get:function(){return c.PROGRESSIVE_LOADING_MODULO}}]);return w}(g.TileAgent);a.MapTileAgent=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/RasterTile":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../webgl/enums","../../webgl/rasterUtils"],function(a,b,c,g,h){const w={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let n=function(){function f(k,e,d=null,m=null){this.type="raster-tile";this._interpolation=this._bandIds=this._symbolizerParameters=this._source=
this._memoryUsed=null;this._dirty=!1;this._transformGrid=null;this.isRendereredSource=!1;this.lij=this.rawPixelData=this.symbolizerRenderer=null;this.scale=1;this.offset=[0,0];this.opacity=1;this.lij=k;this.source=e;this.width=d||e.width;this.height=m||e.height}var l=f.prototype;l.bind=function(k){if(!(this.source&&this.source.pixels&&0<this.source.pixels.length))return!1;this._rasterTexture&&!this._dirty||this._updateRasterTexture(k,this.bandIds);this._rasterTexture&&(this._updateColormapTexture(k),
this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=h.createTransformTexture(k,this.transformGrid)));return!0};l.getUniforms=function(){const k=h.getBasicGridUniforms(this.scale,this.offset),{symbolizerParameters:e,transformGrid:d,width:m,height:z,opacity:v}=this,q=h.getCommonUniforms(d,[m,z],[this.source.width,this.source.height],v),t=e.colormap?h.getColormapUniforms(e.colormap,e.colormapOffset):null,r="stretch"===this.symbolizerParameters.type?h.getStretchUniforms(this.symbolizerParameters):
null,x="hillshade"===this.symbolizerParameters.type?h.getShadedReliefUniforms(this.symbolizerParameters):null;return{basic:k,common:q,colormap:t,stretch:r,hillshade:x}};l.getTextures=function(){const k=[],e=[];this._rasterTexture&&(e.push(this._rasterTexture),k.push("u_image"),this._transformGridTexture&&(e.push(this._transformGridTexture),k.push("u_transformGrid")),this._colormapTexture&&(e.push(this._colormapTexture),k.push("u_colormap")));return{names:k,textures:e}};l.release=function(){this._rasterTexture=
c.disposeMaybe(this._rasterTexture);this._transformGridTexture=c.disposeMaybe(this._transformGridTexture);this._colormapTexture=c.disposeMaybe(this._colormapTexture);this.rawPixelData=this.transformGrid=this.source=null;return!0};l._updateRasterTexture=function(k,e){const d=this.source?this.source.extractBands(e):null;if(d&&d.pixels&&0<d.pixels.length){e=c.isNone(e)&&c.isNone(this.bandIds)||c.isSome(e)&&c.isSome(this.bandIds)&&e.join("")===this.bandIds.join("");if(this._rasterTexture){if(e)return;
this._rasterTexture.dispose();this._rasterTexture=null}e=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=h.createRasterTexture(k,d,e,this.isRendereredSource||this.hasStretchTypeNone())}else this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null)};l.hasStretchTypeNone=function(){return"stretchType"in this.symbolizerParameters&&"none"===this.symbolizerParameters.stretchType&&!this.symbolizerParameters.useGamma&&"u8"===this.source.pixelType};l._getRasterTextureInterpolation=
function(k){return"lut"===this.symbolizerParameters.type||"nearest"===k||"majority"===k?"nearest":"bilinear"};l._updateColormapTexture=function(k){const e=this._colormap,d=this.symbolizerParameters.colormap;if(!d)this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormap=null;else if(!e)this._colormapTexture=h.createColormapTexture(k,d),this._colormap=d;else if(d.length!==e.length||d.some((m,z)=>m!==e[z]))this._colormapTexture&&(this._colormapTexture.dispose(),
this._colormapTexture=null),this._colormapTexture=h.createColormapTexture(k,d),this._colormap=d};b._createClass(f,[{key:"source",get:function(){return this._source},set:function(k){this._source=k;this._rasterTexture&&(this._rasterTexture.dispose(),this._memoryUsed=this._rasterTexture=null)}},{key:"symbolizerParameters",get:function(){return this.isRendereredSource?{...w,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||w},set:function(k){this._symbolizerParameters=k}},{key:"bandIds",get:function(){return this._bandIds},
set:function(k){c.isSome(k)&&0<k.length?this._bandIds&&k.every((e,d)=>this._bandIds[d]?e===this._bandIds[d]:!1)||(this._bandIds=k,this._dirty=!0):this._bandIds=null}},{key:"interpolation",get:function(){return this._interpolation||"nearest"},set:function(k){this._interpolation=k;this._rasterTexture&&(k=this._getRasterTextureInterpolation(k),this._rasterTexture.setSamplingMode("bilinear"===k?g.TextureSamplingMode.LINEAR:g.TextureSamplingMode.NEAREST))}},{key:"transformGrid",get:function(){return this._transformGrid},
set:function(k){this._transformGrid=k;this._transformGridTexture&&(this._transformGridTexture.dispose(),this._memoryUsed=this._transformGridTexture=null)}},{key:"memoryUsage",get:function(){if(c.isNone(this._memoryUsed)){const k=this.getTextures();if(null==k)return 0;this._memoryUsed=k.textures.map(e=>e.descriptor.width*e.descriptor.height*4).reduce((e,d)=>e+d,0)}return this._memoryUsed}}]);return f}();a.RasterTile=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/rasterUtils":function(){define(["exports",
"./context-util","./enums","./FramebufferObject","./Texture"],function(a,b,c,g,h){a.createColormapTexture=function(w,n){return new h.Texture(w,{width:n.length/4,height:1,target:c.TextureType.TEXTURE_2D,pixelFormat:c.PixelFormat.RGBA,internalFormat:c.PixelFormat.RGBA,dataType:c.PixelType.UNSIGNED_BYTE,samplingMode:c.TextureSamplingMode.NEAREST,wrapMode:c.TextureWrapMode.CLAMP_TO_EDGE,flipped:!1},n)};a.createFrameBuffer=function(w,n,f,l){l=new h.Texture(w,{width:n,height:f,target:c.TextureType.TEXTURE_2D,
pixelFormat:c.PixelFormat.RGBA,internalFormat:c.PixelFormat.RGBA,samplingMode:c.TextureSamplingMode.NEAREST,dataType:l?c.PixelType.UNSIGNED_BYTE:c.PixelType.FLOAT,wrapMode:c.TextureWrapMode.CLAMP_TO_EDGE,flipped:!1});return new g.FramebufferObject(w,{colorTarget:c.TargetType.TEXTURE,depthStencilTarget:c.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER,width:n,height:f},l)};a.createRasterTexture=function(w,n,f="nearest",l=!1){var k;const e=(l=!(l&&"u8"===n.pixelType))?c.PixelType.FLOAT:c.PixelType.UNSIGNED_BYTE,
d=null==n.pixels||0===n.pixels.length?null:l?n.getAsRGBAFloat():n.getAsRGBA(),m=null==(k=w.capabilities.textureFloat)?void 0:k.textureFloatLinear;return new h.Texture(w,{width:n.width,height:n.height,target:c.TextureType.TEXTURE_2D,pixelFormat:c.PixelFormat.RGBA,internalFormat:w.type===b.ContextType.WEBGL2&&l?c.SizedPixelFormat.RGBA32F:c.PixelFormat.RGBA,samplingMode:!m||"bilinear"!==f&&"cubic"!==f?c.TextureSamplingMode.NEAREST:c.TextureSamplingMode.LINEAR,dataType:e,wrapMode:c.TextureWrapMode.CLAMP_TO_EDGE,
flipped:!1},d)};a.createTransformTexture=function(w,n){const {spacing:f,offsets:l,coefficients:k,size:[e,d]}=n;var m=1<f[0];n={width:m?4*e:e,height:d,target:c.TextureType.TEXTURE_2D,pixelFormat:c.PixelFormat.RGBA,internalFormat:w.type===b.ContextType.WEBGL2?c.SizedPixelFormat.RGBA32F:c.PixelFormat.RGBA,dataType:c.PixelType.FLOAT,samplingMode:c.TextureSamplingMode.NEAREST,wrapMode:c.TextureWrapMode.CLAMP_TO_EDGE,flipped:!1};const z=new Float32Array(m?e*d*16:2*l.length);if(m)for(let v=0,q=0;v<k.length;v++)z[q++]=
k[v],2===v%3&&(z[q++]=1);else for(m=0;m<d;m++)for(let v=0;v<e;v++){const q=4*(m*e+v),t=2*(v*d+m);z[q]=l[t];z[q+1]=l[t+1];z[q+3]=-1===l[t]?0:1}return new h.Texture(w,n,z)};a.getBasicGridUniforms=function(w,n){return{u_scale:w,u_offset:n}};a.getColormapUniforms=function(w,n){return{u_colormapOffset:n||0,u_colormapMaxIndex:w?w.length/4-1:null}};a.getCommonUniforms=function(w,n,f,l=1,k=!0,e=!1){return{u_flipY:k,u_isFloatTexture:e,u_applyTransform:w?!0:!1,u_opacity:l,u_transformSpacing:w?w.spacing:null,
u_transformGridSize:w?w.size:null,u_targetImageSize:n,u_srcImageSize:f}};a.getShadedReliefUniforms=function(w){return{u_hillshadeType:w.hillshadeType,u_sinZcosAs:w.sinZcosAs,u_sinZsinAs:w.sinZsinAs,u_cosZs:w.cosZs,u_weights:w.weights,u_factor:w.factor,u_minValue:w.minValue,u_maxValue:w.maxValue}};a.getStretchUniforms=function(w){return{u_bandCount:w.bandCount,u_minOutput:w.outMin,u_maxOutput:w.outMax,u_minCutOff:w.minCutOff,u_maxCutOff:w.maxCutOff,u_factor:w.factor,u_useGamma:w.useGamma,u_gamma:w.gamma,
u_gammaCorrection:w.gammaCorrection}};a.getUniformLocationInfos=function(w,n){w=w.gl;n=n.glName;const f=w.getProgramParameter(n,w.ACTIVE_UNIFORMS),l=new Map;let k;for(let e=0;e<f;e++)(k=w.getActiveUniform(n,e))&&l.set(k.name,{location:w.getUniformLocation(n,k.name),info:k});return l};a.setTextures=function(w,n,f,l){f.length===l.length&&(l.some(k=>null==k)||f.some(k=>null==k)||f.forEach((k,e)=>{n.setUniform1i(k,e);w.bindTexture(l[e],e)}))};a.setUniforms=function(w,n,f){Object.keys(f).forEach(l=>{var k=
n.get(l)||n.get(l+"[0]");if(k){var e=f[l];if(null!==k&&null!=e)switch({info:k}=k,k.type){case c.UniformType.FLOAT:1<k.size?w.setUniform1fv(l,e):w.setUniform1f(l,e);break;case c.UniformType.FLOAT_VEC2:w.setUniform2fv(l,e);break;case c.UniformType.FLOAT_VEC3:w.setUniform3fv(l,e);break;case c.UniformType.FLOAT_VEC4:w.setUniform4fv(l,e);break;case c.UniformType.FLOAT_MAT3:w.setUniformMatrix3fv(l,e);break;case c.UniformType.FLOAT_MAT4:w.setUniformMatrix4fv(l,e);break;case c.UniformType.INT:1<k.size?w.setUniform1iv(l,
e):w.setUniform1i(l,e);break;case c.UniformType.BOOL:w.setUniform1i(l,e?1:0);break;case c.UniformType.INT_VEC2:case c.UniformType.BOOL_VEC2:w.setUniform2iv(l,e);break;case c.UniformType.INT_VEC3:case c.UniformType.BOOL_VEC3:w.setUniform3iv(l,e);break;case c.UniformType.INT_VEC4:case c.UniformType.BOOL_VEC4:w.setUniform4iv(l,e)}}})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ./terrainUtils ./tileUtils".split(" "),
function(a,b,c,g,h,w,n){let f=function(){function e(){this.waitingAgents=new h;this.requestAbort=this.requestPromise=this.loadingAgent=this._upsampleInfo=null;this.pendingUpdates=0}e.acquire=function(m){const z=l.acquire();z._init(m);return z};var d=e.prototype;d.release=function(){this.dispose();k.delete(this);l.release(this)};d.dispose=function(){this.loadingAgent=c.disposeMaybe(this.loadingAgent);this.abortRequest();this._unsetUpsampleInfo();this.pendingUpdates=0;this._data=w.releaseTileData(this._data)};
e.prune=function(){l.prune(0)};d._init=function(m){this.waitingAgents.clear();this._data=w.releaseTileData(this._data);this.dataInvalidated=this.dataMissing=!1;this._unsetUpsampleInfo();this.abortRequest();this.loadingAgent=null;this.pendingUpdates=0;this._pool=m;this.elevationBounds=null};d.invalidateSourceData=function(){this.dataInvalidated=!0;this.dataMissing=!1;this._unsetUpsampleInfo()};d.abortRequest=function(){this.requestAbort=c.abortMaybe(this.requestAbort);this.requestPromise=null};d._unsetUpsampleInfo=
function(){this._upsampleInfo&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)};d.setUpsampleInfo=function(m,z){if(m===z||c.isNone(z))this._unsetUpsampleInfo();else{if(null==this._upsampleInfo)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===z)return;this._upsampleInfo.tile.unrefMapData()}z.refMapData();n.computeUpsampleInfo(m,z,this._upsampleInfo)}};b._createClass(e,[{key:"upsampleInfo",get:function(){return this._upsampleInfo}},
{key:"data",get:function(){return this._data},set:function(m){w.releaseTileData(this._data);this._data=m}}]);return e}();const l=new g(f,null,()=>{}),k=new Map;a.TilePerLayerInfo=f;a.printAllocations=function(){0<k.size&&(console.log(`${k.size} live TilePerLayerInfo allocations:`),k.forEach(e=>console.log(e,"\n")))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TileTexture":function(){define(["../../../chunks/_rollupPluginBabelHelpers"],function(a){return function(){function b(g){this._texture=
g;this.type="tile-texture";this._refCount=1}var c=b.prototype;c.retain=function(){++this._refCount};c.release=function(){--this._refCount;0===this._refCount&&this._texture.dispose()};c.generateMipmap=function(){this._texture.generateMipmap()};a._createClass(b,[{key:"texture",get:function(){return this._texture}},{key:"descriptor",get:function(){return this._texture.descriptor}}]);return b}()})},"esri/views/3d/terrain/TileUpdate":function(){define(["exports"],function(a){a.TileUpdate=void 0;var b=
a.TileUpdate||(a.TileUpdate={});b[b.NONE=0]="NONE";b[b.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD";b[b.SPLIT=2]="SPLIT";b[b.VSPLITMERGE=4]="VSPLITMERGE";b[b.MERGE=8]="MERGE";b[b.RENDERDATA=16]="RENDERDATA";b[b.GEOMETRY=32]="GEOMETRY";b[b.TEXTURE_NOFADING=64]="TEXTURE_NOFADING";b[b.TEXTURE_FADING=128]="TEXTURE_FADING";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/RenderOrder":function(){define(["exports"],function(a){a.RenderOrder=void 0;var b=a.RenderOrder||(a.RenderOrder={});
b[b.BACK_TO_FRONT=-1]="BACK_TO_FRONT";b[b.NONE=0]="NONE";b[b.FRONT_TO_BACK=1]="FRONT_TO_BACK";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/SphericalPatch":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/frustum ../../../geometry/support/plane ./interfaces ./PatchGeometryFactory ./Tile".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){d=function(v){function q(r,x,u){var E=v.call(this)||this;E.obb=Array(8);E.isWebMercator=!1;for(let y=0;8>y;y++)E.obb[y]=h.create();void 0!==r&&E.init(r,x,u);return E}b._inheritsLoose(q,v);var t=q.prototype;t.init=function(r,x,u){v.prototype.init.call(this,r,x,u);this.isWebMercator=u.tilingScheme.spatialReference.isWebMercator;x=this.ellipsoid.radius;u=this.extentInRadians[0];const E=this.extentInRadians[1],y=this.extentInRadians[2],A=this.extentInRadians[3];r=r[0];
const p=c.lerp(E,A,.5),B=c.lerp(u,y,.5);this._edgeLen=(y-u)*Math.cos(0===r?0:Math.min(Math.abs(E),Math.abs(A)))*x;this._edgeLen2=this._edgeLen*this._edgeLen;this._curvatureHeight=x-Math.sqrt(x*x-this._edgeLen2/4);w.lonLatToSphericalPCPF(this.centerAtSeaLevel,B,p,this.ellipsoid.radius,0);x=h.fromArray(this.centerAtSeaLevel);g.normalize(x,x);this.up=x;this._updateOBB();this.updateRadiusAndCenter()};t.updateRadiusAndCenter=function(){if(0===this.lij[0])g.set(this._center[a.CenterPosition.MIDDLE],0,0,
0),g.set(this._center[a.CenterPosition.TOP],0,0,0),g.set(this._center[a.CenterPosition.BOTTOM],0,0,0),this.ellipsoid||(this.ellipsoid=n.getReferenceEllipsoid(this.surface.spatialReference)),this._center[a.CenterPosition.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const r=Math.max(g.squaredDistance(this._center[a.CenterPosition.MIDDLE],this.obb[0]),g.squaredDistance(this._center[a.CenterPosition.MIDDLE],this.obb[1]));this._center[a.CenterPosition.MIDDLE][3]=Math.sqrt(r)}};
t._isVisible=function(r){if(!f.intersectsSphere(r,this._center[a.CenterPosition.MIDDLE]))return!1;if(10>this.lij[0])return!0;const x=this.obb;for(let y=0;y<f.NumPlanes.NUM;y++){var u=y===f.PlaneIndex.NEAR,E=r[y];u&&(z[0]=E[0],z[1]=E[1],z[2]=E[2],z[3]=E[3]-this.surface.view.state.camera.near);u=u?z:E;for(E=0;8>E;E++){const A=x[E];if(0>u[0]*A[0]+u[1]*A[1]+u[2]*A[2]+u[3])break}if(8===E)return!1}return!0};t.computeElevationBounds=function(){v.prototype.computeElevationBounds.call(this);this._updateOBB()};
t.createGeometry=function(r,x){const u=this._getPatchType(this.lij[1],this.lij[0]);e.createSphericalGlobePatch(r,this.extent,x,this.renderData,this.extentInRadians,this.isWebMercator,this.ellipsoid,u);this.setMemoryDirty()};t._updateOBB=function(){const r=this.extentInRadians,x=this.obb;for(let u=0;2>u;u++){const E=this.elevationBounds[u];let y=4*u;w.lonLatToSphericalPCPF(x[y++],r[0],r[1],this.ellipsoid.radius,E);w.lonLatToSphericalPCPF(x[y++],r[0],r[3],this.ellipsoid.radius,E);w.lonLatToSphericalPCPF(x[y++],
r[2],r[3],this.ellipsoid.radius,E);w.lonLatToSphericalPCPF(x[y++],r[2],r[1],this.ellipsoid.radius,E)}if(this.isWebMercator)switch(this._getPatchType(this.lij[1],this.lij[0])){case k.PatchType.HAS_NORTH_POLE:g.set(x[1],0,0,this.ellipsoid.radius);g.set(x[2],0,0,this.ellipsoid.radius);g.set(x[5],0,0,this.ellipsoid.radius);g.set(x[6],0,0,this.ellipsoid.radius);break;case k.PatchType.HAS_SOUTH_POLE:g.set(x[0],0,0,-this.ellipsoid.radius),g.set(x[3],0,0,-this.ellipsoid.radius),g.set(x[4],0,0,-this.ellipsoid.radius),
g.set(x[7],0,0,-this.ellipsoid.radius)}};t._getPatchType=function(r,x){return r===(1<<x)-1?0===r?k.PatchType.HAS_BOTH_POLES:k.PatchType.HAS_SOUTH_POLE:0===r?k.PatchType.HAS_NORTH_POLE:k.PatchType.REGULAR};t.intersectsRay=function(r,x,u,E,y){E=this._center[a.CenterPosition.MIDDLE];u=E[3]+u+.2*this.ellipsoid.radius*Math.abs(y*(this.extentInRadians[3]-this.extentInRadians[1]));var A=E[0]-r[0];y=E[1]-r[1];r=E[2]-r[2];E=(A*x[0]+y*x[1]+r*x[2])/(x[0]*x[0]+x[1]*x[1]+x[2]*x[2]);A=x[0]*E-A;y=x[1]*E-y;x=x[2]*
E-r;return A*A+y*y+x*x<u*u};t.getDefaultVerticesPerRowOnLevel=function(){return this.level<m.length?m[this.level]+1:2};return q}(d.Tile);const m=[128,64,32,16,16,8,8,4],z=l.create();a.CenterPosition=void 0;(function(v){v[v.TOP=0]="TOP";v[v.MIDDLE=1]="MIDDLE";v[v.BOTTOM=2]="BOTTOM"})(a.CenterPosition||(a.CenterPosition={}));a.SphericalPatch=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TerrainRenderer":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/maybe ../../../core/ObjectPool ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/buffer/BufferView ../../../support/requestImageUtils ../../ViewingMode ./interfaces ./LayerClass ./Overlay ./OverlayRenderer ./PatchGeometryFactory ./PatchRenderData ./RenderOrder ./ScaleRangeQueries ./TerrainConst ./TileRenderer ./TileUpdate ./tileUtils ../webgl-engine/collections/Component/ComponentIntersectionData ../webgl-engine/core/shaderLibrary/ShaderOutputOptions ../webgl-engine/core/shaderLibrary/Slice.glsl ../webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl ../webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../webgl-engine/core/shaderLibrary/util/View.glsl ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Intersector ../webgl-engine/lib/IntersectorInterfaces ../webgl-engine/lib/Material ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/lib/VertexAttribute ../webgl-engine/lib/verticalOffsetUtils ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/shaders/TerrainTechnique ../../webgl/enums".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H,M,K,I,O,Q,J,P,N,R,S,T,V,W,U,aa,da,Y,ea,ja,la){function ia(Da,ua,Fa){Fa[0]=Da[0]*ua[2]+ua[0];Fa[1]=Da[1]*ua[3]+ua[1];Fa[2]=Da[2]*ua[2];Fa[3]=Da[3]*ua[3]}const ca=t.create(),fa=q.create();g=function(Da){function ua(qa){qa=Da.call(this,qa)||this;qa.type=T.IntersectorType.TERRAIN;qa.isGround=!0;qa.tileSize=256;qa.rctx=null;qa._isTransparent=!1;qa._scaleRangeQueries=new F.ScaleRangeQueries;qa.renderDataPool=new w(D.PatchRenderData);
qa._patchGroups=new Map;qa.patchGroupsDirty=!0;qa.tileIterator=new M.IteratorPreorder;qa.highestVisibleLODTile=null;qa.visible=!0;qa._opaque=!0;qa._skirtScale=1;qa._velvetOverground=!0;qa.castShadows=!0;qa._ssrEnabled=!1;qa.emptyTex=null;qa.tileRenderer=null;qa.tileBackgroundInitialized=!1;qa.tileBackgroundUpdating=!1;qa.stencilEnabledLayerExtents=[];qa.numTilesRendered=0;qa.numTilesCulled=0;qa.numOriginsRendered=0;qa.overlayOpacity=1;qa.needsHighlight=!1;qa.renderOccludedFlags=V.RenderOccludedFlag.Occlude;
return qa}a._inheritsLoose(ua,Da);var Fa=ua.prototype;Fa.initialize=function(){this.stage.addRenderPlugin([U.RenderSlot.OPAQUE_TERRAIN,U.RenderSlot.TRANSPARENT_TERRAIN,U.RenderSlot.OCCLUDED_TERRAIN],this)};Fa.destroy=function(){this.stage.removeRenderPlugin(this);B.clearCaches()};Fa.setDebugScreenSizePerspective=function(qa){this.shaderTechniqueConfig.screenSizePerspective!==qa&&(this.shaderTechniqueConfig.screenSizePerspective=qa,this.setNeedsRender())};Fa.setRootTiles=function(qa){this._rootTiles=
qa;this.setNeedsRender()};Fa.setNeedsHighlight=function(qa){this.needsHighlight=qa;this.setNeedsRender()};Fa.setRenderOccludedOverlay=function(qa){this.renderOccludedFlags=qa?p.overlayRenderOccludedFlag:V.RenderOccludedFlag.Occlude;this.setNeedsRender()};Fa.setStencilEnabledLayerExtents=function(qa){this.stencilEnabledLayerExtents=qa;this.setNeedsRender()};Fa.setTileSize=function(qa){this.tileSize=qa;this.tileRenderer&&(this.tileRenderer.tileSize=qa);this.setNeedsRender()};Fa.loadTile=function(qa){qa.renderData||
(qa.renderData=this.renderDataPool.acquire(),qa.renderData.init(qa),qa.renderData.localOrigin=this._getLocalOriginOfTile(qa));this.updateTileGeometry(qa);this.updateTileTexture(qa,H.TileUpdate.TEXTURE_FADING)};Fa.queryVisibleLevelRange=function(qa,sa,ma,ra){this._scaleRangeQueries.queryVisibleLevelRange(qa,sa,ma,ra);this.setNeedsRender()};Fa.updateTileTexture=function(qa,sa){this.tileRenderer&&this.tileBackgroundInitialized&&(this.tileRenderer.updateTileTexture(qa,sa===H.TileUpdate.TEXTURE_FADING?
E.TextureUpdate.FADING:E.TextureUpdate.UNFADED),this.setNeedsRender(),qa.resetPendingUpdate(sa))};Fa.updateTileGeometry=function(qa){for(const sa of qa.layerInfo[y.LayerClass.ELEVATION])sa.pendingUpdates&=~H.TileUpdate.GEOMETRY;qa.resetPendingUpdate(H.TileUpdate.GEOMETRY);qa.renderData.updateGeometry(this.rctx,this.wireframe)&&this.setNeedsRender()};Fa.unloadTile=function(qa){qa.renderData&&(qa.renderData.releaseGeometry()&&this.setNeedsRender(),this.renderDataPool.release(qa.renderData),qa.renderData.clear(),
qa.renderData=null,qa.setMemoryDirty(),this.setNeedsRender())};Fa._getLocalOriginOfTile=function(qa){const sa=Math.max(0,7*Math.floor((qa.level-3)/7));if(this.isGlobal&&0===sa)return v.ZEROS;for(;qa.parent&&qa.level>sa;)qa=qa.parent;return qa.centerAtSeaLevel};Fa.setVisibility=function(qa){this.visible=qa;this.setNeedsRender()};Fa.getStats=function(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numOriginsRendered:this.numOriginsRendered}};Fa.setNeedsRender=function(qa=
N.RenderRequestType.UPDATE){this.patchGroupsDirty=!0;this.context.requestRender(qa)};Fa.setTileBackground=function(qa){this.tileBackground=qa;this._updateTileBackground()};Fa.initializeRenderContext=function(qa){this.context=qa;this.rctx=qa.renderContext.rctx;this.shaderTechniques=qa.shaderTechniqueRepository;this.shaderTechniqueConfig=new ja.TerrainTechniqueConfiguration;this.tileRenderer=new L.TileRenderer(this.rctx,this.tileSize,this.shaderTechniques);this.tileBackground&&this._updateTileBackground();
this.emptyTex=R.createEmptyTexture(this.rctx)};Fa.uninitializeRenderContext=function(){null!=this.emptyTex&&(this.emptyTex.dispose(),this.emptyTex=null);this.tileRenderer&&(this.tileRenderer.dispose(),this.tileRenderer=null)};Fa.intersect=function(qa,sa,ma,ra){if(this._rootTiles&&(!qa.options.selectOpaqueTerrainOnly||!qa.options.selectionMode||this._opaque)){var va=ha,Ia=na;z.subtract(va,ra,ma);z.set(Ia,1/va[0],1/va[1],1/va[2]);var Ja=qa.results.min,Ha=qa.results.max,Ta=qa.results.ground,db=qa.options.store===
T.StoreResults.MIN,fb=!!qa.results.ground.target,ka=Y.getVerticalOffsetTerrain(qa.verticalOffset),cb=this._skirtScale,Ca=qa.tolerance,Ka,Oa=db&&h.isSome(Ja.dist)?Ja.dist:Infinity,wa=Na=>{var Ua=Na.renderData;if(null!=Ua){var Ya=Ua.geometryInfo;t.set(ca,Ya.boundingBox);Ua=Ua.localOrigin;h.isSome(ka)&&(ka.localOrigin=Ua,ka.applyToAabb(ca));var ya=-cb*Ya.skirtLength;if(0!==ya){var La=Na.up;t.expandWithOffset(ca,ya*La[0],ya*La[1],ya*La[2])}pa[0]=ma[0]-Ua[0];pa[1]=ma[1]-Ua[1];pa[2]=ma[2]-Ua[2];if(ea.intersectAabbInvDirBefore(ca,
pa,Ia,Ca,Oa)){var Va=($a,za,Pa)=>{$a.set(this.type,Na,za,Pa,m.IDENTITY);Oa=db&&h.isSome(Ja.dist)?Ja.dist:Infinity};La=($a,za)=>{h.isSome(za)&&0<=$a&&(qa.options.backfacesTerrain||0>z.dot(za,va))&&(qa.options.invisibleTerrain||!qa.options.selectionMode||null==sa||sa(ma,ra,$a))&&((null==Ta.dist||$a<Ta.dist)&&Va(Ta,$a,za),qa.options.isFiltered||(qa.options.store===T.StoreResults.ALL&&(h.isNone(Ka)?(Ka=S.newIntersectorResult(qa.ray),Va(Ka,$a,za),qa.results.all.push(Ka)):$a<Ka.dist&&Va(Ka,$a,za)),(null==
Ja.dist||$a<Ja.dist)&&Va(Ja,$a,za),qa.options.store!==T.StoreResults.MIN&&(null==Ha.dist||$a>Ha.dist)&&Va(Ha,$a,za)))};var hb=xa;z.subtract(hb,ra,Ua);var kb=Ya.indices,ib=Ya.vertexAttributes,ob={data:ib.getField(da.VertexAttribute.POSITION,r.BufferViewVec3f).typedBuffer,size:3,stride:ib.stride/4};Ya=Ya.numWithoutSkirtIndices/3;if(!h.isSome(ka)&&Ya>K.componentMinimalSizeForIntersectionData){var sb=Na.renderData;h.isSome(sb.intersectionData)||(sb.intersectionData=new K.ComponentIntersectionData(kb,
0,Ya,ob));sb.intersectionData.intersectRay({r0:pa,r1:hb},La)}else ea.intersectTriangles(pa,hb,0,Ya,kb,ob,null,ka,La);if(0!==ya){const $a=kb.length/3;this.isGlobal?(ob=$a-Ya,!h.isSome(ka)&&ob>K.componentMinimalSizeForIntersectionData?(sb=Na.renderData,h.isSome(sb.skirtIntersectionData)||(Ua=B.getGlobalSkirtGeometry(kb,Ya,$a,ib,ya,Ua),sb.skirtIntersectionData=new K.ComponentIntersectionData(Ua.indices,0,ob,{data:Ua.vertices,stride:3})),sb.skirtIntersectionData.intersectRay({r0:pa,r1:hb},La)):B.intersectSkirtsGlobal(pa,
hb,Ya,$a,kb,ib,ya,Ua,ka,La)):B.intersectSkirtsLocal(pa,hb,Ya,$a,kb,ib,ya,ka,La)}}}},Aa=this._rootTiles;h.isSome(Aa)&&(()=>{const Na=this.tileIterator;Na.reset(Aa);const Ua=qa.options.invisibleTerrain;for(;!Na.done;){const Ya=Na.next();!(Ya.visible||Ua&&Ya.intersectsClippingArea)||!h.isSome(ka)&&!Ya.intersectsRay(ma,va,Ca,Oa,cb)||fb&&this._useStencilForTile(Ya)?Na.skipSubtree():wa(Ya)}})()}};Fa.prepareTechnique=function(qa){if(qa.slot===U.RenderSlot.OCCLUDED_TERRAIN){if(0===(qa.renderOccludedMask&
p.overlayRenderOccludedFlag))return null}else if(qa.slot!==(this.opaque?U.RenderSlot.OPAQUE_TERRAIN:U.RenderSlot.TRANSPARENT_TERRAIN))return null;switch(qa.pass){case W.RenderPass.MATERIAL:var sa=qa.shadowMap&&qa.shadowMap.enabled;this.shaderTechniqueConfig.receiveShadows!==sa&&(this.shaderTechniqueConfig.receiveShadows=sa);sa=this.overlayRenderer.isEmpty()?J.OverlayMode.Disabled:this.overlayRenderer.hasWater?J.OverlayMode.EnabledWithWater:J.OverlayMode.Enabled;this.shaderTechniqueConfig.overlayMode!==
sa&&(this.shaderTechniqueConfig.overlayMode=sa);return this._updateTechnique(I.ShaderOutput.Color,(qa.slot===U.RenderSlot.OCCLUDED_TERRAIN?A.OverlaySource.Occluded:A.OverlaySource.ColorAndWater)===A.OverlaySource.Occluded);case W.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL:case W.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:if(this.castShadows&&1===qa.scenelightingData.globalFactor)return this._updateTechnique(I.ShaderOutput.Shadow,!1);break;case W.RenderPass.MATERIAL_DEPTH:if(!this.isTransparent||!this.overlayRenderer.isEmpty())return this._updateTechnique(I.ShaderOutput.Depth,
!1);break;case W.RenderPass.MATERIAL_NORMAL:return this._updateTechnique(I.ShaderOutput.Normal,!1);case W.RenderPass.MATERIAL_HIGHLIGHT:if(this.needsHighlight)return this._updateTechnique(I.ShaderOutput.Highlight,!1)}return null};Fa.render=function(qa,sa){const ma=qa.pass,ra=1===qa.scenelightingData.globalFactor;this._updatePatchGroups();sa.useStencil=!1;switch(ma){case W.RenderPass.MATERIAL:this._renderMaterialPass(qa,sa,qa.slot===U.RenderSlot.OCCLUDED_TERRAIN?A.OverlaySource.Occluded:A.OverlaySource.ColorAndWater);
break;case W.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL:case W.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:this.castShadows&&ra&&this._renderAuxiliaryPass(qa,sa,A.OverlaySource.None);break;case W.RenderPass.MATERIAL_DEPTH:this.isTransparent&&this.overlayRenderer.isEmpty()||this._renderAuxiliaryPass(qa,sa,A.OverlaySource.None);break;case W.RenderPass.MATERIAL_NORMAL:this._renderAuxiliaryPass(qa,sa,A.OverlaySource.None);break;case W.RenderPass.MATERIAL_HIGHLIGHT:this.needsHighlight&&(this._renderAuxiliaryPass(qa,
sa,A.OverlaySource.Highlight),qa.rctx.clearSafe(la.ClearBufferBit.DEPTH_BUFFER_BIT))}this._scaleRangeQueries.hasPendingQueries()&&this.setNeedsRender()};Fa._renderMaterialPass=function(qa,sa,ma){const {rctx:ra,camera:va}=qa;this._ssrEnabled=qa.ssrParams.ssrEnabled;const Ia=ra.useTechnique(sa,qa.slot);this.shaderTechniqueConfig.overlayMode!==J.OverlayMode.Disabled&&ma===A.OverlaySource.ColorAndWater&&qa.ssrParams&&Q.bindSSRUniforms(Ia,qa.ssrParams);qa.shadowMap.bind(Ia);qa.ssaoHelper.bind(Ia,qa.camera);
this._bindOverlayData(Ia,ma);Ia.setUniformMatrix4fv("viewNormal",va.viewInverseTransposeMatrix);P.bindProjectionMatrix(Ia,va.projectionMatrix);qa.scenelightingData.setUniforms(Ia,!0,!1);const Ja=va.viewMatrix;z.set(Z,Ja[12],Ja[13],Ja[14]);z.normalize(Z,Z);Ia.setUniform3fv("viewDirection",Z);this.numOriginsRendered=this.numTilesCulled=this.numTilesRendered=0;this._scaleRangeQueries.prepareQueries();this.opaque?this._renderPatchGroups(qa,sa,ma):qa.offscreenRenderingHelper.renderToTargets(()=>this._renderPatchGroups(qa,
sa,ma),qa.offscreenRenderingHelper.tmpColor,qa.offscreenRenderingHelper.mainDepth,[0,0,0,0]);this._scaleRangeQueries.processQueries()};Fa._renderAuxiliaryPass=function(qa,sa,ma){const ra=qa.rctx.useTechnique(sa,qa.slot);if(qa.pass===W.RenderPass.MATERIAL_HIGHLIGHT){const va=qa.offscreenRenderingHelper;ra.bindTexture(va.depthTexture,"depthTex");ra.setUniform4f("highlightViewportPixelSz",0,0,1/va.width,1/va.height)}else ra.setUniformMatrix4fv("viewNormal",qa.camera.viewInverseTransposeMatrix),qa.pass!==
W.RenderPass.MATERIAL_DEPTH&&qa.pass!==W.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL&&qa.pass!==W.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT||ra.setUniform2fv("nearFar",qa.camera.nearFar);this._renderPatchGroupsAuxiliary(qa,sa,ma)};Fa._updateTileBackground=function(){if(this.tileRenderer){this.tileBackgroundUpdating=!0;var qa=()=>{this.tileBackgroundInitialized=!0;this.tileBackgroundUpdating=!1;this.shaderTechniqueConfig.useGrid=this.tileRenderer.backgroundIsGrid;this.shaderTechniqueConfig.hasBackgroundColor=
!this.tileRenderer.backgroundIsGrid&&!!h.isSome(this.tileRenderer.backgroundColor);this.allTiles.forAll(sa=>this.tileRenderer.updateTileTexture(sa,E.TextureUpdate.FADING));this.setNeedsRender()};if("string"===typeof this.tileBackground){const sa=this.tileBackground;x.requestImage(sa).then(ma=>{sa===this.tileBackground&&this.tileRenderer&&(this.tileRenderer.setBackground(ma,this.tileBackground===G.DEFAULT_TILE_BACKGROUND),qa())})}else{const sa=this.tileBackground?c.toUnitRGBA(this.tileBackground):
[0,0,0,0];this.tileRenderer.setBackground(sa,!1);qa()}}};Fa._updatePatchGroups=function(){if(this.patchGroupsDirty){this.highestVisibleLODTile=null;this._rebuildPatchGroups();if(this.renderOrder!==C.RenderOrder.NONE){const qa=Array.from(this._patchGroups.values());qa.forEach(sa=>M.sortTiles(this.renderOrder,sa));qa.sort((sa,ma)=>M.compareTiles(sa[0],ma[0],this.renderOrder));this._patchGroups=new Map(qa.map(sa=>[sa[0].renderData.localOrigin,sa]))}this.patchGroupsDirty=!1}};Fa._rebuildPatchGroups=function(){const qa=
this._rootTiles;if(!h.isNone(qa)){this._patchGroups.clear();for(const sa of qa)this._rebuildPatchGroupsForRootTile(sa)}};Fa._rebuildPatchGroupsForRootTile=function(qa){const sa=this.tileIterator;for(sa.resetOne(qa);!sa.done;){qa=sa.next();const ma=qa.renderData;if(ma&&!qa.visible)this.numTilesCulled++,sa.skipSubtree();else if(!qa.rendered)this.numTilesCulled++;else if(ma){const ra=this._patchGroups.get(ma.localOrigin)||[];this._patchGroups.set(ma.localOrigin,ra);ra.push(qa);if(!this.highestVisibleLODTile||
qa.vlevel>this.highestVisibleLODTile.vlevel)this.highestVisibleLODTile=qa;sa.skipSubtree()}}};Fa._useStencilForTile=function(qa){for(const sa of this.stencilEnabledLayerExtents)if(qa.intersectsExtent(sa))return!0;return!1};Fa._renderPatchGroupsAuxiliary=function(qa,sa,ma){sa.program.setUniformMatrix4fv("proj",qa.camera.projectionMatrix);sa.program.setUniform1f("skirtScale",this._skirtScale);ma!==A.OverlaySource.None&&this._bindOverlayData(sa.program,ma);const ra=0<this.stencilEnabledLayerExtents.length;
this._patchGroups.forEach(va=>{this._bindPatchGroupData(sa.program,va[0].renderData.localOrigin,qa.camera.eye,qa.camera.viewMatrix);for(let Ia=0;Ia<va.length;Ia++)this._renderPatch(qa,sa,va[Ia],la.PrimitiveType.TRIANGLES,ra,ma)});qa.rctx.bindVAO(null)};Fa._renderPatchGroups=function(qa,sa,ma){const ra=qa.rctx,va=qa.camera,Ia=va.viewMatrix,Ja=sa.program;if(this.shaderTechniqueConfig.screenSizePerspective&&this.pointsOfInterest){var Ha=aa.getSettings(this.stage.viewingMode,this.ellipsoidRadius);Ha.update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,
fovY:va.fovY});ea.bindScreenSizePerspective(Ha,Ja,"screenSizePerspective")}const Ta=0<this.stencilEnabledLayerExtents.length,db=ma===A.OverlaySource.Occluded;db&&(Ja.bindTexture(this.emptyTex,"tex"),Ja.setUniform1f("blend",1),Ja.setUniform4fv("texOffsetAndScale",q.ZEROS));Ha=h.isSome(this.tileRenderer.backgroundColor)?this.tileRenderer.backgroundColor:v.ZEROS;this.shaderTechniqueConfig.hasBackgroundColor&&Ja.setUniform3fv("backgroundColor",Ha);Ja.setUniform1f("skirtScale",db?0:this._skirtScale);const fb=
this.wireframe?la.PrimitiveType.LINES:la.PrimitiveType.TRIANGLES;this.shaderTechniqueConfig.textureFadingEnabled&&Ja.bindTexture(this.emptyTex,"texNext");this._patchGroups.forEach(ka=>{var cb=ka[0].renderData.localOrigin;this._bindPatchGroupData(Ja,cb,va.eye,Ia);O.bindSliceUniforms(Ja,sa.configuration,qa.sliceHelper&&qa.sliceHelper.plane,{origin:cb});qa.shadowMap&&qa.shadowMap.bindView(Ja,cb);this.numOriginsRendered++;for(cb=0;cb<ka.length;cb++){const Ca=ka[cb],Ka=Ca.renderData.textureReference;if(!h.isNone(Ka)){if(!db){this._scaleRangeQueries.scaleQueriesForTile(Ca);
ia(Ca.renderData.geometryInfo.uvOffsetAndScale,Ka.offsetAndScale,fa);Ja.setUniform4fv("texOffsetAndScale",fa);Ja.bindTexture(Ka.texture.texture,"tex");const Oa=Ca.renderData.textureFadeFactor,wa=1>Oa?Ca.renderData.nextTextureReference:null;this.shaderTechniqueConfig.textureFadingEnabled&&h.isSome(wa)&&1>Oa?(ia(Ca.renderData.geometryInfo.uvOffsetAndScale,wa.offsetAndScale,fa),Ja.setUniform1f("fadeFactor",Oa),Ja.setUniform4fv("nextTexOffsetAndScale",fa),Ja.setUniform3fv("nextTexOpacities",wa.opacities),
Ja.bindTexture(wa.texture.texture,"texNext")):Ja.setUniform1f("fadeFactor",1);Ca.renderData.textureIsFading&&this.setNeedsRender();Ja.setUniform3fv("textureOpacities",Ka.opacities)}this._renderPatch(qa,sa,Ca,fb,Ta,ma);Ca.renderOrder=this.numTilesRendered;this.numTilesRendered++}}});ra.bindVAO(null)};Fa._renderPatch=function(qa,sa,ma,ra,va,Ia){if(!h.isNone(ma.renderData.vao.indexBuffer)){var Ja=sa.program;Ia!==A.OverlaySource.None&&this._bindOverlayPatchData(Ja,ma.renderData.overlay);va&&(sa.useStencil=
this._useStencilForTile(ma),sa.bindPipelineState(qa.rctx,qa.slot));sa=0===this._skirtScale?ma.renderData.geometryInfo.numWithoutSkirtIndices:ma.renderData.vao.indexBuffer.size;qa.rctx.bindVAO(ma.renderData.vao);Ja.assertCompatibleVertexAttributeLocations(ma.renderData.vao);qa.rctx.drawElements(ra,sa,ma.renderData.vao.indexBuffer.indexType,0)}};Fa._bindPatchGroupData=function(qa,sa,ma,ra){qa.setUniform3fv("origin",sa);d.translate(ba,ra,sa);qa.setUniformMatrix4fv("view",ba);qa.setUniform3f("cameraPosition",
ma[0]-sa[0],ma[1]-sa[1],ma[2]-sa[2])};Fa._bindOverlayData=function(qa,sa){if(this.shaderTechniqueConfig.overlayMode!==J.OverlayMode.Disabled){qa.setUniform1f("overlayOpacity",this.overlayOpacity);var ma=this.overlayRenderer.overlays;if(ma.length>E.OverlayIndex.INNER){ma=ma[E.OverlayIndex.INNER];const ra=ma.getColorTexture(sa);qa.bindTexture(h.isSome(ra)?ra:this.emptyTex,"ovColorTex");this.shaderTechniqueConfig.overlayMode===J.OverlayMode.EnabledWithWater&&(sa=ma.getNormalTexture(sa),qa.bindTexture(h.isSome(sa)?
sa:this.emptyTex,"ovWaterTex"))}}};Fa._bindOverlayPatchData=function(qa,sa){qa.setUniform4fv("overlayTexOffset",sa.offsets);qa.setUniform4fv("overlayTexScale",sa.scales)};Fa._updateTechnique=function(qa,sa){this.shaderTechniqueConfig.output=qa;qa===I.ShaderOutput.Color&&(this.shaderTechniqueConfig.atmosphere=this.isGlobal&&this._velvetOverground,this.shaderTechniqueConfig.ssrEnabled=this._ssrEnabled);this.shaderTechniqueConfig.renderOccluded=sa;this.shaderTechniqueConfig.stencilEnabled=!1;return this._shaderTechnique=
this.shaderTechniques.releaseAndAcquire(ja.TerrainTechnique,this.shaderTechniqueConfig,this._shaderTechnique)};a._createClass(ua,[{key:"isGlobal",get:function(){return this.stage.viewingMode===u.ViewingMode.Global}},{key:"updating",get:function(){return!this.tileBackgroundInitialized||this.tileBackgroundUpdating}},{key:"canRender",get:function(){return this.visible&&!!this._rootTiles&&this.tileBackgroundInitialized&&!this.renderingDisabled}},{key:"renderingDisabled",set:function(qa){this._set("renderingDisabled",
!!qa);this.setNeedsRender()}},{key:"opaque",get:function(){return this._opaque&&!this.shaderTechniqueConfig.slicePlaneEnabled},set:function(qa){this._opaque!==qa&&(this._opaque=qa,this.setNeedsRender())}},{key:"needsLinearDepth",get:function(){return this.overlayRenderer.hasWater}},{key:"isTransparent",get:function(){return this._isTransparent},set:function(qa){this._isTransparent!==qa&&(this._isTransparent=qa,this.setNeedsRender())}},{key:"skirtScale",get:function(){return this._skirtScale},set:function(qa){qa!==
this._skirtScale&&(this._skirtScale=qa,this.setNeedsRender())}},{key:"renderPatchBorders",get:function(){return!!this.shaderTechniqueConfig.tileBorders},set:function(qa){this.shaderTechniqueConfig.tileBorders!==qa&&(this.shaderTechniqueConfig.tileBorders=qa,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}},{key:"cullBackFaces",get:function(){return this.shaderTechniqueConfig.backfaceCullingEnabled},set:function(qa){this.shaderTechniqueConfig.backfaceCullingEnabled!==qa&&(this.shaderTechniqueConfig.backfaceCullingEnabled=
qa,this.notifyChange("cullBackFaces"),this.setNeedsRender())}},{key:"renderOrder",set:function(qa){this._set("renderOrder",qa);this.setNeedsRender()}},{key:"velvetOverground",set:function(qa){this._velvetOverground!==qa&&(this._velvetOverground=qa,this.setNeedsRender())}},{key:"layerUid",get:function(){return Y.TERRAIN_ID}},{key:"slicePlaneEnabled",get:function(){return this.shaderTechniqueConfig.slicePlaneEnabled},set:function(qa){this.shaderTechniqueConfig.slicePlaneEnabled!==qa&&(this.shaderTechniqueConfig.slicePlaneEnabled=
qa,this.setNeedsRender())}},{key:"textureFadingEnabled",set:function(qa){this.shaderTechniqueConfig.textureFadingEnabled!==qa&&(this.shaderTechniqueConfig.textureFadingEnabled=qa,this.setNeedsRender())}},{key:"wireframe",set:function(qa){this._get("wireframe")!==qa&&(this._set("wireframe",qa),this.allTiles.forAll(sa=>{var ma;return null==(ma=sa.renderData)?void 0:ma.updateGeometry(this.rctx,qa)}),this.setNeedsRender())}},{key:"test",get:function(){return{tileRenderer:this.tileRenderer}}}]);return ua}(g);
b.__decorate([n.property()],g.prototype,"tileBackgroundInitialized",void 0);b.__decorate([n.property()],g.prototype,"tileBackgroundUpdating",void 0);b.__decorate([n.property({constructOnly:!0})],g.prototype,"overlayRenderer",void 0);b.__decorate([n.property({constructOnly:!0})],g.prototype,"stage",void 0);b.__decorate([n.property({readOnly:!0})],g.prototype,"isGlobal",null);b.__decorate([n.property({constructOnly:!0})],g.prototype,"allTiles",void 0);b.__decorate([n.property({constructOnly:!0})],g.prototype,
"ellipsoidRadius",void 0);b.__decorate([n.property({readOnly:!0})],g.prototype,"updating",null);b.__decorate([n.property({value:!1})],g.prototype,"renderingDisabled",null);b.__decorate([n.property()],g.prototype,"renderPatchBorders",null);b.__decorate([n.property()],g.prototype,"cullBackFaces",null);b.__decorate([n.property({value:C.RenderOrder.FRONT_TO_BACK})],g.prototype,"renderOrder",null);b.__decorate([n.property()],g.prototype,"wireframe",null);b=g=b.__decorate([e.subclass("esri.views.3d.terrain.TerrainRenderer")],
g);const ba=m.create(),Z=v.create(),ha=v.create(),na=v.create(),pa=v.create(),xa=v.create();return b})},"esri/views/3d/terrain/PatchRenderData":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/arrayUtils ../../../core/maybe ../../../geometry/support/aaBoundingBox ../support/buffer/glUtil ./GeometryState ./LayerClass ./PatchGeometryFactory ./TextureFader ./TileOverlayData ./tileUtils ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/BufferObject ../../webgl/VertexArrayObject".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v){let q=function(){function t(){this.geometryInfo=new l.PatchGeometry;this.skirtIntersectionData=this.intersectionData=null;this.geometryState=new n.GeometryState;this._textureRef=new k.default(()=>this.tile.surface.textureFadeDuration);this.overlay=new e}var r=t.prototype;r.init=function(x){this.tile=x;this.clear();x=this.geometryInfo;x.indices=null;x.vertexAttributes=null;h.empty(x.boundingBox);x.numSurfaceIndices=0;x.numSkirtIndices=0;x.numWithoutSkirtIndices=
0;x.numVertsPerRow=0;this.skirtIntersectionData=this.intersectionData=null;this.geometryState=new n.GeometryState;this.localOrigin=null;this.overlay.clear()};r.clear=function(){this.releaseGeometry();this.releaseTexture();this._textureRef.clear()};r.updateGeometry=function(x,u){if(!this._updateGeometryState(u))return!1;this._releaseGeometry();this._createGeometry(x);return!0};r.releaseGeometry=function(){return this._releaseGeometry()?(this.geometryState=new n.GeometryState,!0):!1};r.ensureTexture=
function(x,u){g.isSome(this._texture)&&this._texture.descriptor.width!==x&&this.releaseTexture();g.isNone(this._texture)&&(this._texture=u(),this.tile.setMemoryDirty());return this._texture};r.releaseTexture=function(){g.isSome(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())};r._updateGeometryState=function(x){const u=this._getElevationInfo(),E=u.samplerData?this.tile.getElevationBasedVerticesPerRow(u.maxTileLevel):this.tile.getDefaultVerticesPerRowOnLevel();
let y=this.tile.clippingArea;if(!this.tile.intersectsClippingArea||this.tile.isWithinClippingArea)y=null;const A=this.geometryState;let p=!1;A.numVertsPerSide!==E&&(A.numVertsPerSide=E,p=!0);u.changed&&(A.samplerData=u.samplerData,p=!0);c.equals(A.clippingArea,y)||(A.clippingArea=y,p=!0);A.wireframe!==x&&(A.wireframe=x,p=!0);return p};r._createGeometry=function(x){this.tile.createGeometry(this.geometryState,this.localOrigin);const u=this.geometryInfo.vertexAttributes,E=this.geometryInfo.indices,y=
x.gl;this._vao=new v.VertexArrayObject(x,m.Default3D,{geometry:w.glLayout(u.layout)},{geometry:z.BufferObject.createVertex(x,y.STATIC_DRAW,u.buffer)},z.BufferObject.createIndex(x,y.STATIC_DRAW,E))};r._releaseGeometry=function(){if(!this._vao)return!1;this._vao.dispose();this._vao=null;l.releaseGeometry(this.geometryInfo);return!0};r.setTextureReference=function(x,u=k.ActivationTime.Immediate){g.isSome(x)&&x.texture!==this._texture&&this.releaseTexture();this._textureRef.push(x,u)};r._getElevationInfo=
function(){const x=this.geometryState.samplerData,u=this.tile.layerInfo[f.LayerClass.ELEVATION],E=u.length;let y=Array(E),A=0;var p=0;let B=!1;for(let F=0;F<E;F++){var D=u[F];if(D.upsampleInfo){D=D.upsampleInfo.tile;var C=D.layerInfo[f.LayerClass.ELEVATION][F].data;C=C&&C.samplerData;x&&x[A]===C||(B=!0);y[A++]=C;p=Math.max(p,D.lij[0])}else D.data&&(C=this.tile.surface.layerViewByIndex(F,f.LayerClass.ELEVATION),d.fallsWithinLayer(this.tile,C.layer,!1)&&(p=D.data,x&&x[A]===p.samplerData||(B=!0),y[A++]=
p.samplerData,p=this.tile.level))}g.isSome(x)&&x.length!==A&&(B=!0);0<A?y.length=A:y=null;return{changed:B,samplerData:y,maxTileLevel:p}};b._createClass(t,[{key:"vao",get:function(){return this._vao}},{key:"textureReference",get:function(){return this._textureRef.current}},{key:"nextTextureReference",get:function(){return this._textureRef.next}},{key:"textureFadeFactor",get:function(){return this._textureRef.fadeFactor}},{key:"textureIsFading",get:function(){return this._textureRef.isFading}},{key:"estimatedGeometryMemoryUsage",
get:function(){const x=g.mapOr(this.intersectionData,0,u=>u.estimatedMemoryUsage)+g.mapOr(this.skirtIntersectionData,0,u=>u.estimatedMemoryUsage+u.vertexPositionBuffer.byteLength);return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength+x}},{key:"textureDescriptor",get:function(){return g.isSome(this._texture)?this._texture.descriptor:null}},{key:"test",get:function(){return{hasTexture:null!=this._texture}}}]);return t}();Object.defineProperty(a,"ActivationTime",{enumerable:!0,
get:()=>k.ActivationTime});a.PatchRenderData=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/GeometryState":function(){define(["exports"],function(a){a.GeometryState=function(){this.numVertsPerSide=0;this.wireframe=!1};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TextureFader":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","./interfaces"],function(a,b,c,g){let h=function(){function w(f){this._getFadeDuration=
f;this._delayedTime=this._fadeStart=0}var n=w.prototype;n.clear=function(){this._current=c.destroyMaybe(this._current);this._next=c.destroyMaybe(this._next);this._waiting=c.destroyMaybe(this._waiting);this._delayed=c.destroyMaybe(this._delayed)};n.push=function(f,l=a.ActivationTime.Immediate){this._delayed=c.destroyMaybe(this._delayed);this._push(f,l)};n._push=function(f,l){this._isFadingEnabled||this.clear();if(c.isNone(this._current))this._current=f;else{var k=w.test.fadeMoment||performance.now();
l!==a.ActivationTime.Immediate?(this._delayed=f,this._delayedTime=k+l):c.isNone(this._next)?(this._next=f,this._fadeStart=this._alignFadeStart(k)):c.isNone(f)||(c.destroyMaybe(this._waiting),this._waiting=f)}};n._alignFadeStart=function(f){const l=this._getFadeDuration();return f+l-f%l};b._createClass(w,[{key:"current",get:function(){if(c.isNone(this._current))return null;if(!this._isFadingEnabled){var f=this._delayed||this._waiting||this._next||this._current;f!==this._current&&(this._current=null,
this.clear(),this._current=f)}f=w.test.fadeMoment;c.isSome(this._delayed)&&(f=f||performance.now(),f>=this._delayedTime&&(this._push(this._delayed,a.ActivationTime.Immediate),this._delayed=null));if(c.isSome(this._next)){f=f||performance.now();var l=this._fadeDuration;const k=c.isSome(this._current)&&this._next.texture===this._current.texture,e=this._next.type!==g.TextureUpdate.FADING;l=f-this._fadeStart>=l;if(k||e||l)c.destroyMaybe(this._current),this._current=this._next,this._next=this._waiting,
this._waiting=null,this._fadeStart=this._alignFadeStart(f)}return this._current}},{key:"next",get:function(){return this._next}},{key:"fadeFactor",get:function(){if(c.isNone(this._next))return 1;var f=w.test.fadeMoment||performance.now();f=Math.max(0,f-this._fadeStart);const l=this._fadeDuration;return f>l?0:1-f/l}},{key:"isFading",get:function(){return c.isSome(this._next)||c.isSome(this._delayed)}},{key:"_fadeDuration",get:function(){return c.isNone(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}},
{key:"_isFadingEnabled",get:function(){return 0<this._getFadeDuration()}}]);return w}();h.test={fadeMoment:0};a.ActivationTime=void 0;(function(w){w[w.Immediate=0]="Immediate";w[w.Delayed=5E3]="Delayed"})(a.ActivationTime||(a.ActivationTime={}));a.default=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TileOverlayData":function(){define(["../../../chunks/_rollupPluginBabelHelpers"],function(a){return function(){function b(){this._scales=[-1,-1,-1,-1];this._offsets=[-1,
-1,-1,-1]}var c=b.prototype;c.clear=function(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1;this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1};c.setScale=function(g,h,w){this._scales[2*g]=h;this._scales[2*g+1]=w};c.setOffset=function(g,h,w){this._offsets[2*g]=h;this._offsets[2*g+1]=w};a._createClass(b,[{key:"scales",get:function(){return this._scales}},{key:"offsets",get:function(){return this._offsets}}]);return b}()})},"esri/views/3d/terrain/ScaleRangeQueries":function(){define(["exports",
"../../../core/ObjectPool","../../../core/PooledArray","../../../chunks/vec4","../../../chunks/vec4f64"],function(a,b,c,g,h){let w=function(){this.extent=h.create();this.maxLevel=this.minLevel=0;this.callback=null},n=function(){function f(){this._queries=new c({initialSize:10});this._queriesInvPtr=0;this._queryQueue=new c({initialSize:30});this._queryPool=new b(w)}var l=f.prototype;l.queryVisibleLevelRange=function(k,e,d,m){const z=this._queryPool.acquire();g.copy(z.extent,k);z.minLevel=e?e:-Number.MAX_VALUE;
z.maxLevel=null!=d?d:Number.MAX_VALUE;z.callback=m;this._queryQueue.push(z)};l.hasPendingQueries=function(){return 0!==this._queryQueue.length};l.prepareQueries=function(){for(;this._queries.length<this._queries.data.length&&0<this._queryQueue.length;){const k=this._queryQueue.pop();this._queries.push(k)}this._queriesInvPtr=this._queries.length};l.processQueries=function(){for(let k=0;k<this._queries.length;k++){const e=this._queries.data[k];this._queryPool.release(e);e.callback(k>=this._queriesInvPtr);
e.callback=null}this._queries.clear()};l.scaleQueriesForTile=function(k){const e=k.level;let d=0;for(;d<this._queriesInvPtr;){const m=this._queries.data[d],z=m.extent;e>=m.minLevel&&e<=m.maxLevel&&z[0]<=k.extent[2]&&z[2]>=k.extent[0]&&z[1]<=k.extent[3]&&z[3]>=k.extent[1]?(this._queries.swapElements(d,this._queriesInvPtr-1),this._queriesInvPtr--):d++}};return f}();a.ScaleRangeQueries=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TileRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../layers/support/layerUtils ../../2d/engine/imagery/enums ../../2d/engine/vectorTiles/VectorTileRendererHelper3D ../support/StreamDataLoader ./BlendLayersTechnique ./interfaces ./LayerClass ../../../core/arrayUtils ../../../geometry/support/aaBoundingBox ../support/buffer/glUtil ./PatchGeometryFactory ./TextureFader ../../../core/HeapSort ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/BufferObject ../../webgl/VertexArrayObject ./RasterColorizerTechnique ./terrainUtils ./TextureReference ./TileTexture ./TileUpdate ./support/FBOPool ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/Texture ../../webgl/Util".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H,M,K,I,O,Q){function J(S,T,V){V.layerIndex=T;const W=S.layerInfo[v.LayerClass.MAP][T];return W.data?(h.set(V.offset,0,0),V.tile=S,V.scale=1,V.sourceLod=S.lij,V.sourceLayerInfo=W,V):(S=W.upsampleInfo)?(T=S.tile.layerInfo[v.LayerClass.MAP][T],V.tile=S.tile,h.copy(V.offset,S.offset),V.scale=S.scale,V.sourceLod=S.tile.lij,V.sourceLayerInfo=T,V):null}q=function(){function S(V,W,U){this._rctx=V;this.tileSize=W;this._techniqueRepository=
U;this._backgroundIsGrid=!1;this._blackTex=this._backgroundColor=this._backgroundTexture=null;this._vectorTileHelper=new e.VectorTileRendererHelper3D;this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy;this._vaoQuad=K.createQuadVAO(this._rctx,M.Pos2Tex);this._blackTex=new F(K.createColorTexture(this._rctx,[0,0,0,1]));this._fboPool=new L.FBOPool(this._rctx)}var T=S.prototype;T.dispose=function(){this._fboPool&&(this._fboPool.clear(),this._fboPool=null);this._vaoQuad=g.disposeMaybe(this._vaoQuad);
this._backgroundTexture=g.releaseMaybe(this._backgroundTexture);this._blackTex=g.releaseMaybe(this._blackTex);this._blendLayersTechnique=g.releaseMaybe(this._blendLayersTechnique);this._applyOpacityTechnique=g.releaseMaybe(this._applyOpacityTechnique);this._vectorTileHelper=g.disposeMaybe(this._vectorTileHelper)};T.updateTileTexture=function(V,W){var U=V.layerInfo[v.LayerClass.MAP];for(var aa of U)aa.pendingUpdates&=~(G.TileUpdate.TEXTURE_NOFADING&G.TileUpdate.TEXTURE_FADING);if(V.renderData){for(var da=
V.surface,Y=da.baseOpacity,ea=aa=0,ja=this.tileSize,la=!1,ia=da.view.pixelRatio,ca=U.length,fa=0;fa<U.length&&!la;fa++){const ba=da.layerViewByIndex(fa,v.LayerClass.MAP),Z=ba.fullOpacity;P[fa]=Z;l.isBaseLayer(ba.layer)&&ca>=U.length&&(ca=fa);if(0===Z)continue;++ea;const ha=J(V,fa,N);ha&&(D.isVectorTileLayerView(ba)?ja=Math.max(ja,this.tileSize*ia):1===Y&&1===Z&&(ba.isOpaque||this._dataToTexture(ha)&&ha.sourceLayerInfo.data.descriptor.isOpaque)&&(la=!0),++aa)}this._cleanupFBOPool(ia,U.length);Y=ja;
ja=c.nextHighestPowerOfTwo(Y);U=ja*ja;da=Y*Y;U===da?ja=Y:(Y=ja/2,ja=U-da<da-Y*Y?ja:Y);U=ja/this.tileSize;--fa;0===aa?this._useBackgroundTexture(V,ea):1===aa&&(la||this._backgroundIsGrid||g.isSome(this._backgroundColor))&&this._useLayerTexture(V,fa,ca,P[fa])||this._composeMapLayers(V,W,fa,ca,la,P,ja,U)}};T._useBackgroundTexture=function(V,W){let U=u.ActivationTime.Immediate;if(V.surface.view.layerViewManager.updating||0<W)U=u.ActivationTime.Delayed;this._backgroundTexture&&g.isNone(V.renderData.textureReference)&&
(U=u.ActivationTime.Immediate);V.renderData.setTextureReference(g.isSome(this._backgroundTexture)?new C.TextureReference(this._backgroundTexture,z.TextureUpdate.FADING,R,V.surface.baseOpacity,1,1,!1):null,U)};T._useLayerTexture=function(V,W,U,aa){var da=W<U;U=da?1:V.surface.baseOpacity;da=da?V.surface.baseOpacity:1;W=J(V,W,N);return this._dataToTexture(W)?(V.renderData.setTextureReference(new C.TextureReference(W.sourceLayerInfo.data,z.TextureUpdate.FADING,W,U,aa,da,!0)),!0):!1};T._composeMapLayers=
function(V,W,U,aa,da,Y,ea,ja){const la=this._rctx,ia=this._fboPool.acquire(ea);la.bindFramebuffer(ia);la.setViewport(0,0,ea,ea);la.setClearColor(0,0,0,0);la.setClearDepth(1);la.clearSafe(I.ClearBufferBit.COLOR_BUFFER_BIT|I.ClearBufferBit.DEPTH_BUFFER_BIT);let ca=!1;!da&&g.isSome(this._backgroundTexture)&&this._drawRasterData(this.blendLayersTechnique,this._backgroundTexture.texture,1,w.ZEROS);da=V.surface.baseOpacity;let fa=!1,ba=I.TextureSamplingMode.LINEAR_MIPMAP_LINEAR;for(;0<=U;U--){const Z=J(V,
U,N);Z&&(U<aa&&1>da&&!fa&&(this._drawRasterData(this.applyOpacityTechnique,this._blackTex.texture,1,w.ZEROS,da),fa=!0),0!==Y[U]&&(D.isVectorTileRenderInfo(Z)?ca=this._drawVectorData(this.blendLayersTechnique,Z,ja,Y[U],ea,ia,ca):D.isImageryTileRenderInfo(Z)?(this._drawImageryTileData(Z,Y[U]),this._hasNearestInterpolation(Z)&&(ba=I.TextureSamplingMode.NEAREST)):this._dataToTexture(Z)&&this._drawRasterData(this.blendLayersTechnique,Z.sourceLayerInfo.data.texture,Z.scale,Z.offset,Y[U])))}aa=V.renderData.ensureTexture(ea,
()=>this._buildTexture(ea,ba));Y=la.bindTexture(aa.texture,O.Texture.TEXTURE_UNIT_FOR_UPDATES);ja=aa.descriptor;la.gl.copyTexImage2D(la.gl.TEXTURE_2D,0,ja.pixelFormat,0,0,ja.width,ja.height,0);aa.generateMipmap();la.bindTexture(Y,O.Texture.TEXTURE_UNIT_FOR_UPDATES);la.bindFramebuffer(null);this._fboPool.release(ia);V.renderData.setTextureReference(new C.TextureReference(aa,W,R,fa?1:da,1,1,!1))};T._drawQuad=function(V){this._rctx.bindVAO(this._vaoQuad);V.assertCompatibleVertexAttributeLocations(this._vaoQuad);
this._rctx.drawArrays(I.PrimitiveType.TRIANGLE_STRIP,0,Q.vertexCount(this._vaoQuad,"geometry"))};T._drawRasterData=function(V,W,U,aa,da=1){g.isNone(W)||(V=this._rctx.useTechnique(V),V.bindTexture(W,"tex"),V.setUniform1f("scale",U),V.setUniform2f("offset",aa[0],aa[1]),V.setUniform1f("opacity",da),this._drawQuad(V))};T._hasNearestInterpolation=function(V){V=V.sourceLayerInfo.data;return V.source?"nearest"===V.interpolation:!1};T._drawImageryTileData=function(V,W=1){const U=V.sourceLayerInfo.data;if(U.source){V.tile.surface.layerViewByIndex(V.layerIndex,
v.LayerClass.MAP).ensureSymbolizerParameters(U);var aa=this._getRasterColorizerTechnique(U),da=this._rctx,Y=da.useTechnique(aa);if(U.bind(da)){U.opacity=W;U.scale=V.scale;U.offset=V.offset;var {names:ea,textures:ja}=U.getTextures();ea.forEach((la,ia)=>Y.bindTexture(ja[ia],la));aa.bindPass(U.getUniforms());this._drawQuad(Y);da.bindVAO()}}};T._getRasterColorizerTechnique=function(V){const W=V.symbolizerParameters,U=["stretch","lut","hillshade"].indexOf(W.type);g.isNone(this._rasterColorizerConfig)&&
(this._rasterColorizerConfig=new B.RasterColorizerTechniqueConfiguration,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float"));this._rasterColorizerConfig.colorizerType=U;this._rasterColorizerConfig.applyColormap=!!W.colormap;this._rasterColorizerConfig.stretchType=V.hasStretchTypeNone()?k.RasterColorizerStretchType.Noop:k.RasterColorizerStretchType.PerBand;return this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(B.RasterColorizerTechnique,
this._rasterColorizerConfig,this._rasterColorizerTechnique)};T._drawVectorData=function(V,W,U,aa,da,Y,ea){const ja=this._rctx,la=W.sourceLayerInfo.data,ia=W.tile.surface.layerViewByIndex(W.layerIndex,v.LayerClass.MAP);let ca;V.bindPipelineState(ja);1>aa?(ca=this._fboPool.acquire(da),ja.bindFramebuffer(ca),ja.setClearColor(1,1,1,0),ja.clearSafe(I.ClearBufferBit.COLOR_BUFFER_BIT|I.ClearBufferBit.DEPTH_BUFFER_BIT)):ea&&ja.clearSafe(I.ClearBufferBit.DEPTH_BUFFER_BIT);this._vectorTileHelper.render(ja,
W.sourceLod,la,ia.painter,ia.layer.styleRepository,ia.schemaHelper,Math.round(1/W.scale),W.offset,this.tileSize,U);return g.isSome(ca)?(ja.bindFramebuffer(Y),this._drawRasterData(V,ca.colorTexture,1,[0,0],aa),this._fboPool.release(ca),ea):!0};T._dataToTexture=function(V){D.isRasterTileRenderInfo(V)&&this._rasterDataToTexture(V);return D.isTextureTileRenderInfo(V)};T._rasterDataToTexture=function(V){const W=V.sourceLayerInfo;W.data=this._buildTexture(W.data);V.tile.setMemoryDirty()};T.setBackground=
function(V,W){g.releaseMaybe(this._backgroundTexture);this._backgroundIsGrid=W;V instanceof HTMLImageElement?(this._backgroundTexture=this._buildTexture(V),this._backgroundColor=null):(this._backgroundTexture=new F(K.createColorTexture(this._rctx,f.fromValues(V[0]||0,V[1]||0,V[2]||0,1))),this._backgroundColor=n.fromValues(V[0]||0,V[1]||0,V[2]||0))};T._buildTexture=function(V,W=I.TextureSamplingMode.LINEAR_MIPMAP_LINEAR){if(g.isNone(V))return null;const U={target:I.TextureType.TEXTURE_2D,pixelFormat:I.PixelFormat.RGBA,
dataType:I.PixelType.UNSIGNED_BYTE,wrapMode:I.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:W,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0};W=this._rctx;let aa;if("number"===typeof V)U.width=U.height=V,aa=new F(new O.Texture(W,U));else if(V instanceof d.ImageWithType)U.isOpaque=V.isOpaque,aa=new F(new O.Texture(W,U,V.image)),V.release();else try{aa=new F(new O.Texture(W,U,V))}catch(da){aa=new F(K.createEmptyTexture(W)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}V=
W.bindTexture(aa.texture,O.Texture.TEXTURE_UNIT_FOR_UPDATES);aa.generateMipmap();W.bindTexture(V,O.Texture.TEXTURE_UNIT_FOR_UPDATES);return aa};T._cleanupFBOPool=function(V,W){if(V!==this._lastPixelRatio||W!==this._lastNumLayers)this._fboPool.clear(),this._lastPixelRatio=V,this._lastNumLayers=W};b._createClass(S,[{key:"blendLayersTechnique",get:function(){if(g.isNone(this._blendLayersTechnique)){const V=new m.BlendLayersTechniqueConfiguration;V.mode=H.BlendMode.OneMinusSourceAlpha;this._blendLayersTechnique=
this._techniqueRepository.acquire(m.BlendLayersTechnique,V)}return this._blendLayersTechnique}},{key:"applyOpacityTechnique",get:function(){if(g.isNone(this._applyOpacityTechnique)){const V=new m.BlendLayersTechniqueConfiguration;V.mode=H.BlendMode.SourceAlpha;this._applyOpacityTechnique=this._techniqueRepository.acquire(m.BlendLayersTechnique,V)}return this._applyOpacityTechnique}},{key:"backgroundIsGrid",get:function(){return this._backgroundIsGrid}},{key:"backgroundColor",get:function(){return this._backgroundColor}},
{key:"test",get:function(){return{backgroundTexture:this._backgroundTexture}}}]);return S}();const P=[],N={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},R={offset:[0,0],scale:1};a.TileRenderer=q;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/imagery/enums":function(){define(["exports"],function(a){a.RasterColorizerType=void 0;(function(b){b[b.Stretch=0]="Stretch";b[b.Lut=1]="Lut";b[b.Hillshade=2]="Hillshade";b[b.COUNT=3]="COUNT"})(a.RasterColorizerType||
(a.RasterColorizerType={}));a.RasterColorizerStretchType=void 0;(function(b){b[b.Noop=0]="Noop";b[b.PerBand=1]="PerBand";b[b.COUNT=2]="COUNT"})(a.RasterColorizerStretchType||(a.RasterColorizerStretchType={}));Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/VectorTileRendererHelper3D":function(){define(["exports","../../../../geometry","../../../../Viewpoint","../../ViewState","../../../../geometry/Point"],function(a,b,c,g,h){b=function(){function w(){this._renderParams=
{context:null,drawPhase:1,state:new g({viewpoint:new c({targetGeometry:new h(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1}}var n=w.prototype;n.dispose=function(){this._renderParams=
null};n.render=function(f,l,k,e,d,m,z,v,q,t){const r=m.adjustLevel(l[0]),x=this._renderParams;x.context=f;x.painter=e;x.glyphMosaic=e.glyphMosaic;x.spriteMosaic=e.spriteMosaic;x.pixelRatio=t;x.displayLevel=r;x.requiredLevel=r;t=m.getScale(l[0]);const [u,E]=m.getShift(l,z*t);l=.125*z*t/q;m=k.transforms.dvs;m[0]=l;m[4]=-l;m[6]=-1-u-v[0]*z*2;m[7]=1+E+(1-v[1])*z*2-2;x.state.size[0]=q;x.state.size[1]=q;k.stage||k.attachWithContext(f);k.triangleCount=0;e.drawTile(x,k,d)};return w}();a.VectorTileRendererHelper3D=
b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/ViewState":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../Viewpoint ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../chunks/common ../../chunks/mat2d ../../chunks/mat2df32 ../../chunks/mat2df64 ../../chunks/mat3 ../../chunks/mat3f32 ../../chunks/vec2 ../../chunks/vec2f32 ../../chunks/vec2f64 ../../core/libs/gl-matrix-2/types/vec2 ./viewpointUtils ../../geometry/Extent ../../geometry/Point".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A){var p;const B=[0,0];c=p=function(D){function C(G){G=D.call(this,G)||this;G._viewpoint2D={center:x.create(),rotation:0,scale:0,spatialReference:null};G.center=[0,0];G.extent=new y;G.id=0;G.inverseTransform=z.create();G.resolution=0;G.rotation=0;G.scale=0;G.transform=z.create();G.transformNoRotation=z.create();G.displayMat3=q.create();G.displayViewMat3=q.create();G.viewMat3=q.create();G.viewMat2d=m.create();G.worldScreenWidth=0;G.size=[0,0];return G}
a._inheritsLoose(C,D);var F=C.prototype;F.copy=function(G){const L=this.size,H=this.viewpoint;H&&L?(this.viewpoint=E.copy(H,G.viewpoint),this._set("size",t.copy(L,G.size))):(this.viewpoint=G.viewpoint.clone(),this._set("size",[G.size[0],G.size[1]]));this._set("pixelRatio",G.pixelRatio);return this};F.clone=function(){return new p({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})};F.toMap=function(G,L,H){if(u.isVec2(L))return t.transformMat2d(G,L,this.inverseTransform);
B[0]=L;B[1]=H;return t.transformMat2d(G,B,this.inverseTransform)};F.toScreen=function(G,L,H){if(u.isVec2(L))return t.transformMat2d(G,L,this.transform);B[0]=L;B[1]=H;return t.transformMat2d(G,B,this.transform)};F.toScreenNoRotation=function(G,L,H){if(u.isVec2(L))return t.transformMat2d(G,L,this.transformNoRotation);B[0]=L;B[1]=H;return t.transformMat2d(G,B,this.transformNoRotation)};F.getScreenTransform=function(G,L){const {center:H}=this._viewpoint2D,M=this._get("pixelRatio")||1,K=this._get("size");
E.getMatrix(G,H,K,L,0,M);return G};F._update=function(){const {center:G,spatialReference:L,scale:H,rotation:M}=this._viewpoint2D,K=this._get("pixelRatio")||1,I=this._get("size"),O=new g({targetGeometry:new A(G[0],G[1],L),scale:H,rotation:M});this._set("viewpoint",O);if(I&&L&&H){this.resolution=E.getResolution(O);this.rotation=M;this.scale=H;this.spatialReference=L;t.copy(this.center,G);v.set(this.displayMat3,0!==I[0]?2/I[0]:0,0,0,0,0!==I[1]?-2/I[1]:0,0,-1,1,1);var Q=v.identity(this.viewMat3),J=r.fromValues(I[0]/
2,I[1]/2),P=r.fromValues(-I[0]/2,-I[1]/2),N=e.toRadian(M);v.translate(Q,Q,J);v.rotate(Q,Q,N);v.translate(Q,Q,P);v.multiply(this.displayViewMat3,this.displayMat3,Q);Q=d.fromTranslation(this.viewMat2d,J);d.rotate(Q,Q,N);d.translate(Q,Q,P);E.getExtent(this.extent,O,I);E.getTransform(this.transform,O,I,K);d.invert(this.inverseTransform,this.transform);E.getTransformNoRotation(this.transformNoRotation,O,I,K);this.worldScreenWidth=E.getWorldScreenWidth(this.spatialReference,this.resolution);this._set("id",
this.id+1);return this}};a._createClass(C,[{key:"pixelRatio",set:function(G){this._set("pixelRatio",G);this._update()}},{key:"size",set:function(G){this._set("size",G);this._update()}},{key:"viewpoint",set:function(G){if(G){const L=this._viewpoint2D,H=G.targetGeometry;L.center[0]=H.x;L.center[1]=H.y;L.rotation=G.rotation;L.scale=G.scale;L.spatialReference=H.spatialReference}this._update()}}]);return C}(h.JSONSupport);b.__decorate([w.property({readOnly:!0})],c.prototype,"id",void 0);b.__decorate([w.property({value:1,
json:{write:!0}})],c.prototype,"pixelRatio",null);b.__decorate([w.property({json:{write:!0}})],c.prototype,"size",null);b.__decorate([w.property()],c.prototype,"spatialReference",void 0);b.__decorate([w.property({type:g,json:{write:!0}})],c.prototype,"viewpoint",null);return c=p=b.__decorate([k.subclass("esri.views.2d.ViewState")],c)})},"esri/chunks/mat2d":function(){define(["exports","./common"],function(a,b){function c(p,B){p[0]=B[0];p[1]=B[1];p[2]=B[2];p[3]=B[3];p[4]=B[4];p[5]=B[5];return p}function g(p){p[0]=
1;p[1]=0;p[2]=0;p[3]=1;p[4]=0;p[5]=0;return p}function h(p,B,D,C,F,G,L){p[0]=B;p[1]=D;p[2]=C;p[3]=F;p[4]=G;p[5]=L;return p}function w(p,B){const D=B[0],C=B[1],F=B[2],G=B[3],L=B[4];B=B[5];let H=D*G-C*F;if(!H)return null;H=1/H;p[0]=G*H;p[1]=-C*H;p[2]=-F*H;p[3]=D*H;p[4]=(F*B-G*L)*H;p[5]=(C*L-D*B)*H;return p}function n(p){return p[0]*p[3]-p[1]*p[2]}function f(p,B,D){const C=B[0],F=B[1],G=B[2],L=B[3],H=B[4];B=B[5];const M=D[0],K=D[1],I=D[2],O=D[3],Q=D[4];D=D[5];p[0]=C*M+G*K;p[1]=F*M+L*K;p[2]=C*I+G*O;p[3]=
F*I+L*O;p[4]=C*Q+G*D+H;p[5]=F*Q+L*D+B;return p}function l(p,B,D){const C=B[0],F=B[1],G=B[2],L=B[3],H=B[4];B=B[5];const M=Math.sin(D);D=Math.cos(D);p[0]=C*D+G*M;p[1]=F*D+L*M;p[2]=C*-M+G*D;p[3]=F*-M+L*D;p[4]=H;p[5]=B;return p}function k(p,B,D){const C=B[1],F=B[2],G=B[3],L=B[4],H=B[5],M=D[0];D=D[1];p[0]=B[0]*M;p[1]=C*M;p[2]=F*D;p[3]=G*D;p[4]=L;p[5]=H;return p}function e(p,B,D){const C=B[0],F=B[1],G=B[2],L=B[3],H=B[4];B=B[5];const M=D[0];D=D[1];p[0]=C;p[1]=F;p[2]=G;p[3]=L;p[4]=C*M+G*D+H;p[5]=F*M+L*D+
B;return p}function d(p,B){const D=Math.sin(B);B=Math.cos(B);p[0]=B;p[1]=D;p[2]=-D;p[3]=B;p[4]=0;p[5]=0;return p}function m(p,B){p[0]=B[0];p[1]=0;p[2]=0;p[3]=B[1];p[4]=0;p[5]=0;return p}function z(p,B){p[0]=1;p[1]=0;p[2]=0;p[3]=1;p[4]=B[0];p[5]=B[1];return p}function v(p){return"mat2d("+p[0]+", "+p[1]+", "+p[2]+", "+p[3]+", "+p[4]+", "+p[5]+")"}function q(p){return Math.sqrt(p[0]**2+p[1]**2+p[2]**2+p[3]**2+p[4]**2+p[5]**2+1)}function t(p,B,D){p[0]=B[0]+D[0];p[1]=B[1]+D[1];p[2]=B[2]+D[2];p[3]=B[3]+
D[3];p[4]=B[4]+D[4];p[5]=B[5]+D[5];return p}function r(p,B,D){p[0]=B[0]-D[0];p[1]=B[1]-D[1];p[2]=B[2]-D[2];p[3]=B[3]-D[3];p[4]=B[4]-D[4];p[5]=B[5]-D[5];return p}function x(p,B,D){p[0]=B[0]*D;p[1]=B[1]*D;p[2]=B[2]*D;p[3]=B[3]*D;p[4]=B[4]*D;p[5]=B[5]*D;return p}function u(p,B,D,C){p[0]=B[0]+D[0]*C;p[1]=B[1]+D[1]*C;p[2]=B[2]+D[2]*C;p[3]=B[3]+D[3]*C;p[4]=B[4]+D[4]*C;p[5]=B[5]+D[5]*C;return p}function E(p,B){return p[0]===B[0]&&p[1]===B[1]&&p[2]===B[2]&&p[3]===B[3]&&p[4]===B[4]&&p[5]===B[5]}function y(p,
B){const D=p[0],C=p[1],F=p[2],G=p[3],L=p[4];p=p[5];const H=B[0],M=B[1],K=B[2],I=B[3],O=B[4];B=B[5];return Math.abs(D-H)<=b.EPSILON*Math.max(1,Math.abs(D),Math.abs(H))&&Math.abs(C-M)<=b.EPSILON*Math.max(1,Math.abs(C),Math.abs(M))&&Math.abs(F-K)<=b.EPSILON*Math.max(1,Math.abs(F),Math.abs(K))&&Math.abs(G-I)<=b.EPSILON*Math.max(1,Math.abs(G),Math.abs(I))&&Math.abs(L-O)<=b.EPSILON*Math.max(1,Math.abs(L),Math.abs(O))&&Math.abs(p-B)<=b.EPSILON*Math.max(1,Math.abs(p),Math.abs(B))}const A=Object.freeze({__proto__:null,
copy:c,identity:g,set:h,invert:w,determinant:n,multiply:f,rotate:l,scale:k,translate:e,fromRotation:d,fromScaling:m,fromTranslation:z,str:v,frob:q,add:t,subtract:r,multiplyScalar:x,multiplyScalarAndAdd:u,exactEquals:E,equals:y,mul:f,sub:r});a.add=t;a.copy=c;a.determinant=n;a.equals=y;a.exactEquals=E;a.frob=q;a.fromRotation=d;a.fromScaling=m;a.fromTranslation=z;a.identity=g;a.invert=w;a.mat2d=A;a.mul=f;a.multiply=f;a.multiplyScalar=x;a.multiplyScalarAndAdd=u;a.rotate=l;a.scale=k;a.set=h;a.str=v;a.sub=
r;a.subtract=r;a.translate=e})},"esri/chunks/mat2df32":function(){define(["exports"],function(a){function b(){const l=new Float32Array(6);l[0]=1;l[3]=1;return l}function c(l){const k=new Float32Array(6);k[0]=l[0];k[1]=l[1];k[2]=l[2];k[3]=l[3];k[4]=l[4];k[5]=l[5];return k}function g(l,k,e,d,m,z){const v=new Float32Array(6);v[0]=l;v[1]=k;v[2]=e;v[3]=d;v[4]=m;v[5]=z;return v}function h(l,k){return new Float32Array(l,k,6)}function w(l,k,e,d){const m=k[d];k=k[d+1];l[d]=e[0]*m+e[2]*k+e[4];l[d+1]=e[1]*m+
e[3]*k+e[5]}function n(l,k,e,d=0,m=0,z=2){for(m=m||k.length/z;d<m;d++)w(l,k,e,d*z)}const f=Object.freeze({__proto__:null,create:b,clone:c,fromValues:g,createView:h,transform:w,transformMany:n});a.clone=c;a.create=b;a.createView=h;a.fromValues=g;a.mat2df32=f;a.transform=w;a.transformMany=n})},"esri/chunks/mat2df64":function(){define(["exports"],function(a){function b(){return[1,0,0,1,0,0]}function c(n){return[n[0],n[1],n[2],n[3],n[4],n[5]]}function g(n,f,l,k,e,d){return[n,f,l,k,e,d]}function h(n,f){return new Float64Array(n,
f,6)}const w=Object.freeze({__proto__:null,create:b,clone:c,fromValues:g,createView:h});a.clone=c;a.create=b;a.createView=h;a.fromValues=g;a.mat2df64=w})},"esri/core/libs/gl-matrix-2/types/vec2":function(){define(["exports"],function(a){function b(g){return g instanceof Float32Array&&2<=g.length}function c(g){return Array.isArray(g)&&2<=g.length}a.isVec2=function(g){return b(g)||c(g)};a.isVec2f32=b;a.isVec2f64=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/viewpointUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../Viewpoint ../../core/Collection ../../core/maybe ../../core/unitUtils ../../chunks/common ../../chunks/mat2d ../../chunks/mat2df64 ../../chunks/vec2 ../../chunks/vec2f64 ../../geometry/Extent ../../geometry/Geometry ../../geometry/Point ../../geometry/projection ../../geometry/SpatialReference ../../geometry/support/spatialReferenceUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t){function r(Y,ea){return ea.type?k.set(Y,ea.x,ea.y):k.copy(Y,ea)}function x(Y,ea){return Math.max(Y.width/ea[0],Y.height/ea[1])*G(Y.spatialReference)}function u(Y,ea,ja,la){return E.apply(this,arguments)}function E(){E=b._asyncToGenerator(function*(Y,ea,ja,la){if(!Y||Array.isArray(Y)&&!Y.length)return null;g.isCollection(Y)&&(Y=Y.toArray());if(Array.isArray(Y)&&Y.length&&"object"===typeof Y[0]){var ia=Y.every(na=>"attributes"in na);var ca=Y.some(na=>!na.geometry),
fa=Y;if(ia&&ca&&ea&&ea.allLayerViews){ia=new Map;for(var ba of Y)Y=ba.layer,ca=ia.get(Y)||[],fa=ba.attributes[Y.objectIdField],null!=fa&&ca.push(fa),ia.set(Y,ca);const na=[];ia.forEach((pa,xa)=>{const Da=ea.allLayerViews.find(ua=>ua.layer.id===xa.id);if("queryFeatures"in Da){const ua=xa.createQuery();ua.objectIds=pa;ua.returnGeometry=!0;na.push(Da.queryFeatures(ua))}});ba=yield Promise.all(na);Y=[];for(var Z of ba)if(Z&&Z.features&&Z.features.length)for(var ha of Z.features)h.isSome(ha.geometry)&&
Y.push(ha.geometry);fa=Y}for(const na of fa)la=yield u(na,ea,ja,la);return la}if(Array.isArray(Y)&&2===Y.length&&"number"===typeof Y[0]&&"number"===typeof Y[1])ia=new z(Y);else if(Y instanceof m)ia=Y;else if("geometry"in Y)if(Y.geometry)ia=Y.geometry;else if(Y.layer){const na=Y.layer;Z=ea.allLayerViews.find(pa=>pa.layer.id===na.id);"queryFeatures"in Z&&(ha=na.createQuery(),ha.objectIds=[Y.attributes[na.objectIdField]],ha.returnGeometry=!0,Z=yield Z.queryFeatures(ha),ia=h.get(Z,"features",0,"geometry"))}if(h.isNone(ia))return null;
Z="point"===ia.type?new d({xmin:ia.x,ymin:ia.y,xmax:ia.x,ymax:ia.y,spatialReference:ia.spatialReference}):ia.extent;if(!Z)return null;v.isLoaded()||v.canProjectWithoutEngine(Z.spatialReference,ja)||(yield v.load());ja=v.project(Z,ja);return ja?la=la?la.union(ja):ja:null});return E.apply(this,arguments)}function y(Y){if(Y&&(!Array.isArray(Y)||"number"!==typeof Y[0])&&("object"===typeof Y||Array.isArray(Y)&&"object"===typeof Y[0])){if("layer"in Y&&Y.layer&&Y.layer.minScale&&Y.layer.maxScale){var ea=
Y.layer;return{min:ea.minScale,max:ea.maxScale}}if(Array.isArray(Y)&&Y.length&&Y.every(ja=>"layer"in ja)){let ja=ea=0;for(const la of Y)(Y=la.layer)&&Y.minScale&&Y.maxScale&&(ea=Y.minScale<ea?Y.minScale:ea,ja=Y.maxScale>ja?Y.maxScale:ja);return ea&&ja?{min:ea,max:ja}:null}}}function A(Y,ea){return t.equals(Y.wkid?Y:Y.spatialReference||q.WGS84,ea)?Y:v.project(Y,ea)}function p(){p=b._asyncToGenerator(function*(Y,ea){if(!Y||!ea)return new c({targetGeometry:new z,scale:0,rotation:0});let ja=ea.spatialReference;
const {constraints:la,padding:ia,viewpoint:ca,size:fa}=ea,ba=[ia?fa[0]-ia.left-ia.right:fa[0],ia?fa[1]-ia.top-ia.bottom:fa[1]];let Z=null;Y instanceof c?Z=Y:Y.viewpoint?Z=Y.viewpoint:Y.target&&"esri.Viewpoint"===Y.target.declaredClass&&(Z=Y.target);let ha=null;if(Z&&Z.targetGeometry)ha=Z.targetGeometry;else if(Y instanceof d)ha=Y;else if(Y||Y&&("center"in Y||"extent"in Y||"target"in Y))ha=(yield u(Y.center,ea,ja))||(yield u(Y.extent,ea,ja))||(yield u(Y.target,ea,ja))||(yield u(Y,ea,ja));!ha&&ca&&
ca.targetGeometry?ha=ca.targetGeometry:!ha&&ea.extent&&(ha=ea.extent);if(!ja){var na=ea.spatialReference||ea.extent||ha;ja=na.wkid?na:na.spatialReference||q.WGS84}v.isLoaded()||t.equals(ha.spatialReference,ja)||v.canProjectWithoutEngine(ha,ja)||(yield v.load());na=A(ha.center?ha.center:ha,ja);var pa=null;Z&&h.isSome(Z.targetGeometry)&&"point"===Z.targetGeometry.type?pa=Z.scale:"scale"in Y&&Y.scale?pa=Y.scale:"zoom"in Y&&-1!==Y.zoom&&la&&la.effectiveLODs?pa=la.zoomToScale(Y.zoom):Array.isArray(ha)||
"point"===ha.type||"extent"===ha.type&&0===ha.width&&0===ha.height?(pa=A(ea.extent,ja),pa=h.isSome(pa)?x(pa,ba):ea.extent?x(ea.extent,ba):ca.scale):pa=x(A(ha.extent,ja),ba);if(ea=y(Y))ea.min&&ea.min>pa?pa=ea.min:ea.max&&ea.max<pa&&(pa=ea.max);ea=0;Z?ea=Z.rotation:Y.hasOwnProperty("rotation")?ea=Y.rotation:ca&&(ea=ca.rotation);Y=new c({targetGeometry:na,scale:pa,rotation:ea});la&&(Y=la.fit(Y),la.constrainByGeometry(Y),la.rotationEnabled||(Y.rotation=ea));return Y});return p.apply(this,arguments)}function B(Y,
ea){const ja=Y.targetGeometry,la=ea.targetGeometry;ja.x=la.x;ja.y=la.y;ja.spatialReference=la.spatialReference;Y.scale=ea.scale;Y.rotation=ea.rotation;return Y}function D(Y,ea,ja){return ja?k.set(Y,.5*(ea[0]-ja.right+ja.left),.5*(ea[1]-ja.bottom+ja.top)):k.scale(Y,ea,.5)}function C(Y,ea,ja,la){Q(Y,ea,ja,la);return f.invert(Y,Y)}function F(Y){var ea=Y.scale;Y=Y.targetGeometry;Y=h.isSome(Y)&&t.isValid(Y.spatialReference)?1/(39.37*w.getMetersPerUnitForSR(Y.spatialReference)*96):1;return ea*Y}function G(Y){return t.isValid(Y)?
39.37*w.getMetersPerUnitForSR(Y)*96:1}function L(Y){return Y.isWrappable?(Y=t.getInfo(Y),Y.valid[1]-Y.valid[0]):0}const H=180/Math.PI,M=function(){const Y=e.create();return function(ea,ja,la){const ia=ja.targetGeometry;r(Y,ia);ja=.5*F(ja);ea.xmin=Y[0]-ja*la[0];ea.ymin=Y[1]-ja*la[1];ea.xmax=Y[0]+ja*la[0];ea.ymax=Y[1]+ja*la[1];ea.spatialReference=ia.spatialReference;return ea}}(),K=function(){const Y=e.create();return function(ea,ja,la){return k.sub(ea,k.scale(ea,ja,.5),D(Y,ja,la))}}(),I=function(){const Y=
l.create(),ea=e.create();return function(ja,la,ia,ca){const fa=F(la);la=n.toRadian(la.rotation)||0;k.set(ea,fa,fa);f.fromScaling(Y,ea);f.rotate(Y,Y,la);f.translate(Y,Y,K(ea,ia,ca));f.translate(Y,Y,[0,ca.top-ca.bottom]);return k.set(ja,Y[4],Y[5])}}(),O=function(){const Y=e.create(),ea=e.create(),ja=e.create();return function(la,ia,ca,fa,ba,Z){k.negate(Y,ia);k.scale(ea,ca,.5*Z);k.set(ja,1/fa*Z,-1/fa*Z);f.fromTranslation(la,ea);ba&&f.rotate(la,la,ba);f.scale(la,la,ja);f.translate(la,la,Y);return la}}(),
Q=function(){const Y=e.create();return function(ea,ja,la,ia){const ca=F(ja),fa=n.toRadian(ja.rotation)||0;r(Y,ja.targetGeometry);return O(ea,Y,la,ca,fa,ia)}}(),J=function(){const Y=e.create();return function(ea,ja,la,ia){const ca=F(ja);r(Y,ja.targetGeometry);return O(ea,Y,la,ca,0,ia)}}(),P=function(){const Y=e.create(),ea=e.create(),ja=[0,0,0];return function(la,ia,ca){k.subtract(Y,la,ia);k.normalize(Y,Y);k.subtract(ea,la,ca);k.normalize(ea,ea);k.cross(ja,Y,ea);la=Math.acos(k.dot(Y,ea)/(k.length(Y)*
k.length(ea)))*H;0>ja[2]&&(la=-la);isNaN(la)&&(la=0);return la}}(),N=function(){const Y=e.create();return function(ea,ja,la,ia){const ca=ea.targetGeometry;B(ea,ja);I(Y,ja,la,ia);ca.x+=Y[0];ca.y+=Y[1];return ea}}(),R=function(){return function(Y,ea,ja){B(Y,ea);ea=Y.targetGeometry;ea.x=ja.x;ea.y=ja.y;ea.spatialReference=ja.spatialReference;return Y}}(),S=function(){const Y=e.create();return function(ea,ja,la,ia,ca){ca||(ca="center");k.sub(Y,la,ia);k.scale(Y,Y,.5);la=Y[0];ia=Y[1];switch(ca){case "center":k.set(Y,
0,0);break;case "left":k.set(Y,-la,0);break;case "top":k.set(Y,0,ia);break;case "right":k.set(Y,la,0);break;case "bottom":k.set(Y,0,-ia);break;case "top-left":k.set(Y,-la,ia);break;case "bottom-left":k.set(Y,-la,-ia);break;case "top-right":k.set(Y,la,ia);break;case "bottom-right":k.set(Y,la,-ia)}da(ea,ja,Y);return ea}}(),T=function(){const Y=e.create();return function(ea,ja,la,ia,ca){B(ea,ja);isNaN(la)||0===la||(U(Y,ia,ja,ca),ea.scale=ja.scale*la,aa(Y,Y,ea,ca),da(ea,ea,k.set(Y,Y[0]-ia[0],ia[1]-Y[1])));
return ea}}(),V=function(){const Y=e.create();return function(ea,ja,la,ia,ca,fa){B(ea,ja);isNaN(la)||0===la||(U(Y,ca,ja,fa),ea.scale=ja.scale*la,ea.rotation+=ia,aa(Y,Y,ea,fa),da(ea,ea,k.set(Y,Y[0]-ca[0],ca[1]-Y[1])));return ea}}(),W=function(){const Y=e.create(),ea=e.create();return function(ja,la,ia,ca,fa,ba,Z){K(ea,ba,Z);k.add(Y,fa,ea);return ca?V(ja,la,ia,ca,Y,ba):T(ja,la,ia,Y,ba)}}(),U=function(){const Y=l.create();return function(ea,ja,la,ia){return k.transformMat2d(ea,ja,C(Y,la,ia,1))}}(),aa=
function(){const Y=l.create();return function(ea,ja,la,ia){return k.transformMat2d(ea,ja,Q(Y,la,ia,1))}}(),da=function(){const Y=e.create(),ea=l.create();return function(ja,la,ia){B(ja,la);const ca=F(la),fa=ja.targetGeometry;f.fromRotation(ea,n.toRadian(la.rotation)||0);f.scale(ea,ea,e.fromValues(ca,ca));k.transformMat2d(Y,ia,ea);fa.x+=Y[0];fa.y+=Y[1];return ja}}();a.addPadding=N;a.angleBetween=P;a.centerAt=R;a.copy=B;a.create=function(Y,ea){return p.apply(this,arguments)};a.extentToScale=x;a.getAnchor=
D;a.getExtent=M;a.getMatrix=O;a.getPaddingMapTranslation=I;a.getPaddingScreenTranslation=K;a.getResolution=F;a.getResolutionToScaleFactor=G;a.getTransform=Q;a.getTransformNoRotation=J;a.getWorldScreenWidth=function(Y,ea){return Math.round(L(Y)/ea)};a.getWorldWidth=L;a.padAndScaleAndRotateBy=W;a.resize=S;a.rotateBy=function(Y,ea,ja){B(Y,ea);Y.rotation+=ja;return Y};a.rotateTo=function(Y,ea,ja){B(Y,ea);Y.rotation=ja;return Y};a.scaleAndRotateBy=V;a.scaleTo=function(Y,ea,ja){B(Y,ea);Y.scale=ja;return Y};
a.setExtent=function(Y,ea,ja,la,ia){R(Y,ea,ja.center);Y.scale=x(ja,la);ia&&ia.constraints&&ia.constraints.constrain(Y);return Y};a.toMap=U;a.toScreen=aa;a.translateBy=da;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/BlendLayersTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../webgl-engine/core/shaderLibrary/output/BlendOptions ../../../chunks/BlendLayers.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m){f=function(z){function v(){return z.apply(this,arguments)||this}c._inheritsLoose(v,z);var q=v.prototype;q.initializeProgram=function(t){const r=v.shader.get().build();return new e.Program(t.rctx,r,k.Default3D)};q.initializePipeline=function(){const t=this.configuration.mode===h.BlendMode.OneMinusSourceAlpha?m.simpleBlendingParams(d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA):this.configuration.mode===h.BlendMode.SourceAlpha?m.simpleBlendingParams(d.BlendFactor.ZERO,
d.BlendFactor.SRC_ALPHA):null;return m.makePipelineState({blending:t,colorWrite:m.defaultColorWriteParams})};return v}(f.ShaderTechnique);f.shader=new n.ReloadableShaderModule(w.BlendLayersShader,()=>new Promise((z,v)=>a(["../webgl-engine/core/shaderLibrary/util/BlendLayers.glsl"],z,v)));w=function(z){function v(){var q=z.apply(this,arguments)||this;q.mode=h.BlendMode.NoAlpha;return q}c._inheritsLoose(v,z);return v}(l.ShaderTechniqueConfiguration);g.__decorate([l.parameter({count:h.BlendMode.COUNT})],
w.prototype,"mode",void 0);b.BlendLayersTechnique=f;b.BlendLayersTechniqueConfiguration=w;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/BlendOptions":function(){define(["exports"],function(a){a.BlendMode=void 0;var b=a.BlendMode||(a.BlendMode={});b[b.NoAlpha=0]="NoAlpha";b[b.SourceAlpha=1]="SourceAlpha";b[b.OneMinusSourceAlpha=2]="OneMinusSourceAlpha";b[b.COUNT=3]="COUNT";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/BlendLayers.glsl":function(){define(["exports",
"../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/lib/VertexAttribute"],function(a,b,c,g){function h(){const n=new c.ShaderBuilder;n.attributes.add(g.VertexAttribute.POSITION,"vec2");n.attributes.add(g.VertexAttribute.UV0,"vec2");n.vertex.uniforms.add("scale","float");n.vertex.uniforms.add("offset","vec2");n.varyings.add("uv","vec2");n.vertex.code.add(b.glsl`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
}`);n.fragment.uniforms.add("tex","sampler2D");n.fragment.uniforms.add("opacity","float");n.fragment.code.add(b.glsl`void main() {
vec4 color = texture2D(tex, uv);
gl_FragColor = vec4(color.xyz, 1.0) * color.a * opacity;
}`);return n}const w=Object.freeze({__proto__:null,build:h});a.BlendLayersShader=w;a.build=h})},"esri/views/3d/terrain/RasterColorizerTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/maybe ../../2d/engine/imagery/enums ../webgl-engine/core/shaderLibrary/output/BlendOptions ../../../chunks/RasterColorizer.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/rasterUtils ../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q){k=function(t){function r(){return t.apply(this,arguments)||this}c._inheritsLoose(r,t);var x=r.prototype;x.initializeProgram=function(u){var E=r.shader.get();const y=this.configuration;E=E.build({output:y.colorizerType,applyColormap:y.applyColormap,stretchType:y.stretchType});this._context=u.rctx;return new m.Program(u.rctx,E,d.Default3D)};x.initializePipeline=function(){const u=this.configuration.mode===n.BlendMode.OneMinusSourceAlpha?q.simpleBlendingParams(z.BlendFactor.ONE,
z.BlendFactor.ONE_MINUS_SRC_ALPHA):this.configuration.mode===n.BlendMode.SourceAlpha?q.simpleBlendingParams(z.BlendFactor.ZERO,z.BlendFactor.SRC_ALPHA):null;return q.makePipelineState({blending:u,colorWrite:q.defaultColorWriteParams})};x.bindPass=function(u){v.setUniforms(this.program,this.uniformLocationInfos,u.basic);v.setUniforms(this.program,this.uniformLocationInfos,u.common);h.isSome(u.colormap)&&v.setUniforms(this.program,this.uniformLocationInfos,u.colormap);this.configuration.colorizerType===
w.RasterColorizerType.Stretch&&h.isSome(u.stretch)?v.setUniforms(this.program,this.uniformLocationInfos,u.stretch):this.configuration.colorizerType===w.RasterColorizerType.Hillshade&&h.isSome(u.hillshade)&&v.setUniforms(this.program,this.uniformLocationInfos,u.hillshade)};c._createClass(r,[{key:"uniformLocationInfos",get:function(){this._uniformLocationInfos||(this._uniformLocationInfos=v.getUniformLocationInfos(this._context,this.program));return this._uniformLocationInfos}}]);return r}(k.ShaderTechnique);
k.shader=new l.ReloadableShaderModule(f.RasterColorizerShader,()=>new Promise((t,r)=>a(["../webgl-engine/core/shaderLibrary/raster/RasterColorizer.glsl"],t,r)));f=function(t){function r(){var x=t.apply(this,arguments)||this;x.mode=n.BlendMode.OneMinusSourceAlpha;x.colorizerType=w.RasterColorizerType.Stretch;x.stretchType=w.RasterColorizerStretchType.Noop;x.applyColormap=!0;return x}c._inheritsLoose(r,t);return r}(e.ShaderTechniqueConfiguration);g.__decorate([e.parameter({count:n.BlendMode.COUNT})],
f.prototype,"mode",void 0);g.__decorate([e.parameter({count:w.RasterColorizerType.COUNT})],f.prototype,"colorizerType",void 0);g.__decorate([e.parameter({count:w.RasterColorizerStretchType.COUNT})],f.prototype,"stretchType",void 0);g.__decorate([e.parameter()],f.prototype,"applyColormap",void 0);b.RasterColorizerTechnique=k;b.RasterColorizerTechniqueConfiguration=f;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/RasterColorizer.glsl":function(){define("exports ../views/2d/engine/imagery/enums ../views/3d/webgl-engine/core/shaderLibrary/raster/BasicGrid.glsl ../views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl ../views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,b,c,g,h,w,n,f){function l(e){const d=new f.ShaderBuilder;d.include(c.BasicGrid);d.include(h.Common);d.include(g.Colormap);if(e.output===b.RasterColorizerType.Stretch){{d.fragment.uniforms.add("u_bandCount","int");d.fragment.uniforms.add("u_minCutOff","float",3);d.fragment.uniforms.add("u_maxCutOff","float",3);d.fragment.uniforms.add("u_factor","float",3);d.fragment.uniforms.add("u_minOutput","float");d.fragment.uniforms.add("u_maxOutput","float");d.fragment.uniforms.add("u_useGamma","bool");
d.fragment.uniforms.add("u_gamma","float",3);d.fragment.uniforms.add("u_gammaCorrection","float",3);d.fragment.code.add(n.glsl`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const m=e.applyColormap?n.glsl`gl_FragColor = colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma);`:n.glsl`gl_FragColor = vec4(grayVal, grayVal, grayVal, 1.0) * currentPixel.a * u_opacity;`;d.fragment.code.add(n.glsl`
      void main() {
        vec2 pixelLocation = getPixelLocation(v_texcoord);
        if (isOutside(pixelLocation)) {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===b.RasterColorizerStretchType.Noop?n.glsl`
        gl_FragColor = vec4(currentPixel.rgb, 1.0) * currentPixel.a * u_opacity;`:n.glsl`
        if (currentPixel.a == 0.0) {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${m}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = vec4(redVal, greenVal, blueVal, 1.0) * currentPixel.a * u_opacity;
        }`}
      }`)}}else e.output===b.RasterColorizerType.Lut?d.fragment.code.add(n.glsl`void main() {
vec2 pixelLocation = getPixelLocation(v_texcoord);
if (isOutside(pixelLocation)) {
gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = colormap(currentPixel, true);
}`):e.output===b.RasterColorizerType.Hillshade&&(d.fragment.uniforms.add("u_hillshadeType","int"),d.fragment.uniforms.add("u_sinZcosAs","float",6),d.fragment.uniforms.add("u_sinZsinAs","float",6),d.fragment.uniforms.add("u_cosZs","float",6),d.fragment.uniforms.add("u_weights","float",6),d.fragment.uniforms.add("u_factor","vec2"),d.fragment.uniforms.add("u_applyColormap","bool"),d.fragment.uniforms.add("u_minValue","float"),d.fragment.uniforms.add("u_maxValue","float"),d.fragment.uniforms.add("u_srcImageSize",
"vec2"),d.fragment.include(w.ColorConversion),d.fragment.code.add(n.glsl`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 rgb = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(rgb.xyz);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv) * alpha, alpha);
}`),d.fragment.code.add(n.glsl`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`),e=e.applyColormap?n.glsl`gl_FragColor = overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha);`:n.glsl`hillshade *= alpha;
gl_FragColor = vec4(hillshade, hillshade, hillshade, alpha);`,d.fragment.code.add(n.glsl`
    void main() {
      vec2 pixelLocation = getPixelLocation(v_texcoord);
      if (isOutside(pixelLocation)) {
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${e}
    }
  `));return d}const k=Object.freeze({__proto__:null,build:l});a.RasterColorizerShader=k;a.build=l})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/BasicGrid.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c){a.BasicGrid=function(g){g.attributes.add(c.VertexAttribute.POSITION,"vec2");g.attributes.add(c.VertexAttribute.UV0,"vec2");g.vertex.uniforms.add("u_scale","float");g.vertex.uniforms.add("u_offset","vec2");g.varyings.add("v_texcoord",
"vec2");g.vertex.code.add(b.glsl`void main(void) {
v_texcoord = uv0 * u_scale + u_offset;
gl_Position = vec4(position, 0.0, 1.0);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.Colormap=function(c){c.fragment.uniforms.add("u_colormap","sampler2D");c.fragment.uniforms.add("u_colormapOffset","float");c.fragment.uniforms.add("u_colormapMaxIndex","float");c.fragment.code.add(b.glsl`vec4 colormap(vec4 currentPixel, bool isFloat) {
float clrIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || clrIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);
vec4 color = texture2D(u_colormap, clrPosition);
result = vec4(color.rgb, 1.0) * color.a * u_opacity;
}
return result;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl":function(){define(["exports","./Projection.glsl","../../shaderModules/interfaces"],function(a,b,c){a.Common=function(g){g.include(b.Projection);g.fragment.uniforms.add("u_image","sampler2D");g.fragment.uniforms.add("u_isFloatTexture","bool");g.fragment.uniforms.add("u_flipY","bool");g.fragment.uniforms.add("u_applyTransform","bool");g.fragment.uniforms.add("u_opacity","float");
g.fragment.code.add(c.glsl`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Projection.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.Projection=function(c){c.fragment.uniforms.add("u_transformGrid","sampler2D");c.fragment.uniforms.add("u_transformSpacing","vec2");c.fragment.uniforms.add("u_transformGridSize","vec2");c.fragment.uniforms.add("u_targetImageSize","vec2");c.fragment.code.add(b.glsl`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);
vec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;
vec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);
vec2 srcLocation;
vec2 transform_location = index_transform + oneTransformPixel * 0.5;
if (pos.s <= pos.t) {
vec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));
vec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));
} else {
vec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));
vec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));
}
return srcLocation;;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TextureReference":function(){define(["exports","../../../chunks/vec3f64","../../../chunks/vec4f64"],function(a,b,c){let g=function(){function h(w,n,f,l,k,e,d){this.texture=w;this.type=n;w.retain();this.offsetAndScale=c.fromValues(f.offset[0],f.offset[1],f.scale,f.scale);this.opacities=b.fromValues(l,d?e:0,k)}h.prototype.destroy=function(){this.texture.release()};return h}();a.TextureReference=g;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/terrain/support/FBOPool":function(){define(["exports","../../../../core/ObjectPool","../../../webgl/enums","../../../webgl/FramebufferObject"],function(a,b,c,g){let h=function(){function w(f){this._rctx=f;this._pools=new Map}var n=w.prototype;n.acquire=function(f){return this._getPool(f).acquire()};n.release=function(f){this._getPool(f.width).release(f)};n.clear=function(){this._pools.forEach(f=>f.destroy());this._pools.clear()};n._getPool=function(f){var l=
this._pools.get(f);l||(l=g.FramebufferObject.bind(g.FramebufferObject,this._rctx,{colorTarget:c.TargetType.TEXTURE,depthStencilTarget:c.DepthStencilTargetType.DEPTH_RENDER_BUFFER,width:f,height:f}),l=new b(l),this._pools.set(f,l));return l};return w}();a.FBOPool=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/ComponentIntersectionData":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/vec3f64",
"../../../../../geometry/support/aaBoundingBox","../../materials/internal/MaterialUtil"],function(a,b,c,g,h){function w(t,r,x){let u=0,E=Infinity;for(let A=0;3>A;++A){var y=t[A];if(r[A]<y){if(1E-6>=x[A])return!1;u=Math.max(u,(y-r[A])/x[A])}else-1E-6>=x[A]&&(E=Math.min(E,(y-r[A])/x[A]));if(u>E)return!1;y=t[A+3];if(r[A]>y){if(-1E-6<=x[A])return!1;u=Math.max(u,(y-r[A])/x[A])}else 1E-6<=x[A]&&(E=Math.min(E,(y-r[A])/x[A]));if(u>E)return!1}return!0}function n(t,r,x,u,E,y){let A=u;for(;x<A;){var p=t[x];
r[6*p+E+3]<=y?++x:(--A,t[x]=t[A],t[A]=p)}p=x;for(A=u;p<A;)u=t[A-1],r[6*u+E]>=y?--A:(t[A-1]=t[p],t[p]=u,++p);return{next:x,mid:p}}function f(t,r,x,u){if(u<=x)return g.fromValues(NaN,NaN,NaN,NaN,NaN,NaN);var E=6*t[x];for(var y=0;3>y;++y)v[y]=r[E+0+y],q[y]=r[E+3+y];for(x+=1;x<u;++x)for(E=6*t[x],y=0;3>y;++y)v[y]=Math.min(v[y],r[E+0+y]),q[y]=Math.max(q[y],r[E+3+y]);return g.fromValues(v[0],v[1],v[2],q[0],q[1],q[2])}function l(t){var r=t[3]-t[0];const x=t[4]-t[1],u=t[5]-t[2];r=r>x?r>u?0:x>u?1:2:x>u?1:u>
r?2:0;return{axis:r,midValue:(t[r]+t[r+3])/2}}function k(t,r,x,u,E){x-=r;const y=new Float32Array(6*x);for(let p=0;p<x;++p){var A=3*(p+r);const B=t[A+0]*E,D=t[A+1]*E;A=t[A+2]*E;for(let C=0;3>C;++C){const F=u[B+C],G=u[D+C],L=u[A+C];y[6*p+C]=Math.min(F,G,L);y[6*p+3+C]=Math.max(F,G,L)}}return y}function e(t,r,x,u){const E=u-x;var y=0;for(var A=x;A<u;++A)for(var p=0;3>p;++p)y=Math.max(r[3*A+p],y);u=65535>=y?new Uint16Array(3*E):new Uint32Array(3*E);for(y=0;y<E;++y)for(A=3*(t[y]+x),p=0;3>p;++p)u[3*y+p]=
r[A+p];return u}let d=function(t,r,x,u,E){this.aabb=t;this.axis=r;this.d=x;this.midStartIndex=u;this.rightStartIndex=E},m=function(){function t(x,u,E,y){this.globalTriangleVertexIndices=x;this.firstTriangleIndex=u;this.positionAttribute=y;this.rayDirection=c.create();this.bspNodeTree=[];this.vertexPositionBuffer=y.data;this.vertexPositionStride=y.stride;const A=E-u,p=65535>=A?new Uint16Array(A):new Uint32Array(A);this.indices=p;for(let B=0;B<A;++B)p[B]=B;{const B=k(x,u,E,y.data,y.stride),D=(C,F,G)=>
{var L=f(p,B,C,F);const H=F-C;if(20>=H)return C=new d(L,void 0,0,C,F),this.bspNodeTree.push(C),C;const {axis:M,midValue:K}=l(L),I=n(p,B,C,F,M,K),O=(Q,J)=>{if(!(15<G)){var P=J-Q;if(!(20>P||P>=.8*H))return D(Q,J,G+1)}};L=new d(L,M,K,I.next,I.mid);this.bspNodeTree.push(L);L.leftNode=O(C,I.next);L.rightNode=O(I.mid,F);return L};D(0,A,0);this.triangleVertexIndices=e(p,x,u,E)}}var r=t.prototype;r.intersectRayTriangleRange=function(x,u){{if(x>=u)return;const I=this.triangleVertexIndices,O=this.positionAttribute.data,
Q=this.positionAttribute.stride;var E=this.rayOrigin;const J=E[0],P=E[1];E=E[2];var y=this.rayDirection;const N=y[0],R=y[1];y=y[2];for(let S=x,T=3*x;S<u;++S){var A=I[T]*Q,p=O[A],B=O[A+1],D=O[A+2],C=I[T+1]*Q;A=O[C];var F=O[C+1];C=O[C+2];var G=I[T+2]*Q,L=O[G],H=O[G+1];G=O[G+2];T+=3;A-=p;F-=B;C-=D;L-=p;H-=B;G-=D;var M=R*G-H*y,K=y*L-G*N;const V=N*H-L*R,W=A*M+F*K+C*V;if(!(Math.abs(W)<=Number.EPSILON)){p=J-p;B=P-B;D=E-D;M=p*M+B*K+D*V;if(0<W){if(0>M||M>W)continue}else if(0<M||M<W)continue;K=B*C-F*D;D=D*
A-C*p;B=p*F-A*B;p=N*K+R*D+y*B;if(0<W){if(0>p||M+p>W)continue}else if(0<p||M+p<W)continue;B=(L*K+H*D+G*B)/W;0<=B&&(D=this.indices[S]+this.firstTriangleIndex,A=h.computeNormal(A,F,C,L,H,G,z),this.callback(B,A,D,!1))}}}t.numFacesTested+=u-x};r.intersectRay=function(x,u){t.numFacesTested=0;var E=c.fromValues(x.r0[0],x.r0[1],x.r0[2]),y=c.fromValues(x.r1[0],x.r1[1],x.r1[2]);x=y[0]-E[0];const A=y[1]-E[1];y=y[2]-E[2];1E-6>x*x+A*A+y*y||(this.rayOrigin=E,E=this.rayDirection,E[0]=x,E[1]=A,E[2]=y,E=this.triangleVertexIndices.length/
3,this.callback=u,this.intersectRayBSP(this.bspNodeTree[0],0,E))};r.intersectRayBSP=function(x,u,E){const y=this.rayOrigin,A=this.rayDirection;if(w(x.aabb,y,A)){var p=x.axis,B=x.d;if(y[p]<B||0>A[p]){const D=x.midStartIndex;if(u<D){const C=x.leftNode;void 0!==C?this.intersectRayBSP(C,u,D):this.intersectRayTriangleRange(u,D)}}this.intersectRayTriangleRange(x.midStartIndex,x.rightStartIndex);if(y[p]>B||0<A[p])u=x.rightStartIndex,u<E&&(x=x.rightNode,void 0!==x?this.intersectRayBSP(x,u,E):this.intersectRayTriangleRange(u,
E))}};b._createClass(t,[{key:"estimatedMemoryUsage",get:function(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}]);return t}();m.numFacesTested=0;const z=c.create(),v=[Infinity,Infinity,Infinity],q=[-Infinity,-Infinity,-Infinity];a.ComponentIntersectionData=m;a.componentMinimalSizeForIntersectionData=40;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl":function(){define(["exports","../shading/EvaluateMainLighting.glsl",
"../shading/PhysicallyBasedRenderingParameters.glsl","../shading/Water.glsl","../../shaderModules/interfaces"],function(a,b,c,g,h){a.OverlayMode=void 0;(function(w){w[w.Disabled=0]="Disabled";w[w.Enabled=1]="Enabled";w[w.EnabledWithWater=2]="EnabledWithWater";w[w.COUNT=3]="COUNT"})(a.OverlayMode||(a.OverlayMode={}));a.Overlay=function(w,n){w.extensions.add("GL_OES_standard_derivatives");n.pbrMode!==c.PBRMode.Water&&n.pbrMode!==c.PBRMode.WaterOnIntegratedMesh||w.include(g.Water,n);w.vertex.uniforms.add("overlayTexOffset",
"vec4");w.vertex.uniforms.add("overlayTexScale","vec4");w.varyings.add("vtcOverlay","vec4");w.vertex.code.add(h.glsl`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`);w.fragment.uniforms.add("ovColorTex","sampler2D");w.fragment.uniforms.add("overlayOpacity","float");w.fragment.code.add(h.glsl`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`);w.fragment.code.add(h.glsl`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`);if(n.pbrMode===c.PBRMode.Water||n.pbrMode===c.PBRMode.WaterOnIntegratedMesh)w.include(b.EvaluateMainLighting),w.fragment.code.add(h.glsl`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, lightingMainDirection, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/TerrainTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/terrain/Overlay.glsl ../../../../chunks/Terrain.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t){k=function(r){function x(){var E=r.apply(this,arguments)||this;E.useStencil=!1;return E}c._inheritsLoose(x,r);var u=x.prototype;u.initializeProgram=function(E){var y=x.shader.get();const A=this.configuration;y=y.build({overlayMode:A.overlayMode,output:A.output,viewingMode:E.viewingMode,slicePlaneEnabled:A.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,textureFadingEnabled:A.textureFadingEnabled&&!A.renderOccluded,hasBackgroundColor:A.hasBackgroundColor,
useGrid:A.useGrid,receiveShadows:A.receiveShadows&&!A.renderOccluded,receiveAmbientOcclusion:!1,atmosphere:A.atmosphere,tileBorders:A.tileBorders,screenSizePerspective:A.screenSizePerspective,pbrMode:w.PBRMode.Disabled,ssrEnabled:A.ssrEnabled,highStepCount:!1});return new z.Program(E.rctx,y,m.Default3D)};u.initializePipeline=function(){this._stencilPipelineState=this._createPipeline(!0);return this._createPipeline(!1)};u._createPipeline=function(E){const y=this.configuration,A=y.backfaceCullingEnabled&&
!y.renderOccluded;return t.makePipelineState({blending:y.renderOccluded?t.simpleBlendingParams(q.BlendFactor.ONE,q.BlendFactor.ONE_MINUS_SRC_ALPHA):null,culling:A&&t.backFaceCullingParams,depthTest:!y.renderOccluded&&{func:q.CompareFunction.LESS},depthWrite:!y.renderOccluded&&t.defaultDepthWriteParams,colorWrite:t.defaultColorWriteParams,stencilTest:E?v.renderWhenBitIsNotSet(d.StencilBits.IntegratedMeshMaskExcluded):null})};u.getPipelineState=function(E,y){return this.useStencil?this._stencilPipelineState:
r.prototype.getPipelineState.call(this,E,y)};return x}(k.ShaderTechnique);k.shader=new l.ReloadableShaderModule(f.TerrainShader,()=>new Promise((r,x)=>a(["../core/shaderLibrary/terrain/Terrain.glsl"],r,x)));f=function(r){function x(){var u=r.apply(this,arguments)||this;u.output=h.ShaderOutput.Color;u.overlayMode=n.OverlayMode.Disabled;u.atmosphere=!1;u.receiveShadows=!1;u.slicePlaneEnabled=!1;u.backfaceCullingEnabled=!1;u.stencilEnabled=!1;u.textureFadingEnabled=!1;u.hasBackgroundColor=!1;u.useGrid=
!1;u.renderOccluded=!1;u.ssrEnabled=!1;u.tileBorders=!1;u.screenSizePerspective=!1;return u}c._inheritsLoose(x,r);return x}(e.ShaderTechniqueConfiguration);g.__decorate([e.parameter({count:h.ShaderOutput.COUNT})],f.prototype,"output",void 0);g.__decorate([e.parameter({count:n.OverlayMode.COUNT})],f.prototype,"overlayMode",void 0);g.__decorate([e.parameter()],f.prototype,"atmosphere",void 0);g.__decorate([e.parameter()],f.prototype,"receiveShadows",void 0);g.__decorate([e.parameter()],f.prototype,
"slicePlaneEnabled",void 0);g.__decorate([e.parameter()],f.prototype,"backfaceCullingEnabled",void 0);g.__decorate([e.parameter()],f.prototype,"stencilEnabled",void 0);g.__decorate([e.parameter()],f.prototype,"textureFadingEnabled",void 0);g.__decorate([e.parameter()],f.prototype,"hasBackgroundColor",void 0);g.__decorate([e.parameter()],f.prototype,"useGrid",void 0);g.__decorate([e.parameter()],f.prototype,"renderOccluded",void 0);g.__decorate([e.parameter()],f.prototype,"ssrEnabled",void 0);g.__decorate([e.parameter()],
f.prototype,"tileBorders",void 0);g.__decorate([e.parameter()],f.prototype,"screenSizePerspective",void 0);b.TerrainTechnique=k;b.TerrainTechniqueConfiguration=f;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/Terrain.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Skirts.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/HeaderComment.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t){function r(u){const E=new q.ShaderBuilder;E.include(z.HeaderComment,{name:"Terrain Shader",output:u.output});E.include(d.Skirts);E.attributes.add(t.VertexAttribute.POSITION,"vec3");E.attributes.add(t.VertexAttribute.UV0,"vec2");E.vertex.uniforms.add("proj","mat4").add("view","mat4").add("origin","vec3").add("skirtScale","float");E.fragment.uniforms.add("origin","vec3");if(u.output===b.ShaderOutput.Color){E.include(g.Transform,{linearDepth:!1});E.include(l.NormalUtils,
u);E.include(m.TerrainTexture,u);E.include(f.EvaluateSceneLighting,u);const y=u.overlayMode!==e.OverlayMode.Disabled,A=u.overlayMode===e.OverlayMode.EnabledWithWater;y&&E.include(e.Overlay,{pbrMode:k.PBRMode.Water,useCustomDTRExponentForWater:!1,ssrEnabled:u.ssrEnabled,highStepCount:u.highStepCount});A&&E.include(h.VertexTangent,u);E.varyings.add("vnormal","vec3");E.varyings.add("vpos","vec3");E.vertex.uniforms.add("viewNormal","mat4");u.receiveShadows&&E.varyings.add("linearDepth","float");u.tileBorders&&
E.varyings.add("vuv","vec2");u.atmosphere&&(E.vertex.uniforms.add("lightingMainDirection","vec3"),E.varyings.add("wnormal","vec3"),E.varyings.add("wlight","vec3"));u.screenSizePerspective&&(E.vertex.uniforms.add("screenSizePerspective","vec4"),E.varyings.add("screenSizeDistanceToCamera","float"),E.varyings.add("screenSizeCosAngle","float"));E.vertex.code.add(v.glsl`
      void main(void) {
        vpos = position;
        vnormal = getLocalUp(vpos, origin);

        vec2 uv = uv0;
        vpos = applySkirts(uv, vpos, vnormal, skirtScale);
        ${u.atmosphere?v.glsl`
        wnormal = normalize((viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz);
        wlight = normalize((view  * vec4(lightingMainDirection, 1.0)).xyz);`:""}
        ${u.tileBorders?v.glsl`vuv = uv;`:""}
        ${u.screenSizePerspective?v.glsl`
        vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
        screenSizeDistanceToCamera = length(viewPos);
        vec3 viewSpaceNormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;
        screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}
        gl_Position = transformPosition(proj, view, vpos);
        ${u.receiveShadows?v.glsl`linearDepth = gl_Position.w;`:""}
        forwardTextureCoordinates(uv);
        ${y?v.glsl`setOverlayVTC(uv);`:""}
        ${A?v.glsl`forwardVertexTangent(vnormal);`:v.glsl``}
      }
    `);E.extensions.add("GL_OES_standard_derivatives");E.extensions.add("GL_EXT_shader_texture_lod");E.include(c.Slice,u);E.include(f.EvaluateSceneLighting,u);E.fragment.uniforms.add("cameraPosition","vec3").add("viewDirection","vec3").add("ssaoTex","sampler2D").add("viewportPixelSz","vec4");u.screenSizePerspective&&E.fragment.uniforms.add("screenSizePerspective","vec4");A&&(E.fragment.uniforms.add("ovWaterTex","sampler2D"),E.fragment.uniforms.add("view","mat4"));E.fragment.code.add(v.glsl`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`);E.fragment.code.add(v.glsl`
      void main() {
        ${u.receiveShadows?v.glsl`float shadow = readShadowMap(vpos, linearDepth);`:v.glsl`float shadow = 0.0;`}
        float vndl = dot(normalize(vnormal), lightingMainDirection);

        float ssao = viewportPixelSz.w < .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
        vec4 tileColor = getTileColor();
        ${y?v.glsl`
            vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
            vec4 overlayColor = overlayOpacity * overlayColorOpaque;
            vec4 groundColor = tileColor;
            tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}
        if (rejectBySlice(vpos)) {
          tileColor *= sliceOpacity;
        }
        ${u.atmosphere?v.glsl`
            float ndotl = clamp(vndl, 0.0, 1.0);
            vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
            atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); //avoid atmosphere on bright base maps
            atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
            atm *= tileColor.a; // premultiply with tile alpha`:""}

        vec3 albedo = ${u.atmosphere?v.glsl`atm + tileColor.rgb;`:v.glsl`tileColor.rgb;`}
        vec3 normal = normalize(vnormal);

        // heuristic shading function used in the old terrain, now used to add ambient lighting
        float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);
        ${A?v.glsl`
            vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
            float waterNormalLength = length(overlayWaterMask);
            if (waterNormalLength > 0.95) {
              mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
              vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
              vec4 viewPosition = view*vec4(vpos, 1.0);
              vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + origin);
              vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
              // un-gamma the ground color to mix in linear space
              gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w);
            }`:""}
        ${u.screenSizePerspective?v.glsl`
          float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);
          if (perspectiveScale <= 0.25) {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
          }
          else if (perspectiveScale <= 0.5) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
          }
          else if (perspectiveScale >= 0.99) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
          }
          else {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
          }`:""}
        ${u.tileBorders?v.glsl`
            vec2 dVuv = fwidth(vuv);
            vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));
            float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
      }
    `)}if(u.output===b.ShaderOutput.Depth||u.output===b.ShaderOutput.Shadow)E.include(g.Transform,{linearDepth:!0}),E.include(w.OutputDepth,{output:u.output}),E.include(l.NormalUtils,u),E.varyings.add("linearDepth","float"),E.vertex.uniforms.add("nearFar","vec2"),E.vertex.code.add(v.glsl`void main(void) {
vec3 normal = getLocalUp(position, origin);
vec2 uv = uv0;
vec3 vpos = applySkirts(uv, position, normal.xyz, skirtScale);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);
}`),E.fragment.code.add(v.glsl`void main() {
outputDepth(linearDepth);
}`);u.output===b.ShaderOutput.Normal&&(E.include(g.Transform,{linearDepth:!1}),E.include(l.NormalUtils,u),E.varyings.add("vnormal","vec3"),E.varyings.add("vpos","vec3"),E.vertex.uniforms.add("viewNormal","mat4"),E.vertex.code.add(v.glsl`void main(void) {
vec3 normal = getLocalUp(position, origin);
vec2 uv = uv0;
vpos = applySkirts(uv, position, normal, skirtScale);
gl_Position = transformPosition(proj, view, vpos);
vnormal = normalize((viewNormal * vec4(normal, 1.0)).xyz);
}`),E.fragment.code.add(v.glsl`void main() {
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) {
normal = -normal;
}
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
}`));u.output===b.ShaderOutput.Highlight&&(E.include(g.Transform,{linearDepth:!1}),E.include(l.NormalUtils,u),E.include(e.Overlay,{pbrMode:k.PBRMode.Disabled}),E.vertex.code.add(v.glsl`void main() {
vec3 vnormal = getLocalUp(position, origin);
vec2 uv = uv0;
vec3 vpos = applySkirts(uv, position, vnormal, skirtScale);
setOverlayVTC(uv);
gl_Position = transformPosition(proj, view, vpos);
}`),E.include(n.OutputHighlight),E.fragment.code.add(v.glsl`void main() {
vec4 overlayColor = getCombinedOverlayColor();
if (overlayColor.a == 0.0) {
gl_FragColor = vec4(0.0);
return;
}
outputHighlight();
}`));return E}const x=Object.freeze({__proto__:null,build:r});a.TerrainShader=x;a.build=r})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl":function(){define(["exports","../../../../../ViewingMode","../../shaderModules/interfaces"],function(a,b,c){a.VertexTangent=function(g,h){g.varyings.add("tbnTangent","vec3");g.varyings.add("tbnBiTangent","vec3");h.viewingMode===b.ViewingMode.Global?g.vertex.code.add(c.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):g.vertex.code.add(c.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`);g.fragment.code.add(c.glsl`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Skirts.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.Skirts=function(c){c.vertex.code.add(b.glsl`vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal, float skirtScale) {
float skirtLength = 0.0;
if (uv.x >= 2.0) {
skirtLength = uv.y * skirtScale;
vec2 x = vec2(uv.x) - vec2(3.5, 4.5);
uv = clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));
}
return vpos - vnormal * skirtLength;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.TerrainTexture=function(c,g){c.varyings.add("vtc","vec2");c.vertex.uniforms.add("texOffsetAndScale","vec4");c.fragment.uniforms.add("tex","sampler2D");c.fragment.uniforms.add("textureOpacities","vec3");g.textureFadingEnabled&&(c.vertex.uniforms.add("nextTexOffsetAndScale","vec4"),c.varyings.add("nvtc",
"vec2"),c.fragment.uniforms.add("texNext","sampler2D"),c.fragment.uniforms.add("nextTexOpacities","vec3"),c.fragment.uniforms.add("fadeFactor","float"));c.vertex.code.add(b.glsl`
  void forwardTextureCoordinates(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${g.textureFadingEnabled?b.glsl`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:b.glsl``}
  }`);g.useGrid?(c.fragment.code.add(b.glsl`float lineFactorAtPosition(float value) {
float pos = value * 129.0;
if(pos < 0.5 || pos > 128.5) {
return 1.0;
}
pos = pos + 0.5;
float modulo = mod(pos, 16.0);
return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
}
float lineFactorAtUV(vec2 uv) {
return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
}
float lineFactor(vec2 uv) {
vec2 offset = fwidth(uv) * 0.25;
return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
}
vec4 gridColor(vec2 uv) {
float line = lineFactor(uv) * 0.1 + 0.9;
float backgroundOpacity = textureOpacities.y;
return vec4(1.0, 0.972, 0.918, 1.0) * line * backgroundOpacity;
}`),c.fragment.code.add(b.glsl`vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
if (opacities.y <= 0.0) {
return color * opacities.z * opacities.x;
}
vec4 grid = gridColor(uv);
float alpha = opacities.z * color.a;
return mix(grid, color, alpha) * opacities.x;
}`)):g.hasBackgroundColor?(c.fragment.uniforms.add("backgroundColor","vec3"),c.fragment.code.add(b.glsl`vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
if (opacities.y <= 0.0) {
return color * opacities.z * opacities.x;
}
float alpha = opacities.z * color.a;
float backgroundOpacity = opacities.y;
return mix(vec4(backgroundColor, 1.0) * backgroundOpacity, color, alpha) * opacities.x;
}`)):c.fragment.code.add(b.glsl`vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
return color;
}`);g.textureFadingEnabled?c.fragment.code.add(b.glsl`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):c.fragment.code.add(b.glsl`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/TerrainSurfacePerformanceInfo":function(){define(function(){return function(){this.numMerged=this.numSplit=this.numRendered=this.numVisible=this.numLeaves=this.numNodes=0;this.numRenderedPerLevel=[];this.numLoadedPerLevel=[]}})},"esri/views/3d/terrain/TilingSchemeLogic":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../../../layers/support/layerUtils ../../ViewingMode ./terrainUtils ./TilingScheme".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r){a.TilingSchemeLogic=function(x){function u(y){y=x.call(this,y)||this;y._handles=new h;return y}b._inheritsLoose(u,x);var E=u.prototype;E.initialize=function(){this._handles.add(this.layers.on("change",()=>this._update()));this._handles.add(this.extentHelper.watch("layerViewsExtent",()=>this._setAdHocTilingScheme()));this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()};E.destroy=function(){this._handles=w.destroyMaybe(this._handles);this._waitTask=
null};E._update=function(){this._waitTask=null;if(!this.tilingSchemeLocked){var y;this.layers.some(p=>!v.isTiledLayer(p)||p.isRejected()?!1:!p.isFulfilled()||w.isSome(t.getTiledLayerInfo(p,this.viewSpatialReference,this.viewingMode))?(y=p,!t.isVectorTileLayer(p)&&!t.isProjectableRasterLayer(p)):!1);if(y)if(y.isResolved()){var A=t.getTiledLayerInfo(y,this.viewSpatialReference,this.viewingMode);w.isSome(A)&&(A=new r.default(A.tileInfo),this._lockTilingScheme(A))}else this._updateWhen(y)}};E._updateWhen=
function(y){const A=y.when().catch(()=>{}).then(()=>{A!==this._waitTask||this.destroyed||this._update()});this._waitTask=A};E._lockTilingScheme=function(y){if(this.viewingMode===q.ViewingMode.Global){const A=y.levels.length-1;y.spatialReference.isWebMercator?y=r.default.makeWebMercatorAuxiliarySphere(A):d.canProjectToWGS84ComparableLonLat(y.spatialReference)&&(y=r.default.makeGCSWithTileSize(y.spatialReference,y.pixelSize,A))}this.tilingSchemeLocked=!0;this.tilingScheme=y;this.extentHelper.tilingScheme=
this.tilingScheme;this._updateTiledLayerExtent();this._handles.removeAll();this._handles.add(this.extentHelper.watch("tiledLayersExtent",()=>this._updateTiledLayerExtent()))};E._updateTiledLayerExtent=function(){this._set("extent",this.extentHelper.tiledLayersExtent)};E._setAdHocTilingScheme=function(){if(this.viewingMode===q.ViewingMode.Global){var y=this.extentHelper.viewSpatialReference;const A=d.canProjectToWGS84ComparableLonLat(y)||z.isMars(y)||z.isMoon(y);y.isWebMercator?this.tilingScheme=r.default.WebMercatorAuxiliarySphere:
A&&(this.tilingScheme=r.default.makeGCSWithTileSize(y,256));this._set("extent",this.extentHelper.layerViewsExtent)}else y=this.extentHelper.layerViewsExtent,w.isSome(y)&&!m.equals(y,this.extent)&&(this.tilingScheme=r.default.fromExtent(y,this.extentHelper.viewSpatialReference),this._set("extent",y))};b._createClass(u,[{key:"test",get:function(){return{lockTilingScheme:y=>this._lockTilingScheme(y),done:!this._waitTask}}}]);return u}(g);c.__decorate([n.property()],a.TilingSchemeLogic.prototype,"tilingScheme",
void 0);c.__decorate([n.property({readOnly:!0})],a.TilingSchemeLogic.prototype,"extent",void 0);c.__decorate([n.property({value:!1})],a.TilingSchemeLogic.prototype,"tilingSchemeLocked",void 0);c.__decorate([n.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"viewSpatialReference",void 0);c.__decorate([n.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"layers",void 0);c.__decorate([n.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"extentHelper",void 0);c.__decorate([n.property({constructOnly:!0})],
a.TilingSchemeLogic.prototype,"viewingMode",void 0);a.TilingSchemeLogic=c.__decorate([e.subclass("esri.views.3d.terrain.TilingSchemeLogic")],a.TilingSchemeLogic);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["exports","../../../chunks/vec2f64"],function(a,b){let c=function(){function g(){this.offset=b.create();this.scale=0;this.tile=null}var h=g.prototype;h.init=function(w,n,f,l){this.tile=w;this.offset[0]=n;this.offset[1]=f;this.scale=
l};h.dispose=function(){this.tile=null;this.offset[0]=0;this.scale=this.offset[1]=0};return g}();a.UpsampleInfo=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/Stage":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/PooledArray ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../state/helpers/SceneIntersectionHelper ./lib/AutoDisposable ./lib/basicInterfaces ./lib/ChangeSet ./lib/GeometryRecord ./lib/WebGLLayer ./parts/Model ./parts/RenderView ../../support/Scheduler".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y){var A;a.Stage=A=function(p){function B(C){C=p.call(this,C)||this;C._handles=new h;C._model=new u.Model;C._layers=new n;C._changeSet=new t.ChangeSet;C._layerSyncSet=new Set;return C}b._inheritsLoose(B,p);var D=B.prototype;D.initialize=function(){this._set("renderView",new E.RenderView(this));this._frameTask=this.resourceController.scheduler.registerTask(y.TaskPriority.STAGE,this);this._handles.add(this._frameTask)};D.destroy=function(){r.GeometryRecord.pool.prune(0);
this._handles.destroy();this.dispose()};D.add=function(C){this._model.add(C);x.isWebGLLayer(C)&&(C.attachStage(this),this._addLayer(C));this.renderView.requestRender()};D.remove=function(C){w.isNone(C)||(this.renderView.requestRender(),this._model.remove(C),x.isWebGLLayer(C)&&(this._removeLayer(C),C.detachStage()))};D.addMany=function(C){w.isSome(C)&&(this._model.addMany(C),this.renderView.requestRender())};D.removeMany=function(C){w.isSome(C)&&(this._model.removeMany(C),this.renderView.requestRender())};
D.load=function(){var C=b._asyncToGenerator(function*(F){w.isNone(F)||(Array.isArray(F)||(F=[F]),yield f.all(F.filter(G=>w.isNone(G.glTexture)).map(G=>this.schedule(()=>this._model.has(G)?G.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique):null))))});return function(F){return C.apply(this,arguments)}}();D.loadImmediate=function(C){return C.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)};D.forEachOfType=function(C,
F){this._model.forEachOfType(C,F)};D.handleEvent=function(C,F){this.destroyed||(this._model.dirtySet[C](F),this.renderView.requestRender())};D.runTask=function(C){this._frameTask.processQueue(C);C.done||this._commit()};D._commit=function(){const C=this._model.dirtySet;A.DebugSettings.logDirtySet&&console.log("Dirty set: "+C.formatDebugInfo());C.commit(this._changeSet);A.DebugSettings.logDirtySet&&(console.log("RGs add: "+this._changeSet.adds.map(F=>F.id)),console.log("RGs remove: "+this._changeSet.removes.map(F=>
F.id)));this._layerSyncSet.clear();this.renderView.modify(this._changeSet);this.renderView.requestRender()};D.schedule=function(C,F){return this._frameTask.schedule(C,F)};D.syncLayer=function(C){this._layerSyncSet.add(C);this.renderView.requestRender()};D.processSyncLayers=function(){const C=this._model.dirtySet;this._layers.forAll(F=>{if(this._layerSyncSet.has(F.id)||F.updatePolicy===q.UpdatePolicy.SYNC)C.commitLayer(F.id,this._changeSet),this._layerSyncSet.delete(F.id)});for(const F of this._layerSyncSet)C.commitLayer(F,
this._changeSet);this._layerSyncSet.clear();this.renderView.modify(this._changeSet)};D.getObject=function(C){return this._model.getObject(C)};D._addLayer=function(C){this._layers.some(F=>F===C)||this._layers.push(C)};D._removeLayer=function(C){this._commit();null!=this._layers.removeUnordered(C)&&(this._model.dirtySet.getResidentRenderGeometries(C.id,this._changeSet.removes),this.renderView.modify(this._changeSet))};D.addRenderPlugin=function(C,F,G){C=this.renderView.renderPlugins.add(C,F,G);G=()=>
{z.isIntersectionHandler(F)&&this.sceneIntersectionHelper.addIntersectionHandler(F)};if(f.isPromiseLike(C))return C.then(G);G()};D.removeRenderPlugin=function(C){z.isIntersectionHandler(C)&&this.sceneIntersectionHelper.removeIntersectionHandler(C);this.renderView.renderPlugins.remove(C)};b._createClass(B,[{key:"viewingMode",get:function(){return this.state.viewingMode}},{key:"updating",get:function(){return this._model.dirtySet.dirty||this.renderView.updating||this._frameTask.updating}},{key:"running",
get:function(){return this._model.dirtySet.dirty}},{key:"layers",get:function(){return this._layers}},{key:"performanceInfo",get:function(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}},{key:"test",get:function(){const C=this;return{getCount(F){return C._model.test.content.filter(G=>G.type===F).length},model:C._model}}}]);return B}(v.AutoDisposableMixin(g));a.Stage.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1};c.__decorate([l.property({constructOnly:!0})],
a.Stage.prototype,"resourceController",void 0);c.__decorate([l.property({constructOnly:!0})],a.Stage.prototype,"options",void 0);c.__decorate([l.property({constructOnly:!0})],a.Stage.prototype,"state",void 0);c.__decorate([l.property({constructOnly:!0})],a.Stage.prototype,"sceneIntersectionHelper",void 0);c.__decorate([l.property({readOnly:!0})],a.Stage.prototype,"viewingMode",null);c.__decorate([l.property({constructOnly:!0})],a.Stage.prototype,"container",void 0);c.__decorate([l.property({constructOnly:!0})],
a.Stage.prototype,"renderSR",void 0);c.__decorate([l.property({constructOnly:!0})],a.Stage.prototype,"_handles",void 0);c.__decorate([l.property({readOnly:!0})],a.Stage.prototype,"updating",null);c.__decorate([l.property({constructOnly:!0})],a.Stage.prototype,"_model",void 0);c.__decorate([v.autoDispose(),l.property()],a.Stage.prototype,"renderView",void 0);a.Stage=A=c.__decorate([m.subclass("esri.views.3d.webgl-engine.Stage")],a.Stage);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/parts/Model":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../lib/ContentObjectType ../lib/GridLocalOriginFactory ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util ../lib/WebGLLayer".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q){a.Model=function(t){function r(){var u=t.apply(this,arguments)||this;u.dirtySet=new m({model:b._assertThisInitialized(u)});u._content=new Map;u._originFactory=new d.GridLocalOriginFactory(null,75E4);return u}b._inheritsLoose(r,t);var x=r.prototype;x.getObject=function(u){return this._content.get(u)};x.add=function(u){const E=u.id;v.assert(!this._content.has(E),"Model/Stage already contains object to be added");this._content.set(E,u);q.isWebGLLayer(u)&&this.dirtySet.layerAdded(u)};
x.remove=function(u){v.assert(this._content.has(u.id),"Model/Stage doesn't contain object to be removed");this._content.delete(u.id);u.unload();q.isWebGLLayer(u)&&this.dirtySet.layerRemoved(u)};x.addMany=function(u){for(const E of u)h.isSome(E)&&(v.assert(!this._content.has(E.id),"Model/Stage already contains object to be added"),this._content.set(E.id,E))};x.removeMany=function(u){for(const E of u)v.assert(this._content.has(E.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(E.id),
E.unload()};x.has=function(u){return this._content.has(u.id)};x.forEachOfType=function(u,E){this._content.forEach(y=>{y.type===u&&E(y)})};x.getRenderGeometry=function(u,E){const {geometry:y,material:A,id:p,shaderTransformation:B,origin:D,instanceParameters:C}=E,F=new z.RenderGeometry(y,A,{id:p,boundingInfo:y.boundingInfo,calculateShaderTransformation:B,castShadow:u.castShadow});F.updateTransformation(G=>u.getCombinedStaticTransformation(E,G));F.origin=D||this._originFactory.getOrigin(F.boundingSphere);
F.instanceParameters=C;return F};x.updateRenderGeometryTransformation=function(u,E,y){if(h.isNone(u))return!1;y.updateTransformation(p=>u.getCombinedStaticTransformation(E,p));const A=this._originFactory.getOrigin(y.boundingSphere);return y.origin!==A};x.getStats=function(){const u={},E=Array.from(this._content.values());for(let y=0;y<e.ContentObjectType.COUNT;++y)u[y]=E.filter(A=>A.type===y).length;return{contentTypes:u,dirtySet:this.dirtySet.formatDebugInfo()}};b._createClass(r,[{key:"test",get:function(){return{content:Array.from(this._content.values())}}}]);
return r}(g);c.__decorate([w.property({constructOnly:!0})],a.Model.prototype,"dirtySet",void 0);a.Model=c.__decorate([k.subclass("esri.views.3d.webgl-engine.parts.Model")],a.Model);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/MapUtils ../../../../core/maybe ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./GeometryRecord ./ModelDirtyTypes ./Util".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z){c=function(v){function q(r){r=v.call(this,r)||this;r._residentGeomRecords=new Map;r._dirtyGeomRecords=new Map;r.dirty=!1;return r}a._inheritsLoose(q,v);var t=q.prototype;t.commit=function(r){this.dirty=!1;this._dirtyGeomRecords.forEach((x,u)=>this.commitLayer(u,r))};t.commitLayer=function(r,x){const u=this._dirtyGeomRecords.get(r);u&&(u.forEach((E,y)=>{const A=this._ensureGeomRecord(r,y);E.forEach((p,B)=>{var D=p[0],C=p[1],F=p[2];p=!1;if(C&m.ModelDirty.Geometry.UPDATE){var G=
A.get(B);if(G){G=G[1];if(F&m.ModelDirty.State.TRANSFORMATION){const L=this.model.getObject(y);this.model.updateRenderGeometryTransformation(L,D,G)&&(p=!0)}p||x.updates.push({renderGeometry:G,updateType:F})}else z.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(C&m.ModelDirty.Geometry.REMOVE||p)(F=A.get(B))?(x.removes.push(F[1]),A.delete(B),F[0].disposed&&d.GeometryRecord.pool.release(F[0])):C===m.ModelDirty.Geometry.REMOVE&&z.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove");
if(C&m.ModelDirty.Geometry.ADD||p)C=this.model.getObject(y),h.isSome(C)&&(C=this.model.getRenderGeometry(C,D),D=[D,C],x.adds.push(C),A.set(B,D))});0===A.size&&this._residentGeomRecords.get(r).delete(y)}),0===this._residentGeomRecords.get(r).size&&this._residentGeomRecords.delete(r),this._dirtyGeomRecords.delete(r))};t.getResidentRenderGeometries=function(r,x){(r=this._residentGeomRecords.get(r))&&r.forEach(u=>u.forEach(E=>x.push(E[1])))};t._objectStateChanged=function(r,x){for(const u of x.geometryRecords)this._updateOrCreateDirtyRecord(x,
u,null,m.ModelDirty.Geometry.UPDATE,0,0,m.ModelDirty.Geometry.UPDATE,m.ModelDirty.Geometry.ADD|m.ModelDirty.Geometry.REMOVE,r)};t.visibilityChanged=function(r){this._objectStateChanged(m.ModelDirty.State.VISIBILITIES,r)};t.highlightChanged=function(r){this._objectStateChanged(m.ModelDirty.State.HIGHLIGHTS,r)};t.occlusionChanged=function(r){this._objectStateChanged(m.ModelDirty.State.OCCLUDEES,r)};t.vertexAttrsUpdated=function(r){this._updateOrCreateDirtyRecord(r.object,r.record,null,m.ModelDirty.Geometry.UPDATE,
0,0,m.ModelDirty.Geometry.UPDATE,m.ModelDirty.Geometry.ADD|m.ModelDirty.Geometry.REMOVE,m.ModelDirty.State.VERTEXATTRS)};t.layerAdded=function(r){r.objects.forAll(x=>this._layerObjectAdded(r,x))};t.layerRemoved=function(r){r.objects.forAll(x=>this._layerObjectRemoved(r,x))};t.layerObjectAdded=function(r){this._layerObjectAdded(r.layer,r.object)};t._layerObjectAdded=function(r,x){r=r.id;for(const u of x.geometryRecords)this._objectGeometryAdded(x,u,r)};t.layerObjectRemoved=function(r){this._layerObjectRemoved(r.layer,
r.object)};t.layerObjectsAdded=function(r){for(const x of r.objects)this._layerObjectAdded(r.layer,x)};t.layerObjectsRemoved=function(r){for(const x of r.objects)this._layerObjectRemoved(r.layer,x)};t._layerObjectRemoved=function(r,x){r=r.id;for(const u of x.geometryRecords)this._objectGeometryRemoved(x,u,r)};t.shaderTransformationChanged=function(r){(r=this._residentGeomRecords.get(r.id))&&r.forEach((x,u)=>{(u=this.model.getObject(u))&&u.hasVolativeTransformation()&&x.forEach(E=>{E[1].shaderTransformationChanged()})})};
t.objectTransformation=function(r){const x=this._getParentLayerId(r);this._ensureGeomRecord(x,r.id).forEach(u=>{this._updateOrCreateDirtyRecord(r,u[0],x,m.ModelDirty.Geometry.UPDATE,0,0,m.ModelDirty.Geometry.UPDATE,m.ModelDirty.Geometry.ADD|m.ModelDirty.Geometry.REMOVE,m.ModelDirty.State.TRANSFORMATION)})};t.objectGeometryAdded=function(r){this._objectGeometryAdded(r.object,r.record)};t._objectGeometryAdded=function(r,x,u=null){this._updateOrCreateDirtyRecord(r,x,u,m.ModelDirty.Geometry.ADD,m.ModelDirty.Geometry.REMOVE,
0,0,0)};t.objectGeometryRemoved=function(r){this._objectGeometryRemoved(r.object,r.record)};t._objectGeometryRemoved=function(r,x,u=null){this._updateOrCreateDirtyRecord(r,x,u,m.ModelDirty.Geometry.REMOVE,m.ModelDirty.Geometry.ADD,m.ModelDirty.Geometry.UPDATE,0,0)};t._updateOrCreateDirtyRecord=function(r,x,u,E,y,A,p,B,D){u=h.unwrapOr(u,this._getParentLayerId(r));const C=x.id;r=this._ensureDirtyRecord(u,r.id);(u=r.get(C))?(x=u[1],x&y?(r.delete(C),u[0].disposed&&d.GeometryRecord.pool.release(u[0])):
x&A?(u[1]=E,u[2]=D):x&p?u[2]|=D:x&B||z.assert(!1,"ModelDirtySet.objectGeometryAdded: inconsistent state")):r.set(C,[x,E,D]);this.dirty=this._hasDirtyGeometryRecords};t._ensureGeomRecord=function(r,x){let u=this._residentGeomRecords.get(r);u||(u=new Map,this._residentGeomRecords.set(r,u));r=u.get(x);r||(r=new Map,u.set(x,r));return r};t._ensureDirtyRecord=function(r,x){let u=this._dirtyGeomRecords.get(r);u||(u=new Map,this._dirtyGeomRecords.set(r,u));r=u.get(x);r||(r=new Map,u.set(x,r));return r};
t._getParentLayerId=function(r){return h.isSome(r.parentLayer)?r.parentLayer.id:w.NullUID};t.formatDebugInfo=function(){const r=["ADD","UPD",void 0,"REM"];let x="";this._dirtyGeomRecords.forEach((u,E)=>{u.forEach((y,A)=>{0<x.length&&(x+="\n");x+=E+"."+A;const p=[];y.forEach(B=>{const D=B[1];p[D]||(p[D]=[]);p[D].push(B[0].geometry.id)});for(y=0;y<p.length;y++)if(p[y])for(x+=" "+r[y-1]+": ",A=0;A<p[y].length;A++)x+=p[y][A]+", "})});return x};a._createClass(q,[{key:"_hasDirtyGeometryRecords",get:function(){return g.someMap(this._dirtyGeomRecords,
r=>g.someMap(r,x=>x&&0<x.size))}},{key:"test",get:function(){const r=this;return{get residentLayerCount(){return r._residentGeomRecords.size},get residentObjectCount(){return Array.from(r._residentGeomRecords.values()).reduce((x,u)=>x+u.size,0)}}}}]);return q}(c);b.__decorate([n.property({constructOnly:!0})],c.prototype,"model",void 0);b.__decorate([n.property()],c.prototype,"dirty",void 0);return c=b.__decorate([e.subclass("esri.views.3d.webgl-engine.lib.ModelDirtySet")],c)})},"esri/views/3d/webgl-engine/parts/RenderView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../core/scheduling ../../../../core/time ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../collections/Component/ComponentObjectCollection ../core/shaderTechnique/ShaderTechniqueRepository ../lib/AutoDisposable ../lib/basicInterfaces ../lib/CompositingHelper ../lib/depthRangeUtils ../lib/GLMaterialRepository ../lib/MagnifierHelper ../lib/Renderer ../lib/RenderingContext ../lib/TextureRepository ../materials/StippleTextureRepository ../materials/internal/WaterTextureRepository ./requireUtils ./ScreenshotManager ../../../webgl/context-util".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H){const M=n.getLogger("esri.views.3d.webgl-engine.parts.View");a.RenderView=function(O){function Q(P){var N=O.call(this,{})||this;N.events=new h;N.waterTextureRepository=new F.WaterTextureRepository;N._magnifierHelper=new A.MagnifierHelper;N._needsUpdate=!0;N._needsRender=!0;N._idleSuspend=!0;N._needsWaterReflectionUpdate=!1;N._lastAnimationUpdate=0;N._container=P.container;N._initializeContext(P);e.init(N.waterTextureRepository,
"loadingState",()=>N.requestRender());N._magnifierHelper.events.on("request-render",()=>N.requestRender());N._stippleTextureRepository=new C.StippleTextureRepository(N._rctx);N._shaderTechniqueRepository=new t.ShaderTechniqueRepository({rctx:N._rctx,viewingMode:P.viewingMode,stippleTextureRepository:N._stippleTextureRepository,waterTextureRepository:N.waterTextureRepository});N._textureRepository=new D.TextureRepository(P,N._shaderTechniqueRepository,N._rctx);N._textureRepository.events.on("changed",
R=>N.requestRender(R));N._materialRepository=new y.GLMaterialRepository(N._textureRepository,N._shaderTechniqueRepository,()=>N.requestRender(),()=>N.requestRender());N._compositingHelper=new u(N._rctx,N._shaderTechniqueRepository);N._renderer=new p.Renderer(N._materialRepository,N._textureRepository,N._shaderTechniqueRepository,N._rctx,N._compositingHelper,N._magnifierHelper,R=>N.requestRender(R),(R,S)=>P.schedule(R,S),P);N._screenshotManager=new L.ScreenshotManager(N._rctx,(R,S,T)=>N._renderer.render(R,
S,S,T),R=>N.requestRender(R),P.options.screenshot.renderOverlay,R=>N.events.emit("force-camera-for-screenshot",R),()=>N._renderer.disposeOffscreenBuffers());N._registerFrameTask(P);return N}b._inheritsLoose(Q,O);var J=Q.prototype;J.normalizeCtorArgs=function(){return{}};J.dispose=function(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._frameTask=f.removeMaybe(this._frameTask);this._shaderTechniqueRepository=f.disposeMaybe(this._shaderTechniqueRepository);
O.prototype.dispose.call(this);this._rctx=this._tmpDepthBuffer=null};J.requestRender=function(P=x.RenderRequestType.UPDATE){P===x.RenderRequestType.UPDATE?this._needsUpdate=!0:this._needsRender=!0};J.ensureEdgeView=function(){return this._renderer.ensureEdgeView()};J.updateLightSources=function(P,N,R){this._renderer.updateLightSources(P,N,R);this.requestRender()};J.setRenderParameters=function(P){void 0!==P.idleSuspend&&this._idleSuspend!==!!P.idleSuspend&&(this._idleSuspend=!!P.idleSuspend,this.requestRender());
this._renderer.setRenderParameters(P)};J.modify=function(P){this._renderer.modify(P);P.clear()};J.takeScreenshot=function(P){return this._screenshotManager.takeScreenshot(P)};J.readAccumulatedShadow=function(P){return this._renderer.readAccumulatedShadow(P[0],P[1])};J.getMinimalDepthForArea=function(P,N,R,S,T,V=T){V=S.constrainWindowSize(N,R,T*S.pixelRatio,V*S.pixelRatio);const W=this._ensureDepthBuffer(V);this._renderer.readDepthPixels(S,V[0],V[1],V[2],V[3],W);T=Number.MAX_VALUE;for(let U=0;U<V[2]*
V[3];U++){const aa=E.textureToDepth(4*U,W,S.nearFar);T>aa&&aa!==S.nearFar[0]&&aa!==S.nearFar[1]&&(T=aa)}f.isSome(P)&&(P=P.pickDepth(N*S.pixelRatio,R*S.pixelRatio,S),f.isSome(P)&&T>P&&P!==S.nearFar[0]&&P!==S.nearFar[1]&&(T=P));return T===Number.MAX_VALUE?void 0:T};J._ensureDepthBuffer=function(P){P=4*P[2]*P[3];if(f.isNone(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<P)this._tmpDepthBuffer=new Uint8Array(P);return this._tmpDepthBuffer};J.reloadShaders=function(){var P=b._asyncToGenerator(function*(){G.removeLoadedShaderModules();
yield this._shaderTechniqueRepository.reloadAll();this.requestRender()});return function(){return P.apply(this,arguments)}}();J._registerFrameTask=function(P){const N=P.state,R={viewCamera:N.camera,frameHasDecorations:!1};let S=!1,T=x.RenderRequestType.BACKGROUND,V=!1;this._frameTask=l.addFrameTask({preRender:W=>{S=this.updating;T=this._needsUpdate?x.RenderRequestType.UPDATE:x.RenderRequestType.BACKGROUND;P.processSyncLayers();const U=k.Milliseconds(W.time-this._lastAnimationUpdate);if(U>this.animationTimestep||
f.isSome(this.forcedAnimationTime)||S||this._needsRender)this._renderer.updateAnimation({camera:N.camera,dt:U,forcedTime:this.forcedAnimationTime})&&this.requestRender(x.RenderRequestType.BACKGROUND),this._lastAnimationUpdate=W.time},render:()=>{if((this._needsUpdate||this._needsRender||!this._idleSuspend||!this._renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&0<N.camera.fullWidth&&0<N.camera.fullHeight){const W=this._needsUpdate&&this._idleSuspend&&this._renderer.isCameraFinal;this._needsWaterReflectionUpdate=
this._needsUpdate=this._needsRender=!1;this._renderer.render(null,N.camera,N.contentCamera,x.Decorations.ON);V=!0;W&&this._renderer.hasWaterReflection&&(this.requestRender(x.RenderRequestType.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:()=>{R.viewCamera=N.camera;R.frameHasDecorations=this._renderer.hasSlicePlane||this._magnifierHelper.enabled;this._textureRepository.update();this._screenshotManager.update(R)},finish:()=>{V&&(this._renderer.finish(T),V=!1)}})};J._initializeContext=function(P){const N=
P.options;this._canvas=N.canvas;this._canvas||(this._canvas=document.createElement("canvas"));this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const R=H.createContextOrErrorHTML("3d",this._canvas,{alpha:N.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==N.stencil?!0:N.stencil,powerPreference:"high-performance"});f.isNone(R)?(P=w("esri-force-webgl"),M.error("A WebGL context with the requested version ("+P?P:"automatic) could not be created.")):(this._rctx=
this._newRenderingContext(R,P),this._loadShaderOnlyExtensions(),!N.alpha&&this._rctx.contextAttributes.alpha&&M.error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&11<=w("safari")&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas))};J._newRenderingContext=function(P,N){const R={disabledExtensions:N.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:N.options.debugWebGLExtensions||
{},maxAnisotropy:8},S=(T,V)=>N.resourceController.memoryController.newCache(T,V);if(K.enableContextCache){let T=I.get(P);if(T)return T.configure(R),T.newCache=S,T.ref(),T;T=new B.RenderingContext(P,R,S);I.set(P,T);T.ref();return T}return new B.RenderingContext(P,R,S)};J._loadShaderOnlyExtensions=function(){this._rctx.capabilities.enable("standardDerivatives");this._rctx.capabilities.enable("shaderTextureLOD");this._rctx.capabilities.enable("textureFloat")};b._createClass(Q,[{key:"performanceInfo",
get:function(){const P=this._rctx.gl;return{renderer:this._renderer.performanceInfo,textureMemory:void 0!==P.getUsedTextureMemory?P.getUsedTextureMemory():void 0,renderbufferMemory:void 0!==P.getUsedRenderbufferMemory?P.getUsedRenderbufferMemory():void 0,VBOMemory:void 0!==P.getUsedVBOMemory?P.getUsedVBOMemory():void 0}}},{key:"updating",get:function(){return this._needsUpdate||this._needsWaterReflectionUpdate||this._renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||
this._magnifierHelper.updating}},{key:"edgeView",get:function(){return this._renderer.edgeView}},{key:"textureRepository",get:function(){return this._textureRepository}},{key:"compositingHelper",get:function(){return this._compositingHelper}},{key:"magnifier",set:function(P){this._magnifierHelper.magnifier=P}},{key:"renderingContext",get:function(){return this._rctx}},{key:"capabilities",get:function(){return this._rctx.capabilities}},{key:"canvas",get:function(){return this._canvas}},{key:"hasShadowsEnabled",
get:function(){return this._renderer.hasShadowsEnabled}},{key:"renderPlugins",get:function(){return this._renderer.renderPlugins}},{key:"test",get:function(){return{renderer:this._renderer}}},{key:"gpuMemoryUsage",get:function(){return this._renderer.gpuMemoryUsage}},{key:"animationTimestep",get:function(){return this._renderer.animationTimestep}},{key:"componentObjectCollection",get:function(){f.isNone(this._componentObjectCollection)&&(this._componentObjectCollection=new q.ComponentObjectCollection(this._renderer.renderPassManager));
return this._componentObjectCollection},set:function(P){this._componentObjectCollection=P}}]);return Q}(r.AutoDisposableMixin(g));c.__decorate([d.property({type:Boolean,readOnly:!0})],a.RenderView.prototype,"updating",null);c.__decorate([r.autoDispose()],a.RenderView.prototype,"_rctx",void 0);c.__decorate([r.autoDispose()],a.RenderView.prototype,"_container",void 0);c.__decorate([r.autoDispose()],a.RenderView.prototype,"_canvas",void 0);c.__decorate([r.autoDispose()],a.RenderView.prototype,"_stippleTextureRepository",
void 0);c.__decorate([r.autoDispose(),d.property()],a.RenderView.prototype,"waterTextureRepository",void 0);c.__decorate([r.autoDispose(),d.property()],a.RenderView.prototype,"_magnifierHelper",void 0);c.__decorate([r.autoDispose(),d.property()],a.RenderView.prototype,"_textureRepository",void 0);c.__decorate([r.autoDispose()],a.RenderView.prototype,"_compositingHelper",void 0);c.__decorate([r.autoDispose()],a.RenderView.prototype,"_renderer",void 0);c.__decorate([r.autoDispose()],a.RenderView.prototype,
"_screenshotManager",void 0);c.__decorate([r.autoDispose()],a.RenderView.prototype,"componentObjectCollection",null);c.__decorate([r.autoDispose()],a.RenderView.prototype,"_componentObjectCollection",void 0);c.__decorate([d.property()],a.RenderView.prototype,"_needsUpdate",void 0);c.__decorate([d.property()],a.RenderView.prototype,"_needsWaterReflectionUpdate",void 0);a.RenderView=c.__decorate([v.subclass("esri.views.3d.webgl-engine.parts.RenderView")],a.RenderView);const K={enableContextCache:!1,
disposeContextCache:()=>{I.forEach(O=>O.dispose());I.clear()}},I=new Map;a.test=K;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObjectCollection":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/vec4 ../../../../../chunks/vec4f32 ../../../layers/support/symbolColorUtils ../../../support/orientedBoundingBox ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ./ComponentData ./ComponentObject ./interface ./IntersectionGeometry ./Renderable ./RenderGeometry ./RenderSubmitSystem ./SourceGeometry ./Material/ComponentMaterial ./Material/ComponentTechnique ../../core/util/TwoVectorPosition ../../lib/ComponentUtils ../../lib/Util ../../lib/VertexAttribute ../../lib/TextureBackedBuffer/BufferManager ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H,M,K){function I(R,S){return R===S?p.ComponentParameterSummary.All:0===R?p.ComponentParameterSummary.None:p.ComponentParameterSummary.Some}const O=c.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");c=function(){function R(T){this._renderManager=T;this._objects=[new h,new h];this._renderSubmit=new y.RenderSubmitSystem(this);this._renderManager.register(this._renderSubmit);this._componentBufferManager=
new L.BufferManager(T.rctx)}var S=R.prototype;S.dispose=function(){F.assert(0===this._objects[t.State.Hidden].length&&0===this._objects[t.State.Visible].length,"ObjectCollection should be empty upon disposal");this._componentBufferManager.destroy()};S.createObject=function(T){const V=new t.ComponentObject;V.toMapSpace=T.toMapSpace.slice();V.transform=T.transform;V.obb=m.clone(T.obb);V.components=new q(this._componentBufferManager,T.geometry.componentOffsets);V.renderable=this._createRenderable(T,
V.components);V.intersectionGeometry=new x(T.geometry.positionData,V.components);this._objects[V.visible].push(V);return V};S.destroyObject=function(T){this._objects[T.visible].removeUnordered(T);T.dispose();this._notifyDirty()};S.setObjectVisibility=function(T,V){V!==T.visible&&(this._objects[T.visible].removeUnordered(T),this._objects[V].push(T),T.visible=V,this._notifyDirty())};S.preSubmit=function(T){const V=T.camera.eye;this.visibleObjects.forAll(W=>{const U=f.squaredDistance(V,W.obb.center);
W.renderable.meta.cameraDepthSquared=U})};S.getMaterial=function(T){return T.renderable.material};S.updateMaterial=function(T,V){T=T.renderable.material;V(T);T.dirty&&this._notifyDirty()};S.setAllComponentVisibilities=function(T,V){T.components.visibility.reset(V);T.components.visibilityDirty();this._notifyDirty()};S.forEachVisibleComponent=function(T,V){return T.components.visibility.forEachComponent(V)};S.getComponentCount=function(T){const V=T.components.visibility.componentCount();return{visible:V,
invisible:T.components.count-V}};S.setComponentData=function(T,V){const W=T.renderable.material;if(r.isVaryingComponentParameters(V)){T=T.components;var U=T.materialDataBuffer;const aa=T.materialDataIndices,da={castShadows:!0,pickable:!0,externalColor:e.create(),externalColorMixMode:d.ColorMixModeEnum.Multiply};U=U.textureBuffer;const Y=new Uint8Array(4),ea=new Uint32Array(Y.buffer);let ja=0,la=0,ia=0,ca=!1,fa=0;for(let ba=0;ba<T.count;ba++)V(ba,da),ja+=+(1>da.externalColor[3]),la+=+(da.externalColorMixMode===
d.ColorMixModeEnum.Replace&&1===da.externalColor[3]),ia+=+da.castShadows,d.encodeSymbolColor(da.externalColor,da.externalColorMixMode,Y),Y[2]=Y[2]&254|+da.castShadows,U.setData(aa[ba],0,Y[0],Y[1],Y[2],Y[3]),ca=ca||0<ba&&fa!==ea[0],fa=ea[0],da.pickable!==C.getVisibility(T.pickability,ba)&&(T.pickability=C.updateVisibilityWithCount(T.pickability,T.count,ba,da.pickable));ca?(W.componentParameters=new p.ComponentParametersVarying,W.componentParameters.castShadows=I(ia,T.count),W.componentParameters.transparent=
I(ja,T.count),W.componentParameters.opaqueOverride=I(la,T.count),W.componentParameters.texture=U,U.updateTexture()):(W.componentParameters=new p.ComponentParametersUniform,W.componentParameters.castShadows=da.castShadows?p.ComponentParameterSummary.All:p.ComponentParameterSummary.None,W.componentParameters.externalColor=da.externalColor,W.componentParameters.externalColorMixMode=da.externalColorMixMode)}else W.componentParameters=new p.ComponentParametersUniform,W.componentParameters.castShadows=
V.castShadows?p.ComponentParameterSummary.All:p.ComponentParameterSummary.None,W.componentParameters.externalColor=V.externalColor,W.componentParameters.externalColorMixMode=V.externalColorMixMode;this._notifyDirty()};S.getComponentAabb=function(T,V,W){return T.intersectionGeometry.getComponentAabb(V,W)};S.getComponentObb=function(T){return T.obb};S.getObjectTransform=function(T){return T.transform};S.getComponentPositions=function(T,V,W){return T.intersectionGeometry.getComponentPositions(V,W)};
S.intersect=function(T,V,W,U,aa,da){g.isSome(aa)&&(aa.localOrigin=T.transform.position);const Y=w.invert(J,T.transform.rotationScale);f.sub(P,V,T.transform.position);f.sub(N,W,T.transform.position);f.transformMat3(P,P,Y);f.transformMat3(N,N,Y);V=w.transpose(J,Y);return T.intersectionGeometry.intersect(P,N,U,V,aa,da)};S.addEdges=function(T,V,W,U){const {indices:aa,positions:da}=T.intersectionGeometry,Y=T.components.offsets;return V.addComponentObject(T,T.transform,{center:T.obb.center,radius:m.radius(T.obb)},
da,aa,Y,W,U)};S.addComponentHighlight=function(T,V){T=T.components;g.isNone(T.highlightCounts)&&(T.highlightCounts=new Uint32Array(T.count+1));0===T.highlightCounts[V]++&&(T.highlightsDirty(),this._notifyDirty());T.highlightCounts[T.count]++};S.removeComponentHighlight=function(T,V){T=T.components;if(g.isNone(T.highlightCounts))O.warn("Removing non-existing highlight.");else{var W=T.highlightCounts[V],U=T.highlightCounts[T.count];0===W?O.warn("Removing non-existing highlight."):1<W?(T.highlightCounts[V]=
W-1,T.highlightCounts[T.count]=U-1):(T.highlightCounts[V]=0,T.highlightsDirty(),this._notifyDirty(),1===U?T.highlightCounts=null:T.highlightCounts[T.count]=U-1)}};S.clearHighlights=function(T){T=T.components;g.isSome(T.highlightCounts)&&(T.highlightCounts=null,T.highlightsDirty(),this._notifyDirty())};S.getObjectGPUMemoryUsage=function(T){return T.renderable.meta.gpuMemoryEstimate};S._createRenderable=function(T,V){const W=this._renderManager.rctx;var U=T.geometry,aa=U.vertices.layoutParameters,da=
H.BufferObject.createVertex(W,M.Usage.STATIC_DRAW,U.vertices.data);const Y=g.applySome(U.indices,ca=>H.BufferObject.createIndex(W,M.Usage.STATIC_DRAW,ca));var ea=z.glLayout(A.createVertexBufferLayout(aa)),ja=new Uint16Array(U.vertices.count);for(var la=0;la<V.count;la++){var ia=V.offsets[la];const ca=V.offsets[la+1],fa=V.materialDataIndices[la];if(g.isSome(U.indices))for(;ia<ca;ia++)ja[U.indices[ia]]=fa;else for(;ia<ca;ia++)ja[ia]=fa}U=H.BufferObject.createVertex(W,M.Usage.STATIC_DRAW,ja.buffer);
ja=new D.TwoVectorPosition(T.transform.position);la=n.clone(T.transform.rotationScale);w.invert(la,la);w.transpose(la,la);V=new B.ComponentDrawParameters;f.copy(V.transformWorldFromModelTL,ja.low);f.copy(V.transformWorldFromModelTH,ja.high);w.copy(V.transformWorldFromModelRS,T.transform.rotationScale);w.copy(V.transformNormalGlobalFromModel,la);k.copy(V.toMapSpace,T.toMapSpace);T=new p.ComponentMaterial;ea=new K.VertexArrayObject(W,T.attributeLocations,{data:ea,componentIndices:Q},{data:da,componentIndices:U},
g.unwrap(Y));aa=new E.RenderGeometry(ea,M.PrimitiveType.TRIANGLES,aa,g.isSome(Y));da={cameraDepthSquared:.5,gpuMemoryEstimate:da.byteSize+U.byteSize+(g.isSome(Y)?Y.byteSize:0)};return new u.Renderable(T,V,aa,da)};S._notifyDirty=function(){this._renderManager.notifyDirty()};b._createClass(R,[{key:"visibleObjects",get:function(){return this._objects[t.State.Visible]}}]);return R}();const Q=z.glLayout(v.newLayout().u16(G.VertexAttribute.COMPONENTINDEX)),J=n.create(),P=l.create(),N=l.create();a.ComponentObjectCollection=
c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/orientedBoundingBox":function(){define("exports ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/quat ../../../chunks/quatf32 ../../../chunks/quatf64 ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/plane ./dito".split(" "),function(a,b,c,g,h,w,n,f,l,k,e,d,m,z){function v(B=[0,0,0],
D=[-1,-1,-1],C=[0,0,0,1]){return{center:l.clone(B),halfSize:f.clone(D),quaternion:h.clone(C)}}function q(B,D){const C=m.signedDistance(D,B.center);B=t(B,m.normal(D));return C>B?1:C<-B?-1:0}function t(B,D){g.conjugate(r,B.quaternion);n.transformQuat(x,D,r);B=B.halfSize;return Math.abs(x[0]*B[0])+Math.abs(x[1]*B[1])+Math.abs(x[2]*B[2])}const r=w.create(),x=l.create(),u=l.create(),E=e.create(),y=c.create(),A=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],p=(()=>{const B=new Int8Array(162);let D=0;const C=F=>
{for(let G=0;G<F.length;G++)B[D+G]=F[G];D+=6};C([6,2,3,1,5,4]);C([0,2,3,1,5,4]);C([0,2,3,7,5,4]);C([0,1,3,2,6,4]);C([0,1,3,2,0,0]);C([0,1,5,7,3,2]);C([0,1,3,7,6,4]);C([0,1,3,7,6,2]);C([0,1,5,7,6,2]);C([0,1,5,4,6,2]);C([0,1,5,4,0,0]);C([0,1,3,7,5,4]);C([0,2,6,4,0,0]);C([0,0,0,0,0,0]);C([1,3,7,5,0,0]);C([2,3,7,6,4,0]);C([2,3,7,6,0,0]);C([2,3,1,5,7,6]);C([0,1,5,7,6,2]);C([0,1,5,7,6,4]);C([0,1,3,7,6,4]);C([4,5,7,6,2,0]);C([4,5,7,6,0,0]);C([4,5,1,3,7,6]);C([0,2,3,7,5,4]);C([6,2,3,7,5,4]);C([6,2,3,1,5,
4]);return B})();a.ObbArray=function(B){this.buffer=new ArrayBuffer(56*B);this.obbs=Array(B);for(let D=0;D<B;D++)this.obbs[D]={center:l.createView(this.buffer,56*D),halfSize:f.createView(this.buffer,56*D+24),quaternion:h.createView(this.buffer,56*D+36)}};a.clone=function(B){return v(B.center,B.halfSize,B.quaternion)};a.compute=function(B,D){D=D||v();z.computeOBB(B,D);return D};a.corners=function(B,D){for(let C=0;8>C;++C){const F=D[C];F[0]=C&1?-B.halfSize[0]:B.halfSize[0];F[1]=C&2?-B.halfSize[1]:B.halfSize[1];
F[2]=C&4?-B.halfSize[2]:B.halfSize[2];n.transformQuat(F,F,B.quaternion);n.add(F,F,B.center)}};a.create=v;a.intersectLine=function(B,D,C,F=0){g.conjugate(r,B.quaternion);n.subtract(x,D,B.center);D=n.transformQuat(x,x,r);C=n.transformQuat(u,C,r);let G=-Infinity,L=Infinity;for(let H=0;3>H;H++)if(1E-6<Math.abs(C[H])){const M=(F+B.halfSize[H]-D[H])/C[H],K=(-F-B.halfSize[H]-D[H])/C[H];G=Math.max(G,Math.min(M,K));L=Math.min(L,Math.max(M,K))}else if(D[H]>B.halfSize[H]+F||D[H]<-B.halfSize[H]-F)return!1;return G<=
L};a.intersectPlane=q;a.isVisible=function(B,D){return 0>=q(B,D[0])&&0>=q(B,D[1])&&0>=q(B,D[2])&&0>=q(B,D[3])&&0>=q(B,D[4])&&0>=q(B,D[5])};a.maximumDistancePlane=function(B,D){const C=m.signedDistance(D,B.center);B=t(B,m.normal(D));return C+B};a.minimumDistancePlane=function(B,D){const C=m.signedDistance(D,B.center);B=t(B,m.normal(D));return C-B};a.projectedArea=function(B,D,C,F,G){g.conjugate(r,B.quaternion);n.sub(x,D,B.center);n.transformQuat(x,x,r);var L=x[0]<-B.halfSize[0]?-1:x[0]>B.halfSize[0]?
1:0,H=x[1]<-B.halfSize[1]?-1:x[1]>B.halfSize[1]?1:0,M=x[2]<-B.halfSize[2]?-1:x[2]>B.halfSize[2]?1:0;D=Math.abs(L)+Math.abs(H)+Math.abs(M);if(0===D)return Infinity;D=1===D?4:6;L=6*(L+3*H+9*M+13);b.fromQuat(y,B.quaternion);b.scale(y,y,B.halfSize);for(H=0;H<D;H++)M=p[L+H],n.set(x,((M&1)<<1)-1,(M&2)-1,((M&4)>>1)-1),n.transformMat3(x,x,y),n.add(E,B.center,x),E[3]=1,k.transformMat4(E,E,C),M=1/Math.max(1E-6,E[3]),A[2*H]=E[0]*M,A[2*H+1]=E[1]*M;B=2*D-2;C=A[0]*(A[3]-A[B+1])+A[B]*(A[1]-A[B-1]);for(D=2;D<B;D+=
2)C+=A[D]*(A[D+3]-A[D-1]);return Math.abs(C)*F*G*.125};a.projectedRadius=t;a.radius=function(B){return n.len(B.halfSize)};a.set=function(B,D){n.copy(D.center,B.center);n.copy(D.halfSize,B.halfSize);g.copy(D.quaternion,B.quaternion)};a.toAaBoundingBox=function(B,D){D||(D=d.create());var C=b.fromQuat(y,B.quaternion);const F=B.halfSize[0]*Math.abs(C[0])+B.halfSize[1]*Math.abs(C[3])+B.halfSize[2]*Math.abs(C[6]),G=B.halfSize[0]*Math.abs(C[1])+B.halfSize[1]*Math.abs(C[4])+B.halfSize[2]*Math.abs(C[7]);C=
B.halfSize[0]*Math.abs(C[2])+B.halfSize[1]*Math.abs(C[5])+B.halfSize[2]*Math.abs(C[8]);D[0]=B.center[0]-F;D[1]=B.center[1]-G;D[2]=B.center[2]-C;D[3]=B.center[0]+F;D[4]=B.center[1]+G;D[5]=B.center[2]+C;return D};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/quatf32":function(){define(["exports"],function(a){function b(){const n=new Float32Array(4);n[3]=1;return n}function c(n){const f=new Float32Array(4);f[0]=n[0];f[1]=n[1];f[2]=n[2];f[3]=n[3];return f}function g(n,f,l,k){const e=
new Float32Array(4);e[0]=n;e[1]=f;e[2]=l;e[3]=k;return e}function h(n,f){return new Float32Array(n,f,4)}const w=Object.freeze({__proto__:null,create:b,clone:c,fromValues:g,createView:h});a.clone=c;a.create=b;a.createView=h;a.fromValues=g;a.quatf32=w})},"esri/views/3d/support/dito":function(){define(["exports"],function(a){function b(U,aa,da,Y,ea,ja){if(!(1E-6>aa[0]*aa[0]+aa[1]*aa[1]+aa[2]*aa[2]))for(d(C,da,aa),d(F,Y,aa),d(G,ea,aa),c(U,aa,D),H[1]=D[0],L[1]=D[1],M[1]=L[1]-H[1],da=[da,Y,ea],Y=[C,F,G],
ea=0;3>ea;++ea){c(U,da[ea],D);H[0]=D[0];L[0]=D[1];c(U,Y[ea],D);H[2]=D[0];L[2]=D[1];M[0]=L[0]-H[0];M[2]=L[2]-H[2];const la=n(M);la<ja.quality&&(e(ja.b0,da[ea]),e(ja.b1,aa),e(ja.b2,Y[ea]),ja.quality=la)}}function c(U,aa,da){const {data:Y,size:ea}=U;da[0]=Number.POSITIVE_INFINITY;da[1]=Number.NEGATIVE_INFINITY;for(U=0;U<Y.length;U+=ea){const ja=Y[U]*aa[0]+Y[U+1]*aa[1]+Y[U+2]*aa[2];da[0]=Math.min(da[0],ja);da[1]=Math.max(da[1],ja)}}function g(U,aa,da){e(da.center,U);k(da.halfSize,aa,.5);da.quaternion[0]=
0;da.quaternion[1]=0;da.quaternion[2]=0;da.quaternion[3]=1}function h(U,aa,da,Y,ea,ja){c(U,aa,D);ea[0]=D[0];ja[0]=D[1];c(U,da,D);ea[1]=D[0];ja[1]=D[1];c(U,Y,D);ea[2]=D[0];ja[2]=D[1]}function w(U,aa,da,Y,ea,ja,la){S[0]=U[0];S[1]=U[1];S[2]=U[2];S[3]=aa[0];S[4]=aa[1];S[5]=aa[2];S[6]=da[0];S[7]=da[1];S[8]=da[2];var ia=la.quaternion,ca=S,fa=ca[0]+ca[4]+ca[8];if(0<fa)fa=Math.sqrt(fa+1),ia[3]=.5*fa,fa=.5/fa,ia[0]=(ca[5]-ca[7])*fa,ia[1]=(ca[6]-ca[2])*fa,ia[2]=(ca[1]-ca[3])*fa;else{fa=0;ca[4]>ca[0]&&(fa=1);
ca[8]>ca[3*fa+fa]&&(fa=2);const ba=(fa+1)%3,Z=(fa+2)%3;let ha=Math.sqrt(ca[3*fa+fa]-ca[3*ba+ba]-ca[3*Z+Z]+1);ia[fa]=.5*ha;ha=.5/ha;ia[3]=(ca[3*ba+Z]-ca[3*Z+ba])*ha;ia[ba]=(ca[3*ba+fa]+ca[3*fa+ba])*ha;ia[Z]=(ca[3*Z+fa]+ca[3*fa+Z])*ha}f(T,Y,ea);k(T,T,.5);k(la.center,U,T[0]);k(R,aa,T[1]);f(la.center,la.center,R);k(R,da,T[2]);f(la.center,la.center,R);k(la.halfSize,ja,.5)}function n(U){return U[0]*U[1]+U[0]*U[2]+U[1]*U[2]}function f(U,aa,da){U[0]=aa[0]+da[0];U[1]=aa[1]+da[1];U[2]=aa[2]+da[2]}function l(U,
aa,da){U[0]=aa[0]-da[0];U[1]=aa[1]-da[1];U[2]=aa[2]-da[2]}function k(U,aa,da){U[0]=aa[0]*da;U[1]=aa[1]*da;U[2]=aa[2]*da}function e(U,aa,da=0){U[0]=aa[da+0];U[1]=aa[da+1];U[2]=aa[da+2]}function d(U,aa,da){const Y=aa[0],ea=aa[1];aa=aa[2];const ja=da[0],la=da[1];da=da[2];U[0]=ea*da-aa*la;U[1]=aa*ja-Y*da;U[2]=Y*la-ea*ja}function m(U,aa){var da=aa[0]*aa[0]+aa[1]*aa[1]+aa[2]*aa[2];0<da&&(da=1/Math.sqrt(da),U[0]=aa[0]*da,U[1]=aa[1]*da,U[2]=aa[2]*da)}function z(U,aa){const da=aa[0]-U[0],Y=aa[1]-U[1];U=aa[2]-
U[2];return da*da+Y*Y+U*U}const v=[0,0,0],q=[0,0,0],t=[0,0,0],r=[0,0,0],x=[0,0,0],u=[0,0,0],E=[0,0,0],y=[0,0,0],A=[0,0,0],p=[0,0,0],B=[0,0,0],D=[0,0],C=[0,0,0],F=[0,0,0],G=[0,0,0],L=[0,0,0],H=[0,0,0],M=[0,0,0],K=[0,0,0],I=[0,0,0],O=[0,0,0],Q=[0,0,0],J=[0,0,0],P=[0,0,0],N=[0,0,0],R=[0,0,0],S=[1,0,0,0,1,0,0,0,1],T=[0,0,0];let V=function(U){this.minVert=Array(7);this.maxVert=Array(7);this.buffer=new ArrayBuffer(448);var aa=0;this.minProj=new Float64Array(this.buffer,aa,7);aa+=56;this.maxProj=new Float64Array(this.buffer,
aa,7);aa+=56;for(var da=0;7>da;++da)this.minVert[da]=new Float64Array(this.buffer,aa,3),aa+=24;for(da=0;7>da;++da)this.maxVert[da]=new Float64Array(this.buffer,aa,3),aa+=24;for(aa=0;7>aa;++aa)this.minProj[aa]=Number.POSITIVE_INFINITY,this.maxProj[aa]=Number.NEGATIVE_INFINITY;aa=Array(7);da=Array(7);const {data:Y,size:ea}=U;for(U=0;U<Y.length;U+=ea){var ja=Y[U];ja<this.minProj[0]&&(this.minProj[0]=ja,aa[0]=U);ja>this.maxProj[0]&&(this.maxProj[0]=ja,da[0]=U);ja=Y[U+1];ja<this.minProj[1]&&(this.minProj[1]=
ja,aa[1]=U);ja>this.maxProj[1]&&(this.maxProj[1]=ja,da[1]=U);ja=Y[U+2];ja<this.minProj[2]&&(this.minProj[2]=ja,aa[2]=U);ja>this.maxProj[2]&&(this.maxProj[2]=ja,da[2]=U);ja=Y[U]+Y[U+1]+Y[U+2];ja<this.minProj[3]&&(this.minProj[3]=ja,aa[3]=U);ja>this.maxProj[3]&&(this.maxProj[3]=ja,da[3]=U);ja=Y[U]+Y[U+1]-Y[U+2];ja<this.minProj[4]&&(this.minProj[4]=ja,aa[4]=U);ja>this.maxProj[4]&&(this.maxProj[4]=ja,da[4]=U);ja=Y[U]-Y[U+1]+Y[U+2];ja<this.minProj[5]&&(this.minProj[5]=ja,aa[5]=U);ja>this.maxProj[5]&&(this.maxProj[5]=
ja,da[5]=U);ja=Y[U]-Y[U+1]-Y[U+2];ja<this.minProj[6]&&(this.minProj[6]=ja,aa[6]=U);ja>this.maxProj[6]&&(this.maxProj[6]=ja,da[6]=U)}for(U=0;7>U;++U)ja=aa[U],e(this.minVert[U],Y,ja),ja=da[U],e(this.maxVert[U],Y,ja)},W=function(){this.b0=[1,0,0];this.b1=[0,1,0];this.b2=[0,0,1];this.quality=0};a.computeOBB=function(U,aa){const {data:da,size:Y}=U;var ea=da.length/Y;if(!(0>=ea)){var ja=new V(U);f(v,ja.minProj,ja.maxProj);k(v,v,.5);l(q,ja.maxProj,ja.minProj);var la=n(q),ia=new W;ia.quality=la;14>ea&&(U=
{data:new Float64Array(ja.buffer,112,42),size:3});var ca=[0,0,0],fa=[0,0,0],ba=[0,0,0];ea=[0,0,0];var Z=[0,0,0],ha=[0,0,0],na=[0,0,0];var pa=U;var xa=z(ja.maxVert[0],ja.minVert[0]),Da=0;for(var ua=1;7>ua;++ua){const Fa=z(ja.maxVert[ua],ja.minVert[ua]);Fa>xa&&(xa=Fa,Da=ua)}e(ca,ja.minVert[Da]);e(fa,ja.maxVert[Da]);if(1E-6>z(ca,fa))pa=1;else{l(ea,ca,fa);m(ea,ea);{const {data:Fa,size:qa}=pa;ja=Number.NEGATIVE_INFINITY;xa=0;for(Da=0;Da<Fa.length;Da+=qa)B[0]=Fa[Da]-ca[0],B[1]=Fa[Da+1]-ca[1],B[2]=Fa[Da+
2]-ca[2],ua=ea[0]*B[0]+ea[1]*B[1]+ea[2]*B[2],ua=B[0]*B[0]+B[1]*B[1]+B[2]*B[2]-ua*ua/(ea[0]*ea[0]+ea[1]*ea[1]+ea[2]*ea[2]),ua>ja&&(ja=ua,xa=Da);e(ba,Fa,xa)}1E-6>ja?pa=2:(l(Z,fa,ba),m(Z,Z),l(ha,ba,ca),m(ha,ha),d(na,Z,ea),m(na,na),b(pa,na,ea,Z,ha,ia),pa=0)}switch(pa){case 1:g(v,q,aa);return;case 2:la=U;e(I,ea);Math.abs(ea[0])>Math.abs(ea[1])&&Math.abs(ea[0])>Math.abs(ea[2])?I[0]=0:Math.abs(ea[1])>Math.abs(ea[2])?I[1]=0:I[2]=0;1E-6>I[0]*I[0]+I[1]*I[1]+I[2]*I[2]&&(I[0]=I[1]=I[2]=1);d(O,ea,I);m(O,O);d(Q,
ea,O);m(Q,Q);h(la,ea,O,Q,J,P);l(N,P,J);w(ea,O,Q,J,P,N,aa);return}pa=U;{ja=D;const {data:Fa,size:qa}=pa;e(r,Fa);e(t,r);ja[0]=K[0]*na[0]+K[1]*na[1]+K[2]*na[2];ja[1]=ja[0];for(xa=qa;xa<Fa.length;xa+=qa)Da=Fa[xa]*na[0]+Fa[xa+1]*na[1]+Fa[xa+2]*na[2],Da<ja[0]&&(ja[0]=Da,e(r,Fa,xa)),Da>ja[1]&&(ja[1]=Da,e(t,Fa,xa))}na=ca[0]*na[0]+ca[1]*na[1]+ca[2]*na[2];D[1]-1E-6<=na&&(t[0]=void 0);D[0]+1E-6>=na&&(r[0]=void 0);void 0!==t[0]&&(l(x,t,ca),m(x,x),l(u,t,fa),m(u,u),l(E,t,ba),m(E,E),d(y,u,ea),m(y,y),d(A,E,Z),m(A,
A),d(p,x,ha),m(p,p),b(pa,y,ea,u,x,ia),b(pa,A,Z,E,u,ia),b(pa,p,ha,x,E,ia));void 0!==r[0]&&(l(x,r,ca),m(x,x),l(u,r,fa),m(u,u),l(E,r,ba),m(E,E),d(y,u,ea),m(y,y),d(A,E,Z),m(A,A),d(p,x,ha),m(p,p),b(pa,y,ea,u,x,ia),b(pa,A,Z,E,u,ia),b(pa,p,ha,x,E,ia));h(U,ia.b0,ia.b1,ia.b2,J,P);U=[0,0,0];l(U,P,J);ia.quality=n(U);ia.quality<la?w(ia.b0,ia.b1,ia.b2,J,P,U,aa):g(v,q,aa)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/ComponentData":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers",
"../../../../../core/maybe","../../../../../core/typedArrayUtil","./IndexRange/ComponentRangeRunLengthEncoded","../../lib/AutoDisposable"],function(a,b,c,g,h){function w(n,f,l){const k=[],e=[];let d=l.length,m=l.length;f.forEachComponent(z=>{0<n[z]?(d!==z-1&&(k.length&&k.push(l[d+1]-k[k.length-1]),k.push(l[z])),d=z):(m!==z-1&&(e.length&&e.push(l[m+1]-e[e.length-1]),e.push(l[z])),m=z);return!0});k.length&&k.push(l[d+1]-k[k.length-1]);e.length&&e.push(l[m+1]-e[e.length-1]);return{highlightRanges:k,
defaultRanges:e}}return function(n){function f(k,e){var d=n.call(this)||this;d.pickability=null;d.highlightCounts=null;d.cachedGeometryRanges=null;d.cachedHighlightRanges=null;d.cachedDefaultRanges=null;d.offsets=c.slice(e);e=d.count;d.visibility=new g.ComponentRangeRunLengthEncoded(e);d.materialDataBuffer=k.getBuffer(e);d.materialDataIndices=new Uint16Array(e);for(k=0;k<e;k++)d.materialDataIndices[k]=d.materialDataBuffer.acquireIndex();return d}a._inheritsLoose(f,n);var l=f.prototype;l.dispose=function(){n.prototype.dispose.call(this);
for(let k=0;k<this.count;k++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[k])};l.highlightsDirty=function(){this.cachedDefaultRanges=this.cachedHighlightRanges=null};l.visibilityDirty=function(){this.cachedGeometryRanges=null;this.highlightsDirty()};l._updateCachedHighlightRanges=function(){if((b.isNone(this.cachedHighlightRanges)||b.isNone(this.cachedDefaultRanges))&&b.isSome(this.highlightCounts)){const {highlightRanges:k,defaultRanges:e}=w(this.highlightCounts,this.visibility,
this.offsets);this.cachedHighlightRanges=k;this.cachedDefaultRanges=e}};a._createClass(f,[{key:"count",get:function(){return this.offsets.length-1}},{key:"geometryRanges",get:function(){b.isNone(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets));return this.cachedGeometryRanges}},{key:"highlightRanges",get:function(){if(b.isNone(this.highlightCounts))return null;this._updateCachedHighlightRanges();return this.cachedHighlightRanges}},{key:"defaultShadowMapRanges",
get:function(){if(b.isNone(this.highlightCounts))return this.geometryRanges;this._updateCachedHighlightRanges();return this.cachedDefaultRanges}}]);return f}(h.AutoDisposable)})},"esri/views/3d/webgl-engine/collections/Component/IndexRange/ComponentRangeRunLengthEncoded":function(){define(["exports"],function(a){let b=function(){function c(h){this._totalCount=h;this._indexRanges=[0,h]}var g=c.prototype;g.componentCount=function(){const h=this._indexRanges;let w=0;for(let n=0;n<h.length;n+=2)w+=h[n+
1];return w};g.reset=function(h){if("all"===h||h.length===this._totalCount)this._indexRanges=[0,this._totalCount];else{{const f=[];if(0!==h.length){var w=h[0],n=1;for(let l=1;l<h.length;l++){const k=h[l];w+n===k?n+=1:(f.push(w),f.push(n),w=k,n=1)}f.push(w);f.push(n)}h=f}this._indexRanges=h}};g.forEachComponent=function(h){const w=this._indexRanges;for(let f=0;f<w.length;f+=2){var n=w[f];const l=n+w[f+1];for(;n<l;n++)if(!h(n))return!1}return!0};g.forEachComponentRange=function(h){const w=this._indexRanges;
for(let n=0;n<w.length;n+=2){const f=w[n];if(!h(f,f+w[n+1]))return!1}return!0};g.computeOffsetRanges=function(h){const w=Array(this._indexRanges.length),n=this._indexRanges;for(let l=0;l<n.length;l+=2){var f=n[l];const k=h[f];f=h[f+n[l+1]];w[l]=k;w[l+1]=f-k}return w};return c}();a.ComponentRangeRunLengthEncoded=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObject":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers",
"../../../../../chunks/tslib.es6","../../lib/AutoDisposable"],function(a,b,c,g){let h=function(w){function n(){var f=w.apply(this,arguments)||this;f.visible=a.State.Hidden;return f}b._inheritsLoose(n,w);return n}(g.AutoDisposable);c.__decorate([g.autoDispose()],h.prototype,"renderable",void 0);c.__decorate([g.autoDispose()],h.prototype,"components",void 0);a.State=void 0;(function(w){w[w.Hidden=0]="Hidden";w[w.Visible=1]="Visible"})(a.State||(a.State={}));a.ComponentObject=h;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/interface":function(){define(["exports"],function(a){a.isVaryingComponentParameters=function(b){return"function"===typeof b};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/IntersectionGeometry":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../../../../geometry/support/buffer/BufferView ./ComponentIntersectionData ../../lib/ComponentUtils ../../lib/geometryDataUtils ../../materials/internal/MaterialUtil".split(" "),
function(a,b,c,g,h,w,n,f,l,k){let e=function(){function z(q,t){this._indices=b.isSome(q.indices)?q.indices:l.generateDefaultIndexArray(q.positions.length/3);this._positions=new w.BufferViewVec3f(q.positions);this._components=t;this._componentIntersectionData=Array(t.count)}var v=z.prototype;v.getComponentAabb=function(q,t){if(b.isSome(this._perComponentAabbs)){for(let r=0;6>r;r++)t[r]=this._perComponentAabbs[6*q+r];return t}this._computePerComponentAabbs();return this.getComponentAabb(q,t)};v.getComponentPositions=
function(q,t){t.indices=this._indices;t.data=this._positions.typedBuffer;t.stride=this._positions.typedBufferStride;t.startIndex=this._components.offsets[q];t.endIndex=this._components.offsets[q+1]};v.intersect=function(q,t,r,x,u,E){const y={data:this._positions.typedBuffer,stride:this._positions.typedBufferStride,size:3},A=this._indices,p=this._components.offsets,B=k.computeInvDir(q,t,d);this._components.visibility.forEachComponent(D=>{if(!f.getVisibility(this._components.pickability,D))return!0;
var C=this.getComponentAabb(D,m);b.isSome(u)&&u.applyToAabb(C);if(!k.intersectAabbInvDir(C,q,B,r))return!0;C=p[D]/3;const F=p[D+1]/3,G=(H,M,K)=>{E(D,H,c.transformMat3(M,M,x),K)},L=F-C;b.isNone(u)&&L>n.componentMinimalSizeForIntersectionData?(null==this._componentIntersectionData[D]&&(this._componentIntersectionData[D]=new n.ComponentIntersectionData(this._indices,C,F,y)),this._componentIntersectionData[D].intersectRay({r0:q,r1:t},G)):k.intersectTriangles(q,t,C,F,A,y,void 0,u,G);return!0})};v._computePerComponentAabbs=
function(){const q=this._components.count;this._perComponentAabbs=new Float32Array(6*q);for(let t=0;t<q;t++)this._computeAABB(t)};v._computeAABB=function(q){const t=this._indices,r=this._positions;var x=this._components.offsets,u=x[q];const E=x[q+1],y=[0,0,0];x=[Infinity,Infinity,Infinity];const A=[-Infinity,-Infinity,-Infinity];for(;u<E;u++)r.getVec(t[u],y),c.min(x,x,y),c.max(A,A,y);q*=6;this._perComponentAabbs[q++]=x[0];this._perComponentAabbs[q++]=x[1];this._perComponentAabbs[q++]=x[2];this._perComponentAabbs[q++]=
A[0];this._perComponentAabbs[q++]=A[1];this._perComponentAabbs[q]=A[2]};a._createClass(z,[{key:"positions",get:function(){return this._positions}},{key:"indices",get:function(){return this._indices}}]);return z}();const d=g.create(),m=h.create();return e})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["exports"],function(a){function b(c=!0){return{isVisibleBit:!c,data:new Uint32Array(0)}}a.defaultVisibilities=b;a.getVisibility=function(c,g){if(null==c)return!0;const {isVisibleBit:h,
data:w}=c,n=8*w.BYTES_PER_ELEMENT;return g<w.length*n?(c=g/n|0,g=0!==(w[c]&1<<g-c*n)===h):!c.isVisibleBit};a.updateVisibilityWithCount=function(c,g,h,w){if(h>=g)return c;null==c&&(c=b());let n=c.data;const f=8*n.BYTES_PER_ELEMENT,l=h/f|0,k=h-f*l,e=n;w=w===c.isVisibleBit;h<e.length*f||!w||(h=Math.max(l+1,Math.ceil(1.5*e.length)),h=Math.min(h,((g-1)/f|0)+1),n=new Uint32Array(h),n.set(e));l<n.length&&(n[l]=n[l]&~(1<<k)|(w?1:0)<<k);c.data=n;return c};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/webgl-engine/collections/Component/Renderable":function(){define(["exports"],function(a){let b=function(){function c(g,h,w,n){this.material=g;this.drawParameters=h;this.geometry=w;this.meta=n}c.prototype.dispose=function(){this.material.dispose();this.geometry.dispose()};return c}();a.Renderable=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/RenderGeometry":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers",
"../../../../../chunks/tslib.es6","../../lib/AutoDisposable"],function(a,b,c,g){let h=function(w){function n(f,l,k,e){var d=w.call(this)||this;d.primitiveType=l;d.parameters=k;d.indexed=e;d.vao=f;return d}b._inheritsLoose(n,w);return n}(g.AutoDisposable);c.__decorate([g.autoDispose()],h.prototype,"vao",void 0);a.RenderGeometry=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/RenderSubmitSystem":function(){define(["exports","./DepthRange"],function(a,
b){let c=function(){function g(w){this._objects=w}var h=g.prototype;h.submit=function(w,n){this._objects.preSubmit(n);this._objects.visibleObjects.forAll(f=>f.renderable.material.submit(w,f))};h.queryShadowCasterDepthRange=function(w){return this._objects.visibleObjects.length?b.computeDepthRange(w,this._objects.visibleObjects):null};return g}();a.RenderSubmitSystem=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/DepthRange":function(){define("exports ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/quat ../../../../../chunks/quatf64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/plane ../../../support/orientedBoundingBox ../../lib/depthRange".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){function d(G,L,H){return n.set(G,L.data[H+0],L.data[H+1],L.data[H+2])}function m(G,L){G.push(L[0]);G.push(L[1]);G.push(L[2])}function z(G,L,H,M){h.conjugate(A,G.quaternion);n.sub(p,L,G.center);n.transformQuat(p,p,A);const K=8*((p[0]<-G.halfSize[0]?-1:p[0]>G.halfSize[0]?1:0)+3*(p[1]<-G.halfSize[1]?-1:p[1]>G.halfSize[1]?1:0)+9*(p[2]<-G.halfSize[2]?-1:p[2]>G.halfSize[2]?1:0)+13);L=E[K];if(0===L)return L;c.fromQuat(y,G.quaternion);c.scale(y,y,G.halfSize);const I=(O,Q)=>
{Q=E[K+Q+1];n.set(O,((Q&1)<<1)-1,(Q&2)-1,((Q&4)>>1)-1);n.transformMat3(O,O,y);return n.add(O,G.center,O)};H.length=0;m(H,I(B,0));m(H,I(D,1));m(H,I(p,2));m(H,I(C,3));M(H);if(1===L)return L;H.length=0;m(H,B);m(H,C);m(H,I(p,4));m(H,I(F,5));M(H);if(2===L)return L;H.length=0;m(H,B);m(H,F);m(H,I(p,6));m(H,D);M(H);return L}const v=new b({allocator:G=>G||{near:Infinity,far:-Infinity,mask:0,object:null},deallocator:G=>{G.object=null;return G}}),q=e.empty(),t=f.create(),r=f.create(),x=new b({deallocator:null}),
u=new b({deallocator:null}),E=(()=>{const G=new Int8Array(216);let L=0;const H=M=>{for(let K=0;K<M.length;K++)G[L+K]=M[K];L+=8};H([3,0,6,2,3,1,5,4]);H([2,0,2,3,1,5,4,0]);H([3,1,0,2,3,7,5,4]);H([2,0,1,3,2,6,4,0]);H([1,0,1,3,2,0,0,0]);H([2,1,5,7,3,2,0,0]);H([3,2,0,1,3,7,6,4]);H([2,2,0,1,3,7,6,0]);H([3,3,0,1,5,7,6,2]);H([2,0,1,5,4,6,2,0]);H([1,0,1,5,4,0,0,0]);H([2,1,3,7,5,4,0,0]);H([1,0,2,6,4,0,0,0]);H([0,0,0,0,0,0,0,0]);H([1,1,3,7,5,0,0,0]);H([2,2,3,7,6,4,0,0]);H([1,2,3,7,6,0,0,0]);H([2,3,1,5,7,6,2,
0]);H([3,4,0,1,5,7,6,2]);H([2,5,7,6,4,0,1,0]);H([3,5,0,1,3,7,6,4]);H([2,4,5,7,6,2,0,0]);H([1,4,5,7,6,0,0,0]);H([2,5,1,3,7,6,4,0]);H([3,6,0,2,3,7,5,4]);H([2,6,2,3,7,5,4,0]);H([3,7,6,2,3,1,5,4]);return G})(),y=g.create(),A=w.create(),p=f.create(),B=f.create(),D=f.create(),C=f.create(),F=f.create();a.computeDepthRange=function(G,L){const H=e.empty(),{eye:M,frustum:K,viewForward:I}=G;L.forAll(O=>{var Q=O.obb;const J=n.dot(n.sub(p,Q.center,M),I),P=k.projectedRadius(Q,I);if(!e.within(H,J-P)||!e.within(H,
J+P)){a:{var N=0;for(let R=0;4>R;R++){const S=k.intersectPlane(Q,K[R]);if(0<S){Q=-1;break a}0===S&&(N|=1<<R)}Q=N}-1!==Q&&(0===Q?(q.far=J+P,q.near=J-P,e.union(H,q)):(N=v.pushNew(),N.near=J-P,N.far=J+P,N.mask=Q,N.object=O))}});for(G=0;G<v.length;G++){const O=v.data[G];e.within(H,O.near)&&e.within(H,O.far)||(q.far=O.far,q.near=Infinity,0===z(O.object.obb,M,x,Q=>{var J=u;for(var P=0;4>P&&0<Q.length;P++)if(0!==(O.mask&1<<P)){{var N=K[P],R=Q,S=J;S.length=0;const T=R.length-3;d(t,R,T);const V=l.signedDistance(N,
t);0>=V&&(S.push(t[0]),S.push(t[1]),S.push(t[2]));let W=0,U=V;for(W;W<T;W+=3){d(r,R,W);const aa=l.signedDistance(N,r);0>U*aa&&(n.lerp(t,r,t,aa/(aa-U)),m(S,t));0>=aa&&m(S,r);U=aa;n.copy(t,r)}0>U*V&&(d(r,R,T),n.lerp(t,r,t,V/(V-U)),m(S,t))}N=Q;Q=J;J=N}for(J=0;J<Q.length;J+=3)n.set(t,Q.data[J+0],Q.data[J+1],Q.data[J+2]),P=n.dot(n.sub(t,t,M),I),q.near=Math.min(q.near,P)})&&(q.near=0),e.union(H,q))}v.length=0;return H};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/depthRange":function(){define(["exports"],
function(a){function b(g,h){return{near:g,far:h}}function c(g,h,w){g.near=h;g.far=w;return g}a.ZERO={near:0,far:0};a.create=b;a.empty=function(g){return g?c(g,Infinity,-Infinity):b(Infinity,-Infinity)};a.set=c;a.union=function(g,h,w=g){w.near=Math.min(g.near,h.near);w.far=Math.max(g.far,h.far);return w};a.within=function(g,h){return g.near<=h&&h<=g.far};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/SourceGeometry":function(){define(["exports",
"../../../support/buffer/InterleavedLayout","../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl","../../lib/VertexAttribute"],function(a,b,c,g){a.createVertexBufferLayout=function(h){const w=b.newLayout().vec3f(g.VertexAttribute.POSITION);h.normals&&w.vec2i16(g.VertexAttribute.NORMALCOMPRESSED,{glNormalized:!0});h.textureCoordinates===c.TextureCoordinateAttributeType.Default?w.vec2f(g.VertexAttribute.UV0):h.textureCoordinates===c.TextureCoordinateAttributeType.Atlas&&(w.vec2f(g.VertexAttribute.UV0),
w.vec4u16(g.VertexAttribute.UVREGION,{glNormalized:!0}));h.colors&&w.vec4u8(g.VertexAttribute.COLOR,{glNormalized:!0});return w.alignTo(4)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentMaterial":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ../../../../../../core/maybe ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f32 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f32 ../../../../../../chunks/vec4f64 ../../../../layers/support/symbolColorUtils ./ComponentTechnique ./shader/ComponentData.glsl ../../../../../../chunks/ComponentShader.glsl ./shader/VertexDiscardByOpacity.glsl ../../../core/material/MaterialBase ../../../core/renderPasses/AllRenderPasses ../../../core/shaderLibrary/ShaderOutputOptions ../../../core/shaderLibrary/shading/Normals.glsl ../../../core/shaderLibrary/util/AlphaDiscard.glsl ../../../core/shaderLibrary/util/EllipsoidMode ../../../lib/basicInterfaces".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E){function y(C){switch(C){case q.MaterialSubPass.Color:return t.ShaderOutput.Color;case q.MaterialSubPass.Alpha:return t.ShaderOutput.Alpha;case q.MaterialSubPass.Depth:return t.ShaderOutput.Depth;case q.MaterialSubPass.Normal:return t.ShaderOutput.Normal}}let A=function(C){function F(){var L=C.apply(this,arguments)||this;L.baseColor=f.fromValues(1,1,1,1);L.usePBR=!1;L.hasParametersFromSource=!1;L.mrrFactors=w.fromValues(1,1,.5);L.emissiveFactor=w.fromValues(0,
0,0);L.baseColorTexture=null;L.metallicRoughnessTexture=null;L.emissionTexture=null;L.occlusionTexture=null;L.normalTexture=null;L.overlayTexOffset=l.fromValues(-1,-1,-1,-1);L.overlayTexScale=l.fromValues(0,0,0,0);L.overlayColor=null;L.overlayHighlight=null;L.overlayNormal=null;L.objectOpacity=1;L.commonMaterialParameters=new B;L.componentParameters=new D;L.alphaCutoff=x.defaultMaskAlphaCutoff;L.alphaDiscardMode=E.AlphaDiscardMode.Opaque;L.isIntegratedMesh=!1;L.polygonOffsetEnabled=!1;L.ellipsoidMode=
u.EllipsoidMode.Earth;L.sceneHasOcludees=!1;L._techniqueConfig=new e.ComponentTechniqueConfiguration;return L}b._inheritsLoose(F,C);var G=F.prototype;G.dispose=function(){this._technique=g.releaseMaybe(this._technique);this.normalTexture=this.occlusionTexture=this.emissionTexture=this.metallicRoughnessTexture=this.baseColorTexture=null};G.prepareTechnique=function(L,H,M){const K=this._techniqueConfig;K.hasVertexColors=M.colors;K.hasNormals=M.normals;K.vertexTextureCoordinates=M.textureCoordinates;
K.usePBR=this.usePBR;K.hasMetalnessAndRoughnessTexture=g.isSome(this.metallicRoughnessTexture);K.hasEmissionTexture=g.isSome(this.emissionTexture);K.hasOcclusionTexture=g.isSome(this.occlusionTexture);K.hasNormalTexture=g.isSome(this.normalTexture);K.transparencyPassType=H.identifier===q.RenderPassIdentifier.Material&&null!=H.transparencyPassType?H.transparencyPassType:E.TransparencyPassType.NONE;K.multipassTerrainEnabled=H.identifier===q.RenderPassIdentifier.Material&&null!=H.multipassTerrainParams?
H.multipassTerrainParams.multipassTerrainEnabled:!1;K.cullAboveGround=H.identifier===q.RenderPassIdentifier.Material&&null!=H.multipassTerrainParams?H.multipassTerrainParams.cullAboveGround:!1;K.ellipsoidMode=this.ellipsoidMode;this.dirty&&(K.componentData=this.componentParameters.type,K.cullFace=this.commonMaterialParameters.cullFace,K.doubleSidedMode=this.commonMaterialParameters.doubleSided?r.NormalsDoubleSidedMode.View:r.NormalsDoubleSidedMode.None,K.baseColorTexture=g.isSome(this.baseColorTexture),
K.isSchematic=this.hasParametersFromSource&&!g.isSome(this.baseColorTexture),M=this._computeWhichMaterialPass(),K.blendingEnabled=M===p.Transparent||M===p.OpaqueAndTransparent,K.alphaDiscardMode=this.alphaDiscardMode,K.integratedMeshMode=this.isIntegratedMesh?this.overlayColor?this.overlayNormal?e.IntegratedMeshMode.ColorOverlayWithWater:e.IntegratedMeshMode.ColorOverlay:e.IntegratedMeshMode.NoOverlay:e.IntegratedMeshMode.None,K.polygonOffsetEnabled=this.polygonOffsetEnabled,this._setClean());K.slicePlaneEnabled=
H.slicePlaneEnabled&&this.commonMaterialParameters.slicePlaneEnabled;H.identifier===q.RenderPassIdentifier.ShadowMap?(K.output=t.ShaderOutput.Shadow,K.vertexDiscardMode=z.VertexDiscardMode.None):H.identifier===q.RenderPassIdentifier.Highlight?(K.output=t.ShaderOutput.Highlight,K.vertexDiscardMode=z.VertexDiscardMode.None):(this._computeWhichMaterialPass()===p.OpaqueAndTransparent?K.vertexDiscardMode=H.transparent?z.VertexDiscardMode.Opaque:z.VertexDiscardMode.Transparent:K.vertexDiscardMode=z.VertexDiscardMode.None,
K.output=y(H.subPass),H.subPass===q.MaterialSubPass.Alpha&&(K.sceneHasOcludees=H.sceneHasOcludees),H.subPass===q.MaterialSubPass.Color?(K.receiveAmbientOcclusion=H.ambientOcclusionEnabled,K.sceneHasOcludees=H.sceneHasOcludees,K.receiveShadows=H.shadowsEnabled,K.ssrEnabled=H.ssrParams.ssrEnabled):(K.receiveAmbientOcclusion=!1,K.receiveShadows=!1));return this._technique=L.releaseAndAcquire(e.ComponentTechnique,K,this._technique)};G.submit=function(L,H){if(0!==this.objectOpacity){var M=H.renderable.geometry,
K=H.components,I=H.renderable.drawParameters;H=H.renderable.meta.cameraDepthSquared;var O=K.geometryRanges,Q=K.highlightRanges;K=K.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case p.Opaque:L.materialOpaque.submitDraw(this,M,O,I,H);break;case p.Transparent:L.materialTransparent.submitDraw(this,M,O,I,H);break;case p.OpaqueAndTransparent:L.materialOpaque.submitDraw(this,M,O,I,H);L.materialTransparent.submitDraw(this,M,O,I,H);break;case p.IntegratedMesh:L.materialIntegratedMesh.submitDraw(this,
M,O,I,H),this.overlayHighlight&&L.highlightIntegratedMesh.submitDraw(this,M,O,I,H)}var J=this.componentParameters.castShadows!==a.ComponentParameterSummary.None;J&&L.shadowMap.submitDraw(this,M,O,I,H);g.isSome(Q)&&(L.highlight.submitDraw(this,M,Q,I,H),J&&L.highlightShadowMap.submitDraw(this,M,Q,I,H));J&&g.isSome(K)&&L.defaultShadowMap.submitDraw(this,M,K,I,H)}};G._computeWhichMaterialPass=function(){return this.isIntegratedMesh?p.IntegratedMesh:1>this.objectOpacity?p.Transparent:this.componentParameters.opaqueOverride===
a.ComponentParameterSummary.All?p.Opaque:1>this.baseColor[3]||this.alphaDiscardMode===E.AlphaDiscardMode.Blend||this.alphaDiscardMode===E.AlphaDiscardMode.MaskBlend?p.Transparent:this.componentParameters.transparent===a.ComponentParameterSummary.None?p.Opaque:this.componentParameters.transparent===a.ComponentParameterSummary.All?p.Transparent:p.OpaqueAndTransparent};b._createClass(F,[{key:"attributeLocations",get:function(){return m.attributeLocations}}]);return F}(v.MaterialBase);c.__decorate([v.parameter({vectorOps:n.vec4})],
A.prototype,"baseColor",void 0);c.__decorate([v.parameter()],A.prototype,"usePBR",void 0);c.__decorate([v.parameter()],A.prototype,"hasParametersFromSource",void 0);c.__decorate([v.parameter({vectorOps:h.vec3})],A.prototype,"mrrFactors",void 0);c.__decorate([v.parameter({vectorOps:h.vec3})],A.prototype,"emissiveFactor",void 0);c.__decorate([v.parameter({dispose:!0})],A.prototype,"baseColorTexture",void 0);c.__decorate([v.parameter({dispose:!0})],A.prototype,"metallicRoughnessTexture",void 0);c.__decorate([v.parameter({dispose:!0})],
A.prototype,"emissionTexture",void 0);c.__decorate([v.parameter({dispose:!0})],A.prototype,"occlusionTexture",void 0);c.__decorate([v.parameter({dispose:!0})],A.prototype,"normalTexture",void 0);c.__decorate([v.parameter({vectorOps:{equals:n.exactEquals,copy:n.copy}})],A.prototype,"overlayTexOffset",void 0);c.__decorate([v.parameter({vectorOps:{equals:n.exactEquals,copy:n.copy}})],A.prototype,"overlayTexScale",void 0);c.__decorate([v.parameter()],A.prototype,"overlayColor",void 0);c.__decorate([v.parameter()],
A.prototype,"overlayHighlight",void 0);c.__decorate([v.parameter()],A.prototype,"overlayNormal",void 0);c.__decorate([v.parameter()],A.prototype,"objectOpacity",void 0);c.__decorate([v.parameterBlock()],A.prototype,"commonMaterialParameters",void 0);c.__decorate([v.parameterBlock()],A.prototype,"componentParameters",void 0);c.__decorate([v.parameter()],A.prototype,"alphaCutoff",void 0);c.__decorate([v.parameter()],A.prototype,"alphaDiscardMode",void 0);c.__decorate([v.parameter()],A.prototype,"isIntegratedMesh",
void 0);c.__decorate([v.parameter()],A.prototype,"polygonOffsetEnabled",void 0);c.__decorate([v.parameter()],A.prototype,"ellipsoidMode",void 0);c.__decorate([v.parameter()],A.prototype,"sceneHasOcludees",void 0);a.ShadingNormalSource=void 0;(function(C){C[C.VERTEX=0]="VERTEX";C[C.GROUND=1]="GROUND";C[C.SCREEN_DERIVATIVE=2]="SCREEN_DERIVATIVE"})(a.ShadingNormalSource||(a.ShadingNormalSource={}));var p;(function(C){C[C.Opaque=0]="Opaque";C[C.Transparent=1]="Transparent";C[C.OpaqueAndTransparent=2]=
"OpaqueAndTransparent";C[C.IntegratedMesh=3]="IntegratedMesh"})(p||(p={}));let B=function(C){function F(){var G=C.apply(this,arguments)||this;G.doubleSided=!1;G.cullFace=E.CullFaceOptions.Back;G.slicePlaneEnabled=!0;return G}b._inheritsLoose(F,C);return F}(v.MaterialParameterBlock);c.__decorate([v.parameter()],B.prototype,"doubleSided",void 0);c.__decorate([v.parameter()],B.prototype,"cullFace",void 0);c.__decorate([v.parameter()],B.prototype,"slicePlaneEnabled",void 0);let D=function(C){function F(){var G=
C.apply(this,arguments)||this;G.externalColor=f.fromValues(1,1,1,1);G.externalColorMixMode=k.ColorMixModeEnum.Multiply;G.castShadows=a.ComponentParameterSummary.All;return G}b._inheritsLoose(F,C);b._createClass(F,[{key:"transparent",get:function(){return 1>this.externalColor[3]?a.ComponentParameterSummary.All:a.ComponentParameterSummary.None}},{key:"opaqueOverride",get:function(){return this.externalColorMixMode===k.ColorMixModeEnum.Replace&&1===this.externalColor[3]?a.ComponentParameterSummary.All:
a.ComponentParameterSummary.None}},{key:"visible",get:function(){return 0<this.externalColor[3]?a.ComponentParameterSummary.All:a.ComponentParameterSummary.None}},{key:"type",get:function(){return d.ComponentDataType.Uniform}}]);return F}(v.MaterialParameterBlock);c.__decorate([v.parameter({vectorOps:n.vec4})],D.prototype,"externalColor",void 0);c.__decorate([v.parameter()],D.prototype,"externalColorMixMode",void 0);c.__decorate([v.parameter()],D.prototype,"castShadows",void 0);a.ComponentParameterSummary=
void 0;(function(C){C[C.All=0]="All";C[C.Some=1]="Some";C[C.None=2]="None"})(a.ComponentParameterSummary||(a.ComponentParameterSummary={}));h=function(C){function F(){var G=C.apply(this,arguments)||this;G.texture=null;G.transparent=a.ComponentParameterSummary.None;G.opaqueOverride=a.ComponentParameterSummary.None;G.castShadows=a.ComponentParameterSummary.None;return G}b._inheritsLoose(F,C);b._createClass(F,[{key:"type",get:function(){return d.ComponentDataType.Varying}}]);return F}(v.MaterialParameterBlock);
c.__decorate([v.parameter()],h.prototype,"texture",void 0);c.__decorate([v.parameter()],h.prototype,"transparent",void 0);c.__decorate([v.parameter()],h.prototype,"opaqueOverride",void 0);c.__decorate([v.parameter()],h.prototype,"castShadows",void 0);a.CommonMaterialParameters=B;a.ComponentMaterial=A;a.ComponentParametersUniform=D;a.ComponentParametersVarying=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechnique":function(){define("require exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ../../../../../../core/maybe ../../../../../../chunks/mat3f64 ../../../../../../chunks/vec4f64 ./shader/ComponentData.glsl ../../../../../../chunks/ComponentShader.glsl ./shader/VertexDiscardByOpacity.glsl ../../../core/renderPasses/AllRenderPasses ../../../core/shaderLibrary/ShaderOutputOptions ../../../core/shaderLibrary/Slice.glsl ../../../core/shaderLibrary/attributes/NormalAttribute.glsl ../../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../../../core/shaderLibrary/attributes/VertexPosition.glsl ../../../core/shaderLibrary/output/OutputHighlight.glsl ../../../core/shaderLibrary/shading/Normals.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/shading/ScreenSpaceReflections.glsl ../../../core/shaderLibrary/util/DoublePrecision.glsl ../../../core/shaderLibrary/util/EllipsoidMode ../../../core/shaderTechnique/ReloadableShaderModule ../../../core/shaderTechnique/ShaderTechnique ../../../core/shaderTechnique/ShaderTechniqueConfiguration ../../../lib/basicInterfaces ../../../lib/OrderIndependentTransparency ../../../lib/Program ../../../lib/StencilUtils ../../../../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L){p=function(H){function M(){return H.apply(this,arguments)||this}c._inheritsLoose(M,H);var K=M.prototype;K.bindPass=function(I){const O=this.program;q.bindViewProjTransform(O,I.viewTransform);m.bindSliceUniforms(this.program,this.configuration,I.slicePlane);I.identifier===e.RenderPassIdentifier.Material&&(void 0!==I.ssrParams&&u.bindSSRUniforms(this.program,I.ssrParams),O.setUniformMatrix3fv("transformNormalViewFromGlobal",I.transformNormalViewFromGlobal),
I.subPass===e.MaterialSubPass.Depth&&O.setUniform2fv("nearFar",I.nearFar),I.subPass===e.MaterialSubPass.Color&&I.lighting.setUniforms(this.program,I.integratedMesh,I.hasFillLights));I.identifier===e.RenderPassIdentifier.ShadowMap&&this.program.setUniform2fv("nearFar",I.nearFar)};K.bindMaterial=function(I,O){this._material=I;const Q=this.program;Q.setUniform4fv("baseColor",I.baseColor);Q.setUniform1f("objectOpacity",I.objectOpacity);Q.setUniform1f("textureAlphaCutoff",I.alphaCutoff);I.componentParameters.type===
f.ComponentDataType.Varying?I.componentParameters.texture.bind(Q,"componentColorTex","componentColorTexInvDim"):(Q.setUniform4fv("externalColor",I.componentParameters.externalColor),Q.setUniform1i("externalColorMixMode",I.componentParameters.externalColorMixMode));h.isSome(I.baseColorTexture)&&I.baseColorTexture.bind(Q,"baseColorTexture","baseColorTextureSize");if(this.configuration.output===d.ShaderOutput.Color||this.configuration.output===d.ShaderOutput.Alpha)x.bindPBRUniforms(this.program,I,this.configuration.isSchematic),
h.isSome(I.metallicRoughnessTexture)&&I.metallicRoughnessTexture.bind(Q,"texMetallicRoughness","texMetallicRoughnessSize"),h.isSome(I.emissionTexture)&&I.emissionTexture.bind(Q,"texEmission","texEmissionSize"),h.isSome(I.occlusionTexture)&&I.occlusionTexture.bind(Q,"texOcclusion","texOcclusionSize"),h.isSome(I.normalTexture)&&I.normalTexture.bind(Q,"normalTexture","normalTextureSize");I.isIntegratedMesh&&(O.identifier===e.RenderPassIdentifier.Material&&O.subPass===e.MaterialSubPass.Color?(Q.bindTexture(I.overlayColor,
"ovColorTex"),Q.bindTexture(I.overlayNormal,"ovNormalTex")):O.identifier===e.RenderPassIdentifier.Highlight&&Q.bindTexture(I.overlayHighlight,"ovColorTex"),Q.setUniform1f("overlayOpacity",1));O.identifier===e.RenderPassIdentifier.Highlight&&t.bindOutputHighlight(this.program,O);O.identifier===e.RenderPassIdentifier.Material&&O.subPass===e.MaterialSubPass.Color&&(O.ambientOcclusionEnabled&&O.bindAmbientOcclusion(Q),O.shadowsEnabled&&O.bindShadowMap(Q));O.identifier!==e.RenderPassIdentifier.Material||
O.subPass!==e.MaterialSubPass.Color&&O.subPass!==e.MaterialSubPass.Alpha||!O.multipassTerrainParams.multipassTerrainEnabled||(this.program.setUniform2fv("nearFar",O.nearFar),Q.setUniform2fv("inverseViewport",O.inverseViewport),O.multipassTerrainParams.terrainLinearDepthTexture&&Q.bindTexture(O.multipassTerrainParams.terrainLinearDepthTexture,"terrainDepthTexture"))};K.bindDraw=function(I){q.bindModelTransform(this.program,I);this.program.setUniformMatrix3fv("transformNormalGlobalFromModel",I.transformNormalGlobalFromModel);
this.program.rebindTextures();if(h.isSome(this._material)&&this._material.isIntegratedMesh){const O=this._material.overlayTexScale,Q=this._material.overlayTexOffset;this.program.setUniform4fv("overlayTexOffset",[I.toMapSpace[0]*O[0]+Q[0],I.toMapSpace[1]*O[1]+Q[1],I.toMapSpace[0]*O[2]+Q[2],I.toMapSpace[1]*O[3]+Q[3]]);this.program.setUniform4fv("overlayTexScale",[I.toMapSpace[2]*O[0],I.toMapSpace[3]*O[1],I.toMapSpace[2]*O[2],I.toMapSpace[3]*O[3]])}};K.initializeProgram=function(I){const O=M.shader.get();
var Q=this.configuration;Q=O.build({multipassTerrainEnabled:Q.multipassTerrainEnabled,cullAboveGround:Q.cullAboveGround,oitEnabled:Q.transparencyPassType===D.TransparencyPassType.Color,output:Q.output,normalType:Q.integratedMeshMode===b.IntegratedMeshMode.None?Q.hasNormals?z.NormalAttributeType.CompressedAttribute:z.NormalAttributeType.ScreenDerivative:z.NormalAttributeType.Ground,attributeColor:Q.hasVertexColors,attributeTextureCoordinates:Q.vertexTextureCoordinates,componentData:Q.componentData,
alphaDiscardMode:Q.alphaDiscardMode,baseColorTexture:Q.baseColorTexture,doubleSidedMode:Q.doubleSidedMode,receiveAmbientOcclusion:Q.receiveAmbientOcclusion,receiveShadows:Q.receiveShadows,slicePlaneEnabled:Q.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,viewingMode:I.viewingMode,vertexDiscardMode:Q.vertexDiscardMode,pbrMode:Q.integratedMeshMode===b.IntegratedMeshMode.ColorOverlayWithWater?x.PBRMode.WaterOnIntegratedMesh:Q.usePBR?Q.isSchematic?x.PBRMode.Schematic:x.PBRMode.Normal:
x.PBRMode.Disabled,hasMetalnessAndRoughnessTexture:Q.hasMetalnessAndRoughnessTexture,hasEmissionTexture:Q.hasEmissionTexture,hasOcclusionTexture:Q.hasOcclusionTexture,hasNormalTexture:Q.hasNormalTexture,vertexTangents:!1,supportsTextureAtlas:!0,doublePrecisionRequiresObfuscation:E.doublePrecisionRequiresObfuscation(I.rctx),overlayEnabled:Q.integratedMeshMode===b.IntegratedMeshMode.ColorOverlay||Q.integratedMeshMode===b.IntegratedMeshMode.ColorOverlayWithWater,ssrEnabled:Q.ssrEnabled,highStepCount:!1,
ellipsoidMode:Q.ellipsoidMode});return new F.Program(I.rctx,Q,O.attributeLocations)};K._setPipelineState=function(I){const O=this.configuration,Q=O.integratedMeshMode!==b.IntegratedMeshMode.None,J=I===D.TransparencyPassType.NONE,P=I===D.TransparencyPassType.FrontFace;return L.makePipelineState({blending:O.output!==d.ShaderOutput.Color&&O.output!==d.ShaderOutput.Alpha||!O.blendingEnabled?null:J?C.blendingDefault:C.oitBlending(I),culling:L.cullingParams(O.cullFace),depthTest:{func:C.oitDepthTest(I)},
depthWrite:J||P?L.defaultDepthWriteParams:null,colorWrite:L.defaultColorWriteParams,stencilWrite:Q||O.sceneHasOcludees?G.stencilWriteMaskOn:null,stencilTest:Q?G.replaceBitWhenDepthTestPasses(D.StencilBits.IntegratedMeshMaskExcluded):O.sceneHasOcludees?G.stencilBaseAllZerosParams:null,polygonOffset:J||P?O.polygonOffsetEnabled?{factor:2,units:2}:null:C.OITPolygonOffset})};K.initializePipeline=function(){return this._setPipelineState(this.configuration.transparencyPassType)};return M}(p.ShaderTechnique);
p.shader=new A.ReloadableShaderModule(l.ComponentShader,()=>new Promise((H,M)=>a(["./shader/ComponentShader.glsl"],H,M)));l=function(H){function M(){var K=H.apply(this,arguments)||this;K.transformNormalGlobalFromModel=w.create();K.toMapSpace=n.create();return K}c._inheritsLoose(M,H);return M}(q.VertexPositionModelTransform);b.PassDiscardMode=void 0;(function(H){H[H.None=0]="None";H[H.Transparent=1]="Transparent";H[H.Opaque=2]="Opaque";H[H.COUNT=3]="COUNT"})(b.PassDiscardMode||(b.PassDiscardMode={}));
b.IntegratedMeshMode=void 0;(function(H){H[H.None=0]="None";H[H.NoOverlay=1]="NoOverlay";H[H.ColorOverlay=2]="ColorOverlay";H[H.ColorOverlayWithWater=3]="ColorOverlayWithWater";H[H.COUNT=4]="COUNT"})(b.IntegratedMeshMode||(b.IntegratedMeshMode={}));A=function(H){function M(){var K=H.apply(this,arguments)||this;K.output=d.ShaderOutput.Color;K.hasVertexColors=!1;K.hasNormals=!1;K.vertexTextureCoordinates=v.TextureCoordinateAttributeType.None;K.componentData=f.ComponentDataType.Uniform;K.slicePlaneEnabled=
!1;K.cullFace=D.CullFaceOptions.Back;K.baseColorTexture=!1;K.receiveAmbientOcclusion=!0;K.receiveShadows=!0;K.vertexDiscardMode=k.VertexDiscardMode.None;K.doubleSidedMode=r.NormalsDoubleSidedMode.WindingOrder;K.blendingEnabled=!0;K.alphaDiscardMode=D.AlphaDiscardMode.Opaque;K.integratedMeshMode=b.IntegratedMeshMode.None;K.ssrEnabled=!1;K.polygonOffsetEnabled=!1;K.usePBR=!1;K.isSchematic=!1;K.hasMetalnessAndRoughnessTexture=!1;K.hasEmissionTexture=!1;K.hasOcclusionTexture=!1;K.hasNormalTexture=!1;
K.sceneHasOcludees=!1;K.transparencyPassType=D.TransparencyPassType.NONE;K.ellipsoidMode=y.EllipsoidMode.Earth;K.multipassTerrainEnabled=!1;K.cullAboveGround=!1;return K}c._inheritsLoose(M,H);return M}(B.ShaderTechniqueConfiguration);g.__decorate([B.parameter({count:d.ShaderOutput.COUNT})],A.prototype,"output",void 0);g.__decorate([B.parameter()],A.prototype,"hasVertexColors",void 0);g.__decorate([B.parameter()],A.prototype,"hasNormals",void 0);g.__decorate([B.parameter({count:v.TextureCoordinateAttributeType.COUNT})],
A.prototype,"vertexTextureCoordinates",void 0);g.__decorate([B.parameter({count:f.ComponentDataType.COUNT})],A.prototype,"componentData",void 0);g.__decorate([B.parameter()],A.prototype,"slicePlaneEnabled",void 0);g.__decorate([B.parameter({count:D.CullFaceOptions.COUNT})],A.prototype,"cullFace",void 0);g.__decorate([B.parameter()],A.prototype,"baseColorTexture",void 0);g.__decorate([B.parameter()],A.prototype,"receiveAmbientOcclusion",void 0);g.__decorate([B.parameter()],A.prototype,"receiveShadows",
void 0);g.__decorate([B.parameter({count:k.VertexDiscardMode.COUNT})],A.prototype,"vertexDiscardMode",void 0);g.__decorate([B.parameter({count:r.NormalsDoubleSidedMode.COUNT})],A.prototype,"doubleSidedMode",void 0);g.__decorate([B.parameter()],A.prototype,"blendingEnabled",void 0);g.__decorate([B.parameter({count:D.AlphaDiscardMode.COUNT})],A.prototype,"alphaDiscardMode",void 0);g.__decorate([B.parameter({count:b.IntegratedMeshMode.COUNT})],A.prototype,"integratedMeshMode",void 0);g.__decorate([B.parameter()],
A.prototype,"ssrEnabled",void 0);g.__decorate([B.parameter()],A.prototype,"polygonOffsetEnabled",void 0);g.__decorate([B.parameter()],A.prototype,"usePBR",void 0);g.__decorate([B.parameter()],A.prototype,"isSchematic",void 0);g.__decorate([B.parameter()],A.prototype,"hasMetalnessAndRoughnessTexture",void 0);g.__decorate([B.parameter()],A.prototype,"hasEmissionTexture",void 0);g.__decorate([B.parameter()],A.prototype,"hasOcclusionTexture",void 0);g.__decorate([B.parameter()],A.prototype,"hasNormalTexture",
void 0);g.__decorate([B.parameter()],A.prototype,"sceneHasOcludees",void 0);g.__decorate([B.parameter({count:D.TransparencyPassType.COUNT})],A.prototype,"transparencyPassType",void 0);g.__decorate([B.parameter({count:y.EllipsoidMode.COUNT})],A.prototype,"ellipsoidMode",void 0);g.__decorate([B.parameter()],A.prototype,"multipassTerrainEnabled",void 0);g.__decorate([B.parameter()],A.prototype,"cullAboveGround",void 0);b.ComponentDrawParameters=l;b.ComponentTechnique=p;b.ComponentTechniqueConfiguration=
A;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl":function(){define(["exports","./DecodeSymbolColor.glsl","../../../../core/shaderModules/interfaces","../../../../lib/VertexAttribute"],function(a,b,c,g){a.ComponentDataType=void 0;(function(h){h[h.Uniform=0]="Uniform";h[h.Varying=1]="Varying";h[h.COUNT=2]="COUNT"})(a.ComponentDataType||(a.ComponentDataType={}));a.ComponentData=function(h,w){w.componentData===
a.ComponentDataType.Varying&&(h.vertex.uniforms.add("componentColorTex","sampler2D"),h.vertex.uniforms.add("componentColorTexInvDim","vec2"),h.attributes.add(g.VertexAttribute.COMPONENTINDEX,"float"),h.varyings.add("vExternalColorMixMode","mediump float"),h.varyings.add("vExternalColor","vec4"),h.include(b.DecodeSymbolColor),h.vertex.code.add(c.glsl`vec4 _readComponentColor() {
float normalizedIndex = (componentIndex + 0.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return texture2D(componentColorTex, indexCoord);
}
vec4 forwardExternalColor(out bool castShadows) {
vec4 componentColor = _readComponentColor() * 255.0;
float shadowFlag = mod(componentColor.b * 255.0, 2.0);
componentColor.b -= shadowFlag;
castShadows = shadowFlag >= 1.0;
int decodedColorMixMode;
vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451;
vExternalColorMixMode = float(decodedColorMixMode) + 0.5;
return vExternalColor;
}`),h.fragment.code.add(c.glsl`void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
externalColor = vExternalColor;
externalColorMixMode = int(vExternalColorMixMode);
}`));w.componentData===a.ComponentDataType.Uniform&&(h.vertex.uniforms.add("externalColor","vec4"),h.fragment.uniforms.add("externalColorMixMode","int"),h.varyings.add("vExternalColor","vec4"),h.vertex.code.add(c.glsl`vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),h.fragment.code.add(c.glsl`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}`))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/ComponentShader.glsl":function(){define("exports ../geometry/support/Ellipsoid ../views/ViewingMode ../views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl ../views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L){function H(K){const I=new G.ShaderBuilder;I.include(m.VertexPosition,K);I.include(d.VertexNormal,K);I.include(e.VertexColor,K);I.include(k.TextureCoordinateAttribute,K);I.include(w.ForwardLinearDepth,K);I.include(g.ComponentData,K);I.include(D.DiscardOrAdjustAlpha,K);I.include(f.Slice,K);I.include(A.ReadBaseColorTexture,K);I.include(h.VertexDiscardByOpacity,K);I.fragment.uniforms.add("view","mat4");if(K.pbrMode===y.PBRMode.Normal||
K.pbrMode===y.PBRMode.Schematic)I.include(y.PhysicallyBasedRenderingParameters,K),K.hasNormalTexture&&I.include(r.ComputeNormalTexture,K);K.output===n.ShaderOutput.Shadow&&K.componentData===g.ComponentDataType.Varying?I.vertex.code.add(F.glsl`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):I.vertex.code.add(F.glsl`#define discardShadows(castShadows) {}`);const O=K.overlayEnabled&&K.output===n.ShaderOutput.Color&&K.pbrMode===y.PBRMode.WaterOnIntegratedMesh;
K.overlayEnabled&&(I.include(u.EvaluateSceneLighting,K),I.include(B.Overlay,K),K.viewingMode===c.ViewingMode.Global?I.vertex.code.add(F.glsl`
      const float invEllipsoidRadius = ${F.glsl.float(1/(K.ellipsoidMode===C.EllipsoidMode.Earth?b.earth.radius:K.ellipsoidMode===C.EllipsoidMode.Mars?b.mars.radius:b.moon.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):I.vertex.code.add(F.glsl`vec2 projectOverlay(vec3 pos) { return pos.xy; }`));O&&(I.varyings.add("tbnTangent","vec3"),I.varyings.add("tbnBiTangent","vec3"),I.varyings.add("groundNormal","vec3"),I.varyings.add("positionView","vec3"));I.vertex.code.add(F.glsl`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      if (externalColor.a < ${F.glsl.float(D.symbolAlphaCutoff)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
      forwardPosition();
      forwardNormal();
      ${O?F.glsl`
        positionView = position_view();
        ${K.viewingMode===c.ViewingMode.Global?F.glsl`
        groundNormal = normalize(positionWorld());
        tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
        tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:F.glsl`
        groundNormal = vec3(0.0, 0.0, 1.0);
        tbnTangent = vec3(1.0, 0.0, 0.0);
        tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`}
        `:""}

      ${K.overlayEnabled?F.glsl`setOverlayVTC(projectOverlay(position));`:""}
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth(); // depends on forwardPosition()
    }
  `);K.output===n.ShaderOutput.Alpha&&(I.fragment.include(q.ReadLinearDepth),K.multipassTerrainEnabled&&I.include(E.multipassTerrainTest,K),I.include(t.ComputeMaterialColor,K),I.fragment.code.add(F.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${K.multipassTerrainEnabled?F.glsl`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${K.overlayEnabled?F.glsl`
        vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
        vec4 overlayColor = overlayOpacity * overlayColorOpaque;
        materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `));K.output===n.ShaderOutput.Color&&(I.fragment.include(q.ReadLinearDepth),K.multipassTerrainEnabled&&I.include(E.multipassTerrainTest,K),I.include(t.ComputeMaterialColor,K),I.include(x.ComputeShadingNormal,K),I.include(u.EvaluateSceneLighting,K),O&&I.fragment.uniforms.add("ovNormalTex","sampler2D"),K.receiveShadows?(I.include(p.ReadShadowMap,K),I.fragment.code.add(F.glsl`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):I.fragment.code.add(F.glsl`float evaluateShadow() { return 0.0; }`),I.fragment.code.add(F.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${K.multipassTerrainEnabled?F.glsl`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${K.overlayEnabled?F.glsl`
        vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
        vec4 overlayColor = overlayOpacity * overlayColorOpaque;
        materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}
    `),K.pbrMode===y.PBRMode.Normal||K.pbrMode===y.PBRMode.Schematic?(I.fragment.code.add(F.glsl`
        ${K.pbrMode===y.PBRMode.Normal?F.glsl`
        applyPBRFactors();
        if (int(externalColorMixMode) == 3) {
          mrr = vec3(0.0, 0.6, 0.2);
        }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * lightingMainIntensity[2];
      `),K.hasNormalTexture?I.fragment.code.add(F.glsl`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):I.fragment.code.add(F.glsl`vec3 shadingNormal = normalVertex;`),I.fragment.code.add(F.glsl`${K.viewingMode===c.ViewingMode.Global?F.glsl`vec3 normalGround = normalize(positionWorld());`:F.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),I.fragment.code.add(F.glsl`vec3 viewDir = normalize(vPositionWorldCameraRelative);
float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());
vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);`)):(K.receiveShadows?I.fragment.code.add(F.glsl`float shadow = evaluateShadow();`):K.viewingMode===c.ViewingMode.Global?I.fragment.code.add(F.glsl`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`):I.fragment.code.add(F.glsl`float shadow = 0.0;`),I.fragment.code.add(F.glsl`
      float ambientOcclusion = evaluateAmbientOcclusion();
      // At global scale we create some additional ambient light based on the main light to simulate global illumination
      vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());
      vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${O?F.glsl`
          vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
          float waterNormalLength = length(overlayWaterMask);
          if (waterNormalLength > 0.95) {
            mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
            vec4 waterOverlayColor = vec4(overlayColorOpaque.xyz, overlayColor.w);
            vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, positionView, positionWorld());
            vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
            // un-gamma the ground color to mix in linear space
            shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
          }`:""}
      `)),I.fragment.code.add(F.glsl`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${K.oitEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));if(K.output===n.ShaderOutput.Depth||K.output===n.ShaderOutput.Shadow)I.include(z.OutputDepth,K),I.fragment.code.add(F.glsl`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`);K.output===n.ShaderOutput.Normal&&(I.include(x.ComputeShadingNormal,K),I.fragment.code.add(F.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${K.normalType===l.NormalAttributeType.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `));K.output===n.ShaderOutput.Highlight&&(I.include(v.OutputHighlight),I.fragment.code.add(F.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${K.overlayEnabled?F.glsl`
        vec4 overlayColor = getCombinedOverlayColor();

        if (overlayColor.a == 0.0) {
          gl_FragColor = vec4(0.0);
          return;
        }`:""}

        outputHighlight();
      }
    `));return I}L=new Map([[L.VertexAttribute.POSITION,0],[L.VertexAttribute.NORMAL,1],[L.VertexAttribute.NORMALCOMPRESSED,1],[L.VertexAttribute.COLOR,2],[L.VertexAttribute.UV0,3],[L.VertexAttribute.UVREGION,4],[L.VertexAttribute.COMPONENTINDEX,5]]);const M=Object.freeze({__proto__:null,attributeLocations:L,build:H});a.ComponentShader=M;a.attributeLocations=L;a.build=H})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl":function(){define(["exports","../../../../core/shaderModules/interfaces"],
function(a,b){a.VertexDiscardMode=void 0;(function(c){c[c.None=0]="None";c[c.Transparent=1]="Transparent";c[c.Opaque=2]="Opaque";c[c.COUNT=3]="COUNT"})(a.VertexDiscardMode||(a.VertexDiscardMode={}));a.VertexDiscardByOpacity=function(c,g){c=c.vertex;c.code.add(b.glsl`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`);switch(g.vertexDiscardMode){case a.VertexDiscardMode.None:c.code.add(b.glsl`#define vertexDiscardByOpacity(_opacity_) {}`);break;case a.VertexDiscardMode.Opaque:c.code.add(b.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);
break;case a.VertexDiscardMode.Transparent:c.code.add(b.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl":function(){define(["exports","../attributes/VertexColor.glsl","../util/MixExternalColor.glsl","../../shaderModules/interfaces"],function(a,b,c,g){a.ComputeMaterialColor=
function(h,w){h.include(b.VertexColor,w);h.fragment.include(c.MixExternalColor);h=h.fragment;h.uniforms.add("baseColor","vec4");h.uniforms.add("objectOpacity","float");w.attributeColor?h.code.add(g.glsl`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):h.code.add(g.glsl`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`);h.code.add(g.glsl`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl":function(){define("exports ../../../../../../core/compilerUtils ../../../../../ViewingMode ../attributes/NormalAttribute.glsl ../attributes/VertexNormal.glsl ../attributes/VertexPosition.glsl ./Normals.glsl ../../shaderModules/interfaces".split(" "),function(a,b,c,g,h,w,n,f){a.ComputeShadingNormal=function(l,k){const e=l.fragment;switch(k.doubleSidedMode){case n.NormalsDoubleSidedMode.None:e.code.add(f.glsl`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case n.NormalsDoubleSidedMode.View:l.include(w.VertexPosition,k);e.code.add(f.glsl`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case n.NormalsDoubleSidedMode.WindingOrder:e.code.add(f.glsl`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:b.neverReached(k.doubleSidedMode);case n.NormalsDoubleSidedMode.COUNT:}switch(k.normalType){case g.NormalAttributeType.Attribute:case g.NormalAttributeType.CompressedAttribute:l.include(h.VertexNormal,k);e.code.add(f.glsl`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case g.NormalAttributeType.ScreenDerivative:l.extensions.add("GL_OES_standard_derivatives");l.include(w.VertexPosition,k);e.code.add(f.glsl`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case g.NormalAttributeType.Ground:k.viewingMode===c.ViewingMode.Global?(l.include(w.VertexPosition,k),e.code.add(f.glsl`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):k.viewingMode===c.ViewingMode.Local&&e.code.add(f.glsl`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`);l.extensions.add("GL_OES_standard_derivatives");e.code.add(f.glsl`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:b.neverReached(k.normalType);case g.NormalAttributeType.COUNT:}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl":function(){define(["exports","../attributes/TextureCoordinateAttribute.glsl","../attributes/VertexTextureCoordinates.glsl","../util/TextureAtlasLookup.glsl","../../shaderModules/interfaces"],function(a,b,c,g,h){a.ReadBaseColorTexture=function(w,n){const f=w.fragment;n.baseColorTexture?
(w.include(c.VertexTextureCoordinates,n),f.uniforms.add("baseColorTexture","sampler2D"),f.uniforms.add("baseColorTextureSize","vec2"),n.attributeTextureCoordinates===b.TextureCoordinateAttributeType.Atlas?(w.include(g.TextureAtlasLookup),f.code.add(h.glsl`vec4 readBaseColorTexture() {
return textureAtlasLookup(
baseColorTexture,
baseColorTextureSize,
vuv0,
vuvRegion
);
}`)):f.code.add(h.glsl`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`)):f.code.add(h.glsl`vec4 readBaseColorTexture() { return vec4(1.0); }`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode":function(){define(["exports","../../../../../../geometry/support/spatialReferenceUtils"],function(a,b){a.EllipsoidMode=void 0;(function(c){c[c.Earth=1]="Earth";c[c.Mars=2]="Mars";c[c.Moon=3]="Moon";c[c.COUNT=4]="COUNT"})(a.EllipsoidMode||(a.EllipsoidMode={}));a.getEllipsoidMode=function(c){return c&&b.isMars(c)?
a.EllipsoidMode.Mars:c&&b.isMoon(c)?a.EllipsoidMode.Moon:a.EllipsoidMode.Earth};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/renderPasses/AllRenderPasses":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/mat3f64 ../../../../../chunks/vec2f64 ../../../../../chunks/vec4f64 ../../../../../chunks/boundedPlane ../shaderLibrary/attributes/VertexPosition.glsl ../../lib/basicInterfaces".split(" "),function(a,b,c,g,h,w,
n,f){a.RenderPassIdentifier=void 0;(function(m){m[m.Material=0]="Material";m[m.ShadowMap=1]="ShadowMap";m[m.Highlight=2]="Highlight"})(a.RenderPassIdentifier||(a.RenderPassIdentifier={}));a.MaterialSubPass=void 0;(function(m){m[m.Color=0]="Color";m[m.Alpha=1]="Alpha";m[m.Depth=2]="Depth";m[m.Normal=3]="Normal"})(a.MaterialSubPass||(a.MaterialSubPass={}));let l=function(){this.viewTransform=new n.VertexPositionViewProjectionTransform;this.slicePlane=w.create()},k=function(m){function z(){var v=m.apply(this,
arguments)||this;v.identifier=a.RenderPassIdentifier.Material;v.slicePlaneEnabled=!0;v.transparent=!1;v.integratedMesh=!1;v.transformNormalViewFromGlobal=c.create();v.nearFar=g.create();v.inverseViewport=g.create();v.ambientOcclusionEnabled=!0;v.shadowsEnabled=!0;v.hasFillLights=!0;v.sceneHasOcludees=!1;v.transparencyPassType=f.TransparencyPassType.NONE;return v}b._inheritsLoose(z,m);return z}(l),e=function(m){function z(){var v=m.apply(this,arguments)||this;v.identifier=a.RenderPassIdentifier.ShadowMap;
v.nearFar=g.create();return v}b._inheritsLoose(z,m);return z}(l),d=function(m){function z(){var v=m.apply(this,arguments)||this;v.identifier=a.RenderPassIdentifier.Highlight;v.inverseViewport=g.create();v.viewport=h.create();return v}b._inheritsLoose(z,m);return z}(l);a.HighlightPassParameters=d;a.MaterialPassesParameters=k;a.PassParameters=l;a.ShadowMapPassParameters=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/material/MaterialBase":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function h(){this._dirty=!0}var w=h.prototype;w._setDirty=function(){this._dirty=!0};w._setClean=function(){this._dirty=!1;if(null!=this._parameterBlocks)for(const n of this._parameterBlocks)this[n]._setClean()};w._checkParameterBlocksDirty=function(){if(null==this._parameterBlocks)return!1;for(const n of this._parameterBlocks)if(this[n].dirty)return!0;return!1};b._createClass(h,[{key:"dirty",get:function(){return this._dirty||
this._checkParameterBlocksDirty()}}]);return h}(),g=function(){function h(){this._dirty=!0}var w=h.prototype;w._setDirty=function(){this._dirty=!0};w._setClean=function(){this._dirty=!1};b._createClass(h,[{key:"dirty",get:function(){return this._dirty}}]);return h}();a.MaterialBase=c;a.MaterialParameterBlock=g;a.parameter=function(h={}){return(w,n)=>{var f;const l=null!=(f=w._parameterCount)?f:0;w._parameterCount=l+1;if(h.vectorOps){const k=h.vectorOps;Object.defineProperty(w,n,{get(){return this[l]},
set(e){const d=this[l];if(null==d)this[l]=e;else{if(k.equals(d,e))return;k.copy(d,e)}this._setDirty()}})}else Object.defineProperty(w,n,{get(){return this[l]},set(k){this[l]!==k&&(h.dispose&&this[l]&&this[l].dispose(),this[l]=k,this._setDirty())}})}};a.parameterBlock=function(){return(h,w)=>{var n;const f=null!=(n=h._parameterCount)?n:0;h._parameterCount=f+1;h._parameterBlocks=h._parameterBlocks||[];h._parameterBlocks.push(f);Object.defineProperty(h,w,{get(){return this[f]},set(l){this[f]!==l&&(this[f]=
l,this._setDirty())}})}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/util/TwoVectorPosition":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/vec3","../../../../../chunks/vec3f32","../../../../../chunks/vec3f64"],function(a,b,c,g,h){let w=function(){function f(k){this._low=g.create();this._high=g.create();k&&this.set(k)}var l=f.prototype;l.set=function(k){const e=this._low,d=this._high;c.copy(e,k);c.sub(d,
k,e)};l.setElements=function(k,e,d){c.set(n,k,e,d);this.set(n)};l.get=function(k){return c.add(k,this._low,this._high)};l.getLowScaled=function(k){return c.scale(k,this._low,1)};b._createClass(f,[{key:"low",get:function(){return this._low}},{key:"high",get:function(){return this._high}}]);return f}();const n=h.create();a.TwoVectorPosition=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["exports","./ManagedTextureBackedBuffer"],
function(a,b){let c=function(){function g(w,n=1){this.rctx=w;this.fieldCount=n;this.buffers=[]}var h=g.prototype;h.garbageCollect=function(){this.buffers=this.buffers.filter(w=>0===w.activeCount?(w.dispose(),!1):!0)};h.destroy=function(){this.buffers.forEach(w=>w.dispose());this.buffers=[]};h.getBuffer=function(w){for(const n of this.buffers)if(n.availableCount>=w)return n;if(w>b.MAX_INDEX_COUNT)return null;w=new b.ManagedTextureBackedBuffer(this.rctx,this.fieldCount);this.buffers.push(w);return w};
h.updateTextures=function(){for(const w of this.buffers)w.textureBuffer.updateTexture()};return g}();a.BufferManager=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./SimpleIndexManager","./TextureBackedBuffer"],function(a,b,c,g){let h=function(){function w(f,l=1){this.textureBuffer=new g.TextureBackedBuffer(f,l);this.indexManager=new c.SimpleIndexManager(65536)}
var n=w.prototype;n.dispose=function(){this.textureBuffer.dispose();this.textureBuffer=void 0};n.acquireIndex=function(){const f=this.indexManager.acquire();this.textureBuffer.resizeToFit(f);return f};n.releaseIndex=function(f){this.indexManager.release(f)};b._createClass(w,[{key:"availableCount",get:function(){return this.indexManager.availableCount}},{key:"activeCount",get:function(){return this.indexManager.activeCount}}]);return w}();a.MAX_INDEX_COUNT=65536;a.ManagedTextureBackedBuffer=h;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function g(w){this.maxCount=w;this._nextIndex=0;this.recycledIndices=[]}var h=g.prototype;h.acquire=function(){if(0<this.recycledIndices.length)return this.recycledIndices.pop();if(this.availableCount)return this._nextIndex++};h.release=function(w){this.recycledIndices.push(w)};b._createClass(g,
[{key:"activeCount",get:function(){return this._nextIndex-this.recycledIndices.length}},{key:"availableCount",get:function(){return this.recycledIndices.length+this.maxCount-this._nextIndex}}]);return g}();a.SimpleIndexManager=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["exports","../../../../../geometry/support/buffer/BufferView","../../../../webgl/enums","../../../../webgl/Texture"],function(a,
b,c,g){let h=function(){function w(f,l=1){this.rctx=f;this.fieldCount=l;this.textureWidth=4096;this.dirty=!0;this.texture=new g.Texture(this.rctx,{target:c.TextureType.TEXTURE_2D,pixelFormat:c.PixelFormat.RGBA,dataType:c.PixelType.UNSIGNED_BYTE,samplingMode:c.TextureSamplingMode.NEAREST,wrapMode:c.TextureWrapMode.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1});this.data=new b.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}var n=w.prototype;n.dispose=function(){this.texture.dispose();
this.data=this.texture=void 0};n.setData=function(f,l,k,e,d,m){f=f*this.fieldCount+l;this.dirty=!0;this.data.set(f,0,k);this.data.set(f,1,e);this.data.set(f,2,d);this.data.set(f,3,m)};n.setDataElement=function(f,l,k,e){f=f*this.fieldCount+l;this.dirty=!0;this.data.set(f,k,e)};n.resizeToFit=function(f){f*=this.fieldCount;f>=this.data.count&&(f=new b.BufferViewVec4u8(new ArrayBuffer(Math.ceil((f+1)/this.textureWidth)*this.textureWidth*4)),f.typedBuffer.set(this.data.typedBuffer),this.data=f)};n.updateTexture=
function(){if(this.dirty){var f=this.texture.descriptor.width;this.data.count>f*this.texture.descriptor.height&&this.texture.resize(f,this.data.count/f);this.texture.setData(this.data.typedBuffer);this.dirty=!1}};n.bind=function(f,l,k){f.bindTexture(this.texture,l);f.setUniform2f(k,1/this.texture.descriptor.width,1/this.texture.descriptor.height)};return w}();a.TextureBackedBuffer=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/CompositingHelper":function(){define("../../../../core/maybe ../../terrain/interfaces ./glUtil3D ../../../../chunks/Compositing.glsl ../shaders/CompositingTechnique ../../../webgl/enums ../../../webgl/Util".split(" "),
function(a,b,c,g,h,w,n){let f=function(){function k(d,m){this._rctx=d;this._techniqueRepository=m}var e=k.prototype;e.dispose=function(){this._vao=a.disposeMaybe(this._vao)};e.compositeTransparent=function(d,m,z,v=1){const q=this._rctx;l.alphaMode=h.AlphaMode.Alpha;l.function=g.CompositingFunction.Transparency;l.hasOpacityFactor=1!==v;v=this._techniqueRepository.acquire(h.CompositingTechnique,l);const t=q.useTechnique(v);t.bindTexture(d,"colorTexture");t.bindTexture(m,"alphaTexture");t.bindTexture(z,
"frontFaceTexture");d=this._ensureVAO();q.bindVAO(d);q.drawArrays(w.PrimitiveType.TRIANGLE_STRIP,0,n.vertexCount(d,"geometry"));v.release()};e.composite=function(d,m=h.AlphaMode.None,z=1,v=g.CompositingFunction.Standard,q=b.OverlayIndex.INNER){const t=this._rctx;l.alphaMode=m;l.function=v;l.hasOpacityFactor=1!==z;m=this._techniqueRepository.acquire(h.CompositingTechnique,l);const r=t.useTechnique(m);r.bindTexture(d,"tex");l.hasOpacityFactor&&r.setUniform1f("opacity",z);v===g.CompositingFunction.OverlayWithTransparency&&
r.setUniform1i("overlayIdx",q);d=this._ensureVAO();t.bindVAO(d);t.drawArrays(w.PrimitiveType.TRIANGLE_STRIP,0,n.vertexCount(d,"geometry"));m.release()};e._ensureVAO=function(){a.isNone(this._vao)&&(this._vao=c.createQuadVAO(this._rctx));return this._vao};return k}();const l=new h.CompositingTechniqueConfiguration;return f})},"esri/views/3d/webgl-engine/lib/depthRangeUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/floatRGBA ../../../../core/maybe ../../../../core/PooledArray ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../chunks/sphere ../../support/mathUtils ./depthRange ./Octree ./Util".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q){function t(K,I){if(I.isVisible){var O=z.empty(),Q=I.getSpatialQueryAccelerator();g.isSome(Q)?r(O,K,Q):x(O,K,I.objects);return O}}function r(K,I,O){var Q=I.eye;const J=I.viewForward,P=I.frustum,N=S=>S.isVisible;var R=O.objectCount;500>R?(z.set(G,I.near,Math.min(K.near,I.far)),O.forEachInDepthRange(Q,J,v.DepthOrder.FRONT_TO_BACK,G,(S,T)=>{u(K,I,S);G.far=K.near;T.setRange(G)},P,N),z.set(G,Math.max(K.far,I.near),I.far),O.forEachInDepthRange(Q,J,v.DepthOrder.BACK_TO_FRONT,
G,(S,T)=>{u(K,I,S);G.near=K.far;T.setRange(G)},P,N)):(R=Math.max(Math.min(R,500),Math.ceil(.1*R)),Q=O.findClosest(J,v.DepthOrder.FRONT_TO_BACK,P,N,R),O=O.findClosest(J,v.DepthOrder.BACK_TO_FRONT,P,N,R),Q&&O&&(y(K,I,Q.boundingVolumeWorldSpace.bounds),y(K,I,O.boundingVolumeWorldSpace.bounds)))}function x(K,I,O){L.clear();O.forAll(Q=>{Q.isVisible&&0!==Q.geometryRecords.length&&L.add(Q)});L.empty||(L.sort(I),z.set(G,I.near,Math.min(K.near,I.far)),L.forEachInDepthRange(G,v.DepthOrder.FRONT_TO_BACK,(Q,
J)=>{J<K.near&&u(K,I,Q)}),z.set(G,Math.max(K.far,I.near),I.far),L.forEachInDepthRange(G,v.DepthOrder.BACK_TO_FRONT,(Q,J,P)=>{K.far=Math.max(K.far,P)}))}function u(K,I,O){if(O.isVisible&&e.intersectsSphere(I.frustum,O.boundingVolumeWorldSpace.bounds)){var Q=O.transformation,J=F;O.geometryRecords.forEach(P=>{w.multiply(J,Q,P.getShaderTransformation());const N=m.maxScale(J);E(K,I,P.geometry.boundingInfo,J,N)})}}function E(K,I,O,Q,J){if(!g.isNone(O)){var P=I.eye,N=I.viewForward;f.transformMat4(C,O.center,
Q);P=N[0]*(C[0]-P[0])+N[1]*(C[1]-P[1])+N[2]*(C[2]-P[2]);C[3]=O.radius*J;if(!(P-C[3]>K.near&&P+C[3]<K.far)&&e.intersectsSphere(I.frustum,C))if(100<O.radius&&O.getChildren())for(O=O.getChildren(),P=0;8>P;++P)O[P]&&E(K,I,O[P],Q,J);else M.unionDepthRangeWithAABB(K,I.viewProjectionMatrix,Q,O.bbMin,O.bbMax)}}function y(K,I,O){var Q=I.eye;I=I.viewForward;Q=(O[0]-Q[0])*I[0]+(O[1]-Q[1])*I[1]+(O[2]-Q[2])*I[2];K.near=Math.min(K.near,Q-O[3]);K.far=Math.max(K.far,Q+O[3])}let A=function(){function K(){this._items=
new h({allocator:O=>O||{obj:null,distance:0,near:0,far:0},deallocator:O=>{O.obj=null;O.distance=0;O.near=0;O.far=0;return O}})}var I=K.prototype;I.clear=function(){this._items.clear()};I.add=function(O){this._items.pushNew().obj=O};I.sort=function(O){const Q=O.eye,J=O.viewForward;this._items.forAll(P=>{const N=P.obj.boundingVolumeWorldSpace.bounds,R=(N[0]-Q[0])*J[0]+(N[1]-Q[1])*J[1]+(N[2]-Q[2])*J[2];P.distance=R;P.near=R-N[3];P.far=R+N[3]});this._items.sort((P,N)=>P.distance-N.distance)};I.forEachInDepthRange=
function(O,Q,J){if(Q===v.DepthOrder.FRONT_TO_BACK)for(Q=0;Q<this._items.length;++Q){var P=this._items.data[Q];P.far<O.near||P.near>O.far||J(P.obj,P.near,P.far)}else for(Q=this._items.length-1;0<=Q;--Q)P=this._items.data[Q],P.far<O.near||P.near>O.far||J(P.obj,P.near,P.far)};b._createClass(K,[{key:"length",get:function(){return this._items.length}},{key:"empty",get:function(){return 0===this._items.length}}]);return K}(),p=function(){function K(){this.view=n.create();this.viewProj=n.create();this.frustum=
e.create();this.geometries=[];this.near=[];this.far=[];this.nearCandidates=[];this.farCandidates=[];this.range={near:0,far:0};this.looseRange={near:0,far:0}}var I=K.prototype;I.compute=function(O,Q){this._reset();w.copy(this.view,O.viewMatrix);w.multiply(this.viewProj,O.projectionMatrix,this.view);e.copy(this.frustum,O.frustum);O=this.view;const J=O[2],P=O[6],N=O[10],R=O[14];O=this.range;let S=0;Q.forEach(W=>{if(W.instanceParameters.visible&&W.castShadow){if(W.hasShaderTransformation){W.computeBoundingSphere(W.getShaderTransformation(),
C,1);var U=C}else U=W.boundingSphere;var aa=J*U[0]+P*U[1]+N*U[2]+R,da=aa-U[3];U=aa+U[3];this.geometries[S]=W;this.near[S]=-U;this.far[S]=-da;++S}});if(0===this.geometries.length)return O;for(Q=0;Q<this.geometries.length;++Q)this.near[Q]>O.far&&(O.far=this.near[Q]),2<this.near[Q]&&this.far[Q]<O.near&&(O.near=this.far[Q]);Q=this.looseRange;Q.near=Math.max(.5*O.near,2);Q.far=2*O.far;var T=0;let V=0;for(let W=0;W<this.geometries.length;++W)this.near[W]<O.near&&(this.near[W]>=Q.near?O.near=this.near[W]:
this.nearCandidates[T++]=W),this.far[W]>O.far&&(this.far[W]<=Q.far?O.far=this.far[W]:this.farCandidates[V++]=W);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return O;this.nearCandidates.sort((W,U)=>this.near[W]<this.near[U]?-1:this.near[W]>this.near[U]?1:0);this.farCandidates.sort((W,U)=>this.far[W]<this.far[U]?1:this.far[W]>this.far[U]?-1:0);for(Q=0;Q<this.nearCandidates.length;++Q)T=this.nearCandidates[Q],this.near[T]<O.near&&(T=this.geometries[T],this._includeNearBoundingInfoRec(T.boundingInfo,
T.getShaderTransformation()));for(Q=0;Q<this.farCandidates.length;++Q)T=this.farCandidates[Q],this.far[T]>O.far&&(T=this.geometries[T],this._includeFarBoundingInfoRec(T.boundingInfo,T.getShaderTransformation()));return O};I._reset=function(){this.geometries.length=0;this.near.length=0;this.far.length=0;this.nearCandidates.length=0;this.farCandidates.length=0;this.range.near=Number.MAX_VALUE;this.range.far=-Number.MAX_VALUE};I._includeNearBoundingInfoRec=function(O,Q){if(!g.isNone(O)){var J=O.getCenter();
f.transformMat4(C,J,Q);J=m.maxScale(Q);var P=C[0],N=C[1],R=C[2];J*=O.getBSRadius();var S=this.frustum;if(!(S[0][0]*P+S[0][1]*N+S[0][2]*R+S[0][3]>J||S[1][0]*P+S[1][1]*N+S[1][2]*R+S[1][3]>J||S[2][0]*P+S[2][1]*N+S[2][2]*R+S[2][3]>J||S[3][0]*P+S[3][1]*N+S[3][2]*R+S[3][3]>J||(P=this.view[2]*P+this.view[6]*N+this.view[10]*R+this.view[14],N=P+J,2>-(P-J)||-N>=this.range.near)))if(-N>this.looseRange.near)this.range.near=-N;else{if(100<J&&(J=O.getChildren(),void 0!==J)){for(O=0;8>O;++O)void 0!==J[O]&&this._includeNearBoundingInfoRec(J[O],
Q);return}M.unionDepthRangeWithAABB(this.range,this.viewProj,Q,O.getBBMin(),O.getBBMax())}}};I._includeFarBoundingInfoRec=function(O,Q){if(!g.isNone(O)){var J=O.getBSRadius(),P=O.getCenter();f.transformMat4(C,P,Q);var N=m.maxScale(Q);P=C[0];var R=C[1],S=C[2];J*=N;N=this.frustum;if(!(N[0][0]*P+N[0][1]*R+N[0][2]*S+N[0][3]>J||N[1][0]*P+N[1][1]*R+N[1][2]*S+N[1][3]>J||N[2][0]*P+N[2][1]*R+N[2][2]*S+N[2][3]>J||N[3][0]*P+N[3][1]*R+N[3][2]*S+N[3][3]>J||(P=this.view[2]*P+this.view[6]*R+this.view[10]*S+this.view[14]-
J,-P<=this.range.far)))if(-P<this.looseRange.far)this.range.far=-P;else{if(100<J&&(J=O.getChildren(),void 0!==J)){for(O=0;8>O;++O)void 0!==J[O]&&this._includeFarBoundingInfoRec(J[O],Q);return}M.unionDepthRangeWithAABB(this.range,this.viewProj,Q,O.getBBMin(),O.getBBMax())}}};return K}(),B=function(){function K(){this.modelViewProj=n.create();this.clipPosition=[k.create(),k.create(),k.create(),k.create(),k.create(),k.create(),k.create(),k.create()]}var I=K.prototype;I.unionDepthRangeWithAABB=function(O,
Q,J,P,N){var R=this.modelViewProj;w.multiply(R,Q,J);Q=!1;for(J=0;8>J;++J){const S=this.clipPosition[J],T=0===J||3===J||4===J||7===J?P[0]:N[0],V=0===J||1===J||4===J||5===J?P[1]:N[1],W=4>J?P[2]:N[2];S[0]=R[0]*T+R[4]*V+R[8]*W+R[12];S[1]=R[1]*T+R[5]*V+R[9]*W+R[13];S[2]=R[2]*T+R[6]*V+R[10]*W+R[14];S[3]=R[3]*T+R[7]*V+R[11]*W+R[15]}for(P=0;12>P;++P){N=this._clipTriangle(this.clipPosition[D[P][0]],this.clipPosition[D[P][1]],this.clipPosition[D[P][2]]);R=!0;for(J=0;J<N.length;++J)if(2<=N[J][3]){R=!1;break}if(!R)for(Q=
!0,R=0;R<N.length;++R)J=N[R][3],J<O.near&&(O.near=J),J>O.far&&(O.far=J)}return Q};I._inside=function(O,Q){if(0===Q)return O[0]>=-O[3];if(1===Q)return O[1]>=-O[3];if(2===Q)return O[0]<=O[3];if(3===Q)return O[1]<=O[3];q.assert(!1)};I._intersect=function(O,Q,J){let P=0;0===J?P=(-O[3]-O[0])/(Q[0]-O[0]+Q[3]-O[3]):1===J?P=(-O[3]-O[1])/(Q[1]-O[1]+Q[3]-O[3]):2===J?P=(O[3]-O[0])/(Q[0]-O[0]-Q[3]+O[3]):3===J&&(P=(O[3]-O[1])/(Q[1]-O[1]-Q[3]+O[3]));return l.lerp(k.create(),O,Q,P)};I._clipTriangle=function(O,Q,
J){O=[O,Q,J];for(Q=0;4>Q;++Q){J=O;O=[];for(let P=0;P<J.length;++P){const N=J[P],R=J[(P+1)%J.length];this._inside(R,Q)?(this._inside(N,Q)||O.push(this._intersect(N,R,Q)),O.push(R)):this._inside(N,Q)&&O.push(this._intersect(N,R,Q))}}return O};return K}();const D=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],C=d.create(),F=n.create(),G=z.empty(),L=new A,H=new p,M=new B;a.DepthRangeFromRenderGeometries=p;a.depthRangeFromLayer=t;a.depthRangeFromScene=
function(K,I,O){if(1E4>I.size)return H.compute(K,I);const Q=z.empty();O.forAll(J=>{J.isVisible&&z.union(Q,t(K,J))});return Q};a.textureToDepth=function(K,I,O){return c.unpackFloatRGBA(I,K)*(O[1]-O[0])+O[0]};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/MagnifierHelper":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../support/requestImageUtils ./DefaultVertexBufferLayouts ./glUtil3D ./Program ./VertexAttribute ../shaders/Magnifier.glsl ../../../magnifier/resources ../../../webgl/enums ../../../webgl/renderState ../../../webgl/Texture".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D){a.MagnifierHelper=function(C){function F(){var L=C.apply(this,arguments)||this;L._handles=new w;L._magnifier=null;L._imageSources=null;L._imageLoadTask=null;L._resources=null;L.events=new h;L.attributeLocations=new Map([[E.VertexAttribute.POSITION,0]]);L.tmpScreenPoint=k.createScreenPointArray();L.tmpRenderPoint=k.createRenderScreenPointArray();return L}b._inheritsLoose(F,C);var G=F.prototype;G.dispose=function(){this._magnifier=null;this._handles.destroy();
f.isSome(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null);this._disposeResources()};G.render=function(L,H){const M=this._validMagnifier;if(!f.isNone(M)){var K=H.camera.pixelRatio,I=Math.ceil(K*M.size);this._updateResources(L,I);if(!f.isNone(this._resources)){var O=this._resources.program;L.useProgram(O);var Q=this._resources.textures,J=Math.ceil(1/this.factor*I);Q.input.resize(J,J);var P=H.camera.fullWidth,N=H.camera.fullHeight;k.screenPointObjectToArray(M.position,
this.tmpScreenPoint);H=H.camera.screenToRender(this.tmpScreenPoint,this.tmpRenderPoint);var R=.5*J,S=.5*J;H[0]=n.clamp(H[0],R,P-R-1);H[1]=n.clamp(H[1],S,N-S-1);R=Math.floor(H[0]-R);S=Math.floor(H[1]-S);O.bindTexture(Q.input,"textureInput");L.gl.copyTexImage2D(Q.input.descriptor.target,0,Q.input.descriptor.pixelFormat,R,S,J,J,0);J=-1+(H[0]+M.offset.x*K)/P*2;K=-1+(H[1]-M.offset.y*K)/N*2;P=I/P*2;I=I/N*2;L.bindVAO(this._resources.vao);O.bindTexture(Q.overlay,"textureOverlay");O.bindTexture(Q.mask,"textureMask");
O.setUniform4f("drawPosition",J,K,P,I);O.setUniform1b("maskEnabled",M.maskEnabled);O.setUniform1b("overlayEnabled",M.overlayEnabled);L.setPipelineState(this._resources.pipelineState);L.drawArrays(p.PrimitiveType.TRIANGLE_STRIP,0,4)}}};G._updateResourceLoading=function(){var L=this;const H=this._validMagnifier;if(!f.isNone(H)){var M=H.maskUrl,K=H.overlayUrl;!f.isSome(this._imageLoadTask)||this._imageLoadTask.maskUrl===M&&this._imageLoadTask.overlayUrl===K||(this._imageLoadTask.task.abort(),this._imageSources=
this._imageLoadTask=null);f.isSome(this._imageSources)||f.isSome(this._imageLoadTask)||(this._imageLoadTask={maskUrl:M,overlayUrl:K,task:l.createTask(function(){var I=b._asyncToGenerator(function*(O){const Q=f.isNone(M)||f.isNone(K)?A.loadMagnifierResources(O):null,J=f.isSome(M)?t.requestImage(M,{signal:O}):Q.then(P=>P.mask);O=f.isSome(K)?t.requestImage(K,{signal:O}):Q.then(P=>P.overlay);L._imageSources={mask:yield J,overlay:yield O};L._disposeResources();L.events.emit("request-render")});return function(O){return I.apply(this,
arguments)}}())},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}};G._updateResources=function(L,H){this.enabled?f.isSome(this._resources)?this._resources.textures.size!==H&&(L=this._createTextureResources(L,H),f.isNone(L)?this._disposeResources():(this._disposeTextureResources(this._resources.textures),this._resources.textures=L)):(H=this._createTextureResources(L,H),f.isNone(H)||(this._resources={textures:H,program:this._createProgram(L),
vao:x.createQuadVAO(L,r.Pos2,this.attributeLocations,0,1),pipelineState:B.makePipelineState({blending:B.simpleBlendingParams(p.BlendFactor.ONE,p.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:B.defaultColorWriteParams})})):this._disposeResources()};G._disposeResources=function(){f.isNone(this._resources)||(this._disposeTextureResources(this._resources.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)};G._disposeTextureResources=
function(L){L.mask.dispose();L.overlay.dispose();L.input.dispose()};G._createTextureResources=function(L,H){if(f.isNone(this._imageSources))return null;this._imageSources.overlay.width=H;this._imageSources.overlay.height=H;this._imageSources.mask.width=H;this._imageSources.mask.height=H;const M=new D.Texture(L,{target:p.TextureType.TEXTURE_2D,pixelFormat:p.PixelFormat.RGBA,internalFormat:p.PixelFormat.RGBA,dataType:p.PixelType.UNSIGNED_BYTE,wrapMode:p.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:p.TextureSamplingMode.LINEAR,
flipped:!0,preMultiplyAlpha:e.isSVG(this._imageSources.overlay.src)&&L.driverTest.svgAlwaysPremultipliesAlpha?!1:!0},this._imageSources.overlay),K=new D.Texture(L,{target:p.TextureType.TEXTURE_2D,pixelFormat:p.PixelFormat.ALPHA,internalFormat:p.PixelFormat.ALPHA,dataType:p.PixelType.UNSIGNED_BYTE,wrapMode:p.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:p.TextureSamplingMode.LINEAR,flipped:!0},this._imageSources.mask);return{input:new D.Texture(L,{target:p.TextureType.TEXTURE_2D,pixelFormat:p.PixelFormat.RGBA,
internalFormat:p.PixelFormat.RGBA,dataType:p.PixelType.UNSIGNED_BYTE,wrapMode:p.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:p.TextureSamplingMode.LINEAR,flipped:!1}),mask:K,overlay:M,size:H}};G._createProgram=function(L){const H=y.build();return new u.Program(L,H,this.attributeLocations)};b._createClass(F,[{key:"updating",get:function(){return f.isNone(this._imageSources)&&f.isSome(this._imageLoadTask)&&!this._imageLoadTask.task.finished}},{key:"magnifier",get:function(){return this._magnifier},set:function(L){L!==
this._magnifier&&(this._handles.removeAll(),this._magnifier=L,L=()=>{this._updateResourceLoading();this.events.emit("request-render")},f.isSome(this._magnifier)&&this._handles.add(this._magnifier.watch("version",L)),L())}},{key:"enabled",get:function(){return f.isSome(this._validMagnifier)}},{key:"_validMagnifier",get:function(){return f.isSome(this._magnifier)&&this._magnifier.visible&&f.isSome(this._magnifier.position)&&0<this._magnifier.size?this._magnifier:null}},{key:"factor",get:function(){return f.isSome(this._magnifier)?
this._magnifier.factor||1:1}}]);return F}(g);c.__decorate([d.property()],a.MagnifierHelper.prototype,"_imageSources",void 0);c.__decorate([d.property()],a.MagnifierHelper.prototype,"_imageLoadTask",void 0);c.__decorate([d.property({readOnly:!0})],a.MagnifierHelper.prototype,"updating",null);a.MagnifierHelper=c.__decorate([q.subclass("esri/views/3d/webgl-engine/lib/MagnifierHelper")],a.MagnifierHelper);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/Magnifier.glsl":function(){define(["exports",
"../core/shaderModules/interfaces","../core/shaderModules/ShaderBuilder","../lib/VertexAttribute"],function(a,b,c,g){a.build=function(){const h=new c.ShaderBuilder;h.attributes.add(g.VertexAttribute.POSITION,"vec2");h.vertex.uniforms.add("proj","mat4");h.vertex.uniforms.add("drawPosition","vec4");h.varyings.add("vUV","vec2");h.vertex.code.add(b.glsl`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`);h.fragment.uniforms.add("textureInput","sampler2D");h.fragment.uniforms.add("textureMask","sampler2D");h.fragment.uniforms.add("textureOverlay","sampler2D");h.fragment.uniforms.add("maskEnabled","bool");h.fragment.uniforms.add("overlayEnabled","bool");h.fragment.code.add(b.glsl`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`);return h};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/magnifier/resources":function(){define(["require","exports","../../chunks/_rollupPluginBabelHelpers","../../core/promiseUtils","../../support/requestImageUtils"],function(a,b,c,g,h){function w(){w=c._asyncToGenerator(function*(n){var f=new Promise((k,e)=>a(["./mask-svg"],d=>k(Object.freeze({__proto__:null,default:d})),e)),l=new Promise((k,e)=>a(["./overlay-svg"],d=>k(Object.freeze({__proto__:null,default:d})),e));f=h.requestImage((yield f).default,
{signal:n});l=h.requestImage((yield l).default,{signal:n});l={mask:yield f,overlay:yield l};g.throwIfAborted(n);return l});return w.apply(this,arguments)}b.loadMagnifierResources=function(n){return w.apply(this,arguments)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/MapUtils ../../../../core/maybe ../../../../core/time ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../support/animationUtils ../../support/debugFlags ../core/renderPasses/RenderPassManager ../core/shaderLibrary/hud/HUDUniforms ./basicInterfaces ./BoundingInfo ./depthRange ./depthRangeUtils ./glUtil3D ./HighlightHelper ./Material ./OffscreenRendering ./RenderContext ./rendererUtils ./RenderPass ./RenderPluginManager ./RenderSlot ./ShadowAccumulator ./ShadowHighlightHelper ./ShadowMap ./SliceHelper ./SmaaRenderPass ./SSAOHelper ./edgeRendering/EdgeView ./edgeRendering/interfaces ../lighting/SceneLighting ../materials/renderers/MergedRenderer ../shaders/CompositingTechnique ../shaders/ShadowHighlightTechnique ../statistics/RendererPerformanceInfo ../../../webgl/enums ../../../webgl/Measurement".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H,M,K,I,O,Q,J,P,N,R,S,T,V,W,U,aa,da,Y,ea){a.Renderer=function(Z){function ha(pa,xa,Da,ua,Fa,qa,sa,ma,ra){var va=Z.call(this,{})||this;va._materialRepository=pa;va._shaderTechniqueRepository=Da;va._rctx=ua;va._compositingHelper=Fa;va._magnifierHelper=qa;va._requestRender=sa;va._stage=ra;va._materialRenderers=new Map;va._needsTransparentPass=!1;va._hasHUDElements=!1;va._hasHighlights=!1;va._hasOccludees=!1;va._hasWater=!1;va._hasOverlayWater=
!1;va._content=new Map;va._isRendering=!1;va._fallbackDepthStencilTexture=null;va.performanceInfo=new da.RendererPerformanceInfo;va._antialiasing=y.AntiAliasingMode.SMAA;va._oitEnabled=!1;va._multipassTerrain=!0;va._opaqueTerrain=!0;va._lighting=new V.SceneLighting;va._hasAnimations=!1;va._animationTimestep=f.Milliseconds(0);va._handles=new h;va._renderHiddenTransparentEdges=()=>{};va._oitUsed=!1;va._smaaPass=new N.SmaaRenderPass(va._rctx,Da);va._oitEnabled=va._hasOITSupport;va._requestRender();va._offscreenRendering=
new G.OffscreenRendering(va._rctx,va._compositingHelper);va._sliceHelper=new P;va._shadowMap=new J(va._rctx,ra.viewingMode,2);va._ssaoHelper=new R.SSAOHelper(Da,va._rctx,()=>va._requestRender());va._highlightHelper=new C(Da,va._rctx);va._shadowHighlightHelper=new Q.ShadowHighlightHelper(va._rctx,ra.viewingMode);va._shadowAccumulator=new O.ShadowAccumulator(va._rctx,Da,ra,(Ia,Ja)=>{va.renderPassManager.shadowCastingEnabled=!0;va._renderPlugins.prepareRender(Ia,Ja);va.renderPassManager.shadowCastingEnabled=
va._shadowMap.enabled},(Ia,Ja,Ha,Ta)=>{Ia.start(Ha,Ja,Ta);va._renderShadowCascades(M.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL,Ia);Ha.setGLViewport(va._rctx);va._ensureCameraBindParameters(Ha)},()=>va._requestRender());va._bindParameters={slot:null,camera:null,inverseViewport:t.create(),shadowMap:va._shadowMap,shadowMappingEnabled:va._shadowMap.enabled,ssaoHelper:va._ssaoHelper,ssaoEnabled:va._ssaoHelper.enabled,origin:null,screenToWorldRatio:null,screenToPCSRatio:null,slicePlane:va._sliceHelper.plane,
highlightDepthTexture:null,hasOccludees:!1,linearDepthTexture:null,terrainLinearDepthTexture:null,geometryLinearDepthTexture:null,multipassTerrainEnabled:!1,multipassGeometryEnabled:!1,cullAboveGround:!1,lastFrameColorTexture:null,reprojectionMatrix:q.IDENTITY,ssrEnabled:!1,lighting:va._lighting,highlightColorTexture:null,cloudsCompositionParams:null,hasFillLights:!0};va._renderContext=new L.RenderContext(va._rctx,va._offscreenRendering,va._lighting,va._shadowMap,va._ssaoHelper,va._sliceHelper);va._renderContext.multipassTerrainParams=
{camera:null,multipassTerrainEnabled:!1,cullAboveGround:!1,terrainLinearDepthTexture:null};va._renderContext.multipassGeometryParams={multipassGeometryEnabled:!1,geometryLinearDepthTexture:null};va._renderContext.ssrParams={camera:null,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMatrix:q.IDENTITY,ssrEnabled:!1};va._renderPlugins=new K.RenderPluginManager({renderContext:va._renderContext,shaderTechniqueRepository:Da,textureRep:xa,materialRep:va._materialRepository,requestRender:va._requestRender,
schedule:ma});va.renderPassManager=new u.RenderPassManager(va._rctx,va._shaderTechniqueRepository);va._renderPlugins.add(va.renderPassManager.slots(),va.renderPassManager);va._handles.add([l.init(x,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",Ia=>{va._renderHiddenTransparentEdges=Ia?()=>va._renderEdges(T.Transparency.TRANSPARENT):()=>{};va._requestRender()}),l.init(va._stage,"camera",()=>va._requestRender(),!0)]);return va}b._inheritsLoose(ha,Z);var na=ha.prototype;na.normalizeCtorArgs=function(){return{}};
na.dispose=function(){this._handles.destroy();this._smaaPass.dispose();this._materialRenderers.forEach(pa=>pa.dispose());this._materialRenderers.clear();this._edgeView=n.destroyMaybe(this._edgeView);this._offscreenRendering.dispose();this._fallbackDepthStencilTexture=n.disposeMaybe(this._fallbackDepthStencilTexture);this._shadowMap.enabled=!1;this._shadowMap.dispose();this._ssaoHelper.enabled=!1;this._ssaoHelper.dispose();this._highlightHelper.dispose();this._shadowHighlightHelper.dispose();this._shadowAccumulator.dispose();
A.BoundingInfo.prune();this._content.clear()};na.disposeOffscreenBuffers=function(){this._offscreenRendering.dispose();this._shadowMap.dispose();this._smaaPass.disable();this._ssaoHelper.disposeOffscreenBuffers()};na.ensureEdgeView=function(){n.isNone(this._edgeView)&&(this._edgeView=new S.EdgeView({rctx:this._rctx,renderSR:this._stage.renderSR,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:pa=>this._stage.resourceController.schedule(pa)}),this._handles.add(this._edgeView.watch("updating",
()=>this._requestRender(),!0)),this._requestRender());return this._edgeView};na.setRenderParameters=function(pa){const {renderPassManager:xa,_shadowMap:Da,_ssaoHelper:ua}=this;void 0!==pa.screenSpaceReflectionsEnabled&&xa.screenSpaceReflectionsEnabled!==pa.screenSpaceReflectionsEnabled&&(xa.screenSpaceReflectionsEnabled=pa.screenSpaceReflectionsEnabled,this._requestRender());void 0!==pa.fillLightsEnabled&&xa.fillLightsEnabled!==pa.fillLightsEnabled&&(xa.fillLightsEnabled=pa.fillLightsEnabled,this._requestRender());
void 0===pa.shadowMap||Da.enabled===pa.shadowMap&&xa.shadowCastingEnabled===pa.shadowMap||(Da.enabled=pa.shadowMap,xa.shadowCastingEnabled=pa.shadowMap,this._requestRender());void 0!==pa.shadowMapMaxCascades&&Da.maxCascades!==pa.shadowMapMaxCascades&&(Da.maxCascades=pa.shadowMapMaxCascades,this._requestRender());void 0!==pa.ssao&&ua.enabled!==pa.ssao&&(ua.enabled=pa.ssao,this._requestRender());pa.background&&this._offscreenRendering.background!==pa.background&&(this._offscreenRendering.background=
pa.background,this._requestRender());const Fa=pa.antialiasingEnabled?y.AntiAliasingMode.SMAA:y.AntiAliasingMode.NONE;void 0!==pa.antialiasingEnabled&&this._antialiasing!==Fa&&(this._antialiasing=Fa,this._requestRender());void 0!==pa.highQualityTransparency&&this._multipassTerrain!==pa.highQualityTransparency&&(this._oitEnabled=(this._multipassTerrain=pa.highQualityTransparency)&&this._hasOITSupport,this._requestRender());void 0!==pa.defaultHighlightOptions&&(this._highlightHelper.setDefaultOptions(pa.defaultHighlightOptions),
this._shadowHighlightHelper.setDefaultOptions(pa.defaultHighlightOptions),this._requestRender());void 0!==pa.slicePlane&&this._sliceHelper.plane!==pa.slicePlane&&(this._sliceHelper.plane=n.unwrap(pa.slicePlane),this._requestRender());void 0!==pa.waterReflectionEnabled&&this._waterReflectionEnabled!==pa.waterReflectionEnabled&&(this._waterReflectionEnabled=pa.waterReflectionEnabled,this._requestRender());void 0!==pa.fillLightsEnabled&&this._hasFillLights!==pa.fillLightsEnabled&&(this._hasFillLights=
pa.fillLightsEnabled,this._requestRender());void 0!==pa.opaqueTerrain&&this._opaqueTerrain!==pa.opaqueTerrain&&(this._opaqueTerrain=pa.opaqueTerrain,this._requestRender());void 0!==pa.hasOverlayWater&&this._hasOverlayWater!==pa.hasOverlayWater&&(this._hasOverlayWater=pa.hasOverlayWater,this._requestRender());void 0!==pa.shadowCastOptions&&this._shadowAccumulator.setOptions(pa.shadowCastOptions)};na.modify=function(pa){this._isRendering&&console.warn("Renderer.modify called while rendering");const {adds:xa,
removes:Da,updates:ua}=pa;if(0!==xa.length||0!==Da.length||0!==ua.length){Da.forAll(({id:qa})=>this._content.delete(qa));xa.forAll(qa=>this._content.set(qa.id,qa));var Fa=!1;H.splitRenderGeometryChangeSetByMaterial(pa).forEach((qa,sa)=>{let ma=this._materialRenderers.get(sa);if(!ma)if(0<qa.adds.length)ma=new W.MergedRenderer(this._rctx,this._materialRepository,sa),this._materialRenderers.set(sa,ma);else return;ma.modify(qa);ma.isEmpty&&(Fa=!0)});Fa&&this._materialRenderers.forEach((qa,sa)=>{qa.isEmpty&&
(this._materialRenderers.delete(sa),qa.dispose())});this._hasHighlights=w.someMap(this._materialRenderers,qa=>qa.hasHighlights);this._hasOccludees=w.someMap(this._materialRenderers,qa=>qa.hasOccludees);this._hasWater=w.someMap(this._materialRenderers,qa=>qa.hasWater);this._needsTransparentPass=w.someMap(this._materialRenderers,qa=>qa.requiresSlot(I.RenderSlot.TRANSPARENT_MATERIAL,M.RenderPass.MATERIAL));this._hasHUDElements=w.someMap(this._materialRenderers,qa=>qa.requiresSlot(I.RenderSlot.LINE_CALLOUTS_HUD_DEPTH,
M.RenderPass.MATERIAL)||qa.requiresSlot(I.RenderSlot.HUD_MATERIAL,M.RenderPass.MATERIAL)||qa.requiresSlot(I.RenderSlot.LABEL_MATERIAL,M.RenderPass.MATERIAL));this._requestRender()}};na.updateAnimation=function(pa){this._hasAnimations=!1;this._materialRenderers.forEach(xa=>this._hasAnimations=xa.updateAnimation(pa)||this._hasAnimations);return this._hasAnimations=this._renderPlugins.updateAnimation(pa)||this._hasAnimations};na.updateLightSources=function(pa,xa,Da){this._lighting.groundLightingFactor=
xa;this._lighting.globalFactor=Da;this._lighting.set(pa)};na.render=function(pa,xa,Da,ua){this._isRendering=!0;this.performanceInfo.prerender(this._rctx);this._bindParameters.lighting=this._lighting;this._renderContext.hasOccludees=this._hasOccludees;this._renderContext.transparencyPassType=this._bindParameters.transparencyPassType=y.TransparencyPassType.NONE;this._renderContext.hasFillLights=this._bindParameters.hasFillLights=this._hasFillLights;var Fa=this._offscreenRendering;Fa.needLastFrameColorTexture=
this.hasWaterReflection;Fa.advanceCurrentRenderTarget();const qa=this._sliceHelper.plane;ua===y.Decorations.OFF&&(this._sliceHelper.plane=null);this._rctx.bindFramebuffer(pa);xa.setGLViewport(this._rctx);this.needsShadowCast&&(this.renderPassManager.shadowCastingEnabled=!0);this._renderPlugins.prepareRender(xa,Da);this.performanceInfo.advance(da.Statistics.Prepare);var sa=this._computeDepthRange(xa);this._renderShadowMap(pa,xa,this._lighting.lightingMainDirection,sa);this.performanceInfo.advance(da.Statistics.Shadowmap);
Fa.initializeFrame(xa);this._ensureBindParameters(xa);this._renderLinearDepth();this.performanceInfo.advance(da.Statistics.Lineardepth);this._accumulateShadows(sa,xa,Da);this._renderNormal();this.performanceInfo.advance(da.Statistics.Normals);this._ensureBindParametersSSR();this._ensureBindParametersCloudsReflections();this._ssaoHelper.computeSSAO(xa,Fa.linearDepthTexture,Fa.normalTexture);this.performanceInfo.advance(da.Statistics.SSAO);this._renderContext.pass=M.RenderPass.MATERIAL;Fa.bindFramebuffer();
this._renderOpaqueGeometry();this.performanceInfo.advance(da.Statistics.Opaque);xa=this._multipassTerrain&&!this._opaqueTerrain;this._renderTerrainLinearDepth(xa);this._setMultipassFlags(xa);this._setTerrainCulling(xa);this._renderEdges(T.Transparency.OPAQUE);this.performanceInfo.advance(da.Statistics.OpaqueEdges);this._renderHiddenTransparentEdges();(Da=this._needsTransparentPass||this._renderPlugins.needsTransparentPass)&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),
!1):this._renderTransparentGeometry());this.performanceInfo.advance(da.Statistics.Transparent);this._renderGeometryLinearDepth(xa);sa=this._renderHUDVisibility();xa||this._renderInternalSlot(I.RenderSlot.LINE_CALLOUTS);this.performanceInfo.advance(da.Statistics.Hudvisibility);this._renderEdges(T.Transparency.TRANSPARENT,xa);this.performanceInfo.advance(da.Statistics.TransparentEdges);this._renderSlot(I.RenderSlot.VOXEL);this._renderTransparentTerrain();!this._opaqueTerrain&&sa&&(xa?this._renderLineCallouts(E.HUDTransparentRenderStyle.OCCLUDED):
Fa.compositeTransparentTerrainOntoHUDVisibility(),this._renderHUD(E.HUDTransparentRenderStyle.OCCLUDED,Fa.framebuffer),this.performanceInfo.advance(da.Statistics.HudOccluded));this.performanceInfo.advance(da.Statistics.TransparentTerrain);this._setTerrainCulling(!1);this._opaqueTerrain||(Fa.compositeTransparentTerrainOntoMain(),xa&&(this._renderEdges(T.Transparency.OPAQUE),this.performanceInfo.advance(da.Statistics.OpaqueEdges),Da&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),
!1):this._renderTransparentGeometry()),this.performanceInfo.advance(da.Statistics.Transparent),this._renderEdges(T.Transparency.TRANSPARENT),this.performanceInfo.advance(da.Statistics.TransparentEdges)));xa&&this._renderLineCallouts(E.HUDTransparentRenderStyle.NOTOCCLUDED);this._setMultipassFlags(!1);this._shadowAccumulator.render();Fa.renderToTargets(()=>{this._renderInternalSlot(I.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);this._renderSlot(I.RenderSlot.POSTPROCESSING_ENVIRONMENT_TRANSPARENT);
this._renderSlot(I.RenderSlot.LASERLINES)},Fa.currentColorTarget,Fa.mainDepth);this.performanceInfo.advance(da.Statistics.Atmosphere);this._renderPlugins.needsLaserlineWithContrastControl&&Fa.renderTmpAndCompositeToMain(()=>this._renderSlot(I.RenderSlot.LASERLINES_CONTRAST_CONTROL),U.AlphaMode.PremultipliedAlpha);this.performanceInfo.advance(da.Statistics.Laserline);this._renderOccluded();this.performanceInfo.advance(da.Statistics.Occluded);Fa=(ua=ua===y.Decorations.ON&&this._magnifierHelper.enabled)&&
n.isNone(pa)?this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor,this._offscreenRendering.tmpDepth):pa;this._rctx.bindFramebuffer(Fa);xa=this._offscreenRendering.colorTexture;!this._renderAntiAliasing(this._antialiasing,xa)&&n.isSome(xa)&&this._compositingHelper.composite(xa,U.AlphaMode.None);this.performanceInfo.advance(da.Statistics.Antialiasing);this._renderHUD(E.HUDTransparentRenderStyle.NOTOCCLUDED,Fa);this.performanceInfo.advance(da.Statistics.HudNotoccluded);this._renderHighlights(Fa,
this._bindParameters);this.performanceInfo.advance(da.Statistics.Highlights);ua&&this._magnifierHelper.render(this._rctx,this._bindParameters);Fa!==pa&&(this._rctx.bindFramebuffer(pa),this._compositingHelper.composite(this._offscreenRendering.tmpColorTexture,U.AlphaMode.None));this._disposeOITBuffers();this._renderContext.lastFrameCamera.copyFrom(this._renderContext.camera);this._sliceHelper.plane=qa;this._isRendering=!1;if(this.onPostRender)this.onPostRender();this.performanceInfo.postrender()};
na.finish=function(pa){this._hasAnimations||(this._animationTimestep=f.Milliseconds(0));pa===y.RenderRequestType.BACKGROUND&&(this._rctx.gl.getError(),this._animationTimestep=f.Milliseconds(Math.max(.9*this._animationTimestep+this.performanceInfo.elapsedTime/r.MAXIMUM_ANIMATION_LOAD*(1-.9),r.MINIMUM_IDLE_ANIMATION_MS)))};na.readDepthPixels=function(pa,xa,Da,ua,Fa,qa){const sa=this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth);this._needsLinearDepth||
(this._ensureBindParameters(pa),this._renderContext.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(Y.ClearBufferBit.COLOR_BUFFER_BIT|Y.ClearBufferBit.DEPTH_BUFFER_BIT|Y.ClearBufferBit.STENCIL_BUFFER_BIT),this._renderGeometryAndTransparentTerrainPass(M.RenderPass.MATERIAL_DEPTH));sa.readPixels(xa,Da,ua,Fa,Y.PixelFormat.RGBA,Y.PixelType.UNSIGNED_BYTE,qa)};na.readAccumulatedShadow=function(pa,xa){return this._shadowAccumulator.readAccumulatedShadow(pa,xa)};na._setMultipassFlags=
function(pa){this._renderContext.multipassTerrainParams.multipassTerrainEnabled=this._bindParameters.multipassTerrainEnabled=pa;this._renderContext.multipassGeometryParams.multipassGeometryEnabled=this._bindParameters.multipassGeometryEnabled=pa};na._setTerrainCulling=function(pa){this._renderContext.multipassTerrainParams.cullAboveGround=this._bindParameters.cullAboveGround=pa};na._renderSlot=function(pa){this._renderContext.slot=pa;this._renderPlugins.render()};na._renderEdges=function(pa,xa=!1){const Da=
this._edgeView;n.isSome(Da)&&Da.shouldRender()&&this._offscreenRendering.renderTmpAndCompositeToMain(()=>Da.render(this._bindParameters,pa),U.AlphaMode.Alpha,xa)};na._renderShadowMap=function(pa,xa,Da,ua){const Fa=this._shadowMap;Fa.enabled&&(Fa.start(xa,Da,ua),this._shadowHighlightHelper.updateParameters(xa,Da),this.needsShadowHighlight?(this._renderShadowCascades(M.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,this._shadowMap,qa=>Fa.takeCascadeSnapshotTo(qa,aa.HighlightShadowMapSlot)),Fa.clear(),
this._renderShadowCascades(M.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,this._shadowMap,qa=>{Fa.takeCascadeSnapshotTo(qa,aa.DefaultSnapshotSlot);this._renderGeometryAndTransparentTerrainPass(M.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT)})):this._renderShadowCascades(M.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL),Fa.finish(pa),xa.setGLViewport(this._rctx))};na._renderShadowCascades=function(pa,xa=this._shadowMap,Da=ua=>{}){for(const ua of xa.getCascades())ua.camera.setGLViewport(this._rctx),this._ensureCameraBindParameters(ua.camera),
this._renderGeometryAndTransparentTerrainPass(pa),Da(ua)};na._renderLinearDepth=function(){this._needsLinearDepth?this._offscreenRendering.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(M.RenderPass.MATERIAL_DEPTH),this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth);this._renderContext.ssrParams.linearDepthTexture=this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture};
na._renderTerrainLinearDepth=function(pa){pa?(pa=this._renderContext.pass,this._renderContext.pass=M.RenderPass.MATERIAL_DEPTH,this._offscreenRendering.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreenRendering.terrainLinearDepth,this._offscreenRendering.tmpDepth,[-1E10,-1E10,-1E10,1],!0,!0),this._renderContext.pass=pa):this._offscreenRendering.disposeTarget(this._offscreenRendering.terrainLinearDepth);this._renderContext.multipassTerrainParams.terrainLinearDepthTexture=this._bindParameters.terrainLinearDepthTexture=
this._offscreenRendering.terrainLinearDepthTexture};na._renderGeometryLinearDepth=function(pa){pa?(pa=this._renderContext.pass,this._offscreenRendering.renderToTargets(()=>this._renderGeometryPass(M.RenderPass.MATERIAL_DEPTH),this._offscreenRendering.geometryLinearDepth,this._offscreenRendering.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.pass=pa):this._offscreenRendering.disposeTarget(this._offscreenRendering.geometryLinearDepth);this._renderContext.multipassGeometryParams.geometryLinearDepthTexture=
this._bindParameters.geometryLinearDepthTexture=this._offscreenRendering.geometryLinearDepthTexture};na._renderNormal=function(){this.needsNormal?this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(M.RenderPass.MATERIAL_NORMAL)},this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)};na._computeDepthRange=function(pa){if(!this.needsDepthRange)return p.ZERO;const xa=
B.depthRangeFromScene(pa,this._content,this._stage.layers);p.union(xa,this.renderPlugins.queryDepthRange(pa));xa.near=Math.max(pa.near,xa.near);xa.far=Math.min(pa.far,xa.far);return xa};na._renderGeometryAndTransparentTerrainPass=function(pa){this._renderContext.pass=pa;this._renderGeometryPass(pa);this._renderTransparentTerrain()};na._renderGeometryPass=function(pa){this._renderContext.pass=pa;this._renderOpaqueGeometry();this._renderTransparentGeometry()};na._renderOpaqueGeometry=function(){this._renderSlot(I.RenderSlot.INTEGRATED_MESH);
this._renderSlot(I.RenderSlot.OPAQUE_TERRAIN);this._renderInternalSlot(I.RenderSlot.OPAQUE_MATERIAL);this._renderSlot(I.RenderSlot.OPAQUE_PLUGIN);this._renderSlot(I.RenderSlot.POSTPROCESSING_ENVIRONMENT_OPAQUE)};na._renderTransparentGeometry=function(){this._renderInternalSlot(I.RenderSlot.TRANSPARENT_MATERIAL);this._renderSlot(I.RenderSlot.TRANSPARENT_PLUGIN)};na._renderTransparentTerrain=function(){this._renderSlot(I.RenderSlot.TRANSPARENT_TERRAIN)};na._renderHUDVisibility=function(){let pa=!1;
this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture;pa=this._renderInternalSlot(I.RenderSlot.OCCLUSION_PIXELS)},this._multipassTerrain&&!this._opaqueTerrain);return pa};na._renderLineCallouts=function(pa){this._bindParameters.renderTransparentlyOccludedHUD=pa;pa===E.HUDTransparentRenderStyle.OCCLUDED?this._offscreenRendering.renderToTargets(()=>
this._renderInternalSlot(I.RenderSlot.LINE_CALLOUTS),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderInternalSlot(I.RenderSlot.LINE_CALLOUTS)};na._renderHUD=function(pa,xa){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency(()=>this._renderHUDElements(pa),!0),this._rctx.bindFramebuffer(xa),this._compositingHelper.composite(this._offscreenRendering.hudColorTexture,U.AlphaMode.PremultipliedAlpha)):pa===E.HUDTransparentRenderStyle.OCCLUDED?
this._offscreenRendering.renderToTargets(()=>this._renderHUDElements(E.HUDTransparentRenderStyle.OCCLUDED),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderHUDElements(pa))};na._renderHUDElements=function(pa){this._bindParameters.renderTransparentlyOccludedHUD=pa;this._renderInternalSlot(I.RenderSlot.LINE_CALLOUTS_HUD_DEPTH);this._renderInternalSlot(I.RenderSlot.HUD_MATERIAL);this._renderInternalSlot(I.RenderSlot.LABEL_MATERIAL)};na._renderHighlights=
function(pa,xa){if(this.needsHighlight){var Da=this._highlightHelper,ua=Da.profilingCallback&&ea.startMeasurement(this._renderContext.rctx);this._renderContext.highlightDepthTexture=xa.highlightDepthTexture;var Fa=this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(M.RenderPass.MATERIAL_HIGHLIGHT);this._rctx.clearSafe(Y.ClearBufferBit.DEPTH_BUFFER_BIT);this._renderHUDElements(E.HUDTransparentRenderStyle.BOTH)},this._offscreenRendering.highlight,this._offscreenRendering.tmpDepth,
[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=Fa.colorTexture;this.needsShadowHighlight&&this._shadowHighlightHelper.render(xa,pa);Da.render(this._renderContext.camera,Fa,pa);n.isSome(ua)&&Da.profilingCallback&&ua.stop(qa=>{Da.profilingCallback&&Da.profilingCallback(qa)})}else this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight)};na._accumulateShadows=function(pa,xa,Da){this.needsShadowCast&&(this._shadowAccumulator.setAccumulationDependencies(this._offscreenRendering.linearDepthTexture,
pa,xa,Da),this._shadowAccumulator.accumulateFixedSamples(),this.renderPassManager.shadowCastingEnabled=this._shadowMap.enabled)};na._renderOrderIndependentTransparency=function(pa,xa){const Da=Fa=>{this._renderContext.transparencyPassType=Fa;this._bindParameters.transparencyPassType=this._renderContext.transparencyPassType;this._offscreenRendering.renderOITPass(()=>pa(),Fa,xa)},ua=this._renderContext.pass;this._renderContext.pass=M.RenderPass.MATERIAL_ALPHA;Da(y.TransparencyPassType.Alpha);this._renderContext.pass=
M.RenderPass.MATERIAL;Da(y.TransparencyPassType.Color);Da(y.TransparencyPassType.FrontFace);this._offscreenRendering.compositeTransparentOntoOpaque(xa);this._renderContext.transparencyPassType=y.TransparencyPassType.NONE;this._bindParameters.transparencyPassType=this._renderContext.transparencyPassType;this._renderContext.pass=ua;this._oitUsed=!0};na._disposeOITBuffers=function(){this._oitUsed||(this._offscreenRendering.disposeTarget(this._offscreenRendering.alphaFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.colorFloatTarget),
this._offscreenRendering.disposeTarget(this._offscreenRendering.frontFaceTarget));this._oitUsed=!1};na._renderOccluded=function(){let pa=0;this._materialRenderers.forEach((qa,sa)=>{sa&&sa.isVisible()&&sa.renderOccluded===F.RenderOccludedFlag.OccludeAndTransparentStencil&&(pa|=sa.renderOccluded,la.push(sa))});const xa=this._offscreenRendering,Da=(qa,sa,ma,ra,va)=>{0!==(pa&sa)&&(xa.renderToTargets(ma,xa.tmpColor,xa.mainDepth,[0,0,0,0],ra,va),xa.compositeOccludedOntoMain(qa))};0!==la.length&&(this._renderInternalSlot(I.RenderSlot.OCCLUDER_MATERIAL,
la),Da(.5,F.RenderOccludedFlag.OccludeAndTransparentStencil,()=>this._renderInternalSlot(I.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL,la),!1,!1),la.length=0);this._materialRenderers.forEach((qa,sa)=>{sa&&sa.isVisible()&&(sa.renderOccluded===F.RenderOccludedFlag.OccludeAndTransparent||sa.renderOccluded===F.RenderOccludedFlag.Transparent||sa.renderOccluded===F.RenderOccludedFlag.Opaque)&&(pa|=sa.renderOccluded,ja.push(sa))});const ua=this._renderPlugins.renderOccludedFlags;if(pa|=ua){var Fa=qa=>{this._renderContext.renderOccludedMask=
qa;ua>F.RenderOccludedFlag.Occlude&&this._renderSlot(I.RenderSlot.OCCLUDED_TERRAIN);this._renderInternalSlot(I.RenderSlot.OPAQUE_MATERIAL,ja);this._renderInternalSlot(I.RenderSlot.TRANSPARENT_MATERIAL,ja);this._renderInternalSlot(I.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,ja);this._renderContext.resetRenderOccludedMask()};this._renderContext.pass=M.RenderPass.MATERIAL;Da(.5,F.RenderOccludedFlag.OccludeAndTransparent,()=>Fa(F.RenderOccludedFlag.OccludeAndTransparent),!0,y.StencilBits.OutlineVisualElementMask);
Da(.5,F.RenderOccludedFlag.Transparent,()=>Fa(F.RenderOccludedFlag.Transparent),!0,y.StencilBits.OutlineVisualElementMask);Da(1,F.RenderOccludedFlag.Opaque,()=>Fa(F.RenderOccludedFlag.Opaque),!0,y.StencilBits.OutlineVisualElementMask);ja.length=0}};na._renderAntiAliasing=function(pa,xa){if(pa===y.AntiAliasingMode.SMAA){if(this._smaaPass.enable(()=>this._requestRender())&&n.isSome(xa))return this._smaaPass.render(xa),!0}else this._smaaPass.disable();return!1};na._ensureCameraBindParameters=function(pa){this._renderContext.camera=
pa;this._bindParameters.camera=this._renderContext.camera;this._bindParameters.inverseViewport[0]=1/this._renderContext.camera.fullViewport[2];this._bindParameters.inverseViewport[1]=1/this._renderContext.camera.fullViewport[3]};na._ensureBindParameters=function(pa){var xa;this._ensureCameraBindParameters(pa);pa=this._renderContext.offscreenRenderingHelper;this._bindParameters.shadowMap=this._renderContext.shadowMap;this._bindParameters.shadowMappingEnabled=this._renderContext.shadowMap.enabled;this._bindParameters.ssaoHelper=
this._renderContext.ssaoHelper;this._bindParameters.ssaoEnabled=this._renderContext.ssaoHelper.enabled;this._bindParameters.slicePlane=this._renderContext.sliceHelper.plane;this._bindParameters.hasOccludees=this._renderContext.hasOccludees;this._renderContext.multipassTerrainParams.camera=this._renderContext.camera;this._bindParameters.hudVisibilityTexture=pa.hudVisibilityTexture;this._bindParameters.highlightDepthTexture=null!=(xa=pa.depthTexture)?xa:this._getFallbackDepthTexture()};na._ensureBindParametersSSR=
function(){this.hasWaterReflection?(this._renderContext.lastFrameCamera.equals(this._renderContext.camera)?this._renderContext.ssrParams.reprojectionMatrix=this._reprojectionMatrix=q.IDENTITY:(v.translate(ia,this._renderContext.lastFrameCamera.viewMatrix,this._bindParameters.origin?this._bindParameters.origin:[0,0,0]),v.translate(fa,this._renderContext.camera.viewMatrix,this._bindParameters.origin?this._bindParameters.origin:[0,0,0]),v.invert(fa,fa),v.invert(ca,this._renderContext.camera.projectionMatrix),
v.multiply(ba,fa,ca),v.multiply(ba,ia,ba),v.multiply(ba,this._renderContext.lastFrameCamera.projectionMatrix,ba),this._renderContext.ssrParams.reprojectionMatrix=this._reprojectionMatrix=ba),this._renderContext.ssrParams.camera=this._renderContext.camera,this._renderContext.ssrParams.lastFrameColorTexture=this._bindParameters.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture):this._renderContext.ssrParams.lastFrameColorTexture=this._bindParameters.lastFrameColorTexture=null;this._renderContext.ssrParams.ssrEnabled=
this._bindParameters.ssrEnabled=this.hasWaterReflection};na._ensureBindParametersCloudsReflections=function(){this._bindParameters.cloudsCompositionParams=this._renderContext.cloudsCompositionParams};na._renderInternalSlot=function(pa,xa){let Da=!1;this._bindParameters.slot=pa;n.isSome(xa)?xa.forEach(ua=>{ua.shouldRender(this._renderContext)&&(ua=this._materialRenderers.get(ua),n.isSome(ua)&&(Da=ua.render(pa,this._renderContext.pass,this._bindParameters)||Da))}):this._materialRenderers.forEach((ua,
Fa)=>{Fa.shouldRender(this._renderContext)&&(Da=ua.render(pa,this._renderContext.pass,this._bindParameters)||Da)});return Da};na._getFallbackDepthTexture=function(){this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=D.createEmptyDepthTexture(this._rctx));return this._fallbackDepthStencilTexture};b._createClass(ha,[{key:"hasWater",get:function(){return this._hasWater||this._hasOverlayWater}},{key:"hasWaterReflection",get:function(){return this.hasWater&&this._waterReflectionEnabled}},
{key:"updating",get:function(){return this._antialiasing===y.AntiAliasingMode.SMAA&&this._smaaPass.updating||n.isSome(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}},{key:"edgeView",get:function(){return this._edgeView}},{key:"isCameraFinal",get:function(){return null===this._bindParameters.reprojectionMatrix||v.equals(this._bindParameters.reprojectionMatrix,q.IDENTITY)}},{key:"_reprojectionMatrix",set:function(pa){v.equals(this._bindParameters.reprojectionMatrix,
pa)||(this._bindParameters.reprojectionMatrix=pa,this.notifyChange("isCameraFinal"))}},{key:"hasShadowsEnabled",get:function(){var pa;return!(null==(pa=this._shadowMap)||!pa.enabled)}},{key:"hasSlicePlane",get:function(){return!!this._sliceHelper.plane}},{key:"renderPlugins",get:function(){return this._renderPlugins}},{key:"_hasOITSupport",get:function(){return this._rctx.driverTest.floatBufferBlendWorking}},{key:"animationTimestep",get:function(){return this._animationTimestep}},{key:"_needsLinearDepth",
get:function(){return this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled||this.needsShadowHighlight||this.needsShadowCast}},{key:"needsNormal",get:function(){return this._ssaoHelper.enabled}},{key:"needsDepthRange",get:function(){return this._shadowMap.enabled||this.needsShadowCast}},{key:"needsHighlight",get:function(){return this._hasHighlights||this._renderPlugins.needsHighlight}},{key:"needsShadowHighlight",get:function(){return this._shadowMap.enabled&&
this._shadowHighlightHelper.isVisible&&this.needsHighlight}},{key:"needsShadowCast",get:function(){return this._shadowAccumulator.isAccumulating}},{key:"gpuMemoryUsage",get:function(){var pa,xa,Da,ua,Fa,qa,sa,ma,ra,va;return{offscreen:null!=(pa=null==(xa=this._offscreenRendering)?void 0:xa.gpuMemoryUsage)?pa:0,highlights:(null!=(Da=null==(ua=this._highlightHelper)?void 0:ua.gpuMemoryUsage)?Da:0)+(null!=(Fa=null==(qa=this._shadowHighlightHelper)?void 0:qa.gpuMemoryUsage)?Fa:0),shadows:null!=(sa=null==
(ma=this._shadowMap)?void 0:ma.gpuMemoryUsage)?sa:0,ssao:null!=(ra=null==(va=this._ssaoHelper)?void 0:va.gpuMemoryUsage)?ra:0}}},{key:"test",get:function(){const pa=this;return{offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlightHelper,lighting:this._lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,getFramebufferTexture:xa=>{var Da;switch(xa){case a.FramebufferId.Color:return pa._offscreenRendering.colorTexture;
case a.FramebufferId.LinearDepth:return pa._offscreenRendering.linearDepthTexture;case a.FramebufferId.Normals:return pa._offscreenRendering.normalTexture;case a.FramebufferId.ShadowMap:return null==(Da=pa._shadowMap)?void 0:Da.test.depthTexture;case a.FramebufferId.HudVisibility:return pa._offscreenRendering.hudVisibilityTexture;case a.FramebufferId.Highlight:return pa._offscreenRendering.highlightTexture}}}}}]);return ha}(g);c.__decorate([k.property()],a.Renderer.prototype,"_shadowAccumulator",
void 0);c.__decorate([k.property()],a.Renderer.prototype,"_smaaPass",void 0);c.__decorate([k.property()],a.Renderer.prototype,"_antialiasing",void 0);c.__decorate([k.property()],a.Renderer.prototype,"_edgeView",void 0);c.__decorate([k.property()],a.Renderer.prototype,"updating",null);c.__decorate([k.property()],a.Renderer.prototype,"isCameraFinal",null);a.Renderer=c.__decorate([z.subclass("esri.views.3d.webgl-engine.lib.Renderer")],a.Renderer);a.FramebufferId=void 0;(function(Z){Z[Z.Color=0]="Color";
Z[Z.LinearDepth=1]="LinearDepth";Z[Z.Normals=2]="Normals";Z[Z.ShadowMap=3]="ShadowMap";Z[Z.HudVisibility=4]="HudVisibility";Z[Z.Highlight=5]="Highlight"})(a.FramebufferId||(a.FramebufferId={}));const ja=[],la=[],ia=q.create(),ca=q.create(),fa=q.create(),ba=q.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/animationUtils":function(){define(["exports","../../../core/time"],function(a,b){b=b.Milliseconds(1E3/30);a.MAXIMUM_ANIMATION_LOAD=.5;a.MINIMUM_IDLE_ANIMATION_MS=
b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPassManager":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4 ../../../../../chunks/vec2 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/vec4 ../../../../../chunks/boundedPlane ./AllRenderPasses ./RenderPass ../util/TwoVectorPosition ../../lib/depthRange ../../lib/RenderPass ../../lib/RenderSlot".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t){let r=function(){function y(p,B){this.rctx=p;this.shaderTechniqueRepository=B;this.canRender=!0;this._materialPassParams=new d.MaterialPassesParameters;this._shadowPassParams=new d.ShadowMapPassParameters;this._highlightPassParams=new d.HighlightPassParameters;this._systems=new Set;this._passes={materialOpaque:new m.RenderPass(p,this.shaderTechniqueRepository),materialTransparent:new m.RenderPass(p,this.shaderTechniqueRepository,m.RenderPassSorting.BackToFront),
materialIntegratedMesh:new m.RenderPass(p,this.shaderTechniqueRepository),shadowMap:new m.RenderPass(p,this.shaderTechniqueRepository),highlight:new m.RenderPass(p,this.shaderTechniqueRepository),highlightIntegratedMesh:new m.RenderPass(p,this.shaderTechniqueRepository),highlightShadowMap:new m.RenderPass(p,this.shaderTechniqueRepository),defaultShadowMap:new m.RenderPass(p,this.shaderTechniqueRepository)}}var A=y.prototype;A.register=function(p){this._systems.add(p)};A.prepareRender=function(p){if(0!==
this._systems.size){for(const B of Object.values(this._passes))B.prepareSubmit();this._systems.forEach(B=>B.submit(this._passes,{camera:p}));for(const B of Object.values(this._passes))B.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}};A.render=function(p){if(0!==this._systems.size)switch(this._configure(p),p.slot){case t.RenderSlot.OPAQUE_PLUGIN:switch(p.pass){case q.RenderPass.MATERIAL:return this._materialPassParams.subPass=d.MaterialSubPass.Color,this._configureMaterialColorPass(p),
this._passes.materialOpaque.dispatch(this._materialPassParams);case q.RenderPass.MATERIAL_DEPTH:return this._materialPassParams.subPass=d.MaterialSubPass.Depth,this._passes.materialOpaque.dispatch(this._materialPassParams);case q.RenderPass.MATERIAL_NORMAL:return this._materialPassParams.subPass=d.MaterialSubPass.Normal,this._passes.materialOpaque.dispatch(this._materialPassParams);case q.RenderPass.MATERIAL_HIGHLIGHT:return this._passes.highlight.dispatch(this._highlightPassParams);case q.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL:return this._passes.shadowMap.dispatch(this._shadowPassParams);
case q.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:return this._passes.highlightShadowMap.dispatch(this._shadowPassParams);case q.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this._passes.defaultShadowMap.dispatch(this._shadowPassParams)}break;case t.RenderSlot.TRANSPARENT_PLUGIN:switch(p.pass){case q.RenderPass.MATERIAL:return this._materialPassParams.subPass=d.MaterialSubPass.Color,this._configureMaterialColorPass(p),this._passes.materialTransparent.dispatch(this._materialPassParams);case q.RenderPass.MATERIAL_ALPHA:return this._materialPassParams.subPass=
d.MaterialSubPass.Alpha,this._configureMaterialColorPass(p),this._passes.materialTransparent.dispatch(this._materialPassParams);case q.RenderPass.MATERIAL_DEPTH:return this._materialPassParams.subPass=d.MaterialSubPass.Depth,this._passes.materialTransparent.dispatch(this._materialPassParams);case q.RenderPass.MATERIAL_NORMAL:return this._materialPassParams.subPass=d.MaterialSubPass.Normal,this._passes.materialTransparent.dispatch(this._materialPassParams)}break;case t.RenderSlot.INTEGRATED_MESH:switch(p.pass){case q.RenderPass.MATERIAL:return this._materialPassParams.subPass=
d.MaterialSubPass.Color,this._configureMaterialColorPass(p),this._materialPassParams.ssrParams=p.ssrParams,this._passes.materialIntegratedMesh.dispatch(this._materialPassParams);case q.RenderPass.MATERIAL_DEPTH:return this._materialPassParams.subPass=d.MaterialSubPass.Depth,this._passes.materialIntegratedMesh.dispatch(this._materialPassParams);case q.RenderPass.MATERIAL_NORMAL:return this._materialPassParams.subPass=d.MaterialSubPass.Normal,this._passes.materialIntegratedMesh.dispatch(this._materialPassParams);
case q.RenderPass.MATERIAL_HIGHLIGHT:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParams)}}};A.notifyDirty=function(){this._context.requestRender()};A.slots=function(){return[t.RenderSlot.OPAQUE_PLUGIN,t.RenderSlot.TRANSPARENT_PLUGIN,t.RenderSlot.INTEGRATED_MESH]};A.initializeRenderContext=function(p){this._context=p};A.uninitializeRenderContext=function(){};A.queryDepthRange=function(p){const B={near:Infinity,far:-Infinity};this._systems.forEach(D=>{D=D.queryShadowCasterDepthRange(p);
c.isSome(D)&&v.union(B,D,B)});return B};A._configureMaterialColorPass=function(p){this._materialPassParams.bindShadowMap=B=>{p.shadowMap.bind(B);const D=this._materialPassParams.viewTransform;f.add(x,D.transformWorldFromViewTL,D.transformWorldFromViewTH);p.shadowMap.bindView(B,x)};this._materialPassParams.bindAmbientOcclusion=B=>p.ssaoHelper.bind(B,p.camera);this._materialPassParams.ambientOcclusionEnabled=!!p.ssaoHelper&&p.ssaoHelper.ready;this._materialPassParams.sceneHasOcludees=p.hasOccludees};
A._configure=function(p){this._updateParameters(p,p.pass===q.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL||p.pass===q.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||p.pass===q.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT?this._shadowPassParams:p.pass===q.RenderPass.MATERIAL_HIGHLIGHT?this._highlightPassParams:this._materialPassParams)};A._updateParameters=function(p,B){const D=p.camera,C=D.viewInverseTransposeMatrix;f.set(x,C[3],C[7],C[11]);E.set(x);f.copy(B.viewTransform.transformWorldFromViewTH,E.high);
f.copy(B.viewTransform.transformWorldFromViewTL,E.low);g.fromMat4(B.viewTransform.transformViewFromCameraRelativeRS,D.viewMatrix);w.copy(B.viewTransform.transformProjFromView,D.projectionMatrix);B.identifier===d.RenderPassIdentifier.Material?(this._materialPassParams.transparent=p.slot===t.RenderSlot.TRANSPARENT_PLUGIN,this._materialPassParams.integratedMesh=p.slot===t.RenderSlot.INTEGRATED_MESH,this._materialPassParams.lighting=p.scenelightingData,g.transpose(u,B.viewTransform.transformViewFromCameraRelativeRS),
g.invert(B.transformNormalViewFromGlobal,u),n.copy(B.nearFar,D.nearFar)):B.identifier===d.RenderPassIdentifier.ShadowMap?n.copy(B.nearFar,D.nearFar):B.identifier===d.RenderPassIdentifier.Highlight&&(B.highlightDepthTexture=p.highlightDepthTexture,k.copy(B.viewport,D.fullViewport));if(B.identifier===d.RenderPassIdentifier.Material||B.identifier===d.RenderPassIdentifier.Highlight)B.inverseViewport[0]=1/D.fullViewport[2],B.inverseViewport[1]=1/D.fullViewport[3];e.copyWithoutVerify(p.sliceHelper.plane,
B.slicePlane);f.subtract(B.slicePlane.origin,B.slicePlane.origin,x);B.slicePlaneEnabled=p.sliceHelper.isEnabled;this._materialPassParams.slot=p.slot;this._materialPassParams.transparencyPassType=p.transparencyPassType;this._materialPassParams.multipassTerrainParams=p.multipassTerrainParams};b._createClass(y,[{key:"shadowCastingEnabled",get:function(){return this._materialPassParams.shadowsEnabled},set:function(p){this._materialPassParams.shadowsEnabled=p}},{key:"fillLightsEnabled",get:function(){return this._materialPassParams.hasFillLights},
set:function(p){this._materialPassParams.hasFillLights=p}},{key:"screenSpaceReflectionsEnabled",get:function(){return c.isSome(this._materialPassParams.ssrParams.ssrEnabled)},set:function(p){this._materialPassParams.ssrParams.ssrEnabled=!!p}},{key:"needsHighlight",get:function(){return 0<this._passes.highlight.count||0<this._passes.highlightIntegratedMesh.count}},{key:"needsTransparentPass",get:function(){return 0<this._passes.materialTransparent.count}}]);return y}();const x=l.create(),u=h.create(),
E=new z.TwoVectorPosition;a.RenderPassManager=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPass":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/PooledArray ../../lib/basicInterfaces ../../../../webgl/enums".split(" "),function(a,b,c,g,h,w){a.RenderPassSorting=void 0;(function(l){l[l.FrontToBack=0]="FrontToBack";l[l.BackToFront=1]="BackToFront"})(a.RenderPassSorting||
(a.RenderPassSorting={}));let n=function(){function l(e,d,m=a.RenderPassSorting.FrontToBack){this._rctx=e;this._techniqueRepository=d;this._sorting=m;this._draws=new g({initialSize:32,allocator:z=>z||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}});this._passBoundTechniques=new Set;this._previouslyBoundMaterials=new Map;this._previouslyBoundDraw=new Map}var k=l.prototype;k.submitDraw=function(e,d,m,z,v){const q=this._draws.pushNew();q.geometry=
d;q.geometryRanges=m;q.material=e;q.bindDrawParams=z;q.depthSquaredHint=v;q.indexType=d.indexed?c.unwrap(d.vao.indexBuffer).indexType:0};k.dispatch=function(e){const d=this._rctx;this._passBoundTechniques.clear();this._previouslyBoundMaterials.clear();this._previouslyBoundDraw.clear();let m=null;const z=this._draws.map(r=>r.material.prepareTechnique(this._techniqueRepository,e,r.geometry.parameters)),v=this._draws.length;for(let r=0;r<v;r++){var q=z[r];if(q!==m||q.configuration.transparencyPassType!==
h.TransparencyPassType.NONE)d.useTechnique(q,e.slot),m=q;this._passBoundTechniques.has(q)||(q.bindPass(e),this._passBoundTechniques.add(q));var t=this._draws.data[r];const x=t.geometry;d.bindVAO(x.vao);this._previouslyBoundMaterials.get(q)!==t.material&&(q.bindMaterial(t.material,e),this._previouslyBoundMaterials.set(q,t.material));this._previouslyBoundDraw.get(q)!==t.bindDrawParams&&(q.bindDraw(t.bindDrawParams),this._previouslyBoundDraw.set(q,t.bindDrawParams));q=t.geometryRanges;const u=q.length;
if(0!==t.indexType){const E=f.get(t.indexType);for(let y=0;y<u;y+=2)d.drawElements(x.primitiveType,q[y+1],t.indexType,q[y]*E)}else for(t=0;t<u;t+=2)d.drawArrays(x.primitiveType,q[t],q[t+1])}};k.prepareSubmit=function(){this._draws.clear()};k.finishSubmit=function(){const e=this._sorting===a.RenderPassSorting.FrontToBack?1:-1;this._draws.sort((d,m)=>{const z=e*(d.depthSquaredHint-m.depthSquaredHint);return 0!==z?z:d.geometry.vao.size-m.geometry.vao.size})};b._createClass(l,[{key:"count",get:function(){return this._draws.length}}]);
return l}();const f=new Map;f.set(w.DataType.UNSIGNED_BYTE,1);f.set(w.DataType.UNSIGNED_SHORT,2);f.set(w.DataType.UNSIGNED_INT,4);a.RenderPass=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/HighlightHelper":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec4 ../../../../chunks/vec4f32 ../../../../chunks/vec4f64 ../../support/debugFlags ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./glUtil3D ../../../../chunks/HighlightComposition.glsl ../shaders/HighlightTechnique ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q){return function(){function t(x,u){this._techniqueRep=x;this._rctx=u;this.viewportToRestore=h.create();this.defaultOptions={color:g.fromValues(1,0,1,1),haloColor:g.fromValues(1,0,1,1),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05,shadowColor:g.fromValues(1,0,1,1),shadowOpacity:.15,occludedShadowOpacity:.075};this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,
viewportHeight:0}}var r=t.prototype;r._assertResources=function(){if(!this.quadVAO){this.quadVAO=l.createQuadVAO(this._rctx);var x={colorTarget:m.TargetType.TEXTURE,depthStencilTarget:m.DepthStencilTargetType.NONE,width:0,height:0},u={target:m.TextureType.TEXTURE_2D,pixelFormat:m.PixelFormat.RGBA,dataType:m.PixelType.UNSIGNED_BYTE,samplingMode:m.TextureSamplingMode.LINEAR,wrapMode:m.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0};this.blur0Fbo=new z.FramebufferObject(this._rctx,x,u);this.blur1Fbo=
new z.FramebufferObject(this._rctx,x,u);x=new e.HighlightCompositionTechniqueConfiguration;x.highlightStage=k.HighlightCompositionPass.Blur;x.gridOptimization=!1;this.blurTechnique=this._techniqueRep.acquire(e.HighlightCompositionTechnique,x);x.highlightStage=k.HighlightCompositionPass.Blur;x.gridOptimization=!0;this.blurGridTechnique=this._techniqueRep.acquire(e.HighlightCompositionTechnique,x);x.highlightStage=k.HighlightCompositionPass.Apply;x.gridOptimization=!1;this.applyTechnique=this._techniqueRep.acquire(e.HighlightCompositionTechnique,
x);x.highlightStage=k.HighlightCompositionPass.Apply;x.gridOptimization=!0;this.applyGridTechnique=this._techniqueRep.acquire(e.HighlightCompositionTechnique,x);x.highlightStage=k.HighlightCompositionPass.Downsample;x.gridOptimization=!1;this.downsampleTechnique=this._techniqueRep.acquire(e.HighlightCompositionTechnique,x)}};r.dispose=function(){if(this._grid.coverageMipmap)for(let x=1;x<this._grid.coverageMipmap.length;x++)this._grid.coverageMipmap[x].dispose();this._grid.vao&&this._grid.vao.dispose(!0);
this.quadVAO&&(this.quadVAO.dispose(!0),this.quadVAO=null);this.blur0Fbo=b.disposeMaybe(this.blur0Fbo);this.blur1Fbo=b.disposeMaybe(this.blur1Fbo)};r.setDefaultOptions=function(x){this.defaultOptions=x};r.render=function(x,u,E){var y=x.pixelRatio;const A=w.HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED,p=this._rctx;this._assertResources();c.copy(this.viewportToRestore,x.fullViewport);var B=Math.ceil(x.fullWidth/y);y=Math.ceil(x.fullHeight/y);this.blur0Fbo.resize(B,y);this.blur1Fbo.resize(B,y);p.bindVAO(this.quadVAO);
x=null;const D=A?this.blurGridTechnique:this.blurTechnique,C=p.useTechnique(D);A?(this._gridUpdateResources(u,32),this._gridComputeMipmap(),x=this._grid.vao,C.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,"coverageTex")):x=this.quadVAO;p.bindVAO(x);p.bindFramebuffer(this.blur0Fbo);p.setViewport(0,0,B,y);p.setClearColor(0,0,0,0);p.clear(m.ClearBufferBit.COLOR_BUFFER_BIT);C.bindTexture(u.colorTexture,"tex");C.setUniform2f("blurSize",1/B,0);p.drawArrays(D.primitiveType,
0,v.vertexCount(x,"geometry"));p.bindFramebuffer(this.blur1Fbo);p.clear(m.ClearBufferBit.COLOR_BUFFER_BIT);C.bindTexture(this.blur0Fbo.colorTexture,"tex");C.setUniform2f("blurSize",0,1/y);p.drawArrays(D.primitiveType,0,v.vertexCount(x,"geometry"));p.bindFramebuffer(E);p.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]);E=A?this.applyGridTechnique:this.applyTechnique;B=p.useTechnique(E);B.bindTexture(this.blur1Fbo.colorTexture,"tex");
B.bindTexture(u.colorTexture,"origin");A&&B.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,"coverageTex");E.bindApplyPass(this.defaultOptions);p.drawArrays(E.primitiveType,0,v.vertexCount(x,"geometry"));p.bindVAO(null)};r._gridUpdateResources=function(x,u){const E=this._rctx,y=this._grid;var A=!1;null===y.coverageMipmap&&(y.coverageMipmap=[x],A=!0);if(y.viewportWidth!==x.width||y.viewportHeight!==x.height)A=!0,y.viewportWidth=x.width,y.viewportHeight=x.height;y.coverageMipmap[0]=
x;y.cellPixelSize!==u&&(y.cellPixelSize=u,A=!0);if(A){for(u=1;u<y.coverageMipmap.length;u++)y.coverageMipmap[u].dispose();y.mipmapLevels=Math.ceil(Math.log(y.cellPixelSize)*Math.LOG2E);y.coverageMipmap.length=y.mipmapLevels+1;for(u=0;u<y.mipmapLevels;u++)A=y.coverageMipmap[u],y.coverageMipmap[u+1]=new z.FramebufferObject(E,{colorTarget:m.TargetType.TEXTURE,depthStencilTarget:m.DepthStencilTargetType.NONE,width:Math.ceil(A.width/2),height:Math.ceil(A.height/2)},{target:m.TextureType.TEXTURE_2D,pixelFormat:m.PixelFormat.RGB,
dataType:m.PixelType.UNSIGNED_SHORT_5_6_5,samplingMode:m.TextureSamplingMode.LINEAR,wrapMode:m.TextureWrapMode.CLAMP_TO_EDGE,width:Math.ceil(A.width/2),height:Math.ceil(A.height/2)})}A=Math.ceil(x.height/y.cellPixelSize);var p=Math.ceil(x.width/y.cellPixelSize);if(!y.vao||y.verticalCellCount!==A||y.horizontalCellCount!==p){y.verticalCellCount=A;y.horizontalCellCount=p;x=A+1;u=p+1;A=1/A;p=1/p;const B=new Float32Array(24*x*u);let D=0;for(let C=0;C<x;C++)for(let F=0;F<u;F++)B[D+0]=(F-.5)*p*2-1,B[D+1]=
(C-.5)*A*2-1,B[D+2]=F*p,B[D+3]=C*A,B[D+4]=(F+.5)*p*2-1,B[D+5]=(C-.5)*A*2-1,B[D+6]=F*p,B[D+7]=C*A,B[D+8]=(F-.5)*p*2-1,B[D+9]=(C+.5)*A*2-1,B[D+10]=F*p,B[D+11]=C*A,B[D+12]=(F-.5)*p*2-1,B[D+13]=(C+.5)*A*2-1,B[D+14]=F*p,B[D+15]=C*A,B[D+16]=(F+.5)*p*2-1,B[D+17]=(C-.5)*A*2-1,B[D+18]=F*p,B[D+19]=C*A,B[D+20]=(F+.5)*p*2-1,B[D+21]=(C+.5)*A*2-1,B[D+22]=F*p,B[D+23]=C*A,D+=24;y.vao&&y.vao.dispose(!0);y.vao=new q.VertexArrayObject(E,n.Default3D,{geometry:f.Pos2Tex},{geometry:d.BufferObject.createVertex(E,m.Usage.STATIC_DRAW,
B)})}};r._gridComputeMipmap=function(){const x=this._rctx,u=this._grid,E=x.useTechnique(this.downsampleTechnique);x.bindVAO(this.quadVAO);for(let y=0;y<u.mipmapLevels;y++){x.bindFramebuffer(u.coverageMipmap[y+1]);E.bindTexture(u.coverageMipmap[y].colorTexture,"tex");const A=u.coverageMipmap[y+1].width,p=u.coverageMipmap[y+1].height;E.setUniform2f("invFramebufferDim",1/A,1/p);x.setViewport(0,0,A,p);x.drawArrays(m.PrimitiveType.TRIANGLE_STRIP,0,v.vertexCount(this.quadVAO,"geometry"))}};a._createClass(t,
[{key:"profilingCallback",get:function(){return w.HIGHLIGHTS_PROFILE_TO_CONSOLE?x=>console.log(x):null}},{key:"gpuMemoryUsage",get:function(){let x=(b.isSome(this.blur0Fbo)?this.blur0Fbo.gpuMemoryUsage:0)+(b.isSome(this.blur1Fbo)?this.blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const u of this._grid.coverageMipmap)x+=u.gpuMemoryUsage;return x}},{key:"test",get:function(){return{coverage:this._grid.coverageMipmap,blur:[this.blur0Fbo,this.blur1Fbo]}}}]);return t}()})},"esri/chunks/HighlightComposition.glsl":function(){define(["exports",
"../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/lib/VertexAttribute"],function(a,b,c,g){function h(n){const f=new c.ShaderBuilder,l=f.vertex.code,k=f.fragment.code;f.attributes.add(g.VertexAttribute.POSITION,"vec2");n.highlightStage===a.HighlightCompositionPass.Downsample&&(l.add(b.glsl`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),f.fragment.uniforms.add("tex","sampler2D"),f.fragment.uniforms.add("invFramebufferDim","vec2"),k.add(b.glsl`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`));n.highlightStage===a.HighlightCompositionPass.Blur&&(f.attributes.add(g.VertexAttribute.UV0,"vec2"),n.gridOptimization?(f.vertex.uniforms.add("coverageTex","sampler2D"),f.fragment.uniforms.add("blurSize","vec2"),f.varyings.add("blurCoordinate","vec3")):(f.vertex.uniforms.add("blurSize","vec2"),f.varyings.add("blurCoordinates[5]","vec2")),l.add(b.glsl`
    void main() {
      gl_Position = vec4(position, 0.0, 1.0);
      ${n.gridOptimization?b.glsl`
      vec4 cov = texture2D(coverageTex, uv0);
      if (cov.r == 0.0) {
        gl_Position = vec4(0.0);
      }
      blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
      `:b.glsl`
      vec2 uv = position.xy * 0.5 + vec2(0.5);
      blurCoordinates[0] = uv;
      blurCoordinates[1] = uv + blurSize * 1.407333;
      blurCoordinates[2] = uv - blurSize * 1.407333;
      blurCoordinates[3] = uv + blurSize * 3.294215;
      blurCoordinates[4] = uv - blurSize * 3.294215;
          `}
    }`),f.fragment.uniforms.add("tex","sampler2D"),k.add(b.glsl`
    void main() {
      ${n.gridOptimization?b.glsl`
          vec2 uv = blurCoordinate.xy;
          vec4 center = texture2D(tex, uv);

          // do not blur if no pixel or all pixels in neighborhood are set
          if (blurCoordinate.z == 1.0) {
            gl_FragColor = center;
          } else {
            vec4 sum = vec4(0.0);
            sum += center * 0.204164;
            sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
            sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
            sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
            sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
            gl_FragColor = sum;
          }`:b.glsl`
          vec4 sum = vec4(0.0);
          sum += texture2D(tex, blurCoordinates[0]) * 0.204164;
          sum += texture2D(tex, blurCoordinates[1]) * 0.304005;
          sum += texture2D(tex, blurCoordinates[2]) * 0.304005;
          sum += texture2D(tex, blurCoordinates[3]) * 0.093913;
          sum += texture2D(tex, blurCoordinates[4]) * 0.093913;
          gl_FragColor = sum;`}
    }`));n.highlightStage===a.HighlightCompositionPass.Apply&&(f.varyings.add("uv","vec2"),n.gridOptimization&&(f.attributes.add(g.VertexAttribute.UV0,"vec2"),f.vertex.uniforms.add("coverageTex","sampler2D")),l.add(b.glsl`
      void main() {
        ${n.gridOptimization?b.glsl`
            vec4 cov = texture2D(coverageTex, uv0);
            // if no highlight pixel set in this block, hide block
            if (cov.r == 0.0) {
              gl_Position = vec4(0.0);
              return;
            }`:""}
        gl_Position = vec4(position, 0.0, 1.0);
        uv = position.xy * 0.5 + vec2(0.5);
      }`),f.fragment.uniforms.add("tex","sampler2D"),f.fragment.uniforms.add("origin","sampler2D"),f.fragment.uniforms.add("uColor","vec4"),f.fragment.uniforms.add("haloColor","vec4"),f.fragment.uniforms.add("outlineSize","float"),f.fragment.uniforms.add("blurSize","float"),f.fragment.uniforms.add("opacities","vec4"),k.add(b.glsl`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`));return f}a.HighlightCompositionPass=void 0;(function(n){n[n.Blur=0]="Blur";n[n.Apply=1]="Apply";n[n.Downsample=2]="Downsample";n[n.COUNT=3]="COUNT"})(a.HighlightCompositionPass||(a.HighlightCompositionPass={}));const w=Object.freeze({__proto__:null,get HighlightCompositionPass(){return a.HighlightCompositionPass},build:h});a.HighlightCompositionShader=w;a.build=h})},"esri/views/3d/webgl-engine/shaders/HighlightTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HighlightComposition.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){w=function(m){function z(){return m.apply(this,arguments)||this}c._inheritsLoose(z,m);var v=z.prototype;v.initializeProgram=function(q){const t=z.shader.get().build(this.configuration);return new l.Program(q.rctx,t,f.Default3D)};v.bindApplyPass=function(q){this.program.setUniform4fv("uColor",q.color);this.program.setUniform4fv("haloColor",q.haloColor);this.program.setUniform1f("outlineSize",8.6);this.program.setUniform1f("blurSize",.4);this.program.setUniform4f("opacities",
q.haloOpacity,q.haloOpacityOccluded,q.fillOpacity,q.fillOpacityOccluded)};v.initializePipeline=function(){return this.configuration.highlightStage===k.HighlightCompositionPass.Apply?d.makePipelineState({blending:d.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:d.defaultColorWriteParams}):d.makePipelineState({colorWrite:d.defaultColorWriteParams})};c._createClass(z,[{key:"primitiveType",get:function(){return this.configuration.gridOptimization?
e.PrimitiveType.TRIANGLES:e.PrimitiveType.TRIANGLE_STRIP}}]);return z}(w.ShaderTechnique);w.shader=new h.ReloadableShaderModule(k.HighlightCompositionShader,()=>new Promise((m,z)=>a(["./HighlightComposition.glsl"],m,z)));h=function(m){function z(){var v=m.apply(this,arguments)||this;v.highlightStage=k.HighlightCompositionPass.Blur;v.gridOptimization=!1;return v}c._inheritsLoose(z,m);return z}(n.ShaderTechniqueConfiguration);g.__decorate([n.parameter({count:k.HighlightCompositionPass.COUNT})],h.prototype,
"highlightStage",void 0);g.__decorate([n.parameter()],h.prototype,"gridOptimization",void 0);b.HighlightCompositionTechnique=w;b.HighlightCompositionTechniqueConfiguration=h;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/OffscreenRendering":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./basicInterfaces ./RenderTargetHelper ../../../../chunks/Compositing.glsl ../shaders/CompositingTechnique ../../../webgl/context-util ../../../webgl/enums".split(" "),
function(a,b,c,g,h,w,n,f,l){let k=function(){function m(v,q){this._rctx=v;this._compositingHelper=q;this._mainColorTarget=0;this._dimensions={width:4,height:4};this._needLastFrameColorTexture=!1;this._background={type:"color",color:[0,0,0,1]};const t=v.type===f.ContextType.WEBGL2,r=this._renderTargetHelper=new h.RenderTargetHelper(v);this.mainColorTargets=[r.registerColorTarget({name:"mainColorTarget0"}),r.registerColorTarget({name:"mainColorTarget1"})];this.frontFaceTarget=r.registerColorTarget({name:"frontFaceTarget"});
v=x=>r.registerColorTarget({name:x,dataType:l.PixelType.FLOAT,internalFormat:t?l.SizedPixelFormat.RGBA32F:l.PixelFormat.RGBA,samplingMode:l.TextureSamplingMode.NEAREST});this.colorFloatTarget=v("colorFloatTarget");this.alphaFloatTarget=v("alphaFloatTarget");this.mainDepth=r.registerDepthTarget({name:"mainDepth"});this.linearDepth=r.registerColorTarget({name:"linearDepth",samplingMode:l.TextureSamplingMode.NEAREST});this.terrainLinearDepth=r.registerColorTarget({name:"terrainLinearDepth"});this.geometryLinearDepth=
r.registerColorTarget({name:"geometryLinearDepth"});this.normal=r.registerColorTarget({name:"normal"});this.highlight=r.registerColorTarget({name:"highlight",internalFormat:t?l.SizedPixelFormat.RGBA4:l.PixelFormat.RGBA,dataType:l.PixelType.UNSIGNED_SHORT_4_4_4_4});this.hudVisibility=r.registerColorTarget({name:"hudVisibility",internalFormat:t?l.SizedPixelFormat.RGBA4:l.PixelFormat.RGBA,dataType:l.PixelType.UNSIGNED_SHORT_4_4_4_4});this.tmpColor=r.registerColorTarget({name:"tmpColor"});this.tmpDepth=
r.registerDepthTarget({name:"tmpDepth"});this.hudColor=r.registerColorTarget({name:"hudColor"})}var z=m.prototype;z.dispose=function(){this._renderTargetHelper.dispose()};z.getFramebuffer=function(v,q){return this._renderTargetHelper.getFramebuffer(this._dimensions,v,q)};z.advanceCurrentRenderTarget=function(){this._mainColorTarget=0===this._mainColorTarget&&this._needLastFrameColorTexture?1:0};z.initializeFrame=function(v){const q=this._rctx;this._dimensions.width=v.fullWidth;this._dimensions.height=
v.fullHeight;this.bindTarget(this.currentColorTarget,this.mainDepth);q.setClearStencil(0);v=this._background.color;q.setClearColor(v[0]*v[3],v[1]*v[3],v[2]*v[3],v[3]);q.clearSafe(l.ClearBufferBit.COLOR_BUFFER_BIT|l.ClearBufferBit.DEPTH_BUFFER_BIT|l.ClearBufferBit.STENCIL_BUFFER_BIT)};z.composite=function(){c.isSome(this.colorTexture)&&this._compositingHelper.composite(this.colorTexture,n.AlphaMode.None)};z.renderTmpAndCompositeToMain=function(v,q,t=!1){this.renderToTargets(v,this.tmpColor,t?this.tmpDepth:
this.mainDepth,e);this._compositingHelper.composite(this._getColorTexture(this.tmpColor),q)};z.renderHUDVisibility=function(v,q=!1){this.renderToTargets(v,this.hudVisibility,q?this.tmpDepth:this.mainDepth,d)};z.compositeTransparentTerrainOntoHUDVisibility=function(){this.renderToTargets(()=>this._compositingHelper.composite(this._getColorTexture(this.tmpColor),n.AlphaMode.None,1,w.CompositingFunction.TransparentToHUDVisibility),this.hudVisibility,this.tmpDepth)};z.renderOITPass=function(v,q,t){let r,
x;switch(q){case g.TransparencyPassType.Color:r=this.colorFloatTarget;x=[0,0,0,0];break;case g.TransparencyPassType.Alpha:r=this.alphaFloatTarget;x=[1,1,1,1];break;case g.TransparencyPassType.FrontFace:r=this.frontFaceTarget,x=[0,0,0,0]}t?this.renderToTargets(v,r,this.tmpDepth,x,!0,!0):this.renderToTargets(v,r,this.mainDepth,x,!1)};z.compositeTransparentTerrainOntoMain=function(){this.bindFramebuffer();this._compositingHelper.composite(this._getColorTexture(this.tmpColor),n.AlphaMode.PremultipliedAlpha)};
z.compositeOccludedOntoMain=function(v){this.bindFramebuffer();this._compositingHelper.composite(this._getColorTexture(this.tmpColor),n.AlphaMode.PremultipliedAlpha,v)};z.compositeTransparentOntoOpaque=function(v){v?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1E-13),this._rctx.clearSafe(l.ClearBufferBit.COLOR_BUFFER_BIT)):this.bindFramebuffer();this._compositingHelper.compositeTransparent(this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),
this._getColorTexture(this.frontFaceTarget))};z.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)};z.renderDepthDetached=function(v){this.bindTarget(this.currentColorTarget);v();this.bindTarget(this.currentColorTarget,this.mainDepth)};z.disposeTarget=function(v){this._renderTargetHelper.disposeTargetResource(v)};z.renderToTargets=function(v,q,t,r,x=!1,u=!1){const E=this._rctx;q=this.bindTarget(q,t);t=0;r&&(E.setClearColor(r[0],r[1],r[2],Math.max(1E-13,r[3])),t|=l.ClearBufferBit.COLOR_BUFFER_BIT);
x&&(t|=l.ClearBufferBit.DEPTH_BUFFER_BIT);!1===u?u=0:(!0===u&&(u=255),t|=l.ClearBufferBit.STENCIL_BUFFER_BIT);t&&E.clearSafe(t,u);v();E.gl.flush();this.bindTarget(this.currentColorTarget,this.mainDepth);return q};z.bindTarget=function(v,q){v=this._renderTargetHelper.getFramebuffer(this._dimensions,v,q);this._rctx.bindFramebuffer(v);return v};z._getColorTexture=function(v){return this._renderTargetHelper.getColorTexture(v,this._dimensions)};b._createClass(m,[{key:"width",get:function(){return this._dimensions.width}},
{key:"height",get:function(){return this._dimensions.height}},{key:"background",get:function(){return this._background},set:function(v){this._background=v}},{key:"currentColorTarget",get:function(){return this.mainColorTargets[this._mainColorTarget]}},{key:"previousColorTarget",get:function(){return this.mainColorTargets[1-this._mainColorTarget]}},{key:"framebuffer",get:function(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}},{key:"colorTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}},
{key:"depthTexture",get:function(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}},{key:"linearDepthTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}},{key:"terrainLinearDepthTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}},{key:"geometryLinearDepthTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}},{key:"lastFrameColorTexture",
get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}},{key:"normalTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}},{key:"highlightTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}},{key:"hudVisibilityTexture",get:function(){return this._getColorTexture(this.hudVisibility)}},{key:"tmpColorTexture",get:function(){return this._getColorTexture(this.tmpColor)}},{key:"hudColorTexture",
get:function(){return this._getColorTexture(this.hudColor)}},{key:"mainColorTexture",get:function(){return this._getColorTexture(this.currentColorTarget)}},{key:"needLastFrameColorTexture",get:function(){return this._needLastFrameColorTexture},set:function(v){!v&&this._needLastFrameColorTexture&&(this._mainColorTarget=0,this.disposeTarget(this.mainColorTargets[1]));this._needLastFrameColorTexture=v}},{key:"gpuMemoryUsage",get:function(){let v=0;this._renderTargetHelper&&(v+=this._renderTargetHelper.gpuMemoryUsage);
return v}}]);return m}();const e=[0,0,0,0],d=[0,1,0,1];a.OffscreenRendering=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderTargetHelper":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/uid ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/Texture ../../../webgl/Util".split(" "),function(a,b,c,g,h,w,n,f,l){const k={dataType:h.PixelType.UNSIGNED_BYTE,
internalFormat:h.PixelFormat.RGBA},e={};let d=function(){function m(v){this.rctx=v;this._activeTargets=new Set;this._depthTextures=new Map;this._depthBuffers=new Map;this._colorTextures=new Map;this._framebuffers=new Map;this.depthTextureSupported=v.capabilities.depthTexture}var z=m.prototype;z.dispose=function(){this._depthBuffers.forEach(v=>v.dispose());this._depthBuffers.clear();this._depthTextures.forEach(v=>v.dispose());this._depthTextures.clear();this._colorTextures.forEach(v=>v.dispose());
this._colorTextures.clear();this._framebuffers.forEach(v=>v.dispose());this._framebuffers.clear();this._activeTargets.clear()};z.disposeTargetResource=function(v){v=v.id;this._activeTargets.has(v)&&(this._activeTargets.delete(v),this._disposeWithFramebuffers(this._depthTextures,v),this._disposeWithFramebuffers(this._depthBuffers,v),this._disposeWithFramebuffers(this._colorTextures,v))};z._disposeWithFramebuffers=function(v,q){const t=v.get(q);t&&(this._framebuffers.forEach((r,x)=>{if(r.colorAttachment===
t||r.depthStencilAttachment===t)r.detachAll(),r.dispose(),this._framebuffers.delete(x)}),t.dispose(),v.delete(q))};z.getDepthTexture=function(v,q){if(!this.depthTextureSupported)return null;let t=this._depthTextures.get(v.id);!t||t.descriptor.width===q.width&&t.descriptor.height===q.height||(t.dispose(),t=null);t||(t=new f.Texture(this.rctx,{target:h.TextureType.TEXTURE_2D,pixelFormat:h.PixelFormat.DEPTH_STENCIL,dataType:h.PixelType.UNSIGNED_INT_24_8,samplingMode:h.TextureSamplingMode.NEAREST,wrapMode:h.TextureWrapMode.CLAMP_TO_EDGE,
width:q.width,height:q.height}),this._depthTextures.set(v.id,t),this._activeTargets.add(v.id));return t};z.getAllocatedDepthTexture=function(v){return this._depthTextures.get(v.id)};z.getDepthBuffer=function(v,q){if(this.depthTextureSupported)return null;let t=this._depthBuffers.get(v.id);t?t.descriptor.width===q.width&&t.descriptor.height===q.height||t.resize(q.width,q.height):(t=new n.Renderbuffer(this.rctx,{internalFormat:h.RenderbufferFormat.DEPTH_STENCIL,...q}),this._depthBuffers.set(v.id,t),
this._activeTargets.add(v.id));return t};z.getColorTexture=function(v,q){let t=this._colorTextures.get(v.id);!t||t.descriptor.width===q.width&&t.descriptor.height===q.height||(t.dispose(),t=null);t||(t=new f.Texture(this.rctx,{target:h.TextureType.TEXTURE_2D,pixelFormat:h.PixelFormat.RGBA,internalFormat:v.internalFormat,dataType:v.dataType,samplingMode:null!=v.samplingMode?v.samplingMode:h.TextureSamplingMode.LINEAR,wrapMode:h.TextureWrapMode.CLAMP_TO_EDGE,width:q.width,height:q.height}),this._colorTextures.set(v.id,
t),this._activeTargets.add(v.id));return t};z.getAllocatedColorTexture=function(v){return this._colorTextures.get(v.id)};z.registerDepthTarget=function(v={}){return{id:g.generateUID(),...e,...v}};z.registerColorTarget=function(v={}){return{id:g.generateUID(),...k,...v}};z.getFramebuffer=function(v,q,t){const r=this._getKey(q,t);let x=this._framebuffers.get(r);q=this.getColorTexture(q,v);if(this.depthTextureSupported){var u=t?this.getDepthTexture(t,v):void 0;if(!x)return x=c.isSome(t)?new w.FramebufferObject(this.rctx,
{colorTarget:h.TargetType.TEXTURE,depthStencilTarget:h.DepthStencilTargetType.DEPTH_STENCIL_TEXTURE},q,u):new w.FramebufferObject(this.rctx,{colorTarget:h.TargetType.TEXTURE,depthStencilTarget:h.DepthStencilTargetType.NONE},q),this._framebuffers.set(r,x),x;if(x.width!==v.width||x.height!==v.height||x.colorTexture!==q||x.depthStencilTexture!==u)x.detachAll(),x.resize(v.width,v.height),x.attachColorTexture(q),x.attachDepthStencilTexture(u);return x}u=t?this.getDepthBuffer(t,v):void 0;if(!x)return x=
new w.FramebufferObject(this.rctx,{colorTarget:h.TargetType.TEXTURE,depthStencilTarget:t?h.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER:h.DepthStencilTargetType.NONE},q,u),this._framebuffers.set(r,x),x;if(x.width!==v.width||x.height!==v.height||x.colorTexture!==q)x.detachAll(),x.resize(v.width,v.height),x.attachColorTexture(q),x.attachDepthStencilBuffer(u);return x};z._getKey=function(v,q){return`${v.id}_${q?q.id:"X"}_${v.name}${q?"_"+q.name:""}`};b._createClass(m,[{key:"gpuMemoryUsage",get:function(){let v=
0;const q=new Set,t=r=>{q.has(r)||(q.add(r),v+=l.getGpuMemoryUsage(r))};this._depthTextures.forEach(t);this._colorTextures.forEach(t);this._depthBuffers.forEach(t);return v}}]);return m}();a.RenderTargetHelper=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderPluginManager":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/promiseUtils ./depthRange ./RenderSlot ./Util".split(" "),function(a,b,c,g,h,w){let n=function(){function l(e){this.context=
e;this.renderPlugins=[];this.slots=[];for(e=0;e<h.RenderSlot.MAX_SLOTS;++e)this.slots[e]=[]}var k=l.prototype;k.add=function(e,d,m){const z=()=>{this.renderPlugins.push(d);for(const v of e)this.slots[v].push(d);this.context.requestRender()};m=d.initializeRenderContext(this.context,m);if(c.isPromiseLike(m))return m.then(z);z()};k.remove=function(e){var d=this.renderPlugins.length;this.renderPlugins=this.renderPlugins.filter(m=>m!==e);w.assert(this.renderPlugins.length<d,"Removing non-added render plugin");
for(d=0;d<this.slots.length;++d)this.slots[d]=this.slots[d].filter(m=>m!==e);e.uninitializeRenderContext();this.context.requestRender()};k.prepareRender=function(e,d){for(const m of this.renderPlugins)m.prepareRender&&m.prepareRender(e,d)};k.updateAnimation=function(e){let d=!1;this.renderPlugins.forEach(m=>{m.updateAnimation&&(d=m.updateAnimation(e)||d)});return d};k.render=function(){const e=[];this.slots[this.context.renderContext.slot].filter(d=>{if(!d.canRender)return!1;if("prepareTechnique"in
d)return(d=d.prepareTechnique(this.context.renderContext))?(e.push(d),!0):!1;e.push(null);return!0}).forEach((d,m)=>d.render(this.context.renderContext,e[m]))};k.queryDepthRange=function(e){const d=f;d.near=Infinity;d.far=-Infinity;for(const m of this.renderPlugins)if(m.queryDepthRange){const z=m.queryDepthRange(e);z&&g.union(d,z,d)}return d};b._createClass(l,[{key:"needsTransparentPass",get:function(){return this.renderPlugins.some(e=>e.needsTransparentPass)}},{key:"needsHighlight",get:function(){return this.renderPlugins.some(e=>
e.needsHighlight)}},{key:"needsLinearDepth",get:function(){return this.renderPlugins.some(e=>e.needsLinearDepth)}},{key:"needsLaserlineWithContrastControl",get:function(){const e=this.slots[h.RenderSlot.LASERLINES_CONTRAST_CONTROL];return!!e&&0<e.length}},{key:"renderOccludedFlags",get:function(){let e=0;this.renderPlugins.forEach(d=>{d.renderOccludedFlags&&(e|=d.renderOccludedFlags)});return e}}]);return l}();const f={near:0,far:0};a.RenderPluginManager=n;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/webgl-engine/lib/ShadowAccumulator":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Handles ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ./Camera ./depthRange ./glUtil3D ./ShadowCastRenderer ./ShadowMap ./Util ../../../../chunks/ShadowCast.glsl ../shaders/ShadowCastTechnique ../../../support/Scheduler ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Util".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H){var M;a.ShadowAccumulator=M=function(I){function O(J,P,N,R,S,T){var V=I.call(this,{})||this;V._rctx=J;V._stage=N;V._prepareForShadowMapPass=R;V._renderToShadowMap=S;V._requestRender=T;V._progress=0;V._sampleCount=0;V._cachedCamera=new u.default;V._contentCamera=new u.default;V._enabled=!1;V._cachedLightDirections=[];V._depthRange=E.ZERO;V._previewing=!1;V._handles=new w;V._cameraForcedForScreenshot=!1;V._shadowMap=new p(J,N.viewingMode);
V._shadowMap.enabled=!0;V._vao=y.createQuadVAO(J);V._fbo=new L.FramebufferObject(J,{colorTarget:G.TargetType.TEXTURE,depthStencilTarget:G.DepthStencilTargetType.NONE,width:0,height:0},{target:G.TextureType.TEXTURE_2D,pixelFormat:G.PixelFormat.RGBA,dataType:G.PixelType.UNSIGNED_BYTE,samplingMode:G.TextureSamplingMode.LINEAR,wrapMode:G.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0});V._accumulationParams={camera:V._cachedCamera,linearDepthTexture:null,shadowMap:V._shadowMap,inverseViewMatrix:v.create(),
projInfo:x.create(),zScale:q.create()};V._accumulationRenderer=new A.ShadowCastRenderer(P,J,b._assertThisInitialized(V),T);V._handles.add(V._stage.resourceController.scheduler.registerTask(F.TaskPriority.SHADOW_ACCUMULATOR,b._assertThisInitialized(V)));V._handles.add(l.watch(()=>N.renderView,W=>{V._handles.remove(M.renderViewHandleKey);f.isNone(W)||V._handles.add(W.events.on("force-camera-for-screenshot",()=>V._cameraForcedForScreenshot=!0),M.renderViewHandleKey)},l.syncAndInitial));return V}b._inheritsLoose(O,
I);var Q=O.prototype;Q.normalizeCtorArgs=function(){return{}};Q.runTask=function(J){for(this._prepareForShadowMapPass(this._cachedCamera,this._contentCamera);!J.done&&!this._isDoneAccumulating;)this._accumulateShadow(),J.madeProgress();this._requestRender()};Q.accumulateFixedSamples=function(){if(this.isAccumulating&&this._canAccumulate){(this._previewing||0===this._progress||this._cameraForcedForScreenshot)&&this._clear();var J=this._cameraForcedForScreenshot?this._sampleCount:Math.min(M.previewSamples,
this._sampleCount-this._progress);for(let P=0;P<J;++P)this._accumulateShadow();this._cameraForcedForScreenshot=!1}};Q.render=function(){this._accumulationRenderer.render()};Q.dispose=function(){this._stop();this._handles.destroy();this._accumulationRenderer=f.disposeMaybe(this._accumulationRenderer);this._shadowMap=f.disposeMaybe(this._shadowMap);this._fbo=f.disposeMaybe(this._fbo);this._vao=f.disposeMaybe(this._vao);this._accumulationTechnique=f.releaseMaybe(this._accumulationTechnique);this._sampleCount=
this._cachedLightDirections.length=0};Q.setOptions=function(J){void 0!==J.enabled&&this._setEnabled(J.enabled);void 0!==J.previewing&&this.setPreviewing(J.previewing);void 0!==J.lightDirections&&this.setLightDirections(J.lightDirections);this._accumulationRenderer.setOptions(J)};Q.setPreviewing=function(J){this._previewing!==J&&(this._previewing=J,this._requestRenderIfEnabled())};Q.setLightDirections=function(J){this._lightDirections=J};Q.setAccumulationDependencies=function(J,P,N,R){this._accumulationParams.linearDepthTexture=
J;this._depthRange=P;this._updateCamera(N);this._contentCamera=R;this.notifyChange("_canAccumulate")};Q.readAccumulatedShadow=function(J,P){if(!this._isActive||1>this._progress||0>J||J>this._fbo.width||0>P||P>this._fbo.height)return 0;const N=K;this._fbo.readPixels(J,P,1,1,G.PixelFormat.RGBA,G.PixelType.UNSIGNED_BYTE,N);return N[0]/this._progress};Q._start=function(){this._progress=0;this._enabled=!0};Q._stop=function(){this._enabled=!1};Q._invalidate=function(){this._progress=0;this._requestRenderIfEnabled()};
Q._clear=function(){this._rctx.bindFramebuffer(this._fbo);this._rctx.setClearColor(0,0,0,0);this._rctx.clearSafe(G.ClearBufferBit.COLOR_BUFFER_BIT);this._progress=0};Q._accumulateShadow=function(){this._renderToShadowMap(this._shadowMap,this._lightDirections[this._progress],this._cachedCamera,this._depthRange);this._rctx.bindFramebuffer(this._fbo);const J=this.accumulationTechnique;this._rctx.useTechnique(J);J.bindPass(this._accumulationParams);this._rctx.bindVAO(this._vao);this._rctx.drawArrays(J.primitiveType,
0,H.vertexCount(this._vao,"geometry"));this._progress++};Q._updateCamera=function(J){if(!J.equals(this._cachedCamera)){var {fullWidth:P,fullHeight:N,projectionMatrix:R,viewMatrix:S,center:T}=J;this._cachedCamera.copyFrom(J);this._fbo.resize(P,N);B.inverseProjectionInfo(R,P,N,this._projInfo,this._zScale);z.translate(this._inverseView,S,T);z.invert(this._inverseView,this._inverseView);this._opacityFromElevation=1-n.smoothstep(A.shadowCastDisableElevationMin,A.shadowCastDisableElevationMax,J.relativeElevation)}};
Q._setEnabled=function(J){J!==this._enabled&&(J?this._start():this._stop())};Q._requestRenderIfEnabled=function(){this._enabled&&this._requestRender()};b._createClass(O,[{key:"computedSamples",get:function(){return this._progress}},{key:"shadowCastTexture",get:function(){return this._fbo.colorTexture}},{key:"isAccumulating",get:function(){return this._isPreviewing||this._isRefining}},{key:"accumulationTechnique",get:function(){if(f.isNone(this._accumulationTechnique)){const J={rctx:this._rctx,viewingMode:this._stage.viewingMode},
P=new C.ShadowCastTechniqueConfiguration;P.pass=D.ShadowCastPass.Accumulate;this._accumulationTechnique=new C.ShadowCastTechnique(J,P)}return this._accumulationTechnique}},{key:"_isRefining",get:function(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}},{key:"_isPreviewing",get:function(){return this._isActive&&this._previewing}},{key:"_isActive",get:function(){return this._enabled&&0<this._sampleCount}},{key:"_canAccumulate",get:function(){return null!==this._accumulationParams.linearDepthTexture&&
this._depthRange!==E.ZERO&&this._opacityFromElevation>A.shadowCastDisabledElevationThreshold}},{key:"_isDoneAccumulating",get:function(){return this._progress>=this._sampleCount}},{key:"_lightDirections",get:function(){return this._cachedLightDirections},set:function(J){const P=this._cachedLightDirections;if(!h.equals(P,J,t.equals)){var N=J.length;P.length=N;this._sampleCount=Math.min(D.shadowCastMaxSamples,N);for(let R=0;R<N;++R){const S=J[R],T=P[R]||r.create();t.copy(T,S);P[R]=T}this._invalidate()}}},
{key:"_projInfo",get:function(){return this._accumulationParams.projInfo}},{key:"_zScale",get:function(){return this._accumulationParams.zScale}},{key:"_inverseView",get:function(){return this._accumulationParams.inverseViewMatrix}},{key:"_opacityFromElevation",get:function(){return this._accumulationRenderer.opacityFromElevation},set:function(J){this._accumulationRenderer.opacityFromElevation=J}},{key:"running",get:function(){return this._isRefining&&this._canAccumulate&&0<this._progress}},{key:"test",
get:function(){return{lightDirections:this._lightDirections,isDone:()=>this._isDoneAccumulating,isActive:()=>this._isActive}}}]);return O}(g);a.ShadowAccumulator.previewSamples=6;a.ShadowAccumulator.renderViewHandleKey="renderView";c.__decorate([k.property()],a.ShadowAccumulator.prototype,"_progress",void 0);c.__decorate([k.property()],a.ShadowAccumulator.prototype,"_sampleCount",void 0);c.__decorate([k.property()],a.ShadowAccumulator.prototype,"_enabled",void 0);c.__decorate([k.property()],a.ShadowAccumulator.prototype,
"_depthRange",void 0);c.__decorate([k.property()],a.ShadowAccumulator.prototype,"_previewing",void 0);c.__decorate([k.property()],a.ShadowAccumulator.prototype,"_accumulationRenderer",void 0);c.__decorate([k.property()],a.ShadowAccumulator.prototype,"_isRefining",null);c.__decorate([k.property()],a.ShadowAccumulator.prototype,"_isActive",null);c.__decorate([k.property()],a.ShadowAccumulator.prototype,"_canAccumulate",null);c.__decorate([k.property()],a.ShadowAccumulator.prototype,"_isDoneAccumulating",
null);c.__decorate([k.property()],a.ShadowAccumulator.prototype,"_opacityFromElevation",null);c.__decorate([k.property()],a.ShadowAccumulator.prototype,"running",null);a.ShadowAccumulator=M=c.__decorate([m.subclass("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],a.ShadowAccumulator);const K=new Uint8Array(4);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ShadowCastRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec4 ../../../../chunks/vec4f64 ./glUtil3D ../../../../chunks/ShadowCast.glsl ../shaders/ShadowCastTechnique ../../../webgl/Util".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q){const t=d.fromValues(.01,0,.25,1),r=1/512;a.ShadowCastRenderer=function(x){function u(y,A,p,B){var D=x.call(this,{})||this;D._techniqueRepository=y;D._rctx=A;D._shadowAccumulator=p;D._requestRender=B;D._visualizationParams={shadowCastMap:D._shadowCastTexture,sampleScale:0,color:t,threshold:.5,bandSize:.1,opacityFromElevation:1};D._techniqueConfig=new v.ShadowCastTechniqueConfiguration;D._enabled=!1;D._vao=m.createQuadVAO(A);D._techniqueConfig.pass=z.ShadowCastPass.Visualize;
D._techniqueConfig.visualization=z.ShadowCastVisualization.Gradient;return D}b._inheritsLoose(u,x);var E=u.prototype;E.normalizeCtorArgs=function(){return{}};E.dispose=function(){this._stop();this._vao=h.disposeMaybe(this._vao);this._techniqueRepository.release(this._technique);this._shadowAccumulator=this._technique=null};E.render=function(){if(this._isRenderingVisualization){this._sampleScale=1/this._computedSamples;this._rctx.bindVAO(this._vao);var y=this.visualizeShadowCastTechnique;this._rctx.useTechnique(y);
y.bindPass(this._visualizationParams);this._rctx.drawArrays(y.primitiveType,0,q.vertexCount(this._vao,"geometry"))}};E.setOptions=function(y){void 0!==y.enabled&&this._setEnabled(y.enabled);void 0!==y.color&&this._setColor(y.color);void 0!==y.threshold&&(this._threshold=y.threshold);void 0!==y.visualization&&(this._visualization=y.visualization);void 0!==y.bandSize&&(this._bandSize=y.bandSize);void 0!==y.bandsEnabled&&(this._bandsEnabled=y.bandsEnabled)};E._setColor=function(y){e.exactEquals(y,this._visualizationParams.color)||
(e.copy(this._visualizationParams.color,y),this._requestRenderIfRunning())};E._setEnabled=function(y){y!==this._enabled&&(y?this._start():this._stop())};E._requestRenderIfRunning=function(){this._enabled&&this._requestRender()};E._start=function(){this._enabled=!0;this._requestRender()};E._stop=function(){this._enabled=!1;this._requestRender()};b._createClass(u,[{key:"visualizeShadowCastTechnique",get:function(){return this._technique=this._techniqueRepository.releaseAndAcquire(v.ShadowCastTechnique,
this._techniqueConfig,this._technique)}},{key:"opacityFromElevation",get:function(){return this._visualizationParams.opacityFromElevation},set:function(y){this._visualizationParams.opacityFromElevation!==y&&(this._visualizationParams.opacityFromElevation=y,this.notifyChange("opacityFromElevation"))}},{key:"_isRenderingVisualization",get:function(){return this._enabled&&0<this._computedSamples&&this.opacityFromElevation>r}},{key:"_computedSamples",get:function(){return this._shadowAccumulator.computedSamples}},
{key:"_shadowCastTexture",get:function(){return this._shadowAccumulator.shadowCastTexture}},{key:"_sampleScale",get:function(){return this._visualizationParams.sampleScale},set:function(y){this._visualizationParams.sampleScale=y}},{key:"_threshold",get:function(){return this._visualizationParams.threshold},set:function(y){this._threshold!==y&&(this._visualizationParams.threshold=y,this._requestRenderIfRunning())}},{key:"_visualization",get:function(){return this._techniqueConfig.visualization},set:function(y){y!==
this._visualization&&(this._techniqueConfig.visualization=y,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}},{key:"_bandSize",get:function(){return this._visualizationParams.bandSize},set:function(y){y!==this._bandSize&&(this._visualizationParams.bandSize=y,this._requestRenderIfRunning())}},{key:"_bandsEnabled",get:function(){return this._techniqueConfig.bandsEnabled},set:function(y){y!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=
y,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}}]);return u}(g);c.__decorate([w.property()],a.ShadowCastRenderer.prototype,"opacityFromElevation",null);a.ShadowCastRenderer=c.__decorate([k.subclass("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],a.ShadowCastRenderer);a.shadowCastDisableElevationMax=5E4;a.shadowCastDisableElevationMin=4E4;a.shadowCastDisabledElevationThreshold=r;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/ShadowCast.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,b,c,g,h,w,n,f){function l(d){const m=new f.ShaderBuilder;m.fragment.include(w.RgbaFloatEncoding);m.fragment.include(c.ReadLinearDepth);m.include(h.CameraSpace);m.include(b.ScreenSpacePass);var {pass:z}=d;if(z===a.ShadowCastPass.Visualize){const {visualization:v,bandsEnabled:q}=d;m.fragment.constants.add("inverseSampleValue","float",255);m.fragment.uniforms.add("shadowCastMap","sampler2D");m.fragment.uniforms.add("sampleScale","float");m.fragment.uniforms.add("opacityFromElevation","float");
d=v===a.ShadowCastVisualization.Gradient;z=v===a.ShadowCastVisualization.Threshold;m.fragment.uniforms.add("uColor","vec4");d?q&&m.fragment.uniforms.add("bandSize","float"):z&&m.fragment.uniforms.add("threshold","float");m.fragment.code.add(n.glsl`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;

        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${z?n.glsl`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${d&&q?n.glsl`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${d?n.glsl`* strength`:""});
      }
    `)}else if(z===a.ShadowCastPass.Accumulate||z===a.ShadowCastPass.VisualizeCurrent)m.include(g.ReadShadowMap),m.fragment.uniforms.add("depthMap","sampler2D"),m.fragment.uniforms.add("inverseViewMatrix","mat4"),m.fragment.uniforms.add("nearFar","vec2"),z===a.ShadowCastPass.Accumulate?m.fragment.constants.add("sampleValue","float",k):m.fragment.constants.add("shadowColor","vec4",[0,0,0,.8]),m.fragment.code.add(n.glsl`
      void main(void) {

        float depth = rgba2float(texture2D(depthMap, uv));
        // 0.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
        if (depth == 0.0) {
          discard;
        }

        float currentPixelDepth = linearDepthFromFloat(depth, nearFar);

        if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
          discard;
        }

        vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
        vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;

        mat4 shadowMatrix;
        float linearDepth = -currentPixelDepth;
        int i = chooseCascade(linearDepth, shadowMatrix);

        if (i >= numCascades) {
          discard;
        }

        vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);

        // vertex completely outside? -> no shadow
        if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
          discard;
        }

        vec2 uvShadow = cascadeCoordinates(i, lvpos);

        float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
        bool shadow = depthShadow < lvpos.z;

        if (!shadow) {
          discard;
        }

        gl_FragColor = ${z===a.ShadowCastPass.Accumulate?n.glsl`vec4(sampleValue)`:n.glsl`shadowColor`};
      }
    `);return m}a.ShadowCastPass=void 0;(function(d){d[d.Accumulate=0]="Accumulate";d[d.Visualize=1]="Visualize";d[d.VisualizeCurrent=2]="VisualizeCurrent";d[d.COUNT=3]="COUNT"})(a.ShadowCastPass||(a.ShadowCastPass={}));a.ShadowCastVisualization=void 0;(function(d){d[d.Gradient=0]="Gradient";d[d.Threshold=1]="Threshold"})(a.ShadowCastVisualization||(a.ShadowCastVisualization={}));const k=1/255,e=Object.freeze({__proto__:null,get ShadowCastPass(){return a.ShadowCastPass},get ShadowCastVisualization(){return a.ShadowCastVisualization},
shadowCastMaxSamples:255,build:l});a.ShadowCast=e;a.build=l;a.shadowCastMaxSamples=255})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.CameraSpace=function(c){c.fragment.uniforms.add("projInfo","vec4");c.fragment.uniforms.add("zScale","vec2");c.fragment.code.add(b.glsl`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/ShadowCastTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../../../../chunks/ShadowCast.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m){w=function(z){function v(t,r){var x;return x=z.call(this,t,r,()=>x.destroy())||this}c._inheritsLoose(v,z);var q=v.prototype;q.initializeProgram=function(t){const r=v.shader.get().build(this.configuration);return new k.Program(t.rctx,r,f.Default3D)};q.initializePipeline=function(t){switch(this.configuration.pass){case e.ShadowCastPass.Accumulate:return m.makePipelineState({blending:m.separateBlendingParams(d.BlendFactor.ONE,d.BlendFactor.ONE,d.BlendFactor.ONE,d.BlendFactor.ONE),
colorWrite:m.defaultColorWriteParams,depthTest:null,depthWrite:null});case e.ShadowCastPass.Visualize:case e.ShadowCastPass.VisualizeCurrent:return m.makePipelineState({blending:l.blendingDefault,colorWrite:m.defaultColorWriteParams,depthTest:null,depthWrite:null})}return m.makePipelineState({})};q.bindPass=function(t){this.configuration.pass===e.ShadowCastPass.Accumulate||this.configuration.pass===e.ShadowCastPass.VisualizeCurrent?(this.program.bindTexture(t.linearDepthTexture,"depthMap"),t.shadowMap.bind(this.program),
t.shadowMap.bindView(this.program,t.camera.center),this.program.setUniform2fv("nearFar",t.camera.nearFar),this.program.setUniformMatrix4fv("inverseViewMatrix",t.inverseViewMatrix),this.program.setUniform4fv("projInfo",t.projInfo),this.program.setUniform2fv("zScale",t.zScale)):this.configuration.pass===e.ShadowCastPass.Visualize&&(this.program.bindTexture(t.shadowCastMap,"shadowCastMap"),this.program.setUniform1f("sampleScale",t.sampleScale),this.program.setUniform1f("opacityFromElevation",t.opacityFromElevation),
this.program.setUniform4fv("uColor",t.color),this.configuration.visualization===e.ShadowCastVisualization.Gradient&&this.configuration.bandsEnabled?this.program.setUniform1f("bandSize",t.bandSize):this.configuration.visualization===e.ShadowCastVisualization.Threshold&&this.program.setUniform1f("threshold",t.threshold))};c._createClass(v,[{key:"primitiveType",get:function(){return d.PrimitiveType.TRIANGLE_STRIP}}]);return v}(w.ShaderTechnique);w.shader=new h.ReloadableShaderModule(e.ShadowCast,()=>
new Promise((z,v)=>a(["./ShadowCast.glsl"],z,v)));h=function(z){function v(){var q=z.apply(this,arguments)||this;q.pass=e.ShadowCastPass.Accumulate;q.visualization=e.ShadowCastVisualization.Gradient;q.bandsEnabled=!1;return q}c._inheritsLoose(v,z);return v}(n.ShaderTechniqueConfiguration);g.__decorate([n.parameter({count:e.ShadowCastPass.COUNT})],h.prototype,"pass",void 0);g.__decorate([n.parameter()],h.prototype,"visualization",void 0);g.__decorate([n.parameter()],h.prototype,"bandsEnabled",void 0);
b.ShadowCastTechnique=w;b.ShadowCastTechniqueConfiguration=h;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../ViewingMode ./Camera ./Util ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x){function u(ca,fa){n.set(ja,ca[fa],ca[fa+3]);return ja}let E=function(){this.camera=new z.default;this.lightMat=w.create()},y=function(){function ca(ba,Z,ha=0){this.rctx=ba;this.viewingMode=Z;this._enabled=!1;this._snapshots=[];this.maxTextureSize=this.textureSize=0;this.numCascades=1;this.maxNumCascades=4;this.splitSchemeLambda=0;this.warp=!0;this.cascadeDistances=[0,0,0,0,0];this.cascades=[];this.maxTextureSize=this.rctx.parameters.maxTextureSize;for(ba=
0;4>ba;++ba)this.cascades.push(new E);this.snapshotCount=ha}var fa=ca.prototype;fa.dispose=function(){this._discardDepthTexture();this._discardAllSnapshots()};fa.getSnapshot=function(ba){return this.enabled?this._snapshots[ba]:null};fa.getCascades=function(){for(let ba=0;ba<this.numCascades;++ba)J[ba]=this.cascades[ba];J.length=this.numCascades;return J};fa.start=function(ba,Z,ha){v.assert(this.enabled);this.textureSize=this._computeTextureSize(ba.fullWidth,ba.fullHeight);this._ensureDepthTexture();
const {near:na,far:pa}=this._clampNearFar(ha);this._computeCascadeDistances(pa,na);this._setupMatrices(ba,Z);ha=ba.viewMatrix;ba=ba.projectionMatrix;for(let xa=0;xa<this.numCascades;++xa)this._constructCascade(xa,ba,ha,Z);this.lastOrigin=null;this.clear()};fa.finish=function(ba){v.assert(this.enabled);this.rctx.bindFramebuffer(ba)};fa.bind=function(ba){this.enabled?(this._depthTextureUnit=ba.bindTexture(this._depthTexture,"shadowMapTex"),ba.setUniform1f("depthHalfPixelSz",.5/this.textureSize),ba.setUniform1i("numCascades",
this.numCascades),ba.setUniform4f("cascadeDistances",this.cascadeDistances[0],1<this.numCascades?this.cascadeDistances[1]:Infinity,2<this.numCascades?this.cascadeDistances[2]:Infinity,3<this.numCascades?this.cascadeDistances[3]:Infinity)):ba.setUniform1f("depthHalfPixelSz",-1)};fa.bindView=function(ba,Z){if(this.enabled){var ha=this.lastOrigin;if(!ha||ha[0]!==Z[0]||ha[1]!==Z[1]||ha[2]!==Z[2])for(this.lastOrigin=this.lastOrigin||k.create(),l.copy(this.lastOrigin,Z),ha=0;ha<this.numCascades;++ha){h.translate(P,
this.cascades[ha].lightMat,Z);for(let na=0;16>na;++na)N[16*ha+na]=P[na]}ba.setUniformMatrix4fv("shadowMapMatrix",N)}};fa.takeCascadeSnapshotTo=function(ba,Z){v.assert(this.enabled);this._ensureSnapshot(Z);this._bindFbo();const ha=this.rctx;Z=ha.bindTexture(this._snapshots[Z],r.Texture.TEXTURE_UNIT_FOR_UPDATES);ha.gl.copyTexSubImage2D(q.TextureType.TEXTURE_2D,0,ba.camera.viewport[0],ba.camera.viewport[1],ba.camera.viewport[0],ba.camera.viewport[1],ba.camera.viewport[2],ba.camera.viewport[3]);ha.bindTexture(Z,
r.Texture.TEXTURE_UNIT_FOR_UPDATES)};fa.clear=function(){const ba=this.rctx;this._bindFbo();ba.setClearColor(1,1,1,1);ba.clearSafe(q.ClearBufferBit.COLOR_BUFFER_BIT|q.ClearBufferBit.DEPTH_BUFFER_BIT)};fa._computeTextureSize=function(ba,Z){return Math.min(this.maxTextureSize,2*2**Math.round(.5*Math.log(ba*ba+Z*Z)*Math.LOG2E+.35))};fa._ensureDepthTexture=function(){if(null==this._depthTexture||this._depthTexture.descriptor.width!==this.textureSize)this._discardDepthTexture(),this._depthTexture=new r.Texture(this.rctx,
{target:q.TextureType.TEXTURE_2D,pixelFormat:q.PixelFormat.RGBA,dataType:q.PixelType.UNSIGNED_BYTE,wrapMode:q.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:q.TextureSamplingMode.NEAREST,flipped:!0,width:this.textureSize,height:this.textureSize}),this.fbo=new t.FramebufferObject(this.rctx,{colorTarget:q.TargetType.TEXTURE,depthStencilTarget:q.DepthStencilTargetType.DEPTH_RENDER_BUFFER,width:this.textureSize,height:this.textureSize},this._depthTexture)};fa._ensureSnapshot=function(ba){const Z=this._snapshots[ba];
c.isSome(Z)&&Z.descriptor.width===this.textureSize||(this._discardSnapshot(ba),this._snapshots[ba]=new r.Texture(this.rctx,{target:q.TextureType.TEXTURE_2D,pixelFormat:q.PixelFormat.RGBA,dataType:q.PixelType.UNSIGNED_BYTE,wrapMode:q.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:q.TextureSamplingMode.NEAREST,flipped:!0,width:this.textureSize,height:this.textureSize}))};fa._discardDepthTexture=function(){this.fbo=c.disposeMaybe(this.fbo);this._depthTexture=c.disposeMaybe(this._depthTexture)};fa._discardSnapshot=
function(ba){this._snapshots[ba]=c.disposeMaybe(this._snapshots[ba])};fa._discardAllSnapshots=function(){for(let ba=0;ba<this.snapshotCount;++ba)this._discardSnapshot(ba)};fa._bindFbo=function(){const ba=this.rctx;c.isSome(this._depthTextureUnit)&&(ba.bindTexture(null,this._depthTextureUnit),this._depthTextureUnit=null);ba.bindFramebuffer(this.fbo)};fa._constructCascade=function(ba,Z,ha,na){const pa=this.cascades[ba];var xa=-this.cascadeDistances[ba],Da=-this.cascadeDistances[ba+1];xa=(Z[10]*xa+Z[14])/
Math.abs(Z[11]*xa+Z[15]);Z=(Z[10]*Da+Z[14])/Math.abs(Z[11]*Da+Z[15]);v.assert(xa<Z);for(Da=0;8>Da;++Da){e.set(D,0===Da%4||3===Da%4?-1:1,0===Da%4||1===Da%4?-1:1,4>Da?xa:Z,1);e.transformMat4(C[Da],D,B);for(let ua=0;3>ua;++ua)C[Da][ua]/=C[Da][3]}l.negate(Q,C[0]);h.translate(A,O,Q);pa.camera.viewMatrix=A;for(xa=0;8>xa;++xa)l.transformMat4(C[xa],C[xa],pa.camera.viewMatrix);l.copy(F,C[0]);l.copy(G,C[0]);for(xa=1;8>xa;++xa)for(Z=0;3>Z;++Z)F[Z]=Math.min(F[Z],C[xa][Z]),G[Z]=Math.max(G[Z],C[xa][Z]);F[2]-=200;
G[2]+=200;pa.camera.near=-G[2];pa.camera.far=-F[2];this.warp?this._constructTrapezoidalProjection(ha,na,pa):this._constructOrthogonalProjection(pa);h.multiply(pa.lightMat,pa.camera.projectionMatrix,pa.camera.viewMatrix);ha=this.textureSize/2;pa.camera.viewport[0]=0===ba%2?0:ha;pa.camera.viewport[1]=0===Math.floor(ba/2)?0:ha;pa.camera.viewport[2]=ha;pa.camera.viewport[3]=ha};fa._constructOrthogonalProjection=function(ba){h.ortho(ba.camera.projectionMatrix,F[0],G[0],F[1],G[1],ba.camera.near,ba.camera.far)};
fa._constructTrapezoidalProjection=function(ba,Z,ha){var na=1/C[0][3],pa=1/C[4][3];v.assert(na<pa);na+=Math.sqrt(na*pa);var xa=Math.sin(b.acosClamped(ba[2]*Z[0]+ba[6]*Z[1]+ba[10]*Z[2]));ba=C;var Da=na/xa;Z=L;var ua=H,Fa=M;pa=K;na=I;n.set(R,0,0);for(var qa=0;4>qa;++qa)n.add(R,R,ba[qa]);n.scale(R,R,.25);n.set(S,0,0);for(qa=4;8>qa;++qa)n.add(S,S,ba[qa]);n.scale(S,S,.25);n.lerp(T[0],ba[4],ba[5],.5);n.lerp(T[1],ba[5],ba[6],.5);n.lerp(T[2],ba[6],ba[7],.5);n.lerp(T[3],ba[7],ba[4],.5);qa=0;var sa=n.squaredDistance(T[0],
R);for(var ma=1;4>ma;++ma){var ra=n.squaredDistance(T[ma],R);ra<sa&&(sa=ra,qa=ma)}n.subtract(V,T[qa],ba[qa+4]);qa=V[0];V[0]=-V[1];V[1]=qa;n.subtract(W,S,R);0>n.dot(W,V)&&n.negate(V,V);n.lerp(V,V,W,xa);n.normalize(V,V);xa=qa=n.dot(n.subtract(U,ba[0],R),V);for(sa=1;8>sa;++sa)ma=n.dot(n.subtract(U,ba[sa],R),V),ma<xa?xa=ma:ma>qa&&(qa=ma);n.copy(Z,R);n.scale(U,V,xa-Da);n.add(Z,Z,U);ma=-1;ra=1;Da=sa=0;for(let va=0;8>va;++va){n.subtract(aa,ba[va],Z);n.normalize(aa,aa);const Ia=V[0]*aa[1]-V[1]*aa[0];0<Ia?
Ia>ma&&(ma=Ia,sa=va):Ia<ra&&(ra=Ia,Da=va)}v.verify(0<ma,"leftArea");v.verify(0>ra,"rightArea");n.scale(da,V,xa);n.add(da,da,R);n.scale(Y,V,qa);n.add(Y,Y,R);ea[0]=-V[1];ea[1]=V[0];ua=v.rayRay2D(Z,ba[Da],Y,n.add(U,Y,ea),1,ua);Fa=v.rayRay2D(Z,ba[sa],Y,U,1,Fa);pa=v.rayRay2D(Z,ba[sa],da,n.add(U,da,ea),1,pa);ba=v.rayRay2D(Z,ba[Da],da,U,1,na);v.verify(ua,"rayRay");v.verify(Fa,"rayRay");v.verify(pa,"rayRay");v.verify(ba,"rayRay");Fa=L;ba=H;Z=K;pa=I;na=ha.camera.projectionMatrix;n.subtract(la,Z,pa);n.scale(la,
la,.5);ia[0]=la[0];ia[1]=la[1];ia[2]=0;ia[3]=la[1];ia[4]=-la[0];ia[5]=0;ia[6]=la[0]*la[0]+la[1]*la[1];ia[7]=la[0]*la[1]-la[1]*la[0];ia[8]=1;ia[6]=-n.dot(u(ia,0),Fa);ia[7]=-n.dot(u(ia,1),Fa);Fa=n.dot(u(ia,0),Z)+ia[6];ua=n.dot(u(ia,1),Z)+ia[7];Da=n.dot(u(ia,0),pa)+ia[6];pa=n.dot(u(ia,1),pa)+ia[7];Fa=-(Fa+Da)/(ua+pa);ia[0]+=ia[1]*Fa;ia[3]+=ia[4]*Fa;ia[6]+=ia[7]*Fa;Fa=1/(n.dot(u(ia,0),Z)+ia[6]);ua=1/(n.dot(u(ia,1),Z)+ia[7]);ia[0]*=Fa;ia[3]*=Fa;ia[6]*=Fa;ia[1]*=ua;ia[4]*=ua;ia[7]*=ua;ia[2]=ia[1];ia[5]=
ia[4];ia[8]=ia[7];ia[7]+=1;Fa=n.dot(u(ia,1),ba)+ia[7];ua=n.dot(u(ia,2),ba)+ia[8];Da=n.dot(u(ia,1),Z)+ia[7];pa=n.dot(u(ia,2),Z)+ia[8];Fa=-.5*(Fa/ua+Da/pa);ia[1]+=ia[2]*Fa;ia[4]+=ia[5]*Fa;ia[7]+=ia[8]*Fa;Fa=n.dot(u(ia,1),ba)+ia[7];ua=n.dot(u(ia,2),ba)+ia[8];Da=-ua/Fa;ia[1]*=Da;ia[4]*=Da;ia[7]*=Da;na[0]=ia[0];na[1]=ia[1];na[2]=0;na[3]=ia[2];na[4]=ia[3];na[5]=ia[4];na[6]=0;na[7]=ia[5];na[8]=0;na[9]=0;na[10]=1;na[11]=0;na[12]=ia[6];na[13]=ia[7];na[14]=0;na[15]=ia[8];ha.camera.projectionMatrix[10]=2/(F[2]-
G[2]);ha.camera.projectionMatrix[14]=-(F[2]+G[2])/(F[2]-G[2])};fa._setupMatrices=function(ba,Z){h.multiply(p,ba.projectionMatrix,ba.viewMatrix);h.invert(B,p);ba=this.viewingMode===m.ViewingMode.Global?ba.eye:l.set(Q,0,0,1);h.lookAt(O,[0,0,0],[-Z[0],-Z[1],-Z[2]],ba)};fa._clampNearFar=function(ba){let {near:Z,far:ha}=ba;2>Z&&(Z=2);2>ha&&(ha=2);Z>=ha&&(Z=2,ha=4);return{near:Z,far:ha}};fa._computeCascadeDistances=function(ba,Z){this.numCascades=Math.min(1+Math.floor(v.logWithBase(ba/Z,4)),this.maxNumCascades);
const ha=(ba-Z)/this.numCascades;ba=(ba/Z)**(1/this.numCascades);let na=Z;for(let pa=0;pa<this.numCascades+1;++pa)this.cascadeDistances[pa]=b.lerp(na,Z,this.splitSchemeLambda),na*=ba,Z+=ha};a._createClass(ca,[{key:"maxCascades",get:function(){return this.maxNumCascades},set:function(ba){this.maxNumCascades=b.clamp(Math.floor(ba),1,4)}},{key:"enabled",get:function(){return this._enabled},set:function(ba){this._enabled=ba;ba||(this._discardDepthTexture(),this._discardAllSnapshots())}},{key:"snapshotCount",
get:function(){return this._snapshots.length},set:function(ba){var Z=this._snapshots.length;if(ba>Z){var ha=ba-Z;this._snapshots.length=ba;for(ba=0;ba<ha;++ba)this._snapshots[Z+ba]=null}else if(ba<this.snapshotCount){Z-=ba;for(ha=0;ha<Z;++ha)this._discardSnapshot(ba+ha);this._snapshots.length=ba}}},{key:"gpuMemoryUsage",get:function(){var ba,Z;return this._snapshots.reduce((ha,na)=>ha+x.getGpuMemoryUsage(na),null!=(ba=null==(Z=this.fbo)?void 0:Z.gpuMemoryUsage)?ba:0)}},{key:"test",get:function(){const ba=
this;return{maxNumCascades:this.maxNumCascades,cascades:this.cascades,textureSize:this.textureSize,depthTexture:this._depthTexture,set splitSchemeLambda(Z){ba.splitSchemeLambda=Z},get splitSchemeLambda(){return ba.splitSchemeLambda},set warp(Z){ba.warp=Z},get warp(){return ba.warp}}}}]);return ca}();const A=w.create(),p=w.create(),B=w.create(),D=d.create(),C=[];for(let ca=0;8>ca;++ca)C.push(d.create());const F=k.create(),G=k.create(),L=f.create(),H=f.create(),M=f.create(),K=f.create(),I=f.create(),
O=w.create(),Q=k.create(),J=[],P=w.create(),N=new Float32Array(64),R=f.create(),S=f.create(),T=[f.create(),f.create(),f.create(),f.create()],V=f.create(),W=f.create(),U=f.create(),aa=f.create(),da=f.create(),Y=f.create(),ea=f.create(),ja=f.create(),la=f.create(),ia=g.create();return y})},"esri/views/3d/webgl-engine/lib/ShadowHighlightHelper":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f32 ../../../ViewingMode ./glUtil3D ../shaders/ShadowHighlightTechnique ../../../webgl/Util".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){let d=function(){function z(q,t){this._rctx=q;this._viewingMode=t;this._maxOpacity=1;this._parameters={shadowColor:n.fromValues(1,0,1,1),shadowOpacity:.2,occludedShadowOpacity:.1,opacityElevation:1,dayNightTerminator:1};this._vao=l.createQuadVAO(this._rctx)}var v=z.prototype;v.render=function(q,t){if(q.shadowMap.enabled&&q.linearDepthTexture&&this.isVisible){var r=this.technique;this._rctx.bindFramebuffer(t);this._rctx.useTechnique(r);r.bindPass(this._parameters,q);
this._rctx.bindVAO(this._vao);this._rctx.drawArrays(r.primitiveType,0,e.vertexCount(this._vao,"geometry"))}};v.setDefaultOptions=function(q){this._parameters={...this._parameters,...q};this._updateMaxOpacity()};v.updateParameters=function(q,t){this._parameters.opacityElevation=1-c.smoothstep(4E4,5E4,q.relativeElevation);q=this._viewingMode===f.ViewingMode.Global?h.normalize(m,q.center):h.set(m,0,0,1);t=h.dot(q,t);this._parameters.dayNightTerminator=c.smoothstep(0,1,c.clamp(30*t,0,1))};v.dispose=function(){this._vao=
g.disposeMaybe(this._vao);this._technique=g.releaseMaybe(this._technique)};v._updateMaxOpacity=function(){const q=this._parameters;this._maxOpacity=Math.max(q.shadowOpacity,q.occludedShadowOpacity)*q.shadowColor[3]};b._createClass(z,[{key:"technique",get:function(){g.isNone(this._technique)&&(this._technique=new k.ShadowHighlightTechnique({rctx:this._rctx,viewingMode:this._viewingMode}));return this._technique}},{key:"gpuMemoryUsage",get:function(){var q,t;return null!=(q=null==(t=this._vao)?void 0:
t.size)?q:0}},{key:"isVisible",get:function(){const {opacityElevation:q,dayNightTerminator:t}=this._parameters;return.001953125<=this._maxOpacity*q*t}}]);return z}();const m=w.create();a.ShadowHighlightHelper=d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/ShadowHighlightTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/Util ../../../../chunks/ShadowHighlight.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r){d=function(A){function p(D){var C;return C=A.call(this,D,null,()=>C.destroy())||this}c._inheritsLoose(p,A);var B=p.prototype;B.initializeProgram=function(D){const C=p.shader.get().build({highlightedThreshold:.99999,selfShadowThreshold:.025});return new z.Program(D.rctx,C,m.Default3D)};B.initializePipeline=function(D){return r.makePipelineState({blending:r.separateBlendingParams(t.BlendFactor.SRC_ALPHA,t.BlendFactor.ONE,t.BlendFactor.ONE_MINUS_SRC_ALPHA,
t.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:r.defaultColorWriteParams,depthTest:null,depthWrite:null})};B.bindPass=function(D,C){g.isNone(C.linearDepthTexture)||(this.program.bindTexture(C.linearDepthTexture,"depthMap"),this.program.bindTexture(C.highlightColorTexture,"highlightMap"),f.transformMat4(x,C.lighting.lightingMainDirection,C.camera.viewInverseTransposeMatrix),f.normalize(x,x),v.inverseProjectionInfo(C.camera.projectionMatrix,C.camera.fullWidth,C.camera.fullHeight,E,u),h.translate(y,C.camera.viewMatrix,
C.camera.center),h.invert(y,y),this.program.setUniform4fv("uColor",D.shadowColor),this.program.setUniform1f("opacity",D.shadowOpacity),this.program.setUniform1f("occludedOpacity",D.occludedShadowOpacity),this.program.setUniform1f("terminationFactor",D.opacityElevation*D.dayNightTerminator),this.program.setUniform2fv("nearFar",C.camera.nearFar),this.program.setUniformMatrix4fv("inverseViewMatrix",y),this.program.setUniform4fv("projInfo",E),this.program.setUniform2fv("zScale",u),this.program.setUniform3fv("lightingMainDirectionView",
x),this.program.setUniform2f("texelSize",1/C.linearDepthTexture.descriptor.width,1/C.linearDepthTexture.descriptor.height),C.shadowMap.bind(this.program),C.shadowMap.bindView(this.program,C.camera.center),D=C.shadowMap.getSnapshot(0),g.isSome(D)&&this.program.bindTexture(D,"highlightDepthTex"),D=C.shadowMap.getSnapshot(1),g.isSome(D)&&this.program.bindTexture(D,"defaultDepthTex"))};c._createClass(p,[{key:"primitiveType",get:function(){return t.PrimitiveType.TRIANGLE_STRIP}}]);return p}(d.ShaderTechnique);
d.shader=new e.ReloadableShaderModule(q.ShadowHighlightShader,()=>new Promise((A,p)=>a(["./ShadowHighlight.glsl"],A,p)));const x=l.create(),u=n.create(),E=k.create(),y=w.create();b.DefaultSnapshotSlot=1;b.HighlightShadowMapSlot=0;b.ShadowHighlightTechnique=d;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/ShadowHighlight.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,b,c,g,h,w,n,f,l){function k(d){const m=new l.ShaderBuilder;m.include(h.ReadShadowMap);m.fragment.include(n.RgbaFloatEncoding);m.fragment.include(g.ReadLinearDepth);m.include(w.CameraSpace);m.include(b.ScreenSpacePass);m.fragment.uniforms.add("defaultDepthTex","sampler2D").add("highlightDepthTex","sampler2D").add("depthMap","sampler2D").add("highlightMap","sampler2D").add("uColor","vec4").add("nearFar","vec2").add("opacity","float").add("occludedOpacity","float").add("terminationFactor",
"float").add("inverseViewMatrix","mat4").add("lightingMainDirectionView","vec3").add("texelSize","vec2");m.fragment.constants.add("unoccludedHighlightFlag","vec4",c.unoccludedHighlightFlag).add("highlightedThreshold","float",d.highlightedThreshold).add("selfShadowThreshold","float",d.selfShadowThreshold);m.fragment.code.add(f.glsl`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`);m.fragment.code.add(f.glsl`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float differenceOpacity = opacity;
float bothOpacity = occludedOpacity;
float fragOpacity = (shadowDefault || shaded) ? bothOpacity : differenceOpacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`);return m}const e=Object.freeze({__proto__:null,build:k});a.ShadowHighlightShader=e;a.build=k})},"esri/views/3d/webgl-engine/lib/SliceHelper":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/boundedPlane"],function(a,b){const c=b.create();return function(){function g(){this._worldPlane=c}a._createClass(g,[{key:"isEnabled",get:function(){return this.plane!==c}},{key:"plane",get:function(){return this._worldPlane},set:function(h){this._worldPlane=h?h:c}}]);return g}()})},
"esri/views/3d/webgl-engine/lib/SmaaRenderPass":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../support/requestImageUtils ./glUtil3D ./SMAATechnique ../../../../chunks/SMAA.glsl ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x){b.SmaaRenderPass=function(u){function E(A,p){var B=u.call(this,{})||this;B.rctx=A;B._techniqueRep=p;B._isEnabled=!1;return B}c._inheritsLoose(E,u);var y=E.prototype;y.normalizeCtorArgs=function(){return{}};y.dispose=function(){this._abortController=w.abortMaybe(this._abortController);this.disable()};y._loadResources=function(A){if(w.isSome(this._abortController))return!1;if(w.isSome(this._searchTexture))return!0;this._abortController=new AbortController;
const p=this._abortController.signal;(new Promise((B,D)=>a(["./SmaaRenderPassData"],B,D))).then(B=>this._loadTextures(B,p)).then(()=>A()).finally(()=>this._abortController=null);return!1};y._loadTextures=function(A,p){n.throwIfAborted(p);return Promise.all([this._loadTextureFromBase64(A.areaTexture,t.TextureSamplingMode.LINEAR,t.PixelFormat.RGB),this._loadTextureFromBase64(A.searchTexure,t.TextureSamplingMode.NEAREST,t.PixelFormat.LUMINANCE)]).then(([B,D])=>{n.isAborted(p)?(B.dispose(),D.dispose(),
n.throwIfAborted(p)):(this._areaTexture=B,this._searchTexture=D)})};y.enable=function(A){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const p=new v.SMAATechniqueConfiguration,B=(D,C)=>this._techniqueRep.releaseAndAcquire(v.SMAATechnique,D,C);p.output=q.SMAAOutput.EdgeDetector;this._edgeDetectTechnique=B(p,this._edgeDetectTechnique);p.output=q.SMAAOutput.BlendWeight;this._blendWeightsTechnique=B(p,this._blendWeightsTechnique);p.output=
q.SMAAOutput.Blur;this._blurTechnique=B(p,this._blurTechnique)}if(!this._loadResources(A))return!1;this._vao=z.createScreenSizeTriangleVAO(this.rctx);this._edges=new r.FramebufferObject(this.rctx,{colorTarget:t.TargetType.TEXTURE,depthStencilTarget:t.DepthStencilTargetType.NONE},{target:t.TextureType.TEXTURE_2D,pixelFormat:t.PixelFormat.RGB,dataType:t.PixelType.UNSIGNED_BYTE,samplingMode:t.TextureSamplingMode.LINEAR,wrapMode:t.TextureWrapMode.CLAMP_TO_EDGE,width:4,height:4});this._blend=new r.FramebufferObject(this.rctx,
{colorTarget:t.TargetType.TEXTURE,depthStencilTarget:t.DepthStencilTargetType.NONE},{target:t.TextureType.TEXTURE_2D,pixelFormat:t.PixelFormat.RGBA,dataType:t.PixelType.UNSIGNED_BYTE,samplingMode:t.TextureSamplingMode.LINEAR,wrapMode:t.TextureWrapMode.CLAMP_TO_EDGE,width:4,height:4});return this._isEnabled=!0};y.disable=function(){this._isEnabled&&(this._vao=w.disposeMaybe(this._vao),this._areaTexture=w.disposeMaybe(this._areaTexture),this._searchTexture=w.disposeMaybe(this._searchTexture),this._blend=
w.disposeMaybe(this._blend),this._edges=w.disposeMaybe(this._edges),this._isEnabled=!1)};y.render=function(A){if(this._isEnabled){var p=this.rctx,B=p.getBoundFramebufferObject(),D=A.descriptor.width,C=A.descriptor.height;p.bindVAO(this._vao);p.setViewport(0,0,D,C);this._edges.resize(D,C);p.bindFramebuffer(this._edges);p.setClearColor(0,0,0,1);p.clear(t.ClearBufferBit.COLOR_BUFFER_BIT);var F=p.useTechnique(this._edgeDetectTechnique);F.bindTexture(A,"tColor");F.setUniform4f("resolution",1/D,1/C,D,C);
p.drawArrays(t.PrimitiveType.TRIANGLES,0,3);this._blend.resize(D,C);p.bindFramebuffer(this._blend);p.setClearColor(0,0,1,1);p.clear(t.ClearBufferBit.COLOR_BUFFER_BIT);F=p.useTechnique(this._blendWeightsTechnique);F.setUniform4f("resolution",1/D,1/C,D,C);F.bindTexture(this._searchTexture,"tSearch");F.bindTexture(this._areaTexture,"tArea");F.bindTexture(this._edges.colorTexture,"tEdges");p.drawArrays(t.PrimitiveType.TRIANGLES,0,3);p.bindFramebuffer(B);p.setClearColor(0,1,0,1);p.clear(t.ClearBufferBit.COLOR_BUFFER_BIT);
B=p.useTechnique(this._blurTechnique);B.setUniform4f("resolution",1/D,1/C,D,C);B.bindTexture(A,"tColor");B.bindTexture(this._blend.colorTexture,"tBlendWeights");p.drawArrays(t.PrimitiveType.TRIANGLES,0,3)}};y._loadTextureFromBase64=function(A,p,B){const D=new x.Texture(this.rctx,{pixelFormat:B,dataType:t.PixelType.UNSIGNED_BYTE,wrapMode:t.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:p},null);return m.requestImage(A).then(C=>{D.resize(C.width,C.height);D.setData(C);return D})};c._createClass(E,[{key:"updating",
get:function(){return w.isSome(this._abortController)}}]);return E}(h);g.__decorate([f.property()],b.SmaaRenderPass.prototype,"_abortController",void 0);g.__decorate([f.property({readOnly:!0})],b.SmaaRenderPass.prototype,"updating",null);b.SmaaRenderPass=g.__decorate([d.subclass("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],b.SmaaRenderPass);Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/SMAATechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ./DefaultVertexAttributeLocations ./Program ../../../../chunks/SMAA.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){w=function(d){function m(){return d.apply(this,arguments)||this}c._inheritsLoose(m,d);var z=m.prototype;z.initializeProgram=function(v){const q=m.shader.get().build({output:this.configuration.output,threshold:.05,localConstrastAdaption:2,maxSearchSteps:8,maxDistanceAreaTex:16});return new l.Program(v.rctx,q,f.Default3D)};z.initializePipeline=function(){return e.makePipelineState({colorWrite:e.defaultColorWriteParams})};return m}(w.ShaderTechnique);w.shader=new h.ReloadableShaderModule(k.SMAAShader,
()=>new Promise((d,m)=>a(["../shaders/SMAA.glsl"],d,m)));h=function(d){function m(){var z=d.apply(this,arguments)||this;z.output=k.SMAAOutput.EdgeDetector;return z}c._inheritsLoose(m,d);return m}(n.ShaderTechniqueConfiguration);g.__decorate([n.parameter({count:k.SMAAOutput.COUNT})],h.prototype,"output",void 0);b.SMAATechnique=w;b.SMAATechniqueConfiguration=h;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/SMAA.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderModules/interfaces",
"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/lib/VertexAttribute"],function(a,b,c,g){function h(n){const f=new c.ShaderBuilder;n.output===a.SMAAOutput.EdgeDetector&&(f.attributes.add(g.VertexAttribute.POSITION,"vec2"),f.vertex.uniforms.add("resolution","vec4"),f.varyings.add("fTexCoord","vec2"),f.varyings.add("fOffset[3]","vec4"),f.vertex.code.add(b.glsl`void SMAAEdgeDetectionVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
fOffset[2] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAAEdgeDetectionVS( fTexCoord );
}`),f.fragment.uniforms.add("tColor","sampler2D"),f.fragment.code.add(b.glsl`
      vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {
        vec2 threshold = vec2( ${b.glsl.float(n.threshold)} );

        // Calculate color deltas:
        vec4 delta;
        vec3 C = texture2D( colorTex, texcoord ).rgb;

        vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;
        vec3 t = abs( C - Cleft );
        delta.x = max( max( t.r, t.g ), t.b );

        vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;
        t = abs( C - Ctop );
        delta.y = max( max( t.r, t.g ), t.b );

        // We do the usual threshold:
        vec2 edges = step( threshold, delta.xy );

        // Then discard if there is no edge:
        if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )
            discard;

        // Calculate right and bottom deltas:
        vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;
        t = abs( C - Cright );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;
        t = abs( C - Cbottom );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the maximum delta in the direct neighborhood:
        float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );

        // Calculate left-left and top-top deltas:
        vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;
        t = abs( C - Cleftleft );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;
        t = abs( C - Ctoptop );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the final maximum delta:
        maxDelta = max( max( maxDelta, delta.z ), delta.w );

        // Local contrast adaptation in action:
        edges.xy *= step( maxDelta, float(${b.glsl.float(n.localConstrastAdaption)}) * delta.xy );

        return vec4( edges, 0.0, 0.0 );
      }

      void main() {
        gl_FragColor = SMAAColorEdgeDetectionPS( fTexCoord, fOffset, tColor );
      }
    `));n.output===a.SMAAOutput.BlendWeight&&(f.attributes.add(g.VertexAttribute.POSITION,"vec2"),f.vertex.uniforms.add("resolution","vec4"),f.varyings.add("fTexCoord","vec2"),f.varyings.add("fOffset[3]","vec4"),f.varyings.add("fPixCoord","vec2"),f.vertex.code.add(b.glsl`
      void SMAABlendingWeightCalculationVS( vec2 texcoord ) {
        fPixCoord = texcoord * resolution.zw;
        fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        fOffset[2] = vec4( fOffset[0].xz, fOffset[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${b.glsl.int(n.maxSearchSteps)} );
      }

      void main() {
        fTexCoord = (position + 1.0 ) * 0.5;
        gl_Position = vec4(position, 0, 1);
        SMAABlendingWeightCalculationVS( fTexCoord );
      }
    `),f.fragment.uniforms.add("tEdges","sampler2D").add("tArea","sampler2D").add("tSearch","sampler2D").add("tColor","sampler2D").add("resolution","vec4"),f.fragment.code.add(b.glsl`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 SMAASampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset) {
        return texture2D( tex, coord + offset.x * resolution.xy, 0.0 );
      }

      vec2 round( vec2 x ) {
        return sign( x ) * floor( abs( x ) + 0.5 );
      }

      float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${b.glsl.int(n.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${b.glsl.int(n.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${b.glsl.int(n.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${b.glsl.int(n.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${b.glsl.int(n.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {
        vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );
        vec2 e = texture2D( edgesTex, texcoord ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );
          coords.y = offset[ 1 ].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTex, coords, 0.0 ).r;
          coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );
          d.y = coords.x;
          d = d * resolution.z - pixcoord.x;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );
          coords.x = offset[ 0 ].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTex, coords, 0.0 ).g;
          coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );
          d.y = coords.y;
          d = d * resolution.w - pixcoord.y;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 0.0, 1.0 ) ).g;
          weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offset[ 0 ]+offset[ 1 ]+offset[ 2 ] + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0,1,0,1),dbg);
        }
        return weights;
      }

      void main() {
        gl_FragColor = SMAABlendingWeightCalculationPS( fTexCoord, fPixCoord, fOffset, tEdges, tArea, tSearch, ivec4( 0.0 ) );
      }
    `));n.output===a.SMAAOutput.Blur&&(f.attributes.add(g.VertexAttribute.POSITION,"vec2"),f.vertex.uniforms.add("resolution","vec4"),f.varyings.add("fTexCoord","vec2"),f.varyings.add("fOffset[2]","vec4"),f.vertex.code.add(b.glsl`void SMAANeighborhoodBlendingVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAANeighborhoodBlendingVS(fTexCoord);
}`),f.fragment.uniforms.add("tBlendWeights","sampler2D"),f.fragment.uniforms.add("tColor","sampler2D"),f.fragment.uniforms.add("resolution","vec4"),f.fragment.code.add(b.glsl`vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {
vec4 a;
a.xz = texture2D( blendTex, texcoord ).xz;
a.y = texture2D( blendTex, offset[ 1 ].zw ).g;
a.w = texture2D( blendTex, offset[ 1 ].xy ).a;
if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {
return texture2D( colorTex, texcoord, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTex, texcoord, 0.0 );
texcoord += sign( offset ) * resolution.xy;
vec4 Cop = texture2D( colorTex, texcoord, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
vec4 mixed = mix(C, Cop, s);
return mixed;
}
}
void main() {
gl_FragColor = SMAANeighborhoodBlendingPS( fTexCoord, fOffset, tColor, tBlendWeights );
}`));return f}a.SMAAOutput=void 0;(function(n){n[n.EdgeDetector=0]="EdgeDetector";n[n.BlendWeight=1]="BlendWeight";n[n.Blur=2]="Blur";n[n.COUNT=3]="COUNT"})(a.SMAAOutput||(a.SMAAOutput={}));const w=Object.freeze({__proto__:null,get SMAAOutput(){return a.SMAAOutput},build:h});a.SMAAShader=w;a.build=h})},"esri/views/3d/webgl-engine/lib/SSAOHelper":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec4f64 ../../../../support/requestImageUtils ./glUtil3D ./SSAOTechnique ./Util ../../../../chunks/SSAO.glsl ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q){let t=function(){function u(y,A,p){this._techniqueRep=y;this._rctx=A;this._requestRender=p;this._enabled=!1;this._ssaoTechniqueConfig=new k.SSAOTechniqueConfiguration;this.quadVAO=null;this._blurSizePx=2;this._attenuation=.5}var E=u.prototype;E.dispose=function(){this.quadVAO=g.disposeMaybe(this.quadVAO)};E.disposeOffscreenBuffers=function(){g.applySome(this._ssaoFBO,y=>y.resize(0,0));g.applySome(this._blur0FBO,y=>y.resize(0,0));g.applySome(this._blur1FBO,
y=>y.resize(0,0))};E.computeSSAO=function(y,A,p){if(!(!this.enabled||g.isNone(A)||g.isNone(p)||g.isNone(this._noiseTexture)||g.isNone(this._ssaoFBO)||g.isNone(this._blur0FBO)||g.isNone(this._blur1FBO))){var B=this._rctx,D=y.fullViewport,C=D[2],F=D[3],G=C/this._blurSizePx,L=F/this._blurSizePx;this._ssaoFBO.resize(C,F);this._blur0FBO.resize(G,L);this._blur1FBO.resize(G,L);G=1*C;L=1*F;B.bindFramebuffer(this._ssaoFBO);B.setViewport(0,0,C,F);var H=B.useTechnique(this._ssaoTechnique);H.setUniform2f("rnmScale",
C/this._noiseTexture.descriptor.width,F/this._noiseTexture.descriptor.height);e.inverseProjectionInfo(y.projectionMatrix,y.fullWidth,y.fullHeight,x,r);H.setUniform4fv("projInfo",x);H.setUniform2fv("zScale",r);H.setUniform2fv("nearFar",y.nearFar);C=1/y.computeRenderPixelSizeAtDist(1);H.setUniform1f("projScale",1*C);H.setUniform2f("screenDimensions",G,L);F=w.distance(y.eye,y.center);var M=20*y.computeRenderPixelSizeAtDist(F);M=Math.max(.1,M);H.setUniform1f("radius",M);H.setUniform1f("intensity",4*this._attenuation/
M**6);H.bindTexture(this._noiseTexture,"rnm");H.bindTexture(p,"normalMap");H.bindTexture(A,"depthMap");g.isNone(this.quadVAO)&&(this.quadVAO=l.createQuadVAO(this._rctx));B.bindVAO(this.quadVAO);B.drawArrays(m.PrimitiveType.TRIANGLE_STRIP,0,q.vertexCount(this.quadVAO,"geometry"));H=B.useTechnique(this._blurTechnique);H.bindTexture(this._ssaoFBO.colorTexture,"tex");H.bindTexture(p,"normalMap");H.bindTexture(A,"depthMap");B.setViewport(0,0,G/this._blurSizePx,L/this._blurSizePx);B.bindFramebuffer(this._blur0FBO);
H.setUniform2f("screenDimensions",G,L);H.setUniform2f("blurSize",0,1*this._blurSizePx/L);H.setUniform2fv("nearFar",y.nearFar);5E4<F&&(C=Math.max(0,C-(F-5E4)));H.setUniform1f("projScale",C);B.drawArrays(m.PrimitiveType.TRIANGLE_STRIP,0,q.vertexCount(this.quadVAO,"geometry"));H.setUniform2f("blurSize",1*this._blurSizePx/G,0);B.bindFramebuffer(this._blur1FBO);H.bindTexture(this._blur0FBO.colorTexture,"tex");B.drawArrays(m.PrimitiveType.TRIANGLE_STRIP,0,q.vertexCount(this.quadVAO,"geometry"));B.setViewport(D[0],
D[1],D[2],D[3])}};E.bind=function(y,A){this.enabled&&g.isSome(this._blur1FBO)&&g.isSome(this._ssaoFBO)?(y.bindTexture(this._blur1FBO.colorTexture,"ssaoTex"),y.setUniform4f("viewportPixelSz",A.fullViewport[0],A.fullViewport[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height)):y.setUniform4f("viewportPixelSz",-1,-1,-1,-1)};E._selectPrograms=function(){this._ssaoTechniqueConfig.output=d.SSAOOutput.SSAO;this._ssaoTechnique=this._techniqueRep.releaseAndAcquire(k.SSAOTechnique,this._ssaoTechniqueConfig,this._ssaoTechnique);
this._ssaoTechniqueConfig.output=d.SSAOOutput.Blur;this._blurTechnique=this._techniqueRep.releaseAndAcquire(k.SSAOTechnique,this._ssaoTechniqueConfig,this._blurTechnique)};E._enable=function(){this.enabled||(this._enabled=!0,this._loadResources(()=>{this._enabled&&this._initialize()}))};E._loadResources=function(y){this._data?y():(new Promise((A,p)=>a(["./SSAOHelperData"],A,p))).then(A=>{this._data=A;y()})};E._initialize=function(){const y={target:m.TextureType.TEXTURE_2D,pixelFormat:m.PixelFormat.RGBA,
dataType:m.PixelType.UNSIGNED_BYTE,samplingMode:m.TextureSamplingMode.LINEAR,wrapMode:m.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0},A={colorTarget:m.TargetType.TEXTURE,depthStencilTarget:m.DepthStencilTargetType.NONE};f.requestImage(this._data.noiseTexture).then(p=>{this._enabled&&(this._ssaoFBO=new z.FramebufferObject(this._rctx,A,y),this._blur0FBO=new z.FramebufferObject(this._rctx,A,y),this._blur1FBO=new z.FramebufferObject(this._rctx,A,y),this._noiseTexture=new v.Texture(this._rctx,{target:m.TextureType.TEXTURE_2D,
pixelFormat:m.PixelFormat.RGBA,dataType:m.PixelType.UNSIGNED_BYTE,hasMipmap:!0,width:p.width,height:p.height},p),this._requestRender())});this._selectPrograms()};E._disable=function(){this._enabled=!1;this._noiseTexture=g.disposeMaybe(this._noiseTexture);this._blur1FBO=g.disposeMaybe(this._blur1FBO);this._blur0FBO=g.disposeMaybe(this._blur0FBO);this._ssaoFBO=g.disposeMaybe(this._ssaoFBO)};c._createClass(u,[{key:"enabled",get:function(){return this._enabled},set:function(y){y?this._enable():this._disable()}},
{key:"ready",get:function(){return this.enabled&&g.isSome(this._noiseTexture)&&g.isSome(this._ssaoFBO)&&g.isSome(this._blur0FBO)&&g.isSome(this._blur1FBO)}},{key:"gpuMemoryUsage",get:function(){return(g.isSome(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(g.isSome(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(g.isSome(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}},{key:"test",get:function(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}}]);return u}();const r=h.create(),x=n.create();b.SSAOHelper=
t;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/SSAOTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ./DefaultVertexAttributeLocations ./Program ../../../../chunks/SSAO.glsl ../../../webgl/renderState".split(" "),function(a,b,c,g,h,w,n,f,l,k,e){w=function(d){function m(){return d.apply(this,
arguments)||this}c._inheritsLoose(m,d);var z=m.prototype;z.initializeProgram=function(v){var q=m.shader.get();const t=(m.filterRadius+1)/2;q=q.build({output:this.configuration.output,samples:m.samples,filterRadius:m.filterRadius,blurFalloff:1/(2*t*t)});return new l.Program(v.rctx,q,f.Default3D)};z.initializePipeline=function(){return e.makePipelineState({colorWrite:e.defaultColorWriteParams})};return m}(w.ShaderTechnique);w.shader=new h.ReloadableShaderModule(k.SSAOShader,()=>new Promise((d,m)=>a(["../shaders/SSAO.glsl"],
d,m)));w.samples=16;w.filterRadius=4;h=function(d){function m(){var z=d.apply(this,arguments)||this;z.output=k.SSAOOutput.SSAO;return z}c._inheritsLoose(m,d);return m}(n.ShaderTechniqueConfiguration);g.__decorate([n.parameter({count:k.SSAOOutput.COUNT})],h.prototype,"output",void 0);b.SSAOTechnique=w;b.SSAOTechniqueConfiguration=h;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/SSAO.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,b,c,g,h,w){function n(l){const k=new w.ShaderBuilder;k.include(b.ScreenSpacePass);l.output===a.SSAOOutput.Blur&&(k.fragment.include(c.ReadLinearDepth),k.fragment.uniforms.add("normalMap","sampler2D").add("depthMap","sampler2D").add("tex","sampler2D").add("blurSize","vec2").add("projScale","float").add("nearFar","vec2"),k.fragment.code.add(h.glsl`
      void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
        float c = texture2D(tex, uv).r;
        float d = linearDepthFromTexture(depthMap, uv, nearFar);

        float ddiff = d - center_d;

        float w = exp(-r * r * ${h.glsl.float(l.blurFalloff)} - ddiff * ddiff * sharpness);
        wTotal += w;
        bTotal += w * c;
      }
    `),k.fragment.code.add(h.glsl`
      void main(void) {
        float b = 0.0;
        float w_total = 0.0;

        float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

        float sharpness = -0.05 * projScale/center_d;
        for (int r = -${h.glsl.int(l.filterRadius)}; r <= ${h.glsl.int(l.filterRadius)}; ++r) {
          float rf = float(r);
          vec2 uvOffset = uv + rf * blurSize;
          blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
        }

        gl_FragColor = vec4(b / w_total);
      }
    `));l.output===a.SSAOOutput.SSAO&&(k.fragment.include(c.ReadLinearDepth),k.include(g.CameraSpace),k.fragment.uniforms.add("normalMap","sampler2D").add("depthMap","sampler2D").add("intensity","float").add("projScale","float").add("radius","float").add("nearFar","vec2").add("screenDimensions","vec2").add("rnmScale","vec2").add("rnm","sampler2D"),k.fragment.code.add(h.glsl`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),k.fragment.code.add(h.glsl`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),k.fragment.code.add(h.glsl`
      void main(void) {
        fillSphere();
        vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
        float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

        if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
          gl_FragColor = vec4(0.0);
          return;
        }

        vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

        // get the normal of current fragment
        vec4 norm4 = texture2D(normalMap, uv);
        vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
        bool isTerrain = norm4.w<0.5;

        float sum = .0;
        vec3 tapPixelPos;

        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
        // bug or deviation from CE somewhere else?
        float ps = projScale/(2.0 * currentPixelPos.z * zScale.x + zScale.y);

        for(int i = 0; i < ${h.glsl.int(l.samples)}; ++i) {
          vec2 unitOffset = reflect(sphere[i], fres).xy;
          vec2 offset = vec2(-unitOffset * radius * ps);

          //don't use current or very nearby samples
          if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

          vec2 tc = vec2(gl_FragCoord.xy + offset);
          if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenDimensions.x || tc.y > screenDimensions.y) continue;
          vec2 tcTap = tc/screenDimensions;
          float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

          if (isTerrain) {
            bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
            if (isTerrainTap) {
              continue;
            }
          }

          tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

          sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
        }

        // output the result
        float A = max(1.0-sum*intensity/float(${h.glsl.int(l.samples)}),0.0);

        // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
        gl_FragColor = vec4(A);
      }
    `));return k}a.SSAOOutput=void 0;(function(l){l[l.SSAO=0]="SSAO";l[l.Blur=1]="Blur";l[l.COUNT=2]="COUNT"})(a.SSAOOutput||(a.SSAOOutput={}));const f=Object.freeze({__proto__:null,get SSAOOutput(){return a.SSAOOutput},build:n});a.SSAOShader=f;a.build=n})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/arrayUtils ../../../../../core/Logger ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/sphere ../../../../../chunks/vec33 ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../core/util/TwoVectorPosition ../GridLocalOriginFactory ../localOriginHelper ../LocalOriginManager ../Object3D ../VertexAttribute ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing ./EdgeRenderer ./EdgeWorkerHandle ./interfaces ./strokes ./util ../TextureBackedBuffer/BufferManager ../../../../support/WatchUpdatingTracking ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H,M,K,I,O,Q,J,P,N,R){function S(W){let U=null,aa=null;for(let Y=0;Y<W.geometries.length;Y++){var da;const ea=W.geometryRecords[Y];if(ea.material.supportsEdges){if(!U)U=ea.transformation;else if(!h.equals(U,ea.transformation))return!1;if(!aa&&f.isSome(ea.origin))aa=ea;else if(f.isSome(null==(da=aa)?void 0:da.origin)&&f.isSome(ea.origin)&&aa.origin.id!==ea.origin.id)return!1}}return!0}const T=w.getLogger("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView");
a.EdgeView=function(W){function U(da){var Y=W.call(this,da)||this;Y.updatingHandles=new J.WatchUpdatingTracking;Y.perObjectData=new Map;Y.perObjectDataEvictionCache=new Set;Y.renderers=new Map;Y.numberOfRenderedEdges={[K.Transparency.TRANSPARENT]:0,[K.Transparency.OPAQUE]:0};Y.gpuMemoryUsage=0;Y.workerAbort=new AbortController;Y.tmpModelPosition=r.create();Y.localOrigins=new B.LocalOriginManager(new A.GridLocalOriginFactory(da.renderSR));return Y}b._inheritsLoose(U,W);var aa=U.prototype;aa.initialize=
function(){this.worker=new M(this.schedule);this.componentColorManager=new Q.BufferManager(this.rctx,2);const da=F.VertexLayout.createBuffer(4);for(let Y=0;4>Y;Y++)da.sideness.set(Y,0,0===Y||3===Y?0:1),da.sideness.set(Y,1,0===Y||1===Y?0:1);this.verticesBufferObject=P.BufferObject.createVertex(this.rctx,N.Usage.STATIC_DRAW,da.buffer)};aa.destroy=function(){this.destroyed||(this.perObjectData.forEach(da=>this._discardObjectEntry(da)),this.perObjectData.clear(),this.strokesTexture=f.disposeMaybe(this.strokesTexture),
this.componentColorManager=f.destroyMaybe(this.componentColorManager),this.workerAbort.abort(),this.worker.destroy(),this.verticesBufferObject=f.disposeMaybe(this.verticesBufferObject),this.renderers.clear(),this.updatingHandles.destroy())};aa.shouldRender=function(){return 0<this.renderers.size};aa.addComponentObject=function(){var da=b._asyncToGenerator(function*(Y,ea,ja,la,ia,ca,fa,ba){if(this.hasObject(Y))return this.getObjectMemoryUsage(Y);let Z;ja=new V(new Promise(ha=>Z=ha),ja.center,ja.radius);
this.perObjectData.set(Y,ja);Y=yield this.updatingHandles.addPromise(this._addComponentGeometry(ea,ja,la,ia,ca,fa,ba));this.setNeedsRender();Z();return Y});return function(Y,ea,ja,la,ia,ca,fa,ba){return da.apply(this,arguments)}}();aa.addOrUpdateObject3D=function(){var da=b._asyncToGenerator(function*(Y,ea,ja,la){if(this.destroyed)T.warn("Attempt to add an object to a destroyed instance");else{var ia=this.perObjectData.get(Y);0<(null==ia?void 0:ia.renderables.length)&&this.perObjectDataEvictionCache.add(ia);
var ca,fa=Y.boundingVolumeWorldSpace.bounds;fa=new V(new Promise(Z=>ca=Z),x.getCenter(fa),x.getRadius(fa));this.perObjectData.set(Y,fa);var ba=[];if(ja.mergeGeometries&&1<Y.geometries.length&&S(Y))ba.push(this._addObjectMergedGeometries(Y,fa,ea,ja,la));else for(let Z=0;Z<Y.geometries.length;Z++){const ha=Y.geometryRecords[Z];ha.material.supportsEdges&&ba.push(this._addGeometry(Y,fa,Y.geometries[Z],ha,ea[0],ja,la))}yield this.updatingHandles.addPromise(Promise.all(ba));this.perObjectDataEvictionCache.delete(fa);
this._discardObjectEntry(ia);this.setNeedsRender();ca()}});return function(Y,ea,ja,la){return da.apply(this,arguments)}}();aa._discardObjectEntry=function(da){da&&(da.renderables.length&&(da.renderables.forEach(Y=>this._removeRenderable(Y)),this.setNeedsRender()),da.loaded=null)};aa.hasObject=function(da){return this.perObjectData.has(da)};aa.updateAllComponentOpacities=function(){var da=b._asyncToGenerator(function*(Y,ea){const ja=ea instanceof Array?la=>ea[la]:()=>ea;(yield this.updatingHandles.addPromise(this._getObjectEntry(Y))).renderables.forEach(la=>
{const ia=la.components.meta.length;for(let ca=0;ca<ia;ca++){const fa=ja(ca),ba=la.components.meta[ca],Z=ba.index;ba.material.opacity=fa;la.components.buffer.textureBuffer.setDataElement(Z,1,3,255*fa)}this._updateTransparency(la)});this.setNeedsRender()});return function(Y,ea){return da.apply(this,arguments)}}();aa.getObjectMemoryUsage=function(){var da=b._asyncToGenerator(function*(Y){return(yield this._getObjectEntry(Y)).renderables.reduce((ea,ja)=>ea+ja.statistics.gpuMemoryUsage,0)});return function(Y){return da.apply(this,
arguments)}}();aa.updateAllComponentMaterials=function(){var da=b._asyncToGenerator(function*(Y,ea,ja,la){const ia=Y instanceof D.Object3D,ca=!!ja.slicePlaneEnabled,fa=O.determineRendererType(ea),ba=H.EdgeRenderer.getKey(fa,ca,ia);(yield this.updatingHandles.addPromise(this._getObjectEntry(Y))).renderables.forEach(Z=>{if(ba!==Z.rendererKey){var ha=this.renderers.get(Z.rendererKey);const na=this._acquireRenderer(fa,ca,ia);ha.removeRenderable(Z);ha.refCount.decrement();Z.rendererKey=ba;na.addRenderable(Z)}for(ha=
0;ha<ea.length;ha++)Z.components.meta[ha].material=ea[ha];la&&this._updateComponentBuffer(Z.components);this._updateTransparency(Z)});this.setNeedsRender()});return function(Y,ea,ja,la){return da.apply(this,arguments)}}();aa.updateObjectVisibility=function(){var da=b._asyncToGenerator(function*(Y,ea){(yield this.updatingHandles.addPromise(this._getObjectEntry(Y))).renderables.forEach(ja=>ja.visible=ea);this.setNeedsRender()});return function(Y,ea){return da.apply(this,arguments)}}();aa.removeObject=
function(da){const Y=this.perObjectData.get(da);Y&&(this.perObjectData.delete(da),this._discardObjectEntry(Y))};aa._getObjectEntry=function(){var da=b._asyncToGenerator(function*(Y){Y=this.perObjectData.get(Y);if(!Y)throw"no object";yield Y.loaded;return Y});return function(Y){return da.apply(this,arguments)}}();aa.removeAll=function(){this.perObjectData.forEach((da,Y)=>this.removeObject(Y))};aa.render=function(da,Y){this.numberOfRenderedEdges[Y]=0;if(!f.isNone(this.componentColorManager)){this.localOrigins.updateViewMatrices(da.camera.viewMatrix);
var ea=da.camera.viewInverseTransposeMatrix,ja=r.create(),la=new y.TwoVectorPosition,ia=new E.VertexPositionViewProjectionTransform,ca=z.create();t.set(ja,ea[3],ea[7],ea[11]);la.set(ja);t.copy(ia.transformWorldFromViewTH,la.high);t.copy(ia.transformWorldFromViewTL,la.low);m.fromMat4(ia.transformViewFromCameraRelativeRS,da.camera.viewMatrix);v.copy(ia.transformProjFromView,da.camera.projectionMatrix);ea=z.create();m.transpose(ea,ia.transformViewFromCameraRelativeRS);m.invert(ca,ea);var fa=0,ba=0;this.renderers.forEach(ha=>
{0===ha.refCount.value?(this.renderers.delete(ha.key),ha.dispose()):ha.forEachRenderable(na=>{na.visible&&(fa+=na.statistics.averageEdgeLength,ba++)},Y)});this.componentColorManager.garbageCollect();this.componentColorManager.updateTextures();if(0!==ba){var Z={distanceFalloffFactor:40*fa/ba,minimumEdgeLength:da.camera.perScreenPixelRatio,transparency:Y,viewProjectionTransform:ia,transformNormalViewFromGlobal:ca};this._updateObjectCameraDistances(da);this.renderers.forEach(ha=>{this._renderRegularEdges(ha,
da,Z);this._renderSilhouetteEdges(ha,da,Z)})}}};aa._updateTransparency=function(da){const Y=O.determineEdgeTransparency(da.components.meta),ea=O.determineObjectTransparency(da.components.meta);if(Y!==da.edgeTransparency||ea!==da.objectTransparency)da.edgeTransparency=Y,da.objectTransparency=ea,this.renderers.get(da.rendererKey).setRenderablesDirty()};aa._computeModelTransformWithLocalOrigin=function(da,Y,ea){da.getCombinedStaticTransformation(Y,ea);f.isSome(Y.origin)?this.localOrigins.register(Y.origin):
(da=t.set(this.tmpModelPosition,ea[12],ea[13],ea[14]),Y.origin=this.localOrigins.acquire(da));p.applyToModelMatrix(Y.origin.vec3,ea);return Y.origin};aa._updateComponentBuffer=function(da){const {meta:Y,buffer:ea}=da;for(da=0;da<Y.length;da++){var ja=Y[da].material;const la=Y[da].index,ia=n.clamp(Math.round(ja.size*H.LINE_WIDTH_FRACTION_FACTOR),0,255),ca=n.clamp(ja.extensionLength,-H.EXTENSION_LENGTH_OFFSET,255-H.EXTENSION_LENGTH_OFFSET)+H.EXTENSION_LENGTH_OFFSET,fa="solid"===ja.type?L.EdgeType.SOLID:
L.EdgeType.SKETCH,ba=255*ja.opacity;ja=ja.color;ea.textureBuffer.setData(la,0,255*ja[0],255*ja[1],255*ja[2],255*ja[3]);ea.textureBuffer.setData(la,1,ia,ca,fa,ba)}};aa._createComponentBuffers=function(da){if(f.isNone(this.componentColorManager))return null;const Y=[],ea=this.componentColorManager.getBuffer(da.length);for(let ja=0;ja<da.length;ja++){const la=da[ja],ia=ea.acquireIndex();Y.push({index:ia,material:la})}da={meta:Y,buffer:ea};this._updateComponentBuffer(da);return da};aa._extractEdges=function(da,
Y,ea,ja,la,ia=la.length){return this.worker.process({data:Y,indices:la,indicesLength:ia,writerSettings:da,skipDeduplicate:ea},this.workerAbort.signal,ja)};aa._createEdgeResources=function(da){const Y={};if(f.isNone(this.verticesBufferObject))return Y;if(0<da.regular.lodInfo.lengths.length){var ea=new R.VertexArrayObject(this.rctx,F.EdgeShaderAttributeLocations,{vertices:F.glVertexLayout,instances:G.RegularEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:P.BufferObject.createVertex(this.rctx,
N.Usage.STATIC_DRAW,da.regular.instancesData.buffer)});Y.regular={vao:ea,lod:da.regular.lodInfo}}0<da.silhouette.lodInfo.lengths.length&&(ea=new R.VertexArrayObject(this.rctx,F.EdgeShaderAttributeLocations,{vertices:F.glVertexLayout,instances:G.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:P.BufferObject.createVertex(this.rctx,N.Usage.STATIC_DRAW,da.silhouette.instancesData.buffer)}),Y.silhouette={vao:ea,lod:da.silhouette.lodInfo});return Y};aa._addGeometry=function(){var da=
b._asyncToGenerator(function*(Y,ea,ja,la,ia,ca,fa){const ba=ja.vertexAttributes.get(C.VertexAttribute.POSITION),Z=ja.indices.get(C.VertexAttribute.POSITION),ha=q.create();Y=this._computeModelTransformWithLocalOrigin(Y,la,ha);return this._addPositionData(ea,{position:ba,indices:Z,modelTransform:ha,origin:Y},ja.edgeIndicesLength,ia,ca,fa)});return function(Y,ea,ja,la,ia,ca,fa){return da.apply(this,arguments)}}();aa._addPositionData=function(){var da=b._asyncToGenerator(function*(Y,ea,ja,la,ia,ca=!1){if(null!=
Y.loaded){var fa=this._createComponentBuffers([la]);if(!(f.isNone(fa)||0>=ja)){la=this._acquireRenderer(la.type,!!ia.slicePlaneEnabled);var {modelTransform:ba,origin:Z}=ea;ia=ea.indices;ea=ea.position;var ha=ea.data.length/ea.size,na=F.EdgeInputBufferLayout.createBuffer(ha);for(let Da=0;Da<ha;Da++)na.position.set(Da,0,ea.data[Da*ea.size]),na.position.set(Da,1,ea.data[Da*ea.size+1]),na.position.set(Da,2,ea.data[Da*ea.size+2]);O.fillComponenBufferIndices(fa.meta,[0,na.componentIndex.count],na.componentIndex);
ca=yield this.updatingHandles.addPromise(this._extractEdges(la.writerSettings,na,!1,ca,ia,ja));if(null!=Y.loaded){var {regular:pa,silhouette:xa}=this._createEdgeResources(ca);ja=(pa?pa.vao.size:0)+(xa?xa.vao.size:0);fa={regular:pa,silhouette:xa,transform:{modelMatrix:ba,origin:Z},statistics:{gpuMemoryUsage:ja,externalMemoryUsage:!1,averageEdgeLength:ca.averageEdgeLength},components:fa,visible:!0,edgeTransparency:O.determineEdgeTransparency(fa.meta),objectTransparency:O.determineObjectTransparency(fa.meta),
distanceToCamera:0,rendererKey:la.key};Y.renderables.push(fa);la.addRenderable(fa);this.gpuMemoryUsage+=ja}}}});return function(Y,ea,ja,la,ia){return da.apply(this,arguments)}}();aa._addComponentGeometry=function(){var da=b._asyncToGenerator(function*(Y,ea,ja,la,ia,ca,fa){if(null==ea.loaded)return 0;const ba=this._createComponentBuffers(ca);if(f.isNone(ba))return 0;ca=O.determineRendererType(ca);fa=this._acquireRenderer(ca,fa.slicePlaneEnabled||!1,!1);ca=F.EdgeInputBufferLayout.createBuffer(ja.count);
u.copy(ca.position,ja);O.fillComponenBufferIndices(ba.meta,ia,ca.componentIndex,la);la=yield this.updatingHandles.addPromise(this._extractEdges(fa.writerSettings,ca,!0,!1,la));if(null==ea.loaded)return 0;const {regular:Z,silhouette:ha}=this._createEdgeResources(la);ja=(Z?Z.vao.size:0)+(ha?ha.vao.size:0);Y={regular:Z,silhouette:ha,transform:Y,statistics:{gpuMemoryUsage:ja,externalMemoryUsage:!0,averageEdgeLength:la.averageEdgeLength},components:ba,visible:!0,edgeTransparency:O.determineEdgeTransparency(ba.meta),
objectTransparency:O.determineObjectTransparency(ba.meta),distanceToCamera:0,rendererKey:fa.key};ea.renderables.push(Y);fa.addRenderable(Y);return ja});return function(Y,ea,ja,la,ia,ca,fa){return da.apply(this,arguments)}}();aa._addObjectMergedGeometries=function(){var da=b._asyncToGenerator(function*(Y,ea,ja,la,ia){var ca=new Map,fa=0,ba=null,Z=0;for(var ha=0;ha<Y.geometries.length;ha++){var na=Y.geometries[ha],pa=Y.geometryRecords[ha];pa.material.supportsEdges&&(!ba&&pa.origin&&(ba=pa),pa=na.vertexAttributes.get(C.VertexAttribute.POSITION),
Z+=pa.data.length/pa.size,fa+=na.edgeIndicesLength)}Z=65536<=Z?Uint32Array:Uint16Array;fa=fa?new Z(fa):null;Z=[];ha=0;for(na=0;na<Y.geometries.length;na++){pa=Y.geometries[na];if(!Y.geometryRecords[na].material.supportsEdges)continue;var xa=pa.vertexAttributes.get(C.VertexAttribute.POSITION);const Da=pa.indices.get(C.VertexAttribute.POSITION);let ua=ca.get(xa.data);if(null==ua){ua=Z.length/3;for(let Fa=0;Fa<xa.data.length;Fa+=xa.size)Z.push(xa.data[Fa+0]),Z.push(xa.data[Fa+1]),Z.push(xa.data[Fa+2]);
ca.set(xa.data,ua)}if(Da)for(xa=0;xa<pa.edgeIndicesLength;xa++)fa[ha++]=ua+Da[xa]}ba=ba||Y.geometryRecords[0];ca=q.create();ba=this._computeModelTransformWithLocalOrigin(Y,ba,ca);for(ha=0;ha<Y.geometryRecords.length;ha++)Y.geometryRecords[ha].origin=ba;yield this.updatingHandles.addPromise(this._addPositionData(ea,{position:{data:Z,size:3},indices:fa,modelTransform:ca,origin:ba},fa.length,ja[0],la,ia))});return function(Y,ea,ja,la,ia){return da.apply(this,arguments)}}();aa._acquireRenderer=function(da,
Y,ea=!0){const ja=H.EdgeRenderer.getKey(da,Y,ea);let la=this.renderers.get(ja);f.isNone(this.strokesTexture)&&(this.strokesTexture=I.generateStrokesTexture(this.rctx));la||(la=new H.EdgeRenderer(this.rctx,this.techniqueRepository,{type:da,slicePlaneEnabled:Y,strokesTexture:this.strokesTexture,legacy:ea}),this.renderers.set(ja,la));la.refCount.increment();return la};aa._removeRenderable=function(da){da.regular&&(da.regular.vao.vertexBuffers.instances.dispose(),da.regular.vao.dispose(!1),da.regular.vao=
null);da.silhouette&&(da.silhouette.vao.vertexBuffers.instances.dispose(),da.silhouette.vao.dispose(!1),da.silhouette.vao=null);const Y=this.renderers.get(da.rendererKey);if(Y){Y.removeRenderable(da);Y.refCount.decrement();"origin"in da.transform&&this.localOrigins.release(da.transform.origin);this.gpuMemoryUsage-=da.statistics.externalMemoryUsage?0:da.statistics.gpuMemoryUsage;for(const ea of da.components.meta)da.components.buffer.releaseIndex(ea.index)}};aa._updateObjectCameraDistances=function(da){const Y=
da.camera.eye,ea=da.camera.viewForward,ja=r.create();da=la=>{const {center:ia,radius:ca}=la;t.sub(ja,ia,Y);const fa=t.dot(ja,ea),ba=fa<-ca?Infinity:fa<ca?0:fa-ca;la.renderables.forEach(Z=>Z.distanceToCamera=ba)};this.perObjectData.forEach(da);this.perObjectDataEvictionCache.forEach(da)};aa._renderRegularEdges=function(da,Y,ea){da.bindRegularEdges(Y,ea);const ja=ea.transparency;da.forEachRenderable(la=>{if(la.visible&&la.regular){var ia=O.computeEdgeCount(la.regular.lod.lengths,la.distanceToCamera,
ea);"origin"in la.transform&&(Y.localViewMatrixForEdges=this.localOrigins.getViewMatrix(la.transform.origin));da.renderRegularEdges(la,Y,ia);this.numberOfRenderedEdges[ja]+=ia}},ja)};aa._renderSilhouetteEdges=function(da,Y,ea){da.bindSilhouetteEdges(Y,ea);const ja=ea.transparency;da.forEachRenderable(la=>{if(la.visible&&la.silhouette){var ia=O.computeEdgeCount(la.silhouette.lod.lengths,la.distanceToCamera,ea);"origin"in la.transform&&(Y.localViewMatrixForEdges=this.localOrigins.getViewMatrix(la.transform.origin));
da.renderSilhouetteEdges(la,Y,ia);this.numberOfRenderedEdges[ja]+=ia}},ja)};b._createClass(U,[{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"usedMemory",get:function(){return this.gpuMemoryUsage}},{key:"numberOfRenderedPrimitives",get:function(){return this.numberOfRenderedEdges[K.Transparency.TRANSPARENT]+this.numberOfRenderedEdges[K.Transparency.OPAQUE]}}]);return U}(g);c.__decorate([l.property({constructOnly:!0})],a.EdgeView.prototype,"rctx",void 0);c.__decorate([l.property({constructOnly:!0})],
a.EdgeView.prototype,"renderSR",void 0);c.__decorate([l.property({constructOnly:!0})],a.EdgeView.prototype,"techniqueRepository",void 0);c.__decorate([l.property({constructOnly:!0})],a.EdgeView.prototype,"setNeedsRender",void 0);c.__decorate([l.property({constructOnly:!0})],a.EdgeView.prototype,"schedule",void 0);c.__decorate([l.property({readOnly:!0})],a.EdgeView.prototype,"updatingHandles",void 0);c.__decorate([l.property({readOnly:!0})],a.EdgeView.prototype,"updating",null);a.EdgeView=c.__decorate([d.subclass("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],
a.EdgeView);let V=function(W,U,aa){this.center=U;this.radius=aa;this.renderables=[];this.loaded=W;this.loaded.then(()=>{null!=this.loaded&&(this.loaded=!0)})};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["exports"],function(a){a.applyToModelMatrix=function(b,c){const g=-b[0],h=-b[1];b=-b[2];const w=c[3],n=c[7],f=c[11],l=c[15];c[0]+=w*g;c[1]+=w*h;c[2]+=w*b;c[4]+=n*g;c[5]+=n*h;c[6]+=n*b;c[8]+=f*g;c[9]+=f*h;c[10]+=f*b;c[12]+=
l*g;c[13]+=l*h;c[14]+=l*b};a.applyToViewMatrix=function(b,c){const g=b[0],h=b[1];b=b[2];c[12]+=g*c[0]+h*c[4]+b*c[8];c[13]+=g*c[1]+h*c[5]+b*c[9];c[14]+=g*c[2]+h*c[6]+b*c[10];c[14]+=g*c[3]+h*c[7]+b*c[11]};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["exports","../../../../chunks/mat4","../../../../chunks/mat4f64","./localOriginHelper"],function(a,b,c,g){let h=function(){function w(f){this.factory=f;this.originData=new Map}
var n=w.prototype;n.acquire=function(f){return this.register(this.factory.getOrigin(f))};n.register=function(f){const l=this.originData.get(f.id);if(l)return l.refCount++,l.origin;this.originData.set(f.id,{refCount:1,viewMatrix:c.create(),origin:f});return f};n.release=function(f){const l=this.originData.get(f.id);l&&(l.refCount--,0===l.refCount&&this.originData.delete(f.id))};n.updateViewMatrices=function(f){this.originData.forEach(l=>{b.copy(l.viewMatrix,f);g.applyToViewMatrix(l.origin.vec3,l.viewMatrix)})};
n.getViewMatrix=function(f){return this.originData.get(f.id).viewMatrix};return w}();a.LocalOriginManager=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":function(){define(["exports","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout","../VertexAttribute"],function(a,b,c,g){const h=c.newLayout().vec3f(g.VertexAttribute.POSITION).u16(g.VertexAttribute.COMPONENTINDEX).u16(g.VertexAttribute.U16PADDING),w=c.newLayout().vec2u8(g.VertexAttribute.SIDENESS);
b=b.glLayout(w);c=c.newLayout().vec3f(g.VertexAttribute.POSITION0).vec3f(g.VertexAttribute.POSITION1).u16(g.VertexAttribute.COMPONENTINDEX).u8(g.VertexAttribute.VARIANTOFFSET,{glNormalized:!0}).u8(g.VertexAttribute.VARIANTSTROKE).u8(g.VertexAttribute.VARIANTEXTENSION,{glNormalized:!0}).u8(g.VertexAttribute.U8PADDING,{glPadding:!0}).u16(g.VertexAttribute.U16PADDING,{glPadding:!0});const n=c.clone().vec3f(g.VertexAttribute.NORMAL),f=c.clone().vec3f(g.VertexAttribute.NORMALA).vec3f(g.VertexAttribute.NORMALB);
g=new Map([[g.VertexAttribute.POSITION0,0],[g.VertexAttribute.POSITION1,1],[g.VertexAttribute.COMPONENTINDEX,2],[g.VertexAttribute.VARIANTOFFSET,3],[g.VertexAttribute.VARIANTSTROKE,4],[g.VertexAttribute.VARIANTEXTENSION,5],[g.VertexAttribute.NORMAL,6],[g.VertexAttribute.NORMALA,6],[g.VertexAttribute.NORMALB,7],[g.VertexAttribute.SIDENESS,8]]);a.CommonInstancesLayout=c;a.EdgeInputBufferLayout=h;a.EdgeShaderAttributeLocations=g;a.RegularEdgeInstancesLayout=n;a.SilhouetteEdgeInstancesLayout=f;a.VertexLayout=
w;a.glVertexLayout=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":function(){define("exports ../../../../../core/RandomLCG ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../support/buffer/glUtil ./bufferLayouts".split(" "),function(a,b,c,g,h,w){function n(r){const x=e;x[0]=r.position0[0];x[1]=r.position0[1];x[2]=r.position0[2];x[3]=r.position1[0];x[4]=r.position1[1];x[5]=r.position1[2];m[0]=5381;for(r=0;r<d.length;r++)m[0]=
31*m[0]+d[r];return m[0]}function f(r){const x=e;x[0]=l(r.position0[0]);x[1]=l(r.position0[1]);x[2]=l(r.position0[2]);x[3]=l(r.position1[0]);x[4]=l(r.position1[1]);x[5]=l(r.position1[2]);m[0]=5381;for(r=0;r<d.length;r++)m[0]=31*m[0]+d[r];return m[0]}function l(r){return Math.round(1E4*r)/1E4}let k=function(){function r(){}var x=r.prototype;x.updateSettings=function(u){this.settings=u;this.edgeHashFunction=u.reducedPrecision?f:n};x.write=function(u,E,y){var A=this.edgeHashFunction(y);t.seed=A;A=t.getIntRange(0,
255);const p=t.getIntRange(0,this.settings.variants-1);var B=t.getFloat();B=-(1-Math.min(B/.7,1))+Math.max(0,B-.7)/(1-.7);B=255*(Math.abs(B)**1.2*(0>B?-1:1)*.5+.5);u.position0.setVec(E,y.position0);u.position1.setVec(E,y.position1);u.componentIndex.set(E,y.componentIndex);u.variantOffset.set(E,A);u.variantStroke.set(E,p);u.variantExtension.set(E,B)};x.trim=function(u,E){return u.slice(0,E)};return r}();const e=new Float32Array(6),d=new Uint32Array(e.buffer),m=new Uint32Array(1);let z=function(){function r(){this.commonWriter=
new k}var x=r.prototype;x.updateSettings=function(u){this.commonWriter.updateSettings(u)};x.allocate=function(u){return w.RegularEdgeInstancesLayout.createBuffer(u)};x.write=function(u,E,y){this.commonWriter.write(u,E,y);c.add(q,y.faceNormal0,y.faceNormal1);c.normalize(q,q);u.normal.setVec(E,q)};x.trim=function(u,E){return this.commonWriter.trim(u,E)};return r}();z.Layout=w.RegularEdgeInstancesLayout;z.glLayout=h.glLayout(w.RegularEdgeInstancesLayout,1);let v=function(){function r(){this.commonWriter=
new k}var x=r.prototype;x.updateSettings=function(u){this.commonWriter.updateSettings(u)};x.allocate=function(u){return w.SilhouetteEdgeInstancesLayout.createBuffer(u)};x.write=function(u,E,y){this.commonWriter.write(u,E,y);u.normalA.setVec(E,y.faceNormal0);u.normalB.setVec(E,y.faceNormal1)};x.trim=function(u,E){return this.commonWriter.trim(u,E)};return r}();v.Layout=w.SilhouetteEdgeInstancesLayout;v.glLayout=h.glLayout(w.SilhouetteEdgeInstancesLayout,1);const q=g.create(),t=new b;a.CommonBufferWriter=
k;a.RegularEdgeBufferWriter=z;a.SilhouetteEdgeBufferWriter=v;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define("exports ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../core/typedArrayUtil ../../../../../chunks/vec3 ../../../../../chunks/vec3f64".split(" "),function(a,b,c,g,h,w){function n(m,z){const v=c.acosClamped(m.cosAngle),q=k.fwd,t=k.ortho;h.direction(q,m.position1,m.position0);m=
0<h.dot(h.cross(t,m.faceNormal0,m.faceNormal1),q)?-1:1;return v*m>z}function f(m){const z=m.faces.length/3,v=m.faces;m=m.neighbors;var q=0;for(var t=0;t<z;t++){var r=m[3*t+1],x=m[3*t+2],u=v[3*t],E=v[3*t+1],y=v[3*t+2];q+=-1===m[3*t]||u<E?1:0;q+=-1===r||E<y?1:0;q+=-1===x||y<u?1:0}q=new Int32Array(4*q);t=0;for(r=0;r<z;r++){x=m[3*r];u=m[3*r+1];E=m[3*r+2];y=v[3*r];const A=v[3*r+1],p=v[3*r+2];if(-1===x||y<A)q[t++]=y,q[t++]=A,q[t++]=r,q[t++]=x;if(-1===u||A<p)q[t++]=A,q[t++]=p,q[t++]=r,q[t++]=u;if(-1===E||
p<y)q[t++]=p,q[t++]=y,q[t++]=r,q[t++]=E}return q}function l(m){const z=m.faces.length/3,v=m.vertices.position;m=m.faces;const q=e.v0,t=e.v1,r=e.v2,x=new Float32Array(3*z);for(let u=0;u<z;u++){const E=m[3*u+1],y=m[3*u+2];v.getVec(m[3*u],q);v.getVec(E,t);v.getVec(y,r);h.subtract(t,t,q);h.subtract(r,r,q);h.cross(q,t,r);h.normalize(q,q);x[3*u]=q[0];x[3*u+1]=q[1];x[3*u+2]=q[2]}return x}a.EdgeType=void 0;(function(m){m[m.SOLID=0]="SOLID";m[m.SKETCH=1]="SKETCH"})(a.EdgeType||(a.EdgeType={}));const k={edge:{position0:w.create(),
position1:w.create(),faceNormal0:w.create(),faceNormal1:w.create(),componentIndex:0,cosAngle:0},ortho:w.create(),fwd:w.create()},e={v0:w.create(),v1:w.create(),v2:w.create()},d={anglePlanar:4,angleSignificantEdge:35};a.extractEdges=function(m,z,v,q=d){const t=m.vertices.position;var r=m.vertices.componentIndex,x=c.deg2rad(q.anglePlanar);q=c.deg2rad(q.angleSignificantEdge);const u=Math.cos(q),E=Math.cos(x),y=k.edge,A=y.position0,p=y.position1,B=y.faceNormal0,D=y.faceNormal1,C=l(m),F=f(m),G=F.length/
4;m=z.allocate(G);q=0;const L=v.allocate(G);let H=0,M=0,K=0;const I=b.range(0,G),O=new Float32Array(G);g.forEach(O,(N,R,S)=>{t.getVec(F[4*R],A);t.getVec(F[4*R+1],p);S[R]=h.distance(A,p)});I.sort((N,R)=>O[R]-O[N]);const Q=[],J=[];for(let N=0;N<G;N++){var P=I[N];const R=O[P],S=F[4*P],T=F[4*P+1],V=F[4*P+2];P=F[4*P+3];const W=-1===P;t.getVec(S,A);t.getVec(T,p);if(W)h.set(B,C[3*V],C[3*V+1],C[3*V+2]),h.copy(D,B),y.componentIndex=r.get(S),y.cosAngle=h.dot(B,D);else{h.set(B,C[3*V],C[3*V+1],C[3*V+2]);h.set(D,
C[3*P],C[3*P+1],C[3*P+2]);y.componentIndex=r.get(S);y.cosAngle=h.dot(B,D);if(y.cosAngle>E)continue;-.9999>y.cosAngle&&h.copy(D,B)}M+=R;K++;W||y.cosAngle<u?(z.write(m,q++,y),Q.push(R)):n(y,x)&&(v.write(L,H++,y),J.push(R))}r=new Float32Array(Q.reverse());x=new Float32Array(J.reverse());return{regular:{instancesData:z.trim(m,q),lodInfo:{lengths:r}},silhouette:{instancesData:v.trim(L,H),lodInfo:{lengths:x}},averageEdgeLength:M/K}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../support/debugFlags ../../collections/Component/Material/ComponentTechnique ../../core/shaderLibrary/Slice.glsl ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../../core/shaderLibrary/util/DoublePrecision.glsl ../../core/util/TwoVectorPosition ./EdgeShaderTechnique ./interfaces ../../shaders/sources/edgeRenderer/EdgeUtil.glsl ../../../../webgl/enums".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x){const u={type:"uber",slicePlaneEnabled:!1,sliceHighlightDisabled:!1,strokesTexture:null,legacy:!0};let E=function(){function B(){this._value=0}var D=B.prototype;D.increment=function(){this._value++};D.decrement=function(){this._value--};b._createClass(B,[{key:"value",get:function(){return this._value}}]);return B}();const y={solid:r.EdgeUtilMode.SOLID,sketch:r.EdgeUtilMode.SKETCH,uber:r.EdgeUtilMode.MIXED};r=function(){function B(C,F,G){this.rctx=C;
this.shaderTechniqueRepository=F;this.config=new q.EdgeShaderTechniqueConfiguration;this.technique=null;this.refCount=new E;this.renderables=new Set;this.sortedRenderables={[t.Transparency.TRANSPARENT]:{[t.Transparency.TRANSPARENT]:new g,[t.Transparency.OPAQUE]:new g},[t.Transparency.OPAQUE]:{[t.Transparency.TRANSPARENT]:new g,[t.Transparency.OPAQUE]:new g}};this.renderablesDirty=!1;this.settings={...u,...G};this.key=B.getKey(this.settings.type,this.settings.slicePlaneEnabled,this.settings.legacy);
this.writerSettings={variants:this.settings.strokesTexture.variants,reducedPrecision:l.TESTS_DISABLE_OPTIMIZATIONS};this.config.legacy=this.settings.legacy;this.config.mode=y[this.settings.type];this.config.silhouette=!1;this.config.antialiasing=!!this.rctx.capabilities.blendMinMax;this.config.slicePlaneEnabled=this.settings.slicePlaneEnabled;this.config.doublePrecisionRequiresObfuscation=z.doublePrecisionRequiresObfuscation(C)}var D=B.prototype;D.dispose=function(){this.technique=c.releaseMaybe(this.technique)};
D.addRenderable=function(C){this.renderables.add(C);this.renderablesDirty=!0};D.removeRenderable=function(C){this.renderables.delete(C);this.renderablesDirty=!0};D.setRenderablesDirty=function(){this.renderablesDirty=!0};D.forEachRenderable=function(C,F){this.renderablesDirty&&this._sortRenderables();this.sortedRenderables[F][t.Transparency.TRANSPARENT].forAll(C);this.sortedRenderables[F][t.Transparency.OPAQUE].forAll(C)};D.setMultipassParameters=function(C){this.config.multipassTerrainEnabled=C.multipassTerrainEnabled?
C.multipassTerrainEnabled:!1;this.config.cullAboveGround=C.cullAboveGround?C.cullAboveGround:!1};D.bindRegularEdges=function(C,F){this.setMultipassParameters(C);this.config.silhouette=!1;this.technique=this.shaderTechniqueRepository.releaseAndAcquire(q.EdgeShaderTechnique,this.config,this.technique);this.rctx.useTechnique(this.technique,C.slot);this.technique.bindPass({bindParameters:C,edgeRenderParameters:F})};D.bindSilhouetteEdges=function(C,F){this.setMultipassParameters(C);this.config.silhouette=
!0;this.technique=this.shaderTechniqueRepository.releaseAndAcquire(q.EdgeShaderTechnique,this.config,this.technique);this.rctx.useTechnique(this.technique,C.slot);this.technique.bindPass({bindParameters:C,edgeRenderParameters:F})};D.renderRegularEdges=function(C,F,G){this._render(C,C.regular.vao,F,G)};D.renderSilhouetteEdges=function(C,F,G){this._render(C,C.silhouette.vao,F,G)};D._render=function(C,F,G,L){this._setUniforms(C,G);this.rctx.bindVAO(F);this.rctx.capabilities.instancing.drawArraysInstanced(x.PrimitiveType.TRIANGLE_FAN,
0,4,L)};D._setUniforms=function(C,F){const G=this.technique.program;C.components.buffer.textureBuffer.bind(G,"componentDataTex","componentDataTexInvDim");F.multipassTerrainEnabled&&(G.setUniform2fv("nearFar",F.camera.nearFar),G.setUniform2fv("inverseViewport",F.inverseViewport),m.bindMultipassTerrainTexture(G,F));if("origin"in C.transform)G.setUniformMatrix4fv("view",F.localViewMatrixForEdges),G.setUniformMatrix4fv("model",C.transform.modelMatrix),e.bindSliceUniforms(G,this.settings,F.slicePlane,
{origin:C.transform.origin.vec3});else{const L=new v.TwoVectorPosition(C.transform.position),H=h.transpose(A,h.invert(A,C.transform.rotationScale)),M=new k.ComponentDrawParameters;n.copy(M.transformWorldFromModelTL,L.low);n.copy(M.transformWorldFromModelTH,L.high);h.copy(M.transformWorldFromModelRS,C.transform.rotationScale);h.copy(M.transformNormalGlobalFromModel,H);d.bindModelTransform(G,M);G.setUniformMatrix3fv("transformNormalGlobalFromModel",M.transformNormalGlobalFromModel);C=F.camera.viewInverseTransposeMatrix;
C=n.set(p,C[3],C[7],C[11]);e.bindSliceUniforms(G,this.settings,F.slicePlane,{origin:C})}"uber"!==this.settings.type&&"sketch"!==this.settings.type||this._setSketchUniforms(G)};D._setSketchUniforms=function(C){const F=this.settings.strokesTexture,G=F.texture;c.isNone(G)||(C.bindTexture(G,"strokesTexture"),C.setUniform2f("strokesTextureScale",1/G.descriptor.width,1/G.descriptor.height),C.setUniform1f("strokesLog2Resolution",Math.log2(F.resolution)),C.setUniform1f("strokesNormalizationScale",F.normalizationScale),
C.setUniform1f("strokesAmplitude",F.amplitude),C.setUniform1f("strokeVariants",F.variants))};D._sortRenderables=function(){this.renderablesDirty=!1;this.sortedRenderables[t.Transparency.TRANSPARENT][t.Transparency.TRANSPARENT].clear();this.sortedRenderables[t.Transparency.TRANSPARENT][t.Transparency.OPAQUE].clear();this.sortedRenderables[t.Transparency.OPAQUE][t.Transparency.TRANSPARENT].clear();this.sortedRenderables[t.Transparency.OPAQUE][t.Transparency.OPAQUE].clear();this.renderables.forEach(F=>
{F.objectTransparency!==t.Transparency.INVISIBLE&&F.edgeTransparency!==t.Transparency.INVISIBLE&&this.sortedRenderables[F.objectTransparency][F.edgeTransparency].push(F)});const C=(F,G)=>"origin"in F.transform&&"origin"in G.transform?F.transform.origin.id<G.transform.origin.id?-1:F.transform.origin.id>G.transform.origin.id?1:0:0;this.sortedRenderables[t.Transparency.TRANSPARENT][t.Transparency.TRANSPARENT].sort(C);this.sortedRenderables[t.Transparency.TRANSPARENT][t.Transparency.OPAQUE].sort(C);this.sortedRenderables[t.Transparency.OPAQUE][t.Transparency.TRANSPARENT].sort(C);
this.sortedRenderables[t.Transparency.OPAQUE][t.Transparency.OPAQUE].sort(C)};B.getKey=function(C,F,G){return`edges-t:${C}:${F}:${G}`};return B}();const A=w.create(),p=f.create();a.EXTENSION_LENGTH_OFFSET=128;a.EdgeRenderer=r;a.LINE_WIDTH_FRACTION_FACTOR=8;a.componentDataInvDimName="componentDataTexInvDim";a.componentDataTexName="componentDataTex";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechnique":function(){define("require exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../core/shaderTechnique/ShaderTechniqueConfiguration ../Program ./bufferLayouts ../../../../../chunks/EdgeShaderProgram.glsl ../../shaders/sources/edgeRenderer/EdgeUtil.glsl ../../../../webgl/enums ../../../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z){n=function(v){function q(){return v.apply(this,arguments)||this}c._inheritsLoose(q,v);var t=q.prototype;t.bindPass=function(r){const x=this.program,{edgeRenderParameters:u,bindParameters:E}=r;h.bindViewProjTransform(x,u.viewProjectionTransform);x.setUniformMatrix3fv("transformNormalViewFromGlobal",u.transformNormalViewFromGlobal);x.setUniformMatrix4fv("proj",E.camera.projectionMatrix);x.setUniform2f("depthBias",.5,-4E-4);x.setUniform2f("pixelToNDC",2/E.camera.fullViewport[2],
2/E.camera.fullViewport[3]);x.setUniform2f("ndcToPixel",E.camera.fullViewport[2]/2,E.camera.fullViewport[3]/2);x.setUniform1f("distanceFalloffFactor",u.distanceFalloffFactor);x.setUniform2f("inverseViewport",1/E.camera.fullViewport[2],1/E.camera.fullViewport[3]);x.setUniform1f("pixelRatio",E.camera.pixelRatio||1)};t.initializeProgram=function(r){var x=q.shader.get();const u=this.configuration;x=x.build({slicePlaneEnabled:u.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,
silhouette:u.silhouette,legacy:u.legacy,antialiasing:u.antialiasing,mode:u.mode,doublePrecisionRequiresObfuscation:u.doublePrecisionRequiresObfuscation,multipassTerrainEnabled:u.multipassTerrainEnabled,cullAboveGround:u.cullAboveGround});return new l.Program(r.rctx,x,k.EdgeShaderAttributeLocations)};t.initializePipeline=function(r){return(r=r.rctx.capabilities.blendMinMax)?z.makePipelineState({blending:z.separateBlendingParams(m.BlendFactor.ONE,m.BlendFactor.ONE,m.BlendFactor.ZERO,m.BlendFactor.ONE,
m.BlendOperation.ADD,r.MAX),depthTest:{func:m.CompareFunction.LEQUAL},colorWrite:z.defaultColorWriteParams}):z.makePipelineState({depthTest:{func:m.CompareFunction.LEQUAL},depthWrite:z.defaultDepthWriteParams,colorWrite:z.defaultColorWriteParams})};return q}(n.ShaderTechnique);n.shader=new w.ReloadableShaderModule(e.EdgeShaderProgram,()=>new Promise((v,q)=>a(["../../shaders/sources/edgeRenderer/EdgeShaderProgram.glsl"],v,q)));w=function(v){function q(){var t=v.apply(this,arguments)||this;t.slicePlaneEnabled=
!1;t.silhouette=!1;t.legacy=!1;t.antialiasing=!1;t.mode=d.EdgeUtilMode.SOLID;t.doublePrecisionRequiresObfuscation=!1;t.multipassTerrainEnabled=!1;t.cullAboveGround=!1;return t}c._inheritsLoose(q,v);return q}(f.ShaderTechniqueConfiguration);g.__decorate([f.parameter()],w.prototype,"slicePlaneEnabled",void 0);g.__decorate([f.parameter()],w.prototype,"silhouette",void 0);g.__decorate([f.parameter()],w.prototype,"legacy",void 0);g.__decorate([f.parameter()],w.prototype,"antialiasing",void 0);g.__decorate([f.parameter({count:d.EdgeUtilMode.COUNT})],
w.prototype,"mode",void 0);g.__decorate([f.parameter()],w.prototype,"doublePrecisionRequiresObfuscation",void 0);g.__decorate([f.parameter()],w.prototype,"multipassTerrainEnabled",void 0);g.__decorate([f.parameter()],w.prototype,"cullAboveGround",void 0);b.EdgeShaderTechnique=n;b.EdgeShaderTechniqueConfiguration=w;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/EdgeShaderProgram.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardShortEdges.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v){function q(r){const x=new w.ShaderBuilder,u=x.vertex,E=x.fragment;r.legacy&&u.uniforms.add("model","mat4");r.antialiasing&&(u.code.add(h.glsl`#define ANTIALIASING 1`),E.code.add(h.glsl`#define ANTIALIASING 1`));x.include(f.AdjustProjectedPosition,r);x.include(m.LineAmplitude,r);x.include(d.EdgeUtil,r);x.include(v.UnpackAttributes,r);x.include(z.LineOffset,r);x.include(b.Slice,r);x.include(k.DiscardNonSilhouetteEdges,r);x.include(l.DiscardByCoverage,r);x.include(e.DiscardShortEdges,
r);x.varyings.add("vColor","vec4");x.varyings.add("vRadius","float");x.varyings.add("vPosition","vec3");x.varyings.add("vWorldPosition","vec3");x.varyings.add("vViewPos","vec3");x.varyings.add("vLineLengthPixels","float");x.varyings.add("vSizeFalloffFactor","float");u.uniforms.add("pixelToNDC","vec2");u.uniforms.add("ndcToPixel","vec2");u.uniforms.add("pixelRatio","float");x.attributes.add(n.VertexAttribute.POSITION0,"vec3");x.attributes.add(n.VertexAttribute.POSITION1,"vec3");x.attributes.add(n.VertexAttribute.VARIANTOFFSET,
"float");x.attributes.add(n.VertexAttribute.VARIANTSTROKE,"float");x.attributes.add(n.VertexAttribute.VARIANTEXTENSION,"float");u.code.add(h.glsl`const float opaqueCutoff = 1.0 / 255.0;
void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
vec2 sideness = unpackedAttributes.sideness;
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;
vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
vViewPos = viewPos;
vec4 projPosV0 = projFromViewPosition(viewPosV0);
vec4 projPosV1 = projFromViewPosition(viewPosV1);
vec4 projPos = projFromViewPosition(viewPos);
vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
float lineLengthPixels = length(screenSpaceLinePixels);
float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;
float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;
float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;
vSizeFalloffFactor = falloffFactor;
float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;
#ifdef ANTIALIASING
const float aaPaddingPixels = 1.0;
float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;
#else
float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;
#endif
vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;
vec2 ndcOffset = (
screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
+ perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
);
projPos.xy += ndcOffset * projPos.w;
projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;
projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));
float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;
float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;
vPosition = vec3(
halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
pixelPositionAlongLine,
pixelPositionAlongLine / extendedLineLengthPixels
);
vRadius = lineWidthPixels * 0.5;
vLineLengthPixels = extendedLineLengthPixels;
discardShortEdges(unpackedAttributes, lineLengthPixels);
gl_Position = projPos;
}
void main() {
ComponentData component = readComponentData();
UnpackedAttributes unpackedAttributes = unpackAttributes(component);
vec3 worldPosV0 = worldFromModelPosition(position0);
vec3 worldPosV1 = worldFromModelPosition(position1);
vec3 viewPosV0 = viewFromModelPosition(position0);
vec3 viewPosV1 = viewFromModelPosition(position1);
vColor = component.color;
if (vColor.a < opaqueCutoff) {
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return;
}
if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
return;
}
calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);
calculateStyleOutputs(unpackedAttributes);
}`);r.multipassTerrainEnabled&&(x.fragment.include(c.ReadLinearDepth),x.include(g.multipassTerrainTest,r));x.fragment.code.add(h.glsl`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float lineOffset = calculateLineOffset();
      float positionX = position.x - lineOffset;

      if (radius < 1.0) {
        // Handle this specifically for subpixel sizes:
        // 1. Compute correct coverage (note coverage is computed by
        //    0.5 - dist, so we make sure that that will lead to correct
        //    subpixel coverage
        // 2. Ignore rounded caps
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);

        float coverage = min(coverageX, coverageY);

        return vec2(0.5 - coverage, 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${r.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      float alpha = vColor.a * coverage;

      gl_FragColor = vec4(vColor.rgb, alpha);

    }
  `);return x}const t=Object.freeze({__proto__:null,build:q});a.EdgeShaderProgram=t;a.build=q})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl":function(){define(["exports","../../../core/shaderLibrary/attributes/VertexPosition.glsl","../../../core/shaderLibrary/util/IsNaN.glsl","../../../core/shaderModules/interfaces"],function(a,b,c,g){a.AdjustProjectedPosition=function(h,w){h.vertex.include(c.IsNaN);h.include(b.VertexPosition,w);h=h.vertex;h.uniforms.add("depthBias",
"vec2");h.uniforms.add("inverseViewport","vec2");w.legacy?(h.uniforms.add("view","mat4"),h.uniforms.add("proj","mat4")):h.uniforms.add("transformNormalViewFromGlobal","mat3");w.legacy?h.code.add(g.glsl`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
float offsetZ  = depthBias.y;
vec4 projNormal = proj * view * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`):h.code.add(g.glsl`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
float offsetZ  = depthBias.y;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`);h.code.add(g.glsl`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/IsNaN.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.IsNaN=function(c){const g=b.glsl`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;c.code.add(g)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,b){a.DiscardByCoverage=function(c,g){c=c.fragment;c.constants.add("coverageTestThreshold","float",.01);g.antialiasing?c.code.add(b.glsl`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):c.code.add(b.glsl`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,b){a.DiscardNonSilhouetteEdges=function(c,g){c=c.vertex;g.silhouette?(c.code.add(b.glsl`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),g.legacy?c.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):c.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):c.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardShortEdges.glsl":function(){define(["exports","../../../core/shaderModules/interfaces","./EdgeUtil.glsl"],function(a,b,c){a.DiscardShortEdges=function(g,h){g=g.vertex;switch(h.mode){case c.EdgeUtilMode.SKETCH:g.code.add(b.glsl`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);
break;case c.EdgeUtilMode.MIXED:g.code.add(b.glsl`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case c.EdgeUtilMode.SOLID:g.code.add(b.glsl`#define discardShortEdges(unpackedAttributes, lineLengthPixels) {}`)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl":function(){define(["exports",
"../../../core/shaderLibrary/util/DoublePrecision.glsl","../../../core/shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c,g){a.EdgeUtilMode=void 0;(function(h){h[h.SOLID=0]="SOLID";h[h.SKETCH=1]="SKETCH";h[h.MIXED=2]="MIXED";h[h.COUNT=3]="COUNT"})(a.EdgeUtilMode||(a.EdgeUtilMode={}));a.EdgeUtil=function(h,w){const n=h.vertex;n.uniforms.add("distanceFalloffFactor","float");n.code.add(c.glsl`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`);n.uniforms.add("componentDataTex","sampler2D");n.uniforms.add("componentDataTexInvDim","vec2");h.attributes.add(g.VertexAttribute.COMPONENTINDEX,"float");n.constants.add("componentColorFieldOffset","float",0);n.constants.add("componentOtherFieldOffset","float",1);n.constants.add("componentFieldCount","float",2);n.constants.add("lineWidthFractionFactor","float",8);n.constants.add("extensionLengthOffset","float",128);n.constants.add("componentTexWidth","float",4096);n.code.add(c.glsl`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float rowIndex = floor(fieldIndex / componentTexWidth);
float colIndex = mod(fieldIndex, componentTexWidth);
vec2 linearIndex = vec2(
(colIndex + 0.5) / componentTexWidth,
(rowIndex + 0.5) * componentDataTexInvDim.y
);
return linearIndex;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec4 colorValue = texture2D(componentDataTex, colorIndex);
vec4 otherValue = texture2D(componentDataTex, otherIndex);
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5
);
}`);w.legacy?n.code.add(c.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (view * model * vec4(normal, 0.0)).xyz;
}`):(n.uniforms.add("transformNormalGlobalFromModel","mat3"),n.code.add(c.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`));w.silhouette?(h.attributes.add(g.VertexAttribute.NORMALA,"vec3"),h.attributes.add(g.VertexAttribute.NORMALB,"vec3"),n.code.add(c.glsl`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(h.attributes.add(g.VertexAttribute.NORMAL,"vec3"),n.code.add(c.glsl`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`));w.legacy?n.code.add(c.glsl`vec3 worldFromModelPosition(vec3 position) {
return (model * vec4(position, 1.0)).xyz;
}
vec3 viewFromModelPosition(vec3 position) {
return (view * vec4(worldFromModelPosition(position), 1.0)).xyz;
}
vec4 projFromViewPosition(vec3 position) {
return proj * vec4(position, 1.0);
}`):(h.vertex.include(b.DoublePrecision,w),n.code.add(c.glsl`vec3 worldFromModelPosition(vec3 position) {
vec3 rotatedModelPosition = transformWorldFromModelRS * position;
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}
vec3 viewFromModelPosition(vec3 position) {
return transformViewFromCameraRelativeRS * worldFromModelPosition(position);
}
vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`));n.code.add(c.glsl`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)};a.usesSketchLogic=function(h){return h.mode===a.EdgeUtilMode.SKETCH||h.mode===a.EdgeUtilMode.MIXED};a.usesSolidLogic=function(h){return h.mode===a.EdgeUtilMode.SOLID||h.mode===a.EdgeUtilMode.MIXED};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl":function(){define(["exports","../../../core/shaderModules/interfaces","./EdgeUtil.glsl","./UnpackAttributes.glsl"],function(a,b,c,g){a.LineAmplitude=function(h,w){const n=
h.vertex;h.include(g.UnpackAttributes,w);c.usesSketchLogic(w)&&n.uniforms.add("strokesAmplitude","float");switch(w.mode){case c.EdgeUtilMode.SOLID:n.code.add(b.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case c.EdgeUtilMode.SKETCH:n.code.add(b.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case c.EdgeUtilMode.MIXED:n.code.add(b.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../../core/shaderModules/interfaces","../../../lib/VertexAttribute","./EdgeUtil.glsl"],function(a,b,c,g,h){a.UnpackAttributes=function(w,n){const f=w.vertex;w.include(h.EdgeUtil,n);w.attributes.add(g.VertexAttribute.SIDENESS,"vec2");n.mode===h.EdgeUtilMode.MIXED?f.code.add(c.glsl`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):f.code.add(c.glsl`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`);switch(n.mode){case h.EdgeUtilMode.MIXED:f.code.add(c.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case h.EdgeUtilMode.SKETCH:f.code.add(c.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case h.EdgeUtilMode.SOLID:f.code.add(c.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case h.EdgeUtilMode.COUNT:break;default:b.neverReached(n.mode)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl":function(){define(["exports","../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl","../../../core/shaderModules/interfaces","./EdgeUtil.glsl","./UnpackAttributes.glsl"],function(a,b,c,g,h){a.LineOffset=function(w,n){const f=w.vertex;w.include(h.UnpackAttributes,n);const l=w.fragment;g.usesSketchLogic(n)&&
(f.uniforms.add("strokesTextureScale","vec2"),f.uniforms.add("strokesLog2Resolution","float"),f.uniforms.add("strokeVariants","float"),w.varyings.add("vStrokeUV","vec2"),l.uniforms.add("strokesTexture","sampler2D"),l.uniforms.add("strokesNormalizationScale","float"),f.code.add(c.glsl`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * strokesTextureScale;
vStrokeUV.x += variantOffset;
}`),w.fragment.include(b.RgbaFloatEncoding),l.code.add(c.glsl`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`));switch(n.mode){case g.EdgeUtilMode.SOLID:f.code.add(c.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`);l.code.add(c.glsl`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case g.EdgeUtilMode.SKETCH:f.code.add(c.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`);l.code.add(c.glsl`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case g.EdgeUtilMode.MIXED:w.varyings.add("vType","float"),f.code.add(c.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),l.code.add(c.glsl`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeWorkerHandle":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/typedArrayUtil","../../../../../core/workers/WorkerHandle","../../../support/buffer/workerHelper","./EdgeProcessingWorker"],function(a,b,c,g,h){return function(w){function n(l){return w.call(this,"EdgeProcessingWorker","wrappedWork",l)||this}a._inheritsLoose(n,w);var f=n.prototype;f.process=
function(){var l=a._asyncToGenerator(function*(k,e,d){if(d)return h.work(k);k=this._packInput(k);e=yield this.invoke(k,e);return this._unpackOutput(e)});return function(k,e,d){return l.apply(this,arguments)}}();f.getTransferList=function(l){return[l.dataBuffer]};f._packInput=function(l){return{dataBuffer:l.data.buffer,writerSettings:l.writerSettings,skipDeduplicate:l.skipDeduplicate,indicesBuffer:l.indices.buffer,indicesType:b.isUint32Array(l.indices)?"Uint32Array":"Uint16Array",indicesLength:l.indicesLength}};
f._unpackOutput=function(l){return{regular:{instancesData:g.unpackInterleavedBuffer(l.regular.instancesData),lodInfo:{lengths:new Float32Array(l.regular.lodInfo.lengths)}},silhouette:{instancesData:g.unpackInterleavedBuffer(l.silhouette.instancesData),lodInfo:{lengths:new Float32Array(l.silhouette.lodInfo.lengths)}},averageEdgeLength:l.averageEdgeLength}};return n}(c.WorkerHandle)})},"esri/views/3d/support/buffer/workerHelper":function(){define(["exports","../../../../geometry/support/buffer/BufferView",
"./InterleavedLayout"],function(a,b,c){function g(n){const f=[];n.fields.forEach((l,k)=>{var e=l.constructor;f.push([k,{...l,constructor:`${e.ElementType}_${e.ElementCount}`}])});return{stride:n.stride,fields:f,fieldNames:n.fieldNames}}function h(n){const f=c.newLayout();f.stride=n.stride;f.fieldNames=n.fieldNames;n.fields.forEach(l=>f.fields.set(l[0],{...l[1],constructor:w.get(l[1].constructor)}));return f}b=[b.BufferViewFloat,b.BufferViewVec2f,b.BufferViewVec3f,b.BufferViewVec4f,b.BufferViewMat3f,
b.BufferViewMat4f,b.BufferViewFloat64,b.BufferViewVec2f64,b.BufferViewVec3f64,b.BufferViewVec4f64,b.BufferViewMat3f64,b.BufferViewMat4f64,b.BufferViewUint8,b.BufferViewVec2u8,b.BufferViewVec3u8,b.BufferViewVec4u8,b.BufferViewUint16,b.BufferViewVec2u16,b.BufferViewVec3u16,b.BufferViewVec4u16,b.BufferViewUint32,b.BufferViewVec2u32,b.BufferViewVec3u32,b.BufferViewVec4u32,b.BufferViewInt8,b.BufferViewVec2i8,b.BufferViewVec3i8,b.BufferViewVec4i8,b.BufferViewInt16,b.BufferViewVec2i16,b.BufferViewVec3i16,
b.BufferViewVec4i16,b.BufferViewInt32,b.BufferViewVec2i32,b.BufferViewVec3i32,b.BufferViewVec4i32];const w=new Map;b.forEach(n=>w.set(`${n.ElementType}_${n.ElementCount}`,n));a.packInterleavedBuffer=function(n,f){f.push(n.buffer);return{buffer:n.buffer,layout:g(n.layout)}};a.packLayout=g;a.unpackInterleavedBuffer=function(n){return h(n.layout).createView(n.buffer)};a.unpackLayout=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../geometry/support/meshUtils/deduplicate ../../../support/meshProcessing ../../../support/buffer/workerHelper ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing".split(" "),
function(a,b,c,g,h,w,n,f){function l(){l=b._asyncToGenerator(function*(m){var z={data:w.EdgeInputBufferLayout.createView(m.dataBuffer),indices:"Uint32Array"===m.indicesType?new Uint32Array(m.indicesBuffer):"Uint16Array"===m.indicesType?new Uint16Array(m.indicesBuffer):void 0,indicesLength:m.indicesLength,writerSettings:m.writerSettings,skipDeduplicate:m.skipDeduplicate};m=k(z);z=[z.data.buffer];z.push(m.regular.lodInfo.lengths.buffer);z.push(m.silhouette.lodInfo.lengths.buffer);return{result:{regular:{instancesData:h.packInterleavedBuffer(m.regular.instancesData,
z),lodInfo:{lengths:m.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:h.packInterleavedBuffer(m.silhouette.instancesData,z),lodInfo:{lengths:m.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:m.averageEdgeLength},transferList:z}});return l.apply(this,arguments)}function k(m){var z=m.data,v=m.indices;var q=m.indicesLength;if(m.skipDeduplicate){const t=g.computeNeighbors(v,q,z.count);q={faces:v,facesLength:q,neighbors:t,vertices:z}}else z=c.deduplicate(z.buffer,z.stride/4,{originalIndices:v,
originalIndicesLength:q}),q=g.computeNeighbors(z.indices,q,z.uniqueCount),q={faces:z.indices,facesLength:z.indices.length,neighbors:q,vertices:w.EdgeInputBufferLayout.createView(z.buffer)};e.updateSettings(m.writerSettings);d.updateSettings(m.writerSettings);return f.extractEdges(q,e,d)}const e=new n.RegularEdgeBufferWriter,d=new n.SilhouetteEdgeBufferWriter;a.work=k;a.wrappedWork=function(m){return l.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/meshProcessing":function(){define(["exports"],
function(a){a.computeNeighbors=function(b,c,g){c/=3;const h=new Uint32Array(g+1),w=new Uint32Array(g+1);var n=(q,t)=>{q<t?h[q+1]++:w[t+1]++};for(var f=0;f<c;f++){var l=b[3*f],k=b[3*f+1],e=b[3*f+2];n(l,k);n(k,e);n(e,l)}f=n=0;for(l=0;l<g;l++)k=h[l+1],e=w[l+1],h[l+1]=n,w[l+1]=f,n+=k,f+=e;const d=new Uint32Array(6*c),m=h[g];n=(q,t,r)=>{q<t?(q=h[q+1]++,d[2*q]=t,d[2*q+1]=r):(t=w[t+1]++,d[2*m+2*t]=q,d[2*m+2*t+1]=r)};for(f=0;f<c;f++)l=b[3*f],k=b[3*f+1],e=b[3*f+2],n(l,k,f),n(k,e,f),n(e,l,f);n=(q,t)=>{const r=
2*q;q=t-q;for(t=1;t<q;t++){const x=d[r+2*t],u=d[r+2*t+1];let E=t-1;for(E;0<=E&&d[r+2*E]>x;E--)d[r+2*E+2]=d[r+2*E],d[r+2*E+3]=d[r+2*E+1];d[r+2*E+2]=x;d[r+2*E+3]=u}};for(f=0;f<g;f++)n(h[f],h[f+1]),n(m+w[f],m+w[f+1]);const z=new Int32Array(3*c),v=(q,t)=>q===b[3*t]?0:q===b[3*t+1]?1:q===b[3*t+2]?2:-1;c=(q,t)=>{q=v(q,t);z[3*t+q]=-1};n=(q,t,r,x)=>{q=v(q,t);z[3*t+q]=x;r=v(r,x);z[3*x+r]=t};for(f=0;f<g;f++){l=h[f];k=h[f+1];e=w[f];const q=w[f+1];for(;l<k&&e<q;){const t=d[2*l],r=d[2*m+2*e];t===r?(n(f,d[2*l+1],
r,d[2*m+2*e+1]),l++,e++):t<r?(c(f,d[2*l+1]),l++):(c(r,d[2*m+2*e+1]),e++)}for(;l<k;)c(f,d[2*l+1]),l++;for(;e<q;)c(d[2*m+2*e],d[2*m+2*e+1]),e++}return z};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define("exports ../../../../../core/floatRGBA ../../../../../core/mathUtils ../../../../../core/maybe ../../../../webgl/enums ../../../../webgl/Texture".split(" "),function(a,b,c,g,h,w){function n(e,d){if(!e)return null;var m=e.length/
2;const z=.1*m;m=Array(m);let v=0;d=d===f.PRESSURE;for(let q=0;q<e.length;q+=2){const t=(e[q]+e[q+1])/2;d?m[v++]=Math.min(z,1-.5*(1-t)):m[v++]=Math.min(z,.5*t)}return m}var f;(function(e){e[e.DISTANCE=0]="DISTANCE";e[e.PRESSURE=1]="PRESSURE"})(f||(f={}));let l=function(){function e(d,m,z,v,q){this.resolution=d;this.normalizationScale=m;this.amplitude=z;this.variants=v;this.texture=q}e.prototype.dispose=function(){this.texture=g.disposeMaybe(this.texture)};return e}();const k={amplitude:8,resolution:256,
strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,
-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,
.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,
-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,
.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,
.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,
.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,
-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,
-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,
1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,
.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,
-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,
.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,
.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,
.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,
.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,
4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,
3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,
1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-7.6E-4,2.7E-4,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,
.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,
.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,
.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,
.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,
1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,
-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,
.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,
2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,
.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,
.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,
.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,
-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,
.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,
.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,
-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,
.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,
.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,
.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,
.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,
5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,
.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,
-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,
3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,
.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,
.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,
.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};a.StrokesTexture=l;a.generateStrokesTexture=function(e){const d=k.resolution;var m=d/2;const z=new Uint8Array(4*d*d),v=4*d*m;m=
k.amplitude;const q=2*m,t=4*d,r=Math.log2(d)+1,x=k.strokes.length;let u=(r-1)*x*t;for(const {distance:E,pressure:y}of k.strokes){let A=E,p=y,B=u;for(let D=0;D<r;D++){0!==D&&(A=n(A,f.DISTANCE),p=n(p,f.PRESSURE));for(let C=0;C<k.resolution;C++){const F=p?p[C%p.length]:1;b.packFloatRGBA((A?A[C%A.length]/q:0)+.5,z,B);b.packFloatRGBA(F,z,B+v);B+=4}B-=t*(x+1)}u+=t}e=new w.Texture(e,{pixelFormat:h.PixelFormat.RGBA,dataType:h.PixelType.UNSIGNED_BYTE,hasMipmap:!1,samplingMode:h.TextureSamplingMode.LINEAR,
width:d,height:d,wrapMode:h.TextureWrapMode.REPEAT},z);return new l(d,q,m,x,e)};a.rasterizeStrokes=function(){var e=k.resolution;const d=Math.log2(e)+1;var m=k.strokes.length;const z=k.amplitude,v=Math.ceil(2*z+.5);var q;for(q=0;1<=e;)q+=e,e/=2;q+=6*(d+1);m*=v;e=new Uint8ClampedArray(4*q*m);const t=4*q;e.fill(255);let r=24;for(const {distance:x,pressure:u}of k.strokes){let E=x,y=u,A=r;for(let p=0;p<d;p++){0!==p&&(E=n(E,f.DISTANCE),y=n(y,f.PRESSURE));for(let B=0;B<E.length;B++){const D=E?E[B]:0,C=
y?c.clamp(y[B],0,1):1;let F=A;for(let G=-z;G<v-z;G++){const L=255-255*c.clamp(1-(Math.abs(G-D+.5)-.5*C),0,1);e[F+0]=L;e[F+1]=L;e[F+2]=L;e[F+3]=255;F+=t}A+=4}A+=24}r+=v*t}return new ImageData(e,q,m)};a.strokesDefinition=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/util":function(){define(["exports","../../../../../core/arrayUtils","../../../../../core/maybe","./interfaces"],function(a,b,c,g){a.computeEdgeCount=function(h,w,n){const f=h.length;
w*=n.minimumEdgeLength;n=b.binaryIndexOf(h,w,!0);h=-1===n?w<h[0]?0:h.length:n;return f-h};a.determineEdgeTransparency=function(h){let w=g.Transparency.INVISIBLE;for(const {material:n}of h)if(0<n.size*n.color[3]*n.opacity){if(1>n.color[3]*n.opacity)return g.Transparency.TRANSPARENT;w=g.Transparency.OPAQUE}return w};a.determineObjectTransparency=function(h){let w=g.Transparency.INVISIBLE;for(const {material:n}of h)if(0<n.size*n.color[3]*n.opacity){switch(n.objectTransparency){case g.Transparency.TRANSPARENT:case g.Transparency.INVISIBLE:return g.Transparency.TRANSPARENT;
case g.Transparency.OPAQUE:if(1>n.opacity)return g.Transparency.TRANSPARENT}w=g.Transparency.OPAQUE}return w};a.determineRendererType=function(h){let w=null;for(const n of h)if(h=n.type,0<n.size*n.color[3])if(c.isNone(w))w=h;else if(w!==h)return"uber";return c.isSome(w)?w:"uber"};a.estimateLengthAtDistance=function(h,w,n,f){return f/h*n*2*Math.tan(.5*w)};a.fillComponenBufferIndices=function(h,w,n,f){for(let k=0;k<h.length;k++){const e=h[k].index;var l=w[k];const d=w[k+1];if(f)for(;l<d;l++)n.set(f[l],
e);else for(;l<d;l++)n.set(l,e)}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/statistics/RendererPerformanceInfo":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PerformanceSampler ../../../../core/time ../../../../core/accessorSupport/utils ../../../webgl/Measurement".split(" "),function(a,b,c,g,h,w,n){a.Statistics=void 0;(function(e){e[e.Prepare=0]="Prepare";e[e.Shadowmap=1]="Shadowmap";e[e.Lineardepth=
2]="Lineardepth";e[e.Normals=3]="Normals";e[e.SSAO=4]="SSAO";e[e.Opaque=5]="Opaque";e[e.OpaqueEdges=6]="OpaqueEdges";e[e.Transparent=7]="Transparent";e[e.TransparentEdges=8]="TransparentEdges";e[e.Hudvisibility=9]="Hudvisibility";e[e.TransparentTerrain=10]="TransparentTerrain";e[e.Atmosphere=11]="Atmosphere";e[e.Laserline=12]="Laserline";e[e.Occluded=13]="Occluded";e[e.Antialiasing=14]="Antialiasing";e[e.Highlights=15]="Highlights";e[e.HudOccluded=16]="HudOccluded";e[e.HudNotoccluded=17]="HudNotoccluded"})(a.Statistics||
(a.Statistics={}));const f="prepare;shadowmap;lineardepth;normals;ssao;opaque;opaque edges;transparent;transparent edges;hudvisibility;transparent terrain;atmosphere;laserline;occluded;antialiasing;highlights;hudOccluded;hudNotoccluded".split(";");let l=function(e){function d(){var m=e.call(this,"total")||this;m.total=0;m.frameCount=0;return m}b._inheritsLoose(d,e);return d}(g),k=function(){function e(){this._startTime=h.Milliseconds(0);this._lastSample=h.Milliseconds(0);this._enableGPUTimer=0;this.totalTime=
new l;this.gpuTime=new g("gpu",9);this.renderPassTimings=f.map(m=>new g(m))}var d=e.prototype;d.enableGPUTimer=function(){++this._enableGPUTimer;return{remove:w.once(()=>--this._enableGPUTimer)}};d.prerender=function(m){this._startTime=this._lastSample=h.Milliseconds(performance.now());this._enableGPUTimer&&(this._gpuTimer=n.startMeasurement(m))};d.advance=function(m){const z=h.Milliseconds(performance.now());this.renderPassTimings[m].record(z-this._lastSample);this._lastSample=z};d.postrender=function(){c.isSome(this._gpuTimer)&&
(this._gpuTimer.stop(z=>c.isSome(z)&&this.gpuTime.record(z),16),this._gpuTimer=null);const m=performance.now()-this._startTime;this.totalTime.record(m);this.totalTime.total+=m;this.totalTime.frameCount++};b._createClass(e,[{key:"elapsedTime",get:function(){return h.Milliseconds(performance.now()-this._startTime)}}]);return e}();a.RenderTime=l;a.RendererPerformanceInfo=k;a.performanceStatsCategories=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/Measurement":function(){define(["exports",
"../../core/maybe"],function(a,b){let c=function(){function w(f){this.timer=f;this.start=f.createQuery();f.createTimestamp(this.start)}var n=w.prototype;n.stop=function(f,l=50){this.end=this.timer.createQuery();this.timer.createTimestamp(this.end);this._checkQueryResult(f,l)};n._checkQueryResult=function(f,l){if(this.timer.resultAvailable(this.end))if(this.timer.disjoint())f(null);else{var k=this.timer.getResult(this.start),e=this.timer.getResult(this.end);f((e-k)/1E6)}else setTimeout(()=>this._checkQueryResult(f,
l),l)};return w}(),g=function(){function w(f){this.timer=f;this.query=f.createQuery();h=!0;this.timer.beginTimeElapsed(this.query)}var n=w.prototype;n.stop=function(f,l=50){this.timer.endTimeElapsed();h=!1;this._checkQueryResult(f,l)};n._checkQueryResult=function(f,l){var k=this.timer.resultAvailable(this.query);const e=this.timer.disjoint();k&&!e?(k=this.timer.getResult(this.query),f(k/1E6)):e?f(null):setTimeout(()=>this._checkQueryResult(f,l),l)};return w}(),h=!1;a.startMeasurement=function(w){w=
w.capabilities.disjointTimerQuery;return b.isNone(w)?null:0<w.timestampBits()?new c(w):h?null:new g(w)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderingContext":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../webgl/RenderingContext"],function(a,b,c){c=function(g){function h(n,f,l){n=g.call(this,n,f)||this;n.newCache=l;n._refCount=1;return n}b._inheritsLoose(h,g);var w=h.prototype;w.dispose=function(){0<--this._refCount||
g.prototype.dispose.call(this)};w.ref=function(){++this._refCount};w.useTechnique=function(n,f=null,l){this.useProgram(n.program);n.bindPipelineState(this,f,l);return n.program};w.isTechniqueCompiled=function(n){return n.program.isCompiled};b._createClass(h,[{key:"test",get:function(){return this.programCache.test}}]);return h}(c.RenderingContext);a.RenderingContext=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/RenderingContext":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/maybe ../../core/promiseUtils ../../core/time ./BufferObject ./FramebufferObject ../../core/has ./checkWebGLError ./context-util ./enums ./ShaderTranspiler ./ProgramCache ./Texture ./VertexArrayObject ./ContextState ./InstanceCounter ./renderState ./Util ./WebGLDriverTest ./capabilities/Capabilities ./capabilities/isWebGL2Context".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y){function A(B,D,C,F){D?F!==D&&B.bindBuffer(C,D.glName):B.bindBuffer(C,null);return D}function p(B,D){switch(B){case e.PrimitiveType.POINTS:return 2*D;case e.PrimitiveType.TRIANGLES:return D/3;case e.PrimitiveType.TRIANGLE_STRIP:return D-2;case e.PrimitiveType.TRIANGLE_FAN:return D-2;default:return 0}}w=function(){function B(C,F){this.gl=C;this.instanceCounter=new t.InstanceCounter;this.programCache=new m.ProgramCache(this);this._state=new q.ContextState;
this._numOfTriangles=this._numOfDrawCalls=0;this.type=y(C)?k.ContextType.WEBGL2:k.ContextType.WEBGL1;this._loadExtensions();this.configure(F)}var D=B.prototype;D.configure=function(C){this._capabilities=new E.Capabilities(this.gl,C);this._parameters=this._loadParameters(C);C=this.gl.getParameter(this.gl.VIEWPORT);this._state=new q.ContextState;this._state.viewport={x:C[0],y:C[1],width:C[2],height:C[3]};this._stateTracker=new r.StateTracker({setBlending:F=>{F?(this.setBlendingEnabled(!0),this.setBlendEquationSeparate(F.opRgb,
F.opAlpha),this.setBlendFunctionSeparate(F.srcRgb,F.dstRgb,F.srcAlpha,F.dstAlpha),F=F.color,this.setBlendColor(F.r,F.g,F.b,F.a)):this.setBlendingEnabled(!1)},setCulling:F=>{F?(this.setFaceCullingEnabled(!0),this.setCullFace(F.face),this.setFrontFace(F.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:F=>{F?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(F.factor,F.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:F=>{F?(this.setDepthTestEnabled(!0),this.setDepthFunction(F.func)):
this.setDepthTestEnabled(!1)},setStencilTest:F=>{if(F){this.setStencilTestEnabled(!0);const G=F.function;this.setStencilFunction(G.func,G.ref,G.mask);F=F.operation;this.setStencilOp(F.fail,F.zFail,F.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:F=>{F?(this.setDepthWriteEnabled(!0),this.setDepthRange(F.zNear,F.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:F=>{F?this.setColorMask(F.r,F.g,F.b,F.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:F=>{F?this.setStencilWriteMask(F.mask):
this.setStencilWriteMask(0)}});this.enforceState();this._driverTest=new u.WebGLDriverTest(this)};D.dispose=function(){this.programCache.dispose();this.bindVAO(null);this.unbindBuffer(e.BufferType.ARRAY_BUFFER);this.unbindBuffer(e.BufferType.ELEMENT_ARRAY_BUFFER);y(this.gl)&&(this.unbindBuffer(e.BufferType.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(e.BufferType.PIXEL_PACK_BUFFER),this.unbindBuffer(e.BufferType.PIXEL_UNPACK_BUFFER),this.unbindBuffer(e.BufferType.COPY_READ_BUFFER),
this.unbindBuffer(e.BufferType.COPY_WRITE_BUFFER));this._state.textureUnitMap.length=0;l.webglDebugEnabled()&&this.instanceCounter.printResourceCount()};D.setPipelineState=function(C){this._stateTracker.setPipeline(C)};D.setBlendingEnabled=function(C){this._state.blend!==C&&(!0===C?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=C,this._stateTracker.invalidateBlending())};D.externalProgramUpdate=function(){var C;null==(C=this._state.program)?void 0:C.stop();this._state.program=
null};D.externalTextureUnitUpdate=function(C,F){for(let G=0;G<C.length;++G)this._state.textureUnitMap[C[G]]=null;0<=F&&(this._state.activeTexture=F)};D.externalVertexArrayObjectUpdate=function(){const C=this.capabilities.vao;C&&(C.bindVertexArray(null),this._state.vertexArrayObject=null);this._state.vertexBuffer=null;this._state.indexBuffer=null};D.externalVertexBufferUpdate=function(){this._state.vertexBuffer=null};D.externalIndexBufferUpdate=function(){this._state.indexBuffer=null};D.setBlendColor=
function(C,F,G,L){if(C!==this._state.blendColor.r||F!==this._state.blendColor.g||G!==this._state.blendColor.b||L!==this._state.blendColor.a)this.gl.blendColor(C,F,G,L),this._state.blendColor.r=C,this._state.blendColor.g=F,this._state.blendColor.b=G,this._state.blendColor.a=L,this._stateTracker.invalidateBlending()};D.setBlendFunction=function(C,F){if(C!==this._state.blendFunction.srcRGB||F!==this._state.blendFunction.dstRGB)this.gl.blendFunc(C,F),this._state.blendFunction.srcRGB=C,this._state.blendFunction.srcAlpha=
C,this._state.blendFunction.dstRGB=F,this._state.blendFunction.dstAlpha=F,this._stateTracker.invalidateBlending()};D.setBlendFunctionSeparate=function(C,F,G,L){if(this._state.blendFunction.srcRGB!==C||this._state.blendFunction.srcAlpha!==G||this._state.blendFunction.dstRGB!==F||this._state.blendFunction.dstAlpha!==L)this.gl.blendFuncSeparate(C,F,G,L),this._state.blendFunction.srcRGB=C,this._state.blendFunction.srcAlpha=G,this._state.blendFunction.dstRGB=F,this._state.blendFunction.dstAlpha=L,this._stateTracker.invalidateBlending()};
D.setBlendEquation=function(C){this._state.blendEquation.mode!==C&&(this.gl.blendEquation(C),this._state.blendEquation.mode=C,this._state.blendEquation.modeAlpha=C,this._stateTracker.invalidateBlending())};D.setBlendEquationSeparate=function(C,F){if(this._state.blendEquation.mode!==C||this._state.blendEquation.modeAlpha!==F)this.gl.blendEquationSeparate(C,F),this._state.blendEquation.mode=C,this._state.blendEquation.modeAlpha=F,this._stateTracker.invalidateBlending()};D.setColorMask=function(C,F,
G,L){if(this._state.colorMask.r!==C||this._state.colorMask.g!==F||this._state.colorMask.b!==G||this._state.colorMask.a!==L)this.gl.colorMask(C,F,G,L),this._state.colorMask.r=C,this._state.colorMask.g=F,this._state.colorMask.b=G,this._state.colorMask.a=L,this._stateTracker.invalidateColorWrite()};D.setClearColor=function(C,F,G,L){if(this._state.clearColor.r!==C||this._state.clearColor.g!==F||this._state.clearColor.b!==G||this._state.clearColor.a!==L)this.gl.clearColor(C,F,G,L),this._state.clearColor.r=
C,this._state.clearColor.g=F,this._state.clearColor.b=G,this._state.clearColor.a=L};D.setFaceCullingEnabled=function(C){this._state.faceCulling!==C&&(!0===C?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=C,this._stateTracker.invalidateCulling())};D.setPolygonOffsetFillEnabled=function(C){this._state.polygonOffsetFill!==C&&(!0===C?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=C,this._stateTracker.invalidatePolygonOffset())};
D.setPolygonOffset=function(C,F){if(this._state.polygonOffset[0]!==C||this._state.polygonOffset[1]!==F)this._state.polygonOffset[0]=C,this._state.polygonOffset[1]=F,this.gl.polygonOffset(C,F),this._stateTracker.invalidatePolygonOffset()};D.setCullFace=function(C){this._state.cullFace!==C&&(this.gl.cullFace(C),this._state.cullFace=C,this._stateTracker.invalidateCulling())};D.setFrontFace=function(C){this._state.frontFace!==C&&(this.gl.frontFace(C),this._state.frontFace=C,this._stateTracker.invalidateCulling())};
D.setScissorTestEnabled=function(C){this._state.scissorTest!==C&&(!0===C?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=C)};D.setScissorRect=function(C,F,G,L){if(this._state.scissorRect.x!==C||this._state.scissorRect.y!==F||this._state.scissorRect.width!==G||this._state.scissorRect.height!==L)this.gl.scissor(C,F,G,L),this._state.scissorRect.x=C,this._state.scissorRect.y=F,this._state.scissorRect.width=G,this._state.scissorRect.height=L};D.setDepthTestEnabled=
function(C){this._state.depthTest!==C&&(!0===C?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=C,this._stateTracker.invalidateDepthTest())};D.setClearDepth=function(C){this._state.clearDepth!==C&&(this.gl.clearDepth(C),this._state.clearDepth=C)};D.setDepthFunction=function(C){this._state.depthFunction!==C&&(this.gl.depthFunc(C),this._state.depthFunction=C,this._stateTracker.invalidateDepthTest())};D.setDepthWriteEnabled=function(C){this._state.depthWrite!==
C&&(this.gl.depthMask(C),this._state.depthWrite=C,this._stateTracker.invalidateDepthWrite())};D.setDepthRange=function(C,F){if(this._state.depthRange.zNear!==C||this._state.depthRange.zFar!==F)this.gl.depthRange(C,F),this._state.depthRange.zNear=C,this._state.depthRange.zFar=F,this._stateTracker.invalidateDepthWrite()};D.setStencilTestEnabled=function(C){this._state.stencilTest!==C&&(!0===C?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=C,this._stateTracker.invalidateStencilTest())};
D.setClearStencil=function(C){C!==this._state.clearStencil&&(this.gl.clearStencil(C),this._state.clearStencil=C)};D.setStencilFunction=function(C,F,G){if(this._state.stencilFunction.func!==C||this._state.stencilFunction.ref!==F||this._state.stencilFunction.mask!==G)this.gl.stencilFunc(C,F,G),this._state.stencilFunction.face=e.Face.FRONT_AND_BACK,this._state.stencilFunction.func=C,this._state.stencilFunction.ref=F,this._state.stencilFunction.mask=G,this._stateTracker.invalidateStencilTest()};D.setStencilFunctionSeparate=
function(C,F,G,L){if(this._state.stencilFunction.face!==C||this._state.stencilFunction.func!==F||this._state.stencilFunction.ref!==G||this._state.stencilFunction.mask!==L)this.gl.stencilFuncSeparate(C,F,G,L),this._state.stencilFunction.face=C,this._state.stencilFunction.func=F,this._state.stencilFunction.ref=G,this._state.stencilFunction.mask=L,this._stateTracker.invalidateStencilTest()};D.setStencilWriteMask=function(C){this._state.stencilWriteMask!==C&&(this.gl.stencilMask(C),this._state.stencilWriteMask=
C,this._stateTracker.invalidateStencilWrite())};D.setStencilOp=function(C,F,G){if(this._state.stencilOperation.face!==e.Face.FRONT_AND_BACK||this._state.stencilOperation.fail!==C||this._state.stencilOperation.zFail!==F||this._state.stencilOperation.zPass!==G)this.gl.stencilOp(C,F,G),this._state.stencilOperation.face=e.Face.FRONT_AND_BACK,this._state.stencilOperation.fail=C,this._state.stencilOperation.zFail=F,this._state.stencilOperation.zPass=G,this._stateTracker.invalidateStencilTest()};D.setStencilOpSeparate=
function(C,F,G,L){if(this._state.stencilOperation.face!==C||this._state.stencilOperation.fail!==F||this._state.stencilOperation.zFail!==G||this._state.stencilOperation.zPass!==L)this.gl.stencilOpSeparate(C,F,G,L),this._state.stencilOperation.face=C,this._state.stencilOperation.fail=F,this._state.stencilOperation.zFail=G,this._state.stencilOperation.zPass=L,this._stateTracker.invalidateStencilTest()};D.setActiveTexture=function(C,F=!1){const G=this._state.activeTexture;0<=C&&(F||C!==this._state.activeTexture)&&
(this.gl.activeTexture(e.BASE_TEXTURE_UNIT+C),this._state.activeTexture=C);return G};D.clear=function(C){C&&this.gl.clear(C)};D.clearSafe=function(C,F=255){C&&(C&e.ClearBufferBit.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),C&e.ClearBufferBit.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),C&e.ClearBufferBit.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(F),this.gl.clear(C))};D.drawArrays=function(C,F,G){l.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=p(C,G));this.gl.drawArrays(C,
F,G);l.webglDebugEnabled()&&(C=x.getErrorString(this))&&console.error("drawArrays:",C)};D.drawElements=function(C,F,G,L){l.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=p(C,F));this.gl.drawElements(C,F,G,L);if(l.webglDebugEnabled()){const I=x.getErrorString(this);if(I){var H,M=this.getBoundVAO(),K=null==M?void 0:M.indexBuffer;M={indexBuffer:K,vertexBuffers:null==M?void 0:M.vertexBuffers};C={mode:C,count:F,type:G,offset:L};K=null!=(H=c.applySome(K,O=>O.size))?H:0;F=L+F;console.error(`drawElements: ${I}${K<
F?`. Buffer is too small. Attempted to draw index ${F} of ${K}`:""}`,{args:C,vao:M})}}};D.logIno=function(){l.webglDebugEnabled()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)};D.setViewport=function(C,F,G,L){G=Math.max(Math.round(G),1);L=Math.max(Math.round(L),1);const H=this._state.viewport;if(H.x!==C||H.y!==F||H.width!==G||H.height!==L)H.x=C,H.y=F,H.width=G,H.height=L,this.gl.viewport(C,F,G,L)};D.getViewport=function(){return{x:this._state.viewport.x,y:this._state.viewport.y,
width:this._state.viewport.width,height:this._state.viewport.height}};D.useProgram=function(C){var F,G;this._state.program!==C&&(null==(F=this._state.program)?void 0:F.stop(),this._state.program=C,this.gl.useProgram(null!=(G=null==C?void 0:C.glName)?G:null))};D.bindTexture=function(C,F,G=!1){(F>=this.parameters.maxTextureImageUnits||0>F)&&console.error("Input texture unit is out of range of available units!");const L=this._state.textureUnitMap[F];if(c.isNone(C)||null==C.glName)return c.isSome(L)&&
(this.setActiveTexture(F,G),this.gl.bindTexture(L.descriptor.target,null)),this._state.textureUnitMap[F]=null,L;if(!G&&L===C)return C.isDirty&&(this.setActiveTexture(F,G),C.applyChanges()),L;this.setActiveTexture(F,G);this.gl.bindTexture(C.descriptor.target,C.glName);C.applyChanges();this._state.textureUnitMap[F]=C;return L};D.unbindTextureAllUnits=function(C){for(let F=0;F<this.parameters.maxTextureImageUnits;F++)this._state.textureUnitMap[F]===C&&(this.bindTexture(null,F),this._state.textureUnitMap[F]=
null)};D.bindFramebuffer=function(C,F=!1){if(F||this._state.readFramebuffer!==C||this._state.drawFramebuffer!==C)c.isNone(C)?(this.gl.bindFramebuffer(e.FramebufferTarget.FRAMEBUFFER,null),this._state.readFramebuffer=null,this._state.drawFramebuffer=null):(C.initializeAndBind(e.FramebufferTarget.FRAMEBUFFER),this._state.readFramebuffer=C,this._state.drawFramebuffer=C)};D.bindFramebufferSeparate=function(C,F,G=!1){const L=F===e.FramebufferTarget.READ_FRAMEBUFFER,H=L?this._state.readFramebuffer:this._state.drawFramebuffer;
if(G||H!==C)c.isNone(C)?this.gl.bindFramebuffer(F,null):C.initializeAndBind(F),L?this._state.readFramebuffer=c.unwrapOr(C,null):this._state.drawFramebuffer=c.unwrapOr(C,null)};D.blitFramebuffer=function(C,F,G=0,L=0,H=C.width,M=C.height,K=0,I=0,O=F.width,Q=F.height,J=e.ClearBufferBit.COLOR_BUFFER_BIT,P=e.TextureSamplingMode.NEAREST){this.bindFramebufferSeparate(C,e.FramebufferTarget.READ_FRAMEBUFFER);this.bindFramebufferSeparate(F,e.FramebufferTarget.DRAW_FRAMEBUFFER);this.gl.blitFramebuffer(G,L,H,
M,K,I,O,Q,J,P)};D.bindBuffer=function(C,F){if(C){var G;null!=(G=F)?G:F=C.bufferType;switch(F){case e.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=A(this.gl,C,F,this._state.vertexBuffer);break;case e.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=A(this.gl,C,F,this._state.indexBuffer);break;case e.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=A(this.gl,C,F,this._state.uniformBuffer);break;case e.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=A(this.gl,C,F,this._state.pixelPackBuffer);
break;case e.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=A(this.gl,C,F,this._state.pixelUnpackBuffer);break;case e.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=A(this.gl,C,F,this._state.copyReadBuffer);break;case e.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=A(this.gl,C,F,this._state.copyWriteBuffer)}}};D.bindRenderbuffer=function(C){const F=this.gl;C||(F.bindRenderbuffer(F.RENDERBUFFER,null),this._state.renderbuffer=null);this._state.renderbuffer!==C&&(F.bindRenderbuffer(F.RENDERBUFFER,
C.glName),this._state.renderbuffer=C)};D._getBufferBinding=function(C,F){if(F>=this.parameters.maxUniformBufferBindings||0>F)return console.error("Uniform buffer binding point is out of range!"),null;C=this._state.uniformBufferBindingPoints;let G=C[F];c.isNone(G)&&(G={buffer:null,offset:0,size:0},C[F]=G);return G};D.bindBufferBase=function(C,F,G){const L=this._getBufferBinding(C,F);c.isNone(L)||L.buffer===G&&0===L.offset&&0===L.size||(this.gl.bindBufferBase(C,F,G?G.glName:null),L.buffer=G,L.offset=
0,L.size=0)};D.bindBufferRange=function(C,F,G,L,H){const M=this._getBufferBinding(C,F);c.isNone(M)||M.buffer===G&&M.offset===L&&M.size===H||(0!==L%this._parameters.uniformBufferOffsetAlignment?console.error("Uniform buffer binding offset is not a multiple of the context offset alignment"):(this.gl.bindBufferRange(C,F,G.glName,L,H),M.buffer=G,M.offset=L,M.size=H))};D.bindUBO=function(C,F,G,L){c.isNone(F)?this.bindBufferBase(e.BufferType.UNIFORM_BUFFER,C,null):(l.webglDebugEnabled()&&(null!=L?L:F.byteLength)>
this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),F.initialize(),void 0!==G&&void 0!==L?this.bindBufferRange(e.BufferType.UNIFORM_BUFFER,C,F.buffer,G,L):this.bindBufferBase(e.BufferType.UNIFORM_BUFFER,C,F.buffer))};D.unbindUBO=function(C){for(let F=0,G=this._state.uniformBufferBindingPoints.length;F<G;F++){const L=this._state.uniformBufferBindingPoints[F];c.isSome(L)&&L.buffer===C.buffer&&this.bindBufferBase(e.BufferType.UNIFORM_BUFFER,
F,null)}};D.unbindBuffer=function(C){switch(C){case e.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=A(this.gl,null,C,this._state.vertexBuffer);break;case e.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=A(this.gl,null,C,this._state.indexBuffer);break;case e.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=A(this.gl,null,C,this._state.uniformBuffer);break;case e.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=A(this.gl,null,C,this._state.pixelPackBuffer);break;case e.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=
A(this.gl,null,C,this._state.pixelUnpackBuffer);break;case e.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=A(this.gl,null,C,this._state.copyReadBuffer);break;case e.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=A(this.gl,null,C,this._state.copyWriteBuffer)}};D.bindVAO=function(C=null){c.isNone(C)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==C&&(C.bind(),this._state.vertexArrayObject=C)};
D.clientWaitAsync=function(){var C=b._asyncToGenerator(function*(F=h.Milliseconds(10)){const G={};this.instanceCounter.increment(e.ResourceType.Sync,G);const L=this.gl,H=L.fenceSync(e.SyncCondition.SYNC_GPU_COMMANDS_COMPLETE,0);L.flush();let M;do yield g.after(F),M=L.clientWaitSync(H,0,0);while(M===e.ClientWaitSyncStatus.TIMEOUT_EXPIRED);L.deleteSync(H);this.instanceCounter.decrement(e.ResourceType.Sync,G);if(M===e.ClientWaitSyncStatus.WAIT_FAILED)throw Error("Client wait failed");});return function(){return C.apply(this,
arguments)}}();D.getBoundFramebufferObject=function(C=e.FramebufferTarget.FRAMEBUFFER){return C===e.FramebufferTarget.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer};D.getBoundVAO=function(){return this._state.vertexArrayObject};D.resetState=function(){this.useProgram(null);this.bindVAO(null);this.bindFramebuffer(null,!0);this.unbindBuffer(e.BufferType.ARRAY_BUFFER);this.unbindBuffer(e.BufferType.ELEMENT_ARRAY_BUFFER);y(this.gl)&&(this.unbindBuffer(e.BufferType.UNIFORM_BUFFER),
this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(e.BufferType.PIXEL_PACK_BUFFER),this.unbindBuffer(e.BufferType.PIXEL_UNPACK_BUFFER),this.unbindBuffer(e.BufferType.COPY_READ_BUFFER),this.unbindBuffer(e.BufferType.COPY_WRITE_BUFFER));for(let C=0;C<this.parameters.maxTextureImageUnits;++C)this.bindTexture(null,C);this.setBlendingEnabled(!1);this.setBlendFunction(e.BlendFactor.ONE,e.BlendFactor.ZERO);this.setBlendEquation(e.BlendOperation.ADD);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);
this.setCullFace(e.Face.BACK);this.setFrontFace(e.CullMode.CCW);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(e.CompareFunction.LESS);this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(e.CompareFunction.ALWAYS,0,0);this.setStencilOp(e.StencilOperation.KEEP,e.StencilOperation.KEEP,e.StencilOperation.KEEP);
this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)};D.enforceState=function(){var C,F;const G=this.gl;var L=this.capabilities.vao;L&&L.bindVertexArray(null);for(let O=0;O<this.parameters.maxVertexAttributes;O++)G.disableVertexAttribArray(O);this._state.vertexBuffer?G.bindBuffer(this._state.vertexBuffer.bufferType,
this._state.vertexBuffer.glName):G.bindBuffer(e.BufferType.ARRAY_BUFFER,null);this._state.indexBuffer?G.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):G.bindBuffer(e.BufferType.ELEMENT_ARRAY_BUFFER,null);if(y(G)){var H,M;this._state.uniformBuffer?G.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):G.bindBuffer(e.BufferType.UNIFORM_BUFFER,null);for(var K=0;K<this._parameters.maxUniformBufferBindings;K++){var I=this._state.uniformBufferBindingPoints[K];
if(c.isSome(I)&&null!==I.buffer){const {buffer:O,offset:Q,size:J}=I;0===Q&&0===J?G.bindBufferBase(e.BufferType.UNIFORM_BUFFER,K,O.glName):G.bindBufferRange(e.BufferType.UNIFORM_BUFFER,K,O.glName,Q,J)}else G.bindBufferBase(e.BufferType.UNIFORM_BUFFER,K,null)}this._state.pixelPackBuffer?G.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):G.bindBuffer(e.BufferType.PIXEL_PACK_BUFFER,null);this._state.pixelUnpackBuffer?G.bindBuffer(this._state.pixelUnpackBuffer.bufferType,
this._state.pixelUnpackBuffer.glName):G.bindBuffer(e.BufferType.PIXEL_UNPACK_BUFFER,null);this._state.copyReadBuffer?G.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):G.bindBuffer(e.BufferType.COPY_READ_BUFFER,null);this._state.copyWriteBuffer?G.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):G.bindBuffer(e.BufferType.COPY_WRITE_BUFFER,null);G.bindFramebuffer(e.FramebufferTarget.READ_FRAMEBUFFER,null);G.readBuffer(G.BACK);this._state.readFramebuffer&&
(G.bindFramebuffer(e.FramebufferTarget.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),G.readBuffer(e.ColorAttachment.COLOR_ATTACHMENT0));G.bindFramebuffer(e.FramebufferTarget.DRAW_FRAMEBUFFER,null!=(H=null==(M=this._state.drawFramebuffer)?void 0:M.glName)?H:null)}else this._state.readFramebuffer=this._state.drawFramebuffer,G.bindFramebuffer(e.FramebufferTarget.FRAMEBUFFER,null!=(K=null==(I=this._state.drawFramebuffer)?void 0:I.glName)?K:null);if(L&&this._state.vertexArrayObject){if(L=this._state.vertexArrayObject)this._state.vertexArrayObject.unbind(),
this._state.vertexArrayObject=null;this.bindVAO(L)}G.useProgram(null!=(C=null==(F=this._state.program)?void 0:F.glName)?C:null);G.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a);G.bindRenderbuffer(G.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null);!0===this._state.blend?G.enable(this.gl.BLEND):G.disable(this.gl.BLEND);G.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha);
G.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha);G.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a);G.clearDepth(this._state.clearDepth);G.clearStencil(this._state.clearStencil);G.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a);G.cullFace(this._state.cullFace);G.depthFunc(this._state.depthFunction);
G.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar);!0===this._state.depthTest?G.enable(G.DEPTH_TEST):G.disable(G.DEPTH_TEST);G.depthMask(this._state.depthWrite);G.frontFace(this._state.frontFace);G.lineWidth(1);!0===this._state.faceCulling?G.enable(G.CULL_FACE):G.disable(G.CULL_FACE);G.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]);!0===this._state.polygonOffsetFill?G.enable(G.POLYGON_OFFSET_FILL):G.disable(G.POLYGON_OFFSET_FILL);G.scissor(this._state.scissorRect.x,
this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height);!0===this._state.scissorTest?G.enable(G.SCISSOR_TEST):G.disable(G.SCISSOR_TEST);G.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask);G.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass);!0===this._state.stencilTest?G.enable(G.STENCIL_TEST):G.disable(G.STENCIL_TEST);
G.stencilMask(this._state.stencilWriteMask);for(C=0;C<this.parameters.maxTextureImageUnits;C++)G.activeTexture(e.BASE_TEXTURE_UNIT+C),G.bindTexture(e.TextureType.TEXTURE_2D,null),G.bindTexture(e.TextureType.TEXTURE_CUBE_MAP,null),y(G)&&(G.bindTexture(e.TextureType.TEXTURE_3D,null),G.bindTexture(e.TextureType.TEXTURE_2D_ARRAY,null)),F=this._state.textureUnitMap[C],c.isSome(F)&&G.bindTexture(F.descriptor.target,F.glName);G.activeTexture(e.BASE_TEXTURE_UNIT+this._state.activeTexture);G.viewport(this._state.viewport.x,
this._state.viewport.y,this._state.viewport.width,this._state.viewport.height);l.webglDebugEnabled()&&(this._numOfTriangles=this._numOfDrawCalls=0)};D._loadExtensions=function(){this.type===k.ContextType.WEBGL1&&this.gl.getExtension("OES_element_index_uint");this.gl.getExtension("KHR_parallel_shader_compile")};D._loadParameters=function(C){var F,G=this.capabilities.textureFilterAnisotropic;C=null!=(F=C.maxAnisotropy)?F:Infinity;F=y(this.gl);const L=this.gl;G={versionString:this.gl.getParameter(this.gl.VERSION),
maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:G?Math.min(this.gl.getParameter(G.MAX_TEXTURE_MAX_ANISOTROPY),C):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:F?L.getParameter(L.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:F?L.getParameter(L.MAX_VERTEX_UNIFORM_BLOCKS):
0,maxFragmentUniformBlocks:F?L.getParameter(L.MAX_FRAGMENT_UNIFORM_BLOCKS):0,maxUniformBlockSize:F?L.getParameter(L.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:F?L.getParameter(L.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:F?L.getParameter(L.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:F?L.getParameter(L.MAX_SAMPLES):1};z.Texture.TEXTURE_UNIT_FOR_UPDATES=G.maxTextureImageUnits-1;return G};b._createClass(B,[{key:"driverTest",get:function(){return this._driverTest}},{key:"contextAttributes",
get:function(){return this.gl.getContextAttributes()}},{key:"parameters",get:function(){return this._parameters}},{key:"capabilities",get:function(){return this._capabilities}}]);return B}();a.RenderingContext=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/ShaderTranspiler":function(){define(["exports","../../core/has","../../core/maybe","./enums","./reservedWordsGLSL3"],function(a,b,c,g,h){function w(){function u(S){S.length&&K.push({type:q[G],data:S,position:Q,line:I,column:O})}
function E(){M=M.length?[]:M;if("/"===H&&"*"===L)return Q=F+C-1,G=0,H=L,C+1;if("/"===H&&"/"===L)return Q=F+C-1,G=1,H=L,C+1;if("#"===L)return G=2,Q=F+C,C;if(/\s/.test(L))return G=9,Q=F+C,C;J=/\d/.test(L);P=/[^\w_]/.test(L);Q=F+C;G=J?4:P?3:9999;return C}function y(){if(("\r"===L||"\n"===L)&&"\\"!==H)return u(M.join("")),G=999,C;M.push(L);H=L;return C+1}function A(){if("."===H&&/\d/.test(L))return G=5,C;if("/"===H&&"*"===L)return G=0,C;if("/"===H&&"/"===L)return G=1,C;if("."===L&&M.length){for(;p(M););
G=5;return C}if(";"===L||")"===L||"("===L){if(M.length)for(;p(M););u(L);G=999;return C+1}var S=2===M.length&&"\x3d"!==L;if(/[\w_\d\s]/.test(L)||S){for(;p(M););G=999;return C}M.push(L);H=L;return C+1}function p(S){var T=0;do{var V=z.indexOf(S.slice(0,S.length+T).join(""));var W=z[V];if(-1===V){if(0<T--+S.length)continue;W=S.slice(0,1).join("")}u(W);Q+=W.length;M=M.slice(W.length);return M.length}while(1)}function B(){if("."===L||/[eE]/.test(L))return M.push(L),G=5,H=L,C+1;if("x"===L&&1===M.length&&
"0"===M[0])return G=11,M.push(L),H=L,C+1;if(/[^\d]/.test(L))return u(M.join("")),G=999,C;M.push(L);H=L;return C+1}function D(){"f"===L&&(M.push(L),H=L,C+=1);if(/[eE]/.test(L)||"-"===L&&/[eE]/.test(H))return M.push(L),H=L,C+1;if(/[^\d]/.test(L))return u(M.join("")),G=999,C;M.push(L);H=L;return C+1}var C=0,F=0,G=999,L,H,M=[],K=[],I=1,O=0,Q=0,J=!1,P=!1,N="",R;return function(S){K=[];if(null!==S){S=S.replace?S.replace(/\r\n/g,"\n"):S;C=0;N+=S;for(R=N.length;L=N[C],C<R;){S=C;switch(G){case 0:"/"===L&&
"*"===H?(M.push(L),u(M.join("")),G=999):(M.push(L),H=L);C+=1;break;case 1:C=y();break;case 2:C=y();break;case 3:C=A();break;case 4:C=B();break;case 11:/[^a-fA-F0-9]/.test(L)?(u(M.join("")),G=999):(M.push(L),H=L,C+=1);break;case 5:C=D();break;case 9999:if(/[^\d\w_]/.test(L)){var T=M.join("");G=-1<m.indexOf(T)?8:-1<v.indexOf(T)?7:6;u(M.join(""));G=999}else M.push(L),H=L,C+=1;break;case 9:/[^\s]/g.test(L)?(u(M.join("")),G=999):(M.push(L),H=L,C+=1);break;case 999:C=E()}if(S!==C)switch(N[S]){case "\n":O=
0;++I;break;default:++O}}F+=C;N=N.slice(C);return K}M.length&&u(M.join(""));G=10;u("(eof)");return K}}function n(u){return u.map(E=>"eof"!==E.type?E.data:"").join("")}function f(u,E="100",y="300 es"){const A=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const p of u)if("preprocessor"===p.type){const B=A.exec(p.data);if(B){u=B[1].replace(/\s\s+/g," ");if(u===y)return u;if(u===E)return p.data="#version "+y,E;throw Error("unknown glsl version: "+u);}}u.splice(0,0,{type:"preprocessor",data:"#version "+
y},{type:"whitespace",data:"\n"});return null}function l(u,E,y,A){A=A||y;for(const p of u)if("ident"===p.type&&p.data===y)return A in E?E[A]++:E[A]=0,l(u,E,A+"_"+E[A],A);return y}function k(u,E,y="afterVersion"){const A={data:"\n",type:"whitespace"},p=D=>D<u.length?/[^\r\n]$/.test(u[D].data):!1;let B=function(D){let C=-1,F=0,G=-1;for(let H=0;H<D.length;H++){var L=D[H];"preprocessor"===L.type&&(L.data.match(/#(if|ifdef|ifndef)\s+.+/)?++F:L.data.match(/#endif\s*.*/)&&--F);("afterVersion"===y||"afterPrecision"===
y)&&"preprocessor"===L.type&&/^#version/.test(L.data)&&(G=Math.max(G,H));if("afterPrecision"===y&&"keyword"===L.type&&"precision"===L.data){a:{for(L=H;L<D.length;L++){const M=D[L];if("operator"===M.type&&";"===M.data)break a}L=null}if(null===L)throw Error("precision statement not followed by any semicolons!");G=Math.max(G,L)}C<G&&0===F&&(C=H)}return C+1}(u);p(B-1)&&u.splice(B++,0,A);for(const D of E)u.splice(B++,0,D);p(B-1)&&p(B)&&u.splice(B,0,A)}function e(u,E,y,A="lowp"){k(u,[{type:"keyword",data:"out"},
{type:"whitespace",data:" "},{type:"keyword",data:A},{type:"whitespace",data:" "},{type:"keyword",data:y},{type:"whitespace",data:" "},{type:"ident",data:E},{type:"operator",data:";"}],"afterPrecision")}function d(u,E,y,A,p="lowp"){k(u,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"\x3d"},{type:"whitespace",data:" "},{type:"integer",data:A.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},
{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:p},{type:"whitespace",data:" "},{type:"keyword",data:y},{type:"whitespace",data:" "},{type:"ident",data:E},{type:"operator",data:";"}],"afterPrecision")}b={exports:{}};(function(u){(function(E){E=E();void 0!==E&&(u.exports=E)})(function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})})(b);
const m=b.exports;b={exports:{}};(function(u){(function(E){E=E();void 0!==E&&(u.exports=E)})(function(){"use strict;";return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})})(b);const z=b.exports;b={exports:{}};(function(u){(function(E){E=E();void 0!==E&&(u.exports=E)})(function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT".split(" ")})})(b);
const v=b.exports;var q="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");const t=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"],r={enableCache:!1},x=new Map;a.test=r;a.transpileShader=function(u,E){var y=r.enableCache?x.get(u):null;if(c.isSome(y))return y;y=w();var A=[];A=A.concat(y(u));y=A=A.concat(y(null));if("300 es"===f(y,"100","300 es"))return u;var p=A=null;const B=
{},D={};for(let L=0;L<y.length;++L){const H=y[L];switch(H.type){case "keyword":E===g.ShaderType.VERTEX_SHADER&&"attribute"===H.data?H.data="in":"varying"===H.data&&(H.data=E===g.ShaderType.VERTEX_SHADER?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(H.data.trim())&&(H.data=H.data.replace(/(2D|Cube|EXT)/g,""));E===g.ShaderType.FRAGMENT_SHADER&&"gl_FragColor"===H.data&&(A||(A=l(y,B,"fragColor"),e(y,A,"vec4")),H.data=A);if(E===g.ShaderType.FRAGMENT_SHADER&&"gl_FragData"===
H.data){{var C=void 0;let M=void 0;var F=y;var G=L+1;let K=-1;for(;G<F.length;G++){const I=F[G];if("operator"===I.type&&("["===I.data&&(M=G),"]"===I.data)){C=G;break}"integer"===I.type&&(K=parseInt(I.data,10))}M&&C&&F.splice(M,C-M+1);F=K}C=l(y,B,"fragData");d(y,C,"vec4",F,"mediump");H.data=C}else E===g.ShaderType.FRAGMENT_SHADER&&"gl_FragDepthEXT"===H.data&&(p||(p=l(y,B,"gl_FragDepth")),H.data=p);break;case "ident":if(0<=h.indexOf(H.data)){if(F=E===g.ShaderType.VERTEX_SHADER)a:{for(F=L-1;0<=F;F--)if(C=
y[F],"whitespace"!==C.type&&"block-comment"!==C.type)if("keyword"===C.type){if("attribute"===C.data||"in"===C.data){F=!0;break a}}else break;F=!1}if(F)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");H.data in D||(D[H.data]=l(y,B,H.data));H.data=D[H.data]}}}for(E=y.length-1;0<=E;--E)A=y[E],"preprocessor"===A.type&&((p=A.data.match(/#extension\s+(.*):/))&&p[1]&&0<=t.indexOf(p[1].trim())&&(p=y[E+1],y.splice(E,p&&"whitespace"===p.type?2:1)),(p=A.data.match(/#ifdef\s+(.*)/))&&
p[1]&&0<=t.indexOf(p[1].trim())&&(A.data="#if 1"),(p=A.data.match(/#ifndef\s+(.*)/))&&p[1]&&0<=t.indexOf(p[1].trim())&&(A.data="#if 0"));y=n(y);r.enableCache&&x.set(u,y);return y};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/reservedWordsGLSL3":function(){define(function(){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/ProgramCache":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe","../../core/NestedMap","./Program"],function(a,b,c,g,h){let w=function(){function n(l){this._rctx=l;this._store=new g.NestedMap}var f=n.prototype;f.dispose=function(){this._store.forEach(l=>l.forEach(k=>k.dispose()));this._store.clear()};f.acquire=function(l,k,e,d){const m=this._store.get(l,k);if(c.isSome(m))return m.ref(),m;e=new h.Program(this._rctx,l,k,e,d);e.ref();this._store.set(l,
k,e);return e};b._createClass(n,[{key:"test",get:function(){let l=0;this._store.forEach(k=>k.forEach(e=>l+=e.hasGLName?2:1));return{cachedWebGLObjects:l}}}]);return n}();a.ProgramCache=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/Program":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/maybe ./checkWebGLError ./context-util ./enums ./ShaderTranspiler".split(" "),function(a,b,c,g,h,w,n,f){function l(m,z){if(g.isNone(m)||m.length!==
z.length)return!0;for(let v=0;v<m.length;++v)if(m[v]!==z[v])return!0;return!1}function k(m,z,v){const q=m.gl,t=q.createShader(z);q.shaderSource(t,v);q.compileShader(t);h.webglValidateShadersEnabled()&&!q.getShaderParameter(t,q.COMPILE_STATUS)&&(console.error("Compile error in ".concat(z===n.ShaderType.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(q.getShaderInfoLog(t)),console.error(e(v)),m.type===w.ContextType.WEBGL2&&(console.log("Shader source before transpilation:"),console.log(v)));
return t}function e(m){let z=2;return m.replace(/\n/g,()=>{var v=z++;v=1E3<=v?v.toString():("  "+v).slice(-3);return"\n"+v+":"})}function d(m,z){for(let v=0;v<m.length;++v)z[v]=m[v]}c=function(){function m(v,q,t,r,x=new Map){this._context=v;this._locations=r;this._uniformBlockBindings=x;this._refCount=1;this._compiled=!1;this._nameToUniformLocation={};this._nameToUniform1={};this._nameToUniform1v={};this._nameToUniform2={};this._nameToUniform3={};this._nameToUniform4={};this._nameToUniformMatrix3=
{};this._nameToUniformMatrix4={};v||console.error("RenderingContext isn't initialized!");0===q.length&&console.error("Shaders source should not be empty!");this._context.type===w.ContextType.WEBGL2&&(q=f.transpileShader(q,n.ShaderType.VERTEX_SHADER),t=f.transpileShader(t,n.ShaderType.FRAGMENT_SHADER));this._vShader=k(this._context,n.ShaderType.VERTEX_SHADER,q);this._fShader=k(this._context,n.ShaderType.FRAGMENT_SHADER,t);this._vShader&&this._fShader||console.error("Error loading shaders!");this._context.instanceCounter.increment(n.ResourceType.Shader,
this);h.webglValidateShadersEnabled()&&(this.vertexShader=q,this.fragmentShader=t)}var z=m.prototype;z.dispose=function(){if(!(0<--this._refCount)){var v=this._context.gl;this._vShader&&(v.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(n.ResourceType.Shader,this));this._fShader&&(v.deleteShader(this._fShader),this._fShader=null);this._glName&&(v.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(n.ResourceType.Program,this))}};
z.ref=function(){++this._refCount};z._getUniformLocation=function(v){void 0===this._nameToUniformLocation[v]&&(this._nameToUniformLocation[v]=this._context.gl.getUniformLocation(this.glName,v));return this._nameToUniformLocation[v]};z.hasUniform=function(v){return null!==this._getUniformLocation(v)};z.setUniform1i=function(v,q){const t=this._nameToUniform1[v];if(void 0===t||q!==t)this._context.gl.uniform1i(this._getUniformLocation(v),q),this._nameToUniform1[v]=q};z.setUniform1iv=function(v,q){const t=
this._nameToUniform1v[v];l(t,q)&&(this._context.gl.uniform1iv(this._getUniformLocation(v),q),void 0===t?this._nameToUniform1v[v]=Array.from(q):d(q,t))};z.setUniform2iv=function(v,q){const t=this._nameToUniform2[v];l(t,q)&&(this._context.gl.uniform2iv(this._getUniformLocation(v),q),void 0===t?this._nameToUniform2[v]=Array.from(q):d(q,t))};z.setUniform3iv=function(v,q){const t=this._nameToUniform3[v];l(t,q)&&(this._context.gl.uniform3iv(this._getUniformLocation(v),q),void 0===t?this._nameToUniform3[v]=
Array.from(q):d(q,t))};z.setUniform4iv=function(v,q){const t=this._nameToUniform4[v];l(t,q)&&(this._context.gl.uniform4iv(this._getUniformLocation(v),q),void 0===t?this._nameToUniform4[v]=Array.from(q):d(q,t))};z.setUniform1f=function(v,q){const t=this._nameToUniform1[v];if(void 0===t||q!==t)this._context.gl.uniform1f(this._getUniformLocation(v),q),this._nameToUniform1[v]=q};z.setUniform1fv=function(v,q){const t=this._nameToUniform1v[v];l(t,q)&&(this._context.gl.uniform1fv(this._getUniformLocation(v),
q),void 0===t?this._nameToUniform1v[v]=Array.from(q):d(q,t))};z.setUniform2f=function(v,q,t){const r=this._nameToUniform2[v];if(void 0===r||q!==r[0]||t!==r[1])this._context.gl.uniform2f(this._getUniformLocation(v),q,t),void 0===r?this._nameToUniform2[v]=[q,t]:(r[0]=q,r[1]=t)};z.setUniform2fv=function(v,q){const t=this._nameToUniform2[v];l(t,q)&&(this._context.gl.uniform2fv(this._getUniformLocation(v),q),void 0===t?this._nameToUniform2[v]=Array.from(q):d(q,t))};z.setUniform3f=function(v,q,t,r){const x=
this._nameToUniform3[v];if(void 0===x||q!==x[0]||t!==x[1]||r!==x[2])this._context.gl.uniform3f(this._getUniformLocation(v),q,t,r),void 0===x?this._nameToUniform3[v]=[q,t,r]:(x[0]=q,x[1]=t,x[2]=r)};z.setUniform3fv=function(v,q){const t=this._nameToUniform3[v];l(t,q)&&(this._context.gl.uniform3fv(this._getUniformLocation(v),q),void 0===t?this._nameToUniform3[v]=Array.from(q):d(q,t))};z.setUniform4f=function(v,q,t,r,x){const u=this._nameToUniform4[v];if(void 0===u||q!==u[0]||t!==u[1]||r!==u[2]||x!==
u[3])this._context.gl.uniform4f(this._getUniformLocation(v),q,t,r,x),void 0===u?this._nameToUniform4[v]=[q,t,r,x]:(u[0]=q,u[1]=t,u[2]=r,u[3]=x)};z.setUniform4fv=function(v,q){const t=this._nameToUniform4[v];l(t,q)&&(this._context.gl.uniform4fv(this._getUniformLocation(v),q),void 0===t?this._nameToUniform4[v]=Array.from(q):d(q,t))};z.setUniformMatrix3fv=function(v,q,t=!1){const r=this._nameToUniformMatrix3[v];var x=g.isNone(r)?!0:9!==r.length?l(r,q):9!==r.length||r[0]!==q[0]||r[1]!==q[1]||r[2]!==q[2]||
r[3]!==q[3]||r[4]!==q[4]||r[5]!==q[5]||r[6]!==q[6]||r[7]!==q[7]||r[8]!==q[8];x&&(this._context.gl.uniformMatrix3fv(this._getUniformLocation(v),t,q),void 0===r?this._nameToUniformMatrix3[v]=Array.from(q):d(q,r))};z.setUniformMatrix4fv=function(v,q,t=!1){const r=this._nameToUniformMatrix4[v];var x=g.isNone(r)?!0:16!==r.length?l(r,q):16!==r.length||r[0]!==q[0]||r[1]!==q[1]||r[2]!==q[2]||r[3]!==q[3]||r[4]!==q[4]||r[5]!==q[5]||r[6]!==q[6]||r[7]!==q[7]||r[8]!==q[8]||r[9]!==q[9]||r[10]!==q[10]||r[11]!==
q[11]||r[12]!==q[12]||r[13]!==q[13]||r[14]!==q[14]||r[15]!==q[15];x&&(this._context.gl.uniformMatrix4fv(this._getUniformLocation(v),t,q),void 0===r?this._nameToUniformMatrix4[v]=Array.from(q):d(q,r))};z.stop=function(){};b._createClass(m,[{key:"glName",get:function(){if(g.isSome(this._glName))return this._glName;if(g.isNone(this._vShader))return null;const v=this._context.gl,q=v.createProgram();v.attachShader(q,this._vShader);v.attachShader(q,this._fShader);this._locations.forEach((t,r)=>v.bindAttribLocation(q,
t,r));v.linkProgram(q);h.webglValidateShadersEnabled()&&!v.getProgramParameter(q,v.LINK_STATUS)&&console.error("Could not link shader\n"+`validated: ${v.getProgramParameter(q,v.VALIDATE_STATUS)}`+`, gl error ${v.getError()}`+`, vertex: ${v.getShaderParameter(this._vShader,v.COMPILE_STATUS)}`+`, fragment: ${v.getShaderParameter(this._fShader,v.COMPILE_STATUS)}`+`, info log: ${v.getProgramInfoLog(q)}`+`, vertex source: ${this.vertexShader}`+`, fragment source: ${this.fragmentShader}`);if(this._context.type===
w.ContextType.WEBGL2)for(const [t,r]of this._uniformBlockBindings){const x=v.getUniformBlockIndex(q,t);4294967295>x&&v.uniformBlockBinding(q,x,r)}this._glName=q;this._context.instanceCounter.increment(n.ResourceType.Program,this);return q}},{key:"hasGLName",get:function(){return g.isSome(this._glName)}},{key:"isCompiled",get:function(){if(this._compiled)return!0;const v=this._context.gl.getExtension("KHR_parallel_shader_compile");return null==v?this._compiled=!0:this._compiled=!!this._context.gl.getProgramParameter(this.glName,
v.COMPLETION_STATUS_KHR)}}]);return m}();a.Program=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/ContextState":function(){define(["exports","./enums"],function(a,b){a.ContextState=function(){this.blend=!1;this.blendColor={r:0,g:0,b:0,a:0};this.blendFunction={srcRGB:b.BlendFactor.ONE,dstRGB:b.BlendFactor.ZERO,srcAlpha:b.BlendFactor.ONE,dstAlpha:b.BlendFactor.ZERO};this.blendEquation={mode:b.BlendOperation.ADD,modeAlpha:b.BlendOperation.ADD};this.colorMask={r:!0,g:!0,b:!0,
a:!0};this.faceCulling=!1;this.cullFace=b.Face.BACK;this.frontFace=b.CullMode.CCW;this.scissorTest=!1;this.scissorRect={x:0,y:0,width:0,height:0};this.depthTest=!1;this.depthFunction=b.CompareFunction.LESS;this.clearDepth=1;this.depthWrite=!0;this.depthRange={zNear:0,zFar:1};this.viewport=null;this.polygonOffsetFill=this.stencilTest=!1;this.polygonOffset=[0,0];this.stencilFunction={face:b.Face.FRONT_AND_BACK,func:b.CompareFunction.ALWAYS,ref:0,mask:1};this.clearStencil=0;this.stencilWriteMask=1;this.stencilOperation=
{face:b.Face.FRONT_AND_BACK,fail:b.StencilOperation.KEEP,zFail:b.StencilOperation.KEEP,zPass:b.StencilOperation.KEEP};this.clearColor={r:0,g:0,b:0,a:0};this.copyWriteBuffer=this.copyReadBuffer=this.pixelUnpackBuffer=this.pixelPackBuffer=this.uniformBuffer=this.indexBuffer=this.vertexBuffer=this.program=null;this.uniformBufferBindingPoints=[];this.renderbuffer=this.drawFramebuffer=this.readFramebuffer=null;this.activeTexture=0;this.textureUnitMap=[]};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/webgl/InstanceCounter":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../support/AllocationTracer","./enums"],function(a,b,c,g){const h=new function(){this.RECORD_ALLOCATIONS=!1};let w=function(){function n(){this._current=[];this._max=[];for(this._allocations=new c.AllocationTracer(h.RECORD_ALLOCATIONS);this._current.length<g.ResourceType.COUNT;)this._current.push(0),this._max.push(0)}var f=n.prototype;f.resetMax=function(){for(this._max.length=0;this._max.length<
this._current.length;)this._max.push(0)};f.increment=function(l,k){const e=++this._current[l];this._max[l]=Math.max(e,this._max[l]);this._allocations.add(k)};f.decrement=function(l,k){--this._current[l];this._allocations.remove(k)};f.printResourceCount=function(){if(0<this.total){console.log("Live objects:");for(let l=0;l<g.ResourceType.COUNT;++l){const k=this._current[l];0<k&&console.log(`${g.ResourceType[l]}: ${k}`)}}this._allocations.print()};b._createClass(n,[{key:"max",get:function(){return this._max}},
{key:"current",get:function(){return this._current}},{key:"total",get:function(){return this.current.reduce((l,k)=>l+k,0)}}]);return n}();a.InstanceCounter=w;a.test=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/support/AllocationTracer":function(){define(["exports"],function(a){let b=function(){function c(h){this._allocations=new Map;h?Error.stackTraceLimit=Infinity:(this.add=()=>{},this.remove=()=>{})}var g=c.prototype;g.add=function(h){this._allocations.set(h,Error().stack)};
g.remove=function(h){this._allocations.delete(h)};g.print=function(){if(0<this._allocations.size){console.log(`${this._allocations.size} live object allocations:`);const h=new Map;this._allocations.forEach(w=>{var n;h.set(w,(null!=(n=h.get(w))?n:0)+1)});h.forEach((w,n)=>{n=n.split("\n");n.shift();n.shift();console.log(`${w}: ${n.shift()}`);n.forEach(f=>console.log("   ",f))})}};return c}();a.AllocationTracer=b;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/WebGLDriverTest":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/maybe ./testDoublePrecisionArithmetic ./testFloatBufferBlend ./testSamplerPrecision ./testSVGPremultipliedAlpha".split(" "),
function(a,b,c,g,h,w,n){let f=function(){function l(k){this.context=k;this._floatBufferBlendWorking=h.testFloatBufferBlend(k);n.testSVGPremultipliedAlpha(k).then(e=>this._svgAlwaysPremultipliesAlpha=!e)}b._createClass(l,[{key:"floatBufferBlendWorking",get:function(){if(c.isNone(this._floatBufferBlendWorking))throw Error("floatBufferBlendWorking test not yet available");return this._floatBufferBlendWorking}},{key:"svgAlwaysPremultipliesAlpha",get:function(){if(c.isNone(this._svgAlwaysPremultipliesAlpha))throw Error("svgAlwaysPremultipliesAlpha test not yet available");
return this._svgAlwaysPremultipliesAlpha}},{key:"doublePrecisionRequiresObfuscation",get:function(){if(c.isNone(this._doublePrecisionRequiresObfuscation)){const k=g.testDoublePrecisionArithmetic(this.context,!1),e=g.testDoublePrecisionArithmetic(this.context,!0);this._doublePrecisionRequiresObfuscation=0!==k&&(0===e||5<k/e)}return this._doublePrecisionRequiresObfuscation}},{key:"ignoresSamplerPrecision",get:function(){c.isNone(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=w.testSamplerPrecision(this.context));
return this._ignoresSamplerPrecision}}]);return l}();a.WebGLDriverTest=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/testDoublePrecisionArithmetic":function(){define("exports ../../core/floatRGBA ../../chunks/vec3f64 ./BufferObject ./doublePrecisionUtils ./enums ./FramebufferObject ./VertexArrayObject ./VertexElementDescriptor".split(" "),function(a,b,c,g,h,w,n,f,l){a.testDoublePrecisionArithmetic=function(k,e){var d=new n.FramebufferObject(k,{colorTarget:w.TargetType.TEXTURE,
depthStencilTarget:w.DepthStencilTargetType.NONE},{target:w.TextureType.TEXTURE_2D,wrapMode:w.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:w.PixelFormat.RGBA,dataType:w.PixelType.UNSIGNED_BYTE,samplingMode:w.TextureSamplingMode.NEAREST,width:1,height:1});const m=g.BufferObject.createVertex(k,w.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),z=new f.VertexArrayObject(k,new Map([["position",0]]),{geometry:[new l.VertexElementDescriptor("position",2,w.DataType.UNSIGNED_SHORT,0,4)]},{geometry:m}),
v=c.fromValues(5633261.287538229,2626832.878767164,1434988.0495278358),q=c.fromValues(5633271.46742708,2626873.6381334523,1434963.231608387);e=k.programCache.acquire(`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `,
"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor \x3d v_color;\n  }\n  ",new Map([["position",0]]));var t=new Float32Array(6);h.encodeDoubleArray(v,t,3);var r=new Float32Array(6);h.encodeDoubleArray(q,r,3);k.useProgram(e);e.setUniform3f("u_highA",t[0],t[2],t[4]);e.setUniform3f("u_lowA",t[1],t[3],t[5]);e.setUniform3f("u_highB",r[0],r[2],r[4]);e.setUniform3f("u_lowB",r[1],r[3],r[5]);t=e;r=k.getBoundFramebufferObject();const {x,y:u,width:E,height:y}=k.getViewport();
k.bindFramebuffer(d);k.setViewport(0,0,1,1);k.bindVAO(z);k.drawArrays(w.PrimitiveType.TRIANGLE_STRIP,0,4);e=new Uint8Array(4);d.readPixels(0,0,1,1,w.PixelFormat.RGBA,w.PixelType.UNSIGNED_BYTE,e);t.dispose();z.dispose(!1);m.dispose();d.dispose();k.setViewport(x,u,E,y);k.bindFramebuffer(r);k=(v[2]-q[2])/25;d=b.unpackFloatRGBA(e);return Math.abs(k-d)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/testFloatBufferBlend":function(){define("exports ../3d/webgl-engine/lib/OrderIndependentTransparency ./BufferObject ./context-util ./enums ./FramebufferObject ./renderState ./VertexArrayObject ./VertexElementDescriptor".split(" "),
function(a,b,c,g,h,w,n,f,l){var k={exports:{}};(function(e){(function(d){d=d();void 0!==d&&(e.exports=d)})(function(){function d(y){if(null==u){u={};E={};for(var A in y)"number"==typeof y[A]&&(u[y[A]]=A,E[A]=y[A])}}function m(){if(null==u)throw"WebGLDebugUtils.init(ctx) not called";}function z(y){m();var A=u[y];return void 0!==A?"gl."+A:"/*UNKNOWN WebGL ENUM*/ 0x"+y.toString(16)}function v(y,A,p,B){y=x[y];if(void 0!==y&&(y=y[A],void 0!==y&&y[p])){if("object"===typeof y[p]&&void 0!==y[p].enumBitwiseOr){A=
y[p].enumBitwiseOr;p=0;y=[];for(var D=0;D<A.length;++D){var C=E[A[D]];0!==(B&C)&&(p|=C,y.push(z(C)))}return p===B?y.join(" | "):z(B)}return z(B)}return null===B?"null":void 0===B?"undefined":B.toString()}function q(y,A,p){y.__defineGetter__(p,function(){return A[p]});y.__defineSetter__(p,function(B){A[p]=B})}function t(y,A,p,B){function D(H,M){return function(){p&&p(M,arguments);var K=H[M].apply(H,arguments),I=B.getError();0!=I&&(C[I]=!0,A(I,M,arguments));return K}}B=B||y;d(y);A=A||function(H,M,K){for(var I=
"",O=K.length,Q=0;Q<O;++Q)I+=(0==Q?"":", ")+v(M,O,Q,K[Q]);H="WebGL error "+z(H)+" in "+M+"("+I+")";window.console&&window.console.error?window.console.error(H):window.console&&window.console.log&&window.console.log(H)};var C={},F={},G;for(G in y)if("function"==typeof y[G])if("getExtension"!=G)F[G]=D(y,G);else{var L=D(y,G);F[G]=function(){var H=L.apply(y,arguments);return t(H,A,p,B)}}else q(F,y,G);F.getError=function(){for(var H in C)if(C.hasOwnProperty(H)&&C[H])return C[H]=!1,H;return y.NO_ERROR};
return F}function r(y){var A=y.getParameter(y.MAX_VERTEX_ATTRIBS),p=y.createBuffer();y.bindBuffer(y.ARRAY_BUFFER,p);for(var B=0;B<A;++B)y.disableVertexAttribArray(B),y.vertexAttribPointer(B,4,y.FLOAT,!1,0,0),y.vertexAttrib1f(B,0);y.deleteBuffer(p);A=y.getParameter(y.MAX_TEXTURE_IMAGE_UNITS);for(B=0;B<A;++B)y.activeTexture(y.TEXTURE0+B),y.bindTexture(y.TEXTURE_CUBE_MAP,null),y.bindTexture(y.TEXTURE_2D,null);y.activeTexture(y.TEXTURE0);y.useProgram(null);y.bindBuffer(y.ARRAY_BUFFER,null);y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,
null);y.bindFramebuffer(y.FRAMEBUFFER,null);y.bindRenderbuffer(y.RENDERBUFFER,null);y.disable(y.BLEND);y.disable(y.CULL_FACE);y.disable(y.DEPTH_TEST);y.disable(y.DITHER);y.disable(y.SCISSOR_TEST);y.blendColor(0,0,0,0);y.blendEquation(y.FUNC_ADD);y.blendFunc(y.ONE,y.ZERO);y.clearColor(0,0,0,0);y.clearDepth(1);y.clearStencil(-1);y.colorMask(!0,!0,!0,!0);y.cullFace(y.BACK);y.depthFunc(y.LESS);y.depthMask(!0);y.depthRange(0,1);y.frontFace(y.CCW);y.hint(y.GENERATE_MIPMAP_HINT,y.DONT_CARE);y.lineWidth(1);
y.pixelStorei(y.PACK_ALIGNMENT,4);y.pixelStorei(y.UNPACK_ALIGNMENT,4);y.pixelStorei(y.UNPACK_FLIP_Y_WEBGL,!1);y.pixelStorei(y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);y.UNPACK_COLORSPACE_CONVERSION_WEBGL&&y.pixelStorei(y.UNPACK_COLORSPACE_CONVERSION_WEBGL,y.BROWSER_DEFAULT_WEBGL);y.polygonOffset(0,0);y.sampleCoverage(1,!1);y.scissor(0,0,y.canvas.width,y.canvas.height);y.stencilFunc(y.ALWAYS,0,4294967295);y.stencilMask(4294967295);y.stencilOp(y.KEEP,y.KEEP,y.KEEP);y.viewport(0,0,y.canvas.width,y.canvas.height);
for(y.clear(y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT|y.STENCIL_BUFFER_BIT);y.getError(););}var x={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},
texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},
bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,
1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},u=null,E=null;return{init:d,mightBeEnum:function(y){m();return void 0!==u[y]},glEnumToString:z,glFunctionArgToString:v,glFunctionArgsToString:function(y,A){for(var p="",B=A.length,
D=0;D<B;++D)p+=(0==D?"":", ")+v(y,B,D,A[D]);return p},makeDebugContext:t,makeLostContextSimulatingCanvas:function(y){function A(S){return"function"==typeof S?S:function(T){S.handleEvent(T)}}function p(){for(var S=Object.keys(R),T=0;T<S.length;++T)delete R[S]}function B(){++J;I||Q==J&&y.loseContext()}function D(S,T){var V=S[T];return function(){B();if(!I)return V.apply(S,arguments)}}function C(S){return{statusMessage:S,preventDefault:function(){P=!0}}}function F(S){for(var T in S)"function"==typeof S[T]?
M[T]=D(S,T):q(M,S,T);M.getError=function(){B();if(!I)for(var U;U=G.getError();)R[U]=!0;for(U in R)if(R[U])return delete R[U],U;return M.NO_ERROR};var V="createBuffer createFramebuffer createProgram createRenderbuffer createShader createTexture".split(" ");for(T=0;T<V.length;++T){var W=V[T];M[W]=function(U){return function(){B();if(I)return null;var aa=U.apply(S,arguments);aa.__webglDebugContextLostId__=K;O.push(aa);return aa}}(S[W])}V="getActiveAttrib getActiveUniform getBufferParameter getContextAttributes getAttachedShaders getFramebufferAttachmentParameter getParameter getProgramParameter getProgramInfoLog getRenderbufferParameter getShaderParameter getShaderInfoLog getShaderSource getTexParameter getUniform getUniformLocation getVertexAttrib".split(" ");
for(T=0;T<V.length;++T)W=V[T],M[W]=function(U){return function(){B();return I?null:U.apply(S,arguments)}}(M[W]);V="isBuffer isEnabled isFramebuffer isProgram isRenderbuffer isShader isTexture".split(" ");for(T=0;T<V.length;++T)W=V[T],M[W]=function(U){return function(){B();return I?!1:U.apply(S,arguments)}}(M[W]);M.checkFramebufferStatus=function(U){return function(){B();return I?M.FRAMEBUFFER_UNSUPPORTED:U.apply(S,arguments)}}(M.checkFramebufferStatus);M.getAttribLocation=function(U){return function(){B();
return I?-1:U.apply(S,arguments)}}(M.getAttribLocation);M.getVertexAttribOffset=function(U){return function(){B();return I?0:U.apply(S,arguments)}}(M.getVertexAttribOffset);M.isContextLost=function(){return I};return M}var G,L=[],H=[];var M={};var K=1,I=!1,O=[],Q=0,J=0,P=!1,N=0,R={};y.getContext=function(S){return function(){var T=S.apply(y,arguments);if(T instanceof WebGLRenderingContext){if(T!=G){if(G)throw"got different context";G=T;M=F(G)}return M}return T}}(y.getContext);(function(S){var T=S.addEventListener;
S.addEventListener=function(V,W,U){switch(V){case "webglcontextlost":L.push(A(W));break;case "webglcontextrestored":H.push(A(W));break;default:T.apply(S,arguments)}}})(y);y.loseContext=function(){if(!I){I=!0;Q=0;for(++K;G.getError(););p();R[G.CONTEXT_LOST_WEBGL]=!0;var S=C("context lost"),T=L.slice();setTimeout(function(){for(var V=0;V<T.length;++V)T[V](S);0<=N&&setTimeout(function(){y.restoreContext()},N)},0)}};y.restoreContext=function(){I&&H.length&&setTimeout(function(){if(!P)throw"can not restore. webglcontestlost listener did not call event.preventDefault";
for(var S=0;S<O.length;++S){var T=O[S];T instanceof WebGLBuffer?G.deleteBuffer(T):T instanceof WebGLFramebuffer?G.deleteFramebuffer(T):T instanceof WebGLProgram?G.deleteProgram(T):T instanceof WebGLRenderbuffer?G.deleteRenderbuffer(T):T instanceof WebGLShader?G.deleteShader(T):T instanceof WebGLTexture&&G.deleteTexture(T)}r(G);I=!1;J=0;P=!1;S=H.slice();T=C("context restored");for(var V=0;V<S.length;++V)S[V](T)},0)};y.loseContextInNCalls=function(S){if(I)throw"You can not ask a lost contet to be lost";
Q=J+S};y.getNumCalls=function(){return J};y.setRestoreTimeout=function(S){N=S};return y},resetToInitialState:r}})})(k);a.testFloatBufferBlend=function(e){var d,m,z;if(!e.gl)return!1;if(e.type===g.ContextType.WEBGL1){var v,q;return!(null==(v=e.capabilities.textureFloat)||!v.textureFloat||null==(q=e.capabilities.colorBufferFloat)||!q.textureFloat)}if(!((null==(d=e.capabilities.textureFloat)?0:d.textureFloat)&&(null==(m=e.capabilities.colorBufferFloat)?0:m.textureFloat)&&(null==(z=e.capabilities.colorBufferFloat)?
0:z.floatBlend)))return!1;d=new w.FramebufferObject(e,{colorTarget:h.TargetType.TEXTURE,depthStencilTarget:h.DepthStencilTargetType.NONE},{target:h.TextureType.TEXTURE_2D,wrapMode:h.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:h.PixelFormat.RGBA,dataType:h.PixelType.FLOAT,internalFormat:h.SizedPixelFormat.RGBA32F,samplingMode:h.TextureSamplingMode.NEAREST,width:1,height:1});m=c.BufferObject.createVertex(e,h.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));z=new f.VertexArrayObject(e,new Map([["a_pos",
0]]),{geometry:[new l.VertexElementDescriptor("a_pos",2,h.DataType.UNSIGNED_SHORT,0,4)]},{geometry:m});v=e.programCache.acquire("\n  precision highp float;\n  attribute vec2 a_pos;\n\n  void main() {\n    gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n   precision highp float;\n\n   void main() {\n    gl_FragColor \x3d vec4(0.5, 0.5, 0.5, 0.5);\n   }\n  ",new Map([["a_pos",0]]));e.useProgram(v);q=e.getBoundFramebufferObject();const {x:t,y:r,width:x,height:u}=e.getViewport();e.bindFramebuffer(d);
e.setViewport(0,0,1,1);e.bindVAO(z);e.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,0,4);var E=n.makePipelineState({blending:b.blendingAlpha});e.setPipelineState(E);e.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,0,4);k.exports.init(e);E=e.gl.getError();e.setViewport(t,r,x,u);e.bindFramebuffer(q);v.dispose();z.dispose(!1);m.dispose();d.dispose();return 1282===E?(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1):!0};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/webgl/testSamplerPrecision":function(){define("exports ../../core/Logger ./BufferObject ./enums ./FramebufferObject ./Texture ./VertexArrayObject ./VertexElementDescriptor".split(" "),function(a,b,c,g,h,w,n,f){const l=b.getLogger("esri.views.WebGLDriverTest");a.testSamplerPrecision=function(k){var e=new h.FramebufferObject(k,{colorTarget:g.TargetType.TEXTURE,depthStencilTarget:g.DepthStencilTargetType.NONE},{target:g.TextureType.TEXTURE_2D,wrapMode:g.TextureWrapMode.CLAMP_TO_EDGE,
pixelFormat:g.PixelFormat.RGBA,dataType:g.PixelType.UNSIGNED_BYTE,samplingMode:g.TextureSamplingMode.NEAREST,width:1,height:1});const d=new Uint8Array(4),m=c.BufferObject.createVertex(k,g.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),z=new n.VertexArrayObject(k,new Map([["a_position",0]]),{geometry:[new f.VertexElementDescriptor("a_position",2,g.DataType.SHORT,0,4)]},{geometry:m}),v=k.programCache.acquire("\nprecision highp float;\nattribute vec2 a_pos;\nuniform highp sampler2D u_texture;\nvarying vec4 v_color;\n\nfloat getBit(in float bitset, in int bitIndex) {\n  float offset \x3d pow(2.0, float(bitIndex));\n  return mod(floor(bitset / offset), 2.0);\n}\n\nvoid main() {\n  vec4 value \x3d texture2D(u_texture, vec2(0.0));\n  float bit \x3d getBit(value.x * 255.0, 1);\n\n  v_color \x3d bit * vec4(1.0);\n  gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n",
"\nprecision highp float;\nvarying vec4 v_color;\n\nvoid main() {\n  gl_FragColor \x3d v_color;\n}\n",new Map([["a_pos",0]]));k.useProgram(v);var q=new w.Texture(k,{target:g.TextureType.TEXTURE_2D,wrapMode:g.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:g.PixelFormat.RGBA,dataType:g.PixelType.UNSIGNED_BYTE,samplingMode:g.TextureSamplingMode.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));v.setUniform1i("u_texture",0);k.bindTexture(q,0);q=k.getBoundFramebufferObject();k.bindFramebuffer(e);k.useProgram(v);
const {x:t,y:r,width:x,height:u}=k.getViewport();k.setViewport(0,0,1,1);k.bindVAO(z);k.drawArrays(g.PrimitiveType.TRIANGLE_STRIP,0,4);k.setViewport(t,r,x,u);e.readPixels(0,0,1,1,g.PixelFormat.RGBA,g.PixelType.UNSIGNED_BYTE,d);v.dispose();z.dispose(!1);m.dispose();e.dispose();(e=255!==d[0]||255!==d[1]||255!==d[2]||255!==d[3])&&l.warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${d[0]}.${d[1]}.${d[2]}.${d[3]}]`);
k.bindFramebuffer(q);return e};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/testSVGPremultipliedAlpha":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../2d/engine/webgl/DefaultVertexAttributeLayouts ./BufferObject ./enums ./FramebufferObject ./Texture ./VertexArrayObject".split(" "),function(a,b,c,g,h,w,n,f){function l(){l=b._asyncToGenerator(function*(k){const e=new Image;e.src="data:image/svg+xml,%3C%3Fxml version\x3d'1.0' encoding\x3d'UTF-8'%3F%3E%3Csvg width\x3d'5' height\x3d'5' version\x3d'1.1' viewBox\x3d'0 0 5 5' xmlns\x3d'http://www.w3.org/2000/svg'%3E%3Crect width\x3d'5' height\x3d'5' fill\x3d'%23f00' fill-opacity\x3d'.5'/%3E%3C/svg%3E%0A";
e.width=5;e.height=5;yield e.decode();if(!k.gl)return!0;const d=new w.FramebufferObject(k,{colorTarget:h.TargetType.TEXTURE,depthStencilTarget:h.DepthStencilTargetType.NONE},{target:h.TextureType.TEXTURE_2D,wrapMode:h.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:h.PixelFormat.RGBA,dataType:h.PixelType.UNSIGNED_BYTE,samplingMode:h.TextureSamplingMode.NEAREST,width:1,height:1}),m=g.BufferObject.createVertex(k,h.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),z=new f.VertexArrayObject(k,new Map([["a_pos",
0]]),c.Pos2us,{geometry:m}),v=k.programCache.acquire("\n  precision highp float;\n\n  attribute vec2 a_pos;\n  varying vec2 v_uv;\n\n  void main() {\n    v_uv \x3d a_pos;\n    gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n  precision highp float;\n\n  varying vec2 v_uv;\n  uniform sampler2D u_texture;\n\n  void main() {\n    gl_FragColor \x3d texture2D(u_texture, v_uv);\n  }\n  ",new Map([["a_pos",0]]));k.useProgram(v);const q=new n.Texture(k,{dataType:h.PixelType.UNSIGNED_BYTE,
pixelFormat:h.PixelFormat.RGBA,preMultiplyAlpha:!1,wrapMode:h.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:h.TextureSamplingMode.LINEAR},e);k.bindTexture(q,0);v.setUniform1i("u_texture",0);const t=k.getBoundFramebufferObject(),{x:r,y:x,width:u,height:E}=k.getViewport();k.bindFramebuffer(d);k.setViewport(0,0,1,1);k.setClearColor(0,0,0,0);k.setBlendingEnabled(!1);k.clearSafe(h.ClearBufferBit.COLOR_BUFFER_BIT);k.bindVAO(z);k.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,0,4);const y=new Uint8Array(4);d.readPixels(0,
0,1,1,h.PixelFormat.RGBA,h.PixelType.UNSIGNED_BYTE,y);v.dispose();z.dispose(!1);m.dispose();d.dispose();q.dispose();k.setViewport(r,x,u,E);k.bindFramebuffer(t);e.src="";return 255===y[0]});return l.apply(this,arguments)}a.testSVGPremultipliedAlpha=function(k){return l.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/2d/engine/webgl/DefaultVertexAttributeLayouts":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,
b,c){const g={geometry:[new c.VertexElementDescriptor("a_pos",2,b.DataType.BYTE,0,2)]},h={geometry:[new c.VertexElementDescriptor("a_pos",2,b.DataType.BYTE,0,4),new c.VertexElementDescriptor("a_tex",2,b.DataType.BYTE,2,4)]};b={geometry:[new c.VertexElementDescriptor("a_pos",2,b.DataType.UNSIGNED_SHORT,0,4)]};a.Pos2b=g;a.Pos2us=b;a.PosTex2b=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/Capabilities":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ./DisjointTimerQuery ./DrawBuffers ./Instancing ./load ./LoseContext ./VertexArrayObjects".split(" "),
function(a,b,c,g,h,w,n,f){let l=function(){function k(e,d){this.gl=e;this._fragDepth=this._shaderTextureLOD=this._standardDerivatives=this._depthTexture=null;this._disabledExtensions=d.disabledExtensions||{};this._debugWebGLExtensions=d.debugWebGLExtensions||{}}k.prototype.enable=function(e){return this[e]};b._createClass(k,[{key:"drawBuffers",get:function(){this._drawBuffers||(this._drawBuffers=g.load(this.gl,this._disabledExtensions));return this._drawBuffers}},{key:"instancing",get:function(){this._instancing||
(this._instancing=h.load(this.gl));return this._instancing}},{key:"vao",get:function(){this._vertexArrayObject||(this._vertexArrayObject=f.load(this.gl,this._disabledExtensions));return this._vertexArrayObject}},{key:"compressedTextureETC",get:function(){this._compressedTextureETC||(this._compressedTextureETC=w.loadCompressedTextureETC(this.gl,this._disabledExtensions));return this._compressedTextureETC}},{key:"compressedTextureS3TC",get:function(){this._compressedTextureS3TC||(this._compressedTextureS3TC=
w.loadCompressedTextureS3TC(this.gl,this._disabledExtensions));return this._compressedTextureS3TC}},{key:"textureFilterAnisotropic",get:function(){this._textureFilterAnisotropic||(this._textureFilterAnisotropic=w.loadTextureFilterAnisotropicCapability(this.gl,this._disabledExtensions));return this._textureFilterAnisotropic}},{key:"disjointTimerQuery",get:function(){this._disjointTimerQuery||(this._disjointTimerQuery=c.createDisjointTimerQuery(this.gl,this._disabledExtensions));return this._disjointTimerQuery}},
{key:"textureFloat",get:function(){this._textureFloat||(this._textureFloat=w.loadTextureFloat(this.gl,this._disabledExtensions));return this._textureFloat}},{key:"colorBufferFloat",get:function(){this._colorBufferFloat||(this._colorBufferFloat=w.loadColorBufferFloat(this.gl,this._disabledExtensions));return this._colorBufferFloat}},{key:"blendMinMax",get:function(){this._minMaxBlending||(this._minMaxBlending=w.loadMinMaxBlending(this.gl,this._disabledExtensions));return this._minMaxBlending}},{key:"depthTexture",
get:function(){null===this._depthTexture&&(this._depthTexture=w.loadBooleanExtension(this.gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]));return this._depthTexture}},{key:"standardDerivatives",get:function(){null===this._standardDerivatives&&(this._standardDerivatives=w.loadBooleanExtension(this.gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"]));return this._standardDerivatives}},{key:"shaderTextureLOD",
get:function(){null===this._shaderTextureLOD&&(this._shaderTextureLOD=w.loadBooleanExtension(this.gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]));return this._shaderTextureLOD}},{key:"fragDepth",get:function(){null===this._fragDepth&&(this._fragDepth=w.loadBooleanExtension(this.gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"]));return this._fragDepth}},{key:"loseContext",get:function(){this._loseContext||(this._loseContext=n.load(this.gl,this._debugWebGLExtensions));
return this._loseContext}},{key:"textureNorm16",get:function(){this._textureNorm16||(this._textureNorm16=w.loadTextureNorm16(this.gl,this._disabledExtensions));return this._textureNorm16}}]);return k}();a.Capabilities=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["exports","./isWebGL2Context"],function(a,b){let c=function(g,h,w,n,f,l,k,e){this.createQuery=g;this.resultAvailable=h;this.getResult=w;this.disjoint=n;this.beginTimeElapsed=
f;this.endTimeElapsed=l;this.createTimestamp=k;this.timestampBits=e};a.DisjointTimerQuery=c;a.createDisjointTimerQuery=function(g,h){if(h.disjointTimerQuery)return null;let w=g.getExtension("EXT_disjoint_timer_query_webgl2");return w&&b(g)?new c(()=>g.createQuery(),n=>g.getQueryParameter(n,g.QUERY_RESULT_AVAILABLE),n=>g.getQueryParameter(n,g.QUERY_RESULT),()=>g.getParameter(w.GPU_DISJOINT_EXT),n=>g.beginQuery(w.TIME_ELAPSED_EXT,n),()=>g.endQuery(w.TIME_ELAPSED_EXT),n=>w.queryCounterEXT(n,w.TIMESTAMP_EXT),
()=>g.getQuery(w.TIMESTAMP_EXT,w.QUERY_COUNTER_BITS_EXT)):(w=g.getExtension("EXT_disjoint_timer_query"))?new c(()=>w.createQueryEXT(),n=>w.getQueryObjectEXT(n,w.QUERY_RESULT_AVAILABLE_EXT),n=>w.getQueryObjectEXT(n,w.QUERY_RESULT_EXT),()=>g.getParameter(w.GPU_DISJOINT_EXT),n=>w.beginQueryEXT(w.TIME_ELAPSED_EXT,n),()=>w.endQueryEXT(w.TIME_ELAPSED_EXT),n=>w.queryCounterEXT(n,w.TIMESTAMP_EXT),()=>w.getQueryEXT(w.TIMESTAMP_EXT,w.QUERY_COUNTER_BITS_EXT)):null};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/webgl/capabilities/DrawBuffers":function(){define(["exports","./isWebGL2Context"],function(a,b){a.load=function(c,g){return g.disjointTimerQuery?null:b(c)?{drawBuffers:c.drawBuffers.bind(c),MAX_DRAW_BUFFERS:c.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:c.MAX_COLOR_ATTACHMENTS}:g.drawBuffers?null:(c=c.getExtension("WEBGL_draw_buffers"))?{drawBuffers:c.drawBuffersWEBGL.bind(c),MAX_DRAW_BUFFERS:c.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:c.MAX_COLOR_ATTACHMENTS_WEBGL}:null};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/webgl/capabilities/Instancing":function(){define(["exports","./isWebGL2Context"],function(a,b){a.load=function(c){return b(c)?{drawArraysInstanced:c.drawArraysInstanced.bind(c),drawElementsInstanced:c.drawElementsInstanced.bind(c),vertexAttribDivisor:c.vertexAttribDivisor.bind(c)}:(c=c.getExtension("ANGLE_instanced_arrays"))?{drawArraysInstanced:c.drawArraysInstancedANGLE.bind(c),drawElementsInstanced:c.drawElementsInstancedANGLE.bind(c),vertexAttribDivisor:c.vertexAttribDivisorANGLE.bind(c)}:
null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/load":function(){define(["exports","./isWebGL2Context"],function(a,b){a.loadBooleanExtension=function(c,g,h,w,n){if(w&&b(c))return!0;if(g[h])return!1;for(const f of n)if(c.getExtension(f))return!0;return!1};a.loadColorBufferFloat=function(c,g){if(b(c)){var h=!g.colorBufferFloat&&c.getExtension("EXT_color_buffer_half_float"),w=!g.colorBufferFloat&&c.getExtension("EXT_color_buffer_float");g=!g.floatBlend&&!g.colorBufferFloat&&
c.getExtension("EXT_float_blend");return h||w||g?{textureFloat:!!w,textureHalfFloat:!!h,floatBlend:!!g,R16F:c.R16F,RG16F:c.RG16F,RGBA16F:c.RGBA16F,R32F:c.R32F,RG32F:c.RG32F,RGBA32F:c.RGBA32F,R11F_G11F_B10F:c.R11F_G11F_B10F,RGB16F:c.RGB16F}:null}return c instanceof WebGLRenderingContext?(h=!g.colorBufferFloat&&c.getExtension("EXT_color_buffer_half_float"),w=!g.colorBufferFloat&&c.getExtension("WEBGL_color_buffer_float"),c=!g.floatBlend&&!g.colorBufferFloat&&c.getExtension("EXT_float_blend"),h||w||
c?{textureFloat:!!w,textureHalfFloat:!!h,floatBlend:!!c,RGBA16F:h?h.RGBA16F_EXT:void 0,RGB16F:h?h.RGB16F_EXT:void 0,RGBA32F:w?w.RGBA32F_EXT:void 0}:null):null};a.loadCompressedTextureETC=function(c,g){return g.compressedTextureETC?null:(c=c.getExtension("WEBGL_compressed_texture_etc"))?{COMPRESSED_R11_EAC:c.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:c.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:c.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:c.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:c.COMPRESSED_RGB8_ETC2,
COMPRESSED_SRGB8_ETC2:c.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:c.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:c.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:c.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:c.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null};a.loadCompressedTextureS3TC=function(c,g){return g.compressedTextureS3TC?null:(c=c.getExtension("WEBGL_compressed_texture_s3tc"))?{COMPRESSED_RGB_S3TC_DXT1:c.COMPRESSED_RGB_S3TC_DXT1_EXT,
COMPRESSED_RGBA_S3TC_DXT1:c.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:c.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:c.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null};a.loadMinMaxBlending=function(c,g){return b(c)?{MIN:c.MIN,MAX:c.MAX}:g.blendMinMax?null:(c=c.getExtension("EXT_blend_minmax"))?{MIN:c.MIN_EXT,MAX:c.MAX_EXT}:null};a.loadTextureFilterAnisotropicCapability=function(c,g){return g.textureFilterAnisotropic?null:(c=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||
c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))?{MAX_TEXTURE_MAX_ANISOTROPY:c.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:c.TEXTURE_MAX_ANISOTROPY_EXT}:null};a.loadTextureFloat=function(c,g){if(b(c))return{textureFloat:!0,textureFloatLinear:!g.textureFloatLinear&&!!c.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!g.textureHalfFloatLinear&&!!c.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:c.HALF_FLOAT,R16F:c.R16F,RG16F:c.RG16F,RGBA16F:c.RGBA16F,
R32F:c.R32F,RG32F:c.RG32F,RGBA32F:c.RGBA32F,R11F_G11F_B10F:c.R11F_G11F_B10F,RGB16F:c.RGB16F};if(c instanceof WebGLRenderingContext){const h=!g.textureHalfFloat&&c.getExtension("OES_texture_half_float");return{textureFloat:!g.textureFloat&&!!c.getExtension("OES_texture_float"),textureFloatLinear:!g.textureFloatLinear&&!!c.getExtension("OES_texture_float_linear"),textureHalfFloat:!!h,textureHalfFloatLinear:!g.textureHalfFloatLinear&&!!c.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:h?h.HALF_FLOAT_OES:
void 0}}return null};a.loadTextureNorm16=function(c,g){return!b(c)||g.textureNorm16?null:(c=c.getExtension("EXT_texture_norm16"))?{R16:c.R16_EXT,RG16:c.RG16_EXT,RGB16:c.RGB16_EXT,RGBA16:c.RGBA16_EXT,R16_SNORM:c.R16_SNORM_EXT,RG16_SNORM:c.RG16_SNORM_EXT,RGB16_SNORM:c.RGB16_SNORM_EXT,RGBA16_SNORM:c.RGBA16_SNORM_EXT}:null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/LoseContext":function(){define(["exports"],function(a){a.load=function(b,c){const g=c.loseContext&&
b.getExtension("WEBGL_lose_context");return g?{loseRenderingContext:()=>g.loseContext()}:null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["exports","./isWebGL2Context"],function(a,b){a.load=function(c,g){return b(c)?{createVertexArray:c.createVertexArray.bind(c),deleteVertexArray:c.deleteVertexArray.bind(c),bindVertexArray:c.bindVertexArray.bind(c)}:g.vao?null:(c=c.getExtension("OES_vertex_array_object")||c.getExtension("MOZ_OES_vertex_array_object")||
c.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:c.createVertexArrayOES.bind(c),deleteVertexArray:c.deleteVertexArrayOES.bind(c),bindVertexArray:c.bindVertexArrayOES.bind(c)}:null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureRepository":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./basicInterfaces ./ContentObjectType ./TextureTechnique ./Util ../../../support/Scheduler".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r){const x=w.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");a.TextureRepository=function(E){function y(p,B,D){var C=E.call(this,{})||this;C._stage=p;C._techniqueRepository=B;C._rctx=D;C._textures=new Map;C._loadingCount=0;C._frameUpdates=new Map;C.events=new h;C._frameTask=p.resourceController.scheduler.registerTask(r.TaskPriority.TEXTURE_UNLOAD);return C}b._inheritsLoose(y,E);var A=y.prototype;A.normalizeCtorArgs=function(){return{}};A.dispose=
function(){this._frameTask.remove();this._stage.forEachOfType(v.ContentObjectType.Texture,p=>p.unload())};A.acquire=function(p){const B=this._textures.get(p);return B?(B.ref(),n.unwrapOr(B.loadingPromise,B)):this._createNewRef(p)};A.update=function(){let p=!1;this._frameUpdates.forEach(B=>{const D=B.texture.frameUpdate(this._rctx,this.textureTechnique,B.previousToken);0<=D&&D!==B.previousToken&&(B.previousToken=D,p=!0)});p&&this.events.emit("changed",z.RenderRequestType.BACKGROUND)};A._createNewRef=
function(p){const B=this._stage.getObject(p);if(n.isNone(B))return t.assert(void 0!==B),null;const D=B.events.on("unloaded",()=>{D.remove();this._onTextureUnloaded(p)}),C=new u(p,()=>{this._frameTask.schedule(()=>{C.isUnreferenced&&B.unload()})});this._textures.set(p,C);C.ref();if(n.isSome(B.glTexture))return this._updateGLTexture(C,B.glTexture),B.requiresFrameUpdates&&this._frameUpdates.set(p,{texture:B,previousToken:-1}),C;this._loadingCount++;C.loadingPromise=this._stage.schedule(()=>{const F=
B.load(this._rctx,()=>this.textureTechnique),G=H=>{this._loadingCount--;C.loadingPromise=null;this._updateGLTexture(C,H);B.requiresFrameUpdates&&this._frameUpdates.set(p,{texture:B,previousToken:-1});return C},L=H=>{this._loadingCount--;C.loadingPromise=null;f.isAbortError(H)||x.error(H);return null};return f.isPromiseLike(F)?F.then(G,L):G(F)});return C.loadingPromise};A._updateGLTexture=function(p,B){p.glTexture=B;this.events.emit("changed",z.RenderRequestType.UPDATE)};A._onTextureUnloaded=function(p){this._textures.delete(p);
this._frameUpdates.delete(p)};b._createClass(y,[{key:"updating",get:function(){return 0<this._loadingCount||this._frameTask.updating}},{key:"textureTechnique",get:function(){n.isNone(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(q.TextureTechnique,new q.TextureTechniqueConfiguration));return this._textureTechnique}}]);return y}(g);c.__decorate([l.property()],a.TextureRepository.prototype,"_loadingCount",void 0);c.__decorate([l.property()],a.TextureRepository.prototype,
"_frameTask",void 0);c.__decorate([l.property()],a.TextureRepository.prototype,"updating",null);a.TextureRepository=c.__decorate([m.subclass("esri.views.3d.webgl-engine.lib.TextureRepository")],a.TextureRepository);let u=function(){function E(A,p){this.id=A;this._release=p;this._refCount=0}var y=E.prototype;y.ref=function(){++this._refCount};y.release=function(){--this._refCount;0<this._refCount||(0===this._refCount?this._release():(x.error("Cannot dereference texture that has no references!"),this._refCount=
0))};b._createClass(E,[{key:"isUnreferenced",get:function(){return 0===this._refCount}}]);return E}();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/internal/WaterTextureRepository":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../assets ../../../../../core/Accessor ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../support/requestImageUtils ../../lib/basicInterfaces ../../../../webgl/enums ../../../../webgl/Texture".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v){const q=w.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");a.WaterTextureRepository=function(t){function r(){var u=t.apply(this,arguments)||this;u._data=[];u.loadingState=m.ResourceState.NOT_LOADED;return u}b._inheritsLoose(r,t);var x=r.prototype;x.dispose=function(){this.loadingState=m.ResourceState.NOT_LOADED;this._data.forEach(u=>u.dispose());this._data.length=0};x.loadTextures=function(u){const E=[g.getAssetUrl("esri/images/materials/water/normals.jpg"),
g.getAssetUrl("esri/images/materials/water/perturbation.jpg")];this.loadingState=m.ResourceState.LOADING;Promise.all(E.map(y=>d.requestImage(y))).then(y=>{y.forEach(A=>this._data.push(new v.Texture(u,{target:z.TextureType.TEXTURE_2D,pixelFormat:z.PixelFormat.RGBA,dataType:z.PixelType.UNSIGNED_BYTE,wrapMode:z.TextureWrapMode.REPEAT,samplingMode:z.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8,width:A.width,height:A.height},A)));this.loadingState=m.ResourceState.LOADED}).catch(y=>
{q.error("Failed to load textures for water material.",y);this.loadingState=m.ResourceState.NOT_LOADED})};x.bind=function(u){this.ready&&(u.bindTexture(this._data[0],"texWaveNormal"),u.bindTexture(this._data[1],"texWavePerturbation"))};b._createClass(r,[{key:"updating",get:function(){return this.loadingState===m.ResourceState.LOADING}},{key:"ready",get:function(){return this.loadingState===m.ResourceState.LOADED}}]);return r}(h);c.__decorate([n.property()],a.WaterTextureRepository.prototype,"loadingState",
void 0);c.__decorate([n.property({type:Boolean,readOnly:!0})],a.WaterTextureRepository.prototype,"updating",null);a.WaterTextureRepository=c.__decorate([e.subclass("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],a.WaterTextureRepository);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/parts/ScreenshotManager":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../../../../chunks/vec4f64 ../lib/AutoDisposable ../lib/basicInterfaces ../../../support/screenshotUtils ../../../webgl/enums ../../../webgl/FramebufferObject".split(" "),
function(a,b,c,g,h,w,n,f,l,k){w=function(e){function d(z,v,q,t,r,x){var u=e.call(this)||this;u._rctx=z;u._renderScene=v;u._requestRenderScene=q;u._renderOverlay=t;u._forceCameraHook=r;u._disposeOffscreenBuffers=x;u.supersample=!0;u._screenshotQueue=[];return u}b._inheritsLoose(d,e);var m=d.prototype;m.dispose=function(){this._rctx=null};m.takeScreenshot=function(z){this._requestRenderScene(n.RenderRequestType.BACKGROUND);const v=g.createResolver();this._screenshotQueue.push({settings:z,resolver:v});
return v.promise};m.update=function(z){for(const q of this._screenshotQueue){if(this.isDisposed){q.resolver.reject();continue}var v={...q.settings,pixelRatio:q.settings.pixelRatio*z.viewCamera.pixelRatio};const t=this._ensureScreenshotEncodeCanvas(),r=this._renderScreenshot(z,v);v=f.encodeResult(r,v,t,{flipY:!0,premultipliedAlpha:!0});q.resolver(v)}this._screenshotQueue.length=0};m._renderScreenshotOverlay=function(z,v,q){if(c.isNone(this._renderOverlay))return v;z.width=v.width;z.height=v.height;
const t=z.getContext("2d"),r=q.pixelRatio;t.save();t.translate(0,v.height);t.scale(1,-1);q.region&&t.translate(-q.region.x,-q.region.y);t.scale(r,r);v=this._renderOverlay(z,v);t.restore();return v};m._readbackScreenshot=function(z,v){return z.resample?this._readbackScreenshotResampled(z,v):this._readbackScreenshotImmediate(z,v)};m._readbackScreenshotResampled=function(z,v){const {framebufferWidth:q,framebufferHeight:t,region:r,resample:x}=z,u=this._ensureScreenshotEncodeCanvas();let E=f.createEmptyImageData(q,
t,u);this._rctx.gl.readPixels(0,0,q,t,l.PixelFormat.RGBA,l.DataType.UNSIGNED_BYTE,new Uint8Array(E.data.buffer));v();E=this._renderScreenshotOverlay(u,E,{...z,region:null});z=f.createEmptyImageData(r.width,r.height,u);return f.resampleHermite(E,z,!0,x.region.x,t-(x.region.y+x.region.height),x.region.width,x.region.height)};m._readbackScreenshotImmediate=function(z,v){const {framebufferHeight:q,region:t}=z,r=this._ensureScreenshotEncodeCanvas(),x=f.createEmptyImageData(t.width,t.height,r);this._rctx.gl.readPixels(t.x,
q-(t.y+t.height),t.width,t.height,l.PixelFormat.RGBA,l.DataType.UNSIGNED_BYTE,new Uint8Array(x.data.buffer));v();return this._renderScreenshotOverlay(r,x,z)};m._renderScreenshot=function(z,v){let q=null;const t=z.viewCamera,{framebufferWidth:r,framebufferHeight:x}=v;var u=!1;z=v.disableDecorations&&z.frameHasDecorations;var E=v.ignorePadding&&t.pixelRatio!==v.pixelRatio;if(z=r!==t.fullWidth||x!==t.fullHeight||z||E){E=t.clone();if(v.ignorePadding){u=h.clone(E.padding);for(var y=0;4>y;y++)u[y]=Math.round(u[y]/
E.pixelRatio*v.pixelRatio);E.padding=u}E.fullWidth=r;E.fullHeight=x;E.pixelRatio=v.pixelRatio;u=t.fovX-E.fovX;y=t.fovY-E.fovY;0>u&&u<y?E.fovX=t.fovX:0>y&&y<u&&(E.fovY=t.fovY);this._forceCameraHook(E);u=!0;q=new k.FramebufferObject(this._rctx,{width:E.fullWidth,height:E.fullHeight,colorTarget:l.TargetType.TEXTURE,depthStencilTarget:l.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER});this._renderScene(q,E,v.disableDecorations?n.Decorations.OFF:n.Decorations.ON);this._disposeOffscreenBuffers()}E=
()=>{this._rctx.bindFramebuffer(null);c.disposeMaybe(q)};v=this._readbackScreenshot(v,E);E();if(z&&!this._rctx.contextAttributes.alpha)for(z=3;z<v.data.length;z+=4)v.data[z]=255;u&&this._forceCameraHook(t);return v};m._ensureScreenshotEncodeCanvas=function(){this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas};return d}(w.AutoDisposable);a.ScreenshotManager=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/intersectorUtilsConversions":function(){define("exports ../../../../core/maybe ../../layers/i3s/Intersector ../../terrain/Intersector ./intersectorUtils ./lodRendering/Intersector".split(" "),
function(a,b,c,g,h,w){function n(k,e){if(b.isNone(k)||b.isNone(k.graphicUid))return null;const d=l(k,e);return b.isNone(d)?null:d===e.graphics?b.isSome(e.graphicsView)?e.graphicsView.getGraphicFromGraphicUid(k.graphicUid):null:(e=e.allLayerViews.find(m=>m.layer===d))&&!e.suspended&&"getGraphicFromGraphicUid"in e&&b.isSome(k.graphicUid)?e.getGraphicFromGraphicUid(k.graphicUid):null}function f(k,e){const d=l(k,e);return b.isNone(d)?null:(e=e.allLayerViews.find(m=>m.layer===d))&&!e.suspended&&"getGraphicFromIntersectorTarget"in
e?e.getGraphicFromIntersectorTarget(k):null}function l(k,e){return b.isNone(k.layerUid)?null:b.isSome(e.graphicsView)&&k.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.findLayerByUid(k.layerUid)}a.toGraphic=function(k,e){return h.isObjectIntersectorResult(k)||h.isHudIntersectorResult(k)?n(k.target.object.metadata,e):c.isPclIntersectorResult(k)?k.target.createGraphic():g.isOverlayIntersectorResult(k)||w.isLodIntersectorResult(k)?n(k.target,e):c.isI3sIntersectorResult(k)?f(k.target,e):
null};a.toOwner=function(k,e){if(h.isObjectIntersectorResult(k)||h.isHudIntersectorResult(k))return l(k.target.object.metadata,e);if(g.isTerrainIntersectorResult(k)){var d;return null==(d=e.map)?void 0:d.ground}return c.isPclIntersectorResult(k)||c.isI3sIntersectorResult(k)||g.isOverlayIntersectorResult(k)?l(k.target,e):null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/Intersector":function(){define(["exports","../../webgl-engine/lib/IntersectorInterfaces","../../webgl-engine/lib/intersectorUtils"],
function(a,b,c){a.isI3sIntersectorResult=function(g){return c.isValidIntersectorResult(g)&&g.intersector===b.IntersectorType.I3S&&!!g.target};a.isPclIntersectorResult=function(g){return c.isValidIntersectorResult(g)&&g.intersector===b.IntersectorType.PCL&&!!g.target};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/terrain/Intersector":function(){define(["exports","../webgl-engine/lib/IntersectorInterfaces","../webgl-engine/lib/intersectorUtils"],function(a,b,c){a.isOverlayIntersectorResult=
function(g){return c.isValidIntersectorResult(g)&&g.intersector===b.IntersectorType.OVERLAY&&!!g.target};a.isTerrainIntersectorResult=function(g){return c.isValidIntersectorResult(g)&&g.intersector===b.IntersectorType.TERRAIN&&!!g.target};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/Intersector":function(){define(["exports","../IntersectorInterfaces","../intersectorUtils"],function(a,b,c){a.isLodIntersectorResult=function(g){return c.isValidIntersectorResult(g)&&
g.intersector===b.IntersectorType.LOD&&!!g.target};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/support/hitTestSelectUtils":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){function c(){c=b._asyncToGenerator(function*(g,h){if("2d"===g.type)return g.hitTest(h);g=yield g.hitTest(h);const w=g.results[0];h=g.results.findIndex(n=>n.distance!==w.distance);-1!==h&&(g.results=g.results.slice(0,h));return g});return c.apply(this,arguments)}a.hitTestSelectSameDistance=
function(g,h){return c.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/support/WebGLRequirements":function(){define(["exports","../../core/Error","../webgl/capabilities","../webgl/context-util"],function(a,b,c,g){a.check=function(h){var w;a:{for(w=g.getContextTypes(h);1<w.length;){const n=c.getWebGLCapabilities(w.shift());if(n.available){w=n;break a}}w=c.getWebGLCapabilities(w.shift())}if(!w.available)return new b("webgl:required","WebGL is required but not supported.");
if("3d"===h&&w.majorPerformanceCaveat)return new b("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!w.supportsHighPrecisionFragment)return new b("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!w.supportsVertexShaderSamplers)return new b("webgl:vertex-shader-samplers-required",
"WebGL support for vertex shader samplers is required but not supported.");if(w.type===g.ContextType.WEBGL1){if(!w.supportsElementIndexUint)return new b("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!w.supportsStandardDerivatives)return new b("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!w.supportsInstancedArrays)return new b("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null};
Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/webgl/capabilities":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe","./context-util"],function(a,b,c,g){function h(){if(!f){{const m=new e,z=n(g.ContextType.WEBGL1,m);c.isNone(z)||(m.supportsElementIndexUint=null!==z.getExtension("OES_element_index_uint"),m.supportsStandardDerivatives=null!==z.getExtension("OES_standard_derivatives"),m.supportsInstancedArrays=null!==z.getExtension("ANGLE_instanced_arrays"),
m.supportsTextureFloat=null!==z.getExtension("OES_texture_float"));f=m}}return f}function w(){if(!l){{const m=new d,z=n(g.ContextType.WEBGL2,m);c.isNone(z);l=m}}return l}function n(m,z){const v=document.createElement("canvas");if(!v)return null;let q=g.createContext(v,m,{failIfMajorPerformanceCaveat:!0});c.isNone(q)&&(q=g.createContext(v,m),c.isSome(q)&&(z.majorPerformanceCaveat=!0));if(c.isNone(q))return q;if(m===g.ContextType.WEBGL1){if(m=q.getParameter(q.VERSION),m=null==m?void 0:m.match(/^WebGL\s+([\d.]*)/))m=
parseFloat(m[1]),z.available=.94<=m}else z.available=!0;z.maxTextureSize=q.getParameter(q.MAX_TEXTURE_SIZE);z.supportsVertexShaderSamplers=0<q.getParameter(q.MAX_VERTEX_TEXTURE_IMAGE_UNITS);if(m=q.getShaderPrecisionFormat(q.FRAGMENT_SHADER,q.HIGH_FLOAT))z.supportsHighPrecisionFragment=0<m.precision;return q}let f,l,k=function(){this.majorPerformanceCaveat=this.available=!1;this.maxTextureSize=0;this.supportsHighPrecisionFragment=this.supportsVertexShaderSamplers=!1},e=function(m){function z(){var v=
m.apply(this,arguments)||this;v.type=g.ContextType.WEBGL1;v.supportsElementIndexUint=!1;v.supportsStandardDerivatives=!1;v.supportsInstancedArrays=!1;v.supportsTextureFloat=!1;return v}b._inheritsLoose(z,m);return z}(k),d=function(m){function z(){var v=m.apply(this,arguments)||this;v.type=g.ContextType.WEBGL2;return v}b._inheritsLoose(z,m);return z}(k);a.WebGL1Capabilities=e;a.WebGL2Capabilities=d;a.getWebGL1Capabilities=h;a.getWebGL2Capabilities=w;a.getWebGLCapabilities=function(m){switch(m){case g.ContextType.WEBGL1:return h();
case g.ContextType.WEBGL2:return w()}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/ui/3d/DefaultUI3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../DefaultUI".split(" "),function(a,b,c,g,h,w,n,f){g=function(l){function k(e){e=l.call(this,e)||this;e.components=
["attribution","zoom","navigation-toggle","compass"];return e}a._inheritsLoose(k,l);return k}(f);b.__decorate([c.property()],g.prototype,"components",void 0);return g=b.__decorate([n.subclass("esri.views.ui.3d.DefaultUI3D")],g)})},"esri/views/ui/DefaultUI":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v){g.getLogger("esri.views.ui.DefaultUI");c=function(q){function t(x){x=q.call(this,x)||this;x._defaultPositionLookup={attribution:"manual",compass:"top-leading","navigation-toggle":"top-leading",zoom:"top-leading"};x.components=[];return x}a._inheritsLoose(t,q);var r=t.prototype;r.initialize=function(){this._handles.add([h.watch(()=>this.components,this._componentsWatcher.bind(this),h.initial),h.watch(()=>this.view,this._updateViewAwareWidgets.bind(this),h.initial)])};
r._add=function(x,u,E,y){if("string"===typeof x&&this._defaultPositionLookup[x]){if(this._find(x))return;x=this._createComponent(x)}q.prototype._add.call(this,x,u,E,y)};r._removeComponents=function(x){x.forEach(u=>{if(u=this._find(u))this.remove(u),u.destroy()})};r._updateViewAwareWidgets=function(x){this.components.forEach(u=>{(u=(u=this._find(u))&&u.widget)&&void 0!==u.view&&(u.view=x)})};r._componentsWatcher=function(x,u){this._removeComponents(u);this._addComponents(x);this._adjustPadding(x)};
r._adjustPadding=function(x){-1!==x.indexOf("attribution")||this._isOverridden("padding")||({top:x}=this.padding,this.padding=x)};r._addComponents=function(x){this.initialized&&x.forEach(u=>this.add(this._createComponent(u),this._defaultPositionLookup[u]))};r._createComponent=function(x){const u=this._createWidget(x);if(u)return new k({id:x,node:u})};r._createWidget=function(x){if("attribution"===x)return this._createAttribution();if("compass"===x)return this._createCompass();if("navigation-toggle"===
x)return this._createNavigationToggle();if("zoom"===x)return this._createZoom()};r._createAttribution=function(){return new d({view:this.view})};r._createCompass=function(){return new m({view:this.view})};r._createNavigationToggle=function(){return new z({view:this.view})};r._createZoom=function(){return new v({view:this.view})};return t}(e);b.__decorate([w.property()],c.prototype,"components",void 0);return c=b.__decorate([l.subclass("esri.views.ui.DefaultUI")],c)})},"esri/views/ui/Component":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/domUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,g,h,w,n,f,l){c=function(k){function e(){var m=k.apply(this,arguments)||this;m.widget=null;return m}a._inheritsLoose(e,k);var d=e.prototype;d.destroy=function(){this.widget&&this.widget.destroy();this.node=null};d.castNode=function(m){if(!m)return this._set("widget",null),null;if("string"===typeof m||m&&"nodeType"in m)return this._set("widget",null),g.byId(m);m&&"function"===typeof m.render&&!m.domNode&&(m.domNode=document.createElement("div"));this._set("widget",m);return m.domNode};
a._createClass(e,[{key:"id",get:function(){return this.get("widget.id")||this.get("node.id")}},{key:"node",set:function(m){const z=this._get("node");m!==z&&(m&&m.classList.add("esri-component"),z&&z.classList.remove("esri-component"),this._set("node",m))}}]);return e}(c);b.__decorate([h.property({dependsOn:[]})],c.prototype,"id",null);b.__decorate([h.property()],c.prototype,"node",null);b.__decorate([f.cast("node")],c.prototype,"castNode",null);b.__decorate([h.property({readOnly:!0})],c.prototype,
"widget",void 0);return c=b.__decorate([l.subclass("esri.views.ui.Component")],c)})},"esri/views/ui/UI":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/domUtils ../../core/Evented ../../core/Handles ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ./Component ../../widgets/support/widgetUtils ../../core/Logger ../../widgets/support/widgetThemeUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v){function q(u){const E="object"===typeof u&&null!==u&&Object.getPrototypeOf(u);return null!==E&&E!==Object.prototype||!("component"in u||"index"in u||"position"in u)?null:u}function t(u,{top:E,bottom:y,left:A,right:p}){u.style.top=E;u.style.bottom=y;u.style.left=A;u.style.right=p}const r={left:0,top:0,bottom:0,right:0},x={bottom:30,top:15,right:15,left:15};g=function(u){function E(A){var p=u.call(this,A)||this;p._cornerNameToContainerLookup={};p._positionNameToContainerLookup=
{};p._components=[];p._componentToKey=new Map;p._handles=new h;p.view=null;p._applyViewPadding=()=>{const B=p.container;B&&t(B,p._toPxPosition(p._getViewPadding()))};p._applyUIPadding=()=>{const B=p._innerContainer;B&&t(B,p._toPxPosition(p.padding))};p._initContainers();return p}a._inheritsLoose(E,u);var y=E.prototype;y.initialize=function(){this._handles.add([w.watch(()=>{var A;return[null==(A=this.view)?void 0:A.padding,this.container]},this._applyViewPadding,w.initial),w.watch(()=>this.padding,
this._applyUIPadding,w.initial)])};y.destroy=function(){this.container=null;for(const A of this._components)A.destroy();this._components.length=0;this._handles.destroy();this._componentToKey.clear()};y.castPadding=function(A){return"number"===typeof A?{bottom:A,top:A,right:A,left:A}:{...x,...A}};y.add=function(A,p){let B,D;if(Array.isArray(A))A.forEach(F=>this.add(F,p));else{var C=q(A);C&&({index:B,position:p,component:A,key:D}=C);p&&"object"===typeof p&&({index:B,key:D,position:p}=p);!A||p&&!this._isValidPosition(p)||
this._add(A,p,B,D)}};y.remove=function(A,p){if(A){if(Array.isArray(A))return A.map(C=>this.remove(C,p));var B=this._find(A);if(B){var D=this._componentToKey;if(!D.has(A)||D.get(A)===p)return D=this._components.indexOf(B),B.node.parentNode&&B.node.parentNode.removeChild(B.node),this._componentToKey.delete(A),this._components.splice(D,1)[0]}}};y.empty=function(A){if(Array.isArray(A))return A.map(p=>this.empty(p)).reduce((p,B)=>p.concat(B));A=A||"manual";return"manual"===A?Array.prototype.slice.call(this._manualContainer.children).filter(p=>
!p.classList.contains("esri-ui-corner")).map(p=>this.remove(p)):this._isValidPosition(A)?Array.prototype.slice.call(this._cornerNameToContainerLookup[A].children).map(this.remove,this):null};y.move=function(A,p){Array.isArray(A)&&A.forEach(C=>this.move(C,p));if(A){var B=q(A)||q(p);if(B){var D=B.index;p=B.position;A=B.component||A}(!p||this._isValidPosition(p))&&(A=this.remove(A))&&this.add(A,{position:p,index:D})}};y.find=function(A){return A?(A=this._findById(A))&&(A.widget||A.node):null};y.getPosition=
function(A){for(const p in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[p].contains(A))return p;return null};y._add=function(A,p,B,D){A instanceof d||(A=new d({node:A}));this._place({component:A,position:p,index:B});this._components.push(A);D&&this._componentToKey.set(A,D)};y._find=function(A){return A?A instanceof d?this._findByComponent(A):"string"===typeof A?this._findById(A):this._findByNode(A.domNode||A):null};y._getViewPadding=function(){return this.get("view.padding")||
r};y._attachContainers=function(A){A.appendChild(this._innerContainer);A.appendChild(this._manualContainer)};y._initContainers=function(){var A=document.createElement("div");A.classList.add("esri-ui-inner-container");A.classList.add("esri-ui-corner-container");const p=document.createElement("div");p.classList.add("esri-ui-inner-container");p.classList.add("esri-ui-manual-container");const B=document.createElement("div");B.classList.add("esri-ui-top-left");B.classList.add("esri-ui-corner");A.appendChild(B);
const D=document.createElement("div");D.classList.add("esri-ui-top-right");D.classList.add("esri-ui-corner");A.appendChild(D);const C=document.createElement("div");C.classList.add("esri-ui-bottom-left");C.classList.add("esri-ui-corner");A.appendChild(C);const F=document.createElement("div");F.classList.add("esri-ui-bottom-right");F.classList.add("esri-ui-corner");A.appendChild(F);this._innerContainer=A;this._manualContainer=p;A=m.isRTL();this._cornerNameToContainerLookup={"top-left":B,"top-right":D,
"bottom-left":C,"bottom-right":F,"top-leading":A?D:B,"top-trailing":A?B:D,"bottom-leading":A?F:C,"bottom-trailing":A?C:F};this._positionNameToContainerLookup={manual:p,...this._cornerNameToContainerLookup}};y._isValidPosition=function(A){return!!this._positionNameToContainerLookup[A]};y._place=function(A){const p=A.component,B=A.index;A=this._positionNameToContainerLookup[A.position||"manual"];var D=-1<B,C=p.widget;C&&!C._started&&"function"===typeof C.postMixInProperties&&"function"===typeof C.buildRendering&&
"function"===typeof C.postCreate&&"function"===typeof C.startup&&p.widget.startup();D?(D=Array.prototype.slice.call(A.children),0===B?A.firstChild?c.insertBefore(p.node,A.firstChild):A.appendChild(p.node):B>=D.length?A.appendChild(p.node):c.insertBefore(p.node,D[B])):A.appendChild(p.node)};y._toPxPosition=function(A){return{top:this._toPxUnit(A.top),left:this._toPxUnit(A.left),right:this._toPxUnit(A.right),bottom:this._toPxUnit(A.bottom)}};y._toPxUnit=function(A){return 0===A?"0":A+"px"};y._findByComponent=
function(A){let p=null,B;this._components.some(D=>{(B=D===A)&&(p=D);return B});return p};y._findById=function(A){let p=null,B;this._components.some(D=>{(B=D.id===A)&&(p=D);return B});return p};y._findByNode=function(A){let p=null,B;this._components.some(D=>{(B=D.node===A)&&(p=D);return B});return p};a._createClass(E,[{key:"container",set:function(A){const p=this._get("container");A!==p&&(A&&(A.classList.add("esri-ui"),A.classList.add(v.getCalciteThemeClass()),this._attachContainers(A)),p&&(p.classList.remove("esri-ui"),
t(p,{top:"",bottom:"",left:"",right:""}),c.empty(p)),this._set("container",A))}},{key:"height",get:function(){const A=this.get("view.height")||0;if(0===A)return A;const p=this._getViewPadding();return Math.max(A-(p.top+p.bottom),0)}},{key:"padding",get:function(){return this._get("padding")},set:function(A){A?this._override("padding",A):this._clearOverride("padding")}},{key:"width",get:function(){const A=this.get("view.width")||0;if(0===A)return A;const p=this._getViewPadding();return Math.max(A-
(p.left+p.right),0)}}]);return E}(g.EventedAccessor);b.__decorate([n.property()],g.prototype,"container",null);b.__decorate([n.property()],g.prototype,"height",null);b.__decorate([n.property({value:x})],g.prototype,"padding",null);b.__decorate([k.cast("padding")],g.prototype,"castPadding",null);b.__decorate([n.property()],g.prototype,"view",void 0);b.__decorate([n.property()],g.prototype,"width",null);return g=b.__decorate([e.subclass("esri.views.ui.UI")],g)})},"esri/widgets/Attribution":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/watchUtils ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./Attribution/AttributionViewModel ./support/decorators/accessibleHandler ./support/decorators/messageBundle ../core/Logger ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q){h=function(t){function r(u,E){u=t.call(this,u,E)||this;u._isOpen=!1;u._attributionTextOverflowed=!1;u._prevSourceNodeHeight=0;u.iconClass="esri-icon-description";u.itemDelimiter=" | ";u.label=void 0;u.messages=null;u.view=null;u.viewModel=new e;return u}a._inheritsLoose(r,t);var x=r.prototype;x.initialize=function(){this.own(c.on(this,"viewModel.items","change",()=>this.scheduleRender()))};x.render=function(){return v.tsx("div",{bind:this,class:this.classes("esri-attribution esri-widget",
{["esri-attribution--open"]:this._isOpen}),onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())};x.renderPoweredBy=function(){return v.tsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",v.tsx("a",{class:"esri-attribution__link",href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))};x.renderSourcesNode=function(){const u=this._isOpen,E=this._isInteractive,y=E?0:-1,{attributionText:A}=this,p=E?"button":void 0;return v.tsx("div",
{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:this.classes("esri-attribution__sources",{["esri-attribution__sources--open"]:u,["esri-interactive"]:E}),innerHTML:A,role:p,tabIndex:y})};x._afterSourcesNodeCreate=function(u){this._prevSourceNodeHeight=u.clientWidth};x._afterSourcesNodeUpdate=function(u){let E=!1;const {clientHeight:y,clientWidth:A,scrollWidth:p}=u;u=p>=A;const B=this._attributionTextOverflowed!==u;this._attributionTextOverflowed=u;
B&&(E=!0);this._isOpen&&(u=y<this._prevSourceNodeHeight,this._prevSourceNodeHeight=y,u&&(this._isOpen=!1,E=!0));E&&this.scheduleRender()};x._toggleState=function(){this._isInteractive&&(this._isOpen=!this._isOpen)};a._createClass(r,[{key:"_isInteractive",get:function(){return this._isOpen||this._attributionTextOverflowed}},{key:"attributionText",get:function(){return this.viewModel.items.reduce((u,E)=>{-1===u.indexOf(E.text)&&u.push(E.text);return u},[]).join(this.itemDelimiter)}}]);return r}(k);
b.__decorate([f.property()],h.prototype,"_isOpen",void 0);b.__decorate([f.property()],h.prototype,"_isInteractive",null);b.__decorate([f.property()],h.prototype,"_attributionTextOverflowed",void 0);b.__decorate([f.property()],h.prototype,"_prevSourceNodeHeight",void 0);b.__decorate([f.property({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],h.prototype,"attributionText",null);b.__decorate([f.property()],h.prototype,"iconClass",void 0);b.__decorate([f.property()],h.prototype,"itemDelimiter",
void 0);b.__decorate([f.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],h.prototype,"label",void 0);b.__decorate([f.property(),m.messageBundle("esri/widgets/Attribution/t9n/Attribution")],h.prototype,"messages",void 0);b.__decorate([g.aliasOf("viewModel.view")],h.prototype,"view",void 0);b.__decorate([f.property({type:e})],h.prototype,"viewModel",void 0);b.__decorate([d.accessibleHandler()],h.prototype,"_toggleState",null);return h=b.__decorate([l.subclass("esri.widgets.Attribution")],
h)})},"esri/widgets/Attribution/AttributionViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/asyncUtils ../../core/Collection ../../core/HandleOwner ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/contains ../../geometry/support/webMercatorUtils ../../geometry/SpatialReference".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v){function q(u,E){return u&&"copyright"in u&&(!E||"function"===typeof u.originOf&&"user"===u.originOf("copyright"))}function t(u,E){return u.length!==E.length||u.some((y,A)=>y.text!==E[A].text)}function r(u,E,y){y&&E&&(u.find(A=>A.layerView===E&&A.text===y)||u.push({text:y,layerView:E}))}const x=[];c=function(u){function E(A){var p=u.call(this,A)||this;p._clear=()=>{p._fetchedAttributionData.clear();p._pendingAttributions.clear();p.handles.remove("suspension");
p.notifyChange("state")};p._pendingAttributions=new Set;p._fetchedAttributionData=new Map;p.items=new h;p.view=null;p._allLayerViewsChange=B=>{p.handles.remove("suspension");const D=p.get("view.allLayerViews");D&&p.handles.add(D.map(C=>C.watch(["suspended","attributionVisible"],p._updateAttributionItems)),"suspension");B&&B.removed&&B.removed.forEach(C=>{p._pendingAttributions.delete(C);p._fetchedAttributionData.delete(C)});p._updateAttributionItems()};p._updateAttributionItems=()=>{const B=p.get("view.allLayerViews");
x.length=0;B?(B.forEach(D=>{if(!D.suspended&&D.get("layer.attributionVisible")){var C=D.layer;if(q(C,"user"))r(x,D,C.copyright);else if(C.hasAttributionData)if(p._fetchedAttributionData.has(D)){var F=p._fetchedAttributionData.get(D);F?r(x,D,p._getDynamicAttribution(F,p.view,C)):q(C)&&r(x,D,C.copyright)}else p._fetchAttributionData(D);else(F=C.get("portalItem.accessInformation"))?r(x,D,F):r(x,D,C.copyright)}}),t(p.items,x)&&(p.items.removeAll(),p.items.addMany(x)),x.length=0,p.notifyChange("state")):
p._clear()};p.handles.add([n.on(a._assertThisInitialized(p),"view.allLayerViews","change",p._allLayerViewsChange,p._allLayerViewsChange,p._clear),n.whenTrue(a._assertThisInitialized(p),"view.stationary",()=>p._updateAttributionItems())]);return p}a._inheritsLoose(E,u);var y=E.prototype;y.destroy=function(){this.view=null;this._fetchedAttributionData.clear();this._pendingAttributions.clear();this.items.removeAll()};y._fetchAttributionData=function(){var A=a._asyncToGenerator(function*(p){if(!this._pendingAttributions.has(p)){this._pendingAttributions.add(p);
var B=yield g.result(p.layer.fetchAttributionData());this._pendingAttributions.has(p)&&(B=B.ok?this._createContributionIndex(B.value,"bing-maps"===p.layer.type):null,this._pendingAttributions.delete(p),this._fetchedAttributionData.set(p,B));this._updateAttributionItems()}});return function(p){return A.apply(this,arguments)}}();y._createContributionIndex=function(A,p){A=A.contributors;const B={};if(!A)return B;for(let G=0;G<A.length;G++){const L=A[G];var D=L.coverageAreas;if(!D)return;for(const H of D){var C=
H.bbox,F=H.zoomMin-(p&&H.zoomMin?1:0);D=H.zoomMax-(p&&H.zoomMax?1:0);for(C={extent:z.geographicToWebMercator({xmin:C[1],ymin:C[0],xmax:C[3],ymax:C[2],spatialReference:v.WGS84}),attribution:L.attribution||"",score:null!=H.score?H.score:100,id:G};F<=D;F++)B[F]=B[F]||[],B[F].push(C)}}B.maxKey=Math.max.apply(null,Object.keys(B));return B};y._getDynamicAttribution=function(A,p,B){const {extent:D,scale:C}=p;B=B.tileInfo.scaleToZoom(C);B=Math.min(A.maxKey,Math.round(B));if(!D||null==B||-1>=B)return"";A=
A[B];const F=z.project(D.center.clone().normalize(),p.spatialReference),G={};return A?A.filter(L=>{const H=!G[L.id]&&F&&m.extentContainsPoint(L.extent,F);H&&(G[L.id]=!0);return H}).sort((L,H)=>H.score-L.score||L.objectId-H.objectId).map(L=>L.attribution).join(", "):""};a._createClass(E,[{key:"state",get:function(){return this.get("view.ready")?0<this._pendingAttributions.size?"loading":"ready":"disabled"}}]);return E}(w.HandleOwner);b.__decorate([f.property({readOnly:!0,type:h})],c.prototype,"items",
void 0);b.__decorate([f.property({readOnly:!0})],c.prototype,"state",null);b.__decorate([f.property()],c.prototype,"view",void 0);return c=b.__decorate([d.subclass("esri.widgets.Attribution.AttributionViewModel")],c)})},"esri/widgets/Compass":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./Compass/CompassViewModel ./support/decorators/accessibleHandler ./support/decorators/messageBundle ../core/Logger ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v){g=function(q){function t(x,u){x=q.call(this,x,u)||this;x.goToOverride=null;x.iconClass="esri-icon-locate-circled";x.label=void 0;x.messages=null;x.view=null;x.viewModel=new k;return x}a._inheritsLoose(t,q);var r=t.prototype;r.reset=function(){return this.viewModel.reset()};r.render=function(){const {orientation:x,state:u}=this.viewModel;var E="disabled"===u,y="compass"===("rotation"===u?"rotation":"compass");const A=E?-1:0;E={["esri-disabled"]:E,["esri-interactive"]:!E};
y={["esri-icon-compass"]:y,["esri-icon-dial"]:!y};const {messages:p}=this;return z.tsx("div",{bind:this,class:this.classes("esri-compass esri-widget--button esri-widget",E),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:A,"aria-label":p.reset,title:p.reset},z.tsx("span",{"aria-hidden":"true",class:this.classes("esri-compass__icon",y),styles:this._toRotationTransform(x)}),z.tsx("span",{class:"esri-icon-font-fallback-text"},p.reset))};r._reset=function(){this.viewModel.reset()};r._toRotationTransform=
function(x){return{transform:`rotateZ(${x.z}deg)`}};return t}(l);b.__decorate([c.aliasOf("viewModel.goToOverride")],g.prototype,"goToOverride",void 0);b.__decorate([n.property()],g.prototype,"iconClass",void 0);b.__decorate([n.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],g.prototype,"label",void 0);b.__decorate([n.property(),d.messageBundle("esri/widgets/Compass/t9n/Compass")],g.prototype,"messages",void 0);b.__decorate([c.aliasOf("viewModel.view")],g.prototype,"view",void 0);
b.__decorate([n.property({type:k})],g.prototype,"viewModel",void 0);b.__decorate([e.accessibleHandler()],g.prototype,"_reset",null);return g=b.__decorate([f.subclass("esri.widgets.Compass")],g)})},"esri/widgets/Compass/CompassViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../support/GoTo".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){c=function(d){function m(v){v=d.call(this,v)||this;v._handles=new g;v.orientation={x:0,y:0,z:0};v.view=null;v._updateForCamera=v._updateForCamera.bind(a._assertThisInitialized(v));v._updateForRotation=v._updateForRotation.bind(a._assertThisInitialized(v));v._updateRotationWatcher=v._updateRotationWatcher.bind(a._assertThisInitialized(v));return v}a._inheritsLoose(m,d);var z=m.prototype;z.initialize=function(){this._handles.add(h.init(this,"view",this._updateRotationWatcher))};
z.destroy=function(){this._handles.destroy();this.view=this._handles=null};z.reset=function(){if(this.get("view.ready")){var v={};"2d"===this.view.type?v.rotation=0:v.heading=0;this.callGoTo({target:v})}};z._updateForRotation=function(v){void 0!==v&&null!==v&&(this.orientation={z:v})};z._updateForCamera=function(v){v&&(this.orientation={x:0,y:0,z:-v.heading})};z._updateRotationWatcher=function(v){this._handles.removeAll();v&&("2d"===v.type?this._handles.add(h.init(this,"view.rotation",this._updateForRotation)):
this._handles.add(h.init(this,"view.camera",this._updateForCamera)))};a._createClass(m,[{key:"canShowNorth",get:function(){const v=this.get("view.spatialReference");return!(!v||!v.isWebMercator&&!v.isGeographic)}},{key:"state",get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}}]);return m}(e.GoToMixin(c));b.__decorate([w.property({readOnly:!0})],c.prototype,"canShowNorth",null);b.__decorate([w.property()],c.prototype,"orientation",void 0);b.__decorate([w.property({readOnly:!0})],
c.prototype,"state",null);b.__decorate([w.property()],c.prototype,"view",void 0);return c=b.__decorate([k.subclass("esri.widgets.CompassViewModel")],c)})},"esri/widgets/NavigationToggle":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./NavigationToggle/NavigationToggleViewModel ./support/decorators/accessibleHandler ./support/decorators/messageBundle ../core/Logger ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v){g=function(q){function t(x,u){x=q.call(this,x,u)||this;x.iconClass="esri-icon-pan2";x.label=void 0;x.messages=null;x.view=null;x.viewModel=new k;return x}a._inheritsLoose(t,q);var r=t.prototype;r.toggle=function(){return this.viewModel.toggle()};r.render=function(){const x="disabled"===this.get("viewModel.state");var u="pan"===this.get("viewModel.navigationMode");const E={["esri-navigation-toggle__button--active"]:u};u={["esri-navigation-toggle__button--active"]:!u};
const y=x?-1:0,A=this.messages.toggle;return z.tsx("div",{bind:this,class:this.classes("esri-navigation-toggle esri-widget",{["esri-disabled"]:x,["esri-navigation-toggle--horizontal"]:"horizontal"===this.layout}),onclick:this._toggle,onkeydown:this._toggle,tabIndex:y,"aria-label":A,title:A},z.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--pan",E)},z.tsx("span",{class:"esri-icon-pan"})),z.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button",
"esri-navigation-toggle__button--rotate",u)},z.tsx("span",{class:"esri-icon-rotate"})))};r._toggle=function(){this.toggle()};a._createClass(t,[{key:"layout",set:function(x){"horizontal"!==x&&(x="vertical");this._set("layout",x)}}]);return t}(l);b.__decorate([n.property()],g.prototype,"iconClass",void 0);b.__decorate([n.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],g.prototype,"label",void 0);b.__decorate([n.property({value:"vertical"})],g.prototype,"layout",null);b.__decorate([n.property(),
d.messageBundle("esri/widgets/NavigationToggle/t9n/NavigationToggle")],g.prototype,"messages",void 0);b.__decorate([c.aliasOf("viewModel.view")],g.prototype,"view",void 0);b.__decorate([n.property({type:k})],g.prototype,"viewModel",void 0);b.__decorate([e.accessibleHandler()],g.prototype,"_toggle",null);return g=b.__decorate([f.subclass("esri.widgets.NavigationToggle")],g)})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,g,h,w,n,f,l,k){c=function(e){function d(z){z=e.call(this,z)||this;z._handles=new g;z.navigationMode="pan";z.view=null;return z}a._inheritsLoose(d,e);var m=d.prototype;m.initialize=function(){this._handles.add(h.when(this,"view.inputManager",this._setNavigationMode.bind(this)))};m.destroy=function(){this._handles.destroy();this.view=this._handles=null};m.toggle=function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())};
m._setNavigationMode=function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"};a._createClass(d,[{key:"state",get:function(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"}}]);return d}(c);b.__decorate([w.property({readOnly:!0})],c.prototype,"state",null);b.__decorate([w.property()],c.prototype,"navigationMode",void 0);b.__decorate([w.property()],c.prototype,"view",void 0);return c=b.__decorate([k.subclass("esri.widgets.NavigationToggleViewModel")],
c)})},"esri/widgets/Zoom":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./support/widgetUtils ./support/decorators/messageBundle ../core/Logger ./support/jsxFactory ./Zoom/IconButton ./Zoom/ZoomViewModel".split(" "),function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v){g=function(q){function t(x,
u){x=q.call(this,x,u)||this;x.iconClass="esri-icon-zoom-in-magnifying-glass";x.label=void 0;x.messages=null;x.view=null;x.viewModel=new v;return x}a._inheritsLoose(t,q);var r=t.prototype;r.initialize=function(){this._zoomInButton=new z({action:this.zoomIn.bind(this),iconClass:"esri-icon-plus"});this._zoomOutButton=new z({action:this.zoomOut.bind(this),iconClass:"esri-icon-minus"})};r.destroy=function(){this._zoomInButton.destroy();this._zoomOutButton.destroy();this._zoomOutButton=this._zoomInButton=
null};r.render=function(){const x=this.viewModel,u={["esri-zoom--horizontal"]:"horizontal"===this.layout};this._zoomInButton.enabled="ready"===x.state&&x.canZoomIn;this._zoomOutButton.enabled="ready"===x.state&&x.canZoomOut;this._zoomInButton.title=this.messages.zoomIn;this._zoomOutButton.title=this.messages.zoomOut;return m.tsx("div",{class:this.classes("esri-zoom esri-widget",u)},this._zoomInButton.render(),this._zoomOutButton.render())};r.zoomIn=function(){return this.viewModel.zoomIn()};r.zoomOut=
function(){return this.viewModel.zoomOut()};a._createClass(t,[{key:"layout",set:function(x){"horizontal"!==x&&(x="vertical");this._set("layout",x)}}]);return t}(l);b.__decorate([n.property()],g.prototype,"iconClass",void 0);b.__decorate([n.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],g.prototype,"label",void 0);b.__decorate([n.property({value:"vertical"})],g.prototype,"layout",null);b.__decorate([n.property(),e.messageBundle("esri/widgets/Zoom/t9n/Zoom")],g.prototype,"messages",
void 0);b.__decorate([c.aliasOf("viewModel.view")],g.prototype,"view",void 0);b.__decorate([n.property({type:v})],g.prototype,"viewModel",void 0);return g=b.__decorate([f.subclass("esri.widgets.Zoom")],g)})},"esri/widgets/Zoom/IconButton":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../Widget ../support/decorators/accessibleHandler ../../core/Logger ../support/jsxFactory ../support/widgetUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){g=function(m){function z(){var q=m.apply(this,arguments)||this;q.enabled=!0;q.iconClass="";q.title="";return q}a._inheritsLoose(z,m);var v=z.prototype;v.render=function(){const q=this.enabled?0:-1,t={[this.iconClass]:!!this.iconClass};return e.tsx("div",{bind:this,class:this.classes("esri-widget--button esri-widget",{["esri-disabled"]:!this.enabled,["esri-interactive"]:this.enabled}),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:q,
title:this.title},e.tsx("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",t)}),e.tsx("span",{class:"esri-icon-font-fallback-text"},this.title))};v._triggerAction=function(){this.action.call(this)};return z}(f);b.__decorate([c.property()],g.prototype,"action",void 0);b.__decorate([c.property()],g.prototype,"enabled",void 0);b.__decorate([c.property()],g.prototype,"iconClass",void 0);b.__decorate([c.property()],g.prototype,"title",void 0);b.__decorate([l.accessibleHandler()],
g.prototype,"_triggerAction",null);return g=b.__decorate([n.subclass("esri.widgets.IconButton")],g)})},"esri/widgets/Zoom/ZoomViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/promiseUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./ZoomConditions2D ./ZoomConditions3D".split(" "),function(a,b,c,g,h,w,
n,f,l,k,e){c=function(d){function m(v){v=d.call(this,v)||this;v.canZoomIn=!1;v.canZoomOut=!1;return v}a._inheritsLoose(m,d);var z=m.prototype;z.destroy=function(){this.view=null};z.zoomIn=function(){if(this.canZoomIn){var v=this.view;"2d"===v.type?v.mapViewNavigation.zoomIn():g.ignoreAbortErrors(v.goTo({zoomFactor:2}))}};z.zoomOut=function(){if(this.canZoomOut){var v=this.view;"2d"===v.type?v.mapViewNavigation.zoomOut():g.ignoreAbortErrors(v.goTo({zoomFactor:.5}))}};a._createClass(m,[{key:"state",
get:function(){return this.get("view.ready")?"ready":"disabled"}},{key:"view",set:function(v){v?"2d"===v.type?this._zoomConditions=new k({view:v}):"3d"===v.type&&(this._zoomConditions=new e({view:v})):this._zoomConditions=null;this._set("view",v)}}]);return m}(c);b.__decorate([h.property()],c.prototype,"_zoomConditions",void 0);b.__decorate([h.property({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],c.prototype,"canZoomIn",void 0);b.__decorate([h.property({aliasOf:"_zoomConditions.canZoomOut",
readOnly:!0})],c.prototype,"canZoomOut",void 0);b.__decorate([h.property({readOnly:!0})],c.prototype,"state",null);b.__decorate([h.property()],c.prototype,"view",null);return c=b.__decorate([l.subclass("esri.widgets.Zoom.ZoomViewModel")],c)})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,g,h,w,n,f){c=function(l){function k(){return l.apply(this,arguments)||this}a._inheritsLoose(k,l);a._createClass(k,[{key:"canZoomIn",get:function(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),d=this.get("view.constraints.effectiveMaxScale");return 0===d||e>d}},{key:"canZoomOut",get:function(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),d=this.get("view.constraints.effectiveMinScale");
return 0===d||e<d}}]);return k}(c);b.__decorate([g.property({readOnly:!0})],c.prototype,"canZoomIn",null);b.__decorate([g.property({readOnly:!0})],c.prototype,"canZoomOut",null);b.__decorate([g.property()],c.prototype,"view",void 0);return c=b.__decorate([f.subclass("esri.widgets.Zoom.ZoomConditions2D")],c)})},"esri/widgets/Zoom/ZoomConditions3D":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,g,h,w,n,f){c=function(l){function k(){return l.apply(this,arguments)||this}a._inheritsLoose(k,l);a._createClass(k,[{key:"canZoomIn",get:function(){return!!this.get("view.ready")}},{key:"canZoomOut",get:function(){return!!this.get("view.ready")}}]);return k}(c);b.__decorate([g.property({readOnly:!0})],c.prototype,"canZoomIn",null);b.__decorate([g.property({readOnly:!0})],c.prototype,"canZoomOut",null);b.__decorate([g.property()],c.prototype,"view",void 0);return c=b.__decorate([f.subclass("esri.widgets.Zoom.ZoomConditions3D")],
c)})},"esri/layers/SceneLayer":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../PopupTemplate ../renderers/ClassBreaksRenderer ../renderers/DictionaryRenderer ../renderers/DotDensityRenderer ../renderers/HeatmapRenderer ../renderers/Renderer ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/support/jsonUtils ../renderers/support/types ../request ../core/Collection ../core/Error ../core/Logger ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/reactiveUtils ../core/urlUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/utils ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/PropertyOrigin ./Layer ./mixins/APIKeyMixin ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./mixins/SceneService ./support/capabilities ./support/commonProperties ./support/FeatureReduction ./support/FeatureReductionSelection ./support/FetchAssociatedFeatureLayer ./support/fieldProperties ./support/FieldsIndex ./support/fieldUtils ./support/I3SLayerDefinitions ./support/LabelClass ./support/labelingInfo ./support/LayerFloorInfo ./support/RangeInfo ../renderers/support/styleUtils ../rest/support/Query ../support/popupUtils ../webdoc/support/opacityUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H,M,K,I,O,Q,J,P,N,R,S,T,V,W,U,aa,da,Y,ea,ja,la,ia,ca,fa){const ba=["3DObject","Point"],Z=t.getLogger("esri.layers.SceneLayer");h=V.defineFieldProperties();x=function(pa){function xa(...ua){ua=pa.call(this,...ua)||this;ua.featureReduction=null;ua.rangeInfos=null;ua.operationalLayerType="ArcGISSceneServiceLayer";ua.type="scene";ua.fields=null;ua.floorInfo=null;ua.outFields=null;ua.nodePages=null;ua.materialDefinitions=null;ua.textureSetDefinitions=
null;ua.geometryDefinitions=null;ua.serviceUpdateTimeStamp=null;ua.excludeObjectIds=new v;ua.definitionExpression=null;ua.path=null;ua.labelsVisible=!0;ua.labelingInfo=null;ua.legendEnabled=!0;ua.cachedDrawingInfo={color:!1};ua.popupEnabled=!0;ua.popupTemplate=null;ua.objectIdField=null;ua.globalIdField=null;ua._fieldUsageInfo={};ua.screenSizePerspectiveEnabled=!0;return ua}b._inheritsLoose(xa,pa);var Da=xa.prototype;Da.normalizeCtorArgs=function(ua,Fa){return"string"===typeof ua?{url:ua,...Fa}:ua};
Da.getField=function(ua){return this.fieldsIndex.get(ua)};Da.getFieldDomain=function(ua,Fa){var qa,sa,ma,ra;return(Fa=null==(qa=this.getFeatureType(null==Fa?void 0:Fa.feature))?void 0:null==(sa=qa.domains)?void 0:sa[ua])&&"inherited"!==Fa.type?Fa:null!=(ma=null==(ra=this.getField(ua))?void 0:ra.domain)?ma:null};Da.getFeatureType=function(ua){return ua&&r.isSome(this.associatedLayer)?this.associatedLayer.getFeatureType(ua):null};Da.readNodePages=function(ua,Fa,qa){"Point"===Fa.layerType&&(ua=Fa.pointNodePages);
return null==ua||"object"!==typeof ua?null:aa.I3SNodePageDefinition.fromJSON(ua,qa)};Da.readCachedDrawingInfo=function(ua){if(null==ua||"object"!==typeof ua)ua={};null==ua.color&&(ua.color=!1);return ua};Da.readObjectIdField=function(ua,Fa){!ua&&Fa.fields&&Fa.fields.some(qa=>{"esriFieldTypeOID"===qa.type&&(ua=qa.name);return!!ua});return ua||void 0};Da.readGlobalIdField=function(ua,Fa){!ua&&Fa.fields&&Fa.fields.some(qa=>{"esriFieldTypeGlobalID"===qa.type&&(ua=qa.name);return!!ua});return ua||void 0};
Da.readProfile=function(ua,Fa){ua=Fa.store.profile;if(null!=ua&&ha[ua])return ha[ua];Z.error("Unknown or missing profile",{profile:ua,layer:this});return"mesh-pyramids"};Da.load=function(ua){const Fa=r.isSome(ua)?ua.signal:null,qa=this.loadFromPortal({supportedTypes:["Scene Service"]},ua).catch(u.throwIfAbortError).then(()=>this._fetchService(Fa)).then(()=>Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,Fa),this._setAssociatedFeatureLayer(Fa)])).then(()=>this._validateElevationInfo()).then(()=>
this._applyAssociatedLayerOverrides()).then(()=>this._populateFieldUsageInfo()).then(()=>la.loadStyleRenderer(this,{origin:"service"},Fa)).then(()=>U.fixRendererFields(this.renderer,this.fieldsIndex)).then(()=>this.finishLoadEditablePortalLayer(ua));this.addResolvingPromise(qa);return Promise.resolve(this)};Da.createQuery=function(){const ua=new ia;"mesh"!==this.geometryType&&(ua.returnGeometry=!0,ua.returnZ=!0);ua.where=this.definitionExpression||"1\x3d1";ua.sqlFormat="standard";return ua};Da.queryExtent=
function(ua,Fa){return this._getAssociatedLayerForQuery().then(qa=>qa.queryExtent(ua||this.createQuery(),Fa))};Da.queryFeatureCount=function(ua,Fa){return this._getAssociatedLayerForQuery().then(qa=>qa.queryFeatureCount(ua||this.createQuery(),Fa))};Da.queryFeatures=function(ua,Fa){return this._getAssociatedLayerForQuery().then(qa=>qa.queryFeatures(ua||this.createQuery(),Fa)).then(qa=>{if(null!=qa&&qa.features)for(const sa of qa.features)sa.layer=this,sa.sourceLayer=this;return qa})};Da.queryObjectIds=
function(ua,Fa){return this._getAssociatedLayerForQuery().then(qa=>qa.queryObjectIds(ua||this.createQuery(),Fa))};Da.queryAttachments=function(ua,Fa){return this._getAssociatedLayerForQuery().then(qa=>qa.queryAttachments(ua,Fa))};Da.getFieldUsageInfo=function(ua){const Fa={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[ua]||Fa:(Z.error("#getFieldUsageInfo()","Unavailable until layer is loaded"),Fa)};Da.createPopupTemplate=
function(ua){return ca.createPopupTemplate(this,ua)};Da._getAssociatedLayerForQuery=function(){const ua=this.associatedLayer;return r.isSome(ua)&&ua.loaded?Promise.resolve(ua):this._loadAssociatedLayerForQuery()};Da._loadAssociatedLayerForQuery=function(){var ua=b._asyncToGenerator(function*(){yield this.load();if(r.isNone(this.associatedLayer))throw new q("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{yield this.associatedLayer.load()}catch(Fa){throw new q("scenelayer:query-not-available",
"SceneLayer associated feature layer could not be loaded",{layer:this,error:Fa});}return this.associatedLayer});return function(){return ua.apply(this,arguments)}}();Da.hasCachedStatistics=function(ua){return null!=this.statisticsInfo&&this.statisticsInfo.some(Fa=>Fa.name===ua)};Da.queryCachedStatistics=function(){var ua=b._asyncToGenerator(function*(Fa,qa){yield this.load(qa);if(!this.statisticsInfo)throw new q("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");
const sa=this.fieldsIndex.get(Fa);if(!sa)throw new q("scenelayer:field-unexisting",`Field '${Fa}' does not exist on the layer`);for(const ma of this.statisticsInfo)if(ma.name===sa.name)return Fa=y.join(this.parsedUrl.path,ma.href),z(Fa,{query:{f:"json",token:this.apiKey},responseType:"json",signal:qa?qa.signal:null}).then(ra=>ra.data);throw new q("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available");});return function(Fa,qa){return ua.apply(this,arguments)}}();
Da.saveAs=function(){var ua=b._asyncToGenerator(function*(Fa,qa){return this._debouncedSaveOperations(J.SaveOperationType.SAVE_AS,{...qa,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"},Fa)});return function(Fa,qa){return ua.apply(this,arguments)}}();Da.save=function(){var ua=b._asyncToGenerator(function*(){return this._debouncedSaveOperations(J.SaveOperationType.SAVE,{getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"})});return function(){return ua.apply(this,
arguments)}}();Da.applyEdits=function(){var ua=b._asyncToGenerator(function*(Fa,qa){const sa=yield new Promise((ma,ra)=>a(["./graphics/editingSupport"],ma,ra));yield this.load();if(r.isNone(this.associatedLayer))throw new q(`${this.type}-layer:not-editable`,"Service is not editable");yield this.associatedLayer.load();return sa.applyEdits(this,this.associatedLayer.source,Fa,qa)});return function(Fa,qa){return ua.apply(this,arguments)}}();Da.on=function(ua,Fa){return pa.prototype.on.call(this,ua,Fa)};
Da.validateLayer=function(ua){if(ua.layerType&&-1===ba.indexOf(ua.layerType))throw new q("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:ua.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new q("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(2<this.version.major)throw new q("layer:service-version-too-new","Service version is too new.",
{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});{ua=this.normalReferenceFrame;var Fa=this.spatialReference;let qa=!1,sa=!1;if(null==ua)sa=qa=!0;else switch(Fa=Fa&&Fa.isGeographic,ua){case "east-north-up":case "earth-centered":qa=!0;sa=Fa;break;case "vertex-reference-frame":qa=!0;sa=!Fa;break;default:qa=!1}if(!qa)throw new q("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!sa)throw new q("scenelayer:incompatible-normal-reference-frame",
"Normal reference frame is incompatible with layer spatial reference.");}};Da._getTypeKeywords=function(){const ua=[];if("points"===this.profile)ua.push("Point");else if("mesh-pyramids"===this.profile)ua.push("3DObject");else throw new q("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);return ua};Da._populateFieldUsageInfo=function(){this._fieldUsageInfo={};if(this.fields)for(const ua of this.fields){const Fa=!(!this.attributeStorageInfo||
!this.attributeStorageInfo.some(sa=>sa.name===ua.name)),qa=!!(r.isSome(this.associatedLayer)&&this.associatedLayer.fields&&this.associatedLayer.fields.some(sa=>sa&&ua.name===sa.name));this._fieldUsageInfo[ua.name]={supportsLabelingInfo:Fa,supportsRenderer:Fa,supportsPopupTemplate:Fa||qa,supportsLayerQuery:qa}}};Da._applyAssociatedLayerOverrides=function(){this._applyAssociatedLayerFieldsOverrides();this._applyAssociatedLayerPopupOverrides()};Da._applyAssociatedLayerFieldsOverrides=function(){if(!r.isNone(this.associatedLayer)&&
this.associatedLayer.fields){var ua=null;for(const Fa of this.associatedLayer.fields){const qa=this.getField(Fa.name);qa?(!qa.domain&&Fa.domain&&(qa.domain=Fa.domain.clone()),qa.editable=Fa.editable,qa.nullable=Fa.nullable,qa.length=Fa.length):(ua||(ua=this.fields?this.fields.slice():[]),ua.push(Fa.clone()))}ua&&this._set("fields",ua)}};Da._applyAssociatedLayerPopupOverrides=function(){if(!r.isNone(this.associatedLayer)){var ua=["popupTemplate","popupEnabled"],Fa=D.getProperties(this);for(let qa=
0;qa<ua.length;qa++){const sa=ua[qa],ma=this.originIdOf(sa),ra=this.associatedLayer.originIdOf(sa);ma<ra&&(ra===L.OriginId.SERVICE||ra===L.OriginId.PORTAL_ITEM)&&Fa.setAtOrigin(sa,this.associatedLayer[sa],ra)}}};Da._setAssociatedFeatureLayer=function(){var ua=b._asyncToGenerator(function*(Fa){if(-1!==["mesh-pyramids","points"].indexOf(this.profile)){Fa=new T.FetchAssociatedFeatureLayer(this.parsedUrl,this.portalItem,this.apiKey,Fa);try{this.associatedLayer=yield Fa.fetch()}catch(qa){u.isAbortError(qa)||
this._logWarningOnPopupEnabled()}}});return function(Fa){return ua.apply(this,arguments)}}();Da._logWarningOnPopupEnabled=function(){var ua=b._asyncToGenerator(function*(){yield E.whenOnce(()=>this.popupEnabled&&null!=this.popupTemplate);const Fa=`this SceneLayer: ${this.title}`;null==this.attributeStorageInfo?Z.warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${Fa}`):Z.info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${Fa}`)});
return function(){return ua.apply(this,arguments)}}();Da._validateElevationInfo=function(){const ua=this.elevationInfo;ua&&("mesh-pyramids"===this.profile&&"absolute-height"!==ua.mode&&Z.warn(".elevationInfo\x3d","Mesh scene layers only support absolute-height elevation mode"),ua.featureExpressionInfo&&"0"!==ua.featureExpressionInfo.expression&&Z.warn(".elevationInfo\x3d","Scene layers do not support featureExpressionInfo"))};b._createClass(xa,[{key:"types",get:function(){return r.isSome(this.associatedLayer)?
this.associatedLayer.types:[]}},{key:"typeIdField",get:function(){return r.isSome(this.associatedLayer)?this.associatedLayer.typeIdField:null}},{key:"formTemplate",get:function(){return r.isSome(this.associatedLayer)?this.associatedLayer.formTemplate:null}},{key:"fieldsIndex",get:function(){return new W(this.fields)}},{key:"elevationInfo",set:function(ua){this._set("elevationInfo",ua);this.loaded&&this._validateElevationInfo()}},{key:"geometryType",get:function(){return na[this.profile]||"mesh"}},
{key:"renderer",set:function(ua){U.fixRendererFields(ua,this.fieldsIndex);this._set("renderer",ua)}},{key:"capabilities",get:function(){var ua=r.isSome(this.associatedLayer)&&this.associatedLayer.capabilities?this.associatedLayer.capabilities:P.zeroCapabilities;const {query:Fa,editing:{supportsGlobalId:qa,supportsRollbackOnFailure:sa,supportsUploadWithItemId:ma,supportsReturnServiceEditsInSourceSpatialReference:ra},data:{supportsZ:va,supportsM:Ia,isVersioned:Ja,supportsAttachment:Ha},operations:{supportsEditing:Ta,
supportsUpdate:db,supportsQuery:fb,supportsQueryAttachments:ka}}=ua;ua=ua.operations.supportsChangeTracking;return{query:Fa,editing:{supportsGlobalId:qa,supportsReturnServiceEditsInSourceSpatialReference:ra,supportsRollbackOnFailure:sa,supportsGeometryUpdate:!1,supportsUploadWithItemId:ma},data:{supportsAttachment:Ha,supportsZ:va,supportsM:Ia,isVersioned:Ja},operations:{supportsQuery:fb,supportsQueryAttachments:ka,supportsEditing:Ta&&ua,supportsAdd:!1,supportsDelete:!1,supportsUpdate:db&&ua}}}},{key:"editingEnabled",
get:function(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.userHasEditingPrivileges},set:function(ua){null!=ua?this._override("editingEnabled",ua):this._clearOverride("editingEnabled")}},{key:"defaultPopupTemplate",get:function(){return r.isSome(this.associatedLayer)||this.attributeStorageInfo?this.createPopupTemplate():null}},{key:"displayField",get:function(){return r.isSome(this.associatedLayer)?this.associatedLayer.displayField:null}}]);return xa}(J.SceneService(K.ArcGISService(I.OperationalLayer(O.PortalLayer(Q.ScaleRangeLayer(x.MultiOriginJSONMixin(M.APIKeyMixin(H))))))));
c.__decorate([A.property({types:{key:"type",base:R.default,typeMap:{selection:S}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],x.prototype,"featureReduction",void 0);c.__decorate([A.property({type:[ja.default],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],x.prototype,"rangeInfos",void 0);c.__decorate([A.property({json:{read:!1}})],
x.prototype,"associatedLayer",void 0);c.__decorate([A.property({type:["show","hide"]})],x.prototype,"listMode",void 0);c.__decorate([A.property({type:["ArcGISSceneServiceLayer"]})],x.prototype,"operationalLayerType",void 0);c.__decorate([A.property({json:{read:!1},readOnly:!0})],x.prototype,"type",void 0);c.__decorate([A.property({...h.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],x.prototype,"fields",void 0);c.__decorate([A.property()],x.prototype,"types",null);c.__decorate([A.property()],
x.prototype,"typeIdField",null);c.__decorate([A.property()],x.prototype,"formTemplate",null);c.__decorate([A.property({readOnly:!0})],x.prototype,"fieldsIndex",null);c.__decorate([A.property({type:ea,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],x.prototype,"floorInfo",void 0);c.__decorate([A.property(h.outFields)],x.prototype,"outFields",void 0);c.__decorate([A.property({type:aa.I3SNodePageDefinition,readOnly:!0,json:{read:!1}})],x.prototype,"nodePages",
void 0);c.__decorate([F.reader("service","nodePages",["nodePages","pointNodePages"])],x.prototype,"readNodePages",null);c.__decorate([A.property({type:[aa.I3SMaterialDefinition],readOnly:!0})],x.prototype,"materialDefinitions",void 0);c.__decorate([A.property({type:[aa.I3STextureSetDefinition],readOnly:!0})],x.prototype,"textureSetDefinitions",void 0);c.__decorate([A.property({type:[aa.I3SGeometryDefinition],readOnly:!0})],x.prototype,"geometryDefinitions",void 0);c.__decorate([A.property({readOnly:!0})],
x.prototype,"serviceUpdateTimeStamp",void 0);c.__decorate([A.property({readOnly:!0})],x.prototype,"attributeStorageInfo",void 0);c.__decorate([A.property({readOnly:!0})],x.prototype,"statisticsInfo",void 0);c.__decorate([A.property({type:v.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],x.prototype,"excludeObjectIds",void 0);c.__decorate([A.property({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",
write:{enabled:!0,allowNull:!0}}})],x.prototype,"definitionExpression",void 0);c.__decorate([A.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],x.prototype,"path",void 0);c.__decorate([A.property(N.elevationInfo)],x.prototype,"elevationInfo",null);c.__decorate([A.property({type:String})],x.prototype,"geometryType",null);c.__decorate([A.property(N.labelsVisible)],x.prototype,"labelsVisible",void 0);c.__decorate([A.property({type:[da],json:{origins:{service:{name:"drawingInfo.labelingInfo",
read:{reader:Y.reader},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:Y.reader},write:!0}})],x.prototype,"labelingInfo",void 0);c.__decorate([A.property(N.legendEnabled)],x.prototype,"legendEnabled",void 0);c.__decorate([A.property({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(pa,xa){var Da,
ua;if("number"===typeof pa&&0<=pa&&1>=pa)return pa;pa=null==(Da=xa.layerDefinition)?void 0:null==(ua=Da.drawingInfo)?void 0:ua.transparency;return void 0!==pa?fa.transparencyToOpacity(pa):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],x.prototype,"opacity",void 0);c.__decorate([A.property({types:m.webSceneRendererTypes,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],x.prototype,"renderer",null);c.__decorate([A.property({json:{read:!1}})],
x.prototype,"cachedDrawingInfo",void 0);c.__decorate([F.reader("service","cachedDrawingInfo")],x.prototype,"readCachedDrawingInfo",null);c.__decorate([A.property({readOnly:!0,json:{read:!1}})],x.prototype,"capabilities",null);c.__decorate([A.property({type:Boolean,json:{read:!1}})],x.prototype,"editingEnabled",null);c.__decorate([A.property(N.popupEnabled)],x.prototype,"popupEnabled",void 0);c.__decorate([A.property({type:g,json:{name:"popupInfo",write:!0}})],x.prototype,"popupTemplate",void 0);c.__decorate([A.property({readOnly:!0,
json:{read:!1}})],x.prototype,"defaultPopupTemplate",null);c.__decorate([A.property({type:String,json:{read:!1}})],x.prototype,"objectIdField",void 0);c.__decorate([F.reader("service","objectIdField",["objectIdField","fields"])],x.prototype,"readObjectIdField",null);c.__decorate([A.property({type:String,json:{read:!1}})],x.prototype,"globalIdField",void 0);c.__decorate([F.reader("service","globalIdField",["globalIdField","fields"])],x.prototype,"readGlobalIdField",null);c.__decorate([A.property({readOnly:!0,
type:String,json:{read:!1}})],x.prototype,"displayField",null);c.__decorate([A.property({type:String,json:{read:!1}})],x.prototype,"profile",void 0);c.__decorate([F.reader("service","profile",["store.profile"])],x.prototype,"readProfile",null);c.__decorate([A.property({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],x.prototype,"normalReferenceFrame",void 0);c.__decorate([A.property(N.screenSizePerspectiveEnabled)],x.prototype,"screenSizePerspectiveEnabled",
void 0);x=c.__decorate([G.subclass("esri.layers.SceneLayer")],x);const ha={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},na={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return x})},"esri/layers/mixins/SceneService":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/Error ../../core/has ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/originUtils ../../geometry/Extent ../../geometry/HeightModelInfo ../../geometry/SpatialReference ../support/arcgisLayerUrl ../support/commonProperties ../support/I3SIndexInfo ../../portal/Portal ../../portal/PortalItem ../../webdoc/support/saveUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C){const F=f.getLogger("esri.layers.mixins.SceneService");var G;(function(H){H[H.existingItem=0]="existingItem";H[H.newItem=1]="newItem"})(G||(G={}));const L={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};b.SaveOperationType=void 0;(function(H){H[H.SAVE=0]="SAVE";H[H.SAVE_AS=1]="SAVE_AS"})(b.SaveOperationType||(b.SaveOperationType={}));b.SCENE_SERVICE_ITEM_TYPE=
"Scene Service";b.SceneService=H=>{H=function(M){function K(){var O=M.apply(this,arguments)||this;O.spatialReference=null;O.fullExtent=null;O.heightModelInfo=null;O.minScale=0;O.maxScale=0;O.version={major:Number.NaN,minor:Number.NaN,versionString:""};O.copyright=null;O.sublayerTitleMode="item-title";O.title=null;O.layerId=null;O.indexInfo=null;O._debouncedSaveOperations=k.debounce(function(){var Q=c._asyncToGenerator(function*(J,P,N){switch(J){case b.SaveOperationType.SAVE:return O._save(P);case b.SaveOperationType.SAVE_AS:return O._saveAs(N,
P)}});return function(J,P,N){return Q.apply(this,arguments)}}());return O}c._inheritsLoose(K,M);var I=K.prototype;I.readSpatialReference=function(O,Q){return this._readSpatialReference(Q)};I._readSpatialReference=function(O){if(null!=O.spatialReference)return E.fromJSON(O.spatialReference);O=O.store;O=(O=O.indexCRS||O.geographicCRS)&&parseInt(O.substring(O.lastIndexOf("/")+1,O.length),10);return null!=O?new E(O):null};I.readFullExtent=function(O,Q,J){if(null!=O&&"object"===typeof O)return Q=null==
O.spatialReference?{...O,spatialReference:this._readSpatialReference(Q)}:O,x.fromJSON(Q,J);J=Q.store;Q=this._readSpatialReference(Q);return null==Q||null==J||null==J.extent||!Array.isArray(J.extent)||J.extent.some(P=>-1E38>P)?null:new x({xmin:J.extent[0],ymin:J.extent[1],xmax:J.extent[2],ymax:J.extent[3],spatialReference:Q})};I.parseVersionString=function(O){const Q={major:Number.NaN,minor:Number.NaN,versionString:O};O=O.split(".");2<=O.length&&(Q.major=parseInt(O[0],10),Q.minor=parseInt(O[1],10));
return Q};I.readVersion=function(O,Q){O=Q.store;return this.parseVersionString(null!=O.version?O.version.toString():"")};I.readTitlePortalItem=function(O){return"item-title"!==this.sublayerTitleMode?void 0:O};I.readTitleService=function(O,Q){O=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return y.titleFromUrlAndName(this.url,Q.name);Q=Q.name;if(!Q&&this.url){const J=y.parse(this.url);l.isSome(J)&&(Q=J.title)}"item-title-and-service-name"===this.sublayerTitleMode&&
O&&(Q=O+" - "+Q);return y.cleanTitle(Q)};I.writeUrl=function(O,Q,J,P){y.writeUrlWithLayerId(this,O,"layers",Q,P)};I._fetchIndexAndUpdateExtent=function(){var O=c._asyncToGenerator(function*(Q,J){this.indexInfo=p.fetchIndexInfo(this.parsedUrl.path,this.rootNode,Q,this.apiKey,F,J);null==this.fullExtent||this.fullExtent.hasZ||this._updateExtent(yield this.indexInfo)});return function(Q,J){return O.apply(this,arguments)}}();I._updateExtent=function(O){if("page"===(null==O?void 0:O.type)){var Q,J,P=O.rootIndex%
O.pageSize;O=null==(Q=O.rootPage)?void 0:null==(J=Q.nodes)?void 0:J[P];if(null==O||null==O.obb||null==O.obb.center||null==O.obb.halfSize)throw new w("sceneservice:invalid-node-page","Invalid node page.");-1E38>O.obb.center[0]||null==this.fullExtent||this.fullExtent.hasZ||(Q=O.obb.halfSize,J=O.obb.center[2],Q=Math.sqrt(Q[0]*Q[0]+Q[1]*Q[1]+Q[2]*Q[2]),this.fullExtent.zmin=J-Q,this.fullExtent.zmax=J+Q)}else"node"===(null==O?void 0:O.type)&&(J=null==(P=O.rootNode)?void 0:P.mbs,!Array.isArray(J)||4!==J.length||
-1E38>J[0]||(Q=J[2],J=J[3],this.fullExtent.zmin=Q-J,this.fullExtent.zmax=Q+J))};I._fetchService=function(){var O=c._asyncToGenerator(function*(Q){if(null==this.url)throw new w("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(null==this.layerId&&/SceneServer\/*$/i.test(this.url)){const J=yield this._fetchFirstLayerId(Q);null!=J&&(this.layerId=J)}return this._fetchServiceLayer(Q)});return function(Q){return O.apply(this,arguments)}}();I._fetchFirstLayerId=
function(){var O=c._asyncToGenerator(function*(Q){Q=yield h(this.url,{query:{f:"json",token:this.apiKey},responseType:"json",signal:Q});if(Q.data&&Array.isArray(Q.data.layers)&&0<Q.data.layers.length)return Q.data.layers[0].id});return function(Q){return O.apply(this,arguments)}}();I._fetchServiceLayer=function(){var O=c._asyncToGenerator(function*(Q){Q=yield h(this.parsedUrl.path,{query:{f:"json",token:this.apiKey},responseType:"json",signal:Q});Q.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));
let J=!1;Q.data.layerType&&"Voxel"===Q.data.layerType&&(J=!0);if(J)return this._fetchVoxelServiceLayer();Q=Q.data;this.read(Q,{origin:"service",url:this.parsedUrl});this.validateLayer(Q)});return function(Q){return O.apply(this,arguments)}}();I._fetchVoxelServiceLayer=function(){var O=c._asyncToGenerator(function*(Q){Q=(yield h(this.parsedUrl.path+"/layer",{query:{f:"json",token:this.apiKey},responseType:"json",signal:Q})).data;this.read(Q,{origin:"service",url:this.parsedUrl});this.validateLayer(Q)});
return function(Q){return O.apply(this,arguments)}}();I._ensureLoadBeforeSave=function(){var O=c._asyncToGenerator(function*(){yield this.load();"beforeSave"in this&&"function"===typeof this.beforeSave&&(yield this.beforeSave())});return function(){return O.apply(this,arguments)}}();I.validateLayer=function(O){};I._updateTypeKeywords=function(O,Q,J){O.typeKeywords||(O.typeKeywords=[]);Q=Q.getTypeKeywords();for(const P of Q)O.typeKeywords.push(P);O.typeKeywords&&(O.typeKeywords=O.typeKeywords.filter((P,
N,R)=>R.indexOf(P)===N),J===G.newItem&&(O.typeKeywords=O.typeKeywords.filter(P=>"Hosted Service"!==P)))};I._saveAs=function(){var O=c._asyncToGenerator(function*(Q,J){J={...L,...J};Q=D.from(Q);Q||(F.error("_saveAs(): requires a portal item parameter"),yield Promise.reject(new w("sceneservice:portal-item-required","_saveAs() requires a portal item to save to")));Q.id&&(Q=Q.clone(),Q.id=null);const P=Q.portal||B.getDefault();yield this._ensureLoadBeforeSave();Q.type="Scene Service";Q.portal=P;const N=
{origin:"portal-item",url:null,messages:[],portal:P,portalItem:Q,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},R={layers:[this.write({},N)]};yield Promise.all(N.resources.pendingOperations);yield this._validateAgainstJSONSchema(R,N,J);Q.url=this.url;Q.title||(Q.title=this.title);this._updateTypeKeywords(Q,J,G.newItem);yield P._signIn();yield P.user.addItem({item:Q,folder:J&&J.folder,data:R});yield C.saveResources(this.resourceReferences,
N,null);this.portalItem=Q;r.updateOrigins(N);return N.portalItem=Q});return function(Q,J){return O.apply(this,arguments)}}();I._save=function(){var O=c._asyncToGenerator(function*(Q){Q={...L,...Q};this.portalItem||(F.error("_save(): requires the .portalItem property to be set"),yield Promise.reject(new w("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService")));"Scene Service"!==this.portalItem.type&&(F.error("_save(): Non-matching portal item type. Got "+
this.portalItem.type+", expected Scene Service"),yield Promise.reject(new w("sceneservice:portal-item-wrong-type",'Portal item needs to have type "Scene Service"')));yield this._ensureLoadBeforeSave();const J={origin:"portal-item",url:this.portalItem.itemUrl&&e.urlToObject(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||B.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},P={layers:[this.write({},
J)]};yield Promise.all(J.resources.pendingOperations);yield this._validateAgainstJSONSchema(P,J,Q);this.portalItem.url=this.url;this.portalItem.title||(this.portalItem.title=this.title);this._updateTypeKeywords(this.portalItem,Q,G.existingItem);yield this.portalItem.update({data:P});yield C.saveResources(this.resourceReferences,J,null);r.updateOrigins(J);return this.portalItem});return function(Q){return O.apply(this,arguments)}}();I._validateAgainstJSONSchema=function(){var O=c._asyncToGenerator(function*(Q,
J,P){J=J.messages.filter(N=>"error"===N.type).map(N=>new w(N.name,N.message,N.details));P&&P.validationOptions.ignoreUnsupported&&(J=J.filter(N=>"layer:unsupported"!==N.name&&"symbol:unsupported"!==N.name&&"symbol-layer:unsupported"!==N.name&&"property:unsupported"!==N.name&&"url:unsupported"!==N.name&&"scenemodification:unsupported"!==N.name));if(P.validationOptions.enabled&&(Q=(yield new Promise((N,R)=>a(["../support/schemaValidator"],N,R))).validate(Q,P.portalItemLayerType),0<Q.length)){const N=
`Layer item did not validate:\n${Q.join("\n")}`;F.error(`_validateAgainstJSONSchema(): ${N}`);if("throw"===P.validationOptions.failPolicy)throw P=Q.map(R=>new w("sceneservice:schema-validation",R)).concat(J),new w("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:P});}if(0<J.length)throw new w("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",
{errors:J});});return function(Q,J,P){return O.apply(this,arguments)}}();c._createClass(K,[{key:"url",set:function(O){O=y.sanitizeUrlWithLayerId({layer:this,url:O,nonStandardUrlAllowed:!1,logger:F});this._set("url",O.url);null!=O.layerId&&this._set("layerId",O.layerId)}},{key:"parsedUrl",get:function(){var O=this._get("url");if(!O)return null;O=e.urlToObject(O);null!=this.layerId&&(O.path=`${O.path}/layers/${this.layerId}`);return O}}]);return K}(H);g.__decorate([d.property(A.id)],H.prototype,"id",
void 0);g.__decorate([d.property({type:E})],H.prototype,"spatialReference",void 0);g.__decorate([v.reader("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],H.prototype,"readSpatialReference",null);g.__decorate([d.property({type:x})],H.prototype,"fullExtent",void 0);g.__decorate([v.reader("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],H.prototype,"readFullExtent",null);g.__decorate([d.property({readOnly:!0,type:u})],
H.prototype,"heightModelInfo",void 0);g.__decorate([d.property({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],H.prototype,"minScale",void 0);g.__decorate([d.property({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],H.prototype,"maxScale",void 0);g.__decorate([d.property({readOnly:!0})],H.prototype,"version",void 0);g.__decorate([v.reader("version",["store.version"])],
H.prototype,"readVersion",null);g.__decorate([d.property({type:String,json:{read:{source:"copyrightText"}}})],H.prototype,"copyright",void 0);g.__decorate([d.property({type:String,json:{read:!1}})],H.prototype,"sublayerTitleMode",void 0);g.__decorate([d.property({type:String})],H.prototype,"title",void 0);g.__decorate([v.reader("portal-item","title")],H.prototype,"readTitlePortalItem",null);g.__decorate([v.reader("service","title",["name"])],H.prototype,"readTitleService",null);g.__decorate([d.property({type:Number,
json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],H.prototype,"layerId",void 0);g.__decorate([d.property(A.url)],H.prototype,"url",null);g.__decorate([t.writer("url")],H.prototype,"writeUrl",null);g.__decorate([d.property()],H.prototype,"parsedUrl",null);g.__decorate([d.property({readOnly:!0})],H.prototype,"store",void 0);g.__decorate([d.property({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],H.prototype,"rootNode",
void 0);return H=g.__decorate([q.subclass("esri.layers.mixins.SceneService")],H)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/core/accessorSupport/originUtils":function(){define(["exports","../multiOriginJSONSupportUtils"],function(a,b){a.updateOrigins=function(c){c&&c.writtenProperties&&c.writtenProperties.forEach(g=>{const h=g.target;g.newOrigin&&g.oldOrigin!==g.newOrigin&&b.isMultiOriginJSONMixin(h)&&h.updateOrigin(g.propName,g.newOrigin)})};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/core/multiOriginJSONSupportUtils":function(){define(["exports"],function(a){a.isMultiOriginJSONMixin=function(b){return b&&"getAtOrigin"in b&&"originOf"in b};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/I3SIndexInfo":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../request","../../core/Error","../../core/maybe"],function(a,b,c,g,h){function w(){w=b._asyncToGenerator(function*(n,f,l,k,e,d){var m=null;if(h.isSome(l)){m=`${n}/nodepages/`;
const z=m+Math.floor(l.rootIndex/l.nodesPerPage);try{return{type:"page",rootPage:(yield c(z,{query:{f:"json",token:k},responseType:"json",signal:d})).data,rootIndex:l.rootIndex,pageSize:l.nodesPerPage,lodMetric:l.lodSelectionMetricType,urlPrefix:m}}catch(v){h.isSome(e)&&e.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",z,v),m=v}}if(!f)return null;f=f&&f.split("/").pop();n=`${n}/nodes/`;f=n+f;try{return{type:"node",rootNode:(yield c(f,{query:{f:"json",token:k},
responseType:"json",signal:d})).data,urlPrefix:n}}catch(z){throw new g("sceneservice:root-node-missing","Root node missing.",{pageError:m,nodeError:z,url:f});}});return w.apply(this,arguments)}a.fetchIndexInfo=function(n,f,l,k,e,d){return w.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/webdoc/support/saveUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/asyncUtils ../../core/Error ../../core/promiseUtils ../../core/uuid ../../portal/support/resourceUtils".split(" "),
function(a,b,c,g,h,w,n){function f(){f=b._asyncToGenerator(function*(m,z,v){if(z&&z.resources){var q=z.portalItem===m.portalItem?new Set(m.paths):new Set;m.paths.length=0;m.portalItem=z.portalItem;var t=new Set(z.resources.toKeep.map(u=>u.resource.path)),r=new Set,x=[];t.forEach(u=>{q.delete(u);m.paths.push(u)});for(const u of z.resources.toUpdate)if(q.delete(u.resource.path),t.has(u.resource.path)||r.has(u.resource.path)){const {resource:E,content:y,finish:A,error:p}=u,B=n.getSiblingOfSameTypeI(E,
w.generateUUID());m.paths.push(B.path);x.push(l({resource:B,content:y,finish:A,error:p},v))}else m.paths.push(u.resource.path),x.push(e(u,v)),r.add(u.resource.path);for(const u of z.resources.toAdd)x.push(l(u,v)),m.paths.push(u.resource.path);q.forEach(u=>{u=z.portalItem.resourceFromPath(u);x.push(u.portalItem.removeResource(u).catch(()=>{}))});if(0!==x.length&&(t=yield h.eachAlways(x),h.throwIfAborted(v),v=t.filter(u=>"error"in u).map(u=>u.error),0<v.length))throw new g("save:resources","Failed to save one or more resources",
{errors:v});}});return f.apply(this,arguments)}function l(m,z){return k.apply(this,arguments)}function k(){k=b._asyncToGenerator(function*(m,z){z=yield c.result(m.resource.portalItem.addResource(m.resource,m.content,z));if(!0===z.ok)m.finish&&m.finish(m.resource);else throw m.error&&m.error(z.error),z.error;});return k.apply(this,arguments)}function e(m,z){return d.apply(this,arguments)}function d(){d=b._asyncToGenerator(function*(m,z){z=yield c.result(m.resource.update(m.content,z));if(!0===z.ok)m.finish(m.resource);
else throw m.error(z.error),z.error;});return d.apply(this,arguments)}a.saveResources=function(m,z,v){return f.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/portal/support/resourceUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../core/Error ../../core/maybe ../../core/urlUtils".split(" "),function(a,b,c,g,h,w){function n(){n=b._asyncToGenerator(function*(v,q={},t){yield v.load(t);var r=w.join(v.itemUrl,"resources");const {start:x=
1,num:u=10,sortOrder:E="asc",sortField:y="created"}=q;q={query:{start:x,num:u,sortOrder:E,sortField:y,token:v.apiKey},signal:h.get(t,"signal")};r=yield v.portal._request(r,q);return{total:r.total,nextStart:r.nextStart,resources:r.resources.map(({created:A,size:p,resource:B})=>({created:new Date(A),size:p,resource:v.resourceFromPath(B)}))}});return n.apply(this,arguments)}function f(){f=b._asyncToGenerator(function*(v,q,t,r){if(!v.hasPath())throw new g(`portal-item-resource-${q}:invalid-path`,"Resource does not have a valid path");
const x=v.portalItem;yield x.load(r);q=w.join(x.userItemUrl,"add"===q?"addResources":"updateResources");const [u,E]=e(v.path);t=yield m(t);const y=new FormData;u&&"."!==u&&y.append("resourcesPrefix",u);y.append("fileName",E);y.append("file",t,E);y.append("f","json");h.isSome(r)&&r.access&&y.append("access",r.access);yield x.portal._request(q,{method:"post",body:y,signal:h.get(r,"signal")});return v});return f.apply(this,arguments)}function l(){l=b._asyncToGenerator(function*(v,q,t){if(!q.hasPath())throw new g("portal-item-resources-remove:invalid-path",
"Resource does not have a valid path");yield v.load(t);const r=w.join(v.userItemUrl,"removeResources");yield v.portal._request(r,{method:"post",query:{resource:q.path},signal:h.get(t,"signal")});q.portalItem=null});return l.apply(this,arguments)}function k(){k=b._asyncToGenerator(function*(v,q){yield v.load(q);const t=w.join(v.userItemUrl,"removeResources");return v.portal._request(t,{method:"post",query:{deleteAll:!0},signal:h.get(q,"signal")})});return k.apply(this,arguments)}function e(v){const q=
v.lastIndexOf("/");return-1===q?[".",v]:[v.slice(0,q),v.slice(q+1)]}function d(v){{const u=w.getPathExtension(v);v=h.isNone(u)?[v,""]:[v.slice(0,v.length-u.length-1),`.${u}`]}const [q,t]=v,[r,x]=e(q);return[r,x,t]}function m(v){return z.apply(this,arguments)}function z(){z=b._asyncToGenerator(function*(v){return v instanceof Blob?v:(yield c(v.url,{responseType:"blob"})).data});return z.apply(this,arguments)}a.addOrUpdateResource=function(v,q,t,r){return f.apply(this,arguments)};a.contentToBlob=m;
a.fetchResources=function(v){return n.apply(this,arguments)};a.getSiblingOfSameType=function(v,q){if(!v.hasPath())return null;const [t,,r]=d(v.path);return v.portalItem.resourceFromPath(w.join(t,q+r))};a.getSiblingOfSameTypeI=function(v,q){if(!v.hasPath())return null;const [t,,r]=d(v.path);return v.portalItem.resourceFromPath(w.join(t,q+r))};a.removeAllResources=function(v,q){return k.apply(this,arguments)};a.removeResource=function(v,q,t){return l.apply(this,arguments)};a.splitPrefixFileNameAndExtension=
d;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/capabilities":function(){define(["exports"],function(a){a.zeroCapabilities={attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,
supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAttachments:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,
supportsPagination:!1},query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsDefaultSpatialReference:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,
supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/FetchAssociatedFeatureLayer":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../kernel ../../request ../../core/maybe ../../core/promiseUtils ../FeatureLayer ../../portal/Portal ../../portal/PortalItem".split(" "),
function(a,b,c,g,h,w,n,f,l){let k=function(){function e(m,z,v,q){this.parsedUrl=m;this.portalItem=z;this.apiKey=v;this.signal=q;this.rootDocument=null;if(m=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i))this.urlParts={root:m[1],layerId:parseInt(m[2],10)}}var d=e.prototype;d.fetch=function(){var m=b._asyncToGenerator(function*(){var z;if(!this.urlParts)return null;const v=null!=(z=this.portalItem)?z:yield this._portalItemFromServiceItemId();if(h.isNone(v))return this._loadFromUrl();
z=yield this._findAndLoadRelatedPortalItem(v);return h.isNone(z)?null:this._loadFeatureLayerFromPortalItem(z)});return function(){return m.apply(this,arguments)}}();d.fetchPortalItem=function(){var m=b._asyncToGenerator(function*(){var z;if(!this.urlParts)return null;const v=null!=(z=this.portalItem)?z:yield this._portalItemFromServiceItemId();return h.isNone(v)?null:this._findAndLoadRelatedPortalItem(v)});return function(){return m.apply(this,arguments)}}();d._fetchRootDocument=function(){var m=
b._asyncToGenerator(function*(){if(h.isSome(this.rootDocument))return this.rootDocument;if(h.isNone(this.urlParts))return this.rootDocument={},{};const z={query:{f:"json",token:this.apiKey},responseType:"json",signal:this.signal},v=`${this.urlParts.root}/SceneServer`;try{this.rootDocument=(yield g(v,z)).data}catch{this.rootDocument={}}return this.rootDocument});return function(){return m.apply(this,arguments)}}();d._fetchServiceOwningPortalUrl=function(){var m=b._asyncToGenerator(function*(){var z;
const v=null==(z=c.id)?void 0:z.findServerInfo(this.parsedUrl.path);if(null!=v&&v.owningSystemUrl)return v.owningSystemUrl;z=this.parsedUrl.path.replace(/(.*\/rest)\/.*/i,"$1")+"/info";try{const q=(yield g(z,{query:{f:"json"},responseType:"json",signal:this.signal})).data.owningSystemUrl;if(q)return q}catch(q){w.throwIfAbortError(q)}return null});return function(){return m.apply(this,arguments)}}();d._findAndLoadRelatedPortalItem=function(){var m=b._asyncToGenerator(function*(z){try{return(yield z.fetchRelatedItems({relationshipType:"Service2Service",
direction:"reverse"},{signal:this.signal})).find(v=>"Feature Service"===v.type)||null}catch(v){return w.throwIfAbortError(v),null}});return function(z){return m.apply(this,arguments)}}();d._loadFeatureLayerFromPortalItem=function(){var m=b._asyncToGenerator(function*(z){yield z.load({signal:this.signal});const v=yield this._findMatchingAssociatedSublayerUrl(z.url);return(new n({url:v,portalItem:z})).load({signal:this.signal})});return function(z){return m.apply(this,arguments)}}();d._loadFromUrl=
function(){var m=b._asyncToGenerator(function*(){const z=yield this._findMatchingAssociatedSublayerUrl(`${this.urlParts.root}/FeatureServer`);return(new n({url:z})).load({signal:this.signal})});return function(){return m.apply(this,arguments)}}();d._findMatchingAssociatedSublayerUrl=function(){var m=b._asyncToGenerator(function*(z){z=z.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1");var v={query:{f:"json"},responseType:"json",authMode:"no-prompt",signal:this.signal};const q=this.urlParts.layerId;
var t=this._fetchRootDocument();v=g(z,v);const [r,x]=yield Promise.all([v,t]);t=x&&x.layers;v=r.data&&r.data.layers;if(!Array.isArray(v))throw Error("expected layers array");if(!Array.isArray(t)){if(q<v.length)return`${z}/${v[q].id}`}else for(let u=0;u<Math.min(t.length,v.length);u++)if(t[u].id===q)return`${z}/${v[u].id}`;throw Error("could not find matching associated sublayer");});return function(z){return m.apply(this,arguments)}}();d._portalItemFromServiceItemId=function(){var m=b._asyncToGenerator(function*(){var z=
(yield this._fetchRootDocument()).serviceItemId;if(!z)return null;z=new l({id:z,apiKey:this.apiKey});const v=yield this._fetchServiceOwningPortalUrl();h.isSome(v)&&(z.portal=new f({url:v}));try{return z.load({signal:this.signal})}catch(q){return w.throwIfAbortError(q),null}});return function(){return m.apply(this,arguments)}}();return e}();a.FetchAssociatedFeatureLayer=k;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/I3SLayerDefinitions":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,g,h,w,n,f,l,k){a.I3SNodePageDefinition=function(e){function d(){var m=e.apply(this,arguments)||this;m.nodesPerPage=null;m.rootIndex=0;m.lodSelectionMetricType=null;return m}b._inheritsLoose(d,e);return d}(g.JSONSupport);c.__decorate([h.property({type:Number})],a.I3SNodePageDefinition.prototype,"nodesPerPage",void 0);c.__decorate([h.property({type:Number})],a.I3SNodePageDefinition.prototype,"rootIndex",void 0);c.__decorate([h.property({type:String})],a.I3SNodePageDefinition.prototype,
"lodSelectionMetricType",void 0);a.I3SNodePageDefinition=c.__decorate([k.subclass("esri.layer.support.I3SNodePageDefinition")],a.I3SNodePageDefinition);a.I3SMaterialTexture=function(e){function d(){var m=e.apply(this,arguments)||this;m.factor=1;return m}b._inheritsLoose(d,e);return d}(g.JSONSupport);c.__decorate([h.property({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],a.I3SMaterialTexture.prototype,"id",void 0);c.__decorate([h.property({type:Number})],a.I3SMaterialTexture.prototype,
"factor",void 0);a.I3SMaterialTexture=c.__decorate([k.subclass("esri.layer.support.I3SMaterialTexture")],a.I3SMaterialTexture);a.I3SMaterialPBRMetallicRoughness=function(e){function d(){var m=e.apply(this,arguments)||this;m.baseColorFactor=[1,1,1,1];m.baseColorTexture=null;m.metallicRoughnessTexture=null;m.metallicFactor=1;m.roughnessFactor=1;return m}b._inheritsLoose(d,e);return d}(g.JSONSupport);c.__decorate([h.property({type:[Number]})],a.I3SMaterialPBRMetallicRoughness.prototype,"baseColorFactor",
void 0);c.__decorate([h.property({type:a.I3SMaterialTexture})],a.I3SMaterialPBRMetallicRoughness.prototype,"baseColorTexture",void 0);c.__decorate([h.property({type:a.I3SMaterialTexture})],a.I3SMaterialPBRMetallicRoughness.prototype,"metallicRoughnessTexture",void 0);c.__decorate([h.property({type:Number})],a.I3SMaterialPBRMetallicRoughness.prototype,"metallicFactor",void 0);c.__decorate([h.property({type:Number})],a.I3SMaterialPBRMetallicRoughness.prototype,"roughnessFactor",void 0);a.I3SMaterialPBRMetallicRoughness=
c.__decorate([k.subclass("esri.layer.support.I3SMaterialPBRMetallicRoughness")],a.I3SMaterialPBRMetallicRoughness);a.I3SMaterialDefinition=function(e){function d(){var m=e.apply(this,arguments)||this;m.alphaMode="opaque";m.alphaCutoff=.25;m.doubleSided=!1;m.cullFace="none";m.normalTexture=null;m.occlusionTexture=null;m.emissiveTexture=null;m.emissiveFactor=null;m.pbrMetallicRoughness=null;return m}b._inheritsLoose(d,e);return d}(g.JSONSupport);c.__decorate([l.enumeration({opaque:"opaque",mask:"mask",
blend:"blend"})],a.I3SMaterialDefinition.prototype,"alphaMode",void 0);c.__decorate([h.property({type:Number})],a.I3SMaterialDefinition.prototype,"alphaCutoff",void 0);c.__decorate([h.property({type:Boolean})],a.I3SMaterialDefinition.prototype,"doubleSided",void 0);c.__decorate([l.enumeration({none:"none",back:"back",front:"front"})],a.I3SMaterialDefinition.prototype,"cullFace",void 0);c.__decorate([h.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"normalTexture",void 0);
c.__decorate([h.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"occlusionTexture",void 0);c.__decorate([h.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"emissiveTexture",void 0);c.__decorate([h.property({type:[Number]})],a.I3SMaterialDefinition.prototype,"emissiveFactor",void 0);c.__decorate([h.property({type:a.I3SMaterialPBRMetallicRoughness})],a.I3SMaterialDefinition.prototype,"pbrMetallicRoughness",void 0);a.I3SMaterialDefinition=c.__decorate([k.subclass("esri.layer.support.I3SMaterialDefinition")],
a.I3SMaterialDefinition);a.I3STextureFormat=function(e){function d(){return e.apply(this,arguments)||this}b._inheritsLoose(d,e);return d}(g.JSONSupport);c.__decorate([h.property({type:String,json:{read:{source:["name","index"],reader:(e,d)=>null!=e?e:`${d.index}`}}})],a.I3STextureFormat.prototype,"name",void 0);c.__decorate([l.enumeration({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],a.I3STextureFormat.prototype,"format",void 0);a.I3STextureFormat=c.__decorate([k.subclass("esri.layer.support.I3STextureFormat")],
a.I3STextureFormat);a.I3STextureSetDefinition=function(e){function d(){var m=e.apply(this,arguments)||this;m.atlas=!1;return m}b._inheritsLoose(d,e);return d}(g.JSONSupport);c.__decorate([h.property({type:[a.I3STextureFormat]})],a.I3STextureSetDefinition.prototype,"formats",void 0);c.__decorate([h.property({type:Boolean})],a.I3STextureSetDefinition.prototype,"atlas",void 0);a.I3STextureSetDefinition=c.__decorate([k.subclass("esri.layer.support.I3STextureSetDefinition")],a.I3STextureSetDefinition);
a.I3SGeometryAttribute=function(e){function d(){return e.apply(this,arguments)||this}b._inheritsLoose(d,e);return d}(g.JSONSupport);c.__decorate([l.enumeration({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],a.I3SGeometryAttribute.prototype,"type",void 0);c.__decorate([h.property({type:Number})],a.I3SGeometryAttribute.prototype,"component",void 0);a.I3SGeometryAttribute=c.__decorate([k.subclass("esri.layer.support.I3SGeometryAttribute")],a.I3SGeometryAttribute);
a.I3SGeometryCompressedAttributes=function(e){function d(){return e.apply(this,arguments)||this}b._inheritsLoose(d,e);return d}(g.JSONSupport);c.__decorate([l.enumeration({draco:"draco"})],a.I3SGeometryCompressedAttributes.prototype,"encoding",void 0);c.__decorate([h.property({type:[String]})],a.I3SGeometryCompressedAttributes.prototype,"attributes",void 0);a.I3SGeometryCompressedAttributes=c.__decorate([k.subclass("esri.layer.support.I3SGeometryCompressedAttributes")],a.I3SGeometryCompressedAttributes);
a.I3SGeometryBuffer=function(e){function d(){var m=e.apply(this,arguments)||this;m.offset=0;return m}b._inheritsLoose(d,e);return d}(g.JSONSupport);c.__decorate([h.property({type:Number})],a.I3SGeometryBuffer.prototype,"offset",void 0);c.__decorate([h.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"position",void 0);c.__decorate([h.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"normal",void 0);c.__decorate([h.property({type:a.I3SGeometryAttribute})],
a.I3SGeometryBuffer.prototype,"uv0",void 0);c.__decorate([h.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"color",void 0);c.__decorate([h.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"uvRegion",void 0);c.__decorate([h.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"featureId",void 0);c.__decorate([h.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"faceRange",void 0);c.__decorate([h.property({type:a.I3SGeometryCompressedAttributes})],
a.I3SGeometryBuffer.prototype,"compressedAttributes",void 0);a.I3SGeometryBuffer=c.__decorate([k.subclass("esri.layer.support.I3SGeometryBuffer")],a.I3SGeometryBuffer);a.I3SGeometryDefinition=function(e){function d(){return e.apply(this,arguments)||this}b._inheritsLoose(d,e);return d}(g.JSONSupport);c.__decorate([l.enumeration({triangle:"triangle"})],a.I3SGeometryDefinition.prototype,"topology",void 0);c.__decorate([h.property()],a.I3SGeometryDefinition.prototype,"geometryBuffers",void 0);a.I3SGeometryDefinition=
c.__decorate([k.subclass("esri.layer.support.I3SGeometryDefinition")],a.I3SGeometryDefinition);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/RangeInfo":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,g,h,w,n,f,l){a.RangeInfo=
function(k){function e(){var d=k.apply(this,arguments)||this;d.name=null;d.field=null;d.currentRangeExtent=null;d.fullRangeExtent=null;d.type="rangeInfo";return d}b._inheritsLoose(e,k);return e}(g.JSONSupport);c.__decorate([h.property({type:String,json:{read:!0,write:!0}})],a.RangeInfo.prototype,"name",void 0);c.__decorate([h.property({type:String,json:{read:!0,write:!0}})],a.RangeInfo.prototype,"field",void 0);c.__decorate([h.property({type:[Number],json:{read:!0,write:!0}})],a.RangeInfo.prototype,
"currentRangeExtent",void 0);c.__decorate([h.property({type:[Number],json:{read:!0,write:!0}})],a.RangeInfo.prototype,"fullRangeExtent",void 0);c.__decorate([h.property({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],a.RangeInfo.prototype,"type",void 0);a.RangeInfo=c.__decorate([l.subclass("esri.layers.support.RangeInfo")],a.RangeInfo);a.default=a.RangeInfo;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/FeatureLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../support/featureFlags ./FeatureLayerViewBase3D".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){h=function(d){function m(){var z=d.apply(this,arguments)||this;z.type="feature-3d";z.direct3DObjectFeatureLayerDisplayEnabled=k.enableDirect3DObjectFeatureLayerDisplay();return z}a._inheritsLoose(m,d);m.prototype.initialize=function(){this.layer.infoFor3D&&!this.direct3DObjectFeatureLayerDisplayEnabled&&this.addResolvingPromise(Promise.reject(new c("featurelayerview3d:unsupported-geometry-type",`Unsupported geometry type ${this.layer.geometryType}`)));"mesh"!==this.layer.geometryType||
l.canProjectWithoutEngine(this.layer.spatialReference,this.view.spatialReference)||this.addResolvingPromise(Promise.reject(new c("layerview:spatial-reference-incompatible","The spatial references of the feature layer layer is incompatible with the spatial reference of the view")))};a._createClass(m,[{key:"featureSpatialReference",get:function(){var z,v;return null==(z=this.view.featureTiles)?void 0:null==(v=z.tilingScheme)?void 0:v.spatialReference}}]);return m}(e);b.__decorate([g.property({constructOnly:!0})],
h.prototype,"direct3DObjectFeatureLayerDisplayEnabled",void 0);b.__decorate([g.property()],h.prototype,"layer",void 0);return h=b.__decorate([f.subclass("esri.views.3d.layers.FeatureLayerView3D")],h)})},"esri/views/3d/layers/FeatureLayerViewBase3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ./FeatureLikeLayerView3D ./LayerView3D ./support/FeatureTileFetcher3DLayerViewContext ../support/EventedSet ../support/updatingProperties ../webgl-engine/lib/basicInterfaces ../../layers/FeatureLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E){n=function(A){function p(D){D=A.call(this,D)||this;D._controllerTotal=0;D._processorTotal=0;D.suspendResumeExtentMode="data";return D}a._inheritsLoose(p,A);var B=p.prototype;B.initialize=function(){this.updatingHandles.add(()=>this.view.floors,()=>this.processor.filterVisibility.filterChanged());this.handles.add(h.watch(()=>this._updatingRequiredFieldsPromise,D=>this.updatingHandles.addPromise(D),h.syncAndInitial))};B.destroy=function(){this.updatingHandles.removeAll();
this.handles.removeAll();this.fetcherContext=g.destroyMaybe(this.fetcherContext)};B.setVisibility=function(D,C){var F;null==(F=this.processor)?void 0:F.setObjectIdVisibility(D,C)};B.createQuery=function(){return A.prototype.createQuery.call(this)};B.queryFeatures=function(D,C){const F=()=>A.prototype.queryFeatures.call(this,D,C);return"mesh"===this.layer.geometryType?this._queryFeaturesMesh(this._ensureQuery(D),F):F()};B.beforeSetController=function(D){D.maximumNumberOfFeatures=this.maximumNumberOfFeatures};
B.createController=function(){this.fetcherContext=new v.FeatureTileFetcher3DLayerViewContext({layerView:this,returnZ:this.hasZ,returnM:this.hasM});const D=new d.FeatureTileController3D({layerView:this,context:this.fetcherContext,graphics:new q.EventedSet,extent:this.clippingExtent});this.updatingHandles.add(()=>D.serviceDataExtent,C=>{this.processor&&(this.processor.dataExtent=C)},h.initial);this.handles.add(h.watch(()=>this.suspended,C=>{C?D.suspend():D.resume()},h.syncAndInitial));this.updatingHandles.add(()=>
{var C;return null==(C=this.processor)?void 0:C.displayFeatureLimit},C=>D.displayFeatureLimit=C,h.initial);this.handles.add(h.when(()=>!this.updating,()=>{this._processorTotal=this._controllerTotal=0}));return D};B.doRefresh=function(){var D=a._asyncToGenerator(function*(C){C&&!this.suspended&&this.controller&&this.controller.refetch();this.processor.filterVisibility.dirty=!0});return function(C){return D.apply(this,arguments)}}();B.getUsedMemory=function(){var D,C,F,G;const L=null!=(D=null==(C=this.processor)?
void 0:C.usedMemory)?D:0;D=null!=(F=null==(G=this.controller)?void 0:G.memoryForUnusedFeatures)?F:0;return L+D};B.getUnloadedMemory=function(){var D,C,F,G,L;const H=null!=(D=null==(C=this.processor)?void 0:C.unprocessedMemoryEstimate)?D:0;D=null!=(F=(null==(G=this.controller)?NaN:G.expectedFeatureDiff)*(null==(L=this.processor)?NaN:L.usedMemoryPerFeature))?F:0;return H+D};B.ignoresMemoryFactor=function(){var D;return null==(D=this.controller)?void 0:D.hasMaximumNumberOfFeaturesOverride};B._queryFeaturesMesh=
function(){var D=a._asyncToGenerator(function*(C,F){yield this._validateQueryFeaturesMesh(C);F=yield F();if(C&&C.outStatistics||g.isNone(this.graphics3DProcessor))return F;C=this.layer.objectIdField;const G=this.graphics3DProcessor.graphics3DGraphicsByObjectID,L=[];for(const H of F.features)if(H.geometry){const M=G.get(H.attributes[C]);M&&(H.geometry=e.hydrateGeometry(M.graphic.geometry),L.push(H))}else L.push(H);F.features=L;return F});return function(C,F){return D.apply(this,arguments)}}();B._validateQueryFeaturesMesh=
function(){var D=a._asyncToGenerator(function*(C){if(C){var F=L=>{throw new c("feature-layer-view:unsupported-query",`Queries on Mesh feature collection layers do not support '${L}'`);},G=["quantizationParameters","geometryPrecision","maxAllowableOffset"];for(const L of G)null!=C[L]&&F(L);"returnM"in C&&C.returnM&&F("returnM");"returnCentroid"in C&&C.returnCentroid&&F("returnCentroid");g.isSome(C.outSpatialReference)&&!C.outSpatialReference.equals(this.view.spatialReference)&&F("outSpatialReference")}});
return function(C){return D.apply(this,arguments)}}();a._createClass(p,[{key:"maximumNumberOfFeatures",get:function(){var D,C;return null!=(D=null==(C=this.controller)?void 0:C.maximumNumberOfFeatures)?D:this._get("maximumNumberOfFeatures")},set:function(D){this._set("maximumNumberOfFeatures",D);this.controller&&(this.controller.maximumNumberOfFeatures=D)}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return this.controller?!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded):
!1}},{key:"updatingProgressValue",get:function(){var D,C;let F=0;if(null!=(D=this.controller)&&D.updating){D=this.controller.updatingRemaining;var G=Math.max(this.controller.updatingTotal,this._controllerTotal);0<G&&(F=(G-D)/G,this._controllerTotal=G)}D=0;null!=(C=this.processor)&&C.updating&&(C=this.processor.updatingRemaining,G=Math.max(C,this._processorTotal),0<G&&(D=(G-C)/G,this._processorTotal=G));return.5*(F+D)}},{key:"updatePolicy",get:function(){if(!this.controller)return r.UpdatePolicy.ASYNC;
switch(this.controller.mode){case "snapshot":{const D=y[this.layer.geometryType];return null==D||this.controller.serviceDataCount>D?r.UpdatePolicy.ASYNC:r.UpdatePolicy.SYNC}case "tiles":return r.UpdatePolicy.ASYNC}}},{key:"hasZ",get:function(){const D=this.layer,C=D.capabilities&&D.capabilities.data;return C&&C.supportsZ?"returnZ"in D&&null!=D.returnZ?D.returnZ:C.supportsZ:!1}},{key:"hasM",get:function(){const D=this.layer,C=D.capabilities&&D.capabilities.data;return C&&C.supportsM?"returnM"in D&&
null!=D.returnM?D.returnM:!1:!1}},{key:"performanceInfo",get:function(){var D,C,F,G,L;const H=null==(D=this.controller)?void 0:D.displayFeatureLimit;D=g.isSome(H)&&H.averageSymbolComplexity;D=g.isSome(D)?`f:${D.primitivesPerFeature},v:${D.primitivesPerCoordinate}`:"n/a";D={...this._getResourceInfo(),storedFeatures:0,totalVertices:0,partial:this.maximumNumberOfFeaturesExceeded,mode:null!=(C=null==(F=this.controller)?void 0:F.mode)?C:"n/a",symbolComplexity:D,nodes:null!=(G=null==(L=this.controller)?
void 0:L.tileDescriptors.length)?G:0};this.controller&&D.displayedNumberOfFeatures&&(C=this.controller.debug,D.storedFeatures=C.storedFeatures,D.totalVertices=C.totalVertices);return D}},{key:"test",get:function(){return{updatePolicy:this.updatePolicy,controller:this.controller}}}]);return p}(E.RefreshableLayerView(m.FeatureLikeLayerView3D(x.FeatureLayerView(z.LayerView3D(u)))));b.__decorate([w.property()],n.prototype,"layer",void 0);b.__decorate([w.property()],n.prototype,"controller",void 0);b.__decorate([w.property()],
n.prototype,"_controllerTotal",void 0);b.__decorate([w.property()],n.prototype,"_processorTotal",void 0);b.__decorate([w.property()],n.prototype,"maximumNumberOfFeatures",null);b.__decorate([w.property()],n.prototype,"maximumNumberOfFeaturesExceeded",null);b.__decorate([w.property(t.updatingProgress)],n.prototype,"updatingProgress",void 0);b.__decorate([w.property({readOnly:!0})],n.prototype,"updatingProgressValue",null);b.__decorate([w.property({readOnly:!0})],n.prototype,"updatePolicy",null);b.__decorate([w.property({readOnly:!0})],
n.prototype,"hasZ",null);b.__decorate([w.property({readOnly:!0})],n.prototype,"hasM",null);b.__decorate([w.property()],n.prototype,"suspendResumeExtentMode",void 0);n=b.__decorate([k.subclass("esri.views.3d.layers.FeatureLayerViewBase3D")],n);const y={point:5E3,polygon:500,polyline:1E3};return n})},"esri/layers/graphics/controllers/FeatureTileController3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/asyncUtils ../../../core/Collection ../../../core/has ../../../core/Error ../../../core/Handles ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/Promise ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../support/arcgisLayerUrl ../../../portal/support/geometryServiceUtils ../../../rest/support/StatisticDefinition ../../../views/3d/layers/support/FeatureTileFetcher3D ../../../views/3d/layers/support/FeatureTileFetcher3DDebugger ../../../views/3d/support/debugFlags ../../../views/support/WatchUpdatingTracking".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B){function D(F,G){if(!G)return!1;for(const L of G)if(!F.has(L))return!0;return!1}const C=e.getLogger("esri.layers.graphics.controllers.FeatureTileController3D");a.FeatureTileController3D=function(F){function G(H){H=F.call(this,H)||this;H.type="feature-tile-3d";H.watchUpdatingTracking=new B.WatchUpdatingTracking;H.serviceDataExtent=null;H.serviceDataCount=a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT;H.vertexLimitExceeded=!1;H.displayFeatureLimit=
null;H.suspended=!1;H.tileFetcher=null;H.handles=new l;H.fetchDataInfoPromise=null;H.fetchDataInfoAbortController=null;H.lifeCycleAbortController=new AbortController;return H}b._inheritsLoose(G,F);var L=G.prototype;L._approximateExtentSizeAtScale=function(H,M){const K=this.layerView.view,I=M.levels[0];return(I.tileSize[0]/(I.scale/H)+I.tileSize[1]/(I.scale/H))/2*Math.ceil((K.width/M.pixelSize+K.height/M.pixelSize)/2)};L.initialize=function(){this.watchUpdatingTracking.add(()=>this.vertexLimitInfo,
()=>this.watchUpdatingTracking.addPromise(this._updateVertexLimitExceeded(null,this.lifeCycleAbortController.signal)));this.watchUpdatingTracking.add(()=>this.mode,()=>this._modeChanged(),v.initial);this.addResolvingPromise(Promise.resolve().then(()=>this._verifyCapabilities()).then(()=>this.watchUpdatingTracking.addPromise(this._fetchServiceDataInfo())).then(()=>this._initializeTileFetcher()))};L._verifyCapabilities=function(){const H=this.layerView.layer;if(!H.get("capabilities.operations.supportsQuery")&&
"ogc-feature"!==H.type)throw new f("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",{layer:H});};L.destroy=function(){this._cancelFetchServiceDataInfo();this.tileFetcher=d.destroyMaybe(this.tileFetcher);this.handles=d.destroyMaybe(this.handles);this.tilesHandle=d.removeMaybe(this.tilesHandle);this.lifeCycleAbortController&&(this.lifeCycleAbortController.abort(),this.lifeCycleAbortController=null);this.watchUpdatingTracking.destroy();
this._set("watchUpdatingTracking",null)};L.suspend=function(){this.suspended||(this.suspended=!0,d.isSome(this.tileFetcher)&&this.tileFetcher.suspend())};L.resume=function(){this.suspended&&(this.suspended=!1,d.isSome(this.tileFetcher)&&this.tileFetcher.resume())};L.restart=function(){const H=()=>{d.isSome(this.tileFetcher)&&this.tileFetcher.restart()};this.watchUpdatingTracking.addPromise(this._fetchServiceDataInfo().then(H,H))};L.refetch=function(){const H=()=>{d.isSome(this.tileFetcher)&&this.tileFetcher.refetch()};
this.watchUpdatingTracking.addPromise(this._fetchServiceDataInfo().then(H,H))};L._initializeTileFetcher=function(){const H=this.layerView.view;if(H){var M=v.whenOnce(()=>{var K;return null==(K=H.featureTiles)?void 0:K.tilingScheme},this.lifeCycleAbortController.signal);this.watchUpdatingTracking.addPromise(M);M.then(()=>{const {layerView:K,tileDescriptors:I}=this,O=K.layer,Q=new y.FeatureTileFetcher3D({context:this.context,filterExtent:this.extent,tileDescriptors:I,features:this.graphics});this.tileFetcher=
Q;this.suspended?this.tileFetcher.suspend():this.tileFetcher.resume();const J=this.layerView.view.resourceController;J&&(this.handles.add(J.memoryController.events.on("quality-changed",N=>{Q.memoryFactor=N})),this.tileFetcher.memoryFactor=J.memoryController.memoryFactor);const P="polygon"===this.context.geometryType?"polygonLodFactor":"polyline"===this.context.geometryType?"polylineLodFactor":null;P&&this.handles.add(v.watch(()=>{var N,R,S;return null==(N=this.layerView.view)?void 0:null==(R=N.qualitySettings)?
void 0:null==(S=R.graphics3D)?void 0:S[P]},N=>Q.lodFactor=N||1,v.initial));"ogc-feature"!==O.type&&this.watchUpdatingTracking.add(()=>O.createQueryVersion,()=>this._dataFilterChanged());this.watchUpdatingTracking.add(()=>K.availableFields,(N,R)=>this._availableFieldsChanged(R,N));this.watchUpdatingTracking.add(()=>K.requiredFields,(N,R)=>this._requiredFieldsChanged(R,N));this.handles.add([O.on("apply-edits",N=>this._applyEdits(N)),this.watch("extent",N=>Q.filterExtent=N,!0),this.watch("tileDescriptors",
N=>Q.tileDescriptors=N,!0),v.watch(()=>this.maximumNumberOfFeatures,N=>{Q.maximumNumberOfFeatures=N;Q.useTileCount=this.serviceDataCount>N},v.syncAndInitial),v.watch(()=>this.serviceDataCount,N=>Q.useTileCount=N>this.maximumNumberOfFeatures,v.syncAndInitial),v.watch(()=>p.FEATURE_TILE_FETCH_SHOW_TILES,N=>{N&&Q&&!Q.debugger?(Q.debugger=new A.FeatureTileFetcher3DDebugger(Q,H.featureTiles.tilingScheme.toTileInfo(),H),Q.debugger.update()):!N&&this.tileFetcher&&Q.debugger&&(Q.debugger.destroy(),Q.debugger=
null)},v.syncAndInitial)]);this.supportsExceedsLimitQuery||this.watchUpdatingTracking.add(()=>this.maxTotalSnapshotVertices,()=>this.watchUpdatingTracking.addPromise(this._updateVertexLimitExceeded(null,this.lifeCycleAbortController.signal)))}).catch(()=>{})}};L._modeChanged=function(){switch(this.mode){case "tiles":this.tilesHandle||(this.tilesHandle=this.layerView.view.featureTiles.addClient());break;default:C.warn("Unhandled feature layer mode "+this.mode);case "snapshot":d.isSome(this.tilesHandle)&&
(this.tilesHandle.remove(),this.tilesHandle=null)}};L._dataFilterChanged=function(){this._set("maxTotalSnapshotVertices",0);this.notifyChange("maxTotalSnapshotVertices");this.refetch()};L._applyEdits=function(H){d.isNone(this.tileFetcher)||this.tileFetcher.applyEdits(H).then(M=>{M&&(M.deletedFeatures.length||M.updatedFeatures.length||M.addedFeatures.length)&&this.watchUpdatingTracking.addPromise(this._updateServiceDataExtent(this.lifeCycleAbortController.signal))}).catch(M=>{if(!z.isAbortError(M))throw M;
})};L._availableFieldsChanged=function(H,M){d.isSome(this.tileFetcher)&&D(this.tileFetcher.availableFields,M)&&this.refetch()};L._requiredFieldsChanged=function(H,M){d.isSome(this.tileFetcher)&&D(this.tileFetcher.availableFields,M)&&this.restart()};L._createVertexLimitExceededQuery=function(H){const M=this.layerView.layer,K=M.createQuery();K.outStatistics=[new E({statisticType:"exceedslimit",maxVertexCount:H,outStatisticFieldName:"exceedslimit",maxPointCount:1E8,maxRecordCount:1E8})];M.capabilities.query.supportsCacheHint&&
(K.cacheHint=!0);return K};L._createDataInfoQuery=function(){const H=this.layerView.layer,M=H.createQuery();M.outSpatialReference=this.layerView.view.spatialReference;H.capabilities.query.supportsCacheHint&&(M.cacheHint=!0);return M};L._fullExtentIsAccurate=function(){const H=this.layerView.layer;if(H.definitionExpression)return!1;switch(H.type){case "feature":return x.isHostedAgolService(H.url);case "csv":case "geojson":case "ogc-feature":case "wfs":return!0}};L._updateServiceDataExtent=function(){var H=
b._asyncToGenerator(function*(M){try{yield this._tryUpdateServiceDataExtent(M)}catch(K){z.isAbortError(K)||this._set("serviceDataExtent",k.clone(this.layerView.fullExtentInLocalViewSpatialReference))}});return function(M){return H.apply(this,arguments)}}();L._tryUpdateServiceDataExtent=function(){var H=b._asyncToGenerator(function*(M){var K=this.layerView;const I=K.layer,O=I.capabilities.query.supportsExtent,Q=k.clone(K.fullExtentInLocalViewSpatialReference),J=I.fullExtent,P=this._fullExtentIsAccurate(),
N=this.serviceDataCount;O&&N<=a.FeatureTileController3DConstants.MAX_FEATURE_COUNT_FOR_EXTENT&&(!Q||!P)&&"queryExtent"in I?(K=this._createDataInfoQuery(),M=yield I.queryExtent(K,{timeout:a.FeatureTileController3DConstants.QUERY_EXTENT_TIMEOUT,signal:M}),this._set("serviceDataExtent",M.extent)):Q?this._set("serviceDataExtent",Q):d.isSome(J)?(M=yield u.projectGeometry(J,K.view.spatialReference,"portalItem"in I?I.portalItem:null,M),this._set("serviceDataExtent",M)):this._set("serviceDataExtent",null)});
return function(M){return H.apply(this,arguments)}}();L._updateServiceDataCount=function(){var H=b._asyncToGenerator(function*(M){const K=this.layerView.layer;if("queryFeatureCount"in K)if(M=yield h.result(K.queryFeatureCount(this._createDataInfoQuery(),{timeout:a.FeatureTileController3DConstants.QUERY_STATISTICS_TIMEOUT,signal:M})),!0===M.ok)this._set("serviceDataCount",M.value);else{if(z.isAbortError(M.error))throw M.error;this._set("serviceDataCount",a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT)}else this._set("serviceDataCount",
a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT)});return function(M){return H.apply(this,arguments)}}();L._updateVertexLimitExceeded=function(){var H=b._asyncToGenerator(function*(M,K){var I=this.vertexLimitInfo;if(d.isNone(I))this._set("vertexLimitExceeded",!1);else{var O=1<this.minimumNumberOfVerticesForGeometry;if(0>=I.primitivesPerFeature||O){var {primitivesPerFeature:Q,primitivesPerCoordinate:J,maximumTotalNumberOfPrimitives:P}=I;0!==Q&&d.isSome(M)&&(yield M);I=this.serviceDataCount;
var N=I!==a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT;M=N?Math.ceil((P-I*Q)/(J||1)):Math.ceil(P/(J||1));O&&(M=Math.min(M,5E6));if(N&&this.minimumNumberOfVerticesForGeometry*I>M)this._set("vertexLimitExceeded",!0);else if(this.supportsExceedsLimitQuery)if(K=yield h.result(this.layerView.layer.queryFeatures(this._createVertexLimitExceededQuery(M),{timeout:a.FeatureTileController3DConstants.QUERY_STATISTICS_TIMEOUT,signal:K})),!1===K.ok){if(z.isAbortError(K.error))throw K.error;this._set("vertexLimitExceeded",
!1)}else(K=K.value.features[0])&&K.attributes?this._set("vertexLimitExceeded",!!K.attributes.exceedslimit):this._set("vertexLimitExceeded",!1);else this._set("vertexLimitExceeded",this.maxTotalSnapshotVertices>M)}else this._set("vertexLimitExceeded",!1)}});return function(M,K){return H.apply(this,arguments)}}();L._fetchServiceDataInfo=function(){var H=b._asyncToGenerator(function*(){this._cancelFetchServiceDataInfo();let M=new AbortController;const K=M.signal;var I=this._updateServiceDataCount(K);
I=z.eachAlways([I,this._updateVertexLimitExceeded(I,K)]);const O=I.then(()=>this._updateServiceDataExtent(K)).catch(Q=>{z.isAbortError(Q)||C.error("#fetchServiceDataInfo()",Q)}).then(()=>{O===this.fetchDataInfoPromise&&(this.fetchDataInfoAbortController=this.fetchDataInfoPromise=null);M=null});M&&(this.fetchDataInfoPromise=O);this.fetchDataInfoAbortController=M;return I.then(()=>{},()=>{})});return function(){return H.apply(this,arguments)}}();L._cancelFetchServiceDataInfo=function(){const H=this.fetchDataInfoAbortController;
H&&(this.fetchDataInfoPromise=this.fetchDataInfoAbortController=null,H.abort())};b._createClass(G,[{key:"extent",set:function(H){if(H&&!H.spatialReference.equals(this.layerView.view.spatialReference))C.error("#extent\x3d","extent needs to be in the same spatial reference as the view");else{var M=this._get("extent");M===H||M&&H&&M.equals(H)||(H=H?H.clone():null,this._set("extent",H))}}},{key:"updating",get:function(){return!!(d.isSome(this.tileFetcher)&&this.tileFetcher.updating||null!=this.fetchDataInfoPromise||
"tiles"===this.mode&&this.layerView.view.featureTiles&&this.layerView.view.featureTiles.updating||this.watchUpdatingTracking&&this.watchUpdatingTracking.updating)}},{key:"updatingTotal",get:function(){return this.updating&&d.isSome(this.tileFetcher)?this.tileFetcher.updatingTotal:0}},{key:"updatingRemaining",get:function(){return this.updating&&d.isSome(this.tileFetcher)?this.tileFetcher.updatingRemaining:0}},{key:"expectedFeatureDiff",get:function(){return this.updating&&d.isSome(this.tileFetcher)?
this.tileFetcher.expectedFeatureDiff:0}},{key:"memoryForUnusedFeatures",get:function(){return d.isSome(this.tileFetcher)?this.tileFetcher.memoryForUnusedFeatures:0}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!(!d.isSome(this.tileFetcher)||!this.tileFetcher.maximumNumberOfFeaturesExceeded)}},{key:"maximumNumberOfFeatures",get:function(){return d.isSome(this.displayFeatureLimit)?this.displayFeatureLimit.maximumNumberOfFeatures:0},set:function(H){H!==this.maximumNumberOfFeatures&&(null==
H?this._clearOverride("maximumNumberOfFeatures"):this._override("maximumNumberOfFeatures",H))}},{key:"hasMaximumNumberOfFeaturesOverride",get:function(){return this._isOverridden("maximumNumberOfFeatures")}},{key:"mode",get:function(){var H,M,K=this.layerView.layer;if("feature"===K.type&&d.isSome(K.infoFor3D))return"snapshot";if(!1===(null==(H=this.layerView.view.qualitySettings)?void 0:null==(M=H.graphics3D)?void 0:M.snapshotAvailable)||this.serviceDataCount===a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT||
this.vertexLimitExceeded)return"tiles";H=(H=(H=this.layerView.view)&&H.featureTiles)&&H.tilingScheme;return K&&K.minScale&&this.serviceDataExtent&&H&&(K=this._approximateExtentSizeAtScale(K.minScale,H),(this.serviceDataExtent.width/K+this.serviceDataExtent.height/K)/2>a.FeatureTileController3DConstants.MAX_SNAPSHOT_MIN_SCALE_FACTOR)?"tiles":!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"}},{key:"maxTotalSnapshotVertices",get:function(){const H=
this._get("maxTotalSnapshotVertices")||0,M="snapshot"===this.mode&&d.isSome(this.tileFetcher)&&this.tileFetcher.totalVertices||0;return Math.max(H,M)}},{key:"tileDescriptors",get:function(){return"snapshot"===this.mode?new w([{id:"dummy-tile-full-extent",lij:[0,0,0]}]):this.layerView.view.featureTiles?this.layerView.view.featureTiles.tiles:new w}},{key:"test",get:function(){return{fetchDataInfoPromise:this.fetchDataInfoPromise,tileFetcher:this.tileFetcher}}},{key:"vertexLimitInfo",get:function(){if(d.isNone(this.displayFeatureLimit)||
d.isNone(this.displayFeatureLimit.averageSymbolComplexity))return null;const {averageSymbolComplexity:H,maximumTotalNumberOfPrimitives:M}=this.displayFeatureLimit,{primitivesPerCoordinate:K,primitivesPerFeature:I}=H,O=this._get("vertexLimitInfo");return d.isNone(O)||O.maximumTotalNumberOfPrimitives!==M||O.primitivesPerCoordinate!==K||O.primitivesPerFeature!==I?{primitivesPerCoordinate:K,primitivesPerFeature:I,maximumTotalNumberOfPrimitives:M}:O}},{key:"supportsExceedsLimitQuery",get:function(){const H=
this.layerView.layer;return H.capabilities&&H.capabilities.operations&&H.capabilities.operations.supportsExceedsLimitStatistics}},{key:"minimumNumberOfVerticesForGeometry",get:function(){switch(this.layerView.layer.geometryType){case "point":return 1;case "multipoint":return 1;case "polygon":return 4;case "polyline":return 2;case "multipatch":case "mesh":return 3;default:return 0}}},{key:"debug",get:function(){return{storedFeatures:d.isSome(this.tileFetcher)?this.tileFetcher.storedFeatures:0,totalFeatures:d.isSome(this.tileFetcher)?
this.tileFetcher.totalFeatures:0,totalVertices:d.isSome(this.tileFetcher)?this.tileFetcher.totalVertices:0}}}]);return G}(m.EsriPromiseMixin(g));c.__decorate([q.property({readOnly:!0})],a.FeatureTileController3D.prototype,"type",void 0);c.__decorate([q.property({constructOnly:!0})],a.FeatureTileController3D.prototype,"graphics",void 0);c.__decorate([q.property({constructOnly:!0})],a.FeatureTileController3D.prototype,"layerView",void 0);c.__decorate([q.property({constructOnly:!0})],a.FeatureTileController3D.prototype,
"context",void 0);c.__decorate([q.property()],a.FeatureTileController3D.prototype,"extent",null);c.__decorate([q.property()],a.FeatureTileController3D.prototype,"updating",null);c.__decorate([q.property({readOnly:!0})],a.FeatureTileController3D.prototype,"watchUpdatingTracking",void 0);c.__decorate([q.property()],a.FeatureTileController3D.prototype,"updatingTotal",null);c.__decorate([q.property()],a.FeatureTileController3D.prototype,"updatingRemaining",null);c.__decorate([q.property()],a.FeatureTileController3D.prototype,
"expectedFeatureDiff",null);c.__decorate([q.property()],a.FeatureTileController3D.prototype,"memoryForUnusedFeatures",null);c.__decorate([q.property()],a.FeatureTileController3D.prototype,"maximumNumberOfFeaturesExceeded",null);c.__decorate([q.property({readOnly:!0})],a.FeatureTileController3D.prototype,"serviceDataExtent",void 0);c.__decorate([q.property({readOnly:!0})],a.FeatureTileController3D.prototype,"serviceDataCount",void 0);c.__decorate([q.property({readOnly:!0})],a.FeatureTileController3D.prototype,
"vertexLimitExceeded",void 0);c.__decorate([q.property()],a.FeatureTileController3D.prototype,"displayFeatureLimit",void 0);c.__decorate([q.property({type:Number})],a.FeatureTileController3D.prototype,"maximumNumberOfFeatures",null);c.__decorate([q.property({readOnly:!0})],a.FeatureTileController3D.prototype,"mode",null);c.__decorate([q.property({readOnly:!0})],a.FeatureTileController3D.prototype,"maxTotalSnapshotVertices",null);c.__decorate([q.property({readOnly:!0,dependsOn:["mode"]})],a.FeatureTileController3D.prototype,
"tileDescriptors",null);c.__decorate([q.property()],a.FeatureTileController3D.prototype,"tileFetcher",void 0);c.__decorate([q.property()],a.FeatureTileController3D.prototype,"fetchDataInfoPromise",void 0);c.__decorate([q.property({readOnly:!0})],a.FeatureTileController3D.prototype,"vertexLimitInfo",null);a.FeatureTileController3D=c.__decorate([r.subclass("esri.layers.graphics.controllers.FeatureTileController3D")],a.FeatureTileController3D);a.FeatureTileController3DConstants=void 0;(function(F){F.NO_SERVICE_DATA_COUNT=
Infinity;F.MAX_SNAPSHOT_MIN_SCALE_FACTOR=5;F.reset=function(){F.MAX_FEATURE_COUNT_FOR_EXTENT=1E4;F.QUERY_STATISTICS_TIMEOUT=12E3;F.QUERY_EXTENT_TIMEOUT=1E4}})(a.FeatureTileController3DConstants||(a.FeatureTileController3DConstants={}));a.FeatureTileController3DConstants.reset();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileFetcher3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/scheduling ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../rest/support/QuantizationParameters ../../../../rest/support/Query ../../../ViewingMode ./featureReference ./FeatureTile ../../terrain/tileUtils ../../../support/Scheduler".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B){function D(I){return"dummy-tile-full-extent"===I.id}function C(I){let O=0;for(const Q of I)Q.features&&0<Q.features.length&&Q.alive&&(O=Math.max(O,Q.descriptor.lij[0]));return O}function F(I){I.setFeatures([],0,null);I.featuresMissing=!1;return A.FetchStatus.DONE}function G(I){return f.isNone(I)?new Set:new Set(I.map(O=>O.name))}function L(I,O){if(f.isNone(I)||f.isNone(O))return G(O);const Q=new Set;for(const {name:J}of O)I.has(J)&&Q.add(J);
return Q}const H=w.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D");a.FeatureTileFetcher3D=function(I){function O(J){J=I.call(this,J)||this;J._useTileCount=!1;J.updating=!1;J.updatingTotal=0;J.updatingRemaining=0;J.expectedFeatureDiff=0;J.maximumNumberOfFeaturesExceeded=!1;J.maximumNumberOfFeaturesExceededThrottle=1E3;J._fullRatio=1;J._farRatio=1;J.changes={updates:{adds:[],removes:[]},adds:[],removes:[]};J.handles=new h;J._frameTask=B.ImmediateTask;J._dirty=!1;J.featureTiles=new Map;
J.displayingFeatureReferences=new Map;J.numDisplayingFeatureReferences=0;J.suspended=!0;J.pendingEdits=null;return J}b._inheritsLoose(O,I);var Q=O.prototype;Q.initialize=function(){this.handles.add(e.on(this,"tileDescriptors","change",()=>this._setDirty(),()=>this._setDirty()));this.objectIdField=this.context.objectIdField;this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?y.MultiFeatureReference:y.SingleFeatureReference;const J=this.context.scheduler;f.isSome(J)&&(this._frameTask=
J.registerTask(B.TaskPriority.FEATURE_TILE_FETCHER,this));this._setDirty()};Q.destroy=function(){this._frameTask.remove();this.handles=f.destroyMaybe(this.handles);this.featureTiles.forEach(J=>{this._cancelFetchTile(J);this._removeTile(J)});this.featureTiles.clear();this.displayingFeatureReferences.clear();this.pendingEdits&&(this.pendingEdits.controller.abort(),this.pendingEdits=null)};Q.restart=function(){this.featureTiles.forEach(J=>{this._cancelFetchTile(J);this._clearTile(J);this._resetFetchTile(J)});
f.isSome(this.context.memoryCache)&&this.context.memoryCache.clear();this._setDirty()};Q.refetch=function(){this.featureTiles.forEach(J=>{this._cancelFetchTile(J);this._resetFetchTile(J)});f.isSome(this.context.memoryCache)&&this.context.memoryCache.clear();this._setDirty()};Q.suspend=function(){this.suspended||(this.suspended=!0,this._pause(),this._setDirty())};Q.resume=function(){this.suspended&&(this.suspended=!1,this._unpause())};Q._pause=function(){this.paused&&(this.featureTiles.forEach(J=>
this._cancelFetchTile(J)),this._updated())};Q._unpause=function(){this.paused||(this._setDirty(),this._updated())};Q.applyEdits=function(J){this.pendingEdits||(this.pendingEdits={edits:Promise.resolve(),count:0,controller:new AbortController},this._pause());const P=this.pendingEdits;P.count++;const N=P.edits.then(()=>J.result.catch(R=>{if(l.isAbortError(R))throw R;return null}).then(R=>{if(!R)return R;this._applyEditsDeleteFeatures(R.deletedFeatures);return this._applyEditsAddUpdateFeatures(R.addedFeatures,
R.updatedFeatures,P.controller.signal).then(()=>R)}).then(R=>{0===--P.count&&(this.pendingEdits===P&&(this.pendingEdits=null),f.isSome(this.context.memoryCache)&&this.context.memoryCache.clear(),this._unpause(),this._updated());return R}));P.edits=N;this._updated();return N};Q._applyEditsDeleteFeatures=function(J){if(0!==J.length){var P=this.context.globalIdField,N=P&&this.availableFields.has(P),R=new Set,S=this.objectIdField;J.forEach(({objectId:T,globalId:V})=>{(!T||0>T)&&P?(N||H.errorOncePerTick(`Editing the specified service requires the layer's globalIdField, ${P} to be included the layer's outFields for updates to be reflected in the view`),
(T=this.features.find(W=>W.attributes&&W.attributes[P]===V))&&R.add(r.getObjectId(T,S))):R.add(T)});this.featureTiles.forEach(T=>{if(T.features){var V=T.features.filter(W=>!R.has(r.getObjectId(W,this.objectIdField)));V.length!==T.features.length&&(T.setFeatures(V,0,T.availableFields),this._invalidateCounts())}})}};Q._applyEditsAddUpdateFeatures=function(){var J=b._asyncToGenerator(function*(P,N,R){const S=[],T=new Set;P.forEach(W=>S.push(W.objectId));N.forEach(W=>{S.push(W.objectId);T.add(W.objectId)});
if(0!==S.length){var V=[];this.featureTiles.forEach(W=>{(W=this._applyEditsAddUpdateTile(W,S,T,R))&&V.push(W)});yield l.eachAlways(V)}});return function(P,N,R){return J.apply(this,arguments)}}();Q._applyEditsAddUpdateTile=function(){var J=b._asyncToGenerator(function*(P,N,R,S){if(P.features){var T=this._createQuery(P);T.resultType=void 0;T.cacheHint=!1;T.objectIds=N;N=yield this._queryFeatures(T,S);S=null;0<R.size&&(T=P.features.filter(V=>!R.has(r.getObjectId(V,this.objectIdField))),T.length!==P.features.length&&
(S=T));if(0<N.features.length){S||(S=P.features.slice());for(const V of N.features)S.push(V)}S&&(P.hasPreciseFeatureCount&&(P.numFeatures=Math.max(P.numFeatures,S.length)),P.setFeatures(S,0,L(P.availableFields,N.fields)),this._invalidateCounts())}});return function(P,N,R,S){return J.apply(this,arguments)}}();Q._queryFeatures=function(J,P){return this.context.query.queryFeaturesDehydrated(J,{signal:P,timeout:6E5})};Q._setDirty=function(){this._dirty=!0;this._updated()};Q.runTask=function(J){this._frameTask.processQueue(J);
if(this._dirty&&this.constructed){this._dirty=!1;var P=this._getListOfTiles();this._markTilesNotAlive(P);if(J.run(()=>this._addTiles(P,J))&&J.run(()=>this._filterExtentTiles(P,J))&&J.run(()=>this._removeTiles(P,J))&&!J.done){var N=this._sortTiles(P);J.run(()=>this._displayTiles(N,J))&&J.run(()=>this._fetchTiles(N,J))&&J.run(()=>this._updateMemoryEstimates(N,J))||this._setDirty();this._updated();this.updating||this._updateMaximumNumberOfFeaturesExceeded()}else this._setDirty()}};Q._markTilesNotAlive=
function(J){for(const P of J)P.alive=!1};Q._addTiles=function(J,P){if(this.suspended)return!1;this.tileDescriptors.forEach(N=>{const R=this.featureTiles.get(N.id);R?R.alive=!0:P.done||(J.push(this._addTile(N)),P.madeProgress())});return P.hasProgressed};Q._filterExtentTiles=function(J,P){for(const N of J){if(P.done)break;N.alive&&(N.filtered=!N.intersects(this.filterExtent),N.filtered&&(this._clearTile(N),P.madeProgress()))}return P.hasProgressed};Q._removeTiles=function(J,P){for(let N=J.length-1;0<=
N&&!P.done;N--){const R=J[N];R.alive||(this._removeTile(R),N!==J.length-1&&(J[N]=J[J.length-1]),J.pop(),P.madeProgress())}return P.hasProgressed};Q._sortTiles=function(J){J.sort((P,N)=>P.descriptor.loadPriority-N.descriptor.loadPriority);return J};Q._displayTiles=function(J,P){const N=this._updateRatio(J),R=S=>{const T=1>this._fullRatio?N(S)*this._farRatio:1;S.reduceFeatures(T,this.memoryFactor,this.objectIdField)&&this._setDirty();return this._showTile(S)};for(const S of J)if(!P.run(()=>R(S))){this._setDirty();
break}return P.hasProgressed};Q._fetchTiles=function(J,P){if(this.paused)return!1;var N=!1;for(const S of J)if(S.needsFetching){var R=f.isSome(this.context.memoryCache)?this.context.memoryCache.pop(S.id):null;if(f.isSome(R))S.cache=R,this._setDirty(),this._scheduleUpdated(),P.madeProgress();else if(this._needsNumFeatures(S)&&(N=new AbortController,R=this._fetchTileCount(S,N.signal),this._handleRequest(S,R,N,()=>S.numFeatures=A.FAILED_FEATURE_COUNT),N=!0,P.madeProgress()),P.done)return!0}if(N)return P.hasProgressed;
for(const S of J)if(S.needsFetching&&(J=new AbortController,N=this._fetchTile(S,J.signal),this._handleRequest(S,N,J,T=>{S.setFeatures([],0,null);this._invalidateCounts();S.featuresMissing=!1;this.context.logFetchError(H,T)}),P.madeProgress(),P.done))return!0;return P.hasProgressed};Q._updateMemoryEstimates=function(J,P){J.some(N=>P.run(()=>N.updateMemoryEstimates())?!1:(this._setDirty(),!0));return P.hasProgressed};Q._reclip=function(J,P){if(this.constructed){var N=[];this.featureTiles.forEach(R=>
{f.isNone(R.displayingFeatures)||0===R.displayingFeatures.length||(R.intersectionIncludingBorrowed(P,M),R.intersectionIncludingBorrowed(J,K),t.equals(M,K)||N.push(R))});this._refreshDisplayingFeatures(N);this._updated()}};Q._refreshDisplayingFeatures=function(J){const P=new Set,N=this.changes.updates;for(const R of J)if(!f.isNone(R.displayingFeatures))for(const S of R.displayingFeatures)J=r.getObjectId(S,this.objectIdField),P.has(J)||(P.add(J),{feature:J}=this.displayingFeatureReferences.get(J),N.removes.push(J),
N.adds.push(J));this._applyChanges()};Q._updated=function(){let J=0;this.paused||this.featureTiles.forEach(N=>N.isFetching?++J:0);var P=this._dirty||0<J||!!this.pendingEdits;this._set("updating",P);if(P){let N=0,R=0,S=0,T=0,V=0;const W=this.displayingFeatureReferences.size/this.numDisplayingFeatureReferences;this.featureTiles.forEach(aa=>{++R;if(aa.isFetching&&aa.hasPreciseFeatureCount){const da=this._maximumFeaturesForTile(aa)*(1-aa.emptyFeatureRatio),Y=f.isSome(aa.displayingFeatures)?aa.displayingFeatures.length*
W:0;V+=da-Y}aa.needsFetching?++T:0<aa.numFeatures&&(++S,N+=aa.numFeatures)});T+=J;let U=P=0;N?(U=N,P=Math.min(T*N/S,N)):(U=R,P=T);V=Math.min(this.maximumNumberOfFeatures-this.features.length,V);this._set("updatingTotal",U);this._set("updatingRemaining",P);this._set("expectedFeatureDiff",V)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update()};Q._updateMaximumNumberOfFeaturesExceeded=function(){const J=n.someMap(this.featureTiles,
P=>P.perTileMaximumNumberOfFeaturesExceeded);this._set("maximumNumberOfFeaturesExceeded",J)};Q._updateRatio=function(J){const P=C(J),N=T=>1/(1<<Math.max(0,P-T.descriptor.lij[0]));let R=0,S=0;for(const T of J)J=T.numFeatures,R+=J,S+=J*N(T);this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/R);this._farRatio=this.maximumNumberOfFeatures/S;this._scheduleUpdated();return N};Q._maximumFeaturesUpdated=function(J,P){J!==P&&(P>J&&this.featureTiles.forEach(N=>{if(N.featuresMissing){var R=this._maximumFeaturesForTile(N);
N.features&&(N.features.length>=R||N.fetchStatus===A.FetchStatus.FULL)||(this._cancelFetchTile(N),this._resetFetchTile(N))}}),this._setDirty())};Q._addTile=function(J){J=new A.FeatureTile(J);this.featureTiles.set(J.id,J);this._resetFetchTile(J);this._referenceDisplayingFeaturesFromRelatedTiles(J);return J};Q._referenceDisplayingFeaturesFromRelatedTiles=function(J){const P=J.descriptor.resolution;this.featureTiles.forEach(N=>{if(!(f.isNone(N.displayingFeatures)||J===N||J.descriptor.lij&&N.descriptor.lij&&
!p.tilesAreRelated(J.descriptor.lij,N.descriptor.lij))){f.isNone(J.displayingFeatures)&&(J.displayingFeatures=[]);J.descriptor.extent&&N.descriptor.extent&&(f.isNone(J.extentIncludingBorrowedFeatures)&&(J.extentIncludingBorrowedFeatures=t.clone(J.descriptor.extent)),t.expand(J.extentIncludingBorrowedFeatures,N.descriptor.extent,J.extentIncludingBorrowedFeatures));for(const R of N.displayingFeatures)J.displayingFeatures.push(R),N=this.displayingFeatureReferences.get(r.getObjectId(R,this.objectIdField)),
N.ref(N.feature,P),this.numDisplayingFeatureReferences++}});J.featureLimit=f.isSome(J.displayingFeatures)?J.displayingFeatures.length:0};Q._removeTile=function(J){this._clearTile(J);this.featureTiles.delete(J.id)};Q._resetFetchTile=function(J){J.filtered=!J.intersects(this.filterExtent);J.filtered?J.needsFetching&&(J.fetchStatus=A.FetchStatus.DONE):J.fetchStatus=A.FetchStatus.FETCH_NEEDED};Q._cancelFetchTile=function(J){const P=J.requestController;f.isSome(P)&&(J.requestController=null,J.resetFetching(),
P.abort())};Q._fetchTileCount=function(){var J=b._asyncToGenerator(function*(P,N){P.numFeatures=yield this._fetchCount(P,N);this._updateRatio(this._getListOfTiles());return P.fetchStatus===A.FetchStatus.REFETCHING?A.FetchStatus.REFETCH_NEEDED:A.FetchStatus.FETCH_NEEDED});return function(P,N){return J.apply(this,arguments)}}();Q._fetchTile=function(){var J=b._asyncToGenerator(function*(P,N){var R=this._maximumFeaturesForTile(P);if(0>=R)return F(P);const S=this._getMaxRecordCount(P);var T=Math.ceil(R/
S);if(D(P)||!this.context.capabilities.supportsMaxRecordCountFactor||P.numFeatures<=R&&T>u.MAX_MAX_RECORD_COUNT_FACTOR)return this._fetchPagedTile(P,N);T=this._createQuery(P);T.maxRecordCountFactor=Math.ceil(R/S);P.isRefetching&&P.features&&0<P.features.length&&(T.maxRecordCountFactor=Math.max(Math.ceil(P.features.length/(1-P.emptyFeatureRatio)/S)+1,T.maxRecordCountFactor));const {features:V,exceededTransferLimit:W,fields:U}=yield this._queryFeatures(T,N);R=W?T.maxRecordCountFactor>=u.MAX_MAX_RECORD_COUNT_FACTOR?
A.FetchStatus.FULL:A.FetchStatus.DONE:A.FetchStatus.FULL;yield this._frameTask.schedule(()=>{P.featuresMissing=V.length<P.numFeatures||W;const aa=this._removeEmptyFeatures(V);P.setFeatures(V,aa,G(U))},N);this._invalidateCounts();return R});return function(P,N){return J.apply(this,arguments)}}();Q._fetchCount=function(){var J=b._asyncToGenerator(function*(P,N){return this.context.query.queryFeatureCount(this._createFeatureCountQuery(P),{signal:N})});return function(P,N){return J.apply(this,arguments)}}();
Q._fetchPagedTile=function(){var J=b._asyncToGenerator(function*(P,N){let R=0,S=0,T,V=0,W=this._maximumFeaturesForTile(P)-V;const U=this._getMaxRecordCount(P);let aa=null;for(;;){const da=this._createQuery(P),Y=this._setPagingParameters(da,R,W,U),{features:ea,exceededTransferLimit:ja,fields:la}=yield this._queryFeatures(da,N);yield this._frameTask.schedule(()=>{Y&&(R+=f.unwrap(da.num));V+=ea.length;S+=this._removeEmptyFeatures(ea);P.featuresMissing=R<P.numFeatures||ja;T=T?T.concat(ea):ea;aa=L(aa,
la);P.setFeatures(T,S,aa)},N);this._invalidateCounts();this._setDirty();W=this._maximumFeaturesForTile(P)-V;if(!Y||!ja||0>=W)return ja?A.FetchStatus.DONE:A.FetchStatus.FULL}});return function(P,N){return J.apply(this,arguments)}}();Q._createFeatureCountQuery=function(J){J=this._createQuery(J);this.context.capabilities.supportsCacheHint&&(J.resultType=void 0,J.cacheHint=!0);return J};Q._createQuery=function(J){const P=this.context.createQuery(),N=J.descriptor.extent;N&&(P.geometry=t.toExtent(N,this.context.tilingScheme.spatialReference));
this._setResolutionParams(P,J);this._useTileQuery(J)?P.resultType="tile":this.context.capabilities.supportsCacheHint&&(P.cacheHint=!0);return P};Q._setPagingParameters=function(J,P,N,R){if(!this.context.capabilities.supportsPagination)return!1;J.start=P;0<N&&this.context.capabilities.supportsMaxRecordCountFactor?(J.maxRecordCountFactor=Math.ceil(N/R),J.num=Math.min(J.maxRecordCountFactor*R,N)):J.num=Math.min(R);return!0};Q._getEffectiveTileResolution=function(J){if(null==J.descriptor.resolution)return null;
const P=this.context.viewingMode===E.ViewingMode.Global?this.context.tilingScheme.resolutionAtLevel(3):Infinity;return Math.min(J.descriptor.resolution,P)/this.lodFactor};Q._setResolutionParams=function(J,P){this.supportsResolution&&(P=this._getEffectiveTileResolution(P),null!=P&&(this.context.capabilities.supportsQuantization?J.quantizationParameters=new x({mode:"view",originPosition:"upper-left",tolerance:P,extent:this.context.fullExtent}):"polyline"===this.context.geometryType&&(J.maxAllowableOffset=
P)))};Q._removeEmptyFeatures=function(J){const P=J.length;for(let N=0;N<J.length;)r.hasVertices(J[N].geometry)?++N:(J[N]=J[J.length-1],--J.length);return P-J.length};Q._needsNumFeatures=function(J){return this.useTileCount&&J.needsFeatureCount&&!D(J)};Q._getMaxRecordCount=function(J){const {tileMaxRecordCount:P,maxRecordCount:N}=this.context;return this._useTileQuery(J)&&f.isSome(P)&&0<P&&this.context.capabilities.supportsResultType?P:f.isSome(N)&&0<N?N:2E3};Q._useTileQuery=function(J){return D(J)&&
this.context.capabilities.supportsCacheHint?!1:this.context.capabilities.supportsResultType};Q._handleRequest=function(J,P,N,R){J.fetchStatus=J.needsRefetching?A.FetchStatus.REFETCHING:A.FetchStatus.FETCHING;J.requestController=N;let S=!1;P.then(T=>{J.requestController=null;J.fetchStatus=T}).catch(T=>{J.requestController===N&&(J.requestController=null,J.fetchStatus=A.FetchStatus.DONE);l.isAbortError(T)?S=!0:R(T)}).then(()=>{S||this._setDirty();this._scheduleUpdated()})};Q._scheduleUpdated=function(){this.handles&&
!this.handles.has("scheduleUpdated")&&this.handles.add(k.schedule(()=>{this.handles.remove("scheduleUpdated");this._updated()}),"scheduleUpdated")};Q._showTile=function(J){if(f.isSome(J.displayingFeatures)&&!J.needsDisplayUpdate)return!1;var P=J.features;if(0===J.featureLimit||!P)return P=f.isSome(J.displayingFeatures)&&0<J.displayingFeatures.length,this._hideTileFeatures(J),J.displayingFeatures=[],P;const N=J.descriptor.resolution,R=this.changes.updates,S=this.changes.adds,T=Math.min(J.featureLimit,
P.length);J.featureLimit=T;for(let W=0;W<T;++W){var V=P[W];const U=r.getObjectId(V,this.objectIdField),aa=this.displayingFeatureReferences.get(U);aa?(V=aa.ref(V,N),V.oldVersion!==V.newVersion&&(R.removes.push(V.oldVersion),R.adds.push(V.newVersion))):(this.displayingFeatureReferences.set(U,new this.FeatureReferenceClass(V,N)),S.push(V));this.numDisplayingFeatureReferences++}this._hideTileFeatures(J);this._applyChanges();J.displayingFeatures=P.slice(0,T);return!0};Q._hideTile=function(J){this._cancelFetchTile(J);
this._hideTileFeatures(J)};Q._hideTileFeatures=function(J){if(!f.isNone(J.displayingFeatures)){var P=this.changes.updates,N=this.changes.removes;for(const S of J.displayingFeatures){const T=r.getObjectId(S,this.objectIdField);var R=this.displayingFeatureReferences.get(T);R&&((R=R.unref(J.descriptor.resolution),this.numDisplayingFeatureReferences--,R)?R.oldVersion!==R.newVersion&&(null==R.newVersion?(this.displayingFeatureReferences.delete(T),N.push(R.oldVersion)):(P.adds.push(R.newVersion),P.removes.push(R.oldVersion))):
console.error("Hiding unreferenced feature"))}this._applyChanges();J.displayingFeatures=null}};Q._applyChanges=function(){var J=this.changes.updates;0<J.removes.length&&(this.features.removeMany(J.removes),J.removes.length=0);0<J.adds.length&&(this.features.addMany(J.adds),J.adds.length=0);J=this.changes.adds;const P=this.changes.removes,N=Math.min(J.length,P.length);let R=0;for(;R<N;){const S=Math.min(R+200,N);this.features.addMany(J.slice(R,S));this.features.removeMany(P.slice(R,S));R=S}J.length>
N&&this.features.addMany(0===R?J:J.slice(R));P.length>N&&this.features.removeMany(0===R?P:P.slice(R));J.length=0;P.length=0};Q._clearTile=function(J){this._hideTile(J);J.features&&f.isSome(this.context.memoryCache)&&this.context.memoryCache.put(J.id,J.cache,16+J.estimatedSize);J.setFeatures(null,0,null);this._invalidateCounts()};Q._invalidateCounts=function(){this.notifyChange("totalVertices");this.notifyChange("totalFeatures");this.notifyChange("memoryForUnusedFeatures")};Q._getListOfTiles=function(){return Array.from(this.featureTiles.values())};
Q._maximumFeaturesForTile=function(J){const P=J.hasPreciseFeatureCount?J.numFeatures:Infinity;return Math.min(Math.ceil((J.hasPreciseFeatureCount?P:this.maximumNumberOfFeatures)*(1>this._fullRatio?this._farRatio:1)/(1-J.emptyFeatureRatio)),P)};b._createClass(O,[{key:"maximumNumberOfFeatures",set:function(J){J=J||Infinity;const P=this._get("maximumNumberOfFeatures");J===P||1>J||(this._set("maximumNumberOfFeatures",J),this._maximumFeaturesUpdated(P,J))}},{key:"memoryFactor",set:function(J){this.memoryFactor!==
J&&(this._set("memoryFactor",J),this._setDirty())}},{key:"lodFactor",set:function(J){this.lodFactor!==J&&(this._set("lodFactor",J),this.supportsResolution&&this.refetch())}},{key:"useTileCount",get:function(){return this._useTileCount&&f.isSome(this.context.query.queryFeatureCount)},set:function(J){this._useTileCount=J;this.notifyChange("useTileCount")}},{key:"memoryForUnusedFeatures",get:function(){let J=0;this.featureTiles.forEach(P=>J+=P.estimatedUnusedSize);return J}},{key:"totalVertices",get:function(){let J=
0;this.featureTiles.forEach(P=>J+=P.numVertices);return J}},{key:"totalFeatures",get:function(){let J=0;this.featureTiles.forEach(P=>J+=P.numFeatures);return J}},{key:"filterExtent",set:function(J){if(J&&this.context.tilingScheme&&!J.spatialReference.equals(this.context.tilingScheme.spatialReference))H.error("#filterExtent\x3d","extent needs to be in the same spatial reference as the tiling scheme");else{var P=this._get("filterExtent");P===J||P&&J&&P.equals(J)||(J=J?J.clone():null,this._set("filterExtent",
J),this._reclip(J,P))}}},{key:"paused",get:function(){return this.suspended||!!this.pendingEdits}},{key:"availableFields",get:function(){let J=null;this.featureTiles.forEach(P=>{f.isNone(P.displayingFeatures)||0===P.displayingFeatures.length||(f.isNone(J)?J=new Set(P.availableFields):J.forEach(N=>{P.availableFields.has(N)||f.unwrap(J).delete(N)}))});return f.isSome(J)?J:new Set}},{key:"running",get:function(){return this.updating}},{key:"supportsResolution",get:function(){return this.context.capabilities.supportsMultipleResolutions&&
"point"!==this.context.geometryType}},{key:"storedFeatures",get:function(){return this._getListOfTiles().reduce((J,P)=>J+(P.features?P.features.length:0),0)}},{key:"test",get:function(){return{process:J=>this.runTask(J),getFeatureTileById:J=>this.featureTiles.get(J),forEachFeatureTile:J=>this.featureTiles.forEach(J)}}}]);return O}(g);c.__decorate([d.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,"features",void 0);c.__decorate([d.property()],a.FeatureTileFetcher3D.prototype,"tileDescriptors",
void 0);c.__decorate([d.property({value:Infinity})],a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeatures",null);c.__decorate([d.property({value:1})],a.FeatureTileFetcher3D.prototype,"memoryFactor",null);c.__decorate([d.property({value:1})],a.FeatureTileFetcher3D.prototype,"lodFactor",null);c.__decorate([d.property()],a.FeatureTileFetcher3D.prototype,"useTileCount",null);c.__decorate([d.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updating",void 0);c.__decorate([d.property({readOnly:!0})],
a.FeatureTileFetcher3D.prototype,"updatingTotal",void 0);c.__decorate([d.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updatingRemaining",void 0);c.__decorate([d.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"expectedFeatureDiff",void 0);c.__decorate([d.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"memoryForUnusedFeatures",null);c.__decorate([d.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeaturesExceeded",void 0);c.__decorate([d.property({constructOnly:!0})],
a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeaturesExceededThrottle",void 0);c.__decorate([d.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"totalVertices",null);c.__decorate([d.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"totalFeatures",null);c.__decorate([d.property()],a.FeatureTileFetcher3D.prototype,"filterExtent",null);c.__decorate([d.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,"context",void 0);a.FeatureTileFetcher3D=c.__decorate([q.subclass("esri.views.3d.layers.support.FeatureTileFetcher3D")],
a.FeatureTileFetcher3D);const M=t.create(),K=t.create();c=a.FeatureTileFetcher3D;a.contextCapabilitiesFromLayer=function(I){const O=I.capabilities.query;a:switch(I.geometryType){case "polyline":I=!0;break a;case "polygon":I=I.capabilities&&I.capabilities.query&&I.capabilities.query.supportsQuantization;break a;default:I=!1}return{supportsMultipleResolutions:I,supportsPagination:!(!O||!O.supportsPagination),supportsResultType:!(!O||!O.supportsResultType),supportsCacheHint:!(!O||!O.supportsCacheHint),
supportsQuantization:!(!O||!O.supportsQuantization),supportsQuantizationEditMode:!(!O||!O.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!O||!O.supportsMaxRecordCountFactor),supportsFormatPBF:!(!O||!O.supportsFormatPBF)}};a.default=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/featureReference":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../layers/graphics/dehydratedFeatures","../../../../layers/graphics/dehydratedFeatureComparison"],
function(a,b,c,g){c=function(){function n(l,k){this.highestResolutionVersion=null;this.versions=[];this.ref(l,k)}var f=n.prototype;f.ref=function(l,k){const e=this.feature;w.oldVersion=e;this.feature&&Object.defineProperty(l,"uid",{value:this.feature.uid,configurable:!0});for(var d of this.versions)if(d.resolution===k){d.refCount++;if((k=this.highestResolutionVersion===d&&!g.equals(l,d.feature))||this.highestResolutionVersion!==d)d.feature=l;w.newVersion=k?l:e;return w}d={feature:l,resolution:k,refCount:1};
this.versions.push(d);!this.highestResolutionVersion||k<this.highestResolutionVersion.resolution?(w.newVersion=l,this.highestResolutionVersion=d):w.newVersion=e;return w};f.unref=function(l){for(let k=0;k<this.versions.length;k++){const e=this.versions[k];if(e.resolution===l)return e.refCount--,w.oldVersion=this.feature,0===e.refCount&&(this.versions[k]=this.versions[this.versions.length-1],this.versions.length--,this.highestResolutionVersion===e&&(this._recalculateHighestResolutionVersion(),w.oldVersion=
e.feature)),w.newVersion=this.feature,w}return null};f._recalculateHighestResolutionVersion=function(){if(0===this.versions.length)this.highestResolutionVersion=null;else{var l=this.versions[0];for(let k=1;k<this.versions.length;k++){const e=this.versions[k];e.resolution<l.resolution&&(l=e)}this.highestResolutionVersion=l}};b._createClass(n,[{key:"isReferenced",get:function(){return 0!==this.versions.length}},{key:"isSingle",get:function(){return 1===this.versions.length&&1===this.versions[0].refCount}},
{key:"feature",get:function(){return this.highestResolutionVersion?this.highestResolutionVersion.feature:null}}]);return n}();let h=function(){function n(l){this._feature=l;this.refCount=1}var f=n.prototype;f.ref=function(l){++this.refCount;w.oldVersion=this._feature;this.feature&&Object.defineProperty(l,"uid",{value:this.feature.uid,configurable:!0});g.equals(this._feature,l)||(this._feature=l);w.newVersion=this._feature;return w};f.unref=function(){w.oldVersion=this._feature;if(0<this.refCount&&
(this.refCount--,!this.isReferenced))return w.newVersion=null,w;w.newVersion=this._feature;return w};b._createClass(n,[{key:"isReferenced",get:function(){return 0!==this.refCount}},{key:"isSingle",get:function(){return 1===this.refCount}},{key:"feature",get:function(){return this._feature}}]);return n}();const w={oldVersion:null,newVersion:null};a.MultiFeatureReference=c;a.SingleFeatureReference=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/arrayUtils ../../../../core/maybe ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures".split(" "),
function(a,b,c,g,h,w){const n=new Set;let f=function(){function k(d){this.descriptor=d;this.fetchStatus=a.FetchStatus.FETCH_NEEDED;this._features=null;this._featureLimit=this._numVertices=0;this.featuresMissing=!0;this._shuffled=!1;this._numFeatures=-1;this._emptyFeatureRatio=0;this._estimatedSize=-1;this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;this._availableFields=n;this._displayingFeatures=null;this.alive=!0;this.filtered=!1}var e=k.prototype;e.setFeatures=function(d,m,z){this._availableFields=
g.unwrapOr(z,n);this._features=d;this._shuffled=!1;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0;d&&0<d.length?(this._emptyFeatureRatio=m/(d.length+m),this._numVertices=d.reduce((v,q)=>v+w.numVertices(q.geometry),0)):this._numVertices=this._emptyFeatureRatio=0};e.updateMemoryEstimates=function(){if(0>this._estimatedSize){this._estimatedUnusedSize=this._estimatedSize=0;if(this._features)for(var d=0;d<this._features.length;++d){const m=w.estimateSize(this._features[d]);this._estimatedSize+=
m;d>=this.featureLimit&&(this._estimatedUnusedSize+=m)}return!0}if(this._estimatedUnusedSizeDirty){this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;if(this._features)for(d=this.featureLimit;d<this._features.length;++d)this._estimatedUnusedSize+=w.estimateSize(this._features[d]);return!0}return!1};e.resetFetching=function(){this.fetchStatus=this.fetchStatus===a.FetchStatus.REFETCHING?a.FetchStatus.REFETCH_NEEDED:a.FetchStatus.FETCH_NEEDED};e.intersects=function(d){if(!d||!this.descriptor.extent)return!0;
h.fromExtent(d,l);return h.intersects(this.descriptor.extent,l)};e.intersectionIncludingBorrowed=function(d,m){const z=g.isSome(this.extentIncludingBorrowedFeatures)?this.extentIncludingBorrowedFeatures:this.descriptor.extent;if(!d&&!z)return h.copy(m,h.POSITIVE_INFINITY),m;d?(h.fromExtent(d,m),h.intersection(m,z,m)):h.copy(m,z);return m};e._shuffle=function(d){this._features.sort((m,z)=>w.getObjectId(m,d)-w.getObjectId(z,d));c.shuffle(this._features,16438);this._estimatedUnusedSizeDirty=this._shuffled=
!0};e.reduceFeatures=function(d,m,z){if(0>=d)return!1;if(!this._features)return this.featureLimit=0,!1;let v=!1;this.featureLimit=Math.ceil(this.numFeatures*d);this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,this.fetchStatus===a.FetchStatus.DONE&&0<this._features.length&&(this.fetchStatus=a.FetchStatus.REFETCH_NEEDED,v=!0));!this._shuffled&&1>d&&this._shuffle(z);d=Math.max(this.featureLimit,Math.ceil(m*this.numFeatures));this._features.length>d&&(this._features.length=
d,this.featuresMissing=!0,this.fetchStatus===a.FetchStatus.FULL&&(this.fetchStatus=a.FetchStatus.DONE));return v};b._createClass(k,[{key:"displayingFeatures",get:function(){return this._displayingFeatures},set:function(d){this._displayingFeatures=d;this.extentIncludingBorrowedFeatures=null}},{key:"perTileMaximumNumberOfFeaturesExceeded",get:function(){return!this.filtered&&(this.featuresMissing||this.features&&this.featureLimit!==this.features.length)}},{key:"features",get:function(){return this._features}},
{key:"featureLimit",get:function(){return this._featureLimit},set:function(d){this._featureLimit!==d&&(this._featureLimit=d,this._estimatedUnusedSizeDirty=!0)}},{key:"availableFields",get:function(){return this._availableFields}},{key:"emptyFeatureRatio",get:function(){return this._emptyFeatureRatio}},{key:"numFeatures",get:function(){return this.hasPreciseFeatureCount?this._numFeatures:this._features?this._features.length:0},set:function(d){this._numFeatures=d}},{key:"hasPreciseFeatureCount",get:function(){return-1<
this._numFeatures}},{key:"needsFeatureCount",get:function(){return-1===this._numFeatures}},{key:"numVertices",get:function(){return this._numVertices}},{key:"id",get:function(){return this.descriptor.id}},{key:"estimatedSize",get:function(){this.updateMemoryEstimates();return this._estimatedSize}},{key:"estimatedUnusedSize",get:function(){return this._estimatedUnusedSize}},{key:"isFetching",get:function(){return this.fetchStatus===a.FetchStatus.FETCHING||this.fetchStatus===a.FetchStatus.REFETCHING}},
{key:"isRefetching",get:function(){return this.fetchStatus===a.FetchStatus.REFETCHING}},{key:"needsFetching",get:function(){return this.fetchStatus===a.FetchStatus.FETCH_NEEDED||this.fetchStatus===a.FetchStatus.REFETCH_NEEDED}},{key:"needsRefetching",get:function(){return this.fetchStatus===a.FetchStatus.REFETCH_NEEDED}},{key:"isFetched",get:function(){return this.fetchStatus===a.FetchStatus.DONE||this.fetchStatus===a.FetchStatus.FULL}},{key:"needsDisplayUpdate",get:function(){var d;if(d=!!this._features){a:{d=
this._features;var m=this.displayingFeatures,z=this.featureLimit;if(g.isNone(m)||g.isNone(d)||z!==m.length||z>d.length)d=!1;else{for(let v=0;v<z;++v)if(d[v]!==m[v]){d=!1;break a}d=!0}}d=!d}return d}},{key:"cache",get:function(){return{availableFields:this._availableFields,features:this.features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}},set:function(d){this.requestController=null;this._availableFields=
d.availableFields;this._features=d.features;this._numFeatures=d.numFeatures;this._emptyFeatureRatio=d.emptyFeatureRatio;this.fetchStatus=d.fetchStatus;this.featuresMissing=d.featuresMissing;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0}}]);return k}();a.FetchStatus=void 0;(function(k){k[k.FETCH_NEEDED=0]="FETCH_NEEDED";k[k.REFETCH_NEEDED=1]="REFETCH_NEEDED";k[k.FETCHING=2]="FETCHING";k[k.REFETCHING=3]="REFETCHING";k[k.DONE=4]="DONE";k[k.FULL=5]="FULL"})(a.FetchStatus||(a.FetchStatus={}));
const l=h.create();a.FAILED_FEATURE_COUNT=-2;a.FeatureTile=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileFetcher3DDebugger":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Graphic ../../../../geometry/Polygon ../../../../symbols/FillSymbol3DLayer ../../../../symbols/PointSymbol3D ../../../../symbols/PolygonSymbol3D ../../../../symbols/TextSymbol3DLayer ../../terrain/TilingScheme".split(" "),function(a,b,c,g,h,w,n,
f,l){const k=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];let e=function(){function d(z,v,q){this.loadingGraphics=new Map;this.loadedGraphics=new Map;this.pendingGraphics=new Map;this._enabled=!0;this.tileFetcher=z;this.view=q;this.tilingScheme=new l.default(v);this.loadedSymbols=k.map(t=>new n(new h({material:{color:[t[0],
t[1],t[2],.6]},outline:{color:"black",size:1}})));this.loadingSymbols=[new n(new h({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}}))];this.pendingSymbols=[new n(new h({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}}))];this.dataExtentSymbol=new n(new h({material:{color:[0,0,0,0]},outline:{color:"green",size:4}}))}var m=d.prototype;m.destroy=function(){this.enabled=!1};m.update=function(){this._enabled?(this._synchronizeMaps(this.loadingGraphics,{filter:z=>
z.isFetching,symbols:this.loadingSymbols}),this._synchronizeMaps(this.loadedGraphics,{filter:z=>!z.isFetching,symbols:this.loadedSymbols}),this._synchronizeMaps(this.pendingGraphics,{filter:z=>!z.isFetching,symbols:this.pendingSymbols}),this.showDataExtent(this.tileFetcher.filterExtent)):(this.loadingGraphics.forEach(z=>{this.view.graphics.removeMany(z)}),this.loadingGraphics.clear(),this.loadedGraphics.forEach(z=>{this.view.graphics.removeMany(z)}),this.loadedGraphics.clear(),this.pendingGraphics.forEach(z=>
{this.view.graphics.removeMany(z)}),this.pendingGraphics.clear(),this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null))};m.showDataExtent=function(z){this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null);z&&(z=g.fromExtent(z),this.dataExtentGraphic=new c({geometry:z,symbol:this.dataExtentSymbol}),this.view.graphics.add(this.dataExtentGraphic))};m._synchronizeMaps=function(z,v){const q=[];z.forEach((t,
r)=>{const x=this.tileFetcher.test.getFeatureTileById(r);x&&v.filter(x)||(this.view.graphics.removeMany(t),q.push(r))});q.forEach(t=>z.delete(t));this.tileFetcher.test.forEachFeatureTile(t=>{if(v.filter(t)&&!z.has(t.id)){const [u,E,y]=t.descriptor.lij;this.tilingScheme.ensureMaxLod(u);var r=this.tilingScheme.getExtentGeometry(u,E,y),x=new c({geometry:r,symbol:v.symbols[u%v.symbols.length]});r=new c({geometry:r.center,symbol:new w({verticalOffset:{screenLength:40/.75},callout:{type:"line",color:"white",
border:{color:"black"}},symbolLayers:[new f({text:`${u}/${E}/${y}`,halo:{color:"white",size:1/.75},material:{color:"black"},size:16})]})});x=[x,r];z.set(t.id,x);this.view.graphics.addMany(x)}})};b._createClass(d,[{key:"enabled",get:function(){return this._enabled},set:function(z){this._enabled=z;this.update()}}]);return d}();a.FeatureTileFetcher3DDebugger=e;a.default=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/FeatureLikeLayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ../../../rest/support/Query ./interfaces ./graphics/Graphics3DFeatureProcessor ./graphics/QueryEngine ./support/HeatmapFeatureProcessor ./support/projectExtentUtils ../webgl-engine/lib/basicInterfaces ../../support/Scheduler".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E){a.FeatureLikeLayerView3D=y=>{y=function(A){function p(){var D=A.apply(this,arguments)||this;D.controller=null;D.updatePolicy=u.UpdatePolicy.SYNC;D.suspendResumeExtentMode="computed";D.slicePlaneEnabled=!1;D.drapeSourceType=v.DrapeSourceType.Features;D.fullExtentInLocalViewSpatialReference=null;D.suspendResumeExtent=null;D._controllerCreated=!1;D.clippingExtent=null;D.supportsHeightUnitConversion=!0;D.pendingController=null;D.queryEngine=null;return D}
b._inheritsLoose(p,A);var B=p.prototype;B.initialize=function(){var D=this;const C=this.layer;"isTable"in C&&C.isTable?this.addResolvingPromise(Promise.reject(new g("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:C}))):(this.addResolvingPromise(this._validateGeometryType()),this.updatingHandles.add(()=>this.layer.renderer,F=>this._recreateProcessor(F),w.initial),this.addResolvingPromise(b._asyncToGenerator(function*(){const F=yield x.toViewIfLocal(D);D.fullExtentInLocalViewSpatialReference=
F;yield D._initializeController()})()),this.updatingHandles.add(()=>this.updatePolicy,F=>this.processor.preferredUpdatePolicy=F),this.queryEngine=new t.default({layerView:this,priority:E.TaskPriority.FEATURE_QUERY_ENGINE}),this.notifyChange("updating"))};B.destroy=function(){this._destroyPendingController();this.controller=h.destroyMaybe(this.controller);this._set("processor",h.destroyMaybe(this.processor));this.queryEngine=h.destroyMaybe(this.queryEngine);this.loadedGraphics=null};B._destroyPendingController=
function(){this.pendingController=h.destroyMaybe(this.pendingController)};B.getGraphicFromGraphicUid=function(D){var C;let F=null;null==(C=this.loadedGraphics)?void 0:C.forEach(G=>{G.uid===D&&(F=d.hydrateGraphic(G,this.layer))});return F};B.whenGraphicBounds=function(D,C){var F;return null==(F=this.processor)?void 0:F.whenGraphicBounds(D,C)};B.computeAttachmentOrigin=function(D,C){var F;return null==(F=this.processor)?void 0:F.computeAttachmentOrigin(D,C)};B.queryFeatures=function(D,C){return this.queryEngine.executeQuery(this._ensureQuery(D),
h.get(C,"signal"))};B.queryObjectIds=function(D,C){return this.queryEngine.executeQueryForIds(this._ensureQuery(D),h.get(C,"signal"))};B.queryFeatureCount=function(D,C){return this.queryEngine.executeQueryForCount(this._ensureQuery(D),h.get(C,"signal"))};B.queryExtent=function(D,C){return this.queryEngine.executeQueryForExtent(this._ensureQuery(D),h.get(C,"signal"))};B._ensureQuery=function(D){return h.isNone(D)?this.createQuery():z.from(D)};B.highlight=function(D){return this.processor.highlight(D,
this.layer.objectIdField)};B.maskOccludee=function(D){return this.processor.maskOccludee(D)};B.canResume=function(){var D;return A.prototype.canResume.call(this)&&!(null!=(D=this.processor)&&D.scaleVisibilitySuspended)};B.getSuspendInfo=function(){const D=A.prototype.getSuspendInfo.call(this);return this.processor?{...D,...this.processor.suspendInfo}:D};B.isUpdating=function(){var D,C,F;return!this.processor||this.processor.destroyed?!1:!(this._controllerCreated&&(null==(D=this.controller)||!D.updating)&&
null!=(C=this.view)&&null!=(F=C.basemapTerrain)&&F.ready&&!this.processor.updating)};B._initializeController=function(){var D=b._asyncToGenerator(function*(){const C=this.createController();this.pendingController=C;yield C.when();this._setControllerWhenInitialized(C)});return function(){return D.apply(this,arguments)}}();B._setControllerWhenInitialized=function(){var D=b._asyncToGenerator(function*(C){try{yield this.when()}catch(F){}this._controllerCreated=!0;this.notifyChange("updating");!this.isResolved()||
this.destroyed?this._destroyPendingController():(yield w.whenOnce(()=>{var F,G;return null==(F=this.view)?void 0:null==(G=F.basemapTerrain)?void 0:G.ready}),this.beforeSetController(C),this.pendingController=null,this.controller=C,this.loadedGraphics=C.graphics,this.notifyChange("updating"))});return function(C){return D.apply(this,arguments)}}();B._updateClippingExtent=function(D){this.clippingExtent=D;if(!this.controller)return!1;switch(this.controller.type){case "stream":return!1;case "feature-tile-3d":return this.controller.extent=
D,!0}};B._validateGeometryType=function(){var D=b._asyncToGenerator(function*(){switch(this.layer.geometryType){case "multipatch":case "multipoint":return Promise.reject(new g("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:this.layer.geometryType}))}});return function(){return D.apply(this,arguments)}}();B._recreateProcessor=function(D){var C,F;D="heatmap"===(null==D?void 0:D.type);const G="heatmap"===(null==(C=this.processor)?void 0:C.type);
C=this.processor;C&&D===G||(D=D?new r.HeatmapFeatureProcessor({owner:this}):new q({owner:this,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,preferredUpdatePolicy:this.updatePolicy,updateClippingExtent:L=>this._updateClippingExtent(L)}),this._set("processor",D),null==C?void 0:C.destroy(),null==(F=this.queryEngine)?void 0:F.clear(),this.addResolvingPromise(D.setup()))};
B._getResourceInfo=function(){var D,C;const F=this.controller instanceof m.FeatureTileController3D?this.controller:null;return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:null!=(D=null==F?void 0:F.maximumNumberOfFeatures)?D:-1,totalNumberOfFeatures:null!=(C=null==F?void 0:F.serviceDataCount)?C:-1,nodes:0,...this.processor.performanceInfo}};b._createClass(p,[{key:"legendEnabled",get:function(){var D;return this.canResume()&&(null==(D=this.processor)?void 0:D.legendEnabled)}},
{key:"graphics3DProcessor",get:function(){var D;return"graphics-3d"===(null==(D=this.processor)?void 0:D.type)?this.processor:null}},{key:"heatmapProcessor",get:function(){var D;return"heatmap"===(null==(D=this.processor)?void 0:D.type)?this.processor:null}},{key:"performanceInfo",get:function(){return this._getResourceInfo()}}]);return p}(y);c.__decorate([n.property()],y.prototype,"loadedGraphics",void 0);c.__decorate([n.property()],y.prototype,"suspended",void 0);c.__decorate([n.property({readOnly:!0})],
y.prototype,"legendEnabled",null);c.__decorate([n.property()],y.prototype,"updating",void 0);c.__decorate([n.property()],y.prototype,"controller",void 0);c.__decorate([n.property()],y.prototype,"processor",void 0);c.__decorate([n.property({readOnly:!0})],y.prototype,"updatePolicy",void 0);c.__decorate([n.property({readOnly:!0})],y.prototype,"suspendResumeExtentMode",void 0);c.__decorate([n.property({type:Boolean})],y.prototype,"slicePlaneEnabled",void 0);c.__decorate([n.property({readOnly:!0})],y.prototype,
"suspendInfo",void 0);c.__decorate([n.property()],y.prototype,"graphics3DProcessor",null);c.__decorate([n.property()],y.prototype,"heatmapProcessor",null);return y=c.__decorate([e.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],y)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DFeatureProcessor":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/compilerUtils ../../../../core/HandleOwner ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../core/accessorSupport/diffUtils ../../../../geometry/support/webMercatorUtils ../../../../renderers/support/renderingInfoUtils ../../../../rest/support/Query ./constants ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DFilterVisibility ./Graphics3DFrustumVisibility ./Graphics3DObjectStates ./Graphics3DScaleVisibility ./graphicUtils ../support/attributeUtils ../../webgl-engine/lib/basicInterfaces".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C){h=function(G){function L(M){M=G.call(this,M)||this;M.type="graphics-3d";M.elevationFeatureExpressionEnabled=!1;M.dataExtent=null;M.preferredUpdatePolicy=C.UpdatePolicy.ASYNC;M.suspendResumeExtent=null;return M}a._inheritsLoose(L,G);var H=L.prototype;H.normalizeCtorArgs=function(M){const K=M.frustumVisibilityEnabled?new y:null,I=M.scaleVisibilityEnabled?new p:null,O=(M.filterVisibilityEnabled||M.timeExtentVisibilityEnabled)&&"multipatch"!==
M.owner.layer.geometryType?new E.Graphics3DFilterVisibility:null,Q=M.elevationAlignmentEnabled?new u:null,{owner:J,updateClippingExtent:P,dataExtent:N,elevationFeatureExpressionEnabled:R,preferredUpdatePolicy:S}=M;return{owner:J,updateClippingExtent:P,dataExtent:N,frustumVisibility:K,scaleVisibility:I,filterVisibility:O,elevationAlignment:Q,elevationFeatureExpressionEnabled:R,preferredUpdatePolicy:S}};H.initialize=function(){const M=new x.Graphics3DCore({owner:this,layer:this.layer,preferredUpdatePolicy:this.preferredUpdatePolicy,
elevationFeatureExpressionEnabled:this.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:this.owner.hasZ,hasM:this.owner.hasM});this._set("graphicsCore",M);this.scaleVisibility&&this.updatingHandles.add(()=>this.layer.effectiveScaleRange,()=>this.scaleVisibility.layerMinMaxScaleChangeHandler());this.filterVisibility&&(this.updatingHandles.add(()=>"filter"in this.owner&&this.owner.filter,()=>this.filterVisibility.filterChanged()),this.updatingHandles.add(()=>"timeExtent"in this.owner&&
this.owner.timeExtent,()=>this.filterVisibility.filterChanged()));this.elevationAlignment&&this.updatingHandles.add(()=>this.layer.elevationInfo,(K,I)=>{z.diff(K,I)&&this.updatingHandles.addPromise(this.graphicsCore.elevationInfoChange())});this.updatingHandles.add(()=>this.layer.labelsVisible,()=>this.graphicsCore.updateVisibilityInfo());this.updatingHandles.add(()=>this.layer.labelingInfo,(K,I)=>{z.diff(K,I)&&this.graphicsCore.updateLabelingInfo()});this.updatingHandles.add(()=>this.preferredUpdatePolicy,
K=>this.graphicsCore.preferredUpdatePolicy=K);this.handles.add(this.view.resourceController.memoryController.events.on("quality-changed",()=>this.notifyChange("displayFeatureLimit")))};H.destroy=function(){this.handles.removeAll();this.updatingHandles.removeAll();this._set("frustumVisibility",w.destroyMaybe(this.frustumVisibility));this._set("scaleVisibility",w.destroyMaybe(this.scaleVisibility));this._set("filterVisibility",w.destroyMaybe(this.filterVisibility));this._set("elevationAlignment",w.destroyMaybe(this.elevationAlignment));
this._set("objectStates",w.destroyMaybe(this.objectStates));this._set("graphicsCore",w.destroyMaybe(this.graphicsCore));this._set("owner",null)};H.setup=function(){var M=a._asyncToGenerator(function*(){this.frustumVisibility&&this.frustumVisibility.setup(this);const K=this.owner,I=this.owner.view.basemapTerrain,O=(Q,J,P)=>this.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(Q,J,P);this.scaleVisibility&&this.scaleVisibility.setup(this,this.layer,O,this.graphicsCore,I);this.filterVisibility&&("filter"in
K||"timeExtent"in K)&&this.filterVisibility.setup(K,this.graphicsCore);this.elevationAlignment&&this.elevationAlignment.setup(this,O,this.graphicsCore,K.view.elevationProvider);this._set("objectStates",new A.Graphics3DObjectStates(this.graphicsCore));this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility));this._set("deconfliction",K.view.deconflictor.addGraphicsOwner(this.graphicsCore));yield n.logOnError(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,
scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,objectStates:this.objectStates}));this.updatingHandles.add(()=>this.layer.renderer,Q=>this.updatingHandles.addPromise(this.graphicsCore.rendererChange(Q)));this.updatingHandles.add(()=>K.fullOpacity,()=>this.graphicsCore.opacityChange());this._setupSuspendResumeExtent();this.updateClippingExtent&&(this.updatingHandles.add(()=>K.view.clippingArea,()=>this._updateClippingExtent()),
this._updateClippingExtent());this.graphicsCore.startCreateGraphics();this.graphicsCore.labelsEnabled&&(yield n.logOnError(this.graphicsCore.updateLabelingInfo()))});return function(){return M.apply(this,arguments)}}();H.maskOccludee=function(M){const {set:K,handle:I}=this.objectStates.acquireSet(C.Object3DState.MaskOccludee,null);this.objectStates.setUid(K,M.uid);return I};H.highlight=function(M,K){if(M instanceof t){const {set:I,handle:O}=this.objectStates.acquireSet(C.Object3DState.Highlight,K);
this.owner.queryObjectIds(M).then(Q=>this.objectStates.setObjectIds(I,Q));return O}if("number"===typeof M||"string"===typeof M||M instanceof c)return this.highlight([M],K);"toArray"in M&&(M=M.toArray());if(Array.isArray(M)&&0<M.length){if(M[0]instanceof c)if(null!=D.attributeLookup(this.layer.fieldsIndex,M[0].attributes,K))M=M.map(I=>D.attributeLookup(this.layer.fieldsIndex,I.attributes,K));else{M=M.map(Q=>Q.uid);const {set:I,handle:O}=this.objectStates.acquireSet(C.Object3DState.Highlight,null);
this.objectStates.setUids(I,M);return O}if("number"===typeof M[0]||"string"===typeof M[0]){const {set:I,handle:O}=this.objectStates.acquireSet(C.Object3DState.Highlight,K);this.objectStates.setObjectIds(I,M);return O}}return F};H.whenGraphicBounds=function(M,K){var I;return null==(I=this.graphicsCore)?void 0:I.whenGraphicBounds(M,K)};H.computeAttachmentOrigin=function(M,K){var I;return null==(I=this.graphicsCore)?void 0:I.computeAttachmentOrigin(M,K)};H.notifyGraphicGeometryChanged=function(M){this.graphicsCore.notifyGraphicGeometryChanged(M)};
H.notifyGraphicVisibilityChanged=function(M){this.graphicsCore.notifyGraphicVisibilityChanged(M)};H.getRenderingInfo=function(M,K,I){M=q.getRenderingInfo(M,{renderer:K,arcade:I});w.isSome(M)&&M.color&&(K=M.color,K[0]/=255,K[1]/=255,K[2]/=255);return M};H.getRenderingInfoAsync=function(M,K,I,O){return q.getRenderingInfoAsync(M,{renderer:K,arcade:I,...O})};H.getSymbolLayerSize=function(M,K){var I;return null==(I=this.graphicsCore)?void 0:I.getSymbolLayerSize(M,K)};H.setObjectIdVisibility=function(M,
K){var I;null==(I=this.graphicsCore)?void 0:I.setObjectIdVisibility(M,K)};H._updateClippingExtent=function(){const M=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(M,this.owner.view.spatialReference)&&(this.updateClippingExtent(M)||this.graphicsCore.recreateAllGraphics())};H._setupSuspendResumeExtent=function(){(this.frustumVisibility||this.scaleVisibility)&&this.handles.add(f.watch(()=>this.suspendResumeExtentMode,()=>{this.handles.remove("suspendResumeExtentMode");switch(this.suspendResumeExtentMode){case "computed":this.handles.add([f.watch(()=>
this.graphicsCore.computedExtent,M=>this._updateSuspendResumeExtent(M),f.initial),f.watch(()=>this.graphicsCore.extentPadding,()=>this._updateSuspendResumeExtent(this.graphicsCore.computedExtent))],"suspendResumeExtentMode");break;case "data":this.handles.add([f.when(()=>this.dataExtent,M=>this._updateSuspendResumeExtent(M),f.initial),f.watch(()=>this.graphicsCore.extentPadding,()=>this._updateSuspendResumeExtent(w.unwrap(this.dataExtent)))],"suspendResumeExtentMode");break;default:g.neverReached(this.suspendResumeExtentMode)}},
f.initial))};H._updateSuspendResumeExtent=function(M){M?this._suspendResumeExtentChanged(this._extentToSuspendResumeRect(M,this.suspendResumeExtent)):this._suspendResumeExtentChanged(null)};H._extentToSuspendResumeRect=function(M,K){const I=this.owner.view.spatialReference;if(!M.spatialReference.equals(I)){if(!v.canProject(M,I))return;M=v.project(M,I)}return B.enlargeExtent(M,K,r.SUSPEND_RESUME_EXTENT_OPTIMISM,this.graphicsCore.extentPadding)};H._suspendResumeExtentChanged=function(M){this.frustumVisibility&&
this.frustumVisibility.setExtent(M);this.scaleVisibility&&this.scaleVisibility.setExtent(M)};a._createClass(L,[{key:"featureSpatialReference",get:function(){return"featureSpatialReference"in this.owner?this.owner.featureSpatialReference:void 0}},{key:"layer",get:function(){return this.owner.layer}},{key:"suspendResumeExtentMode",get:function(){return"suspendResumeExtentMode"in this.owner?this.owner.suspendResumeExtentMode:"computed"}},{key:"scaleVisibilitySuspended",get:function(){var M;return null==
(M=this.scaleVisibility)?void 0:M.suspended}},{key:"suspended",get:function(){return this.owner.suspended}},{key:"legendEnabled",get:function(){return!this.frustumVisibility.suspended}},{key:"suspendInfo",get:function(){var M,K;const I={};null!=(M=this.scaleVisibility)&&M.suspended&&(I.outsideScaleRange=!0);null!=(K=this.frustumVisibility)&&K.suspended&&(I.outsideOfView=!0);return I}},{key:"updating",get:function(){var M,K,I;return!!(null!=(M=this.graphicsCore)&&M.updating||null!=(K=this.frustumVisibility)&&
K.updating||null!=(I=this.updatingHandles)&&I.updating)}},{key:"updatingRemaining",get:function(){var M,K;return null!=(M=null==(K=this.graphicsCore)?void 0:K.updatingRemaining)?M:0}},{key:"featureStore",get:function(){var M;return null==(M=this.graphicsCore)?void 0:M.featureStore}},{key:"view",get:function(){return this.owner.view}},{key:"loadedGraphics",get:function(){return this.owner.loadedGraphics}},{key:"fullOpacity",get:function(){return this.owner.fullOpacity}},{key:"filter",get:function(){return"filter"in
this.owner?this.owner.filter:null}},{key:"slicePlaneEnabled",get:function(){return this.owner.slicePlaneEnabled}},{key:"drapeSourceType",get:function(){return this.owner.drapeSourceType}},{key:"updatePolicy",get:function(){return this.owner.updatePolicy}},{key:"graphics3DGraphics",get:function(){var M;return null==(M=this.graphicsCore)?void 0:M.graphics3DGraphics}},{key:"graphics3DGraphicsByObjectID",get:function(){var M;return null==(M=this.graphicsCore)?void 0:M.graphics3DGraphicsByObjectID}},{key:"symbolUpdateType",
get:function(){var M;return null==(M=this.graphicsCore)?void 0:M.symbolUpdateType}},{key:"displayFeatureLimit",get:function(){var M;const K=this.view.resourceController.memoryController.memoryFactor,I=null==(M=this.graphicsCore)?void 0:M.displayFeatureLimit;return 1===K?I:{...I,maximumNumberOfFeatures:Math.ceil(I.maximumNumberOfFeatures*K),maximumTotalNumberOfFeatures:Math.ceil(I.maximumTotalNumberOfFeatures*K),minimumTotalNumberOfFeatures:Math.ceil(I.minimumTotalNumberOfFeatures*K)}}},{key:"usedMemory",
get:function(){var M,K;return null!=(M=null==(K=this.graphicsCore)?void 0:K.usedMemory)?M:0}},{key:"usedMemoryPerFeature",get:function(){var M,K;return null!=(M=null==(K=this.graphicsCore)?void 0:K.usedMemoryPerGraphic)?M:0}},{key:"unprocessedMemoryEstimate",get:function(){var M,K;return null!=(M=null==(K=this.graphicsCore)?void 0:K.unprocessedMemoryEstimate)?M:0}},{key:"performanceInfo",get:function(){return{core:this.graphicsCore.performanceInfo,elevationUpdating:this.elevationAlignment.updating,
visibilityFrustum:!this.frustumVisibility.suspended,visibilityScale:!this.scaleVisibility.suspended}}}]);return L}(h.HandleOwner);b.__decorate([l.property()],h.prototype,"type",void 0);b.__decorate([l.property({constructOnly:!0})],h.prototype,"owner",void 0);b.__decorate([l.property()],h.prototype,"layer",null);b.__decorate([l.property({constructOnly:!0})],h.prototype,"updateClippingExtent",void 0);b.__decorate([l.property({constructOnly:!0})],h.prototype,"elevationFeatureExpressionEnabled",void 0);
b.__decorate([l.property({constructOnly:!0})],h.prototype,"graphicsCore",void 0);b.__decorate([l.property({constructOnly:!0})],h.prototype,"scaleVisibility",void 0);b.__decorate([l.property({constructOnly:!0})],h.prototype,"filterVisibility",void 0);b.__decorate([l.property({constructOnly:!0})],h.prototype,"elevationAlignment",void 0);b.__decorate([l.property({constructOnly:!0})],h.prototype,"frustumVisibility",void 0);b.__decorate([l.property({readOnly:!0})],h.prototype,"deconfliction",void 0);b.__decorate([l.property({readOnly:!0})],
h.prototype,"labeling",void 0);b.__decorate([l.property({readOnly:!0})],h.prototype,"objectStates",void 0);b.__decorate([l.property()],h.prototype,"suspendResumeExtentMode",null);b.__decorate([l.property()],h.prototype,"dataExtent",void 0);b.__decorate([l.property()],h.prototype,"scaleVisibilitySuspended",null);b.__decorate([l.property()],h.prototype,"suspended",null);b.__decorate([l.property()],h.prototype,"legendEnabled",null);b.__decorate([l.property()],h.prototype,"suspendInfo",null);b.__decorate([l.property()],
h.prototype,"updating",null);b.__decorate([l.property()],h.prototype,"updatingRemaining",null);b.__decorate([l.property()],h.prototype,"featureStore",null);b.__decorate([l.property()],h.prototype,"view",null);b.__decorate([l.property()],h.prototype,"loadedGraphics",null);b.__decorate([l.property()],h.prototype,"fullOpacity",null);b.__decorate([l.property()],h.prototype,"filter",null);b.__decorate([l.property()],h.prototype,"slicePlaneEnabled",null);b.__decorate([l.property()],h.prototype,"drapeSourceType",
null);b.__decorate([l.property()],h.prototype,"updatePolicy",null);b.__decorate([l.property()],h.prototype,"preferredUpdatePolicy",void 0);b.__decorate([l.property()],h.prototype,"displayFeatureLimit",null);h=b.__decorate([m.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureProcessor")],h);const F={remove(){},pause(){},resume(){}};return h})},"esri/views/3d/layers/graphics/Graphics3DCore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../renderers/ClassBreaksRenderer ../../../../renderers/DictionaryRenderer ../../../../renderers/DotDensityRenderer ../../../../renderers/HeatmapRenderer ../../../../renderers/Renderer ../../../../renderers/SimpleRenderer ../../../../renderers/UniqueValueRenderer ../../../../renderers/support/jsonUtils ../../../../symbols ../../../../core/Accessor ../../../../core/has ../../../../core/Error ../../../../core/Handles ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/scheduling ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../core/accessorSupport/diffUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/Layer ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures ../../../../renderers/support/rendererConversion ../../../../support/arcadeOnDemand ../../../../symbols/support/defaults3D ../../../../symbols/support/symbolConversion ./ElevationQuery ./enums ./featureExpressionInfoUtils ./Graphics3DFeatureStore ./Graphics3DGraphicCreationContext ./Graphics3DSymbolCreationContext ./Graphics3DSymbolFactory ./Graphics3DWebStyleSymbol ./GraphicStateTracking ./graphicUtils ./interfaces ./Loadable ./SpatialIndex2D ./symbolComplexity ../support/StageLayerElevationProvider ../../support/extentUtils ../../support/PropertiesPool ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/GridLocalOriginFactory ../../webgl-engine/lib/WebGLLayer ../../../support/Scheduler ../../../../geometry/Extent ../../../../geometry/Point ../../../../symbols/LabelSymbol3D ../../../../symbols/TextSymbol ../../../../symbols/WebStyleSymbol".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H,M,K,I,O,Q,J,P,N,R,S,T,V,W,U,aa,da,Y,ea,ja,la,ia,ca,fa,ba,Z,ha,na,pa,xa,Da,ua,Fa,qa,sa,ma,ra){var va;const Ia=H.create(),Ja=K.create(),Ha=r.getLogger("esri.views.3d.layers.graphics.Graphics3DCore");a.Graphics3DCore=va=function(Ca){function Ka(wa){var Aa=Ca.call(this,wa)||this;Aa.propertiesPool=new na.PropertiesPool({computedExtent:Fa},b._assertThisInitialized(Aa));Aa.computedExtent=null;Aa.currentRenderer=null;Aa.rendererHasGeometryOperations=
!1;Aa.graphicStateTracking=null;Aa.symbolCreationContext=new da.Graphics3DSymbolCreationContext((Na,Ua)=>Aa._frameTask.schedule(Na,Ua));Aa.graphics3DGraphics=new Map;Aa.stageLayer=null;Aa.stage=null;Aa.graphicsDrapedUids=new Set;Aa.graphicsBySymbol=new Map;Aa.symbolConversionCache=new Map;Aa.symbols=new Map;Aa.graphicsWithoutSymbol=new Map;Aa.graphicsWaitingForSymbol=new Map;Aa.graphicsUpdateId=0;Aa._handles=new t;Aa._frameTask=ua.ImmediateTask;Aa.suspendSymbolCleanup=!1;Aa._spatialReference=null;
Aa.arcadeOnDemand=null;Aa.rendererChangeAbortController=null;Aa.elevationInfoChangeAbortController=null;Aa.setupAbortController=null;Aa.elevationAlignment=null;Aa.scaleVisibility=null;Aa.filterVisibility=null;Aa._spatialIndex=null;Aa.extentPadding=0;Aa._updatingPendingLoadedGraphicsChange=null;Aa.featureStore=null;Aa.deconflictor=null;Aa.labeler=null;Aa.objectStates=null;Aa.viewElevationProvider=null;Aa.stageLayerElevationProvider=null;Aa.sharedSymbolResourcesOwnerHandle=null;Aa.whenGraphics3DGraphicRequests=
{};Aa.pendingUpdates=new Map;Aa.numberOfGraphics=0;Aa.numberOfGraphicsProvidingElevation=0;Aa.pendingAdds=0;Aa.pendingRemoves=0;Aa.pendingUpdatesPool=new E({allocator:Na=>Na||new db,deallocator:Na=>{Na.clear();return Na}});Aa.symbolWarningLogged=!1;Aa.geometryWarningLogged=!1;Aa.objectIdInvisibleSet=new Set;Aa._whenSymbolRemoved=new E;Aa.preferredUpdatePolicy=pa.UpdatePolicy.SYNC;Aa.forcedUpdatePolicy=null;Aa.elevationFeatureExpressionEnabled=!0;Aa.owner=null;Aa.layer=null;Aa.graphicSymbolSupported=
!0;Aa.getRenderingInfoWithoutRenderer=!1;Aa.hasZ=null;Aa.hasM=null;Aa._usedMemory=0;Aa._visible=void 0;Aa._startCreateGraphics=!1;return Aa}b._inheritsLoose(Ka,Ca);var Oa=Ka.prototype;Oa._getConvertedSymbol=function(wa){if("web-style"===wa.type)return wa.clone();var Aa=this.symbolConversionCache.get(wa.id);if(u.isSome(Aa))return Aa;Aa=S.to3D(wa,{retainId:!0,hasLabelingContext:this._hasLabelingContext(wa)});const Na=Aa.symbol||null;u.isNone(Na)&&Aa.error&&Ha.error(Aa.error.message);this.symbolConversionCache.set(wa.id,
Na);return Na};Oa._getSymbolComplexitiesUsedOrRenderer=function(wa){if(u.isNone(wa))return[];var Aa=wa.getSymbols(),Na="backgroundFillSymbol"in wa&&wa.backgroundFillSymbol;if(!(Na||Aa&&Aa.length))return[];wa=[];Na=this._getSymbolComplexityUsedOrRenderer(Na);u.isSome(Na)&&wa.push(Na);for(const Ua of Aa)Aa=this._getSymbolComplexityUsedOrRenderer(Ua),u.isSome(Aa)&&wa.push(Aa);return wa};Oa._getSymbolComplexityUsedOrRenderer=function(wa){if(u.isNone(wa))return null;const Aa=this.symbols.get(wa.id);if(u.isSome(Aa))return Aa.complexity;
wa=this._getConvertedSymbol(wa);return u.isSome(wa)?ba.defaultSymbolComplexity(wa):null};Oa._getSymbolComplexitiesUsed=function(){const wa=[];this.symbols.forEach(Aa=>{u.isSome(Aa)&&wa.push(Aa.complexity)});return wa};Oa.initialize=function(){this._spatialReference=this.owner.view.spatialReference;this._set("featureStore",new U.default({objectIdField:this.owner.layer&&this.owner.layer.objectIdField,hasZ:this.hasZ,hasM:this.hasM,spatialReference:this._spatialReference,featureSpatialReference:this.owner.featureSpatialReference,
getSpatialIndex:()=>this.spatialIndex,forAllGraphics:wa=>this.graphics3DGraphics.forEach(wa)}))};Oa.setup=function(){var wa=b._asyncToGenerator(function*(Aa){this.setupAbortController=new AbortController;const Na=this.setupAbortController.signal;this._set("elevationAlignment",Aa.elevationAlignment);this._set("scaleVisibility",Aa.scaleVisibility);this._set("filterVisibility",Aa.filterVisibility);this._set("deconflictor",Aa.deconflictor);this._set("labeler",Aa.labeler);this._set("objectStates",Aa.objectStates);
const Ua=this.owner.view;this.viewElevationProvider=new T.ViewElevationProvider(this._spatialReference,Ua);this._initializeStage(Ua,this.layer.uid);this.symbolCreationContext.sharedResources=Ua.sharedSymbolResources;this.sharedSymbolResourcesOwnerHandle=Ua.sharedSymbolResources.addGraphicsOwner(this.owner);u.isSome(this.currentRenderer)&&(this.symbolCreationContext.renderer=this.currentRenderer);this.symbolCreationContext.stage=this.stage;this.symbolCreationContext.streamDataRequester=Ua.sharedSymbolResources.streamDataRequester;
this.symbolCreationContext.renderCoordsHelper=Ua.renderCoordsHelper;this.symbolCreationContext.layer=this.layer;this.symbolCreationContext.graphicsCoreOwner=this.owner;this.symbolCreationContext.localOriginFactory=new xa.GridLocalOriginFactory(Ua.renderSpatialReference);this.symbolCreationContext.elevationProvider=Ua.elevationProvider;this.symbolCreationContext.notifyGraphicGeometryChanged=Ya=>this.notifyGraphicGeometryChanged(Ya);this.symbolCreationContext.notifyGraphicVisibilityChanged=Ya=>this.notifyGraphicVisibilityChanged(Ya);
Aa=W.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=yield W.createContext(Aa,this._spatialReference,Ha);y.throwIfAborted(Na);this.symbolCreationContext.screenSizePerspectiveEnabled=Ua.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled;this.symbolCreationContext.physicalBasedRenderingEnabled=!!this.owner.view.qualitySettings.physicallyBasedRenderingEnabled;
Aa="layer"in this.owner?["layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled"]:"view.screenSizePerspectiveEnabled";this._handles.add([this.watch("suspendedOrOutsideOfView",()=>this._frameTask.reschedule(()=>this._updateLayerVisibility())),this.owner.watch(Aa,()=>{const Ya=Ua.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;if(Ya!==this.symbolCreationContext.screenSizePerspectiveEnabled){var ya;this.symbolCreationContext.screenSizePerspectiveEnabled=Ya;null==
(ya=this.labeler)?void 0:ya.reset();this.recreateAllGraphicsAndSymbols()}}),this.owner.watch("slicePlaneEnabled",Ya=>this._slicePlaneEnabledChange(!!Ya)),this.owner.view.watch("pixelRatio",()=>this._pixelRatioChange()),this.owner.view.watch("qualitySettings.physicallyBasedRenderingEnabled",Ya=>this._physicalBasedRenderingChange(Ya)),p.when(Ua.basemapTerrain,"tilingScheme",Ya=>{Ya.spatialReference.equals(this.symbolCreationContext.overlaySR)||(this.symbolCreationContext.overlaySR=Ua.basemapTerrain.spatialReference);
this._handles.has("loaded-graphics")?this.recreateAllGraphics():this._handles.add([p.on(this.owner,"loadedGraphics","change",ya=>this._graphicsCollectionChanged(ya),()=>this.recreateAllGraphics()),p.on(this.owner,"loadedGraphics","after-changes",()=>this._signalUpdatingDuringAsyncLoadedGraphicsChange(),()=>this._signalUpdatingDuringAsyncLoadedGraphicsChange())],"loaded-graphics")}),p.whenFalse(this,"asyncUpdates",()=>this.runTask(ua.noBudget),!0),p.init(this,"effectiveUpdatePolicy",Ya=>{u.isSome(this.stageLayer)&&
(this.stageLayer.updatePolicy=Ya);this.symbolCreationContext.isAsync=this.effectiveUpdatePolicy===pa.UpdatePolicy.ASYNC;Ya===pa.UpdatePolicy.SYNC&&this.runTask(ua.noBudget)},!0)]);this._frameTask=Ua.resourceController.scheduler.registerTask(ua.TaskPriority.GRAPHICS_CORE,this);this.owner.layer&&"featureReduction"in this.owner.layer&&this._handles.add(this.owner.watch("layer.featureReduction",()=>this.deconflictor.featureReductionChange()));this.notifyChange("averageSymbolComplexity");try{yield this.rendererChange(this.layer.renderer)}catch{}y.throwIfAborted(Na);
this.setupAbortController=null});return function(Aa){return wa.apply(this,arguments)}}();Oa._abortSetup=function(){this.setupAbortController&&(this.setupAbortController.abort(),this.setupAbortController=null)};Oa.destroy=function(){this._abortSetup();this._abortRendererChange();this._abortElevationInfoChange();this.owner.view.deconflictor.removeGraphicsOwner(this);this.owner.view.labeler.removeGraphicsOwner(this);this._updatingPendingLoadedGraphicsChange=u.removeMaybe(this._updatingPendingLoadedGraphicsChange);
this.clear();this.graphicStateTracking=u.destroyMaybe(this.graphicStateTracking);this.stage&&(this.stage.remove(this.stageLayer),this.stage=this.stageLayer=null);this._handles=u.destroyMaybe(this._handles);this._frameTask.remove();this._frameTask=ua.ImmediateTask;this._spatialReference=null;this._set("owner",null);for(const wa in this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[wa].reject(new q("graphic:layer-destroyed","Layer has been destroyed"));this.whenGraphics3DGraphicRequests=
null;this.sharedSymbolResourcesOwnerHandle=u.removeMaybe(this.sharedSymbolResourcesOwnerHandle);this.propertiesPool=u.destroyMaybe(this.propertiesPool);this.pendingUpdatesPool=null;this.symbolConversionCache.clear();this.objectIdInvisibleSet.clear();this._spatialIndex=u.destroyMaybe(this._spatialIndex);this._set("featureStore",u.destroyMaybe(this.featureStore))};Oa.clear=function(){var wa,Aa;null==(wa=this.objectStates)?void 0:wa.allGraphicsDeleted();u.isSome(this.graphicStateTracking)&&this.graphicStateTracking.allGraphicsDeleted();
this.graphics3DGraphics.forEach(Na=>Na.destroy());null==(Aa=this._spatialIndex)?void 0:Aa.clear();this.graphics3DGraphics.clear();this._usedMemory=this.numberOfGraphics=0;this._updateLayerVisibility();this.symbols.forEach(u.destroyMaybe);this.symbols.clear();this.graphicsBySymbol.clear();this.graphicsWithoutSymbol.clear();this.graphicsWaitingForSymbol.clear();this.pendingUpdates.clear();this.pendingUpdatesPool.clear();this.pendingRemoves=this.pendingAdds=0;this.notifyChange("updating");this.notifyChange("running");
this.notifyChange("updatingRemaining");this.featureStore.events.emit("changed")};Oa._initializeStage=function(wa,Aa){this.stage=wa._stage;this.stageLayer=new Da.WebGLLayer({isPickable:!this.suspendedOrOutsideOfView,updatePolicy:this.effectiveUpdatePolicy},Aa);this.stage.add(this.stageLayer);wa=this.stageLayer.events;wa.on("objectTransformation",Na=>this.notifyGraphicGeometryChanged(Na.metadata.graphicUid));wa.on("visibilityChanged",Na=>this.notifyGraphicVisibilityChanged(Na.metadata.graphicUid));
wa.on("objectGeometryAdded",Na=>this.notifyGraphicGeometryChanged(Na.object.metadata.graphicUid));wa.on("objectGeometryRemoved",Na=>this.notifyGraphicGeometryChanged(Na.object.metadata.graphicUid));wa.on("vertexAttrsUpdated",Na=>this.notifyGraphicGeometryChanged(Na.object.metadata.graphicUid))};Oa.notifyGraphicGeometryChanged=function(wa){u.isNone(this.graphicStateTracking)||u.isNone(wa)||(wa=this.graphics3DGraphics.get(wa))&&this.graphicStateTracking.updateGraphicGeometry(wa)};Oa.notifyGraphicVisibilityChanged=
function(wa){u.isNone(this.graphicStateTracking)||u.isNone(wa)||(wa=this.graphics3DGraphics.get(wa))&&this.graphicStateTracking.updateGraphicVisibility(wa)};Oa._updateLayerVisibility=function(){var wa=this.numberOfGraphics>10*this.displayFeatureLimit.maximumNumberOfFeatures;wa=!this.suspendedOrOutsideOfView&&!wa;wa!==this._visible&&((this._visible=wa)?(this.stageLayer.isPickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.isPickable=!1,this._hideAllGraphics()),this._updateStageLayerVisibility())};
Oa._updateStageLayerVisibility=function(){this.stageLayer.isVisible=this._visible&&(null==this.layer.opacity||0<this.layer.opacity)};Oa.getGraphics3DGraphicById=function(wa){return this.graphics3DGraphics.get(wa)};Oa.getGraphics3DGraphicByObjectId=function(wa){var Aa;return null!=(Aa=this.owner.layer)&&Aa.objectIdField?this._findGraphics3DGraphicByObjectId(wa):null};Oa._getGraphicObjectID=function(wa,Aa=this.owner.layer&&this.owner.layer.objectIdField){return Q.getObjectId(wa,Aa)};Oa.updateLabelingInfo=
function(){var wa=b._asyncToGenerator(function*(Aa){const Na=this.deconflictor&&this.deconflictor.labelingInfoChange(Aa);Aa=this.labeler&&this.labeler.labelingInfoChange(Aa);yield y.eachAlways([Na,Aa])});return function(Aa){return wa.apply(this,arguments)}}();Oa.updateVisibilityInfo=function(){this.deconflictor&&this.deconflictor.labelingInfoChange();this.labeler&&this.labeler.visibilityInfoChange()};Oa.runTask=function(wa){this._frameTask.processQueue(wa);this._applyPendingUpdates(wa);this.notifyChange("running");
this.running||this.notifyChange("updating");this.notifyChange("updatingRemaining")};Oa.setObjectIdVisibility=function(wa,Aa){Aa?this.objectIdInvisibleSet.delete(wa):this.objectIdInvisibleSet.add(wa);wa=this._findGraphics3DGraphicByObjectId(wa);u.isSome(wa)&&this._updateUserVisibility(wa)};Oa._findGraphics3DGraphicByObjectId=function(wa){return x.findInMap(this.graphics3DGraphics,Aa=>this._getGraphicObjectID(Aa.graphic)===wa)};Oa._updateUserVisibility=function(wa){if(u.isNone(wa))return!1;var Aa=wa.graphic;
const Na=this._getGraphicObjectID(Aa);Aa=Aa.visible&&!this.owner.suspended&&(u.isNone(Na)||!this.objectIdInvisibleSet.has(Na));return wa.setVisibilityFlag(V.VisibilityFlag.USER_SETTING,Aa,V.VisibilityGroup.GRAPHIC)};Oa._whenGraphics3DGraphic=function(wa){var Aa=this.graphics3DGraphics.get(wa.uid);if(Aa)return Promise.resolve(Aa);if(Aa=this.whenGraphics3DGraphicRequests[wa.uid])return Aa.promise;Aa=y.createDeferred();this.whenGraphics3DGraphicRequests[wa.uid]=Aa;return Aa.promise};Oa._boundsForGraphics3DGraphic=
function(){var wa=b._asyncToGenerator(function*(Aa,Na){const Ua=this._spatialReference,Ya=this.owner.view.renderSpatialReference,ya=this.owner.view.basemapTerrain.spatialReference;var La=this.viewElevationProvider?{service:this.viewElevationProvider,useViewElevation:u.isSome(Na)&&Na.useViewElevation,minDemResolution:u.isSome(Na)&&Na.minDemResolution,minDemResolutionForPoints:this.owner.view.resolution}:null;Aa=yield Aa.getProjectedBoundingBox((Va,hb,kb)=>M.projectBuffer(Va,Ya,hb,Va,Ua,hb,kb),(Va,
hb,kb)=>M.projectBuffer(Va,ya,hb,Va,Ua,hb,kb),La,u.get(Na,"signal"));if(!Aa)return null;Na=Aa.boundingBox;Aa.requiresDrapedElevation&&(La=this.symbolCreationContext.elevationProvider)&&(K.center(Na,Ia),La=u.unwrapOr(La.getElevation(Ia[0],Ia[1],0,Ua,"ground"),0),Na[2]=Math.min(Na[2],La),Na[5]=Math.max(Na[5],La));return{boundingBox:Na,screenSpaceObjects:Aa.screenSpaceObjects}});return function(Aa,Na){return wa.apply(this,arguments)}}();Oa.whenGraphicBounds=function(){var wa=b._asyncToGenerator(function*(Aa,
Na){yield p.whenOnce(this.owner,"loadedGraphics");const Ua=this.owner.layer&&this.owner.layer.objectIdField;var Ya=this.owner.loadedGraphics.find(ya=>ya===Aa?!0:Ua&&ya.attributes&&Aa.attributes&&ya.attributes[Ua]===Aa.attributes[Ua]);if(!Ya)throw new q("internal:graphic-not-part-of-view","Graphic is not part of this view");Ya=yield this._whenGraphics3DGraphic(Ya);return this._boundsForGraphics3DGraphic(Ya,Na)});return function(Aa,Na){return wa.apply(this,arguments)}}();Oa.computeAttachmentOrigin=
function(wa,Aa){wa=this.graphics3DGraphics.get(wa.uid);if(!wa)return null;var Na=wa.computeAttachmentOrigin();if(0===Na.render.num&&0===Na.draped.num)return null;L.set(fb,0,0,0);wa=0;if(0<Na.render.num){if(!M.projectVectorToVector(Na.render.origin,this.symbolCreationContext.renderCoordsHelper.spatialReference,ka,Aa))return null;L.add(fb,fb,ka);wa++}if(0<Na.draped.num){const [Ua,Ya]=Na.draped.origin;Na=u.unwrapOr(this.viewElevationProvider.getElevation(Ua,Ya,"ground"),0);L.set(ka,Ua,Ya,Na);if(!M.projectVectorToVector(ka,
this.viewElevationProvider.spatialReference,ka,Aa))return null;L.add(fb,fb,ka);wa++}1<wa&&L.scale(fb,fb,1/wa);return new qa({x:fb[0],y:fb[1],z:fb[2],spatialReference:Aa})};Oa.getSymbolLayerSize=function(wa,Aa){var Na=this.symbols.get(wa.id);if(u.isNone(Na))throw new q("internal:symbol-not-part-of-view","Symbol is not part of this view");wa=wa.symbolLayers.indexOf(Aa);if(-1===wa)throw new q("internal:missing-symbol-layer","Symbol layer is not in symbol");Na=Na.getSymbolLayerSize(wa);if(null==Na)throw new q("internal:missing-size",
"Symbol layer has no valid size");return Na};Oa._graphicsCollectionChanged=function(wa){this._startCreateGraphics&&(this.add(wa.added),this.remove(wa.removed))};Oa.graphicUpdateHandler=function(wa){const Aa=wa.graphic.uid,Na=this.graphics3DGraphics.get(Aa);if(!u.isNone(Na)||!u.isNone(this.graphicsWithoutSymbol.get(Aa)))switch(wa.property){case "visible":this._graphicUpdateVisibleHandler(Na);break;case "geometry":this._graphicUpdateGeometryHandler(Na,wa);break;case "symbol":this._graphicUpdateSymbolHandler(Na,
wa);break;case "transform":this._graphicUpdateTransformHandler(Na,wa)}};Oa._graphicUpdateGeometryHandler=function(wa,Aa){const Na=Aa.graphic.geometry;if(u.isNone(Na))this._recreateGraphic(Aa.graphic);else if(u.isNone(wa)){if(wa=Aa.graphic.symbol&&Aa.graphic.symbol.id)if(wa=this.symbols.get(wa),u.isSome(wa)&&wa.loadStatus===ca.LoadStatus.LOADING)return;this._recreateGraphic(Aa.graphic)}else{var Ua=wa.graphics3DSymbol;!u.isNone(Aa.newValue)&&Ua.updateGeometry(wa,Aa.newValue)||this._recreateGraphic(wa.graphic);
this._expandComputedExtent(Na)}};Oa._graphicUpdateSymbolHandler=function(wa,Aa){var Na=Aa.graphic;const Ua=u.isSome(wa)?wa.graphics3DSymbol:u.isSome(Aa.oldValue)?this.symbols.get(Aa.oldValue.id):null;if(u.isNone(Ua)||u.isNone(Aa.newValue))this._recreateGraphic(Na);else{var Ya=Ua.symbol;Aa=this._getConvertedSymbol(Aa.newValue);if(u.isSome(Aa)&&(Aa.type!==Ya.type||"web-style"===Aa.type)||"web-style"===Ya.type)this._recreateGraphic(Na);else{var ya=this.graphicsBySymbol.get(Ya.id);if(ya&&1!==ya.size)this._recreateGraphic(Na);
else if(ya=G.diff(Ya,Aa),u.isNone(ya))this._updateSymbolMapping(Ya.id,Aa);else if(ya={diff:ya,graphics3DGraphicPatches:[],symbolStatePatches:[]},Ua.prepareSymbolPatch(ya),G.isEmpty(ya.diff)){var La=this._getRenderingInfo(Na);if(u.isNone(La))this._recreateGraphic(Na);else{Na=Ua.extentPadding;for(const Va of ya.symbolStatePatches)Va();Na!==Ua.extentPadding&&this._recomputeExtentPadding();if(u.isSome(wa))for(const Va of ya.graphics3DGraphicPatches)Va(wa,La);this._updateSymbolMapping(Ya.id,Aa)}}else this._recreateGraphic(Na)}}};
Oa._graphicUpdateVisibleHandler=function(wa){this._updateUserVisibility(wa)&&(this.labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty())};Oa._graphicUpdateTransformHandler=function(wa,Aa){};Oa.recreateGraphics=function(wa){this.suspendSymbolCleanup=!0;this.remove(wa);this.add(wa);this.suspendSymbolCleanup=!1;this.effectiveUpdatePolicy===pa.UpdatePolicy.SYNC&&this._cleanupSymbols()};Oa._recreateGraphic=function(wa){this.recreateGraphics([wa])};Oa._beginGraphicUpdate=
function(wa){const Aa=this.graphicsUpdateId;this.graphicsUpdateId++;this.graphicsWaitingForSymbol.set(wa.uid,Aa);1===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating");return Aa};Oa._endGraphicUpdate=function(wa){wa&&(this.graphicsWaitingForSymbol.delete(wa.uid),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating")))};Oa._recomputeExtentPadding=function(){let wa=0;this.symbols.forEach(Aa=>{u.isSome(Aa)&&(wa=Math.max(wa,Aa.extentPadding))});this._set("extentPadding",
wa)};Oa._expandComputedExtent=function(wa){var Aa=wa.spatialReference;Q.computeAABB(wa,Ja);wa=this._spatialReference;var Na=va.tmpVec;!Aa.equals(wa)&&M.projectXYZToVector(Ja[0],Ja[1],0,Aa,Na,wa)&&(Ja[0]=Na[0],Ja[1]=Na[1],M.projectXYZToVector(Ja[3],Ja[4],0,Aa,Na,wa),Ja[3]=Na[0],Ja[4]=Na[1]);if(isFinite(Ja[0])&&isFinite(Ja[3])&&isFinite(Ja[1])&&isFinite(Ja[4])){Aa=this.computedExtent;Na=null;var Ua=isFinite(Ja[2])&&isFinite(Ja[5]),Ya=Ua&&(!Aa||null==Aa.zmin||Ja[2]<Aa.zmin);Ua=Ua&&(!Aa||null==Aa.zmax||
Ja[5]>Aa.zmax);if(Aa){if(Ja[0]<Aa.xmin||Ja[1]<Aa.ymin||Ja[3]>Aa.xmax||Ja[4]>Aa.ymax||Ya||Ua)Na=this.propertiesPool.get("computedExtent"),Na.xmin=Math.min(Ja[0],Aa.xmin),Na.ymin=Math.min(Ja[1],Aa.ymin),Na.xmax=Math.max(Ja[3],Aa.xmax),Na.ymax=Math.max(Ja[4],Aa.ymax),Na.spatialReference=wa}else Na=this.propertiesPool.get("computedExtent"),Na.xmin=Ja[0],Na.ymin=Ja[1],Na.xmax=Ja[3],Na.ymax=Ja[4],Na.spatialReference=wa;Na&&(Ya&&(Na.zmin=Ja[2]),Ua&&(Na.zmax=Ja[5]),this._set("computedExtent",Na))}};Oa._abortElevationInfoChange=
function(){this.elevationInfoChangeAbortController&&(this.elevationInfoChangeAbortController.abort(),this.elevationInfoChangeAbortController=null)};Oa.elevationInfoChange=function(){var wa=b._asyncToGenerator(function*(){var Aa,Na;this._abortElevationInfoChange();const Ua=new AbortController;this.elevationInfoChangeAbortController=Ua;const Ya=W.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=yield W.createContext(Ya,
this._spatialReference,Ha);y.throwIfAborted(Ua);this.elevationInfoChangeAbortController=null;null==(Aa=this.labeler)?void 0:Aa.elevationInfoChange();this.forEachGraphics3DSymbol((ya,La,Va)=>{ya.globalPropertyChanged("elevationInfo",La)?La.forEach(hb=>{const kb=hb.graphic;hb=hb.labelGraphics;for(const ib of hb)ib.graphics3DSymbolLayer.updateGraphicElevationContext(kb,ib)}):this._recreateSymbol(Va)});this.updateStageLayerElevationProvider();null==(Na=this.elevationAlignment)?void 0:Na.elevationInfoChange()});
return function(){return wa.apply(this,arguments)}}();Oa.updateStageLayerElevationProvider=function(){if(this.stageLayerElevationProvider){if(this.layer.elevationInfo&&"relative-to-scene"===this.layer.elevationInfo.mode||0===this.numberOfGraphicsProvidingElevation)this.owner.view.elevationProvider.unregister(this.stageLayerElevationProvider),this.stageLayerElevationProvider.dispose(),this.stageLayerElevationProvider=null}else(!this.layer.elevationInfo||this.layer.elevationInfo&&"relative-to-scene"!==
this.layer.elevationInfo.mode)&&0<this.numberOfGraphicsProvidingElevation&&(this.stageLayerElevationProvider=new Z.StageLayerElevationProvider({layer:this.layer,stageLayer:this.stageLayer,view:this.owner.view}),this.owner.view.elevationProvider.register("scene",this.stageLayerElevationProvider))};Oa._clearSymbolsAndGraphics=function(){var wa,Aa,Na,Ua,Ya;this.clear();null==(wa=this.filterVisibility)?void 0:wa.clear();null==(Aa=this.labeler)?void 0:Aa.reset();null==(Na=this.deconflictor)?void 0:Na.clear();
null==(Ua=this.elevationAlignment)?void 0:Ua.clear();null==(Ya=this.stageLayer)?void 0:Ya.invalidateSpatialQueryAccelerator();this.stageLayerElevationProvider&&(this.owner.view.elevationProvider.unregister(this.stageLayerElevationProvider),this.stageLayerElevationProvider.dispose(),this.stageLayerElevationProvider=null)};Oa.startCreateGraphics=function(){this._startCreateGraphics=!0;this.recreateAllGraphics()};Oa.recreateAllGraphics=function(){this._recreateAllGraphics(!1)};Oa.recreateAllGraphicsAndSymbols=
function(){this._recreateAllGraphics(!0)};Oa._recreateAllGraphics=function(wa=!1){if(this._startCreateGraphics){var {loadedGraphics:Aa,view:Na}=this.owner,Ua=Na.basemapTerrain.tilingScheme&&Aa&&Aa.length?Aa.toArray():null;!wa&&Ua||this._clearSymbolsAndGraphics();this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled;this._set("computedExtent",
null);Ua&&(wa?this.add(Ua):this.recreateGraphics(Ua))}};Oa._recreateSymbol=function(wa){var Aa=this.graphicsBySymbol.get(wa);const Na=[];Aa&&(Aa.forEach((Ua,Ya)=>{var ya;const La=Ua.usedMemory;this._conditionalRemove(Ua,Ya);null==(ya=this._spatialIndex)?void 0:ya.remove(Ua);Na.push(Ua.graphic);Ua.destroy();this._removeGraphics3DGraphic(Ya,La);this._updateLayerVisibility();this.featureStore.events.emit("changed")}),this.graphicsBySymbol.set(wa,new Map));Aa=this.symbols.get(wa);u.destroyMaybe(Aa);this.symbols.delete(wa);
this.add(Na)};Oa._recreateGraphicsForSymbol=function(wa){if(wa=this.graphicsBySymbol.get(wa)){const Aa=[];wa.forEach(Na=>Aa.push(Na.graphic));this.recreateGraphics(Aa)}};Oa._conditionalRemove=function(wa,Aa){var Na,Ua,Ya;this.graphicsDrapedUids.delete(Aa);null==(Na=this.objectStates)?void 0:Na.removeGraphic(wa);null==(Ua=this.labeler)?void 0:Ua.removeGraphic(wa);null==(Ya=this.deconflictor)?void 0:Ya.removeGraphic(wa);u.isSome(this.graphicStateTracking)&&this.graphicStateTracking.removeGraphic(wa)};
Oa.add=function(wa){wa&&0!==wa.length&&(this.owner.view.basemapTerrain&&this.owner.view.basemapTerrain.tilingScheme?(this._updatePolicyForGraphics(wa)===pa.UpdatePolicy.ASYNC?this._addDelayed(wa):this._addImmediate(wa),this.notifyChange("updating")):Ha.error("#add()","Cannot add graphics before terrain surface has been initialized"))};Oa._updatePolicyForGraphics=function(wa){if(this.effectiveUpdatePolicy===pa.UpdatePolicy.SYNC&&("mesh"===this.layer.geometryType||null==this.layer.geometryType))for(const Aa of wa)if(u.isSome(Aa.geometry)&&
"mesh"===Aa.geometry.type&&!Aa.geometry.loaded)return pa.UpdatePolicy.ASYNC;return this.effectiveUpdatePolicy};Oa._addImmediate=function(wa){this.symbolWarningLogged=this.geometryWarningLogged=!1;for(const Aa of wa)this._addGraphic(Aa,this._getRenderingInfo(Aa,Ha),pa.UpdatePolicy.SYNC);this._cleanupSymbols();this.labeler&&(this.owner.view.labeler.setDirty(),this._cleanupSymbols());this.owner.view.deconflictor.setDirty()};Oa._addDelayed=function(wa){for(const Aa of wa){wa=Aa.uid;let Na=this.pendingUpdates.get(wa);
Na?Na.add?Na.state!==Ta.NEW&&Na.abortController.abort():this.pendingAdds++:(Na=this.pendingUpdatesPool.pushNew(),this.pendingAdds++,this.pendingUpdates.set(wa,Na));Na.add=Aa}this.notifyChange("running");this.notifyChange("updatingRemaining")};Oa.remove=function(wa){this.effectiveUpdatePolicy===pa.UpdatePolicy.ASYNC?this._removeDelayed(wa):this._removeImmediate(wa);this.notifyChange("updating")};Oa._removeImmediate=function(wa){for(const Aa of wa)this._removeGraphic(Aa);this._cleanupSymbols();this.labeler&&
this.owner.view.labeler.setDirty();this.owner.view.deconflictor.setDirty()};Oa._removeDelayed=function(wa){for(const Na of wa){wa=Na.uid;var Aa=this.pendingUpdates.get(wa);Aa?Aa.add&&(Aa.remove?Aa.add=null:this.pendingUpdates.delete(wa),Aa.state===Ta.LOADING&&Aa.abortController.abort(),this.pendingAdds--):(Aa=this.pendingUpdatesPool.pushNew(),Aa.remove=Na,this.pendingUpdates.set(wa,Aa),this.pendingRemoves++)}0===this.pendingUpdates.size&&this._finishPendingUpdates();this.notifyChange("running");this.notifyChange("updatingRemaining")};
Oa._finishPendingUpdates=function(){this.pendingUpdatesPool.clear();this._cleanupSymbols();(this.pendingAdds||this.pendingRemoves)&&Ha.warn("pendingAdds/Removes in inconsistent state!");this.pendingRemoves=this.pendingAdds=0};Oa._applyPendingUpdates=function(wa){var Aa;this.symbolWarningLogged=this.geometryWarningLogged=!1;if(0===this.pendingUpdates.size&&null!=(Aa=this._spatialIndex)&&Aa.updating)this._spatialIndex.update();else{for(const [Na,Ua]of this.pendingUpdates){if(wa.done)break;Ua.add&&Ua.state===
Ta.NEW&&this._processPendingUpdateNew(Ua);Aa=this.effectiveUpdatePolicy;!Ua.remove||Ua.add&&Ua.state!==Ta.READY||(this.pendingRemoves--,wa.madeProgress(),this._removeGraphic(Ua.remove),Ua.remove=null,Aa=pa.UpdatePolicy.SYNC);if(Ua.add)switch(Ua.state){case Ta.READY:this._addGraphic(Ua.add,Ua.renderingInfo,Aa);Ua.add=null;this.pendingAdds--;wa.madeProgress();break;case Ta.REJECTED:Ua.add=null,this.pendingAdds--}null==Ua.remove&&null==Ua.add&&this.pendingUpdates.delete(Na)}0===this.pendingUpdates.size&&
(this._finishPendingUpdates(),this.notifyChange("running"))}};Oa._processPendingUpdateNew=function(wa){if(wa.add){var Aa=wa.add.geometry;u.isSome(Aa)&&"mesh"===Aa.type&&!Aa.loaded?this._processPendingUpdateNewMesh(wa,Aa):this._processPendingUpdateNewRenderingInfo(wa)}else wa.state=Ta.READY};Oa._processPendingUpdateNewMesh=function(){var wa=b._asyncToGenerator(function*(Aa,Na){Aa.state=Ta.LOADING;Aa.abortController=new AbortController;const Ua=Aa.abortController.signal;try{yield Na.load({signal:Ua})}catch(Ya){return this._processPendingUpdateNewError(Aa,
Ya)}Aa.abortController=null;this._processPendingUpdateNewRenderingInfo(Aa)});return function(Aa,Na){return wa.apply(this,arguments)}}();Oa._processPendingUpdateNewError=function(wa,Aa){wa.abortController=null;y.isAbortError(Aa)?wa.state=Ta.NEW:wa.state=Ta.REJECTED};Oa._processPendingUpdateNewRenderingInfo=function(){var wa=b._asyncToGenerator(function*(Aa){if(u.isNone(this.layer.renderer)||"dictionary"!==this.layer.renderer.type)Aa.renderingInfo=this._getRenderingInfo(Aa.add,Ha);else{Aa.state=Ta.LOADING;
Aa.abortController=new AbortController;var Na=null;try{Na=yield this._getRenderingInfoAsync(Aa.add,{signal:Aa.abortController.signal})}catch(Ua){Aa.abortController=null;y.isAbortError(Ua)?Aa.state=Ta.NEW:Aa.state=Ta.REJECTED;return}u.isNone(Na)||u.isNone(Na.symbol)?(Ha&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,Ha.warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),Aa.renderingInfo=null):Aa.renderingInfo=Na}Aa.state=Ta.READY});return function(Aa){return wa.apply(this,
arguments)}}();Oa._addGraphic=function(wa,Aa,Na){this.graphicsWithoutSymbol.set(wa.uid,wa);if(!u.isNone(Aa)&&!u.isNone(Aa.symbol)&&Q.hasGeometry(wa)){var Ua=this.getOrCreateGraphics3DSymbol(Aa.symbol,Aa.renderer);if(!u.isNone(Ua)){this._expandComputedExtent(wa.geometry);var Ya=this._beginGraphicUpdate(wa),ya=new aa(wa,Aa,this.layer),La=!1,Va=ib=>{ib===Ua.symbol.id&&(La=!0)};this._whenSymbolRemoved.push(Va);var hb=()=>{if(!this.destroyed){this._whenSymbolRemoved.removeUnordered(Va);if(this.graphicsWaitingForSymbol.get(wa.uid)!==
Ya||La||Ua.destroyed||this.graphicSymbolSupported&&wa.symbol&&wa.symbol.id!==Ua.symbol.id)--Ua.referenced;else{const ib=this._createGraphics3DGraphic(Ua,ya);this._spatialIndex&&u.isSome(ib)&&this._spatialIndex.add(ib);--Ua.referenced;this._endGraphicUpdate(wa)}this.featureStore.events.emit("changed");this.labeler&&this.owner.view.labeler.setDirty()}},kb=ib=>{this.destroyed||(this._whenSymbolRemoved.removeUnordered(Va),La||(y.isAbortError(ib)?this.add([wa]):Ua.destroyed||this._endGraphicUpdate(wa)))};
Na===pa.UpdatePolicy.ASYNC?Ua.load(()=>this._frameTask.schedule(hb),ib=>this._frameTask.schedule(()=>kb(ib))):Ua.load(hb,kb)}}};Oa._removeGraphic=function(wa){wa=wa.uid;const Aa=this.graphics3DGraphics.get(wa);if(Aa){var Na;Aa.graphics3DSymbol.onRemoveGraphic(Aa);const Ua=Aa.usedMemory,Ya=Aa.isElevationSource;this._conditionalRemove(Aa,wa);null==(Na=this._spatialIndex)?void 0:Na.remove(Aa);this.graphicsBySymbol.get(Aa.graphics3DSymbol.symbol.id).delete(wa);this.graphicsWithoutSymbol.delete(wa);this._removeGraphics3DGraphic(wa,
Ua,Ya);Aa.destroy();this.featureStore.events.emit("changed")}else this.graphicsWithoutSymbol.delete(wa),this.graphicsWaitingForSymbol.delete(wa),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating"))};Oa._hasLabelingContext=function(wa){if(wa instanceof sa||wa instanceof ma){const Aa=this.symbolCreationContext.layer;return Aa.labelingInfo?Aa.labelingInfo.some(Na=>Na.symbol===wa):!1}return!1};Oa._hasValidSymbolCreationContext=function(wa){return wa instanceof
sa&&!this._hasLabelingContext(wa)?(Ha.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),!1):!0};Oa._getRenderingInfo=function(wa,Aa){const Na=wa.geometry;if(u.isNone(Na))return Aa&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,Aa.warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),null;if(!M.canProjectWithoutEngine(Na.spatialReference,this._spatialReference))return Aa&&!this.geometryWarningLogged&&
(this.geometryWarningLogged=!0,Aa.warn(`Graphic in layer ${this.layer.id} has incompatible spatial reference and will not render`)),null;if(!this.graphicSymbolSupported&&u.isSome(wa.symbol))return Aa&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,Aa.warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),null;wa=this.rendererHasGeometryOperations?J.hydrateGraphic(wa,this.layer):wa;wa=this.owner.getRenderingInfo&&(this.getRenderingInfoWithoutRenderer||
u.isSome(this.currentRenderer))?this.owner.getRenderingInfo(wa,this.currentRenderer,u.unwrap(this.arcadeOnDemand)):{symbol:wa.symbol||R.getDefaultSymbol3D(wa.geometry)};return u.isNone(wa)||u.isNone(wa.symbol)?(Aa&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,Aa.warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),null):wa};Oa._getRenderingInfoAsync=function(wa,Aa){if(u.isNone(wa.geometry))return Ha&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,Ha.warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),
null;if(!this.graphicSymbolSupported&&u.isSome(wa.symbol))return Ha&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,Ha.warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),null;wa=this.rendererHasGeometryOperations?J.hydrateGraphic(wa,this.layer):wa;return this.owner.getRenderingInfoAsync(wa,u.unwrap(this.currentRenderer),u.unwrap(this.arcadeOnDemand),Aa)};Oa._createGraphics3DSymbol=function(wa,Aa){if(!this._hasValidSymbolCreationContext(wa))return null;
wa=this._getConvertedSymbol(wa);if(!wa)return null;let Na;u.isSome(Aa)&&"backgroundFillSymbol"in Aa&&Aa.backgroundFillSymbol&&(Aa=S.to3D(Aa.backgroundFillSymbol,{ignoreDrivers:!0}),u.isSome(Aa.symbol)&&"web-style"!==Aa.symbol.type&&"cim"!==Aa.symbol.type&&(Na=Aa.symbol.symbolLayers));const Ua=Y.make(wa,this.symbolCreationContext,Na);Ua.load(()=>{const Ya=Ua.extentPadding;Ya>this.extentPadding&&this._set("extentPadding",Ya);this.notifyChange("averageSymbolComplexity")},()=>{});return Ua};Oa.getOrCreateGraphics3DSymbol=
function(wa,Aa){let Na=this.symbols.get(wa.id);void 0===Na&&(Na=wa instanceof ra?new ea(wa,Ua=>this._frameTask.schedule(Ua),Ua=>this._createGraphics3DSymbol(Ua,Aa)):this._createGraphics3DSymbol(wa,Aa),this.symbols.set(wa.id,Na));u.isSome(Na)&&++Na.referenced;return Na};Oa.trackGraphicState=function(wa){u.isNone(this.graphicStateTracking)&&(this.graphicStateTracking=new ja.GraphicStateTracking(this));return this.graphicStateTracking.add(wa)};Oa._addGraphics3DGraphic=function(wa){this._usedMemory+=
wa.usedMemory;this.graphics3DGraphics.set(wa.graphic.uid,wa);this.numberOfGraphics++;wa.isElevationSource&&(this.numberOfGraphicsProvidingElevation++,this.updateStageLayerElevationProvider());this._updateLayerVisibility()};Oa._removeGraphics3DGraphic=function(wa,Aa,Na=!1){this._usedMemory-=Aa;this.graphics3DGraphics.delete(wa);this.numberOfGraphics--;Na&&(this.numberOfGraphicsProvidingElevation--,this.updateStageLayerElevationProvider());this._updateLayerVisibility()};Oa._createGraphics3DGraphic=
function(wa,Aa){var Na,Ua,Ya,ya;const La=Aa.graphic;this.graphicsWithoutSymbol.delete(La.uid);if(!this.symbols.has(wa.symbol.id))return this.add([La]),null;if(this.graphics3DGraphics.has(La.uid))return null;Aa=wa.createGraphics3DGraphic(Aa);if(u.isNone(Aa))return null;this._addGraphics3DGraphic(Aa);wa=wa.symbol.id;this.graphicsBySymbol.has(wa)||this.graphicsBySymbol.set(wa,new Map);this.graphicsBySymbol.get(wa).set(La.uid,Aa);Aa.isDraped&&this.graphicsDrapedUids.add(La.uid);Aa.centroid=null;u.isSome(La.geometry)&&
"point"!==La.geometry.type&&(Aa.centroid=la.computeCentroid(La.geometry,this._spatialReference));this._updateUserVisibility(Aa);u.isSome(this.scaleVisibility)&&this.scaleVisibility.updateVisibility(Aa);null==(Na=this.filterVisibility)?void 0:Na.updateVisibility(Aa);null==(Ua=this.deconflictor)?void 0:Ua.addGraphic(Aa);null==(Ya=this.labeler)?void 0:Ya.addGraphic(Aa);null==(ya=this.objectStates)?void 0:ya.addGraphic(Aa);this.deconflictor&&this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,
Aa);Aa.initialize(this.stage,this.stageLayer,this.owner);u.isSome(this.graphicStateTracking)&&this.graphicStateTracking.addGraphic(Aa);if(Na=this.whenGraphics3DGraphicRequests[La.uid])delete this.whenGraphics3DGraphicRequests[La.uid],Na.resolve(Aa);return Aa};Oa._abortRendererChange=function(){this.rendererChangeAbortController&&(this.rendererChangeAbortController.abort(),this.rendererChangeAbortController=null)};Oa.rendererChange=function(){var wa=b._asyncToGenerator(function*(Aa){this._abortRendererChange();
if(Aa!==this.currentRenderer)if(this._validateRenderer(Aa),u.isNone(Aa)&&this._currentRendererChange(null,!1),P.isSupportedRenderer3D(Aa))if(u.isSome(Aa)&&Aa.arcadeRequired){var Na=new AbortController;this.rendererChangeAbortController=Na;const {arcadeUtils:Ua}=yield this._ensureArcade();y.throwIfAborted(Na);Ua.hasGeometryOperations(Aa)&&(yield Ua.enableGeometryOperations(),y.throwIfAborted(Na));this.effectiveUpdatePolicy===pa.UpdatePolicy.ASYNC?yield this._frameTask.schedule(()=>this._currentRendererChange(Aa,
!0),Na.signal):this._currentRendererChange(Aa,!0);this.rendererChangeAbortController=null}else this.effectiveUpdatePolicy===pa.UpdatePolicy.ASYNC?(this.rendererChangeAbortController=Na=new AbortController,yield this._frameTask.schedule(()=>this._currentRendererChange(Aa,!1),Na.signal),this.rendererChangeAbortController=null):this._currentRendererChange(Aa,!1);else this._currentRendererChange(Aa,!1)});return function(Aa){return wa.apply(this,arguments)}}();Oa._ensureArcade=function(){var wa=b._asyncToGenerator(function*(){u.isNone(this.arcadeOnDemand)&&
(this.arcadeOnDemand=yield N.loadArcade());return this.arcadeOnDemand});return function(){return wa.apply(this,arguments)}}();Oa._currentRendererChange=function(wa,Aa){this.currentRenderer=wa;this.rendererHasGeometryOperations=Aa;this.symbolCreationContext.arcade=u.unwrap(this.arcadeOnDemand);Aa=this.symbolCreationContext.renderer;if(wa!==Aa)if(this.symbolConversionCache.clear(),u.isNone(wa))this.symbolCreationContext.renderer=null,this.recreateAllGraphicsAndSymbols();else{var Na=G.diff(Aa,wa);this._updateUnchangedSymbolMappings(Na,
wa,Aa);this.symbolCreationContext.renderer=wa;u.isNone(Na)||("complete"===Na.type?this.recreateAllGraphicsAndSymbols():"partial"===Na.type&&(this._applyRendererDiff(Na,wa,Aa)?this._volatileGraphicsUpdated():this.recreateAllGraphicsAndSymbols()),this.notifyChange("averageSymbolComplexity"))}};Oa._diffHasSymbolChange=function(wa){for(const Aa in wa.diff)switch(Aa){case "visualVariables":case "defaultSymbol":case "uniqueValueInfos":break;case "authoringInfo":case "fieldDelimiter":delete wa.diff[Aa];
break;default:return!0}return!1};Oa._applySymbolSetDiff=function(wa,Aa,Na){wa=wa||[];Aa=Aa||[];const Ua=[];for(const Ya of Aa){const ya=this.graphicsBySymbol.get(Ya.id);ya&&ya.forEach((La,Va)=>{var hb=La.graphic,kb=this.layer instanceof O?this.layer:null;const ib=u.unwrap(this.arcadeOnDemand);if(Ya!==Na.defaultSymbol||Na.getSymbol(J.hydrateGraphic(hb,kb),{arcade:ib})!==Na.defaultSymbol)kb=La.usedMemory,wa.length||Na.defaultSymbol?Ua.push(hb):this.graphicsWithoutSymbol.set(Va,hb),hb=this.graphics3DGraphics.get(Va),
this._conditionalRemove(hb,Va),La.destroy(),ya.delete(Va),this._removeGraphics3DGraphic(Va,kb),this._updateLayerVisibility()});this._whenSymbolRemoved.forAll(La=>La(Ya.id))}if(wa.length||Ua.length)this.graphicsWithoutSymbol.forEach(Ya=>Ua.push(Ya)),this.graphicsWithoutSymbol.clear(),this.add(Ua);this._cleanupSymbols();this.labeler&&this.owner.view.labeler.setDirty();this.owner.view.deconflictor.setDirty()};Oa._applyUniqueValueRendererDiff=function(wa,Aa,Na){const Ua=wa.diff.defaultSymbol,Ya=wa.diff.uniqueValueInfos;
if(Ua||Ya){const ya=Ya?Ya.added.map(Va=>Va.symbol):[],La=Ya?Ya.removed.map(Va=>Va.symbol):[];if(Ya)for(let Va=0;Va<Ya.changed.length;Va++)ya.push(Ya.changed[Va].newValue.symbol),La.push(Ya.changed[Va].oldValue.symbol);Ua?(Na.defaultSymbol&&La.push(Na.defaultSymbol),Aa.defaultSymbol&&ya.push(Aa.defaultSymbol)):Na.defaultSymbol&&ya.length&&La.push(Aa.defaultSymbol);this._applySymbolSetDiff(ya,La,Aa);delete wa.diff.defaultSymbol;delete wa.diff.uniqueValueInfos;return!0}return!1};Oa._calculateUnchangedSymbolMapping=
function(wa,Aa,Na){if("unique-value"!==(null==Aa?void 0:Aa.type)||"unique-value"!==(null==Na?void 0:Na.type)||u.isSome(wa)&&"partial"!==wa.type)return[];const Ua=ya=>u.isSome(ya)?ya.id:null;var Ya=wa&&wa.diff;wa=Ya&&Ya.defaultSymbol;if(Ya=Ya&&Ya.uniqueValueInfos)Ya=Ya.unchanged.map(ya=>({oldId:Ua(ya.oldValue.symbol),newId:Ua(ya.newValue.symbol)}));else{Ya=[];for(const ya of Na.uniqueValueInfos){const La=Ua(ya.symbol),Va=Aa.uniqueValueInfos.find(hb=>hb.value===ya.value);Va&&La!==Ua(Va.symbol)&&Ya.push({oldId:La,
newId:Ua(Va.symbol)})}}!wa&&Na.defaultSymbol&&Ya.push({oldId:Ua(Na.defaultSymbol),newId:Ua(Aa.defaultSymbol)});return Ya};Oa._updateSymbolMapping=function(wa,Aa){const Na=u.isSome(Aa)&&Aa?"string"===typeof Aa?Aa:Aa.id:null;if(wa&&wa!==Na){var Ua=this.graphicsBySymbol.get(wa);this.graphicsBySymbol.delete(wa);void 0!==Ua&&this.graphicsBySymbol.set(Na,Ua);Ua=this.symbols.get(wa);void 0!==Ua&&(this.symbols.delete(wa),this.symbols.set(Na,Ua),u.isSome(Ua)&&(wa="string"===typeof Aa?null:Aa,u.isSome(wa)?
Ua.symbol=wa:Ua.symbol.id=Na))}};Oa._updateUnchangedSymbolMappings=function(wa,Aa,Na){wa=this._calculateUnchangedSymbolMapping(wa,Aa,Na);for(const {oldId:Ua,newId:Ya}of wa)this._updateSymbolMapping(Ua,Ya)};Oa._applyRendererDiff=function(wa,Aa,Na){if(this._diffHasSymbolChange(wa))return!1;if(Aa instanceof e&&Na instanceof e&&this._applyUniqueValueRendererDiff(wa,Aa,Na)&&0===Object.keys(wa.diff).length)return!0;for(const [Ua]of this.graphicsBySymbol)if(Na=this.symbols.get(Ua),u.isSome(Na))switch(Na.applyRendererDiff(wa,
Aa)){case ia.ApplyRendererDiffResult.Recreate_Symbol:this._recreateSymbol(Ua);break;case ia.ApplyRendererDiffResult.Recreate_Graphics:this._recreateGraphicsForSymbol(Ua)}return!0};Oa.opacityChange=function(){this.forEachGraphics3DSymbol((wa,Aa)=>wa.globalPropertyChanged("opacity",Aa));this._updateStageLayerVisibility()};Oa._slicePlaneEnabledChange=function(wa){wa!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=wa,this.stageLayer.isSliceable=wa,this.forEachGraphics3DSymbol((Aa,
Na)=>Aa.globalPropertyChanged("slicePlaneEnabled",Na)),this.deconflictor&&this.deconflictor.slicePlaneEnabledChange(),this.labeler&&this.labeler.slicePlaneEnabledChange())};Oa._physicalBasedRenderingChange=function(wa){wa!==this.symbolCreationContext.physicalBasedRenderingEnabled&&(this.symbolCreationContext.physicalBasedRenderingEnabled=wa,this.forEachGraphics3DSymbol((Aa,Na,Ua)=>{Aa.globalPropertyChanged("physicalBasedRenderingEnabled",Na)||this._recreateSymbol(Ua)}))};Oa._pixelRatioChange=function(){this.forEachGraphics3DSymbol((wa,
Aa,Na)=>{wa.globalPropertyChanged("pixelRatio",Aa)||this._recreateSymbol(Na)})};Oa._signalUpdatingDuringAsyncLoadedGraphicsChange=function(){this._updatingPendingLoadedGraphicsChange&&this._updatingPendingLoadedGraphicsChange.remove();this._updatingPendingLoadedGraphicsChange=A.schedule(()=>{this._updatingPendingLoadedGraphicsChange=null})};Oa.setClippingExtent=function(wa,Aa){const Na=this.symbolCreationContext.clippingExtent,Ua=I.create();ha.toBoundingRect(wa,Ua,Aa)?this.symbolCreationContext.clippingExtent=
K.fromRect(K.create(),Ua):this.symbolCreationContext.clippingExtent=null;return!K.equals(this.symbolCreationContext.clippingExtent,Na)};Oa.modifyGraphics3DGraphicVisibilities=function(wa){let Aa=!1;this.graphics3DGraphics.forEach(Na=>{wa(Na)&&(Aa=!0)});Aa&&(this.labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty())};Oa.forEachGraphics3DSymbol=function(wa){for(const [Aa,Na]of this.symbols){if(u.isNone(Na))break;const Ua=this.graphicsBySymbol.get(Aa);wa(Na,Ua||cb,Aa)}};
Oa.updateAllGraphicsVisibility=function(){this.filterVisibility&&(this.filterVisibility.dirty=!0);this.modifyGraphics3DGraphicVisibilities(wa=>{const Aa=this._updateUserVisibility(wa);wa=u.isSome(this.scaleVisibility)&&this.scaleVisibility.updateVisibility(wa);return Aa||wa})};Oa._hideAllGraphics=function(){this.modifyGraphics3DGraphicVisibilities(wa=>wa.setVisibilityFlag(V.VisibilityFlag.USER_SETTING,!1,V.VisibilityGroup.GRAPHIC))};Oa._validateRenderer=function(wa){(wa=P.validateTo3D(wa))&&Ha.warn(`Renderer for layer '${this.layer.title?
`${this.layer.title}, `:""}, id:${this.layer.id}' is not supported in a SceneView`,wa.message)};Oa._volatileGraphicsUpdated=function(){var wa;null==(wa=this.labeler)?void 0:wa.reset();this.stageLayer.shaderTransformationChanged();this.notifyChange("updating")};Oa._cleanupSymbols=function(){if(!(0<this.graphicsWaitingForSymbol.size||this.suspendSymbolCleanup)){var wa=!1;this.symbols.forEach((Aa,Na)=>{if(!(u.isNone(Aa)||0<Aa.referenced)){var Ua=this.graphicsBySymbol.get(Na);Ua&&0!==Ua.size||(this.graphicsBySymbol.delete(Na),
this.symbols.delete(Na),u.destroyMaybe(Aa),wa=!0)}});wa&&(this._recomputeExtentPadding(),this.notifyChange("averageSymbolComplexity"))}};b._createClass(Ka,[{key:"spatialIndex",get:function(){if(!this._spatialIndex){var wa;this._spatialIndex=new fa.SpatialIndex2D({objectIdField:null==(wa=this.owner.layer)?void 0:wa.objectIdField,spatialReference:this._spatialReference,hasZ:this.hasZ,hasM:this.hasM});this._spatialIndex.setup(Array.from(this.graphics3DGraphics.values()))}this._spatialIndex.update();
return this._spatialIndex}},{key:"effectiveUpdatePolicy",get:function(){return u.isSome(this.currentRenderer)&&"dictionary"===this.currentRenderer.type?pa.UpdatePolicy.ASYNC:u.unwrapOr(this.forcedUpdatePolicy,this.preferredUpdatePolicy)}},{key:"updating",get:function(){var wa,Aa;return!!(0<this.graphicsWaitingForSymbol.size||this.running||null!=(wa=this.elevationAlignment)&&wa.updating||u.isSome(this.scaleVisibility)&&this.scaleVisibility.updating||null!=(Aa=this.filterVisibility)&&Aa.updating||this.rendererChangeAbortController||
this.elevationInfoChangeAbortController||this._updatingPendingLoadedGraphicsChange||this._frameTask.updating)}},{key:"running",get:function(){var wa;return 0<this.pendingUpdates.size||!(null==(wa=this._spatialIndex)||!wa.updating)}},{key:"suspendedOrOutsideOfView",get:function(){var wa;return this.owner.suspended||(null==(wa=this.owner.suspendInfo)?void 0:wa.outsideOfView)}},{key:"updatingRemaining",get:function(){var wa,Aa;return this.updating?this.pendingUpdates.size+.1*((null==(wa=this._spatialIndex)?
void 0:wa.updatingRemaining)||0)+.1*((null==(Aa=this.elevationAlignment)?void 0:Aa.updatingRemaining)||0):0}},{key:"displayFeatureLimit",get:function(){var wa=this.owner&&this.owner.view&&this.owner.view.qualitySettings;const Aa=wa?wa.graphics3D.minTotalNumberOfFeatures:0,Na=wa?wa.graphics3D.maxTotalNumberOfFeatures:0;wa=wa?wa.graphics3D.maxTotalNumberOfPrimitives:0;const Ua=this.averageSymbolComplexity;var Ya=Math.max(1,u.isSome(Ua)?Ua.primitivesPerFeature:1),ya=u.isSome(Ua)&&0<Ua.drawCallsPerFeature?
Na/Ua.drawCallsPerFeature*.3:Na;Ya=Math.max(Aa,Math.min(Na,Math.ceil(wa/Ya),ya));return(ya=this._get("displayFeatureLimit"))&&ya.minimumTotalNumberOfFeatures===Aa&&ya.maximumTotalNumberOfFeatures===Na&&ya.maximumTotalNumberOfPrimitives===wa&&ya.averageSymbolComplexity===Ua&&ya.maximumNumberOfFeatures===Ya?ya:{minimumTotalNumberOfFeatures:Aa,maximumTotalNumberOfFeatures:Na,maximumTotalNumberOfPrimitives:wa,averageSymbolComplexity:Ua,maximumNumberOfFeatures:Ya}}},{key:"averageSymbolComplexity",get:function(){const wa=
ba.averageSymbolComplexities(this.symbolComplexities),Aa=this._get("averageSymbolComplexity");return 0===wa.numComplexities||u.isSome(Aa)&&(wa.estimated&&(Aa.primitivesPerFeature>=wa.primitivesPerFeature||Aa.primitivesPerCoordinate>=wa.primitivesPerCoordinate||Aa.drawCallsPerFeature>=wa.drawCallsPerFeature)||Aa.primitivesPerFeature===wa.primitivesPerFeature&&Aa.primitivesPerCoordinate===wa.primitivesPerCoordinate&&Aa.drawCallsPerFeature===wa.drawCallsPerFeature)?Aa:wa}},{key:"spatialReference",get:function(){return this._spatialReference}},
{key:"usedMemory",get:function(){const wa=u.isSome(this.averageSymbolComplexity)&&this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel*this.numberOfGraphics:0;return this._usedMemory+wa}},{key:"usedMemoryPerGraphic",get:function(){return this._usedMemory&&this.numberOfGraphics?30<Math.abs(this.pendingAdds-this.pendingRemoves)/this.numberOfGraphics?0:this._usedMemory/this.numberOfGraphics:u.isSome(this.averageSymbolComplexity)?this.averageSymbolComplexity.memory.bytesPerFeature+
(this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel:0):0}},{key:"unprocessedMemoryEstimate",get:function(){return Math.max(0,(this.pendingAdds-this.pendingRemoves)*this.usedMemoryPerGraphic)}},{key:"symbolComplexities",get:function(){return this.currentRenderer?this._getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this._getSymbolComplexitiesUsed()}},{key:"graphics3DGraphicsByObjectID",get:function(){const wa=this.owner.layer&&this.owner.layer.objectIdField;if(!wa)return null;
const Aa=new Map;this.graphics3DGraphics.forEach(Na=>{if(Na){var Ua=this._getGraphicObjectID(Na.graphic,wa);u.isSome(Ua)&&Aa.set(Ua,Na)}});return Aa}},{key:"labelsEnabled",get:function(){return!(!this.labeler||!this.labeler.layerLabelsEnabled())}},{key:"symbolUpdateType",get:function(){if(0<this.pendingUpdates.size)return"unknown";let wa=0,Aa=0;return x.someMap(this.symbols,(Na,Ua)=>{if(u.isSome(Na)){Na=Na.getFastUpdateStatus();if(0<Na.loading)return!0;this.graphicsBySymbol.has(Ua)&&(Aa+=Na.fast,
wa+=Na.slow)}return!1})?"unknown":0<=Aa&&0===wa?"fast":0<=wa&&0===Aa?"slow":"mixed"}},{key:"test",get:function(){return{snapshotInternals:()=>({graphics:[...this.graphics3DGraphics.keys()].sort(),symbols:[...this.symbols.keys()].sort(),graphicsBySymbol:[...this.graphicsBySymbol.keys()].sort().map(wa=>({symbolId:wa,graphics:[...this.graphicsBySymbol.get(wa).keys()].sort()})),graphicsWithoutSymbol:[...this.graphicsWithoutSymbol.keys()].sort(),graphicsDrapedUids:[...this.graphicsDrapedUids].sort(),pendingUpdates:this.pendingUpdates}),
symbols:this.symbols,filterVisibility:this.filterVisibility,numPending:this.pendingUpdates.size,forceUpdatePolicy:wa=>{this.forcedUpdatePolicy=wa}}}},{key:"performanceInfo",get:function(){return{visible:this.graphics3DGraphics.size,missing:this.graphicsWithoutSymbol.size,pending:this.pendingUpdates.size}}}]);return Ka}(z);a.Graphics3DCore.tmpVec=H.create();c.__decorate([B.property({readOnly:!0})],a.Graphics3DCore.prototype,"computedExtent",void 0);c.__decorate([B.property()],a.Graphics3DCore.prototype,
"currentRenderer",void 0);c.__decorate([B.property()],a.Graphics3DCore.prototype,"rendererHasGeometryOperations",void 0);c.__decorate([B.property()],a.Graphics3DCore.prototype,"_frameTask",void 0);c.__decorate([B.property()],a.Graphics3DCore.prototype,"rendererChangeAbortController",void 0);c.__decorate([B.property()],a.Graphics3DCore.prototype,"elevationInfoChangeAbortController",void 0);c.__decorate([B.property()],a.Graphics3DCore.prototype,"setupAbortController",void 0);c.__decorate([B.property({readOnly:!0})],
a.Graphics3DCore.prototype,"elevationAlignment",void 0);c.__decorate([B.property({readOnly:!0})],a.Graphics3DCore.prototype,"scaleVisibility",void 0);c.__decorate([B.property({readOnly:!0})],a.Graphics3DCore.prototype,"filterVisibility",void 0);c.__decorate([B.property()],a.Graphics3DCore.prototype,"_spatialIndex",void 0);c.__decorate([B.property({readOnly:!0})],a.Graphics3DCore.prototype,"extentPadding",void 0);c.__decorate([B.property()],a.Graphics3DCore.prototype,"_updatingPendingLoadedGraphicsChange",
void 0);c.__decorate([B.property({readOnly:!0})],a.Graphics3DCore.prototype,"featureStore",void 0);c.__decorate([B.property({readOnly:!0})],a.Graphics3DCore.prototype,"deconflictor",void 0);c.__decorate([B.property({readOnly:!0})],a.Graphics3DCore.prototype,"labeler",void 0);c.__decorate([B.property({readOnly:!0})],a.Graphics3DCore.prototype,"objectStates",void 0);c.__decorate([B.property()],a.Graphics3DCore.prototype,"preferredUpdatePolicy",void 0);c.__decorate([B.property()],a.Graphics3DCore.prototype,
"forcedUpdatePolicy",void 0);c.__decorate([B.property({readOnly:!0})],a.Graphics3DCore.prototype,"effectiveUpdatePolicy",null);c.__decorate([B.property({constructOnly:!0})],a.Graphics3DCore.prototype,"elevationFeatureExpressionEnabled",void 0);c.__decorate([B.property({constructOnly:!0})],a.Graphics3DCore.prototype,"owner",void 0);c.__decorate([B.property({constructOnly:!0})],a.Graphics3DCore.prototype,"layer",void 0);c.__decorate([B.property({constructOnly:!0})],a.Graphics3DCore.prototype,"graphicSymbolSupported",
void 0);c.__decorate([B.property({constructOnly:!0})],a.Graphics3DCore.prototype,"getRenderingInfoWithoutRenderer",void 0);c.__decorate([B.property({readOnly:!0})],a.Graphics3DCore.prototype,"updating",null);c.__decorate([B.property({readOnly:!0})],a.Graphics3DCore.prototype,"running",null);c.__decorate([B.property({readOnly:!0})],a.Graphics3DCore.prototype,"suspendedOrOutsideOfView",null);c.__decorate([B.property({readOnly:!0,dependsOn:[]})],a.Graphics3DCore.prototype,"updatingRemaining",null);c.__decorate([B.property({readOnly:!0,
dependsOn:["owner.view.qualitySettings.graphics3D.maxTotalNumberOfPrimitives","owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures","averageSymbolComplexity"]})],a.Graphics3DCore.prototype,"displayFeatureLimit",null);c.__decorate([B.property({readOnly:!0,dependsOn:[]})],a.Graphics3DCore.prototype,"averageSymbolComplexity",null);c.__decorate([B.property({constructOnly:!0})],a.Graphics3DCore.prototype,"hasZ",void 0);c.__decorate([B.property({constructOnly:!0})],a.Graphics3DCore.prototype,
"hasM",void 0);a.Graphics3DCore=va=c.__decorate([F.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],a.Graphics3DCore);var Ta;(function(Ca){Ca[Ca.NEW=0]="NEW";Ca[Ca.LOADING=1]="LOADING";Ca[Ca.READY=2]="READY";Ca[Ca.REJECTED=3]="REJECTED"})(Ta||(Ta={}));let db=function(){function Ca(){this.renderingInfo=this.add=null;this.state=Ta.NEW;this.remove=null}Ca.prototype.clear=function(){this.renderingInfo=this.add=null;this.state=Ta.NEW;this.remove=this.abortController=null};return Ca}();const fb=
H.create(),ka=H.create(),cb=new Map;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/support/rendererConversion":function(){define(["exports","../../core/has","../../core/Error","../../core/maybe","../../symbols/support/symbolConversion"],function(a,b,c,g,h){function w(k){return g.isNone(k)||"simple"===k.type||"unique-value"===k.type||"class-breaks"===k.type||"dictionary"===k.type||"heatmap"===k.type}function n(k,e){if(!e)return null;e=Array.isArray(e)?e:[e];if(0<e.length){const d=
e.map(z=>z.details.symbol.type||z.details.symbol.declaredClass).filter(z=>!!z);d.sort();const m=[];d.forEach((z,v)=>{0!==v&&z===d[v-1]||m.push(z)});return new c("renderer-conversion-3d:unsupported-symbols",`Renderer contains symbols (${m.join(", ")}) which are not supported in 3D`,{renderer:k,symbolErrors:e})}return null}function f(k){const e=k.uniqueValueInfos.map(m=>h.to3D(m.symbol).error).filter(m=>!!m),d=h.to3D(k.defaultSymbol);d.error&&e.unshift(d.error);return n(k,e)}function l(k){const e=k.classBreakInfos.map(m=>
h.to3D(m.symbol).error).filter(m=>!!m),d=h.to3D(k.defaultSymbol);d.error&&e.unshift(d.error);return n(k,e)}a.isSupportedRenderer3D=w;a.validateTo3D=function(k){if(g.isNone(k))return null;if(!w(k))return new c("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${k.type||k.declaredClass}'`,{renderer:k});switch(k.type){case "simple":return n(k,h.to3D(k.symbol).error);case "unique-value":return f(k);case "class-breaks":return l(k)}return null};Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/symbols/support/defaults3D":function(){define("exports ../../core/has ../../core/maybe ../FillSymbol3DLayer ../LineSymbol3D ../MeshSymbol3D ../PointSymbol3D ../PolygonSymbol3D ../edges/SolidEdges3D ./defaults ./defaultsJSON".split(" "),function(a,b,c,g,h,w,n,f,l,k,e){const d=n.fromSimpleMarkerSymbol(k.defaultPointSymbol2D),m=h.fromSimpleLineSymbol(k.defaultPolylineSymbol2D),z=f.fromSimpleFillSymbol(k.defaultPolygonSymbol2D),v=new w({symbolLayers:[new g({material:{color:e.defaultColor},
edges:new l({size:"1px",color:e.defaultOutlineColor})})]});a.getDefaultSymbol3D=function(q){if(c.isNone(q))return null;switch(q.type){case "mesh":return v;case "point":case "multipoint":return d;case "polyline":return m;case "polygon":case "extent":return z}return null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DFeatureStore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projection ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/OptimizedFeature ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/data/optimizedFeatureQueryEngineAdapter".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q){a.Graphics3DFeatureStore=function(r){function x(E){var y=r.call(this,E)||this;y.events=new h;y.hasZ=null;y.hasM=null;y.objectIdField=null;y.spatialReference=null;y.featureAdapter={getAttribute(A,p){return"graphic"in A?A.graphic.attributes[p]:q.optimizedFeatureQueryEngineAdapter.getAttribute(A,p)},getAttributes(A){return"graphic"in A?A.graphic.attributes:q.optimizedFeatureQueryEngineAdapter.getAttributes(A)},getObjectId:A=>"graphic"in A?m.getObjectId(A.graphic,
y.objectIdField):q.optimizedFeatureQueryEngineAdapter.getObjectId(A),getGeometry:A=>"graphic"in A?A.getAsOptimizedGeometry(y.hasZ,y.hasM):q.optimizedFeatureQueryEngineAdapter.getGeometry(A),getCentroid:(A,p)=>{if("graphic"in A){let B=null;w.isSome(A.centroid)?B=A.centroid:"point"===A.graphic.geometry.type&&d.projectPoint(A.graphic.geometry,t,y.spatialReference)&&(B=t);A=Array(2+(p.hasZ?1:0)+(p.hasM?1:0));w.isNone(B)?(A[0]=0,A[1]=0,A[2]=0,A[3]=0):(A[0]=B.x,A[1]=B.y,p.hasZ&&(A[2]=B.hasZ?B.z:0),p.hasM&&
(A[p.hasZ?3:2]=B.hasM?B.m:0));return new v([],A)}return q.optimizedFeatureQueryEngineAdapter.getCentroid(A,p)},cloneWithGeometry:(A,p)=>"graphic"in A?new z.OptimizedFeature(p,y.featureAdapter.getAttributes(A),null,y.featureAdapter.getObjectId(A)):q.optimizedFeatureQueryEngineAdapter.cloneWithGeometry(A,p)};return y}b._inheritsLoose(x,r);var u=x.prototype;u.forEach=function(E){this.forAllGraphics(y=>{E(y)})};u.forEachInBounds=function(E,y){this.getSpatialIndex().forEachInBounds(E,y)};u.forEachBounds=
function(E,y,A){const p=this.getSpatialIndex();for(const B of E)E=this.featureAdapter.getObjectId(B),w.isSome(p.getBounds(E,A))&&y(A)};return x}(g);c.__decorate([n.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"getSpatialIndex",void 0);c.__decorate([n.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"forAllGraphics",void 0);c.__decorate([n.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"hasZ",void 0);c.__decorate([n.property({constructOnly:!0})],
a.Graphics3DFeatureStore.prototype,"hasM",void 0);c.__decorate([n.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"objectIdField",void 0);c.__decorate([n.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"spatialReference",void 0);c.__decorate([n.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"featureSpatialReference",void 0);a.Graphics3DFeatureStore=c.__decorate([e.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureStore")],a.Graphics3DFeatureStore);
const t={type:"point",x:0,y:0,hasZ:!1,hasM:!1,spatialReference:null};a.default=a.Graphics3DFeatureStore;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":function(){define(["exports","../../../core/maybe","../centroid","../OptimizedFeature","../OptimizedGeometry"],function(a,b,c,g,h){const w={getObjectId(n){return n.objectId},getAttributes(n){return n.attributes},getAttribute(n,f){return n.attributes[f]},cloneWithGeometry(n,f){return new g.OptimizedFeature(f,
n.attributes,null,n.objectId)},getGeometry(n){return n.geometry},getCentroid(n,f){b.isNone(n.centroid)&&(n.centroid=c.getCentroidOptimizedGeometry(new h,n.geometry,f.hasZ,f.hasM));return n.centroid}};a.default=w;a.optimizedFeatureQueryEngineAdapter=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/centroid":function(){define(["exports","../../core/maybe"],function(a,b){function c(h,w,n,f,l,k,e=1){k=l?k?4:3:k?3:2;let d=n,m=n+k,z=0,v=0,q=n=0,t=0;for(let r=0,x=f-1;r<x;r++,d+=
k,m+=k){f=w[d];const u=w[d+1],E=w[d+2],y=w[m],A=w[m+1],p=w[m+2];let B=f*A-y*u;q+=B;z+=(f+y)*B;v+=(u+A)*B;l&&(B=f*p-y*E,n+=(E+p)*B,t+=B);f<h[0]&&(h[0]=f);f>h[1]&&(h[1]=f);u<h[2]&&(h[2]=u);u>h[3]&&(h[3]=u);l&&(E<h[4]&&(h[4]=E),E>h[5]&&(h[5]=E))}0<q*e&&(q*=-1);0<t*e&&(t*=-1);if(!q)return null;h=[z,v,.5*q];l&&(h[3]=n,h[4]=.5*t);return h}function g(h,w,n,f,l){l=f?l?4:3:l?3:2;let k=w,e=w+l,d=0,m=0,z=0,v=0;for(let x=0,u=n-1;x<u;x++,k+=l,e+=l){var q=h[k];const E=h[k+1],y=h[k+2],A=h[e],p=h[e+1],B=h[e+2];if(f){{var t=
A-q;var r=p-E;const D=B-y;t=Math.sqrt(t*t+r*r+D*D)}}else t=A-q,r=p-E,t=Math.sqrt(t*t+r*r);t&&(d+=t,f?(q=[q+.5*(A-q),E+.5*(p-E),y+.5*(B-y)],m+=t*q[0],z+=t*q[1],v+=t*q[2]):(q=[q+.5*(A-q),E+.5*(p-E)],m+=t*q[0],z+=t*q[1]))}return 0<d?f?[m/d,z/d,v/d]:[m/d,z/d]:0<n?f?[h[w],h[w+1],h[w+2]]:[h[w],h[w+1]]:null}a.getCentroidOptimizedGeometry=function(h,w,n,f,l){if(b.isNone(w)||!w.lengths.length)return null;const k="upperLeft"===(null==l?void 0:l.originPosition)?-1:1;h.lengths.length&&(h.lengths.length=0);h.coords.length&&
(h.coords.length=0);l=h.coords;const e=[],d=n?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:m,coords:z}=w,v=n?f?4:3:f?3:2;let q=0;for(var t of m){const r=c(d,z,q,t,n,f,k);r&&e.push(r);q+=t*v}e.sort((r,x)=>{let u=k*r[2]-k*x[2];0===u&&n&&(u=r[4]-x[4]);return u});e.length&&(t=6*e[0][2],
l[0]=e[0][0]/t,l[1]=e[0][1]/t,n&&(t=6*e[0][4],l[2]=0!==t?e[0][3]/t:0),l[0]<d[0]||l[0]>d[1]||l[1]<d[2]||l[1]>d[3]||n&&(l[2]<d[4]||l[2]>d[5]))&&(l.length=0);if(!l.length)if(w=w.lengths[0]?g(z,0,m[0],n,f):null)l[0]=w[0],l[1]=w[1],n&&2<w.length&&(l[2]=w[2]);else return null;return h};a.lineCentroid=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DSymbolCreationContext":function(){define(["exports"],function(a){a.Graphics3DSymbolCreationContext=function(b){this.schedule=
b;this.featureExpressionInfoContext=this.localOriginFactory=this.graphicsCoreOwner=this.layer=this.overlaySR=this.renderCoordsHelper=this.clippingExtent=this.stage=this.renderer=this.elevationProvider=this.streamDataRequester=this.sharedResources=null;this.screenSizePerspectiveEnabled=!0;this.isAsync=this.physicalBasedRenderingEnabled=this.slicePlaneEnabled=!1};a.Graphics3DSymbolLayerCreationContext=function(){};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":function(){define(["exports",
"./Graphics3DPointSymbol","./Graphics3DSymbol"],function(a,b,c){a.make=function(g,h,w){let n;switch(g.type){case "point-3d":n=b;break;default:n=c}return new n(g,h,w)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DPointSymbol":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DSymbol".split(" "),function(a,b,c,
g,h,w){return function(n){function f(k,e,d){k=n.call(this,k,e,d)||this;k.calloutSymbolLayer=null;k.symbol.hasVisibleCallout()&&(k.calloutSymbolLayer=h.make(k.symbol,e));return k}a._inheritsLoose(f,n);var l=f.prototype;l.doLoad=function(){var k=a._asyncToGenerator(function*(e){const d=this.calloutSymbolLayer?b.result(this.calloutSymbolLayer.load()):null;try{yield n.prototype.doLoad.call(this,e),g.throwIfAborted(e)}catch(z){var m;null==(m=this.calloutSymbolLayer)?void 0:m.abortLoad();throw z;}d&&(yield d)});
return function(e){return k.apply(this,arguments)}}();l.destroy=function(){n.prototype.destroy.call(this);this.calloutSymbolLayer=c.destroyMaybe(this.calloutSymbolLayer)};l.createGraphics3DGraphic=function(k,e){e=n.prototype.createGraphics3DGraphic.call(this,k,e);c.isSome(this.calloutSymbolLayer)&&c.isSome(e)&&(k=this._createCalloutGraphic(k),c.isSome(k)&&e.addAuxiliaryGraphic(k));return e};l.globalPropertyChanged=function(k,e){return n.prototype.globalPropertyChanged.call(this,k,e)?this.calloutSymbolLayer?
this.calloutSymbolLayer.globalPropertyChanged(k,e,d=>this._getCalloutGraphicLayer(d)):!0:!1};l.updateGeometry=function(k,e){const d=n.prototype.updateGeometry.call(this,k,e);return d&&this.calloutSymbolLayer&&(k=this._getCalloutGraphicLayer(k))?this.calloutSymbolLayer.updateGeometry(k,e):d};l._createCalloutGraphic=function(k){const e=k.renderingInfo;k.renderingInfo={renderer:e.renderer,symbol:e.symbol,translation:[0,0,0],centerOffset:[0,0,0,0],screenOffset:[0,0],centerOffsetUnits:"world",elevationOffset:0,
materialCollection:null};return this.calloutSymbolLayer.createGraphics3DGraphic(k)};l._getCalloutGraphicLayer=function(k){for(const e of k._auxiliaryGraphics)if(e.graphics3DSymbolLayer===this.calloutSymbolLayer)return e};return f}(w)})},"esri/views/3d/layers/graphics/GraphicStateTracking":function(){define(["exports","../../../../core/arrayUtils","../../../../core/maybe","../../../../layers/graphics/dehydratedFeatures"],function(a,b,c,g){let h=function(){function w(f){this.graphicsCore=f;this.idToState=
new Map;this.states=new Set;const l=f.owner.layer&&f.owner.layer.objectIdField;l?(this.getGraphicId=k=>g.getObjectId(k,l),this.getGraphics3DGraphicById=k=>this.graphicsCore.getGraphics3DGraphicByObjectId(k)):(this.getGraphicId=k=>k.uid,this.getGraphics3DGraphicById=k=>this.graphicsCore.getGraphics3DGraphicById(k))}var n=w.prototype;n.destroy=function(){this.idToState.clear();this.states.forEach((f,l)=>this.remove(l))};n.add=function(f){const l={remove:()=>this.remove(f)};if(this.states.has(f))return l;
const k=this.getGraphicId(f.graphic),e=this.getGraphics3DGraphicById(k);this.states.has(f)||this.states.add(f);this._ensureStateList(k).push(f);f.displaying=c.isSome(e)?e.isVisible():!1;f.isDraped=c.isSome(e)?e.isDraped:!1;f.tracking=!0;c.isSome(e)&&f.emit("changed",{});return l};n.remove=function(f){if(this.states.has(f)){if(this.idToState.size){const l=this.getGraphicId(f.graphic),k=this.idToState.get(l);k&&(b.remove(k,f),0===k.length&&this.idToState.delete(l))}this.states.delete(f);f.tracking=
!1;f.displaying=!1}};n.addGraphic=function(f){this._forEachState(f,l=>{l.displaying=f.isVisible();l.isDraped=f.isDraped;l.emit("changed",{})})};n.removeGraphic=function(f){this._forEachState(f,l=>{l.displaying=!1;l.isDraped=!1})};n.updateGraphicGeometry=function(f){this._forEachState(f,l=>{l.emit("changed",{})})};n.updateGraphicVisibility=function(f){this._forEachState(f,l=>{l.displaying=f.isVisible()})};n.allGraphicsDeleted=function(){this.states.forEach(f=>{f.displaying=!1})};n._ensureStateList=
function(f){var l=this.idToState.get(f);if(l)return l;l=[];this.idToState.set(f,l);return l};n._forEachState=function(f,l){0!==this.states.size&&0!==this.idToState.size&&(f=this.getGraphicId(f.graphic),f=this.idToState.get(f),null!=f&&f.forEach(l))};return w}();a.GraphicStateTracking=h;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/SpatialIndex2D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/rbush/PooledRBush ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){a.SpatialIndex2D=function(z){function v(t){t=z.call(this,t)||this;t._index=new k.PooledRBush(9,h("esri-csp-restrictions")?r=>({minX:r.extent[0],minY:r.extent[1],maxX:r.extent[2],maxY:r.extent[3]}):[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]);t._missing=new Set;t._boundsByFeature=new Map;t.spatialReference=null;t.hasZ=null;t.hasM=null;t.objectIdField=null;t.updating=!1;return t}b._inheritsLoose(v,z);var q=v.prototype;q.setup=function(t){this._addMany(t)};
q.destroy=function(){this._missing.clear();this._index.destroy();this._index=null;this._boundsByFeature.clear();this._boundsByFeature=null};q.update=function(){0<this._missing.size&&(this._addMany(Array.from(this._missing.values())),this.updating=!1,this._missing.clear())};q.queryGraphicUIDsInExtent=function(t,r,x){r.equals(this.spatialReference)&&(m.minX=t[0],m.minY=t[1],m.maxX=t[2],m.maxY=t[3],this.update(),this._index.search(m,u=>x(u.graphic.uid)))};q.add=function(t){this._missing.add(t);this.updating=
!0};q.remove=function(t){this._missing.delete(t)?this.updating=0<this._missing.size:(this._index.remove(t),t=d.getObjectId(t.graphic,this._get("objectIdField")),null!=t&&this._boundsByFeature.delete(t))};q._addMany=function(t){if(0!==t.length){var r=this._get("objectIdField");for(const x of t){x.computeExtent(this.spatialReference);const u=d.getObjectId(x.graphic,r);null!=u&&this._boundsByFeature.set(u,x.extent)}this._index.load(t)}};q.clear=function(){this._index.clear();this._missing.clear();this._boundsByFeature.clear();
this.updating=!1};q.forEachInBounds=function(t,r){m.minX=t[0];m.minY=t[1];m.maxX=t[2];m.maxY=t[3];this.update();this._index.search(m,x=>{r(x)})};q.getBounds=function(t,r){this.update();return(t=this._boundsByFeature.get(t))?e.fromRect(r,t):null};b._createClass(v,[{key:"updatingRemaining",get:function(){return this._missing.size}}]);return v}(g);c.__decorate([w.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"spatialReference",void 0);c.__decorate([w.property({constructOnly:!0})],a.SpatialIndex2D.prototype,
"hasZ",void 0);c.__decorate([w.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"hasM",void 0);c.__decorate([w.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"objectIdField",void 0);c.__decorate([w.property()],a.SpatialIndex2D.prototype,"updating",void 0);c.__decorate([w.property({readOnly:!0})],a.SpatialIndex2D.prototype,"updatingRemaining",null);a.SpatialIndex2D=c.__decorate([l.subclass("esri.views.3d.layers.graphics.SpatialIndex2D")],a.SpatialIndex2D);const m={minX:0,minY:0,maxX:0,
maxY:0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/libs/rbush/PooledRBush":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../arrayUtils ../../maybe ../../PooledArray ../../../chunks/quickselect".split(" "),function(a,b,c,g,h,w){function n(B,D){f(B,0,B.children.length,D,B)}function f(B,D,C,F,G){G||(G=new A([]));G.minX=Infinity;G.minY=Infinity;G.maxX=-Infinity;G.maxY=-Infinity;for(let L=D,H;L<C;L++)H=B.children[L],l(G,B.leaf?F(H):H);return G}function l(B,
D){B.minX=Math.min(B.minX,D.minX);B.minY=Math.min(B.minY,D.minY);B.maxX=Math.max(B.maxX,D.maxX);B.maxY=Math.max(B.maxY,D.maxY)}function k(B,D){return B.minX-D.minX}function e(B,D){return B.minY-D.minY}function d(B){return(B.maxX-B.minX)*(B.maxY-B.minY)}function m(B){return B.maxX-B.minX+(B.maxY-B.minY)}function z(B,D){return B.minX<=D.minX&&B.minY<=D.minY&&D.maxX<=B.maxX&&D.maxY<=B.maxY}function v(B,D){return D.minX<=B.maxX&&D.minY<=B.maxY&&D.maxX>=B.minX&&D.maxY>=B.minY}function q(B,D,C,F,G){for(D=
[D,C];D.length;){C=g.assumeNonNull(D.pop());const L=g.assumeNonNull(D.pop());if(C-L<=F)continue;const H=L+Math.ceil((C-L)/F/2)*F;w.quickselect(B,H,L,C,G);D.push(L,H,H,C)}}let t=function(){function B(C=9,F){this.compareMinX=k;this.compareMinY=e;this._toBBox=function(G){return G};this._maxEntries=Math.max(4,C||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));F&&("function"===typeof F?this._toBBox=F:this._initFormat(F));this.clear()}var D=B.prototype;D.destroy=function(){this.clear();r.prune();
x.prune();u.prune();E.prune()};D.all=function(C){this._all(this.data,C)};D.search=function(C,F){let G=this.data;const L=this._toBBox;if(v(C,G))for(r.clear();G;){for(let H=0,M=G.children.length;H<M;H++){const K=G.children[H],I=G.leaf?L(K):K;v(C,I)&&(G.leaf?F(K):z(C,I)?this._all(K,F):r.push(K))}G=r.pop()}};D.collides=function(C){let F=this.data;const G=this._toBBox;if(!v(C,F))return!1;for(r.clear();F;){for(let L=0,H=F.children.length;L<H;L++){const M=F.children[L],K=F.leaf?G(M):M;if(v(C,K)){if(F.leaf||
z(C,K))return!0;r.push(M)}}F=r.pop()}return!1};D.load=function(C){if(!C.length)return this;if(C.length<this._minEntries){for(let F=0,G=C.length;F<G;F++)this.insert(C[F]);return this}C=this._build(C.slice(0,C.length),0,C.length-1,0);if(this.data.children.length)if(this.data.height===C.height)this._splitRoot(this.data,C);else{if(this.data.height<C.height){const F=this.data;this.data=C;C=F}this._insert(C,this.data.height-C.height-1,!0)}else this.data=C;return this};D.insert=function(C){C&&this._insert(C,
this.data.height-1);return this};D.clear=function(){this.data=new A([]);return this};D.remove=function(C){if(!C)return this;let F=this.data,G=null,L=0,H=!1,M;const K=this._toBBox(C);u.clear();for(E.clear();F||0<u.length;){if(!F){var I;F=g.assumeNonNull(u.pop());G=u.data[u.length-1];L=null!=(I=E.pop())?I:0;H=!0}if(F.leaf&&(M=c.indexOf(F.children,C,F.children.length,F.indexHint),-1!==M)){F.children.splice(M,1);u.push(F);this._condense(u);break}H||F.leaf||!z(F,K)?G?(L++,F=G.children[L],H=!1):F=null:
(u.push(F),E.push(L),L=0,G=F,F=F.children[0])}return this};D.toJSON=function(){return this.data};D.fromJSON=function(C){this.data=C;return this};D._all=function(C,F){for(x.clear();C;){var G;if(!0===C.leaf)for(const L of C.children)F(L);else x.pushArray(C.children);C=null!=(G=x.pop())?G:null}};D._build=function(C,F,G,L){var H=G-F+1,M=this._maxEntries;if(H<=M)return C=new A(C.slice(F,G+1)),n(C,this._toBBox),C;L||(L=Math.ceil(Math.log(H)/Math.log(M)),M=Math.ceil(H/M**(L-1)));const K=new p([]);K.height=
L;H=Math.ceil(H/M);M=H*Math.ceil(Math.sqrt(M));for(q(C,F,G,M,this.compareMinX);F<=G;F+=M){const I=Math.min(F+M-1,G);q(C,F,I,H,this.compareMinY);for(let O=F;O<=I;O+=H)K.children.push(this._build(C,O,Math.min(O+H-1,I),L-1))}n(K,this._toBBox);return K};D._chooseSubtree=function(C,F,G,L){for(;;){L.push(F);if(!0===F.leaf||L.length-1===G)break;let H=Infinity,M=Infinity,K=void 0;for(let I=0,O=F.children.length;I<O;I++){const Q=F.children[I],J=d(Q),P=(Math.max(Q.maxX,C.maxX)-Math.min(Q.minX,C.minX))*(Math.max(Q.maxY,
C.maxY)-Math.min(Q.minY,C.minY))-J;P<M?(M=P,H=J<H?J:H,K=Q):P===M&&J<H&&(H=J,K=Q)}F=K||F.children[0]}return F};D._insert=function(C,F,G){var L=this._toBBox;G=G?C:L(C);u.clear();L=this._chooseSubtree(G,this.data,F,u);L.children.push(C);for(l(L,G);0<=F;)if(u.data[F].children.length>this._maxEntries)this._split(u,F),F--;else break;this._adjustParentBBoxes(G,u,F)};D._split=function(C,F){const G=C.data[F];var L=G.children.length;const H=this._minEntries;this._chooseSplitAxis(G,H,L);(L=this._chooseSplitIndex(G,
H,L))?(L=G.children.splice(L,G.children.length-L),L=G.leaf?new A(L):new p(L),L.height=G.height,n(G,this._toBBox),n(L,this._toBBox),F?C.data[F-1].children.push(L):this._splitRoot(G,L)):console.log("  Error: assertion failed at PooledRBush._split: no valid split index")};D._splitRoot=function(C,F){this.data=new p([C,F]);this.data.height=C.height+1;n(this.data,this._toBBox)};D._chooseSplitIndex=function(C,F,G){let L,H,M=void 0;L=H=Infinity;for(let I=F;I<=G-F;I++){var K=f(C,0,I,this._toBBox);const O=
f(C,I,G,this._toBBox),Q=Math.max(0,Math.min(K.maxX,O.maxX)-Math.max(K.minX,O.minX))*Math.max(0,Math.min(K.maxY,O.maxY)-Math.max(K.minY,O.minY));K=d(K)+d(O);Q<L?(L=Q,M=I,H=K<H?K:H):Q===L&&K<H&&(H=K,M=I)}return M};D._chooseSplitAxis=function(C,F,G){const L=C.leaf?this.compareMinX:k,H=C.leaf?this.compareMinY:e,M=this._allDistMargin(C,F,G,L);F=this._allDistMargin(C,F,G,H);M<F&&C.children.sort(L)};D._allDistMargin=function(C,F,G,L){C.children.sort(L);L=this._toBBox;var H=f(C,0,F,L);const M=f(C,G-F,G,L);
let K=m(H)+m(M);for(let I=F;I<G-F;I++){const O=C.children[I];l(H,C.leaf?L(O):O);K+=m(H)}for(G=G-F-1;G>=F;G--)H=C.children[G],l(M,C.leaf?L(H):H),K+=m(M);return K};D._adjustParentBBoxes=function(C,F,G){for(;0<=G;G--)l(F.data[G],C)};D._condense=function(C){for(let F=C.length-1;0<=F;F--){const G=C.data[F];if(0===G.children.length)if(0<F){const L=C.data[F-1],H=L.children;H.splice(c.indexOf(H,G,H.length,L.indexHint),1)}else this.clear();else n(G,this._toBBox)}};D._initFormat=function(C){const F=["return a",
" - b",";"];this.compareMinX=new Function("a","b",F.join(C[0]));this.compareMinY=new Function("a","b",F.join(C[1]));this._toBBox=new Function("a","return {minX: a"+C[0]+", minY: a"+C[1]+", maxX: a"+C[2]+", maxY: a"+C[3]+"};")};return B}();const r=new h,x=new h,u=new h,E=new h({deallocator:void 0});h=function(){this.minY=this.minX=Infinity;this.maxY=this.maxX=-Infinity};let y=function(B){function D(){var C=B.apply(this,arguments)||this;C.height=1;C.indexHint=new c.PositionHint;return C}b._inheritsLoose(D,
B);return D}(h),A=function(B){function D(C){var F=B.call(this)||this;F.children=C;F.leaf=!0;return F}b._inheritsLoose(D,B);return D}(y),p=function(B){function D(C){var F=B.call(this)||this;F.children=C;F.leaf=!1;return F}b._inheritsLoose(D,B);return D}(y);a.BBox=h;a.PooledRBush=t;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/chunks/quickselect":function(){define(["exports"],function(a){var b={exports:{}};(function(c){(function(g){g=g();void 0!==g&&(c.exports=g)})(function(){function g(n,
f,l,k,e){for(;k>l;){if(600<k-l){var d=k-l+1,m=f-l+1,z=Math.log(d),v=.5*Math.exp(2*z/3);z=.5*Math.sqrt(z*v*(d-v)/d)*(0>m-d/2?-1:1);g(n,f,Math.max(l,Math.floor(f-m*v/d+z)),Math.min(k,Math.floor(f+(d-m)*v/d+z)),e)}d=n[f];m=l;v=k;h(n,l,f);for(0<e(n[k],d)&&h(n,l,k);m<v;){h(n,m,v);m++;for(v--;0>e(n[m],d);)m++;for(;0<e(n[v],d);)v--}0===e(n[l],d)?h(n,l,v):(v++,h(n,v,k));v<=f&&(l=v+1);f<=v&&(k=v-1)}}function h(n,f,l){var k=n[f];n[f]=n[l];n[l]=k}function w(n,f){return n<f?-1:n>f?1:0}return function(n,f,l,k,
e){g(n,f,l||0,k||n.length-1,e||w)}})})(b);a.quickselect=b.exports})},"esri/views/3d/layers/support/StageLayerElevationProvider":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/unitUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../symbols/support/unitConversionUtils ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E){const y=n.getLogger("esri.views.3d.layers.support.StageLayerElevationProvider");a.StageLayerElevationProvider=function(G){function L(M){M=G.call(this,M)||this;M.elevationOffset=0;M._layerHandes=new w;return M}b._inheritsLoose(L,G);var H=L.prototype;H.initialize=function(){this.renderCoordsHelper=this.view.renderCoordsHelper;this.intersectLayers=[this.stageLayer];this.intersector=u.newIntersector(this.view.state.viewingMode);this.intersector.options.store=
E.StoreResults.MIN;var M=this._computeLayerExtent(this.stageLayer);this.zmin=M[2];this.zmax=M[5];M=this.stageLayer.events;this._layerHandes.add([M.on("layerObjectAdded",K=>this._objectChanged(K.object)),M.on("layerObjectRemoved",K=>this._objectChanged(K.object)),M.on("objectGeometryAdded",K=>this._objectChanged(K.object)),M.on("objectGeometryRemoved",K=>this._objectChanged(K.object)),M.on("vertexAttrsUpdated",K=>this._objectChanged(K.object)),M.on("objectTransformation",K=>this._objectChanged(K))])};
H.dispose=function(){this._layerHandes.destroy()};H.elevationInfoChanged=function(){const M=null!=this.layer?this.layer.elevationInfo:null;if(null!=M&&"on-the-ground"!==M.mode){const K=l.getMetersPerVerticalUnitForSR(this.layer.spatialReference),I=x.getMetersPerUnit(M.unit);this.elevationOffset=f.unwrapOr(M.offset,0)*I/K}else this.elevationOffset=0};H.getElevation=function(M,K,I,O){D[0]=M;D[1]=K;D[2]=I;if(!this.renderCoordsHelper.toRenderCoords(D,O,D))return y.error("could not project point for elevation alignment"),
null;M=this.elevationOffset;K=this.zmin+M;this.renderCoordsHelper.setAltitude(C,this.zmax+M,D);this.renderCoordsHelper.setAltitude(F,K,D);this.intersector.reset(C,F,null);this.intersector.intersect(this.intersectLayers,null,1,null,Q=>Q.metadata&&Q.metadata.isElevationSource);return this.intersector.results.min.getIntersectionPoint(D)?this.renderCoordsHelper.getAltitude(D):null};H._objectChanged=function(M){var K;if(null!=(K=M.metadata)&&K.isElevationSource&&this.spatialReference){t.empty(A);M.metadata.lastValidElevationBB.isEmpty()||
this._expandExtent(M.metadata.lastValidElevationBB.min,M.metadata.lastValidElevationBB.max,A);K=M.boundingVolumeWorldSpace.min;var I=M.boundingVolumeWorldSpace.max;this._expandExtent(K,I,A);t.toRect(A,p);this.zmin=Math.min(this.zmin,A[2]);this.zmax=Math.max(this.zmax,A[5]);B.extent=p;B.spatialReference=this.spatialReference;this.emit("elevation-change",B);v.copy(M.metadata.lastValidElevationBB.min,K);v.copy(M.metadata.lastValidElevationBB.max,I)}};H._computeLayerExtent=function(M){t.empty(A);M.objects.forAll(K=>
this._expandExtent(K.boundingVolumeWorldSpace.min,K.boundingVolumeWorldSpace.max,A));return A};H._expandExtent=function(M,K,I){for(let O=0;8>O;++O)D[0]=O&1?M[0]:K[0],D[1]=O&2?M[1]:K[1],D[2]=O&4?M[2]:K[2],this.renderCoordsHelper.fromRenderCoords(D,D,this.spatialReference),t.expandWithVec3(I,D);return I};return L}(h.EventedMixin(g));c.__decorate([k.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,"layer",void 0);c.__decorate([k.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,
"stageLayer",void 0);c.__decorate([k.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,"view",void 0);c.__decorate([k.property({readOnly:!0,aliasOf:"view.spatialReference"})],a.StageLayerElevationProvider.prototype,"spatialReference",void 0);a.StageLayerElevationProvider=c.__decorate([z.subclass("esri.views.3d.layers.support.StageLayerElevationProvider")],a.StageLayerElevationProvider);const A=t.empty(),p=r.empty(),B={spatialReference:null,extent:p,context:"scene"},D=q.create(),
C=q.create(),F=q.create();Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./ExtentSet ../../webgl-engine/lib/basicInterfaces ../../../support/Scheduler".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z){c=function(v){function q(){var r=v.apply(this,arguments)||this;r.dirtyExtents=new d.ExtentSet;r.globalDirty=!1;r.averageExtentUpdateSize=0;r.dirtyGraphicsSet=new Set;r.handles=new h;r.updateElevation=!1;r.graphicsCoreOwner=null;r.graphicsCore=null;r.events=new g;return r}a._inheritsLoose(q,v);var t=q.prototype;t.setup=function(r,x,u,E){this.graphicsCoreOwner=r;this.queryGraphicUIDsInExtent=x;this.graphicsCore=u;this.elevationProvider=E;r=this.graphicsCoreOwner.view.resourceController.scheduler;
this.handles.add([E.on("elevation-change",y=>this._elevationChanged(y)),this.graphicsCoreOwner.watch("suspended",()=>this._suspendedChange()),r.registerTask(z.TaskPriority.ELEVATION_ALIGNMENT,this)])};t.destroy=function(){this.dirtyGraphicsSet.clear();this.handles.destroy();this.queryGraphicUIDsInExtent=this.graphicsCore=this.graphicsCoreOwner=this.handles=null};t.clear=function(){this.dirtyGraphicsSet.clear();this.notifyChange("updating")};t._suspendedChange=function(){!0===this.graphicsCoreOwner.suspended?
this.updateElevation=!1:!1===this.graphicsCoreOwner.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))};t.elevationInfoChange=function(){this.globalDirty=!0;this.notifyChange("updating")};t.runTask=function(r){this.globalDirty&&(this._markAllGraphicsElevationDirty(),this.globalDirty=!1,r.madeProgress());for(r.run(()=>this.dirtyExtents.merge(r));this.running&&!r.done;)this._updateDirtyGraphics(r),this._updateDirtyExtents(r);this.graphicsCoreOwner.view.deconflictor.setDirty();
this.notifyChange("updating")};t._updateDirtyGraphics=function(r){const x=this.graphicsCoreOwner.view.renderCoordsHelper,u=this.graphicsCore.effectiveUpdatePolicy===m.UpdatePolicy.ASYNC;for(const E of this.dirtyGraphicsSet.keys()){const y=this.graphicsCore.getGraphics3DGraphicById(E);this.dirtyGraphicsSet.delete(E);w.isSome(y)&&(y.alignWithElevation(this.elevationProvider,x,u),r.madeProgress());if(r.done)break}};t._updateDirtyExtents=function(r){for(;!this.dirtyExtents.empty&&!r.done;){const x=this.dirtyExtents.pop(),
u=this.elevationProvider.spatialReference;this.events.emit("invalidate-elevation",{extent:x,spatialReference:u});const E=this.dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(x,u,y=>{const A=this.graphicsCore.getGraphics3DGraphicById(y);w.isSome(A)&&A.needsElevationUpdates()&&this.dirtyGraphicsSet.add(y)});this.averageExtentUpdateSize=.1*(this.dirtyGraphicsSet.size-E)+.9*this.averageExtentUpdateSize;r.madeProgress()}};t._markAllGraphicsElevationDirty=function(){this.dirtyExtents.clear();this.dirtyGraphicsSet.clear();
this.graphicsCore.graphics3DGraphics.forEach((r,x)=>this.dirtyGraphicsSet.add(x))};t._elevationChanged=function(r){if("scene"!==r.context||this.graphicsCore.layer.elevationInfo&&"relative-to-scene"===this.graphicsCore.layer.elevationInfo.mode){var {extent:x,spatialReference:u}=r;this.graphicsCoreOwner.suspended?(this.updateElevation||(r=this.graphicsCore.computedExtent)&&x[2]>r.xmin&&x[0]<r.xmax&&x[3]>r.ymin&&x[1]<r.ymax&&(this.updateElevation=!0),this.events.emit("invalidate-elevation",{extent:x,
spatialReference:u})):(-Infinity===x[0]?this.globalDirty=!0:this.dirtyExtents.add(x),this.notifyChange("updating"))}};a._createClass(q,[{key:"updating",get:function(){return this.running}},{key:"running",get:function(){return 0<this.dirtyGraphicsSet.size||this.dirtyExtents&&!this.dirtyExtents.empty||this.globalDirty}},{key:"updatingRemaining",get:function(){return this.dirtyGraphicsSet.size+this.dirtyExtents.size*this.averageExtentUpdateSize}}]);return q}(c);b.__decorate([n.property({readOnly:!0})],
c.prototype,"updating",null);b.__decorate([n.property({readOnly:!0})],c.prototype,"updatingRemaining",null);return c=b.__decorate([e.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],c)})},"esri/views/3d/layers/graphics/ExtentSet":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/PooledArray","../../../../geometry/support/aaBoundingRect","../../../support/Scheduler"],function(a,b,c,g,h){let w=function(){function n(){this._extents=new c({allocator:l=>
l||g.create()});this._tmpExtent=g.create();this._dirty=!1}var f=n.prototype;f.clear=function(){this._extents.clear()};f.add=function(l){this._contains(l)||(this._removeContained(l),g.copy(this._extents.pushNew(),l),this._dirty=!0)};f.pop=function(){this._dirty&&this._mergeTight();return this._extents.pop()};f.merge=function(l){this._mergeTight(l);return l.hasProgressed};f._mergeTight=function(l=h.noBudget){const k=this._extents,e=new Set;let d=0;for(;d!==k.length;){k.sort((m,z)=>m[0]-z[0]);d=k.length;
e.clear();for(let m=0;m<k.length;++m){if(l.done)return;const z=k.getItemAt(m);for(let v=m+1;v<k.length;++v){const q=k.getItemAt(v);if(q[0]>=z[2])break;e.add(q)}e.forEach(v=>{if(z!==v)if(v[2]<=z[0])e.delete(v);else{var q=g.area(z),t=g.area(v),r=this._tmpExtent;g.expand(z,v,r);q+=t;.05>(g.area(r)-q)/q&&(g.copy(z,r),e.delete(v),k.remove(v),l.madeProgress())}});e.add(z)}}this._dirty=!1};f._contains=function(l){return this._extents.some(k=>g.contains(k,l))};f._removeContained=function(l){this._extents.filterInPlace(k=>
!g.contains(l,k))};b._createClass(n,[{key:"empty",get:function(){return 0===this._extents.length}},{key:"size",get:function(){return this._extents.length}},{key:"test",get:function(){const l=this;return{containsPoint:k=>l._extents.some(e=>g.containsPoint(e,k))}}}]);return n}();a.ExtentSet=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DFilterVisibility":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/ObservableChangesType ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/FeatureFilter ./enums ./QueryEngine ../../../support/floorFilterUtils ../../../support/Scheduler".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u){const E=w.getLogger("esri.views.3d.layers.graphics.Graphics3DFilterVisibility");a.Graphics3DFilterVisibility=function(y){function A(...B){B=y.call(this,...B)||this;B._dirty=!1;B._querying=!1;B._handles=new h;return B}b._inheritsLoose(A,y);var p=A.prototype;p.setup=function(B,D){this._layerView=B;this._core=D;this._objectIdField=B.layer.objectIdField;this._queryEngine=new r.default({layerView:this._layerView,priority:u.TaskPriority.FILTER_VISIBILITY});
this._handles.add(this._layerView.view.resourceController.scheduler.registerTask(u.TaskPriority.FILTER_VISIBILITY,this));this._handles.add(k.on(D.owner,"loadedGraphics","after-changes",C=>this._graphicsChanged(C),()=>this.dirty=!0));this.filterChanged()};p.destroy=function(){this._handles.destroy();this._handles=null;this.clear();this._core=this._layerView=null};p.clear=function(){this._queryEngine.clear()&&(this._core.modifyGraphics3DGraphicVisibilities(B=>B.clearVisibilityFlag(t.VisibilityFlag.FILTER)),
this._queryResult=null,this._querying=!1);this.dirty=!1};p._graphicsChanged=function(B){this._queryEngine&&0===(B.type&f.ObservableChangesType.ADD)||(this.dirty=!0)};p.updateVisibility=function(B){this.active&&(B.hasVisibilityFlag(t.VisibilityFlag.FILTER,t.VisibilityGroup.GRAPHIC)||B.setVisibilityFlag(t.VisibilityFlag.FILTER,!1,t.VisibilityGroup.GRAPHIC),this.dirty=!0)};p.filterChanged=function(){const B=this._recomputeFilter();B!==this._filter&&(this._filter=B,this.dirty=!0)};p._recomputeFilter=
function(){var B="filter"in this._layerView?this._layerView.filter:null;const D="timeExtent"in this._layerView?this._layerView.timeExtent:null,C=x.getFloorFilterClause(this._layerView);if(n.isNone(D)&&n.isNone(C))return B;B=n.isSome(B)?B.clone():new q;n.isSome(D)&&(B.timeExtent=n.isSome(B.timeExtent)?B.timeExtent.intersection(D):D);n.isSome(C)&&(B.where=null==B.where||""===B.where?C:`(${B.where}) AND (${C})`);return B};p.runTask=function(B){if(this.active){!this._dirty||this._querying||B.done||(this._querying=
!0,this.dirty=!1,this._queryEngine.executeQueryForIdSet(this._filter).then(C=>{this._queryResult=C;this._querying=!1}).catch(C=>{if(!l.isAbortError(C)){E.warn("FeatureFilter query failed: "+C,{error:C});const F=new Set;this._core.graphics3DGraphics.forEach(G=>F.add(this._getFeatureId(G.graphic)));this._queryResult=F;this._querying=!1}}),B.madeProgress());var D=this._queryResult;n.isSome(D)&&!B.done&&(this._core.modifyGraphics3DGraphicVisibilities(C=>{if(B.done)return!1;const F=D.has(this._getFeatureId(C.graphic));
return C.setVisibilityFlag(t.VisibilityFlag.FILTER,F,t.VisibilityGroup.GRAPHIC)?(B.madeProgress(),!0):!1}),B.done||(this._queryResult=null))}else this.clear()};p._getFeatureId=function(B){return null==B.objectId?B.attributes[this._objectIdField]:B.objectId};b._createClass(A,[{key:"updating",get:function(){return this._dirty||this._querying||n.isSome(this._queryResult)}},{key:"active",get:function(){return this._filter&&0<this._core.graphics3DGraphics.size}},{key:"running",get:function(){return this._dirty&&
!this._querying||n.isSome(this._queryResult)}},{key:"dirty",set:function(B){this._dirty=B}}]);return A}(g);c.__decorate([e.property({readOnly:!0})],a.Graphics3DFilterVisibility.prototype,"updating",null);c.__decorate([e.property({readOnly:!0})],a.Graphics3DFilterVisibility.prototype,"running",null);c.__decorate([e.property()],a.Graphics3DFilterVisibility.prototype,"_dirty",void 0);c.__decorate([e.property()],a.Graphics3DFilterVisibility.prototype,"_querying",void 0);c.__decorate([e.property()],a.Graphics3DFilterVisibility.prototype,
"_queryResult",void 0);a.Graphics3DFilterVisibility=c.__decorate([v.subclass("esri.views.3d.layers.graphics.Graphics3DFilterVisibility")],a.Graphics3DFilterVisibility);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/QueryEngine":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/graphics/data/QueryEngine ../../../../rest/support/FeatureSet ../../../../rest/support/Query ../../../../geometry/support/typeUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q){const t=m.default;a.QueryEngine=function(r){function x(E){E=r.call(this,E)||this;E._dataQueryEngineInstance=null;return E}b._inheritsLoose(x,r);var u=x.prototype;u.destroy=function(){this.clear()};u.clear=function(){return this._dataQueryEngineInstance?(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0):!1};u.executeQueryForIdSet=function(){var E=b._asyncToGenerator(function*(y,A){return this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(y),
A)});return function(y,A){return E.apply(this,arguments)}}();u.executeQueryForCount=function(){var E=b._asyncToGenerator(function*(y,A){return this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(y),A)});return function(y,A){return E.apply(this,arguments)}}();u.executeQueryForExtent=function(){var E=b._asyncToGenerator(function*(y,A){const {count:p,extent:B}=yield this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(y),A);y=d.fromJSON(B);return{count:p,extent:y}});return function(y,
A){return E.apply(this,arguments)}}();u.executeQueryForIds=function(){var E=b._asyncToGenerator(function*(y,A){return this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(y),A)});return function(y,A){return E.apply(this,arguments)}}();u.executeQueryForLatestObservations=function(){var E=b._asyncToGenerator(function*(y,A){y=yield this.dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(y),A);y=z.fromJSON(y);y.features.forEach(p=>{p.layer=this.layer;p.sourceLayer=this.layer});
return y});return function(y,A){return E.apply(this,arguments)}}();u.executeQuery=function(){var E=b._asyncToGenerator(function*(y,A){y=yield this.dataQueryEngine.executeQuery(this._ensureQueryJSON(y),A);y=z.fromJSON(y);y.features.forEach(p=>{p.layer=this.layer;p.sourceLayer=this.layer});return y});return function(y,A){return E.apply(this,arguments)}}();u._ensureQueryJSON=function(E){if(w.isNone(E))return this.defaultQueryJSON;"outSpatialReference"in E&&!E.outSpatialReference&&(E.outSpatialReference=
this.spatialReference);return E.toJSON()};u._ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const E="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,y=this.layer.objectIdField,A=q.featureGeometryTypeKebabDictionary.toJSON(this.queryGeometryType),p=this.layer.fields.map(H=>H.toJSON()),B=this.layerView.view.resourceController.scheduler,D=this.priority,C=this.spatialReference.toJSON(),F=this.layerView.processor.featureStore,
{hasZ:G,hasM:L}=this.layerView;return this._dataQueryEngineInstance=new t({hasZ:G,hasM:L,geometryType:A,fields:p,timeInfo:E,spatialReference:C,objectIdField:y,featureStore:F,scheduler:B,priority:D})};b._createClass(x,[{key:"queryGeometryType",get:function(){switch(this.layer.geometryType){case "multipoint":case "point":case "polygon":case "polyline":return this.layer.geometryType;case "mesh":return"polygon"}}},{key:"defaultQueryJSON",get:function(){return(new v({outSpatialReference:this.spatialReference})).toJSON()}},
{key:"dataQueryEngine",get:function(){return this._ensureDataQueryEngine()}}]);return x}(h);c.__decorate([n.property({constructOnly:!0})],a.QueryEngine.prototype,"layerView",void 0);c.__decorate([n.property({constructOnly:!0})],a.QueryEngine.prototype,"priority",void 0);c.__decorate([n.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],a.QueryEngine.prototype,"spatialReference",void 0);c.__decorate([n.property({readOnly:!0,aliasOf:"layerView.layer"})],a.QueryEngine.prototype,"layer",
void 0);c.__decorate([n.property({readOnly:!0})],a.QueryEngine.prototype,"queryGeometryType",null);c.__decorate([n.property({readOnly:!0})],a.QueryEngine.prototype,"defaultQueryJSON",null);a.QueryEngine=c.__decorate([e.subclass("esri.views.3d.layers.graphics.QueryEngine")],a.QueryEngine);a.default=a.QueryEngine;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/data/QueryEngine":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/MemCache ../../../core/unitUtils ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/boundsUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ./attributeSupport ./projectionSupport ./QueryEngineCapabilities ./QueryEngineResult ./spatialQuerySupport ./timeSupport ./utils ../../support/FieldsIndex ../../../support/arcadeOnDemand ../../../views/support/Scheduler".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A){function p(H){return H.every(M=>"exceedslimit"!==M.statisticType)}const B=new Set,D=new w.MemCacheStorage(2E6);let C=0,F=function(){function H(K){this.capabilities={query:q.queryCapabilities};this.geometryType=K.geometryType;this.hasM=K.hasM;this.hasZ=K.hasZ;this.objectIdField=K.objectIdField;this.spatialReference=K.spatialReference;this.definitionExpression=K.definitionExpression;this.featureStore=K.featureStore;this.aggregateAdapter=K.aggregateAdapter;
this._changeHandle=this.featureStore.events.on("changed",()=>this.clearCache());this.timeInfo=K.timeInfo;K.cacheSpatialQueries&&(this._geometryQueryCache=new w.MemCache(C++ +"$$",D));this.fieldsIndex=new E(K.fields);K.scheduler&&K.priority&&(this._frameTask=K.scheduler.registerTask(K.priority))}var M=H.prototype;M.destroy=function(){this._frameTask=h.removeMaybe(this._frameTask);this.clearCache();h.destroyMaybe(this._geometryQueryCache);this._changeHandle=h.removeMaybe(this._changeHandle);h.destroyMaybe(this.fieldsIndex)};
M.clearCache=function(){this._geometryQueryCache&&this._geometryQueryCache.clear();this._timeExtent=this._allItems=null};M.executeQuery=function(){var K=b._asyncToGenerator(function*(I={},O){let Q=g.clone(I),J;try{Q=yield this._schedule(()=>u.normalizeQuery(Q,this.definitionExpression,this.spatialReference),O),Q=yield this._reschedule(()=>this._checkQuerySupport(Q),O),J=yield this._reschedule(()=>this._executeGeometryQuery(Q,O),O),J=yield this._reschedule(()=>J.executeAggregateIdsQuery(Q),O),J=yield this._reschedule(()=>
J.executeObjectIdsQuery(Q),O),J=yield this._reschedule(()=>J.executeTimeQuery(Q),O),J=yield this._reschedule(()=>J.executeAttributesQuery(Q),O)}catch(P){if(P!==u.QUERY_ENGINE_EMPTY_RESULT)throw P;J=new t.default([],null,this)}return J.createQueryResponse(Q)});return function(){return K.apply(this,arguments)}}();M.executeQueryForCount=function(){var K=b._asyncToGenerator(function*(I={},O){let Q=g.clone(I);Q.returnGeometry=!1;Q.returnCentroid=!1;Q.outSR=null;try{Q=yield this._schedule(()=>u.normalizeQuery(Q,
this.definitionExpression,this.spatialReference),O);Q=yield this._reschedule(()=>this._checkQuerySupport(Q),O);let J=yield this._reschedule(()=>this._executeGeometryQuery(Q,O),O);J=yield this._reschedule(()=>J.executeAggregateIdsQuery(Q),O);J=yield this._reschedule(()=>J.executeObjectIdsQuery(Q),O);J=yield this._reschedule(()=>J.executeTimeQuery(Q),O);J=yield this._reschedule(()=>J.executeAttributesQuery(Q),O);return J.createQueryResponseForCount(Q)}catch(J){if(J!==u.QUERY_ENGINE_EMPTY_RESULT)throw J;
return 0}});return function(){return K.apply(this,arguments)}}();M.executeQueryForExtent=function(){var K=b._asyncToGenerator(function*(I={},O){let Q=g.clone(I),J;I=Q.outSR;try{Q=yield this._schedule(()=>u.normalizeQuery(Q,this.definitionExpression,this.spatialReference),O);Q=yield this._reschedule(()=>this._checkQuerySupport(Q),O);Q.returnGeometry=!0;Q.returnCentroid=!1;Q.outSR=null;J=yield this._reschedule(()=>this._executeGeometryQuery(Q,O),O);J=yield this._reschedule(()=>J.executeAggregateIdsQuery(Q),
O);J=yield this._reschedule(()=>J.executeObjectIdsQuery(Q),O);J=yield this._reschedule(()=>J.executeTimeQuery(Q),O);J=yield this._reschedule(()=>J.executeAttributesQuery(Q),O);const P=J.size;if(!P)return{count:P,extent:null};f.set(L,f.NEGATIVE_INFINITY);this.featureStore.forEachBounds(J.items,S=>f.expandWithAABB(L,S),G);const N={xmin:L[0],ymin:L[1],xmax:L[3],ymax:L[4],spatialReference:u.cleanFromGeometryEngine(this.spatialReference)};this.hasZ&&isFinite(L[2])&&isFinite(L[5])&&(N.zmin=L[2],N.zmax=
L[5]);const R=v.project(N,J.spatialReference,I);R.spatialReference=u.cleanFromGeometryEngine(I||this.spatialReference);if(0===R.xmax-R.xmin){const S=n.getMetersPerUnitForSR(R.spatialReference);R.xmin-=S;R.xmax+=S}if(0===R.ymax-R.ymin){const S=n.getMetersPerUnitForSR(R.spatialReference);R.ymin-=S;R.ymax+=S}if(this.hasZ&&null!=R.zmin&&null!=R.zmax&&0===R.zmax-R.zmin){const S=n.getMetersPerUnitForSR(R.spatialReference);R.zmin-=S;R.zmax+=S}return{count:P,extent:R}}catch(P){if(P===u.QUERY_ENGINE_EMPTY_RESULT)return{count:0,
extent:null};throw P;}});return function(){return K.apply(this,arguments)}}();M.executeQueryForIds=function(){var K=b._asyncToGenerator(function*(I={},O){return this.executeQueryForIdSet(I,O).then(Q=>Array.from(Q))});return function(){return K.apply(this,arguments)}}();M.executeQueryForIdSet=function(){var K=b._asyncToGenerator(function*(I={},O){let Q=g.clone(I),J;Q.returnGeometry=!1;Q.returnCentroid=!1;Q.outSR=null;try{Q=yield this._schedule(()=>u.normalizeQuery(Q,this.definitionExpression,this.spatialReference),
O);Q=yield this._reschedule(()=>this._checkQuerySupport(Q),O);J=yield this._reschedule(()=>this._executeGeometryQuery(Q,O),O);J=yield this._reschedule(()=>J.executeAggregateIdsQuery(Q),O);J=yield this._reschedule(()=>J.executeObjectIdsQuery(Q),O);J=yield this._reschedule(()=>J.executeTimeQuery(Q),O);J=yield this._reschedule(()=>J.executeAttributesQuery(Q),O);const P=J.items,N=new Set;yield this._reschedule(()=>{for(const R of P)N.add(J.featureAdapter.getObjectId(R))},O);return N}catch(P){if(P===u.QUERY_ENGINE_EMPTY_RESULT)return new Set;
throw P;}});return function(){return K.apply(this,arguments)}}();M.executeQueryForSnapping=function(){var K=b._asyncToGenerator(function*(I,O){const {point:Q,distance:J,types:P}=I;if(P===t.SnappingTypes.NONE)return{candidates:[]};const N=yield this._reschedule(()=>this._checkQuerySupport(I.query),O),R=!m.equals(Q.spatialReference,this.spatialReference);R&&(yield v.checkProjectionSupport(Q.spatialReference,this.spatialReference));var S="number"===typeof J?J:J.x,T="number"===typeof J?J:J.y;S={xmin:Q.x-
S,xmax:Q.x+S,ymin:Q.y-T,ymax:Q.y+T,spatialReference:Q.spatialReference};S=R?v.project(S,this.spatialReference):S;if(!S)return{candidates:[]};T=(yield d.normalizeCentralMeridian(e.fromJSON(Q),null,{signal:O}))[0];const V=(yield d.normalizeCentralMeridian(e.fromJSON(S),null,{signal:O}))[0];if(h.isNone(T)||h.isNone(V))return{candidates:[]};let W=new t.default(this._searchFeatures(this._getQueryBBoxes(V.toJSON())),null,this);W=yield this._reschedule(()=>W.executeObjectIdsQuery(N),O);W=yield this._reschedule(()=>
W.executeTimeQuery(N),O);W=yield this._reschedule(()=>W.executeAttributesQuery(N),O);O=T.toJSON();O=R?v.project(O,this.spatialReference):O;return W.createSnappingResponse({...I,point:O,distance:R?Math.max(S.xmax-S.xmin,S.ymax-S.ymin)/2:J},Q.spatialReference)});return function(I,O){return K.apply(this,arguments)}}();M.executeQueryForLatestObservations=function(){var K=b._asyncToGenerator(function*(I={},O){if(!this.timeInfo||!this.timeInfo.trackIdField)throw new c("feature-store:unsupported-query",
"Missing timeInfo or timeInfo.trackIdField",{query:I,timeInfo:this.timeInfo});let Q=g.clone(I),J;try{Q=yield this._schedule(()=>u.normalizeQuery(Q,this.definitionExpression,this.spatialReference),O),Q=yield this._reschedule(()=>this._checkQuerySupport(Q),O),J=yield this._reschedule(()=>this._executeGeometryQuery(Q,O),O),J=yield this._reschedule(()=>J.executeAggregateIdsQuery(Q),O),J=yield this._reschedule(()=>J.executeObjectIdsQuery(Q),O),J=yield this._reschedule(()=>J.executeTimeQuery(Q),O),J=yield this._reschedule(()=>
J.executeAttributesQuery(Q),O),J=yield this._reschedule(()=>J.filterLatest(),O)}catch(P){if(P!==u.QUERY_ENGINE_EMPTY_RESULT)throw P;J=new t.default([],null,this)}return J.createQueryResponse(Q)});return function(){return K.apply(this,arguments)}}();M.executeQueryForSummaryStatistics=function(){var K=b._asyncToGenerator(function*(I={},O,Q){const {field:J,normalizationField:P,valueExpression:N}=O;return(yield this._getQueryEngineResultForStats(I,{field:J,normalizationField:P,valueExpression:N},Q)).createSummaryStatisticsResponse(I,
O)});return function(){return K.apply(this,arguments)}}();M.executeQueryForUniqueValues=function(){var K=b._asyncToGenerator(function*(I={},O,Q){const {field:J,valueExpression:P}=O;return(yield this._getQueryEngineResultForStats(I,{field:J,valueExpression:P},Q)).createUniqueValuesResponse(I,O)});return function(){return K.apply(this,arguments)}}();M.executeQueryForClassBreaks=function(){var K=b._asyncToGenerator(function*(I={},O,Q){const {field:J,normalizationField:P,valueExpression:N}=O;return(yield this._getQueryEngineResultForStats(I,
{field:J,normalizationField:P,valueExpression:N},Q)).createClassBreaksResponse(I,O)});return function(){return K.apply(this,arguments)}}();M.executeQueryForHistogram=function(){var K=b._asyncToGenerator(function*(I={},O,Q){const {field:J,normalizationField:P,valueExpression:N}=O;return(yield this._getQueryEngineResultForStats(I,{field:J,normalizationField:P,valueExpression:N},Q)).createHistogramResponse(I,O)});return function(){return K.apply(this,arguments)}}();M._schedule=function(){var K=b._asyncToGenerator(function*(I,
O){return h.isSome(this._frameTask)?this._frameTask.schedule(I,O):I(A.noBudget)});return function(I,O){return K.apply(this,arguments)}}();M._reschedule=function(){var K=b._asyncToGenerator(function*(I,O){return h.isSome(this._frameTask)?this._frameTask.reschedule(I,O):I(A.noBudget)});return function(I,O){return K.apply(this,arguments)}}();M._getAll=function(){if(!this._allItems){const K=[];this.featureStore.forEach(I=>K.push(I));this._allItems=new t.default(K,null,this)}return this._allItems};M._executeGeometryQuery=
function(){var K=b._asyncToGenerator(function*(I,O){var Q=this;const {geometry:J,outSR:P,spatialRel:N,returnGeometry:R,returnCentroid:S}=I;var T=this.featureStore.featureSpatialReference;const V=J&&T&&T!==J.spatialReference?v.project(J,T):J,W=R||S,U=m.isValid(P)&&!m.equals(this.spatialReference,P),aa=this._geometryQueryCache?U&&W?JSON.stringify({originalFilterGeometry:J,spatialRelationship:N,outSpatialReference:P}):JSON.stringify({originalFilterGeometry:J,spatialRelationship:N}):null;if(aa&&(T=this._geometryQueryCache.get(aa),
!h.isUndefined(T)))return T;T=function(){var ja=b._asyncToGenerator(function*(la){if(U&&W)return la=yield la.project(P),aa&&Q._geometryQueryCache.put(aa,la,la.size||1),la;aa&&Q._geometryQueryCache.put(aa,la,la.size||1);return la});return function(la){return ja.apply(this,arguments)}}();if(!V)return T(this._getAll());const da=this.featureAdapter;if("esriSpatialRelDisjoint"===N){I=this._searchFeatures(this._getQueryBBoxes(J));if(!I.length)return T(this._getAll());let ja,la;const ia=new Set;for(var Y of I)ia.add(da.getObjectId(Y));
yield this._reschedule(()=>{let ca=0;ja=Array(ia.size);this.featureStore.forEach(fa=>ja[ca++]=fa);la=ia},O);I=yield this._reschedule(b._asyncToGenerator(function*(){const ca=yield r.getSpatialQueryOperator(N,V,Q.geometryType,Q.hasZ,Q.hasM);return new t.default(yield Q._runSpatialFilter(ja,fa=>!la.has(da.getObjectId(fa))||ca(da.getGeometry(fa)),O),J,Q)}),O);return T(I)}Y=this._searchFeatures(this._getQueryBBoxes(J));if(!Y.length)return T=new t.default([],J,this),aa&&this._geometryQueryCache.put(aa,
T,T.size||1),T;if(this._canExecuteSoloPass(V,I))return T(new t.default(Y,J,this));const ea=yield r.getSpatialQueryOperator(N,V,this.geometryType,this.hasZ,this.hasM);I=yield this._runSpatialFilter(Y,ja=>ea(da.getGeometry(ja)),O);return T(new t.default(I,J,this))});return function(I,O){return K.apply(this,arguments)}}();M._runSpatialFilter=function(){var K=b._asyncToGenerator(function*(I,O,Q){var J=this;if(!O)return I;if(h.isNone(this._frameTask))return I.filter(S=>O(S));let P=0;const N=[],R=function(){var S=
b._asyncToGenerator(function*(T){for(;P<I.length;){const V=I[P++];O(V)&&(N.push(V),T.madeProgress());T.done&&(yield J._reschedule(W=>R(W),Q))}});return function(T){return S.apply(this,arguments)}}();return this._reschedule(S=>R(S),Q).then(()=>N)});return function(I,O,Q){return K.apply(this,arguments)}}();M._canExecuteSoloPass=function(K,I){const {geometryType:O}=this;({spatialRel:I}=I);return r.canQueryWithRBush(K)&&("esriSpatialRelEnvelopeIntersects"===I||"esriGeometryPoint"===O&&("esriSpatialRelIntersects"===
I||"esriSpatialRelContains"===I||"esriSpatialRelWithin"===I))};M._getQueryBBoxes=function(K){if(r.canQueryWithRBush(K)){if(e.isExtent(K))return[l.fromValues(K.xmin,K.ymin,K.xmax,K.ymax)];if(e.isPolygon(K))return K.rings.map(I=>l.fromValues(Math.min(I[0][0],I[2][0]),Math.min(I[0][1],I[2][1]),Math.max(I[0][0],I[2][0]),Math.max(I[0][1],I[2][1])))}return[k.getBoundsXY(l.create(),K)]};M._searchFeatures=function(K){for(const Q of K)this.featureStore.forEachInBounds(Q,J=>{B.add(J)});const I=Array(B.size);
let O=0;B.forEach(Q=>I[O++]=Q);B.clear();return I};M._checkStatisticsSupport=function(){var K=b._asyncToGenerator(function*(I,O){if(0>I.distance||null!=I.geometryPrecision||I.multipatchOption||I.pixelSize||I.relationParam||I.text||I.outStatistics||I.groupByFieldsForStatistics||I.having||I.orderByFields)throw new c("feature-store:unsupported-query","Unsupported query options",{query:I});return Promise.all([this._checkAttributesQuerySupport(I),this._checkStatisticsParamsSupport(O),r.checkSpatialQuerySupport(I,
this.geometryType,this.spatialReference),v.checkProjectionSupport(this.spatialReference,I.outSR)]).then(()=>I)});return function(I,O){return K.apply(this,arguments)}}();M._checkStatisticsParamsSupport=function(){var K=b._asyncToGenerator(function*(I){var O=[];I.valueExpression&&({arcadeUtils:O}=yield y.loadArcade(),O=O.extractFieldNames(I.valueExpression));I.field&&O.push(I.field);I.normalizationField&&O.push(I.normalizationField);if(!O.length)throw new c("feature-store:unsupported-query","params should have at least a field or valueExpression",
{params:I});z.validateFields(this.fieldsIndex,O,"params contains missing fields")});return function(I){return K.apply(this,arguments)}}();M._checkQuerySupport=function(){var K=b._asyncToGenerator(function*(I){if(0>I.distance||null!=I.geometryPrecision||I.multipatchOption||I.pixelSize||I.relationParam||I.text)throw new c("feature-store:unsupported-query","Unsupported query options",{query:I});return Promise.all([this._checkAttributesQuerySupport(I),this._checkStatisticsQuerySupport(I),r.checkSpatialQuerySupport(I,
this.geometryType,this.spatialReference),v.checkProjectionSupport(this.spatialReference,I.outSR)]).then(()=>I)});return function(I){return K.apply(this,arguments)}}();M._checkAttributesQuerySupport=function(K){const {outFields:I,orderByFields:O,returnDistinctValues:Q,outStatistics:J}=K,P=J?J.map(N=>N.outStatisticFieldName&&N.outStatisticFieldName.toLowerCase()).filter(Boolean):[];if(O&&0<O.length){const N=O.map(R=>{const S=R.toLowerCase();return-1<S.indexOf(" asc")?S.split(" asc")[0]:-1<S.indexOf(" desc")?
S.split(" desc")[0]:R}).filter(R=>-1===P.indexOf(R));z.validateFields(this.fieldsIndex,N,"orderByFields contains missing fields")}if(I&&0<I.length)z.validateFields(this.fieldsIndex,I,"outFields contains missing fields");else if(Q)throw new c("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:K});z.validateWhere(this.fieldsIndex,K.where)};M._checkStatisticsQuerySupport=function(){var K=b._asyncToGenerator(function*(I){const {outStatistics:O,groupByFieldsForStatistics:Q,
having:J}=I;var P=Q&&Q.length,N=O&&O.length;if(J){if(!P||!N)throw new c("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:I});z.validateHaving(this.fieldsIndex,J,O)}if(N&&p(O)){N=O.map(R=>R.onStatisticField).filter(Boolean);z.validateFields(this.fieldsIndex,N,"onStatisticFields contains missing fields");P&&z.validateFields(this.fieldsIndex,Q,"groupByFieldsForStatistics contains missing fields");for(const R of O){const {onStatisticField:S,
statisticType:T}=R;if(("percentile_disc"===T||"percentile_cont"===T)&&"statisticParameters"in R){if({statisticParameters:P}=R,!P)throw new c("feature-store:unsupported-query","statisticParamters should be set for percentile type",{definition:R,query:I});}else if("count"!==T&&S&&z.hasInvalidFieldType(S,this.fieldsIndex))throw new c("feature-store:unsupported-query","outStatistics contains non-numeric fields",{definition:R,query:I});}}});return function(I){return K.apply(this,arguments)}}();M._getQueryEngineResultForStats=
function(){var K=b._asyncToGenerator(function*(I={},O,Q){I=g.clone(I);let J;try{I=yield this._schedule(()=>u.normalizeQuery(I,this.definitionExpression,this.spatialReference),Q),I=yield this._reschedule(()=>this._checkStatisticsSupport(I,O),Q),J=yield this._reschedule(()=>this._executeGeometryQuery(I,Q),Q),J=yield this._reschedule(()=>J.executeAggregateIdsQuery(I),Q),J=yield this._reschedule(()=>J.executeObjectIdsQuery(I),Q),J=yield this._reschedule(()=>J.executeTimeQuery(I),Q),J=yield this._reschedule(()=>
J.executeAttributesQuery(I),Q)}catch(P){if(P!==u.QUERY_ENGINE_EMPTY_RESULT)throw P;J=new t.default([],null,this)}return J});return function(){return K.apply(this,arguments)}}();b._createClass(H,[{key:"featureAdapter",get:function(){return this.featureStore.featureAdapter}},{key:"fullExtent",get:function(){const K=this.featureStore.fullBounds;return K?{xmin:K[0],ymin:K[1],xmax:K[2],ymax:K[3],spatialReference:u.cleanFromGeometryEngine(this.spatialReference)}:null}},{key:"timeExtent",get:function(){return this.timeInfo?
this._timeExtent?this._timeExtent:this._timeExtent=x.getTimeExtent(this.timeInfo,this.featureStore):null}}]);return H}();const G=f.create(),L=f.create();a.Feature=function(H,M=null,K,I,O){this.attributes=H;this.geometry=K;this.centroid=I;this.filterFlags=O;this.groupId=-1;this.displayId=M};a.default=F;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/data/attributeSupport":function(){define(["exports","../../../core/Error","../../../core/sql/WhereClauseCache"],function(a,b,
c){function g(l,k){return l?n.get(l,k):null}function h(l,k,e,d=!0){const m=[];for(const z of k)if("*"!==z&&!l.has(z))if(d){k=w(z);try{const v=g(k,l);if(!v)throw new b("feature-store:unsupported-query","invalid SQL expression",{where:k});if(!v.isStandardized)throw new b("feature-store:unsupported-query","expression is not standard",{clause:v});h(l,v.fieldNames,"expression contains missing fields")}catch(v){if((k=v&&v.details)&&(k.clause||k.where))throw v;k&&k.missingFields?m.push(...k.missingFields):
m.push(z)}}else m.push(z);if(m.length)throw new b("feature-store:unsupported-query",e,{missingFields:m});}function w(l){return l.split(" as ")[0]}const n=new c.WhereClauseCache(50,500),f=new Set("esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeDate".split(" "));a.getAliasFromFieldName=function(l){return l.split(" as ")[1]};a.getExpressionFromFieldName=w;a.getWhereClause=g;a.hasInvalidFieldType=function(l,k){return(l=
k.get(l))?!f.has(l.type):!1};a.validateFields=h;a.validateHaving=function(l,k,e){if(!k)return!0;const d=n.get(k,l);if(!d)throw new b("feature-store:unsupported-query","invalid SQL expression",{having:k});if(!d.isAggregate)throw new b("feature-store:unsupported-query","having does not contain a valid aggregate function",{having:k});h(l,d.fieldNames,"having contains missing fields");if(!d.getExpressions().every(m=>{const {aggregateType:z,field:v}=m,q=l.has(v)&&l.get(v).name;return e.some(t=>{const {onStatisticField:r,
statisticType:x}=t;return(l.has(r)&&l.get(r).name)===q&&x.toLowerCase().trim()===z})}))throw new b("feature-store:unsupported-query","expressions in having should also exist in outStatistics",{having:k});return!0};a.validateWhere=function(l,k){if(!k)return!0;const e=n.get(k,l);if(!e)throw new b("feature-store:unsupported-query","invalid SQL expression",{where:k});if(!e.isStandardized)throw new b("feature-store:unsupported-query","where clause is not standard",{where:k});h(l,e.fieldNames,"where clause contains missing fields");
return!0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/sql/WhereClauseCache":function(){define(["exports","../ItemCache","./WhereClause"],function(a,b,c){let g=function(){function h(w,n){this._cache=new b(w);this._invalidCache=new b(n)}h.prototype.get=function(w,n){const f=`${n.uid}:${w}`,l=this._cache.get(f);if(l)return l;if(void 0!==this._invalidCache.get(f))return null;try{const k=c.WhereClause.create(w,n);this._cache.put(f,k);return k}catch{return this._invalidCache.put(f,null),
null}};return h}();a.WhereClauseCache=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/sql/WhereClause":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../has ./AggregateFunctions ./StandardizedFunctions ./WhereGrammar".split(" "),function(a,b,c,g,h,w){function n(H,M){H+="";return H.length>=M?H:Array(M-H.length+1).join("0")+H}function f(H,M,K="0",I="0",O="0",Q="0",J="",P="0",N="0"){return"+"===J||"-"===J?(H=`${n(parseInt(H,10),4)}-${n(parseInt(M,10),2)}-${n(parseInt(K,
10),2)}`,M="",10>parseFloat(Q)&&(M="0"),I=`${n(parseInt(I,10),2)}:${n(parseInt(O,10),2)}:${M+parseFloat(Q).toString()}`,J=`${J}${n(parseInt(P,10),2)}:${n(parseInt(N,10),2)}`,new Date(H+"T"+I+J)):new Date(parseInt(H,10),parseInt(M,10)-1,parseInt(K,10),parseInt(I,10),parseInt(O,10),parseFloat(Q))}function l(H){let M=y.exec(H);if(null!==M){const [,K,I,O,Q,J,P]=M;return f(K,I,O,Q,J,P)}M=A.exec(H);if(null!==M){const [,K,I,O,Q,J,P,N,R,S]=M;return f(K,I,O,Q,J,P,N,R,S)}M=p.exec(H);if(null!==M){const [,K,
I,O,Q,J,P,N,R]=M;return f(K,I,O,Q,J,"0",P,N,R)}M=B.exec(H);if(null!==M){const [,K,I,O,Q,J]=M;return f(K,I,O,Q,J)}M=E.exec(H);if(null!==M){const [,K,I,O]=M;return f(K,I,O)}throw Error("SQL Invalid Timestamp");}function k(H){H=E.exec(H);if(null===H)throw Error("SQL Invalid Date");const [,M,K,I]=H;return new Date(parseInt(M,10),parseInt(K,10)-1,parseInt(I,10))}function e(H){return Array.isArray(H)?H:[H]}function d(H){return null!==H?!0!==H:null}function m(H,M){return null!=H&&null!=M?!0===H&&!0===M:
!1===H||!1===M?!1:null}function z(H,M){return null!=H&&null!=M?!0===H||!0===M:!0===H||!0===M?!0:null}function v(H,M){if(null==H)return null;let K=!1;for(const I of M)if(null==I)K=null;else if(H===I){K=!0;break}return K}function q(H,M,K){if(null==H)return null;{let I="",O=G.Normal;for(let Q=0;Q<M.length;Q++){const J=M.charAt(Q);switch(O){case G.Normal:J===K?O=G.Escaped:I="-[]/{}()*+?.\\^$|".includes(J)?I+("\\"+J):"%"===J?I+".*":"_"===J?I+".":I+J;break;case G.Escaped:I="-[]/{}()*+?.\\^$|".includes(J)?
I+("\\"+J):I+J,O=G.Normal}}M=new RegExp("^"+I+"$","m")}return M.test(H)}function t(H){return H instanceof Date?H.valueOf():H}function r(H,M,K){if(null==M||null==K)return null;M=t(M);K=t(K);switch(H){case "\x3c\x3e":return M!==K;case "\x3d":return M===K;case "\x3e":return M>K;case "\x3c":return M<K;case "\x3e\x3d":return M>=K;case "\x3c\x3d":return M<=K}}function x(H,M,K){if(M instanceof h.SqlInterval)if(K instanceof Date)switch(H){case "+":return new Date(M.valueInMilliseconds()+K.getTime());case "-":return M.valueInMilliseconds()-
K.getTime();case "*":return M.valueInMilliseconds()*K.getTime();case "/":return M.valueInMilliseconds()/K.getTime()}else if(K instanceof h.SqlInterval)switch(H){case "+":return h.SqlInterval.createFromMilliseconds(M.valueInMilliseconds()+K.valueInMilliseconds());case "-":return h.SqlInterval.createFromMilliseconds(M.valueInMilliseconds()-K.valueInMilliseconds());case "*":return M.valueInMilliseconds()*K.valueInMilliseconds();case "/":return M.valueInMilliseconds()/K.valueInMilliseconds()}else M=M.valueInMilliseconds();
else if(K instanceof h.SqlInterval)if(M instanceof Date)switch(H){case "+":return new Date(K.valueInMilliseconds()+M.getTime());case "-":return new Date(M.getTime()-K.valueInMilliseconds());case "*":return M.getTime()*K.valueInMilliseconds();case "/":return M.getTime()/K.valueInMilliseconds()}else K=K.valueInMilliseconds();else if(M instanceof Date&&"number"===typeof K)switch(K*=864E5,M=M.getTime(),H){case "+":return new Date(M+K);case "-":return new Date(M-K);case "*":return new Date(M*K);case "/":return new Date(M/
K)}else if(K instanceof Date&&"number"===typeof M)switch(M*=864E5,K=K.getTime(),H){case "+":return new Date(M+K);case "-":return new Date(M-K);case "*":return new Date(M*K);case "/":return new Date(M/K)}switch(H){case "+":return M+K;case "-":return M-K;case "*":return M*K;case "/":return M/K}}function u(H,M,K,I){H=I.getAttribute(H,M);return null!=H&&1===K[M]?new Date(H):H}const E=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,y=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,A=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,
p=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,B=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/,D=new Set(["current_timestamp","current_date","current_time"]);let C=function(){function H(){}H.makeBool=function(M){return!0===M};H.featureValue=function(M,K,I,O){return u(M,K,I,O)};H.equalsNull=function(M){return null===M};H.applyLike=function(M,K,I){return q(M,K,I)};H.ensureArray=function(M){return e(M)};H.applyIn=function(M,K){return v(M,K)};H.currentDate=function(){const M=
new Date;M.setHours(0,0,0,0);return M};H.makeSqlInterval=function(M,K,I){return h.SqlInterval.createFromValueAndQualifer(M,K,I)};H.convertInterval=function(M){return M instanceof h.SqlInterval?M.valueInMilliseconds():M};H.currentTimestamp=function(){return new Date};H.compare=function(M,K,I){return r(M,K,I)};H.calculate=function(M,K,I){return x(M,K,I)};H.makeComparable=function(M){return t(M)};H.evaluateFunction=function(M,K){return h.evaluateFunction(M,K)};H.lookup=function(M,K){M=K[M];return void 0===
M?null:M};H.between=function(M,K){return null==M||null==K[0]||null==K[1]?null:M>=K[0]&&M<=K[1]};H.notbetween=function(M,K){return null==M||null==K[0]||null==K[1]?null:M<K[0]||M>K[1]};H.ternaryNot=function(M){return d(M)};H.ternaryAnd=function(M,K){return m(M,K)};H.ternaryOr=function(M,K){return z(M,K)};return H}(),F=function(){function H(K,I){this.fieldsIndex=I;this.datefields={};this.parameters={};this._hasDateFunctions=void 0;this.parseTree=w.WhereGrammar.parse(K);const {isStandardized:O,isAggregate:Q,
referencedFieldNames:J}=this._extractExpressionInfo(I);this.referencedFieldNames=J;this.isStandardized=O;this.isAggregate=Q}H.create=function(K,I){return new H(K,I)};var M=H.prototype;M.testSet=function(K,I=L){const O={};for(const Q of this.fieldNames)O[Q]=K.map(J=>I.getAttribute(J,Q));return!!this._evaluateNode(this.parseTree,{attributes:O},L)};M.calculateValue=function(K,I=L){K=this._evaluateNode(this.parseTree,K,I);return K instanceof h.SqlInterval?K.valueInMilliseconds()/864E5:K};M.calculateValueCompiled=
function(K,I=L){if(null!=this.parseTree._compiledVersion)return this.parseTree._compiledVersion(K,this.parameters,I,this.datefields);if(c("esri-csp-restrictions"))return this.calculateValue(K,I);this._compileMe();return this.parseTree._compiledVersion(K,this.parameters,I,this.datefields)};M.testFeature=function(K,I=L){return!!this._evaluateNode(this.parseTree,K,I)};M.testFeatureCompiled=function(K,I=L){if(null!=this.parseTree._compiledVersion)return!!this.parseTree._compiledVersion(K,this.parameters,
I,this.datefields);if(c("esri-csp-restrictions"))return this.testFeature(K,I);this._compileMe();return!!this.parseTree._compiledVersion(K,this.parameters,I,this.datefields)};M.getFunctions=function(){const K=new Set;this._visitAll(this.parseTree,I=>{"function"===I.type&&K.add(I.name.toLowerCase())});return Array.from(K)};M.getExpressions=function(){const K=new Map;this._visitAll(this.parseTree,I=>{if("function"===I.type){const O=I.name.toLowerCase();I=I.args.value[0];if("column_ref"===I.type){I=I.column;
const Q=`${O}-${I}`;K.has(Q)||K.set(Q,{aggregateType:O,field:I})}}});return[...K.values()]};M.getVariables=function(){const K=new Set;this._visitAll(this.parseTree,I=>{"param"===I.type&&K.add(I.value.toLowerCase())});return Array.from(K)};M._compileMe=function(){const K="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=(new Function("feature","lookups","attributeAdapter","datefields",K)).bind(C)};M._extractExpressionInfo=function(K){const I=
[],O=new Set;let Q=!0,J=!0;this._visitAll(this.parseTree,P=>{switch(P.type){case "column_ref":{const N=K.get(P.column);let R,S;N?R=S=N.name:(S=P.column,R=S.toLowerCase());!N||"date"!==N.type&&"esriFieldTypeDate"!==N.type||(this.datefields[N.name]=1);O.has(R)||(O.add(R),I.push(S));P.column=S;break}case "function":{const {name:N,args:R}=P;P=R.value.length;Q&&(Q=h.isStandardized(N,P));J&&(J=g.isAggregate(N,P))}}});return{referencedFieldNames:Array.from(I),isStandardized:Q,isAggregate:J}};M._visitAll=
function(K,I){if(null!=K)switch(I(K),K.type){case "when_clause":this._visitAll(K.operand,I);this._visitAll(K.value,I);break;case "case_expression":for(const O of K.clauses)this._visitAll(O,I);"simple"===K.format&&this._visitAll(K.operand,I);null!==K.else&&this._visitAll(K.else,I);break;case "expr_list":for(const O of K.value)this._visitAll(O,I);break;case "unary_expr":this._visitAll(K.expr,I);break;case "binary_expr":this._visitAll(K.left,I);this._visitAll(K.right,I);break;case "function":this._visitAll(K.args,
I)}};M.evaluateNodeToJavaScript=function(K){switch(K.type){case "interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(K.value)+", "+JSON.stringify(K.qualifier)+","+JSON.stringify(K.op)+")";case "case_expression":var I="";if("simple"===K.format){var O="this.makeComparable("+this.evaluateNodeToJavaScript(K.operand)+")";I="( ";for(let Q=0;Q<K.clauses.length;Q++)I+=" ("+O+" \x3d\x3d\x3d this.makeComparable("+this.evaluateNodeToJavaScript(K.clauses[Q].operand)+")) ? ("+this.evaluateNodeToJavaScript(K.clauses[Q].value)+
") : "}else for(I="( ",O=0;O<K.clauses.length;O++)I+=" this.makeBool("+this.evaluateNodeToJavaScript(K.clauses[O].operand)+")\x3d\x3d\x3dtrue ? ("+this.evaluateNodeToJavaScript(K.clauses[O].value)+") : ";I=null!==K.else?I+this.evaluateNodeToJavaScript(K.else):I+"null";return I+=" )";case "param":return"this.lookup("+JSON.stringify(K.value.toLowerCase())+",lookups)";case "expr_list":I="[";for(O of K.value)"["!==I&&(I+=","),I+=this.evaluateNodeToJavaScript(O);return I+="]";case "unary_expr":return"this.ternaryNot("+
this.evaluateNodeToJavaScript(K.expr)+")";case "binary_expr":switch(K.operator){case "AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(K.left)+","+this.evaluateNodeToJavaScript(K.right)+" )";case "OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(K.left)+","+this.evaluateNodeToJavaScript(K.right)+" )";case "IS":if("null"!==K.right.type)throw Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(K.left)+")";case "ISNOT":if("null"!==K.right.type)throw Error("Unsupported RHS for IS");
return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(K.left)+")))";case "IN":return"this.applyIn("+this.evaluateNodeToJavaScript(K.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(K.right)+"))";case "NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(K.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(K.right)+")))";case "BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(K.left)+","+this.evaluateNodeToJavaScript(K.right)+")";case "NOTBETWEEN":return"this.notbetween("+
this.evaluateNodeToJavaScript(K.left)+","+this.evaluateNodeToJavaScript(K.right)+")";case "LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(K.left)+","+this.evaluateNodeToJavaScript(K.right)+","+JSON.stringify(K.escape)+")";case "NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(K.left)+","+this.evaluateNodeToJavaScript(K.right)+","+JSON.stringify(K.escape)+"))";case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return"this.compare("+
JSON.stringify(K.operator)+","+this.evaluateNodeToJavaScript(K.left)+","+this.evaluateNodeToJavaScript(K.right)+")";case "*":case "-":case "+":case "/":return"this.calculate("+JSON.stringify(K.operator)+","+this.evaluateNodeToJavaScript(K.left)+","+this.evaluateNodeToJavaScript(K.right)+")"}throw Error("Not Supported Operator "+K.operator);case "null":case "bool":case "string":case "number":return JSON.stringify(K.value);case "date":return"(new Date("+k(K.value).getTime().toString()+"))";case "timestamp":return"(new Date("+
l(K.value).getTime().toString()+"))";case "current_time":return"date"===K.mode?"this.currentDate()":"this.currentTimestamp()";case "column_ref":return"this.featureValue(feature,"+JSON.stringify(K.column)+",datefields,attributeAdapter)";case "function":return"this.evaluateFunction("+JSON.stringify(K.name)+","+this.evaluateNodeToJavaScript(K.args)+")"}throw Error("Unsupported sql syntax "+K.type);};M._evaluateNode=function(K,I,O){switch(K.type){case "interval":return I=this._evaluateNode(K.value,I,
O),h.SqlInterval.createFromValueAndQualifer(I,K.qualifier,K.op);case "case_expression":if("simple"===K.format){var Q=t(this._evaluateNode(K.operand,I,O));for(var J=0;J<K.clauses.length;J++)if(Q===t(this._evaluateNode(K.clauses[J].operand,I,O)))return this._evaluateNode(K.clauses[J].value,I,O)}else for(Q=0;Q<K.clauses.length;Q++)if(!0===this._evaluateNode(K.clauses[Q].operand,I,O))return this._evaluateNode(K.clauses[Q].value,I,O);return null!==K.else?this._evaluateNode(K.else,I,O):null;case "param":return this.parameters[K.value.toLowerCase()];
case "expr_list":Q=[];for(J of K.value)Q.push(this._evaluateNode(J,I,O));return Q;case "unary_expr":return d(this._evaluateNode(K.expr,I,O));case "binary_expr":switch(K.operator){case "AND":return m(this._evaluateNode(K.left,I,O),this._evaluateNode(K.right,I,O));case "OR":return z(this._evaluateNode(K.left,I,O),this._evaluateNode(K.right,I,O));case "IS":if("null"!==K.right.type)throw Error("Unsupported RHS for IS");return null===this._evaluateNode(K.left,I,O);case "ISNOT":if("null"!==K.right.type)throw Error("Unsupported RHS for IS");
return null!==this._evaluateNode(K.left,I,O);case "IN":return Q=e(this._evaluateNode(K.right,I,O)),v(this._evaluateNode(K.left,I,O),Q);case "NOT IN":return Q=e(this._evaluateNode(K.right,I,O)),d(v(this._evaluateNode(K.left,I,O),Q));case "BETWEEN":return Q=this._evaluateNode(K.left,I,O),K=this._evaluateNode(K.right,I,O),null==Q||null==K[0]||null==K[1]?null:Q>=t(K[0])&&Q<=t(K[1]);case "NOTBETWEEN":return Q=this._evaluateNode(K.left,I,O),K=this._evaluateNode(K.right,I,O),null==Q||null==K[0]||null==K[1]?
null:Q<t(K[0])||Q>t(K[1]);case "LIKE":return q(this._evaluateNode(K.left,I,O),this._evaluateNode(K.right,I,O),K.escape);case "NOT LIKE":return d(q(this._evaluateNode(K.left,I,O),this._evaluateNode(K.right,I,O),K.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return r(K.operator,this._evaluateNode(K.left,I,O),this._evaluateNode(K.right,I,O));case "-":case "+":case "*":case "/":return x(K.operator,this._evaluateNode(K.left,I,O),this._evaluateNode(K.right,
I,O))}case "null":case "bool":case "string":case "number":return K.value;case "date":return k(K.value);case "timestamp":return l(K.value);case "current_time":return I=new Date,"date"===K.mode&&I.setHours(0,0,0,0),I;case "column_ref":return u(I,K.column,this.datefields,O);case "function":return I=this._evaluateNode(K.args,I,O),this.isAggregate?g.aggregateFunction(K.name,I):h.evaluateFunction(K.name,I)}throw Error("Unsupported sql syntax "+K.type);};b._createClass(H,[{key:"fieldNames",get:function(){return this.referencedFieldNames}},
{key:"hasDateFunctions",get:function(){if(null!=this._hasDateFunctions)return this._hasDateFunctions;this._hasDateFunctions=!1;this._visitAll(this.parseTree,K=>{"current_time"===K.type?this._hasDateFunctions=!0:"function"===K.type&&(this._hasDateFunctions=this._hasDateFunctions||D.has(K.name.toLowerCase()))});return this._hasDateFunctions}}]);return H}();var G;(function(H){H[H.Normal=0]="Normal";H[H.Escaped=1]="Escaped"})(G||(G={}));const L={getAttribute(H,M){return(H&&"object"===typeof H.attributes?
H.attributes:H)[M]}};a.WhereClause=F;a.defaultAttributeAdapter=L;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/sql/AggregateFunctions":function(){define(["exports"],function(a){function b(h){let w=0;for(let n=0;n<h.length;n++)w+=h[n];return w/h.length}function c(h){const w=b(h),n=h.length;let f=0;for(const l of h)f+=(l-w)**2;return 1<n?f/(n-1):0}const g={min:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:Math.min.apply(Math,h[0])},max:{minParams:1,maxParams:1,evaluate:h=>null==
h[0]?null:Math.max.apply(Math,h[0])},avg:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:b(h[0])},sum:{minParams:1,maxParams:1,evaluate:h=>{if(null==h[0])h=null;else{{h=h[0];let w=0;for(let n=0;n<h.length;n++)w+=h[n];h=w}}return h}},stddev:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:Math.sqrt(c(h[0]))},count:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:h[0].length},var:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:c(h[0])}};a.aggregateFunction=function(h,w){const n=g[h.toLowerCase()];
if(null==n)throw Error("Function Not Recognised");if(w.length<n.minParams||w.length>n.maxParams)throw Error(`Invalid Parameter count for call to ${h.toUpperCase()}`);return n.evaluate(w)};a.isAggregate=function(h,w){h=g[h.toLowerCase()];return null!=h&&w>=h.minParams&&w<=h.maxParams};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/sql/StandardizedFunctions":function(){define(["exports","../string"],function(a,b){let c=function(){function h(){this.op="+";this.minute=this.year=this.month=
this.hour=this.second=this.day=0}h._fixDefaults=function(w){if(null!==w.precision||null!==w.secondary)throw Error("Primary and Secondary SqlInterval qualifiers not supported");};h.createFromMilliseconds=function(w){const n=new h;n.second=w/1E3;return n};h.createFromValueAndQualifer=function(w,n,f){let l=null;const k=new h;k.op="-"===f?"-":"+";if("interval-period"===n.type){h._fixDefaults(n);if("year"===n.period||"month"===n.period)throw Error("Year-Month Intervals not supported");if(/^[0-9]{1,}$/.test(w))k[n.period]=
parseFloat(w);else throw Error("Illegal Interval");}else{h._fixDefaults(n.start);h._fixDefaults(n.end);if("year"===n.start.period||"month"===n.start.period)throw Error("Year-Month Intervals not supported");if("year"===n.end.period||"month"===n.end.period)throw Error("Year-Month Intervals not supported");switch(n.start.period){case "day":switch(n.end.period){case "hour":l=/^[0-9]{1,} [0-9]{1,}$/;if(l.test(w))k[n.start.period]=parseFloat(w.split(" ")[0]),k[n.end.period]=parseFloat(w.split(" ")[1]);
else throw Error("Illegal Interval");break;case "minute":l=/^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$/;if(l.test(w))k[n.start.period]=parseFloat(w.split(" ")[0]),w=w.split(" ")[1].split(":"),k.hour=parseFloat(w[0]),k.minute=parseFloat(w[1]);else throw Error("Illegal Interval");break;case "second":l=/^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(l.test(w))k[n.start.period]=parseFloat(w.split(" ")[0]),w=w.split(" ")[1].split(":"),k.hour=parseFloat(w[0]),k.minute=parseFloat(w[1]),k.second=
parseFloat(w[2]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;case "hour":switch(n.end.period){case "minute":l=/^[0-9]{1,}:[0-9]{1,}$/;if(l.test(w))k.hour=parseFloat(w.split(":")[0]),k.minute=parseFloat(w.split(":")[1]);else throw Error("Illegal Interval");break;case "second":l=/^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(l.test(w))w=w.split(":"),k.hour=parseFloat(w[0]),k.minute=parseFloat(w[1]),k.second=parseFloat(w[2]);else throw Error("Illegal Interval");
break;default:throw"Invalid Interval.";}break;case "minute":switch(n.end.period){case "second":l=/^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(l.test(w))w=w.split(":"),k.minute=parseFloat(w[0]),k.second=parseFloat(w[1]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;default:throw"Invalid Interval.";}}return k};h.prototype.valueInMilliseconds=function(){return("-"===this.op?-1:1)*(1E3*this.second+6E4*this.minute+36E5*this.hour+864E5*this.day+365/12*this.month*
864E5+31536E6*this.year)};return h}();const g={extract:{minParams:2,maxParams:2,evaluate:([h,w])=>{if(null==w)return null;if(w instanceof Date)switch(h.toUpperCase()){case "SECOND":return w.getSeconds();case "MINUTE":return w.getMinutes();case "HOUR":return w.getHours();case "DAY":return w.getDate();case "MONTH":return w.getMonth()+1;case "YEAR":return w.getFullYear()}throw Error("Invalid Parameter for call to EXTRACT");}},substring:{minParams:2,maxParams:3,evaluate:h=>{if(2===h.length){const [w,
n]=h;return null==w||null==n?null:w.toString().substring(n-1)}if(3===h.length){const [w,n,f]=h;return null==w||null==n||null==f?null:0>=f?"":w.toString().substring(n-1,n+f-1)}}},position:{minParams:2,maxParams:2,evaluate:([h,w])=>null==h||null==w?null:w.indexOf(h)+1},trim:{minParams:2,maxParams:3,evaluate:h=>{var w=3===h.length,n=w?h[1]:" ";w=w?h[2]:h[1];if(null==n||null==w)return null;n=`(${b.escapeRegExpString(n)})`;switch(h[0]){case "BOTH":return w.replace(new RegExp(`^${n}*|${n}*$`,"g"),"");case "LEADING":return w.replace(new RegExp(`^${n}*`,
"g"),"");case "TRAILING":return w.replace(new RegExp(`${n}*$`,"g"),"")}throw Error("Invalid Parameter for call to TRIM");}},abs:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:Math.abs(h[0])},ceiling:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:Math.ceil(h[0])},floor:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:Math.floor(h[0])},log:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:Math.log(h[0])},log10:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:Math.log(h[0])*Math.LOG10E},
sin:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:Math.sin(h[0])},cos:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:Math.cos(h[0])},tan:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:Math.tan(h[0])},asin:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:Math.asin(h[0])},acos:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:Math.acos(h[0])},atan:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:Math.atan(h[0])},sign:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:
0<h[0]?1:0>h[1]?-1:0},power:{minParams:2,maxParams:2,evaluate:h=>null==h[0]||null==h[1]?null:h[0]**h[1]},mod:{minParams:2,maxParams:2,evaluate:h=>null==h[0]||null==h[1]?null:h[0]%h[1]},round:{minParams:1,maxParams:2,evaluate:h=>{const w=h[0];h=2===h.length?10**h[1]:1;return null==w?null:Math.round(w*h)/h}},truncate:{minParams:1,maxParams:2,evaluate:h=>null==h[0]?null:1===h.length?parseInt(h[0].toFixed(0),10):parseFloat(h[0].toFixed(h[1]))},char_length:{minParams:1,maxParams:1,evaluate:h=>"string"===
typeof h[0]||h[0]instanceof String?h[0].length:0},concat:{minParams:1,maxParams:Infinity,evaluate:h=>{let w="";for(let n=0;n<h.length;n++){if(null==h[n])return null;w+=h[n].toString()}return w}},lower:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:h[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:h=>null==h[0]?null:h[0].toString().toUpperCase()}};a.SqlInterval=c;a.evaluateFunction=function(h,w){const n=g[h.toLowerCase()];if(null==n)throw Error("Function Not Recognised");
if(w.length<n.minParams||w.length>n.maxParams)throw Error(`Invalid Parameter count for call to ${h.toUpperCase()}`);return n.evaluate(w)};a.isStandardized=function(h,w){h=g[h.toLowerCase()];return null!=h&&w>=h.minParams&&w<=h.maxParams};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/sql/WhereGrammar":function(){define(["exports","../../chunks/_commonjsHelpers"],function(a,b){var c={exports:{}};(function(h){(function(w,n){h.exports&&(h.exports=n())})(b.commonjsGlobal,function(){function w(f,
l,k,e){f=Error.call(this,f);Object.setPrototypeOf&&Object.setPrototypeOf(f,w.prototype);f.expected=l;f.found=k;f.location=e;f.name="SyntaxError";return f}function n(f,l,k){k=k||" ";if(f.length>l)return f;l-=f.length;k+=k.repeat(l);return f+k.slice(0,l)}(function(f,l){function k(){this.constructor=f}k.prototype=l.prototype;f.prototype=new k})(w,Error);w.prototype.format=function(f){var l="Error: "+this.message;if(this.location){var k=null,e;for(e=0;e<f.length;e++)if(f[e].source===this.location.source){k=
f[e].text.split(/\r\n|\n|\r/g);break}f=this.location.start;e=this.location.source+":"+f.line+":"+f.column;if(k){var d=this.location.end,m=n("",f.line.toString().length);k=k[f.line-1];d=f.line===d.line?d.column:k.length+1;l+="\n --\x3e "+e+"\n"+m+" |\n"+f.line+" | "+k+"\n"+m+" | "+n("",f.column-1)+n("",d-f.column,"^")}else l+="\n at "+e}return l};w.buildMessage=function(f,l){function k(v){return v.charCodeAt(0).toString(16).toUpperCase()}function e(v){return v.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,
"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(q){return"\\x0"+k(q)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(q){return"\\x"+k(q)})}function d(v){return v.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(q){return"\\x0"+k(q)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(q){return"\\x"+k(q)})}function m(v){return z[v.type](v)}
var z={literal:function(v){return'"'+e(v.text)+'"'},class:function(v){var q=v.parts.map(function(t){return Array.isArray(t)?d(t[0])+"-"+d(t[1]):d(t)});return"["+(v.inverted?"^":"")+q+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(v){return v.description}};return"Expected "+function(v){v=v.map(m);var q,t;v.sort();if(0<v.length){for(t=q=1;q<v.length;q++)v[q-1]!==v[q]&&(v[t]=v[q],t++);v.length=t}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+
v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}(f)+" but "+(l?'"'+e(l)+'"':"end of input")+" found."};return{SyntaxError:w,parse:function(f,l){function k(Ba,Ea){return{type:"literal",text:Ba,ignoreCase:Ea}}function e(Ba,Ea,X){return{type:"class",parts:Ba,inverted:Ea,ignoreCase:X}}function d(Ba){var Ea=qc[Ba],X;if(!Ea){for(X=Ba-1;!qc[X];)X--;Ea=qc[X];for(Ea={line:Ea.line,column:Ea.column};X<Ba;)10===f.charCodeAt(X)?(Ea.line++,Ea.column=1):Ea.column++,X++;qc[Ba]=Ea}return Ea}function m(Ba,
Ea){var X=d(Ba),oa=d(Ea);return{source:cb,start:{offset:Ba,line:X.line,column:X.column},end:{offset:Ea,line:oa.line,column:oa.column}}}function z(Ba){ta<Xb||(ta>Xb&&(Xb=ta,ad=[]),ad.push(Ba))}function v(){var Ba=ta;Ha();var Ea=t();Ea!==ka?(Ha(),Ba=Ea):(ta=Ba,Ba=ka);return Ba}function q(){var Ba=ta;var Ea=t();if(Ea!==ka){Ba=[];var X=ta;var oa=Ha();var Ga=va();if(Ga!==ka){var Ma=Ha();var Sa=t();Sa!==ka?X=oa=[oa,Ga,Ma,Sa]:(ta=X,X=ka)}else ta=X,X=ka;for(;X!==ka;)Ba.push(X),X=ta,oa=Ha(),Ga=va(),Ga!==ka?
(Ma=Ha(),Sa=t(),Sa!==ka?X=oa=[oa,Ga,Ma,Sa]:(ta=X,X=ka)):(ta=X,X=ka);X={type:"expr_list"};Ea=[Ea];for(oa=0;oa<Ba.length;oa++)Ea.push(Ba[oa][3]);X.value=Ea;Ba=X}else ta=Ba,Ba=ka;return Ba}function t(){var Ba=ta;var Ea=r();if(Ea!==ka){Ba=[];var X=ta;var oa=Ha();var Ga=ca();if(Ga!==ka){var Ma=Ha();var Sa=r();Sa!==ka?X=oa=[oa,Ga,Ma,Sa]:(ta=X,X=ka)}else ta=X,X=ka;for(;X!==ka;)Ba.push(X),X=ta,oa=Ha(),Ga=ca(),Ga!==ka?(Ma=Ha(),Sa=r(),Sa!==ka?X=oa=[oa,Ga,Ma,Sa]:(ta=X,X=ka)):(ta=X,X=ka);Ba=fb(Ea,Ba)}else ta=
Ba,Ba=ka;return Ba}function r(){var Ba=ta;var Ea=x();if(Ea!==ka){Ba=[];var X=ta;var oa=Ha();var Ga=ia();if(Ga!==ka){var Ma=Ha();var Sa=x();Sa!==ka?X=oa=[oa,Ga,Ma,Sa]:(ta=X,X=ka)}else ta=X,X=ka;for(;X!==ka;)Ba.push(X),X=ta,oa=Ha(),Ga=ia(),Ga!==ka?(Ma=Ha(),Sa=x(),Sa!==ka?X=oa=[oa,Ga,Ma,Sa]:(ta=X,X=ka)):(ta=X,X=ka);Ba=fb(Ea,Ba)}else ta=Ba,Ba=ka;return Ba}function x(){var Ba=ta;var Ea=la();if(Ea===ka){Ea=ta;if(33===f.charCodeAt(ta)){var X=Oa;ta++}else X=ka,0===bb&&z(Dc);if(X!==ka){var oa=ta;bb++;if(61===
f.charCodeAt(ta)){var Ga=wa;ta++}else Ga=ka,0===bb&&z(qd);bb--;Ga===ka?oa=void 0:(ta=oa,oa=ka);oa!==ka?Ea=X=[X,oa]:(ta=Ea,Ea=ka)}else ta=Ea,Ea=ka}Ea!==ka?(X=Ha(),oa=x(),oa!==ka?Ba={type:"unary_expr",operator:"NOT",expr:oa}:(ta=Ba,Ba=ka)):(ta=Ba,Ba=ka);if(Ba===ka){Ea=ta;Ba=A();if(Ba!==ka){Ha();Ea=[];X=ta;oa=Ha();Ga=u();if(Ga!==ka){var Ma=Ha();var Sa=A();Sa!==ka?X=oa=[oa,Ga,Ma,Sa]:(ta=X,X=ka)}else ta=X,X=ka;if(X!==ka)for(;X!==ka;)Ea.push(X),X=ta,oa=Ha(),Ga=u(),Ga!==ka?(Ma=Ha(),Sa=A(),Sa!==ka?X=oa=[oa,
Ga,Ma,Sa]:(ta=X,X=ka)):(ta=X,X=ka);else Ea=ka;Ea!==ka&&(Ea={type:"arithmetic",tail:Ea});Ea===ka&&(Ea=ta,X=y(),X!==ka?(Ha(),oa=Ia(),oa!==ka?(Ha(),oa=q(),oa!==ka?(Ha(),Ga=Ja(),Ga!==ka?Ea={op:X,right:oa}:(ta=Ea,Ea=ka)):(ta=Ea,Ea=ka)):(ta=Ea,Ea=ka)):(ta=Ea,Ea=ka),Ea===ka&&(Ea=ta,X=y(),X!==ka?(Ha(),oa=Ia(),oa!==ka?(Ha(),oa=Ja(),oa!==ka?Ea={op:X,right:{type:"expr_list",value:[]}}:(ta=Ea,Ea=ka)):(ta=Ea,Ea=ka)):(ta=Ea,Ea=ka),Ea===ka&&(Ea=ta,X=y(),X!==ka?(Ha(),oa=M(),oa!==ka?Ea={op:X,right:oa}:(ta=Ea,Ea=ka)):
(ta=Ea,Ea=ka))),Ea===ka&&(Ea=ta,Ga=la(),Ga!==ka?(Ha(),X=fa(),X!==ka?(Ha(),oa=A(),oa!==ka?(Ha(),Ma=ia(),Ma!==ka?(Ha(),Ga=A(),Ga!==ka?Ea={op:"NOT"+X,right:{type:"expr_list",value:[oa,Ga]}}:(ta=Ea,Ea=ka)):(ta=Ea,Ea=ka)):(ta=Ea,Ea=ka)):(ta=Ea,Ea=ka)):(ta=Ea,Ea=ka),Ea===ka&&(Ea=ta,Ga=fa(),Ga!==ka?(Ha(),X=A(),X!==ka?(Ha(),oa=ia(),oa!==ka?(Ha(),Ma=A(),Ma!==ka?Ea={op:Ga,right:{type:"expr_list",value:[X,Ma]}}:(ta=Ea,Ea=ka)):(ta=Ea,Ea=ka)):(ta=Ea,Ea=ka)):(ta=Ea,Ea=ka)),Ea===ka&&(Ea=ta,X=ea(),X!==ka?(Ha(),oa=
la(),oa!==ka?(Ha(),oa=A(),oa!==ka?Ea={op:X+"NOT",right:oa}:(ta=Ea,Ea=ka)):(ta=Ea,Ea=ka)):(ta=Ea,Ea=ka),Ea===ka&&(Ea=ta,X=ea(),X!==ka?(Ha(),oa=A(),oa!==ka?Ea={op:X,right:oa}:(ta=Ea,Ea=ka)):(ta=Ea,Ea=ka)),Ea===ka&&(Ea=ta,X=E(),X!==ka?(Ha(),oa=P(),oa!==ka?(Ha(),Ga=ta,f.substr(ta,6).toLowerCase()===Qa?(Ma=f.substr(ta,6),ta+=6):(Ma=ka,0===bb&&z(ce)),Ma!==ka?(Ma=ta,bb++,Sa=L(),bb--,Sa===ka?Ma=void 0:(ta=Ma,Ma=ka),Ma!==ka?Ga="ESCAPE":(ta=Ga,Ga=ka)):(ta=Ga,Ga=ka),Ga!==ka?(Ha(),Ga=N(),Ga!==ka?Ea={op:X,right:oa,
escape:Ga.value}:(ta=Ea,Ea=ka)):(ta=Ea,Ea=ka)):(ta=Ea,Ea=ka)):(ta=Ea,Ea=ka),Ea===ka&&(Ea=ta,X=E(),X!==ka?(Ha(),oa=P(),oa!==ka?Ea={op:X,right:oa,escape:""}:(ta=Ea,Ea=ka)):(ta=Ea,Ea=ka))))));Ea===ka&&(Ea=null);""==Ea||void 0==Ea||null==Ea?Ea=Ba:(X=null,Ea=X="arithmetic"==Ea.type?fb(Ba,Ea.tail):db(Ea.op,Ba,Ea.right,Ea.escape))}else ta=Ea,Ea=ka;Ba=Ea}return Ba}function u(){if(f.substr(ta,2)===Aa){var Ba=Aa;ta+=2}else Ba=ka,0===bb&&z(Ec);Ba===ka&&(62===f.charCodeAt(ta)?(Ba=Na,ta++):(Ba=ka,0===bb&&z(cc)),
Ba===ka&&(f.substr(ta,2)===Ua?(Ba=Ua,ta+=2):(Ba=ka,0===bb&&z(Yc)),Ba===ka&&(f.substr(ta,2)===Ya?(Ba=Ya,ta+=2):(Ba=ka,0===bb&&z(Mb)),Ba===ka&&(60===f.charCodeAt(ta)?(Ba=ya,ta++):(Ba=ka,0===bb&&z(Ud)),Ba===ka&&(61===f.charCodeAt(ta)?(Ba=wa,ta++):(Ba=ka,0===bb&&z(qd)),Ba===ka&&(f.substr(ta,2)===La?(Ba=La,ta+=2):(Ba=ka,0===bb&&z(rd))))))));return Ba}function E(){var Ba=Ba=ta;var Ea=la();if(Ea!==ka){var X=Ha();var oa=ja();oa!==ka?Ba=Ea=[Ea,X,oa]:(ta=Ba,Ba=ka)}else ta=Ba,Ba=ka;Ba!==ka&&(Ba=Ba[0]+" "+Ba[2]);
Ba===ka&&(Ba=ja());return Ba}function y(){var Ba=Ba=ta;var Ea=la();if(Ea!==ka){var X=Ha();var oa=Y();oa!==ka?Ba=Ea=[Ea,X,oa]:(ta=Ba,Ba=ka)}else ta=Ba,Ba=ka;Ba!==ka&&(Ba=Ba[0]+" "+Ba[2]);Ba===ka&&(Ba=Y());return Ba}function A(){var Ba=ta;var Ea=B();if(Ea!==ka){Ba=[];var X=ta;var oa=Ha();var Ga=p();if(Ga!==ka){var Ma=Ha();var Sa=B();Sa!==ka?X=oa=[oa,Ga,Ma,Sa]:(ta=X,X=ka)}else ta=X,X=ka;for(;X!==ka;)Ba.push(X),X=ta,oa=Ha(),Ga=p(),Ga!==ka?(Ma=Ha(),Sa=B(),Sa!==ka?X=oa=[oa,Ga,Ma,Sa]:(ta=X,X=ka)):(ta=X,
X=ka);Ba=fb(Ea,Ba)}else ta=Ba,Ba=ka;return Ba}function p(){if(43===f.charCodeAt(ta)){var Ba=Va;ta++}else Ba=ka,0===bb&&z(Fc);Ba===ka&&(45===f.charCodeAt(ta)?(Ba=hb,ta++):(Ba=ka,0===bb&&z(Gc)));return Ba}function B(){var Ba=ta;var Ea=C();if(Ea!==ka){Ba=[];var X=ta;var oa=Ha();var Ga=D();if(Ga!==ka){var Ma=Ha();var Sa=C();Sa!==ka?X=oa=[oa,Ga,Ma,Sa]:(ta=X,X=ka)}else ta=X,X=ka;for(;X!==ka;)Ba.push(X),X=ta,oa=Ha(),Ga=D(),Ga!==ka?(Ma=Ha(),Sa=C(),Sa!==ka?X=oa=[oa,Ga,Ma,Sa]:(ta=X,X=ka)):(ta=X,X=ka);Ba=fb(Ea,
Ba)}else ta=Ba,Ba=ka;return Ba}function D(){if(42===f.charCodeAt(ta)){var Ba=kb;ta++}else Ba=ka,0===bb&&z(sd);Ba===ka&&(47===f.charCodeAt(ta)?(Ba=ib,ta++):(Ba=ka,0===bb&&z(td)));return Ba}function C(){var Ba=N();if(Ba===ka){var Ea=ta;var X=ta;var oa=V();if(oa!==ka){var Ga=W();if(Ga!==ka){var Ma=U();Ma!==ka?X=parseFloat(oa+Ga+Ma):(ta=X,X=ka)}else ta=X,X=ka}else ta=X,X=ka;X===ka&&(X=ta,oa=V(),oa!==ka?(Ga=W(),Ga!==ka?X=parseFloat(oa+Ga):(ta=X,X=ka)):(ta=X,X=ka),X===ka&&(X=ta,oa=V(),oa!==ka?(Ga=U(),Ga!==
ka?X=parseFloat(oa+Ga):(ta=X,X=ka)):(ta=X,X=ka),X===ka&&(X=ta,oa=V(),oa!==ka&&(oa=parseFloat(oa)),X=oa)));var Sa=X;if(Sa!==ka){var Wa=ta;bb++;var gb=G();bb--;gb===ka?Wa=void 0:(ta=Wa,Wa=ka);Wa!==ka?Ea={type:"number",value:Sa}:(ta=Ea,Ea=ka)}else ta=Ea,Ea=ka;Ba=Ea;if(Ba===ka){var nb=ta;var qb=ta;if(f.substr(ta,4).toLowerCase()===Za){var xb=f.substr(ta,4);ta+=4}else xb=ka,0===bb&&z(xd);if(xb!==ka){var vb=ta;bb++;var yb=L();bb--;yb===ka?vb=void 0:(ta=vb,vb=ka);vb!==ka?qb=xb=[xb,vb]:(ta=qb,qb=ka)}else ta=
qb,qb=ka;var wb=qb;wb!==ka&&(wb={type:"bool",value:!0});nb=wb;if(nb===ka){nb=ta;var Lb=ta;if(f.substr(ta,5).toLowerCase()===eb){var Zb=f.substr(ta,5);ta+=5}else Zb=ka,0===bb&&z($c);if(Zb!==ka){var Yb=ta;bb++;var Yd=L();bb--;Yd===ka?Yb=void 0:(ta=Yb,Yb=ka);Yb!==ka?Lb=Zb=[Zb,Yb]:(ta=Lb,Lb=ka)}else ta=Lb,Lb=ka;wb=Lb;wb!==ka&&(wb={type:"bool",value:!1});nb=wb}Ba=nb;if(Ba===ka){var Hc=ta;if(f.substr(ta,4).toLowerCase()===Xa){var Ad=f.substr(ta,4);ta+=4}else Ad=ka,0===bb&&z(Zc);if(Ad!==ka){var cd=ta;bb++;
var bf=L();bb--;bf===ka?cd=void 0:(ta=cd,cd=ka);cd!==ka?Hc=Ad=[Ad,cd]:(ta=Hc,Hc=ka)}else ta=Hc,Hc=ka;var ye=Hc;ye!==ka&&(ye={type:"null",value:null});Ba=ye;if(Ba===ka){var Ic=ta;var Jc=ta;if(f.substr(ta,4).toLowerCase()===Vb){var Ke=f.substr(ta,4);ta+=4}else Ke=ka,0===bb&&z(ne);if(Ke!==ka){var Bd=ta;bb++;var cf=L();bb--;cf===ka?Bd=void 0:(ta=Bd,Bd=ka);Bd!==ka?Jc="DATE":(ta=Jc,Jc=ka)}else ta=Jc,Jc=ka;if(Jc!==ka){Ha();var Le=P();Le!==ka?Ic={type:"date",value:Le.value}:(ta=Ic,Ic=ka)}else ta=Ic,Ic=ka;
Ba=Ic;if(Ba===ka){var Kc=ta;var Lc=ta;if(f.substr(ta,9).toLowerCase()===Bc){var Me=f.substr(ta,9);ta+=9}else Me=ka,0===bb&&z(me);if(Me!==ka){var Cd=ta;bb++;var df=L();bb--;df===ka?Cd=void 0:(ta=Cd,Cd=ka);Cd!==ka?Lc="TIMESTAMP":(ta=Lc,Lc=ka)}else ta=Lc,Lc=ka;if(Lc!==ka){Ha();var Ne=P();Ne!==ka?Kc={type:"timestamp",value:Ne.value}:(ta=Kc,Kc=ka)}else ta=Kc,Kc=ka;Ba=Kc;if(Ba===ka){var Ib=ta;var ze=ha();if(ze!==ka){Ha();if(45===f.charCodeAt(ta)){var hc=hb;ta++}else hc=ka,0===bb&&z(Gc);hc===ka&&(43===f.charCodeAt(ta)?
(hc=Va,ta++):(hc=ka,0===bb&&z(Fc)));if(hc!==ka){Ha();var dd=P();if(dd!==ka){Ha();var Oe=I();Oe!==ka?Ib={type:"interval",value:dd,qualifier:Oe,op:hc}:(ta=Ib,Ib=ka)}else ta=Ib,Ib=ka}else ta=Ib,Ib=ka}else ta=Ib,Ib=ka;Ib===ka&&(Ib=ta,ze=ha(),ze!==ka?(Ha(),hc=P(),hc!==ka?(Ha(),dd=I(),dd!==ka?Ib={type:"interval",value:hc,qualifier:dd,op:""}:(ta=Ib,Ib=ka)):(ta=Ib,Ib=ka)):(ta=Ib,Ib=ka));Ba=Ib}}}}}}var Bb=Ba;if(Bb===ka){var Qb=ta;var Mc=ta;if(f.substr(ta,7).toLowerCase()===Kb){var Pe=f.substr(ta,7);ta+=7}else Pe=
ka,0===bb&&z(je);if(Pe!==ka){var Dd=ta;bb++;var ef=L();bb--;ef===ka?Dd=void 0:(ta=Dd,Dd=ka);Dd!==ka?Mc="EXTRACT":(ta=Mc,Mc=ka)}else ta=Mc,Mc=ka;if(Mc!==ka){Ha();var ff=Ia();if(ff!==ka){Ha();var ac=na();ac===ka&&(ac=pa(),ac===ka&&(ac=xa(),ac===ka&&(ac=Da(),ac===ka&&(ac=ua(),ac===ka&&(ac=Fa())))));var Qe=ac;if(Qe!==ka){Ha();var gf=ba();if(gf!==ka){Ha();var Re=t();if(Re!==ka){Ha();var hf=Ja();hf!==ka?Qb={type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:Qe},Re]}}:(ta=
Qb,Qb=ka)}else ta=Qb,Qb=ka}else ta=Qb,Qb=ka}else ta=Qb,Qb=ka}else ta=Qb,Qb=ka}else ta=Qb,Qb=ka;Bb=Qb;if(Bb===ka){var Rb=ta;var Nc=ta;if(f.substr(ta,9).toLowerCase()===Ab){var Se=f.substr(ta,9);ta+=9}else Se=ka,0===bb&&z(ie);if(Se!==ka){var Ed=ta;bb++;var jf=L();bb--;jf===ka?Ed=void 0:(ta=Ed,Ed=ka);Ed!==ka?Nc="SUBSTRING":(ta=Nc,Nc=ka)}else ta=Nc,Nc=ka;if(Nc!==ka){Ha();var kf=Ia();if(kf!==ka){Ha();var Ae=t();if(Ae!==ka){Ha();var lf=ba();if(lf!==ka){Ha();var Be=t();if(Be!==ka){Ha();var ic=ta;var Oc=
ta;if(f.substr(ta,3).toLowerCase()===rb){var Te=f.substr(ta,3);ta+=3}else Te=ka,0===bb&&z(he);if(Te!==ka){var Fd=ta;bb++;var mf=L();bb--;mf===ka?Fd=void 0:(ta=Fd,Fd=ka);Fd!==ka?Oc="FOR":(ta=Oc,Oc=ka)}else ta=Oc,Oc=ka;var ed=Oc;if(ed!==ka){var nf=Ha();var Ue=t();if(Ue!==ka){var of=Ha();ic=ed=[ed,nf,Ue,of]}else ta=ic,ic=ka}else ta=ic,ic=ka;ic===ka&&(ic=null);ed=Ja();ed!==ka?Rb={type:"function",name:"substring",args:{type:"expr_list",value:ic?[Ae,Be,ic[2]]:[Ae,Be]}}:(ta=Rb,Rb=ka)}else ta=Rb,Rb=ka}else ta=
Rb,Rb=ka}else ta=Rb,Rb=ka}else ta=Rb,Rb=ka}else ta=Rb,Rb=ka;Bb=Rb;if(Bb===ka){var Cb=ta;var Ce=Z();if(Ce!==ka){Ha();var De=Ia();if(De!==ka){Ha();var jc=K();jc===ka&&(jc=null);Ha();var fd=t();if(fd!==ka){Ha();var Ee=ba();if(Ee!==ka){Ha();var Ve=t();if(Ve!==ka){Ha();var pf=Ja();pf!==ka?Cb={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==jc?"BOTH":jc},fd,Ve]}}:(ta=Cb,Cb=ka)}else ta=Cb,Cb=ka}else ta=Cb,Cb=ka}else ta=Cb,Cb=ka}else ta=Cb,Cb=ka}else ta=Cb,Cb=ka;Cb===
ka&&(Cb=ta,Ce=Z(),Ce!==ka?(Ha(),De=Ia(),De!==ka?(Ha(),jc=K(),jc===ka&&(jc=null),Ha(),fd=t(),fd!==ka?(Ha(),Ee=Ja(),Ee!==ka?Cb={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==jc?"BOTH":jc},fd]}}:(ta=Cb,Cb=ka)):(ta=Cb,Cb=ka)):(ta=Cb,Cb=ka)):(ta=Cb,Cb=ka));Bb=Cb;if(Bb===ka){var Sb=ta;var Pc=ta;if(f.substr(ta,8).toLowerCase()===Ub){var We=f.substr(ta,8);ta+=8}else We=ka,0===bb&&z(le);if(We!==ka){var Gd=ta;bb++;var qf=L();bb--;qf===ka?Gd=void 0:(ta=Gd,Gd=ka);Gd!==ka?
Pc="POSITION":(ta=Pc,Pc=ka)}else ta=Pc,Pc=ka;if(Pc!==ka){Ha();var rf=Ia();if(rf!==ka){Ha();var Xe=t();if(Xe!==ka){Ha();var sf=Y();if(sf!==ka){Ha();var Ye=t();if(Ye!==ka){Ha();var tf=Ja();tf!==ka?Sb={type:"function",name:"position",args:{type:"expr_list",value:[Xe,Ye]}}:(ta=Sb,Sb=ka)}else ta=Sb,Sb=ka}else ta=Sb,Sb=ka}else ta=Sb,Sb=ka}else ta=Sb,Sb=ka}else ta=Sb,Sb=ka;Bb=Sb;if(Bb===ka){var oc=ta;var Hd;var bc=ta;bc=Hd=F();if(bc===ka)if(bc=ta,96===f.charCodeAt(ta)?(Hd=Vc,ta++):(Hd=ka,0===bb&&z(yc)),
Hd!==ka){var Id=[];if(Xc.test(f.charAt(ta))){var kc=f.charAt(ta);ta++}else kc=ka,0===bb&&z(od);if(kc!==ka)for(;kc!==ka;)Id.push(kc),Xc.test(f.charAt(ta))?(kc=f.charAt(ta),ta++):(kc=ka,0===bb&&z(od));else Id=ka;Id!==ka?(96===f.charCodeAt(ta)?(kc=Vc,ta++):(kc=ka,0===bb&&z(yc)),kc!==ka?bc=Id.join(""):(ta=bc,bc=ka)):(ta=bc,bc=ka)}else ta=bc,bc=ka;var Ze=bc;if(Ze!==ka){Ha();var uf=Ia();if(uf!==ka){Ha();var Jd=q();Jd===ka&&(Jd=null);Ha();var vf=Ja();vf!==ka?oc={type:"function",name:Ze,args:Jd?Jd:{type:"expr_list",
value:[]}}:(ta=oc,oc=ka)}else ta=oc,oc=ka}else ta=oc,oc=ka;Bb=oc;if(Bb===ka){var dc;var Jb=ta;var Fe=qa();if(Fe!==ka){Ha();var gd=t();if(gd!==ka){Ha();var hd=[];for(dc=S();dc!==ka;)hd.push(dc),dc=S();dc=Ha();var Kd=sa();Kd!==ka?Jb={type:"case_expression",format:"simple",operand:gd,clauses:hd,else:null}:(ta=Jb,Jb=ka)}else ta=Jb,Jb=ka}else ta=Jb,Jb=ka;if(Jb===ka)if(Jb=ta,Fe=qa(),Fe!==ka)if(Ha(),gd=t(),gd!==ka){Ha();hd=[];for(dc=S();dc!==ka;)hd.push(dc),dc=S();dc=Ha();Kd=T();if(Kd!==ka){Ha();var wf=
sa();wf!==ka?Jb={type:"case_expression",format:"simple",operand:gd,clauses:hd,else:Kd.value}:(ta=Jb,Jb=ka)}else ta=Jb,Jb=ka}else ta=Jb,Jb=ka;else ta=Jb,Jb=ka;var Ge=Jb;if(Ge===ka){var ec;var Pb=ta;var He=qa();if(He!==ka){Ha();var id=[];for(ec=R();ec!==ka;)id.push(ec),ec=R();ec=Ha();var Ld=sa();Ld!==ka?Pb={type:"case_expression",format:"searched",clauses:id,else:null}:(ta=Pb,Pb=ka)}else ta=Pb,Pb=ka;if(Pb===ka)if(Pb=ta,He=qa(),He!==ka){Ha();id=[];for(ec=R();ec!==ka;)id.push(ec),ec=R();ec=Ha();Ld=T();
if(Ld!==ka){Ha();var xf=sa();xf!==ka?Pb={type:"case_expression",format:"searched",clauses:id,else:Ld.value}:(ta=Pb,Pb=ka)}else ta=Pb,Pb=ka}else ta=Pb,Pb=ka;Ge=Pb}Bb=Ge;if(Bb===ka){var Md;var Nd=ta;var $e=G();if($e!==ka){var af=[];for(Md=H();Md!==ka;)af.push(Md),Md=H();Nd=$e+af.join("")}else ta=Nd,Nd=ka;var Od=Nd;if(Od!==ka){var Ie=Od;Od=/^CURRENT_DATE$/i.test(Ie)?{type:"current_time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(Ie)?{type:"current_time",mode:"timestamp"}:{type:"column_ref",table:"",column:Ie}}Bb=
Od;if(Bb===ka&&(Bb=M(),Bb===ka)){Bb=ta;var yf=Ia();if(yf!==ka){Ha();var Je=t();if(Je!==ka){Ha();var zf=Ja();zf!==ka?(Je.paren=!0,Bb=Je):(ta=Bb,Bb=ka)}else ta=Bb,Bb=ka}else ta=Bb,Bb=ka}}}}}}}}return Bb}function F(){var Ba;var Ea=ta;var X=G();if(X!==ka){Ea=[];for(Ba=L();Ba!==ka;)Ea.push(Ba),Ba=L();Ea=X+Ea.join("")}else ta=Ea,Ea=ka;return Ea}function G(){if(Td.test(f.charAt(ta))){var Ba=f.charAt(ta);ta++}else Ba=ka,0===bb&&z(ud);return Ba}function L(){if(Sd.test(f.charAt(ta))){var Ba=f.charAt(ta);ta++}else Ba=
ka,0===bb&&z(Gb);return Ba}function H(){if(Rd.test(f.charAt(ta))){var Ba=f.charAt(ta);ta++}else Ba=ka,0===bb&&z(ld);return Ba}function M(){var Ba=ta;if(64===f.charCodeAt(ta)){var Ea=ob;ta++}else Ea=ka,0===bb&&z(Rc);if(Ea!==ka){var X=F();X!==ka?Ba=Ea=[Ea,X]:(ta=Ba,Ba=ka)}else ta=Ba,Ba=ka;Ba!==ka&&(Ba={type:"param",value:Ba[1]});return Ba}function K(){var Ba=ta;if(f.substr(ta,7).toLowerCase()===lc){var Ea=f.substr(ta,7);ta+=7}else Ea=ka,0===bb&&z(oe);if(Ea!==ka){Ea=ta;bb++;var X=L();bb--;X===ka?Ea=
void 0:(ta=Ea,Ea=ka);Ea!==ka?Ba="LEADING":(ta=Ba,Ba=ka)}else ta=Ba,Ba=ka;Ba===ka&&(Ba=ta,f.substr(ta,8).toLowerCase()===$b?(Ea=f.substr(ta,8),ta+=8):(Ea=ka,0===bb&&z(pe)),Ea!==ka?(Ea=ta,bb++,X=L(),bb--,X===ka?Ea=void 0:(ta=Ea,Ea=ka),Ea!==ka?Ba="TRAILING":(ta=Ba,Ba=ka)):(ta=Ba,Ba=ka),Ba===ka&&(Ba=ta,f.substr(ta,4).toLowerCase()===rc?(Ea=f.substr(ta,4),ta+=4):(Ea=ka,0===bb&&z(qe)),Ea!==ka?(Ea=ta,bb++,X=L(),bb--,X===ka?Ea=void 0:(ta=Ea,Ea=ka),Ea!==ka?Ba="BOTH":(ta=Ba,Ba=ka)):(ta=Ba,Ba=ka)));return Ba}
function I(){var Ba=ta;var Ea=ta;var X=O();if(X!==ka){Ha();var oa=Ia();if(oa!==ka)if(Ha(),oa=J(),oa!==ka){Ha();var Ga=Ja();Ga!==ka?Ea={type:"interval-period",period:X.value,precision:oa,secondary:null}:(ta=Ea,Ea=ka)}else ta=Ea,Ea=ka;else ta=Ea,Ea=ka}else ta=Ea,Ea=ka;Ea===ka&&(Ea=ta,X=O(),X!==ka&&(X=zc(X)),Ea=X);if(Ea!==ka)if(Ha(),X=ta,f.substr(ta,2).toLowerCase()===sc?(oa=f.substr(ta,2),ta+=2):(oa=ka,0===bb&&z(re)),oa!==ka?(oa=ta,bb++,Ga=L(),bb--,Ga===ka?oa=void 0:(ta=oa,oa=ka),oa!==ka?X="TO":(ta=
X,X=ka)):(ta=X,X=ka),X!==ka){Ha();X=ta;oa=O();oa!==ka&&(oa={type:"interval-period",period:oa.value,precision:null,secondary:null});X=oa;if(X===ka){X=ta;oa=Fa();if(oa!==ka)if(Ha(),oa=Ia(),oa!==ka)if(Ha(),oa=J(),oa!==ka)if(Ha(),Ga=va(),Ga!==ka)if(Ha(),Ga=Q(),Ga!==ka){Ha();var Ma=Ja();Ma!==ka?X=Ac(oa,Ga):(ta=X,X=ka)}else ta=X,X=ka;else ta=X,X=ka;else ta=X,X=ka;else ta=X,X=ka;else ta=X,X=ka;X===ka&&(X=ta,oa=Fa(),oa!==ka?(Ha(),oa=Ia(),oa!==ka?(Ha(),oa=J(),oa!==ka?(Ha(),Ga=Ja(),Ga!==ka?X={type:"interval-period",
period:"second",precision:oa,secondary:null}:(ta=X,X=ka)):(ta=X,X=ka)):(ta=X,X=ka)):(ta=X,X=ka),X===ka&&(X=ta,oa=Fa(),oa!==ka&&(oa={type:"interval-period",period:"second",precision:null,secondary:null}),X=oa))}X!==ka?Ba={type:"interval-qualifier",start:Ea,end:X}:(ta=Ba,Ba=ka)}else ta=Ba,Ba=ka;else ta=Ba,Ba=ka;Ba===ka&&(Ba=ta,X=O(),X!==ka?(Ha(),Ea=Ia(),Ea!==ka?(Ha(),Ea=Q(),Ea!==ka?(Ha(),oa=Ja(),oa!==ka?Ba={type:"interval-period",period:X.value,precision:Ea,secondary:null}:(ta=Ba,Ba=ka)):(ta=Ba,Ba=
ka)):(ta=Ba,Ba=ka)):(ta=Ba,Ba=ka),Ba===ka&&(Ba=ta,X=O(),X!==ka&&(X=zc(X)),Ba=X,Ba===ka&&(Ba=ta,X=Fa(),X!==ka?(Ha(),Ea=Ia(),Ea!==ka?(Ha(),Ea=J(),Ea!==ka?(Ha(),oa=va(),oa!==ka?(Ha(),X=Q(),X!==ka?(Ha(),oa=Ja(),oa!==ka?Ba=Ac(Ea,X):(ta=Ba,Ba=ka)):(ta=Ba,Ba=ka)):(ta=Ba,Ba=ka)):(ta=Ba,Ba=ka)):(ta=Ba,Ba=ka)):(ta=Ba,Ba=ka),Ba===ka&&(Ba=ta,X=Fa(),X!==ka?(Ha(),Ea=Ia(),Ea!==ka?(Ha(),Ea=Q(),Ea!==ka?(Ha(),oa=Ja(),oa!==ka?Ba={type:"interval-period",period:"second",precision:Ea,secondary:null}:(ta=Ba,Ba=ka)):(ta=
Ba,Ba=ka)):(ta=Ba,Ba=ka)):(ta=Ba,Ba=ka),Ba===ka&&(Ba=ta,X=Fa(),X!==ka&&(X={type:"interval-period",period:"second",precision:null,secondary:null}),Ba=X)))));return Ba}function O(){var Ba=ta;Ba=xa();Ba!==ka&&(Ba={type:"string",value:"day"});Ba===ka&&(Ba=ta,Ba=Da(),Ba!==ka&&(Ba={type:"string",value:"hour"}),Ba===ka&&(Ba=ta,Ba=ua(),Ba!==ka&&(Ba={type:"string",value:"minute"}),Ba===ka&&(Ba=ta,Ba=pa(),Ba!==ka&&(Ba={type:"string",value:"month"}),Ba===ka&&(Ba=ta,Ba=na(),Ba!==ka&&(Ba={type:"string",value:"year"})))));
return Ba}function Q(){var Ba=aa();Ba!==ka&&(Ba=parseFloat(Ba));return Ba}function J(){var Ba=aa();Ba!==ka&&(Ba=parseFloat(Ba));return Ba}function P(){var Ba=N();Ba===ka&&(Ba=M());return Ba}function N(){var Ba=ta;if(39===f.charCodeAt(ta)){var Ea=sb;ta++}else Ea=ka,0===bb&&z(xc);Ea===ka&&(f.substr(ta,2)===$a?(Ea=$a,ta+=2):(Ea=ka,0===bb&&z(Sc)));if(Ea!==ka){Ea=[];var X=ta;f.substr(ta,2)===za?(X=za,ta+=2):(X=ka,0===bb&&z(uc));X!==ka&&(X="'");X===ka&&(pd.test(f.charAt(ta))?(X=f.charAt(ta),ta++):(X=ka,
0===bb&&z(vd)));for(;X!==ka;)Ea.push(X),X=ta,f.substr(ta,2)===za?(X=za,ta+=2):(X=ka,0===bb&&z(uc)),X!==ka&&(X="'"),X===ka&&(pd.test(f.charAt(ta))?(X=f.charAt(ta),ta++):(X=ka,0===bb&&z(vd)));39===f.charCodeAt(ta)?(X=sb,ta++):(X=ka,0===bb&&z(xc));X!==ka?Ba={type:"string",value:Ea.join("")}:(ta=Ba,Ba=ka)}else ta=Ba,Ba=ka;return Ba}function R(){var Ba=ta;if(ma()!==ka){Ha();var Ea=t();if(Ea!==ka){Ha();var X=ra();X!==ka?(Ha(),X=t(),X!==ka?Ba={type:"when_clause",operand:Ea,value:X}:(ta=Ba,Ba=ka)):(ta=Ba,
Ba=ka)}else ta=Ba,Ba=ka}else ta=Ba,Ba=ka;return Ba}function S(){var Ba=ta;if(ma()!==ka){Ha();var Ea=t();if(Ea!==ka){Ha();var X=ra();X!==ka?(Ha(),X=t(),X!==ka?Ba={type:"when_clause",operand:Ea,value:X}:(ta=Ba,Ba=ka)):(ta=Ba,Ba=ka)}else ta=Ba,Ba=ka}else ta=Ba,Ba=ka;return Ba}function T(){var Ba=ta;var Ea=ta;if(f.substr(ta,4).toLowerCase()===Pd){var X=f.substr(ta,4);ta+=4}else X=ka,0===bb&&z(vc);if(X!==ka){X=ta;bb++;var oa=L();bb--;oa===ka?X=void 0:(ta=X,X=ka);X!==ka?Ea="ELSE":(ta=Ea,Ea=ka)}else ta=
Ea,Ea=ka;Ea!==ka?(Ha(),Ea=t(),Ea!==ka?Ba={type:"else_clause",value:Ea}:(ta=Ba,Ba=ka)):(ta=Ba,Ba=ka);return Ba}function V(){var Ba=aa();if(Ba===ka){Ba=ta;if(45===f.charCodeAt(ta)){var Ea=hb;ta++}else Ea=ka,0===bb&&z(Gc);Ea===ka&&(43===f.charCodeAt(ta)?(Ea=Va,ta++):(Ea=ka,0===bb&&z(Fc)));if(Ea!==ka){var X=aa();X!==ka?Ba=Ea[0]+X:(ta=Ba,Ba=ka)}else ta=Ba,Ba=ka}return Ba}function W(){var Ba=ta;if(46===f.charCodeAt(ta)){var Ea=Pa;ta++}else Ea=ka,0===bb&&z(Zd);Ea!==ka?(Ba=aa(),Ba===ka&&(Ba=null),Ba="."+
(null!=Ba?Ba:"")):(ta=Ba,Ba=ka);return Ba}function U(){var Ba;var Ea=Ba=ta;if(Tb.test(f.charAt(ta))){var X=f.charAt(ta);ta++}else X=ka,0===bb&&z(Db);X!==ka?(pc.test(f.charAt(ta))?(Ea=f.charAt(ta),ta++):(Ea=ka,0===bb&&z(wd)),Ea===ka&&(Ea=null),Ea="e"+(null===Ea?"":Ea)):(ta=Ea,Ea=ka);Ea!==ka?(X=aa(),X!==ka?Ba=Ea+X:(ta=Ba,Ba=ka)):(ta=Ba,Ba=ka);return Ba}function aa(){var Ba=[];var Ea=da();if(Ea!==ka)for(;Ea!==ka;)Ba.push(Ea),Ea=da();else Ba=ka;Ba!==ka&&(Ba=Ba.join(""));return Ba}function da(){if(Nb.test(f.charAt(ta))){var Ba=
f.charAt(ta);ta++}else Ba=ka,0===bb&&z($d);return Ba}function Y(){var Ba=ta;if(f.substr(ta,2).toLowerCase()===lb){var Ea=f.substr(ta,2);ta+=2}else Ea=ka,0===bb&&z(ae);if(Ea!==ka){Ea=ta;bb++;var X=L();bb--;X===ka?Ea=void 0:(ta=Ea,Ea=ka);Ea!==ka?Ba="IN":(ta=Ba,Ba=ka)}else ta=Ba,Ba=ka;return Ba}function ea(){var Ba=ta;if(f.substr(ta,2).toLowerCase()===tb){var Ea=f.substr(ta,2);ta+=2}else Ea=ka,0===bb&&z(be);if(Ea!==ka){Ea=ta;bb++;var X=L();bb--;X===ka?Ea=void 0:(ta=Ea,Ea=ka);Ea!==ka?Ba="IS":(ta=Ba,Ba=
ka)}else ta=Ba,Ba=ka;return Ba}function ja(){var Ba=ta;if(f.substr(ta,4).toLowerCase()===mb){var Ea=f.substr(ta,4);ta+=4}else Ea=ka,0===bb&&z(yd);if(Ea!==ka){Ea=ta;bb++;var X=L();bb--;X===ka?Ea=void 0:(ta=Ea,Ea=ka);Ea!==ka?Ba="LIKE":(ta=Ba,Ba=ka)}else ta=Ba,Ba=ka;return Ba}function la(){var Ba=ta;if(f.substr(ta,3).toLowerCase()===Ra){var Ea=f.substr(ta,3);ta+=3}else Ea=ka,0===bb&&z(de);if(Ea!==ka){Ea=ta;bb++;var X=L();bb--;X===ka?Ea=void 0:(ta=Ea,Ea=ka);Ea!==ka?Ba="NOT":(ta=Ba,Ba=ka)}else ta=Ba,Ba=
ka;return Ba}function ia(){var Ba=ta;if(f.substr(ta,3).toLowerCase()===ab){var Ea=f.substr(ta,3);ta+=3}else Ea=ka,0===bb&&z(ee);if(Ea!==ka){Ea=ta;bb++;var X=L();bb--;X===ka?Ea=void 0:(ta=Ea,Ea=ka);Ea!==ka?Ba="AND":(ta=Ba,Ba=ka)}else ta=Ba,Ba=ka;return Ba}function ca(){var Ba=ta;if(f.substr(ta,2).toLowerCase()===jb){var Ea=f.substr(ta,2);ta+=2}else Ea=ka,0===bb&&z(Vd);if(Ea!==ka){Ea=ta;bb++;var X=L();bb--;X===ka?Ea=void 0:(ta=Ea,Ea=ka);Ea!==ka?Ba="OR":(ta=Ba,Ba=ka)}else ta=Ba,Ba=ka;return Ba}function fa(){var Ba=
ta;if(f.substr(ta,7).toLowerCase()===pb){var Ea=f.substr(ta,7);ta+=7}else Ea=ka,0===bb&&z(fe);if(Ea!==ka){Ea=ta;bb++;var X=L();bb--;X===ka?Ea=void 0:(ta=Ea,Ea=ka);Ea!==ka?Ba="BETWEEN":(ta=Ba,Ba=ka)}else ta=Ba,Ba=ka;return Ba}function ba(){var Ba=ta;if(f.substr(ta,4).toLowerCase()===ub){var Ea=f.substr(ta,4);ta+=4}else Ea=ka,0===bb&&z(ge);if(Ea!==ka){Ea=ta;bb++;var X=L();bb--;X===ka?Ea=void 0:(ta=Ea,Ea=ka);Ea!==ka?Ba="FROM":(ta=Ba,Ba=ka)}else ta=Ba,Ba=ka;return Ba}function Z(){var Ba=ta;if(f.substr(ta,
4).toLowerCase()===Ob){var Ea=f.substr(ta,4);ta+=4}else Ea=ka,0===bb&&z(ke);if(Ea!==ka){Ea=ta;bb++;var X=L();bb--;X===ka?Ea=void 0:(ta=Ea,Ea=ka);Ea!==ka?Ba="TRIM":(ta=Ba,Ba=ka)}else ta=Ba,Ba=ka;return Ba}function ha(){var Ba=ta;if(f.substr(ta,8).toLowerCase()===mc){var Ea=f.substr(ta,8);ta+=8}else Ea=ka,0===bb&&z(se);if(Ea!==ka){Ea=ta;bb++;var X=L();bb--;X===ka?Ea=void 0:(ta=Ea,Ea=ka);Ea!==ka?Ba="INTERVAL":(ta=Ba,Ba=ka)}else ta=Ba,Ba=ka;return Ba}function na(){var Ba=ta;if(f.substr(ta,4).toLowerCase()===
nc){var Ea=f.substr(ta,4);ta+=4}else Ea=ka,0===bb&&z(te);if(Ea!==ka){Ea=ta;bb++;var X=L();bb--;X===ka?Ea=void 0:(ta=Ea,Ea=ka);Ea!==ka?Ba="YEAR":(ta=Ba,Ba=ka)}else ta=Ba,Ba=ka;return Ba}function pa(){var Ba=ta;if(f.substr(ta,5).toLowerCase()===fc){var Ea=f.substr(ta,5);ta+=5}else Ea=ka,0===bb&&z(ue);if(Ea!==ka){Ea=ta;bb++;var X=L();bb--;X===ka?Ea=void 0:(ta=Ea,Ea=ka);Ea!==ka?Ba="MONTH":(ta=Ba,Ba=ka)}else ta=Ba,Ba=ka;return Ba}function xa(){var Ba=ta;if(f.substr(ta,3).toLowerCase()===tc){var Ea=f.substr(ta,
3);ta+=3}else Ea=ka,0===bb&&z(ve);if(Ea!==ka){Ea=ta;bb++;var X=L();bb--;X===ka?Ea=void 0:(ta=Ea,Ea=ka);Ea!==ka?Ba="DAY":(ta=Ba,Ba=ka)}else ta=Ba,Ba=ka;return Ba}function Da(){var Ba=ta;if(f.substr(ta,4).toLowerCase()===Uc){var Ea=f.substr(ta,4);ta+=4}else Ea=ka,0===bb&&z(zd);if(Ea!==ka){Ea=ta;bb++;var X=L();bb--;X===ka?Ea=void 0:(ta=Ea,Ea=ka);Ea!==ka?Ba="HOUR":(ta=Ba,Ba=ka)}else ta=Ba,Ba=ka;return Ba}function ua(){var Ba=ta;if(f.substr(ta,6).toLowerCase()===Hb){var Ea=f.substr(ta,6);ta+=6}else Ea=
ka,0===bb&&z(we);if(Ea!==ka){Ea=ta;bb++;var X=L();bb--;X===ka?Ea=void 0:(ta=Ea,Ea=ka);Ea!==ka?Ba="MINUTE":(ta=Ba,Ba=ka)}else ta=Ba,Ba=ka;return Ba}function Fa(){var Ba=ta;if(f.substr(ta,6).toLowerCase()===Cc){var Ea=f.substr(ta,6);ta+=6}else Ea=ka,0===bb&&z(xe);if(Ea!==ka){Ea=ta;bb++;var X=L();bb--;X===ka?Ea=void 0:(ta=Ea,Ea=ka);Ea!==ka?Ba="SECOND":(ta=Ba,Ba=ka)}else ta=Ba,Ba=ka;return Ba}function qa(){var Ba=ta;if(f.substr(ta,4).toLowerCase()===Fb){var Ea=f.substr(ta,4);ta+=4}else Ea=ka,0===bb&&
z(gc);if(Ea!==ka){Ea=ta;bb++;var X=L();bb--;X===ka?Ea=void 0:(ta=Ea,Ea=ka);Ea!==ka?Ba="CASE":(ta=Ba,Ba=ka)}else ta=Ba,Ba=ka;return Ba}function sa(){var Ba=ta;if(f.substr(ta,3).toLowerCase()===Wb){var Ea=f.substr(ta,3);ta+=3}else Ea=ka,0===bb&&z(Wd);if(Ea!==ka){Ea=ta;bb++;var X=L();bb--;X===ka?Ea=void 0:(ta=Ea,Ea=ka);Ea!==ka?Ba="END":(ta=Ba,Ba=ka)}else ta=Ba,Ba=ka;return Ba}function ma(){var Ba=ta;if(f.substr(ta,4).toLowerCase()===Qc){var Ea=f.substr(ta,4);ta+=4}else Ea=ka,0===bb&&z(zb);if(Ea!==ka){Ea=
ta;bb++;var X=L();bb--;X===ka?Ea=void 0:(ta=Ea,Ea=ka);Ea!==ka?Ba="WHEN":(ta=Ba,Ba=ka)}else ta=Ba,Ba=ka;return Ba}function ra(){var Ba=ta;if(f.substr(ta,4).toLowerCase()===wc){var Ea=f.substr(ta,4);ta+=4}else Ea=ka,0===bb&&z(Eb);if(Ea!==ka){Ea=ta;bb++;var X=L();bb--;X===ka?Ea=void 0:(ta=Ea,Ea=ka);Ea!==ka?Ba="THEN":(ta=Ba,Ba=ka)}else ta=Ba,Ba=ka;return Ba}function va(){if(44===f.charCodeAt(ta)){var Ba=kd;ta++}else Ba=ka,0===bb&&z(Tc);return Ba}function Ia(){if(40===f.charCodeAt(ta)){var Ba=jd;ta++}else Ba=
ka,0===bb&&z(md);return Ba}function Ja(){if(41===f.charCodeAt(ta)){var Ba=Qd;ta++}else Ba=ka,0===bb&&z(Xd);return Ba}function Ha(){var Ba;var Ea=[];for(Ba=Ta();Ba!==ka;)Ea.push(Ba),Ba=Ta();return Ea}function Ta(){if(Wc.test(f.charAt(ta))){var Ba=f.charAt(ta);ta++}else Ba=ka,0===bb&&z(nd);return Ba}function db(Ba,Ea,X,oa){Ba={type:"binary_expr",operator:Ba,left:Ea,right:X};void 0!==oa&&(Ba.escape=oa);return Ba}function fb(Ba,Ea){for(var X=0;X<Ea.length;X++)Ba=db(Ea[X][1],Ba,Ea[X][3]);return Ba}l=void 0!==
l?l:{};var ka={},cb=l.grammarSource,Ca={start:v},Ka=v,Oa="!",wa="\x3d",Aa="\x3e\x3d",Na="\x3e",Ua="\x3c\x3d",Ya="\x3c\x3e",ya="\x3c",La="!\x3d",Va="+",hb="-",kb="*",ib="/",ob="@",sb="'",$a="N'",za="''",Pa=".",Xa="null",Za="true",eb="false",lb="in",tb="is",mb="like",Qa="escape",Ra="not",ab="and",jb="or",pb="between",ub="from",rb="for",Ab="substring",Kb="extract",Ob="trim",Ub="position",Bc="timestamp",Vb="date",lc="leading",$b="trailing",rc="both",sc="to",mc="interval",nc="year",fc="month",tc="day",
Uc="hour",Hb="minute",Cc="second",Fb="case",Wb="end",Qc="when",wc="then",Pd="else",kd=",",jd="(",Qd=")",Vc="`",Td=/^[A-Za-z_\x80-\uFFFF]/,Sd=/^[A-Za-z0-9_]/,Rd=/^[A-Za-z0-9_.\x80-\uFFFF]/,pd=/^[^']/,Nb=/^[0-9]/,Tb=/^[eE]/,pc=/^[+\-]/,Wc=/^[ \t\n\r]/,Xc=/^[^`]/,Dc=k("!",!1),qd=k("\x3d",!1),Ec=k("\x3e\x3d",!1),cc=k("\x3e",!1),Yc=k("\x3c\x3d",!1),Mb=k("\x3c\x3e",!1),Ud=k("\x3c",!1),rd=k("!\x3d",!1),Fc=k("+",!1),Gc=k("-",!1),sd=k("*",!1),td=k("/",!1),ud=e([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],
!1,!1),Gb=e([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),ld=e([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),Rc=k("@",!1),xc=k("'",!1),Sc=k("N'",!1),uc=k("''",!1),vd=e(["'"],!0,!1),Zd=k(".",!1),$d=e([["0","9"]],!1,!1),Db=e(["e","E"],!1,!1),wd=e(["+","-"],!1,!1),Zc=k("NULL",!0),xd=k("TRUE",!0),$c=k("FALSE",!0),ae=k("IN",!0),be=k("IS",!0),yd=k("LIKE",!0),ce=k("ESCAPE",!0),de=k("NOT",!0),ee=k("AND",!0),Vd=k("OR",!0),fe=k("BETWEEN",!0),ge=k("FROM",!0),he=k("FOR",!0),ie=k("SUBSTRING",
!0),je=k("EXTRACT",!0),ke=k("TRIM",!0),le=k("POSITION",!0),me=k("TIMESTAMP",!0),ne=k("DATE",!0),oe=k("LEADING",!0),pe=k("TRAILING",!0),qe=k("BOTH",!0),re=k("TO",!0),se=k("INTERVAL",!0),te=k("YEAR",!0),ue=k("MONTH",!0),ve=k("DAY",!0),zd=k("HOUR",!0),we=k("MINUTE",!0),xe=k("SECOND",!0),gc=k("CASE",!0),Wd=k("END",!0),zb=k("WHEN",!0),Eb=k("THEN",!0),vc=k("ELSE",!0),Tc=k(",",!1),md=k("(",!1),Xd=k(")",!1),nd=e([" ","\t","\n","\r"],!1,!1),yc=k("`",!1),od=e(["`"],!0,!1),zc=function(Ba){return{type:"interval-period",
period:Ba.value,precision:null,secondary:null}},Ac=function(Ba,Ea){return{type:"interval-period",period:"second",precision:Ba,secondary:Ea}},ta=0,qc=[{line:1,column:1}],Xb=0,ad=[],bb=0;if("startRule"in l){if(!(l.startRule in Ca))throw Error("Can't start parsing from rule \""+l.startRule+'".');Ka=Ca[l.startRule]}var bd=Ka();if(bd!==ka&&ta===f.length)return bd;bd!==ka&&ta<f.length&&z({type:"end"});throw function(Ba,Ea,X){return new w(w.buildMessage(Ba,Ea),Ba,Ea,X)}(ad,Xb<f.length?f.charAt(Xb):null,
Xb<f.length?m(Xb,Xb+1):m(Xb,Xb));}}})})(c);let g=function(){function h(){}h.parse=function(w){return c.exports.parse(w)};return h}();a.WhereGrammar=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/data/projectionSupport":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../geometry/projection ../../../geometry/geometryAdapters/json ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),
function(a,b,c,g,h,w,n){function f(q,t){if(!t)return null;if("x"in t){var r={x:0,y:0};[r.x,r.y]=q(t.x,t.y,d);null!=t.z&&(r.z=t.z);null!=t.m&&(r.m=t.m);return r}if("xmin"in t)return r={xmin:0,ymin:0,xmax:0,ymax:0},[r.xmin,r.ymin]=q(t.xmin,t.ymin,d),[r.xmax,r.ymax]=q(t.xmax,t.ymax,d),t.hasZ&&(r.zmin=t.zmin,r.zmax=t.zmax,r.hasZ=!0),t.hasM&&(r.mmin=t.mmin,r.mmax=t.mmax,r.hasM=!0),r;if("rings"in t)return{rings:l(t.rings,q),hasM:t.hasM,hasZ:t.hasZ};if("paths"in t)return{paths:l(t.paths,q),hasM:t.hasM,hasZ:t.hasZ};
if("points"in t)return{points:k(t.points,q),hasM:t.hasM,hasZ:t.hasZ}}function l(q,t){const r=[];for(const x of q)r.push(k(x,t));return r}function k(q,t){const r=[];for(const x of q)q=t(x[0],x[1],[0,0]),r.push(q),2<x.length&&q.push(x[2]),3<x.length&&q.push(x[3]);return r}function e(){e=b._asyncToGenerator(function*(q,t){t&&(q=Array.isArray(q)?q.map(r=>c.isSome(r.geometry)&&r.geometry.spatialReference):[q],yield g.initializeProjection(q.map(r=>({source:r,dest:t}))))});return e.apply(this,arguments)}
const d=[0,0],m=f.bind(null,n.lngLatToXY),z=f.bind(null,n.xyToLngLat),v=new (function(){function q(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}var t=q.prototype;t.push=function(){var r=b._asyncToGenerator(function*(x,u,E){if(!(x&&x.length&&u&&E)||w.equals(u,E))return x;const y={geometries:x,inSpatialReference:u,outSpatialReference:E,resolve:null};this._jobs.push(y);return new Promise(A=>{y.resolve=A;null===this._timer&&(this._timer=setTimeout(this._process,10))})});return function(x,
u,E){return r.apply(this,arguments)}}();t._process=function(){this._timer=null;const r=this._jobs.shift();if(r){var {geometries:x,inSpatialReference:u,outSpatialReference:E,resolve:y}=r;n.canProject(u,E)?w.isWebMercator(E)?y(x.map(m)):y(x.map(z)):y(g.projectMany(h.jsonAdapter,x,u,E,null));0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}};return q}());a.checkProjectionSupport=function(q,t){return e.apply(this,arguments)};a.project=function(q,t,r){if(!q)return q;r||(r=t,t=q.spatialReference);
return w.isValid(t)&&w.isValid(r)&&!w.equals(t,r)?n.canProject(t,r)?(q=w.isWebMercator(r)?m(q):z(q),q.spatialReference=r,q):g.projectMany(h.jsonAdapter,[q],t,r,null)[0]:q};a.projectMany=function(q,t,r){return v.push(q,t,r)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/geometry/geometryAdapters/json":function(){define(["exports"],function(a){let b=function(n,f,l){this.x=n;this.y=f;this.spatialReference=l;this.m=this.z=void 0},c=function(n,f,l,k){this.rings=n;this.spatialReference=f;this.hasM=
this.hasZ=void 0;l&&(this.hasZ=l);k&&(this.hasM=k)},g=function(n,f,l,k){this.paths=n;this.spatialReference=f;this.hasM=this.hasZ=void 0;l&&(this.hasZ=l);k&&(this.hasM=k)},h=function(n,f,l,k){this.points=n;this.spatialReference=f;this.hasM=this.hasZ=void 0;l&&(this.hasZ=l);k&&(this.hasM=k)},w=function(n,f,l,k,e){this.xmin=n;this.ymin=f;this.xmax=l;this.ymax=k;this.spatialReference=e;this.mmax=this.mmin=this.zmax=this.zmin=void 0};a.jsonAdapter={convertToGEGeometry:function(n,f){return null==f?null:
n.convertJSONToGeometry(f)},exportPoint:function(n,f,l){l=new b(n.getPointX(f),n.getPointY(f),l);const k=n.hasZ(f),e=n.hasM(f);k&&(l.z=n.getPointZ(f));e&&(l.m=n.getPointM(f));return l},exportPolygon:function(n,f,l){return new c(n.exportPaths(f),l,n.hasZ(f),n.hasM(f))},exportPolyline:function(n,f,l){return new g(n.exportPaths(f),l,n.hasZ(f),n.hasM(f))},exportMultipoint:function(n,f,l){return new h(n.exportPoints(f),l,n.hasZ(f),n.hasM(f))},exportExtent:function(n,f,l){var k=n.hasZ(f);const e=n.hasM(f);
l=new w(n.getXMin(f),n.getYMin(f),n.getXMax(f),n.getYMax(f),l);k&&(k=n.getZExtent(f),l.zmin=k.vmin,l.zmax=k.vmax);e&&(n=n.getMExtent(f),l.mmin=n.vmin,l.mmax=n.vmax);return l}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/data/QueryEngineResult":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../geometry/support/centroid ../../../geometry/support/extentUtils ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ./AttributesBuilder ./attributeSupport ./projectionSupport ./timeSupport ./utils ../../support/fieldUtils ../../../statistics/utils ../../../support/arcadeOnDemand".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t){function r(E,y,A,p,B,D){B-=A;D-=p;E=Math.min(1,Math.max(0,((E-A)*B+(y-p)*D)/(B*B+D*D)));return{x:A+B*E,y:p+D*E}}function x(E,y){return E?y?4:3:y?3:2}let u=function(){function E(A,p,B){this.items=A;this.queryGeometry=p;this.definitionExpression=B.definitionExpression;this.geometryType=B.geometryType;this.hasM=B.hasM;this.hasZ=B.hasZ;this.objectIdField=B.objectIdField;this.spatialReference=B.spatialReference;this.fieldsIndex=B.fieldsIndex;this.timeInfo=B.timeInfo;
this.featureAdapter=B.featureAdapter;this.aggregateAdapter=B.aggregateAdapter}var y=E.prototype;y.createQueryResponseForCount=function(A){const p=new k(A,this.featureAdapter,this.fieldsIndex);if(!A.outStatistics)return p.countDistinctValues(this.items);const {groupByFieldsForStatistics:B,having:D}=A;if(null==B||!B.length)return 1;const C=new Map,F=new Map,G=new Set;A=A.outStatistics;for(const H of A){({statisticType:A}=H);A="exceedslimit"!==A?H.onStatisticField:void 0;if(!F.has(A)){var L=[];for(const M of B){const K=
this._getAttributeValues(p,M,C);L.push(K)}F.set(A,this._calculateUniqueValues(L,p.returnDistinctValues))}A=F.get(A);for(const M in A){const {data:K,items:I}=A[M];L=K.join(",");D&&!p.validateItems(I,D)||G.add(L)}}return G.size};y.createQueryResponse=function(){var A=c._asyncToGenerator(function*(p){let B;B=p.outStatistics?p.outStatistics.some(D=>"exceedslimit"===D.statisticType)?this._createExceedsLimitQueryResponse(p):yield this._createStatisticsQueryResponse(p):this._createFeatureQueryResponse(p);
p.returnQueryGeometry&&(f.isValid(p.outSR)&&!f.equals(this.queryGeometry.spatialReference,p.outSR)?B.queryGeometry=z.cleanFromGeometryEngine({spatialReference:p.outSR,...d.project(this.queryGeometry,this.queryGeometry.spatialReference,p.outSR)}):B.queryGeometry=z.cleanFromGeometryEngine({spatialReference:p.outSR,...this.queryGeometry}));return B});return function(p){return A.apply(this,arguments)}}();y.createSnappingResponse=function(A,p){const B=this.featureAdapter,D=x(this.hasZ,this.hasM),{x:C,
y:F}=A.point,G="number"===typeof A.distance?A.distance:A.distance.x,L="number"===typeof A.distance?A.distance:A.distance.y,H={candidates:[]},M="esriGeometryPolygon"===this.geometryType;p=this._getPointCreator(A.point,this.spatialReference,p);for(const R of this.items){var K=B.getGeometry(R);if(g.isNone(K))continue;const {coords:S,lengths:T}=K;if(A.types&b.SnappingTypes.EDGE){K=0;for(var I=0;I<T.length;I++){var O=T[I];for(var Q=0;Q<O;Q++,K+=D){var J=S[K],P=S[K+1];if(Q!==O-1){const V=S[K+D],W=S[K+D+
1],{x:U,y:aa}=r(C,F,J,P,V,W);var N=(C-U)/G;const da=(F-aa)/L;N=N*N+da*da;1>=N&&H.candidates.push({type:"edge",objectId:B.getObjectId(R),distance:Math.sqrt(N),target:p(U,aa),start:p(J,P),end:p(V,W)})}}}}if(A.types&b.SnappingTypes.VERTEX)for(K=M?S.length-D:S.length,I=0;I<K;I+=D)O=S[I],Q=S[I+1],J=(C-O)/G,P=(F-Q)/L,J=J*J+P*P,1>=J&&H.candidates.push({type:"vertex",objectId:B.getObjectId(R),distance:Math.sqrt(J),target:p(O,Q)})}H.candidates.sort((R,S)=>R.distance-S.distance);return H};y._getPointCreator=
function(A,p,B){const D=g.isSome(B)&&!f.equals(p,B)?C=>d.project(C,p,B):C=>C;return null!=A.z&&null!=A.m?(C,F)=>D({x:C,y:F,z:A.z,m:A.m}):null!=A.z?(C,F)=>D({x:C,y:F,z:A.z}):null!=A.m?(C,F)=>D({x:C,y:F,m:A.m}):(C,F)=>D({x:C,y:F})};y.executeAttributesQuery=function(A){var p=e.getWhereClause(A.where,this.fieldsIndex);if(!p)return Promise.resolve(this);if(p.isStandardized){let B=0;const D=[];for(const C of this.items)p.testFeature(C,this.featureAdapter)&&(D[B++]=C);p=new E(D,this.queryGeometry,this);
p.definitionExpression=A.where;return Promise.resolve(p)}return Promise.reject(new TypeError("Where clause is not standardized"))};y.executeAggregateIdsQuery=function(A){if(!A.aggregateIds||!A.aggregateIds.length||g.isNone(this.aggregateAdapter))return Promise.resolve(this);const p=new Set;for(const D of A.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(D).forEach(C=>p.add(C));const B=this.featureAdapter.getObjectId;return Promise.resolve(new E(this.items.filter(D=>p.has(B(D))),this.queryGeometry,
this))};y.executeObjectIdsQuery=function(A){if(!A.objectIds||!A.objectIds.length)return Promise.resolve(this);const p=new Set(A.objectIds),B=this.featureAdapter.getObjectId;return Promise.resolve(new E(this.items.filter(D=>p.has(B(D))),this.queryGeometry,this))};y.executeTimeQuery=function(A){A=m.getTimeOperator(this.timeInfo,A.timeExtent,this.featureAdapter);if(!g.isSome(A))return Promise.resolve(this);A=this.items.filter(A);return Promise.resolve(new E(A,this.queryGeometry,this))};y.filterLatest=
function(){const {trackIdField:A,startTimeField:p,endTimeField:B}=this.timeInfo;var D=B||p;const C=new Map,F=this.featureAdapter.getAttribute;for(const G of this.items){const L=F(G,A),H=F(G,D),M=C.get(L);(!M||H>F(M,D))&&C.set(L,G)}D=Array.from(C.values());return Promise.resolve(new E(D,this.queryGeometry,this))};y.project=function(){var A=c._asyncToGenerator(function*(p){if(!p||f.equals(this.spatialReference,p))return this;const B=this.featureAdapter,D=(yield d.projectMany(this.items.map(C=>z.getGeometry(this.geometryType,
this.hasZ,this.hasM,B.getGeometry(C))),this.spatialReference,p)).map((C,F)=>B.cloneWithGeometry(this.items[F],l.convertFromGeometry(C,this.hasZ,this.hasM)));return new E(D,this.queryGeometry,{definitionExpression:this.definitionExpression,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:p,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter})});return function(p){return A.apply(this,arguments)}}();y.createSummaryStatisticsResponse=
function(){var A=c._asyncToGenerator(function*(p,B){const {field:D,valueExpression:C,normalizationField:F,normalizationType:G,normalizationTotal:L,minValue:H,maxValue:M,scale:K}=B;B=this.fieldsIndex.isDateField(D);p=yield this._getDataValues(p,{field:D,valueExpression:C,normalizationField:F,normalizationType:G,normalizationTotal:L,scale:K});const I=q.isNullCountSupported({normalizationType:G,normalizationField:F,minValue:H,maxValue:M}),O=this.fieldsIndex.get(D),Q={value:.5,fieldType:null==O?void 0:
O.type};p=v.isStringField(O)?q.calculateStringStatistics({values:p,supportsNullCount:I,percentileParams:Q}):q.calculateStatistics({values:p,minValue:H,maxValue:M,useSampleStdDev:!G,supportsNullCount:I,percentileParams:Q});return q.processSummaryStatisticsResult(p,B)});return function(p,B){return A.apply(this,arguments)}}();y.createUniqueValuesResponse=function(){var A=c._asyncToGenerator(function*(p,B){const {field:D,valueExpression:C,domain:F,returnAllCodedValues:G,scale:L}=B;p=yield this._getDataValues(p,
{field:D,valueExpression:C,scale:L});p=q.calculateUniqueValuesCount(p);return q.createUVResult(p,F,G)});return function(p,B){return A.apply(this,arguments)}}();y.createClassBreaksResponse=function(){var A=c._asyncToGenerator(function*(p,B){const {field:D,valueExpression:C,normalizationField:F,normalizationType:G,normalizationTotal:L,classificationMethod:H,standardDeviationInterval:M,minValue:K,maxValue:I,numClasses:O,scale:Q}=B;p=yield this._getDataValues(p,{field:D,valueExpression:C,normalizationField:F,
normalizationType:G,normalizationTotal:L,scale:Q});p=q.calculateClassBreaks(p,{field:D,normalizationField:F,normalizationType:G,normalizationTotal:L,classificationMethod:H,standardDeviationInterval:M,minValue:K,maxValue:I,numClasses:O});return q.resolveCBResult(p,H)});return function(p,B){return A.apply(this,arguments)}}();y.createHistogramResponse=function(){var A=c._asyncToGenerator(function*(p,B){const {field:D,valueExpression:C,normalizationField:F,normalizationType:G,normalizationTotal:L,classificationMethod:H,
standardDeviationInterval:M,minValue:K,maxValue:I,numBins:O,scale:Q}=B;p=yield this._getDataValues(p,{field:D,valueExpression:C,normalizationField:F,normalizationType:G,normalizationTotal:L,scale:Q});return q.calculateHistogram(p,{field:D,normalizationField:F,normalizationType:G,normalizationTotal:L,classificationMethod:H,standardDeviationInterval:M,minValue:K,maxValue:I,numBins:O})});return function(p,B){return A.apply(this,arguments)}}();y._sortFeatures=function(A,p,B){if(1<A.length&&p&&p.length)for(const D of p.reverse()){p=
D.split(" ");const C=p[0],F=this.fieldsIndex.get(C);p=p[1]&&"desc"===p[1].toLowerCase();const G=q.getAttributeComparator(null==F?void 0:F.type,p);A.sort((L,H)=>{L=B(L,C,F);H=B(H,C,F);return G(L,H)})}};y._createFeatureQueryResponse=function(A){const p=this.items,{geometryType:B,hasM:D,hasZ:C,objectIdField:F,spatialReference:G}=this,{outFields:L,outSR:H,quantizationParameters:M,resultRecordCount:K,resultOffset:I,returnZ:O,returnM:Q}=A,J=null!=K?p.length>(I||0)+K:!1,P=L&&(L.includes("*")?[...this.fieldsIndex.fields]:
L.map(N=>this.fieldsIndex.get(N)));return{exceededTransferLimit:J,features:this._createFeatures(A,p),fields:P,geometryType:B,hasM:D&&Q,hasZ:C&&O,objectIdFieldName:F,spatialReference:z.cleanFromGeometryEngine(H?H:G),transform:M&&n.toQuantizationTransform(M)||null}};y._createFeatures=function(A,p){const B=new k(A,this.featureAdapter,this.fieldsIndex),{hasM:D,hasZ:C}=this,{orderByFields:F,quantizationParameters:G,returnGeometry:L,returnCentroid:H,maxAllowableOffset:M,resultOffset:K,resultRecordCount:I,
returnZ:O=!1,returnM:Q=!1}=A,J=C&&O,P=D&&Q;A=[];var N=0;p=[...p];this._sortFeatures(p,F,(T,V,W)=>B.getFieldValue(T,V,W));if(L||H){var R=n.toQuantizationTransform(G);if(L&&!H)for(var S of p)A[N++]={attributes:B.getAttributes(S),geometry:z.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(S),M,R,J,P)};else if(!L&&H)for(const T of p)A[N++]={attributes:B.getAttributes(T),centroid:z.transformCentroid(this,this.featureAdapter.getCentroid(T,this),R)};else for(const T of p)A[N++]=
{attributes:B.getAttributes(T),centroid:z.transformCentroid(this,this.featureAdapter.getCentroid(T,this),R),geometry:z.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(T),M,R,J,P)}}else for(R of p)(S=B.getAttributes(R))&&(A[N++]={attributes:S});N=K||0;null!=I&&(A=A.slice(N,Math.min(A.length,N+I)));return A};y._createExceedsLimitQueryResponse=function(A){var p=!1;let B=Number.POSITIVE_INFINITY,D=Number.POSITIVE_INFINITY;p=Number.POSITIVE_INFINITY;for(const C of A.outStatistics)if("exceedslimit"===
C.statisticType){B=null!=C.maxPointCount?C.maxPointCount:Number.POSITIVE_INFINITY;D=null!=C.maxRecordCount?C.maxRecordCount:Number.POSITIVE_INFINITY;p=null!=C.maxVertexCount?C.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)p=this.items.length>B;else if(this.items.length>D)p=!0;else{A=this.hasZ?this.hasM?4:3:this.hasM?3:2;const C=this.featureAdapter;p=this.items.reduce((F,G)=>{G=C.getGeometry(G);return F+(g.isSome(G)&&G.coords.length||0)},0)/A>p}return{fields:[{name:"exceedslimit",
type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(p)}}]}};y._createStatisticsQueryResponse=function(){var A=c._asyncToGenerator(function*(p){var B={attributes:{}};const D=[],C=new Map,F=new Map,G=new Map,L=new Map,H=new k(p,this.featureAdapter,this.fieldsIndex);var M=p.outStatistics;const {groupByFieldsForStatistics:K,having:I,orderByFields:O}=p;p=K&&K.length;const Q=!!p,J=Q&&K[0],P=Q&&!this.fieldsIndex.get(J);
for(const V of M){const {outStatisticFieldName:W,statisticType:U}=V;M=V;var N="exceedslimit"!==U?V.onStatisticField:void 0;const aa="percentile_disc"===U||"percentile_cont"===U,da="EnvelopeAggregate"===U||"CentroidAggregate"===U||"ConvexHullAggregate"===U,Y=Q&&1===p&&(N===J||P)&&"count"===U;if(Q){if(!G.has(N)){var R=[];for(const ea of K){var S=this._getAttributeValues(H,ea,C);R.push(S)}G.set(N,this._calculateUniqueValues(R,H.returnDistinctValues))}R=G.get(N);for(const ea in R){const {count:ja,data:la,
items:ia,itemPositions:ca}=R[ea];S=la.join(",");if(!I||H.validateItems(ia,I)){const fa=L.get(S)||{attributes:{}};if(da){fa.aggregateGeometries||(fa.aggregateGeometries={});const {aggregateGeometries:ba,outStatisticFieldName:Z}=yield this._getAggregateGeometry(M,ia);fa.aggregateGeometries[Z]=ba}else{var T=null;if(Y)T=ja;else{const ba=this._getAttributeValues(H,N,C);T=ca.map(Z=>ba[Z]);T=aa&&"statisticParameters"in M?this._getPercentileValue(M,T):this._getStatisticValue(M,T,null,H.returnDistinctValues)}fa.attributes[W]=
T}K.forEach((ba,Z)=>fa.attributes[this.fieldsIndex.get(ba)?ba:`EXPR_${Z+1}`]=la[Z]);L.set(S,fa)}}}else if(da){B.aggregateGeometries||(B.aggregateGeometries={});const {aggregateGeometries:ea,outStatisticFieldName:ja}=yield this._getAggregateGeometry(M,this.items);B.aggregateGeometries[ja]=ea}else N=this._getAttributeValues(H,N,C),B.attributes[W]=aa&&"statisticParameters"in M?this._getPercentileValue(M,N):this._getStatisticValue(M,N,F,H.returnDistinctValues);D.push({name:W,alias:W,type:"esriFieldTypeDouble"})}B=
Q?Array.from(L.values()):[B];this._sortFeatures(B,O,(V,W)=>V.attributes[W]);return{fields:D,features:B}});return function(p){return A.apply(this,arguments)}}();y._getAggregateGeometry=function(){var A=c._asyncToGenerator(function*(p,B){var D=yield new Promise((O,Q)=>a(["../../../geometry/geometryEngineJSON"],O,Q));const {statisticType:C,outStatisticFieldName:F}=p,{featureAdapter:G,spatialReference:L,geometryType:H,hasZ:M,hasM:K}=this;B=B.map(O=>z.getGeometry(H,M,K,G.getGeometry(O)));const I=D.convexHull(L,
B,!0)[0];p={aggregateGeometries:null,outStatisticFieldName:null};"EnvelopeAggregate"===C?(D=I?w.getPolygonExtent(I):w.getGeometryExtent(D.union(L,B)),p.aggregateGeometries={...D,spatialReference:L},p.outStatisticFieldName=F||"extent"):"CentroidAggregate"===C?(D=I?h.polygonCentroid(I):h.extentCentroid(w.getGeometryExtent(D.union(L,B))),p.aggregateGeometries={x:D[0],y:D[1],spatialReference:L},p.outStatisticFieldName=F||"centroid"):"ConvexHullAggregate"===C&&(p.aggregateGeometries=I,p.outStatisticFieldName=
F||"convexHull");return p});return function(p,B){return A.apply(this,arguments)}}();y._getStatisticValue=function(A,p,B,D){const {onStatisticField:C,statisticType:F}=A;A=null;A=null!=B&&B.has(C)?B.get(C):v.isStringField(this.fieldsIndex.get(C))?q.calculateStringStatistics({values:p,returnDistinct:D}):q.calculateStatistics({values:p,minValue:null,maxValue:null,useSampleStdDev:!0});B&&B.set(C,A);return A["var"===F?"variance":F]};y._getPercentileValue=function(A,p){const {onStatisticField:B,statisticParameters:D,
statisticType:C}=A,{value:F,orderBy:G}=D;A=this.fieldsIndex.get(B);return q.calculatePercentile(p,{value:F,orderBy:G,fieldType:null==A?void 0:A.type,isDiscrete:"percentile_disc"===C})};y._getAttributeValues=function(A,p,B){if(B.has(p))return B.get(p);const D=this.fieldsIndex.get(p),C=this.items.map(F=>A.getFieldValue(F,p,D));B.set(p,C);return C};y._getAttributeNormalizedValues=function(A,p){return this.items.map(B=>A.getNormalizedValue(B,{field:p.field,fieldInfo:this.fieldsIndex.get(p.field),normalizationField:p.normalizationField,
normalizationFieldInfo:this.fieldsIndex.get(p.normalizationField),normalizationType:p.normalizationType,normalizationTotal:p.normalizationTotal}))};y._getAttributeExpressionValues=function(){var A=c._asyncToGenerator(function*(p,B,D){const {arcadeUtils:C}=yield t.loadArcade(),F=C.createFunction(B),G=D&&C.getViewInfo(D);return this.items.map(L=>p.getExpressionValue(L,{compiledFunc:F,viewInfo:G},C))});return function(p,B,D){return A.apply(this,arguments)}}();y._calculateUniqueValues=function(A,p){const B=
{},D=this.items,C=D.length;for(let F=0;F<C;F++){const G=D[F],L=[];for(const M of A)L.push(M[F]);const H=L.join(",");p?null==B[H]&&(B[H]={count:1,data:L,items:[G],itemPositions:[F]}):null==B[H]?B[H]={count:1,data:L,items:[G],itemPositions:[F]}:(B[H].count++,B[H].items.push(G),B[H].itemPositions.push(F))}return B};y._getDataValues=function(){var A=c._asyncToGenerator(function*(p,B){const D=new k(p,this.featureAdapter,this.fieldsIndex),{valueExpression:C,field:F,normalizationField:G,normalizationType:L,
normalizationTotal:H,scale:M}=B;p=C?{viewingMode:"map",scale:M,spatialReference:p.outSR||this.spatialReference}:null;return C?this._getAttributeExpressionValues(D,C,p):this._getAttributeNormalizedValues(D,{field:F,normalizationField:G,normalizationType:L,normalizationTotal:H})});return function(p,B){return A.apply(this,arguments)}}();c._createClass(E,[{key:"size",get:function(){return this.items.length}}]);return E}();b.SnappingTypes=void 0;(function(E){E[E.NONE=0]="NONE";E[E.EDGE=1]="EDGE";E[E.VERTEX=
2]="VERTEX"})(b.SnappingTypes||(b.SnappingTypes={}));b.default=u;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/layers/graphics/data/AttributesBuilder":function(){define(["../../../core/maybe","./attributeSupport","../../../statistics/utils"],function(a,b,c){return function(){function g(w,n,f){this._fieldDataCache=new Map;this._returnDistinctMap=new Map;this.returnDistinctValues=w.returnDistinctValues;this.fieldsIndex=f;this.featureAdapter=n;if((n=w.outFields)&&-1===n.indexOf("*")){this.outFields=
n;w=0;for(const k of n){var l=b.getExpressionFromFieldName(k);l=(n=this.fieldsIndex.get(l))?null:b.getWhereClause(l,f);n=n?n.name:b.getAliasFromFieldName(k)||`FIELD_EXP_${w++}`;this._fieldDataCache.set(k,{alias:n,clause:l})}}}var h=g.prototype;h.countDistinctValues=function(w){if(!this.returnDistinctValues)return w.length;w.forEach(n=>this.getAttributes(n));return this._returnDistinctMap.size};h.getAttributes=function(w){w=this._processAttributesForOutFields(w);return this._processAttributesForDistinctValues(w)};
h.getFieldValue=function(w,n,f){const l=f?f.name:n;let k=null;this._fieldDataCache.has(l)?k=this._fieldDataCache.get(l).clause:f||(k=b.getWhereClause(n,this.fieldsIndex),this._fieldDataCache.set(l,{alias:l,clause:k}));return f?this.featureAdapter.getAttribute(w,l):k.calculateValue(w,this.featureAdapter)};h.getNormalizedValue=function(w,n){const f=n.normalizationType,l=n.normalizationTotal;let k=this.getFieldValue(w,n.field,n.fieldInfo);f&&Number.isFinite(k)&&(w=this.getFieldValue(w,n.normalizationField,
n.normalizationFieldInfo),k=c.getNormalizedValue(k,f,w,l));return k};h.getExpressionValue=function(w,n,f){w={attributes:this.featureAdapter.getAttributes(w)};w=f.createExecContext(w,n.viewInfo);return f.executeFunction(n.compiledFunc,w)};h.validateItem=function(w,n){this._fieldDataCache.has(n)||this._fieldDataCache.set(n,{alias:n,clause:b.getWhereClause(n,this.fieldsIndex)});return this._fieldDataCache.get(n).clause.testFeature(w,this.featureAdapter)};h.validateItems=function(w,n){this._fieldDataCache.has(n)||
this._fieldDataCache.set(n,{alias:n,clause:b.getWhereClause(n,this.fieldsIndex)});return this._fieldDataCache.get(n).clause.testSet(w,this.featureAdapter)};h._processAttributesForOutFields=function(w){const n=this.outFields;if(!n||!n.length)return this.featureAdapter.getAttributes(w);const f={};for(const l of n){const {alias:k,clause:e}=this._fieldDataCache.get(l);f[k]=e?e.calculateValue(w,this.featureAdapter):this.featureAdapter.getAttribute(w,k)}return f};h._processAttributesForDistinctValues=function(w){if(a.isNone(w)||
!this.returnDistinctValues)return w;var n=this.outFields,f=[];if(n)for(const k of n){var {alias:l}=this._fieldDataCache.get(k);f.push(w[l])}else for(l in w)f.push(w[l]);n=`${(n||["*"]).join(",")}=${f.join(",")}`;f=this._returnDistinctMap.get(n)||0;this._returnDistinctMap.set(n,++f);return 1<f?null:w};return g}()})},"esri/statistics/utils":function(){define(["exports","../rest/support/ClassBreaksDefinition","../rest/support/generateRendererUtils"],function(a,b,c){function g(u){const E=null!=u.minValue||
null!=u.maxValue,y=!!u.sqlExpression&&u.supportsSQLExpression;return!(null!=u.normalizationField||null!=u.normalizationType)&&!E&&!y}function h(u){const {values:E,useSampleStdDev:y,supportsNullCount:A}=u;var p=Number.POSITIVE_INFINITY;let B=Number.NEGATIVE_INFINITY,D=null,C=null;var F=null;let G=null,L=0;const H=null==u.minValue?-Infinity:u.minValue,M=null==u.maxValue?Infinity:u.maxValue;for(const K of E)Number.isFinite(K)?K>=H&&K<=M&&(D+=K,p=Math.min(p,K),B=Math.max(B,K),L++):"string"===typeof K&&
L++;if(L&&null!=D){C=D/L;F=0;for(const K of E)Number.isFinite(K)&&K>=H&&K<=M&&(F+=(K-C)**2);G=y?1<L?F/(L-1):0:0<L?F/L:0;F=Math.sqrt(G)}else B=p=null;p={avg:C,count:L,max:B,min:p,stddev:F,sum:D,variance:G};A&&(p.nullcount=E.length-L);u.percentileParams&&(p.median=w(E,u.percentileParams));return p}function w(u,E){const {fieldType:y,value:A,orderBy:p,isDiscrete:B}=E,D=n(y,"desc"===p);u=[...u].filter(L=>null!=L).sort((L,H)=>D(L,H));if(0===u.length)return null;if(0>=A)return u[0];if(1<=A)return u[u.length-
1];var C=(u.length-1)*A,F=Math.floor(C);E=F+1;C%=1;F=u[F];const G=u[E];return E>=u.length||B||"string"===typeof F||"string"===typeof G?F:F*(1-C)+G*C}function n(u,E){const y=E?1:-1,A=l(E),p=f(E);if(!u||!["esriFieldTypeDate","esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...r].includes(u))return(B,D)=>"number"===typeof B&&"number"===typeof D?A(B,D):"string"===typeof B&&"string"===typeof D?p(B,D):y;if("esriFieldTypeDate"===u)return(B,D)=>{B=(new Date(B)).getTime();D=(new Date(D)).getTime();
return isNaN(B)||isNaN(D)?y:A(B,D)};if(r.has(u))return(B,D)=>A(B,D);if("esriFieldTypeString"===u)return(B,D)=>p(B,D);if("esriFieldTypeGUID"===u||"esriFieldTypeGlobalID"===u){const B=f(E);return(D,C)=>B(k(D),k(C))}return E?(B,D)=>1:(B,D)=>-1}function f(u){return u?(E,y)=>{var A,p;E=null==(A=E)?void 0:A.toUpperCase();y=null==(p=y)?void 0:p.toUpperCase();return E>y?-1:E<y?1:0}:(E,y)=>{var A,p;E=null==(A=E)?void 0:A.toUpperCase();y=null==(p=y)?void 0:p.toUpperCase();return E<y?-1:E>y?1:0}}function l(u){return u?
(E,y)=>y-E:(E,y)=>E-y}function k(u){return u.substr(24,12)+u.substr(19,4)+u.substr(16,2)+u.substr(14,2)+u.substr(11,2)+u.substr(9,2)+u.substr(6,2)+u.substr(4,2)+u.substr(2,2)+u.substr(0,2)}function e(u,E){const y=m({field:E.field,normalizationType:E.normalizationType,normalizationField:E.normalizationField,classificationMethod:E.classificationMethod,standardDeviationInterval:E.standardDeviationInterval,breakCount:E.numClasses||5});u=d(u,E.minValue,E.maxValue);return c.createGenerateRendererClassBreaks({definition:y,
values:u,normalizationTotal:E.normalizationTotal})}function d(u,E,y){E=null==E?-Infinity:E;y=null==y?Infinity:y;return u.filter(A=>Number.isFinite(A)&&A>=E&&A<=y)}function m(u){const E=u.field,y=u.classificationMethod||"equal-interval",A=u.normalizationType,p=u.normalizationField,B=new b;B.classificationField=E;B.breakCount=u.breakCount;B.classificationMethod=y;B.standardDeviationInterval="standard-deviation"===y?u.standardDeviationInterval||1:void 0;B.normalizationType=A;B.normalizationField="field"===
A?p:void 0;return B}function z(u,E){const {field:y,classificationMethod:A,standardDeviationInterval:p,normalizationType:B,normalizationField:D,normalizationTotal:C,minValue:F,maxValue:G}=E,L=E.numBins||10;let H=E=null,M=null;A&&"equal-interval"!==A||B?({classBreaks:u}=e(u,{field:y,normalizationType:B,normalizationField:D,normalizationTotal:C,classificationMethod:A,standardDeviationInterval:p,minValue:F,maxValue:G,numClasses:L}),E=u[0].minValue,H=u[u.length-1].maxValue,M=u.map(K=>[K.minValue,K.maxValue])):
(null!=F&&null!=G?(E=F,H=G):(u=h({values:u,minValue:F,maxValue:G,useSampleStdDev:!B,supportsNullCount:g({normalizationType:B,normalizationField:D,minValue:F,maxValue:G})}),E=u.min,H=u.max),M=q(E,H,L));return{min:E,max:H,intervals:M}}function v(u,E){let y=-1;for(let A=u.length-1;0<=A;A--)if(E>=u[A][0]){y=A;break}return y}function q(u,E,y){const A=(E-u)/y,p=[];let B;for(let D=1;D<=y;D++)B=u+A,B=Number(B.toFixed(16)),p.push([u,D===y?E:B]),u=B;return p}const t=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,
r=new Set(["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),x="min max avg stddev count sum variance nullcount median".split(" ");a.calculateClassBreaks=e;a.calculateHistogram=function(u,E){const {min:y,max:A,intervals:p}=z(u,E),B=p.map((D,C)=>({minValue:p[C][0],maxValue:p[C][1],count:0}));for(const D of u)null!=D&&D>=y&&D<=A&&(u=v(p,D),-1<u&&B[u].count++);return{bins:B,minValue:y,maxValue:A,normalizationTotal:E.normalizationTotal}};a.calculatePercentile=
w;a.calculateStatistics=h;a.calculateStringStatistics=function(u){const E=u.returnDistinct?[...new Set(u.values)]:u.values,y=E.filter(p=>null!=p).length,A={count:y};u.supportsNullCount&&(A.nullcount=E.length-y);u.percentileParams&&(A.median=w(E,u.percentileParams));return A};a.calculateUniqueValuesCount=function(u){const E={};for(let y of u){if(null==y||"string"===typeof y&&""===y.trim())y=null;null==E[y]?E[y]={count:1,data:y}:E[y].count++}return{count:E}};a.createClassBreaksDefinition=m;a.createUVResult=
function(u,E,y){const A=u.count;u=[];y&&E&&"coded-value"===E.type&&E.codedValues.forEach(p=>{p=p.code;A.hasOwnProperty(p)||(A[p]={data:p,count:0})});for(const p in A)E=A[p],u.push({value:E.data,count:E.count,label:E.label});return{uniqueValueInfos:u}};a.getAttributeComparator=n;a.getEqualIntervalBins=q;a.getNormalizedValue=function(u,E,y,A){let p=null;switch(E){case "log":0!==u&&(p=Math.log(u)*Math.LOG10E);break;case "percent-of-total":Number.isFinite(A)&&0!==A&&(p=u/A*100);break;case "field":Number.isFinite(y)&&
0!==y&&(p=u/y);break;case "natural-log":0<u&&(p=Math.log(u));break;case "square-root":0<u&&(p=u**.5)}return p};a.isNullCountSupported=g;a.processSummaryStatisticsResult=function(u,E){let y;for(y in u)-1<x.indexOf(y)&&(Number.isFinite(u[y])||(u[y]=null));if(!E)return u;["avg","stddev","variance"].forEach(A=>{null!=u[A]&&(u[A]=Math.ceil(u[A]))});return u};a.resolveCBResult=function(u,E){let y=u.classBreaks;const A=y[0].minValue,p=y[y.length-1].maxValue,B="standard-deviation"===E;y=y.map(D=>{const C=
D.label;D={minValue:D.minValue,maxValue:D.maxValue,label:C};if(B&&C){const F=C.match(t).map(G=>+G.trim());2===F.length?(D.minStdDev=F[0],D.maxStdDev=F[1],0>F[0]&&0<F[1]&&(D.hasAvg=!0)):1===F.length&&(C.includes("\x3c")?(D.minStdDev=null,D.maxStdDev=F[0]):C.includes("\x3e")&&(D.minStdDev=F[0],D.maxStdDev=null))}return D});return{minValue:A,maxValue:p,classBreakInfos:y,normalizationTotal:u.normalizationTotal}};a.statisticTypes=x;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/rest/support/ClassBreaksDefinition":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/jsonMap ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./ClassificationDefinition".split(" "),
function(a,b,c,g,h,w,n,f,l){h=new c.JSONMap({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"});c=new c.JSONMap({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});l=function(k){function e(){var d=k.apply(this,arguments)||this;d.breakCount=null;d.classificationField=
null;d.classificationMethod=null;d.normalizationField=null;d.normalizationType=null;d.type="class-breaks-definition";return d}a._inheritsLoose(e,k);a._createClass(e,[{key:"standardDeviationInterval",set:function(d){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",d)}},{key:"definedInterval",set:function(d){"defined-interval"===this.classificationMethod&&this._set("definedInterval",d)}}]);return e}(l);b.__decorate([g.property({json:{write:!0}})],l.prototype,"breakCount",
void 0);b.__decorate([g.property({json:{write:!0}})],l.prototype,"classificationField",void 0);b.__decorate([g.property({type:String,json:{read:h.read,write:h.write}})],l.prototype,"classificationMethod",void 0);b.__decorate([g.property({json:{write:!0}})],l.prototype,"normalizationField",void 0);b.__decorate([g.property({json:{read:c.read,write:c.write}})],l.prototype,"normalizationType",void 0);b.__decorate([g.property({value:null,json:{write:!0}})],l.prototype,"standardDeviationInterval",null);
b.__decorate([g.property({value:null,json:{write:!0}})],l.prototype,"definedInterval",null);b.__decorate([g.property()],l.prototype,"type",void 0);return l=b.__decorate([f.subclass("esri.rest.support.ClassBreaksDefinition")],l)})},"esri/rest/support/ClassificationDefinition":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./colorRamps ../../symbols/Symbol".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){c=new c.JSONMap({classBreaksDef:"class-breaks-definition",uniqueValueDef:"unique-value-definition"});g=function(d){function m(){var z=d.apply(this,arguments)||this;z.baseSymbol=null;z.colorRamp=null;z.type=null;return z}a._inheritsLoose(m,d);return m}(g.JSONSupport);b.__decorate([h.property({type:e,json:{write:!0}})],g.prototype,"baseSymbol",void 0);b.__decorate([h.property({types:k.types,json:{read:{reader:k.fromJSON},write:!0}})],g.prototype,"colorRamp",void 0);b.__decorate([h.property({json:{read:c.read,
write:c.write}})],g.prototype,"type",void 0);return g=b.__decorate([l.subclass("esri.rest.support.ClassificationDefinition")],g)})},"esri/rest/support/generateRendererUtils":function(){define(["exports"],function(a){function b(e){const {classificationMethod:d,breakCount:m,normalizationType:z,definedInterval:v}=e.definition,q=[];var t=e.values;if(0===t.length)return[];t=t.sort((A,p)=>A-p);var r=t[0],x=t[t.length-1];if("equal-interval"===d)if(t.length>=m){t=(x-r)/m;e=r;for(var u=1;u<m;u++){var E=Number((r+
u*t).toFixed(6));q.push({minValue:e,maxValue:E,label:c(e,E,z)});e=E}q.push({minValue:e,maxValue:x,label:c(e,x,z)})}else t.forEach(A=>{q.push({minValue:A,maxValue:A,label:c(A,A,z)})});else if("natural-breaks"===d){t=g(t);e=h(t.uniqueValues,e.valueFrequency||t.valueFrequency,m);for(u=1;u<m;u++)t.uniqueValues.length>u&&(E=Number(t.uniqueValues[e[u]].toFixed(6)),q.push({minValue:r,maxValue:E,label:c(r,E,z)}),r=E);q.push({minValue:r,maxValue:x,label:c(r,x,z)})}else if("quantile"===d)if(t.length>=m&&r!==
x){e=Math.ceil(t.length/m);u=0;for(E=1;E<m;E++){var y=e+u-1;y>t.length&&(y=t.length-1);0>y&&(y=0);q.push({minValue:r,maxValue:t[y],label:c(r,t[y],z)});r=t[y];u+=e;e=Math.ceil((t.length-u)/(m-E))}q.push({minValue:r,maxValue:x,label:c(r,x,z)})}else for(x=-1,r=0;r<t.length;r++)e=t[r],e!==x&&(x=e,q.push({minValue:x,maxValue:e,label:c(x,e,z)}),x=e);else if("standard-deviation"===d)if(e=f(t),u=l(t,e),0===u)q.push({minValue:t[0],maxValue:t[0],label:c(t[0],t[0],z)});else{t=n(r,x,m,e,u)*u;u=0;for(E=m;1<=E;E--)y=
Number((e-(E-.5)*t).toFixed(6)),q.push({minValue:r,maxValue:y,label:c(r,y,z)}),r=y,u++;E=Number((e+.5*t).toFixed(6));q.push({minValue:r,maxValue:E,label:c(r,E,z)});r=E;u++;for(y=1;y<=m;y++)E=u===2*m?x:Number((e+(y+.5)*t).toFixed(6)),q.push({minValue:r,maxValue:E,label:c(r,E,z)}),r=E,u++}else if("defined-interval"===d){if(!v)return q;x=t[0];t=t[t.length-1];r=Math.ceil((t-x)/v);e=x;for(u=1;u<r;u++)E=Number((x+u*v).toFixed(6)),q.push({minValue:e,maxValue:E,label:c(e,E,z)}),e=E;q.push({minValue:e,maxValue:t,
label:c(e,t,z)})}return q}function c(e,d,m){let z=null;return z=e===d?m&&"percent-of-total"===m?e+"%":e.toString():m&&"percent-of-total"===m?e+"% - "+d+"%":e+" - "+d}function g(e){const d=[],m=[];let z=Number.MIN_VALUE,v=1,q=-1;for(let t=0;t<e.length;t++){const r=e[t];r===z?(v++,m[q]=v):null!==r&&(d.push(r),z=r,v=1,m.push(v),q++)}return{uniqueValues:d,valueFrequency:m}}function h(e,d,m){var z=e.length;const v=[];m>z&&(m=z);for(var q=0;q<m;q++)v.push(Math.round(q*z/m-1));v.push(z-1);q=w(v,e,d,m);{z=
q.mean;q=q.sdcm;var t=m,r=0,x=0;let E=0,y=0,A=!0;for(let p=0;2>p&&A;p++){0===p&&(A=!1);for(var u=0;u<t-1;u++)for(;v[u+1]+1!==v[u+2];)if(v[u+1]+=1,r=k(u,v,e,d),E=r.sbMean,r=r.sbSdcm,x=k(u+1,v,e,d),y=x.sbMean,x=x.sbSdcm,r+x<q[u]+q[u+1])q[u]=r,q[u+1]=x,z[u]=E,z[u+1]=y,A=!0;else{--v[u+1];break}for(u=t-1;0<u;u--)for(;v[u]!==v[u-1]+1;)if(--v[u],r=k(u-1,v,e,d),E=r.sbMean,r=r.sbSdcm,x=k(u,v,e,d),y=x.sbMean,x=x.sbSdcm,r+x<q[u-1]+q[u])q[u-1]=r,q[u]=x,z[u-1]=E,z[u]=y,A=!0;else{v[u]+=1;break}}z=A}z&&(q=w(v,e,
d,m));return v}function w(e,d,m,z){let v=[];var q=[],t=[];let r=0;const x=[],u=[];for(var E=0;E<z;E++){var y=k(E,e,d,m);x.push(y.sbMean);u.push(y.sbSdcm);r+=u[E]}y=r;for(E=!0;E||r<y;){E=!1;v=[];for(q=0;q<z;q++)v.push(e[q]);for(t=0;t<z;t++)for(y=e[t]+1;y<=e[t+1];y++)if(q=d[y],0<t&&y!==e[t+1]&&Math.abs(q-x[t])>Math.abs(q-x[t-1]))e[t]=y;else if(t<z-1&&e[t]!==y-1&&Math.abs(q-x[t])>Math.abs(q-x[t+1])){e[t+1]=y-1;break}y=r;r=0;q=[];t=[];for(let A=0;A<z;A++){q.push(x[A]);t.push(u[A]);const p=k(A,e,d,m);
x[A]=p.sbMean;u[A]=p.sbSdcm;r+=u[A]}}if(r>y){for(d=0;d<z;d++)e[d]=v[d],x[d]=q[d],u[d]=t[d];r=y}return{mean:x,sdcm:u}}function n(e,d,m,z,v){e=Math.max(z-e,d-z)/v/m;return 1<=e?1:.5<=e?.5:.25}function f(e){let d=0;for(let m=0;m<e.length;m++)d+=e[m];return d/=e.length}function l(e,d){let m=0;for(let z=0;z<e.length;z++){const v=e[z];m+=(v-d)*(v-d)}m/=e.length;return Math.sqrt(m)}function k(e,d,m,z){var v=0,q=0;for(var t=d[e]+1;t<=d[e+1];t++){const r=z[t];v+=m[t]*r;q+=r}0>=q&&console.log("Exception in Natural Breaks calculation");
v/=q;q=0;for(t=d[e]+1;t<=d[e+1];t++)q+=z[t]*(m[t]-v)**2;return{sbMean:v,sbSdcm:q}}a.createGenerateRendererClassBreaks=function(e){const {normalizationTotal:d}=e;return{classBreaks:b(e),normalizationTotal:d}};a.createGenerateRendererUniqueValues=function(e){e=g(e);const d=[],m=e.uniqueValues.length;for(let z=0;z<m;z++){const v=e.uniqueValues[z];d.push({value:v,count:e.valueFrequency[z],label:v.toString()})}return{uniqueValues:d}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/data/timeSupport":function(){define(["exports"],
function(a){function b(h,w,n,f,l){if(null!=f&&null!=l)return k=>{const e=h.getAttribute(k,w);k=h.getAttribute(k,n);return(null==e||e<=l)&&(null==k||k>=f)};if(null!=f)return k=>{k=h.getAttribute(k,n);return null==k||k>=f};if(null!=l)return k=>{k=h.getAttribute(k,w);return null==k||k<=l}}function c(h,w,n,f){if(null!=n&&null!=f&&n===f)return l=>h.getAttribute(l,w)===n;if(null!=n&&null!=f)return l=>{l=h.getAttribute(l,w);return l>=n&&l<=f};if(null!=n)return l=>h.getAttribute(l,w)>=n;if(null!=f)return l=>
h.getAttribute(l,w)<=f}function g(){return()=>!1}a.getTimeExtent=function(h,w){if(!h)return null;const n=w.featureAdapter,{startTimeField:f,endTimeField:l}=h;let k=Number.POSITIVE_INFINITY,e=Number.NEGATIVE_INFINITY;if(f&&l)w.forEach(d=>{const m=n.getAttribute(d,f);d=n.getAttribute(d,l);null==m||isNaN(m)||(k=Math.min(k,m));null==d||isNaN(d)||(e=Math.max(e,d))});else{const d=f||l;w.forEach(m=>{m=n.getAttribute(m,d);null==m||isNaN(m)||(k=Math.min(k,m),e=Math.max(e,m))})}return{start:k,end:e}};a.getTimeOperator=
function(h,w,n){if(!w||!h)return null;const {startTimeField:f,endTimeField:l}=h;if(!f&&!l)return null;const {start:k,end:e}=w;return null===k&&null===e?null:void 0===k&&void 0===e?g():f&&l?b(n,f,l,k,e):c(n,f||l,k,e)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/data/utils":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/jsonMap ../../../core/maybe ../../../core/unitUtils ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../centroid ../featureConversionUtils ../OptimizedGeometry ./projectionSupport".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z){function v(H,M,K,I=H.hasZ,O=H.hasM){if(h.isNone(M))return null;const Q=H.hasZ&&I,J=H.hasM&&O;return K?(H=d.quantizeOptimizedGeometry(F,M,H.hasZ,H.hasM,"esriGeometryPoint",K,I,O),d.convertToPoint(H,Q,J)):d.convertToPoint(M,Q,J)}function q(){q=c._asyncToGenerator(function*(H,M,K){const {outFields:I,orderByFields:O,groupByFieldsForStatistics:Q,outStatistics:J}=H;if(I)for(var P=0;P<I.length;P++)I[P]=I[P].trim();if(O)for(P=0;P<O.length;P++)O[P]=O[P].trim();if(Q)for(P=
0;P<Q.length;P++)Q[P]=Q[P].trim();if(J)for(P=0;P<J.length;P++)J[P].onStatisticField&&(J[P].onStatisticField=J[P].onStatisticField.trim());H.geometry&&!H.outSR&&(H.outSR=H.geometry.spatialReference);return r(H,M,K)});return q.apply(this,arguments)}function t(){t=c._asyncToGenerator(function*(H,M,K){return r(H,M,K)});return t.apply(this,arguments)}function r(H,M,K){return x.apply(this,arguments)}function x(){x=c._asyncToGenerator(function*(H,M,K){if(!H)return null;var {where:I}=H;H.where=I=I&&I.trim();
if(!I||/^1 *= *1$/.test(I)||M&&M===I)H.where=null;if(!H.geometry)return H;M=yield u(H);H.distance=0;H.units=null;"esriSpatialRelEnvelopeIntersects"===H.spatialRel&&({spatialReference:I}=H.geometry,M=n.getGeometryExtent(M),M.spatialReference=I);H.geometry=M;yield z.checkProjectionSupport(M.spatialReference,K);M=(yield l.normalizeCentralMeridian(f.fromJSON(M)))[0];if(h.isNone(M))throw B;M=M.toJSON();M=yield z.project(M,M.spatialReference,K);if(!M)throw B;M.spatialReference=K;H.geometry=M;return H});
return x.apply(this,arguments)}function u(H){return E.apply(this,arguments)}function E(){E=c._asyncToGenerator(function*(H){const {geometry:M,distance:K,units:I}=H;if(null==K||"vertexAttributes"in M)return M;var O=M.spatialReference;H=I?p.fromJSON(I):w.getUnitString(O);O=O&&(k.isGeographic(O)||k.isWebMercator(O))?M:yield z.checkProjectionSupport(O,k.WGS84).then(()=>z.project(M,k.WGS84));return(yield y())(O.spatialReference,O,K,H)});return E.apply(this,arguments)}function y(){return A.apply(this,arguments)}
function A(){A=c._asyncToGenerator(function*(){return(yield new Promise((H,M)=>a(["../../../geometry/geometryEngineJSON"],H,M))).geodesicBuffer});return A.apply(this,arguments)}const p=new g.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),B=Object.freeze({}),D=new m,C=new m,F=new m,G={esriGeometryPoint:d.convertToPoint,esriGeometryPolyline:d.convertToPolyline,
esriGeometryPolygon:d.convertToPolygon,esriGeometryMultipoint:d.convertToMultipoint},L=(H,M)=>"_geVersion"!==H?M:void 0;b.QUERY_ENGINE_EMPTY_RESULT=B;b.cleanFromGeometryEngine=function(H){return H&&"_geVersion"in H?JSON.parse(JSON.stringify(H,L)):H};b.getCentroid=function(H,M,K){if("esriGeometryPolygon"!==H.geometryType||!M||!M.centroid&&!M.geometry)return null;M.centroid||(M.centroid=e.getCentroidOptimizedGeometry(new m,M.geometry,H.hasZ,H.hasM));return v(H,M.centroid,K)};b.getGeometry=function(H,
M,K,I,O,Q,J=M,P=K){const N=M&&J,R=K&&P;I=h.isSome(I)?"coords"in I?I:I.geometry:null;if(h.isNone(I))return null;if(O)return M=d.generalizeOptimizedGeometry(C,I,M,K,H,O,J,P),Q&&(M=d.quantizeOptimizedGeometry(F,M,N,R,H,Q)),G[H](M,N,R);if(Q)return Q=d.quantizeOptimizedGeometry(F,I,M,K,H,Q,J,P),G[H](Q,N,R);d.removeZMValues(D,I,M,K,J,P);return G[H](D,N,R)};b.normalizeFilter=function(H,M,K){return t.apply(this,arguments)};b.normalizeQuery=function(H,M,K){return q.apply(this,arguments)};b.normalizeQueryLike=
r;b.transformCentroid=v;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./utils".split(" "),function(a,b,c,g,h,w,n,f,
l,k,e,d,m){function z(){return new Promise((r,x)=>a(["../../../geometry/geometryEngineJSON"],r,x))}function v(){v=c._asyncToGenerator(function*(r,x,u){const {spatialRel:E,geometry:y}=r;if(y){if(!0!==t.spatialRelationship[E])throw new g("feature-store:unsupported-query","Unsupported query spatial relationship",{query:r});if(f.isValid(y.spatialReference)&&f.isValid(u)){if(!0!==t.queryGeometry[n.getJsonType(y)])throw new g("feature-store:unsupported-query","Unsupported query geometry type",{query:r});
if(!0!==t.layerGeometry[x])throw new g("feature-store:unsupported-query","Unsupported layer geometry type",{query:r});if(r.outSR)return d.checkProjectionSupport(r.geometry&&r.geometry.spatialReference,r.outSR)}}});return v.apply(this,arguments)}const q={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",
esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},t={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},
layerGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};b.canQueryWithRBush=function(r){if(n.isExtent(r))return!0;if(n.isPolygon(r)){for(const x of r.rings)if(5!==x.length||x[0][0]!==x[1][0]||x[0][0]!==x[4][0]||x[2][0]!==x[3][0]||x[0][1]!==x[3][1]||x[0][1]!==x[4][1]||x[1][1]!==x[2][1])return!1;return!0}return!1};b.checkSpatialQuerySupport=function(r,x,u){return v.apply(this,arguments)};b.getSpatialQueryOperator=function(r,
x,u,E,y){if(n.isPolygon(x)&&"esriGeometryPoint"===u&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r)){const A=k.convertFromPolygon(new e,x,!1,!1);return Promise.resolve(p=>l.polygonContainsPoint(A,!1,!1,p))}if(n.isPolygon(x)&&"esriGeometryMultipoint"===u){const A=k.convertFromPolygon(new e,x,!1,!1);if("esriSpatialRelContains"===r)return Promise.resolve(p=>l.polygonContainsMultipoint(A,!1,!1,p,E,y))}if(n.isExtent(x)&&"esriGeometryPoint"===u&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===
r))return Promise.resolve(A=>h.extentContainsPoint(x,m.getGeometry(u,E,y,A)));if(n.isExtent(x)&&"esriGeometryMultipoint"===u&&"esriSpatialRelContains"===r)return Promise.resolve(A=>h.extentContainsMultipoint(x,m.getGeometry(u,E,y,A)));if(n.isExtent(x)&&"esriSpatialRelIntersects"===r){const A=w.getExtentIntersector(u);return Promise.resolve(p=>A(x,m.getGeometry(u,E,y,p)))}return z().then(A=>{const p=A[q[r]].bind(null,x.spatialReference,x);return B=>p(m.getGeometry(u,E,y,B))})};Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/geometry/support/intersects":function(){define(["exports","./intersectsBase"],function(a,b){a.extentIntersectsExtent=b.extentIntersectsExtent;a.extentIntersectsMultipoint=b.extentIntersectsMultipoint;a.extentIntersectsPoint=b.extentIntersectsPoint;a.extentIntersectsPolygon=b.extentIntersectsPolygon;a.extentIntersectsPolyline=b.extentIntersectsPolyline;a.getFeatureExtentIntersector=b.getFeatureExtentIntersector;a.isSelfIntersecting=b.isSelfIntersecting;a.segmentIntersects=
b.segmentIntersects;a.getExtentIntersector=function(c){return"mesh"===c?b.extentIntersectsExtent:b.getFeatureExtentIntersector(c)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/contains":function(){define(["exports"],function(a){function b(c,g,h,w,n){if(!c)return!1;g=g?h?4:3:h?3:2;const {coords:f,lengths:l}=c;h=!1;c=0;for(const e of l){var k=c;for(let d=c,m=c+e*g;d<m;d+=g){k=d+g;k===m&&(k=c);const z=f[d],v=f[d+1],q=f[k];k=f[k+1];(v<n&&k>=n||k<n&&v>=n)&&z+(n-v)/(k-v)*(q-
z)<w&&(h=!h)}c+=e*g}return h}a.polygonContainsCoords=b;a.polygonContainsMultipoint=function(c,g,h,w,n,f){n=n?f?4:3:f?3:2;const {coords:l,lengths:k}=w;if(!k)return!1;for(let e=0,d=0;e<k.length;e++,d+=n)if(!b(c,g,h,l[d],l[d+1]))return!1;return!0};a.polygonContainsPoint=function(c,g,h,w){return b(c,g,h,w.coords[0],w.coords[1])};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projectionEllipsoid ../../support/FrustumExtentIntersection ../../../support/Scheduler".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m){c=function(z){function v(){var t=z.apply(this,arguments)||this;t.suspended=!1;t.extent=null;t.extentIntersectionDirty=!0;t._isVisibleBelowSurface=!1;t.handles=new g;t.graphicsCoreOwner=null;t.updating=!0;return t}a._inheritsLoose(v,z);var q=v.prototype;q.setup=function(t){this.graphicsCoreOwner=t;this.extentIntersection=new d.FrustumExtentIntersection({renderCoordsHelper:t.view.renderCoordsHelper});t=t.view;const r=t.basemapTerrain,x=t.resourceController.scheduler;
this.handles.add([t.on("resize",()=>this._viewChange()),t.state.watch("camera",()=>this._viewChange(),!0),x.registerTask(m.TaskPriority.FRUSTUM_VISIBILITY,this),r.on("elevation-bounds-change",()=>this._elevationBoundsChange())]);"local"===t.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([h.init(r,["opacity","wireframe"],()=>this._updateIsVisibleBelowSurface()),h.init(t,"map.ground.navigationConstraint.type",()=>this._updateIsVisibleBelowSurface())])};q.destroy=function(){this.extentIntersection=
this.extent=this.graphicsCoreOwner=null;this.handles&&(this.handles.destroy(),this.handles=null)};q._setDirty=function(){this.updating||this._set("updating",!0)};q.setExtent=function(t){this.extent=t;this.extentIntersectionDirty=!0;this._setDirty()};q._viewChange=function(){this._setDirty()};q._elevationBoundsChange=function(){this._setDirty();this.extentIntersectionDirty=!0};q._updateIsVisibleBelowSurface=function(){const t=this.graphicsCoreOwner.view,r=t.basemapTerrain,x=t.map.ground&&t.map.ground.navigationConstraint&&
"none"===t.map.ground.navigationConstraint.type;this.isVisibleBelowSurface="local"===t.viewingMode||!r.opaque||x};q._updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=!1;var t=this.graphicsCoreOwner.view;if(this._isVisibleBelowSurface)var r=-.3*e.getReferenceEllipsoid(t.spatialReference).radius;else{const {min:x,max:u}=t.basemapTerrain.elevationBounds;r=x-Math.max(1,(u-x)*(1.2-1))}this.extentIntersection.update(this.extent,t.spatialReference,r)}};q.runTask=
function(){this._set("updating",!1);if(this.extent){this._updateExtentIntersection();var t=this.graphicsCoreOwner.view.frustum,r=e.getReferenceEllipsoid(this.graphicsCoreOwner.view.spatialReference).radius;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(t,r))}else this._set("suspended",!1)};a._createClass(v,[{key:"isVisibleBelowSurface",set:function(t){this._isVisibleBelowSurface=t;this._setDirty();this.extentIntersectionDirty=!0}},{key:"running",get:function(){return this.updating}}]);
return v}(c);b.__decorate([w.property({readOnly:!0})],c.prototype,"suspended",void 0);b.__decorate([w.property({readOnly:!0})],c.prototype,"updating",void 0);return c=b.__decorate([k.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],c)})},"esri/views/3d/layers/graphics/Graphics3DObjectStates":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/handleUtils","./Graphics3DObjectStateSet"],function(a,b,c,g){let h=function(){function w(f){this._graphicsCore=
f;this._stateSets=[]}var n=w.prototype;n.destroy=function(){this._stateSets&&this._stateSets.forEach(f=>f.objectStateSet.removeAll());this._stateSets=null};n.acquireSet=function(f,l){const k=new g.Graphics3DObjectStateSet(f,l);this._stateSets.push(k);f=c.makeHandle(()=>this.releaseSet(k));return{set:k,handle:f}};n.releaseSet=function(f){f.objectStateSet.removeAll();f=this._stateSets?this._stateSets.indexOf(f):-1;-1!==f&&this._stateSets.splice(f,1)};n._addObjectStateSet=function(f,l){f.addObjectStateSet(l.stateType,
l.objectStateSet)};n._removeObjectStateSet=function(f,l){f.removeObjectState(l.objectStateSet)};n.setUid=function(f,l){f.ids.add(l);(l=this._graphicsCore.graphics3DGraphics.get(l))&&this._addObjectStateSet(l,f)};n.setUids=function(f,l){l.forEach(k=>this.setUid(f,k))};n.setObjectIds=function(f,l){l.forEach(k=>f.ids.add(k));this._initializeSet(f)};n.addGraphic=function(f){this._stateSets.forEach(l=>{!l.paused&&l.hasGraphic(f)&&this._addObjectStateSet(f,l)})};n.removeGraphic=function(f){this._stateSets.forEach(l=>
{l.hasGraphic(f)&&this._removeObjectStateSet(f,l)})};n.allGraphicsDeleted=function(){this._stateSets&&this._stateSets.forEach(f=>f.objectStateSet.removeAll())};n._initializeSet=function(f){const l=this._graphicsCore.graphics3DGraphics;f.objectIdField?l.forEach(k=>{k&&f.hasGraphic(k)&&this._addObjectStateSet(k,f)}):f.ids.forEach(k=>{(k=l.get(k))&&this._addObjectStateSet(k,f)})};b._createClass(w,[{key:"test",get:function(){return{states:this._stateSets}}}]);return w}();a.Graphics3DObjectStates=h;Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DObjectStateSet":function(){define(["exports","../../webgl-engine/lib/Object3DStateSet"],function(a,b){let c=function(){function g(h,w){this.stateType=h;this.objectIdField=w;this.objectStateSet=new b.Object3DStateSet;this.ids=new Set;this.paused=!1}g.prototype.hasGraphic=function(h){return this.objectIdField?this.ids.has(h.graphic.attributes[this.objectIdField]):this.ids.has(h.graphic.uid)};return g}();a.Graphics3DObjectStateSet=
c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Object3DStateSet":function(){define(["exports","./basicInterfaces"],function(a,b){var c;(function(h){h[h.Object=0]="Object";h[h.RenderGeometry=1]="RenderGeometry";h[h.External=2]="External";h[h.COUNT=3]="COUNT"})(c||(c={}));let g=function(){function h(){this.items=[]}var w=h.prototype;w.addObject=function(n,f){this.items.push({type:c.Object,objectStateId:f,object:n})};w.addRenderGeometry=function(n,f,l){this.items.push({type:c.RenderGeometry,
objectStateId:f,renderGeometry:n,owner:l})};w.addExternal=function(n,f){this.items.push({type:c.External,objectStateId:f,remove:n})};w.remove=function(n){for(let f=this.items.length-1;0<=f;--f){const l=this.items[f];l.objectStateId===n&&(this._removeObjectStateItem(l),this.items.splice(f,1))}};w.removeObject=function(n){for(let f=this.items.length-1;0<=f;--f){const l=this.items[f];l.type===c.Object&&l.object===n&&(this._removeObjectStateItem(l),this.items.splice(f,1))}};w.removeRenderGeometry=function(n){for(let f=
this.items.length-1;0<=f;--f){const l=this.items[f];l.type===c.RenderGeometry&&l.renderGeometry===n&&(this._removeObjectStateItem(l),this.items.splice(f,1))}};w.removeAll=function(){this.items.forEach(n=>{this._removeObjectStateItem(n)});this.items=[]};w._removeObjectStateItem=function(n){switch(n.type){case c.Object:n.objectStateId.channel===b.Object3DState.Highlight?n.object.removeHighlight(n.objectStateId):n.objectStateId.channel===b.Object3DState.MaskOccludee&&n.object.removeOcclude(n.objectStateId);
break;case c.RenderGeometry:n.owner.removeRenderGeometryObjectState(n.renderGeometry,n.objectStateId);break;case c.External:n.remove(n.objectStateId)}};return h}();a.Object3DStateSet=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projection ../../../../geometry/support/aaBoundingRect ./enums ../../../support/layerViewUtils ../../../support/Scheduler".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v){c=function(q){function t(){var x=q.apply(this,arguments)||this;x._scaleRangeActive=!1;x.layerScaleRangeVisibilityQuery=!1;x.handles=new g;x.graphicsCoreOwner=null;x.layer=null;x.queryGraphicUIDsInExtent=null;x.extent=null;x.graphicsCore=null;x.basemapTerrain=null;x.layerScaleEnabled=!0;x.suspended=!1;x.updating=!0;return x}a._inheritsLoose(t,q);var r=t.prototype;r.setup=function(x,u,E,y,A){this.graphicsCoreOwner=x;this.layer=u;this.queryGraphicUIDsInExtent=
E;this.graphicsCore=y;this.basemapTerrain=A;this.updateScaleRangeActive();this.handles.add(this.graphicsCoreOwner.view.resourceController.scheduler.registerTask(v.TaskPriority.SCALE_VISIBILITY,this))};r.destroy=function(){this.handles.destroy();this.graphicsCore=this.queryGraphicUIDsInExtent=this.extent=this.graphicsCoreOwner=this.handles=null};r._setDirty=function(){this.updating||this._set("updating",!0)};r.setExtent=function(x){const u=this.graphicsCoreOwner.view.spatialReference,E=this.graphicsCoreOwner.view.basemapTerrain.spatialReference;
if(u===E)this.extent=x;else{const y=d.create();e.projectBoundingRect(x,u,y,E)?this.extent=y:this.extent=null}this._setDirty()};r.scaleRangeActive=function(){return this._scaleRangeActive};r.updateScaleRangeActive=function(){var x=this.layer,u=x.effectiveScaleRange;u=this.layerScaleEnabled&&(0<u.minScale||0<u.maxScale);x.labelingInfo&&!u&&(u=x.labelingInfo.some(E=>E&&(0<E.minScale||0<E.maxScale)));x=this._scaleRangeActive!==u;(this._scaleRangeActive=u)&&!this.handles.has("terrain-events")&&this.basemapTerrain?
(this.handles.add(this.basemapTerrain.on("scale-change",E=>this._scaleUpdateHandler(E)),"terrain-events"),this.layerScaleEnabled&&this.handles.add(this.basemapTerrain.on("tiles-visibility-changed",()=>this._setDirty()),"terrain-events")):!u&&this.handles.has("terrain-events")&&this.handles.remove("terrain-events");return x};r.runTask=function(){const x=this.graphicsCoreOwner.view.basemapTerrain;if(!(this.extent&&x&&x.ready&&this._scaleRangeActive&&this.layerScaleEnabled))this._finishUpdate(!0);else if(!this.layerScaleRangeVisibilityQuery){this.layerScaleRangeVisibilityQuery=
!0;const u=this.layer.effectiveScaleRange;x.queryVisibleScaleRange(this.extent,u.minScale,u.maxScale,E=>this._finishUpdate(E))}};r._finishUpdate=function(x){this.layerScaleRangeVisibilityQuery=!1;this._set("suspended",!x);this._set("updating",!1)};r._visibleAtLayerScale=function(x){const u=this.layer.effectiveScaleRange;return!this.layerScaleEnabled||z.scaleBoundsPredicate(x,u.minScale||0,u.maxScale||0)};r._visibleAtLabelScale=function(x,u){return z.scaleBoundsPredicate(x,u.minScale||0,u.maxScale||
0)};r._graphicScale=function(x){let u;h.isSome(x.centroid)?u=x.centroid:h.isSome(x.graphic.geometry)&&"point"===x.graphic.geometry.type&&(u=x.graphic.geometry);return u?this.graphicsCoreOwner.view.basemapTerrain?this.graphicsCoreOwner.view.basemapTerrain.getScale(u):1:null};r._graphicVisible=function(x){if(!this.layerScaleEnabled)return!0;x=this._graphicScale(x);return this._visibleAtLayerScale(x)};r.updateVisibility=function(x){if(this._scaleRangeActive){const u=this._graphicVisible(x);return x.setVisibilityFlag(m.VisibilityFlag.SCALE_RANGE,
u,m.VisibilityGroup.GRAPHIC)}return!1};r.updateGraphicLabelScaleVisibility=function(x){if(!this._scaleRangeActive||!x.labelGraphics||0===x.labelGraphics.length)return!1;const u=this._graphicScale(x);if(x=this._updateLabelScaleVisibility(x,u))this.graphicsCoreOwner.view.deconflictor.setDirty(),this.graphicsCoreOwner.view.labeler.setDirty();return x};r._updateLabelScaleVisibility=function(x,u){if(!x.labelGraphics||0===x.labelGraphics.length)return!1;const E=x.labelGraphics[0]._labelClass;return E&&
null!=E.minScale&&null!=E.maxScale&&(u=this._visibleAtLabelScale(u,E),x.setVisibilityFlag(m.VisibilityFlag.SCALE_RANGE,u,m.VisibilityGroup.LABEL))?!0:!1};r._scaleUpdateHandler=function(x){this._setDirty();if(!this.graphicsCoreOwner.suspended){var u=x.extent,E=x.scale,y=this._visibleAtLayerScale(E),A=!1;this.queryGraphicUIDsInExtent(u,x.spatialReference,p=>{p=this.graphicsCore.getGraphics3DGraphicById(p);if(!h.isNone(p)){var B=p.centroid;h.isSome(B)&&(u[0]>B.x||u[1]>B.y||u[2]<B.x||u[3]<B.y)||(p.setVisibilityFlag(m.VisibilityFlag.SCALE_RANGE,
y,m.VisibilityGroup.GRAPHIC)&&(A=!0),this._updateLabelScaleVisibility(p,E)&&(A=!0))}});A&&(this.graphicsCoreOwner.view.deconflictor.setDirty(),this.graphicsCoreOwner.view.labeler.setDirty())}};r.layerMinMaxScaleChangeHandler=function(){this.updateScaleRangeActive()&&!this._scaleRangeActive?this.graphicsCore.modifyGraphics3DGraphicVisibilities(x=>x.clearVisibilityFlag(m.VisibilityFlag.SCALE_RANGE)):this._scaleRangeActive&&this.graphicsCore.updateAllGraphicsVisibility();this._setDirty()};a._createClass(t,
[{key:"running",get:function(){return!(!this.graphicsCoreOwner.view.basemapTerrain||!this.updating)}}]);return t}(c);b.__decorate([w.property({constructOnly:!0})],c.prototype,"layerScaleEnabled",void 0);b.__decorate([w.property({readOnly:!0})],c.prototype,"suspended",void 0);b.__decorate([w.property({readOnly:!0})],c.prototype,"updating",void 0);return c=b.__decorate([k.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],c)})},"esri/views/3d/layers/support/attributeUtils":function(){define(["exports"],
function(a){a.attributeLookup=function(b,c,g){if(!g||null==c)return null;if(!b){a:{b=g.toLowerCase();for(var h in c)if(h.toLowerCase()===b){c=c[h];break a}c=null}return c}return(h=b.get(g))?c[h.name]:null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/HeatmapFeatureProcessor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/byteSizeEstimations ../../../../core/Error ../../../../core/HandleOwner ../../../../core/handleUtils ../../../../core/Logger ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/scaleUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ../../../../layers/graphics/OptimizedFeature ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/data/FeatureStore ../../../../layers/support/fieldUtils ../../../../renderers/support/heatmapUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/ModelDirtyTypes ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/HeatmapDensityMaterial".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H,M,K){const I=f.getLogger("esri.views.3d.layers.support.HeatmapFeatureProcessor");a.HeatmapFeatureProcessor=function(Q){function J(N){N=Q.call(this,N)||this;N.type="heatmap";N.filterVisibility={filterChanged(){},dirty:!1};N.preferredUpdatePolicy=F.UpdatePolicy.ASYNC;N.dataExtent=null;N._renderGeometries=new Map;N._material=new K.HeatmapDensityMaterial({});N._materialWithField=new K.HeatmapDensityMaterial({isAttributeDriven:!0});
N._fieldTotal=0;N._memoryFactor=1;return N}b._inheritsLoose(J,Q);var P=J.prototype;P.initialize=function(){this._featureStore=new p({geometryType:"esriGeometryPoint",hasZ:this.hasZ,hasM:this.hasM});const {colorBufferFloat:N,textureFloat:R}=this._renderView.capabilities,{floatBufferBlendWorking:S}=this._renderView.renderingContext.driverTest;if(null==R||!R.textureFloat)throw new h("heatmap:missing-texture-float","HeatmapRenderer requires WebGL2 or the WebGL1 extension OES_texture_float.");if(null==
N||!N.textureFloat)throw new h("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL2 extension EXT_color_buffer_float or the WebGL1 extension WEBGL_color_buffer_float.");if(null==N||!N.floatBlend)throw new h("heatmap:missing-float-blend","HeatmapRenderer requires the WebGL extension EXT_float_blend.");if(!S)throw new h("heatmap:missing-float-blend","HeatmapRenderer requires the WebGL extension EXT_float_blend. This device claims support for it, but does not actually support it.");
this._memoryFactor=this.owner.view.resourceController.memoryController.memoryFactor;this.updatingHandles.addOnCollectionChange(()=>this._loadedPointGraphics,T=>this._onLoadedFeaturesChange(T),k.initial);this.updatingHandles.addWhen(()=>this._materialParameters,T=>this._forEachMaterial(V=>V.setParameters(T)),k.initial);this.updatingHandles.add(()=>this._heatmapRendererField,()=>{this._recreate()},k.sync);this.updatingHandles.add(()=>({fieldName:this._heatmapRendererFieldName,numeric:this._heatmapRendererFieldIsNumeric}),
({fieldName:T,numeric:V})=>{if(l.isSome(T)&&V){let W=0;this._featureStore.forEach(U=>{var aa;W+=null!=(aa=U.attributes[T])?aa:0});this._fieldTotal=W}else this._fieldTotal=this._featureStore.numFeatures},k.initial);this.handles.add([k.watch(()=>({fieldName:this._heatmapRendererFieldName,field:this._heatmapRendererField}),({fieldName:T,field:V})=>{if(T&&!V){var W;I.warn(`Heatmap renderer field '${T}' for layer '${null!=(W=this.layer.title)?W:this.layer.id}' not found`)}}),k.watch(()=>({field:this._heatmapRendererField,
numeric:this._heatmapRendererFieldIsNumeric}),({field:T,numeric:V})=>{if(l.isSome(T)&&!V){var W;I.warn(`Heatmap renderer field '${T.name}' for layer '${null!=(W=this.layer.title)?W:this.layer.id}' does not contain numeric values and cannot be used to drive the heatmap density`)}}),this.owner.view.resourceController.memoryController.events.on("quality-changed",()=>{var T,V,W,U,aa;this._memoryFactor=null!=(T=null==(V=this.owner)?void 0:null==(W=V.view)?void 0:null==(U=W.resourceController)?void 0:null==
(aa=U.memoryController)?void 0:aa.memoryFactor)?T:1})])};P.destroy=function(){this._overlayRenderer.removeGeometries(Array.from(this._renderGeometries.values()),this.owner,L.ModelDirty.Geometry.REMOVE);this._renderGeometries.clear();this._material=l.disposeMaybe(this._material);this._materialWithField=l.disposeMaybe(this._materialWithField);this._featureStore.clear();this._featureStore=null};P.whenGraphicBounds=function(){var N=b._asyncToGenerator(function*(){return null});return function(){return N.apply(this,
arguments)}}();P.computeAttachmentOrigin=function(){return null};P.highlight=function(){return O};P.maskOccludee=function(){return O};P.setObjectIdVisibility=function(){};P.setup=function(){var N=b._asyncToGenerator(function*(){});return function(){return N.apply(this,arguments)}}();P._onLoadedFeaturesChange=function(N){if(this._featuresArePoints){var {objectIdField:R}=this.layer;this._featureStore.removeManyById(N.removed.map(T=>u.getObjectId(T,R)));this._featureStore.addMany(N.added.map(T=>new y.OptimizedFeature(E.convertFromPoint(new A,
T.geometry),T.attributes,l.applySome(T.centroid,V=>E.convertFromPoint(new A,V)),u.getObjectId(T,R))));var S=N.added;N=N.removed;this._fieldTotal+=this._computeFieldTotalChange(S,N);N=l.mapSome(N,({uid:T})=>{const V=this._renderGeometries.get(T);this._renderGeometries.delete(T);return V});S=S.map(T=>{const V=this._pointGraphicToRenderGeometry(T);this._renderGeometries.set(T.uid,V);return V});0<N.length&&this._overlayRenderer.removeGeometries(N,this.owner,L.ModelDirty.Geometry.REMOVE);0<S.length&&this._overlayRenderer.addGeometries(S,
this.owner,L.ModelDirty.Geometry.ADD,!0);(0<S.length||0<N.length)&&this._renderView.requestRender()}};P._recreate=function(){if(this._loadedPointGraphics){var N=this._loadedPointGraphics.toArray();this._onLoadedFeaturesChange({added:N,removed:N})}};P._pointGraphicToRenderGeometry=function(N){const R=this._heatmapRendererFieldName,S=l.isSome(R)?this._materialWithField:this._material,T=t.create();r.projectPointToVector(N.geometry,T,this._overlaySpatialReference);T[2]=C.DRAPED_Z;const V=[[M.VertexAttribute.POSITION,
{data:T,size:T.length}]],W=this._heatmapRendererFieldIsNumeric;if(l.isSome(R)){var U;V.push([M.VertexAttribute.FEATUREATTRIBUTE,{data:[W?null!=(U=N.attributes[R])?U:0:0],size:1}])}N=new H.RenderGeometry(new G.Geometry(V,null,F.PrimitiveType.Point),S,{layerUid:this.layer.uid,graphicUid:N.uid});q.copy(N.boundingSphere,T);return N};P._forEachMaterial=function(N){N(this._material);N(this._materialWithField)};P._computeFieldTotalChange=function(N,R){if(l.isNone(this._heatmapRendererFieldName)||!this._heatmapRendererFieldIsNumeric)return N.length-
R.length;const S=this._heatmapRendererFieldName,T=(V,W)=>{var U;return V+(null!=(U=W.attributes[S])?U:0)};return N.reduce(T,0)-R.reduce(T,0)};P._clampSearchRadius=function(N){50<N&&I.warnOnce("SceneView supports a maximum blurRadius of 50 for HeatmapRenderer.");return Math.min(N,50)};b._createClass(J,[{key:"layer",get:function(){return this.owner.layer}},{key:"featureStore",get:function(){return this._featureStore}},{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"updatingRemaining",
get:function(){return 0}},{key:"suspendInfo",get:function(){return{}}},{key:"legendEnabled",get:function(){return!0}},{key:"displayFeatureLimit",get:function(){var N,R;const S=this._memoryFactor,T=null==(N=this.owner)?void 0:null==(R=N.view)?void 0:R.qualitySettings;N=T?Math.ceil(T.heatmap.maxTotalNumberOfFeatures*S):0;return{minimumTotalNumberOfFeatures:0,maximumTotalNumberOfFeatures:N,maximumTotalNumberOfPrimitives:2*N,maximumNumberOfFeatures:N}}},{key:"hasZ",get:function(){return"hasZ"in this.layer&&
this.layer.hasZ}},{key:"hasM",get:function(){return"hasM"in this.layer&&this.layer.hasM}},{key:"scaleVisibilitySuspended",get:function(){return!1}},{key:"usedMemory",get:function(){var N,R,S,T,V;const W=this.usedMemoryPerFeature*this._featureStore.numFeatures,{R32F:U}=null==(N=this._renderView)?void 0:null==(R=N.capabilities)?void 0:R.colorBufferFloat;N=null!=U?1:4;R=null!=(S=Math.ceil((null==(T=this._overlayRenderer)?NaN:null==(V=T.overlays[0])?NaN:V.resolution)*this._densityMapPixelRatio))?S:0;
S=R*R*N*4;T=l.isSome(this._heatmapRenderer)?3*Math.min(this._heatmapRenderer.blurRadius,50):0;return S+W+T*N*4}},{key:"usedMemoryPerFeature",get:function(){if(0===this._featureStore.numFeatures)return 0;let N=0;this._featureStore.forEach(V=>N+=g.estimateAttributesObjectSize(V.attributes));N/=this._featureStore.numFeatures;const R=g.estimateNumberByteSize(),S=6*g.estimateFixedArraySize([0,0,0],R),T=6*g.estimateFixedArraySize([0,0],R);return S+T+(this._heatmapRendererFieldIsNumeric?6*R:0)+N}},{key:"unprocessedMemoryEstimate",
get:function(){return 0}},{key:"performanceInfo",get:function(){return{core:{visible:this._featureStore.numFeatures,missing:0,pending:0},elevationUpdating:!1,visibilityFrustum:!0,visibilityScale:!0}}},{key:"_overlayRenderer",get:function(){return this.owner.view.basemapTerrain.overlayManager.renderer}},{key:"_overlaySpatialReference",get:function(){return l.unwrap(this._overlayRenderer.spatialReference)}},{key:"_materialParameters",get:function(){return{...this._blurRadiusParameters,...this._densityParameters,
colorRampData:this._colorRampData,pixelRatio:this._densityMapPixelRatio}}},{key:"_densityParameters",get:function(){const N=this._heatmapRenderer;return l.isNone(N)?null:{minDensity:N.minPixelIntensity,maxDensity:N.maxPixelIntensity,fieldTotal:this._fieldTotal}}},{key:"_blurRadiusParameters",get:function(){return l.applySome(this._heatmapRenderer,({referenceScale:N,blurRadius:R})=>({searchRadius:this._clampSearchRadius(R),resolutionForScale:0===N?0:x.getResolutionForScale(N,this.owner.view.spatialReference)}))}},
{key:"_colorRampData",get:function(){return l.applySome(this._heatmapRenderer,N=>D.generateGradient(N.colorStops))}},{key:"_densityMapPixelRatio",get:function(){var N,R,S;const T=this._memoryFactor;return(null!=(N=null==(R=this.owner)?void 0:null==(S=R.view)?void 0:S.qualitySettings.heatmap.pixelRatio)?N:1)*Math.sqrt(T)}},{key:"_renderView",get:function(){return this.owner.view._stage.renderView}},{key:"_featuresArePoints",get:function(){return"point"===this.layer.geometryType}},{key:"_loadedPointGraphics",
get:function(){return this.owner.loadedGraphics}},{key:"_heatmapRenderer",get:function(){const N=this.layer.renderer;return"heatmap"===(null==N?void 0:N.type)?N:null}},{key:"_heatmapRendererFieldName",get:function(){return l.applySome(this._heatmapRenderer,N=>N.field)}},{key:"_heatmapRendererField",get:function(){return l.applySome(this._heatmapRendererFieldName,N=>this.layer.fieldsIndex.get(N))}},{key:"_heatmapRendererFieldIsNumeric",get:function(){const N=this._heatmapRendererField;return l.isNone(N)?
!1:B.isNumericField(N)}}]);return J}(w.HandleOwner);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"type",void 0);c.__decorate([e.property({constructOnly:!0})],a.HeatmapFeatureProcessor.prototype,"owner",void 0);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"layer",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"featureStore",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"updating",null);c.__decorate([e.property()],
a.HeatmapFeatureProcessor.prototype,"updatingRemaining",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"suspendInfo",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"legendEnabled",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"filterVisibility",void 0);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"displayFeatureLimit",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"preferredUpdatePolicy",
void 0);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"hasZ",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"hasM",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"dataExtent",void 0);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_featureStore",void 0);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_overlayRenderer",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_overlaySpatialReference",
null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_materialParameters",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_densityParameters",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_blurRadiusParameters",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_colorRampData",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_densityMapPixelRatio",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,
"_renderGeometries",void 0);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_material",void 0);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_materialWithField",void 0);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_renderView",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_featuresArePoints",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_loadedPointGraphics",null);c.__decorate([e.property()],
a.HeatmapFeatureProcessor.prototype,"_heatmapRenderer",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRendererFieldName",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRendererField",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRendererFieldIsNumeric",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_fieldTotal",void 0);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,
"_memoryFactor",void 0);a.HeatmapFeatureProcessor=c.__decorate([v.subclass("esri.views.3d.layers.support.HeatmapFeatureProcessor")],a.HeatmapFeatureProcessor);const O=n.makeHandle();a.MAX_RADIUS=50;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/graphics/data/FeatureStore":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../core/Evented ../../../core/Logger ../../../core/maybe ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../featureConversionUtils ./BoundsStore ./optimizedFeatureQueryEngineAdapter".split(" "),
function(a,b,c,g,h,w,n,f,l,k){return function(){function e(m){this.geometryInfo=m;this._boundsStore=new l.BoundsStore;this._featuresById=new Map;this._markedIds=new Set;this.events=new c;this.featureAdapter=k.optimizedFeatureQueryEngineAdapter}var d=e.prototype;d.add=function(m){this._add(m);this._emitChanged()};d.addMany=function(m){for(const z of m)this._add(z);this._emitChanged()};d.clear=function(){this._featuresById.clear();this._boundsStore.clear();this._emitChanged()};d.removeById=function(m){m=
this._featuresById.get(m);if(!m)return null;this._remove(m);this._emitChanged();return m};d.removeManyById=function(m){this._boundsStore.invalidateIndex();for(const z of m)(m=this._featuresById.get(z))&&this._remove(m);this._emitChanged()};d.forEachBounds=function(m,z,v){for(const q of m)(m=this._boundsStore.get(q.objectId))&&z(w.fromRect(v,m))};d.getFeature=function(m){return this._featuresById.get(m)};d.has=function(m){return this._featuresById.has(m)};d.forEach=function(m){this._featuresById.forEach(z=>
m(z))};d.forEachInBounds=function(m,z){this._boundsStore.forEachInBounds(m,v=>{z(this._featuresById.get(v))})};d.startMarkingUsedFeatures=function(){this._boundsStore.invalidateIndex();this._markedIds.clear()};d.sweep=function(){let m=!1;this._featuresById.forEach((z,v)=>{this._markedIds.has(v)||(m=!0,this._remove(z))});this._markedIds.clear();m&&this._emitChanged()};d._emitChanged=function(){this.events.emit("changed",void 0)};d._add=function(m){if(m){var z=m.objectId;if(null==z)g.getLogger("esri.layers.graphics.data.FeatureStore").error(new b("featurestore:invalid-feature",
"feature id is missing",{feature:m}));else{var v=this._featuresById.get(z);this._markedIds.add(z);if(v){m.displayId=v.displayId;var q=this._boundsStore.get(z);this._boundsStore.delete(z)}else if(h.isSome(this.onFeatureAdd))this.onFeatureAdd(m);!h.isNone(m.geometry)&&m.geometry.coords&&m.geometry.coords.length?(q=f.getBoundsOptimizedGeometry(h.isSome(q)?q:n.create(),m.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),h.isSome(q)&&this._boundsStore.set(z,q)):this._boundsStore.set(z,null);this._featuresById.set(z,
m)}}};d._remove=function(m){if(h.isSome(this.onFeatureRemove))this.onFeatureRemove(m);this._markedIds.delete(m.objectId);this._boundsStore.delete(m.objectId);this._featuresById.delete(m.objectId);return m};a._createClass(e,[{key:"geometryType",get:function(){return this.geometryInfo.geometryType}},{key:"hasM",get:function(){return this.geometryInfo.hasM}},{key:"hasZ",get:function(){return this.geometryInfo.hasZ}},{key:"numFeatures",get:function(){return this._featuresById.size}},{key:"fullBounds",
get:function(){if(!this.numFeatures)return null;const m=n.create(n.NEGATIVE_INFINITY);this._featuresById.forEach(z=>{if(z=this._boundsStore.get(z.objectId))m[0]=Math.min(z[0],m[0]),m[1]=Math.min(z[1],m[1]),m[2]=Math.max(z[2],m[2]),m[3]=Math.max(z[3],m[3])});return m}},{key:"storeStatistics",get:function(){let m=0;this._featuresById.forEach(z=>{h.isSome(z.geometry)&&z.geometry.coords&&(m+=z.geometry.coords.length)});return{featureCount:this._featuresById.size,vertexCount:m/(this.hasZ?this.hasM?4:3:
this.hasM?3:2)}}}]);return e}()})},"esri/layers/graphics/data/BoundsStore":function(){define(["exports","../../../core/has","../../../core/libs/rbush/PooledRBush"],function(a,b,c){function g(n,f,l){h.minX=f[0];h.minY=f[1];h.maxX=f[2];h.maxY=f[3];n.search(h,l)}const h={minX:0,minY:0,maxX:0,maxY:0};let w=function(){function n(){this._indexInvalid=!1;this._boundsToLoad=[];this._boundsById=new Map;this._idByBounds=new Map;this._index=new c.PooledRBush(9,b("esri-csp-restrictions")?l=>({minX:l[0],minY:l[1],
maxX:l[2],maxY:l[3]}):["[0]","[1]","[2]","[3]"]);this._loadIndex=()=>{if(this._indexInvalid){const l=Array(this._idByBounds.size);let k=0;this._idByBounds.forEach((e,d)=>{l[k++]=d});this._indexInvalid=!1;this._index.clear();this._index.load(l)}else this._boundsToLoad.length&&(this._index.load(this._boundsToLoad.filter(l=>this._idByBounds.has(l))),this._boundsToLoad.length=0)}}var f=n.prototype;f.clear=function(){this._indexInvalid=!1;this._boundsToLoad.length=0;this._boundsById.clear();this._idByBounds.clear();
this._index.clear()};f.delete=function(l){const k=this._boundsById.get(l);this._boundsById.delete(l);k&&(this._idByBounds.delete(k),this._indexInvalid||this._index.remove(k))};f.forEachInBounds=function(l,k){this._loadIndex();g(this._index,l,e=>k(this._idByBounds.get(e)))};f.get=function(l){return this._boundsById.get(l)};f.has=function(l){return this._boundsById.has(l)};f.invalidateIndex=function(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)};f.set=function(l,k){if(!this._indexInvalid){const e=
this._boundsById.get(l);e&&(this._index.remove(e),this._idByBounds.delete(e))}this._boundsById.set(l,k);k&&(this._idByBounds.set(k,l),this._indexInvalid||(this._boundsToLoad.push(k),5E4<this._boundsToLoad.length&&this._loadIndex()))};return n}();a.BoundsStore=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/projectExtentUtils":function(){define(["exports","../../../../core/maybe","../../../../geometry/support/webMercatorUtils","../../../../portal/support/geometryServiceUtils"],
function(a,b,c,g){a.toViewIfLocal=function(h){const w=h.view.spatialReference,n=h.layer.fullExtent;var f=b.isSome(n)&&n.spatialReference;if(b.isNone(n)||!f)return Promise.resolve(null);if(f.equals(w))return Promise.resolve(n.clone());f=c.project(n,w);return b.isSome(f)?Promise.resolve(f):h.view.state.isLocal?g.projectGeometry(n,w,h.layer.portalItem).then(l=>!h.destroyed&&l?l:void 0).catch(()=>null):Promise.resolve(null)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileFetcher3DLayerViewContext":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","./FeatureTileFetcher3D","./featureTileQuery3D"],function(a,b,c,g,h){let w=function(){function n(l){this._capabilities=this._memoryCache=null;const k=l.layerView.layer;this.layerView=l.layerView;this.objectIdField=k.objectIdField;this.globalIdField="globalIdField"in k?k.globalIdField:null;this.returnZ=l.returnZ;this.returnM=l.returnM;const e=this.layerView.view.resourceController;this.query=h.createFeatureTileQuery3D(k,d=>e.schedule(d));
e&&this.memoryCacheEnabled&&(this._memoryCache=e.memoryController.newCache(k.uid))}var f=n.prototype;f.destroy=function(){this._memoryCache=c.destroyMaybe(this._memoryCache);this.query.destroy()};f.createQuery=function(){const l=this.layerView.layer.createQuery();l.outFields=this.layerView.availableFields;l.returnZ=this.returnZ;l.returnM=this.returnM;l.outSpatialReference=this.tilingScheme.spatialReference;return l};f.logFetchError=function(l,k){l.error("#fetchTile()",this.layerView.layer,k&&k.message?
k.message:k)};b._createClass(n,[{key:"memoryCacheEnabled",get:function(){switch(this.layerView.layer.source.type){case "feature-layer":case "ogc-feature":return!0;case "csv":case "geojson":case "memory":case "wfs":return!1}}},{key:"memoryCache",get:function(){return this._memoryCache}},{key:"viewingMode",get:function(){return this.layerView.view.state.viewingMode}},{key:"tilingScheme",get:function(){return this.layerView.view.featureTiles.tilingScheme}},{key:"scheduler",get:function(){const l=this.layerView.view.resourceController;
return l?l.scheduler:null}},{key:"geometryType",get:function(){return this.layerView.layer.geometryType}},{key:"fullExtent",get:function(){return this.layerView.layer.fullExtent}},{key:"tileMaxRecordCount",get:function(){return this.layerView.layer.capabilities.query.tileMaxRecordCount}},{key:"maxRecordCount",get:function(){return this.layerView.layer.capabilities.query.maxRecordCount}},{key:"capabilities",get:function(){return c.isSome(this._capabilities)?this._capabilities:this._capabilities=g.contextCapabilitiesFromLayer(this.layerView.layer)}}]);
return n}();a.FeatureTileFetcher3DLayerViewContext=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/featureTileQuery3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../layers/graphics/dehydratedFeatures ../../../../rest/query/operations/query ../../support/PBFDecoder".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z){let v=function(x){function u(y){return x.call(this,y)||this}b._inheritsLoose(u,x);var E=u.prototype;E.queryFeatureCount=function(y,A){return this.layer.queryFeatureCount(y,A)};E.destroy=function(){this._decoder=h.destroyMaybe(this._decoder)};E._createRequestOptions=function(y){return{...y,query:{...this.layer.customParameters,token:this.layer.apiKey,...null==y?void 0:y.query}}};b._createClass(u,[{key:"queryFeaturesDehydrated",get:function(){var y=this.layer.capabilities;
if((y=y&&y.query)&&y.supportsFormatPBF){var A,p;h.isNone(this._decoder)&&(this._decoder=new z.PBFDecoder(this.schedule));const B={sourceSpatialReference:null!=(A=null==(p=this.layer.spatialReference)?void 0:p.toJSON())?A:null,applyTransform:!0,maxStringAttributeLength:1024};return(D,C)=>m.runQuery(this.layer.parsedUrl,D,"pbf",this._createRequestOptions(C)).then(F=>{w.throwIfAborted(C);return h.isSome(this._decoder)?this._decoder.invoke({buffer:F.data,options:B},C.signal):Promise.reject(w.createAbortError())})}return(B,
D)=>m.executeQuery(this.layer.parsedUrl,B,this.layer.spatialReference,this._createRequestOptions(D)).then(C=>d.fromFeatureSetJSON(C.data))}}]);return u}(g);c.__decorate([n.property({constructOnly:!0})],v.prototype,"layer",void 0);c.__decorate([n.property({constructOnly:!0})],v.prototype,"schedule",void 0);c.__decorate([n.property({readOnly:!0})],v.prototype,"queryFeaturesDehydrated",null);v=c.__decorate([e.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],v);let q=
function(x){function u(y){return x.call(this,y)||this}b._inheritsLoose(u,x);var E=u.prototype;E.queryFeaturesDehydrated=function(y,A){return this.layer.queryFeatures(y,A)};E.queryFeatureCount=function(y,A){return this.layer.queryFeatureCount(y,A)};return u}(g);c.__decorate([n.property({constructOnly:!0})],q.prototype,"layer",void 0);c.__decorate([n.property({readOnly:!0})],q.prototype,"queryFeaturesDehydrated",null);q=c.__decorate([e.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceMeshQuery3D")],
q);let t=function(x){function u(E){return x.call(this,E)||this}b._inheritsLoose(u,x);u.prototype.queryFeaturesDehydrated=function(E,y){return this.layer.queryFeatures(E,y)};return u}(g);c.__decorate([n.property({constructOnly:!0})],t.prototype,"layer",void 0);t=c.__decorate([e.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],t);let r=function(x){function u(y){return x.call(this,y)||this}b._inheritsLoose(u,x);var E=u.prototype;E.queryFeaturesDehydrated=function(y,
A){return this.source.queryFeaturesJSON(y,A).then(d.fromFeatureSetJSON,p=>{if(p&&"query-features-json:unsupported"===p.name)return this.layer.queryFeatures(y,A);throw p;})};E.queryFeatureCount=function(y,A){return this.layer.queryFeatureCount(y,A)};return u}(g);c.__decorate([n.property({constructOnly:!0})],r.prototype,"layer",void 0);c.__decorate([n.property({constructOnly:!0})],r.prototype,"source",void 0);r=c.__decorate([e.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],
r);a.createFeatureTileQuery3D=function(x,u){return"feature"===x.type&&"feature-layer"===x.source.type?h.isSome(x.infoFor3D)?new q({layer:x}):new v({layer:x,schedule:u}):"feature"===x.type&&"memory"===x.source.type||"csv"===x.type||"geojson"===x.type||"wfs"===x.type?new r({layer:x,source:x.source}):"ogc-feature"===x.type?new t({layer:x}):null};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/PBFDecoder":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Graphic ../../../core/maybe ../../../core/workers/WorkerHandle ../../../geometry/SpatialReference ../../../layers/support/Field".split(" "),
function(a,b,c,g,h,w,n){let f=function(){function k(d){this._schedule=d;this._handle=new l(d)}var e=k.prototype;e.destroy=function(){this._handle.destroy()};e.invoke=function(d,m){if(!d.buffer||0===d.buffer.byteLength)return Promise.resolve(null);d.options.sourceSpatialReference&&d.options.sourceSpatialReference instanceof w&&(d.options={...d.options,sourceSpatialReference:d.options.sourceSpatialReference.toJSON()});return this._handle.invoke(d,m).then(z=>this._schedule(()=>{z.spatialReference=w.fromJSON(z.spatialReference);
if(z.fields)for(var v=0;v<z.fields.length;v++)z.fields[v]=n.fromJSON(z.fields[v]);v=z.spatialReference;for(const q of z.features)q.uid=c.generateUID(),g.isSome(q.geometry)&&(q.geometry.spatialReference=v);return z}))};return k}(),l=function(k){function e(d){return k.call(this,"PBFDecoderWorker","_parseFeatureQuery",d)||this}b._inheritsLoose(e,k);e.prototype.getTransferList=function(d){return[d.buffer]};return e}(h.WorkerHandle);a.PBFDecoder=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/EventedSet":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../core/Evented","../../../core/ObservableChangesType","../../../core/SetUtils"],function(a,b,c,g,h){c=function(w){function n(){var l=w.apply(this,arguments)||this;l._set=new Set;return l}b._inheritsLoose(n,w);var f=n.prototype;f.clear=function(){if(0<this._set.size){const l=this.toArray();this._set.clear();this.emit("after-changes",{type:g.ObservableChangesType.REMOVE});this.emit("change",{added:[],removed:l})}};f.addMany=function(l){if(0!==l.length){for(const k of l)this._set.add(k);
this.emit("after-changes",{type:g.ObservableChangesType.ADD});this.emit("change",{added:l,removed:[]})}};f.remove=function(l){this._set.delete(l)&&(this.emit("after-changes",{type:g.ObservableChangesType.REMOVE}),this.emit("change",{added:[],removed:[l]}))};f.removeMany=function(l){const k=[];for(const e of l)this._set.delete(e)&&k.push(e);0<k.length&&(this.emit("after-changes",{type:g.ObservableChangesType.REMOVE}),this.emit("change",{added:[],removed:k}))};f.toArray=function(){return[...this._set]};
f.find=function(l){let k;h.someSet(this._set,e=>l(e)?(k=e,!0):!1);return k};f.forEach=function(l){this._set.forEach(k=>l(k))};b._createClass(n,[{key:"length",get:function(){return this._set.size}}]);return n}(c);a.EventedSet=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/layers/FeatureLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/deprecate ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../layers/support/commonProperties ../../layers/support/FeatureEffect ../../layers/support/FeatureFilter ../../layers/support/fieldUtils ../../rest/support/Query ../../support/arcadeOnDemand ./support/popupUtils ../support/floorFilterUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y){const A=w.getLogger("esri.views.layers.FeatureLayerView");w=p=>{p=function(B){function D(...F){F=B.call(this,...F)||this;F._updatingRequiredFieldsPromise=null;F.filter=null;F.timeExtent=null;F.layer=null;F.requiredFields=[];F.view=null;return F}b._inheritsLoose(D,B);var C=D.prototype;C.initialize=function(){l.init(this,"layer.renderer layer.labelingInfo layer.elevationInfo.featureExpressionInfo layer.displayField filter featureEffect layer.timeInfo layer.floorInfo timeExtent".split(" "),
()=>this._handleRequiredFieldsChange(),!0);l.on(this,"view.floors","change",()=>this._handleRequiredFieldsChange());l.on(this,"layer.sublayer","change",()=>this._handleRequiredFieldsChange())};C.highlight=function(F){throw Error("missing implementation");};C.createQuery=function(){var F={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};F=n.isSome(this.filter)?this.filter.createQuery(F):new x(F);if("feature"===this.layer.type){const G=y.getFloorFilterClause(this);n.isSome(G)&&
(F.where=F.where?`(${F.where}) AND (${G})`:G)}n.isSome(this.timeExtent)&&(F.timeExtent=n.isSome(F.timeExtent)?F.timeExtent.intersection(this.timeExtent):this.timeExtent.clone());return F};C.queryFeatures=function(F,G){throw Error("missing implementation");};C.queryObjectIds=function(F,G){throw Error("missing implementation");};C.queryFeatureCount=function(F,G){throw Error("missing implementation");};C.queryExtent=function(F,G){throw Error("missing implementation");};C.fetchPopupFeatures=function(){var F=
b._asyncToGenerator(function*(G,L){if(G=this.validateFetchPopupFeatures(L))throw G;return this.fetchClientPopupFeatures(L)});return function(G,L){return F.apply(this,arguments)}}();C._loadArcadeModules=function(F){if(F.get("expressionInfos.length")||Array.isArray(F.content)&&F.content.some(G=>"expression"===G.type))return u.loadArcade()};C._handleRequiredFieldsChange=function(){const F=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",F);F.then(()=>{this._updatingRequiredFieldsPromise===
F&&this._set("_updatingRequiredFieldsPromise",null)})};C._updateRequiredFields=function(){var F=b._asyncToGenerator(function*(){if(this.layer&&this.view){var G="3d"===this.view.type,{layer:L,layer:{fieldsIndex:H,objectIdField:M}}=this,K="renderer"in L&&L.renderer,I="orderBy"in L&&L.orderBy,O=L.featureReduction,Q=new Set;K=yield f.eachAlways([K?K.collectRequiredFields(Q,H):null,r.collectLabelingFields(Q,L),G?r.collectElevationFields(Q,L):null,n.isSome(this.filter)?r.collectFilterFields(Q,L,this.filter):
null,n.isSome(this.featureEffect)?r.collectFilterFields(Q,L,this.featureEffect.filter):null,O?r.collectFeatureReductionFields(Q,L,O):null,I?r.collectOrderByInfos(Q,L,I):null]);L.timeInfo&&this.timeExtent&&r.collectFields(Q,L.fieldsIndex,[L.timeInfo.startField,L.timeInfo.endField]);"feature"===L.type&&L.floorInfo&&r.collectFields(Q,L.fieldsIndex,[L.floorInfo.floorField]);"subtype-group"===L.type&&(r.collectField(Q,H,L.subtypeField),I=L.sublayers.map(J=>{var P;return Promise.all([null==(P=J.renderer)?
void 0:P.collectRequiredFields(Q,H),r.collectLabelingFields(Q,J)])}),yield f.eachAlways(I));for(const J of K)J.error&&A.error(J.error);r.collectField(Q,H,M);G&&"displayField"in L&&L.displayField&&r.collectField(Q,H,L.displayField);G=Array.from(Q).sort();this._set("requiredFields",G)}});return function(){return F.apply(this,arguments)}}();C.validateFetchPopupFeatures=function(F){if(n.isNone(F))return null;for(const G of F.clientGraphics){const L=G.layer;if("popupEnabled"in L&&!L.popupEnabled)return new h("featurelayerview:fetchPopupFeatures",
"Popups are disabled",{layer:L});if("popupTemplate"in L&&!E.getFetchPopupTemplate(L,F))return new h("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:L});if(G.isAggregate&&!(L.featureReduction&&"popupTemplate"in L.featureReduction&&L.featureReduction.popupEnabled&&L.featureReduction.popupTemplate))return new h("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:L})}};C.fetchClientPopupFeatures=function(){var F=b._asyncToGenerator(function*(G){const L=
n.isSome(G)?G.clientGraphics:null;if(!L||0===L.length)return[];const H=Array(L.length),M=new Map,K=yield this.createPopupQuery(G);for(let O=0;O<L.length;O++){const Q=L[O];if(Q.isAggregate){H[O]=Q;continue}var {layer:I}=Q;if(!("popupEnabled"in I))continue;const J=r.unpackFieldNames(this.layer.fieldsIndex,K.outFields);I=E.getFetchPopupTemplate(I,G);if(!n.isSome(I))continue;const P=yield this._loadArcadeModules(I);P&&P.arcadeUtils.hasGeometryOperations(I)||!r.featureHasFields(J,Q)?M.set(Q.getObjectId(),
O):H[O]=Q}if("stream"===this.layer.type||0===M.size)return H.filter(Boolean);K.objectIds=Array.from(M.keys());try{const O=yield this.layer.queryFeatures(K);for(const Q of O.features){const J=M.get(Q.getObjectId());H[J]=Q}}catch{}return H.filter(Boolean)});return function(G){return F.apply(this,arguments)}}();C.createPopupQuery=function(){var F=b._asyncToGenerator(function*(G){const L=this.layer.createQuery(),H=new Set;var M=!1,K=n.isSome(G)&&G.clientGraphics?G.clientGraphics.map(I=>I.layer):[this.layer];
for(const I of K)if("popupEnabled"in I&&(K=E.getFetchPopupTemplate(I,G),n.isSome(K))){M=(M=yield this._loadArcadeModules(K))&&M.arcadeUtils.hasGeometryOperations(K);M=!("point"!==this.layer.geometryType&&!M);K=yield E.getRequiredFields(this.layer,K);for(const O of K)H.add(O)}L.returnGeometry=M;L.returnZ=M;L.returnM=M;L.outFields=Array.from(H);L.outSpatialReference=this.view.spatialReference;"feature"===this.layer.type&&(G=y.getFloorFilterClause(this),n.isSome(G)&&(L.where=L.where?`(${L.where}) AND (${G})`:
G));return L});return function(G){return F.apply(this,arguments)}}();C.canResume=function(){return!B.prototype.canResume.call(this)||n.isSome(this.timeExtent)&&this.timeExtent.isEmpty?!1:!0};b._createClass(D,[{key:"availableFields",get:function(){const {layer:F,layer:{fieldsIndex:G},requiredFields:L}=this;return"outFields"in F&&F.outFields?r.fixFields(G,[...r.unpackFieldNames(G,F.outFields),...L]):r.fixFields(G,L)}},{key:"effect",get:function(){g.deprecatedProperty(A,"effect",{replacement:"featureEffect",
version:"4.22"});return this.featureEffect},set:function(F){g.deprecatedProperty(A,"effect",{replacement:"featureEffect",version:"4.22"});this.featureEffect=F}},{key:"featureEffect",get:function(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null},set:function(F){void 0===F?this._clearOverride("featureEffect"):this._override("featureEffect",F)}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(F){A.error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")}},
{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}}]);return D}(p);c.__decorate([k.property()],p.prototype,"_updatingRequiredFieldsPromise",void 0);c.__decorate([k.property({readOnly:!0})],p.prototype,"availableFields",null);c.__decorate([k.property()],p.prototype,"effect",null);c.__decorate([k.property({type:q})],p.prototype,"featureEffect",null);c.__decorate([k.property({type:t})],p.prototype,"filter",void 0);c.__decorate([k.property(v.combinedViewLayerTimeExtentProperty)],p.prototype,
"timeExtent",void 0);c.__decorate([k.property()],p.prototype,"layer",void 0);c.__decorate([k.property({type:Number})],p.prototype,"maximumNumberOfFeatures",null);c.__decorate([k.property({readOnly:!0,type:Boolean})],p.prototype,"maximumNumberOfFeaturesExceeded",null);c.__decorate([k.property({readOnly:!0})],p.prototype,"requiredFields",void 0);c.__decorate([k.property()],p.prototype,"suspended",void 0);c.__decorate([k.property()],p.prototype,"view",void 0);return p=c.__decorate([z.subclass("esri.views.layers.FeatureLayerView")],
p)};a.FeatureLayerView=w;a.default=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../layers/support/fieldUtils"],function(a,b,c,g){function h(){h=b._asyncToGenerator(function*(w,n=w.popupTemplate){if(!c.isSome(n))return[];const f=yield n.getRequiredFields(w.fieldsIndex);({lastEditInfoEnabled:n}=n);const {objectIdField:l,typeIdField:k,globalIdField:e,relationships:d}=
w;if(f.includes("*"))return["*"];n=n?yield g.getFeatureEditFields(w):[];const m=g.fixFields(w.fieldsIndex,[...f,...n]);k&&m.push(k);m&&l&&w.fieldsIndex.has(l)&&-1===m.indexOf(l)&&m.push(l);m&&e&&w.fieldsIndex.has(e)&&-1===m.indexOf(e)&&m.push(e);d&&d.forEach(z=>{({keyField:z}=z);m&&z&&w.fieldsIndex.has(z)&&-1===m.indexOf(z)&&m.push(z)});return m});return h.apply(this,arguments)}a.getFetchPopupTemplate=function(w,n){return w.popupTemplate?w.popupTemplate:c.isSome(n)&&n.defaultPopupTemplateEnabled&&
c.isSome(w.defaultPopupTemplate)?w.defaultPopupTemplate:null};a.getRequiredFields=function(w){return h.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/layers/RefreshableLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){f=d=>{d=function(m){function z(){return m.apply(this,arguments)||this}b._inheritsLoose(z,m);z.prototype.initialize=function(){this.handles.add(w.on(()=>this.layer,"refresh",v=>{this.doRefresh(v.dataChanged).catch(q=>{h.isAbortError(q)||g.getLogger(this.declaredClass).error(q)})}),"RefreshableLayerView")};return z}(d);c.__decorate([n.property()],d.prototype,"layer",void 0);return d=c.__decorate([e.subclass("esri.layers.mixins.RefreshableLayerView")],d)};a.RefreshableLayerView=
f;a.default=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/PointCloudLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/asyncUtils ../../../core/Collection ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/screenUtils ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/plane ../../../layers/graphics/dehydratedFeatures ../../../layers/support/CodedValue ../../../layers/support/CodedValueDomain ../../../layers/support/Domain ../../../layers/support/InheritedDomain ../../../layers/support/RangeDomain ../../../layers/support/fieldUtils ../../../layers/support/PromiseQueue ../../../symbols/support/unitConversionUtils ./LayerView3D ./PointCloudWorkerHandle ./i3s/I3SUtil ./i3s/LoDUtil ./i3s/PagedNodeIndex ./i3s/PointCloudRendererUtil ./i3s/PointCloudWorkerUtil ./i3s/PointGraphic ./i3s/PointRenderer ./support/PopupSceneLayerView ../support/extentUtils ../support/index ../support/orientedBoundingBox ../support/updatingProperties ../webgl-engine/lib/RenderSlot ../../layers/LayerView ../../support/layerViewUtils ../../support/Scheduler".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H,M,K,I,O,Q,J,P,N,R,S,T,V,W,U,aa,da,Y,ea){const ja=h.getLogger("esri.views.3d.layers.PointCloudLayerView3D"),la=y.create();h=function(ca){function fa(){var Z=ca.apply(this,arguments)||this;Z.type="point-cloud-3d";Z.maximumPointCount=4E6;Z.slicePlaneEnabled=!1;Z._renderer=null;Z._rendererAdded=!1;Z._renderedNodes=new Set;Z._nodeScales=new Map;Z._updateViewNeeded=!0;Z._lodFactor=1;Z._maxLoggedBoxWarnings=5;Z._pageMultiplier=1;Z._nodeLoadEpoch=
0;Z._indexQueue=[];Z._workQueue=[];Z._idleQueue=new L.PromiseQueue;Z._indexPagesLoading=new Map;Z._loadingNodes=new Map;Z._recalcWork=!0;Z._layerIsVisible=!1;Z._codedDomainPopulationPromise=null;Z._codedDomainPopulationAbortController=null;Z._totalWork=0;Z._index=null;Z._loadingInitNodePage=!1;Z._nodeIdArray=[];return Z}a._inheritsLoose(fa,ca);var ba=fa.prototype;ba.initialize=function(){const Z=this.view.resourceController;this._worker=new K.PointCloudWorkerHandle(pa=>Z.schedule(pa));this.addResolvingPromise(this._worker.promise);
this._tmpPoint=A.makeDehydratedPoint(0,0,0,this.layer.spatialReference);I.checkPointCloudLayerValid(this.layer);I.checkPointCloudLayerCompatibleWithView(this.layer,this.view);this._indexRequester=Z.createStreamDataRequester(V.ClientType.I3S_INDEX);this._dataRequester=Z.createStreamDataRequester(V.ClientType.I3S_DATA);this._initRenderer();const ha=this._initNodePages(),na=this.view.resourceController.memoryController;this._memCache=na.newCache(this.layer.uid);this.updatingHandles.add(()=>this._clippingBox,
()=>this._setUpdateViewNeeded(),f.initial);this.updatingHandles.add(()=>this._elevationOffset,()=>this._elevationOffsetChanged(),f.initial);this.updatingHandles.add(()=>this.layer.renderer,()=>this._rendererChanged(),f.initial);this.updatingHandles.add(()=>this.layer.filters,()=>this._reload(),f.initial);this.updatingHandles.add(()=>this.layer.outFields,()=>this._reload(),f.initial);this.updatingHandles.add(()=>this.layer.effectiveScaleRange,()=>this._setUpdateViewNeeded());this.updatingHandles.add(()=>
this.view.state.contentCamera,()=>this._setUpdateViewNeeded());this.handles.add([this.view.basemapTerrain.on("scale-change",pa=>this._scaleUpdateHandler(pa)),na.events.on("quality-changed",()=>this._setUpdateViewNeeded())]);this.addResolvingPromise(ha);this.when(()=>{this.handles.add([Z.scheduler.registerTask(ea.TaskPriority.POINT_CLOUD_LAYER,this),Z.scheduler.registerIdleStateCallbacks(()=>this._idleBegin(),()=>this._idleEnd()),this.updatingHandles.add(()=>this.suspended,pa=>{pa?this._clearNodeState():
this._setUpdateViewNeeded()},f.initial)])},()=>{this.updatingHandles.removeAll();this.handles.removeAll()})};ba._setUpdateViewNeeded=function(){this._updateViewNeeded=!0;this._updateLoading()};ba.destroy=function(){this.cancelLoading();this._worker&&(this._worker.destroy(),this._worker=null);this._destroyRenderer();this._memCache.destroy();this._memCache=null;this._codedDomainPopulationAbortController&&(this._codedDomainPopulationAbortController.abort(),this._codedDomainPopulationAbortController=
null);this._codedDomainPopulationPromise=null};ba._initRenderer=function(){this._renderer=new R.PointRenderer({createGraphic:(Z,ha,na)=>this._createGraphic(Z,ha,na)});this._renderer.layerUid=this.layer.uid;this.updatingHandles.add(()=>this._clippingBox,Z=>this._renderer.clippingBox=Z,f.initial);this.updatingHandles.add(()=>this.suspended,Z=>this._setPointsVisible(!Z),f.initial);this.updatingHandles.add(()=>this.pointScale,Z=>this._renderer.scaleFactor=Z,f.initial);this._renderer.minSizePx=Math.sqrt(2);
this.updatingHandles.add(()=>this.useRealWorldSymbolSizes,Z=>this._renderer.useRealWorldSymbolSizes=Z,f.initial);this.updatingHandles.add(()=>this.pointSize,Z=>{const ha=l.pt2px(Z);this._renderer.size=Z;this._renderer.sizePx=ha},f.initial);this.updatingHandles.add(()=>this.slicePlaneEnabled,Z=>this._renderer.slicePlaneEnabled=Z,f.initial);this.updatingHandles.add(()=>this.inverseDensity,()=>this._setUpdateViewNeeded(),f.initial);this.updatingHandles.add(()=>this.maximumPointCount,()=>this._setUpdateViewNeeded(),
f.initial);this.updatingHandles.add(()=>this.view.qualitySettings.sceneService.pointCloud.lodFactor,Z=>{this._lodFactor=Z;this._setUpdateViewNeeded()},f.initial)};ba._destroyRenderer=function(){this._renderer.removeAll();this._setPointsVisible(!1)};ba._createGraphic=function(Z,ha,na){const pa=w.isSome(Z.pointIdFilterMap)?Z.pointIdFilterMap[ha]:ha;na=this.view.computeMapPointFromVec3d(na);const xa=this._createGraphicAttributes(Z,pa);return new N.PointGraphic({pointCloudMetadata:{nodeId:Z.id,pointIndexInNode:ha,
attributePointIndexInNode:pa,epoch:this._nodeLoadEpoch},geometry:na,attributes:xa,layer:this.layer,sourceLayer:this.layer})};ba._createGraphicAttributes=function(Z,ha){const na={};for(const pa of Z.attributes)this._encodeGraphicAttribute(pa.attributeInfo,pa.values,ha,na);return na};ba._encodeGraphicAttribute=function(Z,ha,na,pa){var xa=Z.storageInfo&&Z.storageInfo.attributeValues;const Da=xa?xa.valuesPerElement:1;if(1===Da)pa[Z.name]=ha[na];else if("UInt8"===xa.valueType&&4>=Da){xa=0;na*=Da;for(let ua=
na;ua<na+Da;ua++)xa=(xa<<8)+ha[ua];pa[Z.name]=xa}else pa[Z.name]=void 0};ba._setPointsVisible=function(Z){Z&&!this._rendererAdded?(this.view._stage.addRenderPlugin([aa.RenderSlot.OPAQUE_PLUGIN],this._renderer),this._rendererAdded=!0):!Z&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)};ba._rendererChanged=function(){this._renderer.useFixedSizes=J.rendererUsesFixedSizes(this.layer.renderer);this._reload()};ba._reload=function(){this._clearNodeState();
this._memCache.clear();this._setUpdateViewNeeded()};ba._elevationOffsetChanged=function(){this._clearNodeState();this._memCache.clear();this._initNodePages()};ba._scaleUpdateHandler=function(Z){const ha=this.layer.effectiveScaleRange;Y.isScaleRangeActive(ha.minScale,ha.maxScale)?x.projectBoundingRect(Z.extent,Z.spatialReference,ia,this.layer.spatialReference)&&(this._nodeScales.forEach((na,pa)=>{this._renderedNodes.has(pa)?(na=this._index.getNode(pa),E.containsPoint(ia,na.obb.center)&&this._nodeScales.set(pa,
Z.scale)):this._nodeScales.delete(pa)}),this._setUpdateViewNeeded()):this._nodeScales.clear()};ba._displayNodes=function(Z){this._workQueue=O.nodeDiff([...this._renderedNodes],Z,this._index);O.sortFrontToBack(this._workQueue,this.view.state.contentCamera.viewForward,this._index);O.splitWorkEntries(this._workQueue,8,this._index);this._updateQueues();this._totalWork=this._computeWork();this._updateLoading();this._layerIsVisible=0<Z.length||this._loadingInitNodePage;this.notifyChange("suspended")};ba.cancelLoading=
function(){this._cancelNodeLoading();this._cancelIndexLoading()};ba._cancelNodeLoading=function(){const Z=[];this._loadingNodes.forEach(({abortController:ha})=>Z.push(ha));this._loadingNodes.clear();for(const ha of Z)ha.abort();this._workQueue=[];this._idleQueue.cancelAll();this._totalWork=this._computeWork();this._updateLoading()};ba._updateQueues=function(){const Z=new Set;this._workQueue.forEach(pa=>pa.load.forEach(xa=>Z.add(xa)));const ha=[],na=new Map;this._loadingNodes.forEach((pa,xa)=>{Z.has(xa)?
na.set(xa,pa):ha.push(pa)});this._loadingNodes=na;for(const {abortController:pa}of ha)pa.abort();this._workQueue=this._workQueue.filter(pa=>{for(const xa of pa.load)if(this._loadingNodes.has(xa))return this._recalcWork=!0,!1;return!0});this._totalWork=this._computeWork();this._updateLoading()};ba._cancelIndexLoading=function(){this._indexQueue=[];this._indexPagesLoading.forEach(({abortController:Z})=>Z.abort());this._indexPagesLoading.clear();this._totalWork=this._computeWork();this._updateLoading()};
ba._clearNodeState=function(){this._nodeLoadEpoch++;this._renderedNodes.forEach(Z=>this._removeFromRenderer(Z));this._cancelNodeLoading()};ba._idleBegin=function(){this._setUpdateViewNeeded()};ba._idleEnd=function(){this._setUpdateViewNeeded()};ba.runTask=function(Z){if(this.suspended)this._updateViewNeeded&&(this._updateViewNeeded=!1,Z=this._isRootNodeVisible(),Z!==this._layerIsVisible&&(this._layerIsVisible=Z,this.notifyChange("suspended")),this._updateLoading());else{for(Z.run(()=>this._updateWorkQueues());0<
this._indexQueue.length&&Z.run(()=>this._processIndexQueue()););this._processWorkQueue(Z);this._idleQueue.runTask(Z)}};ba._processIndexQueue=function(){const Z=this._indexQueue.shift(),ha=this._loadNodePage(Z);this._indexPagesLoading.set(Z,ha);ha.promise.then(na=>{this._index.addPage(Z,na,this._elevationOffset);this._setUpdateViewNeeded()}).then(()=>{this._indexPagesLoading.delete(Z)},()=>{this._indexPagesLoading.delete(Z)});return!0};ba._processWorkQueue=function(Z){for(;!Z.done;){const ha=this._scheduleWorkEntry();
if(w.isNone(ha))break;this._processWorkEntry(ha);Z.madeProgress()}};ba._scheduleWorkEntry=function(){let Z=this._workQueue.length;for(;Z--;){const ha=this._workQueue.shift();if(ha.remove.find(na=>!this._renderedNodes.has(na)))this._workQueue.push(ha);else return ha}return null};ba._processWorkEntry=function(Z){if(0===Z.load.length)for(const ha of Z.remove)this._removeFromRenderer(ha);else Promise.all(Z.load.map(ha=>{const na=new AbortController,pa=this._memCache.pop(ha.toString());w.isSome(pa)?this._loadingNodes.set(ha,
{abortController:na,promise:Promise.resolve(pa)}):this._loadingNodes.has(ha)||this._loadingNodes.set(ha,{abortController:na,promise:this._loadNode(ha,na.signal)});return this._loadingNodes.get(ha).promise})).then(ha=>{for(let na=0;na<Z.load.length;na++)if(ha[na]){const pa=this._setupRendererData(Z.load[na],ha[na]);this._addToRenderer(pa)}for(const na of Z.remove)this._removeFromRenderer(na)}).catch(()=>{}).then(()=>{for(const ha of Z.load)this._loadingNodes.delete(ha);this._updateLoading();this._recalcWork&&
!this._idleQueue.running&&0===this._indexQueue.length&&0===this._loadingNodes.size&&(this._recalcWork=!1,this._setUpdateViewNeeded())}),this._updateLoading()};ba._populateClassCodeCodedDomain=function(){var Z=a._asyncToGenerator(function*(ha,na){const pa=this.layer.fieldsIndex.get("CLASS_CODE");pa&&!pa.domain&&-1!==ha.indexOf(pa.name)&&(ha=yield c.result(this.layer.queryCachedStatistics("CLASS_CODE",{signal:na})),!1!==ha.ok&&(ha=(ha=ha.value)&&ha.labels&&ha.labels.labels)&&Array.isArray(ha)&&(pa.domain=
new B({name:"CLASS_CODE",codedValues:ha.map(xa=>new p.default({code:xa.value,name:xa.label}))})))});return function(ha,na){return Z.apply(this,arguments)}}();ba.prepareFetchPopupFeatures=function(){var Z=a._asyncToGenerator(function*(ha){this._codedDomainPopulationPromise||(this._codedDomainPopulationAbortController=new AbortController,this._codedDomainPopulationPromise=this._populateClassCodeCodedDomain(ha,this._codedDomainPopulationAbortController.signal).then(()=>{this._codedDomainPopulationAbortController=
null}));return this._codedDomainPopulationPromise});return function(ha){return Z.apply(this,arguments)}}();ba.whenGraphicAttributes=function(){var Z=a._asyncToGenerator(function*(ha,na){var pa=this;const xa=this._splitGraphicsPerNode(ha),Da=this.layer.attributeStorageInfo,ua=na.map(sa=>J.getAttributeInfo(Da,sa)),Fa=function(){var sa=a._asyncToGenerator(function*(ma,ra){const va=pa._index.getNode(ra);yield c.forEach(ua,function(){var Ia=a._asyncToGenerator(function*(Ja){const Ha=Ja.useElevation?yield pa._loadElevationAttributeFromGeometry(va.resourceId):
yield pa._loadAndParseAttribute(va,Ja);if(Ha)for(const Ta of ma)pa._isValidPointGraphic(Ta)&&pa._encodeGraphicAttribute(Ja,Ha,Ta.pointCloudMetadata.attributePointIndexInNode,Ta.attributes)});return function(Ja){return Ia.apply(this,arguments)}}())});return function(ma,ra){return sa.apply(this,arguments)}}(),qa=[];xa.forEach((sa,ma)=>{qa.push(Fa(sa,ma))});yield n.eachAlways(qa);return ha});return function(ha,na){return Z.apply(this,arguments)}}();ba._isValidPointGraphic=function(Z){return Z instanceof
N.PointGraphic&&Z.pointCloudMetadata&&Z.pointCloudMetadata.epoch===this._nodeLoadEpoch};ba._splitGraphicsPerNode=function(Z){const ha=new Map;for(const na of Z){if(!this._isValidPointGraphic(na))continue;Z=na.pointCloudMetadata;const pa=ha.get(Z.nodeId);pa?pa.push(na):ha.set(Z.nodeId,[na])}return ha};ba._loadAndParseAttribute=function(){var Z=a._asyncToGenerator(function*(ha,na){const pa=yield this._loadAttribute(ha.resourceId,na,null);return w.isSome(pa)?P.getAttributeValues({attributeInfo:na,buffer:pa},
null,ha.vertexCount):null});return function(ha,na){return Z.apply(this,arguments)}}();ba._loadElevationAttributeFromGeometry=function(){var Z=a._asyncToGenerator(function*(ha){ha=P.readGeometry(this.layer.store.defaultGeometrySchema,yield this._loadGeometry(ha,null));return P.elevationFromPositions(ha,ha.length/3)});return function(ha){return Z.apply(this,arguments)}}();ba.highlight=function(Z){if(!Z)return{remove(){}};Z=g.isCollection(Z)?Z.toArray():Array.isArray(Z)?Z:[Z];return this._renderer.highlight(Z.map(ha=>
this._graphicToPointDefinition(ha)))};ba._graphicToPointDefinition=function(Z){if(!this._isValidPointGraphic(Z))return null;const {nodeId:ha,pointIndexInNode:na}=Z.pointCloudMetadata;return null!=ha&&null!=na?{nodeId:ha,pointId:na}:null};ba._computeWork=function(){let Z=0;for(const ha of this._workQueue)Z+=ha.load.length+ha.remove.length;Z+=this._loadingNodes.size;Z+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize;Z+=this._loadingInitNodePage?100:0;return Z+=this._updateViewNeeded?
100:0};ba._updateLoading=function(){this.notifyChange("updating");this.notifyChange("updatingProgressValue")};ba.canResume=function(){return ca.prototype.canResume.call(this)&&this._layerIsVisible};ba.isUpdating=function(){return this.suspended?this._updateViewNeeded:0<this._computeWork()};ba._initNodePages=function(){const Z=this.layer.store.index;this._index=new Q(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,Z.nodesPerPage||Z.nodePerIndexBlock);this._cancelIndexLoading();
this._traverseVisible=this._index.createVisibilityTraverse();this._layerIsVisible=this._loadingInitNodePage=!0;this.notifyChange("suspended");this._updateLoading();this._pageMultiplier=null!=Z.nodesPerPage?1:Z.nodePerIndexBlock;return this._loadNodePage(0).promise.then(ha=>{this._index.addPage(0,ha,this._elevationOffset);this._loadingInitNodePage=!1;this._setUpdateViewNeeded()})};ba._loadNodePage=function(Z){const ha=new AbortController;return{promise:this._requestNodePage(`${this.baseUrl}/nodepages/${Z*
this._pageMultiplier}`,ha.signal).then(na=>na.nodes.map((pa,xa)=>({resourceId:null!=pa.resourceId?pa.resourceId:Z*this._index.pageSize+xa,obb:pa.obb,firstChild:pa.firstChild,childCount:pa.childCount,vertexCount:null!=pa.vertexCount?pa.vertexCount:pa.pointCount,lodThreshold:null!=pa.lodThreshold?pa.lodThreshold:pa.effectiveArea}))),abortController:ha}};ba._updateWorkQueues=function(){if(!this._updateViewNeeded)return!1;let Z=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor();const ha=this.maximumPointCount*
this._lodFactor*this._getLodMemoryFactor();let na=this._computeNodesForMinimumDensity(Z),pa=this._computePointCount(na),xa=Math.sqrt(pa/(.75*ha));for(;pa>ha;)Z*=xa,na=this._computeNodesForMinimumDensity(Z),pa=this._computePointCount(na),xa=Math.sqrt(2);this._displayNodes(na);this._updateViewNeeded=!1;this._updateLoading();return!0};ba._computePointCount=function(Z){let ha=0;for(let na=0;na<Z.length;na++){const pa=this._index.getNode(Z[na]);pa&&(ha+=pa.vertexCount)}return ha};ba._getLodMemoryFactor=
function(){return this.view.resourceController.memoryController.memoryFactor};ba._isRootNodeVisible=function(){let Z=!1;this._traverseVisible({frustum:this.view.state.contentCamera.frustum,clippingBox:this._clippingBox},{predicate:(ha,na,pa)=>{Z=pa;return!1},pageMiss:()=>{}});return Z};ba._computeNodesForMinimumDensity=function(Z){const ha=this.view.state.contentCamera,na=ha.frustum,pa=this._clippingBox,xa=ha.viewForward,Da=t.dot(xa,ha.eye),ua=y.fromNormalAndOffset(xa,-Da,la),Fa=ha.perScreenPixelRatio/
2,qa=Z*Z,sa=this._nodeIdArray;sa.length=0;const {minScale:ma,maxScale:ra}=Y.extractSafeScaleBounds(this.layer),va=0===ma&&0===ra?Ia=>sa.push(Ia):Ia=>{const Ja=this._getScale(Ia);Y.scaleBoundsPredicate(Ja,ma,ra)&&sa.push(Ia)};this._traverseVisible({frustum:na,clippingBox:pa},{predicate:(Ia,Ja,Ha)=>{if(!Ha)return!1;if(0===Ja.childCount)return va(Ia),!1;Ha=this._index.getRenderObb(Ia);return this._computeAveragePixelArea(Ha,Ja.lodThreshold,Ja.vertexCount,ua,Fa)<=qa?(va(Ia),!1):!0},pageMiss:(Ia,Ja)=>
{va(Ia);0>this._indexQueue.indexOf(Ja)&&this._indexQueue.push(Ja)}});return sa};ba._getScale=function(Z){var ha=this._nodeScales.get(Z);null==ha&&(ha=this._index.getNode(Z).obb.center,this._tmpPoint.x=ha[0],this._tmpPoint.y=ha[1],this._tmpPoint.z=ha[2],ha=this.view.basemapTerrain.getScale(this._tmpPoint),this._nodeScales.set(Z,ha));return ha};ba._computeAveragePixelArea=function(Z,ha,na,pa,xa){Z=Math.max(1E-7,W.minimumDistancePlane(Z,pa));return ha/(Z*Z)/(4*xa*xa)/na};ba._loadNode=function(Z,ha){try{return this._loadNodeAsync(Z,
ha)}catch(na){throw n.isAbortError(na)||ja.error(na),na;}};ba._loadAdditionalUserAttributes=function(){var Z=a._asyncToGenerator(function*(ha,na,pa){var xa=this.layer.outFields;if(!xa)return[];xa=G.unpackFieldNames(this.layer.fieldsIndex,xa);ha=new Set(ha.map(Fa=>w.isSome(Fa)?Fa.name:null));const Da=this.layer.attributeStorageInfo,ua=[];for(const Fa of xa)ha.has(Fa)||(xa=J.getAttributeInfo(Da,Fa))&&ua.push(na(xa));na=yield n.eachAlwaysValues(ua);n.throwIfAborted(pa);return w.mapSome(na,Fa=>Fa)});
return function(ha,na,pa){return Z.apply(this,arguments)}}();ba._loadNodeAsync=function(){var Z=a._asyncToGenerator(function*(ha,na){var pa=this;const xa=this._index.getNode(ha),Da=J.getRendererInfo(this.layer),ua=J.getFilterInfo(this.layer),Fa=xa.resourceId,qa=function(){var sa=a._asyncToGenerator(function*(ma){if(w.isNone(ma))return null;if(ma.useElevation)return{attributeInfo:ma,buffer:null};const ra=yield pa._loadAttribute(Fa,ma,na);return w.isSome(ra)?{attributeInfo:ma,buffer:ra}:null});return function(ma){return sa.apply(this,
arguments)}}();return this._idleQueue.push(a._asyncToGenerator(function*(){var sa=pa._loadGeometry(Fa,na);const {primaryAttribute:ma,modulationAttribute:ra}=Da,va=qa(ma),Ia=qa(ra);var Ja=ua.map(Ca=>Ca.attributeInfo);const Ha=Ja.map(Ca=>qa(Ca));Ja=pa._loadAdditionalUserAttributes([ma,ra,...Ja],qa,na);const [Ta,db,fb,ka,cb]=yield Promise.all([sa,va,Ia,Promise.all(Ha),Ja]);n.throwIfAborted(na);sa={geometryBuffer:Ta,primaryAttributeData:db,modulationAttributeData:fb,filterAttributesData:ka,userAttributesData:cb,
schema:pa.layer.store.defaultGeometrySchema,rendererInfo:Da,filterInfo:ua,obb:pa._index.getRenderObb(ha),elevationOffset:pa._elevationOffset,inSR:pa.layer.spatialReference.toJSON(),outSR:pa.view.renderCoordsHelper.spatialReference.toJSON()};return pa._worker.invoke(sa,na)}),na)});return function(ha,na){return Z.apply(this,arguments)}}();ba._loadGeometry=function(){var Z=a._asyncToGenerator(function*(ha,na){return this._requestData(`${this.baseUrl}/nodes/${ha}/geometries/0`,na)});return function(ha,
na){return Z.apply(this,arguments)}}();ba._loadAttribute=function(){var Z=a._asyncToGenerator(function*(ha,na,pa){return w.isNone(na)||!na.storageInfo?null:this._requestData(`${this.baseUrl}/nodes/${ha}/attributes/${na.storageInfo.key}`,pa)});return function(ha,na,pa){return Z.apply(this,arguments)}}();ba._requestNodePage=function(Z,ha){return this._indexRequester.request(Z,"json",{query:{f:"json",token:this.layer.apiKey},signal:ha})};ba._requestData=function(Z,ha){return this._dataRequester.request(Z,
"binary",{query:{token:this.layer.apiKey},signal:ha})};ba._removeFromRenderer=function(Z){if(this._renderedNodes.has(Z)){const ha=this._renderer.removeNode(Z);this._renderedNodes.delete(Z);this._nodeScales.delete(Z);this._memCache.put(ha.id.toString(),ha,5*ha.coordinates.length+128)}};ba._addToRenderer=function(Z){this._renderedNodes.has(Z.id)||(this._renderedNodes.add(Z.id),this._renderer.addNode(Z))};ba._setupRendererData=function(Z,ha){const na=this._index.getNode(Z),pa=Math.sqrt(na.lodThreshold/
na.vertexCount),xa=this._index.getRenderObb(Z);if(R.isInstanceOfNode(ha))return ha.splatSize=pa,ha.obb=xa,ha.origin=r.clone(ha.obb.center),ha;var Da=.01*Math.max(xa.halfSize[0],xa.halfSize[1],xa.halfSize[2]);if(ha.obb.halfSize[0]>xa.halfSize[0]+Da||ha.obb.halfSize[1]>xa.halfSize[1]+Da||ha.obb.halfSize[2]>xa.halfSize[2]+Da)0<this._maxLoggedBoxWarnings&&(Da=ua=>`[${ua.halfSize[0]}, ${ua.halfSize[1]}, ${ua.halfSize[2]}]`,ja.warn(`Node ${Z} reported bounding box too small. got ${Da(xa)} but points cover ${Da(ha.obb)}`),
0===--this._maxLoggedBoxWarnings&&ja.warn("  Too many bounding box errors, stopping reporting for this layer.")),this._index.setRenderObb(Z,ha.obb);return{id:Z,coordinates:ha.points,origin:r.clone(xa.center),rgb:ha.rgb,attributes:ha.attributes,pointIdFilterMap:ha.pointIdFilterMap,highlights:null,splatSize:pa,obb:xa,isLeaf:0===na.childCount}};ba.getUsedMemory=function(){let Z=0;this._renderer.forEachNode(ha=>{Z+=160;Z+=k.estimateSize(ha.coordinates);for(const na of ha.attributes)ha=na.values,k.isArrayBuffer(ha.buffer)&&
(Z+=k.estimateSize(ha))});return Z};ba.getUnloadedMemory=function(){var Z=this._renderedNodes.size;if(4>Z)return 0;const ha=[...this._renderedNodes].reduce((xa,Da)=>xa+this._index.getNode(Da).vertexCount);let na=this._loadingNodes.size;for(var pa=0;pa<this._workQueue.length;pa++)na+=this._workQueue[pa].load.length,na-=this._workQueue[pa].remove.length;if(0>na)return 0;pa=na*ha/Z;Z=(this.getUsedMemory()-160*Z)/ha;return pa*Z+160*na};ba.ignoresMemoryFactor=function(){return!1};a._createClass(fa,[{key:"pointScale",
get:function(){const Z=J.getSplatSizeAlgorithm(this.layer&&this.layer.renderer);return Z&&null!=Z.scaleFactor?Z.scaleFactor:1}},{key:"useRealWorldSymbolSizes",get:function(){const Z=J.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);return Z&&null!=Z.useRealWorldSymbolSizes?Z.useRealWorldSymbolSizes:!1}},{key:"pointSize",get:function(){const Z=J.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);return Z&&null!=Z.size?Z.size:0}},{key:"inverseDensity",get:function(){return this.layer&&this.layer.renderer?
96/this.layer.renderer.pointsPerInch:5}},{key:"availableFields",get:function(){var Z=J.getRendererInfo(this.layer);const ha=new Set;Z.primaryAttribute&&ha.add(Z.primaryAttribute.name);Z.modulationAttribute&&ha.add(Z.primaryAttribute.name);if(Z=J.getFilterInfo(this.layer))for(const na of Z)ha.add(na.attributeInfo.name);if(this.layer.outFields)for(const na of G.unpackFieldNames(this.layer.fieldsIndex,this.layer.outFields))ha.add(na);return Array.from(ha)}},{key:"_clippingBox",get:function(){if(!this.view||
!this.view.clippingArea)return null;const Z=u.create();return T.projectToBoundingBox(this.view.clippingArea,Z,this.view.renderSpatialReference)?Z:null}},{key:"_elevationOffset",get:function(){const Z=this.layer&&this.layer.elevationInfo;if(Z&&"absolute-height"===Z.mode){const ha=e.getMetersPerVerticalUnitForSR(this.layer.spatialReference),na=H.getMetersPerUnit(Z.unit);return w.unwrapOr(Z.offset,0)*na/ha}return 0}},{key:"running",get:function(){return this.suspended?this._updateViewNeeded:this._updateViewNeeded||
0<this._indexQueue.length||0<this._workQueue.length||this._idleQueue.running}},{key:"updatingProgressValue",get:function(){if(this.suspended)return this._updateViewNeeded?0:1;const Z=this._computeWork();return 1-Math.min(this._totalWork,Z)/this._totalWork}},{key:"performanceInfo",get:function(){return{nodes:this._renderedNodes.size,displayedNumberOfFeatures:[...this._renderedNodes].reduce((Z,ha)=>Z+this._index.getNode(ha).vertexCount,0),maximumNumberOfFeatures:this.maximumPointCount,totalNumberOfFeatures:-1,
core:null,"Loading Nodes":this._loadingNodes.size,"Index Queue":this._indexQueue.length,"Work Queue":this._workQueue.length,"Idle Queue":this._idleQueue.length}}},{key:"test",get:function(){return{index:this._index,visibleNodes:this._renderedNodes}}}]);return fa}(S.PopupSceneLayerView(M.LayerView3D(da)));b.__decorate([d.property()],h.prototype,"layer",void 0);b.__decorate([d.property({readOnly:!0,aliasOf:"layer.parsedUrl.path"})],h.prototype,"baseUrl",void 0);b.__decorate([d.property({readOnly:!0})],
h.prototype,"pointScale",null);b.__decorate([d.property({readOnly:!0})],h.prototype,"useRealWorldSymbolSizes",null);b.__decorate([d.property({readOnly:!0})],h.prototype,"pointSize",null);b.__decorate([d.property({readOnly:!0})],h.prototype,"inverseDensity",null);b.__decorate([d.property()],h.prototype,"maximumPointCount",void 0);b.__decorate([d.property({readOnly:!0})],h.prototype,"availableFields",null);b.__decorate([d.property({readOnly:!0})],h.prototype,"_clippingBox",null);b.__decorate([d.property({readOnly:!0})],
h.prototype,"_elevationOffset",null);b.__decorate([d.property({type:Boolean})],h.prototype,"slicePlaneEnabled",void 0);b.__decorate([d.property()],h.prototype,"updating",void 0);b.__decorate([d.property(U.updatingProgress)],h.prototype,"updatingProgress",void 0);b.__decorate([d.property({readOnly:!0})],h.prototype,"updatingProgressValue",null);b=h=b.__decorate([q.subclass("esri.views.3d.layers.PointCloudLayerView3D")],h);const ia=E.create();return b})},"esri/views/3d/layers/PointCloudWorkerHandle":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../core/workers/WorkerHandle"],function(a,b,c,g){g=function(h){function w(n){return h.call(this,"PointCloudWorker","transform",n)||this}b._inheritsLoose(w,h);w.prototype.getTransferList=function(n){const f=[n.geometryBuffer];c.isSome(n.primaryAttributeData)&&n.primaryAttributeData.buffer&&f.push(n.primaryAttributeData.buffer);c.isSome(n.modulationAttributeData)&&n.modulationAttributeData.buffer&&f.push(n.modulationAttributeData.buffer);
if(c.isSome(n.filterAttributesData))for(const l of n.filterAttributesData)c.isSome(l)&&l.buffer&&f.push(l.buffer);for(const l of n.userAttributesData)l.buffer&&f.push(l.buffer);return f};return w}(g.WorkerHandle);a.PointCloudWorkerHandle=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SUtil":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../request ../../../../core/arrayUtils ../../../../core/Error ../../../../core/has ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf32 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/SpatialReference ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../rest/support/Query ./I3SBinaryReader ./I3SProjectionUtil ../support/edgeUtils ../support/symbolColorUtils ../../support/orientedBoundingBox".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G){function L(sa){return sa&&parseInt(sa.substring(sa.lastIndexOf("/")+1,sa.length),10)}function H(sa,ma){var ra=ma[0],va=ma[1];ma=ma[3];const Ia=sa[0]-ra;ra-=sa[2];const Ja=sa[1]-va;sa=va-sa[3];va=Math.max(Ia,ra,0);const Ha=Math.max(Ja,sa,0);va=va*va+Ha*Ha;return va>ma*ma?a.MbsIntersectResult.OUTSIDE:0<va?a.MbsIntersectResult.INTERSECTS_CENTER_OUTSIDE:-Math.max(Ia,ra,Ja,sa)>ma?a.MbsIntersectResult.INSIDE:a.MbsIntersectResult.INTERSECTS_CENTER_INSIDE}
function M(sa,ma,ra){const va=[],Ia=ra&&ra.missingFields;ra=ra&&ra.originalFields;for(const Ja of sa){sa=Ja.toLowerCase();let Ha=!1;for(const Ta of ma)if(sa===Ta.name.toLowerCase()){va.push(Ta.name);Ha=!0;ra&&ra.push(Ja);break}!Ha&&Ia&&Ia.push(Ja)}return va}function K(){K=b._asyncToGenerator(function*(sa,ma,ra,va,Ia){if(0===ma.length)return[];const Ja=sa.attributeStorageInfo;if(n.isSome(sa.associatedLayer))try{return yield O(sa.associatedLayer,ma,ra,va)}catch(Ha){if(sa.associatedLayer.loaded)throw Ha;
}if(Ja){ma=I(ma,ra,Ia);if(n.isNone(ma))throw new h("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const Ha=sa.parsedUrl.path;sa=yield Promise.all(ma.map(Ta=>P(Ha,Ja,Ta.node,Ta.indices,va).then(db=>{for(let fb=0;fb<Ta.graphics.length;fb++){const ka=Ta.graphics[fb],cb=db[fb];if(ka.attributes)for(const Ca in ka.attributes)Ca in cb||(cb[Ca]=ka.attributes[Ca]);ka.attributes=cb}return Ta.graphics})));return g.flatten(sa)}throw new h("scenelayer:no-attribute-source",
"This scene layer does not have a source for attributes available");});return K.apply(this,arguments)}function I(sa,ma,ra){const va=new Map,Ia=[];ra=ra();for(const Ta of sa){var Ja=Ta.attributes[ma];for(var Ha=0;Ha<ra.length;Ha++){sa=ra[Ha];const db=sa.featureIds.indexOf(Ja);if(0<=db){Ja=va.get(sa.node);Ja||(Ja={node:sa.node,indices:[],graphics:[]},Ia.push(Ja),va.set(sa.node,Ja));Ja.indices.push(db);for(Ja.graphics.push(Ta);0<Ha;Ha--)ra[Ha]=ra[Ha-1];ra[0]=sa;break}}}return Ia}function O(sa,ma,ra,
va){return Q.apply(this,arguments)}function Q(){Q=b._asyncToGenerator(function*(sa,ma,ra,va){ma.sort((Ha,Ta)=>Ha.attributes[ra]-Ta.attributes[ra]);var Ia=ma.map(Ha=>Ha.attributes[ra]);const Ja=[];va=M(va,sa.fields,{originalFields:Ja});sa=yield J(sa,Ia,va);for(Ia=0;Ia<ma.length;Ia++){const Ha=ma[Ia],Ta=sa[Ia],db={};if(Ha.attributes)for(const fb in Ha.attributes)db[fb]=Ha.attributes[fb];for(let fb=0;fb<Ja.length;fb++)db[Ja[fb]]=Ta[va[fb]];Ha.attributes=db}return ma});return Q.apply(this,arguments)}
function J(sa,ma,ra){var va=sa.capabilities.query.maxRecordCount;if(null!=va&&ma.length>va)return va=g.splitIntoChunks(ma,va),Promise.all(va.map(Ia=>J(sa,Ia,ra))).then(g.flatten);va=new p({objectIds:ma,outFields:ra,orderByFields:[sa.objectIdField]});return sa.queryFeatures(va).then(Ia=>{if(Ia&&Ia.features&&Ia.features.length===ma.length)return Ia.features.map(Ja=>Ja.attributes);throw new h("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer");})}function P(sa,
ma,ra,va,Ia){const Ja=[];for(const Ha of ma)Ha&&-1!==Ia.indexOf(Ha.name)&&Ja.push({url:`${sa}/nodes/${ra.resources.attributes}/attributes/${Ha.key}/0`,storageInfo:Ha});return f.eachAlways(Ja.map(Ha=>c(Ha.url,{responseType:"array-buffer"}).then(Ta=>B.readBinaryAttribute(Ha.storageInfo,Ta.data)))).then(Ha=>{const Ta=[];for(const db of va){const fb={};for(let ka=0;ka<Ha.length;ka++)null!=Ha[ka].value&&(fb[Ja[ka].storageInfo.name]=N(Ha[ka].value,db));Ta.push(fb)}return Ta})}function N(sa,ma){if(!sa)return null;
ma=sa[ma];return l.isInt16Array(sa)?-32768===ma?null:ma:l.isInt32Array(sa)?ma===ea?null:ma:ma!==ma?null:ma}function R(sa){var ma=sa.store.indexCRS||sa.store.geographicCRS;const ra=void 0===ma?sa.store.indexWKT:void 0;if(ra)if(sa.spatialReference){if(ra!==sa.spatialReference.wkt)throw new h("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{});}else throw new h("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference",
"Found indeWKT in the scene layer store but no layer spatial reference",{});ma=ma?new E(L(ma)):sa.spatialReference;return ma.equals(sa.spatialReference)?sa.spatialReference:ma}function S(sa){var ma=sa.store.vertexCRS||sa.store.projectedCRS;const ra=void 0===ma?sa.store.vertexWKT:void 0;if(ra)if(sa.spatialReference){if(ra!==sa.spatialReference.wkt)throw new h("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",
{});}else throw new h("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});ma=ma?new E(L(ma)):sa.spatialReference;return ma.equals(sa.spatialReference)?sa.spatialReference:ma}function T(sa,ma,ra){if(!x.canProjectWithoutEngine(sa,ma))throw new h("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===
ra&&!V(sa,ma))throw new h("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});}function V(sa,ma){return sa.equals(ma)||sa.isWGS84&&ma.isWebMercator||sa.isWebMercator&&ma.isWGS84}function W(sa,ma,ra){const va=R(sa);sa=S(sa);T(va,ma,ra);T(sa,ma,ra)}function U(sa,ma,ra,va,Ia=0){if(va===u.getSphericalPCPF(va))if(ma.isGeographic){var Ja=u.getReferenceEllipsoid(ma);va=1+Math.max(0,Ia)/(Ja.radius+sa.center[2]);
q.set(ra.center,sa.center[0],sa.center[1],sa.center[2]+Ia);x.projectBuffer(ra.center,ma,0,ra.center,u.getSphericalPCPF(ma),0,1);z.copy(ra.quaternion,sa.quaternion);z.conjugate(ha,sa.quaternion);q.set(ua,0,0,1);q.transformQuat(ua,ua,ha);q.set(ua,sa.halfSize[0]*Math.abs(ua[0]),sa.halfSize[1]*Math.abs(ua[1]),sa.halfSize[2]*Math.abs(ua[2]));q.scale(ua,ua,Ja.inverseFlattening);q.add(ra.halfSize,sa.halfSize,ua);q.scale(ra.halfSize,ra.halfSize,va)}else{{G.corners(sa,na);q.set(ra.center,sa.center[0],sa.center[1],
sa.center[2]+Ia);x.computeTranslationToOriginAndRotation(ma,ra.center,Z,u.getSphericalPCPF(ma));q.set(ra.center,Z[12],Z[13],Z[14]);va=2*Math.sqrt(1+Z[0]+Z[5]+Z[10]);ha[0]=(Z[6]-Z[9])/va;ha[1]=(Z[8]-Z[2])/va;ha[2]=(Z[1]-Z[4])/va;ha[3]=.25*va;z.multiply(ra.quaternion,ha,sa.quaternion);z.conjugate(ha,ra.quaternion);let Ha=va=sa=0;for(Ja of na)Ja[2]+=Ia,x.projectBuffer(Ja,ma,0,Ja,u.getSphericalPCPF(ma),0,1),q.sub(ua,Ja,ra.center),q.transformQuat(ua,ua,ha),sa=Math.max(sa,Math.abs(ua[0])),va=Math.max(va,
Math.abs(ua[1])),Ha=Math.max(Ha,Math.abs(ua[2]));q.set(ra.halfSize,sa,va,Ha)}}else ma.isWGS84&&(va.isWebMercator||A.isPlateCarree(va))?(q.copy(fa,sa.center),fa[2]+=Ia,Ia=u.getSphericalPCPF(va),x.projectBuffer(fa,ma,0,fa,Ia,0,1),aa(Ia,sa,fa,va,ra)):ma.isWebMercator&&A.isPlateCarree(va)?(q.copy(fa,sa.center),fa[2]+=Ia,aa(ma,sa,fa,va,ra)):sa===ra?(ra.center[2]+=Ia,x.projectBuffer(ra.center,ma,0,ra.center,va,0,1)):(q.set(ra.center,sa.center[0],sa.center[1],sa.center[2]+Ia),x.projectBuffer(ra.center,ma,
0,ra.center,va,0,1),z.copy(ra.quaternion,sa.quaternion),q.copy(ra.halfSize,sa.halfSize))}function aa(sa,ma,ra,va,Ia){const Ja=k.fromQuat(ba,ma.quaternion);for(let Ta=0;8>Ta;++Ta){for(var Ha=0;3>Ha;++Ha)ca[Ha]=ma.halfSize[Ha]*(0!==(Ta&1<<Ha)?-1:1);for(Ha=0;3>Ha;++Ha){let db=ra[Ha];for(let fb=0;3>fb;++fb)db+=ca[fb]*Ja[3*fb+Ha];la[3*Ta+Ha]=db}}x.projectBuffer(la,sa,0,la,va,0,8);G.compute(ia,Ia)}const da=y.create(),Y=r.create();a.MbsIntersectResult=void 0;(function(sa){sa[sa.OUTSIDE=0]="OUTSIDE";sa[sa.INTERSECTS_CENTER_OUTSIDE=
1]="INTERSECTS_CENTER_OUTSIDE";sa[sa.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE";sa[sa.INSIDE=3]="INSIDE"})(a.MbsIntersectResult||(a.MbsIntersectResult={}));const ea=-(2**31);r=C.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0});let ja=function(){this.material=this.edgeMaterial=null;this.castShadows=!0};const la=new Float64Array(24),ia={data:la,size:3},ca=t.create(),fa=t.create(),ba=e.create(),Z=m.create(),ha=v.create(),na=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,
0,0]],pa=y.create(),xa=y.create(),Da=G.create(),ua=[0,0,0],Fa={data:Array(72),size:3},qa=m.create();a.SymbolInfo=ja;a.addWraparound=function(sa,ma){return(sa|0)+(ma|0)|0};a.checkPointCloudLayerCompatibleWithView=function(sa,ma){T(sa.spatialReference,ma.spatialReference,ma.viewingMode)};a.checkPointCloudLayerValid=function(sa){var ma;(ma=null==sa.store||null==sa.store.defaultGeometrySchema)||(sa=sa.store.defaultGeometrySchema,ma=!!(null==sa.geometryType||"points"!==sa.geometryType||null!=sa.topology&&
"PerAttributeArray"!==sa.topology||null!=sa.encoding&&""!==sa.encoding&&"lepcc-xyz"!==sa.encoding||null==sa.vertexAttributes||null==sa.vertexAttributes.position));if(ma)throw new h("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{});};a.checkSceneLayerCompatibleWithView=function(sa,ma){W(sa,ma.spatialReference,ma.viewingMode)};a.checkSceneLayerValid=function(sa){var ma;(ma=null==sa.store||null==sa.store.defaultGeometrySchema)||(ma=sa.store.defaultGeometrySchema,
ma=!!(null!=ma.geometryType&&"triangles"!==ma.geometryType||null!=ma.topology&&"PerAttributeArray"!==ma.topology||null==ma.vertexAttributes||null==ma.vertexAttributes.position));if(ma)throw new h("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:sa.parsedUrl.path});};a.checkSpatialReference=T;a.checkSpatialReferences=W;a.computeVisibilityObb=function(sa,ma,ra,va,Ia,Ja){if(!Ja||0===Ja.length||n.isNone(ma))return null;const Ha=D.computeGlobalTransformation(sa.mbs,
Ia,ra,ma);d.invert(qa,Ha);let Ta;const db=()=>{if(!Ta)if(Ta=na,y.empty(xa),n.isSome(sa.serviceObb)){U(sa.serviceObb,ra,Da,ma,Ia);G.corners(Da,Ta);for(var Ca of Ta)q.transformMat4(Ca,Ca,qa),y.expandPointInPlace(xa,Ca)}else{var Ka=sa.mbs;Ca=Ka[3];x.projectVectorToVector(Ka,ra,ua,ma);q.transformMat4(ua,ua,qa);ua[2]+=Ia;for(Ka=0;8>Ka;++Ka){const Oa=Ta[Ka];q.copy(Oa,[ua[0]+(Ka&1?Ca:-Ca),ua[1]+(Ka&2?Ca:-Ca),ua[2]+(Ka&4?Ca:-Ca)]);y.expandPointInPlace(xa,Oa)}}};let fb=Infinity,ka=-Infinity;const cb=Ca=>{if("replace"===
Ca.type&&(Ca=Ca.geometry,Ca.hasZ)){y.empty(pa);var Ka=Ca.spatialReference||va;Ca=Ca.rings.reduce((Oa,wa)=>wa.reduce((Aa,Na)=>{x.projectVectorToVector(Na,Ka,ua,ma);q.transformMat4(ua,ua,qa);y.expandPointInPlace(pa,ua);return Math.min(ua[2],Aa)},Oa),Infinity);db();y.intersects(xa,pa)&&(fb=Math.min(fb,Ca),ka=Math.max(ka,Ca))}};Ja.forEach(Ca=>cb(Ca));if(Infinity===fb)return null;Ja=(Ca,Ka,Oa)=>{q.transformMat4(ua,Oa,Ha);Ca[Ka+0]=ua[0];Ca[Ka+1]=ua[1];Ca[Ka+2]=ua[2];Ka+=24;Oa[2]=fb;q.transformMat4(ua,Oa,
Ha);Ca[Ka+0]=ua[0];Ca[Ka+1]=ua[1];Ca[Ka+2]=ua[2];Ka+=24;Oa[2]=ka;q.transformMat4(ua,Oa,Ha);Ca[Ka+0]=ua[0];Ca[Ka+1]=ua[1];Ca[Ka+2]=ua[2]};for(let Ca=0;8>Ca;++Ca)Ja(Fa.data,3*Ca,Ta[Ca]);return G.compute(Fa)};a.containsDraco=function(sa){if(w("disable-feature:i3s-draco")||!sa)return!1;for(const ra of sa)for(const va of ra.geometryBuffers){var ma;if("draco"===(null==(ma=va.compressedAttributes)?void 0:ma.encoding))return!0}return!1};a.extractWkid=L;a.filterInPlace=function(sa,ma,ra){let va=0,Ia=0;for(let Ja=
0;Ja<ma.length&&va<sa.length;Ja++)sa[va]===ma[Ja]&&(ra(Ja)&&(sa[Ia]=sa[va],Ia++),va++);sa.length=Ia};a.findFieldsCaseInsensitive=M;a.findIntersectingNodes=function(sa,ma,ra,va,Ia,Ja){Ia.traverse(ra,Ha=>{var Ta=Ha.mbs;ma!==va&&(Ta=Y,x.projectBoundingSphere(Ha.mbs,va,Ta,ma));Ta=H(sa,Ta);if(Ta===a.MbsIntersectResult.OUTSIDE)return!1;Ja(Ha,Ta);return!0})};a.getCacheKeySuffix=function(sa,ma){return n.isNone(ma)?"@null":ma===u.getSphericalPCPF(ma)?"@ECEF":sa.equals(ma)?"":null!=ma.wkid?"@"+ma.wkid:null};
a.getCachedAttributeValue=N;a.getClipRect=function(sa,ma){if(0===ma.rotationScale[1]&&0===ma.rotationScale[2]&&0===ma.rotationScale[3]&&0===ma.rotationScale[5]&&0===ma.rotationScale[6]&&0===ma.rotationScale[7])return da[0]=(sa[0]-ma.position[0])/ma.rotationScale[0],da[1]=(sa[1]-ma.position[1])/ma.rotationScale[4],da[2]=(sa[2]-ma.position[0])/ma.rotationScale[0],da[3]=(sa[3]-ma.position[1])/ma.rotationScale[4],da};a.getIndexCrs=R;a.getSymbolInfo=function(sa){const ma=new ja;var ra=!1;let va=!1;for(const Ja of sa.symbolLayers.items)if("fill"===
Ja.type&&Ja.enabled){var Ia=Ja.material;sa=Ja.edges;n.isSome(Ia)&&!ra&&(ra=Ia.color,Ia=F.parseColorMixMode(Ia.colorMixMode),n.isSome(ra)?ma.material={color:[ra.r/255,ra.g/255,ra.b/255],alpha:ra.a,colorMixMode:Ia}:ma.material={color:[1,1,1],alpha:1,colorMixMode:F.ColorMixModeEnum.Multiply},ma.castShadows=Ja.castShadows,ra=!0);n.isSome(sa)&&!va&&(ma.edgeMaterial=C.createMaterialFromEdges(sa,{}),va=!0)}ma.material||(ma.material={color:[1,1,1],alpha:1,colorMixMode:F.ColorMixModeEnum.Multiply});return ma};
a.getVertexCrs=S;a.intersectBoundingBoxWithMbs=function(sa,ma){var ra=ma[0],va=ma[1],Ia=ma[2];ma=ma[3];const Ja=sa[0]-ra;ra-=sa[3];const Ha=sa[1]-va;va-=sa[4];const Ta=sa[2]-Ia;sa=Ia-sa[5];Ia=Math.max(Ja,ra,0);const db=Math.max(Ha,va,0),fb=Math.max(Ta,sa,0);Ia=Ia*Ia+db*db+fb*fb;return Ia>ma*ma?a.MbsIntersectResult.OUTSIDE:0<Ia?a.MbsIntersectResult.INTERSECTS_CENTER_OUTSIDE:-Math.max(Ja,ra,Ha,va,Ta,sa)>ma?a.MbsIntersectResult.INSIDE:a.MbsIntersectResult.INTERSECTS_CENTER_INSIDE};a.intersectBoundingRectWithMbs=
H;a.isSupportedLocalModeProjection=V;a.objectIdFilter=function(sa,ma,ra){let va=0,Ia=0;for(;va<ra.length;)0<=g.binaryIndexOf(sa,ra[va])===ma&&(ra[Ia]=ra[va],Ia++),va++;ra.length=Ia};a.rendererNeedsTextures=function(sa){if(null==sa||"simple"!==sa.type&&"class-breaks"!==sa.type&&"unique-value"!==sa.type||("unique-value"===sa.type||"class-breaks"===sa.type)&&null==sa.defaultSymbol)return!0;sa=sa.getSymbols();if(0===sa.length)return!0;for(const ma of sa){if("mesh-3d"!==ma.type||0===ma.symbolLayers.length)return!0;
for(const ra of ma.symbolLayers.items)if("fill"!==ra.type||n.isNone(ra.material)||n.isNone(ra.material.color)||"replace"!==ra.material.colorMixMode)return!0}return!1};a.transformObb=U;a.transparentEdgeMaterial=r;a.whenGraphicAttributes=function(sa,ma,ra,va,Ia){return K.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SBinaryReader":function(){define("exports ../../../../core/Error ../../../../core/lang ../../../../core/Logger ./LEPCC ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,g,h,w){function n(A,p,B){let D="",C=0;for(;C<B;){var F=A[p+C];if(128>F)D+=String.fromCharCode(F),C++;else if(192<=F&&224>F){if(C+1>=B)throw new b("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");D+=String.fromCharCode((F&31)<<6|A[p+C+1]&63);C+=2}else if(224<=F&&240>F){if(C+2>=B)throw new b("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");D+=String.fromCharCode((F&15)<<12|(A[p+C+1]&63)<<6|A[p+C+2]&63);C+=3}else if(240<=F&&248>
F){if(C+3>=B)throw new b("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");F=(F&7)<<18|(A[p+C+1]&63)<<12|(A[p+C+2]&63)<<6|A[p+C+3]&63;D=65536<=F?D+String.fromCharCode((F-65536>>10)+55296,(F&1023)+56320):D+String.fromCharCode(F);C+=4}else throw new b("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");}return D}function f(A,p){const B={byteOffset:0,byteCount:0,fields:Object.create(null)};let D=0;for(let C=0;C<p.length;C++){const F=p[C],G=F.valueType||
F.type;B.fields[F.property]=(0,y[G])(A,D);D+=E[G].BYTES_PER_ELEMENT}B.byteCount=D;return B}function l(A,p,B){const D=[];let C,F=0,G;for(G=0;G<A;G+=1){C=p[G];if(0<C){if(D.push(n(B,F,C-1)),0!==B[F+C-1])throw new b("string-array-error","Invalid string array: missing null termination.");}else D.push(null);F+=C}return D}function k(A,p){return new E[p.valueType](A,p.byteOffset,p.count*p.valuesPerElement)}function e(A,p){return new Uint8Array(A,p.byteOffset,p.byteCount)}function d(A,p,B){A=null!=p.header?
f(A,p.header):{byteOffset:0,byteCount:0,fields:{count:B}};B={header:A,byteOffset:A.byteCount,byteCount:0,entries:Object.create(null)};let D=A.byteCount;for(let C=0;C<p.ordering.length;C++){const F=p.ordering[C],G=c.clone(p[F]);G.count=A.fields.count;if("String"===G.valueType){if(G.byteOffset=D,G.byteCount=A.fields[F+"ByteCount"],"UTF-8"!==G.encoding)throw new b("unsupported-encoding","Unsupported String encoding.",{encoding:G.encoding});}else if(t(G.valueType)){const L=r(G.valueType);D+=0!==D%L?L-
D%L:0;G.byteOffset=D;G.byteCount=L*G.valuesPerElement*G.count}else throw new b("unsupported-value-type","Unsupported binary valueType",{valueType:G.valueType});D+=G.byteCount;B.entries[F]=G}B.byteCount=D-B.byteOffset;return B}function m(A,p,B){p!==A&&x.error(`Invalid ${B} buffer size\n expected: ${A}, actual: ${p})`);if(p<A)throw new b("buffer-too-small","Binary buffer is too small",{expectedSize:A,actualSize:p});}function z(A){return{isDraco:!1,isLegacy:!1,color:null!=A.color,normal:null!=A.normal,
uv0:null!=A.uv0,uvRegion:null!=A.uvRegion,featureIndex:null!=A.faceRange&&null!=A.featureId}}function v(A){const p={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const B of A.ordering)if(A.vertexAttributes[B])switch(B){case "normal":p.normal=!0;break;case "color":p.color=!0;break;case "uv0":p.uv0=!0;break;case "region":p.uvRegion=!0}A.featureAttributes&&A.featureAttributeOrder&&(p.featureIndex=!0);return p}function q(A){const p={isDraco:!0,isLegacy:!1,color:!1,
normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const B of A)switch(B){case "normal":p.normal=!0;break;case "uv0":p.uv0=!0;break;case "color":p.color=!0;break;case "uv-region":p.uvRegion=!0;break;case "feature-index":p.featureIndex=!0}return p}function t(A){return E.hasOwnProperty(A)}function r(A){return t(A)?E[A].BYTES_PER_ELEMENT:0}const x=g.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader"),u={position:w.VertexAttribute.POSITION,normal:w.VertexAttribute.NORMAL,color:w.VertexAttribute.COLOR,
uv0:w.VertexAttribute.UV0,region:w.VertexAttribute.UVREGION},E={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},y={Float32:(A,p)=>(new DataView(A,0)).getFloat32(p,!0),Float64:(A,p)=>(new DataView(A,0)).getFloat64(p,!0),UInt8:(A,p)=>(new DataView(A,0)).getUint8(p),Int8:(A,p)=>(new DataView(A,0)).getInt8(p),UInt16:(A,p)=>(new DataView(A,0)).getUint16(p,!0),Int16:(A,p)=>(new DataView(A,0)).getInt16(p,!0),
UInt32:(A,p)=>(new DataView(A,0)).getUint32(p,!0),Int32:(A,p)=>(new DataView(A,0)).getInt32(p,!0)};a.createAttributeDataIndex=d;a.createGeometryDescriptor=function(A,p){return A&&A.compressedAttributes&&"draco"===A.compressedAttributes.encoding?q(A.compressedAttributes.attributes):A?z(A):v(p)};a.createGeometryDescriptorForDraco=q;a.createGeometryDescriptorFromDefinition=z;a.createGeometryDescriptorFromSchema=v;a.createGeometryIndexFromSchema=function(A,p){var B=f(A,p&&p.header);let D=B.byteCount;
const C={isDraco:!1,header:B,byteOffset:B.byteCount,byteCount:0,vertexAttributes:{}};B=B.fields;var F=null!=B.vertexCount?B.vertexCount:B.count;for(var G of p.ordering){if(!p.vertexAttributes[G])continue;const H={...p.vertexAttributes[G],byteOffset:D,count:F};C.vertexAttributes[u[G]?u[G]:"_"+G]=H;D+=r(H.valueType)*H.valuesPerElement*F}G=B.faceCount;if(p.faces&&G){C.faces={};for(var L of p.ordering)p.faces[L]&&(F={...p.faces[L],byteOffset:D,count:G},C.faces[L]=F,D+=r(F.valueType)*F.valuesPerElement*
G)}L=B.featureCount;if(p.featureAttributes&&p.featureAttributeOrder&&L){C.featureAttributes={};for(const H of p.featureAttributeOrder)p.featureAttributes[H]&&(B={...p.featureAttributes[H],byteOffset:D,count:L},C.featureAttributes[H]=B,G="UInt64"===B.valueType?8:r(B.valueType),D+=G*B.valuesPerElement*L)}m(D,A.byteLength,"geometry");C.byteCount=D-C.byteOffset;return C};a.createRawView=e;a.createTypedView=k;a.getBytesPerValue=r;a.isValueType=t;a.readBinaryAttribute=function(A,p,B){if("lepcc-rgb"===A.encoding)return h.decodeRGB(p);
if("lepcc-intensity"===A.encoding)return h.decodeIntensity(p);if(null!=A.encoding&&""!==A.encoding)throw new b("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");A["attributeByteCounts "]&&!A.attributeByteCounts&&(x.warn("Warning: Trailing space in 'attributeByteCounts '."),A.attributeByteCounts=A["attributeByteCounts "]);"ObjectIds"===A.ordering[0]&&A.hasOwnProperty("objectIds")&&(x.warn("Warning: Case error in objectIds"),A.ordering[0]="objectIds");B=d(p,A,B);m(B.byteOffset+
B.byteCount,p.byteLength,"attribute");if(A=B.entries.attributeValues||B.entries.objectIds){if("String"===A.valueType){B=B.entries.attributeByteCounts;const D=k(p,B);p=e(p,A);return l(B.count,D,p)}return k(p,A)}throw new b("bad-attribute-storage-info","Bad attributeStorageInfo specification.");};a.readHeader=f;a.readStringArray=l;a.valueType2ArrayBufferReader=y;a.valueType2TypedArrayClassMap=E;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/LEPCC":function(){define(["exports",
"../../../../core/Error"],function(a,b){function c(n,f,l){return{identifier:String.fromCharCode.apply(null,new Uint8Array(n,l+w.identifierOffset,w.identifierLength)),version:f.getUint16(l+w.versionOffset,!0),checksum:f.getUint32(l+w.checksumOffset,!0)}}function g(n,f,l){const k=[];f=h(n,f,k);const e=[];for(let d=0;d<k.length;d++){e.length=0;f=h(n,f,e);for(let m=0;m<e.length;m++)l.push(e[m]+k[d])}return f}function h(n,f,l){var k=new DataView(n,f),e=k.getUint8(0);const d=e&31;var m=!!(e&32),z=(e&192)>>
6;e=0;if(0===z)e=k.getUint32(1,!0),f+=5;else if(1===z)e=k.getUint16(1,!0),f+=3;else if(2===z)e=k.getUint8(1),f+=2;else throw new b("lepcc-decode-error","Bad count type");if(m)throw new b("lepcc-decode-error","LUT not implemented");n=new Uint8Array(n,f,Math.ceil(e*d/8));z=m=k=0;const v=-1>>>32-d;for(let q=0;q<e;q++){for(;m<d;)k|=n[z]<<m,m+=8,z+=1;l[q]=k&v;k>>>=d;m-=d;32<m+d&&(k|=n[z-1]>>8-m)}return f+z}const w={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};
a.decodeIntensity=function(n){const f=new DataView(n,0);var l=0;const {identifier:k,version:e}=c(n,f,l);l+=w.byteCount;if("Intensity "!==k)throw new b("lepcc-decode-error","Bad identifier");if(1<e)throw new b("lepcc-decode-error","Unknown version");var d=l;var m=f.getUint32(d+0,!0);var z=f.getUint32(d+4,!0);var v=f.getUint32(d+8,!0);var q=f.getUint16(d+12,!0);var t=f.getUint8(d+14);f.getUint8(d+15);l+=16;if(z*2**32+m!==n.byteLength)throw new b("lepcc-decode-error","Bad size");m=new Uint16Array(v);
if(8===t){if(v+l!==n.byteLength)throw new b("lepcc-decode-error","Bad size");n=new Uint8Array(n,l,v);for(l=0;l<v;l++)m[l]=n[l]*q}else if(16===t){if(2*v+l!==n.byteLength)throw new b("lepcc-decode-error","Bad size");n=new Uint16Array(n,l,v);for(l=0;l<v;l++)m[l]=n[l]*q}else{t=[];if(h(n,l,t)!==n.byteLength)throw new b("lepcc-decode-error","Bad size");for(n=0;n<v;n++)m[n]=t[n]*q}return m};a.decodeRGB=function(n){var f=new DataView(n,0),l=0;const {identifier:k,version:e}=c(n,f,l);l+=w.byteCount;if("ClusterRGB"!==
k)throw new b("lepcc-decode-error","Bad identifier");if(1<e)throw new b("lepcc-decode-error","Unknown version");var d=l;var m=f.getUint32(d+0,!0);var z=f.getUint32(d+4,!0);var v=f.getUint32(d+8,!0);var q=f.getUint16(d+12,!0);var t=f.getUint8(d+14);d=f.getUint8(d+15);l+=16;if(z*2**32+m!==n.byteLength)throw new b("lepcc-decode-error","Bad size");if((2===t||1===t)&&0===d){if(3*q+v+l!==n.byteLength||256<q)throw new b("lepcc-decode-error","Bad count");f=new Uint8Array(n,l,3*q);l=new Uint8Array(n,l+3*q,
v);n=new Uint8Array(3*v);for(q=0;q<v;q++)m=l[q],n[3*q]=f[3*m],n[3*q+1]=f[3*m+1],n[3*q+2]=f[3*m+2];return n}if(0===t&&0===d){if(3*v+l!==n.byteLength||0!==q)throw new b("lepcc-decode-error","Bad count");return(new Uint8Array(n,l)).slice()}if(2>=t&&1===d){if(l+3!==n.byteLength||1!==q)throw new b("lepcc-decode-error","Bad count");n=f.getUint8(l);q=f.getUint8(l+1);l=f.getUint8(l+2);f=new Uint8Array(3*v);for(m=0;m<v;m++)f[3*m]=n,f[3*m+1]=q,f[3*m+2]=l;return f}throw new b("lepcc-decode-error","Bad method "+
t+","+d);};a.decodeXYZ=function(n){var f=new DataView(n,0),l=0;const {identifier:k,version:e}=c(n,f,l);l+=w.byteCount;if("LEPCC     "!==k)throw new b("lepcc-decode-error","Bad identifier");if(1<e)throw new b("lepcc-decode-error","Unknown version");var d=l;var m=f.getUint32(d+0,!0);var z=f.getUint32(d+4,!0);var v=f.getFloat64(d+8,!0);var q=f.getFloat64(d+16,!0);var t=f.getFloat64(d+24,!0);var r=f.getFloat64(d+32,!0);var x=f.getFloat64(d+40,!0);var u=f.getFloat64(d+48,!0);var E=f.getFloat64(d+56,!0);
var y=f.getFloat64(d+64,!0);var A=f.getFloat64(d+72,!0);var p=f.getUint32(d+80,!0);f.getUint32(d+84,!0);l+=88;if(z*2**32+m!==n.byteLength)throw new b("lepcc-decode-error","Bad size");m=new Float64Array(3*p);z=[];p=[];f=[];d=[];l=g(n,l,z);l=g(n,l,p);l=g(n,l,f);l=g(n,l,d);if(l!==n.byteLength)throw new b("lepcc-decode-error","Bad length");l=n=0;for(let B=0;B<z.length;B++){l+=z[B];let D=0;for(let C=0;C<p[B];C++){D+=f[n];const F=d[n];m[3*n]=Math.min(r,v+2*E*D);m[3*n+1]=Math.min(x,q+2*y*l);m[3*n+2]=Math.min(u,
t+2*A*F);n++}}return{errorX:E,errorY:y,errorZ:A,result:m}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SProjectionUtil":function(){define(["exports","../../../../chunks/mat4f64","../../../../chunks/vec3f64","../../../../geometry/projection","../../../../geometry/projectionEllipsoid"],function(a,b,c,g,h){function w(n,f,l){const k=c.create(),e=2**(4*Math.ceil(Math.log(n[3])*Math.LOG2E/4)+1);if(l.isGeographic){var d=e/h.getReferenceEllipsoid(l).radius*180/Math.PI;
l=Math.max(-90,Math.min(90,Math.round(n[1]/d)*d));d/=Math.cos((Math.abs(l)-d/2)/180*Math.PI);k[0]=Math.round(n[0]/d)*d;k[1]=l}else l=Math.round(n[1]/e),k[0]=Math.round(n[0]/e)*e,k[1]=l*e;k[2]=Math.round((n[2]+f)/e)*e;return k}a.computeGlobalTransformation=function(n,f,l,k){n=w(n,f,l);f=b.create();g.computeTranslationToOriginAndRotation(l,n,f,k);return f};a.getLocalOrigin=w;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/LoDUtil":function(){define(["exports","../../../../chunks/vec3"],
function(a,b){function c(l,k,e){for(;0<l;){const d=k.indexOf(l);if(0<=d)return d;l=e.getParentId(l)}return k.indexOf(l)}function g(l,k,e){const d=[k.remove[0]],m=[];for(;1===d.length;){const v=d.pop();m.length=0;for(let q=0;q<k.load.length;q++){let t=k.load[q];for(var z=e.getParentId(t);z!==v;)t=z,z=e.getParentId(t);z=d.indexOf(t);0>z&&(z=d.length,d.push(t),m.push([]));m[z].push(k.load[q])}}k.load=d;for(k=0;k<d.length;k++)1<m[k].length?l.push({remove:[d[k]],load:m[k]}):d[k]=m[k][0]}const h=[!1],w=
[null],n=[!1],f=[null];a.nodeDiff=function(l,k,e){for(var d=0;d<k.length;d++)n[d]=!1,f[d]=null;for(d=0;d<l.length;d++)h[d]=!1,w[d]=null;for(d=0;d<k.length;d++){var m=c(k[d],l,e);0<=m&&(n[d]=!0,null!=w[m]?w[m].push(k[d]):w[m]=[k[d]])}for(d=0;d<l.length;d++)m=c(l[d],k,e),0<=m&&(h[d]=!0,null!=f[m]?f[m].push(l[d]):f[m]=[l[d]]);e=[];for(d=0;d<l.length;d++)null!=w[d]||h[d]||e.push({load:[],remove:[l[d]]});for(d=0;d<k.length;d++)null!=f[d]||n[d]||e.push({load:[k[d]],remove:[]});for(d=0;d<k.length;d++)null!=
f[d]&&(1<f[d].length||f[d][0]!==k[d])&&e.push({load:[k[d]],remove:f[d]});for(k=0;k<l.length;k++)null!=w[k]&&(1<w[k].length||w[k][0]!==l[k])&&e.push({load:w[k],remove:[l[k]]});return e};a.sortFrontToBack=function(l,k,e){return l.sort((d,m)=>{if(0===d.load.length&&0===m.load.length)return 0;if(0===d.load.length)return-1;if(0===m.load.length)return 1;if(0===d.remove.length&&0===m.remove.length)return d=e.getRenderCenter(d.load[0]),m=e.getRenderCenter(m.load[0]),b.dot(d,k)-b.dot(m,k);if(0===d.remove.length)return-1;
if(0===m.remove.length)return 1;if(1===d.load.length&&1===m.load.length)return d=e.getRenderCenter(d.load[0]),m=e.getRenderCenter(m.load[0]),b.dot(d,k)-b.dot(m,k);if(1===d.load.length)return-1;if(1===m.load.length)return 1;d=e.getRenderCenter(d.remove[0]);m=e.getRenderCenter(m.remove[0]);return b.dot(d,k)-b.dot(m,k)})};a.splitWorkEntries=function(l,k,e){for(let d=0;d<l.length;++d){const m=l[d];m.load.length>k&&1===m.remove.length&&g(l,m,e)}};a.splitWorkEntry=g;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/3d/layers/i3s/PagedNodeIndex":function(){define(["../../../../geometry/support/aaBoundingBox","./I3SUtil","../../support/orientedBoundingBox"],function(a,b,c){return function(){function g(w,n,f){this._pages=[];this.pageSize=0;this._renderSR=this._nodeSR=null;this._nodeSR=w;this._renderSR=n;this.pageSize=f}var h=g.prototype;h.addPage=function(w,n,f=0){for(;this._pages.length<w;)this._pages.push(null);var l=this._nodeSR,k=this._renderSR,e=new c.ObbArray(n.length);for(var d=
0;d<n.length;d++)b.transformObb(n[d].obb,l,e.obbs[d],k,f);f=e.obbs;this._pages[w]={nodes:n,renderObbs:f,parents:new Uint32Array(this.pageSize)};w=this._pages;n=this.pageSize;for(f=[0];f.length;)for(l=f.pop(),k=w[l/n|0].nodes[l%n],e=0;e<k.childCount;e++)d=k.firstChild+e,null!=w[d/n|0]&&(w[d/n|0].parents[d%n]=l,f.push(d))};h.hasPage=function(w){return!!this._pages[w]};h.getNode=function(w){const n=this.pageSize;return this._pages[w/n|0].nodes[w%n]};h.getRenderObb=function(w){const n=this.pageSize;return this._pages[w/
n|0].renderObbs[w%n]};h.getRenderCenter=function(w){return this.getRenderObb(w).center};h.setRenderObb=function(w,n){const f=this.pageSize;c.set(n,this._pages[w/f|0].renderObbs[w%f])};h.getParentId=function(w){const n=this.pageSize;return this._pages[w/n|0].parents[w%n]};h.hasNodes=function(w,n){var f=w/this.pageSize|0;for(w=(w+n-1)/this.pageSize|0;f<=w;f++)if(null==this._pages[f])return!1;return!0};h.forEachNodeId=function(w){for(let n=0;n<this._pages.length;n++){const f=this._pages[n];if(f)for(let l=
0;l<f.nodes.length;l++)w(n*this.pageSize+l)}};h.createVisibilityTraverse=function(){var w=this,n=[],f=[],l=a.create();return(k,e)=>{if(w.hasNodes(0,1))for(n.length=0,n.push(0),f.length=0,f.push(0);0<n.length;){var d=n.pop();let r=f.pop();var m=w.getNode(d),z=w.getRenderObb(d),v=!0;if(null!=k.clippingBox){var q=1<<k.frustum.length;if(0===(r&q)){var t=c.toAaBoundingBox(z,l);a.contains(k.clippingBox,t)?r|=q:a.intersects(k.clippingBox,t)||(v=!1)}}for(q=0;q<k.frustum.length&&v;q++)if(t=1<<q,0===(r&t)){const x=
c.intersectPlane(z,k.frustum[q]);0<x?v=!1:0>x&&(r|=t)}if(e.predicate(d,m,v)){z=m.firstChild;m=m.childCount;v=!1;t=z/w.pageSize|0;for(q=(z+m-1)/w.pageSize|0;t<=q;t++)if(!w.hasPage(t)){e.pageMiss(d,t);v=!0;break}if(!v)for(d=0;d<m;d++)n.push(z+d),f.push(r)}}}};return g}()})},"esri/views/3d/layers/i3s/PointCloudRendererUtil":function(){define(["exports"],function(a){function b(g,h){for(const w of g)if(w.name===h&&null!=w.attributeValues&&"UInt8"===w.attributeValues.valueType&&3===w.attributeValues.valuesPerElement)return{name:h,
storageInfo:w,useElevation:!1};return null}function c(g,h){for(const w of g)if(w.name===h)return g="embedded-elevation"===w.encoding,{name:h,storageInfo:g?null:w,useElevation:g};return"elevation"===h.toLowerCase()?{name:h,storageInfo:null,useElevation:!0}:null}a.getAttributeInfo=c;a.getFilterInfo=function(g){const h=g.filters;return h?h.map(w=>({filterJSON:w.toJSON(),attributeInfo:c(g.attributeStorageInfo,w.field)})):[]};a.getFixedSizeAlgorithm=function(g){return(g=g&&g.pointSizeAlgorithm)&&"fixed-size"===
g.type?g:null};a.getRendererInfo=function(g){const h=g.renderer;var w=h&&h.type;const n=h&&g.renderer.toJSON()||null;let f=null,l=!1;"point-cloud-unique-value"===w?f=c(g.attributeStorageInfo,h.field):"point-cloud-stretch"===w?f=c(g.attributeStorageInfo,h.field):"point-cloud-class-breaks"===w?f=c(g.attributeStorageInfo,h.field):(f="point-cloud-rgb"===w?b(g.attributeStorageInfo,h.field):b(g.attributeStorageInfo,"RGB"),l=null!=f);w=null;h&&h.colorModulation&&(w=c(g.attributeStorageInfo,h.colorModulation.field));
return{rendererJSON:n,isRGBRenderer:l,primaryAttribute:f,modulationAttribute:w}};a.getSplatSizeAlgorithm=function(g){return(g=g&&g.pointSizeAlgorithm)&&"splat"===g.type?g:null};a.rendererUsesFixedSizes=function(g){return(g=g&&g.pointSizeAlgorithm)&&g.type?"fixed-size"===g.type:!1};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/PointCloudWorkerUtil":function(){define("exports ../../../../core/maybe ../../../../renderers/PointCloudClassBreaksRenderer ../../../../renderers/PointCloudStretchRenderer ../../../../renderers/PointCloudUniqueValueRenderer ./I3SBinaryReader ./LEPCC".split(" "),
function(a,b,c,g,h,w,n){function f(e,d){const m=new Float64Array(d);for(let z=0;z<d;z++)m[z]=e[3*z+2];return m}function l(e){return null==e||"none"===e?null:"low-four-bit"===e?d=>d&15:"high-four-bit"===e?d=>(d&240)>>4:"absolute-value"===e?d=>Math.abs(d):"modulo-ten"===e?d=>d%10:null}function k(e){let d=0;for(const m of e?e:[])d|=1<<m;return d}a.elevationFromPositions=f;a.evaluateRenderer=function(e,d,m,z){const {rendererJSON:v,isRGBRenderer:q}=e;var t=e=null;if(d&&q)e=d;else if(d&&"pointCloudUniqueValueRenderer"===
v.type){t=h.fromJSON(v);var r=t.colorUniqueValueInfos;e=new Uint8Array(3*z);var x=l(t.fieldTransformType);for(var u=0;u<z;u++){var E=(x?x(d[u]):d[u])+"";for(var y=0;y<r.length;y++)if(0<=r[y].values.indexOf(E)){e[3*u]=r[y].color.r;e[3*u+1]=r[y].color.g;e[3*u+2]=r[y].color.b;break}}}else if(d&&"pointCloudStretchRenderer"===v.type)for(t=g.fromJSON(v),r=t.stops,e=new Uint8Array(3*z),x=l(t.fieldTransformType),u=0;u<z;u++)if(E=x?x(d[u]):d[u],y=r.length-1,E<r[0].value)e[3*u]=r[0].color.r,e[3*u+1]=r[0].color.g,
e[3*u+2]=r[0].color.b;else if(E>=r[y].value)e[3*u]=r[y].color.r,e[3*u+1]=r[y].color.g,e[3*u+2]=r[y].color.b;else for(y=1;y<r.length;y++){if(E<r[y].value){E=(E-r[y-1].value)/(r[y].value-r[y-1].value);e[3*u]=r[y].color.r*E+r[y-1].color.r*(1-E);e[3*u+1]=r[y].color.g*E+r[y-1].color.g*(1-E);e[3*u+2]=r[y].color.b*E+r[y-1].color.b*(1-E);break}}else if(d&&"pointCloudClassBreaksRenderer"===v.type)for(t=c.fromJSON(v),r=t.colorClassBreakInfos,e=new Uint8Array(3*z),x=l(t.fieldTransformType),u=0;u<z;u++)for(E=
x?x(d[u]):d[u],y=0;y<r.length;y++){if(E>=r[y].minValue&&E<=r[y].maxValue){e[3*u]=r[y].color.r;e[3*u+1]=r[y].color.g;e[3*u+2]=r[y].color.b;break}}else for(e=new Uint8Array(3*z),d=0;d<e.length;d++)e[d]=255;if(m&&t&&t.colorModulation)for(d=t.colorModulation.minValue,t=t.colorModulation.maxValue,r=0;r<z;r++)x=m[r],x=x>=t?1:x<=d?.3:.3+.7*(x-d)/(t-d),e[3*r]*=x,e[3*r+1]*=x,e[3*r+2]*=x;return e};a.filterInPlace=function(e,d,m,z,v){const q=e.length/3;let t=0;for(let A=0;A<q;A++){let p=!0;for(let B=0;B<z.length&&
p;B++){var {filterJSON:r}=z[B],x=v[B].values[A];switch(r.type){case "pointCloudValueFilter":var u="exclude"===r.mode;-1!==r.values.indexOf(x)===u&&(p=!1);break;case "pointCloudBitfieldFilter":u=k(r.requiredSetBits);r=k(r.requiredClearBits);if((x&u)!==u||0!==(x&r))p=!1;break;case "pointCloudReturnFilter":var E=x&15,y=x>>>4&15;x=1<y;u=1===E;E=E===y;y=!1;for(const D of r.includedReturns)if("last"===D&&E||"firstOfMany"===D&&u&&x||"lastOfMany"===D&&E&&x||"single"===D&&!x){y=!0;break}y||(p=!1)}}p&&(m[t]=
A,e[3*t]=e[3*A],e[3*t+1]=e[3*A+1],e[3*t+2]=e[3*A+2],d[3*t]=d[3*A],d[3*t+1]=d[3*A+1],d[3*t+2]=d[3*A+2],t++)}return t};a.getAttributeValues=function(e,d,m){return b.isSome(e)&&e.attributeInfo.useElevation?f(d,m):b.isSome(e)?w.readBinaryAttribute(e.attributeInfo.storageInfo,e.buffer,m):null};a.readGeometry=function(e,d){if(null==e.encoding||""===e.encoding){e=w.createGeometryIndexFromSchema(d,e);if(b.isNone(e.vertexAttributes.position))return;d=w.createTypedView(d,e.vertexAttributes.position);var m=
e.header.fields;e=[m.offsetX,m.offsetY,m.offsetZ];m=[m.scaleX,m.scaleY,m.scaleZ];const z=d.length/3,v=new Float64Array(3*z);for(let q=0;q<z;q++)v[3*q]=d[3*q]*m[0]+e[0],v[3*q+1]=d[3*q+1]*m[1]+e[1],v[3*q+2]=d[3*q+2]*m[2]+e[2];return v}if("lepcc-xyz"===e.encoding)return n.decodeXYZ(d).result};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/PointCloudClassBreaksRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorClassBreakInfo".split(" "),
function(a,b,c,g,h,w,n,f,l,k){var e;h=e=function(d){function m(z){z=d.call(this,z)||this;z.type="point-cloud-class-breaks";z.field=null;z.legendOptions=null;z.fieldTransformType=null;z.colorClassBreakInfos=null;return z}a._inheritsLoose(m,d);m.prototype.clone=function(){return new e({...this.cloneProperties(),field:this.field,fieldTransformType:this.fieldTransformType,colorClassBreakInfos:c.clone(this.colorClassBreakInfos),legendOptions:c.clone(this.legendOptions)})};return m}(f);b.__decorate([w.enumeration({pointCloudClassBreaksRenderer:"point-cloud-class-breaks"})],
h.prototype,"type",void 0);b.__decorate([g.property({json:{write:!0},type:String})],h.prototype,"field",void 0);b.__decorate([g.property({type:l.default,json:{write:!0}})],h.prototype,"legendOptions",void 0);b.__decorate([g.property({type:f.fieldTransformTypeKebabDict.apiValues,json:{type:f.fieldTransformTypeKebabDict.jsonValues,read:f.fieldTransformTypeKebabDict.read,write:f.fieldTransformTypeKebabDict.write}})],h.prototype,"fieldTransformType",void 0);b.__decorate([g.property({type:[k.default],
json:{write:!0}})],h.prototype,"colorClassBreakInfos",void 0);return h=e=b.__decorate([n.subclass("esri.renderers.PointCloudClassBreaksRenderer")],h)})},"esri/renderers/PointCloudRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/jsonMap ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./support/pointCloud/ColorModulation ./support/pointCloud/pointSizeAlgorithmTypeUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k){n=c.strict()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks",pointCloudRGBRenderer:"point-cloud-rgb",pointCloudStretchRenderer:"point-cloud-stretch",pointCloudUniqueValueRenderer:"point-cloud-unique-value"});g=function(e){function d(z){z=e.call(this,z)||this;z.type=void 0;z.pointSizeAlgorithm=null;z.colorModulation=null;z.pointsPerInch=10;return z}a._inheritsLoose(d,e);var m=d.prototype;m.clone=function(){console.warn(".clone() is not implemented for "+this.declaredClass);
return null};m.cloneProperties=function(){return{pointSizeAlgorithm:h.clone(this.pointSizeAlgorithm),colorModulation:h.clone(this.colorModulation),pointsPerInch:h.clone(this.pointsPerInch)}};return d}(g.JSONSupport);b.__decorate([w.property({type:n.apiValues,readOnly:!0,nonNullable:!0,json:{type:n.jsonValues,read:!1,write:n.write}})],g.prototype,"type",void 0);b.__decorate([w.property({types:k.pointSizeAlgorithmTypes,json:{write:!0}})],g.prototype,"pointSizeAlgorithm",void 0);b.__decorate([w.property({type:l.default,
json:{write:!0}})],g.prototype,"colorModulation",void 0);b.__decorate([w.property({json:{write:!0},nonNullable:!0,type:Number})],g.prototype,"pointsPerInch",void 0);g=b.__decorate([f.subclass("esri.renderers.PointCloudRenderer")],g);(g||(g={})).fieldTransformTypeKebabDict=new c.JSONMap({none:"none",lowFourBit:"low-four-bit",highFourBit:"high-four-bit",absoluteValue:"absolute-value",moduloTen:"modulo-ten"});return g})},"esri/renderers/support/pointCloud/ColorModulation":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,g,h,w,n,f,l){var k;a.ColorModulation=k=function(e){function d(){var m=e.apply(this,arguments)||this;m.field=null;m.minValue=0;m.maxValue=255;return m}b._inheritsLoose(d,e);d.prototype.clone=function(){return new k({field:this.field,minValue:this.minValue,maxValue:this.maxValue})};return d}(g.JSONSupport);c.__decorate([h.property({type:String,json:{write:!0}})],a.ColorModulation.prototype,"field",void 0);c.__decorate([h.property({type:Number,nonNullable:!0,json:{write:!0}})],a.ColorModulation.prototype,
"minValue",void 0);c.__decorate([h.property({type:Number,nonNullable:!0,json:{write:!0}})],a.ColorModulation.prototype,"maxValue",void 0);a.ColorModulation=k=c.__decorate([l.subclass("esri.renderers.support.pointCloud.ColorModulation")],a.ColorModulation);a.default=a.ColorModulation;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/support/pointCloud/pointSizeAlgorithmTypeUtils":function(){define(["exports","./PointSizeAlgorithm","./PointSizeFixedSizeAlgorithm","./PointSizeSplatAlgorithm"],
function(a,b,c,g){a.pointSizeAlgorithmTypes={key:"type",base:b.default,typeMap:{"fixed-size":c.default,splat:g.default}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/support/pointCloud/PointSizeAlgorithm":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/jsonMap ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,g,h,w,n,f,l,k){g=new g.JSONMap({pointCloudFixedSizeAlgorithm:"fixed-size",pointCloudSplatAlgorithm:"splat"});a.PointSizeAlgorithm=function(e){function d(){return e.apply(this,arguments)||this}b._inheritsLoose(d,e);return d}(h.JSONSupport);c.__decorate([w.property({type:g.apiValues,readOnly:!0,nonNullable:!0,json:{type:g.jsonValues,read:!1,write:g.write}})],a.PointSizeAlgorithm.prototype,"type",void 0);a.PointSizeAlgorithm=c.__decorate([k.subclass("esri.renderers.support.pointCloud.PointSizeAlgorithm")],
a.PointSizeAlgorithm);a.default=a.PointSizeAlgorithm;a.typeKebabDictionary=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/support/pointCloud/PointSizeFixedSizeAlgorithm":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./PointSizeAlgorithm".split(" "),
function(a,b,c,g,h,w,n,f,l,k){var e;a.PointSizeFixedSizeAlgorithm=e=function(d){function m(){var z=d.apply(this,arguments)||this;z.type="fixed-size";z.size=0;z.useRealWorldSymbolSizes=null;return z}b._inheritsLoose(m,d);m.prototype.clone=function(){return new e({size:this.size,useRealWorldSymbolSizes:this.useRealWorldSymbolSizes})};return m}(k.default);c.__decorate([f.enumeration({pointCloudFixedSizeAlgorithm:"fixed-size"})],a.PointSizeFixedSizeAlgorithm.prototype,"type",void 0);c.__decorate([g.property({type:Number,
nonNullable:!0,json:{write:!0}})],a.PointSizeFixedSizeAlgorithm.prototype,"size",void 0);c.__decorate([g.property({type:Boolean,json:{write:!0}})],a.PointSizeFixedSizeAlgorithm.prototype,"useRealWorldSymbolSizes",void 0);a.PointSizeFixedSizeAlgorithm=e=c.__decorate([l.subclass("esri.renderers.support.pointCloud.PointSizeFixedSizeAlgorithm")],a.PointSizeFixedSizeAlgorithm);a.default=a.PointSizeFixedSizeAlgorithm;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/support/pointCloud/PointSizeSplatAlgorithm":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./PointSizeAlgorithm".split(" "),
function(a,b,c,g,h,w,n,f,l,k){var e;a.PointSizeSplatAlgorithm=e=function(d){function m(){var z=d.apply(this,arguments)||this;z.type="splat";z.scaleFactor=1;return z}b._inheritsLoose(m,d);m.prototype.clone=function(){return new e({scaleFactor:this.scaleFactor})};return m}(k.default);c.__decorate([f.enumeration({pointCloudSplatAlgorithm:"splat"})],a.PointSizeSplatAlgorithm.prototype,"type",void 0);c.__decorate([g.property({type:Number,value:1,nonNullable:!0,json:{write:!0}})],a.PointSizeSplatAlgorithm.prototype,
"scaleFactor",void 0);a.PointSizeSplatAlgorithm=e=c.__decorate([l.subclass("esri.renderers.support.pointCloud.PointSizeSplatAlgorithm")],a.PointSizeSplatAlgorithm);a.default=a.PointSizeSplatAlgorithm;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/support/pointCloud/ColorClassBreakInfo":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,g,h,w,n,f,l){var k;a.ColorClassBreakInfo=k=function(e){function d(){var m=e.apply(this,arguments)||this;m.description=null;m.label=null;m.minValue=0;m.maxValue=0;m.color=null;return m}b._inheritsLoose(d,e);d.prototype.clone=function(){return new k({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,color:w.clone(this.color)})};return d}(h.JSONSupport);c.__decorate([n.property({type:String,json:{write:!0}})],a.ColorClassBreakInfo.prototype,"description",
void 0);c.__decorate([n.property({type:String,json:{write:!0}})],a.ColorClassBreakInfo.prototype,"label",void 0);c.__decorate([n.property({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],a.ColorClassBreakInfo.prototype,"minValue",void 0);c.__decorate([n.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],a.ColorClassBreakInfo.prototype,"maxValue",void 0);c.__decorate([n.property({type:g,json:{type:[f.Integer],write:!0}})],
a.ColorClassBreakInfo.prototype,"color",void 0);a.ColorClassBreakInfo=k=c.__decorate([l.subclass("esri.renderers.support.pointCloud.ColorClassBreakInfo")],a.ColorClassBreakInfo);a.default=a.ColorClassBreakInfo;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/renderers/PointCloudStretchRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./visualVariables/support/ColorStop".split(" "),
function(a,b,c,g,h,w,n,f,l,k){var e;h=e=function(d){function m(z){z=d.call(this,z)||this;z.type="point-cloud-stretch";z.field=null;z.legendOptions=null;z.fieldTransformType=null;z.stops=null;return z}a._inheritsLoose(m,d);m.prototype.clone=function(){return new e({...this.cloneProperties(),field:c.clone(this.field),fieldTransformType:c.clone(this.fieldTransformType),stops:c.clone(this.stops),legendOptions:c.clone(this.legendOptions)})};return m}(f);b.__decorate([w.enumeration({pointCloudStretchRenderer:"point-cloud-stretch"})],
h.prototype,"type",void 0);b.__decorate([g.property({json:{write:!0},type:String})],h.prototype,"field",void 0);b.__decorate([g.property({type:l.default,json:{write:!0}})],h.prototype,"legendOptions",void 0);b.__decorate([g.property({type:f.fieldTransformTypeKebabDict.apiValues,json:{type:f.fieldTransformTypeKebabDict.jsonValues,read:f.fieldTransformTypeKebabDict.read,write:f.fieldTransformTypeKebabDict.write}})],h.prototype,"fieldTransformType",void 0);b.__decorate([g.property({type:[k],json:{write:!0}})],
h.prototype,"stops",void 0);return h=e=b.__decorate([n.subclass("esri.renderers.PointCloudStretchRenderer")],h)})},"esri/renderers/PointCloudUniqueValueRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorUniqueValueInfo".split(" "),
function(a,b,c,g,h,w,n,f,l,k){var e;h=e=function(d){function m(z){z=d.call(this,z)||this;z.type="point-cloud-unique-value";z.field=null;z.fieldTransformType=null;z.colorUniqueValueInfos=null;z.legendOptions=null;return z}a._inheritsLoose(m,d);m.prototype.clone=function(){return new e({...this.cloneProperties(),field:c.clone(this.field),fieldTransformType:c.clone(this.fieldTransformType),colorUniqueValueInfos:c.clone(this.colorUniqueValueInfos),legendOptions:c.clone(this.legendOptions)})};return m}(f);
b.__decorate([w.enumeration({pointCloudUniqueValueRenderer:"point-cloud-unique-value"})],h.prototype,"type",void 0);b.__decorate([g.property({json:{write:!0},type:String})],h.prototype,"field",void 0);b.__decorate([g.property({type:f.fieldTransformTypeKebabDict.apiValues,json:{type:f.fieldTransformTypeKebabDict.jsonValues,read:f.fieldTransformTypeKebabDict.read,write:f.fieldTransformTypeKebabDict.write}})],h.prototype,"fieldTransformType",void 0);b.__decorate([g.property({type:[k.default],json:{write:!0}})],
h.prototype,"colorUniqueValueInfos",void 0);b.__decorate([g.property({type:l.default,json:{write:!0}})],h.prototype,"legendOptions",void 0);return h=e=b.__decorate([n.subclass("esri.renderers.PointCloudUniqueValueRenderer")],h)})},"esri/renderers/support/pointCloud/ColorUniqueValueInfo":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,g,h,w,n,f,l){var k;a.ColorUniqueValueInfo=k=function(e){function d(){var m=e.apply(this,arguments)||this;m.description=null;m.label=null;m.values=null;m.color=null;return m}b._inheritsLoose(d,e);d.prototype.clone=function(){return new k({description:this.description,label:this.label,values:w.clone(this.values),color:w.clone(this.color)})};return d}(h.JSONSupport);c.__decorate([n.property({type:String,json:{write:!0}})],a.ColorUniqueValueInfo.prototype,"description",void 0);c.__decorate([n.property({type:String,
json:{write:!0}})],a.ColorUniqueValueInfo.prototype,"label",void 0);c.__decorate([n.property({type:[String],json:{write:!0}})],a.ColorUniqueValueInfo.prototype,"values",void 0);c.__decorate([n.property({type:g,json:{type:[f.Integer],write:!0}})],a.ColorUniqueValueInfo.prototype,"color",void 0);a.ColorUniqueValueInfo=k=c.__decorate([l.subclass("esri.renderers.support.pointCloud.ColorUniqueValueInfo")],a.ColorUniqueValueInfo);a.default=a.ColorUniqueValueInfo;Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/layers/i3s/PointGraphic":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,g,h,w,n,f,l){a.PointGraphic=function(k){function e(d){return k.call(this,d)||this}b._inheritsLoose(e,k);return e}(g);
c.__decorate([h.property({constructOnly:!0,clonable:"reference"})],a.PointGraphic.prototype,"pointCloudMetadata",void 0);a.PointGraphic=c.__decorate([l.subclass("esri.views.3d.layers.i3s.PointGraphic")],a.PointGraphic);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/PointRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../../../../chunks/mat4 ../../../../chunks/mat4f32 ../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/plane ../../../../geometry/support/ray ./PointHighlights ../../support/orientedBoundingBox ../../webgl-engine/core/shaderLibrary/ShaderOutputOptions ../../webgl-engine/core/shaderLibrary/Slice.glsl ../../webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/RenderPass ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/shaders/PointRendererTechnique ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject ../../../webgl/VertexElementDescriptor".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F){function G(O,Q,J,P,N){if(J.drawScreenSpace)return J.fixedSize*Q*P;N=(N?256:64)*Q*P;return J.drawFixedSize?Math.min(J.fixedSize/2,N):0<J.screenMinSize?Math.min(Math.max(J.screenMinSize*Q*P,O/2),N):Math.min(O/2,N)}function L(O){return c.isSome(O.component)?O.component:-1}function H(O,Q){if(c.isNone(O))return O;O=O.filter(J=>J.id!==Q);return 0===O.length?null:O}function M(O){return c.isSome(O.dist)&&c.isSome(O.point)&&c.isSome(O.pointId)&&
c.isSome(O.node)}const K={positions:[new F.VertexElementDescriptor(A.VertexAttribute.POSITION,3,D.DataType.FLOAT,0,12)],colors:[new F.VertexElementDescriptor(A.VertexAttribute.COLOR,3,D.DataType.UNSIGNED_BYTE,0,3,!0)]};A=function(){function O(J){this._params=J;this.type=E.IntersectorType.PCL;this.isGround=!1;this._bindParameters={inverseViewport:[0,0],highlightDepthTexture:null};this._highlights=new z.PointHighlights({forEachNode:P=>this.forEachNode(P),addHighlight:(P,N,R)=>this._addHighlight(P,N,
R),removeHighlight:(P,N)=>this._removeHighlight(P,N)});this.canRender=!0;this.layerUid="";this._useFixedSizes=!1;this._scaleFactor=1;this._minSizePx=0;this._useRealWorldSymbolSizes=!1;this._sizePx=this._size=0;this._slicePlaneEnabled=!1;this._clipBox=e.create(e.POSITIVE_INFINITY);this._techniqueConfig=new p.PointRendererTechniqueConfiguration;this.tempMatrix4=w.create();this.tempVec3=f.create();this.nodes=new g}var Q=O.prototype;Q.initializeRenderContext=function(J){this._context=J;this._techniqueRep=
this._context.shaderTechniqueRepository;J.requestRender()};Q.uninitializeRenderContext=function(){};Q.intersect=function(J,P,N,R){const S=l.create(),T=l.create(),V=l.create(),W=l.create(),U=d.create(),aa=J.camera.perScreenPixelRatio/2,da=J.camera.near,Y=this._getSizeParams();n.subtract(T,R,N);const ea=1/n.length(T);n.scale(T,T,ea);n.negate(V,T);k.set(U,T[0],T[1],T[2],-n.dot(T,N));const ja=new I,la=new I,ia=[],ca=e.create(),fa=e.create(this._clipBox);e.offset(fa,-N[0],-N[1],-N[2],fa);this.nodes.forAll(na=>
{const pa=na.splatSize*this._scaleFactor;var xa=v.minimumDistancePlane(na.obb,U),Da=v.maximumDistancePlane(na.obb,U);xa-=Y.drawScreenSpace?0:G(pa,xa+da,Y,aa,na.isLeaf);Da-=Y.drawScreenSpace?0:G(pa,Da+da,Y,aa,na.isLeaf);xa=null!=ja.dist&&null!=la.dist&&ja.dist<xa*ea&&la.dist>Da*ea;if(!(0>Da||xa)&&(Da=G(pa,Da+da,Y,aa,na.isLeaf),v.intersectLine(na.obb,N,T,Da))){Da*=Da;v.toAaBoundingBox(na.obb,ca);e.offset(ca,-N[0],-N[1],-N[2],ca);xa=!e.contains(fa,ca);n.subtract(W,na.origin,N);var ua=na.coordinates.length/
3;for(let ma=0;ma<ua;ma++){S[0]=W[0]+na.coordinates[3*ma];S[1]=W[1]+na.coordinates[3*ma+1];S[2]=W[2]+na.coordinates[3*ma+2];if(xa&&!e.containsPoint(fa,S))continue;var Fa=n.dot(S,T),qa=n.squaredLength(S)-Fa*Fa;if(qa>Da)continue;var sa=Fa+da;const ra=Y.drawScreenSpace?0:G(pa,sa,Y,aa,na.isLeaf);if(0>Fa-ra)continue;sa-=ra;sa=G(pa,sa,Y,aa,na.isLeaf);if(qa>sa*sa)continue;const va=(Fa-ra)*ea;Fa=Ia=>{var Ja=ma,Ha=Ia.point;c.isNone(Ha)&&(Ha=l.create());Ha[0]=na.origin[0]+na.coordinates[3*Ja];Ha[1]=na.origin[1]+
na.coordinates[3*Ja+1];Ha[2]=na.origin[2]+na.coordinates[3*Ja+2];Ia.point=Ha;Ia.dist=va;Ia.normal=V;Ia.node=na;Ia.pointId=ma;Ia.layerUid=this.layerUid;return Ia};(null==ja.dist||va<ja.dist)&&(null==P||P(N,R,va))&&Fa(ja);J.options.store!==E.StoreResults.MIN&&(null==la.dist||va>la.dist)&&(null==P||P(N,R,va))&&Fa(la);J.options.store!==E.StoreResults.ALL||null!=P&&!P(N,R,va)||(qa=new I,ia.push(Fa(qa)))}}});const ba=na=>{const {layerUid:pa,node:xa,pointId:Da}=na;return{point:na.point,layerUid:pa,graphicUid:Da,
createGraphic:()=>this._params.createGraphic(xa,Da,na.point)}},Z=(na,pa)=>{const xa=ba(pa);na.set(this.type,xa,pa.dist,pa.normal)};if(M(ja)){var ha=J.results.min;(null==ha.dist||ja.dist<ha.dist)&&Z(ha,ja)}M(la)&&J.options.store!==E.StoreResults.MIN&&(ha=J.results.max,(null==ha.dist||la.dist>ha.dist)&&Z(ha,la));if(J.options.store===E.StoreResults.ALL){ha=m.fromPoints(N,R);for(const na of ia){const pa=u.newIntersectorResult(ha);Z(pa,na);J.results.all.push(pa)}}};Q.prepareTechnique=function(J){if(0===
this.nodes.length||J.pass!==y.RenderPass.MATERIAL&&J.pass!==y.RenderPass.MATERIAL_DEPTH&&J.pass!==y.RenderPass.MATERIAL_HIGHLIGHT)return null;this.nodes.forAll(N=>{null==N.vao&&this._initNode(J,N)});const P=this._getSizeParams();this._techniqueConfig.drawScreenSize=P.drawScreenSpace;this._techniqueConfig.slicePlaneEnabled=this._slicePlaneEnabled;this._techniqueConfig.sceneHasOcludees=J.hasOccludees;this._techniqueConfig.output=J.pass===y.RenderPass.MATERIAL_DEPTH?q.ShaderOutput.Depth:J.pass===y.RenderPass.MATERIAL_HIGHLIGHT?
q.ShaderOutput.Highlight:q.ShaderOutput.Color;return this._techniqueRep.releaseAndAcquire(p.PointRendererTechnique,this._techniqueConfig,this._technique)};Q.render=function(J,P){const N=J.rctx,R=N.useTechnique(P),S=this._clipBox,T=!e.equals(S,e.POSITIVE_INFINITY,(aa,da)=>aa===da);T||(n.set(this.tempVec3,-Infinity,-Infinity,-Infinity),R.setUniform3fv("clipMin",this.tempVec3),n.set(this.tempVec3,Infinity,Infinity,Infinity),R.setUniform3fv("clipMax",this.tempVec3));R.setUniformMatrix4fv("proj",J.camera.projectionMatrix);
J.pass===y.RenderPass.MATERIAL_DEPTH&&R.setUniform2fv("nearFar",J.camera.nearFar);J.isHighlightPass&&(this._bindParameters.inverseViewport[0]=1/J.camera.fullViewport[2],this._bindParameters.inverseViewport[1]=1/J.camera.fullViewport[3],this._bindParameters.highlightDepthTexture=J.highlightDepthTexture,r.bindOutputHighlight(R,this._bindParameters));const V=this._getSizeParams(),W=J.camera.pixelRatio;V.drawFixedSize&&R.setUniform2f("pointScale",V.fixedSize*W,J.camera.fullHeight);const U=this._slicePlaneEnabled?
J.sliceHelper&&J.sliceHelper.plane:null;this.nodes.forAll(aa=>{if(0!==aa.coordinates.length&&(!J.isHighlightPass||aa.highlights)){R.setUniform2f("screenMinMaxSize",V.screenMinSize*W,(aa.isLeaf?256:64)*W);V.drawFixedSize||R.setUniform2f("pointScale",aa.splatSize*this._scaleFactor*W,J.camera.fullHeight/W);var da=aa.origin;T&&(n.set(this.tempVec3,S[0]-da[0],S[1]-da[1],S[2]-da[2]),R.setUniform3fv("clipMin",this.tempVec3),n.set(this.tempVec3,S[3]-da[0],S[4]-da[1],S[5]-da[2]),R.setUniform3fv("clipMax",
this.tempVec3));h.fromTranslation(this.tempMatrix4,da);h.multiply(this.tempMatrix4,J.camera.viewMatrix,this.tempMatrix4);R.setUniformMatrix4fv("modelView",this.tempMatrix4);t.bindSliceUniforms(R,P.configuration,U,{origin:da});N.bindVAO(aa.vao);J.isHighlightPass?this._renderHighlightFragments(N,aa):N.drawArrays(D.PrimitiveType.POINTS,0,aa.coordinates.length/3)}})};Q._renderHighlightFragments=function(J,P){var N=P.highlights;if(!c.isNone(N)){P=c.unwrap(N[0].component);var R=P+1;for(let S=1;S<N.length;S++){const T=
c.unwrap(N[S].component);T!==R&&(R-=P,0<R&&J.drawArrays(D.PrimitiveType.POINTS,P,R),P=T);R=T+1}N=R-P;0<N&&J.drawArrays(D.PrimitiveType.POINTS,P,N)}};Q.addNode=function(J){this.nodes.push(J);this._highlights.nodeAdded(J);this._requestRender()};Q.removeNode=function(J){let P=null;this.nodes.filterInPlace(N=>N.id===J?(P=N,N.vao=c.disposeMaybe(N.vao),this._highlights.nodeRemoved(N),!1):!0);this._requestRender();return P};Q.forEachNode=function(J){this.nodes.forAll(J)};Q.removeAll=function(){this.nodes.forAll(J=>
J.vao=c.disposeMaybe(J.vao));this._highlights.removeAll();this.nodes.clear();this._requestRender()};Q.highlight=function(J){return this._highlights.add(J)};Q._addHighlight=function(J,P,N){var R=J.highlights;c.isNone(R)&&(R=[]);P={component:P,id:N};R.push(P);P=L(P);for(N=R.length-1;0<N&&P<L(R[N-1]);)[R[N-1],R[N]]=[R[N],R[N-1]],--N;J.highlights=R;this._requestRender()};Q._removeHighlight=function(J,P){J.highlights=H(J.highlights,P);this._requestRender()};Q._initNode=function(J,P){J=J.rctx;P.vao=new C.VertexArrayObject(J,
x.Default3D,K,{positions:B.BufferObject.createVertex(J,D.Usage.STATIC_DRAW,P.coordinates),colors:B.BufferObject.createVertex(J,D.Usage.STATIC_DRAW,P.rgb)})};Q._requestRender=function(){this._context&&this._context.requestRender()};Q._getSizeParams=function(){const J=this._useFixedSizes,P=J&&!this._useRealWorldSymbolSizes;return{drawScreenSpace:P,drawFixedSize:J,fixedSize:P?this._sizePx:this._size,screenMinSize:J?0:this._minSizePx}};b._createClass(O,[{key:"needsHighlight",get:function(){return this._highlights.hasHighlights}},
{key:"useFixedSizes",get:function(){return this._useFixedSizes},set:function(J){this._useFixedSizes!==J&&(this._useFixedSizes=J,this._requestRender())}},{key:"scaleFactor",get:function(){return this._scaleFactor},set:function(J){this._scaleFactor!==J&&(this._scaleFactor=J,this._requestRender())}},{key:"minSizePx",get:function(){return this._minSizePx},set:function(J){this._minSizePx!==J&&(this._minSizePx=J,this._requestRender())}},{key:"useRealWorldSymbolSizes",get:function(){return this._useRealWorldSymbolSizes},
set:function(J){this._useRealWorldSymbolSizes!==J&&(this._useRealWorldSymbolSizes=J,this._requestRender())}},{key:"size",get:function(){return this._size},set:function(J){this._size!==J&&(this._size=J,this._requestRender())}},{key:"sizePx",get:function(){return this._sizePx},set:function(J){this._sizePx!==J&&(this._sizePx=J,this._requestRender())}},{key:"clippingBox",set:function(J){e.set(this._clipBox,J||e.POSITIVE_INFINITY)}},{key:"slicePlaneEnabled",get:function(){return this._slicePlaneEnabled},
set:function(J){this._slicePlaneEnabled!==J&&(this._slicePlaneEnabled=J,this._requestRender())}}]);return O}();let I=function(){this.normal=this.dist=this.point=this.pointId=this.node=null;this.layerUid=""};a.PointRenderer=A;a.isInstanceOfNode=function(O){return O.hasOwnProperty("splatSize")};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/PointHighlights":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/handleUtils ../../../../core/maybe ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Object3DStateID".split(" "),
function(a,b,c,g,h,w){let n=function(){function l(e){this._context=e;this._highlights=new Set}var k=l.prototype;k.destroy=function(){this._highlights=null};k.add=function(e){const d=new f(e);this._highlights.add(d);this._enableSet(d);return c.makeHandle(()=>this._removeSet(d))};k._removeSet=function(e){this._disableSet(e);this._highlights.delete(e)};k._enableSet=function(e){e.enabled||(e.enabled=!0,this._context.forEachNode(d=>this._enableSetForNode(e,d)))};k._enableSetForNode=function(e,d){if(e.enabled){var m=
e.ids.get(d.id);m&&m.forEach(z=>this._context.addHighlight(d,z,e.id))}};k._disableSet=function(e){e.enabled&&(e.enabled=!1,this._context.forEachNode(d=>this._disableSetForNode(e,d)))};k._disableSetForNode=function(e,d){e.enabled||this._context.removeHighlight(d,e.id)};k.nodeAdded=function(e){this._highlights.forEach(d=>this._enableSetForNode(d,e))};k.nodeRemoved=function(e){this._highlights.forEach(d=>this._disableSetForNode(d,e))};k.removeAll=function(){this._highlights.forEach(e=>this._disableSet(e))};
b._createClass(l,[{key:"hasHighlights",get:function(){return 0<this._highlights.size}}]);return l}(),f=function(){function l(k){this.id=new w.Object3DStateID(h.Object3DState.Highlight);this.ids=new Map;this.enabled=!1;for(const e of k)g.isSome(e)&&this._add(e.nodeId,e.pointId)}l.prototype._add=function(k,e){const d=this.ids.get(k);d?d.add(e):this.ids.set(k,new Set([e]))};return l}();a.PointHighlights=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/PointRendererTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutputOptions ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../../chunks/PointRenderer.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z){n=function(v){function q(r,x,u){return v.call(this,r,x,u)||this}c._inheritsLoose(q,v);var t=q.prototype;t.initializeProgram=function(r){var x=q.shader.get();const u=this.configuration;x=x.build({output:u.output,slicePlaneEnabled:u.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,drawScreenSize:u.drawScreenSize});return new k.Program(r.rctx,x,l.Default3D)};t.initializePipeline=function(){return z.makePipelineState({depthTest:{func:m.CompareFunction.LESS},
depthWrite:z.defaultDepthWriteParams,colorWrite:z.defaultColorWriteParams,stencilWrite:this.configuration.sceneHasOcludees?e.stencilWriteMaskOn:null,stencilTest:this.configuration.sceneHasOcludees?e.stencilBaseAllZerosParams:null})};return q}(n.ShaderTechnique);n.shader=new w.ReloadableShaderModule(d.PointRendererShader,()=>new Promise((v,q)=>a(["./PointRenderer.glsl"],v,q)));w=function(v){function q(){var t=v.apply(this,arguments)||this;t.output=h.ShaderOutput.Color;t.slicePlaneEnabled=!1;t.drawScreenSize=
!1;t.sceneHasOcludees=!1;return t}c._inheritsLoose(q,v);return q}(f.ShaderTechniqueConfiguration);g.__decorate([f.parameter({count:h.ShaderOutput.COUNT})],w.prototype,"output",void 0);g.__decorate([f.parameter()],w.prototype,"slicePlaneEnabled",void 0);g.__decorate([f.parameter()],w.prototype,"drawScreenSize",void 0);g.__decorate([f.parameter()],w.prototype,"sceneHasOcludees",void 0);b.PointRendererTechnique=n;b.PointRendererTechniqueConfiguration=w;Object.defineProperty(b,"__esModule",{value:!0})})},
"esri/chunks/PointRenderer.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),function(a,
b,c,g,h,w,n,f){function l(e){const d=new n.ShaderBuilder,m=e.output===b.ShaderOutput.Color,z=e.output===b.ShaderOutput.Depth,v=e.output===b.ShaderOutput.Highlight;d.extensions.add("GL_OES_standard_derivatives");d.include(c.Slice,e);d.attributes.add(f.VertexAttribute.POSITION,"vec3");d.attributes.add(f.VertexAttribute.COLOR,"vec3");d.vertex.uniforms.add("modelView","mat4").add("proj","mat4").add("screenMinMaxSize","vec2").add("pointScale","vec2").add("clipMin","vec3").add("clipMax","vec3");z?(d.vertex.uniforms.add("nearFar",
"vec2"),d.varyings.add("depth","float")):e.output!==b.ShaderOutput.Highlight&&d.varyings.add("vColor","vec3");d.vertex.code.add(w.glsl`
    void main(void) {
      // Move clipped points outside of clipspace
      if (position.x < clipMin.x || position.y < clipMin.y || position.z < clipMin.z ||
        position.x > clipMax.x || position.y > clipMax.y || position.z > clipMax.z) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      if (rejectBySlice(position)) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      // Position in camera space
      vec4 camera = modelView * vec4(position, 1.0);

      float pointSize = pointScale.x;
      vec4 position = proj * camera;
     ${e.drawScreenSize?w.glsl`
      float clampedScreenSize = pointSize;`:w.glsl`
      float pointRadius = 0.5 * pointSize;
      vec4 cameraOffset = camera + vec4(0.0, pointRadius, 0.0, 0.0);
      vec4 positionOffset = proj * cameraOffset;
      float radius = abs(positionOffset.y - position.y);
      float viewHeight = pointScale.y;
      // screen diameter = (2 * r / w) * (h / 2)
      float screenPointSize = (radius / position.w) * viewHeight;
      float clampedScreenSize = clamp(screenPointSize, screenMinMaxSize.x, screenMinMaxSize.y);
      // Shift towards camera, to move rendered point out of terrain i.e. to
      // the camera-facing end of the virtual point when considering it as a
      // 3D sphere.
      camera.xyz -= normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;
      position = proj * camera;`}

     gl_PointSize = clampedScreenSize;
     gl_Position = position;

     ${z?w.glsl`depth = (-camera.z - nearFar[0]) / (nearFar[1] - nearFar[0]);`:""}
     ${m?w.glsl`vColor = color;`:""}
    }
  `);d.fragment.include(h.RgbaFloatEncoding,e);v&&d.include(g.OutputHighlight);d.fragment.code.add(w.glsl`
    void main(void) {
      vec2 vOffset = gl_PointCoord - vec2(0.5, 0.5);
      float r2 = dot(vOffset, vOffset);

      if (r2 > 0.25) {
        discard;
      }
      ${z?w.glsl`gl_FragColor = float2rgba(depth);`:""}
      ${v?w.glsl`outputHighlight();`:""}
      ${m?w.glsl`gl_FragColor = vec4(vColor, 1.0);`:""}
    }
  `);return d}const k=Object.freeze({__proto__:null,build:l});a.PointRendererShader=k;a.build=l})},"esri/views/3d/layers/support/PopupSceneLayerView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Error ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/set ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/fieldUtils ../../../layers/support/popupUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m){a.PopupSceneLayerView=z=>{z=function(v){function q(){return v.apply(this,arguments)||this}b._inheritsLoose(q,v);var t=q.prototype;t._validateFetchPopupFeatures=function(r){const {layer:x}=this,{popupEnabled:u}=x;if(!u)return new g("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:x});if(!m.getFetchPopupTemplate(x,r))return new g("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:x})};t.prepareFetchPopupFeatures=
function(){var r=b._asyncToGenerator(function*(x){});return function(x){return r.apply(this,arguments)}}();t.fetchPopupFeatures=function(){var r=b._asyncToGenerator(function*(x,u){if(x=this._validateFetchPopupFeatures(u))return Promise.reject(x);x=h.isSome(u)?u.clientGraphics:null;if(!x||0===x.length)return Promise.resolve([]);var E="scene"===this.layer.type&&h.isSome(this.layer.associatedLayer)?this.layer.associatedLayer:this.layer;u=d.unpackFieldNames(this.layer.fieldsIndex,yield m.getRequiredFields(E,
m.getFetchPopupTemplate(this.layer,u)));yield this.prepareFetchPopupFeatures(u);E=new Set;const y=[],A=[];for(const p of x)d.populateMissingFields(u,p,E)?A.push(p):y.push(p);return 0===A.length?Promise.resolve(y):this.whenGraphicAttributes(A,[...E]).catch(()=>A).then(p=>y.concat(p))});return function(x,u){return r.apply(this,arguments)}}();return q}(z);return z=c.__decorate([e.subclass("esri.views.3d.layers.support.PopupSceneLayerView")],z)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/SceneLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../core/sql/WhereClause ../../../layers/support/FeatureFilter ../../../rest/support/Query ./I3SMeshView3D ./II3SMeshView3D ./LayerView3D ./i3s/attributeEditing ./i3s/I3SGeometryUtil ./i3s/I3SMeshViewFilter ./i3s/I3SNode ./i3s/I3SQueryEngine ./i3s/I3SQueryFeatureAdapter ./i3s/I3SQueryFeatureStore ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/PopupSceneLayerView ./support/SceneLayerViewRequiredFields ../support/updatingProperties ../../layers/SceneLayerView ../../support/floorFilterUtils ../../support/Scheduler".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H,M,K){const I=g.getLogger("esri.views.3d.layers.SceneLayerView3D");g=C.defineFieldProperties();v=function(O){function Q(){var P=O.apply(this,arguments)||this;P.type="scene-layer-3d";P.lodFactor=1;P.progressiveLoadFactor=1;P._elevationContext="scene";P._isIntegratedMesh=!1;P._supportsLabeling=!0;P._interactiveEditingSessions=new Map;P._queryEngine=null;return P}a._inheritsLoose(Q,O);var J=Q.prototype;J.initialize=function(){this.fieldsHelper=
new G.SceneLayerViewRequiredFields({layerView:this});this.updatingHandles.add(()=>this.layer.rangeInfos,P=>this._rangeInfosChanged(P),w.initial);this.updatingHandles.add(()=>this.layer.renderer,P=>this.updatingHandles.addPromise(this._rendererChange(P)),w.initial);this.updatingHandles.add(()=>[this.parsedDefinitionExpression,this.filter,this.floorFilterClause,this.excludeObjectIdsSorted,h.applySome(this.viewFilter,P=>[P.parsedWhereClause,P.parsedGeometry,P.sortedObjectIds])],()=>this._filterChange());
this.updatingHandles.add(()=>[this.filter,h.applySome(this.viewFilter,P=>P.parsedGeometry)],()=>this._geometryFilterChange());this.handles.add(this.layer.on("apply-edits",P=>this.updatingHandles.addPromise(P.result)));this.handles.add(this.layer.on("edits",P=>this._handleEdits(P)))};J.destroy=function(){this.fieldsHelper=h.destroyMaybe(this.fieldsHelper)};J._rangeInfosChanged=function(P){null!=P&&0<P.length&&I.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};
J.createQuery=function(){const P={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};return h.isSome(this.filter)?this.filter.createQuery(P):new z(P)};J.queryExtent=function(P,N){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(P),null==N?void 0:N.signal)};J.queryFeatureCount=function(P,N){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(P),null==N?void 0:N.signal)};J.queryFeatures=function(P,N){return this._ensureQueryEngine().executeQuery(this._ensureQuery(P),
null==N?void 0:N.signal).then(R=>{if(null==R||!R.features)return R;const S=this.layer;for(const T of R.features)T.layer=S,T.sourceLayer=S;return R})};J.queryObjectIds=function(P,N){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(P),null==N?void 0:N.signal)};J._ensureQueryEngine=function(){this._queryEngine||(this._queryEngine=this._createQueryEngine());return this._queryEngine};J._createQueryEngine=function(){const P=x.createGetFeatureExtent(this.view.spatialReference,this.view.renderSpatialReference,
this._collection);return new y.default({layerView:this,priority:K.TaskPriority.FEATURE_QUERY_ENGINE,spatialIndex:new p.default({featureAdapter:new A.I3SQueryFeatureAdapter({objectIdField:this.layer.objectIdField,attributeStorageInfo:this.layer.attributeStorageInfo,getFeatureExtent:P}),forAllFeatures:(N,R)=>this._forAllFeatures((S,T,V)=>N({id:S,index:T,meta:V}),R,q.ForAllFeaturesVisibilityMode.ALL_IN_CLIPPING_AREA),getFeatureExtent:P,sourceSpatialReference:B.getIndexCrs(this.layer),viewSpatialReference:this.view.spatialReference})})};
J.highlight=function(P){const N=this._highlights;if(P instanceof z){const {set:R,handle:S}=N.acquireSet();this.queryObjectIds(P).then(T=>N.setFeatureIds(R,T));return S}return O.prototype.highlight.call(this,P)};J.createInteractiveEditSession=function(P){return r.createInteractiveEditSession(this.attributeEditingContext,P)};J._createLayerGraphic=function(P){P=new c(null,null,P);P.layer=this.layer;P.sourceLayer=this.layer;return P};J.canResume=function(){return O.prototype.canResume.call(this)&&(!this._controller||
this._controller.rootNodeVisible)};J.getFilters=function(){const P=O.prototype.getFilters.call(this),N=this.excludeObjectIdsSorted;h.isSome(N)&&P.push(R=>B.objectIdFilter(N,!1,R));this.floorFilterClause&&this.addSqlFilter(P,this.floorFilterClause,this.logError);this.addSqlFilter(P,this.parsedDefinitionExpression,this.logError);h.isSome(this.viewFilter)&&this.viewFilter.addFilters(P,this.view,this._controller.crsIndex,this._collection);return P};J._ensureQuery=function(P){return this._addDefinitionExpressionToQuery(h.isNone(P)?
this.createQuery():z.from(P))};J._handleEdits=function(P){r.processAttributeEdits(this.attributeEditingContext,P)};J.computeNodeFiltering=function(P){const N=this.viewFilter;return h.isNone(N)||N.isMBSGeoemtryVisible(P,this.view.spatialReference,this._controller.crsIndex)?E.NodeFilterImpact.Unmodified:E.NodeFilterImpact.Culled};a._createClass(Q,[{key:"filter",get:function(){return h.isSome(this.viewFilter)?this.viewFilter.filter:null},set:function(P){h.isNone(P)||!u.I3SMeshViewFilter.checkSupport(P)?
this.viewFilter=null:h.isSome(this.viewFilter)?this.viewFilter.filter=P:this.viewFilter=new u.I3SMeshViewFilter({filter:P,layerFieldsIndex:this.layer.fieldsIndex,loadAsyncModule:N=>this._loadAsyncModule(N),applyFilters:()=>this._applyFilters(!0),addSqlFilter:(N,R)=>this.addSqlFilter(N,R,this.logError)})}},{key:"requiredFields",get:function(){var P,N;return null!=(P=null==(N=this.fieldsHelper)?void 0:N.requiredFields)?P:[]}},{key:"floorFilterClause",get:function(){const P=M.getFloorFilterClause(this);
return h.isSome(P)?d.WhereClause.create(P,this.layer.fieldsIndex):null}},{key:"excludeObjectIdsSorted",get:function(){const P=this.layer.excludeObjectIds;return P.length?P.toArray().sort((N,R)=>N-R):null}},{key:"lodCrossfadeinDuration",get:function(){var P,N;return null!=(P=null==(N=this.view)?void 0:N.qualitySettings.sceneService["3dObject"].lodCrossfadeinDuration)?P:0}},{key:"lodCrossfadeoutDuration",get:function(){var P,N;return null!=(P=null==(N=this.view)?void 0:N.qualitySettings.sceneService["3dObject"].lodCrossfadeoutDuration)?
P:0}},{key:"lodCrossfadeUncoveredDuration",get:function(){var P,N;return null!=(P=null==(N=this.view)?void 0:N.qualitySettings.sceneService["3dObject"].lodCrossfadeUncoveredDuration)?P:0}},{key:"attributeEditingContext",get:function(){return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:this._getObjectIdField(),forEachNode:P=>this._forAllNodes(N=>h.isSome(N)?P(N.node,N.featureIds):null),attributeStorageInfo:this.i3slayer.attributeStorageInfo,attributeOverrides:this.attributeOverrides,
getAttributeData:P=>this.getAttributeData(P),setAttributeData:(P,N)=>this.setAttributeData(P,N),clearMemCache:()=>this.clearMemCache()}}},{key:"hasGeometryFilter",get:function(){const P=this.viewFilter;return h.isSome(P)&&h.isSome(P.parsedGeometry)}}]);return Q}(v.I3SMeshView3D(D.DefinitionExpressionSceneLayerView(F.PopupSceneLayerView(t.LayerView3D(H)))));b.__decorate([n.property({aliasOf:"layer"})],v.prototype,"i3slayer",void 0);b.__decorate([n.property(L.updatingProgress)],v.prototype,"updatingProgress",
void 0);b.__decorate([n.property({type:m})],v.prototype,"filter",null);b.__decorate([n.property()],v.prototype,"viewFilter",void 0);b.__decorate([n.property(g.requiredFields)],v.prototype,"requiredFields",null);b.__decorate([n.property(g.availableFields)],v.prototype,"availableFields",void 0);b.__decorate([n.property()],v.prototype,"fieldsHelper",void 0);b.__decorate([n.property()],v.prototype,"floorFilterClause",null);b.__decorate([n.property()],v.prototype,"excludeObjectIdsSorted",null);b.__decorate([n.property({readOnly:!0,
aliasOf:"view.qualitySettings.sceneService.3dObject.lodFactor"})],v.prototype,"lodFactor",void 0);b.__decorate([n.property({readOnly:!0,aliasOf:"_controller.updatingProgress"})],v.prototype,"updatingProgressValue",void 0);return v=b.__decorate([e.subclass("esri.views.3d.layers.SceneLayerView3D")],v)})},"esri/views/3d/layers/I3SMeshView3D":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../Graphic ../../../core/byteSizeEstimations ../../../core/Collection ../../../core/has ../../../core/Logger ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/scheduling ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat3 ../../../chunks/mat3f32 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/fieldUtils ../../../layers/support/layerUtils ../../../layers/support/SceneModification ../../../renderers/visualVariables/support/visualVariableUtils ../../../support/arcadeOnDemand ../../../symbols/Symbol3D ../../../symbols/support/unitConversionUtils ./I3SMeshViewLabeler ./I3SMeshWorkerHandle ./II3SMeshView3D ./SceneLayerWorker ./graphics/graphicUtils ./i3s/enums ./i3s/Highlights ./i3s/I3SAttributeOverrides ./i3s/I3SCrossfadeHelper ./i3s/I3SElevationProvider ./i3s/I3SGeometryUtil ./i3s/I3SIntersectionHandler ./i3s/I3SMaterialUtil ./i3s/I3SNode ./i3s/I3SProjectionUtil ./i3s/I3SUtil ./i3s/IDBCache ./support/attributeUtils ./support/symbolColorUtils ../support/debugFlags ../support/extentUtils ../support/orientedBoundingBox ../support/updatingProperties ../support/buffer/glUtil ../webgl-engine/collections/Component/ComponentObject ../webgl-engine/collections/Component/SourceGeometry ../webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../webgl-engine/lib/BasisUtil ../webgl-engine/lib/edgeRendering/interfaces".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H,M,K,I,O,Q,J,P,N,R,S,T,V,W,U,aa,da,Y,ea,ja,la,ia,ca,fa,ba,Z,ha,na,pa,xa,Da,ua,Fa,qa,sa,ma,ra,va,Ia,Ja){function Ha(ib){if(d.isNone(ib))return!1;const ob=ib.metallicRoughness;return ob&&0<=ob.baseColorTextureId||ob&&0<=ob.metallicRoughnessTextureId||0<=ib.normalTextureId||0<=ib.emissiveTextureId||0<=ib.occlusionTextureId}function Ta(ib){return d.isSome(ib)&&t.isArrayBuffer(ib.data)}function db(ib,ob){ib=1024+ib.interleavedVertexData.byteLength+
(ib.indices?ib.indices.byteLength:0)+ib.positionData.data.byteLength+ib.positionData.indices.byteLength;if(d.isSome(ob))for(const sb of ob)d.isSome(sb)&&t.isArrayBuffer(sb.data)&&(ib+=sb.data.byteLength);return ib}function fb(ib,ob){return ob.byteSize>Aa?(Ca.warn(`Node is too big to store in IndexedDB cache: ${ib.id} (${ob.byteSize} bytes)`),!1):0<ob.byteSize}function ka(ib){if(0===ib.length)return null;const ob=new Float64Array(10*ib.length);ib.forAll((sb,$a)=>{let za=sb.serviceObb;d.isNone(za)&&
(za=ya,F.copy(za.center,sb.mbs),za.halfSize[0]=za.halfSize[1]=za.halfSize[2]=sb.mbs[3]);sb=10*$a;ob[sb+0]=za.center[0];ob[sb+1]=za.center[1];ob[sb+2]=za.center[2];ob[sb+3]=za.halfSize[0];ob[sb+4]=za.halfSize[1];ob[sb+5]=za.halfSize[2];ob[sb+6]=za.quaternion[0];ob[sb+7]=za.quaternion[1];ob[sb+8]=za.quaternion[2];ob[sb+9]=za.quaternion[3]});return ob}function cb(ib,ob){ib.forEach(sb=>sb.opacity=ob)}const Ca=k.getLogger("esri.views.3d.layers.SceneLayerView3D"),Ka=[1,1,1,1];let Oa=function(ib){function ob(sb,
$a,za,Pa,Xa,Za,eb){var lb=ib.call(this)||this;lb.node=sb;lb.featureIds=$a;lb.objectHandle=za;lb.cachedRendererVersion=Pa;lb.attributeInfo=Xa;lb.material=Za;lb.textures=eb;lb.cachedEdgeMaterials=[];lb.edgeMemoryUsage=0;lb.cachedSymbology=null;return lb}c._inheritsLoose(ob,ib);return ob}(ja.NodeCrossfadeMetaData);var wa;(function(ib){ib[ib.CastShadows=4]="CastShadows";ib[ib.Pickable=5]="Pickable"})(wa||(wa={}));const Aa=100*n.ByteSizeUnit.MEGABYTES,Na=M.create(),Ua=K.create(),Ya=K.create(),ya=Fa.create(),
La=[0,0,0,0],Va=new h([0,0,0,0]),hb=[0,0,0,0],kb={remove(){},pause(){},resume(){}};b.I3SMeshView3D=ib=>{ib=function(ob){function sb(...za){za=ob.call(this,za)||this;za._elevationProvider=null;za._intersectionHandler=null;za._nodeId2Meta=new Map;za._nodeId2MetaReloading=new Map;za._i3sWasmLoaded=!1;za._hasLoadedPBRTextures=!1;za._asyncModuleLoading=0;za._addTasks=new Map;za._rendererVersion=0;za._colorVariable=null;za._opacityVariable=null;za._rendererFields=null;za._symbologyFields=null;za._symbologyOverride=
null;za._symbologyOverrideFields=null;za._symbolInfos=new Map;za._idbCache=new na.IDBCache("esri-scenelayer-cache","geometries");za.holeFilling="auto";za._hasColors=!1;za._hasTextures=!1;za._hasData=!1;za.filter=null;za.slicePlaneEnabled=!1;za._modifications=[];za._layerUrl="";za._cacheKeySuffix=null;za._arcade=null;za._tmpAttributeOnlyGraphic=new w(null,null,{});za._crossfadeHelper=new ja.I3SCrossfadeHelper(c._assertThisInitialized(za));return za}c._inheritsLoose(sb,ob);var $a=sb.prototype;$a.initialize=
function(){this._preLoadBasis();this.addResolvingPromise(this.i3slayer.indexInfo);const za=this.view.resourceController;this.attributeOverrides=new ea.I3SAttributeOverrides(this.i3slayer,za.memoryController);this._worker=new V.I3SMeshWorkerHandle(Xa=>za.schedule(Xa));this.addResolvingPromise(this._worker.promise);this._worker.setLegacySchema(this.layerUid,this.i3slayer.store.defaultGeometrySchema);ha.checkSceneLayerValid(this.i3slayer);ha.checkSceneLayerCompatibleWithView(this.i3slayer,this.view);
this._layerUrl=this.i3slayer.parsedUrl.path;this._controller=new I({layerView:this});this.geoMemoryEstimate=this.texMemoryEstimate=this.gpuMemoryEstimate=0;this._stage=this.view._stage;this._collection=this._stage.renderView.componentObjectCollection;this._highlights=new Y({collection:this._collection,forAllFeatures:Xa=>this._forAllFeatures(Xa,null,W.ForAllFeaturesVisibilityMode.ALL),forAllFeaturesOfNode:(Xa,Za)=>this._forAllFeaturesOfNode(Xa,Za)});if(this._isIntegratedMesh||!this.i3slayer.store.defaultGeometrySchema)this._hasSymbolColors=
!1;else{var Pa=this.i3slayer.store.defaultGeometrySchema.featureAttributes;this._hasSymbolColors=!!(Pa&&Pa.faceRange&&Pa.id)}this._hasVertexColors=null!=this.i3slayer.store.defaultGeometrySchema.vertexAttributes.color&&(null==this.i3slayer.cachedDrawingInfo||!this.i3slayer.cachedDrawingInfo.color);this._isIntegratedMesh||(this._edgeView=this._stage.renderView.ensureEdgeView());this._memCache=this.view.resourceController.memoryController.newCache(this.i3slayer.uid,Xa=>this._deleteComponentObject(Xa));
this._intersectionHandler=new ca.I3SIntersectionHandler({layerUid:this.layerUid,sublayerUid:this.sublayerUid,collection:this._collection,slicePlaneEnabled:this.slicePlaneEnabled,isGround:this._isIntegratedMesh,traverseNodeHierarchy:Xa=>d.isSome(this._controller.index)&&d.isSome(this._controller.index.rootNode)?this._controller.index.traverse(this._controller.index.rootNode,Za=>{var eb=Za.index;eb=this._nodeId2Meta.get(eb)||this._nodeId2MetaReloading.get(eb);return Xa(Za,d.isSome(eb)?eb.objectHandle:
null)}):()=>{}});this._elevationProvider=new la({layerView:this,intersectionHandler:this._intersectionHandler});this._hasLoadedPBRTextures=this._usePBR();this.updatingHandles.add(()=>this.view.clippingArea,()=>this._clippingAreaChanged(),v.initial);this.updatingHandles.add(()=>this.fullOpacity,Xa=>this._opacityChange(Xa));this.updatingHandles.add(()=>this.slicePlaneEnabled,Xa=>this._slicePlaneEnabledChange(Xa));this.updatingHandles.add(()=>this.elevationOffset,(Xa,Za)=>{this._reloadAll(Za);this._controller.invalidateVisibilityObbs()});
this.updatingHandles.add(()=>this.filter,()=>this._filterChange(),v.initial);this.updatingHandles.add(()=>this.view.qualitySettings.physicallyBasedRenderingEnabled,()=>this._updatePBR());Pa=()=>{this._reloadAll();this.clearMemCache()};this.updatingHandles.add(()=>this.rendererTextureUsage,Pa);this.updatingHandles.add(()=>this.uncompressedTextureDownsamplingEnabled,Pa);this.updatingHandles.add(()=>this.suspended,Xa=>this._suspendedChange(Xa),v.initial);this.updatingHandles.add(()=>this.i3slayer.labelsVisible,
()=>this._labelingChanged(),v.initial);this.updatingHandles.add(()=>this.i3slayer.labelingInfo,()=>this._labelingChanged(),v.initial);this.updatingHandles.add(()=>this._modifications,()=>this._modificationsChanged(),v.initial);this.handles.add([x.init(Da,"I3S_TREE_SHOW_TILES",Xa=>{if(Xa&&!this._treeDebugger){const Za=this._controller.crsIndex;(new Promise((eb,lb)=>a(["./support/I3STreeDebugger"],eb,lb))).then(({I3STreeDebugger:eb})=>{!this._treeDebugger&&Da.I3S_TREE_SHOW_TILES&&(this._treeDebugger=
new eb({lv:this,view:this.view,nodeSR:Za}))})}else Xa||Da.I3S_TREE_SHOW_TILES||(this._treeDebugger=d.destroyMaybe(this._treeDebugger))}),x.init(Da,"I3S_SHOW_MODIFICATIONS",()=>this._showModifications())]);this._cacheKeySuffix=ha.getCacheKeySuffix(this.i3slayer.spatialReference,this.view.renderSpatialReference);this._idbCache.init().catch(Xa=>Ca.warn(`Failed to initialize IndexedDB cache: ${Xa}`))};$a.destroy=function(){this._clearAddTasks();this.attributeOverrides=d.destroyMaybe(this.attributeOverrides);
this._elevationProvider&&(this._elevationProvider.layerChanged(),this.view.elevationProvider.unregister(this._elevationProvider),this._elevationProvider=null);this._intersectionHandler&&(this._stage.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler),this._intersectionHandler=null);const za=this._worker;za&&(za.destroyContext(this.i3slayer.uid).then(()=>za.destroy()),this._worker=null);this._removeAllNodeDataFromStage();this._memCache=d.destroyMaybe(this._memCache);this._edgeView=
this._stage=this._collection=null;this._labeler=d.destroyMaybe(this._labeler);this._treeDebugger=d.destroyMaybe(this._treeDebugger);this._controller=d.destroyMaybe(this._controller);this._highlights.destroy();this._nodeId2Meta.clear();this._nodeId2MetaReloading.clear();this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null)};$a._memEstimateTextureAdded=function(za){za=
za.estimatedTexMemRequired;this.gpuMemoryEstimate+=za;this.texMemoryEstimate+=za;return za};$a._memEstimateTextureRemoved=function(za){d.isSome(za)&&(za=za.estimatedTexMemRequired,this.gpuMemoryEstimate-=za,this.texMemoryEstimate-=za)};$a._memEstimateGeometryAdded=function(za){za=this._collection.getObjectGPUMemoryUsage(za);this.gpuMemoryEstimate+=za;this.geoMemoryEstimate+=za;return za};$a._memEstimateGeometryRemoved=function(za){za=this._collection.getObjectGPUMemoryUsage(za);this.gpuMemoryEstimate-=
za;this.geoMemoryEstimate-=za};$a.isNodeLoaded=function(za){return this._nodeId2Meta.has(za)};$a.isNodeReloading=function(za){return this._nodeId2MetaReloading.has(za)};$a.getUsedMemory=function(){let za=d.isSome(this._labeler)?this._labeler.usedMemory:0;this._nodeId2Meta.forEach(Pa=>za+=d.isSome(Pa)?Pa.node.memory:0);this._nodeId2MetaReloading.forEach(Pa=>za+=d.isSome(Pa)?Pa.node.memory:0);return za};$a.getUnloadedMemory=function(){return(d.isSome(this._controller)?this._controller.unloadedMemoryEstimate:
0)+(d.isSome(this._labeler)?this._labeler.unloadedMemoryEstimate:0)};$a.ignoresMemoryFactor=function(){return!1};$a._labelingChanged=function(){if(!Q.areLabelsVisible(this.i3slayer)||!this._supportsLabeling)d.isSome(this._labeler)&&(this._labeler.destroy(),this._labeler=null);else if(!d.isSome(this._labeler)){var za=new T({view:this.view,layer:this.i3slayer,collection:this._collection});this._nodeId2Meta.forEach(Pa=>d.isSome(Pa)&&this._addMetaToLabeler(za,Pa));this._labeler=za}};$a._loadAsyncModule=
function(za){++this._asyncModuleLoading;return za.then(Pa=>{--this._asyncModuleLoading;return Pa},Pa=>{--this._asyncModuleLoading;throw Pa;})};$a._modificationsChanged=function(){if(!this._i3sWasmLoaded&&this.hasModifications)this._i3sWasmLoaded=U.initialize().then(()=>{this._i3sWasmLoaded=!0;this._modificationsChanged();this.notifyUpdate()}),this.notifyUpdate();else if(!0===this._i3sWasmLoaded){var za=this.i3slayer.uid,Pa=this.i3slayer.spatialReference;this._worker.setModifications(za,this._layerClippingArea,
this._modifications,Pa);var Xa=V.toWasmModification(this._layerClippingArea,this._modifications,Pa);U.setModificationsSync({context:za,modifications:Xa,isGeodetic:Pa.isGeographic});this._controller.modificationsChanged();var Za=this.hasModifications?new m:null;this._nodeId2Meta.forEach((eb,lb)=>{d.isNone(eb)?this._nodeId2Meta.delete(lb):eb.node.hasModifications?(this._nodeId2Meta.delete(lb),this._nodeId2MetaReloading.set(lb,eb)):d.isSome(Za)&&Za.push(eb.node)});d.isSome(Za)&&this._nodeId2MetaReloading.forEach(eb=>
Za.push(eb.node));d.isSome(Za)&&0<Za.length&&(this.updateNodeModificationStatus(Za),Za.forAll(eb=>{if(eb.imModificationImpact!==ba.NodeIMModificationImpact.Culled){const lb=this._nodeId2Meta.get(eb.index);this._controller.invalidateGeometryVisibility(eb.index);this._nodeId2Meta.delete(eb.index);d.isSome(lb)&&this._nodeId2MetaReloading.set(eb.index,lb)}}));this.clearMemCache();this._controller.restartNodeLoading();this._showModifications()}};$a._showModifications=function(){d.isSome(this._modificationGraphics)&&
(this.view.graphics.removeMany(this._modificationGraphics),this._modificationGraphics=null);if(Da.I3S_SHOW_MODIFICATIONS&&0!==this._modifications.length){var za={clip:[227,227,79,.8],mask:[227,139,79,.8],replace:[139,227,79,.8]},Pa={type:"simple-fill",outline:{color:[255,255,255],width:1}};this._modificationGraphics=[];for(const Xa of this._modifications)Xa.geometry.spatialReference=this.i3slayer.spatialReference,this._modificationGraphics.push(new w({geometry:Xa.geometry,symbol:{...Pa,color:za[Xa.type]}}));
this.view.graphics.addMany(this._modificationGraphics)}};$a._addMetaToLabeler=function(za,Pa){za.addNodeMeta(Pa,(Xa,Za)=>this._createAttributes(Xa,Za))};$a._suspendedChange=function(za){za?(this._removeAllNodeDataFromStage(),this.view.elevationProvider&&this.view.elevationProvider.unregister(this._elevationProvider),this._stage.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler)):(this.view.elevationProvider.register(this._elevationContext,this._elevationProvider),this._stage.sceneIntersectionHelper.addIntersectionHandler(this._intersectionHandler))};
$a.getLoadedAttributes=function(za){za=this._nodeId2Meta.get(za);if(d.isSome(za)&&d.isSome(za.attributeInfo))return za.attributeInfo.loadedAttributes};$a.getAttributeData=function(za){za=this._nodeId2Meta.get(za);if(d.isSome(za)&&d.isSome(za.attributeInfo))return za.attributeInfo.attributeData};$a.setAttributeData=function(za,Pa){za=this._nodeId2Meta.get(za);d.isSome(za)&&d.isSome(za.attributeInfo)&&(za.attributeInfo.attributeData=Pa,this._attributeValuesChanged(za))};$a.updateAttributes=function(){var za=
c._asyncToGenerator(function*(Pa,Xa,Za){Pa=this._nodeId2Meta.get(Pa);d.isSome(Pa)&&(yield this.attributeOverrides.apply(Pa.featureIds,Xa,Za),Pa.attributeInfo=Xa,this._attributeValuesChanged(Pa))});return function(Pa,Xa,Za){return za.apply(this,arguments)}}();$a._attributeValuesChanged=function(za){za.cachedRendererVersion=this._getInvalidRendererVersion();za.filteredIds=null;d.isSome(this._labeler)&&this._labeler.setNodeMetaAttributes(za,(Pa,Xa)=>this._createAttributes(Pa,Xa));this._updateEngineObject(za)};
$a.clearMemCache=function(){d.isSome(this._memCache)&&this._memCache.clear()};$a.getVisibleNodes=function(){const za=[];this._nodeId2Meta.forEach(Pa=>d.isSome(Pa)&&za.push(Pa.node));return za};$a.getLoadedNodeIndices=function(za){this._nodeId2Meta.forEach((Pa,Xa)=>za.push(Xa));this._nodeId2MetaReloading.forEach((Pa,Xa)=>za.push(Xa))};$a._preLoadBasis=function(){!l("disable-feature:i3s-basis")&&0!==(this.supportedTextureEncodings&da.TextureEncoding.Basis)&&d.applySome(this.i3slayer.textureSetDefinitions,
za=>za.some(Pa=>Pa.formats.some(Xa=>"basis"===Xa.format||"ktx2"===Xa.format)))&&Ia.loadBasis()};$a._getVertexBufferLayout=function(za,Pa){za={hasTexture:Ha(za.params.material),hasNormals:Pa.normal,hasRegions:Pa.uvRegion};return sa.glLayout(ra.createVertexBufferLayout(this._getGeometryParameters(za)))};$a._getObjectIdField=function(){return this.i3slayer.objectIdField||"OBJECTID"};$a._findGraphicNodeAndIndex=function(za){const Pa=pa.attributeLookup(this.i3slayer.fieldsIndex,za.attributes,this._getObjectIdField());
let Xa=null;e.someMap(this._nodeId2Meta,Za=>{if(d.isNone(Za))return!1;const eb=Za.featureIds.indexOf(Pa);if(-1===eb)return!1;Xa={node:Za.node,index:eb};return!0});return Xa};$a._getGraphicIndices=function(za,Pa){za=this._nodeId2Meta.get(za.index);if(d.isNone(za))return[];const Xa=[],Za=this._getObjectIdField(),eb=this.i3slayer.fieldsIndex;for(const lb of Pa)Pa=pa.attributeLookup(eb,lb.attributes,Za),Pa=za.featureIds.indexOf(Pa),-1!==Pa&&Xa.push(Pa);return Xa};$a.whenGraphicBounds=function(za){za=
this._findGraphicNodeAndIndex(za);if(!za)return Promise.reject();var Pa=this._nodeId2Meta.get(za.node.index);if(d.isNone(Pa))return Promise.reject();za=ia.boundingBoxCornerPoints(za.index,this._collection,Pa.objectHandle,new Float64Array(24));if(H.projectBuffer(za,this.view.renderSpatialReference,0,za,this.view.spatialReference,0,8))return Pa=M.empty(),M.expandWithBuffer(Pa,za,0,8),Promise.resolve({boundingBox:Pa,screenSpaceObjects:[]})};$a.whenGraphicAttributes=function(za,Pa){return ha.whenGraphicAttributes(this.i3slayer,
za,this._getObjectIdField(),Pa,()=>[...this._nodeId2Meta.values()].filter(d.isSome))};$a.getGraphicFromIntersectorTarget=function(za){if(null==za.nodeIndex||null==za.componentIndex)return null;const Pa=this._nodeId2Meta.get(za.nodeIndex);return d.isNone(Pa)||null==Pa.featureIds||za.componentIndex>=Pa.featureIds.length?null:this._createGraphic(za.componentIndex,Pa)};$a._getCacheKey=function(za){return`${this._layerUrl}/v${19}/${za.id}${this._cacheKeySuffix}`};$a._getMemCacheKey=function(za,Pa=this.elevationOffset){return za+
"#"+Pa};$a.loadCachedGPUData=function(za){return d.isSome(this._memCache)?this._memCache.pop(this._getMemCacheKey(za.index)):null};$a.deleteCachedGPUData=function(za){d.isSome(za)&&this._deleteComponentObject(za)};$a._cacheGPUData=function(za,Pa=this.elevationOffset){if(d.isNone(this._memCache))this._deleteComponentObject(za);else{var Xa=this._controller.indexDepth-za.node.level;this._memCache.put(this._getMemCacheKey(za.node.index,Pa),za,za.node.memory,Xa)}};$a.loadMissingTextures=function(za,Pa,
Xa,Za){var eb;const lb=null!=(eb=null==za?void 0:za.filter((tb,mb)=>{if(0===(tb.usage&this.rendererTextureUsage))return!1;if(d.isNone(Pa))return!0;tb=fa.selectEncoding(tb.encodings,this.supportedTextureEncodings);mb=Pa[mb];return d.isNone(mb)||null==mb.data||tb&&mb.encoding!==tb.encoding?!0:!1}))?eb:[];return 0===lb.length?Promise.resolve(!1):Xa(lb,Za).then(tb=>{let mb=0;for(let Qa=0;Qa<za.length;Qa++)mb<tb.length&&tb[mb].id===za[Qa].id&&(Pa[Qa]=tb[mb],mb++);return!0})};$a.loadCachedNodeData=function(za,
Pa,Xa){return this._idbCacheEnabled?this._idbCache.get(this._getCacheKey(za),Pa).then(Za=>{if(null==Za)return null;if(Za.nodeVersion!==za.version)return this._idbCache.remove(this._getCacheKey(za)),null;za.geometryObb=Za.geometryObb;return this.loadMissingTextures(Za.requiredTextures,Za.textureData,Xa,Pa).then(eb=>{eb&&this._idbCache.initialized&&d.isSome(Za.textureData)&&(Za.byteSize=db(Za.transformedGeometry,Za.textureData),Za.textureData.every(Ta)&&fb(za,Za)&&this._idbCache.put(this._getCacheKey(za),
Za).catch(lb=>Ca.warn(`Failed to update node with textures in IndexedDB cache: ${za.id}: ${lb}`)));z.throwIfAborted(Pa);return Za})}):Promise.resolve(null)};$a.addNode=function(za,Pa,Xa){return"geometryData"in Pa?null==Pa.geometryBuffer?(this._addNodeMeta(za.index,null),Promise.resolve()):this._addData(za,Pa.attributeDataInfo,()=>this._transformNode(za,Pa,Xa).then(Za=>this._safeReschedule(()=>{if(d.isNone(Za))return za.hasModifications=!1,this._addCachedNodeData(za,null,Xa);za.hasModifications=Za.transformedGeometry.hasModifications;
const {obb:eb,componentOffsets:lb,featureIds:tb,transformedGeometry:mb}=Za;var Qa=Z.computeGlobalTransformation(za.mbs,this.elevationOffset,this._controller.crsIndex,this.view.renderSpatialReference);za.geometryObb=Fa.create([eb.center.x,eb.center.y,eb.center.z],[eb.extents.x,eb.extents.y,eb.extents.z],[eb.orientation.x,eb.orientation.y,eb.orientation.z,eb.orientation.w]);F.transformMat4(za.geometryObb.center,za.geometryObb.center,Qa);Pa.geometryData.componentOffsets=lb;tb&&(Pa.geometryData.featureIds=
Array.from(tb));Qa={nodeVersion:za.version,geometryData:Pa.geometryData,requiredTextures:Pa.requiredTextures,textureData:Pa.textureData,transformedGeometry:mb,globalTrafo:Qa,geometryObb:za.geometryObb,byteSize:db(mb,Pa.textureData)};if(this._idbCacheEnabled&&this._idbCache.initialized&&fb(za,Qa)){const Ra=d.isSome(Qa.textureData)?Qa.textureData.map(ab=>Ta(ab)?ab:null):null;this._idbCache.put(this._getCacheKey(za),{...Qa,textureData:Ra}).catch(ab=>Ca.warn(`Failed to store node in IndexedDB cache: ${za.id}: ${ab}`))}return this._addCachedNodeData(za,
Qa,Xa)},Xa))):Promise.reject()};$a.computeVisibilityObb=function(za){return ha.computeVisibilityObb(za,this.view.renderSpatialReference,this._controller.crsIndex,this.i3slayer.spatialReference,this.elevationOffset,this._modifications)};$a._transformNode=function(za,Pa,Xa){var Za=Pa.geometryData.geometries;const eb=Array(Za.length);for(var lb=0;lb<Za.length;++lb)eb[lb]=this._getVertexBufferLayout(Za[lb],Pa.geometryDescriptor);Za=za.mbs;lb=this.elevationOffset;var tb=this._controller.crsIndex,mb=this._controller.crsVertex;
const Qa=this.view.renderSpatialReference,Ra=Z.getLocalOrigin(Za,lb,tb),ab=Z.computeGlobalTransformation(Za,lb,tb,Qa);tb=H.getProjectorName(tb,mb);mb=H.getProjectorName(mb,Qa);return d.isNone(tb)||d.isNone(mb)?Promise.resolve(null):this._worker.invoke({context:this.i3slayer.uid,geometryBuffer:Pa.geometryBuffer,geometryData:Pa.geometryData,geometryDescriptor:Pa.geometryDescriptor,layouts:eb,localOrigin:Ra,globalTrafo:ab,mbs:Za,obb:za.serviceObb,elevationOffset:lb,needNormals:!this._isIntegratedMesh&&
this._controller.isMeshPyramid,normalReferenceFrame:this.i3slayer.normalReferenceFrame||"none",indexToVertexProjector:tb,vertexToRenderProjector:mb},Xa)};$a._setNewNodeOpacity=function(za){this._setNodeOpacity(za,this.nodeCrossfadingEnabled?0:this.fullOpacity)};$a.addCachedGPUData=function(za,Pa,Xa){za.geometryObb=Fa.clone(this._collection.getComponentObb(Pa.objectHandle));this._controller.isGeometryVisible(za)?(d.isSome(this._labeler)&&this._addMetaToLabeler(this._labeler,Pa),za=za.index,this._addNodeMeta(za,
Pa),this.updateNodeState(za,Xa),this._collection.setObjectVisibility(Pa.objectHandle,ma.State.Visible),this._updateMaterial(Pa),this._setNewNodeOpacity(Pa),this._updateEngineObject(Pa),this._highlights.objectCreated(Pa),d.isSome(this._treeDebugger)&&this._treeDebugger.update()):this._cacheGPUData(Pa)};$a.addCachedNodeData=function(za,Pa,Xa,Za){return this._addData(za,Xa,()=>this._addCachedNodeData(za,Pa,Za))};$a._addCachedNodeData=function(){var za=c._asyncToGenerator(function*(Pa,Xa,Za){var eb;if(this.suspended||
!this._controller.isGeometryVisible(Pa))this._removeNodeStageData(Pa.index,this.elevationOffset,this._nodeId2MetaReloading);else if(d.isNone(Xa))this._addNodeMeta(Pa.index,null);else{var lb=this._addTasks.get(Pa.index),{geometryData:tb,transformedGeometry:mb,globalTrafo:Qa}=Xa;yield this.attributeOverrides.apply(tb.featureIds,lb.attributeInfo,Za);var Ra=d.isSome(Xa.textureData)?Xa.textureData.filter(Fb=>d.isSome(Fb)&&0!==(Fb.usage&this.rendererTextureUsage)):[];!l("disable-feature:i3s-basis")&&Ra.some(Fb=>
d.isSome(Fb)&&(Fb.encoding===da.TextureEncoding.Basis||Fb.encoding===da.TextureEncoding.KTX2))&&(yield Ia.loadBasis());Pa.memory=0;var {componentOffsets:ab,geometries:jb,featureIds:pb}=tb,ub=this._collection,rb=jb[0],{layout:Ab,indices:Kb,interleavedVertexData:Ob,positionData:Ub,hasColors:Bc}=mb,Vb=this._materialParameters(rb,Ab),lc=ab||new Uint32Array([0,Kb?Kb.length:Ob.byteLength/Ab[0].stride]);lc={vertices:{data:Ob,count:Ob.byteLength/Ab[0].stride,layoutParameters:Vb.geometryParams},positionData:{positions:Ub.data,
indices:Ub.indices},indices:Kb,componentOffsets:lc};var $b=rb.transformation?C.clone(rb.transformation):C.create();D.multiply($b,Qa,$b);rb=D.getTranslation(G.create(),$b);$b=p.fromMat4(B.create(),$b);var rc=this.view.renderSpatialReference,sc=this.view.basemapTerrain.spatialReference,mc=G.create(),nc=[1,1,1];H.localLinearScaleFactors(rb,rc,nc,sc)||Ca.errorOnce("Unsupported coordinate system for IM overlay");H.projectVectorToVector(rb,rc,mc,sc);var fc=ub.createObject({toMapSpace:[mc[0],mc[1],nc[0],
nc[1]],geometry:lc,obb:d.unwrap(Pa.geometryObb),transform:{position:rb,rotationScale:$b}}),{textures:tc,texturePromise:Uc}=this._initMaterialAndTextures(fc,Vb.material,Ra,Vb.geometryParams.textureCoordinates===va.TextureCoordinateAttributeType.Atlas);Pa.memory+=this._memEstimateGeometryAdded(fc);Pa.memory+=tc.reduce((Fb,Wb)=>Fb+(d.isSome(Wb)?this._memEstimateTextureAdded(Wb):0),0);Ra=!!Vb.material.hasParametersFromSource;Vb="blend"!==Vb.material.alphaMode&&1<=Vb.material.metallicRoughness.baseColorFactor[3];
var Hb=new Oa(Pa,pb,fc,this._getInvalidRendererVersion(),lb.attributeInfo,{hasParametersFromSource:Ra,isOpaque:Vb},tc);lb.meta=Hb;!this._hasTextures&&null!=(eb=Xa.requiredTextures)&&eb.some(({usage:Fb})=>0!==(Fb&da.TextureUsage.ColorTextures))&&(this._hasTextures=!0);this._hasData=!0;this._hasColors=this._hasColors||Bc;this._hasTextures=this._hasTextures||!!Pa.resources.texture;this.notifyChange("hasTexturesOrVertexColors");var Cc=this.slicePlaneEnabled;return Promise.all([this._addOrUpdateEdgeRendering(Hb),
Uc]).then(([Fb])=>{d.isSome(Fb)&&Fb.updateObjectVisibility(Hb.objectHandle,!1);return this._safeReschedule(()=>{var Wb=this._addTasks.get(Pa.index);if(Wb)if(d.isSome(this._labeler)&&this._addMetaToLabeler(this._labeler,Hb),this._addNodeMeta(Pa.index,Hb),Wb.meta=null,this.suspended)this._removeNodeStageData(Pa.index,this.elevationOffset);else{ub.setObjectVisibility(fc,ma.State.Visible);d.isSome(Fb)&&Fb.updateObjectVisibility(Hb.objectHandle,!0);Hb.attributeInfo=Wb.attributeInfo;Wb=Hb.cachedRendererVersion!==
this._rendererVersion;var Qc=Cc!==this.slicePlaneEnabled;this._setObjectSymbolColors(Hb);var wc=this._applyFiltersToNode(Hb);(Wb||d.isSome(Fb)&&(Qc||wc))&&this._addOrUpdateEdgeRendering(Hb);this._visibleGeometryChanged(Hb);this._highlights.objectCreated(Hb);this._updateMaterial(Hb);this._setNewNodeOpacity(Hb);d.isSome(this._treeDebugger)&&this._treeDebugger.update()}},Za)}).catch(Fb=>{d.isSome(lb.meta)&&(this._cacheGPUData(lb.meta),lb.meta=null);throw Fb;})}});return function(Pa,Xa,Za){return za.apply(this,
arguments)}}();$a._addNodeMeta=function(za,Pa){this._removeNodeStageData(za,this.elevationOffset,this._nodeId2MetaReloading);if(this._nodeId2Meta.has(za)){Ca.error("Removing duplicated node");const Xa=this._nodeId2Meta.get(za);d.isSome(Xa)&&this._deleteComponentObject(Xa)}d.isSome(Pa)&&(Pa.lodCrossfadeProgress=null,this.nodeCrossfadingEnabled&&cb(Pa.cachedEdgeMaterials,0));this._nodeId2Meta.set(za,Pa)};$a._safeReschedule=function(za,Pa){z.throwIfAborted(Pa);return this._controller.reschedule(za,Pa)};
$a._materialParameters=function(za,Pa){za=d.isSome(za.params.material)?za.params.material:fa.defaultMaterial();const Xa=Pa.some(eb=>"uvRegion"===eb.name);Pa=Pa.some(eb=>"normalCompressed"===eb.name);const Za=Ha(za);return{geometryParams:this._getGeometryParameters({hasTexture:Za,hasNormals:Pa,hasRegions:Xa}),material:za}};$a._initMaterialAndTextures=function(za,Pa,Xa,Za){const eb=this._stage.renderView,lb=Xa.map(mb=>fa.createTexture(mb,Pa,Za,eb));this._stage.addMany(lb);let tb=null;this._collection.updateMaterial(za,
mb=>{tb=fa.configureMaterial(mb,Pa,lb,Xa,this.view._stage.renderView.textureRepository,{rendererTextureUsage:this.rendererTextureUsage,usePBR:this._usePBR(),isIntegratedMesh:this._isIntegratedMesh,slicePlaneEnabled:this.slicePlaneEnabled,viewSpatialReference:this.view.spatialReference});this._updateMaterialOverlay(mb)});return{textures:lb,texturePromise:tb}};$a._getGeometryParameters=function(za){return{textureCoordinates:za.hasTexture?za.hasRegions?va.TextureCoordinateAttributeType.Atlas:va.TextureCoordinateAttributeType.Default:
va.TextureCoordinateAttributeType.None,colors:this._hasVertexColors,normals:za.hasNormals&&!this._isIntegratedMesh}};$a._addData=function(za,Pa,Xa){let Za=this._addTasks.get(za.index);Za?Za.attributeInfo=Pa:(Za={...z.createResolver(),attributeInfo:Pa,meta:null},this._addTasks.set(za.index,Za),Xa().then(Za.resolve,Za.reject).then(()=>this._addTasks.delete(za.index)).catch(eb=>{this._addTasks.delete(za.index);throw eb;}));return Za.promise};$a._clearAddTasks=function(){this._addTasks.forEach(za=>{d.isSome(za.meta)&&
(this._cacheGPUData(za.meta),za.meta=null)});this._addTasks.clear()};$a._clippingAreaChanged=function(){var za=this.view.renderSpatialReference;const Pa=this.i3slayer.spatialReference,Xa=K.create();this._renderClippingArea=ua.toBoundingRect(this.view.clippingArea,Xa,za)?Xa:null;za=K.create();this._layerClippingArea=ua.toBoundingRect(this.view.clippingArea,za,Pa)?za:null;this._filterChange();this._controller&&this._controller.updateClippingArea(this.view.clippingArea);this._isIntegratedMesh&&this._modificationsChanged()};
$a._geometryFilterChange=function(){this._controller.geometryFilterChanged(this.hasGeometryFilter)};$a._filterChange=function(){this._applyFilters(!1)};$a._applyFilters=function(za){this._filters=this.getFilters();za?this._controller&&this._controller.requestUpdate():this._nodeId2Meta.forEach(Pa=>{d.isSome(Pa)&&this._applyFiltersToNode(Pa)&&(this._addOrUpdateEdgeRendering(Pa),this._visibleGeometryChanged(Pa))})};$a.getFilters=function(){const za=[],Pa=this._renderClippingArea;d.isSome(Pa)&&za.push((Xa,
Za)=>this._boundingRectFilter(Xa,Za,Pa));return za};$a.addSqlFilter=function(za,Pa,Xa){if(d.isSome(Pa)){const Za=Pa.fieldNames;za.push((eb,lb)=>this._sqlFilter(eb,lb,Pa,Za,Xa))}};$a._sqlFilter=function(za,Pa,Xa,Za,eb){const lb={},tb=this._createLayerGraphic(lb),mb=this.i3slayer.objectIdField,Qa=Pa.featureIds,Ra=d.isSome(Pa.attributeInfo)&&Pa.attributeInfo.attributeData;Za.every(ab=>null!=Ra[ab]||ab===mb)&&ha.filterInPlace(za,Qa,ab=>{lb[mb]=Qa[ab];for(const jb of Za)jb!==mb&&(lb[jb]=ha.getCachedAttributeValue(Ra[jb],
ab));try{return Xa.testFeature(tb)}catch(jb){return eb(jb),!1}})};$a._boundingRectNodeTest=function(za,Pa){H.projectBoundingSphere(za.node.mbs,this._controller.crsIndex,hb,this.view.renderSpatialReference);return ha.intersectBoundingRectWithMbs(Pa,hb)};$a._boundingRectFeatureTest=function(za,Pa,Xa){this._collection.getComponentAabb(za.objectHandle,Pa,Na);M.toRect(Na,Ua);return K.intersects(Xa,Ua)};$a._boundingRectFilter=function(za,Pa,Xa){var Za=this._collection;const eb=this._boundingRectNodeTest(Pa,
Xa);if(eb!==ha.MbsIntersectResult.INSIDE)if(eb===ha.MbsIntersectResult.OUTSIDE)za.length=0;else if(Za=Za.getComponentCount(Pa.objectHandle),Za.invisible+Za.visible===Pa.featureIds.length){var lb=this._transformClippingArea(Ya,Xa,Pa.objectHandle);ha.filterInPlace(za,Pa.featureIds,tb=>this._boundingRectFeatureTest(Pa,tb,lb))}};$a._transformClippingArea=function(za,Pa,Xa){var Za=this._collection.getObjectTransform(Xa);Xa=Za.position;Za=Za.rotationScale;za[0]=(Pa[0]-Xa[0])/Za[0];za[1]=(Pa[1]-Xa[1])/Za[4];
za[2]=(Pa[2]-Xa[0])/Za[0];za[3]=(Pa[3]-Xa[1])/Za[4];return za};$a._addOrUpdateEdgeRendering=function(za,Pa=!0){const Xa=this._edgeView;if(d.isNone(Xa))return Promise.resolve(null);const Za=za.objectHandle;var eb=Xa.hasObject(Za);const {hasEdges:lb,perFeatureEdgeMaterials:tb}=this._getFilteredEdgeMaterials(za),mb={slicePlaneEnabled:this.slicePlaneEnabled};if(lb&&eb)return this.nodeCrossfadingEnabled&&(eb=this.getNodeOpacity(za),cb(tb,eb)),Xa.updateAllComponentMaterials(Za,tb,mb,Pa),Xa.updateObjectVisibility(Za,
!0),Promise.resolve(Xa);if(lb&&!eb)return this._collection.addEdges(Za,Xa,tb,mb).then(Qa=>{za.edgeMemoryUsage=Qa;za.node.memory+=Qa;return Xa});!lb&&eb&&(za.node.memory-=za.edgeMemoryUsage,za.edgeMemoryUsage=0,Xa.removeObject(Za));return Promise.resolve(null)};$a._applyFiltersToNode=function(za){return this._applyFiltersToNodeComponents(za)?(d.isSome(this._labeler)&&this._labeler.applyFilterChange(za),!0):!1};$a._applyFiltersToNodeComponents=function(za){const Pa=this._collection;var Xa=0===Pa.getComponentCount(za.objectHandle).invisible;
Pa.setAllComponentVisibilities(za.objectHandle,"all");if(0===this._filters.length)return za.filteredIds=null,!Xa;this._updateCachedFilteredIds(za);if(za.filteredIds===za.featureIds)return!Xa;Xa=this._computeFilteredComponentIndices(za);Pa.setAllComponentVisibilities(za.objectHandle,Xa);return!0};$a._updateCachedFilteredIds=function(za){if(null==za.filteredIds||za.appliedFilters!==this._filters)za.filteredIds=this._computeFilteredIds(za),za.appliedFilters=this._filters};$a._computeFilteredIds=function(za){const Pa=
za.featureIds.slice();for(const Xa of this._filters)if(Xa(Pa,za),0===Pa.length)break;return Pa.length===za.featureIds.length?za.featureIds:Pa};$a._computeFilteredComponentIndices=function(za){const Pa=[];za.featureIds.forEach((Xa,Za)=>{za.filteredIds[Pa.length]===Xa&&Pa.push(Za)});return Pa};$a._removeAllNodeDataFromStage=function(za=this.elevationOffset){this._nodeId2Meta.forEach((Pa,Xa)=>this._removeNodeStageData(Xa,za));this._nodeId2MetaReloading.forEach((Pa,Xa)=>this._removeNodeStageData(Xa,za,
this._nodeId2MetaReloading))};$a.removeNode=function(za){const Pa=this.elevationOffset;this._removeNodeStageData(za,Pa);this._removeNodeStageData(za,Pa,this._nodeId2MetaReloading)};$a._removeNodeStageData=function(za,Pa,Xa=this._nodeId2Meta){const Za=Xa.get(za);d.isNone(Za)?Xa.delete(za):(this._collection.setObjectVisibility(Za.objectHandle,ma.State.Hidden),d.isSome(this._edgeView)&&this._edgeView.hasObject(Za.objectHandle)&&this._edgeView.updateObjectVisibility(Za.objectHandle,!1),this._visibleGeometryChanged(Za),
d.isSome(this._labeler)&&this._labeler.removeNodeMeta(Za),Xa.delete(za),this._highlights.objectDeleted(Za),Xa===this._nodeId2Meta?(this._cacheGPUData(Za,Pa),this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopNodeFading(Za)):this._deleteComponentObject(Za),d.isSome(this._treeDebugger)&&this._treeDebugger.update())};$a._deleteComponentObject=function(za){d.isSome(this._edgeView)&&this._edgeView.removeObject(za.objectHandle);this._memEstimateGeometryRemoved(za.objectHandle);this._collection.destroyObject(za.objectHandle);
if(za.textures)for(const Pa of za.textures)this._memEstimateTextureRemoved(Pa),this._stage.remove(Pa)};$a.updateNodeState=function(za,Pa){za=this._nodeId2Meta.get(za);d.isSome(za)&&this._collection.updateMaterial(za.objectHandle,Xa=>Xa.polygonOffsetEnabled=Pa===ba.NodeState.Hole)};$a._invalidateAllSymbols=function(){this._rendererVersion=ha.addWraparound(this._rendererVersion,1);this._controller&&this._controller.requestUpdate()};$a._getInvalidRendererVersion=function(){return ha.addWraparound(this._rendererVersion,
-1)};$a._rendererChange=function(){var za=c._asyncToGenerator(function*(Pa){this._currentRenderer=Pa;this.notifyChange("rendererTextureUsage");this._rendererVersion=ha.addWraparound(this._rendererVersion,1);this._opacityVariable=this._colorVariable=this._rendererFields=null;this._invalidateAllSymbols();Pa&&(this._rendererFields=yield Pa.getRequiredFields(this.i3slayer.fieldsIndex));this._updateSymbologyFields();!this._arcade&&Pa&&"arcadeRequired"in Pa&&Pa.arcadeRequired&&(this._arcade=yield N.loadArcade());
if(Pa&&"visualVariables"in Pa&&Pa.visualVariables)for(const Xa of Pa.visualVariables)"color"===Xa.type?this._colorVariable=Xa:"opacity"===Xa.type?this._opacityVariable=Xa:Ca.warn(`Unsupported visual variable type for 3D Object Scene Services: ${Xa.type}`);if(Pa)for(const Xa of Pa.getSymbols())"mesh-3d"!==Xa.type&&Ca.error(`Symbols of type '${Xa.type}' are not supported for 3D Object Scene Services.`);this._controller&&this._controller.requestUpdate()});return function(Pa){return za.apply(this,arguments)}}();
$a._getCachedEdgeMaterials=function(za){this._hasSymbolColors&&za.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(za);return za.cachedEdgeMaterials};$a._getSymbolColors=function(za){this._hasSymbolColors&&za.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(za);const Pa=za.cachedSymbology;return(Xa,Za)=>{Xa*=5;L.set(Za.externalColor,Pa[Xa+0]/255,Pa[Xa+1]/255,Pa[Xa+2]/255,Pa[Xa+3]/255);Za.externalColorMixMode=Pa[Xa+4]&(1<<wa.CastShadows)-1;
Za.castShadows=0!==(Pa[Xa+4]&1<<wa.CastShadows);Za.pickable=0!==(Pa[Xa+4]&1<<wa.Pickable)}};$a._getSymbolInfo=function(za,Pa){Pa=za&&za.getSymbol(Pa,{arcade:this._arcade});if(!(Pa instanceof R))return null;za=Pa.id;if(this._symbolInfos.has(za))return this._symbolInfos.get(za);Pa=ha.getSymbolInfo(Pa);this._symbolInfos.set(za,Pa);return Pa};$a._setSymbologyOverride=function(za,Pa){this._symbologyOverride!==za&&(this._symbologyOverride=za,this._symbologyOverrideFields=Pa,this._invalidateAllSymbols(),
this._updateSymbologyFields())};$a._updateSymbologyFields=function(){this._symbologyFields=d.isSome(this._symbologyOverrideFields)&&0<this._symbologyOverrideFields.length?d.isSome(this._rendererFields)&&0<this._rendererFields.length?O.fixFields(this.i3slayer.fieldsIndex,[...this._rendererFields,...this._symbologyOverrideFields]):this._symbologyOverrideFields:this._rendererFields};$a._updateCachedRendererData=function(za){za.cachedRendererVersion=this._rendererVersion;if(this._hasSymbolColors){var Pa=
this._tmpAttributeOnlyGraphic,Xa={};Pa.attributes=Xa;var Za=this._currentRenderer,eb=d.isSome(za.attributeInfo)&&za.attributeInfo.attributeData,lb=null!=za.featureIds?this.i3slayer.objectIdField:null,tb=null!=eb&&d.isSome(this._symbologyFields)&&0<this._symbologyFields.length,mb=tb?[]:null,Qa=tb?[]:null;if(tb&&d.isSome(this._symbologyFields))for(var Ra of this._symbologyFields){var ab=eb[Ra];ab&&(mb.push(Ra),Qa.push(ab))}za.cachedSymbology||(za.cachedSymbology=new Uint8Array(5*za.featureIds.length));
eb={color:La,castShadows:!0,pickable:!0,colorMixMode:xa.ColorMixModeEnum.Multiply,edgeMaterial:null};Ra=this.fullOpacity;Ra=this.nodeCrossfadingEnabled?this.getNodeOpacity(za):Ra;ab=null;var jb=Ja.Transparency.OPAQUE,pb=ha.transparentEdgeMaterial,ub=0;for(let Ob=0;Ob<za.featureIds.length;Ob++){null!=lb&&(Xa[lb]=za.featureIds[Ob]);if(tb)for(var rb=0;rb<mb.length;rb++)Xa[mb[rb]]=ha.getCachedAttributeValue(Qa[rb],Ob);var Ab=this._getSymbolInfo(Za,Pa);let Ub=rb=null;if(Za&&"visualVariables"in Za){if(this._colorVariable){var Kb=
P.getColor(this._colorVariable,Pa,{color:Va,arcade:this._arcade});Kb&&(rb=La,rb[0]=Kb.r/255,rb[1]=Kb.g/255,rb[2]=Kb.b/255,this._opacityVariable||null===Kb.a||(Ub=Kb.a))}this._opacityVariable&&(Ub=P.getOpacity(this._opacityVariable,Pa,{arcade:this._arcade}))}Ab&&Ab.material&&(Kb=Ab.material,rb=d.isNone(rb)||d.isNone(Ub)?aa.overrideColor(rb,Ub,Kb.color,Kb.alpha,Ka,La):aa.overrideColor(rb,Ub,null,null,Ka,La));d.isNone(rb)&&(rb=La,rb[0]=1,rb[1]=1,rb[2]=1,rb[3]=1);eb.pickable=!0;eb.castShadows=Ab?Ab.castShadows:
!0;eb.colorMixMode=Ab&&Ab.material?Ab.material.colorMixMode:xa.ColorMixModeEnum.Multiply;eb.edgeMaterial=Ab?Ab.edgeMaterial:null;d.isSome(this._symbologyOverride)&&(eb.color=rb,this._symbologyOverride(Pa,eb),rb=eb.color);if(d.isSome(eb.edgeMaterial)){Ab=0>=rb[3]?Ja.Transparency.INVISIBLE:1<=rb[3]&&(za.material.isOpaque||eb.colorMixMode===xa.ColorMixModeEnum.Replace)?Ja.Transparency.OPAQUE:Ja.Transparency.TRANSPARENT;if(eb.edgeMaterial!==ab||Ab!==jb)pb={...eb.edgeMaterial,opacity:Ra,objectTransparency:Ab},
ab=eb.edgeMaterial,jb=Ab;za.cachedEdgeMaterials[Ob]=pb}else za.cachedEdgeMaterials[Ob]=ha.transparentEdgeMaterial;za.cachedSymbology[ub+0]=Math.round(255*rb[0]);za.cachedSymbology[ub+1]=Math.round(255*rb[1]);za.cachedSymbology[ub+2]=Math.round(255*rb[2]);za.cachedSymbology[ub+3]=Math.round(255*rb[3]);za.cachedSymbology[ub+4]=eb.colorMixMode|+eb.castShadows<<wa.CastShadows|+eb.pickable<<wa.Pickable;ub+=5}}};$a._getFilteredEdgeMaterials=function(za){var Pa=this._getCachedEdgeMaterials(za);this.nodeCrossfadingEnabled||
cb(Pa,this.fullOpacity);if(d.isNone(za.filteredIds))return{hasEdges:Pa.some(eb=>eb!==ha.transparentEdgeMaterial),perFeatureEdgeMaterials:Pa};let Xa=0,Za=!1;Pa=Pa.map((eb,lb)=>{if(za.featureIds[lb]!==za.filteredIds[Xa])return ha.transparentEdgeMaterial;Za=Za||eb!==ha.transparentEdgeMaterial;Xa++;return eb});return{hasEdges:Za,perFeatureEdgeMaterials:Pa}};$a._setObjectSymbolColors=function(za){if(this._hasSymbolColors){var Pa=za.objectHandle;za=this._getSymbolColors(za);this._collection.setComponentData(Pa,
za);this._stage.renderView.requestRender()}};$a._reloadAll=function(za=this.elevationOffset){this._removeAllNodeDataFromStage(za);null!=this._controller&&this._controller.restartNodeLoading()};$a._opacityChange=function(za){this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopAllNodeFading();this._nodeId2Meta.forEach(Pa=>{d.isNone(Pa)||(this._collection.updateMaterial(Pa.objectHandle,Xa=>Xa.objectOpacity=za),cb(Pa.cachedEdgeMaterials,za),this._updateEdgeRendering(Pa))})};$a._updateMaterial=function(za){this._collection.updateMaterial(za.objectHandle,
Pa=>{Pa.commonMaterialParameters.slicePlaneEnabled=this.slicePlaneEnabled;Pa.usePBR=this._usePBR();this._updateMaterialOverlay(Pa)})};$a._updateMaterialOverlay=function(za){};$a._updateEngineObject=function(za){this._setObjectSymbolColors(za);this._applyFiltersToNode(za);this._addOrUpdateEdgeRendering(za);this._visibleGeometryChanged(za)};$a._slicePlaneEnabledChange=function(za){this._intersectionHandler&&(this._intersectionHandler.slicePlaneEnabled=za);d.isSome(this._labeler)&&(this._labeler.slicePlaneEnabled=
za);this._nodeId2Meta.forEach(Pa=>{d.isNone(Pa)||(this._collection.updateMaterial(Pa.objectHandle,Xa=>{Xa.commonMaterialParameters.slicePlaneEnabled=za}),this._updateEdgeRendering(Pa,!1))})};$a._updatePBR=function(){this._nodeId2Meta.forEach(za=>{d.isNone(za)||this._collection.updateMaterial(za.objectHandle,Pa=>{Pa.usePBR=this._usePBR()})});this._hasLoadedPBRTextures=!0};$a._usePBR=function(){return!this._isIntegratedMesh&&this.view.qualitySettings.physicallyBasedRenderingEnabled};$a._updateEdgeRendering=
function(za,Pa=!0){d.isSome(this._edgeView)&&this._edgeView.hasObject(za.objectHandle)&&this._addOrUpdateEdgeRendering(za,Pa)};$a._forAllNodes=function(za){this._nodeId2Meta.forEach(za)};$a._forAllFeatures=function(za,Pa,Xa=W.ForAllFeaturesVisibilityMode.VISIBLE_ONLY){e.someMap(this._nodeId2Meta,Za=>{if(d.isNone(Za))return!1;if(d.isSome(Pa))switch(Pa(Za)){case W.ForAllFeaturesReturnType.EXIT:return!0;case W.ForAllFeaturesReturnType.SKIP:return!1}let eb=W.ForAllFeaturesReturnType.CONTINUE;switch(Xa){case W.ForAllFeaturesVisibilityMode.ALL:eb=
this._forAllFeaturesOfNode(Za,za);break;case W.ForAllFeaturesVisibilityMode.VISIBLE_ONLY:eb=this._forVisibleFeaturesOfNode(Za,za);break;case W.ForAllFeaturesVisibilityMode.ALL_IN_CLIPPING_AREA:eb=this._forAllFeaturesOfNodeInClippingArea(Za,za)}return eb===W.ForAllFeaturesReturnType.EXIT})};$a._forAllFeaturesOfNode=function(za,Pa){let Xa=W.ForAllFeaturesReturnType.CONTINUE;const Za=za.featureIds;for(let eb=0;eb<Za.length&&(Xa=Pa(Za[eb],eb,za),Xa!==W.ForAllFeaturesReturnType.EXIT);eb++);return Xa};
$a._forVisibleFeaturesOfNode=function(za,Pa){let Xa=W.ForAllFeaturesReturnType.CONTINUE;const Za=za.featureIds;this._collection.forEachVisibleComponent(za.objectHandle,eb=>{Xa=Pa(Za[eb],eb,za);return Xa===W.ForAllFeaturesReturnType.CONTINUE});return Xa};$a._forAllFeaturesOfNodeInClippingArea=function(za,Pa){if(d.isNone(this._renderClippingArea))return this._forAllFeaturesOfNode(za,Pa);var Xa=this._boundingRectNodeTest(za,this._renderClippingArea);if(Xa===ha.MbsIntersectResult.OUTSIDE)return W.ForAllFeaturesReturnType.CONTINUE;
if(Xa===ha.MbsIntersectResult.INSIDE)return this._forAllFeaturesOfNode(za,Pa);Xa=W.ForAllFeaturesReturnType.CONTINUE;const Za=za.featureIds,eb=ha.getClipRect(this._renderClippingArea,this._collection.getObjectTransform(za.objectHandle));for(let lb=0;lb<Za.length;lb++){if(!this._boundingRectFeatureTest(za,lb,eb))continue;const tb=Pa(Za[lb],lb,za);if(tb===W.ForAllFeaturesReturnType.EXIT)return tb}return Xa};$a._createAttributes=function(za,Pa){const Xa={};null!=Pa.featureIds&&(Xa[this._getObjectIdField()]=
Pa.featureIds[za]);Pa=d.isSome(Pa.attributeInfo)&&Pa.attributeInfo.attributeData;if(d.isSome(Pa))for(const Za of Object.keys(Pa))Xa[Za]=ha.getCachedAttributeValue(Pa[Za],za);return Xa};$a._createGraphic=function(za,Pa){return this._createLayerGraphic(this._createAttributes(za,Pa))};$a.highlight=function(za){const Pa=this._highlights;"number"===typeof za?za=[za]:za instanceof w?za=[za]:za instanceof f&&(za=za.toArray());if(Array.isArray(za)&&0<za.length){if(za[0]instanceof w){const Xa=this.i3slayer.fieldsIndex,
Za=this._getObjectIdField();za=za.map(tb=>pa.attributeLookup(Xa,tb.attributes,Za));const {set:eb,handle:lb}=Pa.acquireSet();Pa.setFeatureIds(eb,za);return lb}if("number"===typeof za[0]){const {set:Xa,handle:Za}=Pa.acquireSet();Pa.setFeatureIds(Xa,za);return Za}}return kb};$a._visibleGeometryChanged=function(za){this._elevationProvider&&(this._elevationProvider.objectChanged(za.node),null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=q.schedule(()=>{this.emit("visible-geometry-changed");
this._visibleGeometryChangedSchedulerHandle=null})))};$a.getNodeOpacityByIndex=function(za){za=this._nodeId2Meta.get(za);return this.getNodeOpacity(za)};$a.getNodeOpacity=function(za){return d.isSome(za)?this._collection.getMaterial(za.objectHandle).objectOpacity:0};$a.isNodeFullyFadedIn=function(za){return this._crossfadeHelper.isNodeFullyFadedIn(za)};$a.getNodeCrossfadeMetaData=function(za){return this._nodeId2Meta.get(za)};$a.markNodeToRemove=function(za){this._controller&&this._controller.markNodeToRemove(za)};
$a.removeMarkedNodes=function(){this._controller&&this._controller.removeMarkedNodes()};$a.foreachCrossfadeNode=function(za){this._nodeId2Meta.forEach((Pa,Xa)=>za(Xa,Pa))};$a.fadeNode=function(za,Pa,Xa){if(this.nodeCrossfadingEnabled){var Za=this._nodeId2Meta.get(za);d.isSome(Za)&&this._crossfadeHelper.fadeNode(za,Za,Pa,Xa)}};$a.setNodeOpacityByIndex=function(za,Pa){za=this._nodeId2Meta.get(za);d.isSome(za)&&this._setNodeOpacity(za,Pa)};$a._setNodeOpacity=function(za,Pa){this._collection.updateMaterial(za.objectHandle,
Xa=>Xa.objectOpacity=Pa);this._setNodeEdgeOpacity(za,Pa)};$a._setNodeEdgeOpacity=function(za,Pa){d.isSome(this._edgeView)&&za.cachedEdgeMaterials&&(cb(za.cachedEdgeMaterials,Pa),za=za.objectHandle,this._edgeView.hasObject(za)&&this._edgeView.updateAllComponentOpacities(za,Pa))};$a.updateNodeModificationStatus=function(za){var Pa=za.length;if(this.hasModifications&&!(0>=Pa)&&!0===this._i3sWasmLoaded){Pa=this.i3slayer.uid;var Xa=ka(za);if(d.isSome(Xa)){U.filterObbsForModificationsSync({context:Pa,buffer:Xa.buffer});
const Za=new Float64Array(Xa.buffer);za.forAll((eb,lb)=>{lb=U.interpretObbModificationResults(Za[lb]);eb.imModificationImpact=lb;lb!==ba.NodeIMModificationImpact.Unmodified&&this._controller.invalidateGeometryVisibility(eb.index)})}}};$a.notifyUpdate=function(){this.notifyChange("updating")};$a.notifyLODUpdate=function(){this._controller.notifyLODUpdate()};$a.isUpdating=function(){return!(!this._controller||!this._controller.updating)||!!this._visibleGeometryChangedSchedulerHandle||d.isSome(this._labeler)&&
this._labeler.updating||this._crossfadeHelper.updating||this._i3sWasmLoaded instanceof Promise||0<this._asyncModuleLoading};c._createClass(sb,[{key:"lodCrossfadeoutDuration",get:function(){return 0}},{key:"lodCrossfadeinDuration",get:function(){return 0}},{key:"lodCrossfadeUncoveredDuration",get:function(){return 0}},{key:"layerUid",get:function(){return this.i3slayer&&this.i3slayer.uid}},{key:"sublayerUid",get:function(){return null}},{key:"hasTexturesOrVertexColors",get:function(){return this._hasData?
this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"}},{key:"rendererTextureUsage",get:function(){return ha.rendererNeedsTextures(this._currentRenderer)?this._usePBR()||this._hasLoadedPBRTextures?da.TextureUsage.AllTexturesPBR:da.TextureUsage.AllTextures:this._usePBR()||this._hasLoadedPBRTextures?da.TextureUsage.GeometryTexturesPBR:da.TextureUsage.GeometryTextures}},{key:"elevationOffset",get:function(){const za=null!=this.i3slayer?this.i3slayer.elevationInfo:null;if(null!=za&&"absolute-height"===
za.mode){const Pa=r.getMetersPerVerticalUnitForSR(this.i3slayer.spatialReference),Xa=S.getMetersPerUnit(za.unit);return d.unwrapOr(za.offset,0)*Xa/Pa}return 0}},{key:"supportedTextureEncodings",get:function(){return fa.getSupportedEncodings(this.view._stage.renderView.capabilities)}},{key:"uncompressedTextureDownsamplingEnabled",get:function(){var za;const Pa=null==(za=this.view)?void 0:za.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled;za=0===(this.supportedTextureEncodings&da.TextureEncoding.DDS_S3TC);
return Pa&&za}},{key:"_idbCacheEnabled",get:function(){return!this._controller.disableIDBCache&&!this.hasModifications&&0===this.elevationOffset&&null!=this._cacheKeySuffix}},{key:"supportsNodeCrossFading",get:function(){var za,Pa;return!(null!=(za=this.view)&&null!=(Pa=za._stage)&&Pa.renderView.hasShadowsEnabled)}},{key:"nodeCrossfadingEnabled",get:function(){return this.supportsNodeCrossFading&&(0<this.lodCrossfadeinDuration||0<this.lodCrossfadeoutDuration||0<this.lodCrossfadeUncoveredDuration)}},
{key:"nodeFadeoutEnabled",get:function(){return this.supportsNodeCrossFading&&0<this.lodCrossfadeoutDuration}},{key:"hasGeometryFilter",get:function(){return!1}},{key:"performanceInfo",get:function(){const za={displayedNumberOfFeatures:0,maximumNumberOfFeatures:0,totalNumberOfFeatures:0,core:null,index:0,nodes:this._nodeId2Meta.size,"Total GPU Memory Estimate":(this.gpuMemoryEstimate/1048576).toFixed(1)+"MB","Geometry Memory Estimate":(this.geoMemoryEstimate/1048576).toFixed(1)+"MB","Texture Memory Estimate":(this.texMemoryEstimate/
1048576).toFixed(1)+"MB","Unloaded Memory Estimate":(this.getUnloadedMemory()/1048576).toFixed(1)+"MB"};d.isSome(this._memCache)&&(za.MemCache=Math.round(100*this._memCache.hitRate)+"% hit");this._controller&&(this._idbCacheEnabled&&(za.IDBCache=Math.round(100*this._idbCache.getHitRate())+"% hit"),this._controller.updateStats(za));return za}},{key:"test",get:function(){const za=this;return{controller:this._controller,labeler:this._labeler,get visibleObjectIds(){const Pa=[];za._forAllFeatures(Xa=>
{Pa.push(Xa);return W.ForAllFeaturesReturnType.CONTINUE},null,W.ForAllFeaturesVisibilityMode.VISIBLE_ONLY);Pa.sort((Xa,Za)=>Xa-Za);return Pa},get numNodes(){return za._nodeId2Meta.size}}}},{key:"hasModifications",get:function(){return this._isIntegratedMesh&&d.isSome(this._layerClippingArea)||this._modifications&&0<this._modifications.length}}]);return sb}(ib);g.__decorate([u.property()],ib.prototype,"_hasLoadedPBRTextures",void 0);g.__decorate([u.property()],ib.prototype,"_asyncModuleLoading",void 0);
g.__decorate([u.property()],ib.prototype,"_visibleGeometryChangedSchedulerHandle",void 0);g.__decorate([u.property()],ib.prototype,"view",void 0);g.__decorate([u.property()],ib.prototype,"i3slayer",void 0);g.__decorate([u.property()],ib.prototype,"_controller",void 0);g.__decorate([u.property()],ib.prototype,"_labeler",void 0);g.__decorate([u.property()],ib.prototype,"updating",void 0);g.__decorate([u.property()],ib.prototype,"suspended",void 0);g.__decorate([u.property()],ib.prototype,"holeFilling",
void 0);g.__decorate([u.property(qa.updatingProgress)],ib.prototype,"updatingProgress",void 0);g.__decorate([u.property({readOnly:!0,aliasOf:"_controller.updatingProgress"})],ib.prototype,"updatingProgressValue",void 0);g.__decorate([u.property({readOnly:!0})],ib.prototype,"hasTexturesOrVertexColors",null);g.__decorate([u.property({readOnly:!0})],ib.prototype,"rendererTextureUsage",null);g.__decorate([u.property()],ib.prototype,"filter",void 0);g.__decorate([u.property({readOnly:!0})],ib.prototype,
"elevationOffset",null);g.__decorate([u.property({type:Boolean})],ib.prototype,"slicePlaneEnabled",void 0);g.__decorate([u.property()],ib.prototype,"supportedTextureEncodings",null);g.__decorate([u.property()],ib.prototype,"uncompressedTextureDownsamplingEnabled",null);g.__decorate([u.property({type:[J]})],ib.prototype,"_modifications",void 0);return ib=g.__decorate([A.subclass("esri.views.3d.layers.I3SMeshView3D")],ib)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/layers/graphics/controllers/I3SOnDemandController":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/has ../../../core/Logger ../../../core/maybe ../../../core/PooledArray ../../../core/Promise ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../dehydratedFeatures ../../support/PromiseQueue ../../../views/3d/layers/i3s/I3SFrameTask ../../../views/3d/layers/i3s/I3SIndex ../../../views/3d/layers/i3s/I3SLodHandling ../../../views/3d/layers/i3s/I3SNode ../../../views/3d/layers/i3s/I3SNodeLoader ../../../views/3d/layers/i3s/I3SStreamDataController ../../../views/3d/layers/i3s/I3SUtil ../../../views/3d/layers/i3s/I3SViewportQueries ../../../views/3d/layers/support/I3SLayerView ../../../views/3d/support/extentUtils ../../../views/3d/support/index ../../../views/support/layerViewUtils ../../../views/support/Scheduler".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H,M){function K(S,T){return n.isSome(S)&&S.length===T.length&&S.every(V=>0<=I(T,V.name))}function I(S,T){T=T.toLowerCase();for(let V=0;V<S.length;V++)if(S[V].name.toLowerCase()===T)return V;return-1}const O=w.getLogger("esri.layers.graphics.controllers.I3SOnDemandController");c=function(S){function T(W){W=S.call(this,W)||this;W.screenSizeFactor=0;W.featureTarget=5E4;W.fixedFeatureTarget=!1;W.updating=!0;W.updatingProgress=1;W.leavesReached=
!1;W.scaleVisibilityEnabled=!0;W._featureLOD=1;W._stableFeatureLOD=!1;W._isIdle=!1;W._cameraDirty=!0;W._invisibleDirty=!1;W._newLoadingNodes=new f({deallocator:null});W._loadedNodeScales=new Map;W._modificationsNodeFilteringArray=new f;W._downloadingCount=0;W._loadingNodes=new Map;W._updatingNodes=new Map;W._progressMaxNumNodes=1;W._requiredAttributes=[];W._requiredAttributesDirty=!0;W._updatesDisabled=!1;W.disableIDBCache=!1;W._disableMemCache=!1;W._restartNodeLoading=!1;W._fields=null;W._attributeStorageInfo=
null;W._handles=new g;W._idleQueue=new x.PromiseQueue;W._elevationUpdateNodes=new f({deallocator:null});W._errorCount=0;return W}a._inheritsLoose(T,S);var V=T.prototype;V.initialize=function(){this._disableMemCache=!this.layerView.loadCachedGPUData||!this.layerView.addCachedGPUData;this._lodHandling=new y(this.layerView);const W=this.layerView.i3slayer;this.layer=W;this._defaultGeometrySchema=W.store.defaultGeometrySchema;this.disableIDBCache=h("disable-feature:idb-cache");"fields"in W&&(this._fields=
W.fields,this._attributeStorageInfo=W.attributeStorageInfo);this.addResolvingPromise(Promise.all([this.layer.indexInfo,this.layer.when(),this.layerView.when()]).then(([U])=>{var aa;if(!this.destroyed&&this.layerView&&!this.layerView.destroyed){var da=this.layerView.view;this._setClippingArea(da.clippingArea);var Y=this.layerView.view.resourceController;this._handles.add([e.watch(()=>{var ea,ja;return null==da?void 0:null==(ea=da.pointsOfInterest)?void 0:null==(ja=ea.focus)?void 0:ja.renderLocation},
ea=>this._pointOfInterestChanged(ea),e.initial),Y.memoryController.events.on("quality-changed",()=>this._setCameraDirty()),e.watch(()=>{var ea;return null==(ea=this.layerView)?void 0:ea.suspended},ea=>{const ja=ea?()=>this._updateViewData():()=>this._updateIdleState(!0),la=ea?()=>{}:()=>this._updateIdleState(!1);this._idleStateCallbacks?(ea&&this.cancelNodeLoading(),this.restartNodeLoading(),this._idleStateCallbacks.idleBegin=ja,this._idleStateCallbacks.idleEnd=la):this._idleStateCallbacks=Y.scheduler.registerIdleStateCallbacks(ja,
la)},e.initial),u.addTask(this.layerView.view.resourceController.scheduler,{update:(ea,ja)=>this._frame(ea,ja),needsUpdate:()=>this.updating}),this.watch("uncompressedTextureDownsamplingEnabled",()=>this.restartNodeLoading()),this.watch(["featureTarget","fixedFeatureTarget"],()=>{this._setCameraDirty();this._stableFeatureLOD=!1}),da.state.watch("contentCamera",()=>this._setCameraDirty()),this.layer.watch("elevationInfo",()=>this._elevationInfoChanged()),this.layer.watch("effectiveScaleRange",()=>
this._scaleBoundsChanged()),this.layerView.watch("lodFactor",()=>this._setCameraDirty()),this.layerView.watch("availableFields?",()=>this._requiredFieldsChange()),this.layerView.watch("holeFilling",ea=>n.isSome(this._index)&&(this._index.holeFilling=ea))]);this._updateScaleHandles();this._viewportQueries=new C(this.crsIndex,da.renderCoordsHelper,da.state.contentCamera,!da.state.fixedContentCamera||this.isGraphics3D,this._clippingArea,da.elevationProvider,this.layer.elevationInfo,{progressiveLoadFactor:this._getProgressiveLoadFactor(),
screenspaceErrorBias:this.lod,angleDependentLoD:.5>this.lod});this._index=new E.I3SIndex(W,U,this.indexStreamController,this._viewportQueries,O,this.layerView.holeFilling,ea=>this.layerView.isNodeLoaded(ea),ea=>this.layerView.isNodeReloading(ea),ea=>this._shouldLoadNode(ea),ea=>this._enableFromGPUCache(ea,A.NodeState.Leaf),ea=>this._needsUpdate(ea),()=>!this.indexStreamController.busy,ea=>this.layerView.computeVisibilityObb?this.layerView.computeVisibilityObb(ea):null,null!=(aa=this.layerView)&&aa.computeNodeFiltering?
ea=>this.layerView.computeNodeFiltering(ea):void 0);this._index.imModificationsChanged(!!this.layerView.hasModifications);this._startNodeLoading()}}));this._tmpPoint=r.makeDehydratedPoint(0,0,0,this.crsIndex)};V.updateNodeModificationStatus=function(W){const U=this._index,aa=this.layerView;n.isSome(U)&&aa&&aa.updateNodeModificationStatus&&(this._modificationsNodeFilteringArray.clear(),W.forAll(da=>{da=U.getNode(da);n.isSome(da)&&this._modificationsNodeFilteringArray.push(da)}),aa.updateNodeModificationStatus(this._modificationsNodeFilteringArray),
this._invisibleDirty=!0)};V.destroy=function(){this.cancelNodeLoading();this._idleStateCallbacks&&(this._isIdle=!1,this._idleStateCallbacks.remove(),this._idleStateCallbacks=null);this._handles.destroy();this._nodeLoader=null;Q.prune();n.isSome(J)&&(J.hide(),J=null)};V._getRequiredAttributes=function(){if(null==this._attributeStorageInfo||!this._fields||!this.layerView.availableFields)return[];const W=this._attributeStorageInfo,U=this._fields,aa=this.layer.objectIdField;return this.layerView.availableFields.map(da=>
{const Y=I(W,da);da=I(U,da);return 0<=Y&&0<=da?{index:Y,name:U[da].name,field:U[da],attributeStorageInfo:W[Y]}:null}).filter(da=>null!=da&&da.name!==aa)};V._requiredFieldsChange=function(){const W=this._getRequiredAttributes();K(this._requiredAttributes,W)||(this._requiredAttributes=W,this._requiredAttributesDirty=!1,this.restartNodeLoading())};V.requestUpdate=function(){this._requiredAttributesDirty=!0;this.restartNodeLoading()};V._setClippingArea=function(W){const U=t.create();G.toBoundingRect(W,
U,this.layerView.view.renderSpatialReference)?this._clippingArea=U:this._clippingArea=null};V._pointOfInterestChanged=function(W){n.isSome(this._viewportQueries)&&(this._viewportQueries.setPointOfInterest(W),n.isSome(this._index)&&(this._index.progressiveLoadPenalty=P.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestUpdate()))};V.updateClippingArea=function(W){this._setClippingArea(W);n.isSome(this._viewportQueries)&&n.isSome(this._index)&&(this._viewportQueries.updateClippingArea(this._clippingArea),
this._index.invalidateVisibilityCache());this._setCameraDirty()};V._setCameraDirty=function(){this._cameraDirty=!0;this.notifyChange("rootNodeVisible");this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()};V.updateElevationChanged=function(W,U){const aa=this._index;if(!n.isNone(aa)){var da=aa.rootNode;if(!n.isNone(da)){var Y=this._elevationUpdateNodes;Y.clear();D.findIntersectingNodes(W,U,da,this.crsIndex,aa,ea=>Y.push(ea.index));Y.forAll(ea=>{aa.invalidateBoundingVolumeCache(ea);ea===da.index&&
this.notifyChange("rootNodeVisible")});Y.length&&this.restartNodeLoading()}}};V.getParentIndex=function(W){return n.isSome(this._index)&&this._index.getParentIndex(W)};V._elevationInfoChanged=function(){n.isSome(this._index)&&this._index.updateElevationInfo(this.layer.elevationInfo);this._setCameraDirty()};V._updateScaleHandles=function(){this._handles.remove("scale-bounds");this.areScaleBoundsActive&&this._handles.add(this.layerView.view.basemapTerrain.on("scale-change",W=>this._scaleUpdateHandler(W)),
"scale-bounds")};V._scaleBoundsChanged=function(){this.areScaleBoundsActive||this._loadedNodeScales.clear();this._updateScaleHandles();this._setCameraDirty()};V._scaleUpdateHandler=function(W){this._updateScaleInBoundingRect(W.extent,W.spatialReference);this._setCameraDirty()};V._updateScaleInBoundingRect=function(W,U){const aa=this._index;n.isNone(aa)||!n.isNone(aa.rootNode)&&q.projectBoundingRect(W,U,N,this.crsIndex)&&this._loadedNodeScales.forEach((da,Y)=>{da=aa.getNode(Y);n.isSome(da)&&t.intersectsSphere(N,
da.mbs)&&this._loadedNodeScales.set(Y,this._computeScale(da))})};V.restartNodeLoading=function(){this._restartNodeLoading=!0;this.cancelNodeLoading();this._evaluateUpdating()};V.schedule=function(W,U){return this._idleQueue.push(W,U)};V.reschedule=function(W,U){return this._idleQueue.unshift(W,U)};V._frame=function(W,U){if(this.layerView.suspended)return this._updateViewData(),this._evaluateUpdating(),-Infinity;if(!this.layerView.visible||n.isNone(this._index))return-Infinity;this._processLogError(W,
U);return this._index.getPriority()};V._processLogError=function(W,U){try{this._process(W,U)}catch(aa){50>this._errorCount?O.error("Error during processing: "+aa):50===this._errorCount&&O.error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}};V._process=function(W,U){this._restartNodeLoading&&this._startNodeLoading();null==this._nodeLoader||n.isNone(this._index)||(this._updateViewData(),this._invisibleDirty&&this._removeInvisibleNodes(W)&&(this._invisibleDirty=
!1),this.isIntegratedMesh&&(W.enabled=!1),W.run(()=>this._processIndex(W)),this._updateFeatureLOD(),W.run(()=>this._processCache(W)),this.isIntegratedMesh&&(W.enabled=!0),W.run(()=>this._processNodes(W,U)),this._idleQueue.runTask(W),W.run(()=>this._prefetchIndex()),U.numIndexLoading+=this._index.getIndexLoading(),U.numNodesLoading+=this._downloadingCount,W.run(()=>this._lodHandling.lodGlobalHandling(W)),this._evaluateUpdating())};V._processIndex=function(W){if(n.isNone(this._index))return!1;this._index.dirty&&
(this._newLoadingNodes.clear(),this._index.update([...this._loadingNodes.keys()],W,U=>this.updateNodeModificationStatus(U)),this._disableMemCache||(this._newLoadingNodes.pushArray(this._index.updates.add.data,this._index.updates.add.length),this._newLoadingNodes.pushArray(this._index.updates.missing.data,this._index.updates.missing.length)),W=this._index.featureEstimate.leavesReached,this._index.isLoading()||W===this._get("leavesReached")||this._set("leavesReached",W));return this._index.load()};
V._prefetchIndex=function(){return n.isNone(this._index)||0<this._loadingNodes.size||0<this._index.updates.add.length?!1:this._index.prefetch()};V._updateFeatureLOD=function(){if(this.useMaximumNumberOfFeatures&&!n.isNone(this._index)&&!n.isNone(this._viewportQueries)){var W=!this._index.isLoading(),U=this.featureTarget*this.baseLOD,aa=this._index.featureEstimate;aa.estimate=aa.estimate||U/2;if(500<this._index.getIndexMissing()){if(1E-4>=this._featureLOD)return;this._featureLOD/=1.5;this._stableFeatureLOD=
!1}else if(W&&aa.estimate<U){if(aa.leavesReached||1E4<=this._featureLOD||this._stableFeatureLOD)return;this._featureLOD*=Math.min(10,Math.max(U/aa.estimate,1.001));W=this.lod;U=this._index.checkFeatureTarget(U,W);U!==W&&(this._featureLOD=U/this.baseLOD,this._stableFeatureLOD=!0)}else if(aa.estimate>1.2*U||W&&aa.estimate>U){if(1E-4>=this._featureLOD)return;this._featureLOD/=1+.25*(aa.estimate/U-1);this._stableFeatureLOD=!1}else return;this._featureLOD=Math.min(1E4,Math.max(1E-4,this._featureLOD));
this._viewportQueries.updateScreenSpaceErrorBias(this.lod);this._index.requestUpdate()}};V._processCache=function(W){const U=this._index;if(n.isNone(U))return!1;for(;0<this._newLoadingNodes.length&&!W.done;){var aa=this._newLoadingNodes.pop();for(aa=U.getParent(aa);n.isSome(aa)&&!this.layerView.isNodeLoaded(aa.index)&&this._isNodeInScaleBounds(aa);aa=U.getParent(aa.index))if(this._enableFromGPUCache(aa,A.NodeState.Hole)){W.madeProgress();break}}return W.hasProgressed};V._processNodes=function(W,U){if(n.isNone(this._index))return!1;
let aa=(this._isIdle?100:2)-this._loadingNodes.size;const da=this._index.updates;da.cancel.forEach(this._cancelNode,this);for(da.cancel=[];0<da.remove.length&&!W.done;)this.layerView.removeNode(da.remove.pop()),W.madeProgress();for(;0<da.update.length&&!W.done;){var Y=this._index.getNode(da.update.pop());n.isSome(Y)&&(this._updateLoadedNode(Y),W.madeProgress())}for(;0<da.add.length&&!W.done&&0<aa;){--aa;Y=this._index.getNode(da.add.back());if(n.isNone(Y)||Y.cacheState!==A.CacheState.Cached&&!this._hasNodeLoadToken(U))break;
da.add.pop();this._loadNode(Y);W.madeProgress()}return W.hasProgressed};V._cancelAllNodes=function(){this._loadingNodes.forEach(W=>W.abort());this._loadingNodes.clear();this._updatingNodes.forEach(W=>W.abort());this._updatingNodes.clear()};V._cancelNode=function(W){const U=this._loadingNodes.get(W);U&&(U.abort(),this._loadingNodes.delete(W))};V._hasNodeLoadToken=function(W){return!this._isIdle&&2<=W.numNodesLoading+this._loadingNodes.size?!1:this._downloadingCount<L.maxDownloadSlots&&!this.dataStreamController.busy};
V._evaluateUpdating=function(){var W=!1,U=0;this.layerView.suspended?U=(W=this._cameraDirty)?0:1:(W=n.isSome(this._index)?this._index.getIndexMissing():0,U=n.isSome(this._index)?this._index.updates.add.length:0,U=W+3*U+2*this._loadingNodes.size,W=!!(0<U||0<this._updatingNodes.size||this._restartNodeLoading||this._cameraDirty||this._idleQueue.running||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling),0===U&&(this._progressMaxNumNodes=1),this._progressMaxNumNodes=Math.max(U,this._progressMaxNumNodes),
U=1-U/this._progressMaxNumNodes);this.updating=W;this.updatingProgress=U};V._updateViewData=function(){if(this._cameraDirty&&!n.isNone(this._index)&&!n.isNone(this._viewportQueries)){var W=this.layerView.view,{contentCamera:U,fixedContentCamera:aa}=W.state;this.screenSizeFactor=1/(U.perScreenPixelRatio/2);this._viewportQueries.updateCamera(U,!aa||this.isGraphics3D);this._viewportQueries.setPointOfInterest(W.pointsOfInterest.focus.renderLocation);this._viewportQueries.updateScreenSpaceErrorBias(this.lod);
this._index.invalidateVisibilityCache();this._index.progressiveLoadPenalty=P.distancePenalty*this._viewportQueries.distCameraToPOI();this._index.requestUpdate();this._stableFeatureLOD=!1;this._invisibleDirty=!0;this._cameraDirty=!1;this.notifyChange("rootNodeVisible")}};V._getProgressiveLoadFactor=function(){return 1>this.layerView.view.resourceController.memoryController.memoryFactor?1:this.layerView.progressiveLoadFactor};V.isGeometryVisible=function(W){return n.isSome(this._index)&&this._index.isGeometryVisible(W.index)};
V.updateVisibility=function(W){n.isSome(this._index)&&this._index.invalidateNodeVisibilityCache(W)};V.updateBoundingVolume=function(W){n.isSome(this._index)&&this._index.invalidateBoundingVolumeCache(W)};V.invalidateGeometryVisibility=function(W){n.isSome(this._index)&&this._index.invalidateGeometryVisibility(W)};V.invalidateVisibilityObbs=function(){n.isSome(this._index)&&this._index.invalidateVisibilityObbs()};V.modificationsChanged=function(){n.isSome(this._index)&&this._index.imModificationsChanged(!!this.layerView.hasModifications);
this._invisibleDirty=!0};V._shouldLoadNode=function(W){return this._lodHandling.shouldLoadNode(W)&&!this._shouldDropNode(W)&&n.isSome(this._index)&&this._index.isGeometryVisible(W.index)?this._isNodeInScaleBounds(W):!1};V._shouldDropNode=function(W){if(n.isNone(this._viewportQueries))return!1;const U=this.lodDropFactor;return 1<=U||!this._lodHandling.hasNoVisibleChildren(W)?!1:Math.abs(this._viewportQueries.calcCameraDistanceToCenter(W))-this._viewportQueries.minDistance>(this._viewportQueries.maxDistance-
this._viewportQueries.minDistance)*U};V._startNodeLoading=function(){this._restartNodeLoading=!1;const W=this._index;this._updatesDisabled||n.isNone(W)||n.isNone(this._viewportQueries)||(this._updateViewData(),this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1),this._nodeLoader=new p(this.layer,this.dataStreamController,O,this._defaultGeometrySchema,this._requiredAttributes,{textureEncodings:this.layerView.supportedTextureEncodings,
uncompressedTextureDownsamplingEnabled:this.layerView.uncompressedTextureDownsamplingEnabled,textureUsageMask:this.layerView.rendererTextureUsage,loadFeatureData:this.useMaximumNumberOfFeatures}),W.requestUpdate(),this._lodHandling.startNodeLoading(U=>this._isNodeInScaleBounds(U),(U,aa)=>this._removeNodes(U,aa,R.fadeout),W,{maxLodLevel:this._viewportQueries.maxLodLevel}),this._evaluateUpdating())};V.isNodeLoading=function(){return null!=this._nodeLoader&&null!=this._index};V.cancelNodeLoading=function(){this.isNodeLoading()&&
(this.indexStreamController.cancelAll(),this.dataStreamController.cancelAll(),this._idleQueue.cancelAll(),this._cancelAllNodes(),this._nodeLoader=null,this._evaluateUpdating())};V._removeInvisibleNodes=function(W){const U=this._index;if(n.isNone(U)||n.isNone(this._viewportQueries))return!1;Q.clear();this.layerView.getLoadedNodeIndices(Q);const aa=0===this._viewportQueries.maxDistance,da=aa?()=>!1:Y=>this._shouldDropNode(Y);Q.filterInPlace(Y=>{const ea=U.getNode(Y);return n.isNone(ea)||!U.isGeometryVisible(Y)||
da(ea)||!this._isNodeInScaleBounds(ea)});0<Q.length&&this._lodHandling.setLodGlobalDirty();this._removeNodes(Q,W,R.pop);if(aa&&1>this.lodDropFactor)return!1;if(0===Q.length)return!0;Q.clear();return!1};V.markNodeToRemove=function(W){Q.push(W)};V.removeMarkedNodes=function(){this._removeNodes(Q,M.noBudget,R.pop)};V._removeNodes=function(W,U,aa){const da=W.length;if(0!==da&&!U.done){for(n.isSome(this._index)&&this._index.requestUpdate();0<W.length&&!U.done;){const Y=W.pop(),ea=this._index;aa===R.fadeout&&
this.layerView.nodeFadeoutEnabled&&n.isSome(ea)&&ea.isGeometryVisible(Y)?this.layerView.fadeNode(Y,F.FadeDirection.FadeOut,!0):this.layerView.removeNode(Y);U.madeProgress()}if(0<this._loadedNodeScales.size)for(U=W.length;U<da;U++)this._loadedNodeScales.delete(W.data[U])}};V._needsUpdate=function(W){if(!W.resources.hasFeatureData||this._updatingNodes.has(W.index))return!1;W=this.layerView.getLoadedAttributes(W.index);return null!=W&&W!==this._requiredAttributes};V._updateLoadedNode=function(W){const U=
new AbortController;this._updatingNodes.set(W.index,U);const aa=this.layerView.getLoadedAttributes(W.index);(K(aa,this._requiredAttributes)?Promise.resolve(this.layerView.getAttributeData(W.index)):this._nodeLoader.loadAttributes(W,this._requiredAttributes,U.signal)).then(da=>this.schedule(()=>this.layerView.updateAttributes(W.index,{loadedAttributes:this._requiredAttributes,attributeData:da},U.signal),U.signal)).catch(da=>{if(!k.isAbortError(da))return this.layerView.updateAttributes(W.index,{loadedAttributes:this._requiredAttributes,
attributeData:{}},U.signal)}).catch(()=>{}).then(()=>{this._updatingNodes.delete(W.index);this._evaluateUpdating()});this._evaluateUpdating()};V._loadNode=function(W){if(this._loadingNodes.has(W.index))O.error("already loading node "+W.index);else{var U=new AbortController;this._loadingNodes.set(W.index,U);this._evaluateUpdating();this._loadAndAddNode(W,U.signal).then(aa=>{aa&&n.isSome(this._index)&&this._loadingNodes.get(W.index)===U&&(this._loadingNodes.delete(W.index),this._index.requestUpdate())}).catch(aa=>
{if(!k.isAbortError(aa))throw aa;}).finally(()=>{this._loadingNodes.get(W.index)===U&&this._loadingNodes.delete(W.index);this._evaluateUpdating()})}};V._loadAndAddNode=function(W,U){return W.cacheState===A.CacheState.Uncached?this._loadUncached(W,U).then(()=>!1):this._loadCached(W,U).then(aa=>{if(aa)return!1;W.cacheState=A.CacheState.Uncached;return!0}).catch(aa=>k.isAbortError(aa)?!1:(W.cacheState=A.CacheState.Uncached,!0))};V._enableFromGPUCache=function(W,U){if(this._disableMemCache||n.isNone(this._index))return!1;
if(U===A.NodeState.Hole&&!this._index.useNodeAsHole(W.index))return!0;const aa=this._loadCachedGPUData(W);if(!aa)return!1;this.layerView.addCachedGPUData(W,aa,U);this._nodeAdded();return!0};V._loadCachedGPUData=function(W){W=this.layerView.loadCachedGPUData(W);if(n.isSome(W)&&n.isSome(W.attributeInfo)&&K(W.attributeInfo.loadedAttributes,this._requiredAttributes))return W;this.layerView.deleteCachedGPUData(W);return null};V._nodeAdded=function(){n.isSome(this._index)&&this._index.requestUpdate();this._lodHandling.setLodGlobalDirty();
this._evaluateUpdating()};V._loadCached=function(W,U){if(this._enableFromGPUCache(W,A.NodeState.Leaf))return Promise.resolve(!0);const aa=this.layerView;return!this.disableIDBCache&&aa.loadCachedNodeData&&aa.addCachedNodeData?this.schedule(()=>aa.loadCachedNodeData(W,U,(da,Y)=>this._nodeLoader.loadTextures(W,da,Y)),U).then(da=>{if(n.isNone(da))return!1;const Y=this._requiredAttributes;return this.reschedule(()=>this._nodeLoader.loadAttributes(W,Y,U),U).then(ea=>this.reschedule(()=>aa.addCachedNodeData(W,
da,{loadedAttributes:Y,attributeData:ea},U),U)).then(()=>{this._nodeAdded();return!0})}):Promise.resolve(!1)};V._loadUncached=function(W,U){this._downloadingCount++;return this._nodeLoader.loadNodeData(W,U).catch(aa=>{this._downloadingCount--;throw aa;}).then(aa=>{this._downloadingCount--;return this.schedule(()=>this.layerView.addNode(W,aa,U),U)}).then(()=>{this._nodeAdded();W.cacheState=A.CacheState.Cached}).catch(aa=>{if(!k.isAbortError(aa))throw O.error("#loadNodeData()",this.layer,`Failed to load node '${W.id}'`,
aa),W.failed=!0,n.isSome(this._index)&&this._index.requestUpdate(),aa;})};V._updateIdleState=function(W){W!==this._isIdle&&(this._isIdle=W,this._evaluateUpdating(),W&&this._index&&n.isSome(this._index)&&this._index.resetFailedNodes())};V._getScale=function(W){if(this._loadedNodeScales.has(W.index))return this._loadedNodeScales.get(W.index);const U=this._computeScale(W);this.layerView.isNodeLoaded(W.index)&&this._loadedNodeScales.set(W.index,U);return U};V._computeScale=function(W){this._tmpPoint.x=
W.mbs[0];this._tmpPoint.y=W.mbs[1];this._tmpPoint.z=W.mbs[2];return this.layerView.view.basemapTerrain.getSphereScale(this._tmpPoint,W.mbs[3])};V._isNodeInScaleBounds=function(W){if(!this.areScaleBoundsActive)return!0;W=this._getScale(W);const {minScale:U,maxScale:aa}=H.extractSafeScaleBounds(this.layer);return H.scaleBoundsPredicate(W,U,aa)};V.updateStats=function(W){W.index=n.isSome(this._index)?this._index.size:0;this.isGraphics3D&&(W.detail=this._featureLOD,W.target=this.featureTarget*this.baseLOD);
n.isSome(this._index)&&this._index.updateStats(W)};V.notifyLODUpdate=function(){this._lodHandling.setLodGlobalDirty();this._evaluateUpdating();n.isSome(this._index)&&this._index.requestUpdate()};V.geometryFilterChanged=function(W){const U=this._index;n.isSome(U)&&U.layerFilterChanged(W);this.requestUpdate()};a._createClass(T,[{key:"isMeshPyramid",get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store.lodType}},{key:"isGraphics3D",get:function(){return"points"===
this.layer.profile}},{key:"useMaximumNumberOfFeatures",get:function(){return!this.isMeshPyramid&&(2>this.layer.version.major||!h("enable-feature:point-base-layer"))}},{key:"indexStreamController",get:function(){const W=this.layerView.view.resourceController.createStreamDataRequester(L.ClientType.I3S_INDEX);return new B.I3SStreamDataController(W,this.layer.apiKey)}},{key:"dataStreamController",get:function(){const W=this.layerView.view.resourceController.createStreamDataRequester(L.ClientType.I3S_DATA);
return new B.I3SStreamDataController(W,this.layer.apiKey)}},{key:"crsVertex",get:function(){return D.getVertexCrs(this.layer)}},{key:"crsIndex",get:function(){return D.getIndexCrs(this.layer)}},{key:"rootNodeVisible",get:function(){if(n.isSome(this._index)){const W=this._index.rootNode;if(n.isSome(W))return this._updateViewData(),this._index.isNodeVisible(W.index)}return!0}},{key:"index",get:function(){return this._index}},{key:"isIntegratedMesh",get:function(){return"integrated-mesh"===this.layer.type}},
{key:"areScaleBoundsActive",get:function(){const {minScale:W,maxScale:U}=H.extractSafeScaleBounds(this.layer);return this.scaleVisibilityEnabled&&(0<W||0<U)}},{key:"unloadedMemoryEstimate",get:function(){return n.isNone(this._index)||this.layerView.suspended?0:this._index.getUnloadedMemoryEstimate()*this.lodDropFactor}},{key:"indexDepth",get:function(){return n.isSome(this._index)?this._index.maxLevel:0}},{key:"disableMemCache",set:function(W){this.layerView.loadCachedGPUData&&this.layerView.addCachedGPUData||
(this._disableMemCache=!0);this._disableMemCache=W}},{key:"lod",get:function(){return this._featureLOD*this.baseLOD}},{key:"baseLOD",get:function(){const W=this.layerView.lodFactor,U=this.layerView.view.resourceController.memoryController.memoryFactor;return this.fixedFeatureTarget?1:(0<W?W:1)*U}},{key:"lodDropFactor",get:function(){if(this.fixedFeatureTarget)return 1;const W=this.layerView.view.resourceController.memoryController;return(Math.min(W.memoryFactor,.5)-W.minQuality)/(.5-W.minQuality)}},
{key:"test",get:function(){const W=this;return{index:this._index,set disableUpdates(U){(W._updatesDisabled=U)?W.cancelNodeLoading():W.requestUpdate()},set disableIDBCache(U){W.disableIDBCache=U},set ignoreServiceObb(U){n.isSome(W._index)&&(W._index.ignoreServiceObb=U)},shouldLoadNode:U=>W._shouldLoadNode(U)}}}]);return T}(l.EsriPromiseMixin(c));b.__decorate([d.property({readOnly:!0})],c.prototype,"isMeshPyramid",null);b.__decorate([d.property({readOnly:!0})],c.prototype,"isGraphics3D",null);b.__decorate([d.property({readOnly:!0})],
c.prototype,"useMaximumNumberOfFeatures",null);b.__decorate([d.property({readOnly:!0})],c.prototype,"indexStreamController",null);b.__decorate([d.property({readOnly:!0})],c.prototype,"dataStreamController",null);b.__decorate([d.property({readOnly:!0})],c.prototype,"crsVertex",null);b.__decorate([d.property({readOnly:!0})],c.prototype,"crsIndex",null);b.__decorate([d.property()],c.prototype,"screenSizeFactor",void 0);b.__decorate([d.property()],c.prototype,"featureTarget",void 0);b.__decorate([d.property()],
c.prototype,"fixedFeatureTarget",void 0);b.__decorate([d.property()],c.prototype,"layerView",void 0);b.__decorate([d.property()],c.prototype,"layer",void 0);b.__decorate([d.property({})],c.prototype,"updating",void 0);b.__decorate([d.property({})],c.prototype,"updatingProgress",void 0);b.__decorate([d.property({readOnly:!0})],c.prototype,"leavesReached",void 0);b.__decorate([d.property({constructOnly:!0})],c.prototype,"scaleVisibilityEnabled",void 0);b.__decorate([d.property({readOnly:!0,dependsOn:[]})],
c.prototype,"rootNodeVisible",null);c=b.__decorate([v.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],c);const Q=new f({deallocator:null});let J;const P={factorIM:.2,factor3dObject:.05,distancePenalty:10},N=t.create();var R;(function(S){S[S.pop=0]="pop";S[S.fadeout=1]="fadeout"})(R||(R={}));return c})},"esri/views/3d/layers/i3s/I3SFrameTask":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/arrayUtils","../../../support/Scheduler"],function(a,
b,c,g){let h=function(){function n(l){this.referenceCount=0;this.callbacks=[];this.runIndex=0;this.handle=l.registerTask(g.TaskPriority.I3S_CONTROLLER,this)}var f=n.prototype;f.destroy=function(){this.handle&&(this.handle.remove(),this.handle=null)};f.runTask=function(l){this._sort();const k=this.callbacks,e={numIndexLoading:0,numNodesLoading:0};for(let d=0;d<k.length&&!l.done;++d)k[d].priority=k[d].update(l,e),this.runIndex=d};f._sort=function(){const l=this.callbacks;let k=l.length;for(let e=this.runIndex;0<
e;e--){const d=l[e-1];let m=e;for(;m<l.length&&d.priority<=l[m].priority&&(m!==k||d.priority<l[m].priority);)l[m-1]=l[m],m++;l[m-1]=d;k=m-1}this.runIndex=0};f.add=function(l){this._sort();l.priority=Infinity;this.callbacks.unshift(l)};f.remove=function(l){c.removeUnordered(this.callbacks,l);this.runIndex=this.callbacks.length;this._sort()};b._createClass(n,[{key:"running",get:function(){for(const l of this.callbacks)if(l.needsUpdate())return!0;return!1}}]);return n}();const w=new Map;a.addTask=function(n,
f){let l=w.get(n);null==l&&(l=new h(n),w.set(n,l));l.add(f);return{remove:()=>{null!=l&&(l.remove(f),0<l.callbacks.length||(w.delete(n),l.destroy()),l=null)}}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SIndex":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../chunks/vec3 ../../../../chunks/vec4f64 ./I3SNode ./I3SUtil ../../support/orientedBoundingBox".split(" "),
function(a,b,c,g,h,w,n,f,l,k){function e(y){c.isSome(y.node)&&(y.node.renderMbs[3]=-1,c.isSome(y.node.serviceObbInRenderSR)&&(y.node.serviceObbInRenderSR.halfSize[0]=-1));c.isSome(y.ref)&&(y.ref.renderMbs[3]=-1,c.isSome(y.ref.serviceObbInRenderSR)&&(y.ref.serviceObbInRenderSR.halfSize[0]=-1))}function d(y,A){return 0===A?0:y/A|0}function m(y,A){return 0===A?y:y%A}function z(y){if(y)for(let A=0;A<y.length;A++)for(const p of u)if(p[0]===y[A].metricType)return{lodMetric:p[1],maxError:y[A].maxError};
return{lodMetric:f.LodMetric.None,maxError:0}}function v(y){return Math.sqrt(4/Math.PI*y)}let q=function(y,A,p,B,D){this.childOffset=y;this.childCount=A;this.visibilityCache=p;this.ref=B;this.node=D;this.useAsHole=0;this.filterImpact=f.NodeFilterImpact.NotChecked},t=function(){function y(p,B,D,C,F,G,L,H,M,K,I,O,Q,J){this.streamDataController=D;this.viewportQueries=C;this.logger=F;this.holeFilling=G;this._isLoaded=L;this._isReloading=H;this._isSelected=M;this._enable=K;this._needsUpdate=I;this._canRequest=
O;this._computeVisibilityObb=Q;this._computeNodeFiltering=J;this._dirty=!0;this._nodePages=[];this.rootIndex=this.nodesPerPage=this.nodeCount=0;this.lodMetric=f.LodMetric.None;this._lodConversion=P=>P;this.urlPrefix="";this._loading=new Set;this._failedNodes=new Set;this._failedPages=new Set;this._indexMissing=1;this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._maxProcessingPrio=Number.POSITIVE_INFINITY;this._nodeTraversalState=new Map;this._version=l.addWraparound(0,2);this._visibilityCacheVersion=
l.addWraparound(0,2);this._maxLevel=1;this._featureEstimate={estimate:0,leavesReached:!1};this._unloadedMemoryEstimate=0;this._missing=new g({deallocator:null});this._prefetch=new g({deallocator:null});this._updates=new x(this._missing);this._imModificationUncategorized=new g({deallocator:null});this.ignoreServiceObb=!1;this.progressiveLoadPenalty=0;this._pageQueue=[];this._layerHasFilter=this.layerHasModifications=!1;this.logLayer=p;p.serviceUpdateTimeStamp&&p.serviceUpdateTimeStamp.lastUpdate&&
(this.lastUpdate=`${p.serviceUpdateTimeStamp.lastUpdate}`);this._maxLodLevel=this.viewportQueries?this.viewportQueries.maxLodLevel:1;this._init(B)}var A=y.prototype;A._init=function(p){if("page"===p.type){this.urlPrefix=p.urlPrefix;this.nodesPerPage=p.pageSize;this.rootIndex=p.rootIndex;switch(p.lodMetric){case "maxScreenThreshold":this.lodMetric=f.LodMetric.MaxScreenThreshold;break;case "maxScreenThresholdSQ":this.lodMetric=f.LodMetric.MaxScreenThreshold,this._lodConversion=v}this._addPage(d(this.rootIndex,
this.nodesPerPage),p.rootPage);this._updateParentsAndLevel()}else"node"===p.type&&(this.urlPrefix=p.urlPrefix,this._nodePages.push({nodes:[],children:[],parents:[]}),this._makeRefNode(new f.NodeBase(p.rootNode.id,null),-1),(p=this._validateNode(p.rootNode.id,p.rootNode))&&this._addNode(p,0))};A._loadPage=function(p){this._loading.add(p);this.streamDataController.request(this.urlPrefix+p,"json").then(B=>{this._pageQueue.push({pageIndex:p,page:B})}).catch(B=>{this._loading.delete(p);h.isAbortError(B)||
(this._failedPages.add(p),this.logger.error("#loadPage()",this.logLayer,`Error when loading page ${p}`,B))})};A._addQueuedPages=function(p){for(;0<this._pageQueue.length&&!p.done;){const {pageIndex:B,page:D}=this._pageQueue.shift();this._addPage(B,D);this._loading.delete(B);p.madeProgress()}this._updateParentsAndLevel()};A._addPage=function(p,B){for(let F=this._nodePages.length;F<p;F++)this._nodePages[F]=null;const D=[],C=[];B=B.nodes.map((F,G)=>{const L=D.length,H=F.children?F.children.length:0;
C.push(-1);for(var M=0;M<H;M++)D.push(F.children[M]);const K=`${F.index}`;M=k.clone(F.obb);const I=n.fromArray([M.center[0],M.center[1],M.center[2],w.length(M.halfSize)]),O=F.mesh&&F.mesh.attribute,Q=F.mesh&&F.mesh.geometry,J=F.mesh&&F.mesh.material;F=new f.Node(K,p*this.nodesPerPage+G,I,H,0,{hasSharedResource:!1,hasFeatureData:!!Q,attributes:O&&null!=O.resource?`${O.resource}`:null,geometry:Q&&null!=Q.resource?`${Q.resource}`:null,texture:J&&null!=J.resource?`${J.resource}`:null,geometryDefinition:Q?
Q.definition:-1,materialDefinition:J?J.definition:-1},this.lastUpdate,this.lodMetric,this._lodConversion(F.lodThreshold),Q?Q.featureCount:null);F.serviceObb=M;F.visibilityObb=this._computeVisibilityObb(F);F.vertexCount=Q?Q.vertexCount:0;return new q(L,H,l.addWraparound(this._visibilityCacheVersion,-2),null,F)});this._nodePages[p]={nodes:B,children:D,parents:C};this.nodeCount+=B.length};A._updateParentsAndLevel=function(){const p=[],B=(D,C,F)=>{const G=this._getPage(D);if(c.isSome(G)){const L=m(D,
this.nodesPerPage);G.parents[L]=C;C=G.nodes[L].node;c.isSome(C)&&(C.level=F,p.push(D))}};for(B(this.rootIndex,-1,0);p.length;){const D=p.pop(),C=this.getNode(D);if(c.isSome(C))for(let F=0;F<C.childCount;F++){const G=this.getChildIndex(C,F);B(G,D,C.level+1);this._maxLevel=Math.max(this._maxLevel,C.level+1)}}};A._getPage=function(p){return this._nodePages[d(p,this.nodesPerPage)]};A._getNodeInternal=function(p){const B=this._getPage(p);return c.isNone(B)?null:B.nodes[m(p,this.nodesPerPage)]};A._addNode=
function(p,B){null!=p.children&&this.populateChildren(B,p.children);var D=this.getParent(B);D=c.isSome(D)?D.level+1:0;this._maxLevel=Math.max(this._maxLevel,p.children?D+1:D);const {lodMetric:C,maxError:F}=z(p.lodSelection),G=c.unwrap(this._getNodeInternal(B));G.node=new f.Node(p.id,B,n.fromArray(p.mbs),G.childCount,D,p.resources,p.version,C,F,p.numFeatures);p.obb&&(G.node.serviceObb=k.clone(p.obb));G.node.visibilityObb=this._computeVisibilityObb(G.node);c.isSome(G.ref)&&(null==G.ref.mbs&&(G.ref.mbs=
p.mbs),G.node.renderMbs=G.ref.renderMbs,G.node.serviceObbInRenderSR=G.ref.serviceObbInRenderSR,G.ref.visibilityObb=G.node.visibilityObb);return G.node};A._makeRefNode=function(p,B){const D=this._nodePages[0],C=D.nodes.length;D.nodes.push(new q(0,0,l.addWraparound(this._visibilityCacheVersion,-2),p,null));this.nodeCount++;D.parents.push(B);p.renderMbs[3]=-1;c.isSome(p.serviceObbInRenderSR)&&(p.serviceObbInRenderSR.halfSize[0]=-1);return C};A.populateChildren=function(p,B){var D=c.unwrap(this._getNodeInternal(p));
const C=c.unwrap(this._getPage(p));D.childOffset=C.children.length;D.childCount=B.length;for(D=0;D<B.length;D++){const F=this._makeRefNode(B[D],p);C.children.push(F)}};A.getNode=function(p){p=this._getNodeInternal(p);return c.isSome(p)?p.node:null};A.getIndexById=function(p){let B;this._forAllNodes((D,C)=>{c.isSome(D.node)&&D.node.id===p?B=C:c.isSome(D.ref)&&D.ref.id===p&&(B=C)});return B};A.getNodeById=function(p){p=this.getIndexById(p);return 0<=p?this.getNode(p):null};A.getChildIndex=function(p,
B){const D=this._getPage(p.index);if(c.isNone(D))return-1;p=D.nodes[m(p.index,this.nodesPerPage)];return D.children[p.childOffset+B]};A.getParentIndex=function(p){const B=this._getPage(p);return c.isSome(B)?B.parents[m(p,this.nodesPerPage)]:-1};A.getParent=function(p){p=this.getParentIndex(p);return 0<=p?this.getNode(p):null};A.isLeaf=function(p){p=this._getNodeInternal(p);return c.isSome(p)&&0===p.childCount};A.invalidateVisibilityCache=function(){this._visibilityCacheVersion=l.addWraparound(this._visibilityCacheVersion,
2)};A.invalidateNodeVisibilityCache=function(p){p=this._getNodeInternal(p);c.isSome(p)&&this.invalidateNodeVisibilityCacheInternal(p)};A.invalidateNodeVisibilityCacheInternal=function(p){p.visibilityCache=l.addWraparound(this._visibilityCacheVersion,-2)};A.invalidateBoundingVolumeCache=function(p){p=this._getNodeInternal(p);c.isSome(p)&&(e(p),this.invalidateNodeVisibilityCacheInternal(p))};A.invalidateGeometryVisibility=function(p){p=this._getNodeInternal(p);c.isSome(p)&&c.isSome(p.node)&&(p.node.geometryObb=
null,p.node.renderMbs[3]=-1,c.isSome(p.node.serviceObbInRenderSR)&&(p.node.serviceObbInRenderSR.halfSize[0]=-1))};A.invalidateVisibilityObbs=function(){c.isNone(this.rootNode)||this.traverse(this.rootNode,p=>{p.visibilityObb=this._computeVisibilityObb(p);p.geometryObb=null;return!0})};A.isNodeVisible=function(p){p=this._getNodeInternal(p);if(c.isNone(p)||c.isSome(p.ref)&&!p.ref.mbs)return!0;if((p.visibilityCache&-2)!==this._visibilityCacheVersion){var B=p.node;const C=c.isSome(B)&&(c.isNone(p.ref)||
c.isSome(B.visibilityObb))?B:c.isSome(p.ref)?p.ref:null;if(this._layerHasFilter&&this._computeNodeFiltering&&(c.isSome(B)||c.isSome(p.ref))&&p.filterImpact===f.NodeFilterImpact.NotChecked){var D=c.isSome(B)?B.mbs:c.isSome(p.ref)?p.ref.mbs:null;p.filterImpact=null!=D?this._computeNodeFiltering(D):f.NodeFilterImpact.Unmodified}D=c.isSome(B)&&p.filterImpact===f.NodeFilterImpact.Culled;B=!(c.isSome(B)&&B.imModificationImpact===f.NodeIMModificationImpact.Culled)&&(!C||this.viewportQueries.isNodeVisible(C))&&
!D;p.visibilityCache=this._visibilityCacheVersion+(B?1:0);return B}return 1===(p.visibilityCache&1)};A.isGeometryVisible=function(p){if(!this.isNodeVisible(p))return!1;p=this._getNodeInternal(p);return c.isSome(p)&&c.isSome(p.node)&&c.isSome(p.node.geometryObb)&&(!this.layerHasModifications||p.node.imModificationImpact!==f.NodeIMModificationImpact.NotChecked)?this.viewportQueries.isGeometryVisible(p.node):!0};A._traverseCoverage=function(p,B,D,C,F){p=this._getPage(p);if(!c.isNone(p)&&0!==B.childCount){var G=
B.childOffset+B.childCount,L=[];for(B=B.childOffset;B<G;++B){const H=p.children[B],M=this._getNodeInternal(H);c.isSome(M)&&c.isSome(M.node)&&this.isGeometryVisible(H)&&L.push(M)}C/=L.length;for(const H of L)p=c.unwrap(H.node).index,this._isLoaded(p)||this._isReloading(p)?(F.delta=Math.max(F.delta,D),F.coverage+=C):this._traverseCoverage(p,H,D+1,C,F)}};A.useNodeAsHole=function(p){if("off"===this.holeFilling)return!1;const B=this._getNodeInternal(p);if(c.isNone(B))return!1;if("always"===this.holeFilling)return!0;
if((B.useAsHole&-2)===this._version)return 1===(B.useAsHole&1);const D={delta:0,coverage:0};this._traverseCoverage(p,B,0,1,D);p=.5>=D.delta*D.coverage;B.useAsHole=this._version+(p?1:0);return p};A.destroy=function(){this._updates.add.prune();this._updates.update.prune()};A.requestUpdate=function(){this._dirty=!0;this._indexMissing=1;this._version=l.addWraparound(this._version,2)};A.imModificationsChanged=function(p){this.layerHasModifications=p;this._forAllNodes(({node:B})=>{c.isSome(B)&&(B.imModificationImpact=
f.NodeIMModificationImpact.NotChecked,B.visibilityObb=this._computeVisibilityObb(B),B.hasModifications&&this.invalidateGeometryVisibility(B.index))});this.invalidateVisibilityCache()};A.layerFilterChanged=function(p){this._layerHasFilter=p;this._forAllNodes(B=>{c.isSome(B)&&(B.filterImpact=f.NodeFilterImpact.NotChecked,B=B.node,c.isSome(B)&&this.invalidateNodeVisibilityCache(B.index))});this.invalidateVisibilityCache()};A.update=function(p,B,D){if(this._dirty){0<this._pageQueue.length&&this._addQueuedPages(B);
this._maxProcessingPrio=this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._missing.clear();this._prefetch.clear();this._updates.reset(p);r.clear();var C=!0,F=new E,G=new E,L=this._imModificationUncategorized;L.clear();var H=new Set;this.traverseVisible((K,I,O)=>{if(c.isNone(I))I=this._entryPriority(K),Infinity===I&&(I=this._entryPriority(O)),K=d(K,this.nodesPerPage),r.set(K,Math.max(I,r.get(K)||0)),this._loading.has(K)||this._failedPages.has(K)||this._missing.push(K),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,
I);else{var Q=I.node;this._updateNodeFeatureEstimate(Q,G);if(c.isNone(Q))I=this._entryPriority(K),this._loading.has(K)||this._failedNodes.has(K)||(this._missing.push(K),r.set(K,I)),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,I);else{O=c.unwrap(this._getPage(K));if(0===this._missing.length&&0===this.nodesPerPage)for(let J=0;J<I.childCount;J++){const P=O.children[I.childOffset+J],N=this._getNodeInternal(P);!c.isSome(N)||N.node||this._loading.has(P)||this._failedNodes.has(P)||(r.set(P,this._entryPriority(P)),
this._prefetch.push(P))}Q.failed||(H.add(Q.id),this._isLoaded(K)?(F.known+=Q.memory,++F.knownNodes,this._isSelected(Q)?0<I.childCount&&(C=!1):(F.unremoved+=Q.memory,C=!1),this._needsUpdate(Q)&&(I=this._entryPriority(K),r.set(K,I),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,I),this._updates.update.push(K))):(Q.memory&&(F.known+=Q.memory,++F.knownNodes),this._isSelected(Q)?(0<I.childCount&&(C=!1),Q.memory?(F.missing+=Q.memory,F.known+=Q.memory,++F.knownNodes):++F.missingNodes,0<=p.indexOf(Q.index)?
(this._maxProcessingPrio=Math.max(this._maxProcessingPrio,this._entryPriority(K)),this._updates.cancel=this._updates.cancel.filter(J=>J!==Q.index)):!B.done&&this._enable(Q)?B.madeProgress():(I=this._entryPriority(K),r.set(K,I),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,I),this._updates.add.push(K),this.layerHasModifications&&D&&c.isSome(Q)&&Q.imModificationImpact===f.NodeIMModificationImpact.NotChecked&&L.push(K))):this._isReloading(K)&&this._updates.remove.push(K)))}}});var M=this._updates.add;
0<M.length&&this.layerHasModifications&&(0<L.length&&D(L),M.filterInPlace(K=>{var I=this._getNodeInternal(K);(I=c.isNone(I)||c.isNone(I.node)||I.node.imModificationImpact!==f.NodeIMModificationImpact.Culled)||this.invalidateNodeVisibilityCache(K);return I}));this._unloadedMemoryEstimate=F.missing-F.unremoved;3<F.knownNodes&&0<F.missingNodes&&(this._unloadedMemoryEstimate+=F.known/F.knownNodes*F.missingNodes);this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate);this._featureEstimate.estimate=
this._computeFeatureEstimate(G);this._featureEstimate.leavesReached=C;this._missing.sort((K,I)=>K-I);this._missing.filterInPlace((K,I)=>1>I||this._missing.data[I-1]!==K);this._missing.sort((K,I)=>r.get(K)-r.get(I));0<this._missing.length&&(this._maxUnloadedPrio=r.get(this._missing.back()),this._prefetch.clear());this._updates.add.filterInPlace(K=>r.get(K)>=this._maxUnloadedPrio).sort((K,I)=>r.get(K)-r.get(I));this._updates.update.sort((K,I)=>r.get(K)-r.get(I));this._indexMissing=this._loading.size+
this._missing.length;this._dirty=0<this._indexMissing;r.clear()}};A.checkFeatureTarget=function(p,B){const D=this.viewportQueries.updateScreenSpaceErrorBias(B);let C=B,F=B,G=D,L=10;for(;L--;){const H=new E;this._updateFeatureEstimate(C,H);if(this._computeFeatureEstimate(H)<=p){if(C>=B||0<H.missingNodes||0===L)break;G=C;C=.5*(C+F)}else F=C,C=.5*(C+G)}this._version=l.addWraparound(this._version,2);this.viewportQueries.updateScreenSpaceErrorBias(D);return Math.min(B,C)};A._updateFeatureEstimate=function(p,
B){this._version=l.addWraparound(this._version,2);this.viewportQueries.updateScreenSpaceErrorBias(p);this.traverseVisible((D,C)=>this._updateNodeFeatureEstimate(c.isSome(C)&&C.node,B))};A._updateNodeFeatureEstimate=function(p,B){c.isNone(p)||p.failed||c.isNone(p.numFeatures)||(this._isLoaded(p.index)?(B.known+=p.numFeatures,++B.knownNodes,this._isSelected(p)||(B.unremoved+=p.numFeatures)):this._isSelected(p)&&(c.isSome(p.numFeatures)?(B.missing+=p.numFeatures,B.known+=p.numFeatures,++B.knownNodes):
++B.missingNodes))};A._computeFeatureEstimate=function(p){let B=p.known-p.unremoved;3<p.knownNodes&&0<p.missingNodes&&(B+=p.known/p.knownNodes*p.missingNodes);return Math.max(0,B)};A.load=function(){return this._load(this._missing)};A.prefetch=function(){this._prefetch.sort((p,B)=>r.get(p)-r.get(B));return this._load(this._prefetch)};A._load=function(p){if(0===p.length||!this._canRequest())return!1;for(;0<p.length&&this._canRequest();)0===this.nodesPerPage?this._loadNode(p.pop()):this._loadPage(p.pop());
return!0};A.isLoading=function(){return 0<this._indexMissing};A.getIndexLoading=function(){return this._loading.size};A.getIndexMissing=function(){return this._indexMissing};A.getUnloadedMemoryEstimate=function(){return this._unloadedMemoryEstimate};A.nodeTraversalState=function(p){if(c.isNone(p))return null;let B=this._nodeTraversalState.get(p.index);if(B&&(B.version&-2)===this._version)return B;const D=this.viewportQueries.getLodLevel(p),C=this.viewportQueries.hasLOD(p);var F=!0;C?(F=this.getParentIndex(p.index),
F=0<=F?(F=this._nodeTraversalState.get(F))&&D>F.lodLevel:0<D):F=0===p.childCount;if(B)return B.lodLevel=D,B.isChosen=F,B.version=this._version+1,B;B=new f.NodeTraversalState(C,F,D,this._version+1);this._nodeTraversalState.set(p.index,B);return B};A._loadNode=function(p){this._loading.add(p);const B=c.unwrap(this._getNodeInternal(p)).ref;if(c.isNone(B))this._failedNodes.add(p);else{var D=B.id,C=this.urlPrefix+D,F=()=>{this._loading.delete(p);0===this._missing.length&&0===this._loading.size&&this.requestUpdate()};
this.streamDataController.request(C,"json").then(G=>{F();G=this._validateNode(D,G);null!=G&&(G.obb&&this.invalidateNodeVisibilityCache(p),G=this._addNode(G,p),this.nodeTraversalState(G))},G=>{F();h.isAbortError(G)||(this.logger.error("#loadNode()",this.logLayer,"Error loading node: "+C),this._failedNodes.add(p))})}};A._validateNode=function(p,B){if(null==B||"object"!==typeof B||B.id!==p)return this.logger.error("#validateNode()",this.logLayer,`Invalid node. Wrong type or wrong id "${p}"`),null;if(!Array.isArray(B.mbs))return this.logger.error("#validateNode()",
this.logLayer,`Invalid bounding volume on node ${p}.`),null;B.sharedResource&&"./shared"!==B.sharedResource.href&&"./shared/"!==B.sharedResource.href&&this.logger.warn("#validateNode()",this.logLayer,`Invalid shared resource href on node "${p}"`);null==B.geometryData||Array.isArray(B.geometryData)&&1===B.geometryData.length&&"./geometries/0"===B.geometryData[0].href||this.logger.warn("#validateNode()",this.logLayer,`Invalid geometry data on node "${p}"`);null==B.attributeData||Array.isArray(B.attributeData)&&
!B.attributeData.some((G,L)=>G.href!==`./attributes/f_${L}/0`)||this.logger.warn("#validateNode()",this.logLayer,`Invalid attribute data on node "${p}"`);B.featureData&&1<B.featureData.length&&this.logger.warn("#validateNode()",this.logLayer,`Node ${p} has ${B.featureData.length} bundles. Only the first bundle will be loaded.`);const D=B.hasOwnProperty("obb")&&!this.ignoreServiceObb?B.obb:null,C=B.featureData&&1===B.featureData.length&&B.featureData[0].featureRange?B.featureData[0].featureRange[1]-
B.featureData[0].featureRange[0]+1:null;var F=G=>{if(null==G)return null;var L=H=>this.logger.error("#validateNode()",this.logLayer,`Invalid node reference on node ${p}: ${H}`);if("number"===typeof G.id)L(`id ${G.id} is a number instead of a string.`);else if("string"!==typeof G.id||!Array.isArray(G.mbs))return L("Missing or invalid id."),null;if(!Array.isArray(G.mbs))return L(`Invalid bounding volume on reference ${G.id}.`),null;G.href&&G.href!=="../"+G.id&&this.logger.error("#validateNode()",this.logLayer,
`Invalid node href on node "${p}"`);L=G.hasOwnProperty("obb")&&!this.ignoreServiceObb?G.obb:null;G=new f.NodeBase(`${G.id}`,G.mbs);G.serviceObb=L;G.visibilityObb=this._computeVisibilityObb(G);return G};F=Array.isArray(B.children)?B.children.map(F).filter(G=>null!=G):null;return{id:p,mbs:B.mbs,obb:D,children:F,resources:{hasFeatureData:B.featureData&&0<B.featureData.length,hasSharedResource:null!=B.sharedResource,attributes:B.attributeData?p:null,texture:B.textureData&&0<B.textureData.length?p:null,
geometry:null!=B.geometryData?p:null},version:"string"===typeof B.version?B.version:null,lodSelection:Array.isArray(B.lodSelection)?B.lodSelection:null,numFeatures:C}};A.resetFailedNodes=function(){this._failedNodes.clear();this._failedPages.clear();this._forAllNodes(p=>{c.isSome(p.node)&&(p.node.failed=!1)})};A._entryPriority=function(p){var B=this._getNodeInternal(p),D=this.getParentIndex(p);if(c.isNone(B)||0>D&&null==B.node)return 0>D?Infinity:this._entryPriority(D);let C=0;B.node&&0<=D&&(D=this._nodeTraversalState.get(D),
null!=D&&(C=D.lodLevel));for(D=this.progressiveLoadPenalty;0<=p;p=this.getParentIndex(p))if(this._isLoaded(p)){D=0;break}B=c.isSome(B.ref)?this.viewportQueries.distToPOI(B.ref):c.isSome(B.node)?this.viewportQueries.distToPOI(B.node):0;return-B-C*(B+this.progressiveLoadPenalty)+D};A.traverseVisible=function(p){const B=this._getNodeInternal(this.rootIndex);c.isNone(B)?p(this.rootIndex,null,null):this._traverseVisible(this.rootIndex,-1,B,p)};A._traverseVisible=function(p,B,D,C){if(D.node&&0===D.childCount)this.isGeometryVisible(p)&&
C(p,D,B);else if(this.isNodeVisible(p)&&(C(p,D,B),null!=D.node&&(B=this.nodeTraversalState(D.node),!B.nodeHasLOD||B.lodLevel!==this._maxLodLevel))){B=c.unwrap(this._getPage(p));for(let F=0;F<D.childCount;F++){const G=B.children[D.childOffset+F],L=this._getNodeInternal(G);c.isSome(L)?this._traverseVisible(G,p,L,C):C(G,null,p)}}};A.traverse=function(p,B){B(p)&&this.traverseChildren(p,B)};A.traverseChildren=function(p,B){p=p.index;const D=this._getNodeInternal(p);c.isSome(D)&&this._traverseChildren(p,
D,B)};A._traverseChildren=function(p,B,D){p=this._getPage(p);if(!c.isNone(p)){var C=B.childOffset+B.childCount;for(B=B.childOffset;B<C;++B){const F=p.children[B],G=this._getNodeInternal(F);c.isSome(G)&&c.isSome(G.node)&&D(G.node)&&this._traverseChildren(F,G,D)}}};A.updateStats=function(p){0<this._updates.add.length&&(p.nodes+=" + "+this._updates.add.length);if(this._indexMissing||0<this._prefetch.length)p.index+=" + "+this._indexMissing||this._prefetch.length;p.prio=this._maxProcessingPrio;if(this._featureEstimate.estimate){const B=
this._featureEstimate.estimate-p.features;0<B?p.features+=" + "+B:0>B&&(p.features+=" - "+-B)}};A.getPriority=function(){return Math.max(this._maxProcessingPrio,this._maxUnloadedPrio)};A.updateElevationInfo=function(p){this._forAllNodes(e);this.viewportQueries.updateElevationInfo(p)};A._forAllNodes=function(p){for(let B=0;B<this._nodePages.length;B++){const D=this._nodePages[B];if(D){const C=B*this.nodesPerPage;for(let F=0;F<D.nodes.length;F++)p(D.nodes[F],C+F)}}};b._createClass(y,[{key:"rootNode",
get:function(){return this.getNode(this.rootIndex)}},{key:"size",get:function(){return this.nodeCount}},{key:"maxLevel",get:function(){return this._maxLevel}},{key:"dirty",get:function(){return this._dirty}},{key:"updates",get:function(){return this._updates}},{key:"featureEstimate",get:function(){return this._featureEstimate}},{key:"test",get:function(){return{addNode:(p,B)=>this._addNode(p,B)}}}]);return y}();const r=new Map;let x=function(){function y(A){this.missing=A;this.update=new g({deallocator:null});
this.add=new g({deallocator:null});this.remove=new g({deallocator:null});this.cancel=[]}y.prototype.reset=function(A){this.add.clear();this.update.clear();this.cancel=A};return y}();const u=[["maxScreenThreshold",f.LodMetric.MaxScreenThreshold],["screenSpaceRelative",f.LodMetric.ScreenSpaceRelative],["removedFeatureDiameter",f.LodMetric.RemovedFeatureDiameter],["distanceRangeFromDefaultCamera",f.LodMetric.DistanceRangeFromDefaultCamera]];let E=function(){this.unremoved=this.missingNodes=this.missing=
this.knownNodes=this.known=0};a.I3SIndex=t;a.selectErrorMetric=z;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SNode":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec4f64"],function(a,b,c){let g=function(w,n){this.id=w;this.mbs=n;this.renderMbs=c.fromArray([0,0,0,-1]);this.imModificationImpact=a.NodeIMModificationImpact.NotChecked};a.NodeFilterImpact=void 0;(function(w){w[w.Unmodified=0]="Unmodified";w[w.Culled=1]=
"Culled";w[w.NotChecked=2]="NotChecked"})(a.NodeFilterImpact||(a.NodeFilterImpact={}));a.NodeIMModificationImpact=void 0;(function(w){w[w.Unmodified=0]="Unmodified";w[w.PotentiallyModified=1]="PotentiallyModified";w[w.Culled=2]="Culled";w[w.Unknown=3]="Unknown";w[w.NotChecked=4]="NotChecked"})(a.NodeIMModificationImpact||(a.NodeIMModificationImpact={}));let h=function(w){function n(f,l,k,e,d,m,z,v,q,t){f=w.call(this,f,k)||this;f.index=l;f.childCount=e;f.level=d;f.resources=m;f.version=z;f.lodMetric=
v;f.maxError=q;f.numFeatures=t;f.failed=!1;f.hasModifications=!1;f.cacheState=a.CacheState.Unknown;f.vertexCount=0;f.memory=0;return f}b._inheritsLoose(n,w);return n}(g);a.CacheState=void 0;(function(w){w[w.Unknown=0]="Unknown";w[w.Uncached=1]="Uncached";w[w.Cached=2]="Cached"})(a.CacheState||(a.CacheState={}));a.LodMetric=void 0;(function(w){w[w.None=0]="None";w[w.MaxScreenThreshold=1]="MaxScreenThreshold";w[w.ScreenSpaceRelative=2]="ScreenSpaceRelative";w[w.RemovedFeatureDiameter=3]="RemovedFeatureDiameter";
w[w.DistanceRangeFromDefaultCamera=4]="DistanceRangeFromDefaultCamera"})(a.LodMetric||(a.LodMetric={}));a.NodeState=void 0;(function(w){w[w.Hole=0]="Hole";w[w.Leaf=1]="Leaf"})(a.NodeState||(a.NodeState={}));a.Node=h;a.NodeBase=g;a.NodeTraversalState=function(w,n,f,l){this.nodeHasLOD=w;this.isChosen=n;this.lodLevel=f;this.version=l};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SLodHandling":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe",
"../../../../core/PooledArray","./I3SNode","../support/I3SLayerView"],function(a,b,c,g,h){let w=function(){function f(k){this.layerView=k;this._lodGlobalDirty=!1}var l=f.prototype;l.startNodeLoading=function(k,e,d,m){this._maxLodLevel=m.maxLodLevel;this._index=d;this._isNodeInScaleBounds=k;this._removeNodes=e};l.shouldLoadNode=function(k){if(b.isNone(k))return!1;const e=this._index.nodeTraversalState(k);return this._isChosenMaxLOD(e)?!0:e.isChosen?this._childrenRequireLoading(k):!1};l.setLodGlobalDirty=
function(){this._lodGlobalDirty=!0};l.lodGlobalHandling=function(k){if(!this.requiresLODGlobalHandling)return!1;this._lodGlobalDirty=!1;var e=Math.max(0,Math.floor(10*(this.layerView.view.resourceController.memoryController.usedMemory-1)));n.clear();this._lodGlobalHandling(this._index.rootNode,e,!1);e=n.length;this._removeNodes(n,k);k=n.length<e;0!==n.length&&(this._lodGlobalDirty=!0);n.clear();return k};l._lodGlobalHandling=function(k,e,d){if(b.isNone(k))return!1;const m=k.index,z=this._index,v=
this.layerView;var q=z.nodeTraversalState(k);const t=this._isChosenMaxLOD(q);q=v.isNodeLoaded(m);const r=v.nodeCrossfadingEnabled;if(r&&q&&t){var x=!d&&this.hasNoVisibleChildren(k);v.fadeNode(m,h.FadeDirection.FadeIn,!x)}x=q&&(!v.isNodeFullyFadedIn||v.isNodeFullyFadedIn(m));if(q&&(v.updateNodeState(m,t?g.NodeState.Leaf:g.NodeState.Hole),t))return x&&this._removeChildrenRecursive(k),x;var u=0<k.childCount;let E=u;if(u)for(u=0;u<k.childCount;u++){const y=z.getChildIndex(k,u),A=z.getNode(y);b.isSome(A)?
z.isGeometryVisible(y)&&!this._lodGlobalHandling(A,e,d||x)&&this._isNodeInScaleBounds(A)&&(E=!1):z.isNodeVisible(y)&&(E=!1)}(e=q&&!t&&(E||n.length<e))&&n.push(m);!r||e||!q||d||E||v.fadeNode(m,h.FadeDirection.FadeIn,!1);k=!k.resources.hasFeatureData;return E||x&&!e||k};l._removeChildrenRecursive=function(k){this._index.traverseChildren(k,e=>{(this.layerView.isNodeLoaded(e.index)||this.layerView.isNodeReloading(e.index))&&n.push(e.index);return!0})};l.hasNoVisibleChildren=function(k){let e=!0;this._index.traverseChildren(k,
d=>e&&this._index.isNodeVisible(d.index)?this.layerView.isNodeLoaded(d.index)?e=!1:!0:!1);return e};l._childrenRequireLoading=function(k){let e=!1,d=!0;this._index.traverseChildren(k,m=>{if(!d||!this._index.isNodeVisible(m.index))return!1;const z=this._index.nodeTraversalState(m);this._isChosenMaxLOD(z)&&this._index.isGeometryVisible(m.index)&&(e=!0);return this.layerView.isNodeLoaded(m.index)?d=!1:!0});return d&&e};l._isChosenMaxLOD=function(k){return k.isChosen&&(!k.nodeHasLOD||k.lodLevel===this._maxLodLevel)};
a._createClass(f,[{key:"requiresLODGlobalHandling",get:function(){return null!=this._index&&!0===this._lodGlobalDirty}}]);return f}();const n=new c({deallocator:null});return w})},"esri/views/3d/layers/support/I3SLayerView":function(){define(["exports"],function(a){a.FadeDirection=void 0;var b=a.FadeDirection||(a.FadeDirection={});b[b.FadeIn=0]="FadeIn";b[b.FadeOut=1]="FadeOut";Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SNodeLoader":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/has ../../../../core/lang ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/urlUtils ./enums ./I3SBinaryReader ./I3SMaterialUtil".split(" "),
function(a,b,c,g,h,w,n,f,l,k){return function(){function e(m,z,v,q,t,r){this.streamDataController=z;this.logger=v;this.defaultGeometrySchema=q;this.requiredAttributes=t;this.options=r;this.logLayer=m;this.layerUrl=m.parsedUrl.path;this.geometryDefinitions=m.geometryDefinitions;if(m.materialDefinitions){const x=m.textureSetDefinitions;this.materialAndTextures=m.materialDefinitions.map(u=>k.getMaterialAndTextures(x,u))}}var d=e.prototype;d._load=function(m,z,v){return this.streamDataController.request(m,
z,v)};d._loadAttribute=function(m,z,v){return this._load(`${this.layerUrl}/nodes/${m.resources.attributes}/attributes/${z.key}/0`,"binary",v).then(q=>l.readBinaryAttribute(z,q))};d.loadAttributes=function(m,z,v){return w.eachAlways(z.map(q=>this._loadAttribute(m,q.attributeStorageInfo,v))).then(q=>{const t={};for(let r=0;r<z.length;++r)if(q[r].value)t[z[r].name]=q[r].value;else{if(w.isAbortError(q[r].error))throw q[r].error;this.logger.error("#loadAttributes",this.logLayer,`Failed to load attributeData for '${z[r].name}' on node '${m.id}'`,
q[r].error)}return t})};d.loadNodeData=function(){var m=a._asyncToGenerator(function*(z,v){var q=null!=this.requiredAttributes&&z.resources.attributes?b.result(this.loadAttributes(z,this.requiredAttributes,v)):null;var t=this.geometryDefinitions;var r={bufferDefinition:null,bufferIndex:0};if(!(null==t||0>z.resources.geometryDefinition)&&(t=0<=z.resources.geometryDefinition?t[z.resources.geometryDefinition].geometryBuffers:null,null!=t))for(var x=0;x<t.length;x++){var u=t[x];if(null!=u.compressedAttributes){if("draco"===
u.compressedAttributes.encoding&&!c("disable-feature:i3s-draco")){r.bufferIndex=x;r.bufferDefinition=u;break}}else r.bufferIndex=x,r.bufferDefinition=t[x]}const {bufferDefinition:E,bufferIndex:y}=r;x=(u=!!z.resources.geometry)?b.result(this._loadGeometry(z.resources.geometry,y,v)):null;t=z.resources.hasSharedResource?yield this._loadShared(z,v):null;var A=(r=this.materialAndTextures&&0<=z.resources.materialDefinition?this.materialAndTextures[z.resources.materialDefinition]:null!=t?k.getMaterialAndTexturesFromShared(t):
null)&&r.material;r=r&&r.textures;const p=`${z.id}`,B=!u&&this.options.loadFeatureData;u=B?yield this._loadFeatureData(p,v):null;if(B)a:{for(C of u.featureData)if(A=C.geometries,null!=A)for(var D of A){var C={featureIds:[C.id],featureDataPosition:C.position,geometries:[D]};break a}C=null}else C={featureIds:[],geometries:[{type:"ArrayBufferView",params:{material:A}}],featureDataPosition:[0,0,0]};if(D=h.isNone(C)){D=[];for(var F of u.featureData)null!=F.position&&D.push({featureIds:[F.id],featureDataPosition:F.position,
geometries:null})}F=D;D=null!=r&&0<r.length?b.result(this.loadTextures(z,r,v)):null;v=z=null;x&&(z=b.assertResult(yield x),(v=this.defaultGeometrySchema)&&t&&t.materialDefinitions&&(x=Object.keys(t.materialDefinitions)[0],!t.materialDefinitions[x].params.vertexRegions&&v.vertexAttributes.region&&(v=g.clone(v),delete v.vertexAttributes.region)),v=l.createGeometryDescriptor(E,v));t=D?b.assertResult(yield D):null;q=(q=q?b.assertResult(yield q):{})?{attributeData:q,loadedAttributes:this.requiredAttributes}:
null;return h.isSome(C)?{geometryData:C,attributeDataInfo:q,geometryBuffer:z,geometryDescriptor:v,requiredTextures:r,textureData:t}:h.isSome(F)?{pointData:F,attributeDataInfo:q,geometryBuffer:z,geometryDescriptor:v,requiredTextures:r,textureData:t}:Promise.reject()});return function(z,v){return m.apply(this,arguments)}}();e._addAbsoluteHrefTexture=function(m,z){m=m.textureDefinitions;if(null!=m)for(const v of Object.keys(m))for(const q of m[v].images)Array.isArray(q.href)?q.hrefConcat=q.href.map(t=>
n.makeAbsolute(t,z)):q.hrefConcat=n.makeAbsolute(q.href,z)};e._fixTextureEncodings=function(m){m=m.textureDefinitions;if(null!=m)for(const v in m){const q=m[v];if(Array.isArray(q.encoding))for(var z=0;z<q.encoding.length;z++){const t=q.encoding[z];"data:"===t.substring(0,5)&&(q.encoding[z]=t.substring(5))}else z=q.encoding,"data:"===z.substring(0,5)&&(q.encoding=z.substring(5))}};d._loadShared=function(m,z){const v=`${this.layerUrl}/nodes/${m.resources.geometry}/shared`;return this._load(v,"json",
z).then(q=>{e._fixTextureEncodings(q);e._addAbsoluteHrefTexture(q,v);return q})};d._loadTexture=function(m,z,v,q,t,r){let x=!1;return t===f.TextureEncoding.DDS_S3TC||t===f.TextureEncoding.KTX2||t===f.TextureEncoding.Basis?this._load(m,"binary",r).then(u=>({id:z,usage:v,data:u,encoding:t,downsampled:x})):this._load(m,"image",r).then(u=>{var E=u;if(q&&4096<=u.width*u.height){E=Math.ceil(u.width/2);const y=Math.ceil(u.height/2),A=document.createElement("canvas");A.width=E;A.height=y;A.getContext("2d").drawImage(u,
0,0,E,y);E=A;x=!0}return{id:z,usage:v,data:E,encoding:t,downsampled:x}})};d.loadTextures=function(m,z,v){const q=this.options.uncompressedTextureDownsamplingEnabled,t=this.options.textureUsageMask;return Promise.all(z.map(r=>{if(0===(r.usage&t))return null;const x=k.selectEncoding(r.encodings,this.options.textureEncodings);return null==x?(this.logger.error("#loadTextures",this.logLayer,`No known encoding for texture found on node ${m.id}`),Promise.reject()):this._loadTexture(`${this.layerUrl}/nodes/${m.resources.texture||
m.id}/textures/${x.name}`,r.id,r.usage,q,x.encoding,v)}))};d._loadFeatureData=function(m,z){return this._load(`${this.layerUrl}/nodes/${m}/features/0`,"json",z)};d._loadGeometry=function(m,z,v){return this._load(`${this.layerUrl}/nodes/${m}/geometries/${z}`,"binary",v)};return e}()})},"esri/views/3d/layers/i3s/enums":function(){define(["exports"],function(a){a.TextureEncoding=void 0;(function(b){b[b.KTX2=1]="KTX2";b[b.Basis=2]="Basis";b[b.DDS_S3TC=4]="DDS_S3TC";b[b.PNG=8]="PNG";b[b.JPG=16]="JPG";
b[b.KTX_ETC2=32]="KTX_ETC2"})(a.TextureEncoding||(a.TextureEncoding={}));a.TextureUsage=void 0;(function(b){b[b.None=0]="None";b[b.Color=1]="Color";b[b.MetallicRoughness=2]="MetallicRoughness";b[b.Normal=4]="Normal";b[b.Occlusion=8]="Occlusion";b[b.Emissive=16]="Emissive";b[b.AlphaMask=32]="AlphaMask";b[b.ColorTextures=19]="ColorTextures";b[b.GeometryTextures=36]="GeometryTextures";b[b.GeometryTexturesPBR=44]="GeometryTexturesPBR";b[b.AllTextures=37]="AllTextures";b[b.AllTexturesPBR=63]="AllTexturesPBR"})(a.TextureUsage||
(a.TextureUsage={}));Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SMaterialUtil":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../core/maybe ./enums ../../webgl-engine/core/material/RenderTexture ../../webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../../webgl-engine/core/shaderLibrary/util/EllipsoidMode ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Texture ../../../webgl/enums".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d){function m(E){return E.sort((y,A)=>y.encoding-A.encoding)}function z(E,y,A){if(g.isNone(E)||A===h.TextureUsage.None)return null;for(let p=0;p<E.length;p++){const B=E[p];if(g.isSome(B)&&0!==(B.usage&A))return E=y[p],g.isSome(E)?E.id:null}return null}function v(E){switch(E){case h.TextureEncoding.KTX2:return e.Texture.KTX2_ENCODING;case h.TextureEncoding.Basis:return e.Texture.BASIS_ENCODING;case h.TextureEncoding.DDS_S3TC:return e.Texture.DDS_ENCODING;case h.TextureEncoding.PNG:return"image/png";
case h.TextureEncoding.JPG:return"image/jpeg";case h.TextureEncoding.KTX_ETC2:return"image/ktx";default:return""}}const q={ktx2:h.TextureEncoding.KTX2,basis:h.TextureEncoding.Basis,dds:h.TextureEncoding.DDS_S3TC,png:h.TextureEncoding.PNG,jpg:h.TextureEncoding.JPG,"ktx-etc2":h.TextureEncoding.KTX_ETC2},t={[e.Texture.KTX2_ENCODING]:h.TextureEncoding.Basis,[e.Texture.BASIS_ENCODING]:h.TextureEncoding.Basis,[e.Texture.DDS_ENCODING]:h.TextureEncoding.DDS_S3TC,"image/png":h.TextureEncoding.PNG,"image/jpg":h.TextureEncoding.JPG,
"image/jpeg":h.TextureEncoding.JPG,"image/ktx":h.TextureEncoding.KTX_ETC2},r=()=>({alphaMode:"opaque",alphaCutoff:f.defaultMaskAlphaCutoff,doubleSided:!0,cullFace:k.CullFaceOptions.None,normalTextureId:-1,emissiveTextureId:-1,occlusionTextureId:-1,emissiveFactor:[0,0,0],metallicRoughness:{baseColorFactor:[.8,.8,.8,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,metallicFactor:0,roughnessFactor:.6},wrapTextures:!1,hasParametersFromSource:!0}),x={s:d.TextureWrapMode.CLAMP_TO_EDGE,t:d.TextureWrapMode.CLAMP_TO_EDGE},
u={s:d.TextureWrapMode.REPEAT,t:d.TextureWrapMode.REPEAT};a.configureMaterial=function(E,y,A,p,B,D){const C=D.rendererTextureUsage;var F=y.metallicRoughness.baseColorFactor,G=c.clamp(y.metallicRoughness.baseColorFactor[3],0,1);E.baseColor=[F[0],F[1],F[2],G];E.hasParametersFromSource=!!y.hasParametersFromSource;E.usePBR=D.usePBR;E.mrrFactors=[y.metallicRoughness.metallicFactor,y.metallicRoughness.roughnessFactor,y.hasParametersFromSource?.2:.5];E.emissiveFactor=y.emissiveFactor;E.isIntegratedMesh=
D.isIntegratedMesh;E.alphaCutoff="mask"===y.alphaMode?y.alphaCutoff:f.defaultMaskAlphaCutoff;E.alphaDiscardMode="opaque"===y.alphaMode?k.AlphaDiscardMode.Opaque:"mask"===y.alphaMode?k.AlphaDiscardMode.Mask:k.AlphaDiscardMode.MaskBlend;F=[];G=z(p,A,(h.TextureUsage.Color|h.TextureUsage.AlphaMask)&C);g.isSome(G)&&(E.baseColorTexture=new w.RenderTexture(B,G),F.push(E.baseColorTexture.loadPromise));G=z(p,A,h.TextureUsage.MetallicRoughness&C);g.isSome(G)&&(E.metallicRoughnessTexture=new w.RenderTexture(B,
G),F.push(E.metallicRoughnessTexture.loadPromise));G=z(p,A,h.TextureUsage.Emissive&C);g.isSome(G)&&(E.emissionTexture=new w.RenderTexture(B,G),F.push(E.emissionTexture.loadPromise));G=z(p,A,h.TextureUsage.Occlusion&C);g.isSome(G)&&(E.occlusionTexture=new w.RenderTexture(B,G),F.push(E.occlusionTexture.loadPromise));A=z(p,A,h.TextureUsage.Normal&C);g.isSome(A)&&(E.normalTexture=new w.RenderTexture(B,A),F.push(E.normalTexture.loadPromise));E.commonMaterialParameters.slicePlaneEnabled=D.slicePlaneEnabled;
E.commonMaterialParameters.doubleSided=y.doubleSided;E.commonMaterialParameters.cullFace=y.cullFace;E.ellipsoidMode=l.getEllipsoidMode(D.viewSpatialReference);return Promise.all(F)};a.createTexture=function(E,y,A,p){if(g.isNone(E)||null==E.data)return null;const B=E.data;var D=!(B instanceof HTMLImageElement)||c.isPowerOfTwo(B.width)&&c.isPowerOfTwo(B.height),C=p.renderingContext.parameters.maxMaxAnisotropy;p=A&&!p.capabilities.shaderTextureLOD?1:C;D=D&&!E.downsampled&&1<p;A=A||!y.wrapTextures?x:
u;C=v(E.encoding);return new e.Texture(B,{mipmap:D,maxAnisotropy:p,encoding:C,wrap:A,components:E.usage&h.TextureUsage.Color?"opaque"===y.alphaMode?3:4:3,noUnpackFlip:!0})};a.defaultMaterial=r;a.getMaterialAndTextures=function(E,y){const A=new Map,p=(M,K)=>{if(g.isNone(M))return-1;if(A.has(M.id))return M=A.get(M.id),M.usage|=K,M.id;const I=A.size;A.set(M.id,{id:I,usage:K});return I};var B=y.pbrMetallicRoughness;const D=B&&B.baseColorFactor,C=y.emissiveFactor,F=null==y.normalTexture&&null==y.emissiveTexture&&
null==y.occlusionTexture&&(B?null==B.metallicRoughnessTexture&&1===B.roughnessFactor&&(1===B.metallicFactor||0===B.metallicFactor):!0),G=F?n.PBRSchematicMRRValues[0]:B?B.metallicFactor:1,L=F?n.PBRSchematicMRRValues[1]:B?B.roughnessFactor:1;B={baseColorFactor:D?[D[0],D[1],D[2],D[3]]:[1,1,1,1],baseColorTextureId:p(B&&B.baseColorTexture,"mask"===y.alphaMode?h.TextureUsage.Color|h.TextureUsage.AlphaMask:h.TextureUsage.Color),metallicRoughnessTextureId:p(B&&B.metallicRoughnessTexture,h.TextureUsage.MetallicRoughness),
metallicFactor:G,roughnessFactor:L};y={alphaMode:y.alphaMode,alphaCutoff:y.alphaCutoff,doubleSided:y.doubleSided,cullFace:"none"===y.cullFace?k.CullFaceOptions.None:"back"===y.cullFace?k.CullFaceOptions.Back:"front"===y.cullFace?k.CullFaceOptions.Front:void 0,normalTextureId:p(y.normalTexture,h.TextureUsage.Normal),emissiveTextureId:p(y.emissiveTexture,h.TextureUsage.Emissive),occlusionTextureId:p(y.occlusionTexture,h.TextureUsage.Occlusion),emissiveFactor:C?[C[0],C[1],C[2]]:[0,0,0],metallicRoughness:B,
wrapTextures:!1,hasParametersFromSource:F};const H=[];A.forEach(({usage:M},K)=>{var I=g.isSome(E)&&E[K]&&E[K].formats;I=I?m(I.map(({name:O,format:Q})=>({name:O,encoding:q[Q]}))):[];H.push({id:K,usage:M,encodings:I})});return{material:y,textures:H}};a.getMaterialAndTexturesFromShared=function(E){var y=E&&E.materialDefinitions?Object.keys(E.materialDefinitions)[0]:null,A=E&&E.textureDefinitions?Object.keys(E.textureDefinitions)[0]:null;y=y&&E.materialDefinitions[y];A=A&&E.textureDefinitions[A];E=r();
if(null!=y){y=y.params;y.diffuse&&(E.metallicRoughness.baseColorFactor=[y.diffuse[0],y.diffuse[1],y.diffuse[2],1]);null!=y.doubleSided&&(E.doubleSided=y.doubleSided,E.cullFace=y.doubleSided?k.CullFaceOptions.None:k.CullFaceOptions.Back);if("none"===y.cullFace||"front"===y.cullFace||"back"===y.cullFace)E.cullFace="none"===y.cullFace?k.CullFaceOptions.None:"back"===y.cullFace?k.CullFaceOptions.Back:k.CullFaceOptions.Front;y.transparency&&(E.metallicRoughness.baseColorFactor[3]=c.clamp(1-y.transparency,
0,1));if(y.useVertexColorAlpha||1>E.metallicRoughness.baseColorFactor[3])E.alphaMode="blend"}y=[];if(null!=A){!A.wrap||"repeat"!==A.wrap[0]&&"repeat"!==A.wrap[1]||(E.wrapTextures=!0);let p=h.TextureUsage.Color;"rgba"===A.channels&&(E.alphaMode="blend",p|=h.TextureUsage.AlphaMask);const B=A.images[A.images.length-1],D=C=>C&&C.split("/").pop();A=Array.isArray(A.encoding)?m(A.encoding.map((C,F)=>({name:D(B.href[F]),encoding:t[C]||0}))):[{name:D(B.href),encoding:t[A.encoding]||0}];y.push({id:0,usage:p,
encodings:A});E.metallicRoughness.baseColorTextureId=0}return{material:E,textures:y}};a.getSupportedEncodings=function(E){const y=!!E.compressedTextureS3TC;E=!!E.compressedTextureETC;const A=b("disable-feature:i3s-basis")?0:h.TextureEncoding.Basis|h.TextureEncoding.KTX2,p=A|h.TextureEncoding.DDS_S3TC;return h.TextureEncoding.JPG|h.TextureEncoding.PNG|(y?p:0)|(E?A:0)};a.selectEncoding=function(E,y){return E.find(A=>0!==(A.encoding&y))};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/material/RenderTexture":function(){define(["exports",
"../../../../../core/maybe","../../../../../core/promiseUtils"],function(a,b,c){let g=function(){function h(n,f){this._textureRep=n;this._disposed=!1;n=this._textureRep.acquire(f);c.isPromiseLike(n)?(n.then(l=>{this._disposed?b.releaseMaybe(l):this._textureRef=l}),this.loadPromise=n):this._textureRef=n}var w=h.prototype;w.dispose=function(){this._textureRef=b.releaseMaybe(this._textureRef);this._disposed=!0};w.bind=function(n,f,l){const k=b.isSome(this._textureRef)?this._textureRef.glTexture:null;
b.isSome(k)&&(n.bindTexture(k,f),n.setUniform2f(l,k.descriptor.width,k.descriptor.height))};return h}();a.RenderTexture=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SStreamDataController":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/promiseUtils"],function(a,b,c){let g=function(){function h(n,f){this.requester=n;this.apiKey=f;this.activeRequests=new Set}var w=h.prototype;w.request=function(n,f,l){const k=new AbortController;
l=c.onAbortOrThrow(l,()=>k.abort());n=this.requester.request(n,f,{signal:k.signal,query:{token:this.apiKey}});const e={response:n,abortController:k,abortHandle:l};this.activeRequests.add(e);c.always(n,()=>{var d;e.abortController=null;null==(d=e.abortHandle)?void 0:d.remove();e.abortHandle=null;this.activeRequests.delete(e)});return n};w.cancelAll=function(){this.activeRequests.forEach(n=>{var f,l;null==(f=n.abortController)?void 0:f.abort();n.abortController=null;null==(l=n.abortHandle)?void 0:l.remove()});
this.activeRequests.clear()};b._createClass(h,[{key:"busy",get:function(){return this.requester.busy}}]);return h}();a.I3SStreamDataController=g;a.default=g;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SViewportQueries":function(){define("../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/support/frustum ../../../../chunks/sphere ../../../../layers/graphics/dehydratedFeatures ../graphics/elevationAlignmentUtils ../graphics/ElevationContext ../graphics/featureExpressionInfoUtils ./I3SNode ./I3SUtil ../../support/orientedBoundingBox".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v){return function(){function q(r,x,u,E,y,A,p,B={}){this._indexSR=r;this._renderCoordsHelper=x;this.clippingArea=y;this._elevationProvider=A;this._options=B;this._frustum=n.create();this._useFrustumCulling=!1;this._poi=c.create();this.minDistance=Infinity;this.maxDistance=0;this.maxLodLevel=2;this._tmp1=c.create();this._tmp2=c.create();this._tmp3=c.create();this._tmp0=c.create();this._screenspaceErrorBias=B.screenspaceErrorBias||1;this._progressiveLoadFactor=B.progressiveLoadFactor||
1;this.updateCamera(u,E);this.engineSR=this._renderCoordsHelper.spatialReference;this.updateElevationInfo(p);this._tmpPoint=l.makeDehydratedPoint(0,0,0,r)}var t=q.prototype;t.updateElevationInfo=function(r){null==r?this._elevationContext=null:(this._elevationContext=e.ElevationContext.fromElevationInfo(r),this._elevationContext.updateFeatureExpressionInfoContext(d.createContextWithoutExpressionSupport(d.extractExpressionInfo(r,!1))))};t.updateCamera=function(r,x){(this._useFrustumCulling=x)&&n.fromMatrix(r.viewMatrix,
r.projectionMatrix,this._frustum);this._screenSizeFactor=1/(r.perScreenPixelRatio/2);this._camPos=r.eye;this.minDistance=Infinity;this.maxDistance=0};t.setPointOfInterest=function(r){this._poi=r};t.updateScreenSpaceErrorBias=function(r){const x=this._screenspaceErrorBias;this._screenspaceErrorBias=r;return x};t.updateClippingArea=function(r){this.clippingArea=r};t.getRenderMbs=function(r){const x=r.renderMbs;0>x[3]&&(g.copy(x,r.mbs),this._elevationContext&&1E5>x[3]&&(this._tmpPoint.x=x[0],this._tmpPoint.y=
x[1],this._tmpPoint.z=x[2],x[2]=k.evaluateElevationAlignmentAtPoint(this._tmpPoint,this._elevationProvider,this._elevationContext,this._renderCoordsHelper)),h.projectBoundingSphere(x,this._indexSR,x,this.engineSR));return x};t.getVisibilityObb=function(r){if(a.isSome(r.visibilityObb))return r.visibilityObb;const x=r.serviceObb;if(!(a.isNone(x)||0>x.halfSize[0]))return r.serviceObbInRenderSR=this._computeRenderObb(x,r.serviceObbInRenderSR,r.mbs[3]),r.serviceObbInRenderSR};t._computeRenderObb=function(r,
x,u){a.isNone(x)&&(x=v.create());if(0>x.halfSize[0]){let E=0;this._elevationContext&&1E5>u&&(this._tmpPoint.x=r.center[0],this._tmpPoint.y=r.center[1],this._tmpPoint.z=r.center[2],E=k.evaluateElevationAlignmentAtPoint(this._tmpPoint,this._elevationProvider,this._elevationContext,this._renderCoordsHelper)-r.center[2]);z.transformObb(r,this._indexSR,x,this.engineSR,E)}return x};t.isNodeVisible=function(r){const x=this.getRenderMbs(r);if(!this._isMBSinClippingArea(x))return!1;if(!this._useFrustumCulling)return!0;
r=this.getVisibilityObb(r);return a.isSome(r)?v.isVisible(r,this._frustum):n.intersectsSphere(this._frustum,f.wrap(x))};t.isGeometryVisible=function(r){if(!this._useFrustumCulling)return!0;const x=r.geometryObb;return a.isSome(x)?v.isVisible(x,this._frustum):this.isNodeVisible(r)};t._isMBSinClippingArea=function(r){return a.isNone(this.clippingArea)?!0:z.intersectBoundingRectWithMbs(this.clippingArea,r)!==z.MbsIntersectResult.OUTSIDE};t._screenSpaceDiameterMbs=function(r,x){var u=this.getRenderMbs(r);
r=Math.sqrt(b.squaredDistance(u,this._camPos));u=r-u[3];this._updateMinMaxDistance(r);return 0>u?.5*Number.MAX_VALUE:x/u*this._screenSizeFactor};t.calcCameraDistance=function(r){return this.calcCameraDistanceToCenter(r)-this.getRenderMbs(r)[3]};t.calcCameraDistanceToCenter=function(r){r=this.getRenderMbs(r);r=b.distance(r,this._camPos);this._updateMinMaxDistance(r);return r};t.calcAngleDependentLoD=function(r){r=this.getRenderMbs(r);const x=r[3];r=(Math.abs(r[0]*(r[0]-this._camPos[0])+r[1]*(r[1]-
this._camPos[1])+r[2]*(r[2]-this._camPos[2]))/b.length(r)+x)/b.distance(r,this._camPos);return Math.min(1,r)};t.hasLOD=function(r){return r.lodMetric!==m.LodMetric.None};t._getDistancePlanarMode=function(r,x){var u=r[0]-x[0];const E=r[1]-x[1];r=r[2]-x[2];u=u*u+E*E;x=x[3];if(u<=x*x)return Math.abs(r);x=Math.sqrt(u)-x;return Math.sqrt(r*r+x*x)};t._getDistanceGlobeMode=function(r,x){var u=b.length(x);const E=b.length(r)-u;b.scale(this._tmp0,r,b.dot(r,x)/b.squaredLength(r));var y=b.squaredDistance(x,
this._tmp0),A=x[3];if(y<=A*A)return Math.abs(E);x=b.scale(this._tmp0,x,1/u);u=b.scale(this._tmp1,x,u-A*A/2/u);y=b.subtract(this._tmp2,r,u);y=b.subtract(this._tmp2,y,b.scale(this._tmp3,x,b.dot(x,y)));u=b.add(this._tmp2,u,b.scale(this._tmp2,y,A/b.length(y)));A=b.distance(r,u);2E5<=E&&(r=b.subtract(this._tmp1,r,u),r=b.dot(r,x)/b.length(r),.08>r&&(r=1E-4),A/=r);return A};t._getDistance=function(r,x){return this.engineSR===w.getSphericalPCPF(this.engineSR)?this._getDistanceGlobeMode(r,x):this._getDistancePlanarMode(r,
x)};t._updateMinMaxDistance=function(r){0<r?(this.minDistance=Math.min(this.minDistance,r),this.maxDistance=Math.max(this.maxDistance,r)):(this.minDistance=0,this.maxDistance=Math.max(this.maxDistance,-r))};t.getLodLevel=function(r){if(r.lodMetric===m.LodMetric.None)return 0;if(0===r.childCount)return this.maxLodLevel;if(this._useFrustumCulling&&1>this._progressiveLoadFactor){const x=this._screenspaceErrorBias;return this.evaluateLODmetric(r,this._progressiveLoadFactor*this._screenspaceErrorBias)?
this.evaluateLODmetric(r,x)?2:1:0}return this.evaluateLODmetric(r,this._screenspaceErrorBias)?this.maxLodLevel:0};t.evaluateLODmetric=function(r,x){switch(r.lodMetric){case m.LodMetric.ScreenSpaceRelative:{const u=this.getRenderMbs(r),E=this._getDistance(this._camPos,u),y=2*E/this._screenSizeFactor;this._updateMinMaxDistance(E+u[3]);return r.maxError*x<=y}case m.LodMetric.MaxScreenThreshold:return x=this._screenSpaceDiameterMbs(r,r.mbs[3]*x),this._options.angleDependentLoD&&(x*=this.calcAngleDependentLoD(r)),
x<r.maxError;case m.LodMetric.RemovedFeatureDiameter:return 10>this._screenSpaceDiameterMbs(r,r.maxError)*x;case m.LodMetric.DistanceRangeFromDefaultCamera:return this.calcCameraDistance(r)>r.maxError*x}return!1};t.distToPOI=function(r){r=this.getRenderMbs(r);return b.distance(r,this._poi)-r[3]};t.distCameraToPOI=function(){return b.distance(this._camPos,this._poi)};return q}()})},"esri/layers/support/SceneModification":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/JSONSupport ../../core/lang ../../core/Warning ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/decorators/persistable ../../geometry/projection ../../geometry/Polygon".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m){var z;c=z=function(v){function q(r){r=v.call(this,r)||this;r.geometry=null;r.type="clip";return r}a._inheritsLoose(q,v);var t=q.prototype;t.writeGeometry=function(r,x,u,E){if(E.layer&&E.layer.spatialReference&&!E.layer.spatialReference.equals(this.geometry.spatialReference)){if(!d.canProjectWithoutEngine(r.spatialReference,E.layer.spatialReference)){E&&E.messages&&E.messages.push(new w("scenemodification:unsupported","Scene modifications with incompatible spatial references are not supported",
{modification:this,spatialReference:E.layer.spatialReference,context:E}));return}const y=new m;d.projectPolygon(r,y,E.layer.spatialReference);x[u]=y.toJSON(E)}else x[u]=r.toJSON(E);delete x[u].spatialReference};t.clone=function(){return new z({geometry:h.clone(this.geometry),type:this.type})};return q}(g.JSONSupport);b.__decorate([n.property({type:m}),e.persistable()],c.prototype,"geometry",void 0);b.__decorate([k.writer(["web-scene","portal-item"],"geometry")],c.prototype,"writeGeometry",null);b.__decorate([n.property({type:["clip",
"mask","replace"],nonNullable:!0}),e.persistable()],c.prototype,"type",void 0);return c=z=b.__decorate([l.subclass("esri.layers.support.SceneModification")],c)})},"esri/core/accessorSupport/decorators/persistable":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../maybe ../../multiOriginJSONSupportUtils ../../urlUtils ../../uuid ../metadata ../PropertyOrigin ./property ../../../portal/support/resourceExtension ../../../chunks/persistableUrlUtils".split(" "),function(a,
b,c,g,h,w,n,f,l,k,e,d){function m(x,u,E){const y=f.getOwnPropertyMetadata(u,E);return{type:String,read:(A,p,B)=>{A=d.read(A,p,B);if(y.type===String)return A;if("function"===typeof y.type)return new y.type({url:A})},write:{writer(A,p,B,D){if(D&&D.resources){var C=g.isNone(A)?null:"string"===typeof A?A:A.url;C=C?d.toJSON(C,{...D,verifyItemRelativeUrls:D&&D.verifyItemRelativeUrls?{writtenUrls:D.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null},d.MarkKeep.NO):null;var F=y.type!==String&&(!h.isMultiOriginJSONMixin(this)||
D&&D.origin&&this.originIdOf(E)>l.nameToId(D.origin));if(D&&D.portalItem&&g.isSome(C)&&!w.isAbsolute(C))if(F){{F=D.portalItem.resourceFromPath(C);const G=q(A,C,D),L=e.getResourceContentExtension(G),H=w.getPathExtension(F.path);L!==H?z(this,E,A,C,p,B,D,x):(v(this,E,F,G,D.resources.toUpdate),p[B]=C)}}else D.resources.toKeep.push({resource:D.portalItem.resourceFromPath(C)}),p[B]=C;else D&&D.portalItem&&(g.isNone(C)||g.isSome(d.itemIdFromResourceUrl(C))||w.isBlobProtocol(C)||F)?z(this,E,A,C,p,B,D,x):
p[B]=C}else p[B]="string"===typeof A?d.toJSON(A,D):A.write({},D)}}}}function z(x,u,E,y,A,p,B,D){const C=n.generateUUID();E=q(E,y,B);const F=w.join(g.get(D,"prefix"),C);D=`${F}.${e.getResourceContentExtension(E)}`;const G=B.portalItem.resourceFromPath(D);w.isBlobProtocol(y)&&B.resources.pendingOperations.push(t(y).then(L=>{G.path=`${F}.${e.getResourceContentExtension(L)}`;A[p]=G.itemRelativeUrl}).catch(()=>{}));v(x,u,G,E,B.resources.toAdd);A[p]=G.itemRelativeUrl}function v(x,u,E,y,A){A.push({resource:E,
content:y,finish:p=>{"string"===typeof x[u]?x[u]=p.url:x[u].url=p.url}})}function q(x,u,E){return"string"===typeof x?{url:u}:new Blob([JSON.stringify(x.toJSON(E))],{type:"application/json"})}function t(x){return r.apply(this,arguments)}function r(){r=c._asyncToGenerator(function*(x){const u=(yield new Promise((E,y)=>a(["../../../request"],A=>E(Object.freeze({__proto__:null,default:A})),y))).default;({data:x}=yield u(x,{responseType:"blob"}));return x});return r.apply(this,arguments)}b.persistable=
function(x){const u=g.isSome(x)&&x.origins?x.origins:[void 0];return(E,y)=>{a:if(g.isSome(x)&&"resource"===x.type)var A=m(x,E,y);else{switch(g.isSome(x)&&x.type?x.type:"other"){case "other":A={read:!0,write:!0};break a;case "url":{const {read:p,write:B}=d.persistableUrlUtils;A={read:p,write:B};break a}}A=void 0}for(const p of u){const B=k.propertyJSONMeta(E,p,y);for(const D in A)B[D]=A[D]}}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/portal/support/resourceExtension":function(){define(["exports",
"../../core/urlUtils"],function(a,b){const c={},g=c["text/plain"],h={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"};for(const w in h)c[h[w]]=w;a.getResourceContentExtension=function(w){w instanceof Blob?w=w.type:(w=b.getPathExtension(w.url),w=h[w]||"text/plain");return c[w]||g};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/layers/I3SMeshViewLabeler":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../symbols ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/diffUtils ../../../chunks/vec3f64 ../../../layers/graphics/dehydratedFeatures ./graphics/Graphics3DCore ./graphics/Graphics3DScaleVisibility ./i3s/I3SGeometryUtil ../support/LimitGraphicsMap ../webgl-engine/lib/basicInterfaces ../../../symbols/PointSymbol3D".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E){g=function(p){function B(C){C=p.call(this,C)||this;C.loadedGraphics=new x.LimitGraphicsMap(5E4);C.slicePlaneEnabled=!1;C._renderingInfo={symbol:new E};C._handles=new w;C._graphicsByNode=new Map;C._scaleVisibility=null;return C}a._inheritsLoose(B,p);var D=B.prototype;D.initialize=function(){this._graphicsCore=new q.Graphics3DCore({owner:this,layer:this.layer,preferredUpdatePolicy:u.UpdatePolicy.ASYNC,elevationFeatureExpressionEnabled:!1,graphicSymbolSupported:!1,
getRenderingInfoWithoutRenderer:!0,hasZ:!0,hasM:!1});var C=this.view.basemapTerrain;this._scaleVisibility=new t({layerScaleEnabled:!1});this._scaleVisibility.setup(this,this.layer,(G,L,H)=>this._graphicsCore.spatialIndex.queryGraphicUIDsInExtent(G,L,H),this._graphicsCore,C);C=this.view.labeler.addGraphicsOwner(this._graphicsCore,this._scaleVisibility,{emptySymbolLabelSupported:!0,elevationInfoOverride:{mode:"absolute-height",offset:0},disablePlacement:{logEntityDescription:"3D Object Scene Layer features"}});
const F=this.view.deconflictor.addGraphicsOwner(this._graphicsCore);this._graphicsCore.setup({labeler:C,deconflictor:F,scaleVisibility:this._scaleVisibility}).then(()=>{this._graphicsCore.startCreateGraphics()}).catch(()=>{});this._handles.add([this.layer.watch("labelingInfo",(G,L)=>{m.diff(G,L)&&this._graphicsCore.updateLabelingInfo()})])};D.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);null!=this._scaleVisibility&&(this._scaleVisibility.destroy(),this._scaleVisibility=
null);null!=this._graphicsCore&&(this._graphicsCore.destroy(),this._graphicsCore=null);this.loadedGraphics.destroy();this.view=null};D.addNodeMeta=function(C,F){let G=0;const L=C.filteredIds,H=C.featureIds.map((M,K)=>{r.boundingBoxTop(K,this.collection,C.objectHandle,A);const I=v.makeDehydratedPoint(0,0,0,this.view.spatialReference);this.view.renderCoordsHelper.fromRenderCoords(A,I);K=F(K,C);let O=!1;n.isNone(L)?O=!0:G<L.length&&M===L[G]&&(O=!0,G++);return{objectId:M,uid:c.generateUID(),attributes:K,
visible:O,geometry:I}});this.loadedGraphics.addMany(H);this._graphicsByNode.set(C.node.index,H)};D.setNodeMetaAttributes=function(C,F){const G=this._graphicsByNode.get(C.node.index),L=Array(G.length);for(let H=0;H<G.length;H++){const M=G[H];M.attributes=F(H,C);L[H]=M.uid}this._graphicsCore.updateLabelingInfo(L)};D.applyFilterChange=function(C){var F=this._graphicsByNode.get(C.node.index);if(F)if(n.isNone(C.filteredIds))for(var G of F)G.visible||(G.visible=!0,y.graphic=G,y.property="visible",y.oldValue=
!1,y.newValue=!0,this._graphicsCore.graphicUpdateHandler(y));else{G=0;for(const L of F)F=L.visible,G<C.filteredIds.length&&L.objectId===C.filteredIds[G]?(L.visible=!0,G++):L.visible=!1,F!==L.visible&&(y.graphic=L,y.property="visible",y.oldValue=F,y.newValue=L.visible,this._graphicsCore.graphicUpdateHandler(y))}};D.removeNodeMeta=function(C){this.loadedGraphics.removeManyByObjectId(C.featureIds)};D.getRenderingInfo=function(){return this._renderingInfo};D.notifyGraphicGeometryChanged=function(){};
D.notifyGraphicVisibilityChanged=function(){};a._createClass(B,[{key:"updatePolicy",get:function(){return this._graphicsCore.effectiveUpdatePolicy}},{key:"usedMemory",get:function(){return this._graphicsCore.usedMemory}},{key:"unloadedMemoryEstimate",get:function(){return this._graphicsCore.unprocessedMemoryEstimate}},{key:"test",get:function(){return{graphicsCore:this._graphicsCore}}}]);return B}(h);b.__decorate([f.property()],g.prototype,"view",void 0);b.__decorate([f.property()],g.prototype,"layer",
void 0);b.__decorate([f.property()],g.prototype,"collection",void 0);b.__decorate([f.property()],g.prototype,"loadedGraphics",void 0);b.__decorate([f.property({aliasOf:"_graphicsCore.updating"})],g.prototype,"updating",void 0);b.__decorate([f.property()],g.prototype,"slicePlaneEnabled",void 0);b.__decorate([f.property()],g.prototype,"_graphicsCore",void 0);g=b.__decorate([d.subclass("esri.views.3d.layers.I3SMeshViewLabeler")],g);const y={graphic:null,property:null,oldValue:null,newValue:null},A=z.create();
return g})},"esri/views/3d/layers/i3s/I3SGeometryUtil":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox".split(" "),function(a,b,c,g,h,w){function n(k,e,d,m){k=e.getComponentAabb(d,k,f);e=e.getObjectTransform(d);for(d=0;8>d;++d)l[0]=d&1?k[0]:k[3],l[1]=d&2?k[1]:k[4],l[2]=d&4?k[2]:k[5],c.transformMat3(l,l,e.rotationScale),c.add(l,l,e.position),m[3*d]=l[0],m[3*d+1]=l[1],m[3*
d+2]=l[2];return m}const f=w.create(),l=g.create();a.boundingBoxCornerPoints=n;a.boundingBoxTop=function(k,e,d,m){k=e.getComponentAabb(d,k,f);e=e.getObjectTransform(d);m[0]=0;m[1]=0;m[2]=0;for(d=0;8>d;++d)l[0]=d&1?k[0]:k[3],l[1]=d&2?k[1]:k[4],l[2]=k[5],c.transformMat3(l,l,e.rotationScale),c.add(l,l,e.position),m[0]+=l[0],m[1]+=l[1],m[2]+=l[2];m[0]/=8;m[1]/=8;m[2]/=8;return m};a.createGetFeatureExtent=function(k,e,d){const m=new Float64Array(24);return z=>{var v=z.meta.featureExtents;if(b.isNone(v)){v=
new Float64Array(6*z.meta.featureIds.length);z.meta.featureExtents=v;for(let q=0;q<v.length;q+=6)v[q]=Number.POSITIVE_INFINITY}v=new Float64Array(v.buffer,6*z.index*Float64Array.BYTES_PER_ELEMENT,6);v[0]===Number.POSITIVE_INFINITY&&(n(z.index,d,z.meta.objectHandle,m),h.projectBuffer(m,e,0,m,k,0,8)?(w.set(v,w.NEGATIVE_INFINITY),w.expandWithBuffer(v,m,0,8)):w.set(v,w.ZERO));return v}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/support/LimitGraphicsMap":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../core/Evented","../../../core/MapUtils","./GraphicsMap"],function(a,b,c,g,h){c=function(f){function l(e){var d=f.call(this)||this;d._limit=e;d._all=new h.GraphicsMap;d._active=new n(b._assertThisInitialized(d));d._pending=new Map;d._handle=d._all.on("change",m=>d._handleChanges(m));return d}b._inheritsLoose(l,f);var k=l.prototype;k.destroy=function(){this._handle.remove()};k.toArray=function(){return this._active.toArray()};k.find=function(e){return this._active.find(e)};
k.forEach=function(e){this._active.forEach(e)};k.addMany=function(e){this._all.addMany(e)};k.removeManyByObjectId=function(e){this._all.removeManyByObjectId(e)};k._handleChanges=function(e){let d=e.removed;if(0<this._pending.size){d=[];for(var m of e.removed)this._pending.delete(m.objectId)||d.push(m)}m=this._limit-this._active.length+d.length;m<e.added.length&&(this._active.removeMany(d),d=[],w.reset(1-this._limit/(this._active.length+e.added.length)),this._active.forEach(v=>{w.sample()&&(d.push(v),
this._pending.set(v.objectId,v))}),m=this._limit-this._active.length+d.length);let z=e.added;if(m<e.added.length){z=[];w.reset(m/e.added.length);for(const v of e.added)w.sample()?z.push(v):this._pending.set(v.objectId,v)}e=m-z.length;0<e&&0<this._pending.size&&(w.reset(e/this._pending.size),this._pending.forEach(v=>{w.sample()&&(z.push(v),this._pending.delete(v.objectId))}));this._active.addAndRemove(z,d)};b._createClass(l,[{key:"length",get:function(){return this._active.length}}]);return l}(c);
const w=new (function(){function f(){this.percentage=1;this.last=-1;this.index=0}var l=f.prototype;l.reset=function(k){this.percentage=k;this.last=-1};l.sample=function(){const k=Math.floor(this.index*this.percentage);++this.index;if(k===this.last)return!1;this.last=k;return!0};return f}());let n=function(){function f(k){this._parent=k;this._map=new Map}var l=f.prototype;l.forEach=function(k){this._map.forEach(e=>k(e))};l.find=function(k){let e;g.someMap(this._map,d=>k(d)?(e=d,!0):!1);return e};l.toArray=
function(){return[...this._map.values()]};l.addAndRemove=function(k,e){for(const d of k)this._map.set(d.objectId,d);for(const d of e)this._map.delete(d.objectId);(0<k.length||0<e.length)&&this._parent.emit("change",{added:k,removed:e})};l.removeMany=function(k){for(const e of k)this._map.delete(e.objectId);0<k.length&&this._parent.emit("change",{added:[],removed:k})};b._createClass(f,[{key:"length",get:function(){return this._map.size}}]);return f}();a.LimitGraphicsMap=c;Object.defineProperty(a,"__esModule",
{value:!0})})},"esri/views/3d/support/GraphicsMap":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/Evented","../../../core/MapUtils"],function(a,b,c,g){c=function(h){function w(){var f=h.apply(this,arguments)||this;f._map=new Map;return f}b._inheritsLoose(w,h);var n=w.prototype;n.clear=function(){if(0<this._map.size){const f=this.toArray();this._map.clear();this.emit("change",{added:[],removed:f})}};n.get=function(f){return this._map.get(f)};n.addMany=function(f){if(0!==
f.length){var l=new Set;for(let k=0;k<f.length;k++){const e=f[k],d=e.objectId,m=this._map.get(d);m?(l.add(d),e!==m&&(f[k]=m),++m.refCount):(e.refCount=1,this._map.set(d,e))}f=0<l.size?f.filter(k=>!l.has(k.objectId)):f;0<f.length&&this.emit("change",{added:f,removed:[]})}};n.removeMany=function(f){const l=[];for(const k of f){f=k.objectId;const e=this._map.get(f);null!=e&&0>=--e.refCount&&(this._map.delete(f),l.push(k))}0<l.length&&this.emit("change",{added:[],removed:l})};n.removeManyByObjectId=function(f){const l=
[];for(const k of f)f=this._map.get(k),null!=f&&0>=--f.refCount&&(this._map.delete(k),l.push(f));0<l.length&&this.emit("change",{added:[],removed:l})};n.toArray=function(){return[...this._map.values()]};n.find=function(f){let l;g.someMap(this._map,k=>f(k)?(l=k,!0):!1);return l};n.forEach=function(f){this._map.forEach(l=>f(l))};b._createClass(w,[{key:"length",get:function(){return this._map.size}}]);return w}(c);a.GraphicsMap=c;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/I3SMeshWorkerHandle":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/maybe ../../../core/PooledArray ../../../core/workers/WorkerHandle ../../../geometry/projection ../../../libs/i3s/enums".split(" "),
function(a,b,c,g,h,w,n,f){function l(m,z,v){e.clear();var q=Infinity;let t=Infinity,r=-Infinity,x=-Infinity,u=!1;for(const y of z){var E="clip"===y.type?f.ModificationType.Inside:"mask"===y.type?f.ModificationType.Outside:f.ModificationType.Replace;const A=y.geometry;z=p=>p;if(A.spatialReference){if(!n.canProjectWithoutEngine(A.spatialReference,v)){k.warn("Can't project modification polygon into layer spatial reference, ignoring modification");continue}z=p=>{n.projectVectorToVector(p,A.spatialReference,
d,v);return d}}else A.hasZ||(d[2]=0,z=p=>{d[0]=p[0];d[1]=p[1];return d});u=u||E===f.ModificationType.Outside;e.push(E);e.push(A.rings.length);for(const p of A.rings){e.push(p.length);for(const B of p)E=z(B),e.push(E[0]),e.push(E[1]),e.push(E[2]),q=Math.min(q,E[0]),t=Math.min(t,E[1]),r=Math.max(r,E[0]),x=Math.max(x,E[1])}}g.isSome(m)&&(u?(e.push(f.ModificationType.Inside),e.push(2),e.push(4),e.push(q-1E-4),e.push(t-1E-4),e.push(0),e.push(r+1E-4),e.push(t-1E-4),e.push(0),e.push(r+1E-4),e.push(x+1E-4),
e.push(0),e.push(q-1E-4),e.push(x+1E-4),e.push(0)):(e.push(f.ModificationType.Outside),e.push(1)),e.push(4),e.push(m[0]),e.push(m[1]),e.push(0),e.push(m[2]),e.push(m[1]),e.push(0),e.push(m[2]),e.push(m[3]),e.push(0),e.push(m[0]),e.push(m[3]),e.push(0));e.push(f.ModificationType.Finished);m=new Float64Array(e.length);for(q=0;q<e.length;++q)m[q]=e.getItemAt(q);return m}const k=c.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle");c=function(m){function z(q){return m.call(this,"SceneLayerWorker","process",
q,{hasInitialize:!0})||this}b._inheritsLoose(z,m);var v=z.prototype;v.getTransferList=function(q){return[q.geometryBuffer]};v.setModifications=function(q,t,r,x){q={context:q,modifications:l(t,r,x),isGeodetic:x.isGeographic};this.broadcast(q,"setModifications")};v.setLegacySchema=function(q,t){t=JSON.stringify(t);this.broadcast({context:q,jsonSchema:t},"setLegacySchema")};v.destroyContext=function(q){return this.broadcast(q,"destroyContext")};return z}(w.WorkerHandle);const e=new h({deallocator:null}),
d=[0,0,0];a.I3SMeshWorkerHandle=c;a.toWasmModification=l;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/libs/i3s/enums":function(){define(["exports"],function(a){a.IndexType=void 0;(function(b){b[b.None=0]="None";b[b.Int16=1]="Int16";b[b.Int32=2]="Int32"})(a.IndexType||(a.IndexType={}));a.ModificationType=void 0;(function(b){b[b.Replace=0]="Replace";b[b.Outside=1]="Outside";b[b.Inside=2]="Inside";b[b.Finished=3]="Finished"})(a.ModificationType||(a.ModificationType={}));Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/layers/II3SMeshView3D":function(){define(["exports"],function(a){a.ForAllFeaturesVisibilityMode=void 0;(function(b){b[b.VISIBLE_ONLY=0]="VISIBLE_ONLY";b[b.ALL=1]="ALL";b[b.ALL_IN_CLIPPING_AREA=2]="ALL_IN_CLIPPING_AREA"})(a.ForAllFeaturesVisibilityMode||(a.ForAllFeaturesVisibilityMode={}));a.ForAllFeaturesReturnType=void 0;(function(b){b[b.EXIT=0]="EXIT";b[b.CONTINUE=1]="CONTINUE";b[b.SKIP=2]="SKIP"})(a.ForAllFeaturesReturnType||(a.ForAllFeaturesReturnType=
{}));Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/SceneLayerWorker":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/typedArrayUtil ../../../libs/i3s/enums ../../../libs/i3s/I3SModule ./i3s/I3SNode".split(" "),function(a,b,c,g,h,w,n){function f(){f=b._asyncToGenerator(function*(y){yield r();const A=[y.geometryBuffer];return{result:z(y,A),transferList:A}});return f.apply(this,arguments)}function l(){l=b._asyncToGenerator(function*(y){var A;
yield r();const p=[y.geometryBuffer];var {geometryBuffer:B}=y,D=B.byteLength;y=u._malloc(D);D=new Uint8Array(u.HEAPU8.buffer,y,D);D.set(new Uint8Array(B));B=u.dracoDecompressPointCloudData(y,D.byteLength);u._free(y);if(0<B.error.length)throw`i3s.wasm: ${B.error}`;y=0<(null==(A=B.featureIds)?void 0:A.length)?g.slice(B.featureIds):null;A=g.slice(B.positions);y&&p.push(y.buffer);p.push(A.buffer);return{result:{positions:A,featureIds:y},transferList:p}});return l.apply(this,arguments)}function k(){k=
b._asyncToGenerator(function*(y){yield r();v(y);y={buffer:y.buffer};return{result:y,transferList:[y.buffer]}});return k.apply(this,arguments)}function e(){e=b._asyncToGenerator(function*(y){yield r();m(y)});return e.apply(this,arguments)}function d(){d=b._asyncToGenerator(function*(y){yield r();u.setLegacySchema(y.context,y.jsonSchema)});return d.apply(this,arguments)}function m(y){const A=y.modifications,p=u._malloc(8*A.length),B=new Float64Array(u.HEAPU8.buffer,p,A.length);for(let D=0;D<A.length;++D)B[D]=
A[D];u.setModifications(y.context,p,A.length,y.isGeodetic);u._free(p)}function z(y,A){if(!u)return null;const {context:p,localOrigin:B,globalTrafo:D,mbs:C,obb:F,elevationOffset:G,geometryBuffer:L,geometryDescriptor:H,indexToVertexProjector:M,vertexToRenderProjector:K}=y;var I=u._malloc(L.byteLength),O=u._malloc(33*Float64Array.BYTES_PER_ELEMENT),Q=new Uint8Array(u.HEAPU8.buffer,I,L.byteLength);Q.set(new Uint8Array(L));var J=new Float64Array(u.HEAPU8.buffer,O,33);t(J,B);var P=J.byteOffset+3*J.BYTES_PER_ELEMENT,
N=new Float64Array(J.buffer,P);t(N,D);P+=16*J.BYTES_PER_ELEMENT;N=new Float64Array(J.buffer,P);t(N,C);P+=4*J.BYTES_PER_ELEMENT;c.isSome(F)&&(N=new Float64Array(J.buffer,P),t(N,F.center),P+=3*J.BYTES_PER_ELEMENT,N=new Float64Array(J.buffer,P),t(N,F.halfSize),P+=3*J.BYTES_PER_ELEMENT,N=new Float64Array(J.buffer,P),t(N,F.quaternion));J={isDraco:!1,isLegacy:!1,color:y.layouts.some(S=>S.some(T=>"color"===T.name)),normal:y.needNormals&&y.layouts.some(S=>S.some(T=>"normalCompressed"===T.name)),uv0:y.layouts.some(S=>
S.some(T=>"uv0"===T.name)),uvRegion:y.layouts.some(S=>S.some(T=>"uvRegion"===T.name)),featureIndex:H.featureIndex};Q=u.process(p,!!y.obb,I,Q.byteLength,H,J,O,G,M,K,y.normalReferenceFrame);u._free(O);u._free(I);if(0<Q.error.length)throw`i3s.wasm: ${Q.error}`;if(Q.discarded)return null;I=0<Q.componentOffsets.length?g.slice(Q.componentOffsets):null;O=0<Q.featureIds.length?g.slice(Q.featureIds):null;J=g.slice(Q.interleavedVertedData).buffer;P=Q.indicesType===h.IndexType.Int16?g.slice(new Uint16Array(Q.indices.buffer,
Q.indices.byteOffset,Q.indices.byteLength/2)):g.slice(new Uint32Array(Q.indices.buffer,Q.indices.byteOffset,Q.indices.byteLength/4));N=g.slice(Q.positions);const R=Q.positionIndicesType===h.IndexType.Int16?g.slice(new Uint16Array(Q.positionIndices.buffer,Q.positionIndices.byteOffset,Q.positionIndices.byteLength/2)):g.slice(new Uint32Array(Q.positionIndices.buffer,Q.positionIndices.byteOffset,Q.positionIndices.byteLength/4));y={layout:y.layouts[0],interleavedVertexData:J,indices:P,hasColors:Q.hasColors,
hasModifications:Q.hasModifications,positionData:{data:N,indices:R}};O&&A.push(O.buffer);I&&A.push(I.buffer);A.push(J);A.push(P.buffer);A.push(N.buffer);A.push(R.buffer);return{componentOffsets:I,featureIds:O,transformedGeometry:y,obb:Q.obb}}function v(y){const {context:A,buffer:p}=y;y=u._malloc(p.byteLength);const B=p.byteLength/Float64Array.BYTES_PER_ELEMENT,D=new Float64Array(u.HEAPU8.buffer,y,B),C=new Float64Array(p);D.set(C);u.filterOBBs(A,y,B);C.set(D);u._free(y)}function q(y){u&&u.destroy(y)}
function t(y,A){for(let p=0;p<A.length;++p)y[p]=A[p]}function r(){if(u)return Promise.resolve();x||(x=w.get().then(y=>{u=y;x=null}));return x}let x,u;const E={transform:z,destroy:q};a.destroyContext=function(y){q(y)};a.dracoDecompressPointCloudData=function(y){return l.apply(this,arguments)};a.filterObbsForModifications=function(y){return k.apply(this,arguments)};a.filterObbsForModificationsSync=v;a.initialize=r;a.interpretObbModificationResults=function(y){return 0===y?n.NodeIMModificationImpact.Unmodified:
1===y?n.NodeIMModificationImpact.PotentiallyModified:2===y?n.NodeIMModificationImpact.Culled:n.NodeIMModificationImpact.Unknown};a.process=function(y){return f.apply(this,arguments)};a.setLegacySchema=function(y){return d.apply(this,arguments)};a.setModifications=function(y){return e.apply(this,arguments)};a.setModificationsSync=m;a.test=E;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/libs/i3s/I3SModule":function(){define(["require","exports","../../assets"],function(a,b,c){function g(w){return c.getAssetUrl(`esri/libs/i3s/${w}`)}
let h;b.get=function(){h||(h=(new Promise(w=>(new Promise((n,f)=>a(["../../chunks/i3s"],n,f))).then(n=>n.i3s).then(({default:n})=>{const f=n({locateFile:g,onRuntimeInitialized:()=>w(f)});delete f.then}))).catch(w=>Promise.reject(w)));return h};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/Highlights":function(){define(["../../../../core/arrayUtils","../II3SMeshView3D"],function(a,b){let c=function(){this.ids=new Set;this.paused=!1};return function(){function g({collection:w,
forAllFeatures:n,forAllFeaturesOfNode:f}){this.highlights=[];this.collection=w;this.forAllFeatures=n;this.forAllFeaturesOfNode=f}var h=g.prototype;h.destroy=function(){this.highlights.forEach(w=>this._releaseSet(w));this.highlights=null};h.acquireSet=function(){const w=new c;this.highlights.push(w);return{set:w,handle:{remove:()=>{this._releaseSet(w);a.removeUnordered(this.highlights,w)},pause:()=>{this._releaseSet(w);w.paused=!0},resume:()=>{w.paused=!1;this._initializeSet(w)}}}};h.setFeatureIds=
function(w,n){n.forEach(f=>w.ids.add(f));this._initializeSet(w)};h._initializeSet=function(w){this.forAllFeatures((n,f,l)=>{w.ids.has(n)&&this.collection.addComponentHighlight(l.objectHandle,f);return b.ForAllFeaturesReturnType.CONTINUE})};h._releaseSet=function(w){this.forAllFeatures((n,f,l)=>{w.ids.has(n)&&this.collection.removeComponentHighlight(l.objectHandle,f);return b.ForAllFeaturesReturnType.CONTINUE})};h.objectCreated=function(w){this.highlights.forEach(n=>{n.paused||this.forAllFeaturesOfNode(w,
(f,l)=>{n.ids.has(f)&&this.collection.addComponentHighlight(w.objectHandle,l);return b.ForAllFeaturesReturnType.CONTINUE})})};h.objectDeleted=function(w){this.collection.clearHighlights(w.objectHandle)};return g}()})},"esri/views/3d/layers/i3s/I3SAttributeOverrides":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../request ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../intl/number ../../../../layers/support/featureQueryAll".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){const d=n.getLogger("esri.views.3d.layers.i3s.I3SAttributeOverrides");n=function(){function v(t,r){this.layer=t;this.warnMaximumChangedObjectsExceeded=!1;this.changedObjectIds=new Set;this.pendingFetchAbortController=new AbortController;this.interactiveEditingSessions=null;this._maximumNumberOfEditOVerrides=5E4;this.memCache=r.newCache(`${t.uid}-attribute-overrides`);this.pendingFetchChangedObjectIds=this._fetchChangedObjectIds(this.pendingFetchAbortController.signal);
this.pendingFetchChangedObjectIds.then(()=>this.pendingFetchAbortController=null)}var q=v.prototype;q.destroy=function(){this.layer=null;this.memCache.destroy();this.memCache=null;this.pendingFetchAbortController&&(this.pendingFetchAbortController.abort(),this.pendingFetchAbortController=null);this.pendingFetchChangedObjectIds=null};q.createInteractiveEditSession=function(t){this.changedObjectIds.add(t);f.isNone(this.interactiveEditingSessions)&&(this.interactiveEditingSessions=[]);const r=this.interactiveEditingSessions,
x=new m(t,{rollback:()=>{g.remove(r,x);0===r.length&&(this.interactiveEditingSessions=null)},commit:u=>{for(const [E,y]of u)this.updateValue(t,E,y)}});r.unshift(x);return x};q.apply=function(){var t=b._asyncToGenerator(function*(r,x,u){if(!f.isNone(x)){var {loadedAttributes:E,attributeData:y}=x;if(!f.isNone(E)&&0!==E.length&&!f.isNone(y)&&(yield l.whenOrAbort(this.pendingFetchChangedObjectIds,u),0!==this.changedObjectIds.size)){x={loadedAttributes:E,attributeData:y};var A=this._getOverridesFromCache(r,
x,this.changedObjectIds),{objectIds:p,fieldNames:B}=A;u=yield this._queryOverridesFromAssociatedLayer(p,B,u);f.isNone(u)||this._processOverridesFromAssociatedLayer(r,u,B,x)}}});return function(r,x,u){return t.apply(this,arguments)}}();q.updateValue=function(t,r,x){this.changedObjectIds.add(t);this._cacheValue(t,r,x)};q._cacheValue=function(t,r,x){this.memCache.put(this._getCacheKey(t,r),x,this._memCacheValueSize(x))};q._getOverridesFromCache=function(t,{loadedAttributes:r,attributeData:x},u){const E=
new Set,y=[];for(var A of r)y[A.index]=x[A.name];x=new Set;for(A=0;A<t.length;A++){const p=t[A];if(u.has(p))for(const B of r){const D=this._fromCache(p,B.index);void 0!==D?y[B.index][A]=D:(E.add(p),x.add(B.name))}}return{objectIds:Array.from(E),fieldNames:Array.from(x)}};q._fromCache=function(t,r){const x=this._fromInteractiveEditingSession(t,r);if(void 0!==x)return x;t=this._getCacheKey(t,r);return this.memCache.get(t)};q._fromInteractiveEditingSession=function(t,r){if(!f.isNone(this.interactiveEditingSessions))for(const x of this.interactiveEditingSessions){if(x.objectId!==
t)continue;const u=x.get(r);if(void 0!==u)return u}};q._getCacheKey=function(t,r){return`${t}-${r}`};q._queryOverridesFromAssociatedLayer=function(){var t=b._asyncToGenerator(function*(r,x,u){if(0===r.length||0===x.length)return null;r=r.sort((A,p)=>A-p);this.warnMaximumChangedObjectsExceeded&&(this.warnMaximumChangedObjectsExceeded=!1,this._logMaximumObjectsExceededWarning());const E=f.unwrap(this.layer.associatedLayer),y=E.createQuery();y.where="1\x3d1";y.returnGeometry=!1;y.outFields=[E.objectIdField,
...x];y.cacheHint=!0;y.objectIds=r;x=e.getMaximumQuerySize(E);r=r.length>x?g.splitIntoChunks(r,x).map(A=>{const p=y.clone();p.objectIds=A;return h.resultOrAbort(e.queryAllJSON(E,p,{signal:u}))}):[h.resultOrAbort(e.queryAllJSON(E,y,{signal:u}))];return(yield Promise.all(r)).reduce((A,p)=>A.concat(p.ok?p.value.features:[]),[])});return function(r,x,u){return t.apply(this,arguments)}}();q._logMaximumObjectsExceededWarning=function(){let t=`The number of edited objects that are not yet cached in the scene service exceeds the maximum limit. Attribute changes will only be available for the first ${k.formatNumber(this._maximumNumberOfEditOVerrides)} objects. Please consider re-caching the scene service`;
const r=this.layer.portalItem;t=r&&r.loaded?t+` (${r.portal.url}/home/item.html?id=${r.id}#settings)`:t+` (${this.layer.parsedUrl.path})`;d.warn("#queryOverrides()",this.layer.title,`${t}.`)};q._processOverridesFromAssociatedLayer=function(t,r,x,{loadedAttributes:u,attributeData:E}){const y=f.unwrap(this.layer.associatedLayer).objectIdField,A=x.map(B=>E[B]),p=new Map(u.map(B=>[B.name,B.index]));u=x.map(B=>p.get(B));t=new Map(Array.from(t,(B,D)=>[B,D]));for(const B of r){r=B.attributes[y];for(let D=
0;D<x.length;D++){const C=u[D],F=t.get(r),G=B.attributes[x[D]];A[D][F]=G;this._cacheValue(r,C,G)}}};q._memCacheValueSize=function(t){return"string"===typeof t?w.estimateStringByteSize(t):w.estimateNumberByteSize()};q._fetchChangedObjectIds=function(){var t=b._asyncToGenerator(function*(r){var x,u,E,y=this.layer;yield y.load({signal:r});this.changedObjectIds.clear();if(!f.isNone(y.associatedLayer)&&null!=(x=y.associatedLayer.capabilities)&&null!=(u=x.operations)&&u.supportsChangeTracking){x=this._getFetchChangedObjectIdsServerGen();
if(f.isNone(x))return null;u=y.associatedLayer.layerId;r=yield h.result(c(`${y.associatedLayer.url}/extractChanges`,{method:"post",query:{f:"json",returnIdsOnly:!0,layers:`${u}`,returnUpdates:!0,returnDeletes:!1,returnInserts:!1,layerServerGens:JSON.stringify([{id:u,serverGen:x}])},timeout:1E4,signal:r}));r=r.ok&&null!=(E=r.value.data)&&E.edits?f.get(r.value.data.edits[0],"objectIds","updates"):null;if(f.isSome(r))for(E=Math.min(this._maximumNumberOfEditOVerrides,r.length),E<r.length&&(this.warnMaximumChangedObjectsExceeded=
!0),r=r.sort((A,p)=>A-p),y=0;y<E;y++)this.changedObjectIds.add(r[y])}});return function(r){return t.apply(this,arguments)}}();q._getFetchChangedObjectIdsServerGen=function(){var t=this.layer;if(f.isSome(t.serviceUpdateTimeStamp)&&f.isSome(t.serviceUpdateTimeStamp.lastUpdate))return t.serviceUpdateTimeStamp.lastUpdate;t=t.associatedLayer;return f.isSome(t)&&f.isSome(t.serverGens)&&f.isSome(t.serverGens.minServerGen)?t.serverGens.minServerGen:null};b._createClass(v,[{key:"test",get:function(){const t=
this;return{changedObjectIds:Array.from(this.changedObjectIds),pendingFetchChangedObjectIds:this.pendingFetchChangedObjectIds,get maximumNumberOfEditOVerrides(){return t._maximumNumberOfEditOVerrides},set maximumNumberOfEditOVerrides(r){t._maximumNumberOfEditOVerrides=r}}}}]);return v}();let m=function(){function v(t,r){this.objectId=t;this.options=r;this.updates=new Map;this.state=z.ACTIVE}var q=v.prototype;q.get=function(t){return this.updates.get(t)};q.set=function(t,r){this.isActive&&this.updates.set(t,
r)};q.rollback=function(){this.isActive&&(this.state=z.ROLLED_BACK,this.options.rollback())};q.commit=function(){this.isActive&&(this.state=z.COMMITTED,this.options.commit(this.updates),this.updates.clear())};b._createClass(v,[{key:"isActive",get:function(){return this.state===z.ACTIVE}}]);return v}();var z;(function(v){v[v.ACTIVE=0]="ACTIVE";v[v.COMMITTED=1]="COMMITTED";v[v.ROLLED_BACK=2]="ROLLED_BACK"})(z||(z={}));a.I3SAttributeOverrides=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/layers/support/featureQueryAll":function(){define(["exports",
"../../chunks/_rollupPluginBabelHelpers","../../core/maybe","../../rest/support/Query"],function(a,b,c,g){function h(){h=b._asyncToGenerator(function*(l,k,e){k=k.clone();l.capabilities.query.supportsMaxRecordCountFactor&&(k.maxRecordCountFactor=f(l));const d=w(l),m=l.capabilities.query.supportsPagination;k.start=0;k.num=d;let z=null;for(;;){const v=yield l.source.queryFeaturesJSON(k,e);c.isNone(z)?z=v:z.features=z.features.concat(v.features);z.exceededTransferLimit=v.exceededTransferLimit;if(!m||
!v.exceededTransferLimit)break;k.start+=d}return z});return h.apply(this,arguments)}function w(l){return f(l)*n(l)}function n(l){return l.capabilities.query.maxRecordCount||2E3}function f(l){return l.capabilities.query.supportsMaxRecordCountFactor?g.MAX_MAX_RECORD_COUNT_FACTOR:1}a.getMaxRecordCountFactor=f;a.getMaximumQuerySize=w;a.getMaximumRecordCount=n;a.queryAllJSON=function(l,k,e){return h.apply(this,arguments)};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SCrossfadeHelper":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/scheduling","../support/I3SLayerView"],function(a,b,c,g,h){let w=function(){function n(l){this.view=l;this._currentFrameStartTime=this._preRenderFrameTaskHandle=null;this._numFadingNodes=0}var f=n.prototype;f.stopNodeFading=function(l){null!=l.lodCrossfadeProgress&&(this._numFadingNodes--,l.lodCrossfadeProgress=null,0===this._numFadingNodes&&(null!=this._preRenderFrameTaskHandle&&(this._preRenderFrameTaskHandle=
c.removeMaybe(this._preRenderFrameTaskHandle)),this.view.notifyLODUpdate(),this.view.notifyUpdate()))};f._startNodeFading=function(l,k,e){0===this._numFadingNodes&&(this._preRenderFrameTaskHandle=g.addFrameTask({preRender:d=>this._updateAllNodeFading(d)}),this.view.notifyLODUpdate());null==l.lodCrossfadeProgress&&(this._numFadingNodes++,this.view.notifyUpdate());l.lodCrossfadeSignedDuration=e;l.lodCrossfadeProgress=k};f._updateAllNodeFading=function(l){const k=this.view.nodeCrossfadingEnabled;this.view.foreachCrossfadeNode((e,
d)=>{if(c.isSome(d)&&c.isSome(d.lodCrossfadeProgress)){const m=d.lodCrossfadeSignedDuration,z=d.lodCrossfadeProgress+Math.abs(l.deltaTime/m),v=!k||1<=z||0===m,q=(0<m?this.view.fullOpacity:0)-(v?0:0<m?1:-1)*(1-z);v?(this.stopNodeFading(d),0>m&&this.view.markNodeToRemove(e)):d.lodCrossfadeProgress=z;this.view.setNodeOpacityByIndex(e,q)}});this.view.removeMarkedNodes()};f.stopAllNodeFading=function(){this.view.foreachCrossfadeNode((l,k)=>{c.isSome(k)&&c.isSome(k.lodCrossfadeProgress)&&(this.stopNodeFading(k),
k=k.lodCrossfadeSignedDuration,0>k&&this.view.markNodeToRemove(l),this.view.setNodeOpacityByIndex(l,0<k?this.view.fullOpacity:0))});this.view.removeMarkedNodes()};f.fadeNode=function(l,k,e,d){null==this._currentFrameStartTime&&(this._currentFrameStartTime=Date.now());var m=this.view;const z=m.nodeCrossfadingEnabled,v=e===h.FadeDirection.FadeIn?m.fullOpacity:0;d=z?d?e===h.FadeDirection.FadeIn?m.lodCrossfadeinDuration:m.lodCrossfadeoutDuration:m.lodCrossfadeUncoveredDuration:0;m=this.view.getNodeOpacityByIndex(l);
z&&m!==v&&0<d?this._startNodeFading(k,1-Math.abs(v-m),(e===h.FadeDirection.FadeIn?1:-1)*d):(this.stopNodeFading(k),this.view.setNodeOpacityByIndex(l,v),e===h.FadeDirection.FadeOut&&this.view.removeNode(l))};f.isNodeFullyFadedIn=function(l){const k=this.view.getNodeCrossfadeMetaData(l);return c.isNone(k)||null==k.lodCrossfadeProgress&&this.view.getNodeOpacityByIndex(l)===this.view.fullOpacity};b._createClass(n,[{key:"updating",get:function(){return 0<this._numFadingNodes}}]);return n}();a.I3SCrossfadeHelper=
w;a.NodeCrossfadeMetaData=function(){this.lodCrossfadeSignedDuration=0};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SElevationProvider":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r){const x=q.empty(),u=m.create(),E=v.create(),y=v.create(),A=v.create(),p=h.getLogger("esri.views.3d.layers.i3s.I3SElevationProvider");c=function(B){function D(F){F=B.call(this,F)||this;F.tmpEvent={spatialReference:null,extent:x,context:"scene"};return F}a._inheritsLoose(D,B);var C=D.prototype;C.initialize=function(){this.view=this.layerView.view;this.renderCoordsHelper=this.view.renderCoordsHelper;this.intersector=t.newIntersector(this.view.state.viewingMode);
this.intersector.options.store=r.StoreResults.MIN;const F=this.layerView.i3slayer.fullExtent;w.isNone(F)?p.error("I3SElevationProvider expected fullExtent on I3SLayer."):(this.zmin=F.zmin,this.zmax=F.zmax);this.tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"};C.getElevation=function(F,G,L,H){E[0]=F;E[1]=G;E[2]=L;if(!this.renderCoordsHelper.toRenderCoords(E,H,E))return p.error("could not project point to compute elevation"),null;F=this.layerView.elevationOffset;G=this.zmin+F;this.renderCoordsHelper.setAltitude(y,
this.zmax+F,E);this.renderCoordsHelper.setAltitude(A,G,E);this.intersector.reset(y,A,null);this.intersectionHandler.intersect(this.intersector,null,y,A);return this.intersector.results.min.getIntersectionPoint(E)?this.renderCoordsHelper.getAltitude(E):null};C.layerChanged=function(){this.spatialReference&&(this.tmpEvent.extent=this._computeLayerExtent(),this.tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this.tmpEvent))};C.objectChanged=function(F){this.spatialReference&&
(this.tmpEvent.extent=this._computeObjectExtent(F),this.tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this.tmpEvent))};C._computeObjectExtent=function(F){q.empty(x);this._expandExtent(F,x);return x};C._computeLayerExtent=function(){q.empty(x);for(const F of this.layerView.getVisibleNodes())this._expandExtent(F,x);return x};C._expandExtent=function(F,G){var L=F.visibilityObb||F.serviceObbInRenderSR;if(w.isSome(L))for(d.fromQuat(u,L.quaternion),u[12]=L.center[0],u[13]=
L.center[1],u[14]=L.center[2],F=0;8>F;++F)E[0]=F&1?L.halfSize[0]:-L.halfSize[0],E[1]=F&2?L.halfSize[1]:-L.halfSize[1],E[2]=F&4?L.halfSize[2]:-L.halfSize[2],z.transformMat4(E,E,u),this.renderCoordsHelper.fromRenderCoords(E,E,this.spatialReference),q.expand(G,E,G);else{var H=F.renderMbs[3];L=z.copy(y,F.renderMbs);L[0]-=H;L[1]-=H;L[2]-=H;F=z.copy(A,F.renderMbs);F[0]+=H;F[1]+=H;F[2]+=H;for(H=0;8>H;++H)E[0]=H&1?L[0]:F[0],E[1]=H&2?L[1]:F[1],E[2]=H&4?L[2]:F[2],this.renderCoordsHelper.fromRenderCoords(E,
E,this.spatialReference),q.expand(G,E,G)}};return D}(g.EventedMixin(c));b.__decorate([n.property({constructOnly:!0})],c.prototype,"layerView",void 0);b.__decorate([n.property({constructOnly:!0})],c.prototype,"intersectionHandler",void 0);b.__decorate([n.property()],c.prototype,"view",void 0);b.__decorate([n.property({readOnly:!0,aliasOf:"view.elevationProvider.spatialReference"})],c.prototype,"spatialReference",void 0);return c=b.__decorate([e.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],
c)})},"esri/views/3d/layers/i3s/I3SIntersectionHandler":function(){define("exports ../../../../core/maybe ../../support/orientedBoundingBox ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/verticalOffsetUtils".split(" "),function(a,b,c,g,h,w){function n(l,k,e,d=0){d=l[3]+d;const m=k[0]-l[0],z=k[1]-l[1];l=k[2]-l[2];k=e[0];const v=e[1];e=e[2];const q=k*m+v*z+e*l;return 0<=q*q-(k*k+v*v+e*e)*(m*m+z*z+l*l-d*d)}let f=function(){function l(k){this.type=
h.IntersectorType.I3S;this.layerUid=k.layerUid;this.sublayerUid=k.sublayerUid;this.collection=k.collection;this.traverseNodeHierarchy=k.traverseNodeHierarchy;this.slicePlaneEnabled=k.slicePlaneEnabled;this.isGround=k.isGround}l.prototype.intersect=function(k,e,d,m){const z=k.results,v=k.options.store===h.StoreResults.ALL,q=k.ray.direction,t=k.tolerance;let r=E=>E,x=E=>E;const u=w.getVerticalOffsetI3S(k.verticalOffset);b.isSome(u)&&(r=E=>u.applyToMbs(E),x=E=>u.applyToObb(E));this.traverseNodeHierarchy((E,
y)=>{if(b.isSome(E.serviceObbInRenderSR)&&!c.intersectLine(x(E.serviceObbInRenderSR),d,q,t))return!1;!y||b.isSome(E.geometryObb)&&!c.intersectLine(x(E.geometryObb),d,q,t)||!b.isSome(E.serviceObbInRenderSR)&&!n(r(E.renderMbs),d,q,t)||this.collection.intersect(y,d,m,t,u,(A,p,B,D)=>{if(0<=p&&(null==e||e(d,m,p))){var C=F=>{F.set(this.type,{layerUid:this.layerUid,sublayerUid:this.sublayerUid,nodeIndex:E.index,componentIndex:A,triangleNr:D},p,B)};this.isGround&&(null==z.ground.dist||p<z.ground.dist)&&C(z.ground);
if(!k.options.isFiltered&&((null==z.min.dist||p<z.min.dist)&&C(z.min),(null==z.max.dist||p>z.max.dist)&&C(z.max),v)){const F=g.newIntersectorResult(k.ray);C(F);k.results.all.push(F)}}});return!0})};return l}();a.I3SIntersectionHandler=f;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/IDBCache":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/byteSizeEstimations ../../../../core/Error ../../../../core/maybe ../../../../core/promiseUtils".split(" "),
function(a,b,c,g,h,w){function n(k){return new Promise((e,d)=>{k.oncomplete=()=>e();k.onerror=()=>d(k.error);k.onabort=()=>d(k.error)})}function f(k){return new Promise((e,d)=>{"done"===k.readyState?null!=k.error?d(k.error):e(k.result):(k.onsuccess=()=>e(k.result),k.onerror=()=>d(k.error))})}let l=function(){function k(d,m,z=14){this._version=z;this._quotaReductionPromise=this._db=null;this._miss=this._hit=this._gcCounter=0;this._destroyed=!1;this.gcFrequency=50;this.maxByteSize=c.ByteSizeUnit.GIGABYTES;
this.quotaReductionFactor=.2;this._dbName=d;this._storeName=m}var e=k.prototype;e.init=function(){return Promise.resolve().then(()=>{const d=indexedDB.open(this._dbName,this._version);d.onupgradeneeded=m=>{var z=d.result;const v=d.transaction,q=z.objectStoreNames.contains(this._storeName)?v.objectStore(this._storeName):z.createObjectStore(this._storeName);z=z.objectStoreNames.contains("last_access")?v.objectStore("last_access"):z.createObjectStore("last_access");z.indexNames.contains("date")||z.createIndex("date",
"date",{unique:!1});z.indexNames.contains("byteSize")||z.createIndex("byteSize","byteSize",{unique:!1});m.oldVersion<this._version&&(q.clear(),z.clear())};return f(d)}).then(d=>{this._destroyed?d.close():this._db=d})};e.destroy=function(){this._db&&(this._db.close(),this._db=null);this._destroyed=!0};e.getHitRate=function(){return this._hit/(this._hit+this._miss)};e.put=function(d,m){return null==this._db?Promise.reject(new g("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=
this._quotaReductionPromise?this._quotaReductionPromise:Promise.resolve()).then(()=>this._put(d,m)).catch(z=>{if(z&&"QuotaExceededError"===z.name)return null==this._quotaReductionPromise&&(this._quotaReductionPromise=this._getCacheSize().then(v=>this._removeLeastRecentlyAccessed(m.byteSize+Math.ceil(v*this.quotaReductionFactor))),this._quotaReductionPromise.then(()=>this._quotaReductionPromise=null,()=>this._quotaReductionPromise=null)),this._quotaReductionPromise.then(()=>this._put(d,m));throw z;
}).then(()=>{this._gcCounter--;0>this._gcCounter&&null!=this._db&&(this._gcCounter=this.gcFrequency,this._getCacheSize().then(z=>this._removeLeastRecentlyAccessed(z-this.maxByteSize)))})};e.get=function(d,m){if(null==this._db)return Promise.resolve(null);let z=null;return Promise.resolve().then(()=>{const v=this._db.transaction(this._storeName,"readonly");z=w.onAbort(m,()=>{v.abort()});const q=v.objectStore(this._storeName).get(d);return f(q)}).then(v=>{null==v?++this._miss:this._db&&(++this._hit,
this._db.transaction("last_access","readwrite").objectStore("last_access").put({date:Date.now(),byteSize:v.byteSize},d));h.isSome(z)&&z.remove();return v}).catch(()=>{++this._miss;w.throwIfAborted(m);h.isSome(z)&&z.remove();return null})};e.remove=function(d){var m=this;return null==this._db?Promise.resolve():Promise.resolve().then(b._asyncToGenerator(function*(){const z=m._db.transaction([m._storeName,"last_access"],"readwrite");var v=z.objectStore(m._storeName),q=z.objectStore("last_access");v=
v.delete(d);q=q.delete(d);yield Promise.all([f(v),f(q),n(z)])}))};e._put=function(d,m){const z=this._db.transaction([this._storeName,"last_access"],"readwrite");var v=z.objectStore(this._storeName);const q=z.objectStore("last_access");v=v.put(m,d);d=q.put({date:Date.now(),byteSize:m.byteSize},d);return Promise.all([f(v),f(d),n(z)])};e._removeLeastRecentlyAccessed=function(d){if(!(0>=d)){var m=this._db.transaction([this._storeName,"last_access"],"readwrite"),z=m.objectStore(this._storeName),v=m.objectStore("last_access"),
q=0,t=v.index("date").openCursor(null,"next");t.onsuccess=()=>{const r=t.result;null!=r&&(null!=r.value.byteSize&&(q+=r.value.byteSize),z.delete(r.primaryKey),v.delete(r.primaryKey),q<d&&r.continue())};return n(m)}};e._getCacheSize=function(){const d=this._db.transaction("last_access");let m=0;const z=d.objectStore("last_access").index("byteSize").openKeyCursor();z.onsuccess=()=>{const v=z.result;if(v){var q=v.key;null!=q&&(m+=q);v.continue()}};return n(d).then(()=>m)};b._createClass(k,[{key:"initialized",
get:function(){return null!=this._db}}]);return k}();a.IDBCache=l;a.whenRequest=f;a.whenTransaction=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/attributeEditing":function(){define(["exports","../../../../core/lang","../../../../core/maybe","../support/attributeUtils"],function(a,b,c,g){function h(e,d){const m=d.edits.updateFeatures;if(!m||0===m.length)return new k;const z=w(d),v=new k;d=new Map;for(let x=0;x<e.attributeStorageInfo.length;x++)d.set(e.attributeStorageInfo[x].name,
x);const q=e.fieldsIndex,t=e.objectIdField,r=m.filter(x=>{x=g.attributeLookup(q,x.attributes,t);return z.has(x)});e.forEachNode((x,u)=>{const E=new Set(u);for(const D of r){const C=g.attributeLookup(q,D.attributes,t);if(!E.has(C))continue;const F=u.indexOf(C);for(const G in D.attributes){var y=e.fieldsIndex.normalizeFieldName(G);var A=v;var p=x.index,B=A.get(p);B?A=B:(B=new l,A.set(p,B),A=B);(p=A.get(y))?y=p:(p=[],A.set(y,p),y=p);y.push({featureIndex:F,featureId:C,value:D.attributes[G]})}}});return v}
function w(e){const d=new Set;if(!e.updatedFeatures)return d;for(const m of e.updatedFeatures)null!=m.objectId&&null==m.error&&d.add(m.objectId);return d}const n={setAttribute(){},rollback(){},commit(){}};var f;(function(e){e[e.EDITING=0]="EDITING";e[e.ROLLED_BACK=1]="ROLLED_BACK";e[e.COMMITTED=2]="COMMITTED"})(f||(f={}));const l=Map,k=Map;a.createInteractiveEditSession=function(e,d){const m=d.attributes[e.objectIdField];var z=e.sessions.get(m);if(z)return z;const v=b.clone(d.attributes),q=new Set;
if(null==m)return n;const t=e.attributeOverrides.createInteractiveEditSession(m),r=new Map;let x=f.EDITING;z={setAttribute(u,E){if(x===f.EDITING){var y=e.fieldsIndex.get(u);if(!c.isNone(y)){var A=e.attributeStorageInfo.findIndex(D=>D.name===y.name);if(!(0>A)){t.set(A,E);var p=e.attributeStorageInfo[A],B=!1;q.add(u);e.forEachNode((D,C)=>{var F=r.get(D);null==F?(C=C.indexOf(m),r.set(D,C)):C=F;if(-1!==C&&(F=e.getAttributeData(D.index))){const G=F[p.name];G&&(G[C]=E,e.setAttributeData(D.index,F,d),B=
!0)}});B&&e.clearMemCache()}}}},rollback(){if(x===f.EDITING){for(const u of q)this.setAttribute(u,v[u]);t.rollback();x=f.ROLLED_BACK;e.sessions.delete(m)}},commit(){x===f.EDITING&&(t.commit(),x=f.COMMITTED,e.sessions.delete(m))}};e.sessions.set(m,z);return z};a.processAttributeEdits=function(e,d){d=h(e,d);if(0!==d.size){var m=new Map;for(let v=0;v<e.attributeStorageInfo.length;v++)m.set(e.attributeStorageInfo[v].name,v);var z=!1;d.forEach((v,q)=>{const t=e.getAttributeData(q);let r=!1;v.forEach((x,
u)=>{const E=c.isSome(t)?t[u]:null;u=m.get(u);for(const {featureIndex:y,value:A,featureId:p}of x)E&&(E[y]=A,z=r=!0),e.attributeOverrides.updateValue(p,u,A)});r&&e.setAttributeData(q,t,null)});z&&e.clearMemCache()}};Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SMeshViewFilter":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/unitUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../core/sql/WhereClause ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/Ellipsoid ../../../../geometry/support/webMercatorUtils ../../../../layers/support/FeatureFilter ./I3SUtil ../../../../geometry/SpatialReference".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D){function C(){return F.apply(this,arguments)}function F(){F=c._asyncToGenerator(function*(){return N?N:N=yield new Promise((U,aa)=>a(["../../../../geometry/geometryEngine"],U,aa))});return F.apply(this,arguments)}function G(U,aa){if(k.isNone(U))return null;if("disjoint"===aa&&"polygon"===U.type){const Y=Array(U.rings.length);for(aa=0;aa<U.rings.length;++aa){var da=E.fromValues(Infinity,Infinity,-Infinity,-Infinity);E.expandWithNestedArray(da,
U.rings[aa]);Y[aa]={type:"polygon",rings:[U.rings[aa]],spatialReference:U.spatialReference,aabr:da}}Y.sort((la,ia)=>la.aabr[0]-ia.aabr[0]);const ea=new Set,ja=new n.PositionHint;for(U=0;U<Y.length;++U){const la=Y[U];for(aa=U+1;aa<Y.length;++aa){da=Y[aa];if(da.aabr[0]>=la.aabr[2])break;ea.add(da)}ea.forEach(ia=>{la!==ia&&(ia.aabr[2]<=la.aabr[0]?ea.delete(ia):N.intersects(la,ia)&&(la.rings=la.rings.concat(ia.rings),E.expand(la.aabr,ia.aabr,la.aabr),delete la._geVersion,ea.delete(ia),ia=n.indexOf(Y,
ia,Y.length,ja),Y.splice(ia,1)))});ea.add(la)}for(const la of Y)delete la.aabr;return Y}return[U]}function L(U,aa,da,Y){const ea=K(U,da);return aa.every(ja=>I(ja,ea,Y)!==S.DISCARD)}function H(U,aa,da,Y,ea,ja,la){const ia=ja[0].spatialReference||Y.spatialReference;if(x.projectBoundingSphere(aa.node.mbs,ea,T,ia)){ea=K(T,ia);var ca=M(la,Y,ia,da,aa.objectHandle);for(const fa of ja){if(0===U.length)break;switch(I(fa,ea,la)){case S.DISCARD:U.length=0;return;case S.KEEP:continue}B.filterInPlace(U,aa.featureIds,
ba=>J(fa,ba,ca))}}else P.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter")}function M(U,aa,da,Y,ea){aa=aa.renderSpatialReference;const ja=new Map,la={rings:[[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],hasZ:!1,hasM:!1,type:"polygon",spatialReference:da};la.rings[0][3]=la.rings[0][0];let ia,ca;switch(U){case "intersects":ia=(fa,ba)=>N.intersects(fa,ba)?S.KEEP:S.TEST;ca=O;break;case "contains":ia=(fa,ba)=>N.contains(fa,ba)?S.TEST:S.DISCARD;ca=O;break;default:ia=
(fa,ba)=>N.disjoint(fa,ba)?S.TEST:S.DISCARD,ca=Q}return{collection:Y,object:ea,type:U,maskSR:da,renderSR:aa,aabbCache:ja,triangle:la,positions:{indices:null,data:null,stride:0,startIndex:0,endIndex:0},triangleTest:ia,geometryTest:ca}}function K(U,aa){var da={x:U[0],y:U[1],hasZ:!1,hasM:!1,type:"point",spatialReference:aa};aa=!aa.isWGS84&&!aa.isWebMercator;U=Number.isNaN(U[3])?0:l.clamp(U[3],0,2*y.earth.radius);da=aa?N.buffer(da,U,1):N.geodesicBuffer(da,U,1);da.type="polygon";return da}function I(U,
aa,da){switch(da){case "intersects":case "contains":return O(U,aa);case "disjoint":return Q(U,aa)}}function O(U,aa){return N.intersects(U,aa)?N.contains(U,aa)?S.KEEP:S.TEST:S.DISCARD}function Q(U,aa){return N.intersects(U,aa)?N.contains(U,aa)?S.DISCARD:S.TEST:S.KEEP}function J(U,aa,da){const {collection:Y,object:ea,renderSR:ja,maskSR:la,geometryTest:ia,aabbCache:ca}=da;var fa=ca.get(aa);if(!fa){fa=Y.getObjectTransform(ea);Y.getComponentAabb(ea,aa,W);var ba=[[W[0],W[1],0],[W[0],W[4],0],[W[3],W[4],
0],[W[3],W[1],0]];for(var Z=0;4>Z;++Z)t.transformMat3(ba[Z],ba[Z],fa.rotationScale),t.add(ba[Z],ba[Z],fa.position),x.projectVectorToVector(ba[Z],ja,ba[Z],la);fa={rings:[ba],hasZ:!1,hasM:!1,type:"polygon",spatialReference:la};fa.rings[0][4]=fa.rings[0][0];ca.set(aa,fa)}switch(ia(U,fa)){case S.DISCARD:return!1;case S.KEEP:return!0}const {triangle:ha,triangleTest:na,positions:pa}=da;fa=ha.rings[0][0];ba=ha.rings[0][1];Z=ha.rings[0][2];const xa=Y.getObjectTransform(ea);Y.getComponentPositions(ea,aa,pa);
const {indices:Da,data:ua,stride:Fa,startIndex:qa,endIndex:sa}=pa;for(aa=qa;aa<sa;aa+=3){const ma=Fa*Da[aa+0],ra=Fa*Da[aa+1],va=Fa*Da[aa+2];t.set(fa,ua[ma+0],ua[ma+1],ua[ma+2]);t.set(ba,ua[ra+0],ua[ra+1],ua[ra+2]);t.set(Z,ua[va+0],ua[va+1],ua[va+2]);t.transformMat3(fa,fa,xa.rotationScale);t.transformMat3(ba,ba,xa.rotationScale);t.transformMat3(Z,Z,xa.rotationScale);t.add(fa,fa,xa.position);t.add(ba,ba,xa.position);t.add(Z,Z,xa.position);x.projectVectorToVector(fa,ja,fa,la);x.projectVectorToVector(ba,
ja,ba,la);x.projectVectorToVector(Z,ja,Z,la);if(!(Math.abs((ba[0]-fa[0])*(Z[1]-fa[1])-(ba[1]-fa[1])*(Z[0]-fa[0]))<V))switch(delete ha._geVersion,na(U,ha)){case S.DISCARD:return!1;case S.KEEP:return!0}}switch(da.type){case "intersects":return!1;default:return!0}}const P=f.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter");b.I3SMeshViewFilter=function(U){function aa(Y){Y=U.call(this,Y)||this;Y._projectionEngineLoaded=!1;return Y}c._inheritsLoose(aa,U);var da=aa.prototype;da.initialize=function(){d.whenOnce(this,
"filter.geometry").then(()=>this.loadAsyncModule(C().then(Y=>{this.destroyed||(this._geometryEngine=Y,this.applyFilters())})))};da.addFilters=function(Y,ea,ja,la){const ia=this.sortedObjectIds;k.isSome(ia)&&Y.push(fa=>B.objectIdFilter(ia,!0,fa));this.addSqlFilter(Y,this.parsedWhereClause);const ca=this.parsedGeometry;if(k.isSome(ca)){const fa=this.spatialRelationship;Y.push((ba,Z)=>H(ba,Z,la,ea,ja,ca,fa))}};da.isMBSGeoemtryVisible=function(Y,ea,ja){const la=this.parsedGeometry;if(k.isSome(la)){const ia=
this.spatialRelationship;ea=la[0].spatialReference||ea;return x.projectBoundingSphere(Y,ja,T,ea)?L(T,la,ea,ia):(P.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)}return!0};aa.checkSupport=function(Y){if(Y.timeExtent)return P.warn("Filters with a timeExtent are not supported for mesh scene layers"),!1;Y=Y.spatialRelationship;return null!=Y&&0<=R.indexOf(Y)?!0:(P.warn(`Filters with spatialRelationship other than ${R.join(", ")} are not supported for mesh scene layers`),
!1)};c._createClass(aa,[{key:"sortedObjectIds",get:function(){if(k.isNone(this.filter.objectIds))return null;const Y=new Float64Array(this.filter.objectIds);Y.sort();return Y}},{key:"parsedWhereClause",get:function(){const Y=k.isSome(this.filter)?this.filter.where:null;if(k.isNone(Y)||!Y)return null;try{return r.WhereClause.create(Y,this.layerFieldsIndex)}catch(ea){P.error(`Failed to parse filter where clause: ${ea}`)}return null}},{key:"parsedGeometry",get:function(){if(k.isNone(this.filter)||!this._geometryEngine)return null;
var {geometry:Y}=this.filter;if(k.isNone(Y))return null;const {distance:ea,units:ja}=this.filter,la=this.spatialRelationship;Y="mesh"===Y.type?Y.extent:Y;if(k.isNone(ea)||0===ea)return G(Y,la);const ia=ja||e.getUnitString(Y.spatialReference);if(Y.spatialReference.isWGS84)return Y=this._geometryEngine.geodesicBuffer(Y,ea,ia),G(Y,la);var ca=A.project(Y,D.WGS84);if(k.isSome(ca))return Y=A.project(this._geometryEngine.geodesicBuffer(ca,ea,ia),Y.spatialReference),G(Y,la);if(!this._projectionEngineLoaded&&
(this.loadAsyncModule(x.load().then(()=>this._projectionEngineLoaded=!0)),!this._projectionEngineLoaded))return null;ca=null;try{ca=x.project(Y,D.WGS84)}catch(fa){}if(ca)try{ca=x.project(this._geometryEngine.geodesicBuffer(ca,ea,ia),Y.spatialReference)}catch(fa){ca=null}ca||P.error(`Filter by geodesic buffer (distance) unsupported, failed to project input geometry (${Y.spatialReference.wkid}) to WGS84.`);return G(ca,la)}},{key:"spatialRelationship",get:function(){return k.isSome(this.filter)?this.filter.spatialRelationship:
"intersects"}}]);return aa}(w);g.__decorate([m.property({type:p})],b.I3SMeshViewFilter.prototype,"filter",void 0);g.__decorate([m.property()],b.I3SMeshViewFilter.prototype,"layerFieldsIndex",void 0);g.__decorate([m.property()],b.I3SMeshViewFilter.prototype,"loadAsyncModule",void 0);g.__decorate([m.property()],b.I3SMeshViewFilter.prototype,"applyFilters",void 0);g.__decorate([m.property()],b.I3SMeshViewFilter.prototype,"addSqlFilter",void 0);g.__decorate([m.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,
"sortedObjectIds",null);g.__decorate([m.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"parsedWhereClause",null);g.__decorate([m.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"parsedGeometry",null);g.__decorate([m.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"spatialRelationship",null);g.__decorate([m.property()],b.I3SMeshViewFilter.prototype,"_projectionEngineLoaded",void 0);g.__decorate([m.property()],b.I3SMeshViewFilter.prototype,"_geometryEngine",void 0);b.I3SMeshViewFilter=
g.__decorate([q.subclass("esri.views.3d.layers.i3s.I3SMeshViewFilter")],b.I3SMeshViewFilter);let N;const R=["contains","intersects","disjoint"];var S;(function(U){U[U.KEEP=0]="KEEP";U[U.DISCARD=1]="DISCARD";U[U.TEST=2]="TEST"})(S||(S={}));const T=[0,0,0,0],V=2**-32,W=u.create();Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SQueryEngine":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Error ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/graphics/data/QueryEngine ../../../../rest/support/FeatureSet ../../../../rest/support/Query".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q){const t=z.default;a.I3SQueryEngine=function(r){function x(E){E=r.call(this,E)||this;E._dataQueryEngineInstance=null;E._handles=new w;return E}b._inheritsLoose(x,r);var u=x.prototype;u.initialize=function(){this._handles.add(this.layerView.on("visible-geometry-changed",()=>this.spatialIndex.events.emit("changed")))};u.destroy=function(){this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null);this._handles&&
(this._handles.destroy(),this._handles=null);this._set("layerView",null)};u.executeQueryForCount=function(){var E=b._asyncToGenerator(function*(y,A){return this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(y),A)});return function(y,A){return E.apply(this,arguments)}}();u.executeQueryForExtent=function(){var E=b._asyncToGenerator(function*(y,A){const {count:p,extent:B}=yield this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(y),A);y=m.fromJSON(B);return{count:p,extent:y}});
return function(y,A){return E.apply(this,arguments)}}();u.executeQueryForIds=function(){var E=b._asyncToGenerator(function*(y,A){return this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(y),A)});return function(y,A){return E.apply(this,arguments)}}();u.executeQuery=function(){var E=b._asyncToGenerator(function*(y,A){y=this._ensureQueryJSON(y);if(y.returnGeometry)throw new h("feature-store:unsupported-query","returnGeometry is not yet supported for mesh scene layer queries");if(y.returnCentroid)throw new h("feature-store:unsupported-query",
"returnCentroid is not yet supported for mesh scene layer queries");A=yield this.dataQueryEngine.executeQuery(y,A);A=v.fromJSON(A);A.features.forEach(p=>{p.geometry=null});return A});return function(y,A){return E.apply(this,arguments)}}();u._ensureQueryJSON=function(E){if(n.isNone(E))return this.defaultQueryJSON;const y=E.toJSON();y.outSpatialReference||(E.outSpatialReference=this.spatialReference);return y};u._ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;
const E=this.layer.objectIdField||"OBJECTID",y=this.layer.fields.map(B=>B.toJSON()),A=this.layerView.view.resourceController.scheduler,p=this.spatialReference.toJSON();return this._dataQueryEngineInstance=new t({hasZ:!0,hasM:!1,geometryType:"esriGeometryPolygon",fields:y,timeInfo:null,spatialReference:p,objectIdField:E,featureStore:this.spatialIndex,scheduler:A,priority:this.priority})};b._createClass(x,[{key:"defaultQueryJSON",get:function(){return(new q({outSpatialReference:this.spatialReference})).toJSON()}},
{key:"dataQueryEngine",get:function(){return this._ensureDataQueryEngine()}}]);return x}(g);c.__decorate([f.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"layerView",void 0);c.__decorate([f.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"priority",void 0);c.__decorate([f.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"spatialIndex",void 0);c.__decorate([f.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],a.I3SQueryEngine.prototype,"spatialReference",
void 0);c.__decorate([f.property({readOnly:!0,aliasOf:"layerView.i3slayer"})],a.I3SQueryEngine.prototype,"layer",void 0);c.__decorate([f.property({readOnly:!0})],a.I3SQueryEngine.prototype,"defaultQueryJSON",null);a.I3SQueryEngine=c.__decorate([d.subclass("esri.views.3d.layers.i3s.I3SQueryEngine")],a.I3SQueryEngine);a.default=a.I3SQueryEngine;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SQueryFeatureAdapter":function(){define("exports ../../../../core/maybe ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/centroid ../../../../layers/graphics/OptimizedGeometry ./I3SUtil".split(" "),
function(a,b,c,g,h,w){let n=function(){function l(e){this.objectIdField=e.objectIdField;this.getFeatureExtent=e.getFeatureExtent}var k=l.prototype;k.getObjectId=function(e){return e.id};k.getAttributes=function(e){const {meta:d,index:m}=e,z={};this.objectIdField&&(z[this.objectIdField]=e.id);e=b.isSome(d.attributeInfo)&&d.attributeInfo.attributeData;if(b.isSome(e))for(const v of Object.keys(e))z[v]=w.getCachedAttributeValue(e[v],m);return z};k.getAttribute=function(e,d){if(d===this.objectIdField)return e.id;
const {meta:m,index:z}=e;e=b.isSome(m.attributeInfo)&&m.attributeInfo.attributeData;return b.isSome(e)?w.getCachedAttributeValue(e[d],z):null};k.getGeometry=function(e){if(e.geometry)return e.geometry;const [d,m,z,v,q]=this.getFeatureExtent(e,f);return new h([5],[d,m,z,v,m,z,v,q,z,d,q,z,d,m,z])};k.getCentroid=function(e,d){if(e.geometry)return g.getCentroidOptimizedGeometry(new h,e.geometry,d.hasZ,d.hasM);const [m,z,v,q,t,r]=this.getFeatureExtent(e,f);return new h([0],[(m+q)/2,(z+t)/2,(v+r)/2])};
k.cloneWithGeometry=function(e,d){const {id:m,index:z,meta:v}=e;return{id:m,index:z,meta:v,geometry:d}};return l}();const f=c.create();a.I3SQueryFeatureAdapter=n;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SQueryFeatureStore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../II3SMeshView3D".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v){a.I3SQueryFeatureStore=function(x){function u(y){y=x.call(this,y)||this;y.events=new h;return y}b._inheritsLoose(u,x);var E=u.prototype;E.forEach=function(y){this.forAllFeatures(A=>{y(A);return v.ForAllFeaturesReturnType.CONTINUE})};E.forEachBounds=function(y,A,p){const B=this.getFeatureExtent;for(const D of y)A(B(D,p))};E.forEachInBounds=function(y,A){this.forAllFeatures(p=>{const B=this.getFeatureExtent(p,t);z.intersects(y,m.toRect(B,r))&&A(p);return v.ForAllFeaturesReturnType.CONTINUE},
p=>{d.projectBoundingSphere(p.node.mbs,this.sourceSpatialReference,q,this.viewSpatialReference);if(q[0]>=y[0]&&q[2]<=y[2]&&q[1]>=y[1]&&q[3]<=y[3])return v.ForAllFeaturesReturnType.CONTINUE;p=q[0]-Math.max(y[0],Math.min(q[0],y[2]));const B=q[1]-Math.max(y[1],Math.min(q[1],y[3]));return p*p+B*B<=q[3]*q[3]?v.ForAllFeaturesReturnType.CONTINUE:v.ForAllFeaturesReturnType.SKIP})};return u}(g);c.__decorate([w.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"featureAdapter",void 0);c.__decorate([w.property({constructOnly:!0})],
a.I3SQueryFeatureStore.prototype,"forAllFeatures",void 0);c.__decorate([w.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"getFeatureExtent",void 0);c.__decorate([w.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"sourceSpatialReference",void 0);c.__decorate([w.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"viewSpatialReference",void 0);a.I3SQueryFeatureStore=c.__decorate([k.subclass("esri.views.3d.layers.i3s.I3SQueryFeatureStore")],a.I3SQueryFeatureStore);
const q=e.create(),t=m.create(),r=z.create();a.default=a.I3SQueryFeatureStore;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/3d/layers/support/DefinitionExpressionSceneLayerView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../core/sql/WhereClause ../i3s/I3SUtil".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){const d=g.getLogger("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView");a.DefinitionExpressionSceneLayerView=m=>{m=function(z){function v(){var t=z.apply(this,arguments)||this;t._definitionExpressionErrors=0;t._maxDefinitionExpressionErrors=20;t.logError=r=>{t._definitionExpressionErrors<t._maxDefinitionExpressionErrors&&d.error("Error while evaluating definitionExpression: "+r);t._definitionExpressionErrors++;t._definitionExpressionErrors===t._maxDefinitionExpressionErrors&&
d.error("Further errors are ignored")};return t}b._inheritsLoose(v,z);var q=v.prototype;q._evaluateClause=function(t,r){try{return t.testFeature(r)}catch(x){return this.logError(x),!1}};q._addDefinitionExpressionToQuery=function(t){if(!this.parsedDefinitionExpression)return t;const r=this.i3slayer.definitionExpression;t=t.clone();t.where=t.where?`(${r}) AND (${t.where})`:r;return t};b._createClass(v,[{key:"parsedDefinitionExpression",get:function(){if(!this.i3slayer||!this.i3slayer.definitionExpression)return null;
try{const t=k.WhereClause.create(this.i3slayer.definitionExpression,this.i3slayer.fieldsIndex);if(!t.isStandardized)return d.error("definitionExpression is using non standard function"),null;const r=[];e.findFieldsCaseInsensitive(t.fieldNames,this.i3slayer.fields,{missingFields:r});if(0<r.length)return d.error(`definitionExpression references unknown fields: ${r.join(", ")}`),null;this._definitionExpressionErrors=0;return t}catch(t){return d.error("Failed to parse definitionExpression: "+t),null}}},
{key:"definitionExpressionFields",get:function(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:null}}]);return v}(m);c.__decorate([h.property()],m.prototype,"i3slayer",void 0);c.__decorate([h.property({readOnly:!0})],m.prototype,"parsedDefinitionExpression",null);c.__decorate([h.property({readOnly:!0})],m.prototype,"definitionExpressionFields",null);return m=c.__decorate([l.subclass("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],m)};Object.defineProperty(a,
"__esModule",{value:!0})})},"esri/views/3d/layers/support/fieldProperties":function(){define(["exports","../../../../layers/support/fieldUtils"],function(a,b){a.defineFieldProperties=function(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,get:function(){const {layer:c,layer:{fieldsIndex:g},requiredFields:h}=this;return c.outFields?b.fixFields(g,[...b.unpackFieldNames(g,c.outFields),...h]):b.fixFields(g,h)}}}};Object.defineProperty(a,"__esModule",{value:!0})})},
"esri/views/3d/layers/support/SceneLayerViewRequiredFields":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/AsyncUpdate ../../../../core/HandleOwner ../../../../core/Logger ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/fieldUtils".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m){function z(t){return v.apply(this,arguments)}function v(){v=b._asyncToGenerator(function*(t){const r=new Set;try{return yield t(r),Array.from(r).sort()}catch(x){return q.error(x),null}});return v.apply(this,arguments)}const q=w.getLogger("esri.views.3d.layers.support.SceneLayerViewRequiredFields");a.SceneLayerViewRequiredFields=function(t){function r(x){return t.call(this,x)||this}b._inheritsLoose(r,t);r.prototype.initialize=function(){this.layer=this.layerView.layer;
this.handles.add([this.autoUpdateAsync("rendererFields",()=>{const {fieldsIndex:x,renderer:u}=this.layer;return u?z(E=>u.collectRequiredFields(E,x)):null}),this.autoUpdateAsync("labelingFields",()=>{const {layer:x}=this;return x.labelsVisible?z(u=>m.collectLabelingFields(u,x)):null}),this.autoUpdateAsync("viewFilterFields",()=>{const {layer:x,filter:u}=this.layerView;return z(E=>m.collectFilterFields(E,x,u))})])};b._createClass(r,[{key:"requiredFields",get:function(){const {layerView:{layer:{fieldsIndex:x},
definitionExpressionFields:u},rendererFields:E,labelingFields:y,viewFilterFields:A}=this;return m.fixFields(x,[...n.unwrapOr(u,[]),...n.unwrapOr(E,[]),...n.unwrapOr(y,[]),...n.unwrapOr(A,[])])}}]);return r}(g.AsyncUpdateMixin(h.HandleOwner));c.__decorate([f.property()],a.SceneLayerViewRequiredFields.prototype,"layerView",void 0);c.__decorate([f.property()],a.SceneLayerViewRequiredFields.prototype,"layer",void 0);c.__decorate([f.property()],a.SceneLayerViewRequiredFields.prototype,"requiredFields",
null);c.__decorate([f.property()],a.SceneLayerViewRequiredFields.prototype,"rendererFields",void 0);c.__decorate([f.property()],a.SceneLayerViewRequiredFields.prototype,"labelingFields",void 0);c.__decorate([f.property()],a.SceneLayerViewRequiredFields.prototype,"viewFilterFields",void 0);a.SceneLayerViewRequiredFields=c.__decorate([d.subclass("esri.views.3d.layers.support.SceneLayerViewRequiredFields")],a.SceneLayerViewRequiredFields);Object.defineProperty(a,"__esModule",{value:!0})})},"esri/core/AsyncUpdate":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ./Accessor ./Logger ./accessorSupport/tracking ./accessorSupport/decorators/property ./accessorSupport/decorators/subclass ./accessorSupport/tracking/SimpleTrackingTarget".split(" "),
function(a,b,c,g,h,w,n,f,l){function k(m,z){const v=()=>{if(!q||t)return z();q.clear();t=!0;const r=w.runTracked(q,z);t=!1;return r};let q=new l.SimpleTrackingTarget(()=>{q&&!t&&m(v)}),t=!1;m(v);return{remove:()=>{q&&(q.destroy(),q=null)}}}const e=m=>{m=function(z){function v(){var t=z.apply(this,arguments)||this;t._numUpdating=0;t.asyncUpdateState=new Map;return t}b._inheritsLoose(v,z);var q=v.prototype;q.autoUpdateAsync=function(t,r){return k(x=>this._updateAsync(t,x),r)};q._updateAsync=function(){var t=
b._asyncToGenerator(function*(r,x){if(!this._startAsyncUpdate(r)){try{const u=yield x();this._set(r,u)}catch(u){h.getLogger(this.declaredClass).warn(`Async update of "${r}" failed. Async update functions should not throw exceptions.`)}this._endAsyncUpdate(r)&&this._updateAsync(r,x)}});return function(r,x){return t.apply(this,arguments)}}();q._startAsyncUpdate=function(t){var r;const x=null!=(r=this.asyncUpdateState.get(t))?r:d.None;if(x&d.Updating)return this.asyncUpdateState.set(t,x|d.Invalidated),
!0;++this._numUpdating;this.asyncUpdateState.set(t,x|d.Updating);return!1};q._endAsyncUpdate=function(t){var r;--this._numUpdating;const x=(null!=(r=this.asyncUpdateState.get(t))?r:d.None)&~d.Updating;if(x&d.Invalidated)return this.asyncUpdateState.set(t,x&~d.Invalidated),!0;this.asyncUpdateState.set(t,x);return!1};b._createClass(v,[{key:"updating",get:function(){return 0<this._numUpdating}}]);return v}(m);c.__decorate([n.property({readOnly:!0})],m.prototype,"updating",null);c.__decorate([n.property()],
m.prototype,"_numUpdating",void 0);return m=c.__decorate([f.subclass("esri.core.AsyncUpdate")],m)};var d;(function(m){m[m.None=0]="None";m[m.Updating=1]="Updating";m[m.Invalidated=2]="Invalidated"})(d||(d={}));a.AsyncUpdate=function(m){function z(){return m.apply(this,arguments)||this}b._inheritsLoose(z,m);return z}(e(g));a.AsyncUpdate=c.__decorate([f.subclass("esri.core.AsyncUpdate")],a.AsyncUpdate);a.AsyncUpdateMixin=e;Object.defineProperty(a,"__esModule",{value:!0})})},"esri/views/layers/SceneLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/interfaces ../../core/accessorSupport/tracking ../../core/accessorSupport/extensions/serializableProperty/reader ../../core/accessorSupport/extensions/serializableProperty/writer ./LayerView".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e){g=function(d){function m(){var v=d.apply(this,arguments)||this;v.layer=null;v.filter=null;return v}a._inheritsLoose(m,d);var z=m.prototype;z.highlight=function(v){throw Error("Not implemented");};z.queryFeatures=function(v,q){throw Error("Not implemented");};z.queryObjectIds=function(v,q){throw Error("Not implemented");};z.queryFeatureCount=function(v,q){throw Error("Not implemented");};z.createQuery=function(){throw Error("Not implemented");};z.queryExtent=function(v,
q){throw Error("Not implemented");};a._createClass(m,[{key:"availableFields",get:function(){return[]}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(v){throw Error("Not implemented");}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}}]);return m}(e);b.__decorate([c.property()],g.prototype,"layer",void 0);b.__decorate([c.property()],g.prototype,"availableFields",null);b.__decorate([c.property()],g.prototype,"maximumNumberOfFeatures",null);b.__decorate([c.property({readOnly:!0})],
g.prototype,"maximumNumberOfFeaturesExceeded",null);b.__decorate([c.property()],g.prototype,"filter",void 0);return g})},"esri/views/3d/layers/SceneLayerGraphicsView3D":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/arrayUtils ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../geometry/support/contains ../../../geometry/support/zscale ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/FeatureFilter ../../../rest/support/Query ./I3SPointsWorkerHandle ./interfaces ./LayerView3D ./graphics/Graphics3DFeatureProcessor ./graphics/QueryEngine ./i3s/attributeEditing ./i3s/I3SAttributeOverrides ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/PopupSceneLayerView ./support/SceneLayerViewRequiredFields ../support/debugFlags ../support/GraphicsMap ../support/orientedBoundingBox ../support/updatingProperties ../webgl-engine/lib/basicInterfaces ../../layers/SceneLayerView ../../support/Scheduler".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H,M,K,I,O,Q,J,P,N,R,S,T,V){function W(ja){const la=ja.attributeInfo;for(let ia=0;ia<ja.graphics.length;ia++){const ca=ja.graphics[ia];ca.attributes||(ca.attributes={});if(n.isSome(la)&&n.isSome(la.loadedAttributes))for(const {name:fa}of la.loadedAttributes)la.attributeData[fa]&&(ca.attributes[fa]=M.getCachedAttributeValue(la.attributeData[fa],ia))}}const U=w.getLogger("esri.views.3d.layers.SceneLayerGraphicsView3D");w=I.defineFieldProperties();
C=function(ja){function la(){var ca=ja.apply(this,arguments)||this;ca.type="scene-layer-graphics-3d";ca._nodesAddedToStage=new Map;ca.drapeSourceType=D.DrapeSourceType.Features;ca._queryEngine=null;ca._memCache=null;ca._interactiveEditingSessions=new Map;ca.loadedGraphics=new P.GraphicsMap;ca.holeFilling="always";ca.progressiveLoadFactor=1;ca.supportsHeightUnitConversion=!0;ca._coordinatesOutsideExtentErrors=0;ca._maxCoordinatesOutsideExtentErrors=20;return ca}b._inheritsLoose(la,ja);var ia=la.prototype;
ia.initialize=function(){var ca,fa;const ba=this.layer;this.addResolvingPromise(ba.indexInfo);this._attributeOverrides=new H.I3SAttributeOverrides(this.layer,null==(ca=this.view.resourceController)?void 0:ca.memoryController);M.checkSpatialReferences(ba,this.view.spatialReference,this.view.viewingMode);this.fieldsHelper=new Q.SceneLayerViewRequiredFields({layerView:this});this.updatingHandles.add(()=>ba.rangeInfos,Z=>this._rangeInfosChanged(Z),f.initial);this.updatingHandles.add(()=>ba.renderer,(Z,
ha)=>this._rendererChange(Z,ha));this.updatingHandles.add(()=>[this.parsedDefinitionExpression,this.excludeObjectIdsSorted],()=>this._filterChange());this.updatingHandles.add(()=>this.view.floors,()=>this.processor.filterVisibility.filterChanged());this.handles.add(l.init(J,"I3S_TREE_SHOW_TILES",Z=>{if(Z&&!this._treeDebugger){const ha=this._controller.crsIndex;(new Promise((na,pa)=>a(["./support/I3STreeDebugger"],na,pa))).then(({I3STreeDebugger:na})=>{!this._treeDebugger&&J.I3S_TREE_SHOW_TILES&&(this._treeDebugger=
new na({lv:this,view:this.view,nodeSR:ha}))})}else Z||!this._treeDebugger||J.I3S_TREE_SHOW_TILES||(this._treeDebugger.destroy(),this._treeDebugger=null)}));this._set("processor",new F({owner:this,preferredUpdatePolicy:S.UpdatePolicy.ASYNC,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!1,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,dataExtent:ba.fullExtent,updateClippingExtent:Z=>this._updateClippingExtent(Z)}));null==
(fa=this.processor.elevationAlignment)?void 0:fa.events.on("invalidate-elevation",Z=>this._invalidateElevation(Z));this.supportsHeightUnitConversion&&(this._verticalScale=x.getGeometryZScaler("point",ba.spatialReference,this.view.spatialReference));this.addResolvingPromise(this.processor.setup());this._memCache=this.view.resourceController.memoryController.newCache(ba.uid);this._controller=new y({layerView:this,scaleVisibilityEnabled:!1});M.containsDraco(this.layer.geometryDefinitions)&&(this._worker=
new B.I3SPointsWorkerHandle(Z=>this.view.resourceController.schedule(Z)));this.handles.add(this.layer.on("apply-edits",Z=>this.updatingHandles.addPromise(Z.result)));this.handles.add(this.layer.on("edits",Z=>this._handleEdits(Z)));this.when(()=>{this._queryEngine=new G.default({layerView:this,priority:V.TaskPriority.FEATURE_QUERY_ENGINE});this.updatingHandles.add(()=>this.maximumNumberOfFeatures,Z=>this._controller.featureTarget=Z,f.initial);this.updatingHandles.add(()=>this.suspended,Z=>{Z&&this._removeAllNodeData()})})};
ia.destroy=function(){this._treeDebugger=n.destroyMaybe(this._treeDebugger);this._attributeOverrides=n.destroyMaybe(this._attributeOverrides);this._set("processor",n.destroyMaybe(this.processor));this._controller=n.destroyMaybe(this._controller);this._queryEngine=n.destroyMaybe(this._queryEngine);this._worker=n.destroyMaybe(this._worker);this._memCache=n.destroyMaybe(this._memCache);this._nodesAddedToStage.clear();this.fieldsHelper=n.destroyMaybe(this.fieldsHelper)};ia.whenGraphicAttributes=function(){var ca=
b._asyncToGenerator(function*(fa,ba){return M.whenGraphicAttributes(this.layer,fa,this._getObjectIdField(),ba,()=>[...this._nodesAddedToStage.values()])});return function(fa,ba){return ca.apply(this,arguments)}}();ia.getGraphicFromGraphicUid=function(ca){if(!this.loadedGraphics)return null;const fa=E.hydrateGraphic(this.loadedGraphics.find(Z=>Z.uid===ca),this.layer),ba=this._getObjectIdField();if(!fa||!fa.attributes||!fa.attributes[ba])return null;fa.layer=this.layer;fa.sourceLayer=this.layer;return fa};
ia.whenGraphicBounds=function(ca,fa){return this.processor.whenGraphicBounds(ca,fa)};ia.computeAttachmentOrigin=function(ca,fa){return this.processor.computeAttachmentOrigin(ca,fa)};ia.canResume=function(){return ja.prototype.canResume.call(this)&&(!this._controller||this._controller.rootNodeVisible)};ia.isUpdating=function(){var ca,fa,ba;return!!(null!=(ca=this._controller)&&ca.updating||null!=(fa=this.processor)&&fa.updating||null!=(ba=this.fieldsHelper)&&ba.updating)};ia.highlight=function(ca){return this.processor.highlight(ca,
this.layer.objectIdField)};ia.createInteractiveEditSession=function(ca){return L.createInteractiveEditSession(this.attributeEditingContext,ca)};ia._extractBinaryPointData=function(){var ca=b._asyncToGenerator(function*(fa,ba){fa={geometryBuffer:fa.geometryBuffer};n.isNone(this._worker)&&(this._worker=new B.I3SPointsWorkerHandle(Z=>this.view.resourceController.schedule(Z)));return this._worker.invoke(fa,ba).then(Z=>{if(n.isSome(Z))return{positionData:Z.positions,featureIds:Z.featureIds};throw Error("Failed to decompress Draco point data");
})});return function(fa,ba){return ca.apply(this,arguments)}}();ia._checkExtent=function(ca,fa){ca&&!r.extentContainsCoords3D(ca,fa)&&(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&U.error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&U.error("Maximum number of errors reached. Further errors are ignored."),this._coordinatesOutsideExtentErrors++)};ia.addNode=function(){var ca=b._asyncToGenerator(function*(fa,
ba,Z){if(!("geometryBuffer"in ba&&null!==ba.geometryBuffer||"pointData"in ba))return Promise.reject();if(this._nodesAddedToStage.has(fa.index))U.error("I3S node "+fa.id+" already added");else{if(n.isSome(this.layer.fullExtent)){var ha=this.layer.fullExtent.clone();ha.xmin-=.5;ha.ymin-=.5;ha.xmax+=.5;ha.ymax+=.5;ha.hasZ&&(ha.zmin-=.5,ha.zmax+=.5);ha.hasM&&(ha.mmin-=.5,ha.mmax+=.5)}else ha=null;var na=this._controller.crsVertex,pa=[],xa={graphics:null,featureIds:null,attributeInfo:ba.attributeDataInfo,
node:fa};"geometryBuffer"in ba&&null!==ba.geometryBuffer?yield this._addNodeBinaryPointData(fa,xa,ba,ha,pa,Z):"pointData"in ba&&this._addNodeLegacyPointData(fa,xa,ba,ha,pa);yield this._attributeOverrides.apply(xa.featureIds,ba.attributeDataInfo,Z);fa.numFeatures=xa.graphics.length;this._updateNodeMemory(fa);W(xa);0<pa.length&&(this._computeObb(fa,pa,na),this._controller.updateVisibility(fa.index));if(!this._controller.isGeometryVisible(fa))return this._cacheNodeData(xa),Promise.resolve();if(n.isSome(this._verticalScale))for(const Da of xa.graphics)this._verticalScale(Da.geometry);
this._nodesAddedToStage.set(fa.index,xa);this.loadedGraphics.addMany(xa.graphics);this._filterNode(xa);this._treeDebugger&&this._treeDebugger.update();return Promise.resolve()}});return function(fa,ba,Z){return ca.apply(this,arguments)}}();ia._computeObb=function(ca,fa,ba){const Z=this._controller.crsIndex,ha=Z.isGeographic?this.view.renderSpatialReference:Z;q.projectBuffer(fa,ba,0,fa,ha,0,fa.length/3);ca.serviceObb=N.compute({data:fa,size:3});Z.isGeographic&&q.projectVectorToVector(ca.serviceObb.center,
ha,ca.serviceObb.center,Z)};ia.isNodeLoaded=function(ca){return this._nodesAddedToStage.has(ca)};ia.isNodeReloading=function(){return!1};ia.updateNodeState=function(){};ia._addNodeBinaryPointData=function(){var ca=b._asyncToGenerator(function*(fa,ba,Z,ha,na,pa){var xa=yield this._extractBinaryPointData(Z,pa);if(null==xa)return Promise.reject();Z=this._getObjectIdField();pa=this._controller.crsVertex;const Da=this.view.spatialReference,ua=this.processor.graphicsCore,{positionData:Fa,featureIds:qa}=
xa;xa=Fa.length/3;const sa=[];for(let Ja=0;Ja<xa;Ja++){var ma=n.isSome(fa.serviceObb)?fa.serviceObb.center:[0,0,0],ra=3*Ja,va=v.fromValues(Fa[ra+0],Fa[ra+1],Fa[ra+2]);z.add(va,va,ma);fa.serviceObb||na.push(va[0],va[1],va[2]);n.isSome(ha)&&this._checkExtent(ha,va);ra=qa[Ja];ma={};null!=ra&&(ma[Z]=ra);ra=null==ra?g.generateUID():ra;q.projectBuffer(va,pa,0,da,Da,0,1);va=u.makeDehydratedPoint(da[0],da[1],da[2],Da);var Ia=this.loadedGraphics.get(ra);n.isSome(Ia)?(Ia.level<fa.level&&(Y.property="geometry",
Y.graphic=Ia,Y.oldValue=n.unwrap(Ia.geometry),Y.newValue=va,Ia.geometry=va,ua.graphicUpdateHandler(Y)),sa.push(Ia)):(Ia=g.generateUID(),sa.push({objectId:ra,uid:Ia,geometry:va,attributes:ma,visible:!0,level:fa.level}))}ba.graphics=sa;ba.featureIds=Array.from(qa)});return function(fa,ba,Z,ha,na,pa){return ca.apply(this,arguments)}}();ia._addNodeLegacyPointData=function(ca,fa,ba,Z,ha){const na=this._getObjectIdField(),pa=this._controller.crsVertex,xa=this.view.spatialReference,Da=[0,0,0],ua=[],Fa=[];
for(const ma of ba.pointData){ba=ma.featureDataPosition;const ra=ba.length;var qa=ma.geometries&&ma.geometries[0]||aa[ra];const va=ma.featureIds[0];if("points"!==qa.params.type)continue;n.isSome(Z)&&this._checkExtent(Z,ba);const Ia={};null!=va&&(Ia[na]=va);const Ja=null==va?g.generateUID():va;let Ha;"Embedded"===qa.type&&(Ha=qa.params.vertexAttributes.position);for(qa=0;qa<Ha.length;qa+=ra){for(var sa=0;sa<ra;sa++)Da[sa]=ba[sa]+Ha[qa+sa];sa=3===ra;ca.serviceObb||ha.push(Da[0],Da[1],sa?Da[2]:0);q.projectBuffer(Da,
pa,0,da,xa,0,1);sa=u.makeDehydratedPoint(da[0],da[1],sa?da[2]:void 0,xa);const Ta=this.loadedGraphics.get(Ja);n.isSome(Ta)?Fa.push(Ta):Fa.push({objectId:Ja,uid:g.generateUID(),geometry:sa,attributes:Ia,visible:!0})}ua.push(va)}fa.graphics=Fa;fa.featureIds=ua};ia._updateNodeMemory=function(ca){ca.memory=4096+(n.isSome(ca.numFeatures)?ca.numFeatures*this.processor.graphicsCore.usedMemoryPerGraphic:0)};ia._cacheNodeData=function(ca){const fa=ca.graphics.reduce((ba,Z)=>u.estimateSize(Z)+ba,8*ca.featureIds.length+
1536);this._memCache.put(this._getMemCacheKey(ca.node),ca,fa)};ia._getMemCacheKey=function(ca){return`${ca.index}`};ia._removeAllNodeData=function(){this._nodesAddedToStage.forEach(ca=>{ca&&(this._updateNodeMemory(ca.node),this._cacheNodeData(ca))});this._nodesAddedToStage.clear();this._treeDebugger&&this._treeDebugger.update();this.loadedGraphics.clear()};ia.removeNode=function(ca){if(ca=this._removeNodeStageData(ca))this._updateNodeMemory(ca.node),this._cacheNodeData(ca)};ia._removeNodeStageData=
function(ca){const fa=this._nodesAddedToStage.get(ca);if(!fa)return null;this.loadedGraphics.removeMany(fa.graphics);this._nodesAddedToStage.delete(ca);this._treeDebugger&&this._treeDebugger.update();return fa};ia.loadCachedNodeData=function(){var ca=b._asyncToGenerator(function*(fa){return this._memCache.pop(this._getMemCacheKey(fa))});return function(fa){return ca.apply(this,arguments)}}();ia.addCachedNodeData=function(){var ca=b._asyncToGenerator(function*(fa,ba,Z,ha){if(this._nodesAddedToStage.has(fa.index))U.error("I3S node "+
fa.id+" already added");else return this.loadedGraphics.addMany(ba.graphics),this._nodesAddedToStage.set(fa.index,ba),this._updateNodeMemory(fa),yield this.updateAttributes(fa.index,Z,ha),this._filterNode(ba),this._treeDebugger&&this._treeDebugger.update(),Promise.resolve()});return function(fa,ba,Z,ha){return ca.apply(this,arguments)}}();ia.getLoadedNodeIds=function(){const ca=[];this._nodesAddedToStage.forEach(fa=>ca.push(fa.node.id));return ca.sort()};ia.getVisibleNodes=function(){const ca=[];
this._nodesAddedToStage.forEach(fa=>ca.push(fa.node));return ca};ia.getLoadedNodeIndices=function(ca){this._nodesAddedToStage.forEach((fa,ba)=>ca.push(ba))};ia.getLoadedAttributes=function(ca){if((ca=this._nodesAddedToStage.get(ca))&&n.isSome(ca.attributeInfo))return ca.attributeInfo.loadedAttributes};ia.getAttributeData=function(ca){if((ca=this._nodesAddedToStage.get(ca))&&n.isSome(ca.attributeInfo))return ca.attributeInfo.attributeData};ia._setAttributeData=function(ca,fa){(ca=this._nodesAddedToStage.get(ca))&&
!n.isNone(ca.attributeInfo)&&(ca.attributeInfo.attributeData=fa,this._attributeValuesChanged(ca))};ia.updateAttributes=function(){var ca=b._asyncToGenerator(function*(fa,ba,Z){if(fa=this._nodesAddedToStage.get(fa))yield this._attributeOverrides.apply(fa.featureIds,ba,Z),fa.attributeInfo=ba,this._attributeValuesChanged(fa)});return function(fa,ba,Z){return ca.apply(this,arguments)}}();ia._attributeValuesChanged=function(ca){W(ca);this._filterNode(ca);this.processor.graphicsCore.labelsEnabled&&(ca=
ca.graphics.map(fa=>fa.uid),this.processor.graphicsCore.updateLabelingInfo(ca))};ia._updateClippingExtent=function(ca){this._controller&&this._controller.updateClippingArea(ca);return!1};ia._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"};ia._rendererChange=function(){var ca=b._asyncToGenerator(function*(fa,ba){const {layer:{fieldsIndex:Z}}=this,ha=new Set;let na;fa?(yield fa.collectRequiredFields(ha,Z),na=Array.from(ha).sort()):na=[];ha.clear();let pa;ba?(yield ba.collectRequiredFields(ha,
Z),pa=Array.from(ha).sort()):pa=[];na.length===pa.length&&na.every((xa,Da)=>na[Da]===pa[Da])||this._reloadAllNodes()});return function(fa,ba){return ca.apply(this,arguments)}}();ia._rangeInfosChanged=function(ca){null!=ca&&0<ca.length&&U.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};ia._filterChange=function(){this._nodesAddedToStage.forEach(ca=>this._filterNode(ca))};ia._reloadAllNodes=function(){this._removeAllNodeData();
this._controller&&this._controller.restartNodeLoading()};ia._filterNode=function(ca){const fa=this.parsedDefinitionExpression,ba=this.excludeObjectIdsSorted,Z=this._getObjectIdField();for(const ha of ca.graphics){ca=ha.visible;const na=!fa||this._evaluateClause(fa,ha),pa=n.isNone(ba)||0>h.binaryIndexOf(ba,ha.attributes[Z]);ha.visible=na&&pa;ca!==ha.visible&&(Y.graphic=ha,Y.property="visible",Y.oldValue=ca,Y.newValue=ha.visible,this.processor.graphicsCore.graphicUpdateHandler(Y))}};ia._invalidateElevation=
function(ca){const fa=this._controller.crsIndex;q.projectBoundingRect(ca.extent,ca.spatialReference,ea,fa);this._controller.updateElevationChanged(ea,fa)};ia.createQuery=function(){const ca={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return n.isSome(this.filter)?this.filter.createQuery(ca):new p(ca)};ia.queryFeatures=function(ca,fa){return this._queryEngine.executeQuery(this._ensureQuery(ca),null==fa?void 0:fa.signal)};ia.queryObjectIds=function(ca,fa){return this._queryEngine.executeQueryForIds(this._ensureQuery(ca),
null==fa?void 0:fa.signal)};ia.queryFeatureCount=function(ca,fa){return this._queryEngine.executeQueryForCount(this._ensureQuery(ca),null==fa?void 0:fa.signal)};ia.queryExtent=function(ca,fa){return this._queryEngine.executeQueryForExtent(this._ensureQuery(ca),null==fa?void 0:fa.signal)};ia._ensureQuery=function(ca){return this._addDefinitionExpressionToQuery(n.isNone(ca)?this.createQuery():p.from(ca))};ia.getUsedMemory=function(){var ca,fa,ba;return null!=(ca=null==(fa=this.processor)?void 0:null==
(ba=fa.graphicsCore)?void 0:ba.usedMemory)?ca:0};ia.getUnloadedMemory=function(){var ca,fa,ba,Z,ha;return.8*((null!=(ca=null==(fa=this._controller)?void 0:fa.unloadedMemoryEstimate)?ca:0)+(null!=(ba=null==(Z=this.processor)?void 0:null==(ha=Z.graphicsCore)?void 0:ha.unprocessedMemoryEstimate)?ba:0))};ia.ignoresMemoryFactor=function(){return this._controller&&this._controller.fixedFeatureTarget};ia._handleEdits=function(ca){L.processAttributeEdits(this.attributeEditingContext,ca)};b._createClass(la,
[{key:"requiredFields",get:function(){var ca,fa;return null!=(ca=null==(fa=this.fieldsHelper)?void 0:fa.requiredFields)?ca:[]}},{key:"maximumNumberOfFeatures",get:function(){var ca,fa,ba;const Z=null==(ca=this.processor)?void 0:null==(fa=ca.graphicsCore)?void 0:fa.displayFeatureLimit;return null!=(ba=null==Z?void 0:Z.maximumNumberOfFeatures)?ba:0},set:function(ca){null!=ca?(this._override("maximumNumberOfFeatures",ca),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),
this._controller.fixedFeatureTarget=!1)}},{key:"maximumNumberOfFeaturesExceeded",get:function(){var ca;return this.suspended?!1:!(null==(ca=this._controller)||!ca.useMaximumNumberOfFeatures)&&!this._controller.leavesReached}},{key:"excludeObjectIdsSorted",get:function(){const ca=this.layer.excludeObjectIds;return ca.length?ca.toArray().sort((fa,ba)=>fa-ba):null}},{key:"hasM",get:function(){return!1}},{key:"hasZ",get:function(){return!0}},{key:"updatePolicy",get:function(){return this.processor.graphicsCore.effectiveUpdatePolicy}},
{key:"attributeEditingContext",get:function(){const ca=this._getObjectIdField();return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:ca,forEachNode:fa=>this._nodesAddedToStage.forEach(ba=>fa(ba.node,ba.featureIds)),attributeStorageInfo:this.i3slayer.attributeStorageInfo,attributeOverrides:this._attributeOverrides,getAttributeData:fa=>this.getAttributeData(fa),setAttributeData:(fa,ba,Z)=>{this._setAttributeData(fa,ba);fa=this._nodesAddedToStage.get(fa);
n.isSome(Z)?(Z=this.loadedGraphics.get(Z.attributes[ca]),n.isSome(Z)&&this.processor.graphicsCore.recreateGraphics([Z])):n.isSome(fa)&&this.processor.graphicsCore.recreateGraphics(fa.graphics)},clearMemCache:()=>{}}}},{key:"performanceInfo",get:function(){const ca={displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:this.maximumNumberOfFeatures,totalNumberOfFeatures:-1,nodes:this._nodesAddedToStage.size,core:this.processor.graphicsCore.performanceInfo};this._controller&&this._controller.updateStats(ca);
return ca}},{key:"test",get:function(){return{controller:this._controller,numNodes:this._nodesAddedToStage.size,numFeatures:this.loadedGraphics.length}}}]);return la}(K.DefinitionExpressionSceneLayerView(O.PopupSceneLayerView(C.LayerView3D(T))));c.__decorate([k.property()],C.prototype,"processor",void 0);c.__decorate([k.property({type:A})],C.prototype,"filter",void 0);c.__decorate([k.property()],C.prototype,"loadedGraphics",void 0);c.__decorate([k.property({aliasOf:"layer"})],C.prototype,"i3slayer",
void 0);c.__decorate([k.property()],C.prototype,"_controller",void 0);c.__decorate([k.property()],C.prototype,"updating",void 0);c.__decorate([k.property()],C.prototype,"suspended",void 0);c.__decorate([k.property()],C.prototype,"holeFilling",void 0);c.__decorate([k.property(R.updatingProgress)],C.prototype,"updatingProgress",void 0);c.__decorate([k.property({aliasOf:"_controller.updatingProgress"})],C.prototype,"updatingProgressValue",void 0);c.__decorate([k.property(w.requiredFields)],C.prototype,
"requiredFields",null);c.__decorate([k.property(w.availableFields)],C.prototype,"availableFields",void 0);c.__decorate([k.property()],C.prototype,"fieldsHelper",void 0);c.__decorate([k.property({type:Number})],C.prototype,"maximumNumberOfFeatures",null);c.__decorate([k.property({readOnly:!0})],C.prototype,"maximumNumberOfFeaturesExceeded",null);c.__decorate([k.property()],C.prototype,"excludeObjectIdsSorted",null);c.__decorate([k.property({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.point.lodFactor"})],
C.prototype,"lodFactor",void 0);c.__decorate([k.property({readOnly:!0})],C.prototype,"hasM",null);c.__decorate([k.property({readOnly:!0})],C.prototype,"hasZ",null);c=C=c.__decorate([m.subclass("esri.views.3d.layers.SceneLayerGraphicsView3D")],C);const aa={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},da=v.create(),Y={graphic:null,property:null,oldValue:null,newValue:null},ea=t.create();return c})},
"esri/views/3d/layers/I3SPointsWorkerHandle":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/workers/WorkerHandle"],function(a,b,c){c=function(g){function h(w){return g.call(this,"SceneLayerWorker","dracoDecompressPointCloudData",w,{hasInitialize:!0})||this}b._inheritsLoose(h,g);h.prototype.getTransferList=function(w){return[w.geometryBuffer]};return h}(c.WorkerHandle);a.I3SPointsWorkerHandle=c;Object.defineProperty(a,"__esModule",{value:!0})})},"*noref":1}});
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../Camera ../geometry ../Graphic ../Ground ../Viewpoint ../core/Collection ../core/domUtils ../core/Error ../core/events ../core/handleUtils ../core/has ../core/iteratorUtils ../core/Logger ../core/maybe ../core/ObservableChangesType ../core/promiseUtils ../core/reactiveUtils ../core/scheduling ../core/workers/workers ../core/screenUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/subclass ../core/accessorSupport/ensureType ../chunks/vec3f64 ../core/support/OwningCollection ../geometry/HeightModelInfo ../geometry/projection ../geometry/support/aaBoundingRect ../chunks/boundedPlane ../geometry/support/coordinateSystem ../geometry/support/scaleUtils ../layers/VoxelWasmManager ../layers/support/layerUtils ../support/AnalysesCollection ./BreakpointsOwner ./DOMContainer ./GroundView ./PopupView ./View ./ViewAnimation ./ViewingMode ./3d/layerViewModuleImportUtils ./3d/analysis/AnalysisViewManager3D ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/input/SceneInputManager ./3d/layers/graphics/GraphicsDeconflictor ./3d/layers/graphics/Labeler ./3d/layers/graphics/ObjectResourceCache ./3d/layers/support/FeatureTileTree3D ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/state/helpers/SceneIntersectionHelper ./3d/support/CombinedElevationProvider ./3d/support/debugFlags ./3d/support/DisplayQualityProfile ./3d/support/ElevationProvider ./3d/support/HighlightOptions ./3d/support/MapCoordsHelper ./3d/support/PropertiesPool ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/ResourceController ./3d/support/SceneViewPerformanceInfo ./3d/support/SharedSymbolResources ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/Intersector ./3d/webgl-engine/lib/IntersectorInterfaces ./3d/webgl-engine/lib/intersectorUtils ./3d/webgl-engine/lib/intersectorUtilsConversions ./3d/webgl-engine/lib/verticalOffsetUtils ./support/hitTestSelectUtils ./support/layerViewUtils ./support/screenshotUtils ./support/screenUtils ./support/spatialReferenceSupport ./support/WebGLRequirements ./ui/3d/DefaultUI3D ../webscene/Environment ../geometry/SpatialReference ../geometry/Point ../geometry/Extent".split(" "),
function(a,b,c,g,h,w,n,f,l,k,e,d,m,z,v,q,t,r,x,u,E,y,A,p,B,D,C,F,G,L,H,M,K,I,O,Q,J,P,N,R,S,T,V,W,U,aa,da,Y,ea,ja,la,ia,ca,fa,ba,Z,ha,na,pa,xa,Da,ua,Fa,qa,sa,ma,ra,va,Ia,Ja,Ha,Ta,db,fb,ka,cb,Ca,Ka,Oa,wa,Aa,Na,Ua,Ya,ya,La,Va,hb,kb,ib,ob){function sb(lb,tb){lb.layerUids||(lb.layerUids=new Set);lb.layerUids.add(tb)}function $a(lb,tb){return t.isSome(lb)&&M.canProjectWithoutEngine(lb.spatialReference,tb)?M.project(lb,tb):null}const za=q.getLogger("esri.views.SceneView");h=function(lb){function tb(Qa){var Ra=
lb.call(this,Qa)||this;Ra._userClippingArea=null;Ra._clippingArea=null;Ra._initialDefaultSpatialReference=null;Ra._defaults={};Ra._externallySet={environment:!1};Ra._createGraphicsViewController=null;Ra._resolveWhenReady=[];Ra.propertiesPool=new ma.PropertiesPool({slicePlane:I.BoundedPlaneClass},b._assertThisInitialized(Ra));Ra._resourceController=Ia.newResourceController(b._assertThisInitialized(Ra));Ra._defaultToMapOptions={include:new Set};Ra._defaultHitTestOptions={exclude:new Set};Ra.deconflictor=
new ca.GraphicsDeconflictor({view:b._assertThisInitialized(Ra)});Ra.labeler=new fa.Labeler({view:b._assertThisInitialized(Ra),deconflictor:Ra.deconflictor.labels});Ra.sharedSymbolResources=null;Ra.analyses=new N.AnalysesCollection;Ra.basemapTerrain=null;Ra.elevationProvider=null;Ra.camera=null;Ra.canvas=null;Ra.center=null;Ra.constraints=new ea.default;Ra.environmentManager=new la.SceneViewEnvironmentManager;Ra.extent=null;Ra.floors=new l;Ra.windowDevicePixelRatio=1;Ra.fullOpacity=1;Ra.graphicsView=
null;Ra.analysisViewManager=new Y({view:b._assertThisInitialized(Ra)});Ra.groundView=null;Ra.navigating=!1;Ra.map=null;Ra.screenSizePerspectiveEnabled=!0;Ra.state=new ha;Ra.scale=null;Ra.spatialReference=null;Ra.alphaCompositingEnabled=!1;Ra.supersampleScreenshotsEnabled=!0;Ra.type="3d";Ra.ui=new Va;Ra._numUpdating=0;Ra._lastUpdateTime=0;Ra.updatingProgress=.5;Ra.viewpoint=null;Ra.zoom=null;Ra.highlightOptions=new qa;y.initialize();Qa&&Qa.environment||(Ra._defaults.environment=new ja,Ra.environment=
Ra._defaults.environment);const ab=(jb=null)=>{t.isSome(jb)&&jb.type===r.ObservableChangesType.MOVE||(Ra._updatingChanged(),Ra.map&&Ra.map.allLayers.forEach(function(){var pb=b._asyncToGenerator(function*(ub){try{yield ub.when()}catch{}Ra._updatingChanged()});return function(ub){return pb.apply(this,arguments)}}()))};Ra.handles.add([u.on(()=>{var jb;return null==(jb=Ra.map)?void 0:jb.allLayers},"after-changes",jb=>ab(jb),{onListenerAdd:()=>ab(),onListenerRemove:()=>ab(),sync:!0}),Ra.allLayerViews.on("after-changes",
jb=>Ra._updateUpdatingMonitors(jb)),Ra.watch("map",jb=>{jb&&jb.load&&jb.load().catch(()=>{})})]);Ra.inputManager=new ia({view:b._assertThisInitialized(Ra)});Ra.stateManager=new na({view:b._assertThisInitialized(Ra),updateDevicePixelRatio:()=>{const jb=window.devicePixelRatio;jb!==Ra.windowDevicePixelRatio&&(Ra.windowDevicePixelRatio=jb,Ra.notifyChange("pixelRatio"))}});return Ra}b._inheritsLoose(tb,lb);var mb=tb.prototype;mb.initialize=function(){this.groundView=new T({view:this});this._updateUpdatingMonitors();
const Qa=()=>this._updateDefaultToMapOptions();this.handles.add(u.on(()=>{var Ra;return null==(Ra=this.map)?void 0:Ra.allLayers},"after-changes",Qa,{onListenerAdd:Qa,onListenerRemove:Qa}));this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,Ra=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=Ra)},u.initial);this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,Ra=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=
Ra)},u.initial);this.updatingHandles.add(()=>this.qualitySettings.frameRate,Ra=>E.setFrameDuration(0<Ra?1E3/Math.ceil(Ra):0),u.initial);this.updatingHandles.add(()=>Da.SCENEVIEW_LOCKING_LOG,Ra=>this.defaultsFromMap.logDebugInformation=Ra,u.initial);this.updatingHandles.add(()=>{var Ra;return null==(Ra=this.map)?void 0:Ra.ground},Qa,u.syncAndInitial);this.updatingHandles.add(()=>{var Ra,ab;return null==(Ra=this.map)?void 0:null==(ab=Ra.ground)?void 0:ab.opacity},()=>this._updateDefaultHitTestOptions(),
u.syncAndInitial);this.handles.add(this.watch("spatialReference",()=>this.notifyChange("clippingArea"),!0))};mb.destroy=function(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=t.destroyMaybe(this.sharedSymbolResources),this.labeler.destroy(),this._set("labeler",null),this.deconflictor.destroy(),this._set("deconflictor",null),this._resourceController=t.destroyMaybe(this._resourceController),
this.stateManager.destroy(),this._set("stateManager",null),this.inputManager.destroy(),this._set("inputManager",null),this.propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this.environmentManager.destroy(),this._set("environmentManager",null),this.groundView=t.destroyMaybe(this.groundView))};mb.installContentCameraReset=function(Qa={sticky:!1}){return this.stateManager.installContentCameraReset(Qa)};mb.castEnvironment=function(Qa){return Qa?Qa instanceof ja?Qa:Qa instanceof hb?null!=
this.environment?this.environment.cloneWithWebsceneEnvironment(Qa):ja.fromWebsceneEnvironment(Qa):F.ensureType(ja,Qa):new ja};mb.forceAnimationTime=function(Qa){this._stage.renderView.forcedAnimationTime=this.basemapTerrain.overlayManager.forcedAnimationTime=Qa};mb.on=function(Qa,Ra,ab,jb){return(ab=this.viewEvents.on(Qa,Ra,ab,jb))?ab:lb.prototype.on.call(this,Qa,Ra)};mb.hasEventListener=function(Qa){return lb.prototype.hasEventListener.call(this,Qa)||this.viewEvents.hasHandler(Qa)};mb.toMap=function(Qa,
Ra){if(!this.ready)return za.error("#toMap()","Scene view cannot be used before it is ready"),null;Ra=Ra?this.externalToInternalIntersectOptions(Ra):this._defaultToMapOptions;var ab=t.isSome(Ra.graphics)&&(t.isSome(Ra.graphics.include)||t.isSome(Ra.graphics.exclude));Qa=Ya.isSupportedScreenPointEvent(Qa)?Ya.createScreenPointFromSupportedEvent(this,Qa):Qa;Qa=A.screenPointObjectToArray(Qa);Ra.enableDraped=Ra.include&&!Ra.include.has(wa.TERRAIN_ID)||Ra.exclude&&Ra.exclude.has(wa.TERRAIN_ID);const jb=
this.sceneIntersectionHelper,pb=cb.newIntersector(this.state.viewingMode);pb.options.selectionMode=!0;pb.options.store=ab?Ca.StoreResults.ALL:Ca.StoreResults.MIN;jb.intersectIntersectorScreen(Qa,pb,Ra);if(ab){for(const ub of pb.results.all)if(ab=Oa.toGraphic(ub,this),t.isNone(ab)||this._testGraphicUidFilter(Ra.graphics,ab))return this._intersectResultToMapPoint(ub);return null}return this._intersectResultToMapPoint(pb.results.min)};mb.toScreen=function(Qa){if(!this.ready)return za.error("#toScreen()",
"Scene view cannot be used before it is ready"),null;const Ra=t.unwrapOr(null==Qa.z&&Fa.getElevationAtPoint(this.elevationProvider,Qa),0);M.projectPointToVector(Qa,Xa,this.renderSpatialReference,Ra);this.state.camera.projectToScreen(Xa,Za);return A.createScreenPoint(Za[0],Za[1])};mb.pixelSizeAt=function(Qa){if(!this.ready)return za.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if(!Qa)return 0;M.projectPointToVector(Qa,Xa,this.renderSpatialReference);return this.state.camera.computeScreenPixelSizeAt(Xa)};
mb.overlayPixelSizeInMapUnits=function(Qa){const Ra=this.basemapTerrain.overlayManager;return Ra?Ra.overlayPixelSizeInMapUnits(Qa):1};mb.hitTest=function(Qa,Ra){if(!this.ready)return za.error("#hitTest()","Scene view cannot be used before it is ready"),null;Qa=Ya.isSupportedScreenPointEvent(Qa)?Ya.createScreenPointFromSupportedEvent(this,Qa):Qa;var ab=A.createScreenPointArray(Qa.x,Qa.y),jb=Ra?this.externalToInternalIntersectOptions(Ra):this._defaultHitTestOptions;jb.requiresGroundFeedback=!0;jb.enableDraped=
!0;Ra=cb.newIntersector(this.state.viewingMode);Ra.options.selectionMode=!0;Ra.options.store=Ca.StoreResults.ALL;this.sceneIntersectionHelper.intersectIntersectorScreen(ab,Ra,jb);ab=this._intersectResultsToHits(Ra.results.all,jb.graphics);jb=Ra.results.ground;var pb=Oa.toOwner(jb,this);pb=t.isSome(pb)&&"type"in pb&&"integrated-mesh"===pb.type?pb:null;Qa={screenPoint:Qa,results:ab,ground:{mapPoint:this._intersectResultToMapPoint(jb),distance:Ka.isValidIntersectorResult(jb)?jb.distanceInRenderSpace:
0,layer:pb}};Da.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(Qa.intersector=Ra);return Promise.resolve(Qa)};mb.popupHitTest=function(Qa){return Aa.hitTestSelectSameDistance(this,Qa).then(({results:Ra,ground:ab})=>{let jb=null;!(0===Ra.length||1E-5>Math.abs(t.unwrapOr(Ra[0].distance,0)-ab.distance))||ab.layer&&"integrated-mesh"===ab.layer.type||(jb=ab.mapPoint);return{results:Ra,screenPoint:Qa,mapPoint:jb}})};mb.goTo=function(Qa,Ra){return this.updatingHandles.addPromise(this.stateManager.goTo(Qa,Ra))};
mb.whenAnalysisView=function(){var Qa=b._asyncToGenerator(function*(Ra){yield this.whenReady();if(t.isNone(Ra.parent))throw new e("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:Ra});switch(Ra.parent.type){case "analysis":return(yield this.whenLayerView(Ra.parent)).whenAnalysisView(Ra);default:return this.analysisViewManager.whenAnalysisView(Ra)}});return function(Ra){return Qa.apply(this,arguments)}}();mb.whenLayerView=function(Qa){return lb.prototype.whenLayerView.call(this,
Qa)};mb.takeScreenshot=function(Qa){return this.whenReady().then(()=>{const Ra=Ua.toRenderSettings(Qa,this);Ra.pixelRatio/=this.pixelRatio;return this._stage.renderView.takeScreenshot(Ua.screenshotSuperSampleSettings(Ra,this.supersampleScreenshotsEnabled,this.padding))})};mb.addUpdatingPromise=function(Qa){return this.updatingHandles.addPromise(Qa)};mb.importLayerView=function(Qa){return da.layerView3DImporter.importLayerView(Qa)};mb.hasLayerViewModule=function(Qa){return da.layerView3DImporter.hasLayerViewModule(Qa)};
mb.forceDOMReadyCycle=function(){this.forceReadyCycle()};mb.getDefaultSpatialReference=function(){var Qa,Ra,ab,jb;return this.map&&"initialViewProperties"in this.map&&(null==(Qa=this.map)?void 0:null==(Ra=Qa.initialViewProperties)?void 0:Ra.spatialReference)||(null==(ab=this.defaultsFromMap)?void 0:ab.spatialReference)||(null==(jb=this.defaultsFromMap)?void 0:jb.ready)&&this._initialDefaultSpatialReference||null};mb.validate=function(){var Qa=b._asyncToGenerator(function*(){let Ra=La.check(this.type);
z("safari")&&9>z("safari")&&(Ra=new e("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:z("safari")}));if(t.isSome(Ra))throw za.warn("#validate()",Ra.message),Ra;});return function(){return Qa.apply(this,arguments)}}();mb.getSpatialReferenceSupport=function({spatialReference:Qa,layer:Ra}){var ab=this._predeterminedViewingMode;if(t.isSome(ab))return this._validateSpatialReferenceForViewingMode(Qa,Ra,ab)?{constraints:this._makeSpatialReferenceConstraints(Qa,
Ra,ab)}:null;ab=this._validateSpatialReferenceForViewingMode(Qa,Ra,aa.ViewingMode.Local);const jb=this._validateSpatialReferenceForViewingMode(Qa,Ra,aa.ViewingMode.Global);return ab||jb?ab&&jb?{constraints:this._makeSpatialReferenceConstraints(Qa,Ra,null)}:ab?{constraints:this._makeSpatialReferenceConstraints(Qa,Ra,aa.ViewingMode.Local)}:{constraints:this._makeSpatialReferenceConstraints(Qa,Ra,aa.ViewingMode.Global)}:null};mb._validateSpatialReferenceForViewingMode=function(Qa,Ra,ab){return ya.isSpatialReferenceSupported(Qa,
ab)?t.isNone(Ra)||P.isReprojectableTiledLayer(Ra)?!0:P.isTiledLayer(Ra)&&t.isNone(fb.getTiledLayerInfo(Ra,Qa,ab))||P.isVoxelLayer(Ra)&&ab===aa.ViewingMode.Global?!1:!0:!1};mb._makeSpatialReferenceConstraints=function(Qa,Ra,ab){if(t.isNone(Ra))return[{spatialReference:Qa,viewingMode:ab}];const jb=Qa.isWebMercator,pb=Qa.isWGS84;return P.isReprojectableTiledLayer(Ra)&&(jb||pb)?(pb&&ab!==aa.ViewingMode.Local?null===fb.checkIfTileInfoSupportedForView(Ra.tileInfo,Ra.fullExtent,Qa,aa.ViewingMode.Global):
1)?[{spatialReference:Qa,viewingMode:ab},{spatialReference:kb.WebMercator,viewingMode:ab}]:[{spatialReference:jb?kb.WGS84:kb.WebMercator,viewingMode:ab}]:P.isTiledLayer(Ra)||P.isVoxelLayer(Ra)||!jb&&!pb?P.isTiledLayer(Ra)&&jb&&ab!==aa.ViewingMode.Global?[{spatialReference:Qa,viewingMode:ab},{spatialReference:kb.WGS84,viewingMode:aa.ViewingMode.Local}]:[{spatialReference:Qa,viewingMode:ab}]:[{spatialReference:Qa,viewingMode:ab},{spatialReference:jb?kb.WGS84:kb.WebMercator,viewingMode:ab}]};mb._validateSpatialReference=
function(Qa){const Ra=t.isSome(this.getSpatialReferenceSupport({spatialReference:Qa})),ab=this._predeterminedViewingMode;Ra||(t.isSome(ab)?za.warnOnce(`Spatial reference defined on view not supported in ${aa.stringFromViewingMode(ab)} viewing mode.`):Qa.isGeographic&&za.warnOnce("Spatial reference is geographic but not supported."));return Ra};mb.whenReady=function(){return new Promise(Qa=>{this.ready?Qa(this):this._resolveWhenReady.push(Qa)})};mb.computeMapPointFromVec3d=function(Qa,Ra){let ab=this.spatialReference||
kb.WGS84;M.projectVectorToVector(Qa,this.renderSpatialReference,Qa,ab)||(ab=kb.WGS84,M.projectVectorToVector(Qa,this.renderSpatialReference,Qa,ab));Ra?(Ra.x=Qa[0],Ra.y=Qa[1],Ra.z=Qa[2],Ra.spatialReference=ab):Ra=new ib(Qa,ab);return Ra};mb.trackGraphicState=function(Qa){if(!Qa.graphic)return za.error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const Ra=this.getViewForGraphic(Qa.graphic);let ab=null,jb=!1;const pb=ub=>{var rb;!jb&&t.isSome(ub)&&
"processor"in ub&&"graphics-3d"===(null==(rb=ub.processor)?void 0:rb.type)&&ub.processor.graphicsCore&&(ab=ub.processor.graphicsCore.trackGraphicState(Qa))};t.isSome(Ra)?pb(Ra):this.whenViewForGraphic(Qa.graphic,{waitForLayer:!0}).then(ub=>pb(ub),()=>{}).catch(()=>{});return{remove:()=>{jb=!0;t.isSome(ab)&&(ab.remove(),ab=null)}}};mb.highlight=function(Qa){if(Array.isArray(Qa))return m.handlesGroup(Qa.map(ab=>this.highlight(ab)));if(l.isCollection(Qa))return m.handlesGroup(Qa.toArray().map(ab=>this.highlight(ab)));
const Ra=this.getViewForGraphic(Qa);return Ra&&"highlight"in Ra?Ra.highlight(Qa):m.makeHandle()};mb.maskOccludee=function(Qa){if(!Qa)return za.error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const Ra=this.getViewForGraphic(Qa);let ab=null,jb=!1;const pb=ub=>{!jb&&t.isSome(ub)&&Na.occludeesSupported(ub)&&(ab=ub.maskOccludee(Qa))};t.isSome(Ra)?pb(Ra):this.whenViewForGraphic(Qa,{waitForLayer:!0}).then(ub=>pb(ub),()=>{}).catch(()=>{});return{remove:()=>
{jb=!0;t.isSome(ab)&&(ab.remove(),ab=null)}}};mb.getViewForGraphic=function(Qa){return Qa.layer===this.graphics?this.graphicsView:Qa.layer?this.allLayerViews.find(Ra=>Ra.layer===Qa.layer):null};mb.graphicChanged=function(Qa){t.isSome(this.graphicsView)&&this.graphicsView.graphicChanged(Qa)};mb.whenViewForGraphic=function(){var Qa=b._asyncToGenerator(function*(Ra,ab){if(Ra.layer===this)return yield u.whenOnce(()=>this.graphicsView),this.graphicsView;if(!Ra.layer||!this.map)throw new e("no-view-for-graphic");
return ab&&ab.waitForLayer&&!this.map.allLayers.includes(Ra.layer)?new Promise((jb,pb)=>{const ub=this.map.allLayers.on("change",rb=>{-1!==rb.added.indexOf(Ra.layer)&&(ub.remove(),this.whenLayerView(Ra.layer).then(jb,pb))})}):this.whenLayerView(Ra.layer)});return function(Ra,ab){return Qa.apply(this,arguments)}}();mb.externalToInternalIntersectOptions=function(Qa){const Ra=this._externalToInternalRenderItems(Qa.include,Pa.INCLUDE);Qa=this._externalToInternalRenderItems(Qa.exclude,Pa.EXCLUDE);return{include:Ra.layerUids,
exclude:Qa.layerUids,graphics:{include:Ra.graphicUids,exclude:Qa.graphicUids}}};mb._intersectResultToMapPoint=function(Qa,Ra){return Qa.getIntersectionPoint(Xa)?(Ra=this.computeMapPointFromVec3d(Xa,Ra),Qa.intersector===Ca.IntersectorType.TERRAIN&&this.basemapTerrain&&(Ra.z=t.unwrapOr(Fa.getElevationAtPoint(this.basemapTerrain,Ra),0)),Ra):null};mb._intersectResultsToHits=function(Qa,Ra){const ab=[];let jb=null;for(let rb=0;rb<Qa.length;rb++){const Ab=Qa[rb];var pb=Oa.toOwner(Ab,this);if(t.isSome(pb)&&
(pb===this.map.ground||"type"in pb&&"integrated-mesh"===pb.type))break;pb=Oa.toGraphic(Ab,this);if(t.isSome(pb)){t.isNone(jb)&&rb!==Qa.length-1&&(jb=new Set);if(t.isSome(jb)){var ub=this._getGraphicFilterUid(pb);if(jb.has(ub))continue;jb.add(ub)}this._testGraphicUidFilter(Ra,pb)&&(ub=this._intersectResultToMapPoint(Ab),ab.push({graphic:pb,mapPoint:ub,distance:Ab.distanceInRenderSpace}))}}return ab};mb._getGraphicFilterUid=function(Qa){if(Qa.layer&&"objectIdField"in Qa.layer){const Ra=Qa.attributes[Qa.layer.objectIdField];
if(Ra)return`o-${Qa.layer.id}-${Ra}`}return`u-${Qa.uid}`};mb._testGraphicUidFilter=function(Qa,Ra){Ra=this._getGraphicFilterUid(Ra);return t.isNone(Qa)||(t.isNone(Qa.include)||Qa.include.has(Ra))&&(t.isNone(Qa.exclude)||!Qa.exclude.has(Ra))};mb._externalToInternalRenderItems=function(Qa,Ra,ab={layerUids:null,graphicUids:null}){if(!Qa)return ab;if(Qa instanceof w){var jb=this._getGraphicFilterUid(Qa);ab.graphicUids||(ab.graphicUids=new Set);ab.graphicUids.add(jb);Ra===Pa.INCLUDE&&(t.isSome(this.graphicsView)&&
Qa.layer===this?sb(ab,this.graphicsView.processor.layer.id):Qa.layer&&sb(ab,Qa.layer.uid))}else if(v.isIterable(Qa))for(jb of Qa)jb===this.graphics&&t.isSome(this.graphicsView)?sb(ab,this.graphicsView.processor.layer.id):jb instanceof n?jb===this.map.ground&&sb(ab,wa.TERRAIN_ID):this._externalToInternalRenderItems(jb,Ra,ab);else sb(ab,Qa.uid);return ab};mb._initBasemapTerrain=function(){this._set("basemapTerrain",new db({view:this}));this._set("elevationProvider",new xa.CombinedElevationProvider({view:this}));
this.elevationProvider.register("ground",this.basemapTerrain)};mb._exitBasemapTerrain=function(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))};mb._initGlobe=function(){this._initCoordinateSystem();this.state.createInitialCamera();this._initBasemapTerrain();this._set("pointsOfInterest",new Ta.default({view:this}));this._set("featureTiles",
new Z.default({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.contentCameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const Qa=()=>{var Ra=this.basemapTerrain&&this.basemapTerrain.extent;this.clippingArea||Ra?Ra&&this.basemapTerrain.spatialReference?(Ra=t.isSome(this.basemapTerrain.extent)?M.project(K.toExtent(this.basemapTerrain.extent,
this.basemapTerrain.spatialReference),this.spatialReference):null,t.isSome(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(Ra):this.featureTiles.filterExtent=Ra):this.featureTiles.filterExtent=this.clippingArea:this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(()=>Da.FEATURE_TILE_TREE_SHOW_TILES,Ra=>{Ra&&this.featureTiles&&!this.featureTreeDebugger?this.updatingHandles.addPromise(new Promise((ab,jb)=>a(["./3d/layers/support/FeatureTileTree3DDebugger"],
ab,jb))).then(({FeatureTileTree3DDebugger:ab})=>{!this.featureTreeDebugger&&Da.FEATURE_TILE_TREE_SHOW_TILES&&(this.featureTreeDebugger=new ab({view:this}))}):Ra||!this.featureTreeDebugger||Da.FEATURE_TILE_TREE_SHOW_TILES||(this.featureTreeDebugger.destroy(),this.featureTreeDebugger=null)},u.syncAndInitial),this.updatingHandles.add(()=>this.clippingArea,Qa,u.syncAndInitial),this.updatingHandles.add(()=>this.basemapTerrain.extent,Qa,u.syncAndInitial)],"feature-tiles");this.stateManager.init()};mb._exitGlobe=
function(){this.state&&(this.stateManager.deinit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())};mb._initCoordinateSystem=function(){if(this.spatialReference){var Qa=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(Qa)||this._set("mapCoordsHelper",
new sa.MapCoordsHelper(this.map,Qa));const Ra=this.state.isGlobal;Qa=O.renderSRFromViewSR(Ra,Qa);Qa!==this.renderSpatialReference&&(this._set("renderCoordsHelper",va.RenderCoordsHelper.create(this.state.viewingMode,Qa)),Ra||this.handles.add(this.watch("basemapTerrain.extent",ab=>{const jb=this.renderCoordsHelper.spatialReference;0===ab[0]&&0===ab[1]&&0===ab[2]&&0===ab[3]||!M.projectBoundingRect(ab,this.basemapTerrain.spatialReference,eb,jb)||(this.renderCoordsHelper.extent=eb)},!0),"render-coords-helper"),
this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(cb.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)};mb._exitCoordinateSystem=function(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))};mb._updatingChanged=function(){this.notifyChange("updating")};mb._updateUpdatingMonitors=function(Qa=null){t.isSome(Qa)&&
Qa.type===r.ObservableChangesType.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(Ra=>{Ra.destroyed||(this.handles.add([Ra.watch(["updating","updatingProgress"],()=>this._updatingChanged(),!0)],"updatingMonitors"),Ra.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())};mb._renderScreenshotOverlay=function(Qa,Ra){if(!this.overlay||!this.overlay.hasVisibleItems)return Ra;const ab=Qa.getContext("2d");ab.putImageData(Ra,0,0);this.overlay.renderCanvas(Qa);
return ab.getImageData(0,0,Ra.width,Ra.height)};mb._initStage=function(){var Qa={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:(rb,Ab)=>this._renderScreenshotOverlay(rb,Ab)}};const Ra=new pa.SceneIntersectionHelper(this.state.viewingMode,rb=>this._stage.layers.forAll(rb),this);this._set("sceneIntersectionHelper",Ra);const ab=k.byId(this.surface),{resourceController:jb,
state:pb,renderSpatialReference:ub}=this;this._stage=new ka.Stage({options:Qa,container:ab,resourceController:jb,state:pb,sceneIntersectionHelper:Ra,renderSR:ub});this._stage.renderView.setRenderParameters({slicePlane:this.slicePlane});this._lostWebGLContextHandle=d.on(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new e("webgl-context-lost"));this.handles.add([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderView.setRenderParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),
u.initial),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,()=>this._stage.renderView.setRenderParameters({highQualityTransparency:this.qualitySettings.highQualityTransparency}),u.initial),u.watch(()=>this.magnifier,rb=>this._stage.renderView.magnifier=rb,u.syncAndInitial)],"stage");Qa=()=>{this._stage.renderView.setRenderParameters({defaultHighlightOptions:qa.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add(()=>[this.highlightOptions.color,
this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],Qa),"stage");Qa();this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(cb.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters);this._set("canvas",this._stage.renderView.canvas)};mb._exitStage=function(){this._set("sceneIntersectionHelper",null);this._stage.destroy();this._stage=
null;this._lostWebGLContextHandle.remove();this._lostWebGLContextHandle=null;this.handles.remove("stage");this._set("canvas",null)};mb._initSurface=function(Qa){this._exitSurface();this.state.init(Qa,this.spatialReference);this._initStage();this._initGlobe();this.sharedSymbolResources=new Ha.SharedSymbolResources({view:this,viewingMode:Qa,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state,objectResourceCache:new ba.ObjectResourceCache})};mb._exitSurface=
function(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())};mb._createGraphicsViewIfNeeded=function(){if(!this.graphicsView&&!this._createGraphicsViewController&&0!==this.graphics.length){this.handles.remove("graphics-view");this._createGraphicsViewController=new AbortController;var Qa=()=>{this._createGraphicsViewController=null;this._updatingChanged()};
this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(Qa,Qa);this._updatingChanged()}};mb._createGraphicsViewAsync=function(){var Qa=b._asyncToGenerator(function*(Ra){const ab=(yield new Promise((jb,pb)=>a(["./3d/layers/GraphicsView3D"],ub=>jb(Object.freeze({__proto__:null,default:ub})),pb))).default;x.throwIfAborted(Ra);yield u.whenOnce(()=>{var jb;return!0===(null==(jb=this.basemapTerrain)?void 0:jb.ready)},Ra);this._set("graphicsView",new ab({view:this}))});return function(Ra){return Qa.apply(this,
arguments)}}();mb._disposeGraphicsView=function(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null);this.handles.remove("graphics-view");t.isSome(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))};mb._startup=function(){var Qa=aa.viewingModeFromString(this.viewingMode);Qa===aa.ViewingMode.Global&&(this._clippingArea=null);this._initSurface(Qa);
this._set("ready",!0);this.handles.add(u.on(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view");this._createGraphicsViewIfNeeded();!this._externallySet.environment&&(Qa=this.get("map.initialViewProperties.environment"))&&(this.environment=Qa);this.labeler.setup();this.environmentManager.connectView(this);this.inputManager.connect();Qa=this._resolveWhenReady;this._resolveWhenReady=[];Qa.forEach(Ra=>Ra(this))};mb._teardown=function(){this._initialDefaultSpatialReference=
null;this.inputManager.disconnect();this.environmentManager.disconnectView();this.labeler.dispose();this._disposeGraphicsView();this.handles.remove("graphics-view");this._exitSurface();this._set("ready",!1)};mb._updateDefaultToMapOptions=function(){this._defaultToMapOptions.include.clear();if(this.map){this.map.ground&&this._defaultToMapOptions.include.add(wa.TERRAIN_ID);for(const Qa of this.map.allLayers.items)"integrated-mesh"===Qa.type&&this._defaultToMapOptions.include.add(Qa.uid)}};mb._updateDefaultHitTestOptions=
function(){this._defaultHitTestOptions.exclude.clear();if(this.map){this.map.ground&&1>this.map.ground.opacity&&this._defaultHitTestOptions.exclude.add(wa.TERRAIN_ID);for(const Qa of this.map.allLayers.items)"integrated-mesh"===Qa.type&&1>Qa.opacity&&this._defaultToMapOptions.exclude.add(Qa.uid)}};mb.getVoxelWasmPerSceneView=function(){return J.getInstance().getVoxelWasmPerSceneView(this)};b._createClass(tb,[{key:"renderSpatialReference",get:function(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}},
{key:"basemapSpatialReference",get:function(){return this.basemapTerrain&&this.basemapTerrain.spatialReference}},{key:"clippingArea",get:function(){if("global"===this.viewingMode)return null;let Qa=this._userClippingArea||this.get("map.clippingArea");if(!this._userClippingArea&&!this.get("map.clippingEnabled")||t.isNone(Qa))return this._clippingArea=null;if(!(Qa instanceof ob))return za.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(this.spatialReference&&
(Qa=$a(Qa,this.spatialReference),t.isNone(Qa)))return za.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea;Qa=Qa.clone();t.isNone(Qa.intersection(this.groundAndLayersExtent))&&(Qa.xmin=Qa.xmax,Qa.ymin=Qa.ymax);Qa.zmin=void 0;Qa.zmax=void 0;Qa.equals(this._clippingArea)||(this._clippingArea=Qa);return this._clippingArea},set:function(Qa){this.ready&&"global"===this.viewingMode&&t.isSome(Qa)?za.error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):
this._userClippingArea=Qa}},{key:"renderDataExtent",get:function(){if(this.state.viewingMode===aa.ViewingMode.Global)return null;const Qa=this.renderSpatialReference,Ra=this.dataExtent;return t.isNone(Ra)||t.isNone(Qa)||Ra.spatialReference.equals(Qa)?Ra:$a(Ra,Qa)}},{key:"dataExtent",get:function(){let Qa=this.groundAndLayersExtent;var Ra=$a(this.clippingArea,this.spatialReference||kb.WGS84);t.isSome(Ra)&&(Qa=t.isSome(Qa)?Qa.intersection(Ra):Ra);Ra=this._get("dataExtent");return t.isSome(Qa)&&Qa.equals(Ra)?
Ra:Qa}},{key:"groundAndLayersExtent",get:function(){const Qa=this.spatialReference||kb.WGS84;let Ra;const ab=pb=>{pb=$a(pb,Qa);t.isNone(pb)||(t.isSome(Ra)?Ra.union(pb):Ra=pb.clone())};var jb=this.basemapTerrain;if(null!=jb&&jb.spatialReference){const pb=jb.groundExtent;ab(new ob({xmin:pb[0],ymin:pb[1],zmin:0,xmax:pb[2],ymax:pb[3],zmax:0,spatialReference:jb.spatialReference}))}this.map&&this.map.allLayers.forEach(pb=>{!t.isSome(pb.fullExtent)||"graphics"===pb.type&&pb.internal||ab(pb.fullExtent)});
if(t.isNone(Ra))return null;Ra.hasZ?(Ra.zmin=Math.min(0,Ra.zmin),Ra.zmax=Math.max(0,Ra.zmax)):(Ra.zmin=0,Ra.zmax=0);jb=this._get("groundAndLayersExtent");return Ra.equals(jb)?jb:Ra}},{key:"environment",set:function(Qa){Qa!==this._defaults.environment&&(this._externallySet.environment=!0);this._set("environment",Qa)}},{key:"pixelRatio",get:function(){return Math.min(this.windowDevicePixelRatio,this.maximumPixelRatio)},set:function(Qa){t.isSome(Qa)?this._override("pixelRatio",Qa):this._clearOverride("pixelRatio")}},
{key:"maximumPixelRatio",get:function(){let Qa=Infinity;const {maximumPixelRatio:Ra,maximumRenderResolution:ab}=this.qualitySettings;null!=Ra&&(Qa=Math.min(Qa,Ra));null!=ab&&(Qa=Math.min(Qa,ab/Math.max(this.width,this.height)));return Qa},set:function(Qa){t.isSome(Qa)?this._override("maximumPixelRatio",Qa):this._clearOverride("maximumPixelRatio")}},{key:"initialExtentRequired",get:function(){return this.stateManager&&!this.stateManager.hasInitialView}},{key:"_defaultsFromMapSettings",get:function(){return{required:{tileInfo:!1,
heightModelInfo:!0,extent:!1}}}},{key:"interacting",get:function(){return this.navigating||t.isSome(this.activeTool)}},{key:"stationary",get:function(){return!this.animation&&!this.resizing&&(t.isNone(this.state)||this.state.stationary)}},{key:"qualityProfile",get:function(){return this._get("qualityProfile")||ua.getDefaultProfile()},set:function(Qa){ua.isValidProfile(Qa)&&(ua.apply(Qa,this.qualitySettings),this._set("qualityProfile",Qa))}},{key:"slicePlane",set:function(Qa){t.isSome(this._stage)&&
this._stage.renderView.setRenderParameters({slicePlane:Qa});if(t.isNone(Qa))this._set("slicePlane",null);else{var Ra=this.propertiesPool.get("slicePlane");I.copy(Qa,Ra);this._set("slicePlane",Ra)}}},{key:"typeSpecificPreconditionsReady",get:function(){return!!this.viewingMode}},{key:"resolution",get:function(){return null!=this.spatialReference?Q.getResolutionForScale(this.scale,this.spatialReference):0}},{key:"heightModelInfo",get:function(){const Qa=this.getDefaultHeightModelInfo();return null!=
Qa?H.deriveUnitFromSR(Qa,this.spatialReference):null}},{key:"updating",get:function(){var Qa,Ra,ab;if(this.destroyed)return!1;let jb=0,pb=this.layerViewManager.updating,ub=pb?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(rb=>{rb.isFulfilled()?rb.updating&&(pb=!0,rb.suspended||fb.isSurfaceLayerView(rb)||(++ub,jb+=rb.updatingProgress)):++ub});for(const rb of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,
this.overlay,this.featureTreeDebugger,this.toolViewManager,this.analysisViewManager])t.isSome(rb)&&rb.updating&&(ub+=.1,jb+=.05);for(const rb of[this.deconflictor,this.labeler,this.basemapTerrain])t.isSome(rb)&&rb.updating&&(++ub,jb+=rb.updatingProgress);(pb=!!(pb||0<ub||this.updatingHandles.updating||!this.ready||!this.stationary||this._createGraphicsViewController||null!=(Qa=this.inputManager)&&Qa.hasPendingInputs||null!=(Ra=this.map)&&null!=(ab=Ra.allLayers)&&ab.some(rb=>!rb.isFulfilled())))?(this._numUpdating=
Math.max(ub,this._numUpdating),jb+=this._numUpdating-ub):this._numUpdating=0;jb=0<this._numUpdating?jb/this._numUpdating:pb?0:1;this._get("updatingProgress")!==jb&&(Qa=this._resourceController.scheduler.now,1>jb&&(Ra=Math.min((Qa-this._lastUpdateTime)/2E3,1),jb=this.updatingProgress*(1-Ra)+jb*Ra),this._set("updatingProgress",jb),this._lastUpdateTime=pb&&1>jb?Qa:0);return pb}},{key:"viewingMode",get:function(){var Qa,Ra=this._predeterminedViewingMode;return t.isSome(Ra)?aa.stringFromViewingMode(Ra):
(Ra=this.spatialReference)?t.isSome(null==(Qa=this.defaultsFromMap)?void 0:Qa.viewingMode)&&Ra.equals(this.defaultsFromMap.spatialReference)?aa.stringFromViewingMode(this.defaultsFromMap.viewingMode):ya.isSpatialReferenceSupported(Ra,aa.ViewingMode.Global)?"global":"local":"global"},set:function(Qa){this.ready?za.error("#viewingMode","viewingMode cannot be set once view is ready"):Qa?this._override("viewingMode",Qa):void 0===Qa&&this._clearOverride("viewingMode")}},{key:"resourceController",get:function(){return this._resourceController}},
{key:"performanceInfo",get:function(){return new Ja(this)}},{key:"_predeterminedViewingMode",get:function(){var Qa,Ra;const ab=this._isOverridden("viewingMode")?this._get("viewingMode"):null!=(Qa=this.map&&"initialViewProperties"in this.map?null==(Ra=this.map.initialViewProperties)?void 0:Ra.viewingMode:null)?Qa:null;return t.isSome(ab)?aa.viewingModeFromString(ab):null}}]);return tb}(R.BreakpointsOwner(S.DOMContainer(V.PopupView(W))));c.__decorate([p.property()],h.prototype,"_userClippingArea",void 0);
c.__decorate([p.property()],h.prototype,"_resourceController",void 0);c.__decorate([p.property()],h.prototype,"_stage",void 0);c.__decorate([p.property({readOnly:!0})],h.prototype,"deconflictor",void 0);c.__decorate([p.property({readOnly:!0})],h.prototype,"labeler",void 0);c.__decorate([p.property(L.owningCollectionProperty(N.AnalysesCollection,"analyses"))],h.prototype,"analyses",void 0);c.__decorate([p.property({type:U,readOnly:!0,aliasOf:"state.animation"})],h.prototype,"animation",void 0);c.__decorate([p.property({readOnly:!0})],
h.prototype,"basemapTerrain",void 0);c.__decorate([p.property({readOnly:!0})],h.prototype,"elevationProvider",void 0);c.__decorate([p.property({type:g,aliasOf:"stateManager.camera"})],h.prototype,"camera",void 0);c.__decorate([p.property({type:g,aliasOf:"stateManager.contentCamera"})],h.prototype,"contentCamera",void 0);c.__decorate([p.property({readOnly:!0})],h.prototype,"canvas",void 0);c.__decorate([p.property({type:ib,aliasOf:"stateManager.center"})],h.prototype,"center",void 0);c.__decorate([p.property({type:ob})],
h.prototype,"clippingArea",null);c.__decorate([p.property({type:ea.default})],h.prototype,"constraints",void 0);c.__decorate([p.property({type:ob,readOnly:!0})],h.prototype,"renderDataExtent",null);c.__decorate([p.property({type:ob,readOnly:!0})],h.prototype,"dataExtent",null);c.__decorate([p.property({type:ob,readOnly:!0})],h.prototype,"groundAndLayersExtent",null);c.__decorate([p.property({value:null,type:ja})],h.prototype,"environment",null);c.__decorate([D.cast("environment")],h.prototype,"castEnvironment",
null);c.__decorate([p.property({readOnly:!0})],h.prototype,"environmentManager",void 0);c.__decorate([p.property({type:ob,aliasOf:"stateManager.extent"})],h.prototype,"extent",void 0);c.__decorate([p.property()],h.prototype,"floors",void 0);c.__decorate([p.property({readOnly:!0,aliasOf:"stateManager.screenCenter"})],h.prototype,"screenCenter",void 0);c.__decorate([p.property({type:Number})],h.prototype,"pixelRatio",null);c.__decorate([p.property({type:Number,dependsOn:["qualitySettings.maximumPixelRatio",
"qualitySettings.maximumRenderResolution","size"]})],h.prototype,"maximumPixelRatio",null);c.__decorate([p.property({aliasOf:"stateManager.frustum"})],h.prototype,"frustum",void 0);c.__decorate([p.property({type:Number,readOnly:!0})],h.prototype,"fullOpacity",void 0);c.__decorate([p.property({readOnly:!0})],h.prototype,"graphicsView",void 0);c.__decorate([p.property({readOnly:!0})],h.prototype,"analysisViewManager",void 0);c.__decorate([p.property()],h.prototype,"groundView",void 0);c.__decorate([p.property({type:Boolean})],
h.prototype,"initialExtentRequired",null);c.__decorate([p.property()],h.prototype,"_defaultsFromMapSettings",null);c.__decorate([p.property({type:Boolean,readOnly:!0})],h.prototype,"interacting",null);c.__decorate([p.property()],h.prototype,"stationary",null);c.__decorate([p.property({aliasOf:"state.navigating"})],h.prototype,"navigating",void 0);c.__decorate([p.property()],h.prototype,"map",void 0);c.__decorate([p.property({readOnly:!0})],h.prototype,"mapCoordsHelper",void 0);c.__decorate([p.property({aliasOf:"stateManager.padding"})],
h.prototype,"padding",void 0);c.__decorate([p.property({type:Ta.default,readOnly:!0})],h.prototype,"pointsOfInterest",void 0);c.__decorate([p.property({type:Z.default,readOnly:!0})],h.prototype,"featureTiles",void 0);c.__decorate([p.property()],h.prototype,"featureTreeDebugger",void 0);c.__decorate([p.property({type:Boolean})],h.prototype,"screenSizePerspectiveEnabled",void 0);c.__decorate([p.property({constructOnly:!0})],h.prototype,"deactivatedWebGLExtensions",void 0);c.__decorate([p.property({constructOnly:!0})],
h.prototype,"debugWebGLExtensions",void 0);c.__decorate([p.property({constructOnly:!0})],h.prototype,"renderCanvas",void 0);c.__decorate([p.property({constructOnly:!0})],h.prototype,"state",void 0);c.__decorate([p.property({readOnly:!0})],h.prototype,"inputManager",void 0);c.__decorate([p.property({readOnly:!0})],h.prototype,"stateManager",void 0);c.__decorate([p.property({type:["low","medium","high"]})],h.prototype,"qualityProfile",null);c.__decorate([p.property({type:ra,get(){let lb=this._get("qualitySettings");
lb||(lb=new ra,ua.apply(this.qualityProfile,lb));return lb}})],h.prototype,"qualitySettings",void 0);c.__decorate([p.property()],h.prototype,"slicePlane",null);c.__decorate([p.property({readOnly:!0})],h.prototype,"typeSpecificPreconditionsReady",null);c.__decorate([p.property({readOnly:!0})],h.prototype,"renderCoordsHelper",void 0);c.__decorate([p.property({readOnly:!0})],h.prototype,"sceneIntersectionHelper",void 0);c.__decorate([p.property({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],
h.prototype,"resolution",null);c.__decorate([p.property({type:Number,aliasOf:"stateManager.scale"})],h.prototype,"scale",void 0);c.__decorate([p.property()],h.prototype,"heightModelInfo",null);c.__decorate([p.property()],h.prototype,"spatialReference",void 0);c.__decorate([p.property({type:Boolean,constructOnly:!0})],h.prototype,"alphaCompositingEnabled",void 0);c.__decorate([p.property({type:Boolean})],h.prototype,"supersampleScreenshotsEnabled",void 0);c.__decorate([p.property({readOnly:!0})],h.prototype,
"type",void 0);c.__decorate([p.property({type:Va})],h.prototype,"ui",void 0);c.__decorate([p.property({type:Boolean,readOnly:!0,dependsOn:"graphicsView.updating basemapView.updating basemapTerrain.updating layerViewManager.updating layerViewManager.updatingRemaining _resourceController.updating _stage.updating featureTiles.updating pointsOfInterest.updating environmentManager.updating overlay.updating updatingHandles.updating featureTreeDebugger.updating labeler.updating deconflictor.updating ready stationary inputManager.hasPendingInputs toolViewManager.updating analysisViewManager.updating".split(" ")})],
h.prototype,"updating",null);c.__decorate([p.property({type:Number,readOnly:!0,dependsOn:["updating"]})],h.prototype,"updatingProgress",void 0);c.__decorate([p.property({type:["global","local"]})],h.prototype,"viewingMode",null);c.__decorate([p.property({type:f,aliasOf:"stateManager.viewpoint"})],h.prototype,"viewpoint",void 0);c.__decorate([p.property({type:Number,aliasOf:"stateManager.zoom"})],h.prototype,"zoom",void 0);c.__decorate([p.property({type:qa})],h.prototype,"highlightOptions",void 0);
h=c.__decorate([C.subclass("esri.views.SceneView")],h);var Pa;(function(lb){lb[lb.INCLUDE=0]="INCLUDE";lb[lb.EXCLUDE=1]="EXCLUDE"})(Pa||(Pa={}));const Xa=G.create(),Za=A.createScreenPointArray(),eb=K.create();return h});