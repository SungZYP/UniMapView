// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Handles ../../core/maybe ../../core/reactiveUtils ../../core/scheduling ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass".split(" "),function(f,n,m,p,q,r,g,t,u,v){f.WatchUpdatingTracking=function(d){function l(){var a=d.apply(this,arguments)||this;a.updating=!1;a.handleId=0;a.handles=new q;a.scheduleHandleId=0;a.pendingPromises=new Set;return a}
n._inheritsLoose(l,d);var e=l.prototype;e.destroy=function(){this.removeAll();this.handles.destroy()};e.add=function(a,b,c={}){return this._installWatch(a,b,c,g.watch)};e.addWhen=function(a,b,c={}){return this._installWatch(a,b,c,g.when)};e.addOnCollectionChange=function(a,b,{initial:c=!1}={}){const k=++this.handleId;this.handles.add([g.on(a,"after-changes",this._createSyncUpdatingCallback(),g.sync),g.on(a,"change",b,{onListenerAdd:c?h=>b({added:h.toArray(),removed:[]}):void 0})],k);return{remove:()=>
this.handles.remove(k)}};e.addPromise=function(a){if(r.isNone(a))return a;const b=++this.handleId;this.handles.add({remove:()=>{this.pendingPromises.delete(a)&&(0!==this.pendingPromises.size||this.handles.has(-42)||this._set("updating",!1))}},b);this.pendingPromises.add(a);this._set("updating",!0);const c=()=>this.handles.remove(b);a.then(c,c);return a};e.removeAll=function(){this.pendingPromises.clear();this.handles.removeAll();this._set("updating",!1)};e._installWatch=function(a,b,c={},k){const h=
++this.handleId;c.sync||this._installSyncUpdatingWatch(a,h);a=k(a,b,c);this.handles.add(a,h);return{remove:()=>this.handles.remove(h)}};e._installSyncUpdatingWatch=function(a,b){const c=this._createSyncUpdatingCallback();a=g.watch(a,c,{sync:!0,equals:()=>!1});this.handles.add(a,b);return a};e._createSyncUpdatingCallback=function(){return()=>{this.handles.remove(-42);++this.scheduleHandleId;const a=this.scheduleHandleId;this._get("updating")||this._set("updating",!0);this.handles.add(t.schedule(()=>
{a===this.scheduleHandleId&&(this._set("updating",0<this.pendingPromises.size),this.handles.remove(-42))}),-42)}};return l}(p);m.__decorate([u.property({readOnly:!0})],f.WatchUpdatingTracking.prototype,"updating",void 0);f.WatchUpdatingTracking=m.__decorate([v.subclass("esri.views.support.WatchUpdatingTracking")],f.WatchUpdatingTracking);f.WatchFlags=void 0;(function(d){d[d.NONE=0]="NONE";d[d.SYNC=1]="SYNC";d[d.INIT=2]="INIT"})(f.WatchFlags||(f.WatchFlags={}));Object.defineProperty(f,"__esModule",
{value:!0})});