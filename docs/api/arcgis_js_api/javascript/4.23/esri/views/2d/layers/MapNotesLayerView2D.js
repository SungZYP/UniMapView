// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Collection ../../../core/maybe ../../../core/watchUtils ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/set ../../../core/accessorSupport/decorators/subclass ./LayerView2D ./graphics/GraphicContainer ./graphics/GraphicsView2D ../../layers/LayerView".split(" "),function(l,v,w,x,h,k,n,C,D,E,F,y,z,q,r,A){const B=
Object.freeze({remove(){},pause(){},resume(){}});n=function(t){function p(){var a=t.apply(this,arguments)||this;a._highlightIds=new Map;return a}l._inheritsLoose(p,t);var d=p.prototype;d.fetchPopupFeatures=function(){var a=l._asyncToGenerator(function*(b){return Array.from(this.graphicsViews(),c=>c.hitTest(b).filter(f=>!!f.popupTemplate)).flat()});return function(b){return a.apply(this,arguments)}}();d.graphicsViews=function*(){h.isSome(this._graphicsViewsFeatureCollectionMap)?yield*this._graphicsViewsFeatureCollectionMap.keys():
h.isSome(this._graphicsViews)?yield*this._graphicsViews:yield*[]};d.hitTest=function(){var a=l._asyncToGenerator(function*(b,c){var f=this;c=Array.from(this.graphicsViews(),function(){var g=l._asyncToGenerator(function*(e){const m=yield e.hitTest(b);if(h.isSome(f._graphicsViewsFeatureCollectionMap)){e=f._graphicsViewsFeatureCollectionMap.get(e);for(const u of m)!u.popupTemplate&&e.popupTemplate&&(u.popupTemplate=e.popupTemplate)}return m});return function(e){return g.apply(this,arguments)}}());return(yield Promise.all(c)).flat()});
return function(b,c){return a.apply(this,arguments)}}();d.highlight=function(a){let b;"number"===typeof a?b=[a]:a instanceof w?b=[a.uid]:Array.isArray(a)&&0<a.length?b="number"===typeof a[0]?a:a.map(c=>c&&c.uid):x.isCollection(a)&&(b=a.map(c=>c&&c.uid).toArray());b=b.filter(c=>null!=c);if(!b.length)return B;this._addHighlight(b);return{remove:()=>{this._removeHighlight(b)}}};d.update=function(a){for(const b of this.graphicsViews())b.processUpdate(a)};d.attach=function(){const a=this.view,b=()=>this.requestUpdate();
var c=this.layer.featureCollections;if(h.isSome(c)&&c.length){this._graphicsViewsFeatureCollectionMap=new Map;for(const f of c){c=new q(this.view.featuresTilingScheme);c.fadeTransitionEnabled=!0;const g=new r({view:a,graphics:f.source,renderer:f.renderer,requestUpdateCallback:b,container:c});this._graphicsViewsFeatureCollectionMap.set(g,f);this.container.addChild(g.container);this.handles.add([k.init(f,"visible",e=>g.container.visible=e),k.init(g,"updating",()=>this.notifyChange("updating"))],"layerView")}this._updateHighlight()}else h.isSome(this.layer.sublayers)&&
this.handles.add(k.on(this.layer,"sublayers","change",()=>this._createGraphicsViews(),()=>this._createGraphicsViews(),()=>this._destroyGraphicsViews()),"sublayers")};d.detach=function(){this._destroyGraphicsViews();this.handles.remove("sublayers")};d.moveStart=function(){};d.moveEnd=function(){};d.viewChange=function(){for(const a of this.graphicsViews())a.viewChange()};d.isUpdating=function(){for(const a of this.graphicsViews())if(a.updating)return!0;return!1};d._destroyGraphicsViews=function(){this.container.removeAllChildren();
this.handles.remove("layerView");for(const a of this.graphicsViews())a.destroy();this._graphicsViewsFeatureCollectionMap=this._graphicsViews=null};d._createGraphicsViews=function(){this._destroyGraphicsViews();if(!h.isNone(this.layer.sublayers)){var a=[],b=this.view,c=()=>this.requestUpdate();for(const f of this.layer.sublayers){const g=new q(this.view.featuresTilingScheme);g.fadeTransitionEnabled=!0;const e=new r({view:b,graphics:f.graphics,requestUpdateCallback:c,container:g});this.handles.add([f.on("graphic-update",
e.graphicUpdateHandler),k.init(f,"visible",m=>e.container.visible=m),k.init(e,"updating",()=>this.notifyChange("updating"))],"layerView");this.container.addChild(e.container);a.push(e)}this._graphicsViews=a;this._updateHighlight()}};d._addHighlight=function(a){for(const b of a)this._highlightIds.has(b)?(a=this._highlightIds.get(b),this._highlightIds.set(b,a+1)):this._highlightIds.set(b,1);this._updateHighlight()};d._removeHighlight=function(a){for(const b of a)this._highlightIds.has(b)&&(a=this._highlightIds.get(b)-
1,0===a?this._highlightIds.delete(b):this._highlightIds.set(b,a));this._updateHighlight()};d._updateHighlight=function(){const a=Array.from(this._highlightIds.keys());for(const b of this.graphicsViews())b.setHighlight(a)};return p}(z.LayerView2DMixin(A));return n=v.__decorate([y.subclass("esri.views.2d.layers.MapNotesLayerView2D")],n)});