// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define(["../../../../core/maybe","./enums","./shaders/MaterialPrograms"],function(p,m,q){const r=e=>e===m.WGLDrawPhase.HITTEST||e===m.WGLDrawPhase.LABEL_ALPHA,t=({rendererInfo:e,drawPhase:d},c,b,a)=>{c=c.getVariationHash();a=a.join(".");d=(r(d)?1:0)|(d===m.WGLDrawPhase.HIGHLIGHT?2:0);return`${c}-${a}-${d}-${e.getVariationHash()}-${p.isSome(b)&&b.join(".")}`},u=(e,d,c,b)=>{b=b.reduce((a,f)=>({...a,[f]:e.context.driverTest[f]}),{});d={...d.getVariation(),...e.rendererInfo.getVariation(),highlight:e.drawPhase===
m.WGLDrawPhase.HIGHLIGHT,id:r(e.drawPhase),...b};if(p.isSome(c))for(const a of c)d[a]=!0;return d};return function(){function e(c){this._rctx=c;this._programByKey=new Map}var d=e.prototype;d.dispose=function(){this._programByKey.forEach(c=>c.dispose());this._programByKey.clear()};d.getProgram=function(c,b,a=[],f=[]){const h=b.vsPath+"."+b.fsPath+JSON.stringify(a)+f.join(".");if(this._programByKey.has(h))return this._programByKey.get(h);f=f.reduce((g,k)=>({...g,[k]:c.context.driverTest[k]}),{});a=
{...a.map(g=>"string"===typeof g?{name:g,value:!0}:g).reduce((g,k)=>({...g,[k.name]:k.value}),{}),...f};const {vsPath:n,fsPath:l,attributes:v}=b;b=q.createProgramTemplate(n,l,v,a);b=this._rctx.programCache.acquire(b.shaders.vertexShader,b.shaders.fragmentShader,b.attributes);if(!b)throw Error("Unable to get program for key: ${key}");this._programByKey.set(h,b);return b};d.getMaterialProgram=function(c,b,a,f,h,n=["ignoresSamplerPrecision"]){const l=t(c,b,h,n);if(this._programByKey.has(l))return this._programByKey.get(l);
c=u(c,b,h,n);a=q.createProgramTemplate(a,a,f,c);a=this._rctx.programCache.acquire(a.shaders.vertexShader,a.shaders.fragmentShader,a.attributes);if(!a)throw Error("Unable to get program for key: ${key}");this._programByKey.set(l,a);return a};return e}()});