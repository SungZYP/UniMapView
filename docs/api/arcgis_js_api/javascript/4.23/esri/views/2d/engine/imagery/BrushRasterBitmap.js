// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ./RasterBitmap ../webgl/VertexStream ../webgl/brushes/WGLBrush ../../../webgl/enums ../../../webgl/rasterUtils".split(" "),function(q,r,t,u,l,d){return function(p){function m(){var a=p.apply(this,arguments)||this;a._desc={lut:{vsPath:"raster/lut",fsPath:"raster/lut",attributes:new Map([["a_position",0],["a_texcoord",1]])},stretch:{vsPath:"raster/stretch",fsPath:"raster/stretch",attributes:new Map([["a_position",0],["a_texcoord",1]])},hillshade:{vsPath:"raster/hillshade",
fsPath:"raster/hillshade",attributes:new Map([["a_position",0],["a_texcoord",1]])}};a._rendererUniformInfos=new Map;return a}q._inheritsLoose(m,p);var g=m.prototype;g.dispose=function(){this._quad&&this._quad.dispose()};g.prepareState=function({context:a},c){a.setBlendingEnabled(!0);a.setBlendFunctionSeparate(l.BlendFactor.ONE,l.BlendFactor.ONE_MINUS_SRC_ALPHA,l.BlendFactor.ONE,l.BlendFactor.ONE_MINUS_SRC_ALPHA);a.setColorMask(!0,!0,!0,!0);a.setStencilWriteMask(0);a.setStencilTestEnabled(!0);a.setStencilFunction(l.CompareFunction.EQUAL,
c.stencilRef,255)};g.draw=function(a,c){var b;if(r.hasSource(c)&&!c.suspended){a.timeline.begin(this.name);var e=!(null!=(b=a.context.capabilities.textureFloat)&&b.textureFloatLinear);c.updateTexture(a);b=this._getShaderVariations(c,e);b=a.painter.materialManager.getProgram(a,this._desc[c.symbolizerParameters.type],b);this._drawWithProgram(a.context,b,c);a.timeline.end(this.name)}};g._drawWithProgram=function(a,c,b,e=1,n=[0,0],h=!1){this._quad||(this._quad=new t(a,[0,0,1,0,0,1,1,1]));const {symbolizerParameters:f,
transformGrid:v,width:w,height:x,opacity:y}=b;var k=f.type;a.useProgram(c);const z=this._getShaderVariations(b);k=this._getUniformInfos(k,a,c,z);const {names:A,textures:B}=b.getTextures();d.setTextures(a,c,A,B);a=d.getBasicGridUniforms(e,n);h=d.getCommonUniforms(v,[w,x],[b.source.width,b.source.height],y,h);d.setUniforms(c,k,{u_coordScale:b.coordScale,u_dvsMat3:b.transforms.dvs,...a,...h});if(f.colormap){const {colormap:C,colormapOffset:D}=f;b=d.getColormapUniforms(C,D);d.setUniforms(c,k,b)}"stretch"===
f.type?(b=d.getStretchUniforms(f),d.setUniforms(c,k,b)):"hillshade"===f.type&&(b=d.getShadedReliefUniforms(f),d.setUniforms(c,k,b));this._quad.draw()};g._getUniformInfos=function(a,c,b,e){a=0<e.length?a+"-"+e.join("-"):a;if(this._rendererUniformInfos.has(a))return this._rendererUniformInfos.get(a);c=d.getUniformLocationInfos(c,b);this._rendererUniformInfos.set(a,c);return c};g._getShaderVariations=function(a,c=!1){const b=[],{interpolation:e}=a,{type:n,colormap:h}=a.symbolizerParameters;"cubic"===
e?b.push("bicubic"):"bilinear"===e&&"stretch"===n&&null!=h?(b.push("bilinear"),b.push("nnedge")):c&&"bilinear"===e&&b.push("bilinear");a.isRendereredSource?b.push("noop"):h&&b.push("applyColormap");a.transformGrid&&(b.push("applyProjection"),1===a.transformGrid.spacing[0]&&b.push("lookupProjection"));return b};return m}(u)});