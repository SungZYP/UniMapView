// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../MemoryBuffer ./enums ../../../../webgl/enums ../../../../webgl/VertexElementDescriptor".split(" "),function(E,I,F,J,e,n,K){let H=function(){function z(b){this._locations=new Map;this._key=b}var m=z.prototype;m.defines=function(){return[]};m.getStride=function(){this._layoutInfo||this._buildAttributesInfo();return this._stride};m.getAttributeLocations=function(){0===this._locations.size&&this._buildAttributesInfo();
return this._locations};m.getLayoutInfo=function(){this._layoutInfo||this._buildAttributesInfo();return this._layoutInfo};m.getEncodingInfos=function(){this._propertyEncodingInfo||this._buildAttributesInfo();return this._propertyEncodingInfo};m.getUniforms=function(){this._uniforms||this._buildAttributesInfo();return this._uniforms};m.getShaderHeader=function(){this._shaderHeader||this._buildAttributesInfo();return this._shaderHeader};m.getShaderMain=function(){this._shaderMain||this._buildAttributesInfo();
return this._shaderMain};m.setDataUniforms=function(b,d,g,h,v){var p=this.getUniforms();for(const a of p){const {name:c,type:q,getValue:r}=a;p=r(g,d,h,v);if(null!==p)switch(q){case "float":b.setUniform1f(c,p);break;case "vec2":b.setUniform2fv(c,p);break;case "vec4":b.setUniform4fv(c,p)}}};m.encodeAttributes=function(b,d,g,h){const v=this.attributesInfo(),p=this.getEncodingInfos(),a=[];let c=0,q=0;for(const x of Object.keys(p)){var r,f=p[x];const {type:B,precisionFactor:t,isLayout:C}=v[x],w=C?g.getLayoutProperty(x):
g.getPaintProperty(x),u=null==(r=w.interpolator)?void 0:r.getInterpolationRange(d);let y=0;for(const k of f){const {offset:l,bufferElementsToAdd:A}=k;if(0<A){for(f=0;f<A;f++)a.push(0);c+=q;q=k.bufferElementsToAdd}f=null!=h?h:w.getValue(u?u[y]:d,b);switch(B){case e.EncodingType.R8_SIGNED:case e.EncodingType.R8_UNSIGNED:a[c]|=this._encodeByte(f*(t||1),8*l);break;case e.EncodingType.R16_SIGNED:case e.EncodingType.R16_UNSIGNED:a[c]|=this._encodeShort(f*(t||1),8*l);break;case e.EncodingType.R8G8_SIGNED:case e.EncodingType.R8G8_UNSIGNED:a[c]|=
this._encodeByte(f*(t||1),8*l);a[c]|=this._encodeByte(f*(t||1),8*l+8);break;case e.EncodingType.R16G16_SIGNED:case e.EncodingType.R16G16_UNSIGNED:a[c]|=this._encodeShort(f*(t||1),8*l);a[c]|=this._encodeShort(f*(t||1),8*l+16);break;case e.EncodingType.R8G8B8A8_SIGNED:case e.EncodingType.R8G8B8A8_UNSIGNED:a[c]|=this._encodeByte(f*(t||1),8*l);a[c]|=this._encodeByte(f*(t||1),8*l+8);a[c]|=this._encodeByte(f*(t||1),8*l+16);a[c]|=this._encodeByte(f*(t||1),8*l+24);break;case e.EncodingType.R8G8B8A8_COLOR:a[c]=
this._encodeColor(f);break;case e.EncodingType.R16G16B16A16_DASHARRAY:case e.EncodingType.R16G16B16A16_PATTERN:this._encodePattern(c,a,f);break;default:throw Error("Unsupported encoding type");}y++}}return a};m.getAtributeState=function(b){const d=3+2*b;b=0|this._bit(d);return b|=this._bit(d+1)<<1};m._buildAttributesInfo=function(){const b=[],d={};var g={},h=-1;const v=this.attributesInfo();var p=this.attributes();let a=-1;for(const f of p){a++;p=this.getAtributeState(a);if(p===e.AttributeStatus.UNIFORM||
p===e.AttributeStatus.UNUSED)continue;var c=v[f];const x=[];d[f]=x;c=c.type;for(let B=0;B<p;B++){const {dataType:t,bytesPerElement:C,count:w,normalized:u}=z._encodingInfo[c],y=C*w;let k=g[t];var q=0;!k||4<k.count+w?(h++,k={dataIndex:h,count:0,offset:0},4!==w&&(g[t]=k),b.push({location:-1,name:"a_data_"+h,count:w,type:t,normalized:u}),q=Math.ceil(Math.max(y/4,1))):(q=b[k.dataIndex],q.count+=w,q=Math.ceil(Math.max(q.count*C/4,1))-Math.ceil(Math.max(k.offset/4,1)));x.push({dataIndex:k.dataIndex,offset:k.offset,
bufferElementsToAdd:q});k.offset+=y;k.count+=w}}for(const f of b)switch(f.type){case n.DataType.BYTE:case n.DataType.UNSIGNED_BYTE:f.count=4;case n.DataType.SHORT:case n.DataType.UNSIGNED_SHORT:f.count+=f.count%2}this._buildVertexBufferLayout(b);g=0;h=this._layoutInfo.geometry;for(var r of h)this._locations.set(r.name,g++);if(r=this._layoutInfo.opacity)for(const f of r)this._locations.set(f.name,g++);this._buildShaderInfo(b,d);this._propertyEncodingInfo=d};m._buildVertexBufferLayout=function(b){const d=
{};var g=this.geometryInfo();let h=g[0].stride;if(0===b.length)d.geometry=g;else{const v=[];let p=h;for(const a of b)h+=G(a.type)*a.count;for(const a of g)g={...a},g.stride=h,v.push(g);for(const a of b)v.push(new K.VertexElementDescriptor(a.name,a.count,a.type,p,h)),p+=G(a.type)*a.count;d.geometry=v}this.opacityInfo()&&(d.opacity=this.opacityInfo());this._layoutInfo=d;this._stride=h};m._buildShaderInfo=function(b,d){let g="\n",h="\n";const v=[];for(var p of b)g+=`attribute ${this._getType(p.count)} ${p.name};\n`;
var a=this.attributes();b=this.attributesInfo();p=-1;for(const r of a){p++;const {name:f,type:x,precisionFactor:B,isLayout:t}=b[r];a=B&&1!==B?` * ${1/B}`:"";const {bytesPerElement:C,count:w}=z._encodingInfo[x];var c=u=>`a_data_${u.dataIndex}${L(w,u.offset,C)}`;switch(this.getAtributeState(p)){case e.AttributeStatus.UNIFORM:a=this._getType(w);var q=`u_${f}`;v.push({name:q,type:a,getValue:(u,y,k,l)=>{k=t?u.getLayoutValue(r,y):u.getPaintValue(r,y);if(x===e.EncodingType.R16G16B16A16_DASHARRAY){u=u.getDashKey(k,
u.getLayoutValue("line-cap",y));l=l.getMosaicItemPosition(u,!1);if(F.isNone(l))return null;const {tl:A,br:D}=l;return[A[0],D[1],D[0],A[1]]}if(x===e.EncodingType.R16G16B16A16_PATTERN){l=l.getMosaicItemPosition(k,-1===r.indexOf("line-"));if(F.isNone(l))return null;const {tl:A,br:D}=l;return[A[0],D[1],D[0],A[1]]}return x===e.EncodingType.R8G8B8A8_COLOR?(l=k[3],[l*k[0],l*k[1],l*k[2],l]):k}});g+=`uniform ${a} ${q};\n`;h+=`${a} ${f} = ${q};\n`;break;case e.AttributeStatus.DATA_DRIVEN:q=c(d[r][0]);h+=`${this._getType(w)} ${f} = ${q}${a};\n`;
break;case e.AttributeStatus.INTERPOLATED_DATA_DRIVEN:{q=`u_t_${f}`;v.push({name:q,type:"float",getValue:(y,k,l,A)=>(t?y.getLayoutProperty(r):y.getPaintProperty(r)).interpolator.interpolationUniformValue(l,k)});g+=`uniform float ${q};\n`;const u=c(d[r][0]);c=c(d[r][1]);h+=`${this._getType(w)} ${f} = mix(${u}${a}, ${c}${a}, ${q});\n`}}}this._shaderHeader=g;this._shaderMain=h;this._uniforms=v};m._bit=function(b){return(this._key&1<<b)>>b};m._getType=function(b){switch(b){case 1:return"float";case 2:return"vec2";
case 3:return"vec3";case 4:return"vec4"}throw Error("Invalid count");};m._encodeColor=function(b){const d=255*b[3];return J.i8888to32(b[0]*d,b[1]*d,b[2]*d,d)};m._encodePattern=function(b,d,g){if(g&&g.rect){var h=g.rect,v=g.width;g=g.height;d[b]=this._encodeShort(h.x+2,0);d[b]|=this._encodeShort(h.y+2+g,16);d[b+1]=this._encodeShort(h.x+2+v,0);d[b+1]|=this._encodeShort(h.y+2,16)}};m._encodeByte=function(b,d){return(b&255)<<d};m._encodeShort=function(b,d){return(b&65535)<<d};I._createClass(z,[{key:"key",
get:function(){return this._key}},{key:"type",get:function(){return this._key&7}}]);return z}();H._encodingInfo={[e.EncodingType.R8_SIGNED]:{dataType:n.DataType.BYTE,bytesPerElement:1,count:1,normalized:!1},[e.EncodingType.R8_UNSIGNED]:{dataType:n.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:1,normalized:!1},[e.EncodingType.R16_SIGNED]:{dataType:n.DataType.SHORT,bytesPerElement:2,count:1,normalized:!1},[e.EncodingType.R16_UNSIGNED]:{dataType:n.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:1,normalized:!1},
[e.EncodingType.R8G8_SIGNED]:{dataType:n.DataType.BYTE,bytesPerElement:1,count:2,normalized:!1},[e.EncodingType.R8G8_UNSIGNED]:{dataType:n.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:2,normalized:!1},[e.EncodingType.R16G16_SIGNED]:{dataType:n.DataType.SHORT,bytesPerElement:2,count:2,normalized:!1},[e.EncodingType.R16G16_UNSIGNED]:{dataType:n.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:2,normalized:!1},[e.EncodingType.R8G8B8A8_SIGNED]:{dataType:n.DataType.BYTE,bytesPerElement:1,count:4,normalized:!1},
[e.EncodingType.R8G8B8A8_UNSIGNED]:{dataType:n.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!1},[e.EncodingType.R8G8B8A8_COLOR]:{dataType:n.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!0},[e.EncodingType.R16G16B16A16_DASHARRAY]:{dataType:n.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1},[e.EncodingType.R16G16B16A16_PATTERN]:{dataType:n.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1}};const G=z=>{switch(z){case n.DataType.FLOAT:return 4;
case n.DataType.INT:return 4;case n.DataType.UNSIGNED_INT:return 4;case n.DataType.SHORT:return 2;case n.DataType.UNSIGNED_SHORT:return 2;case n.DataType.BYTE:return 1;case n.DataType.UNSIGNED_BYTE:return 1}},L=(z,m,b)=>{m/=b;if(1===z)switch(m){case 0:return".x";case 1:return".y";case 2:return".z";case 3:return".w"}else if(2===z)switch(m){case 0:return".xy";case 1:return".yz";case 2:return".zw"}else if(3===z)switch(m){case 0:return".xyz";case 1:return".yzw"}return""};E.VTLMaterial=H;Object.defineProperty(E,
"__esModule",{value:!0})});