// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/maybe ../../../../../../core/screenUtils ../../../../../../chunks/mat2df32 ../../../../../../chunks/vec2f32 ../../../../../../symbols/cim/enums ../../color ../../definitions ../../number ../../materialKey/MaterialKey ./util ./WGLBaseMarkerTemplate ./WGLMeshTemplate".split(" "),function(G,H,m,I,J,t,x,p,u,K,v,L,M){return function(F){function q(a,b,l,e,h,d,k,f,n,z,A,B,C,D,g,E,y,w,r,N,O,P,Q){var c=F.call(this)||this;c.angle=
e;c.height=k;c.width=d;c.xOffset=b*r;c.yOffset=l*r;c._markerPlacement=N;c._effects=O;c._anchorX=.5-(.5+E)*g.width/g.width;c._anchorY=.5-(.5+y)*g.height/g.height;c._minMaxZoom=u.i1616to32(Math.round(P*p.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(Q*p.MIN_MAX_ZOOM_PRECISION_FACTOR));b=(D===t.Alignment.MAP?p.BITSET_MARKER_ALIGNMENT_MAP:p.BITSET_MARKER_ALIGNMENT_SCREEN)|(A?p.BITSET_GENERIC_LOCK_COLOR:0)|(C?p.BITSET_MARKER_OUTLINE_ALLOW_COLOR_OVERRIDE:0)|(B?p.BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY:0);
l=g&&g.sdf;a=K.MarkerMaterialKey.load(a);a.sdf=l;a.pattern=!0;a.textureBinding=g.textureBinding;c._materialKey=a.data;c._fillColor=h;c._outlineColor=n;c._sizeOutlineWidth=u.i8888to32(Math.round(Math.min(Math.sqrt(128*d),255)),Math.round(Math.min(Math.sqrt(128*k),255)),Math.round(Math.min(Math.sqrt(128*z),255)),Math.round(Math.min(Math.sqrt(128*f),255)));h=g.rect.x+p.SPRITE_PADDING;f=g.rect.y+p.SPRITE_PADDING;n=h+g.width;g=f+g.height;c._offsets.xUpperLeft=h;c._offsets.yUpperLeft=f;c._offsets.xUpperRight=
n;c._offsets.yUpperRight=f;c._offsets.xBottomLeft=h;c._offsets.yBottomLeft=g;c._offsets.xBottomRight=n;c._offsets.yBottomRight=g;c._texUpperLeft=u.i1616to32(h,f);c._texUpperRight=u.i1616to32(n,f);c._texBottomLeft=u.i1616to32(h,g);c._texBottomRight=u.i1616to32(n,g);d=d*w*r;k=k*w*r;c._bitestAndDistRatio=u.i1616to32(b,Math.round(64*w));c._computedWidth=d;c._computedHeight=k;d=J.create();k=I.create();c._applyTransformation(k,d);return c}G._inheritsLoose(q,F);q.fromCIMMarker=function(a,b,l){const e=a.size,
h=(b&&b.width||1)/(b&&b.height||1)*a.scaleX;var d=a.scaleSymbolsProportionally&&a.frameHeight?e/a.frameHeight:1;let k=x.premultiplyAlphaRGBA(a.color);const f=x.premultiplyAlphaRGBA(a.outlineColor),n=m.pt2px(e),z=n*h,A=m.pt2px(a.offsetX||0),B=m.pt2px(a.offsetY||0);d*=m.pt2px(a.outlineWidth||0);const C=a.alignment||t.Alignment.SCREEN,D=m.pt2px(a.referenceSize),[g,E]=v.getMinMaxZoom(a.scaleInfo,l);b.sdf||0!==k||(k=-1);l=a.rotation||0;a.rotateClockwise||(l=-l);let y=0,w=0;const r=a.anchorPoint;r&&(a.isAbsoluteAnchorPoint?
e&&(y=-r.x/(e*h),w=r.y/e):(y=r.x,w=r.y));b=new q(a.materialKey,A,B,l,k,z,n,D,f,d,a.colorLocked,a.scaleSymbolsProportionally,!1,C,b,y,w,a.sizeRatio,H.unwrapOr(a.scaleFactor,1),a.markerPlacement,a.effects,g,E);b._vertexBoundsScaleX=a.maxVVSize?a.maxVVSize/z:1;b._vertexBoundsScaleY=a.maxVVSize?a.maxVVSize/n:1;return b};q.fromPictureMarker=function(a,b){const l=Math.round(m.pt2px(a.width)),e=Math.round(m.pt2px(a.height)),h=p.PICTURE_FILL_COLOR,d=Math.round(m.pt2px(a.xoffset||0)),k=Math.round(m.pt2px(a.yoffset||
0));b=new q(a.materialKey,d,k,a.angle,h,l,e,e,0,0,!1,!1,!1,t.Alignment.SCREEN,b,0,0,1,1,null,null,v.DEFAULT_MIN_ZOOM,v.DEFAULT_MAX_ZOOM);b._vertexBoundsScaleX=a.maxVVSize?a.maxVVSize/a.width:1;b._vertexBoundsScaleY=a.maxVVSize?a.maxVVSize/a.height:1;return b};q.fromSimpleMarker=function(a,b){const l=x.premultiplyAlphaRGBAArray(a.color),e=Math.round(m.pt2px(a.size)),h=Math.round(m.pt2px(a.xoffset||0)),d=Math.round(m.pt2px(a.yoffset||0)),k=a.style;var f=a.outline;const n=(f&&f.color&&x.premultiplyAlphaRGBAArray(f.color))|
0;f=(f&&f.width&&Math.round(m.pt2px(f.width)))|0;b=new q(a.materialKey,h,d,a.angle,l,e,e,e,n,f,!1,!1,"esriSMSCross"===k||"esriSMSX"===k,t.Alignment.SCREEN,b,0,0,1.96875,1,null,null,v.DEFAULT_MIN_ZOOM,v.DEFAULT_MAX_ZOOM);b.boundsType="esriSMSCircle"===k?"circle":"square";b._vertexBoundsScaleX=a.maxVVSize?a.maxVVSize/a.size:1;b._vertexBoundsScaleY=a.maxVVSize?a.maxVVSize/a.size:1;return b};q.fromLineSymbolMarker=function(a,b){const l=x.premultiplyAlphaRGBAArray(a.color),e=Math.round(m.pt2px(6*a.lineWidth)),
h="cross"===a.style||"x"===a.style;switch(a.placement){case "begin-end":var d=t.ExtremityPlacement.Both;break;case "begin":d=t.ExtremityPlacement.JustBegin;break;case "end":d=t.ExtremityPlacement.JustEnd;break;default:d=t.ExtremityPlacement.None}d={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:d,offsetAlongLine:0};b=new q(a.materialKey,0,0,0,l,e,e,e/6,l,h?Math.round(m.pt2px(a.lineWidth)):0,!1,!1,h,t.Alignment.MAP,b,0,0,1.96875,1,d,null,v.DEFAULT_MIN_ZOOM,v.DEFAULT_MAX_ZOOM);
b.boundsType="circle"===a.style?"circle":"square";return b};return q}(L(M))});