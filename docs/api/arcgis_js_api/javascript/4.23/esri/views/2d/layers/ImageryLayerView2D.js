// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/flow/FlowView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/HandleOwner ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./dataUtils ./FlowContainer ./FlowStrategy ./FlowStyle".split(" "),function(z,
B,u,v,n,r,q,t,G,O,H,P,Z,aa){v=function(Y){function X(){var x=Y.apply(this,arguments)||this;x._loadImagery=(N,M,E,F,f)=>H.loadImagery(x.layer,N,M,E,F,f);x._createStreamlinesMesh=(N,M,E)=>x.layer.createStreamlinesMesh({flowData:M,rendererSettings:N},{signal:E});x.attached=!1;x.container=null;x.layer=null;x.type="flow";x.timeExtent=null;x.redrawOrRefetch=z._asyncToGenerator(function*(){x._updateVisualization()});return x}z._inheritsLoose(X,Y);var W=X.prototype;W.attach=function(){const {layer:x}=this,
N=()=>{this._loadImagery=(M,E,F,f,b)=>H.loadImagery(x,M,E,F,f,b);this._updateVisualization()};"multidimensionalDefinition"in x?this.handles.add(n.watch(()=>x.multidimensionalDefinition,N)):this.handles.add([n.watch(()=>x.mosaicRule,N),n.watch(()=>x.renderingRule,N),n.watch(()=>x.definitionExpression,N)]);this.container=new P;this._strategy=new Z({flowContainer:this.container});this._updateVisualization()};W.detach=function(){this._strategy.destroy();this.container.removeAllChildren();this.container=
null;this.handles.removeAll()};W.update=function(x){x.stationary?this._strategy.update(x):this.layerView.requestUpdate()};W.hitTest=function(x){return new u({attributes:{},geometry:x.clone(),layer:this.layer})};W.moveEnd=function(){};W.doRefresh=function(){var x=z._asyncToGenerator(function*(){});return function(){return x.apply(this,arguments)}}();W._updateVisualization=function(){if("flow"===this.layer.renderer.type){var x=new aa(this._loadImagery,this._createStreamlinesMesh,this.layer.renderer,
this.timeExtent);this.container.flowStyle=x;this.layerView.requestUpdate()}};z._createClass(X,[{key:"updating",get:function(){return!this._strategy||this._strategy.updating}}]);return X}(v.HandleOwner);B.__decorate([r.property()],v.prototype,"_strategy",void 0);B.__decorate([r.property()],v.prototype,"attached",void 0);B.__decorate([r.property()],v.prototype,"container",void 0);B.__decorate([r.property()],v.prototype,"layer",void 0);B.__decorate([r.property()],v.prototype,"layerView",void 0);B.__decorate([r.property()],
v.prototype,"type",void 0);B.__decorate([r.property()],v.prototype,"updating",null);B.__decorate([r.property()],v.prototype,"timeExtent",void 0);return v=B.__decorate([O.subclass("esri.views.2d.engine.flow.FlowView2D")],v)})},"esri/views/2d/engine/flow/dataUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/RandomLCG ../../../../geometry/support/spatialReferenceUtils ../../../../geometry/Extent".split(" "),
function(z,B,u,v,n,r,q,t,G,O){function H(){H=B._asyncToGenerator(function*(f,b,c){const d=performance.now();var g=P(f,b);const m=performance.now();g=aa(f,g,b.width,b.height);b=performance.now();var l=X(g,!0);g=performance.now();l=W(l);const y=performance.now();f.profile&&F.info("createStreamlinesMesh profile",{"_createFlowFieldFromData()":Math.round(m-d),"_getStreamlines()":Math.round(b-m),"createAnimatedLinesData()":Math.round(g-b),"createLinesMesh()":Math.round(y-g),"Total elapsed time":Math.round(y-
d)});yield Promise.resolve();q.throwIfAborted(c);return l});return H.apply(this,arguments)}function P(f,b){const c=Y(b.data,b.width,b.height,f.smoothing);return f.interpolate?(d,g)=>{const m=Math.floor(d),l=Math.floor(g);if(0>m||m>=b.width||0>l||l>=b.height)return[0,0];d-=m;g-=l;const y=m<b.width-1?m+1:m,I=l<b.height-1?l+1:l;return[(c[2*(l*b.width+m)]*(1-g)+c[2*(I*b.width+m)]*g)*(1-d)+(c[2*(l*b.width+y)]*(1-g)+c[2*(I*b.width+y)]*g)*d,(c[2*(l*b.width+m)+1]*(1-g)+c[2*(I*b.width+m)+1]*g)*(1-d)+(c[2*
(l*b.width+y)+1]*(1-g)+c[2*(I*b.width+y)+1]*g)*d]}:(d,g)=>{d=Math.round(d);g=Math.round(g);return 0>d||d>=b.width||0>g||g>=b.height?[0,0]:[c[2*(g*b.width+d)],c[2*(g*b.width+d)+1]]}}function Z(f,b,c,d,g,m,l,y,I){const R=[];let T=0,[J,Q]=b(c,d);J*=f.velocityScale;Q*=f.velocityScale;R.push({x:c,y:d,t:T,speed:Math.sqrt(J*J+Q*Q)});for(let a=0;a<f.verticesPerLine;a++){let [e,h]=b(c,d);e*=f.velocityScale;h*=f.velocityScale;const k=Math.sqrt(e*e+h*h);if(k<f.minSpeedThreshold)break;const A=e/k,C=h/k;c+=A*
f.segmentLength;d+=C*f.segmentLength;T+=f.segmentLength/k;if(Math.acos(A*L+C*S)>f.maxTurnAngle)break;if(f.mergeLines){var L=Math.round(c*I);var S=Math.round(d*I);if(0>L||L>l-1||0>S||S>y-1)break;const p=m[S*l+L];if(-1!==p&&p!==g)break;m[S*l+L]=g}R.push({x:c,y:d,t:T,speed:k});L=A;S=C}return R}function aa(f,b,c,d){const g=[],m=new t,l=1/Math.max(f.lineCollisionWidth,1),y=Math.round(c*l),I=Math.round(d*l),R=new Int32Array(y*I);for(var T=0;T<R.length;T++)R[T]=-1;T=[];for(let J=0;J<d;J+=f.lineSpacing)for(let Q=
0;Q<c;Q+=f.lineSpacing)T.push({x:Q,y:J,sort:m.getFloat()});T.sort((J,Q)=>J.sort-Q.sort);for(const {x:J,y:Q}of T)m.getFloat()<f.density&&(c=Z(f,b,J,Q,g.length,R,y,I,l),2>c.length||g.push(c));return g}function Y(f,b,c,d){if(0===d)return f;const g=Math.round(3*d),m=Array(2*g+1);var l=0;for(var y=-g;y<=g;y++){var I=Math.exp(-y*y/(d*d));m[y+g]=I;l+=I}for(d=-g;d<=g;d++)m[d+g]/=l;l=new Float32Array(f.length);for(d=0;d<c;d++)for(y=0;y<b;y++){var R=I=0;for(var T=-g;T<=g;T++)if(!(0>y+T||y+T>=b)){var J=m[T+
g];I+=J*f[2*(d*b+(y+T))];R+=J*f[2*(d*b+(y+T))+1]}l[2*(d*b+y)]=I;l[2*(d*b+y)+1]=R}f=new Float32Array(f.length);for(d=0;d<b;d++)for(y=0;y<c;y++){R=I=0;for(T=-g;T<=g;T++)0>y+T||y+T>=c||(J=m[T+g],I+=J*l[2*((y+T)*b+d)],R+=J*l[2*((y+T)*b+d)+1]);f[2*(y*b+d)]=I;f[2*(y*b+d)+1]=R}return f}function X(f,b){const c=new t;var d=f.reduce((y,I)=>y+I.length,0);d=new Float32Array(4*d);const g=Array(f.length);let m=0,l=0;for(const y of f){f=m;for(const I of y)d[4*m]=I.x,d[4*m+1]=I.y,d[4*m+2]=I.t,d[4*m+3]=I.speed,m++;
g[l++]={startVertex:f,numberOfVertices:y.length,totalTime:y[y.length-1].t,timeSeed:b?c.getFloat():0}}return{lineVertices:d,lineDescriptors:g}}function W(f,b=10){function c(L,S,a,e,h,k,A,C){const p=9*I;let w=0;y[p+w++]=L;y[p+w++]=S;y[p+w++]=1;y[p+w++]=a;y[p+w++]=k;y[p+w++]=A;y[p+w++]=e/2;y[p+w++]=h/2;y[p+w++]=C;I++;y[p+w++]=L;y[p+w++]=S;y[p+w++]=-1;y[p+w++]=a;y[p+w++]=k;y[p+w++]=A;y[p+w++]=-e/2;y[p+w++]=-h/2;y[p+w++]=C;I++}const {lineVertices:d,lineDescriptors:g}=f;var m=f=0;for(var l of g)f+=2*l.numberOfVertices,
m+=6*(l.numberOfVertices-1);const y=new Float32Array(9*f);l=new Uint32Array(m);let I=0;f=0;for(const L of g){const {totalTime:S,timeSeed:a}=L;let e=m=null,h=null;var R=null,T=null,J=null;for(let k=0;k<L.numberOfVertices;k++){R=d[4*(L.startVertex+k)];const A=d[4*(L.startVertex+k)+1],C=d[4*(L.startVertex+k)+2],p=d[4*(L.startVertex+k)+3];let w=null,D=null;var Q=null;let K=null;0<k&&(w=R-m,D=A-e,Q=Math.sqrt(w*w+D*D),w/=Q,D/=Q,1<k?(T=w+T,J=D+J,Q=Math.sqrt(T*T+J*J),T/=Q,J/=Q,Q=Math.min(1/(T*w+J*D),b),T*=
Q,J*=Q,Q=-J,K=T):(Q=-D,K=w),null!==Q&&null!==K&&(c(m,e,h,Q,K,S,a,p),l[f++]=I-2,l[f++]=I,l[f++]=I-1,l[f++]=I,l[f++]=I+1,l[f++]=I-1));m=R;e=A;h=C;T=w;J=D;R=p}c(m,e,h,-J,T,S,a,R)}return{vertexData:y,indexData:l}}function x(f,b){const c=b.pixels,{width:d,height:g}=b;b=new Float32Array(d*g*2);if("vector-uv"===f)for(f=0;f<d*g;f++)b[2*f]=c[0][f],b[2*f+1]=-c[1][f];else if("vector-magdir"===f)for(f=0;f<d*g;f++){const m=c[0][f],l=n.deg2rad(c[1][f]),y=Math.sin(l-Math.PI/2);b[2*f]=Math.cos(l-Math.PI/2)*m;b[2*
f+1]=y*m}return{data:b,width:d,height:g}}function N(){N=B._asyncToGenerator(function*(f,b,c,d,g,m){var l=G.getInfo(b.spatialReference);if(!l)return M(f,b,c,d,g,m);const [y,I]=l.valid;l=Math.ceil(b.width/(I-y));const R=b.width/l,T=Math.round(c/l);let J=b.xmin;const Q=[];for(let L=0;L<l;L++){const S=new O({xmin:J,xmax:J+R,ymin:b.ymin,ymax:b.ymax,spatialReference:b.spatialReference});Q.push(M(f,S,T,d,g,m));J+=R}b=yield Promise.all(Q);d={data:new Float32Array(c*d*2),width:c,height:d};f=0;for(const L of b){for(b=
0;b<L.height;b++)for(g=0;g<L.width;g++)f+g>=c||(d.data[2*(b*c+f+g)]=L.data[2*(b*L.width+g)],d.data[2*(b*c+f+g)+1]=L.data[2*(b*L.width+g)+1]);f+=L.width}return d});return N.apply(this,arguments)}function M(f,b,c,d,g,m){return E.apply(this,arguments)}function E(){E=B._asyncToGenerator(function*(f,b,c,d,g,m){const l={requestProjectedLocalDirections:!0,signal:m};r.isSome(g)&&(l.timeExtent=g);if("imagery"===f.type)return yield f.load({signal:m}),g=f.rasterInfo.dataType,f=yield f.fetchImage(b,c,d,l),!f||
r.isNone(f.pixelData)||r.isNone(f.pixelData.pixelBlock)?{data:new Float32Array(c*d*2),width:c,height:d}:x(g,f.pixelData.pixelBlock);yield f.load({signal:m});g=f.rasterInfo.dataType;f=yield f.fetchPixels(b,c,d,l);return!f||r.isNone(f.pixelBlock)?{data:new Float32Array(c*d*2),width:c,height:d}:x(g,f.pixelBlock)});return E.apply(this,arguments)}const F=v.getLogger("esri.views.2d.engine.flow.dataUtils");z.createAnimatedLinesData=X;z.createLinesMesh=W;z.createStreamlinesMesh=function(f,b,c){return H.apply(this,
arguments)};z.fetchPart=M;z.loadImagery=function(f,b,c,d,g,m){return N.apply(this,arguments)};Object.defineProperty(z,"__esModule",{value:!0})})},"esri/views/2d/engine/flow/FlowContainer":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./BrushFlow","../webgl/enums","../webgl/WGLContainer"],function(z,B,u,v){return function(n){function r(){var t=n.apply(this,arguments)||this;t.flowStyle=null;return t}z._inheritsLoose(r,n);var q=r.prototype;q.doRender=function(t){n.prototype.doRender.call(this,
t)};q.prepareRenderPasses=function(t){const G=t.registerRenderPass({name:"flow",brushes:[B],target:()=>this.children,drawPhase:u.WGLDrawPhase.MAP});return[...n.prototype.prepareRenderPasses.call(this,t),G]};z._createClass(r,[{key:"requiresDedicatedFBO",get:function(){return!1}}]);return r}(v)})},"esri/views/2d/engine/flow/FlowStrategy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Point ./FlowDisplayData ./FlowDisplayObject ../../../../geometry/Extent".split(" "),
function(z,B,u,v,n,r,q,t,G,O,H,P,Z,aa,Y,X,W){function x(M,E){const F=new aa({x:(M.xmax+M.xmin)/2,y:(M.ymax+M.ymin)/2,spatialReference:M.spatialReference});var f=M.xmax-M.xmin;const b=M.ymax-M.ymin,c=Math.abs(Math.cos(r.deg2rad(E))),d=Math.abs(Math.sin(r.deg2rad(E)));E=c*f+d*b;f=d*f+c*b;M=new W({xmin:F.x-E/2,ymin:F.y-f/2,xmax:F.x+E/2,ymax:F.y+f/2,spatialReference:M.spatialReference});M.centerAt(F);return M}const N=n.getLogger("esri.views.2d.engine.flow.FlowStrategy");u=function(M){function E(f){f=
M.call(this,f)||this;f._flowDisplayObject=new X.FlowDisplayObject;f._loading=null;return f}z._inheritsLoose(E,M);var F=E.prototype;F.initialize=function(){this.flowContainer.addChild(this._flowDisplayObject)};F.destroy=function(){this._clear();this.flowContainer.removeAllChildren()};F.update=function(f){var {flowStyle:b}=this.flowContainer;if(q.isNone(b))this._clear();else{var {extent:c,rotation:d,resolution:g,pixelRatio:m}=f.state;f=x(c,d);f.expand(1.15);b=new Y(b,f,[Math.round((f.xmax-f.xmin)/g),
Math.round((f.ymax-f.ymin)/g)],m);if(q.isSome(this._loading)){if(this._loading.update(b))return;this._loading.destroy();this._loading=null}if(q.isNone(this._flowDisplayObject.displayData)||!this._flowDisplayObject.displayData.update(b))b.load().then(()=>{this._flowDisplayObject.clear();this._flowDisplayObject.displayData=this._loading;this._loading=null},l=>{t.isAbortError(l)||(N.error("A resource failed to load.",l),this._loading=null)}),this._loading=b}};F._clear=function(){this._flowDisplayObject.clear();
q.isSome(this._loading)&&(this._loading.destroy(),this._loading=null)};z._createClass(E,[{key:"updating",get:function(){return null!=this._loading}}]);return E}(v);B.__decorate([G.property()],u.prototype,"_loading",void 0);B.__decorate([G.property()],u.prototype,"flowContainer",void 0);B.__decorate([G.property()],u.prototype,"updating",null);return u=B.__decorate([Z.subclass("esri.views.2d.engine.flow.FlowStrategy")],u)})},"esri/views/2d/engine/flow/FlowDisplayData":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/Logger"],function(z,B){const u=B.getLogger("esri.views.2d.engine.flow.FlowDisplayData");return function(){function v(r,q,t,G){this.state={name:"created"};this.flowStyle=r;this.extent=q;this.size=t;this.pixelRatio=G}var n=v.prototype;n.load=function(){var r=z._asyncToGenerator(function*(){const q=new AbortController;this.state={name:"loading",abortController:q};this.state={name:"loaded",resources:yield this.flowStyle.loadResources({extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},
q.signal)}});return function(){return r.apply(this,arguments)}}();n.prepareForRendering=function(r){if("loaded"!==this.state.name)u.error("Only loaded resources can be attached.");else{var q=this.state.resources;q.prepareForRendering(r);this.state={name:"attached",resources:q}}};n.destroy=function(){"loading"===this.state.name?(this.state.abortController.abort(),this.state={name:"detached"}):"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})};n.update=function(r){if(!this.flowStyle.areResourcesCompatible(r.flowStyle)||
!this.extent.equals(r.extent)||this.size[0]!==r.size[0]||this.size[1]!==r.size[1]||this.pixelRatio!==r.pixelRatio)return!1;this.flowStyle=r.flowStyle;return!0};return v}()})},"esri/views/2d/engine/flow/FlowDisplayObject":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../DisplayObject".split(" "),function(z,B,u,v,n,r,q){q=function(t){function G(){var H=t.apply(this,arguments)||
this;H._displayData=null;return H}B._inheritsLoose(G,t);var O=G.prototype;O.clear=function(){v.isSome(this._displayData)&&(this._displayData.destroy(),this._displayData=null,this.requestRender())};O.setTransform=function(H){var {displayData:P}=this;if(!v.isNone(P)){var Z=[0,0];H.toScreen(Z,[P.extent.xmin,P.extent.ymax]);P=(P.extent.xmax-P.extent.xmin)/P.size[0]/H.resolution;var aa=u.deg2rad(H.rotation),{dvs:Y}=this.transforms;n.fromTranslation(Y,[-1,1,0]);n.scale(Y,Y,[2/(H.size[0]*H.pixelRatio),-2/
(H.size[1]*H.pixelRatio),1]);n.translate(Y,Y,[Z[0],Z[1],0]);n.rotate(Y,Y,aa);n.scale(Y,Y,[P*H.pixelRatio,P*H.pixelRatio,1])}};O._createTransforms=function(){return{dvs:r.create()}};B._createClass(G,[{key:"displayData",get:function(){return this._displayData},set:function(H){this._displayData=H;this.requestRender()}}]);return G}(q.DisplayObject);z.FlowDisplayObject=q;Object.defineProperty(z,"__esModule",{value:!0})})},"esri/views/2d/engine/flow/FlowStyle":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/maybe","../../../../core/promiseUtils","./FlowGLResources","./flowRendererUtils"],function(z,B,u,v,n){return function(){function r(t,G,O,H){this._loadImagery=t;this._createStreamlinesMesh=G;this._timeExtent=H;this._rendererSettings=n.createFlowRendererSettings(O)}var q=r.prototype;q.areResourcesCompatible=function(t){let G;(G=(G=(G=(G=(G=(G=(G=(G=(G=(G=(G=(G=(G=(G=(G=(G=t._loadImagery===this._loadImagery)&&t._createStreamlinesMesh===this._createStreamlinesMesh)&&t._rendererSettings.verticesPerLine===
this._rendererSettings.verticesPerLine)&&t._rendererSettings.segmentLength===this._rendererSettings.segmentLength)&&t._rendererSettings.lineSpacing===this._rendererSettings.lineSpacing)&&t._rendererSettings.density===this._rendererSettings.density)&&t._rendererSettings.smoothing===this._rendererSettings.smoothing)&&t._rendererSettings.velocityScale===this._rendererSettings.velocityScale)&&t._rendererSettings.minWeightThreshold===this._rendererSettings.minWeightThreshold)&&t._rendererSettings.minSpeedThreshold===
this._rendererSettings.minSpeedThreshold)&&t._rendererSettings.mergeLines===this._rendererSettings.mergeLines)&&t._rendererSettings.velocityScale===this._rendererSettings.velocityScale)&&t._rendererSettings.interpolate===this._rendererSettings.interpolate)&&t._rendererSettings.lineColor.kind===this._rendererSettings.lineColor.kind)&&t._rendererSettings.lineOpacity.kind===this._rendererSettings.lineOpacity.kind)&&t._rendererSettings.lineRenderWidth.kind===this._rendererSettings.lineRenderWidth.kind)&&
this._rendererSettings.mergeLines&&(G=t._rendererSettings.lineCollisionWidth===this._rendererSettings.lineCollisionWidth);G&&t._timeExtent!==this._timeExtent&&(G=B.isSome(t._timeExtent)&&B.isSome(this._timeExtent)?t._timeExtent.equals(this._timeExtent):!1);return G};q.loadResources=function(){var t=z._asyncToGenerator(function*(G,O){const {extent:H,size:P}=G;u.throwIfAborted(O);G=yield this._loadImagery(H,P[0],P[1],this._timeExtent,O);const {vertexData:Z,indexData:aa}=yield this._createStreamlinesMesh(this._rendererSettings,
G,O);return new v(Z,aa,{lineColor:this._rendererSettings.lineColor,lineOpacity:this._rendererSettings.lineOpacity,lineRenderWidth:this._rendererSettings.lineRenderWidth})});return function(G,O){return t.apply(this,arguments)}}();z._createClass(r,[{key:"animated",get:function(){return 0<this._rendererSettings.lineSpeed}},{key:"renderSettings",get:function(){return this._rendererSettings}}]);return r}()})},"esri/views/2d/engine/flow/FlowGLResources":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"../../../webgl/BufferObject","../../../webgl/enums","../../../webgl/VertexArrayObject","../../../webgl/VertexElementDescriptor"],function(z,B,u,v,n){const r=new Map;r.set("a_positionAndSide",0);r.set("a_timeInfo",1);r.set("a_extrude",2);r.set("a_speed",3);const q={geometry:[new n.VertexElementDescriptor("a_positionAndSide",3,u.DataType.FLOAT,0,36),new n.VertexElementDescriptor("a_timeInfo",3,u.DataType.FLOAT,12,36),new n.VertexElementDescriptor("a_extrude",2,u.DataType.FLOAT,24,36),new n.VertexElementDescriptor("a_speed",
1,u.DataType.FLOAT,32,36)]};return function(){function t(O,H,P){this.values=P;this._vertexData=O;this._indexData=H}var G=t.prototype;G.prepareForRendering=function(O){const H=B.BufferObject.createVertex(O,u.Usage.STATIC_DRAW,this._vertexData),P=B.BufferObject.createIndex(O,u.Usage.STATIC_DRAW,this._indexData);O=new v.VertexArrayObject(O,r,q,{geometry:H},P);this.vertexBuffer=H;this.indexBuffer=P;this.vertexArray=O;this._indexData=this._vertexData=null};G.detach=function(){this.vertexArray.dispose();
this.vertexBuffer.dispose();this.indexBuffer.dispose()};z._createClass(t,[{key:"locations",get:function(){return r}}]);return t}()})},"esri/views/2d/engine/flow/flowRendererUtils":function(){define(["exports","../../../../core/screenUtils"],function(z,B){function u(v){v=v.toRgba();return[v[0]/255,v[1]/255,v[2]/255,v[3]]}z.createFlowRendererSettings=function(v){if(v.hasVisualVariables("size")){var n=v.getVisualVariablesForType("size")[0];var r=[];var q=[];if(n.stops){for(var t of n.stops)r.push(t.value),
q.push(t.size);n=n.stops.length}else r.push(n.minDataValue,n.maxDataValue),q.push(n.minSize,n.maxSize),n=2;r={kind:"ramp",stops:r,values:q,count:n}}else r={kind:"constant",value:[B.pt2px(v.trailWidth)]};q="constant"===r.kind?r.value[0]:r.values[r.values.length-1];n=2*q;t=Math.round(B.pt2px(v.maxPathLength)/n)+1;if(v.hasVisualVariables("color")){var G=v.getVisualVariablesForType("color")[0],O=[],H=[];for(P of G.stops)O.push(P.value),Array.prototype.push.apply(H,u(P.color));var P={kind:"ramp",stops:O,
values:H,count:G.stops.length}}else P={kind:"constant",value:u(v.color)};if(v.hasVisualVariables("opacity")){G=v.getVisualVariablesForType("opacity")[0];O=[];H=[];for(Z of G.stops)O.push(Z.value),H.push(Z.opacity);var Z={kind:"ramp",stops:O,values:H,count:G.stops.length}}else Z={kind:"constant",value:[1]};const {flowSpeed:aa,trailLength:Y,density:X}=v;G=B.pt2px(v.smoothing);return{lineRenderWidth:r,segmentLength:n,verticesPerLine:t,lineCollisionWidth:q,lineSpacing:10,lineColor:P,lineOpacity:Z,lineSpeed:aa,
fadeDuration:Y,density:X,smoothing:G,velocityScale:"flow-from"===v.flowRepresentation?1:-1,minWeightThreshold:.001,minSpeedThreshold:.001,maxTurnAngle:1,mergeLines:!0,interpolate:!0,profile:!1}};Object.defineProperty(z,"__esModule",{value:!0})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../engine/Container ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(z,B,u,v,n,r,q,t,G,O,H,P,Z,aa,Y,X,W){const x=v.ofType({key:"type",base:aa,typeMap:{rect:Y,path:W,geometry:X}});z.LayerView2DMixin=N=>{N=function(M){function E(){var f=M.apply(this,arguments)||this;f.attached=!1;f.clips=new x;f.lastUpdateId=-1;f.moving=!1;f.updateRequested=!1;return f}B._inheritsLoose(E,M);var F=E.prototype;F.initialize=function(){var f,b,c,d;const g=null!=(f=null==(b=this.view)?void 0:b.spatialReferenceLocked)?f:!0;(null==(c=this.view)?0:c.spatialReference)&&g&&!this.spatialReferenceSupported?
this.addResolvingPromise(Promise.reject(new r("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new Z.Container),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([q.watch(()=>this.suspended,m=>{this.container&&(this.container.visible=!m);this.view&&!m&&this.updateRequested&&this.view.requestUpdate()},q.syncAndInitial),
q.watch(()=>{var m,l;return null!=(m=null==(l=this.layer)?void 0:l.opacity)?m:1},m=>{this.container&&(this.container.opacity=m)},q.syncAndInitial),q.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",m=>{this.container&&(this.container.blendMode=m)},q.syncAndInitial),q.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,m=>{this.container&&(this.container.effect=m)},q.syncAndInitial),q.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=this.clips)})]),
null!=(d=this.view)&&d.whenLayerView?this.view.whenLayerView(this.layer).then(m=>{m===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))};F.destroy=function(){this.processDetach();this.updateRequested=!1};F.processAttach=function(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())};F.processDetach=function(){this.attached&&(this.attached=!1,this.detach(),this.updateRequested=
!1)};F.isVisibleAtScale=function(f){const b=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!b)return!0;const {minScale:c,maxScale:d}=b;return(0===c||f<=c)&&(0===d||f>=d)};F.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};F.processUpdate=function(f){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",f),this.updateRequested&&!this.suspended&&
(this.updateRequested=!1,this.update(f)))};F.hitTest=function(f,b){return Promise.resolve(null)};F.supportsSpatialReference=function(f){return!0};F.canResume=function(){return this.spatialReferenceSupported?M.prototype.canResume.call(this)?this.visibleAtCurrentScale:!1:!1};F.getSuspendInfo=function(){const f=M.prototype.getSuspendInfo.call(this),b=!this.spatialReferenceSupported,c=this.visibleAtCurrentScale;b&&(f.spatialReferenceNotSupported=b);c&&(f.outsideScaleRange=c);return f};B._createClass(E,
[{key:"spatialReferenceSupported",get:function(){var f;const b=null==(f=this.view)?void 0:f.spatialReference;return null==b||this.supportsSpatialReference(b)}},{key:"updating",get:function(){var f;return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!(null==(f=this.updatingHandles)||!f.updating))}},{key:"visibleAtCurrentScale",get:function(){return this.isVisibleAtScale(this.view.scale)}}]);return E}(N);u.__decorate([t.property()],N.prototype,
"attached",void 0);u.__decorate([t.property({type:x,set(M){M=n.referenceSetter(M,this._get("clips"),x);this._set("clips",M)}})],N.prototype,"clips",void 0);u.__decorate([t.property()],N.prototype,"container",void 0);u.__decorate([t.property()],N.prototype,"moving",void 0);u.__decorate([t.property({readOnly:!0})],N.prototype,"spatialReferenceSupported",null);u.__decorate([t.property({readOnly:!0})],N.prototype,"updateParameters",void 0);u.__decorate([t.property()],N.prototype,"updateRequested",void 0);
u.__decorate([t.property()],N.prototype,"updating",null);u.__decorate([t.property()],N.prototype,"view",void 0);u.__decorate([t.property({readOnly:!0})],N.prototype,"visibleAtCurrentScale",null);return N=u.__decorate([P.subclass("esri.views.2d.layers.LayerView2D")],N)};Object.defineProperty(z,"__esModule",{value:!0})})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/set ../../../core/accessorSupport/decorators/subclass".split(" "),
function(z,B,u,v,n,r,q,t,G){u=function(O){function H(){return O.apply(this,arguments)||this}z._inheritsLoose(H,O);return H}(u.JSONSupport);return u=B.__decorate([G.subclass("esri.views.layers.support.ClipArea")],u)})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(z,B,u,v,n,r,q,t){var G;v=G=function(O){function H(){var P=O.apply(this,arguments)||this;P.type="rect";P.left=null;P.right=null;P.top=null;P.bottom=null;return P}z._inheritsLoose(H,O);H.prototype.clone=function(){return new G({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};z._createClass(H,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return H}(t);B.__decorate([u.property({type:[Number,String],json:{write:!0}})],v.prototype,"left",void 0);B.__decorate([u.property({type:[Number,
String],json:{write:!0}})],v.prototype,"right",void 0);B.__decorate([u.property({type:[Number,String],json:{write:!0}})],v.prototype,"top",void 0);B.__decorate([u.property({type:[Number,String],json:{write:!0}})],v.prototype,"bottom",void 0);B.__decorate([u.property({readOnly:!0})],v.prototype,"version",null);return v=G=B.__decorate([q.subclass("esri.views.layers.support.ClipRect")],v)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(z,B,u,v,n,r,q,t,G,O,H,P,Z){var aa;u={base:G,key:"type",typeMap:{extent:P,polygon:Z}};H=aa=function(Y){function X(){var W=Y.apply(this,arguments)||this;W.type="geometry";W.geometry=null;return W}z._inheritsLoose(X,Y);X.prototype.clone=function(){return new aa({geometry:this.geometry.clone()})};z._createClass(X,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return X}(H);B.__decorate([v.property({types:u,json:{read:O.fromJSON,write:!0}})],H.prototype,"geometry",void 0);
B.__decorate([v.property({readOnly:!0})],H.prototype,"version",null);return H=aa=B.__decorate([t.subclass("esri.views.layers.support.Geometry")],H)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(z,B,u,v,n,r,q,
t){v=function(G){function O(){var H=G.apply(this,arguments)||this;H.type="path";H.path=[];return H}z._inheritsLoose(O,G);z._createClass(O,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return O}(t);B.__decorate([u.property({type:[[[Number]]],json:{write:!0}})],v.prototype,"path",void 0);B.__decorate([u.property({readOnly:!0})],v.prototype,"version",null);return v=B.__decorate([q.subclass("esri.views.layers.support.Path")],v)})},"esri/views/2d/layers/graphics/HighlightGraphicContainer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/set ../../../../core/accessorSupport/decorators/subclass ../../engine/webgl/enums ./BaseGraphicContainer ../../../webgl/enums".split(" "),
function(z,B,u,v,n,r,q,t,G,O,H){u=function(P){function Z(){return P.apply(this,arguments)||this}z._inheritsLoose(Z,P);Z.prototype.renderChildren=function(aa){if(aa.drawPhase===G.WGLDrawPhase.HIGHLIGHT&&(this.attributeView.bindTextures(aa.context),this.children.some(X=>X.hasData))){P.prototype.renderChildren.call(this,aa);var {painter:Y}=aa;Y=Y.effects.highlight;Y.bind(aa);aa.context.setColorMask(!0,!0,!0,!0);aa.context.clear(H.ClearBufferBit.COLOR_BUFFER_BIT);this._renderChildren(aa,Y.defines.concat(["highlightAll"]));
Y.draw(aa);Y.unbind()}};return Z}(O);return u=B.__decorate([t.subclass("esri.views.2d.layers.support.HighlightGraphicContainer")],u)})},"esri/views/2d/layers/imagery/ImageryView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/Accessor ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/rasterFunctions/pixelUtils ../../engine/BitmapContainer ../../engine/Container ../../engine/ImageryBitmapSource ../support/ExportStrategy".split(" "),
function(z,B,u,v,n,r,q,t,G,O,H,P,Z,aa,Y,X,W){const x=n.getLogger("esri.views.2d.layers.imagery.ImageryView2D");v=function(N){function M(){var F=N.apply(this,arguments)||this;F.attached=!1;F.container=new Y.Container;F.updateRequested=!1;F.type="imagery";F._bitmapView=new aa.BitmapContainer;return F}z._inheritsLoose(M,N);var E=M.prototype;E.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.updateRequested=!1};E.update=function(F){this.strategy.update(F).catch(f=>{q.isAbortError(f)||
x.error(f)})};E.hitTest=function(F){return new u({attributes:{},geometry:F.clone(),layer:this.layer})};E.attach=function(){this.container.addChild(this._bitmapView);this.strategy=new W({container:this._bitmapView,imageNormalizationSupported:10<=this.layer.version,imageMaxHeight:10.1<=this.layer.version?this.layer.imageMaxHeight:2048,imageMaxWidth:10.1<=this.layer.version?this.layer.imageMaxWidth:2048,fetchSource:this._fetchImage.bind(this),requestUpdate:()=>this.requestUpdate()})};E.detach=function(){this.strategy.destroy();
this._bitmapView.removeAllChildren();this.container.removeAllChildren();this.updateRequested=!1};E.redraw=function(){this.strategy.updateExports(F=>{F.source instanceof HTMLImageElement?F.requestRender():this.layer.applyRenderer({pixelBlock:F.source.pixelBlock}).then(f=>{const b=F.source;b.pixelBlock=f.pixelBlock;b.filter=c=>this.layer.applyFilter(c);this.container.requestRender()})})};E.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())};E.isUpdating=
function(){return this.strategy.updating||this.updateRequested};E.getPixelData=function(){if(this.updating)return null;var F=this.strategy.bitmaps;if(1===F.length&&F[0].source)return{extent:F[0].source.extent,pixelBlock:F[0].source.originalPixelBlock};if(1<F.length){const f=this.view.extent;F=F.map(b=>b.source).filter(b=>b.extent&&b.extent.intersects(f)).map(b=>({extent:b.extent,pixelBlock:b.originalPixelBlock}));F=Z.mosaicPixelData(F,f);return r.isSome(F)?{extent:F.extent,pixelBlock:F.pixelBlock}:
null}return null};E._fetchImage=function(F,f,b,c){c=c||{};c.timeExtent=this.timeExtent;c.requestAsImageElement=!0;return this.layer.fetchImage(F,f,b,c).then(d=>d.imageElement?d.imageElement:this.layer.applyRenderer(d.pixelData,{signal:c.signal}).then(g=>{g=new X(g.pixelBlock,g.extent.clone(),d.pixelData.pixelBlock);g.filter=m=>this.layer.applyFilter(m);return g}))};z._createClass(M,[{key:"updating",get:function(){return!this.attached||this.isUpdating()}}]);return M}(v);B.__decorate([t.property()],
v.prototype,"attached",void 0);B.__decorate([t.property()],v.prototype,"container",void 0);B.__decorate([t.property()],v.prototype,"layer",void 0);B.__decorate([t.property()],v.prototype,"strategy",void 0);B.__decorate([t.property()],v.prototype,"timeExtent",void 0);B.__decorate([t.property()],v.prototype,"view",void 0);B.__decorate([t.property()],v.prototype,"updateRequested",void 0);B.__decorate([t.property()],v.prototype,"updating",null);B.__decorate([t.property()],v.prototype,"type",void 0);return v=
B.__decorate([P.subclass("esri.views.2d.layers.imagery.ImageryView2D")],v)})},"esri/views/2d/layers/support/ExportStrategy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/support/TileInfo ../../viewStateUtils ../../engine/Bitmap ../../tiling/TileInfoView ../../tiling/TileKey".split(" "),
function(z,B,u,v,n,r,q,t,G,O,H,P,Z,aa,Y,X,W){const x=H.create(),N=[0,0],M=new W(0,0,0,0);u=function(E){function F(b){var c=E.call(this,b)||this;c._imagePromise=null;c.bitmaps=[];c.hidpi=!1;c.imageMaxWidth=2048;c.imageMaxHeight=2048;c.imageRotationSupported=!1;c.imageNormalizationSupported=!1;c.update=v.debounce(function(){var d=z._asyncToGenerator(function*(g,m){if(!g.stationary||c.destroyed)return null;const l=g.state;var y=P.getInfo(l.spatialReference);g=c.hidpi?g.pixelRatio:1;var I=c.imageNormalizationSupported&&
l.worldScreenWidth&&l.worldScreenWidth<l.size[0];I?(N[0]=l.worldScreenWidth,N[1]=l.size[1]):c.imageRotationSupported?(N[0]=l.size[0],N[1]=l.size[1]):aa.getOuterSize(N,l);y=y&&(l.extent.xmin<y.valid[0]||l.extent.xmax>y.valid[1]);y=!c.imageNormalizationSupported&&y;const R=c.imageRotationSupported?l.rotation:0;Math.floor(N[0]*g)>c.imageMaxWidth||Math.floor(N[1]*g)>c.imageMaxHeight||y?(I=Math.min(c.imageMaxWidth,c.imageMaxHeight),y&&(I=Math.min(l.worldScreenWidth,I)),c._imagePromise=c._tiledExport(l,
I,R,g,m)):c._imagePromise=c._singleExport(l,N,I?l.paddedViewState.center:l.center,l.resolution,R,g,m);return c._imagePromise.then(function(){var T=z._asyncToGenerator(function*(J){c._imagePromise=null;if(!c.destroyed){c.bitmaps=null!=J?J:[];for(const Q of c.container.children)J.includes(Q)||Q.fadeOut().then(()=>{Q.remove()});for(const Q of J)c.container.addChild(Q),Q.fadeIn()}});return function(J){return T.apply(this,arguments)}}()).catch(T=>{c._imagePromise=null;throw T;})});return function(g,m){return d.apply(this,
arguments)}}(),5E3);return c}z._inheritsLoose(F,E);var f=F.prototype;f.destroy=function(){this.bitmaps=[]};f.updateExports=function(b){for(const c of this.container.children){if(!c.visible||!c.stage)break;b(c);c.invalidateTexture();c.requestRender()}};f._export=function(){var b=z._asyncToGenerator(function*(c,d,g,m,l,y){g=yield this.fetchSource(c,Math.floor(d*l),Math.floor(g*l),{rotation:m,pixelRatio:l,signal:y});g=new Y.Bitmap(g,"additive");g.x=c.xmin;g.y=c.ymax;g.resolution=c.width/d;g.rotation=
m;g.pixelRatio=l;return g});return function(c,d,g,m,l,y){return b.apply(this,arguments)}}();f._singleExport=function(){var b=z._asyncToGenerator(function*(c,d,g,m,l,y,I){aa.getBBox(x,g,m,d);c=new O(x[0],x[1],x[2],x[3],c.spatialReference);return[yield this._export(c,d[0],d[1],l,y,I)]});return function(c,d,g,m,l,y,I){return b.apply(this,arguments)}}();f._tiledExport=function(b,c,d,g,m){var l=Z.create({size:c,spatialReference:b.spatialReference,scales:[b.scale]});const y=new X(l);l=y.getTileCoverage(b);
if(!l)return null;const I=[];l.forEach((R,T,J,Q)=>{M.set(R,T,J,Q);y.getTileBounds(x,M);R=new O(x[0],x[1],x[2],x[3],b.spatialReference);I.push(this._export(R,c,c,d,g,m))});return Promise.all(I)};z._createClass(F,[{key:"updating",get:function(){return!this.destroyed&&null!==this._imagePromise}}]);return F}(u);B.__decorate([n.property()],u.prototype,"_imagePromise",void 0);B.__decorate([n.property()],u.prototype,"bitmaps",void 0);B.__decorate([n.property()],u.prototype,"container",void 0);B.__decorate([n.property()],
u.prototype,"fetchSource",void 0);B.__decorate([n.property()],u.prototype,"hidpi",void 0);B.__decorate([n.property()],u.prototype,"imageMaxWidth",void 0);B.__decorate([n.property()],u.prototype,"imageMaxHeight",void 0);B.__decorate([n.property()],u.prototype,"imageRotationSupported",void 0);B.__decorate([n.property()],u.prototype,"imageNormalizationSupported",void 0);B.__decorate([n.property()],u.prototype,"requestUpdate",void 0);B.__decorate([n.property()],u.prototype,"updating",null);return u=B.__decorate([G.subclass("esri.views.2d.layers.support.ExportStrategy")],
u)})},"esri/views/2d/viewStateUtils":function(){define(["exports"],function(z){const B=Math.PI/180;z.bboxIntersects=function(u,v){const [n,r,q,t]=u,[G,O,H,P]=v;return!(n>H||q<G||r>P||t<O)};z.getBBox=function(u,v,n,r){const [q,t]=v,[G,O]=r;v=.5*n;u[0]=q-v*G;u[1]=t-v*O;u[2]=q+v*G;u[3]=t+v*O;return u};z.getOuterSize=function(u,v){var n=v.rotation*B;const r=Math.abs(Math.cos(n));n=Math.abs(Math.sin(n));const [q,t]=v.size;u[0]=Math.round(t*n+q*r);u[1]=Math.round(t*r+q*n);return u};z.snapToPixel=function(u,
v,n){const {resolution:r,size:q}=n;u[0]=r*(Math.round(v[0]/r)+q[0]%2*.5);u[1]=r*(Math.round(v[1]/r)+q[1]%2*.5);return u};Object.defineProperty(z,"__esModule",{value:!0})})},"esri/views/2d/layers/imagery/VectorFieldView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../request ../../../../core/HandleOwner ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/support/rasterFunctions/rasterProjectionHelper ../../../../layers/support/rasterFunctions/vectorFieldUtils ../../engine/imagery/RasterVFContainer ./ImageryVFStrategy".split(" "),
function(z,B,u,v,n,r,q,t,G,O,H,P,Z,aa,Y,X,W){n=function(x){function N(){var E=x.apply(this,arguments)||this;E.attached=!1;E.container=new X.RasterVFContainer;E.type="imageryVF";E._dataParameters={exportParametersVersion:0,bbox:"",symbolTileSize:0,time:""};E._fetchpixels=function(){var F=z._asyncToGenerator(function*(f,b,c,d){const g=yield E._projectFullExtentPromise,{symbolTileSize:m}=E.layer.renderer,{extent:l,width:y,height:I}=Y.snapImageToSymbolTile(f,b,c,m,g);if(r.isSome(g)&&!g.intersects(f))return{extent:l,
pixelBlock:null};f={bbox:`${l.xmin}, ${l.ymin}, ${l.xmax}, ${l.ymax}`,exportParametersVersion:E.layer.exportImageServiceParameters.version,symbolTileSize:m,time:JSON.stringify(E.timeExtent||"")};if(E._canReuseVectorFieldData(f)&&(b=E.getPixelData(),r.isSome(b)&&`${b.extent.xmin}, ${b.extent.ymin}, ${b.extent.xmax}, ${b.extent.ymax}`===f.bbox))return b;({pixelData:d}=yield E.layer.fetchImage(l,y,I,{timeExtent:E.timeExtent,requestAsImageElement:!1,signal:d}));E._dataParameters=f;if(r.isNone(d.pixelBlock))return{extent:l,
pixelBlock:null};d="vector-uv"===E.layer.rasterInfo.dataType?r.unwrap(Y.convertVectorFieldData(d.pixelBlock,"vector-uv")):d.pixelBlock;return{extent:l,pixelBlock:d}});return function(f,b,c,d){return F.apply(this,arguments)}}();return E}z._inheritsLoose(N,x);var M=N.prototype;M.attach=function(){this._projectFullExtentPromise=this._getProjectedFullExtent(this.view.spatialReference);this._strategy=new W({container:this.container,fetchPixels:this._fetchpixels});this.handles.add(q.watch(()=>this.layer.renderer,
E=>this._updateSymbolizerParams(E),q.syncAndInitial),"vector-field-view-update")};M.detach=function(){this._strategy.destroy();this.container.children.forEach(E=>E.destroy());this.container.removeAllChildren();this.handles.remove("vector-field-view-update");this._strategy=this.container=this._projectFullExtentPromise=null};M.getPixelData=function(){if(this.updating||!this.container.children.length)return null;const {extent:E,pixelBlock:F}=this.container.children[0].rawPixelData;return{extent:E,pixelBlock:F}};
M.hitTest=function(E){return new u({attributes:{},geometry:E.clone(),layer:this.layer})};M.update=function(E){this._strategy.update(E,this._symbolizerParams)};M.redraw=function(){this._updateSymbolizerParams(this.layer.renderer);this._strategy.redraw(this._symbolizerParams)};M._canReuseVectorFieldData=function(E){const F=this._dataParameters.time===E.time,f=this._dataParameters.symbolTileSize===E.symbolTileSize,b=this._dataParameters.bbox===E.bbox;return this._dataParameters.exportParametersVersion===
E.exportParametersVersion&&F&&f&&b};M._getProjectedFullExtent=function(){var E=z._asyncToGenerator(function*(F){try{return yield aa.projectExtent(this.layer.fullExtent,F)}catch(f){try{const b=(yield v(this.layer.url,{query:{option:"footprints",outSR:F.wkid||JSON.stringify(F.toJSON()),f:"json"}})).data.featureCollection.layers[0].layerDefinition.extent;return b?Z.fromJSON(b):null}catch{return null}}});return function(F){return E.apply(this,arguments)}}();M._updateSymbolizerParams=function(E){"vector-field"===
E.type&&(this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null}))};z._createClass(N,[{key:"updating",get:function(){return!this.attached||this._strategy.updating}}]);return N}(n.HandleOwner);B.__decorate([t.property()],n.prototype,"attached",void 0);B.__decorate([t.property()],n.prototype,"container",void 0);B.__decorate([t.property()],n.prototype,"layer",void 0);B.__decorate([t.property()],n.prototype,"timeExtent",void 0);B.__decorate([t.property()],n.prototype,"type",
void 0);B.__decorate([t.property()],n.prototype,"view",void 0);B.__decorate([t.property()],n.prototype,"updating",null);return n=B.__decorate([P.subclass("esri.views.2d.layers.imagery.VectorFieldView2D")],n)})},"esri/layers/support/rasterFunctions/rasterProjectionHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../core/Error ../../../core/maybe ../../../core/unitUtils ../../../chunks/pe ../../../geometry/projection ../../../geometry/Extent ../../../geometry/Point ../../../geometry/SpatialReference".split(" "),
function(z,B,u,v,n,r,q,t,G,O,H){function P(a,e,h){return!t.canProjectWithoutEngine(a,e,h)}function Z(a,e,h){if((a=P(a,e,h))&&!t.isLoaded())throw new v("rasterprojectionhelper-project","projection engine is not loaded");return a}function aa(){aa=B._asyncToGenerator(function*(){if(t.isLoaded())return null;yield t.load()});return aa.apply(this,arguments)}function Y(a,e,h,k=null){const A=a.spatialReference;if(A.equals(e))return a;Z(A,e,k);h=h.center;h=new G({xmin:h.x-a.x/2,xmax:h.x+a.x/2,ymin:h.y-a.y/
2,ymax:h.y+a.y/2,spatialReference:A});k=t.project(h,e,k);if(n.isNone(k))return null;k={x:k.xmax-k.xmin,y:k.ymax-k.ymin};h=m(e);n.isSome(h)&&k.x>=h&&(e=r.getMetersPerUnitForSR(A)/r.getMetersPerUnitForSR(e),k.x=a.x*e,k.y=a.y*e);return k}function X(a,e=.01){return r.getMetersPerUnitForSR(a)?e/r.getMetersPerUnitForSR(a):0}function W(a,e,h=null,k=!0){var A=a.spatialReference;if(A.equals(e))return a;Z(A,e,h);h=t.project(a,e,h);if(!k||!h)return h;k=l(A,!0);e=l(e,!0);(A=X(A))&&n.isSome(k)&&n.isSome(e)&&(0<
h.x&&Math.abs(a.x-k[0])<A?h.x-=e[1]-e[0]:0>h.x&&Math.abs(a.x-k[1])<A&&(h.x+=e[1]-e[0]));return h}function x(a){const {inSR:e,outSR:h,datumTransformation:k,preferPE:A}=a;if(e.equals(h))return{points:a}=f(a,null),a;if(e.isWebMercator&&h.isWGS84||e.isWGS84&&h.isWebMercator){{const {cols:K,rows:U,xres:V,yres:ba,usePixelCenter:da,inSR:ea,outSR:fa}=a;let {xmin:ha,ymax:ca}=a;da&&(ha+=V/2,ca-=ba/2);a=[];var C=[],p=Math.max(K,U);for(var w=0;w<p;w++){var D=t.project(new O({x:ha+V*Math.min(K,w),y:ca-ba*Math.min(U,
w),spatialReference:ea}),fa);w<=K&&a.push(D.x);w<=U&&C.push(D.y)}p=[];for(w=0;w<K;w++)for(D=0;D<U;D++)p.push([a[w],C[D]]);a=p}return a}if(Z(e,h,k)&&A){if(e.isGeographic)return M(a);C=E(e);if(n.isSome(C))return M(a)}return N(a)}function N(a){var {points:e}=f(a,null);e=e.map(h=>new O(h[0],h[1],a.inSR));return t.project(e,a.outSR,a.datumTransformation).map(h=>h?[h.x,h.y]:[NaN,NaN])}function M(a){const {inSR:e,outSR:h,datumTransformation:k}=a,A=E(e),{points:C,mask:p}=f(a,A);e.isGeographic||(a=e.wkid?
q.PeFactory.coordsys(e.wkid):q.PeFactory.fromString(e.isGeographic?q.PeDefs.PE_TYPE_GEOGCS:q.PeDefs.PE_TYPE_PROJCS,e.wkt),q.PeCSTransformations.projToGeog(a,C.length,C));n.isSome(k)&&k.steps.length&&k.steps.forEach(w=>{const D=w.wkid?q.PeFactory.geogtran(w.wkid):q.PeFactory.fromString(q.PeDefs.PE_TYPE_GEOGTRAN,w.wkt);q.PeGTTransformations.geogToGeog(D,C.length,C,null,w.isInverse?q.PeDefs.PE_TRANSFORM_2_TO_1:q.PeDefs.PE_TRANSFORM_1_TO_2)});h.isGeographic||(a=E(h,!0),a=n.isSome(a)&&a.isEnvelope?[a.bbox[1],
a.bbox[3]]:[-90,90],b(C,a),a=h.wkid?q.PeFactory.coordsys(h.wkid):q.PeFactory.fromString(h.isGeographic?q.PeDefs.PE_TYPE_GEOGCS:q.PeDefs.PE_TYPE_PROJCS,h.wkt),q.PeCSTransformations.geogToProj(a,C.length,C));a=C;if(p&&C.length!==p.length){a=[];for(let w=0,D=0;w<p.length;w++)p[w]?a.push(C[D++]):a.push([NaN,NaN])}return a}function E(a,e=!1){var h=a.wkid||a.wkt;if(!h||a.isGeographic)return null;h=String(h);if(L.has(h))return h=L.get(h),e?null==h?void 0:h.gcs:null==h?void 0:h.pcs;var k=a.wkid?q.PeFactory.coordsys(a.wkid):
q.PeFactory.fromString(a.isGeographic?q.PeDefs.PE_TYPE_GEOGCS:q.PeDefs.PE_TYPE_PROJCS,a.wkt);a=X(a,1E-4);a=F(k,a);k=F(k,0,!0);L.set(h,{pcs:a,gcs:k});return e?k:a}function F(a,e=0,h=!1){var k=q.PePCSInfo.generate(a),A=h?a.horizonGcsGenerate():a.horizonPcsGenerate();if(null==A||!A.length)return null;h=!1;a=A.find(K=>1===K.getInclusive()&&1===K.getKind());if(!a){a=A.find(K=>1===K.getInclusive()&&0===K.getKind());if(!a)return null;h=!0}k=k.isPannableRectangle();a=a.getCoord();if(h)return{isEnvelope:h,
isPannable:k,vertices:a,coef:null,bbox:[a[0][0]-e,a[0][1]-e,a[1][0]+e,a[1][1]+e]};e=0;h=[];let [C,p]=a[0],[w,D]=a[0];for(let K=0,U=a.length;K<U;K++){e++;e===U&&(e=0);const [V,ba]=a[K],[da,ea]=a[e];if(ea===ba)h.push([V,da,ba,ea,2]);else{A=(da-V)/(ea-ba||1E-4);const fa=V-A*ba;ba<ea?h.push([A,fa,ba,ea,0]):h.push([A,fa,ea,ba,1])}C=C<V?C:V;p=p<ba?p:ba;w=w>V?w:V;D=D>ba?D:ba}return{isEnvelope:!1,isPannable:k,vertices:a,coef:h,bbox:[C,p,w,D]}}function f(a,e){const h=[],{cols:k,rows:A,xres:C,yres:p,usePixelCenter:w}=
a;let {xmin:D,ymax:K}=a;w&&(D+=C/2,K-=p/2);if(!n.isSome(e)){for(a=0;a<k;a++)for(e=0;e<A;e++)h.push([D+C*a,K-p*e]);return{points:h}}a=new Uint8Array(k*A);if(e.isEnvelope){const {bbox:[ha,ca,ia,ka]}=e;for(let la=0,ma=0;la<k;la++){var U=D+C*la,V=e.isPannable||U>=ha&&U<=ia;for(var ba=0;ba<A;ba++,ma++){var da=K-p*ba;V&&da>=ca&&da<=ka&&(h.push([U,da]),a[ma]=1)}}return{points:h,mask:a}}({coef:U}=e);e=[];for(V=0;V<A;V++){var ea=K-p*V;ba=[];da=[];for(var fa=0;fa<U.length;fa++){const [ha,ca,ia,ka,la]=U[fa];
ea===ia&&ia===ka?(ba.push(ha),ba.push(ca),da.push(2),da.push(2)):ea>=ia&&ea<=ka&&(ba.push(ha*ea+ca),da.push(la))}ea=ba;if(2<ba.length){fa=2===da[0]?0:da[0];let ha=ba[0];ea=[];for(let ca=1;ca<da.length;ca++)if(2!==da[ca]||ca===da.length-1)da[ca]!==fa&&(ea.push(0===fa?Math.min(ha,ba[ca-1]):Math.max(ha,ba[ca-1])),fa=da[ca],ha=ba[ca]),ca===da.length-1&&ea.push(0===da[ca]?Math.min(ha,ba[ca]):Math.max(ha,ba[ca]));ea.sort((ca,ia)=>ca-ia)}else ba[0]>ba[1]&&(ea=[ba[1],ba[0]]);e.push(ea)}for(let ha=0,ca=0;ha<
k;ha++)for(U=D+C*ha,V=0;V<A;V++,ca++)if(ba=K-p*V,da=e[V],2===da.length)U>=da[0]&&U<=da[1]&&(h.push([U,ba]),a[ca]=1);else if(2<da.length){ea=!1;for(fa=0;fa<da.length;fa+=2)if(U>=da[fa]&&U<=da[fa+1]){ea=!0;break}ea&&(h.push([U,ba]),a[ca]=1)}return{points:h,mask:a}}function b(a,e){const [h,k]=e;for(e=0;e<a.length;e++){const A=a[e][1];if(A<h||A>k)a[e]=[NaN,NaN]}}function c(a){const e=m(a[0].spatialReference);if(2>a.length||!n.isSome(e))return a[0];let {xmin:h,xmax:k,ymin:A,ymax:C}=a[0];for(let p=1;p<
a.length;p++){const w=a[p];k=w.xmax+e*p;A=Math.min(A,w.ymin);C=Math.max(C,w.ymax)}return new G({xmin:h,xmax:k,ymin:A,ymax:C,spatialReference:a[0].spatialReference})}function d(a,e,h=null,k=!0){if(a.spatialReference.equals(e))return a;const A=I(a),C=m(a.spatialReference,!0);var p=m(e);if(0===A||n.isNone(C)||n.isNone(p))return g(a,e,h,k);p=a.clone().normalize();if(1===p.length&&a.xmax<C&&a.xmax-C/2>X(a.spatialReference)){const {xmin:w,xmax:D}=a;for(let K=0;K<=A;K++)p[K]=new G({xmin:0===K?w:-C/2,xmax:K===
A?D-C*K:C/2,ymin:a.ymin,ymax:a.ymax,spatialReference:a.spatialReference})}a=p.map(w=>g(w,e,h,k));return c(a.filter(w=>!!w))}function g(a,e,h=null,k=!0,A=!0){const C=a.spatialReference;if(C.equals(e))return a;Z(C,e,h);const p=t.project(a,e,h);if(A&&e.isWebMercator&&p&&(p.ymax=Math.min(2.0037508342787E7,p.ymax),p.ymin=Math.max(-2.0037508342787E7,p.ymin),p.ymin>=p.ymax))return null;if(!k||!p)return p;var w=l(C,!0);k=l(e,!0);if(n.isNone(w)||n.isNone(k))return p;A=X(C,.001);const D=X(C,500);var K=X(e,
.001);if(Math.abs(p.xmin-k[0])<K&&Math.abs(p.xmax-k[1])<K){K=Math.abs(a.xmin-w[0]);w=Math.abs(w[1]-a.xmax);if(K<A&&w>D){p.xmin=k[0];var U=[];U.push(new O(a.xmax,a.ymin,C));U.push(new O(a.xmax,(a.ymin+a.ymax)/2,C));U.push(new O(a.xmax,a.ymax,C));U=U.map(V=>W(V,e,h)).filter(V=>!isNaN(null==V?void 0:V.x)).map(V=>V.x);p.xmax=Math.max.apply(null,U)}w<A&&K>D&&(p.xmax=k[1],k=[],k.push(new O(a.xmin,a.ymin,C)),k.push(new O(a.xmin,(a.ymin+a.ymax)/2,C)),k.push(new O(a.xmin,a.ymax,C)),a=k.map(V=>W(V,e,h)).filter(V=>
!isNaN(null==V?void 0:V.x)).map(V=>V.x),p.xmin=Math.min.apply(null,a))}else a=X(e,.001),Math.abs(p.xmin-k[0])<a&&(p.xmin=k[0]),Math.abs(p.xmax-k[1])<a&&(p.xmax=k[1]);return p}function m(a,e=!1){return a.isWebMercator?2*(e?2.0037508342787E7:2.0037508342788905E7):a.wkid&&a.isGeographic?360:2*Q[a.wkid]||null}function l(a,e=!1){if(a.isGeographic)return[-180,180];a=m(a,e);return n.isSome(a)?[-a/2,a/2]:null}function y(a,e,h,k){a=(a-e)/h;0!==a-Math.floor(a)?a=Math.floor(a):k&&--a;return a}function I(a,e=
!1){var h=m(a.spatialReference);if(!n.isSome(h))return 0;const k=e?0:-(h/2),A=X(a.spatialReference),C=!e&&Math.abs(a.xmin+h/2)<A?-h/2:a.xmin;a=y(!e&&Math.abs(a.xmax-h/2)<A?h/2:a.xmax,k,h,!0);h=y(C,k,h,!1);return a-h}function R(a){const {projectedExtent:e,srcBufferExtent:h,pixelSize:k,datumTransformation:A,rasterTransform:C}=a;var p=e.spatialReference;const w=h.spatialReference;Z(p,w);const {xmin:D,ymin:K,xmax:U,ymax:V}=e,ba=m(w),da=n.isSome(ba)&&(a.hasWrapAround||"gcs-shift"===(null==C?void 0:C.type));
a=a.spacing||[32,32];var ea=a[0]*k.x,fa=a[1]*k.y;const ha=1===a[0],ca=Math.ceil((U-D)/ea-.1/a[0])+(ha?0:1),ia=Math.ceil((V-K)/fa-.1/a[1])+(ha?0:1);p=x({cols:ca,rows:ia,xmin:D,ymax:V,xres:ea,yres:fa,inSR:p,outSR:w,datumTransformation:A,preferPE:4>=a[0],usePixelCenter:ha});ea=[];let ka;fa=0;const la=ha?-1:NaN,{xmin:ma,xmax:qa,ymax:ra,width:sa,height:ta}=h,ua=X(w,500);for(let oa=0;oa<ca;oa++){const pa=[];for(let na=0;na<ia;na++){var ja=p[oa*ia+na];da&&ja[0]>qa&&ja[0]>ba/2-ua&&(ja[0]-=ba);!ja||isNaN(ja[0])||
isNaN(ja[1])?(ea.push(la),ea.push(la),pa.push(null),fa++):(C&&(ja=C.inverseTransform(new O({x:ja[0],y:ja[1],spatialReference:w})),ja=[ja.x,ja.y]),pa.push(ja),0<oa&&da&&ka[na]&&ja[0]<ka[na][0]&&(ja[0]+=ba),ea.push((ja[0]-ma)/sa),ea.push((ra-ja[1])/ta))}ka=pa}return{offsets:ea,error:null,coefficients:null,outofBoundPointCount:fa,spacing:a,size:ha?[ca,ia]:[ca-1,ia-1]}}function T(a,e,h){const {cols:k,rows:A}=e;e=new Float32Array((k-1)*(A-1)*12);const C=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),p=new Float32Array([-1,
1,0,0,-1,1,1,0,0]);for(let ba=0;ba<k-1;ba++){for(var w=0;w<A-1;w++){var D=ba*A*2+2*w,K=a[D];const da=a[D+1];var U=a[D+2],V=a[D+3];D+=2*A;const ea=a[D],fa=a[D+1],ha=a[D+2];D=a[D+3];let ca=0,ia=12*(w*(k-1)+ba);for(let ka=0;3>ka;ka++)e[ia++]=C[ca++]*K+C[ca++]*U+C[ca++]*ha;ca=0;for(U=0;3>U;U++)e[ia++]=C[ca++]*da+C[ca++]*V+C[ca++]*D;ca=0;for(V=0;3>V;V++)e[ia++]=p[ca++]*K+p[ca++]*ea+p[ca++]*ha;ca=0;for(K=0;3>K;K++)e[ia++]=p[ca++]*da+p[ca++]*fa+p[ca++]*D}if(h)for(w=0;w<e.length;w++)isNaN(e[w])&&(e[w]=-1)}return e}
const J=function(a,e,h,k=0){if(1===h[0])return[0,0];var A=1,C=-1,p=1,w=-1;for(var D=0;D<a.length;D+=2)isNaN(a[D])||(A=A>a[D]?a[D]:A,C=C>a[D]?C:a[D],p=p>a[D+1]?a[D+1]:p,w=w>a[D+1]?w:a[D+1]);const {cols:K,rows:U}=e;e=(C-A)/K/h[0];h=(w-p)/U/h[1];k*=2;p=0;w=!1;A=[0,0];for(C=0;C<K-3;C++){for(D=0;D<U-3;D++){var V=C*U*2+2*D;const ba=Math.abs(((a[V]+a[V+4]+a[V+4*U]+a[V+4*U+4])/4-a[V+2*U+2])/e);V=Math.abs(((a[V+1]+a[V+5]+a[V+4*U+1]+a[V+4*U+5])/4-a[V+2*U+3])/h);ba+V>p&&(p=ba+V,A=[ba,V]);if(k&&p>k){w=!0;break}}if(w)break}return A},
Q={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53034:2.001508679602057E7,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,
54003:2.0037508342789244E7,54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54034:2.0037508342789244E7,54079:2.0037508342789244E7,54080:2.0037508342789244E7,54100:2.0037508342789244E7,54101:2.0037508342789244E7},L=new Map,S=new Map;z.computeProjectedScales=function(a,e,h=512,k=!0){const {extent:A,spatialReference:C,pixelSize:p}=a,w=Y(new O({x:p.x,y:p.y,spatialReference:C}),e,A);if(null==w)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};
var D=(w.x+w.y)/2,K=r.getMetersPerUnitForSR(e);D=D*K*96*39.37;const U=e.isGeographic?256/h*2.958287637958547E8:256/h*5.91657527591555E8;h="vector-magdir"===a.dataType||"vector-uv"===a.dataType;const V=d(A,e);h||k&&(e.isGeographic||e.isWebMercator)&&(h=0>V.xmin*V.xmax);k=D;if(h)k=U,a=e.isGeographic?1.341104507446289E-6:.29858214164761665,K=96*a*K*39.37,e=Y(new O({x:a,y:a,spatialReference:{wkid:e.isGeographic?4326:3857}}),C,V),e.x*=k/K,e.y*=k/K;else{e={x:p.x,y:p.y};a=Math.ceil(Math.log(Math.min(a.width,
a.height)/32)/Math.LN2);for(K=0;k<.5005*U&&K<a;)K++,k*=2,e.x*=2,e.y*=2;1.001>=Math.max(k,U)/Math.min(k,U)&&(k=U)}a=[k];K=[{x:e.x,y:e.y}];for(D=Math.min(70.5310735,D)/1.001;k>=D;)k/=2,e.x/=2,e.y/=2,a.push(k),K.push({x:e.x,y:e.y});return{projectedPixelSize:w,scales:a,srcResolutions:K,isCustomTilingScheme:!h}};z.defaultGridSpacing=32;z.defaultProjectionToleranceInPixels=4;z.getDefaultDatumTransformationForDataset=function(a,e,h){return Z(a.spatialReference,e)?h?t.getTransformation(e,a.spatialReference,
a):t.getTransformation(a.spatialReference,e,a):null};z.getProjectedGridPoints=x;z.getProjectionOffsetGrid=function(a){var e=a.isAdaptive&&null==a.spacing;let h=a.spacing||[32,32],k=R(a);var A={cols:k.size[0]+1,rows:k.size[1]+1};const C=0<k.outofBoundPointCount&&k.outofBoundPointCount<k.offsets.length/2;let p=k.outofBoundPointCount===k.offsets.length/2||e&&C?[0,0]:J(k.offsets,A,h,4);const w=(p[0]+p[1])/2;var D=a.projectedExtent.spatialReference;const K=a.srcBufferExtent.spatialReference;e&&(C||4<w)&&
(P(D,K,a.datumTransformation)&&(D.isGeographic||n.isSome(E(D))),h=[4,4],k=R({...a,spacing:h}),A={cols:k.size[0]+1,rows:k.size[1]+1},p=J(k.offsets,A,h,4));k.error=p;1<h[0]&&(k.coefficients=T(k.offsets,A,C));!a.includeGCSGrid||D.isGeographic||D.isWebMercator||(K.isGeographic?k.gcsGrid={offsets:k.offsets,coefficients:k.coefficients,spacing:h}:(e=E(D),n.isSome(e)&&!e.isEnvelope&&(D&&!D.isGeographic&&(e=String(D.wkid||D.wkt),S.has(e)?D=S.get(e):(D=(D.wkid?q.PeFactory.coordsys(D.wkid):q.PeFactory.fromString(q.PeDefs.PE_TYPE_PROJCS,
D.wkt)).getGeogcs().getCode(),S.set(e,D)),D=new H({wkid:D})),D=d(a.projectedExtent,D),{offsets:a}=R({...a,srcBufferExtent:D,spacing:h}),A=T(a,A,C),k.gcsGrid={offsets:a,coefficients:A,spacing:h})));return k};z.getRasterDatasetAlignmentInfo=function(a){const e=a.storageInfo.origin.x;var h=m(a.spatialReference,!0);if(!n.isSome(h))return{originX:e,halfWorldWidth:null,pyramidsInfo:null};const k=h/2,{nativePixelSize:A,storageInfo:C,extent:p}=a,{maximumPyramidLevel:w,blockWidth:D,pyramidScalingFactor:K}=
C;let U=A.x;const V=[];a=n.isSome(a.transform)&&"gcs-shift"===a.transform.type;const ba=e+(a?0:k);h=a?h-e:k-e;for(let da=0;da<=w;da++){const ea=(p.xmax-e)/U/D,fa=h/U/D;V.push({resolutionX:U,blockWidth:D,datsetColumnCount:0===ea-Math.floor(ea)?ea:Math.ceil(ea),worldColumnCountFromOrigin:0===fa-Math.floor(fa)?fa:Math.ceil(fa),leftMargin:Math.round(ba/U)%D,rightPadding:(D-Math.round(h/U)%D)%D,originColumnOffset:Math.floor(ba/U/D)});U*=K}return{originX:e,halfWorldWidth:k,pyramidsInfo:V,hasGCSSShiftTransform:a}};
z.getWorldWidth=m;z.getWorldWrapCount=I;z.load=function(){return aa.apply(this,arguments)};z.minimumGridSpacing=4;z.projectExtent=d;z.projectPoint=W;z.projectResolution=Y;z.requirePE=P;z.snapExtent=function(a){a=a.clone().normalize();return 1===a.length?a[0]:c(a)};z.snapPyramid=function(a,e,h){const {storageInfo:k,pixelSize:A}=e;let C=!1;var {pyramidResolutions:p}=k;if(n.isSome(p)&&p.length){a=(a.x+a.y)/2;var w=p[p.length-1];w=(w.x+w.y)/2;var D=(A.x+A.y)/2;if(a<=D)var K=0;else if(a>=w)K=p.length,
C=8<a/w;else{w=D;for(let U=1;U<=p.length;U++){D=(p[U-1].x+p[U-1].y)/2;if(a<=D){a===D?K=U:"down"===h?(K=U-1,C=8<a/w):K="up"===h?U:a-w>D-a||2<a/w?U:U-1;break}w=D}}h=0===K?A:p[K-1];return{pyramidLevel:K,pyramidResolution:new O({x:h.x,y:h.y,spatialReference:e.spatialReference}),excessiveReading:C}}K=Math.log(a.x/A.x)/Math.LN2;a=Math.log(a.y/A.y)/Math.LN2;p=e.storageInfo.maximumPyramidLevel||0;K="down"===h?Math.floor(Math.min(K,a)):"up"===h?Math.ceil(Math.max(K,a)):Math.round((K+a)/2);0>K?K=0:K>p&&(C=
K>p+3,K=p);h=2**K;e=new O({x:h*e.nativePixelSize.x,y:h*e.nativePixelSize.y,spatialReference:e.spatialReference});return{pyramidLevel:K,pyramidResolution:e,excessiveReading:C}};Object.defineProperty(z,"__esModule",{value:!0})})},"esri/layers/support/rasterFunctions/vectorFieldUtils":function(){define(["exports","../../../core/jsonMap","../../../core/maybe","../PixelBlock","./pixelUtils"],function(z,B,u,v,n){function r(b,c){return X.get(b)/X.get(c)||1}function q(b,c="geographic"){const [d,g]=b;b=Math.sqrt(d*
d+g*g);let m=Math.atan2(g,d)*W;m=(360+m)%360;"geographic"===c&&(m=(450-m)%360);return[b,m]}function t(b,c="geographic"){let d=b[1];"geographic"===c&&(d=(450-d)%360);d%=360;b=b[0];return[b*Math.cos(d/W),b*Math.sin(d/W)]}function G(b,c,d="geographic",g=1){if(!n.isValidPixelBlock(b))return b;const {pixels:m,width:l,height:y}=b;var I=l*y;const R=m[0],T=m[1],J=b.pixelType.startsWith("f")?b.pixelType:"f32",Q=v.createEmptyBand(J,I);I=v.createEmptyBand(J,I);let L=0;for(let S=0;S<y;S++)for(let a=0;a<l;a++)"vector-uv"===
c?([Q[L],I[L]]=q([R[L],T[L]],d),Q[L]*=g):([Q[L],I[L]]=t([R[L],T[L]],d),Q[L]*=g,I[L]*=g),L++;b=new v({pixelType:J,width:b.width,height:b.height,mask:b.mask,validPixelCount:b.validPixelCount,maskIsAlpha:b.maskIsAlpha,pixels:[Q,I]});b.updateStatistics();return b}function O(b=0,c=Math.PI,d=!0){d&&(c=(2*Math.PI-c)%(2*Math.PI));var g=d?-1:1;d=5*g;const m=20*g,l=25*g;g*=2;let [y,I]=[5,0-m],[R,T]=[y+2,I],[J,Q]=[R-0,T+g],[L,S]=[-5,0-l],[a,e]=[L+0,S-g];b=Math.ceil(b/5);let h=Math.floor(b/10);b-=8*h;const k=
[],A=[];for(let da=0;da<b/2;da++,h--){0>=h&&1===b%2&&da===(b-1)/2&&(L=0,a=L+0,S=(S+I)/2,e=S-g);const [ea,fa]=H(L,S,c,45);if(0<h){const [ha,ca]=H(R,S,c,45),[ia,ka]=H(y,I,c,45);k.push(ha);k.push(ca);k.push(ea);k.push(fa);k.push(ia);k.push(ka)}else{const [ha,ca]=H(R,T,c,45),[ia,ka]=H(J,Q,c,45),[la,ma]=H(a,e,c,45);A.push(ea);A.push(fa);A.push(la);A.push(ma);A.push(ia);A.push(ka);A.push(ha);A.push(ca)}S+=d;I+=d;T+=d;Q+=d;e+=d}const [C,p]=H(5,0+m,c,45),[w,D]=H(7,0+m,c,45),[K,U]=H(5,0-l,c,45),[V,ba]=H(7,
0-l,c,45);return{pennants:k,barbs:A,shaft:[C,p,w,D,K,U,V,ba]}}function H(b,c,d,g=1){return[Math.sqrt(b*b+c*c)/g,(2*Math.PI+(2*Math.PI+Math.atan2(c,b))%(2*Math.PI)-d)%(2*Math.PI)]}function P(b,c,d,g){d=r(g||"knots",d);for(g=1;g<c.length;g++)if(g===c.length-1){if(b<c[g]*d)break}else if(b<=c[g]*d)break;return Math.min(g-1,c.length-2)}function Z(b,c,d,g,m){let l=0;switch(c){case "beaufort_kn":l=P(b,M,"knots",d);break;case "beaufort_km":l=P(b,M,"kilometer-per-hour",d);break;case "beaufort_ft":l=P(b,M,
"feet-per-second",d);break;case "beaufort_m":l=P(b,M,"meter-per-second",d);break;case "classified_arrow":l=P(b,m,g,d);break;case "ocean_current_m":l=P(b,E,"meter-per-second",d);break;case "ocean_current_kn":l=P(b,F,"knots",d)}return l}function aa(b,c){const {style:d,inputUnit:g,outputUnit:m,breakValues:l}=c;c=x.fromJSON(g);const y=x.fromJSON(m);let I=0,R=0;const {width:T,height:J,mask:Q}=b,L=b.pixels[0];b=b.pixels[1];var S=Q?Q.filter(k=>0<k).length:T*J;const a=new Float32Array(42*S);S=new Uint32Array(15*
S);for(let k=0;k<J;k++)for(let A=0;A<T;A++){var e=k*T+A;if(!Q||Q[k*T+A]){var h;const C=null!=(h=(b[e]+360)%360/180*Math.PI)?h:2*Math.PI*Math.random(),p=Z(L[e],d,c,y,l);for(let w=0;w<N.length;w+=2)a[I++]=(A+.5)/T,a[I++]=(k+.5)/J,a[I++]=N[w],a[I++]=N[w+1]+C,a[I++]=p,a[I++]=L[e];e=7*(I/42-1);S[R++]=e;S[R++]=e+1;S[R++]=e+2;S[R++]=e+0;S[R++]=e+4;S[R++]=e+3;S[R++]=e+0;S[R++]=e+2;S[R++]=e+3;S[R++]=e+2;S[R++]=e+5;S[R++]=e+3;S[R++]=e+5;S[R++]=e+6;S[R++]=e+3}}return{vertexData:a,indexData:S}}function Y(b,c){let d=
0,g=0;const {width:m,height:l,mask:y}=b;b=b.pixels[0];const I=[],R=[];var T=x.fromJSON(c.inputUnit);T=r(T,"knots");c="wind_speed"===c.style?5:Number.MAX_VALUE;for(let Q=0;Q<l;Q++)for(let L=0;L<m;L++){var J=b[Q*m+L]*T;if((!y||y[Q*m+L])&&J<c){for(let S=0;4>S;S++)I[d++]=(L+.5)/m,I[d++]=(Q+.5)/l,I[d++]=2>S?-.5:.5,I[d++]=0===S%2?-.5:.5,I[d++]=0,I[d++]=J;J=4*(d/24-1);R[g++]=J;R[g++]=J+1;R[g++]=J+2;R[g++]=J+1;R[g++]=J+2;R[g++]=J+3}}return{vertexData:new Float32Array(I),indexData:new Uint32Array(R)}}const X=
new Map;X.set("meter-per-second",1);X.set("kilometer-per-hour",.277778);X.set("knots",.514444);X.set("feet-per-second",.3048);X.set("mile-per-hour",.44704);const W=180/Math.PI,x=new B.JSONMap({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"}),N=function(b=0,c=0,d=Math.PI,g=!0){g&&(d=(2*Math.PI-d)%(2*Math.PI));g=g?-1:1;const m=-7*g,l=-2*g,y=-16*g,[I,R]=H(0,c+13*g,d,21.75),[T,J]=
H(b-5.5,c+m,d,21.75),[Q,L]=H(b+5.5,c+m,d,21.75),[S,a]=H(b-1.5,c+l,d,21.75),[e,h]=H(b+1.5,c+l,d,21.75),[k,A]=H(b-1.5,c+y,d,21.75),[C,p]=H(b+1.5,c+y,d,21.75);return[I,R,T,J,S,a,e,h,Q,L,k,A,C,p]}(0,0,0),M=[0,1,3,6,10,16,21,27,33,40,47,55,63],E=[0,.5,1,1.5,2],F=[0,.25,.5,1,1.5,2,2.5,3,3.5,4],f=[];z.convertToLocalDirections=function(b,c,d,g="geographic"){if(!n.isValidPixelBlock(b)||u.isNone(d))return b;b="vector-magdir"===c?b.clone():u.unwrap(G(b,c));const m=b.pixels[1];for(let l=0;l<m.length;l++)m[l]=
"geographic"===g?(m[l]+d[l]+270)%360:(m[l]+360-d[l])%360;return"vector-magdir"===c?b:G(b,"vector-magdir")};z.convertVectorFieldData=G;z.convertVectorFieldUnit=function(b,c,d=1){if(1===d||!n.isValidPixelBlock(b))return b;b=b.clone();const {pixels:g,width:m,height:l}=b,y=g[0],I=g[1];let R=0;for(let T=0;T<l;T++)for(let J=0;J<m;J++)"vector-uv"===c?(y[R]*=d,I[R]*=d):y[R]*=d,R++;b.updateStatistics();return b};z.createVFMesh=function(b,c){if("simple_scalar"===c.style)var d=Y(b,c);else if("wind_speed"===
c.style){{if(0===f.length)for(var g=0;30>g;g++)f.push(O(5*g,0));c=x.fromJSON(c.inputUnit);c=r(c,"knots");const {width:I,height:R,mask:T}=b;g=b.pixels[0];b=b.pixels[1];const J=[],Q=[];let L=0,S=0;for(let a=0;a<R;a++)for(let e=0;e<I;e++){var m=a*I+e,l=g[m]*c;if((!T||T[a*I+e])&&5<=l){const h=null!=(d=(b[m]+360)%360/180*Math.PI)?d:2*Math.PI*Math.random(),{pennants:k,barbs:A,shaft:C}=f[Math.min(Math.floor(l/5),29)];if(0===k.length+A.length)continue;m=J.length/6;const p=(e+.5)/I,w=(a+.5)/R;for(var y=0;y<
k.length;y+=2)J[L++]=p,J[L++]=w,J[L++]=k[y],J[L++]=k[y+1]+h,J[L++]=0,J[L++]=l;for(y=0;y<A.length;y+=2)J[L++]=p,J[L++]=w,J[L++]=A[y],J[L++]=A[y+1]+h,J[L++]=0,J[L++]=l;for(y=0;y<C.length;y+=2)J[L++]=p,J[L++]=w,J[L++]=C[y],J[L++]=C[y+1]+h,J[L++]=0,J[L++]=l;for(l=0;l<k.length/6;l++)Q[S++]=m,Q[S++]=m+1,Q[S++]=m+2,m+=3;for(l=0;l<A.length/8;l++)Q[S++]=m,Q[S++]=m+1,Q[S++]=m+2,Q[S++]=m+1,Q[S++]=m+2,Q[S++]=m+3,m+=4;Q[S++]=m+0;Q[S++]=m+1;Q[S++]=m+2;Q[S++]=m+1;Q[S++]=m+3;Q[S++]=m+2;m+=4}}d={vertexData:new Float32Array(J),
indexData:new Uint32Array(Q)}}}else d=aa(b,c);return d};z.createVFMeshScalar=Y;z.getUnitConversionFactor=r;z.sampleVectorField=function(b,c,d,g=[0,0],m=.5){const {width:l,height:y,mask:I}=b,[R,T]=b.pixels,[J,Q]=g;b=Math.round((l-J)/d);g=Math.round((y-Q)/d);var L=b*g;const S=new Float32Array(L),a=new Float32Array(L);L=new Uint8Array(L);c="vector-uv"===c;for(let h=0;h<g;h++)for(let k=0;k<b;k++){let A=0;const C=h*b+k,p=Math.max(0,h*d+Q),w=Math.max(0,k*d+J),D=Math.min(y,p+d),K=Math.min(l,w+d);for(let U=
p;U<D;U++)for(let V=w;V<K;V++){var e=U*l+V;if(!I||I[e]){A++;e=c?[R[e],T[e]]:[R[e],(360+T[e])%360];const [ba,da]=c?e:t(e);S[C]+=ba;a[C]+=da}}if(A>=(D-p)*(K-w)*(1-m)){L[C]=1;const [U,V]=q([S[C]/A,a[C]/A]);S[C]=U;a[C]=V}else L[C]=0,S[C]=0,a[C]=0}d=new v({width:b,height:g,pixels:[S,a],mask:L});d.updateStatistics();return d};z.snapImageToSymbolTile=function(b,c,d,g,m){if(!u.isSome(m)||!m.spatialReference.equals(b.spatialReference))return{extent:b,width:Math.round(c/g),height:Math.round(d/g),resolution:b.width/
c};const l=m.xmin;m=m.ymax;c=(b.xmax-b.xmin)/c*g;d=(b.ymax-b.ymin)/d*g;b.xmin=l+Math.floor((b.xmin-l)/c)*c;b.xmax=l+Math.ceil((b.xmax-l)/c)*c;b.ymin=m+Math.floor((b.ymin-m)/d)*d;b.ymax=m+Math.ceil((b.ymax-m)/d)*d;return{extent:b,width:Math.round(b.width/c),height:Math.round(b.height/d),resolution:(c+d)/2}};z.unitKebabDict=x;z.uvComponentToVector=q;Object.defineProperty(z,"__esModule",{value:!0})})},"esri/views/2d/engine/imagery/RasterVFContainer":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"./BrushVectorField","../webgl/enums","../webgl/WGLContainer"],function(z,B,u,v,n){n=function(r){function q(){var G=r.apply(this,arguments)||this;G.symbolTypes=["triangle"];return G}B._inheritsLoose(q,r);var t=q.prototype;t.prepareRenderPasses=function(G){const O=G.registerRenderPass({name:"imagery (vf)",brushes:[u],target:()=>this.children,drawPhase:v.WGLDrawPhase.MAP});return[...r.prototype.prepareRenderPasses.call(this,G),O]};t.doRender=function(G){this.visible&&G.drawPhase===v.WGLDrawPhase.MAP&&
this.symbolTypes.forEach(O=>{G.renderPass=O;r.prototype.doRender.call(this,G)})};B._createClass(q,[{key:"requiresDedicatedFBO",get:function(){return!1}}]);return q}(n);z.RasterVFContainer=n;Object.defineProperty(z,"__esModule",{value:!0})})},"esri/views/2d/layers/imagery/ImageryVFStrategy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../engine/imagery/RasterVFDisplayObject".split(" "),
function(z,B,u,v,n,r,q,t,G,O,H,P,Z){const aa=v.getLogger("esri.views.2d.layers.imagery.VectorFieldView2D");u=function(Y){function X(x){var N=Y.call(this,x)||this;N.update=r.debounce((M,E)=>N._update(M,E).catch(F=>{r.isAbortError(F)||aa.error(F)}));return N}z._inheritsLoose(X,Y);var W=X.prototype;W.redraw=function(x){if(this.container.children.length){var N=this.container.children[0];N.symbolizerParameters=x;N.invalidateVAO();this.container.symbolTypes="wind_speed"===x.style?["scalar","triangle"]:
"simple_scalar"===x.style?["scalar"]:["triangle"];this.container.requestRender()}};W._update=function(){var x=z._asyncToGenerator(function*(N,M,E){if(N.stationary){var {extent:F,spatialReference:f}=N.state,b=new P({xmin:F.xmin,ymin:F.ymin,xmax:F.xmax,ymax:F.ymax,spatialReference:f}),[c,d]=N.state.size;this._loading=this.fetchPixels(b,c,d,E);E=yield this._loading;this._addToDisplay(E,M,N.state);this._loading=null}});return function(N,M,E){return x.apply(this,arguments)}}();W._addToDisplay=function(x,
N,M){if(n.isNone(x.pixelBlock))this.container.children.forEach(b=>b.destroy()),this.container.removeAllChildren();else{var {extent:E,pixelBlock:F}=x,f=new Z.RasterVFDisplayObject(F);f.offset=[0,0];f.symbolizerParameters=N;f.rawPixelData=x;f.invalidateVAO();f.x=E.xmin;f.y=E.ymax;f.pixelRatio=M.pixelRatio;f.rotation=M.rotation;f.resolution=M.resolution;f.width=F.width*N.symbolTileSize;f.height=F.height*N.symbolTileSize;this.container.children.forEach(b=>b.destroy());this.container.removeAllChildren();
this.container.symbolTypes="wind_speed"===N.style?["scalar","triangle"]:"simple_scalar"===N.style?["scalar"]:["triangle"];this.container.addChild(f)}};z._createClass(X,[{key:"updating",get:function(){return!!this._loading}}]);return X}(u);B.__decorate([q.property()],u.prototype,"fetchPixels",void 0);B.__decorate([q.property()],u.prototype,"container",void 0);B.__decorate([q.property()],u.prototype,"_loading",void 0);B.__decorate([q.property()],u.prototype,"updating",null);return u=B.__decorate([H.subclass("esri.views.2d.layers.imagery.ImageryVFStrategy")],
u)})},"esri/views/2d/engine/imagery/RasterVFDisplayObject":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../../../../chunks/vec2f32 ../../../../layers/support/rasterFunctions/vectorFieldUtils ../DisplayObject ../webgl/Utils ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),function(z,B,u,v,n,r,q,t,G,O,H,P,Z){u=function(aa){function Y(W=
null){var x=aa.call(this)||this;x._source=null;x._symbolizerParameters=null;x._vaoInvalidated=!0;x.coordScale=[1,1];x.height=null;x.stencilRef=0;x.resolution=null;x.pixelRatio=1;x.x=0;x.y=0;x.rotation=0;x.rawPixelData=null;x.width=null;x.source=W;return x}B._inheritsLoose(Y,aa);var X=Y.prototype;X.destroy=function(){if(v.isSome(this.vaoData)){var W,x;null==(W=this.vaoData.magdir)?void 0:W.vao.dispose();null==(x=this.vaoData.scalar)?void 0:x.vao.dispose();this.vaoData=null}};X.invalidateVAO=function(){if(!this._vaoInvalidated&&
v.isSome(this.vaoData)){var W,x;null==(W=this.vaoData.magdir)?void 0:W.vao.dispose();null==(x=this.vaoData.scalar)?void 0:x.vao.dispose();this.vaoData=null;this._vaoInvalidated=!0;this.requestRender()}};X.updateVectorFieldVAO=function(W){if(this._vaoInvalidated){this._vaoInvalidated=!1;if(v.isSome(this.source)&&!v.isSome(this.vaoData)){var {style:x}=this.symbolizerParameters;switch(x){case "beaufort_ft":case "beaufort_km":case "beaufort_kn":case "beaufort_m":case "beaufort_mi":case "classified_arrow":case "ocean_current_kn":case "ocean_current_m":case "single_arrow":x=
t.createVFMesh(this.source,this.symbolizerParameters);this.vaoData={magdir:this._createVectorFieldVAO(W.context,x)};break;case "simple_scalar":x=t.createVFMeshScalar(this.source,this.symbolizerParameters);this.vaoData={scalar:this._createVectorFieldVAO(W.context,x)};break;case "wind_speed":{x=t.createVFMesh(this.source,this.symbolizerParameters);x=this._createVectorFieldVAO(W.context,x);const N=t.createVFMeshScalar(this.source,this.symbolizerParameters);W=this._createVectorFieldVAO(W.context,N);this.vaoData=
{magdir:x,scalar:W}}}}this.ready();this.requestRender()}};X._createTransforms=function(){return{dvs:r.create()}};X.setTransform=function(W){const x=n.identity(this.transforms.dvs),[N,M]=W.toScreenNoRotation([0,0],[this.x,this.y]);var E=this.resolution/this.pixelRatio/W.resolution;const F=E*this.width;E*=this.height;const f=Math.PI*this.rotation/180;n.translate(x,x,q.fromValues(N,M));n.translate(x,x,q.fromValues(F/2,E/2));n.rotate(x,x,-f);n.translate(x,x,q.fromValues(-F/2,-E/2));n.scaleByVec2(x,x,
q.fromValues(F,E));n.multiply(this.transforms.dvs,W.displayViewMat3,x)};X.onAttach=function(){this.invalidateVAO()};X.onDetach=function(){this.invalidateVAO()};X._createVectorFieldVAO=function(W,x){const {vertexData:N,indexData:M}=x;x=H.BufferObject.createVertex(W,P.Usage.STATIC_DRAW,new Float32Array(N));const E=H.BufferObject.createIndex(W,P.Usage.STATIC_DRAW,new Uint32Array(M)),F=O.createProgramDescriptor("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:P.DataType.FLOAT,normalized:!1},
{location:1,name:"a_offset",count:2,type:P.DataType.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:P.DataType.FLOAT,normalized:!1}]});return{vao:new Z.VertexArrayObject(W,F.attributes,F.bufferLayouts,{geometry:x},E),elementCount:M.length}};B._createClass(Y,[{key:"symbolizerParameters",get:function(){return this._symbolizerParameters},set:function(W){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(W)&&(this._symbolizerParameters=W,this.invalidateVAO())}},{key:"source",get:function(){return this._source},
set:function(W){this._source=W;this.invalidateVAO()}}]);return Y}(G.DisplayObject);z.RasterVFDisplayObject=u;Object.defineProperty(z,"__esModule",{value:!0})})},"esri/views/layers/ImageryLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Error ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/Point ../../layers/support/commonProperties ../../rest/support/Query ./support/popupUtils".split(" "),
function(z,B,u,v,n,r,q,t,G,O,H,P,Z,aa){q=Y=>{Y=function(X){function W(){var N=X.apply(this,arguments)||this;N.view=null;return N}B._inheritsLoose(W,X);var x=W.prototype;x.fetchPopupFeatures=function(){var N=B._asyncToGenerator(function*(M,E){const {layer:F}=this;if(!M)throw new v("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:F});var {popupEnabled:f}=F;const b=aa.getFetchPopupTemplate(F,E);if(!f||!n.isSome(b))throw new v("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",
{popupEnabled:f,popupTemplate:b});const c=yield b.getRequiredFields();f=new Z;f.timeExtent=this.timeExtent;f.geometry=M;f.outFields=c;f.outSpatialReference=M.spatialReference;M=this.view.resolution;M="2d"===this.view.type?new H(M,M,this.view.spatialReference):new H(.5*M,.5*M,this.view.spatialReference);const {returnTopmostRaster:d,showNoDataRecords:g}=b.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1};E={returnDomainValues:!0,returnTopmostRaster:d,pixelSize:M,showNoDataRecords:g,signal:n.isSome(E)?
E.signal:null};return F.queryVisibleRasters(f,E).then(m=>m)});return function(M,E){return N.apply(this,arguments)}}();x.canResume=function(){var N;return!X.prototype.canResume.call(this)||null!=(N=this.timeExtent)&&N.isEmpty?!1:!0};return W}(Y);u.__decorate([r.property()],Y.prototype,"layer",void 0);u.__decorate([r.property()],Y.prototype,"suspended",void 0);u.__decorate([r.property(P.combinedViewLayerTimeExtentProperty)],Y.prototype,"timeExtent",void 0);u.__decorate([r.property()],Y.prototype,"view",
void 0);return Y=u.__decorate([O.subclass("esri.views.layers.ImageryLayerView")],Y)};z.ImageryLayerView=q;z.default=q;Object.defineProperty(z,"__esModule",{value:!0})})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../layers/support/fieldUtils"],function(z,B,u,v){function n(){n=B._asyncToGenerator(function*(r,q=r.popupTemplate){if(!u.isSome(q))return[];const t=yield q.getRequiredFields(r.fieldsIndex);({lastEditInfoEnabled:q}=
q);const {objectIdField:G,typeIdField:O,globalIdField:H,relationships:P}=r;if(t.includes("*"))return["*"];q=q?yield v.getFeatureEditFields(r):[];const Z=v.fixFields(r.fieldsIndex,[...t,...q]);O&&Z.push(O);Z&&G&&r.fieldsIndex.has(G)&&-1===Z.indexOf(G)&&Z.push(G);Z&&H&&r.fieldsIndex.has(H)&&-1===Z.indexOf(H)&&Z.push(H);P&&P.forEach(aa=>{({keyField:aa}=aa);Z&&aa&&r.fieldsIndex.has(aa)&&-1===Z.indexOf(aa)&&Z.push(aa)});return Z});return n.apply(this,arguments)}z.getFetchPopupTemplate=function(r,q){return r.popupTemplate?
r.popupTemplate:u.isSome(q)&&q.defaultPopupTemplateEnabled&&u.isSome(r.defaultPopupTemplate)?r.defaultPopupTemplate:null};z.getRequiredFields=function(r){return n.apply(this,arguments)};Object.defineProperty(z,"__esModule",{value:!0})})},"esri/views/layers/RefreshableLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(z,B,u,v,n,r,q,t,G,O,H){t=P=>{P=function(Z){function aa(){return Z.apply(this,arguments)||this}B._inheritsLoose(aa,Z);aa.prototype.initialize=function(){this.handles.add(r.on(()=>this.layer,"refresh",Y=>{this.doRefresh(Y.dataChanged).catch(X=>{n.isAbortError(X)||v.getLogger(this.declaredClass).error(X)})}),"RefreshableLayerView")};return aa}(P);u.__decorate([q.property()],P.prototype,"layer",void 0);return P=u.__decorate([H.subclass("esri.layers.mixins.RefreshableLayerView")],P)};z.RefreshableLayerView=
t;z.default=t;Object.defineProperty(z,"__esModule",{value:!0})})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Collection ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../support/GraphicsCollection ../engine/flow/FlowView2D ./LayerView2D ./graphics/GraphicsView2D ./graphics/HighlightGraphicContainer ./imagery/ImageryView2D ./imagery/VectorFieldView2D ../../layers/ImageryLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),function(z,
B,u,v,n,r,q,t,G,O,H,P,Z,aa,Y,X,W,x,N,M){q=function(E){function F(){var b=E.apply(this,arguments)||this;b._exportImageVersion=-1;b._highlightGraphics=new H.GraphicsCollection;b.subview=null;return b}z._inheritsLoose(F,E);var f=F.prototype;f.hitTest=function(){var b=z._asyncToGenerator(function*(c,d){return this.subview?[this.subview.hitTest(c)]:null});return function(c,d){return b.apply(this,arguments)}}();f.update=function(b){var c;null==(c=this.subview)?void 0:c.update(b)};f.attach=function(){this.layer.increaseRasterJobHandlerUsage();
this._setSubView();this.view&&(this._highlightView=new aa({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new Y(this.view.featuresTilingScheme)}),this.container.addChild(this._highlightView.container));this.handles.add([n.watch(()=>{var b;return null!=(b=this.layer.blendMode)?b:"normal"},b=>this.subview.container.blendMode=b,n.syncAndInitial),n.watch(()=>{var b;return null!=(b=this.layer.effect)?b:null},b=>this.subview.container.effect=b,n.syncAndInitial),
n.watch(()=>this.layer.exportImageServiceParameters.version,b=>{b&&this._exportImageVersion!==b&&(this._exportImageVersion=b,this.requestUpdate())},n.sync),n.watch(()=>this.timeExtent,b=>{this.subview.timeExtent=b;"redraw"in this.subview?this.requestUpdate():this.subview.redrawOrRefetch()},n.sync),this.layer.on("redraw",()=>{"redraw"in this.subview?this.subview.redraw():this.subview.redrawOrRefetch()}),n.watch(()=>this.layer.renderer,()=>this._setSubView())],"imagerylayerview-update")};f.detach=function(){var b,
c;this.layer.decreaseRasterJobHandlerUsage();this.container.removeAllChildren();this._detachSubview(this.subview);null==(b=this.subview)?void 0:b.destroy();this.handles.remove("imagerylayerview-update");this.subview=null;null==(c=this._highlightView)?void 0:c.destroy();this._exportImageVersion=-1};f.moveStart=function(){};f.viewChange=function(){};f.moveEnd=function(){this.requestUpdate()};f.highlight=function(b,c){if(!((Array.isArray(b)?b[0]:v.isCollection(b)?b.getItemAt(0):b)instanceof u))return{remove:()=>
{}};let d=[];Array.isArray(b)||v.isCollection(b)?d=b.map(g=>g.clone()):b instanceof u&&(d=[b.clone()]);this._highlightGraphics.addMany(d);return{remove:()=>{this._highlightGraphics.removeMany(d)}}};f.doRefresh=function(){var b=z._asyncToGenerator(function*(){this.requestUpdate()});return function(){return b.apply(this,arguments)}}();f.isUpdating=function(){return!this.subview||this.subview.updating};f._setSubView=function(){var b;if(this.view){var c=null==(b=this.layer.renderer)?void 0:b.type;b="imagery";
"vector-field"===c&&"lerc"===this.layer.format?b="imageryVF":"flow"===c&&(b="flow");if(this.subview){var d;if(this.subview.type===b){this._attachSubview(this.subview);"flow"===this.subview.type&&this.subview.redrawOrRefetch();return}this._detachSubview(this.subview);null==(d=this.subview)?void 0:d.destroy()}this.subview="imagery"===b?new X({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):"imageryVF"===b?new W({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):new P({layer:this.layer,
layerView:this});this._attachSubview(this.subview);this.requestUpdate()}};f._attachSubview=function(b){b&&!b.attached&&(b.attach(),b.attached=!0,this.container.addChildAt(b.container,0),b.container.blendMode=this.layer.blendMode,b.container.effect=this.layer.effect)};f._detachSubview=function(b){null!=b&&b.attached&&(this.container.removeChild(b.container),b.detach(),b.attached=!1)};z._createClass(F,[{key:"pixelData",get:function(){return this.updating?null:"getPixelData"in this.subview?this.subview.getPixelData():
null}},{key:"updating",get:function(){return!(this.subview&&!("updating"in this.subview&&this.subview.updating))}}]);return F}(x.ImageryLayerView(M.RefreshableLayerView(Z.LayerView2DMixin(N))));B.__decorate([r.property()],q.prototype,"pixelData",null);B.__decorate([r.property({readOnly:!0})],q.prototype,"updating",null);B.__decorate([r.property()],q.prototype,"subview",void 0);return q=B.__decorate([O.subclass("esri.views.2d.layers.ImageryLayerView2D")],q)});