// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Collection ../../../core/maybe ../../../core/reactiveUtils ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/set ../../../core/accessorSupport/decorators/subclass ./LayerView2D ./graphics/GraphicContainer ./graphics/GraphicsView2D ../../layers/LayerView".split(" "),function(l,t,m,n,f,g,h,F,G,H,I,u,v,w,x,y){const p=
"routeInfo directionLines directionPoints polygonBarriers polylineBarriers pointBarriers stops".split(" "),z=Object.freeze({remove(){},pause(){},resume(){}});h=function(q){function k(){var a=q.apply(this,arguments)||this;a._graphicsViews=new Map;a._highlightIds=new Map;return a}l._inheritsLoose(k,q);var c=k.prototype;c.attach=function(){for(const a of p)this.handles.add(g.watch(()=>f.isSome(this.layer[a])?"routeInfo"===a?[f.unwrap(this.layer[a])]:f.unwrap(this.layer[a]).toArray():null,b=>this._createGraphicsView(a,
b),g.initial),a)};c.detach=function(){this._destroyGraphicsViews()};c.highlight=function(a){let b;"number"===typeof a?b=[a]:a instanceof m?b=[a.uid]:Array.isArray(a)&&0<a.length?b="number"===typeof a[0]?a:a.map(d=>d&&d.uid):n.isCollection(a)&&(b=a.map(d=>d&&d.uid).toArray());b=b.filter(d=>null!=d);if(!b.length)return z;this._addHighlight(b);return{remove:()=>this._removeHighlight(b)}};c.hitTest=function(){var a=l._asyncToGenerator(function*(b,d){if(this.suspended||!this._graphicsViews.size)return Promise.resolve(null);
d=Array.from(this._graphicsViews.values()).reverse().map(e=>e.hitTest(b)).flat().filter(e=>!!e);for(const e of d)e.layer=this.layer,e.sourceLayer=this.layer;return d});return function(b,d){return a.apply(this,arguments)}}();c.moveStart=function(){};c.moveEnd=function(){};c.update=function(a){for(const b of this._graphicsViews.values())b.processUpdate(a)};c.viewChange=function(){for(const a of this._graphicsViews.values())a.viewChange()};c.isUpdating=function(){for(const a of this._graphicsViews.values())if(a.updating)return!0;
return!1};c._createGraphicsView=function(a,b){this._destroyGraphicsView(a);const d=this.view;b=new n(f.isSome(b)?b.map(A=>{const {attributes:B,geometry:C,symbol:D,popupInfo:E}=A.toPortalJSON();return m.fromJSON({attributes:B,geometry:C,symbol:D,popupTemplate:E})}):[]);const e=new w(d.featuresTilingScheme),r=new x({container:e,graphics:b,requestUpdateCallback:()=>this.requestUpdate(),view:d});this._graphicsViews.set(a,r);this.container.addChildAt(e,p.indexOf(a));this._updateHighlight();this.handles.add([g.watch(()=>
r.updating,()=>this.notifyChange("updating"),g.initial)],`updating-${a}`)};c._destroyGraphicsView=function(a){if(this._graphicsViews.has(a)){var b=this._graphicsViews.get(a);this.container.removeChild(b.container);b.destroy();this.handles.remove(`updating-${a}`);this._graphicsViews.delete(a)}};c._destroyGraphicsViews=function(){this.container.removeAllChildren();for(const [a,b]of this._graphicsViews.entries())this.handles.remove(a),b.destroy();this._graphicsViews.clear()};c._addHighlight=function(a){for(const b of a)this._highlightIds.has(b)?
(a=this._highlightIds.get(b),this._highlightIds.set(b,a+1)):this._highlightIds.set(b,1);this._updateHighlight()};c._removeHighlight=function(a){for(const b of a)this._highlightIds.has(b)&&(a=this._highlightIds.get(b)-1,0===a?this._highlightIds.delete(b):this._highlightIds.set(b,a));this._updateHighlight()};c._updateHighlight=function(){const a=Array.from(this._highlightIds.keys());for(const b of this._graphicsViews.values())b.setHighlight(a)};return k}(v.LayerView2DMixin(y));return h=t.__decorate([u.subclass("esri.views.2d.layers.RouteLayerView2D")],
h)});