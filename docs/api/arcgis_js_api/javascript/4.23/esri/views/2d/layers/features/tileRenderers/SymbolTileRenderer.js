// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/webgl/FeatureTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/CircularArray ../../../../core/has ../../../../core/maybe ../../../../chunks/mat2d ../../../../chunks/mat2df32 ../../../../chunks/vec2 ../../../../chunks/vec2f32 ./enums ./Utils ./WGLTile ./collisions/MetricReader ./cpuMapped/Geometry".split(" "),function(w,t,l,v,p,r,h,c,e,d,a,b,g,m){let u=0;v=function(y){function z(f,k,q,x,A){f=y.call(this,f,k,q)||this;
f.instanceId=u++;f.patchCount=0;f._renderState={current:{geometry:new Map,metrics:null},next:null,swap:!1,swapFrames:0,locked:!1};f._patches=new l(100);f._bufferPatches=new l(100);f._lastCommitTime=0;f._lastMessageWasClear=!1;f.transforms.labelMat2d=h.create();f._store=x;f._requestLabelUpdate=A;return f}t._inheritsLoose(z,y);var n=z.prototype;n.destroy=function(){y.prototype.destroy.call(this);this._renderState.current.geometry.forEach(f=>f.destroy())};n.getGeometry=function(f){return this._renderState.current.geometry.get(f)};
n.setTransform=function(f,k){y.prototype.setTransform.call(this,f,k);const q=this.transforms.labelMat2d;k=f.getScreenTransform(q,k);const x=e.create();c.transformMat2d(x,[this.x,this.y],k);r.fromTranslation(q,x);r.multiply(q,f.viewMat2d,q)};n.patch=function(f,k){this.patchCount++;if(!f.clear||!this._lastMessageWasClear){(this._lastMessageWasClear=f.clear)&&50<=this._patches.size&&this._dropPatches();var q=f.addOrUpdate&&this.key.id!==f.addOrUpdate.tileKeyOrigin;k&&q?this._bufferPatches.enqueue(f):
(f.sort=f.sort&&!k,this._patches.enqueue(f));this.requestRender()}};n.commit=function(f){if(this._lastCommitTime!==f.time){this._lastCommitTime=f.time;for(f=0;4>f;f++)this._updateMesh(),this.isReady&&this._updateBufferMesh();this._renderState.swap&&(this._swapRenderStates(),this.requestRender())}};n.lock=function(){this._renderState.locked=!0};n.unlock=function(){this._renderState.locked=!1;this._flushUpdates();this._swap()};n._swapRenderStates=function(){this._renderState.next&&(this._renderState.locked?
(this._renderState.swap=!0,this.requestRender()):(this._renderState.swap=!0,0===this._renderState.swapFrames?(this._renderState.swapFrames=8,this.requestRender()):1!==this._renderState.swapFrames--?this.requestRender():this._swap()))};n._swap=function(){this._renderState.swap&&(this._renderState.swap=!1,p.isSome(this._renderState.next)&&(this._renderState.current.geometry.forEach(f=>f.destroy()),this._renderState.current=this._renderState.next,this._renderState.next=null,this._requestLabelUpdate()))};
n._flushUpdates=function(){let f=this._patches.maxSize;for(;this._patches.size&&f--;)this._updateMesh(),this._swap()};n._updateBufferMesh=function(){var f=this._bufferPatches.peek();if(!p.isSome(f)||!f.clear||null===this._renderState.next)for(;this._bufferPatches.size;)f=this._bufferPatches.dequeue(),p.isSome(f)&&this._patchBuffer(f)};n._updateMesh=function(){var f=this._patches.peek();p.isSome(f)&&f.clear&&null!==this._renderState.next||(f=this._patches.dequeue(),p.isSome(f)&&(!0===f.clear?this.isReady&&
(this._renderState.next={geometry:new Map,metrics:null}):(this.requestRender(),this._patch(f),f.end&&(this.ready(),this._swapRenderStates()))))};n._patch=function(f){a.forEachGeometryType(k=>{this._remove(k,f.remove);this._insert(k,f,!1)})};n._patchBuffer=function(f){a.forEachGeometryType(k=>{this._insert(k,f,!0)})};n._insert=function(f,k,q){try{var x;const A=p.unwrapOr(this._renderState.next,this._renderState.current),B=null==(x=k.addOrUpdate)?void 0:x.data[f],C=A.geometry;p.isNone(B)||(C.has(f)||
C.set(f,new m.Geometry(f,this.stage)),C.get(f).insert(B,k.sort,q),f===d.WGLGeometryType.LABEL&&this._insertLabelMetrics(k.type,B.metrics,k.clear))}catch(A){}};n._insertLabelMetrics=function(f,k,q){q=p.unwrapOr(this._renderState.next,this._renderState.current);if(!p.isNone(k))if(k=g.MetricReader.from(k),p.isNone(q.metrics))q.metrics=k;else{if("update"===f)for(f=k.getCursor();f.next();)q.metrics.delete(f.id);q.metrics.link(k)}};n._remove=function(f,k){f=p.unwrapOr(this._renderState.next,this._renderState.current).geometry.get(f);
k&&k.length&&f&&(f.remove(k),this._removeLabelMetrics(k))};n._removeLabelMetrics=function(f){const {metrics:k}=p.unwrapOr(this._renderState.next,this._renderState.current);if(!p.isNone(k)&&f.length)for(const q of f)for(;k.delete(q););};n._dropPatches=function(){const f=[];let k=!1;for(;this._patches.size;){const q=this._patches.dequeue();if(p.isNone(q))break;if(q.clear){if(k)break;k=!0}f.push(q)}this._patches.clear();f.forEach(q=>this._patches.enqueue(q))};t._createClass(z,[{key:"labelMetrics",get:function(){return this._renderState.current.metrics}},
{key:"hasData",get:function(){return!!this._renderState.current.geometry.size}}]);return z}(b.WGLTile);w.FeatureTile=v;Object.defineProperty(w,"__esModule",{value:!0})})},"esri/views/2d/engine/webgl/collisions/MetricReader":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe"],function(w,t,l){let v=function(){function r(c){this._cursor=this._head=c}r.from=function(c){c=p.from(new Float32Array(c));return new r(c)};var h=r.prototype;h.computedMinZoom=
function(){return this._cursor.computedMinZoom()};h.setComputedMinZoom=function(c){return this._cursor.setComputedMinZoom(c)};h.boundsComputedAnchorX=function(c){return this._cursor.boundsComputedAnchorX(c)};h.boundsComputedAnchorY=function(c){return this._cursor.boundsComputedAnchorY(c)};h.setBoundsComputedAnchorX=function(c,e){return this._cursor.setBoundsComputedAnchorX(c,e)};h.setBoundsComputedAnchorY=function(c,e){return this._cursor.setBoundsComputedAnchorY(c,e)};h.boundsX=function(c){return this._cursor.boundsX(c)};
h.boundsY=function(c){return this._cursor.boundsY(c)};h.boundsWidth=function(c){return this._cursor.boundsWidth(c)};h.boundsHeight=function(c){return this._cursor.boundsHeight(c)};h.link=function(c){if(l.isSome(c._head))return this._cursor.link(c._head)};h.getCursor=function(){return this.copy()};h.copy=function(){var c;const e=new r(null==(c=this._head)?void 0:c.copy());if(!e._head)return e;c=e._head;let d=e._head._link;for(;d;)c._link=d.copy(),c=d,d=c._link;return e};h.peekId=function(){var c;return null!=
(c=this._cursor.peekId())?c:this._cursor._link.peekId()};h.nextId=function(){const c=this.id;for(;c===this.id;)if(!this.next())return!1;return!0};h.save=function(){this._savedCursor=this._cursor;this._savedOffset=this._cursor._offset};h.restore=function(){this._cursor=this._savedCursor;this._cursor._offset=this._savedOffset};h.next=function(){if(!this._cursor)return!1;if(!this._cursor.next()){if(!this._cursor._link)return!1;this._cursor=this._cursor._link;this._cursor._offset=0}return!0};h.lookup=
function(c){for(this._cursor=this._head;this._cursor&&!this._cursor.lookup(c);){if(!this._cursor._link)return!1;this._cursor=this._cursor._link}return!!this._cursor};h.delete=function(c){let e=this._head,d=null;for(;e;){if(e.delete(c))return e.isEmpty()&&l.isSome(d)&&(d._link=e._link),!0;d=e;e=e._link}return!1};t._createClass(r,[{key:"id",get:function(){return this._cursor.id}},{key:"baseZoom",get:function(){return this._cursor.baseZoom}},{key:"anchorX",get:function(){return this._cursor.anchorX}},
{key:"anchorY",get:function(){return this._cursor.anchorY}},{key:"directionX",get:function(){return this._cursor.directionX}},{key:"directionY",get:function(){return this._cursor.directionY}},{key:"size",get:function(){return this._cursor.size}},{key:"materialKey",get:function(){return this._cursor.materialKey}},{key:"boundsCount",get:function(){return this._cursor.boundsCount}}]);return r}(),p=function(){function r(c){this._offset=-1;this._link=null;this._deletedCount=this._count=0;this._offsets=
{instance:null};this._buffer=c}r.from=function(c){return new r(new Float32Array(c))};var h=r.prototype;h.isEmpty=function(){return this._deletedCount===this.count};h.computedMinZoom=function(){return this._buffer[this._offset+8]};h.setComputedMinZoom=function(c){this._buffer[this._offset+8]=c};h.boundsComputedAnchorX=function(c){return this._buffer[this._offset+10+6*c+0]};h.boundsComputedAnchorY=function(c){return this._buffer[this._offset+10+6*c+1]};h.setBoundsComputedAnchorX=function(c,e){this._buffer[this._offset+
10+6*c+0]=e};h.setBoundsComputedAnchorY=function(c,e){this._buffer[this._offset+10+6*c+1]=e};h.boundsX=function(c){return this._buffer[this._offset+10+6*c+2]};h.boundsY=function(c){return this._buffer[this._offset+10+6*c+3]};h.boundsWidth=function(c){return this._buffer[this._offset+10+6*c+4]};h.boundsHeight=function(c){return this._buffer[this._offset+10+6*c+5]};h.link=function(c){let e=this;for(;e._link;)e=e._link;e._link=c};h.getCursor=function(){return this.copy()};h.copy=function(){const c=new r(this._buffer);
c._link=this._link;c._offset=this._offset;c._deletedCount=this._deletedCount;c._offsets=this._offsets;c._count=this._count;return c};h.peekId=function(){const c=this._offset+10+6*this.boundsCount+0;return c>=this._buffer.length?0:this._buffer[c]};h.next=function(){let c=0;for(;this._offset<this._buffer.length&&100>c++&&(this._offset=-1===this._offset?0:this._offset+(10+6*this.boundsCount),4294967296===this.id););return 4294967296!==this.id&&this._offset<this._buffer.length};h.delete=function(c){const e=
this._offset,d=this.lookup(c);if(d)for(this.id=4294967295,++this._deletedCount;this.next()&&this.id===c;)this.id=4294967295,++this._deletedCount;this._offset=e;return d};h.lookup=function(c){const e=this._offset;if(l.isNone(this._offsets.instance)){this._offsets.instance=new Map;const d=this.copy();d._offset=-1;let a=0;for(;d.next();)d.id!==a&&(this._offsets.instance.set(d.id,d._offset),a=d.id)}if(!this._offsets.instance.has(c))return!1;this._offset=this._offsets.instance.get(c);return 4294967296===
this.id?(this._offset=e,!1):!0};h._computeCount=function(){const c=this._offset;let e=0;for(this._offset=-1;this.next();)e++;this._offset=c;return e};t._createClass(r,[{key:"count",get:function(){this._count||(this._count=this._computeCount());return this._count}},{key:"id",get:function(){return this._buffer[this._offset+0]},set:function(c){this._buffer[this._offset+0]=c}},{key:"baseZoom",get:function(){return this._buffer[this._offset+1]}},{key:"anchorX",get:function(){return this._buffer[this._offset+
2]}},{key:"anchorY",get:function(){return this._buffer[this._offset+3]}},{key:"directionX",get:function(){return this._buffer[this._offset+4]}},{key:"directionY",get:function(){return this._buffer[this._offset+5]}},{key:"size",get:function(){return this._buffer[this._offset+6]}},{key:"materialKey",get:function(){return this._buffer[this._offset+7]}},{key:"boundsCount",get:function(){return this._buffer[this._offset+9]}}]);return r}();w.MetricReader=v;w.MetricReaderNode=p;Object.defineProperty(w,"__esModule",
{value:!0})})},"esri/views/2d/engine/webgl/cpuMapped/Geometry":function(){define("exports ../../../../../core/maybe ../FeatureDisplayList ./Buffer ./DisplayRecordReader ../../../../webgl/VertexArrayObject".split(" "),function(w,t,l,v,p,r){let h=function(){function c(d,a){this._vaos=new Map;this._indicesInvalid=!1;this.geometryType=d}var e=c.prototype;e.destroy=function(){for(const [,d]of this._vaos)t.isSome(d)&&d.dispose(!1);this._indexBuffer=t.destroyMaybe(this._indexBuffer);this._vertexBuffer=t.destroyMaybe(this._vertexBuffer)};
e.insert=function(d,a,b){if(d.records.byteLength)if(b=d.stride,this._vertexBuffer&&this._indexBuffer){var g=d.vertices.byteLength/b;this._indexBuffer.ensure(d.indices.byteLength/4);this._vertexBuffer.ensure(g);const {vertices:m,indices:u}=d;d=p.DisplayRecordReader.from(d.records);const y=this._vertexBuffer.insert(m,0,m.byteLength/b,0),z=this._indexBuffer.insert(u,0,u.byteLength/4,y);d.forEach(n=>{n.indexFrom+=z;n.vertexFrom+=y});t.unwrapOrThrow(this._records,"Expected records to be defined").link(d);
if(a)this._indicesInvalid=!0;else if(this._displayList)for(a=d.getCursor();a.next();)this._displayList.addRecord(a)}else{g=d.indices.byteLength/4;const m=d.vertices.byteLength/b,u=b/Uint32Array.BYTES_PER_ELEMENT;this._records=p.DisplayRecordReader.from(d.records);this._indexBuffer=new v.Buffer("index",g,1);this._vertexBuffer=new v.Buffer("vertex",m,u);this._indexBuffer.insert(d.indices,0,d.indices.byteLength/4,0);this._vertexBuffer.insert(d.vertices,0,d.vertices.byteLength/b,0);a&&(this._indicesInvalid=
!0)}};e.remove=function(d){if(!t.isNone(this._records))for(const a of d){d=this._records.getCursor();if(!d.lookup(a))continue;const b=d.indexFrom,g=d.vertexFrom;let m=d.indexCount,u=d.vertexCount;for(;d.next()&&d.id===a;)m+=d.indexCount,u+=d.vertexCount;this._indexBuffer.free(b,m);this._vertexBuffer.free(g,u,!0);this._records.delete(a)}};e.getVAO=function(d,a,b,g){if(!this._vertexBuffer||!this._indexBuffer||t.isNone(this._records)||!this._vertexBuffer.bufferSize)return null;g=g?1:0;let m=this._vaos.get(g);
if(this._vertexBuffer.invalidated||this._indexBuffer.invalidated)t.applySome(m,z=>z.dispose(!1)),m=null;this._vertexBuffer.upload();this._indexBuffer.upload();const u=this._indexBuffer.getGPUBuffer(d,1===g),y=this._vertexBuffer.getGPUBuffer(d);m||(m=new r.VertexArrayObject(d,b,a,{geometry:y},u),this._vaos.set(g,m));return m};e.forEachCommand=function(d){if(!t.isNone(this._records)){this._sortIndices(this._records);if(!this._displayList){const a=this._cursorIndexOrder;this._displayList=l.FeatureDisplayList.from(this,
this.geometryType,this._records.getCursor(),a)}this._displayList.forEach(d)}};e._sortIndices=function(d){const a=!!this._indexBuffer.bufferSize;if(this._indicesInvalid){this._indicesInvalid=!1;for(var b=0,g=d.getCursor(),m=[],u=[],y=[];g.next();)u.push(g.index),y.push(g.sortKey),m.push(g.id);u.sort((f,k)=>{const q=y[k],x=y[f];return x===q?m[k]-m[f]:q-x});d=d.getCursor();g=a?this._indexBuffer.getCPUBuffer():this._vertexBuffer.getCPUBuffer();for(const f of u){if(!d.seekIndex(f))throw Error("Expected to find index");
if(a){const {indexFrom:k,indexCount:q}=d;d.indexFrom=b;for(var z=0;z<q;z++)this._indexBuffer.set(b++,g.array[k+z])}else{const {vertexFrom:k,vertexCount:q}=d;var n=this._vertexBuffer.strideInt;const x=k*n;z=x+q*n;d.vertexFrom=b/n;for(n=x;n<z;n++)this._vertexBuffer.set(b++,g.array[n])}}this._cursorIndexOrder=u;this._displayList=null}};return c}();w.Geometry=h;Object.defineProperty(w,"__esModule",{value:!0})})},"esri/views/2d/engine/webgl/FeatureDisplayList":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/maybe","./cpuMapped/FreeList"],function(w,t,l,v){let p=function(){function h(c,e,d,a,b){this.target=c;this.geometryType=e;this.materialKey=d;this.indexFrom=a;this.indexCount=b}h.prototype.extend=function(c){this.indexCount+=c};t._createClass(h,[{key:"indexEnd",get:function(){return this.indexFrom+this.indexCount}}]);return h}(),r=function(){function h(e,d){this.geometryType=0;this._target=e;this.geometryType=d}h.from=function(e,d,a,b){e=new h(e,d);if(l.isSome(b))for(const g of b)a.seekIndex(g),
e.addRecord(a);else for(;a.next();)e.addRecord(a);return e};var c=h.prototype;c.addRecord=function(e){var d=this._target,a=this.geometryType,b=e.materialKey;let g=e.indexFrom,m=e.indexCount;const u=e.vertexFrom;e=e.vertexCount;m||(g=u,m=e);if(l.isNone(this._head))b=new p(d,a,b,g,m),this._head=new v.List(b);else{d=null;for(a=this._head;a;){if(g<a.data.indexFrom)return this._insert(b,g,m,d,a);d=a;a=a.next}this._insert(b,g,m,d,null)}};c.forEach=function(e){l.isSome(this._head)&&this._head.forEach(e)};
c.infos=function*(){if(l.isSome(this._head))for(const e of this._head.values())yield e};c._insert=function(e,d,a,b,g){if(l.isNone(b)&&l.isNone(g)){const m=new p(this._target,this.geometryType,e,d,a);this._head=new v.List(m)}if(l.isNone(b)&&l.isSome(g))return this._insertAtHead(e,d,a,g);if(l.isSome(b)&&l.isNone(g))return this._insertAtEnd(e,d,a,b);if(l.isSome(b)&&l.isSome(g))return this._insertAtMiddle(e,d,a,b,g)};c._insertAtHead=function(e,d,a,b){e===b.data.materialKey&&d+a===b.data.indexFrom?(b.data.indexFrom=
d,b.data.indexCount+=a):(e=new p(this._target,this.geometryType,e,d,a),this._head=new v.List(e),this._head.next=b)};c._insertAtEnd=function(e,d,a,b){b.data.materialKey===e&&b.data.indexEnd===d?b.data.indexCount+=a:(e=new p(this._target,this.geometryType,e,d,a),e=new v.List(e),b.next=e)};c._insertAtMiddle=function(e,d,a,b,g){b.data.materialKey===e&&b.data.indexEnd===d?(b.data.indexCount+=a,b.data.materialKey===g.data.materialKey&&b.data.indexEnd===g.data.indexFrom&&(b.data.indexCount+=g.data.indexCount,
b.next=g.next)):e===g.data.materialKey&&d+a===g.data.indexFrom?(g.data.indexFrom=d,g.data.indexCount+=a):(e=new p(this._target,this.geometryType,e,d,a),e=new v.List(e),b.next=e,e.next=g)};return h}();w.FeatureDisplayList=r;w.FeatureDisplayListInfo=p;Object.defineProperty(w,"__esModule",{value:!0})})},"esri/views/2d/engine/webgl/cpuMapped/FreeList":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe"],function(w,t,l){let v=function(){function r(c){if(Array.isArray(c)){this.data=
c[0];var e=this;for(let d=1;d<c.length;d++)e.next=new r([c[d]]),e=e.next}else this.data=c}var h=r.prototype;h.values=function*(){let c=this;for(;c;)yield c.data,c=c.next};h.forEach=function(c){let e=this;for(;e;)c(e.data),e=e.next};h.find=function(c){var e;return c(this.data)?this:null==(e=this.next)?void 0:e.find(c)};h.max=function(c,e=this){e=c(this.data)>c(e.data)?this:e;return this.next?this.next.max(c,e):e};h.remove=function(c,e=null){return this===c?e?(e.next=this.next,e):this.next:this.next.remove(c,
this)};t._createClass(r,[{key:"last",get:function(){return this.next?this.next.last:this}}]);return r}(),p=function(){function r(c){this._head=null;l.isNone(c)||(this._head=new v(c))}var h=r.prototype;h.maxAvailableSpace=function(){if(l.isNone(this._head))return 0;const c=this._head.max(e=>e.end-e.start);return c.data.end-c.data.start};h.firstFit=function(c){if(l.isNone(this._head))return null;var e=null;let d=this._head;for(;d;){const a=d.data.end-d.data.start;if(a===c)return e?e.next=d.next:this._head=
d.next,d.data.start;if(a>c)return e=d.data.start,d.data.start+=c,e;e=d;d=d.next}return null};h.free=function(c,e){const d=c+e;if(l.isNone(this._head))this._head=new v({start:c,end:d});else if(d<=this._head.data.start)if(d===this._head.data.start)this._head.data.start-=e;else{var a=new v({start:c,end:d});a.next=this._head;this._head=a}else{a=this._head;for(var b=a.next;b;){if(b.data.start>=d){if(a.data.end===c){a.data.end+=e;a.data.end===b.data.start&&(a.data.end+=b.data.end-b.data.start,a.next=b.next);
return}if(b.data.start===d){b.data.start-=e;return}c=new v({start:c,end:d});c.next=a.next;a.next=c;return}a=b;b=b.next}c===a.data.end?a.data.end+=e:(c=new v({start:c,end:d}),a.next=c)}};t._createClass(r,[{key:"head",get:function(){return this._head}}]);return r}();w.FreeList=p;w.List=v;Object.defineProperty(w,"__esModule",{value:!0})})},"esri/views/2d/engine/webgl/cpuMapped/Buffer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../BufferPool ./FreeList ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),
function(w,t,l,v,p,r,h){let c=function(){function e(a,b,g){const m=v.TypedBuffer.create(b*g*Uint32Array.BYTES_PER_ELEMENT);this.size=b;this.strideInt=g;this.bufferType=a;this.dirty={start:Infinity,end:0};this._gpu=null;this._cpu=m;this.clear()}var d=e.prototype;d.invalidate=function(){this._invalidateTriangleBuffer();l.applySome(this._gpu,a=>a.dispose());this._gpu=null};d._invalidateTriangleBuffer=function(){l.applySome(this._gpuComputeTriangles,a=>a.dispose());this._gpuComputeTriangles=null};d.destroy=
function(){l.applySome(this._gpu,a=>a.dispose());l.applySome(this._gpuComputeTriangles,a=>a.dispose());l.applySome(this._cpu,a=>a.destroy());l.applySome(this._cpu2,a=>a.destroy())};d.clear=function(){this.dirty.start=Infinity;this.dirty.end=0;this.freeList=new p.FreeList({start:0,end:this._cpu.length/this.strideInt});this.fillPointer=0};d.ensure=function(a){if(!(this.maxAvailableSpace()>=a)&&a*this.strideInt>this._cpu.length-this.fillPointer){this.invalidate();const b=this._cpu.length/this.strideInt;
a=Math.round(1.25*(b+a));this._cpu.expand(a*this.strideInt*Uint32Array.BYTES_PER_ELEMENT);this.freeList.free(b,a-b)}};d.set=function(a,b){this._cpu.array[a]!==b&&(this._cpu.array[a]=b,this.dirty.start=Math.min(a,this.dirty.start),this.dirty.end=Math.max(a,this.dirty.end))};d.getGPUBuffer=function(a,b=!1){if(!this.bufferSize)return null;if(b){if("index"!==this.bufferType)throw Error("Tired to get triangle buffer, but target is not an index buffer");l.isNone(this._gpuComputeTriangles)&&(this._gpuComputeTriangles=
this._createComputeBuffer(a));return this._gpuComputeTriangles}l.isNone(this._gpu)&&(this._gpu=this._createBuffer(a));return this._gpu};d.getCPUBuffer=function(){this._cpu2||(this._cpu2=this._cpu.slice());this._cpu2.length!==this._cpu.length&&this._cpu2.expand(this._cpu.length*this._cpu.array.BYTES_PER_ELEMENT);this._cpu2.set(this._cpu);return this._cpu2};d.maxAvailableSpace=function(){return this.freeList.maxAvailableSpace()};d.insert=function(a,b,g,m){const u=g*this.strideInt;if(!u)return 0;a=new Uint32Array(a,
b*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,u);g=l.unwrapOrThrow(this.freeList.firstFit(g),"First fit region must be defined")*this.strideInt;b=g/this.strideInt-b;if(0!==m)for(let y=0;y<a.length;y++)a[y]+=m;this._cpu.array.set(a,g);this.dirty.start=Math.min(this.dirty.start,g);this.dirty.end=Math.max(this.dirty.end,g+u);this.fillPointer=Math.max(this.fillPointer,g+u);return b};d.free=function(a,b,g){const m=a*this.strideInt,u=(a+b)*this.strideInt;if(!0===g)for(g=a;g!==a+b;g++)this._cpu.array[g*
this.strideInt]=2147450879;this.dirty.start=Math.min(this.dirty.start,m);this.dirty.end=Math.max(this.dirty.end,u);this.freeList.free(a,b)};d.upload=function(){this.dirty.end&&(this._invalidateTriangleBuffer(),l.isNone(this._gpu)||this._gpu.setSubDataFromView(this._cpu.array,this.dirty.start,this.dirty.start,this.dirty.end),this.dirty.start=Infinity,this.dirty.end=0)};d._createBuffer=function(a){const b=h.Usage.DYNAMIC_DRAW;return"index"===this.bufferType?r.BufferObject.createIndex(a,b,this._cpu.array):
r.BufferObject.createVertex(a,b,this._cpu.array)};d._createComputeBuffer=function(a){const b=h.Usage.DYNAMIC_DRAW,g=new Uint32Array(this.fillPointer/3);for(let m=0;m<this.fillPointer;m+=3)g[m/3]=this._cpu.array[m];return r.BufferObject.createIndex(a,b,g)};t._createClass(e,[{key:"elementSize",get:function(){return this._cpu.length/this.strideInt}},{key:"invalidated",get:function(){return this.bufferSize&&!this._gpu}},{key:"bufferSize",get:function(){return this._cpu.length/this.strideInt}}]);return e}();
w.Buffer=c;Object.defineProperty(w,"__esModule",{value:!0})})},"esri/views/2d/engine/webgl/BufferPool":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/has","../../../../core/maybe","./cpuMapped/FreeList"],function(w,t,l,v,p){const r=l("esri-2d-log-allocations");l=function(){function e(a){this._array=a}e.create=function(a){a=c.acquire(a);return new e(a)};var d=e.prototype;d.expand=function(a){a=c.acquire(a);a.set(this._array);c.release(this._array);this._array=
a};d.destroy=function(){c.release(this._array)};d.set=function(a,b){this._array.set(a._array,b)};d.slice=function(){const a=c.acquire(this._array.byteLength);a.set(this._array);return new e(a)};t._createClass(e,[{key:"array",get:function(){return this._array}},{key:"length",get:function(){return this._array.length}}]);return e}();let h=function(){function e(){this._data=new ArrayBuffer(e.BYTE_LENGTH);this._freeList=new p.FreeList({start:0,end:this._data.byteLength})}var d=e.prototype;d.allocate=function(a){const b=
this._freeList.firstFit(a);return v.isNone(b)?null:new Uint32Array(this._data,b,a/Uint32Array.BYTES_PER_ELEMENT)};d.free=function(a){this._freeList.free(a.byteOffset,a.byteLength)};t._createClass(e,[{key:"buffer",get:function(){return this._data}}],[{key:"BYTE_LENGTH",get:function(){return 64E6}}]);return e}();const c=new (function(){function e(){this._bytesAllocated=0;this._pages=[];this._pagesByBuffer=new Map;this._addPage()}var d=e.prototype;d.acquire=function(a){this._bytesAllocated+=a;r&&console.log(`Allocating ${a}, (${this._bytesAllocated} / ${this._bytesTotal})`);
if(a>h.BYTE_LENGTH)return new Uint32Array(a/Uint32Array.BYTES_PER_ELEMENT);for(const b of this._pages){const g=b.allocate(a);if(v.isSome(g))return g}return v.unwrapOrThrow(this._addPage().allocate(a),"Expected to allocate page")};d.release=function(a){this._bytesAllocated-=a.byteLength;r&&console.log(`Freeing ${a.byteLength}, (${this._bytesAllocated} / ${this._bytesTotal})`);const b=this._pagesByBuffer.get(a.buffer);b&&b.free(a)};d._addPage=function(){const a=new h;this._pages.push(a);this._pagesByBuffer.set(a.buffer,
a);return a};t._createClass(e,[{key:"_bytesTotal",get:function(){return this._pages.length*h.BYTE_LENGTH}}]);return e}());w.TypedBuffer=l;Object.defineProperty(w,"__esModule",{value:!0})})},"esri/views/2d/layers/features/tileRenderers/BaseTileRenderer":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/HandleOwner ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass".split(" "),
function(w,t,l,v,p,r,h,c){l=function(e){function d(b){b=e.call(this,b)||this;b.tiles=new Map;return b}w._inheritsLoose(d,e);var a=d.prototype;a.destroy=function(){this.tiles.clear();this.layer=this.layerView=this.tileInfoView=this.tiles=null};a.acquireTile=function(b){const g=this.createTile(b);g.once("isReady",()=>this.notifyChange("updating"));this.tiles.set(b.id,g);return g};a.forceAttributeTextureUpload=function(){};a.forEachTile=function(b){this.tiles.forEach(b)};a.releaseTile=function(b){this.tiles.delete(b.key.id);
this.disposeTile(b)};a.isUpdating=function(){let b=!0;this.tiles.forEach(g=>{b=b&&g.isReady});return!b};a.setHighlight=function(){};a.invalidateLabels=function(){};a.requestUpdate=function(){this.layerView.requestUpdate()};w._createClass(d,[{key:"updating",get:function(){return this.isUpdating()}}]);return d}(l.HandleOwner);t.__decorate([v.property()],l.prototype,"layer",void 0);t.__decorate([v.property()],l.prototype,"layerView",void 0);t.__decorate([v.property()],l.prototype,"tileInfoView",void 0);
t.__decorate([v.property()],l.prototype,"updating",null);return l=t.__decorate([c.subclass("esri.views.2d.layers.features.tileRenderers.BaseTileRenderer")],l)})},"esri/views/2d/layers/features/tileRenderers/support/WGLFeatureView":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/has ../../../../../../core/promiseUtils ../../../../engine/brushes ../../../../engine/FeatureContainer ../../../../engine/webgl/enums".split(" "),function(w,t,l,v,p,r,h){const c=
l("featurelayer-order-by-server-enabled");l=function(e){function d(b,g,m,u){b=e.call(this,b)||this;b._pointToCallbacks=[];b._layer=m;b._layerView=g;b._onUpdate=u;return b}t._inheritsLoose(d,e);var a=d.prototype;a.renderChildren=function(b){this.attributeView.update();this.hasAnimation&&b.painter.effects.integrate.draw(b,b.attributeView);e.prototype.renderChildren.call(this,b)};a.hasEmptyAttributeView=function(){return this.attributeView.isEmpty()};a.isUpdating=function(){return this.attributeView.isUpdating()};
a.hitTest=function(b){const g=v.createResolver();this._pointToCallbacks.push({point:b,resolver:g});this.requestRender();return g.promise};a.onTileData=function(b,g){const m=c&&"orderBy"in this._layer&&this._layer.orderBy,u=(null==m?void 0:m.length)&&!m[0].valueExpression&&m[0].field;b.patch(g,m&&this._layerView.orderByFields===u);this.contains(b)||this.addChild(b);this.requestRender()};a.onTileError=function(b){this.contains(b)||this.addChild(b)};a.updateTransitionProperties=function(b,g){e.prototype.updateTransitionProperties.call(this,
b,g);this._layerView.featureEffectView.transitionStep(b,g);this._layerView.featureEffectView.transitioning&&this.requestRender()};a.doRender=function(b){const {minScale:g,maxScale:m}=this._layer,u=b.state.scale;u<=(g||Infinity)&&u>=m&&e.prototype.doRender.call(this,b)};a.onAttributeStoreUpdate=function(){this.hasLabels&&this._layerView.view.labelManager.requestUpdate();this._onUpdate()};a.setStencilReference=function(b){if(1<b.rendererInfo.ddDotSize)for(const g of this.children)g.stencilRef=g.key.level+
1;else e.prototype.setStencilReference.call(this,b)};a.prepareRenderPasses=function(b){const g=b.registerRenderPass({name:"label",brushes:[p.brushes.label],target:()=>this.hasLabels?this.children:null,drawPhase:h.WGLDrawPhase.LABEL|h.WGLDrawPhase.LABEL_ALPHA}),m=b.registerRenderPass({name:"geometry",brushes:[p.brushes.fill,p.brushes.line,p.brushes.marker,p.brushes.text],target:()=>this.children,enableDefaultDraw:()=>!this._layerView.featureEffectView.hasEffects,effects:[{apply:b.effects.outsideEffect,
enable:()=>this._layerView.featureEffectView.hasEffects,args:()=>this._layerView.featureEffectView.excludedEffects},{apply:b.effects.insideEffect,enable:()=>this._layerView.featureEffectView.hasEffects,args:()=>this._layerView.featureEffectView.includedEffects},{apply:b.effects.hittest,enable:()=>!!this._pointToCallbacks.length,args:()=>this._pointToCallbacks}]}),u=b.registerRenderPass({name:"highlight",brushes:[p.brushes.fill,p.brushes.line,p.brushes.marker,p.brushes.text],target:()=>this.children,
drawPhase:h.WGLDrawPhase.HIGHLIGHT,enableDefaultDraw:()=>!1,effects:[{apply:b.effects.highlight,enable:()=>!!this._layerView.hasHighlight()}]});return[...e.prototype.prepareRenderPasses.call(this,b),m,u,g]};t._createClass(d,[{key:"hasAnimation",get:function(){return this.hasLabels}},{key:"hasLabels",get:function(){if("sublayers"in this._layer)return this._layer.sublayers.some(g=>g.labelingInfo&&g.labelingInfo.length&&g.labelsVisible);var b=this._layer.featureReduction;b=b&&"cluster"===b.type&&b.labelsVisible&&
b.labelingInfo&&b.labelingInfo.length;return this._layer.labelingInfo&&this._layer.labelingInfo.length&&this._layer.labelsVisible||!!b}}]);return d}(r.FeatureContainer);w.WGLFeatureView=l;Object.defineProperty(w,"__esModule",{value:!0})})},"*noref":1}});
define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/promiseUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/accessorSupport/set ../../../../../core/accessorSupport/decorators/subclass ../../../../../geometry/support/aaBoundingRect ../../../engine/webgl/FeatureTile ../support/rendererUtils ./BaseTileRenderer ./support/visualVariablesUtils ./support/WGLFeatureView".split(" "),function(w,
t,l,v,p,r,h,c,e,d,a,b,g,m,u){p=function(y){function z(){return y.apply(this,arguments)||this}w._inheritsLoose(z,y);var n=z.prototype;n.install=function(f){const k=new u.WGLFeatureView(this.tileInfoView,this.layerView,this.layer,()=>this.notifyChange("updating"));this.featuresView=k;f.addChild(k)};n.uninstall=function(f){f.removeChild(this.featuresView);this.featuresView.destroy();this.featuresView=null};n.fetchResource=function(f,k){({url:f}=f);const q=this.featuresView.stage;try{return q.resourceManager.fetchResource(f,
{signal:k.signal})}catch(x){return v.isAbortError(x)?Promise.resolve({width:0,height:0}):Promise.reject(x)}};n.isUpdating=function(){var f;const k=y.prototype.isUpdating.call(this),q=!this.featuresView||this.featuresView.isUpdating(),x=null==(f=this.featuresView)?void 0:f.hasEmptyAttributeView();f=k||q||k&&x;l("esri-2d-log-updating")&&console.log(`Updating SymbolTileRenderer ${f}\n  -> updatingTiles ${k}\n  -> hasFeaturesView ${!!this.featuresView}\n  -> updatingFeaturesView ${q}`);return f};n.hitTest=
function(f){return this.featuresView.hitTest(f)};n.supportsRenderer=function(f){return null!=f&&-1!==["simple","class-breaks","unique-value","dot-density","dictionary"].indexOf(f.type)};n.onConfigUpdate=function(f){var k=null;"visualVariables"in f&&(k=(b.simplifyVVRenderer(f).visualVariables||[]).map(q=>{const x=q.clone();"normalizationField"in q&&(x.normalizationField=null);q.valueExpression&&"$view.scale"!==q.valueExpression&&(x.valueExpression=null,x.field="nop");return x}),k=m.convertVisualVariables(k));
this.featuresView.setRendererInfo(f,k,this.layerView.featureEffect)};n.onTileData=function(f){const k=this.tiles.get(f.tileKey);if(k&&f.data)this.featuresView.onTileData(k,f.data);this.layerView.view.labelManager.requestUpdate()};n.onTileError=function(f){if(f=this.tiles.get(f.tileKey))this.featuresView.onTileError(f)};n.forceAttributeTextureUpload=function(){this.featuresView.attributeView.forceTextureUpload()};n.lockGPUUploads=function(){this.featuresView.attributeView.lockTextureUpload();this.tiles.forEach(f=>
f.lock())};n.unlockGPUUploads=function(){this.featuresView.attributeView.unlockTextureUpload();this.tiles.forEach(f=>f.unlock())};n.getMaterialItems=function(){var f=w._asyncToGenerator(function*(k){return this.featuresView.getMaterialItems(k)});return function(k){return f.apply(this,arguments)}}();n.invalidateLabels=function(){this.featuresView.hasLabels&&this.layerView.view.labelManager.requestUpdate()};n.createTile=function(f){const k=this.tileInfoView.getTileBounds(d.create(),f);return new a.FeatureTile(f,
k[0],k[3],this.featuresView.attributeView,()=>this.layerView.view.labelManager.requestUpdate())};n.disposeTile=function(f){this.featuresView.removeChild(f);f.destroy();this.layerView.view.labelManager.requestUpdate()};return z}(g);return p=t.__decorate([e.subclass("esri.views.2d.layers.features.tileRenderers.SymbolTileRenderer")],p)});