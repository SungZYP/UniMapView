// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../chunks/mat3f32 ../../../../../chunks/vec4f32 ../definitions ../enums ../number ./WGLBrush ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),function(x,G,y,z,H,I,p,J,K,q,L,k,M){q=function(A){function r(){var a=A.apply(this,arguments)||this;a._color=I.fromValues(1,0,0,1);a._patternMatrix=H.create();a._programOptions=
{id:!1,pattern:!1};return a}G._inheritsLoose(r,A);var t=r.prototype;t.dispose=function(){this._vao&&(this._vao.dispose(),this._vao=null)};t.drawMany=function(a,g){const {context:f,painter:h,styleLayerUID:N}=a;this._loadWGLResources(a);const l=a.displayLevel;var c=a.styleLayer,b=c.backgroundMaterial;const O=h.vectorTilesMaterialManager;var d=c.getPaintValue("background-color",l);const B=c.getPaintValue("background-opacity",l),C=c.getPaintValue("background-pattern",l),u=void 0!==C,m=d[3]*B,v=a.spriteMosaic;
let D,E;const P=(window.devicePixelRatio|1)>p.VTL_HIGH_RES_CUTOFF?2:1;a=a.drawPhase===J.WGLDrawPhase.HITTEST;const w=this._programOptions;w.id=a;w.pattern=u;b=O.getMaterialProgram(f,b,w);f.bindVAO(this._vao);f.useProgram(b);if(u){d=v.getMosaicItemPosition(C,!0);if(z.isSome(d)){const {tl:e,br:n,page:F}=d;D=n[0]-e[0];E=n[1]-e[1];d=v.getPageSize(F);z.isSome(d)&&(v.bind(f,k.TextureSamplingMode.LINEAR,F,p.VTL_TEXTURE_BINDING_UNIT_SPRITES),b.setUniform4f("u_tlbr",e[0],e[1],n[0],n[1]),b.setUniform2fv("u_mosaicSize",
d),b.setUniform1i("u_texture",p.VTL_TEXTURE_BINDING_UNIT_SPRITES))}b.setUniform1f("u_opacity",B)}else this._color[0]=m*d[0],this._color[1]=m*d[1],this._color[2]=m*d[2],this._color[3]=m,b.setUniform4fv("u_color",this._color);b.setUniform1f("u_depth",c.z||0);a&&(c=K.u32to4Xu8(N+1),b.setUniform4fv("u_id",c));for(const e of g)b.setUniform1f("u_coord_range",e.rangeX),b.setUniformMatrix3fv("u_dvsMat3",e.transforms.dvs),u&&(c=P*e.width*Math.max(2**(Math.round(l)-e.key.level),1),g=c/y.nextPowerOfTwo(D),c/=
y.nextPowerOfTwo(E),this._patternMatrix[0]=g,this._patternMatrix[4]=c,b.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)),f.setStencilFunction(k.CompareFunction.EQUAL,e.stencilRef,255),f.drawArrays(k.PrimitiveType.TRIANGLE_STRIP,0,4)};t._loadWGLResources=function(a){if(!this._vao){var {context:g,styleLayer:f}=a;a=f.backgroundMaterial;var h=new Int8Array([0,0,1,0,0,1,1,1]);h=L.BufferObject.createVertex(g,k.Usage.STATIC_DRAW,h);this._vao=new M.VertexArrayObject(g,a.getAttributeLocations(),
a.getLayoutInfo(),{geometry:h})}};return r}(q);x.WGLBrushVTLBackground=q;Object.defineProperty(x,"__esModule",{value:!0})});