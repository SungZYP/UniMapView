// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
require({cache:{"esri/AggregateGraphic":function(){define("./chunks/_rollupPluginBabelHelpers ./chunks/tslib.es6 ./Graphic ./core/accessorSupport/decorators/property ./core/arrayUtils ./core/has ./core/accessorSupport/ensureType ./core/accessorSupport/decorators/subclass".split(" "),function(f,l,g,q,H,A,r,h){g=function(u){function v(){var x=u.apply(this,arguments)||this;x.isAggregate=!0;return x}f._inheritsLoose(v,u);var m=v.prototype;m.getEffectivePopupTemplate=function(x){return this.popupTemplate?
this.popupTemplate:(x=this.sourceLayer&&this.sourceLayer.featureReduction)&&"popupTemplate"in x&&x.popupEnabled?x.popupTemplate:null};m.getObjectId=function(){return this.objectId};return v}(g);l.__decorate([q.property({type:Boolean})],g.prototype,"isAggregate",void 0);l.__decorate([q.property({type:Number,json:{read:!0}})],g.prototype,"objectId",void 0);return g=l.__decorate([h.subclass("esri.AggregateGraphic")],g)})},"esri/layers/effects/FeatureEffectView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/has ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./EffectView".split(" "),
function(f,l,g,q,H,A,r,h,u,v){g=function(m){function x(c){var e=m.call(this,c)||this;e._filter=null;e.duration=q("mapview-transitions-duration");e._excludedEffectView=new v.EffectView(c);e._includedEffectView=new v.EffectView(c);return e}f._inheritsLoose(x,m);var t=x.prototype;t.transitionStep=function(c,e){this._set("scale",e);this.transitioning?(this._includedEffectView.transitionStep(c,e),this._excludedEffectView.transitionStep(c,e),this.transitioning||(this._filter=null)):(this._excludedEffectView.scale=
e,this._includedEffectView.scale=e)};t.end=function(){this._includedEffectView.end();this._excludedEffectView.end();this._filter=null};t._transitionTo=function(c){const e=this._get("featureEffect");c=H.unwrap(c);const k=H.unwrap(null==c?void 0:c.includedEffect),z=H.unwrap(null==c?void 0:c.excludedEffect),C=this._includedEffectView.canTransitionTo(k)&&this._excludedEffectView.canTransitionTo(z);this._includedEffectView.effect=k;this._excludedEffectView.effect=z;this._set("featureEffect",c);this._filter=
(null==c?void 0:c.filter)||(null==e?void 0:e.filter)||null;C||this.end()};f._createClass(x,[{key:"excludedEffects",get:function(){return this._excludedEffectView.effects}},{key:"featureEffect",set:function(c){this._get("featureEffect")!==c&&this._transitionTo(c)}},{key:"filter",get:function(){var c;return this._filter||(null==(c=H.unwrap(this.featureEffect))?void 0:c.filter)||null}},{key:"hasEffects",get:function(){return this._excludedEffectView.hasEffects||this._includedEffectView.hasEffects}},
{key:"includedEffects",get:function(){return this._includedEffectView.effects}},{key:"scale",set:function(c){this._set("scale",c);this._excludedEffectView.scale=c;this._includedEffectView.scale=c}},{key:"transitioning",get:function(){return this._excludedEffectView.transitioning||this._includedEffectView.transitioning}}]);return x}(g);l.__decorate([A.property()],g.prototype,"_filter",void 0);l.__decorate([A.property()],g.prototype,"_excludedEffectView",void 0);l.__decorate([A.property()],g.prototype,
"_includedEffectView",void 0);l.__decorate([A.property()],g.prototype,"duration",void 0);l.__decorate([A.property()],g.prototype,"excludedEffects",null);l.__decorate([A.property()],g.prototype,"featureEffect",null);l.__decorate([A.property()],g.prototype,"filter",null);l.__decorate([A.property()],g.prototype,"hasEffects",null);l.__decorate([A.property()],g.prototype,"includedEffects",null);l.__decorate([A.property({value:0})],g.prototype,"scale",null);l.__decorate([A.property()],g.prototype,"transitioning",
null);return g=l.__decorate([u.subclass("esri.layers.effects.FeatureEffectView")],g)})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../engine/Container ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(f,l,g,q,H,A,r,h,u,v,m,x,t,c,e,k,z){const C=q.ofType({key:"type",base:c,typeMap:{rect:e,path:z,geometry:k}});f.LayerView2DMixin=D=>{D=function(J){function N(){var E=J.apply(this,arguments)||this;E.attached=!1;E.clips=new C;E.lastUpdateId=-1;E.moving=!1;E.updateRequested=!1;return E}l._inheritsLoose(N,J);var L=N.prototype;L.initialize=function(){var E,F,Q,X;const O=null!=(E=null==(F=this.view)?void 0:F.spatialReferenceLocked)?E:!0;(null==(Q=this.view)?0:Q.spatialReference)&&O&&!this.spatialReferenceSupported?
this.addResolvingPromise(Promise.reject(new A("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new t.Container),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([r.watch(()=>this.suspended,p=>{this.container&&(this.container.visible=!p);this.view&&!p&&this.updateRequested&&this.view.requestUpdate()},r.syncAndInitial),
r.watch(()=>{var p,B;return null!=(p=null==(B=this.layer)?void 0:B.opacity)?p:1},p=>{this.container&&(this.container.opacity=p)},r.syncAndInitial),r.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",p=>{this.container&&(this.container.blendMode=p)},r.syncAndInitial),r.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,p=>{this.container&&(this.container.effect=p)},r.syncAndInitial),r.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=this.clips)})]),
null!=(X=this.view)&&X.whenLayerView?this.view.whenLayerView(this.layer).then(p=>{p===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))};L.destroy=function(){this.processDetach();this.updateRequested=!1};L.processAttach=function(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())};L.processDetach=function(){this.attached&&(this.attached=!1,this.detach(),this.updateRequested=
!1)};L.isVisibleAtScale=function(E){const F=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!F)return!0;const {minScale:Q,maxScale:X}=F;return(0===Q||E<=Q)&&(0===X||E>=X)};L.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};L.processUpdate=function(E){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",E),this.updateRequested&&!this.suspended&&
(this.updateRequested=!1,this.update(E)))};L.hitTest=function(E,F){return Promise.resolve(null)};L.supportsSpatialReference=function(E){return!0};L.canResume=function(){return this.spatialReferenceSupported?J.prototype.canResume.call(this)?this.visibleAtCurrentScale:!1:!1};L.getSuspendInfo=function(){const E=J.prototype.getSuspendInfo.call(this),F=!this.spatialReferenceSupported,Q=this.visibleAtCurrentScale;F&&(E.spatialReferenceNotSupported=F);Q&&(E.outsideScaleRange=Q);return E};l._createClass(N,
[{key:"spatialReferenceSupported",get:function(){var E;const F=null==(E=this.view)?void 0:E.spatialReference;return null==F||this.supportsSpatialReference(F)}},{key:"updating",get:function(){var E;return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!(null==(E=this.updatingHandles)||!E.updating))}},{key:"visibleAtCurrentScale",get:function(){return this.isVisibleAtScale(this.view.scale)}}]);return N}(D);g.__decorate([h.property()],D.prototype,
"attached",void 0);g.__decorate([h.property({type:C,set(J){J=H.referenceSetter(J,this._get("clips"),C);this._set("clips",J)}})],D.prototype,"clips",void 0);g.__decorate([h.property()],D.prototype,"container",void 0);g.__decorate([h.property()],D.prototype,"moving",void 0);g.__decorate([h.property({readOnly:!0})],D.prototype,"spatialReferenceSupported",null);g.__decorate([h.property({readOnly:!0})],D.prototype,"updateParameters",void 0);g.__decorate([h.property()],D.prototype,"updateRequested",void 0);
g.__decorate([h.property()],D.prototype,"updating",null);g.__decorate([h.property()],D.prototype,"view",void 0);g.__decorate([h.property({readOnly:!0})],D.prototype,"visibleAtCurrentScale",null);return D=g.__decorate([x.subclass("esri.views.2d.layers.LayerView2D")],D)};Object.defineProperty(f,"__esModule",{value:!0})})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/set ../../../core/accessorSupport/decorators/subclass".split(" "),
function(f,l,g,q,H,A,r,h,u){g=function(v){function m(){return v.apply(this,arguments)||this}f._inheritsLoose(m,v);return m}(g.JSONSupport);return g=l.__decorate([u.subclass("esri.views.layers.support.ClipArea")],g)})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(f,l,g,q,H,A,r,h){var u;q=u=function(v){function m(){var x=v.apply(this,arguments)||this;x.type="rect";x.left=null;x.right=null;x.top=null;x.bottom=null;return x}f._inheritsLoose(m,v);m.prototype.clone=function(){return new u({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};f._createClass(m,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return m}(h);l.__decorate([g.property({type:[Number,String],json:{write:!0}})],q.prototype,"left",void 0);l.__decorate([g.property({type:[Number,
String],json:{write:!0}})],q.prototype,"right",void 0);l.__decorate([g.property({type:[Number,String],json:{write:!0}})],q.prototype,"top",void 0);l.__decorate([g.property({type:[Number,String],json:{write:!0}})],q.prototype,"bottom",void 0);l.__decorate([g.property({readOnly:!0})],q.prototype,"version",null);return q=u=l.__decorate([r.subclass("esri.views.layers.support.ClipRect")],q)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(f,l,g,q,H,A,r,h,u,v,m,x,t){var c;g={base:u,key:"type",typeMap:{extent:x,polygon:t}};m=c=function(e){function k(){var z=e.apply(this,arguments)||this;z.type="geometry";z.geometry=null;return z}f._inheritsLoose(k,e);k.prototype.clone=function(){return new c({geometry:this.geometry.clone()})};f._createClass(k,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return k}(m);l.__decorate([q.property({types:g,json:{read:v.fromJSON,write:!0}})],m.prototype,"geometry",void 0);l.__decorate([q.property({readOnly:!0})],
m.prototype,"version",null);return m=c=l.__decorate([h.subclass("esri.views.layers.support.Geometry")],m)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(f,l,g,q,H,A,r,h){q=function(u){function v(){var m=u.apply(this,
arguments)||this;m.type="path";m.path=[];return m}f._inheritsLoose(v,u);f._createClass(v,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return v}(h);l.__decorate([g.property({type:[[[Number]]],json:{write:!0}})],q.prototype,"path",void 0);l.__decorate([g.property({readOnly:!0})],q.prototype,"version",null);return q=l.__decorate([r.subclass("esri.views.layers.support.Path")],q)})},"esri/views/2d/layers/features/tileRenderers":function(){define(["require","exports","../../../../chunks/_rollupPluginBabelHelpers"],
function(f,l,g){function q(){q=g._asyncToGenerator(function*(H,A){if(!H)return null;switch(H.type){case "class-breaks":case "simple":case "unique-value":case "dot-density":case "dictionary":return new (yield new Promise((r,h)=>f(["./tileRenderers/SymbolTileRenderer"],u=>r(Object.freeze({__proto__:null,default:u})),h))).default(A);case "heatmap":return new (yield new Promise((r,h)=>f(["./tileRenderers/HeatmapTileRenderer"],u=>r(Object.freeze({__proto__:null,default:u})),h))).default(A)}});return q.apply(this,
arguments)}l.createOrReuseTileRenderer=function(H,A){return q.apply(this,arguments)};Object.defineProperty(l,"__esModule",{value:!0})})},"esri/views/2d/layers/support/FeatureCommandQueue":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../support/QueueProcessor".split(" "),
function(f,l,g,q,H,A,r,h,u){function v(c){return c.some(e=>e.globalId)}function m(c){return c.filter(e=>!e.error).map(e=>{var k;return null!=(k=e.objectId)?k:e.globalId})}function x(c,e){c=new Set(c);for(const k of e.values())c.add(k);return c}function t(c,e){c=new Set(c);for(const k of e.values())c.delete(k);return c}g=function(c){function e(z){z=c.call(this,z)||this;z._hasGlobalIds=!1;return z}f._inheritsLoose(e,c);var k=e.prototype;k.normalizeCtorArgs=function(z){this._queueProcessor=new u.QueueProcessor({concurrency:1,
process:z.process});return{}};k.destroy=function(){this.clear()};k.clear=function(){this._queueProcessor.clear()};k.push=function(z){const C=this._queueProcessor;var D=C.last();switch(z.type){case "update":case "refresh":if((null==D?void 0:D.type)===z.type)return;C.push(z).finally(()=>this.notifyChange("updating"));break;case "edit":(D="processed-edit"===(null==D?void 0:D.type)?D:null)&&C.popLast();z=this._mergeEdits(D,z);for(const J of z)C.push(J).finally(()=>this.notifyChange("updating"))}this.notifyChange("updating")};
k._mergeEdits=function(z,C){var D,J;const {addedFeatures:N,deletedFeatures:L,updatedFeatures:E}=C.edits;if(this._hasGlobalIds=this._hasGlobalIds||v(N)||v(E)||v(L))return C=[...N,...E],[z,{type:"processed-edit",edits:{addOrModified:C,removed:L}}];C=new Set(m(null!=(D=null==z?void 0:z.edits.addOrModified)?D:[]));z=new Set(m(null!=(J=null==z?void 0:z.edits.removed)?J:[]));J=new Set([...m(N),...m(E)]);D=new Set(m(L));C=Array.from(x(t(C,D),J)).map(F=>({objectId:F}));z=Array.from(x(t(z,J),D)).map(F=>({objectId:F}));
return[{type:"processed-edit",edits:{addOrModified:C,removed:z}}]};f._createClass(e,[{key:"updating",get:function(){return 0<this._queueProcessor.length}}]);return e}(g);l.__decorate([q.property({readOnly:!0})],g.prototype,"updating",null);return g=l.__decorate([h.subclass("esri.views.2d.layers.support.FeatureCommandQueue")],g)})},"esri/views/2d/layers/support/FeatureLayerProxy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Promise ../../../../core/promiseUtils ../../../../core/workers/workers ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(f,l,g,q,H,A,r,h,u,v){g=function(m){function x(c){c=m.call(this,c)||this;c._startupResolver=q.createResolver();c.isReady=!1;return c}f._inheritsLoose(x,m);var t=x.prototype;t.initialize=function(){this._controller=new AbortController;this.addResolvingPromise(this._startWorker(this._controller.signal))};t.destroy=function(){this._controller.abort();this._connection&&this._connection.close()};t.startup=function(){var c=f._asyncToGenerator(function*(e,k,z,C){yield this.when();var D=this._controller.signal;
D=Array.isArray(z.source)?{transferList:z.source,signal:D}:void 0;e=e.tileInfo.toJSON();yield this._connection.invoke("startup",{service:z,config:k,tileInfo:e,tiles:C},D);this._startupResolver.resolve();this._set("isReady",!0)});return function(e,k,z,C){return c.apply(this,arguments)}}();t.updateTiles=function(){var c=f._asyncToGenerator(function*(e){yield this._startupResolver.promise;return q.ignoreAbortErrors(this._connection.invoke("updateTiles",e))});return function(e){return c.apply(this,arguments)}}();
t.update=function(){var c=f._asyncToGenerator(function*(e){e={config:e};yield this._startupResolver.promise;return this._connection.invoke("update",e)});return function(e){return c.apply(this,arguments)}}();t.applyUpdate=function(){var c=f._asyncToGenerator(function*(e){yield this._startupResolver.promise;return this._connection.invoke("applyUpdate",e)});return function(e){return c.apply(this,arguments)}}();t.setHighlight=function(){var c=f._asyncToGenerator(function*(e){yield this._startupResolver.promise;
return q.ignoreAbortErrors(this._connection.invoke("controller.setHighlight",e))});return function(e){return c.apply(this,arguments)}}();t.stop=function(){var c=f._asyncToGenerator(function*(){yield this._startupResolver.promise;if(!this.closed)return q.ignoreAbortErrors(this._connection.invoke("stop"))});return function(){return c.apply(this,arguments)}}();t.refresh=function(){var c=f._asyncToGenerator(function*(e){yield this._startupResolver.promise;return q.ignoreAbortErrors(this._connection.invoke("controller.refresh",
e))});return function(e){return c.apply(this,arguments)}}();t.querySummaryStatistics=function(){var c=f._asyncToGenerator(function*(e,k,z){yield this._startupResolver.promise;return this._connection.invoke("controller.querySummaryStatistics",{query:e.toJSON(),params:k},z)});return function(e,k,z){return c.apply(this,arguments)}}();t.queryUniqueValues=function(){var c=f._asyncToGenerator(function*(e,k,z){yield this._startupResolver.promise;return this._connection.invoke("controller.queryUniqueValues",
{query:e.toJSON(),params:k},z)});return function(e,k,z){return c.apply(this,arguments)}}();t.queryClassBreaks=function(){var c=f._asyncToGenerator(function*(e,k,z){yield this._startupResolver.promise;return this._connection.invoke("controller.queryClassBreaks",{query:e.toJSON(),params:k},z)});return function(e,k,z){return c.apply(this,arguments)}}();t.queryHistogram=function(){var c=f._asyncToGenerator(function*(e,k,z){yield this._startupResolver.promise;return this._connection.invoke("controller.queryHistogram",
{query:e.toJSON(),params:k},z)});return function(e,k,z){return c.apply(this,arguments)}}();t.queryFeatures=function(){var c=f._asyncToGenerator(function*(e,k){yield this._startupResolver.promise;return this._connection.invoke("controller.queryFeatures",e.toJSON(),k)});return function(e,k){return c.apply(this,arguments)}}();t.queryVisibleFeatures=function(){var c=f._asyncToGenerator(function*(e,k){yield this._startupResolver.promise;return this._connection.invoke("controller.queryVisibleFeatures",
e.toJSON(),k)});return function(e,k){return c.apply(this,arguments)}}();t.queryObjectIds=function(){var c=f._asyncToGenerator(function*(e,k){yield this._startupResolver.promise;return this._connection.invoke("controller.queryObjectIds",e.toJSON(),k)});return function(e,k){return c.apply(this,arguments)}}();t.queryFeatureCount=function(){var c=f._asyncToGenerator(function*(e,k){yield this._startupResolver.promise;return this._connection.invoke("controller.queryFeatureCount",e.toJSON(),k)});return function(e,
k){return c.apply(this,arguments)}}();t.queryExtent=function(){var c=f._asyncToGenerator(function*(e,k){return this._connection.invoke("controller.queryExtent",e.toJSON(),k)});return function(e,k){return c.apply(this,arguments)}}();t.queryLatestObservations=function(){var c=f._asyncToGenerator(function*(e,k){yield this._startupResolver.promise;return this._connection.invoke("controller.queryLatestObservations",e.toJSON(),k)});return function(e,k){return c.apply(this,arguments)}}();t.queryStatistics=
function(){var c=f._asyncToGenerator(function*(e){yield this._startupResolver.promise;return this._connection.invoke("controller.queryStatistics",e)});return function(e){return c.apply(this,arguments)}}();t.getObjectId=function(){var c=f._asyncToGenerator(function*(e){yield this._startupResolver.promise;return this._connection.invoke("controller.getObjectId",e)});return function(e){return c.apply(this,arguments)}}();t.getDisplayId=function(){var c=f._asyncToGenerator(function*(e){yield this._startupResolver.promise;
return this._connection.invoke("controller.getDisplayId",e)});return function(e){return c.apply(this,arguments)}}();t.getFeatures=function(){var c=f._asyncToGenerator(function*(e){yield this._startupResolver.promise;return this._connection.invoke("controller.getFeatures",e)});return function(e){return c.apply(this,arguments)}}();t.getAggregates=function(){var c=f._asyncToGenerator(function*(){yield this._startupResolver.promise;return this._connection.invoke("controller.getAggregates")});return function(){return c.apply(this,
arguments)}}();t.getAggregateValueRanges=function(){var c=f._asyncToGenerator(function*(){yield this._startupResolver.promise;return this._connection.invoke("controller.getAggregateValueRanges")});return function(){return c.apply(this,arguments)}}();t.mapValidDisplayIds=function(){var c=f._asyncToGenerator(function*(e){yield this._startupResolver.promise;return this._connection.invoke("controller.mapValidDisplayIds",e)});return function(e){return c.apply(this,arguments)}}();t.onEdits=function(){var c=
f._asyncToGenerator(function*(e){yield this._startupResolver.promise;return q.ignoreAbortErrors(this._connection.invoke("controller.onEdits",e))});return function(e){return c.apply(this,arguments)}}();t.enableEvent=function(){var c=f._asyncToGenerator(function*(e,k){yield this._startupResolver.promise;return q.ignoreAbortErrors(this._connection.invoke("controller.enableEvent",{name:e,value:k}))});return function(e,k){return c.apply(this,arguments)}}();t.pauseStream=function(){return q.ignoreAbortErrors(this._connection.invoke("controller.pauseStream"))};
t.resumeStream=function(){return q.ignoreAbortErrors(this._connection.invoke("controller.resumeStream"))};t._startWorker=function(){var c=f._asyncToGenerator(function*(e){try{this._connection=yield H.open("Pipeline",{client:this.client,strategy:"dedicated",signal:e})}catch(k){q.throwIfNotAbortError(k)}});return function(e){return c.apply(this,arguments)}}();f._createClass(x,[{key:"tileRenderer",set:function(c){this.client.tileRenderer=c}},{key:"closed",get:function(){return this._connection.closed}}]);
return x}(g.EsriPromise);l.__decorate([A.property()],g.prototype,"isReady",void 0);l.__decorate([A.property()],g.prototype,"client",void 0);l.__decorate([A.property()],g.prototype,"tileRenderer",null);return g=l.__decorate([v.subclass("esri.views.2d.layers.support.FeatureLayerProxy")],g)})},"esri/views/2d/tiling/TileManager":function(){define(["exports","../../../core/maybe","./TileCoverage","./TileKey"],function(f,l,g,q){let H=function(){function A(h){this._tiles=new Map;this.buffer=0;this.acquireTile=
h.acquireTile;this.releaseTile=h.releaseTile;this.tileInfoView=h.tileInfoView;this.buffer=h.buffer}var r=A.prototype;r.destroy=function(){};r.clear=function(){this._tiles.forEach(h=>this._releaseTile(h))};r.tileKeys=function(){const h=[];this._tiles.forEach((u,v)=>h.push(v));return h};r.update=function(h){h=this.tileInfoView.getTileCoverage(h.state,this.buffer,"closest");const {spans:u,lodInfo:v}=h,{level:m}=v,x=[],t=[],c=new Set,e=new Set;for(const {row:k,colFrom:z,colTo:C}of u)for(let D=z;D<=C;D++){const J=
q.getId(m,k,v.normalizeCol(D),v.getWorldForColumn(D)),N=this._getOrAcquireTile(x,J);c.add(J);N.isReady?N.visible=!0:e.add(N.key)}e.forEach(k=>this._addPlaceholders(c,k));this._tiles.forEach(k=>{c.has(k.key.id)||(t.push(k.key.id),this._releaseTile(k))});g.pool.release(h);return{hasMissingTiles:0<e.size,added:x,removed:t}};r._getOrAcquireTile=function(h,u){if(!this._tiles.has(u)){const v=this.acquireTile(new q(u));h.push(u);this._tiles.set(u,v);v.visible=!1}return this._tiles.get(u)};r._getTile=function(h){return this._tiles.get(h)};
r._releaseTile=function(h){this._tiles.delete(h.key.id);this.releaseTile(h)};r._addPlaceholders=function(h,u){const v=this._addPlaceholderChildren(h,u);1E-6>Math.abs(1-v)||this._addPlaceholderParent(h,u)||(this._getTile(u.id).visible=!0)};r._addPlaceholderChildren=function(h,u){let v=0;this._tiles.forEach(m=>{v+=this._addPlaceholderChild(h,m,u)});return v};r._addPlaceholderChild=function(h,u,v){if(u.key.level<=v.level||!u.hasData||!v.contains(u.key))return 0;u.visible=!0;h.add(u.key.id);return 1/
(1<<2*(u.key.level-v.level))};r._addPlaceholderParent=function(h,u){u=u.getParentKey();let v=0,m=null;for(;l.isSome(u);){if(h.has(u.id))return!0;const x=this._getTile(u.id);if(null!=x&&x.isReady)return x.visible=!0,h.add(x.key.id),!0;null!=x&&x.hasData&&x.patchCount>v&&(v=x.patchCount,m=x);u=u.getParentKey()}return m?(m.visible=!0,h.add(m.key.id),!0):!1};return A}();f.TileManager=H;Object.defineProperty(f,"__esModule",{value:!0})})},"esri/views/layers/FeatureLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/deprecate ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../layers/support/commonProperties ../../layers/support/FeatureEffect ../../layers/support/FeatureFilter ../../layers/support/fieldUtils ../../rest/support/Query ../../support/arcadeOnDemand ./support/popupUtils ../support/floorFilterUtils".split(" "),
function(f,l,g,q,H,A,r,h,u,v,m,x,t,c,e,k,z,C,D,J,N,L){const E=A.getLogger("esri.views.layers.FeatureLayerView");A=F=>{F=function(Q){function X(...p){p=Q.call(this,...p)||this;p._updatingRequiredFieldsPromise=null;p.filter=null;p.timeExtent=null;p.layer=null;p.requiredFields=[];p.view=null;return p}l._inheritsLoose(X,Q);var O=X.prototype;O.initialize=function(){u.init(this,"layer.renderer layer.labelingInfo layer.elevationInfo.featureExpressionInfo layer.displayField filter featureEffect layer.timeInfo layer.floorInfo timeExtent".split(" "),
()=>this._handleRequiredFieldsChange(),!0);u.on(this,"view.floors","change",()=>this._handleRequiredFieldsChange());u.on(this,"layer.sublayer","change",()=>this._handleRequiredFieldsChange())};O.highlight=function(p){throw Error("missing implementation");};O.createQuery=function(){var p={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};p=r.isSome(this.filter)?this.filter.createQuery(p):new D(p);if("feature"===this.layer.type){const B=L.getFloorFilterClause(this);r.isSome(B)&&
(p.where=p.where?`(${p.where}) AND (${B})`:B)}r.isSome(this.timeExtent)&&(p.timeExtent=r.isSome(p.timeExtent)?p.timeExtent.intersection(this.timeExtent):this.timeExtent.clone());return p};O.queryFeatures=function(p,B){throw Error("missing implementation");};O.queryObjectIds=function(p,B){throw Error("missing implementation");};O.queryFeatureCount=function(p,B){throw Error("missing implementation");};O.queryExtent=function(p,B){throw Error("missing implementation");};O.fetchPopupFeatures=function(){var p=
l._asyncToGenerator(function*(B,w){if(B=this.validateFetchPopupFeatures(w))throw B;return this.fetchClientPopupFeatures(w)});return function(B,w){return p.apply(this,arguments)}}();O._loadArcadeModules=function(p){if(p.get("expressionInfos.length")||Array.isArray(p.content)&&p.content.some(B=>"expression"===B.type))return J.loadArcade()};O._handleRequiredFieldsChange=function(){const p=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",p);p.then(()=>{this._updatingRequiredFieldsPromise===
p&&this._set("_updatingRequiredFieldsPromise",null)})};O._updateRequiredFields=function(){var p=l._asyncToGenerator(function*(){if(this.layer&&this.view){var B="3d"===this.view.type,{layer:w,layer:{fieldsIndex:T,objectIdField:R}}=this,M="renderer"in w&&w.renderer,P="orderBy"in w&&w.orderBy,U=w.featureReduction,I=new Set;M=yield h.eachAlways([M?M.collectRequiredFields(I,T):null,C.collectLabelingFields(I,w),B?C.collectElevationFields(I,w):null,r.isSome(this.filter)?C.collectFilterFields(I,w,this.filter):
null,r.isSome(this.featureEffect)?C.collectFilterFields(I,w,this.featureEffect.filter):null,U?C.collectFeatureReductionFields(I,w,U):null,P?C.collectOrderByInfos(I,w,P):null]);w.timeInfo&&this.timeExtent&&C.collectFields(I,w.fieldsIndex,[w.timeInfo.startField,w.timeInfo.endField]);"feature"===w.type&&w.floorInfo&&C.collectFields(I,w.fieldsIndex,[w.floorInfo.floorField]);"subtype-group"===w.type&&(C.collectField(I,T,w.subtypeField),P=w.sublayers.map(W=>{var Y;return Promise.all([null==(Y=W.renderer)?
void 0:Y.collectRequiredFields(I,T),C.collectLabelingFields(I,W)])}),yield h.eachAlways(P));for(const W of M)W.error&&E.error(W.error);C.collectField(I,T,R);B&&"displayField"in w&&w.displayField&&C.collectField(I,T,w.displayField);B=Array.from(I).sort();this._set("requiredFields",B)}});return function(){return p.apply(this,arguments)}}();O.validateFetchPopupFeatures=function(p){if(r.isNone(p))return null;for(const B of p.clientGraphics){const w=B.layer;if("popupEnabled"in w&&!w.popupEnabled)return new H("featurelayerview:fetchPopupFeatures",
"Popups are disabled",{layer:w});if("popupTemplate"in w&&!N.getFetchPopupTemplate(w,p))return new H("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:w});if(B.isAggregate&&!(w.featureReduction&&"popupTemplate"in w.featureReduction&&w.featureReduction.popupEnabled&&w.featureReduction.popupTemplate))return new H("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:w})}};O.fetchClientPopupFeatures=function(){var p=l._asyncToGenerator(function*(B){const w=
r.isSome(B)?B.clientGraphics:null;if(!w||0===w.length)return[];const T=Array(w.length),R=new Map,M=yield this.createPopupQuery(B);for(let U=0;U<w.length;U++){const I=w[U];if(I.isAggregate){T[U]=I;continue}var {layer:P}=I;if(!("popupEnabled"in P))continue;const W=C.unpackFieldNames(this.layer.fieldsIndex,M.outFields);P=N.getFetchPopupTemplate(P,B);if(!r.isSome(P))continue;const Y=yield this._loadArcadeModules(P);Y&&Y.arcadeUtils.hasGeometryOperations(P)||!C.featureHasFields(W,I)?R.set(I.getObjectId(),
U):T[U]=I}if("stream"===this.layer.type||0===R.size)return T.filter(Boolean);M.objectIds=Array.from(R.keys());try{const U=yield this.layer.queryFeatures(M);for(const I of U.features){const W=R.get(I.getObjectId());T[W]=I}}catch{}return T.filter(Boolean)});return function(B){return p.apply(this,arguments)}}();O.createPopupQuery=function(){var p=l._asyncToGenerator(function*(B){const w=this.layer.createQuery(),T=new Set;var R=!1,M=r.isSome(B)&&B.clientGraphics?B.clientGraphics.map(P=>P.layer):[this.layer];
for(const P of M)if("popupEnabled"in P&&(M=N.getFetchPopupTemplate(P,B),r.isSome(M))){R=(R=yield this._loadArcadeModules(M))&&R.arcadeUtils.hasGeometryOperations(M);R=!("point"!==this.layer.geometryType&&!R);M=yield N.getRequiredFields(this.layer,M);for(const U of M)T.add(U)}w.returnGeometry=R;w.returnZ=R;w.returnM=R;w.outFields=Array.from(T);w.outSpatialReference=this.view.spatialReference;"feature"===this.layer.type&&(B=L.getFloorFilterClause(this),r.isSome(B)&&(w.where=w.where?`(${w.where}) AND (${B})`:
B));return w});return function(B){return p.apply(this,arguments)}}();O.canResume=function(){return!Q.prototype.canResume.call(this)||r.isSome(this.timeExtent)&&this.timeExtent.isEmpty?!1:!0};l._createClass(X,[{key:"availableFields",get:function(){const {layer:p,layer:{fieldsIndex:B},requiredFields:w}=this;return"outFields"in p&&p.outFields?C.fixFields(B,[...C.unpackFieldNames(B,p.outFields),...w]):C.fixFields(B,w)}},{key:"effect",get:function(){q.deprecatedProperty(E,"effect",{replacement:"featureEffect",
version:"4.22"});return this.featureEffect},set:function(p){q.deprecatedProperty(E,"effect",{replacement:"featureEffect",version:"4.22"});this.featureEffect=p}},{key:"featureEffect",get:function(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null},set:function(p){void 0===p?this._clearOverride("featureEffect"):this._override("featureEffect",p)}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(p){E.error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")}},
{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}}]);return X}(F);g.__decorate([v.property()],F.prototype,"_updatingRequiredFieldsPromise",void 0);g.__decorate([v.property({readOnly:!0})],F.prototype,"availableFields",null);g.__decorate([v.property()],F.prototype,"effect",null);g.__decorate([v.property({type:k})],F.prototype,"featureEffect",null);g.__decorate([v.property({type:z})],F.prototype,"filter",void 0);g.__decorate([v.property(e.combinedViewLayerTimeExtentProperty)],F.prototype,
"timeExtent",void 0);g.__decorate([v.property()],F.prototype,"layer",void 0);g.__decorate([v.property({type:Number})],F.prototype,"maximumNumberOfFeatures",null);g.__decorate([v.property({readOnly:!0,type:Boolean})],F.prototype,"maximumNumberOfFeaturesExceeded",null);g.__decorate([v.property({readOnly:!0})],F.prototype,"requiredFields",void 0);g.__decorate([v.property()],F.prototype,"suspended",void 0);g.__decorate([v.property()],F.prototype,"view",void 0);return F=g.__decorate([c.subclass("esri.views.layers.FeatureLayerView")],
F)};f.FeatureLayerView=A;f.default=A;Object.defineProperty(f,"__esModule",{value:!0})})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../layers/support/fieldUtils"],function(f,l,g,q){function H(){H=l._asyncToGenerator(function*(A,r=A.popupTemplate){if(!g.isSome(r))return[];const h=yield r.getRequiredFields(A.fieldsIndex);({lastEditInfoEnabled:r}=r);const {objectIdField:u,typeIdField:v,globalIdField:m,relationships:x}=
A;if(h.includes("*"))return["*"];r=r?yield q.getFeatureEditFields(A):[];const t=q.fixFields(A.fieldsIndex,[...h,...r]);v&&t.push(v);t&&u&&A.fieldsIndex.has(u)&&-1===t.indexOf(u)&&t.push(u);t&&m&&A.fieldsIndex.has(m)&&-1===t.indexOf(m)&&t.push(m);x&&x.forEach(c=>{({keyField:c}=c);t&&c&&A.fieldsIndex.has(c)&&-1===t.indexOf(c)&&t.push(c)});return t});return H.apply(this,arguments)}f.getFetchPopupTemplate=function(A,r){return A.popupTemplate?A.popupTemplate:g.isSome(r)&&r.defaultPopupTemplateEnabled&&
g.isSome(A.defaultPopupTemplate)?A.defaultPopupTemplate:null};f.getRequiredFields=function(A){return H.apply(this,arguments)};Object.defineProperty(f,"__esModule",{value:!0})})},"esri/views/layers/RefreshableLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(f,l,g,q,H,A,r,h,u,v,m){h=x=>{x=function(t){function c(){return t.apply(this,arguments)||this}l._inheritsLoose(c,t);c.prototype.initialize=function(){this.handles.add(A.on(()=>this.layer,"refresh",e=>{this.doRefresh(e.dataChanged).catch(k=>{H.isAbortError(k)||q.getLogger(this.declaredClass).error(k)})}),"RefreshableLayerView")};return c}(x);g.__decorate([r.property()],x.prototype,"layer",void 0);return x=g.__decorate([m.subclass("esri.layers.mixins.RefreshableLayerView")],x)};f.RefreshableLayerView=
h;f.default=h;Object.defineProperty(f,"__esModule",{value:!0})})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../AggregateGraphic ../../../geometry ../../../Graphic ../../../core/Collection ../../../core/Error ../../../core/has ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../layers/effects/FeatureEffectView ../../../layers/support/FeatureFilter ../../../rest/support/FeatureSet ../../../rest/support/Query ../engine/webgl/definitions ./LayerView2D ./features/schemaUtils ./features/tileRenderers ./support/clusterUtils ./support/FeatureCommandQueue ./support/FeatureLayerProxy ./support/util ../tiling/TileManager ../../layers/FeatureLayerView ../../layers/LayerView ../../layers/RefreshableLayerView ../../webgl/capabilities ../../../geometry/Extent".split(" "),function(f,
l,g,q,H,A,r,h,u,v,m,x,t,c,e,k,z,C,D,J,N,L,E,F,Q,X,O,p,B,w,T,R,M,P){function U(W){return W&&"openPorts"in W}const I=v.getLogger("esri.views.2d.layers.FeatureLayerView2D");q=function(W){function Y(){var a=W.apply(this,arguments)||this;a._pipelineIsUpdating=!0;a._commandsQueue=new X({process:b=>{switch(b.type){case "processed-edit":return a._doEdit(b);case "refresh":return a._doRefresh(b.dataChanged);case "update":return a._doUpdate()}}});a._visibilityOverrides=new Set;a._highlightIds=new Map;a._updateHighlight=
x.debounce(f._asyncToGenerator(function*(){return a._proxy.setHighlight(Array.from(a._highlightIds.keys()))}));a._uploadsLocked=!1;a._needsClusterSizeUpdate=!1;a.featureEffectView=new z;a._lastDefinitionExpression=null;return a}f._inheritsLoose(Y,W);var y=Y.prototype;y.destroy=function(){var a;m.applySome(this._updateClusterSizeTask,b=>b.remove());null==(a=this._proxy)?void 0:a.destroy();this._commandsQueue.destroy()};y.initialize=function(){this.addResolvingPromise(Promise.all([this._initProxy(),
this._initServiceOptions()]));this.handles.add([this.on("valueRangesChanged",a=>{this._set("_aggregateValueRanges",a.valueRanges)}),t.watch(()=>this.featureEffect,a=>{this.featureEffectView.featureEffect=a},{initial:!0,sync:!0})])};y._initProxy=function(){var a=f._asyncToGenerator(function*(){if("isTable"in this.layer&&this.layer.isTable)throw new r("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:this.layer});this._proxy&&this._proxy.destroy();const b=this._createClientOptions();
this._set("_proxy",new O({client:b}));return this._proxy.when()});return function(){return a.apply(this,arguments)}}();y._initServiceOptions=function(){var a=f._asyncToGenerator(function*(){this._set("_serviceOptions",yield this._createServiceOptions());return this._serviceOptions});return function(){return a.apply(this,arguments)}}();y.highlight=function(a){var b;let d;a instanceof H?d=[a.getObjectId()]:"number"===typeof a||"string"===typeof a?d=[a]:Array.isArray(a)&&0<a.length?d="number"===typeof a[0]||
"string"===typeof a[0]?a:a.map(n=>null==n?void 0:n.getObjectId()):A.isCollection(a)&&0<a.length&&(d=a.map(n=>null==n?void 0:n.getObjectId()).toArray());d=null==(b=d)?void 0:b.filter(n=>null!=n);if(!d||!d.length)return{remove:()=>{}};this._addHighlight(d);return{remove:()=>this._removeHighlight(d)}};y.hasHighlight=function(){return!!this._highlightIds.size};y.hitTest=function(){var a=f._asyncToGenerator(function*(b,d){if(!this.tileRenderer)return null;b=yield this.tileRenderer.hitTest(d);if(0===b.length)return null;
const {features:n,aggregates:G}=yield this._proxy.getFeatures(b);return[...G.map(K=>this._createHittestResult(g.fromJSON(K))),...n.map(K=>this._createHittestResult(H.fromJSON(K)))]});return function(b,d){return a.apply(this,arguments)}}();y.queryAggregates=function(){var a=f._asyncToGenerator(function*(){return(yield this._proxy.getAggregates()).map(b=>g.fromJSON(b))});return function(){return a.apply(this,arguments)}}();y.queryStatistics=function(){return this._proxy.queryStatistics()};y.querySummaryStatistics=
function(){var a=f._asyncToGenerator(function*(b,d,n){d={...d,scale:this.view.scale};return this._proxy.querySummaryStatistics(this._cleanUpQuery(b),d,n)});return function(b,d,n){return a.apply(this,arguments)}}();y.queryUniqueValues=function(){var a=f._asyncToGenerator(function*(b,d,n){d={...d,scale:this.view.scale};return this._proxy.queryUniqueValues(this._cleanUpQuery(b),d,n)});return function(b,d,n){return a.apply(this,arguments)}}();y.queryClassBreaks=function(){var a=f._asyncToGenerator(function*(b,
d,n){d={...d,scale:this.view.scale};return this._proxy.queryClassBreaks(this._cleanUpQuery(b),d,n)});return function(b,d,n){return a.apply(this,arguments)}}();y.queryHistogram=function(){var a=f._asyncToGenerator(function*(b,d,n){d={...d,scale:this.view.scale};return this._proxy.queryHistogram(this._cleanUpQuery(b),d,n)});return function(b,d,n){return a.apply(this,arguments)}}();y.queryFeatures=function(a,b){return this.queryFeaturesJSON(a,b).then(d=>{d=D.fromJSON(d);d.features.forEach(n=>this._setLayersForFeature(n));
return d})};y.queryVisibleFeatures=function(a,b){return this._proxy.queryVisibleFeatures(this._cleanUpQuery(a),b).then(d=>{d=D.fromJSON(d);d.features.forEach(n=>this._setLayersForFeature(n));return d})};y.queryFeaturesJSON=function(a,b){return this._proxy.queryFeatures(this._cleanUpQuery(a),b)};y.queryObjectIds=function(a,b){return this._proxy.queryObjectIds(this._cleanUpQuery(a),b)};y.queryFeatureCount=function(a,b){return this._proxy.queryFeatureCount(this._cleanUpQuery(a),b)};y.queryExtent=function(a,
b){return this._proxy.queryExtent(this._cleanUpQuery(a),b).then(d=>({count:d.count,extent:P.fromJSON(d.extent)}))};y.setVisibility=function(a,b){b?this._visibilityOverrides.delete(a):this._visibilityOverrides.add(a);this._update()};y.update=function(a){if(this._tileStrategy&&this.tileRenderer){var {hasMissingTiles:b,added:d,removed:n}=this._tileStrategy.update(a);(d.length||n.length)&&this._proxy.updateTiles({added:d,removed:n});b&&this.requestUpdate();this.notifyChange("updating")}};y.attach=function(){this.view.timeline.record(`${this.layer.title} (FeatureLayer) Attach`);
this._tileStrategy=new B.TileManager({acquireTile:a=>this._acquireTile(a),releaseTile:a=>this._releaseTile(a),tileInfoView:this.view.featuresTilingScheme,buffer:0});this.handles.add(t.watch(()=>this.renderingConfigHash,()=>this._update(),t.initial),"attach");"stream"!==this.layer.type&&this.handles.add(this.layer.on("edits",a=>this._edit(a)),"attach")};y.detach=function(){var a;this._commandsQueue.clear();null==(a=this._proxy)?void 0:a.stop();this.container.removeAllChildren();this.handles.remove("attach");
this.tileRenderer&&(this.tileRenderer.uninstall(this.container),this.tileRenderer=null);this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null);this._tileRendererHash=null};y.moveStart=function(){this.requestUpdate()};y.viewChange=function(){this.requestUpdate()};y.moveEnd=function(){this.requestUpdate()};y.isUpdating=function(){var a;const b="renderer"in this.layer&&null!=this.layer.renderer,d=this._commandsQueue.updating,n=null!=this._updatingRequiredFieldsPromise,G=!this._proxy||
!this._proxy.isReady,K=this._pipelineIsUpdating,Z=null==this.tileRenderer||(null==(a=this.tileRenderer)?void 0:a.updating);a=b&&(d||n||G||K||Z);h("esri-2d-log-updating")&&console.log(`Updating FLV2D: ${a}\n  -> hasRenderer ${b}\n  -> hasPendingCommand ${d}\n  -> updatingRequiredFields ${n}\n  -> updatingProxy ${G}\n  -> updatingPipeline ${K}\n  -> updatingTileRenderer ${Z}\n`);return a};y._createClientOptions=function(){return{setUpdating:a=>{this._set("_pipelineIsUpdating",a)},emitEvent:a=>{this.emit(a.name,
a.event)}}};y._detectQueryMode=function(){var a=f._asyncToGenerator(function*(b){var d;const n="editingInfo"in this.layer&&(null==(d=this.layer.editingInfo)?void 0:d.lastEditDate);d=!!this.layer.refreshInterval;if("path"in b&&("feature"===this.layer.type||"subtype-group"===this.layer.type)&&"point"===this.layer.geometryType&&this.layer.capabilities.query.supportsPagination&&!this.layer.capabilities.operations.supportsEditing&&(n||!d)&&h("featurelayer-snapshot-enabled"))try{const G=yield this.layer.queryFeatureCount(),
K=h("featurelayer-snapshot-point-min-threshold");if(G<=K)return{mode:"snapshot",featureCount:G};const Z=h("featurelayer-snapshot-point-max-threshold"),ca=h("featurelayer-snapshot-point-coverage"),S=this.view.extent,V=m.unwrap(this.layer.fullExtent),ba=null==V?void 0:V.clone().intersection(S),aa=m.isSome(ba)?ba.width*ba.height:0,da=(null==V?NaN:V.width)*(null==V?NaN:V.height);b=0===da?0:aa/da;if(G<=Z&&b>=ca)return{mode:"snapshot",featureCount:G}}catch(G){I.warn("mapview-feature-layer","Encountered an error when querying for featureCount",
{error:G})}return{mode:"on-demand"}});return function(b){return a.apply(this,arguments)}}();y._createServiceOptions=function(){var a=f._asyncToGenerator(function*(){var b,d=this.layer;if("stream"===d.type)return null;const {capabilities:n,objectIdField:G}=d,K=d.fields.map(ea=>ea.toJSON()),Z=m.isSome(d.fullExtent)&&d.fullExtent.toJSON(),ca=p.toJSONGeometryType(d.geometryType),S=d.timeInfo&&d.timeInfo.toJSON()||null,V=d.spatialReference?d.spatialReference.toJSON():null,ba="feature"===d.type?d.globalIdField:
null;let aa;"ogc-feature"===d.type?aa=d.source.getFeatureDefinition():U(d.source)?aa=yield d.source.openPorts():d.parsedUrl&&(aa=u.clone(d.parsedUrl),"dynamicDataSource"in d&&d.dynamicDataSource&&(aa.query={layer:JSON.stringify({source:d.dynamicDataSource})}));d="datesInUnknownTimezone"in this.layer&&this.layer.datesInUnknownTimezone;const da=null!=(b="subtypeField"in this.layer&&this.layer.subtypeField)?b:null,{mode:ha,featureCount:ia}=yield this._detectQueryMode(aa);b=this.layer.objectIdField;if("feature"===
this.layer.type&&m.isSome(this.layer.orderBy)&&this.layer.orderBy.length){const ea=!this.layer.orderBy[0].valueExpression&&this.layer.orderBy[0].field;ea&&(b=ea)}return{type:ha,timeReferenceUnknownClient:d,subtypeField:da,featureCount:ia,globalIdField:ba,maxRecordCount:n.query.maxRecordCount,tileMaxRecordCount:n.query.tileMaxRecordCount,capabilities:n,fields:K,fullExtent:Z,geometryType:ca,objectIdField:G,source:aa,timeInfo:S,spatialReference:V,orderByFields:b}});return function(){return a.apply(this,
arguments)}}();y._createMemoryServiceOptions=function(){var a=f._asyncToGenerator(function*(b){b=yield b.openPorts();return{...this._createServiceOptions(),type:"memory",source:b}});return function(b){return a.apply(this,arguments)}}();y._cleanUpQuery=function(a){a=J.from(a)||this.createQuery();a.outSpatialReference||(a.outSpatialReference=this.view.spatialReference);return a};y._update=function(){var a=f._asyncToGenerator(function*(){return this._commandsQueue.push({type:"update"})});return function(){return a.apply(this,
arguments)}}();y._edit=function(){var a=f._asyncToGenerator(function*(b){if(this.suspended)this._clearTiles();else if(this._validateEdit(b))return this._commandsQueue.push({type:"edit",edits:b})});return function(b){return a.apply(this,arguments)}}();y.doRefresh=function(){var a=f._asyncToGenerator(function*(b){if(this._tileStrategy.tileKeys().length){if(!this.suspended||!b)return this._commandsQueue.push({type:"refresh",dataChanged:b});this._clearTiles()}});return function(b){return a.apply(this,
arguments)}}();y._clearTiles=function(){this._tileStrategy.tileKeys().length&&(this._proxy.updateTiles({added:[],removed:this._tileStrategy.tileKeys()}),this._tileStrategy.clear(),this.requestUpdate(),this._commandsQueue.clear(),this._update())};y._validateEdit=function(a){const b="globalIdField"in this.layer&&this.layer.globalIdField,d=a.deletedFeatures.some(G=>-1===G.objectId||!G.objectId),n=b&&this.availableFields.includes(b);return d&&!n?(I.error(new r("mapview-apply-edits",`Editing the specified service requires the layer's globalIdField, ${b} to be included the layer's outFields for updates to be reflected on the map`)),
null):a};y._doUpdate=function(){var a=f._asyncToGenerator(function*(){try{if(!this.destroyed&&this._hasRequiredSupport(this.layer)&&this._tileStrategy){var {featureEffectView:b,filter:d}=this;yield this._updateRequiredFields();var {renderer:n}=this._getEffectiveRenderer();this._set("_effectiveRenderer",n);var G=this._createSchemaConfig(),K=this._createConfiguration(G,d,b.filter),Z=this._lastDefinitionExpression!==K.definitionExpression;this._lastDefinitionExpression=K.definitionExpression;var ca=
this._createTileRendererHash(n);"snapshot"===this._serviceOptions.type&&(K.schema.source.featureCount=this._serviceOptions.featureCount);if(ca!==this._tileRendererHash){yield this._initTileRenderer(n);const S=this.layer,V="stream"===S.type?yield this._initServiceOptions():this._serviceOptions;this.tileRenderer.onConfigUpdate(n);"stream"!==S.type&&U(S.source)&&(V.source=yield S.source.openPorts());const ba={added:this._tileStrategy.tileKeys(),removed:[]};yield this._proxy.startup(this.view.featuresTilingScheme,
K,V,ba);this.hasHighlight()&&(yield this._proxy.setHighlight(Array.from(this._highlightIds.keys())));yield this._onceTilesUpdated();this.tileRenderer.onConfigUpdate(n)}else{"snapshot"===this._serviceOptions.type&&Z&&(K.schema.source.featureCount=yield this.layer.queryFeatureCount());const S=yield this._proxy.update(K);(S.mesh||S.targets.aggregate)&&this._lockGPUUploads();try{yield this._proxy.applyUpdate(S)}catch(V){x.isAbortError(V)||I.error(V)}(S.mesh||S.targets.aggregate)&&this._unlockGPUUploads();
this.tileRenderer.onConfigUpdate(n);this._updateClusterSizeVariable();this._forceAttributeTextureUpload()}this._tileRendererHash=ca;this.tileRenderer.invalidateLabels();this.requestUpdate()}}catch(S){}});return function(){return a.apply(this,arguments)}}();y._doEdit=function(){var a=f._asyncToGenerator(function*(b){try{yield this._proxy.onEdits(b)}catch(d){x.isAbortError(d)}});return function(b){return a.apply(this,arguments)}}();y._doRefresh=function(){var a=f._asyncToGenerator(function*(b){var d;
this._lockGPUUploads();try{yield this._proxy.refresh(b)}catch(n){x.isAbortError(n)}this._unlockGPUUploads();null!=(d=this.layer)&&d.featureReduction&&this._updateClusterSizeVariable()});return function(b){return a.apply(this,arguments)}}();y._updateClusterSizeVariable=function(){this._needsClusterSizeUpdate&&(this.tileRenderer.onConfigUpdate(this._effectiveRenderer),this._needsClusterSizeUpdate=!1)};y._createUpdateClusterSizeTask=function(a,b){var d=this;return this.watch("_aggregateValueRanges",
function(){var n=f._asyncToGenerator(function*(G){d._updateClusterEffectiveRendererSizeVariable(a,b,G);d._needsClusterSizeUpdate=!0;d._uploadsLocked||d._updateClusterSizeVariable()});return function(G){return n.apply(this,arguments)}}())};y._updateClusterEffectiveRendererSizeVariable=function(){var a=f._asyncToGenerator(function*(b,d,n){if(b.dynamicClusterSize&&"visualVariables"in b&&b.visualVariables){var G=Q.findSizeVV(b.visualVariables);m.isSome(G)&&"cluster_count"===G.field&&(G=b.visualVariables.indexOf(G),
b.visualVariables[G]=Q.createClusterCountSizeVariable(d,n),b=b.clone(),b.dynamicClusterSize=!0,this._set("_effectiveRenderer",b))}});return function(b,d,n){return a.apply(this,arguments)}}();y._getEffectiveRenderer=function(){var a="renderer"in this.layer&&this.layer.renderer;const b=this.layer.featureReduction;m.isSome(this._updateClusterSizeTask)&&(this._updateClusterSizeTask.remove(),this._updateClusterSizeTask=null);if(b&&"cluster"===b.type&&Q.isClusterCompatibleRenderer(a)){const d=[];a=Q.createClusterRenderer(d,
a,b,this._aggregateValueRanges);m.applySome(this._updateClusterSizeTask,n=>n.remove());this._updateClusterSizeTask=this._createUpdateClusterSizeTask(a,b);return{renderer:a,aggregateFields:d,featureReduction:b}}return{renderer:a,aggregateFields:[],featureReduction:null}};y._acquireTile=function(a){a=this.tileRenderer.acquireTile(a);a.once("attach",()=>{this.requestUpdate()});return a};y._releaseTile=function(a){this.tileRenderer.releaseTile(a)};y._initTileRenderer=function(){var a=f._asyncToGenerator(function*(b){const d=
yield F.createOrReuseTileRenderer(b,{layerView:this,tileInfoView:this.view.featuresTilingScheme,layer:this.layer});this.tileRenderer&&(this._tileStrategy.clear(),this.tileRenderer.uninstall(this.container),this.tileRenderer.destroy(),this.tileRenderer=null);if(this.destroyed)return null;this._proxy.tileRenderer=d;this._set("tileRenderer",d);this.tileRenderer.install(this.container);this.tileRenderer.onConfigUpdate(b);this.requestUpdate();return this.tileRenderer});return function(b){return a.apply(this,
arguments)}}();y._createTileRendererHash=function(a){return`${"heatmap"===a.type?"heatmap":"symbol"}`};y._injectOverrides=function(a){var b=m.isSome(a)?a.timeExtent:null;b=m.isSome(this.timeExtent)&&m.isSome(b)?this.timeExtent.intersection(b):this.timeExtent||b;var d=null;const n="floorInfo"in this.layer&&this.layer.floorInfo;n&&(d=m.isSome(a)&&a.where,d=this._addFloorFilterClause(d));if(!this._visibilityOverrides.size&&!b&&!n)return m.isSome(a)?a.toJSON():null;a=m.isSome(a)&&a.clone()||new C;a.timeExtent=
b;d&&(a.where=d);a=a.toJSON();a.hiddenIds=Array.from(this._visibilityOverrides);return a};y._addFloorFilterClause=function(a){var b=this.layer;a=a||"";if("floorInfo"in b&&b.floorInfo){var d,n=this.view.floors;if(!n||!n.length)return a;null!=(d=b.floorInfo.viewAllLevelIds)&&d.length&&(n=b.floorInfo.viewAllLevelIds);d=n.filter(G=>""!==G).map(G=>"'"+G+"'");d.push("''");b=b.floorInfo.floorField;n="("+b+" IN ({ids}) OR "+b+" IS NULL)";n=n.replace("{ids}",d.join(", "));m.isSome(a)&&a.includes(b)&&(d=new RegExp("AND \\("+
b+".*NULL\\)","g"),a=a.replace(d,""),d=new RegExp("\\("+b+".*NULL\\)","g"),a=a.replace(d,""),a=a.replace(/\s+/g," ").trim());a=""!==a?"("+a+") AND "+n:n}return""!==a?a:null};y._createConfiguration=function(a,b,d){const n="feature"===this.layer.type&&this.layer.historicMoment?this.layer.historicMoment.getTime():void 0,G="feature"===this.layer.type?this.layer.gdbVersion:void 0,K=Array(N.MAX_FILTERS);b=this._injectOverrides(b);K[0]=b;K[1]=m.isSome(d)?d.toJSON():null;a=E.createSchema(a);if(m.isNone(a))return null;
d=M.getWebGL1Capabilities();return{definitionExpression:this.layer.definitionExpression,availableFields:this.availableFields,gdbVersion:G,historicMoment:n,devicePixelRatio:window.devicePixelRatio||1,filters:K,schema:a,supportsTextureFloat:d.supportsTextureFloat,maxTextureSize:d.maxTextureSize}};y._hasRequiredSupport=function(a){var b;return"renderer"in a&&"dot-density"===(null==(b=a.renderer)?void 0:b.type)&&!M.getWebGL1Capabilities().supportsTextureFloat?(I.error(new r("webgl-missing-extension",
"Missing WebGL extension OES_Texture_Float which is required for DotDensity")),!1):!0};y._onceTilesUpdated=function(){this.requestUpdate();return t.whenOnce(()=>!this._pipelineIsUpdating)};y._lockGPUUploads=function(){this.tileRenderer&&(this._uploadsLocked=!0,this.tileRenderer.lockGPUUploads())};y._unlockGPUUploads=function(){this.tileRenderer&&(this._uploadsLocked=!1,this.tileRenderer.unlockGPUUploads())};y._forceAttributeTextureUpload=function(){this.tileRenderer&&this.tileRenderer.forceAttributeTextureUpload()};
y._createSchemaConfig=function(){return{renderer:"renderer"in this.layer&&this.layer.renderer,spatialReference:this.layer.spatialReference,timeExtent:this.layer.timeExtent,definitionExpression:this.layer.definitionExpression,featureReduction:this.layer.featureReduction,fields:this.layer.fields,geometryType:this.layer.geometryType,historicMoment:"feature"===this.layer.type?this.layer.historicMoment:null,labelsVisible:"labelsVisible"in this.layer&&this.layer.labelsVisible,labelingInfo:"labelingInfo"in
this.layer&&this.layer.labelingInfo,availableFields:this.availableFields,featureEffect:this.featureEffect,filter:this.filter,gdbVersion:"feature"===this.layer.type?this.layer.gdbVersion:null,pixelBuffer:0,orderBy:"orderBy"in this.layer&&this.layer.orderBy?this.layer.orderBy:null,customParameters:{..."customParameters"in this.layer?this.layer.customParameters:void 0,token:"apiKey"in this.layer?this.layer.apiKey:void 0}}};y._addHighlight=function(a){for(const b of a)this._highlightIds.has(b)?(a=this._highlightIds.get(b),
this._highlightIds.set(b,a+1)):this._highlightIds.set(b,1);this._updateHighlight().catch(b=>{x.isAbortError(b)||I.error(b)})};y._removeHighlight=function(a){for(const b of a)this._highlightIds.has(b)&&(a=this._highlightIds.get(b)-1,0===a?this._highlightIds.delete(b):this._highlightIds.set(b,a));this._updateHighlight().catch(b=>{x.isAbortError(b)||I.error(b)})};y._setLayersForFeature=function(a){const b=this.layer;a.layer=b;a.sourceLayer=b};y._createHittestResult=function(a){this._setLayersForFeature(a);
m.isSome(a.geometry)&&(a.geometry.spatialReference=this.view.spatialReference);return a};f._createClass(Y,[{key:"orderByFields",get:function(){return"stream"!==this._serviceOptions.type&&this._serviceOptions.orderByFields}},{key:"labelsVisible",get:function(){const a="subtype-group"===this.layer.type?this.layer.sublayers.items:[this.layer];return!this.suspended&&a.some(b=>b.labelingInfo&&b.labelsVisible)}},{key:"queryMode",get:function(){return this._serviceOptions.type}},{key:"renderingConfigHash",
get:function(){if(!this.layer)return null;const a=this.availableFields;var b=this.layer;const d=this.view.floors,{definitionExpression:n}=b,G="subtype-group"!==this.layer.type&&this.layer.labelsVisible&&this.layer.labelingInfo,K="renderer"in b&&b.renderer,Z="feature"===b.type?b.gdbVersion:void 0,ca="feature"===b.type&&b.historicMoment?b.historicMoment.getTime():void 0,{timeExtent:S}=this,V="customParameters"in b?JSON.stringify(b.customParameters):void 0,ba="apiKey"in b?b.apiKey:void 0,aa="stream"===
b.type?`${JSON.stringify(b.geometryDefinition)}${b.definitionExpression}`:null,da=JSON.stringify(this.clips);b=b.featureReduction&&b.featureReduction.toJSON();const ha="orderBy"in this.layer&&JSON.stringify(this.layer.orderBy),ia="sublayers"in this.layer&&this.layer.sublayers.items.reduce((ea,fa)=>ea+`${fa.visible?1:0}.${JSON.stringify(fa.renderer)}.${fa.labelsVisible}\n.${JSON.stringify(fa.labelingInfo)}`,"");return JSON.stringify({orderBy:ha,sublayerHash:ia,filterHash:m.isSome(this.filter)&&this.filter.toJSON(),
effectHash:m.isSome(this.featureEffect)&&this.featureEffect.toJSON(),streamFilter:aa,gdbVersion:Z,definitionExpression:n,historicMoment:ca,availableFields:a,renderer:K,labelingInfo:G,timeExtent:S,floors:d,clipsHash:da,featureReduction:b,customParameters:V,apiKey:ba})}},{key:"hasFilter",get:function(){const a=!!("floorInfo"in this.layer&&this.layer.floorInfo&&this.view.floors&&this.view.floors.length);return!!this.filter||a||!!this._visibilityOverrides.size||!!this.timeExtent}}]);return Y}(w.FeatureLayerView(R.RefreshableLayerView(L.LayerView2DMixin(T))));
l.__decorate([c.property()],q.prototype,"_serviceOptions",void 0);l.__decorate([c.property()],q.prototype,"_proxy",void 0);l.__decorate([c.property()],q.prototype,"_pipelineIsUpdating",void 0);l.__decorate([c.property()],q.prototype,"_effectiveRenderer",void 0);l.__decorate([c.property()],q.prototype,"_aggregateValueRanges",void 0);l.__decorate([c.property()],q.prototype,"_commandsQueue",void 0);l.__decorate([c.property()],q.prototype,"featureEffectView",void 0);l.__decorate([c.property()],q.prototype,
"labelsVisible",null);l.__decorate([c.property({readOnly:!0})],q.prototype,"queryMode",null);l.__decorate([c.property()],q.prototype,"renderingConfigHash",null);l.__decorate([c.property()],q.prototype,"tileRenderer",void 0);l.__decorate([c.property()],q.prototype,"updating",void 0);return q=l.__decorate([k.subclass("esri.views.2d.layers.FeatureLayerView2D")],q)});