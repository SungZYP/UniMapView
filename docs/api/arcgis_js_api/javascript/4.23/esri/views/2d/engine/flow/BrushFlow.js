// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../webgl/brushes/WGLBrush","../../../webgl/enums"],function(p,q,r,g){function l(c,f,d,a){switch(f){case "int":c.setUniform1iv(d,a);break;case "float":c.setUniform1fv(d,a);break;case "vec2":c.setUniform2fv(d,a);break;case "vec3":c.setUniform3fv(d,a);break;case "vec4":c.setUniform4fv(d,a)}}function m(c,f,d,a){"constant"===a.kind?l(c,d,`u_${f}`,a.value):(l(c,"float",`u_${f}_stops`,a.stops),l(c,d,`u_${f}_values`,a.values),
l(c,"int",`u_${f}_count`,[a.count]))}return function(c){function f(){return c.apply(this,arguments)||this}p._inheritsLoose(f,c);var d=f.prototype;d.dispose=function(){};d.prepareState=function(a){({context:a}=a);a.setColorMask(!0,!0,!0,!0);a.setStencilFunction(g.CompareFunction.EQUAL,0,255)};d.draw=function(a,n){const {context:h}=a,{displayData:e}=n;if(!q.isNone(e)&&("loaded"===e.state.name&&e.prepareForRendering(h),"attached"===e.state.name)){var k=e.state.resources;h.setFaceCullingEnabled(!1);h.setBlendingEnabled(!0);
h.setBlendFunctionSeparate(g.BlendFactor.ONE,g.BlendFactor.ONE_MINUS_SRC_ALPHA,g.BlendFactor.ONE,g.BlendFactor.ONE);var b=[];"ramp"===k.values.lineColor.kind&&b.push("vvLineColor");"ramp"===k.values.lineOpacity.kind&&b.push("vvLineOpacity");"ramp"===k.values.lineRenderWidth.kind&&b.push("vvLineRenderWidth");b=a.painter.materialManager.getProgram(a,{vsPath:"raster/flow",fsPath:"raster/flow",attributes:k.locations},b);h.useProgram(b);b.setUniform1f("u_time",a.time/1E3);b.setUniform1f("u_fadeDuration",
e.flowStyle.renderSettings.fadeDuration);b.setUniform1f("u_lineSpeed",e.flowStyle.renderSettings.lineSpeed);b.setUniformMatrix3fv("u_dvsMat3",n.transforms.dvs);b.setUniformMatrix3fv("u_displayViewMat3",a.state.displayViewMat3);m(b,"lineColor","vec4",e.flowStyle.renderSettings.lineColor);m(b,"lineOpacity","float",e.flowStyle.renderSettings.lineOpacity);m(b,"lineRenderWidth","float",e.flowStyle.renderSettings.lineRenderWidth);h.bindVAO(k.vertexArray);h.drawElements(g.PrimitiveType.TRIANGLES,k.indexBuffer.size,
g.DataType.UNSIGNED_INT,0);e.flowStyle.animated&&n.requestRender()}};return f}(r)});