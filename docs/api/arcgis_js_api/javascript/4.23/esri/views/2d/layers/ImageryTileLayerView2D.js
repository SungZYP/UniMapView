// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/flow/FlowView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/HandleOwner ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./dataUtils ./FlowContainer ./FlowStrategy ./FlowStyle".split(" "),function(x,
N,r,y,v,A,B,t,E,u,g,q,H,U){y=function(Q){function p(){var C=Q.apply(this,arguments)||this;C._loadImagery=(P,T,X,W,f)=>g.loadImagery(C.layer,P,T,X,W,f);C._createStreamlinesMesh=(P,T,X)=>C.layer.createStreamlinesMesh({flowData:T,rendererSettings:P},{signal:X});C.attached=!1;C.container=null;C.layer=null;C.type="flow";C.timeExtent=null;C.redrawOrRefetch=x._asyncToGenerator(function*(){C._updateVisualization()});return C}x._inheritsLoose(p,Q);var G=p.prototype;G.attach=function(){const {layer:C}=this,
P=()=>{this._loadImagery=(T,X,W,f,b)=>g.loadImagery(C,T,X,W,f,b);this._updateVisualization()};"multidimensionalDefinition"in C?this.handles.add(v.watch(()=>C.multidimensionalDefinition,P)):this.handles.add([v.watch(()=>C.mosaicRule,P),v.watch(()=>C.renderingRule,P),v.watch(()=>C.definitionExpression,P)]);this.container=new q;this._strategy=new H({flowContainer:this.container});this._updateVisualization()};G.detach=function(){this._strategy.destroy();this.container.removeAllChildren();this.container=
null;this.handles.removeAll()};G.update=function(C){C.stationary?this._strategy.update(C):this.layerView.requestUpdate()};G.hitTest=function(C){return new r({attributes:{},geometry:C.clone(),layer:this.layer})};G.moveEnd=function(){};G.doRefresh=function(){var C=x._asyncToGenerator(function*(){});return function(){return C.apply(this,arguments)}}();G._updateVisualization=function(){if("flow"===this.layer.renderer.type){var C=new U(this._loadImagery,this._createStreamlinesMesh,this.layer.renderer,
this.timeExtent);this.container.flowStyle=C;this.layerView.requestUpdate()}};x._createClass(p,[{key:"updating",get:function(){return!this._strategy||this._strategy.updating}}]);return p}(y.HandleOwner);N.__decorate([A.property()],y.prototype,"_strategy",void 0);N.__decorate([A.property()],y.prototype,"attached",void 0);N.__decorate([A.property()],y.prototype,"container",void 0);N.__decorate([A.property()],y.prototype,"layer",void 0);N.__decorate([A.property()],y.prototype,"layerView",void 0);N.__decorate([A.property()],
y.prototype,"type",void 0);N.__decorate([A.property()],y.prototype,"updating",null);N.__decorate([A.property()],y.prototype,"timeExtent",void 0);return y=N.__decorate([u.subclass("esri.views.2d.engine.flow.FlowView2D")],y)})},"esri/views/2d/engine/flow/dataUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/RandomLCG ../../../../geometry/support/spatialReferenceUtils ../../../../geometry/Extent".split(" "),
function(x,N,r,y,v,A,B,t,E,u){function g(){g=N._asyncToGenerator(function*(f,b,c){const e=performance.now();var k=q(f,b);const n=performance.now();k=U(f,k,b.width,b.height);b=performance.now();var w=p(k,!0);k=performance.now();w=G(w);const I=performance.now();f.profile&&W.info("createStreamlinesMesh profile",{"_createFlowFieldFromData()":Math.round(n-e),"_getStreamlines()":Math.round(b-n),"createAnimatedLinesData()":Math.round(k-b),"createLinesMesh()":Math.round(I-k),"Total elapsed time":Math.round(I-
e)});yield Promise.resolve();B.throwIfAborted(c);return w});return g.apply(this,arguments)}function q(f,b){const c=Q(b.data,b.width,b.height,f.smoothing);return f.interpolate?(e,k)=>{const n=Math.floor(e),w=Math.floor(k);if(0>n||n>=b.width||0>w||w>=b.height)return[0,0];e-=n;k-=w;const I=n<b.width-1?n+1:n,R=w<b.height-1?w+1:w;return[(c[2*(w*b.width+n)]*(1-k)+c[2*(R*b.width+n)]*k)*(1-e)+(c[2*(w*b.width+I)]*(1-k)+c[2*(R*b.width+I)]*k)*e,(c[2*(w*b.width+n)+1]*(1-k)+c[2*(R*b.width+n)+1]*k)*(1-e)+(c[2*
(w*b.width+I)+1]*(1-k)+c[2*(R*b.width+I)+1]*k)*e]}:(e,k)=>{e=Math.round(e);k=Math.round(k);return 0>e||e>=b.width||0>k||k>=b.height?[0,0]:[c[2*(k*b.width+e)],c[2*(k*b.width+e)+1]]}}function H(f,b,c,e,k,n,w,I,R){const l=[];let D=0,[M,S]=b(c,e);M*=f.velocityScale;S*=f.velocityScale;l.push({x:c,y:e,t:D,speed:Math.sqrt(M*M+S*S)});for(let a=0;a<f.verticesPerLine;a++){let [d,h]=b(c,e);d*=f.velocityScale;h*=f.velocityScale;const m=Math.sqrt(d*d+h*h);if(m<f.minSpeedThreshold)break;const J=d/m,K=h/m;c+=J*
f.segmentLength;e+=K*f.segmentLength;D+=f.segmentLength/m;if(Math.acos(J*O+K*Y)>f.maxTurnAngle)break;if(f.mergeLines){var O=Math.round(c*R);var Y=Math.round(e*R);if(0>O||O>w-1||0>Y||Y>I-1)break;const z=n[Y*w+O];if(-1!==z&&z!==k)break;n[Y*w+O]=k}l.push({x:c,y:e,t:D,speed:m});O=J;Y=K}return l}function U(f,b,c,e){const k=[],n=new t,w=1/Math.max(f.lineCollisionWidth,1),I=Math.round(c*w),R=Math.round(e*w),l=new Int32Array(I*R);for(var D=0;D<l.length;D++)l[D]=-1;D=[];for(let M=0;M<e;M+=f.lineSpacing)for(let S=
0;S<c;S+=f.lineSpacing)D.push({x:S,y:M,sort:n.getFloat()});D.sort((M,S)=>M.sort-S.sort);for(const {x:M,y:S}of D)n.getFloat()<f.density&&(c=H(f,b,M,S,k.length,l,I,R,w),2>c.length||k.push(c));return k}function Q(f,b,c,e){if(0===e)return f;const k=Math.round(3*e),n=Array(2*k+1);var w=0;for(var I=-k;I<=k;I++){var R=Math.exp(-I*I/(e*e));n[I+k]=R;w+=R}for(e=-k;e<=k;e++)n[e+k]/=w;w=new Float32Array(f.length);for(e=0;e<c;e++)for(I=0;I<b;I++){var l=R=0;for(var D=-k;D<=k;D++)if(!(0>I+D||I+D>=b)){var M=n[D+
k];R+=M*f[2*(e*b+(I+D))];l+=M*f[2*(e*b+(I+D))+1]}w[2*(e*b+I)]=R;w[2*(e*b+I)+1]=l}f=new Float32Array(f.length);for(e=0;e<b;e++)for(I=0;I<c;I++){l=R=0;for(D=-k;D<=k;D++)0>I+D||I+D>=c||(M=n[D+k],R+=M*w[2*((I+D)*b+e)],l+=M*w[2*((I+D)*b+e)+1]);f[2*(I*b+e)]=R;f[2*(I*b+e)+1]=l}return f}function p(f,b){const c=new t;var e=f.reduce((I,R)=>I+R.length,0);e=new Float32Array(4*e);const k=Array(f.length);let n=0,w=0;for(const I of f){f=n;for(const R of I)e[4*n]=R.x,e[4*n+1]=R.y,e[4*n+2]=R.t,e[4*n+3]=R.speed,n++;
k[w++]={startVertex:f,numberOfVertices:I.length,totalTime:I[I.length-1].t,timeSeed:b?c.getFloat():0}}return{lineVertices:e,lineDescriptors:k}}function G(f,b=10){function c(O,Y,a,d,h,m,J,K){const z=9*R;let F=0;I[z+F++]=O;I[z+F++]=Y;I[z+F++]=1;I[z+F++]=a;I[z+F++]=m;I[z+F++]=J;I[z+F++]=d/2;I[z+F++]=h/2;I[z+F++]=K;R++;I[z+F++]=O;I[z+F++]=Y;I[z+F++]=-1;I[z+F++]=a;I[z+F++]=m;I[z+F++]=J;I[z+F++]=-d/2;I[z+F++]=-h/2;I[z+F++]=K;R++}const {lineVertices:e,lineDescriptors:k}=f;var n=f=0;for(var w of k)f+=2*w.numberOfVertices,
n+=6*(w.numberOfVertices-1);const I=new Float32Array(9*f);w=new Uint32Array(n);let R=0;f=0;for(const O of k){const {totalTime:Y,timeSeed:a}=O;let d=n=null,h=null;var l=null,D=null,M=null;for(let m=0;m<O.numberOfVertices;m++){l=e[4*(O.startVertex+m)];const J=e[4*(O.startVertex+m)+1],K=e[4*(O.startVertex+m)+2],z=e[4*(O.startVertex+m)+3];let F=null,L=null;var S=null;let V=null;0<m&&(F=l-n,L=J-d,S=Math.sqrt(F*F+L*L),F/=S,L/=S,1<m?(D=F+D,M=L+M,S=Math.sqrt(D*D+M*M),D/=S,M/=S,S=Math.min(1/(D*F+M*L),b),D*=
S,M*=S,S=-M,V=D):(S=-L,V=F),null!==S&&null!==V&&(c(n,d,h,S,V,Y,a,z),w[f++]=R-2,w[f++]=R,w[f++]=R-1,w[f++]=R,w[f++]=R+1,w[f++]=R-1));n=l;d=J;h=K;D=F;M=L;l=z}c(n,d,h,-M,D,Y,a,l)}return{vertexData:I,indexData:w}}function C(f,b){const c=b.pixels,{width:e,height:k}=b;b=new Float32Array(e*k*2);if("vector-uv"===f)for(f=0;f<e*k;f++)b[2*f]=c[0][f],b[2*f+1]=-c[1][f];else if("vector-magdir"===f)for(f=0;f<e*k;f++){const n=c[0][f],w=v.deg2rad(c[1][f]),I=Math.sin(w-Math.PI/2);b[2*f]=Math.cos(w-Math.PI/2)*n;b[2*
f+1]=I*n}return{data:b,width:e,height:k}}function P(){P=N._asyncToGenerator(function*(f,b,c,e,k,n){var w=E.getInfo(b.spatialReference);if(!w)return T(f,b,c,e,k,n);const [I,R]=w.valid;w=Math.ceil(b.width/(R-I));const l=b.width/w,D=Math.round(c/w);let M=b.xmin;const S=[];for(let O=0;O<w;O++){const Y=new u({xmin:M,xmax:M+l,ymin:b.ymin,ymax:b.ymax,spatialReference:b.spatialReference});S.push(T(f,Y,D,e,k,n));M+=l}b=yield Promise.all(S);e={data:new Float32Array(c*e*2),width:c,height:e};f=0;for(const O of b){for(b=
0;b<O.height;b++)for(k=0;k<O.width;k++)f+k>=c||(e.data[2*(b*c+f+k)]=O.data[2*(b*O.width+k)],e.data[2*(b*c+f+k)+1]=O.data[2*(b*O.width+k)+1]);f+=O.width}return e});return P.apply(this,arguments)}function T(f,b,c,e,k,n){return X.apply(this,arguments)}function X(){X=N._asyncToGenerator(function*(f,b,c,e,k,n){const w={requestProjectedLocalDirections:!0,signal:n};A.isSome(k)&&(w.timeExtent=k);if("imagery"===f.type)return yield f.load({signal:n}),k=f.rasterInfo.dataType,f=yield f.fetchImage(b,c,e,w),!f||
A.isNone(f.pixelData)||A.isNone(f.pixelData.pixelBlock)?{data:new Float32Array(c*e*2),width:c,height:e}:C(k,f.pixelData.pixelBlock);yield f.load({signal:n});k=f.rasterInfo.dataType;f=yield f.fetchPixels(b,c,e,w);return!f||A.isNone(f.pixelBlock)?{data:new Float32Array(c*e*2),width:c,height:e}:C(k,f.pixelBlock)});return X.apply(this,arguments)}const W=y.getLogger("esri.views.2d.engine.flow.dataUtils");x.createAnimatedLinesData=p;x.createLinesMesh=G;x.createStreamlinesMesh=function(f,b,c){return g.apply(this,
arguments)};x.fetchPart=T;x.loadImagery=function(f,b,c,e,k,n){return P.apply(this,arguments)};Object.defineProperty(x,"__esModule",{value:!0})})},"esri/views/2d/engine/flow/FlowContainer":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./BrushFlow","../webgl/enums","../webgl/WGLContainer"],function(x,N,r,y){return function(v){function A(){var t=v.apply(this,arguments)||this;t.flowStyle=null;return t}x._inheritsLoose(A,v);var B=A.prototype;B.doRender=function(t){v.prototype.doRender.call(this,
t)};B.prepareRenderPasses=function(t){const E=t.registerRenderPass({name:"flow",brushes:[N],target:()=>this.children,drawPhase:r.WGLDrawPhase.MAP});return[...v.prototype.prepareRenderPasses.call(this,t),E]};x._createClass(A,[{key:"requiresDedicatedFBO",get:function(){return!1}}]);return A}(y)})},"esri/views/2d/engine/flow/FlowStrategy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Point ./FlowDisplayData ./FlowDisplayObject ../../../../geometry/Extent".split(" "),
function(x,N,r,y,v,A,B,t,E,u,g,q,H,U,Q,p,G){function C(T,X){const W=new U({x:(T.xmax+T.xmin)/2,y:(T.ymax+T.ymin)/2,spatialReference:T.spatialReference});var f=T.xmax-T.xmin;const b=T.ymax-T.ymin,c=Math.abs(Math.cos(A.deg2rad(X))),e=Math.abs(Math.sin(A.deg2rad(X)));X=c*f+e*b;f=e*f+c*b;T=new G({xmin:W.x-X/2,ymin:W.y-f/2,xmax:W.x+X/2,ymax:W.y+f/2,spatialReference:T.spatialReference});T.centerAt(W);return T}const P=v.getLogger("esri.views.2d.engine.flow.FlowStrategy");r=function(T){function X(f){f=T.call(this,
f)||this;f._flowDisplayObject=new p.FlowDisplayObject;f._loading=null;return f}x._inheritsLoose(X,T);var W=X.prototype;W.initialize=function(){this.flowContainer.addChild(this._flowDisplayObject)};W.destroy=function(){this._clear();this.flowContainer.removeAllChildren()};W.update=function(f){var {flowStyle:b}=this.flowContainer;if(B.isNone(b))this._clear();else{var {extent:c,rotation:e,resolution:k,pixelRatio:n}=f.state;f=C(c,e);f.expand(1.15);b=new Q(b,f,[Math.round((f.xmax-f.xmin)/k),Math.round((f.ymax-
f.ymin)/k)],n);if(B.isSome(this._loading)){if(this._loading.update(b))return;this._loading.destroy();this._loading=null}if(B.isNone(this._flowDisplayObject.displayData)||!this._flowDisplayObject.displayData.update(b))b.load().then(()=>{this._flowDisplayObject.clear();this._flowDisplayObject.displayData=this._loading;this._loading=null},w=>{t.isAbortError(w)||(P.error("A resource failed to load.",w),this._loading=null)}),this._loading=b}};W._clear=function(){this._flowDisplayObject.clear();B.isSome(this._loading)&&
(this._loading.destroy(),this._loading=null)};x._createClass(X,[{key:"updating",get:function(){return null!=this._loading}}]);return X}(y);N.__decorate([E.property()],r.prototype,"_loading",void 0);N.__decorate([E.property()],r.prototype,"flowContainer",void 0);N.__decorate([E.property()],r.prototype,"updating",null);return r=N.__decorate([H.subclass("esri.views.2d.engine.flow.FlowStrategy")],r)})},"esri/views/2d/engine/flow/FlowDisplayData":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/Logger"],function(x,N){const r=N.getLogger("esri.views.2d.engine.flow.FlowDisplayData");return function(){function y(A,B,t,E){this.state={name:"created"};this.flowStyle=A;this.extent=B;this.size=t;this.pixelRatio=E}var v=y.prototype;v.load=function(){var A=x._asyncToGenerator(function*(){const B=new AbortController;this.state={name:"loading",abortController:B};this.state={name:"loaded",resources:yield this.flowStyle.loadResources({extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},
B.signal)}});return function(){return A.apply(this,arguments)}}();v.prepareForRendering=function(A){if("loaded"!==this.state.name)r.error("Only loaded resources can be attached.");else{var B=this.state.resources;B.prepareForRendering(A);this.state={name:"attached",resources:B}}};v.destroy=function(){"loading"===this.state.name?(this.state.abortController.abort(),this.state={name:"detached"}):"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})};v.update=function(A){if(!this.flowStyle.areResourcesCompatible(A.flowStyle)||
!this.extent.equals(A.extent)||this.size[0]!==A.size[0]||this.size[1]!==A.size[1]||this.pixelRatio!==A.pixelRatio)return!1;this.flowStyle=A.flowStyle;return!0};return y}()})},"esri/views/2d/engine/flow/FlowDisplayObject":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../DisplayObject".split(" "),function(x,N,r,y,v,A,B){B=function(t){function E(){var g=t.apply(this,arguments)||
this;g._displayData=null;return g}N._inheritsLoose(E,t);var u=E.prototype;u.clear=function(){y.isSome(this._displayData)&&(this._displayData.destroy(),this._displayData=null,this.requestRender())};u.setTransform=function(g){var {displayData:q}=this;if(!y.isNone(q)){var H=[0,0];g.toScreen(H,[q.extent.xmin,q.extent.ymax]);q=(q.extent.xmax-q.extent.xmin)/q.size[0]/g.resolution;var U=r.deg2rad(g.rotation),{dvs:Q}=this.transforms;v.fromTranslation(Q,[-1,1,0]);v.scale(Q,Q,[2/(g.size[0]*g.pixelRatio),-2/
(g.size[1]*g.pixelRatio),1]);v.translate(Q,Q,[H[0],H[1],0]);v.rotate(Q,Q,U);v.scale(Q,Q,[q*g.pixelRatio,q*g.pixelRatio,1])}};u._createTransforms=function(){return{dvs:A.create()}};N._createClass(E,[{key:"displayData",get:function(){return this._displayData},set:function(g){this._displayData=g;this.requestRender()}}]);return E}(B.DisplayObject);x.FlowDisplayObject=B;Object.defineProperty(x,"__esModule",{value:!0})})},"esri/views/2d/engine/flow/FlowStyle":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/maybe","../../../../core/promiseUtils","./FlowGLResources","./flowRendererUtils"],function(x,N,r,y,v){return function(){function A(t,E,u,g){this._loadImagery=t;this._createStreamlinesMesh=E;this._timeExtent=g;this._rendererSettings=v.createFlowRendererSettings(u)}var B=A.prototype;B.areResourcesCompatible=function(t){let E;(E=(E=(E=(E=(E=(E=(E=(E=(E=(E=(E=(E=(E=(E=(E=(E=t._loadImagery===this._loadImagery)&&t._createStreamlinesMesh===this._createStreamlinesMesh)&&t._rendererSettings.verticesPerLine===
this._rendererSettings.verticesPerLine)&&t._rendererSettings.segmentLength===this._rendererSettings.segmentLength)&&t._rendererSettings.lineSpacing===this._rendererSettings.lineSpacing)&&t._rendererSettings.density===this._rendererSettings.density)&&t._rendererSettings.smoothing===this._rendererSettings.smoothing)&&t._rendererSettings.velocityScale===this._rendererSettings.velocityScale)&&t._rendererSettings.minWeightThreshold===this._rendererSettings.minWeightThreshold)&&t._rendererSettings.minSpeedThreshold===
this._rendererSettings.minSpeedThreshold)&&t._rendererSettings.mergeLines===this._rendererSettings.mergeLines)&&t._rendererSettings.velocityScale===this._rendererSettings.velocityScale)&&t._rendererSettings.interpolate===this._rendererSettings.interpolate)&&t._rendererSettings.lineColor.kind===this._rendererSettings.lineColor.kind)&&t._rendererSettings.lineOpacity.kind===this._rendererSettings.lineOpacity.kind)&&t._rendererSettings.lineRenderWidth.kind===this._rendererSettings.lineRenderWidth.kind)&&
this._rendererSettings.mergeLines&&(E=t._rendererSettings.lineCollisionWidth===this._rendererSettings.lineCollisionWidth);E&&t._timeExtent!==this._timeExtent&&(E=N.isSome(t._timeExtent)&&N.isSome(this._timeExtent)?t._timeExtent.equals(this._timeExtent):!1);return E};B.loadResources=function(){var t=x._asyncToGenerator(function*(E,u){const {extent:g,size:q}=E;r.throwIfAborted(u);E=yield this._loadImagery(g,q[0],q[1],this._timeExtent,u);const {vertexData:H,indexData:U}=yield this._createStreamlinesMesh(this._rendererSettings,
E,u);return new y(H,U,{lineColor:this._rendererSettings.lineColor,lineOpacity:this._rendererSettings.lineOpacity,lineRenderWidth:this._rendererSettings.lineRenderWidth})});return function(E,u){return t.apply(this,arguments)}}();x._createClass(A,[{key:"animated",get:function(){return 0<this._rendererSettings.lineSpeed}},{key:"renderSettings",get:function(){return this._rendererSettings}}]);return A}()})},"esri/views/2d/engine/flow/FlowGLResources":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"../../../webgl/BufferObject","../../../webgl/enums","../../../webgl/VertexArrayObject","../../../webgl/VertexElementDescriptor"],function(x,N,r,y,v){const A=new Map;A.set("a_positionAndSide",0);A.set("a_timeInfo",1);A.set("a_extrude",2);A.set("a_speed",3);const B={geometry:[new v.VertexElementDescriptor("a_positionAndSide",3,r.DataType.FLOAT,0,36),new v.VertexElementDescriptor("a_timeInfo",3,r.DataType.FLOAT,12,36),new v.VertexElementDescriptor("a_extrude",2,r.DataType.FLOAT,24,36),new v.VertexElementDescriptor("a_speed",
1,r.DataType.FLOAT,32,36)]};return function(){function t(u,g,q){this.values=q;this._vertexData=u;this._indexData=g}var E=t.prototype;E.prepareForRendering=function(u){const g=N.BufferObject.createVertex(u,r.Usage.STATIC_DRAW,this._vertexData),q=N.BufferObject.createIndex(u,r.Usage.STATIC_DRAW,this._indexData);u=new y.VertexArrayObject(u,A,B,{geometry:g},q);this.vertexBuffer=g;this.indexBuffer=q;this.vertexArray=u;this._indexData=this._vertexData=null};E.detach=function(){this.vertexArray.dispose();
this.vertexBuffer.dispose();this.indexBuffer.dispose()};x._createClass(t,[{key:"locations",get:function(){return A}}]);return t}()})},"esri/views/2d/engine/flow/flowRendererUtils":function(){define(["exports","../../../../core/screenUtils"],function(x,N){function r(y){y=y.toRgba();return[y[0]/255,y[1]/255,y[2]/255,y[3]]}x.createFlowRendererSettings=function(y){if(y.hasVisualVariables("size")){var v=y.getVisualVariablesForType("size")[0];var A=[];var B=[];if(v.stops){for(var t of v.stops)A.push(t.value),
B.push(t.size);v=v.stops.length}else A.push(v.minDataValue,v.maxDataValue),B.push(v.minSize,v.maxSize),v=2;A={kind:"ramp",stops:A,values:B,count:v}}else A={kind:"constant",value:[N.pt2px(y.trailWidth)]};B="constant"===A.kind?A.value[0]:A.values[A.values.length-1];v=2*B;t=Math.round(N.pt2px(y.maxPathLength)/v)+1;if(y.hasVisualVariables("color")){var E=y.getVisualVariablesForType("color")[0],u=[],g=[];for(q of E.stops)u.push(q.value),Array.prototype.push.apply(g,r(q.color));var q={kind:"ramp",stops:u,
values:g,count:E.stops.length}}else q={kind:"constant",value:r(y.color)};if(y.hasVisualVariables("opacity")){E=y.getVisualVariablesForType("opacity")[0];u=[];g=[];for(H of E.stops)u.push(H.value),g.push(H.opacity);var H={kind:"ramp",stops:u,values:g,count:E.stops.length}}else H={kind:"constant",value:[1]};const {flowSpeed:U,trailLength:Q,density:p}=y;E=N.pt2px(y.smoothing);return{lineRenderWidth:A,segmentLength:v,verticesPerLine:t,lineCollisionWidth:B,lineSpacing:10,lineColor:q,lineOpacity:H,lineSpeed:U,
fadeDuration:Q,density:p,smoothing:E,velocityScale:"flow-from"===y.flowRepresentation?1:-1,minWeightThreshold:.001,minSpeedThreshold:.001,maxTurnAngle:1,mergeLines:!0,interpolate:!0,profile:!1}};Object.defineProperty(x,"__esModule",{value:!0})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../engine/Container ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(x,N,r,y,v,A,B,t,E,u,g,q,H,U,Q,p,G){const C=y.ofType({key:"type",base:U,typeMap:{rect:Q,path:G,geometry:p}});x.LayerView2DMixin=P=>{P=function(T){function X(){var f=T.apply(this,arguments)||this;f.attached=!1;f.clips=new C;f.lastUpdateId=-1;f.moving=!1;f.updateRequested=!1;return f}N._inheritsLoose(X,T);var W=X.prototype;W.initialize=function(){var f,b,c,e;const k=null!=(f=null==(b=this.view)?void 0:b.spatialReferenceLocked)?f:!0;(null==(c=this.view)?0:c.spatialReference)&&k&&!this.spatialReferenceSupported?
this.addResolvingPromise(Promise.reject(new A("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new H.Container),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([B.watch(()=>this.suspended,n=>{this.container&&(this.container.visible=!n);this.view&&!n&&this.updateRequested&&this.view.requestUpdate()},B.syncAndInitial),
B.watch(()=>{var n,w;return null!=(n=null==(w=this.layer)?void 0:w.opacity)?n:1},n=>{this.container&&(this.container.opacity=n)},B.syncAndInitial),B.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",n=>{this.container&&(this.container.blendMode=n)},B.syncAndInitial),B.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,n=>{this.container&&(this.container.effect=n)},B.syncAndInitial),B.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=this.clips)})]),
null!=(e=this.view)&&e.whenLayerView?this.view.whenLayerView(this.layer).then(n=>{n===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))};W.destroy=function(){this.processDetach();this.updateRequested=!1};W.processAttach=function(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())};W.processDetach=function(){this.attached&&(this.attached=!1,this.detach(),this.updateRequested=
!1)};W.isVisibleAtScale=function(f){const b=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!b)return!0;const {minScale:c,maxScale:e}=b;return(0===c||f<=c)&&(0===e||f>=e)};W.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};W.processUpdate=function(f){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",f),this.updateRequested&&!this.suspended&&
(this.updateRequested=!1,this.update(f)))};W.hitTest=function(f,b){return Promise.resolve(null)};W.supportsSpatialReference=function(f){return!0};W.canResume=function(){return this.spatialReferenceSupported?T.prototype.canResume.call(this)?this.visibleAtCurrentScale:!1:!1};W.getSuspendInfo=function(){const f=T.prototype.getSuspendInfo.call(this),b=!this.spatialReferenceSupported,c=this.visibleAtCurrentScale;b&&(f.spatialReferenceNotSupported=b);c&&(f.outsideScaleRange=c);return f};N._createClass(X,
[{key:"spatialReferenceSupported",get:function(){var f;const b=null==(f=this.view)?void 0:f.spatialReference;return null==b||this.supportsSpatialReference(b)}},{key:"updating",get:function(){var f;return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!(null==(f=this.updatingHandles)||!f.updating))}},{key:"visibleAtCurrentScale",get:function(){return this.isVisibleAtScale(this.view.scale)}}]);return X}(P);r.__decorate([t.property()],P.prototype,
"attached",void 0);r.__decorate([t.property({type:C,set(T){T=v.referenceSetter(T,this._get("clips"),C);this._set("clips",T)}})],P.prototype,"clips",void 0);r.__decorate([t.property()],P.prototype,"container",void 0);r.__decorate([t.property()],P.prototype,"moving",void 0);r.__decorate([t.property({readOnly:!0})],P.prototype,"spatialReferenceSupported",null);r.__decorate([t.property({readOnly:!0})],P.prototype,"updateParameters",void 0);r.__decorate([t.property()],P.prototype,"updateRequested",void 0);
r.__decorate([t.property()],P.prototype,"updating",null);r.__decorate([t.property()],P.prototype,"view",void 0);r.__decorate([t.property({readOnly:!0})],P.prototype,"visibleAtCurrentScale",null);return P=r.__decorate([q.subclass("esri.views.2d.layers.LayerView2D")],P)};Object.defineProperty(x,"__esModule",{value:!0})})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/set ../../../core/accessorSupport/decorators/subclass".split(" "),
function(x,N,r,y,v,A,B,t,E){r=function(u){function g(){return u.apply(this,arguments)||this}x._inheritsLoose(g,u);return g}(r.JSONSupport);return r=N.__decorate([E.subclass("esri.views.layers.support.ClipArea")],r)})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(x,N,r,y,v,A,B,t){var E;y=E=function(u){function g(){var q=u.apply(this,arguments)||this;q.type="rect";q.left=null;q.right=null;q.top=null;q.bottom=null;return q}x._inheritsLoose(g,u);g.prototype.clone=function(){return new E({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};x._createClass(g,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return g}(t);N.__decorate([r.property({type:[Number,String],json:{write:!0}})],y.prototype,"left",void 0);N.__decorate([r.property({type:[Number,
String],json:{write:!0}})],y.prototype,"right",void 0);N.__decorate([r.property({type:[Number,String],json:{write:!0}})],y.prototype,"top",void 0);N.__decorate([r.property({type:[Number,String],json:{write:!0}})],y.prototype,"bottom",void 0);N.__decorate([r.property({readOnly:!0})],y.prototype,"version",null);return y=E=N.__decorate([B.subclass("esri.views.layers.support.ClipRect")],y)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(x,N,r,y,v,A,B,t,E,u,g,q,H){var U;r={base:E,key:"type",typeMap:{extent:q,polygon:H}};g=U=function(Q){function p(){var G=Q.apply(this,arguments)||this;G.type="geometry";G.geometry=null;return G}x._inheritsLoose(p,Q);p.prototype.clone=function(){return new U({geometry:this.geometry.clone()})};x._createClass(p,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return p}(g);N.__decorate([y.property({types:r,json:{read:u.fromJSON,write:!0}})],g.prototype,"geometry",void 0);N.__decorate([y.property({readOnly:!0})],
g.prototype,"version",null);return g=U=N.__decorate([t.subclass("esri.views.layers.support.Geometry")],g)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(x,N,r,y,v,A,B,t){y=function(E){function u(){var g=E.apply(this,
arguments)||this;g.type="path";g.path=[];return g}x._inheritsLoose(u,E);x._createClass(u,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return u}(t);N.__decorate([r.property({type:[[[Number]]],json:{write:!0}})],y.prototype,"path",void 0);N.__decorate([r.property({readOnly:!0})],y.prototype,"version",null);return y=N.__decorate([B.subclass("esri.views.layers.support.Path")],y)})},"esri/views/2d/layers/imagery/ImageryTileView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../engine/imagery/RasterTileContainer ./BaseImageryTileSubView2D ../support/util".split(" "),
function(x,N,r,y,v,A,B,t,E,u,g){v=function(q){function H(){var Q=q.apply(this,arguments)||this;Q.container=null;Q.layer=null;Q.type="raster";return Q}x._inheritsLoose(H,q);var U=H.prototype;U.attach=function(){q.prototype.attach.call(this);this.container=new E.RasterTileContainer(this._tileInfoView);this.container.isCustomTilingScheme=this._isCustomTilingScheme};U.detach=function(){q.prototype.detach.call(this);this.container.removeAllChildren();this.container=null};U.canUseWebGLForProcessing=function(){return this.useWebGLForProcessing&&
this.layer.symbolizer.canRenderInWebGL&&!("majority"===this.layer.interpolation&&g.canUseMajorityInterpolationOnDataSource(this.layer))};U.fetchTile=function(Q,p){return this.layer.fetchTile(Q.level,Q.row,Q.col,p)};U.updateTileSource=function(){var Q=x._asyncToGenerator(function*(p,G){const {bandIds:C}=this.layer,P=this._getLayerInterpolation(),T=this.canUseWebGLForProcessing(),{source:X,symbolizerParams:W,globalSymbolizerParams:f,suspended:b,coords:c,resolution:e}=G;({bitmap:p}=p);[p.x,p.y]=c;p.resolution=
e;X&&r.isSome(X)&&r.isSome(X.pixelBlock)?(G={extent:X.extent,pixelBlock:X.pixelBlock},p.rawPixelData=G,T?(p.source=X.pixelBlock,p.isRendereredSource=!1):(G=yield this.layer.applyRenderer(G,"stretch"===(null==f?void 0:f.type)?f:null),p.source=G,p.isRendereredSource=!0),p.symbolizerParameters=T?W:null,T?p.transformGrid||(p.transformGrid=X.transformGrid):p.transformGrid=null):(G=this.createEmptyTilePixelBlock(),p.source=G,p.symbolizerParameters=T?W:null,p.transformGrid=null);p.bandIds=T?C:null;p.width=
this._tileInfoView.tileInfo.size[0];p.height=this._tileInfoView.tileInfo.size[1];p.interpolation=P;p.suspended=b;p.invalidateTexture()});return function(p,G){return Q.apply(this,arguments)}}();U.updateTileSymbolizerParameters=function(){var Q=x._asyncToGenerator(function*(p,G){const {local:C,global:P}=G;({bandIds:G}=this.layer);const T=this._getLayerInterpolation(),X=this.canUseWebGLForProcessing();({bitmap:p}=p);const {rawPixelData:W}=p;!X&&r.isSome(W)?(p.source=yield this.layer.applyRenderer(W,
"stretch"===(null==P?void 0:P.type)?P:null),p.isRendereredSource=!0):(p.isRendereredSource&&r.isSome(W)&&(p.source=W.pixelBlock),p.isRendereredSource=!1);p.symbolizerParameters=X?P||C:null;p.bandIds=X?G:null;p.interpolation=T;p.suspended=!1});return function(p,G){return Q.apply(this,arguments)}}();U._getLayerInterpolation=function(){var Q=this.layer.renderer.type;if("raster-colormap"===Q||"unique-value"===Q||"class-breaks"===Q)return"nearest";({interpolation:Q}=this.layer);const {renderer:p}=this.layer;
return"raster-stretch"===p.type&&null!=p.colorRamp?"bilinear"===Q||"cubic"===Q?"bilinear":"nearest":Q};return H}(u.BaseImageryTileSubView2D);N.__decorate([y.property()],v.prototype,"container",void 0);N.__decorate([y.property()],v.prototype,"layer",void 0);N.__decorate([y.property()],v.prototype,"type",void 0);return v=N.__decorate([t.subclass("esri.views.2d.layers.imagery.ImageryTileView2D")],v)})},"esri/views/2d/engine/imagery/RasterTileContainer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry/support/aaBoundingRect ../../viewpointUtils ../brushes ./RasterTile ../webgl/enums ../webgl/TileContainer".split(" "),
function(x,N,r,y,v,A,B,t){t=function(E){function u(){var q=E.apply(this,arguments)||this;q.isCustomTilingScheme=!1;return q}N._inheritsLoose(u,E);var g=u.prototype;g.createTile=function(q){const H=this._getTileBounds(q),[U,Q]=this._tileInfoView.tileInfo.size;return new A.RasterTile(q,H[0],H[3],U,Q)};g.prepareRenderPasses=function(q){const H=q.registerRenderPass({name:"imagery (tile)",brushes:[v.brushes.raster],target:()=>this.children.map(U=>U.bitmap),drawPhase:B.WGLDrawPhase.MAP});return[...E.prototype.prepareRenderPasses.call(this,
q),H]};g.doRender=function(q){this.visible&&q.drawPhase===B.WGLDrawPhase.MAP&&E.prototype.doRender.call(this,q)};g._getTileBounds=function(q){const H=this._tileInfoView.getTileBounds(r.create(),q);if(this.isCustomTilingScheme&&q.world){var {tileInfo:U}=this._tileInfoView,Q=y.getWorldWidth(U.spatialReference);if(Q){const {resolution:p}=U.lodAt(q.level);U=(Q=Q/p%U.size[0])?(U.size[0]-Q)*p:0;H[0]-=U*q.world;H[2]-=U*q.world}}return H};return u}(t.default);x.RasterTileContainer=t;Object.defineProperty(x,
"__esModule",{value:!0})})},"esri/views/2d/engine/imagery/RasterTile":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/mat3f32","./RasterBitmap","../webgl/TiledDisplayObject"],function(x,N,r,y,v){v=function(A){function B(E,u,g,q,H,U=null){var Q=A.call(this,E,u,g,q,H)||this;Q.bitmap=new y.RasterBitmap(U,null,null);Q.bitmap.coordScale=[q,H];Q.bitmap.once("isReady",()=>Q.ready());return Q}N._inheritsLoose(B,A);var t=B.prototype;t.destroy=function(){A.prototype.destroy.call(this);
this.bitmap.destroy();this.stage=this.bitmap=null};t.setTransform=function(E,u){A.prototype.setTransform.call(this,E,u);this.bitmap.transforms.dvs=this.transforms.dvs};t._createTransforms=function(){return{dvs:r.create(),tileMat3:r.create()}};t.onAttach=function(){this.bitmap.stage=this.stage};t.onDetach=function(){this.bitmap.stage=null};N._createClass(B,[{key:"stencilRef",get:function(){return this.bitmap.stencilRef},set:function(E){this.bitmap.stencilRef=E}}]);return B}(v.TiledDisplayObject);x.RasterTile=
v;Object.defineProperty(x,"__esModule",{value:!0})})},"esri/views/2d/layers/imagery/BaseImageryTileSubView2D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/HandleOwner ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Point ../../../../layers/support/PixelBlock ../../../../layers/support/TileInfo ../../../../layers/support/rasterDatasets/RawBlockCache ../../../../layers/support/rasterFunctions/pixelUtils ../../../../layers/support/rasterFunctions/rasterProjectionHelper ../../tiling/PagedTileQueue ../../tiling/TileInfoView ../../tiling/TileKey ../../tiling/TileQueue ../../tiling/TileStrategy ../../../webgl/capabilities ../../../../geometry/Extent".split(" "),
function(x,N,r,y,v,A,B,t,E,u,g,q,H,U,Q,p,G,C,P,T,X,W,f,b,c,e){const k=[0,0],n=A.getLogger("esri.views.2d.layers.ImageryTileLayerView2D");x.BaseImageryTileSubView2D=function(w){function I(){var l=w.apply(this,arguments)||this;l._emptyTilePixelBlock=null;l._tileStrategy=null;l._tileInfoView=null;l._fetchQueue=null;l._blockCacheRegistryUrl=null;l._blockCacheRegistryId=null;l._srcResolutions=null;l.previousLOD=null;l._needBlockCacheUpdate=!1;l._globalSymbolizerParams=null;l._symbolizerParams=null;l._abortController=
null;l._isCustomTilingScheme=!1;l._globalUpdateRequested=!1;l.attached=!1;l.container=null;l.layer=null;l.timeExtent=null;l.redrawOrRefetch=t.debounce((D,M)=>!l.previousLOD||l.layerView.suspended?Promise.resolve():D?l.doRefresh():l._redrawImage(M));return l}N._inheritsLoose(I,w);var R=I.prototype;R.update=function(l){this._fetchQueue.pause();this._fetchQueue.state=l.state;this._tileStrategy.update(l);this._fetchQueue.resume();const {extent:D,resolution:M,scale:S}=l.state;l=this._tileInfoView.getClosestInfoForScale(S);
if(this.layer.raster){var O;if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){const Y=this._srcResolutions[l.level],a=D.toJSON?D:e.fromJSON(D);G.update(this._blockCacheRegistryUrl,this._blockCacheRegistryId,a,M,Y,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1;(null==(O=this.previousLOD)?void 0:O.level)!==l.level&&(this.previousLOD=l,null==this._symbolizerParams||this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}};R.moveEnd=
function(){if(this.layerView.hasTilingEffects||!this.useProgressiveUpdate)this._abortController&&this._abortController.abort(),this._abortController=new AbortController,0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then(()=>{this._globalUpdateRequested=!1;this.layerView.requestUpdate()});const l=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(l);this.layerView.requestUpdate()};R.attach=function(){c.getWebGL1Capabilities().supportsTextureFloat||
(this.useWebGLForProcessing=!1);this._initializeTileInfo();this._tileInfoView=new X(this.layerView.tileInfo,this.layerView.fullExtent);var l=this._computeFetchConcurrency();this._fetchQueue=new f({tileInfoView:this._tileInfoView,concurrency:l,process:(D,M)=>this._fetchTile1(D,M)});l=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new b({cachePolicy:"purge",acquireTile:D=>this.acquireTile(D),releaseTile:D=>this.releaseTile(D),cacheSize:l,tileInfoView:this._tileInfoView});this._updateBlockCacheRegistry()};
R.detach=function(){this._tileStrategy.destroy();this._fetchQueue.clear();this.container.removeAllChildren();this._fetchQueue=this._tileStrategy=this._tileInfoView=null;G.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId);this._blockCacheRegistryUrl=this._blockCacheRegistryId=null};R.acquireTile=function(l){l=this.container.createTile(l);this._enqueueTileFetch(l);this.layerView.requestUpdate();this._needBlockCacheUpdate=!0;this._globalUpdateRequested=this.layerView.hasTilingEffects||
!this.useProgressiveUpdate;return l};R.releaseTile=function(l){this._fetchQueue.abort(l.key.id);this.container.removeChild(l);l.once("detach",()=>{l.destroy();this.layerView.requestUpdate()});this.layerView.requestUpdate()};R.createEmptyTilePixelBlock=function(l=null){const D=null==l||l.join(",")===this._tileInfoView.tileInfo.size.join(",");if(D&&B.isSome(this._emptyTilePixelBlock))return this._emptyTilePixelBlock;l=l||this._tileInfoView.tileInfo.size;const [M,S]=l;l=new Q({width:M,height:S,pixels:[new Uint8Array(M*
S)],mask:new Uint8Array(M*S),pixelType:"u8"});D&&(this._emptyTilePixelBlock=l);return l};R._fetchTile1=function(l,D){D=!B.isNone(D)&&D.signal;const M=this.canUseWebGLForProcessing(),{layerView:S}=this,O=!S.tileInfo.isWrappable&&B.isSome(P.getWorldWidth(S.view.spatialReference));D={allowPartialFill:!0,datumTransformation:S.datumTransformation,interpolation:M?"nearest":this.layer.interpolation,registryId:this._blockCacheRegistryId,requestRawData:M,signal:B.unwrap(D),srcResolution:this._srcResolutions[l.level],
timeExtent:S.timeExtent,tileInfo:S.tileInfo,disableWrapAround:O};return this.fetchTile(l,D)};R._getCacheSize=function(l){return l?40:0};R._initializeTileInfo=function(){var l=this.layerView.view.spatialReference;const D=new U({x:this.layerView.fullExtent.xmin,y:this.layerView.fullExtent.ymax,spatialReference:l}),{scales:M,srcResolutions:S,isCustomTilingScheme:O}=P.computeProjectedScales(this.layer.rasterInfo,l);l=p.create({spatialReference:l,size:512,scales:M});if(0===l.origin.x||l.origin.x>D.x)l.origin=
D;this._isCustomTilingScheme=O;this.layerView.set("tileInfo",l);this._srcResolutions=null!=S?S:[]};R._computeFetchConcurrency=function(){var {blockBoundary:l}=this.layer.rasterInfo.storageInfo;l=l[l.length-1];return 64<(l.maxCol-l.minCol+1)*(l.maxRow-l.minRow+1)?2:10};R._enqueueTileFetch=function(){var l=N._asyncToGenerator(function*(D,M){if(!this._fetchQueue.has(D.key.id)){try{const S=yield this._fetchQueue.push(D.key),{bandIds:O}=this.layer;let Y=!this.useProgressiveUpdate||this.layerView.hasTilingEffects&&
!this._globalSymbolizerParams;if(this._globalUpdateRequested&&!this.layerView.moving&&0===this._fetchQueue.length){Y=!1;try{yield this._redrawImage(this._abortController&&this._abortController.signal)}catch(h){t.isAbortError(h)&&n.error(h)}this._globalUpdateRequested=!1}!this.canUseWebGLForProcessing()&&"rasterVF"!==this.type||this.layerView.hasTilingEffects||null!=this._symbolizerParams||this._updateSymbolizerParams();const a=this._tileInfoView.getTileCoords(k,D.key),d=this._tileInfoView.getTileResolution(D.key);
yield this.updateTileSource(D,{source:S,symbolizerParams:this._symbolizerParams,globalSymbolizerParams:this._globalSymbolizerParams,suspended:Y,bandIds:O,coords:a,resolution:d});D.once("attach",()=>this.layerView.requestUpdate());this.container.addChild(D)}catch(S){t.isAbortError(S)||n.error(S)}this.layerView.requestUpdate()}});return function(D,M){return l.apply(this,arguments)}}();R._redrawImage=function(){var l=N._asyncToGenerator(function*(D){var M=this;0!==this.container.children.length&&(yield this.updatingHandles.addPromise(this.layer.updateRenderer()),
this.layerView.hasTilingEffects?yield this._updateGlobalSymbolizerParams(D):(this._updateSymbolizerParams(),this._globalSymbolizerParams=null),D=this.container.children.map(function(){var S=N._asyncToGenerator(function*(O){return M.updateTileSymbolizerParameters(O,{local:M._symbolizerParams,global:M._globalSymbolizerParams})});return function(O){return S.apply(this,arguments)}}()),yield t.eachAlways(D),this.container.requestRender())});return function(D){return l.apply(this,arguments)}}();R._updateGlobalSymbolizerParams=
function(){var l=N._asyncToGenerator(function*(D){(D=yield this.layer.fetchPixels(this.layerView.view.extent,this.layerView.view.width,this.layerView.view.height,{srcResolution:this._srcResolutions[this.previousLOD.level],registryId:this._blockCacheRegistryId,signal:D}))&&D.pixelBlock&&(D=this.layer.symbolizer.generateWebGLParameters({pixelBlock:C.extractBands(D.pixelBlock,this.layer.bandIds),isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:this.previousLOD.resolution,y:this.previousLOD.resolution},
bandIds:this.layer.bandIds}),!this.canUseWebGLForProcessing()&&D&&"stretch"===D.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(D.factor=D.factor.map(M=>255*M),D.outMin=Math.round(255*D.outMin),D.outMax=Math.round(255*D.outMax)),this._globalSymbolizerParams=D)});return function(D){return l.apply(this,arguments)}}();R._updateSymbolizerParams=function(){this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.layerView.view.spatialReference.isGeographic,
resolution:{x:this.previousLOD.resolution,y:this.previousLOD.resolution},bandIds:this.layer.bandIds})};R._updateBlockCacheRegistry=function(l=!1){const {url:D,rasterInfo:M,raster:S}=this.layer;var {multidimensionalDefinition:O}=this.layer.normalizeRasterFetchOptions({multidimensionalDefinition:this.layer.multidimensionalDefinition,timeExtent:this.layerView.timeExtent});O=null!=M&&M.multidimensionalInfo?S.getSliceIndex(O):null;O=G.getRasterId(D,O);O!==this._blockCacheRegistryUrl&&(null!=this._blockCacheRegistryUrl&&
G.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=G.register(O,this.layer.raster.rasterInfo),l&&(l=this._tileInfoView.getClosestInfoForScale(this.layerView.view.scale),G.update(O,this._blockCacheRegistryId,this.layerView.view.extent,this.layerView.view.resolution,this._srcResolutions[l.level],this.layer.raster.ioConfig.sampling)),this._blockCacheRegistryUrl=O)};R.doRefresh=function(){var l=N._asyncToGenerator(function*(){yield this.updatingHandles.addPromise(this.layer.updateRenderer());
this.layerView.hasTilingEffects||this._updateSymbolizerParams();this._updateBlockCacheRegistry(!0);this._fetchQueue.reset();const D=[];this._tileStrategy.tiles.forEach(M=>D.push(this._enqueueTileFetch(M)));yield t.eachAlways(D)});return function(){return l.apply(this,arguments)}}();N._createClass(I,[{key:"useWebGLForProcessing",get:function(){var l;return null!=(l=this._get("useWebGLForProcessing"))?l:!0},set:function(l){this._set("useWebGLForProcessing",l)}},{key:"useProgressiveUpdate",get:function(){return null==
this._get("useProgressiveUpdate")?!0:this._get("useProgressiveUpdate")},set:function(l){if(this._tileStrategy&&this.useProgressiveUpdate!==l){this._tileStrategy.destroy();this.container.removeAllChildren();const D=this._getCacheSize(l);this._tileStrategy=new b({cachePolicy:"purge",acquireTile:M=>this.acquireTile(M),releaseTile:M=>this.releaseTile(M),cacheSize:D,tileInfoView:this._tileInfoView});this._set("useProgressiveUpdate",l);this.layerView.requestUpdate()}}},{key:"updating",get:function(){return this._fetchQueue.updating||
this._globalUpdateRequested||!(!this.updatingHandles||!this.updatingHandles.updating)}}]);return I}(v.HandleOwner);r.__decorate([E.property()],x.BaseImageryTileSubView2D.prototype,"_fetchQueue",void 0);r.__decorate([E.property()],x.BaseImageryTileSubView2D.prototype,"_globalUpdateRequested",void 0);r.__decorate([E.property()],x.BaseImageryTileSubView2D.prototype,"attached",void 0);r.__decorate([E.property()],x.BaseImageryTileSubView2D.prototype,"container",void 0);r.__decorate([E.property()],x.BaseImageryTileSubView2D.prototype,
"layer",void 0);r.__decorate([E.property()],x.BaseImageryTileSubView2D.prototype,"layerView",void 0);r.__decorate([E.property()],x.BaseImageryTileSubView2D.prototype,"type",void 0);r.__decorate([E.property()],x.BaseImageryTileSubView2D.prototype,"useWebGLForProcessing",null);r.__decorate([E.property()],x.BaseImageryTileSubView2D.prototype,"useProgressiveUpdate",null);r.__decorate([E.property()],x.BaseImageryTileSubView2D.prototype,"timeExtent",void 0);r.__decorate([E.property()],x.BaseImageryTileSubView2D.prototype,
"updating",null);x.BaseImageryTileSubView2D=r.__decorate([H.subclass("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")],x.BaseImageryTileSubView2D);Object.defineProperty(x,"__esModule",{value:!0})})},"esri/layers/support/rasterDatasets/RawBlockCache":function(){define("exports ../../../geometry ../../../core/maybe ./EphemeralBlockCache ../rasterFunctions/rasterProjectionHelper ../../../geometry/Point".split(" "),function(x,N,r,y,v,A){function B(u,g){if(!t.has(u))return null;u=t.get(u);return null==
u[g]?null:u[g]}const t=new Map,E=new y;x.decreaseRefCount=function(u,g,q){if(!t.has(u))return null==g?E.decreaseRefCount(u,q):0;const H=t.get(u);if(null==H[g])return E.decreaseRefCount(u,q);g=H[g].cache;if(g.has(q)){u=g.get(q);u.refCount--;if(0===u.refCount){g.delete(q);for(g=0;g<H.length;g++)H[g]&&H[g].cache.has(q)&&H[g].cache.delete(q);u.controller&&u.controller.abort()}return u.refCount}return 0};x.deleteBlock=function(u,g,q){if(t.has(u)){var H=t.get(u);null==H[g]?E.deleteBlock(u,q):H[g].cache.delete(q)}else null==
g&&E.deleteBlock(u,q)};x.deleteRaster=function(u){t.delete(u)};x.getBlock=function(u,g,q){if(!t.has(u))return null==g?E.getBlock(u,q):null;var H=t.get(u);if(null==H[g]){for(g=0;g<H.length;g++)if(H[g]&&H[g].cache.has(q))return q=H[g].cache.get(q),q.refCount++,q.block;return E.getBlock(u,q)}u=H[g].cache;if(u.has(q))return q=u.get(q),q.refCount++,q.block;for(let U=0;U<H.length;U++)if(U!==g&&H[U]&&H[U]&&H[U].cache.has(q))return H=H[U].cache.get(q),H.refCount++,u.set(q,H),H.block;return null};x.getRasterId=
function(u,g){return null==g?u:`${u}?sliceId=${g}`};x.putBlock=function(u,g,q,H,U=null){if(t.has(u)){var Q=t.get(u);if(null==Q[g])E.putBlock(u,q,H,U);else{var p={refCount:1,block:H,isResolved:!1,isRejected:!1,controller:U};H.then(()=>p.isResolved=!0).catch(()=>p.isRejected=!0);Q[g].cache.set(q,p)}}else null==g&&E.putBlock(u,q,H,U)};x.register=function(u,g){g={extent:null,rasterInfo:g,cache:new Map};if(t.has(u))return u=t.get(u),u.push(g),u.length-1;t.set(u,[g]);return 0};x.unregister=function(u,g){if(t.has(u)){const q=
t.get(u);q[g]=null;q.some(H=>null!=H)||t.delete(u)}};x.update=function(u,g,q,H,U,Q,p=null){u=B(u,g);g=u.extent;const {cache:G,rasterInfo:C}=u;if(!g||g.xmin!==q.xmin||g.xmax!==q.xmax||g.ymin!==q.ymin||g.ymax!==q.ymax){g=q.clone().normalize();var {spatialReference:P,transform:T}=C,X=new Set;for(let k=0;k<g.length;k++){var W=g[k];if(W.xmax-W.xmin<=H||W.ymax-W.ymin<=H)continue;var f=v.projectExtent(W,P,p);r.isSome(T)&&(f=T.inverseTransform(f));var b=new A({x:H,y:H,spatialReference:W.spatialReference});
if(null==U&&(U=v.projectResolution(b,P,W,p),!U))return;const {pyramidLevel:n,pyramidResolution:w,excessiveReading:I}=v.snapPyramid(U,C,Q||"closest");if(I)return;({storageInfo:W}=C);var {origin:c}=W;b=Math.max(0,Math.floor((f.xmin-c.x)/w.x));c=Math.max(0,Math.floor((c.y-f.ymax)/w.y));const R=0<n?W.pyramidBlockWidth:W.blockWidth,l=0<n?W.pyramidBlockHeight:W.blockHeight;W=Math.max(0,Math.floor(b/R)-1);var e=Math.max(0,Math.floor(c/l)-1);b=Math.floor((b+Math.ceil((f.xmax-f.xmin)/w.x-.1)-1)/R)+1;f=Math.floor((c+
Math.ceil((f.ymax-f.ymin)/w.y-.1)-1)/l)+1;for(c=e;c<=f;c++)for(e=W;e<=b;e++)X.add(`${n}/${c}/${e}`)}G.forEach((k,n)=>{X.has(n)||(k=G.get(n),(null==k||k.isResolved||k.isRejected)&&G.delete(n))});u.extent={xmin:q.xmin,ymin:q.ymin,xmax:q.xmax,ymax:q.ymax}}};Object.defineProperty(x,"__esModule",{value:!0})})},"esri/layers/support/rasterDatasets/EphemeralBlockCache":function(){define(function(){return function(){function x(r=15E3,y=5E3){this._timer=null;this._cachedBlocks=new Map;this._size=-1;this._duration=
r;this._interval=Math.min(r,y)}var N=x.prototype;N.decreaseRefCount=function(r,y){r=r+"/"+y;y=this._cachedBlocks;if(y.has(r)){const v=y.get(r);v.refCount--;0>=v.refCount&&(y.delete(r),v.controller&&v.controller.abort());return v.refCount}return 0};N.getBlock=function(r,y){r=r+"/"+y;y=this._cachedBlocks;if(y.has(r)){const v=y.get(r);v.ts=Date.now();v.refCount++;y.delete(r);y.set(r,v);return v.block}return null};N.putBlock=function(r,y,v,A=null){const B=this._cachedBlocks;r=r+"/"+y;B.has(r)?(v=B.get(r),
v.ts=Date.now(),v.refCount++):B.set(r,{block:v,ts:Date.now(),refCount:1,controller:A});this._trim();this._updateTimer()};N.deleteBlock=function(r,y){const v=this._cachedBlocks;r=r+"/"+y;v.has(r)&&v.delete(r)};N.updateMaxSize=function(r){this._size=r;this._trim()};N.empty=function(){this._cachedBlocks.clear();this._clearTimer()};N.getCurrentSize=function(){return this._cachedBlocks.size};N._updateTimer=function(){if(null==this._timer){var r=this._cachedBlocks;this._timer=setInterval(()=>{const y=Array.from(r),
v=Date.now();for(let A=0;A<y.length;A++)if(y[A][1].ts<=v-this._duration)r.delete(y[A][0]);else break;0===r.size&&this._clearTimer()},this._interval)}};N._trim=function(){const r=this._cachedBlocks;if(!(-1===this._size||this._size>=r.size)){var y=Array.from(r);for(let v=0;v<y.length-this._size;v++)r.delete(y[v][0])}};N._clearTimer=function(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)};return x}()})},"esri/layers/support/rasterFunctions/rasterProjectionHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../core/Error ../../../core/maybe ../../../core/unitUtils ../../../chunks/pe ../../../geometry/projection ../../../geometry/Extent ../../../geometry/Point ../../../geometry/SpatialReference".split(" "),
function(x,N,r,y,v,A,B,t,E,u,g){function q(a,d,h){return!t.canProjectWithoutEngine(a,d,h)}function H(a,d,h){if((a=q(a,d,h))&&!t.isLoaded())throw new y("rasterprojectionhelper-project","projection engine is not loaded");return a}function U(){U=N._asyncToGenerator(function*(){if(t.isLoaded())return null;yield t.load()});return U.apply(this,arguments)}function Q(a,d,h,m=null){const J=a.spatialReference;if(J.equals(d))return a;H(J,d,m);h=h.center;h=new E({xmin:h.x-a.x/2,xmax:h.x+a.x/2,ymin:h.y-a.y/2,
ymax:h.y+a.y/2,spatialReference:J});m=t.project(h,d,m);if(v.isNone(m))return null;m={x:m.xmax-m.xmin,y:m.ymax-m.ymin};h=n(d);v.isSome(h)&&m.x>=h&&(d=A.getMetersPerUnitForSR(J)/A.getMetersPerUnitForSR(d),m.x=a.x*d,m.y=a.y*d);return m}function p(a,d=.01){return A.getMetersPerUnitForSR(a)?d/A.getMetersPerUnitForSR(a):0}function G(a,d,h=null,m=!0){var J=a.spatialReference;if(J.equals(d))return a;H(J,d,h);h=t.project(a,d,h);if(!m||!h)return h;m=w(J,!0);d=w(d,!0);(J=p(J))&&v.isSome(m)&&v.isSome(d)&&(0<
h.x&&Math.abs(a.x-m[0])<J?h.x-=d[1]-d[0]:0>h.x&&Math.abs(a.x-m[1])<J&&(h.x+=d[1]-d[0]));return h}function C(a){const {inSR:d,outSR:h,datumTransformation:m,preferPE:J}=a;if(d.equals(h))return{points:a}=f(a,null),a;if(d.isWebMercator&&h.isWGS84||d.isWGS84&&h.isWebMercator){{const {cols:V,rows:Z,xres:aa,yres:ba,usePixelCenter:da,inSR:ea,outSR:fa}=a;let {xmin:ha,ymax:ca}=a;da&&(ha+=aa/2,ca-=ba/2);a=[];var K=[],z=Math.max(V,Z);for(var F=0;F<z;F++){var L=t.project(new u({x:ha+aa*Math.min(V,F),y:ca-ba*Math.min(Z,
F),spatialReference:ea}),fa);F<=V&&a.push(L.x);F<=Z&&K.push(L.y)}z=[];for(F=0;F<V;F++)for(L=0;L<Z;L++)z.push([a[F],K[L]]);a=z}return a}if(H(d,h,m)&&J){if(d.isGeographic)return T(a);K=X(d);if(v.isSome(K))return T(a)}return P(a)}function P(a){var {points:d}=f(a,null);d=d.map(h=>new u(h[0],h[1],a.inSR));return t.project(d,a.outSR,a.datumTransformation).map(h=>h?[h.x,h.y]:[NaN,NaN])}function T(a){const {inSR:d,outSR:h,datumTransformation:m}=a,J=X(d),{points:K,mask:z}=f(a,J);d.isGeographic||(a=d.wkid?
B.PeFactory.coordsys(d.wkid):B.PeFactory.fromString(d.isGeographic?B.PeDefs.PE_TYPE_GEOGCS:B.PeDefs.PE_TYPE_PROJCS,d.wkt),B.PeCSTransformations.projToGeog(a,K.length,K));v.isSome(m)&&m.steps.length&&m.steps.forEach(F=>{const L=F.wkid?B.PeFactory.geogtran(F.wkid):B.PeFactory.fromString(B.PeDefs.PE_TYPE_GEOGTRAN,F.wkt);B.PeGTTransformations.geogToGeog(L,K.length,K,null,F.isInverse?B.PeDefs.PE_TRANSFORM_2_TO_1:B.PeDefs.PE_TRANSFORM_1_TO_2)});h.isGeographic||(a=X(h,!0),a=v.isSome(a)&&a.isEnvelope?[a.bbox[1],
a.bbox[3]]:[-90,90],b(K,a),a=h.wkid?B.PeFactory.coordsys(h.wkid):B.PeFactory.fromString(h.isGeographic?B.PeDefs.PE_TYPE_GEOGCS:B.PeDefs.PE_TYPE_PROJCS,h.wkt),B.PeCSTransformations.geogToProj(a,K.length,K));a=K;if(z&&K.length!==z.length){a=[];for(let F=0,L=0;F<z.length;F++)z[F]?a.push(K[L++]):a.push([NaN,NaN])}return a}function X(a,d=!1){var h=a.wkid||a.wkt;if(!h||a.isGeographic)return null;h=String(h);if(O.has(h))return h=O.get(h),d?null==h?void 0:h.gcs:null==h?void 0:h.pcs;var m=a.wkid?B.PeFactory.coordsys(a.wkid):
B.PeFactory.fromString(a.isGeographic?B.PeDefs.PE_TYPE_GEOGCS:B.PeDefs.PE_TYPE_PROJCS,a.wkt);a=p(a,1E-4);a=W(m,a);m=W(m,0,!0);O.set(h,{pcs:a,gcs:m});return d?m:a}function W(a,d=0,h=!1){var m=B.PePCSInfo.generate(a),J=h?a.horizonGcsGenerate():a.horizonPcsGenerate();if(null==J||!J.length)return null;h=!1;a=J.find(V=>1===V.getInclusive()&&1===V.getKind());if(!a){a=J.find(V=>1===V.getInclusive()&&0===V.getKind());if(!a)return null;h=!0}m=m.isPannableRectangle();a=a.getCoord();if(h)return{isEnvelope:h,
isPannable:m,vertices:a,coef:null,bbox:[a[0][0]-d,a[0][1]-d,a[1][0]+d,a[1][1]+d]};d=0;h=[];let [K,z]=a[0],[F,L]=a[0];for(let V=0,Z=a.length;V<Z;V++){d++;d===Z&&(d=0);const [aa,ba]=a[V],[da,ea]=a[d];if(ea===ba)h.push([aa,da,ba,ea,2]);else{J=(da-aa)/(ea-ba||1E-4);const fa=aa-J*ba;ba<ea?h.push([J,fa,ba,ea,0]):h.push([J,fa,ea,ba,1])}K=K<aa?K:aa;z=z<ba?z:ba;F=F>aa?F:aa;L=L>ba?L:ba}return{isEnvelope:!1,isPannable:m,vertices:a,coef:h,bbox:[K,z,F,L]}}function f(a,d){const h=[],{cols:m,rows:J,xres:K,yres:z,
usePixelCenter:F}=a;let {xmin:L,ymax:V}=a;F&&(L+=K/2,V-=z/2);if(!v.isSome(d)){for(a=0;a<m;a++)for(d=0;d<J;d++)h.push([L+K*a,V-z*d]);return{points:h}}a=new Uint8Array(m*J);if(d.isEnvelope){const {bbox:[ha,ca,ia,ka]}=d;for(let la=0,ma=0;la<m;la++){var Z=L+K*la,aa=d.isPannable||Z>=ha&&Z<=ia;for(var ba=0;ba<J;ba++,ma++){var da=V-z*ba;aa&&da>=ca&&da<=ka&&(h.push([Z,da]),a[ma]=1)}}return{points:h,mask:a}}({coef:Z}=d);d=[];for(aa=0;aa<J;aa++){var ea=V-z*aa;ba=[];da=[];for(var fa=0;fa<Z.length;fa++){const [ha,
ca,ia,ka,la]=Z[fa];ea===ia&&ia===ka?(ba.push(ha),ba.push(ca),da.push(2),da.push(2)):ea>=ia&&ea<=ka&&(ba.push(ha*ea+ca),da.push(la))}ea=ba;if(2<ba.length){fa=2===da[0]?0:da[0];let ha=ba[0];ea=[];for(let ca=1;ca<da.length;ca++)if(2!==da[ca]||ca===da.length-1)da[ca]!==fa&&(ea.push(0===fa?Math.min(ha,ba[ca-1]):Math.max(ha,ba[ca-1])),fa=da[ca],ha=ba[ca]),ca===da.length-1&&ea.push(0===da[ca]?Math.min(ha,ba[ca]):Math.max(ha,ba[ca]));ea.sort((ca,ia)=>ca-ia)}else ba[0]>ba[1]&&(ea=[ba[1],ba[0]]);d.push(ea)}for(let ha=
0,ca=0;ha<m;ha++)for(Z=L+K*ha,aa=0;aa<J;aa++,ca++)if(ba=V-z*aa,da=d[aa],2===da.length)Z>=da[0]&&Z<=da[1]&&(h.push([Z,ba]),a[ca]=1);else if(2<da.length){ea=!1;for(fa=0;fa<da.length;fa+=2)if(Z>=da[fa]&&Z<=da[fa+1]){ea=!0;break}ea&&(h.push([Z,ba]),a[ca]=1)}return{points:h,mask:a}}function b(a,d){const [h,m]=d;for(d=0;d<a.length;d++){const J=a[d][1];if(J<h||J>m)a[d]=[NaN,NaN]}}function c(a){const d=n(a[0].spatialReference);if(2>a.length||!v.isSome(d))return a[0];let {xmin:h,xmax:m,ymin:J,ymax:K}=a[0];
for(let z=1;z<a.length;z++){const F=a[z];m=F.xmax+d*z;J=Math.min(J,F.ymin);K=Math.max(K,F.ymax)}return new E({xmin:h,xmax:m,ymin:J,ymax:K,spatialReference:a[0].spatialReference})}function e(a,d,h=null,m=!0){if(a.spatialReference.equals(d))return a;const J=R(a),K=n(a.spatialReference,!0);var z=n(d);if(0===J||v.isNone(K)||v.isNone(z))return k(a,d,h,m);z=a.clone().normalize();if(1===z.length&&a.xmax<K&&a.xmax-K/2>p(a.spatialReference)){const {xmin:F,xmax:L}=a;for(let V=0;V<=J;V++)z[V]=new E({xmin:0===
V?F:-K/2,xmax:V===J?L-K*V:K/2,ymin:a.ymin,ymax:a.ymax,spatialReference:a.spatialReference})}a=z.map(F=>k(F,d,h,m));return c(a.filter(F=>!!F))}function k(a,d,h=null,m=!0,J=!0){const K=a.spatialReference;if(K.equals(d))return a;H(K,d,h);const z=t.project(a,d,h);if(J&&d.isWebMercator&&z&&(z.ymax=Math.min(2.0037508342787E7,z.ymax),z.ymin=Math.max(-2.0037508342787E7,z.ymin),z.ymin>=z.ymax))return null;if(!m||!z)return z;var F=w(K,!0);m=w(d,!0);if(v.isNone(F)||v.isNone(m))return z;J=p(K,.001);const L=p(K,
500);var V=p(d,.001);if(Math.abs(z.xmin-m[0])<V&&Math.abs(z.xmax-m[1])<V){V=Math.abs(a.xmin-F[0]);F=Math.abs(F[1]-a.xmax);if(V<J&&F>L){z.xmin=m[0];var Z=[];Z.push(new u(a.xmax,a.ymin,K));Z.push(new u(a.xmax,(a.ymin+a.ymax)/2,K));Z.push(new u(a.xmax,a.ymax,K));Z=Z.map(aa=>G(aa,d,h)).filter(aa=>!isNaN(null==aa?void 0:aa.x)).map(aa=>aa.x);z.xmax=Math.max.apply(null,Z)}F<J&&V>L&&(z.xmax=m[1],m=[],m.push(new u(a.xmin,a.ymin,K)),m.push(new u(a.xmin,(a.ymin+a.ymax)/2,K)),m.push(new u(a.xmin,a.ymax,K)),a=
m.map(aa=>G(aa,d,h)).filter(aa=>!isNaN(null==aa?void 0:aa.x)).map(aa=>aa.x),z.xmin=Math.min.apply(null,a))}else a=p(d,.001),Math.abs(z.xmin-m[0])<a&&(z.xmin=m[0]),Math.abs(z.xmax-m[1])<a&&(z.xmax=m[1]);return z}function n(a,d=!1){return a.isWebMercator?2*(d?2.0037508342787E7:2.0037508342788905E7):a.wkid&&a.isGeographic?360:2*S[a.wkid]||null}function w(a,d=!1){if(a.isGeographic)return[-180,180];a=n(a,d);return v.isSome(a)?[-a/2,a/2]:null}function I(a,d,h,m){a=(a-d)/h;0!==a-Math.floor(a)?a=Math.floor(a):
m&&--a;return a}function R(a,d=!1){var h=n(a.spatialReference);if(!v.isSome(h))return 0;const m=d?0:-(h/2),J=p(a.spatialReference),K=!d&&Math.abs(a.xmin+h/2)<J?-h/2:a.xmin;a=I(!d&&Math.abs(a.xmax-h/2)<J?h/2:a.xmax,m,h,!0);h=I(K,m,h,!1);return a-h}function l(a){const {projectedExtent:d,srcBufferExtent:h,pixelSize:m,datumTransformation:J,rasterTransform:K}=a;var z=d.spatialReference;const F=h.spatialReference;H(z,F);const {xmin:L,ymin:V,xmax:Z,ymax:aa}=d,ba=n(F),da=v.isSome(ba)&&(a.hasWrapAround||"gcs-shift"===
(null==K?void 0:K.type));a=a.spacing||[32,32];var ea=a[0]*m.x,fa=a[1]*m.y;const ha=1===a[0],ca=Math.ceil((Z-L)/ea-.1/a[0])+(ha?0:1),ia=Math.ceil((aa-V)/fa-.1/a[1])+(ha?0:1);z=C({cols:ca,rows:ia,xmin:L,ymax:aa,xres:ea,yres:fa,inSR:z,outSR:F,datumTransformation:J,preferPE:4>=a[0],usePixelCenter:ha});ea=[];let ka;fa=0;const la=ha?-1:NaN,{xmin:ma,xmax:qa,ymax:ra,width:sa,height:ta}=h,ua=p(F,500);for(let oa=0;oa<ca;oa++){const pa=[];for(let na=0;na<ia;na++){var ja=z[oa*ia+na];da&&ja[0]>qa&&ja[0]>ba/2-
ua&&(ja[0]-=ba);!ja||isNaN(ja[0])||isNaN(ja[1])?(ea.push(la),ea.push(la),pa.push(null),fa++):(K&&(ja=K.inverseTransform(new u({x:ja[0],y:ja[1],spatialReference:F})),ja=[ja.x,ja.y]),pa.push(ja),0<oa&&da&&ka[na]&&ja[0]<ka[na][0]&&(ja[0]+=ba),ea.push((ja[0]-ma)/sa),ea.push((ra-ja[1])/ta))}ka=pa}return{offsets:ea,error:null,coefficients:null,outofBoundPointCount:fa,spacing:a,size:ha?[ca,ia]:[ca-1,ia-1]}}function D(a,d,h){const {cols:m,rows:J}=d;d=new Float32Array((m-1)*(J-1)*12);const K=new Float32Array([-0,
-1,1,-1,1,-0,1,-0,-0]),z=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let ba=0;ba<m-1;ba++){for(var F=0;F<J-1;F++){var L=ba*J*2+2*F,V=a[L];const da=a[L+1];var Z=a[L+2],aa=a[L+3];L+=2*J;const ea=a[L],fa=a[L+1],ha=a[L+2];L=a[L+3];let ca=0,ia=12*(F*(m-1)+ba);for(let ka=0;3>ka;ka++)d[ia++]=K[ca++]*V+K[ca++]*Z+K[ca++]*ha;ca=0;for(Z=0;3>Z;Z++)d[ia++]=K[ca++]*da+K[ca++]*aa+K[ca++]*L;ca=0;for(aa=0;3>aa;aa++)d[ia++]=z[ca++]*V+z[ca++]*ea+z[ca++]*ha;ca=0;for(V=0;3>V;V++)d[ia++]=z[ca++]*da+z[ca++]*fa+z[ca++]*
L}if(h)for(F=0;F<d.length;F++)isNaN(d[F])&&(d[F]=-1)}return d}const M=function(a,d,h,m=0){if(1===h[0])return[0,0];var J=1,K=-1,z=1,F=-1;for(var L=0;L<a.length;L+=2)isNaN(a[L])||(J=J>a[L]?a[L]:J,K=K>a[L]?K:a[L],z=z>a[L+1]?a[L+1]:z,F=F>a[L+1]?F:a[L+1]);const {cols:V,rows:Z}=d;d=(K-J)/V/h[0];h=(F-z)/Z/h[1];m*=2;z=0;F=!1;J=[0,0];for(K=0;K<V-3;K++){for(L=0;L<Z-3;L++){var aa=K*Z*2+2*L;const ba=Math.abs(((a[aa]+a[aa+4]+a[aa+4*Z]+a[aa+4*Z+4])/4-a[aa+2*Z+2])/d);aa=Math.abs(((a[aa+1]+a[aa+5]+a[aa+4*Z+1]+a[aa+
4*Z+5])/4-a[aa+2*Z+3])/h);ba+aa>z&&(z=ba+aa,J=[ba,aa]);if(m&&z>m){F=!0;break}}if(F)break}return J},S={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53034:2.001508679602057E7,53079:2.0015114352186374E7,
53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54034:2.0037508342789244E7,54079:2.0037508342789244E7,54080:2.0037508342789244E7,54100:2.0037508342789244E7,54101:2.0037508342789244E7},O=new Map,Y=new Map;x.computeProjectedScales=function(a,d,h=512,m=!0){const {extent:J,spatialReference:K,pixelSize:z}=a,F=Q(new u({x:z.x,y:z.y,spatialReference:K}),d,J);if(null==
F)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};var L=(F.x+F.y)/2,V=A.getMetersPerUnitForSR(d);L=L*V*96*39.37;const Z=d.isGeographic?256/h*2.958287637958547E8:256/h*5.91657527591555E8;h="vector-magdir"===a.dataType||"vector-uv"===a.dataType;const aa=e(J,d);h||m&&(d.isGeographic||d.isWebMercator)&&(h=0>aa.xmin*aa.xmax);m=L;if(h)m=Z,a=d.isGeographic?1.341104507446289E-6:.29858214164761665,V=96*a*V*39.37,d=Q(new u({x:a,y:a,spatialReference:{wkid:d.isGeographic?
4326:3857}}),K,aa),d.x*=m/V,d.y*=m/V;else{d={x:z.x,y:z.y};a=Math.ceil(Math.log(Math.min(a.width,a.height)/32)/Math.LN2);for(V=0;m<.5005*Z&&V<a;)V++,m*=2,d.x*=2,d.y*=2;1.001>=Math.max(m,Z)/Math.min(m,Z)&&(m=Z)}a=[m];V=[{x:d.x,y:d.y}];for(L=Math.min(70.5310735,L)/1.001;m>=L;)m/=2,d.x/=2,d.y/=2,a.push(m),V.push({x:d.x,y:d.y});return{projectedPixelSize:F,scales:a,srcResolutions:V,isCustomTilingScheme:!h}};x.defaultGridSpacing=32;x.defaultProjectionToleranceInPixels=4;x.getDefaultDatumTransformationForDataset=
function(a,d,h){return H(a.spatialReference,d)?h?t.getTransformation(d,a.spatialReference,a):t.getTransformation(a.spatialReference,d,a):null};x.getProjectedGridPoints=C;x.getProjectionOffsetGrid=function(a){var d=a.isAdaptive&&null==a.spacing;let h=a.spacing||[32,32],m=l(a);var J={cols:m.size[0]+1,rows:m.size[1]+1};const K=0<m.outofBoundPointCount&&m.outofBoundPointCount<m.offsets.length/2;let z=m.outofBoundPointCount===m.offsets.length/2||d&&K?[0,0]:M(m.offsets,J,h,4);const F=(z[0]+z[1])/2;var L=
a.projectedExtent.spatialReference;const V=a.srcBufferExtent.spatialReference;d&&(K||4<F)&&(q(L,V,a.datumTransformation)&&(L.isGeographic||v.isSome(X(L))),h=[4,4],m=l({...a,spacing:h}),J={cols:m.size[0]+1,rows:m.size[1]+1},z=M(m.offsets,J,h,4));m.error=z;1<h[0]&&(m.coefficients=D(m.offsets,J,K));!a.includeGCSGrid||L.isGeographic||L.isWebMercator||(V.isGeographic?m.gcsGrid={offsets:m.offsets,coefficients:m.coefficients,spacing:h}:(d=X(L),v.isSome(d)&&!d.isEnvelope&&(L&&!L.isGeographic&&(d=String(L.wkid||
L.wkt),Y.has(d)?L=Y.get(d):(L=(L.wkid?B.PeFactory.coordsys(L.wkid):B.PeFactory.fromString(B.PeDefs.PE_TYPE_PROJCS,L.wkt)).getGeogcs().getCode(),Y.set(d,L)),L=new g({wkid:L})),L=e(a.projectedExtent,L),{offsets:a}=l({...a,srcBufferExtent:L,spacing:h}),J=D(a,J,K),m.gcsGrid={offsets:a,coefficients:J,spacing:h})));return m};x.getRasterDatasetAlignmentInfo=function(a){const d=a.storageInfo.origin.x;var h=n(a.spatialReference,!0);if(!v.isSome(h))return{originX:d,halfWorldWidth:null,pyramidsInfo:null};const m=
h/2,{nativePixelSize:J,storageInfo:K,extent:z}=a,{maximumPyramidLevel:F,blockWidth:L,pyramidScalingFactor:V}=K;let Z=J.x;const aa=[];a=v.isSome(a.transform)&&"gcs-shift"===a.transform.type;const ba=d+(a?0:m);h=a?h-d:m-d;for(let da=0;da<=F;da++){const ea=(z.xmax-d)/Z/L,fa=h/Z/L;aa.push({resolutionX:Z,blockWidth:L,datsetColumnCount:0===ea-Math.floor(ea)?ea:Math.ceil(ea),worldColumnCountFromOrigin:0===fa-Math.floor(fa)?fa:Math.ceil(fa),leftMargin:Math.round(ba/Z)%L,rightPadding:(L-Math.round(h/Z)%L)%
L,originColumnOffset:Math.floor(ba/Z/L)});Z*=V}return{originX:d,halfWorldWidth:m,pyramidsInfo:aa,hasGCSSShiftTransform:a}};x.getWorldWidth=n;x.getWorldWrapCount=R;x.load=function(){return U.apply(this,arguments)};x.minimumGridSpacing=4;x.projectExtent=e;x.projectPoint=G;x.projectResolution=Q;x.requirePE=q;x.snapExtent=function(a){a=a.clone().normalize();return 1===a.length?a[0]:c(a)};x.snapPyramid=function(a,d,h){const {storageInfo:m,pixelSize:J}=d;let K=!1;var {pyramidResolutions:z}=m;if(v.isSome(z)&&
z.length){a=(a.x+a.y)/2;var F=z[z.length-1];F=(F.x+F.y)/2;var L=(J.x+J.y)/2;if(a<=L)var V=0;else if(a>=F)V=z.length,K=8<a/F;else{F=L;for(let Z=1;Z<=z.length;Z++){L=(z[Z-1].x+z[Z-1].y)/2;if(a<=L){a===L?V=Z:"down"===h?(V=Z-1,K=8<a/F):V="up"===h?Z:a-F>L-a||2<a/F?Z:Z-1;break}F=L}}h=0===V?J:z[V-1];return{pyramidLevel:V,pyramidResolution:new u({x:h.x,y:h.y,spatialReference:d.spatialReference}),excessiveReading:K}}V=Math.log(a.x/J.x)/Math.LN2;a=Math.log(a.y/J.y)/Math.LN2;z=d.storageInfo.maximumPyramidLevel||
0;V="down"===h?Math.floor(Math.min(V,a)):"up"===h?Math.ceil(Math.max(V,a)):Math.round((V+a)/2);0>V?V=0:V>z&&(K=V>z+3,V=z);h=2**V;d=new u({x:h*d.nativePixelSize.x,y:h*d.nativePixelSize.y,spatialReference:d.spatialReference});return{pyramidLevel:V,pyramidResolution:d,excessiveReading:K}};Object.defineProperty(x,"__esModule",{value:!0})})},"esri/views/2d/layers/imagery/VectorFieldTileView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/rasterFunctions/vectorFieldUtils ../../engine/imagery/RasterVFTileContainer ./BaseImageryTileSubView2D".split(" "),
function(x,N,r,y,v,A,B,t,E,u,g,q){A=function(H){function U(){var p=H.apply(this,arguments)||this;p._handle=null;p.container=null;p.layer=null;p.type="rasterVF";return p}x._inheritsLoose(U,H);var Q=U.prototype;Q.canUseWebGLForProcessing=function(){return!1};Q.fetchTile=function(){var p=x._asyncToGenerator(function*(G,C){C={...C,interpolation:"nearest",requestProjectedLocalDirections:!0};G=yield this.layer.fetchTile(G.level,G.row,G.col,C);"vector-magdir"===this.layer.rasterInfo.dataType&&null!=G&&G.pixelBlock&&
(G.pixelBlock=yield this.layer.convertVectorFieldData(G.pixelBlock,C));return G});return function(G,C){return p.apply(this,arguments)}}();Q.updateTileSource=function(p,G){const C=G.symbolizerParams,{tileData:P}=p;P.key=p.key;P.width=this._tileInfoView.tileInfo.size[0];P.height=this._tileInfoView.tileInfo.size[1];({symbolTileSize:p}=C);({source:G}=G);P.offset=this._getTileSymbolOffset(P.key,p);r.isSome(G)&&r.isSome(G.pixelBlock)?(P.rawPixelData={extent:G.extent,pixelBlock:G.pixelBlock},P.symbolizerParameters=
C,P.source=this._sampleVectorFieldData(G.pixelBlock,C,P.offset)):(G=this.createEmptyTilePixelBlock([Math.round((this._tileInfoView.tileInfo[0]-P.offset[0])/p),Math.round((this._tileInfoView.tileInfo[1]-P.offset[1])/p)]),P.source=G,P.symbolizerParameters=C);P.invalidateVAO();return Promise.resolve(null)};Q.updateTileSymbolizerParameters=function(p,G){var C;G=G.local;const {symbolTileSize:P}=G;({tileData:p}=p);p.offset=this._getTileSymbolOffset(p.key,P);const T=p.symbolizerParameters.symbolTileSize;
p.symbolizerParameters=G;r.isSome(null==(C=p.rawPixelData)?void 0:C.pixelBlock)&&T!==P&&(p.source=this._sampleVectorFieldData(p.rawPixelData.pixelBlock,p.symbolizerParameters,p.offset));return Promise.resolve(null)};Q.attach=function(){H.prototype.attach.call(this);this.container=new g.RasterVFTileContainer(this._tileInfoView);this.container.isCustomTilingScheme=this._isCustomTilingScheme;this._updateSymbolType(this.layer.renderer);this._handle=y.watch(()=>this.layer.renderer,p=>this._updateSymbolType(p))};
Q.detach=function(){H.prototype.detach.call(this);this.container.removeAllChildren();this._handle.remove();this._handle=null};Q._getTileSymbolOffset=function(p,G){const C=p.col*this._tileInfoView.tileInfo.size[0]%G;p=p.row*this._tileInfoView.tileInfo.size[1]%G;return[C>G/2?G-C:-C,p>G/2?G-p:-p]};Q._sampleVectorFieldData=function(p,G,C){({symbolTileSize:G}=G);return u.sampleVectorField(p,"vector-uv",G,C)};Q._updateSymbolType=function(p){"vector-field"===p.type&&(this.container.symbolTypes="wind-barb"===
p.style?["scalar","triangle"]:"simple-scalar"===p.style?["scalar"]:["triangle"])};return U}(q.BaseImageryTileSubView2D);N.__decorate([v.property()],A.prototype,"container",void 0);N.__decorate([v.property()],A.prototype,"layer",void 0);N.__decorate([v.property()],A.prototype,"type",void 0);return A=N.__decorate([E.subclass("esri.views.2d.layers.imagery.VectorFieldTileView2D")],A)})},"esri/layers/support/rasterFunctions/vectorFieldUtils":function(){define(["exports","../../../core/jsonMap","../../../core/maybe",
"../PixelBlock","./pixelUtils"],function(x,N,r,y,v){function A(b,c){return p.get(b)/p.get(c)||1}function B(b,c="geographic"){const [e,k]=b;b=Math.sqrt(e*e+k*k);let n=Math.atan2(k,e)*G;n=(360+n)%360;"geographic"===c&&(n=(450-n)%360);return[b,n]}function t(b,c="geographic"){let e=b[1];"geographic"===c&&(e=(450-e)%360);e%=360;b=b[0];return[b*Math.cos(e/G),b*Math.sin(e/G)]}function E(b,c,e="geographic",k=1){if(!v.isValidPixelBlock(b))return b;const {pixels:n,width:w,height:I}=b;var R=w*I;const l=n[0],
D=n[1],M=b.pixelType.startsWith("f")?b.pixelType:"f32",S=y.createEmptyBand(M,R);R=y.createEmptyBand(M,R);let O=0;for(let Y=0;Y<I;Y++)for(let a=0;a<w;a++)"vector-uv"===c?([S[O],R[O]]=B([l[O],D[O]],e),S[O]*=k):([S[O],R[O]]=t([l[O],D[O]],e),S[O]*=k,R[O]*=k),O++;b=new y({pixelType:M,width:b.width,height:b.height,mask:b.mask,validPixelCount:b.validPixelCount,maskIsAlpha:b.maskIsAlpha,pixels:[S,R]});b.updateStatistics();return b}function u(b=0,c=Math.PI,e=!0){e&&(c=(2*Math.PI-c)%(2*Math.PI));var k=e?-1:
1;e=5*k;const n=20*k,w=25*k;k*=2;let [I,R]=[5,0-n],[l,D]=[I+2,R],[M,S]=[l-0,D+k],[O,Y]=[-5,0-w],[a,d]=[O+0,Y-k];b=Math.ceil(b/5);let h=Math.floor(b/10);b-=8*h;const m=[],J=[];for(let da=0;da<b/2;da++,h--){0>=h&&1===b%2&&da===(b-1)/2&&(O=0,a=O+0,Y=(Y+R)/2,d=Y-k);const [ea,fa]=g(O,Y,c,45);if(0<h){const [ha,ca]=g(l,Y,c,45),[ia,ka]=g(I,R,c,45);m.push(ha);m.push(ca);m.push(ea);m.push(fa);m.push(ia);m.push(ka)}else{const [ha,ca]=g(l,D,c,45),[ia,ka]=g(M,S,c,45),[la,ma]=g(a,d,c,45);J.push(ea);J.push(fa);
J.push(la);J.push(ma);J.push(ia);J.push(ka);J.push(ha);J.push(ca)}Y+=e;R+=e;D+=e;S+=e;d+=e}const [K,z]=g(5,0+n,c,45),[F,L]=g(7,0+n,c,45),[V,Z]=g(5,0-w,c,45),[aa,ba]=g(7,0-w,c,45);return{pennants:m,barbs:J,shaft:[K,z,F,L,V,Z,aa,ba]}}function g(b,c,e,k=1){return[Math.sqrt(b*b+c*c)/k,(2*Math.PI+(2*Math.PI+Math.atan2(c,b))%(2*Math.PI)-e)%(2*Math.PI)]}function q(b,c,e,k){e=A(k||"knots",e);for(k=1;k<c.length;k++)if(k===c.length-1){if(b<c[k]*e)break}else if(b<=c[k]*e)break;return Math.min(k-1,c.length-2)}
function H(b,c,e,k,n){let w=0;switch(c){case "beaufort_kn":w=q(b,T,"knots",e);break;case "beaufort_km":w=q(b,T,"kilometer-per-hour",e);break;case "beaufort_ft":w=q(b,T,"feet-per-second",e);break;case "beaufort_m":w=q(b,T,"meter-per-second",e);break;case "classified_arrow":w=q(b,n,k,e);break;case "ocean_current_m":w=q(b,X,"meter-per-second",e);break;case "ocean_current_kn":w=q(b,W,"knots",e)}return w}function U(b,c){const {style:e,inputUnit:k,outputUnit:n,breakValues:w}=c;c=C.fromJSON(k);const I=C.fromJSON(n);
let R=0,l=0;const {width:D,height:M,mask:S}=b,O=b.pixels[0];b=b.pixels[1];var Y=S?S.filter(m=>0<m).length:D*M;const a=new Float32Array(42*Y);Y=new Uint32Array(15*Y);for(let m=0;m<M;m++)for(let J=0;J<D;J++){var d=m*D+J;if(!S||S[m*D+J]){var h;const K=null!=(h=(b[d]+360)%360/180*Math.PI)?h:2*Math.PI*Math.random(),z=H(O[d],e,c,I,w);for(let F=0;F<P.length;F+=2)a[R++]=(J+.5)/D,a[R++]=(m+.5)/M,a[R++]=P[F],a[R++]=P[F+1]+K,a[R++]=z,a[R++]=O[d];d=7*(R/42-1);Y[l++]=d;Y[l++]=d+1;Y[l++]=d+2;Y[l++]=d+0;Y[l++]=
d+4;Y[l++]=d+3;Y[l++]=d+0;Y[l++]=d+2;Y[l++]=d+3;Y[l++]=d+2;Y[l++]=d+5;Y[l++]=d+3;Y[l++]=d+5;Y[l++]=d+6;Y[l++]=d+3}}return{vertexData:a,indexData:Y}}function Q(b,c){let e=0,k=0;const {width:n,height:w,mask:I}=b;b=b.pixels[0];const R=[],l=[];var D=C.fromJSON(c.inputUnit);D=A(D,"knots");c="wind_speed"===c.style?5:Number.MAX_VALUE;for(let S=0;S<w;S++)for(let O=0;O<n;O++){var M=b[S*n+O]*D;if((!I||I[S*n+O])&&M<c){for(let Y=0;4>Y;Y++)R[e++]=(O+.5)/n,R[e++]=(S+.5)/w,R[e++]=2>Y?-.5:.5,R[e++]=0===Y%2?-.5:.5,
R[e++]=0,R[e++]=M;M=4*(e/24-1);l[k++]=M;l[k++]=M+1;l[k++]=M+2;l[k++]=M+1;l[k++]=M+2;l[k++]=M+3}}return{vertexData:new Float32Array(R),indexData:new Uint32Array(l)}}const p=new Map;p.set("meter-per-second",1);p.set("kilometer-per-hour",.277778);p.set("knots",.514444);p.set("feet-per-second",.3048);p.set("mile-per-hour",.44704);const G=180/Math.PI,C=new N.JSONMap({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",
esriMilesPerHour:"mile-per-hour"}),P=function(b=0,c=0,e=Math.PI,k=!0){k&&(e=(2*Math.PI-e)%(2*Math.PI));k=k?-1:1;const n=-7*k,w=-2*k,I=-16*k,[R,l]=g(0,c+13*k,e,21.75),[D,M]=g(b-5.5,c+n,e,21.75),[S,O]=g(b+5.5,c+n,e,21.75),[Y,a]=g(b-1.5,c+w,e,21.75),[d,h]=g(b+1.5,c+w,e,21.75),[m,J]=g(b-1.5,c+I,e,21.75),[K,z]=g(b+1.5,c+I,e,21.75);return[R,l,D,M,Y,a,d,h,S,O,m,J,K,z]}(0,0,0),T=[0,1,3,6,10,16,21,27,33,40,47,55,63],X=[0,.5,1,1.5,2],W=[0,.25,.5,1,1.5,2,2.5,3,3.5,4],f=[];x.convertToLocalDirections=function(b,
c,e,k="geographic"){if(!v.isValidPixelBlock(b)||r.isNone(e))return b;b="vector-magdir"===c?b.clone():r.unwrap(E(b,c));const n=b.pixels[1];for(let w=0;w<n.length;w++)n[w]="geographic"===k?(n[w]+e[w]+270)%360:(n[w]+360-e[w])%360;return"vector-magdir"===c?b:E(b,"vector-magdir")};x.convertVectorFieldData=E;x.convertVectorFieldUnit=function(b,c,e=1){if(1===e||!v.isValidPixelBlock(b))return b;b=b.clone();const {pixels:k,width:n,height:w}=b,I=k[0],R=k[1];let l=0;for(let D=0;D<w;D++)for(let M=0;M<n;M++)"vector-uv"===
c?(I[l]*=e,R[l]*=e):I[l]*=e,l++;b.updateStatistics();return b};x.createVFMesh=function(b,c){if("simple_scalar"===c.style)var e=Q(b,c);else if("wind_speed"===c.style){{if(0===f.length)for(var k=0;30>k;k++)f.push(u(5*k,0));c=C.fromJSON(c.inputUnit);c=A(c,"knots");const {width:R,height:l,mask:D}=b;k=b.pixels[0];b=b.pixels[1];const M=[],S=[];let O=0,Y=0;for(let a=0;a<l;a++)for(let d=0;d<R;d++){var n=a*R+d,w=k[n]*c;if((!D||D[a*R+d])&&5<=w){const h=null!=(e=(b[n]+360)%360/180*Math.PI)?e:2*Math.PI*Math.random(),
{pennants:m,barbs:J,shaft:K}=f[Math.min(Math.floor(w/5),29)];if(0===m.length+J.length)continue;n=M.length/6;const z=(d+.5)/R,F=(a+.5)/l;for(var I=0;I<m.length;I+=2)M[O++]=z,M[O++]=F,M[O++]=m[I],M[O++]=m[I+1]+h,M[O++]=0,M[O++]=w;for(I=0;I<J.length;I+=2)M[O++]=z,M[O++]=F,M[O++]=J[I],M[O++]=J[I+1]+h,M[O++]=0,M[O++]=w;for(I=0;I<K.length;I+=2)M[O++]=z,M[O++]=F,M[O++]=K[I],M[O++]=K[I+1]+h,M[O++]=0,M[O++]=w;for(w=0;w<m.length/6;w++)S[Y++]=n,S[Y++]=n+1,S[Y++]=n+2,n+=3;for(w=0;w<J.length/8;w++)S[Y++]=n,S[Y++]=
n+1,S[Y++]=n+2,S[Y++]=n+1,S[Y++]=n+2,S[Y++]=n+3,n+=4;S[Y++]=n+0;S[Y++]=n+1;S[Y++]=n+2;S[Y++]=n+1;S[Y++]=n+3;S[Y++]=n+2;n+=4}}e={vertexData:new Float32Array(M),indexData:new Uint32Array(S)}}}else e=U(b,c);return e};x.createVFMeshScalar=Q;x.getUnitConversionFactor=A;x.sampleVectorField=function(b,c,e,k=[0,0],n=.5){const {width:w,height:I,mask:R}=b,[l,D]=b.pixels,[M,S]=k;b=Math.round((w-M)/e);k=Math.round((I-S)/e);var O=b*k;const Y=new Float32Array(O),a=new Float32Array(O);O=new Uint8Array(O);c="vector-uv"===
c;for(let h=0;h<k;h++)for(let m=0;m<b;m++){let J=0;const K=h*b+m,z=Math.max(0,h*e+S),F=Math.max(0,m*e+M),L=Math.min(I,z+e),V=Math.min(w,F+e);for(let Z=z;Z<L;Z++)for(let aa=F;aa<V;aa++){var d=Z*w+aa;if(!R||R[d]){J++;d=c?[l[d],D[d]]:[l[d],(360+D[d])%360];const [ba,da]=c?d:t(d);Y[K]+=ba;a[K]+=da}}if(J>=(L-z)*(V-F)*(1-n)){O[K]=1;const [Z,aa]=B([Y[K]/J,a[K]/J]);Y[K]=Z;a[K]=aa}else O[K]=0,Y[K]=0,a[K]=0}e=new y({width:b,height:k,pixels:[Y,a],mask:O});e.updateStatistics();return e};x.snapImageToSymbolTile=
function(b,c,e,k,n){if(!r.isSome(n)||!n.spatialReference.equals(b.spatialReference))return{extent:b,width:Math.round(c/k),height:Math.round(e/k),resolution:b.width/c};const w=n.xmin;n=n.ymax;c=(b.xmax-b.xmin)/c*k;e=(b.ymax-b.ymin)/e*k;b.xmin=w+Math.floor((b.xmin-w)/c)*c;b.xmax=w+Math.ceil((b.xmax-w)/c)*c;b.ymin=n+Math.floor((b.ymin-n)/e)*e;b.ymax=n+Math.ceil((b.ymax-n)/e)*e;return{extent:b,width:Math.round(b.width/c),height:Math.round(b.height/e),resolution:(c+e)/2}};x.unitKebabDict=C;x.uvComponentToVector=
B;Object.defineProperty(x,"__esModule",{value:!0})})},"esri/views/2d/engine/imagery/RasterVFTileContainer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry/support/aaBoundingRect ./BrushVectorField ./RasterVFTile ../webgl/enums ../webgl/TileContainer".split(" "),function(x,N,r,y,v,A,B){B=function(t){function E(){var g=t.apply(this,arguments)||this;g.isCustomTilingScheme=!1;g.symbolTypes=["triangle"];return g}N._inheritsLoose(E,t);var u=E.prototype;u.createTile=
function(g){const q=this._tileInfoView.getTileBounds(r.create(),g),[H,U]=this._tileInfoView.tileInfo.size;return new v.RasterVFTile(g,q[0],q[3],H,U)};u.prepareRenderPasses=function(g){const q=g.registerRenderPass({name:"imagery (vf tile)",brushes:[y],target:()=>this.children.map(H=>H.tileData),drawPhase:A.WGLDrawPhase.MAP});return[...t.prototype.prepareRenderPasses.call(this,g),q]};u.doRender=function(g){this.visible&&g.drawPhase===A.WGLDrawPhase.MAP&&this.symbolTypes.forEach(q=>{g.renderPass=q;t.prototype.doRender.call(this,
g)})};return E}(B.default);x.RasterVFTileContainer=B;Object.defineProperty(x,"__esModule",{value:!0})})},"esri/views/2d/engine/imagery/RasterVFTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/mat3 ../../../../chunks/mat3f32 ./RasterVFDisplayObject ../webgl/TiledDisplayObject".split(" "),function(x,N,r,y,v,A){A=function(B){function t(u,g,q,H,U,Q=null){var p=B.call(this,u,g,q,H,U)||this;p.tileData=new v.RasterVFDisplayObject(Q);p.tileData.coordScale=[H,
U];p.tileData.once("isReady",()=>p.ready());return p}N._inheritsLoose(t,B);var E=t.prototype;E.destroy=function(){B.prototype.destroy.call(this);this.tileData.destroy();this.stage=this.tileData=null};E._createTransforms=function(){return{dvs:y.create(),tileMat3:y.create()}};E.setTransform=function(u,g){B.prototype.setTransform.call(this,u,g);const q=g/(u.resolution*u.pixelRatio),H=this.transforms.tileMat3,[U,Q]=this.tileData.offset,[p,G]=u.toScreenNoRotation([0,0],[this.x+U*g,this.y-Q*g]);({symbolTileSize:g}=
this.tileData.symbolizerParameters);r.set(H,Math.round((this.width-this.tileData.offset[0])/g)*g/this.rangeX*q,0,0,0,Math.round((this.height-this.tileData.offset[1])/g)*g/this.rangeY*q,0,p,G,1);r.multiply(this.transforms.dvs,u.displayViewMat3,H);this.tileData.transforms.dvs=this.transforms.dvs};E.onAttach=function(){this.tileData.stage=this.stage};E.onDetach=function(){this.tileData.stage=null};N._createClass(t,[{key:"stencilRef",get:function(){return this.tileData.stencilRef},set:function(u){this.tileData.stencilRef=
u}}]);return t}(A.TiledDisplayObject);x.RasterVFTile=A;Object.defineProperty(x,"__esModule",{value:!0})})},"esri/views/2d/engine/imagery/RasterVFDisplayObject":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../../../../chunks/vec2f32 ../../../../layers/support/rasterFunctions/vectorFieldUtils ../DisplayObject ../webgl/Utils ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),
function(x,N,r,y,v,A,B,t,E,u,g,q,H){r=function(U){function Q(G=null){var C=U.call(this)||this;C._source=null;C._symbolizerParameters=null;C._vaoInvalidated=!0;C.coordScale=[1,1];C.height=null;C.stencilRef=0;C.resolution=null;C.pixelRatio=1;C.x=0;C.y=0;C.rotation=0;C.rawPixelData=null;C.width=null;C.source=G;return C}N._inheritsLoose(Q,U);var p=Q.prototype;p.destroy=function(){if(y.isSome(this.vaoData)){var G,C;null==(G=this.vaoData.magdir)?void 0:G.vao.dispose();null==(C=this.vaoData.scalar)?void 0:
C.vao.dispose();this.vaoData=null}};p.invalidateVAO=function(){if(!this._vaoInvalidated&&y.isSome(this.vaoData)){var G,C;null==(G=this.vaoData.magdir)?void 0:G.vao.dispose();null==(C=this.vaoData.scalar)?void 0:C.vao.dispose();this.vaoData=null;this._vaoInvalidated=!0;this.requestRender()}};p.updateVectorFieldVAO=function(G){if(this._vaoInvalidated){this._vaoInvalidated=!1;if(y.isSome(this.source)&&!y.isSome(this.vaoData)){var {style:C}=this.symbolizerParameters;switch(C){case "beaufort_ft":case "beaufort_km":case "beaufort_kn":case "beaufort_m":case "beaufort_mi":case "classified_arrow":case "ocean_current_kn":case "ocean_current_m":case "single_arrow":C=
t.createVFMesh(this.source,this.symbolizerParameters);this.vaoData={magdir:this._createVectorFieldVAO(G.context,C)};break;case "simple_scalar":C=t.createVFMeshScalar(this.source,this.symbolizerParameters);this.vaoData={scalar:this._createVectorFieldVAO(G.context,C)};break;case "wind_speed":{C=t.createVFMesh(this.source,this.symbolizerParameters);C=this._createVectorFieldVAO(G.context,C);const P=t.createVFMeshScalar(this.source,this.symbolizerParameters);G=this._createVectorFieldVAO(G.context,P);this.vaoData=
{magdir:C,scalar:G}}}}this.ready();this.requestRender()}};p._createTransforms=function(){return{dvs:A.create()}};p.setTransform=function(G){const C=v.identity(this.transforms.dvs),[P,T]=G.toScreenNoRotation([0,0],[this.x,this.y]);var X=this.resolution/this.pixelRatio/G.resolution;const W=X*this.width;X*=this.height;const f=Math.PI*this.rotation/180;v.translate(C,C,B.fromValues(P,T));v.translate(C,C,B.fromValues(W/2,X/2));v.rotate(C,C,-f);v.translate(C,C,B.fromValues(-W/2,-X/2));v.scaleByVec2(C,C,
B.fromValues(W,X));v.multiply(this.transforms.dvs,G.displayViewMat3,C)};p.onAttach=function(){this.invalidateVAO()};p.onDetach=function(){this.invalidateVAO()};p._createVectorFieldVAO=function(G,C){const {vertexData:P,indexData:T}=C;C=g.BufferObject.createVertex(G,q.Usage.STATIC_DRAW,new Float32Array(P));const X=g.BufferObject.createIndex(G,q.Usage.STATIC_DRAW,new Uint32Array(T)),W=u.createProgramDescriptor("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:q.DataType.FLOAT,normalized:!1},
{location:1,name:"a_offset",count:2,type:q.DataType.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:q.DataType.FLOAT,normalized:!1}]});return{vao:new H.VertexArrayObject(G,W.attributes,W.bufferLayouts,{geometry:C},X),elementCount:T.length}};N._createClass(Q,[{key:"symbolizerParameters",get:function(){return this._symbolizerParameters},set:function(G){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(G)&&(this._symbolizerParameters=G,this.invalidateVAO())}},{key:"source",get:function(){return this._source},
set:function(G){this._source=G;this.invalidateVAO()}}]);return Q}(E.DisplayObject);x.RasterVFDisplayObject=r;Object.defineProperty(x,"__esModule",{value:!0})})},"esri/views/layers/ImageryTileLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../core/Error ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../layers/support/commonProperties ../../layers/support/rasterFunctions/rasterProjectionHelper ./support/popupUtils".split(" "),
function(x,N,r,y,v,A,B,t,E,u,g,q,H,U){t=Q=>{Q=function(p){function G(){var P=p.apply(this,arguments)||this;P._rasterFieldPrefix="Raster.";P.layer=null;P.view=null;P.tileInfo=null;return P}N._inheritsLoose(G,p);var C=G.prototype;C._getfullExtent=function(){return this.projectFullExtent(this.view.spatialReference)};C.supportsSpatialReference=function(P){return!!this.projectFullExtent(P)};C.projectFullExtent=function(P){const T=A.unwrap(this.layer.fullExtent),X=H.getDefaultDatumTransformationForDataset(T,
P,!1);return H.projectExtent(T,P,X)};C.fetchPopupFeatures=function(){var P=N._asyncToGenerator(function*(T,X){const {layer:W}=this;if(!T)return Promise.reject(new v("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:W}));var {popupEnabled:f}=W;X=U.getFetchPopupTemplate(W,X);if(!f||!A.isSome(X))throw new v("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:f,popupTemplate:X});f=[];const {value:b,magdirValue:c}=yield W.identify(T,
{timeExtent:this.timeExtent});let e="";if(b&&b.length){var k,n;e="imagery-tile"===W.type&&W.hasStandardTime()&&null!=b[0]?b.map(I=>W.getStandardTimeValue(I)).join(", "):b.join(", ");T={ObjectId:0};T["Raster.ServicePixelValue"]=this._formatAttributeValue(e,"Raster.ServicePixelValue");if((X=null==(k=W.rasterInfo)?void 0:null==(n=k.attributeTable)?void 0:n.features)&&0<X.length&&(k=X.filter(I=>String(I.attributes.value||I.attributes.Value||I.attributes.VALUE)===e),0<k.length&&(k=k[0])))for(var w in k.attributes)k.attributes.hasOwnProperty(w)&&
(n=this._rasterFieldPrefix+w,T[n]=this._formatAttributeValue(k.attributes[w],n));w=W.rasterInfo.dataType;if("vector-magdir"===w||"vector-uv"===w)T["Raster.Magnitude"]=null==c?void 0:c[0],T["Raster.Direction"]=null==c?void 0:c[1];w=new y(this.fullExtent.clone(),null,T);w.layer=W;w.sourceLayer=w.layer;f.push(w)}return f});return function(T,X){return P.apply(this,arguments)}}();C._formatAttributeValue=function(P,T){if("string"===typeof P&&(T=(T=this._getFieldInfo(this.layer.popupTemplate&&this.layer.popupTemplate.fieldInfos,
T))&&T.format)){let X,W;return-1<P.trim().indexOf(",")?(X=",",W=X+" ",this._formatDelimitedString(P,X,W,T)):-1<P.trim().indexOf(" ")?(X=W=" ",this._formatDelimitedString(P,X,W,T)):this._formatNumberFromString(P,T)}return P};C._getFieldInfo=function(P,T){if(P&&P.length&&T){var X=T.toLowerCase(),W=void 0;P.some(f=>!f.fieldName||f.fieldName.toLowerCase()!==X&&f.fieldName.toLowerCase()!==X.replace(/ /g,"_")?!1:(W=f,!0));return W}};C._formatDelimitedString=function(P,T,X,W){return P&&T&&X&&W?P.trim().split(T).map(f=>
this._formatNumberFromString(f,W)).join(X):P};C._formatNumberFromString=function(P,T){if(!P||!T)return P;const X=Number(P);return isNaN(X)?P:T.format(X)};N._createClass(G,[{key:"fullExtent",get:function(){return this._getfullExtent()}},{key:"hasTilingEffects",get:function(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}},{key:"datumTransformation",get:function(){return H.getDefaultDatumTransformationForDataset(A.unwrap(this.layer.fullExtent),
this.view.spatialReference,!0)}}]);return G}(Q);r.__decorate([B.property()],Q.prototype,"layer",void 0);r.__decorate([B.property(q.combinedViewLayerTimeExtentProperty)],Q.prototype,"timeExtent",void 0);r.__decorate([B.property()],Q.prototype,"view",void 0);r.__decorate([B.property()],Q.prototype,"fullExtent",null);r.__decorate([B.property()],Q.prototype,"tileInfo",void 0);r.__decorate([B.property({readOnly:!0})],Q.prototype,"hasTilingEffects",null);return Q=r.__decorate([g.subclass("esri.views.layers.ImageryTileLayerView")],
Q)};x.ImageryTileLayerView=t;x.default=t;Object.defineProperty(x,"__esModule",{value:!0})})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../layers/support/fieldUtils"],function(x,N,r,y){function v(){v=N._asyncToGenerator(function*(A,B=A.popupTemplate){if(!r.isSome(B))return[];const t=yield B.getRequiredFields(A.fieldsIndex);({lastEditInfoEnabled:B}=B);const {objectIdField:E,typeIdField:u,globalIdField:g,
relationships:q}=A;if(t.includes("*"))return["*"];B=B?yield y.getFeatureEditFields(A):[];const H=y.fixFields(A.fieldsIndex,[...t,...B]);u&&H.push(u);H&&E&&A.fieldsIndex.has(E)&&-1===H.indexOf(E)&&H.push(E);H&&g&&A.fieldsIndex.has(g)&&-1===H.indexOf(g)&&H.push(g);q&&q.forEach(U=>{({keyField:U}=U);H&&U&&A.fieldsIndex.has(U)&&-1===H.indexOf(U)&&H.push(U)});return H});return v.apply(this,arguments)}x.getFetchPopupTemplate=function(A,B){return A.popupTemplate?A.popupTemplate:r.isSome(B)&&B.defaultPopupTemplateEnabled&&
r.isSome(A.defaultPopupTemplate)?A.defaultPopupTemplate:null};x.getRequiredFields=function(A){return v.apply(this,arguments)};Object.defineProperty(x,"__esModule",{value:!0})})},"esri/views/layers/RefreshableLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(x,N,r,y,v,A,B,t,E,u,g){t=q=>{q=function(H){function U(){return H.apply(this,arguments)||this}N._inheritsLoose(U,H);U.prototype.initialize=function(){this.handles.add(A.on(()=>this.layer,"refresh",Q=>{this.doRefresh(Q.dataChanged).catch(p=>{v.isAbortError(p)||y.getLogger(this.declaredClass).error(p)})}),"RefreshableLayerView")};return U}(q);r.__decorate([B.property()],q.prototype,"layer",void 0);return q=r.__decorate([g.subclass("esri.layers.mixins.RefreshableLayerView")],q)};x.RefreshableLayerView=
t;x.default=t;Object.defineProperty(x,"__esModule",{value:!0})})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Logger ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../engine/flow/FlowView2D ./LayerView2D ./imagery/ImageryTileView2D ./imagery/VectorFieldTileView2D ./support/util ../../layers/ImageryTileLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),function(x,
N,r,y,v,A,B,t,E,u,g,q,H,U,Q,p,G,C,P,T){const X=y.getLogger("esri.views.2d.layers.ImageryTileLayerView2D");y=function(W){function f(){var c=W.apply(this,arguments)||this;c._useWebGLForProcessing=!0;c._useProgressiveUpdate=!0;c.subview=null;return c}x._inheritsLoose(f,W);var b=f.prototype;b.update=function(c){this.subview.update(c);this.notifyChange("updating")};b.isUpdating=function(){return!this.subview||this.subview.updating};b.attach=function(){this.layer.increaseRasterJobHandlerUsage();this._updateSubview();
this.handles.add([B.watch(this.layer,["bandIds","renderer","interpolation","multidimensionalDefinition"],(c,e,k)=>{const n="multidimensionalDefinition"===k,w="interpolation"===k&&("majority"===c||"majority"===e)&&G.canUseMajorityInterpolationOnDataSource(this.layer);(c="renderer"===k&&e.type!==c.type)&&this._updateSubview();this.subview.redrawOrRefetch(n||w||c).catch(I=>{v.isAbortError(I)||X.error(I)});this.notifyChange("updating")}),A.watch(()=>{var c;return null!=(c=this.layer.blendMode)?c:"normal"},
c=>{this.subview.container.blendMode=c},A.syncAndInitial),A.watch(()=>{var c;return null!=(c=this.layer.effect)?c:null},c=>{this.subview.container.effect=c},A.syncAndInitial),A.watch(()=>this.timeExtent,()=>{this.subview.timeExtent=this.timeExtent;this.subview.redrawOrRefetch(!0).catch(c=>{v.isAbortError(c)||X.error(c)})},A.initial)],"attach")};b.detach=function(){var c;this.handles.remove("attach");this.layer.decreaseRasterJobHandlerUsage();this._detachSubview(this.subview);null==(c=this.subview)?
void 0:c.destroy();this.subview=null};b.moveStart=function(){this.requestUpdate()};b.viewChange=function(){this.requestUpdate()};b.moveEnd=function(){this.subview.moveEnd()};b.hitTest=function(){var c=x._asyncToGenerator(function*(e,k){return[new r({attributes:{},geometry:e.clone()})]});return function(e,k){return c.apply(this,arguments)}}();b.doRefresh=function(){return this.subview.doRefresh()};b._updateSubview=function(){var c="vector-field"===this.layer.renderer.type?"rasterVF":"flow"===this.layer.renderer.type?
"flow":"raster";if(this.subview){var e;if(this.subview.type===c){this._attachSubview(this.subview);return}this._detachSubview(this.subview);null==(e=this.subview)?void 0:e.destroy();this.subview=null}({layer:e}=this);c="rasterVF"===c?new p({layer:e,layerView:this}):"flow"===c?new H({layer:e,layerView:this}):new Q({layer:e,layerView:this});"useWebGLForProcessing"in c&&(c.useWebGLForProcessing=this._useWebGLForProcessing);"useProgressiveUpdate"in c&&(c.useProgressiveUpdate=this._useProgressiveUpdate);
"previousLOD"in c&&(c.previousLOD=this.subview&&"previousLOD"in this.subview&&this.subview.previousLOD);this._attachSubview(c);this.subview=c;this.requestUpdate()};b._attachSubview=function(c){c&&!c.attached&&(c.attach(),c.attached=!0,this.container.addChildAt(c.container,0),c.container.blendMode=this.layer.blendMode,c.container.effect=this.layer.effect)};b._detachSubview=function(c){null!=c&&c.attached&&(this.container.removeChild(c.container),c.detach(),c.attached=!1)};x._createClass(f,[{key:"useWebGLForProcessing",
get:function(){return this._useWebGLForProcessing},set:function(c){this._useWebGLForProcessing=c;this.subview&&"useWebGLForProcessing"in this.subview&&(this.subview.useWebGLForProcessing=c)}},{key:"useProgressiveUpdate",get:function(){return this._useWebGLForProcessing},set:function(c){this._useProgressiveUpdate=c;this.subview&&"useProgressiveUpdate"in this.subview&&(this.subview.useProgressiveUpdate=c)}}]);return f}(C.ImageryTileLayerView(T.RefreshableLayerView(U.LayerView2DMixin(P))));N.__decorate([t.property()],
y.prototype,"subview",void 0);N.__decorate([t.property()],y.prototype,"useWebGLForProcessing",null);N.__decorate([t.property()],y.prototype,"useProgressiveUpdate",null);return y=N.__decorate([q.subclass("esri.views.2d.layers.ImageryTileLayerView2D")],y)});