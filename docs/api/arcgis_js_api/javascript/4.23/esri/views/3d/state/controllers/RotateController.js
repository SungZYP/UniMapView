// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../camera/constraintUtils ../../camera/constraintUtils/common ../Constraints ./InteractiveController ../utils/navigationUtils".split(" "),
function(c,u,r,v,B,w,I,J,K,C,x,D,E,y,d,k,F,G,g,z,H,p){c.PivotPoint=void 0;(function(l){l[l.CENTER=0]="CENTER";l[l.EYE=1]="EYE"})(c.PivotPoint||(c.PivotPoint={}));c.RotateController=function(l){function q(a){a=l.call(this,a)||this;a.view=null;a.pivot=c.PivotPoint.CENTER;a.lastPoint=y.create();a.tmpWorldUp=k.create();a.tmpViewDir=k.create();a.tmpRotCurPoint=y.create();a.tmpTransf=D.create();a.tmpAxis=k.create();a.tmpPivotPoint=k.create();a.pivotPos=k.create();a.constraintOptions={selection:g.ConstraintTypes.ALL,
interactionType:g.InteractionType.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:g.TiltMode.TUMBLE};return a}u._inheritsLoose(q,l);var n=q.prototype;n.initialize=function(){this.rotScale=this.pivot===c.PivotPoint.CENTER?3:1.5};n.begin=function(a){if(this.active){switch(this.pivot){case c.PivotPoint.EYE:d.copy(this.pivotPos,this.startCamera.eye);this.constraintOptions.interactionType=g.InteractionType.LOOK_AROUND;this.constraintOptions.tiltMode=g.TiltMode.LOOK_AROUND;
this.constraintOptions.selection=g.ConstraintTypes.NONE;break;case c.PivotPoint.CENTER:this.intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this.pivotPos)||d.copy(this.pivotPos,this.startCamera.center),this._constrainPivotPoint(a),this.startCamera.center=this.pivotPos,this.constraintOptions.interactionType=g.InteractionType.TUMBLE,this.constraintOptions.tiltMode=g.TiltMode.TUMBLE,this.constraintOptions.selection=g.ConstraintTypes.ALL&~g.ConstraintTypes.DISTANCE}this.constraintOptions.interactionStartCamera=
this.startCamera;p.normalizeCoordinate(this.startCamera,a,this.lastPoint)}};n._constrainPivotPoint=function(a){const b=this.startCamera,e=k.create();d.subtract(e,this.pivotPos,b.eye);let h=d.length(e);this.view.camera.position.hasZ&&(h=Math.min(h,7*Math.abs(this.view.camera.position.z)));var m=F.getReferenceEllipsoid(this.view.spatialReference),f=B.createScreenPointArray(b.width/b.pixelRatio*.5,b.height/b.pixelRatio*.5);m=p.decideNavigationMode(this.startCamera,f,!0,m);f=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),
b.fullWidth/b.pixelRatio*.5,b.fullHeight/b.pixelRatio*.5,b,225,90);a=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),a[0],a[1],b,90);if(void 0!==f||void 0!==a)f=void 0===f?a:f,a=void 0===a||m===p.NavigationMode.Horizontal?f:a,h=f>a?a:f;d.normalize(e,e);d.copy(this.pivotPos,d.add(this.tmpPivotPoint,b.eye,d.scale(this.tmpPivotPoint,e,h)))};n.update=function(a){if(this.active){switch(this.pivot){case c.PivotPoint.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,
a,this.currentCamera.center,this.pivotPos);break;case c.PivotPoint.CENTER:this.currentCamera.center=this.pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,a,this.currentCamera.eye,this.pivotPos)}G.applyAll(this.view,this.currentCamera,this.constraintOptions)}};n.end=function(){this.active&&this.finishController()};n._applyRotation=function(a,b,e,h){this.view.renderCoordsHelper.worldUpAtPosition(h,this.tmpWorldUp);p.normalizeCoordinate(a,b,this.tmpRotCurPoint);b=(this.lastPoint[1]-
this.tmpRotCurPoint[1])*this.rotScale;let m=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;d.subtract(this.tmpViewDir,e,h);e=d.length(this.tmpViewDir);e=v.acosClamped(d.dot(this.tmpViewDir,this.tmpWorldUp)/e);if(this.pivot===c.PivotPoint.EYE){const f=.5*Math.PI-e,A=.495*Math.PI;b=f-Math.max(-A,Math.min(A,f+-.5*b))}b=v.clamp(b+e,z.TiltDefault.min,z.TiltDefault.max)-e;d.cross(this.tmpAxis,a.up,this.tmpViewDir);this.pivot===c.PivotPoint.CENTER&&(m=-m);x.fromRotation(this.tmpTransf,m,this.tmpWorldUp);
x.rotate(this.tmpTransf,this.tmpTransf,b,this.tmpAxis);d.transformMat4(this.tmpViewDir,this.tmpViewDir,this.tmpTransf);a.up=d.transformMat4(t,a.up,this.tmpTransf);d.add(t,h,this.tmpViewDir);E.copy(this.lastPoint,this.tmpRotCurPoint);return t};u._createClass(q,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return q}(H.InteractiveController);r.__decorate([w.property({constructOnly:!0})],c.RotateController.prototype,"view",void 0);r.__decorate([w.property()],c.RotateController.prototype,
"pivot",void 0);c.RotateController=r.__decorate([C.subclass("esri.views.3d.state.controllers.RotateController")],c.RotateController);const t=k.create();Object.defineProperty(c,"__esModule",{value:!0})});