// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingRect ./I3SMeshView3D ./interfaces ./LayerView3D ../support/updatingProperties ../terrain/interfaces ../../layers/LayerView".split(" "),
function(q,e,u,n,r,h,d,C,D,v,t,l,w,x,y,z,k,A){d=function(p){function m(){var a=p.apply(this,arguments)||this;a.type="integrated-mesh-3d";a.lodFactor=1;a._elevationContext="im";a._isIntegratedMesh=!0;a._supportsLabeling=!1;a.drapeTargetType=x.DrapeTargetType.WithoutRasterImage;a._overlayTexOffset=t.fromValues(-1,-1,-1,-1);a._overlayTexScale=t.create();a._overlayColor=null;a._overlayHighlight=null;a._overlayNormal=null;return a}q._inheritsLoose(m,p);var f=m.prototype;f.setDrapingTextures=function(a){this._clearDrapingTexture(k.OverlayIndex.INNER);
this._clearDrapingTexture(k.OverlayIndex.OUTER);for(const b of a){var g=b.index,c=b.extent;a=b.needsColorWithoutRasterImage?b.getValidTarget(k.RenderTargetType.ColorNoRasterImage):b.hasDrapedFeatureSource?b.getValidTarget(k.RenderTargetType.Color):null;n.isSome(a)&&0<l.area(c)&&(this._overlayTexOffset[2*g]=-c[0]/l.width(c),this._overlayTexOffset[2*g+1]=-c[1]/l.height(c),this._overlayTexScale[2*g]=1/l.width(c),this._overlayTexScale[2*g+1]=1/l.height(c),g=b.getValidTarget(k.RenderTargetType.Highlight),
c=b.getValidTarget(k.RenderTargetType.Water),this._overlayColor=a.getTexture(),this._overlayHighlight=g?g.getTexture():null,this._overlayNormal=c?c.getTexture():null)}this._forAllNodes(b=>n.isSome(b)&&this._collection.updateMaterial(b.objectHandle,B=>this._updateMaterialOverlay(B)))};f._clearDrapingTexture=function(a){this._overlayTexOffset[2*a]=-1;this._overlayTexOffset[2*a+1]=-1;this._overlayTexScale[2*a]=0;this._overlayTexScale[2*a+1]=0;this._overlayNormal=this._overlayHighlight=this._overlayColor=
null};f._updateMaterialOverlay=function(a){a.overlayColor=this._overlayColor;a.overlayHighlight=this._overlayHighlight;a.overlayNormal=this._overlayNormal;a.overlayTexOffset=this._overlayTexOffset;a.overlayTexScale=this._overlayTexScale};f.initialize=function(){this.updatingHandles.add(()=>this.layer.modifications,()=>this._loadModifications(),r.initial)};f._createLayerGraphic=function(){const a=new u;a.layer=this.layer;a.sourceLayer=this.layer;return a};f.canResume=function(){return p.prototype.canResume.call(this)&&
(!this._controller||this._controller.rootNodeVisible)};f._loadModifications=function(){this.handles.remove("modifications");if(n.isNone(this.layer.modifications))this._modifications=[];else{var a=this.layer.modifications;this.handles.add(this.updatingHandles.addOnCollectionChange(()=>a,()=>this._modifications=a.toArray(),r.initial),"modifications")}};q._createClass(m,[{key:"progressiveLoadFactor",get:function(){return 1<=this.lodFactor?.2:1}}]);return m}(w.I3SMeshView3D(y.LayerView3D(A)));e.__decorate([h.property()],
d.prototype,"layer",void 0);e.__decorate([h.property({aliasOf:"layer"})],d.prototype,"i3slayer",void 0);e.__decorate([h.property(z.updatingProgress)],d.prototype,"updatingProgress",void 0);e.__decorate([h.property({readOnly:!0,aliasOf:"_controller.updatingProgress"})],d.prototype,"updatingProgressValue",void 0);e.__decorate([h.property({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.integratedMesh.lodFactor"})],d.prototype,"lodFactor",void 0);e.__decorate([h.property({readOnly:!0})],d.prototype,
"progressiveLoadFactor",null);return d=e.__decorate([v.subclass("esri.views.3d.layers.SceneLayerView3D")],d)});