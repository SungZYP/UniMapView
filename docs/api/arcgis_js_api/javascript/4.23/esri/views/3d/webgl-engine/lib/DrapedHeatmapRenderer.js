// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/set ../../../../core/accessorSupport/decorators/subclass ../../../ViewingMode ./glUtil3D ./SortedRenderGeometryRenderer ../materials/HeatmapDensityMaterial ../shaders/HeatmapTechnique ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(p,r,x,k,L,M,N,O,P,y,z,A,B,C,t,b,D,E,F){function G(f){return C.isHeatMapDensityMaterial(f.material)}p.DrapedHeatmapRenderer=function(f){function q(){var a=f.apply(this,arguments)||this;a.type="draped-heatmap";return a}r._inheritsLoose(q,f);var l=q.prototype;l.initialize=function(){f.prototype.initialize.call(this);var a={colorTarget:b.TargetType.TEXTURE,depthStencilTarget:b.DepthStencilTargetType.NONE,width:0,height:0},{capabilities:e}=this.rctx,{R32F:c}=e.colorBufferFloat;({textureFloatLinear:e}=
e.textureFloat);c=null!=c;this._densityMap=new D.FramebufferObject(this.rctx,a,{target:b.TextureType.TEXTURE_2D,pixelFormat:c?b.PixelFormat.RED:b.PixelFormat.RGBA,internalFormat:c?b.SizedPixelFormat.R32F:b.PixelFormat.RGBA,dataType:b.PixelType.FLOAT,samplingMode:e?b.TextureSamplingMode.LINEAR:b.TextureSamplingMode.NEAREST,wrapMode:b.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0});this._quad=A.createQuadVAO(this.rctx);this._colorRamp=a=new E.Texture(this.rctx,{target:b.TextureType.TEXTURE_2D,pixelFormat:b.PixelFormat.RGBA,
dataType:b.PixelType.UNSIGNED_BYTE,samplingMode:b.TextureSamplingMode.LINEAR,wrapMode:b.TextureWrapMode.CLAMP_TO_EDGE,width:1,height:1},new Uint8ClampedArray(4));this._technique=new t.HeatmapTechnique({rctx:this.rctx,viewingMode:z.ViewingMode.Local},new t.HeatmapTechniqueConfiguration);this._heatmapParameters={colorRamp:a,densityMap:this._densityMap.colorTexture,searchRadius:1,minDensity:0,maxDensity:100,fieldTotal:0}};l.destroy=function(){this._technique=k.releaseMaybe(this._technique);this._densityMap=
k.disposeMaybe(this._densityMap);this._quad=k.disposeMaybe(this._quad);this._colorRamp=k.disposeMaybe(this._colorRamp)};l.add=function(a){f.prototype.add.call(this,a)};l.remove=function(a){f.prototype.remove.call(this,a)};l.render=function(a,e){var c=this._heatmapDensityMaterialRenderers,m=c.length;if(!(1>m)){var H=this.rctx.getBoundFramebufferObject(),g=this.rctx.getViewport(),u=c[0].material.parameters,{pixelRatio:d}=u,h=Math.ceil(g.width*d);d=Math.ceil(g.height*d);this._densityMap.resize(h,d);
this.rctx.bindFramebuffer(this._densityMap);this.rctx.setViewport(0,0,h,d);this.rctx.clear(b.ClearBufferBit.COLOR_BUFFER_BIT);h=!1;for(d=0;d<m;d++){const v=c[d];v.material.shouldRender(a)&&(h=h||v.materialRenderer.render(e.slot,a.pass,e))}this.rctx.bindFramebuffer(H);this.rctx.setViewport(g.x,g.y,g.width,g.height);if(h){var {searchRadius:w,minDensity:I,maxDensity:J,fieldTotal:K,colorRampData:n}=u;a=this._heatmapParameters;a.searchRadius=w;a.fieldTotal=K;a.searchRadius=w;a.minDensity=I;a.maxDensity=
J;k.isSome(n)&&n!==this._colorRampData&&({colorRamp:c}=a,m=n.length/4,m!==c.descriptor.width&&c.resize(m,1),c.setData(n),this._colorRampData=n);this.rctx.bindVAO(this._quad);this.rctx.useProgram(this._technique.program);this._technique.bindPipelineState(this.rctx);this._technique.bindPass(a,e);this.rctx.drawArrays(this._technique.primitiveType,0,F.vertexCount(this._quad,"geometry"))}}};r._createClass(q,[{key:"hasHighlights",get:function(){return!1}},{key:"hasWater",get:function(){return!1}},{key:"rendersOccluded",
get:function(){return!1}},{key:"_heatmapDensityMaterialRenderers",get:function(){return this._sortedMaterialRenderers.filter(G)}}]);return q}(B.SortedRenderGeometryRenderer);p.DrapedHeatmapRenderer=x.__decorate([y.subclass("esri.views.3d.webgl-engine.lib.DrapedHeatmapRenderer")],p.DrapedHeatmapRenderer);Object.defineProperty(p,"__esModule",{value:!0})});