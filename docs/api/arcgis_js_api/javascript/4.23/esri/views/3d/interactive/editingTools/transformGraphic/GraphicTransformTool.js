// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Evented ../../../../../core/HandleOwner ../../../../../core/handleUtils ../../../../../core/maybe ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../geometry/Point ../../../../../support/elevationInfoUtils ../../../../ViewingMode ../../Manipulator3D ../../manipulatorUtils ../../SnappingVisualizer3D ../manipulatorUtils ../visualElementUtils ../manipulations/config ../manipulations/MoveManipulation ./GraphicScaleRotateTransform ./ScaleRotateMeshAdapter ./ScaleRotateObjectSymbol3DAdapter ./undoRecords ../../../layers/graphics/GraphicState ../../../../interactive/InteractiveToolBase ../../../../interactive/editGeometry/EditGeometryOperations ../../../../interactive/snapping/SnappingContext ../../../../interactive/snapping/SnappingDragPipelineStep".split(" "),
function(c,q,f,v,w,x,e,g,P,Q,R,y,z,r,A,B,C,D,t,E,F,m,G,H,I,J,K,L,M,N,O){c.GraphicTransformTool=function(u){function l(a){a=u.call(this,a)||this;a.enableZ=!0;a.enableRotation=!0;a.enableScaling=!0;a.type="transform-3d";a.scaleRotate=null;a.snappingPipeline=new O.SnappingPipeline;return a}q._inheritsLoose(l,u);var d=l.prototype;d.initialize=function(){this.graphicState=new K.GraphicState({graphic:this.graphic});this.moveManipulation=new m.MoveManipulation({tool:this,view:this.view,snapToScene:this.snapToScene,
xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&t.canMoveZ(this.graphic),radius:m.MoveManipulation.radiusForSymbol(this.graphic.symbol)});this.moveManipulation.forEachManipulator(b=>this.handles.add(b.events.on("immediate-click",h=>{this.emit("immediate-click",{...h,graphic:this.graphicState.graphic});h.stopPropagation()})));this.moveManipulation.elevationInfo=r.getGraphicEffectiveElevationInfo(this.graphic);const a=this.graphic.geometry;this.moveManipulation.createGraphicDragPipeline((b,
h,k,n,p)=>{e.isSome(a)&&b===m.ManipulationType.XY&&(k=k.next(this.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:new N.SnappingContext({elevationInfo:r.getGraphicEffectiveElevationInfo(this.graphic),pointer:p,editGeometryOperations:M.EditGeometryOperations.fromGeometry(new z({spatialReference:a.spatialReference}),this.view.state.viewingMode),visualizer:new D.SnappingVisualizer3D,excludeFeature:this.graphic}),snappingManager:this.snappingManager,updatingHandles:this.updatingHandles,
cancel:n}),this.snappingPipeline.next));return k},this.graphicState,b=>{const {action:h,graphic:k,dxScreen:n,dyScreen:p}=b;b={graphic:k,dxScreen:n,dyScreen:p};switch(h){case "start":this.emit("graphic-translate-start",b);this.emit("record-undo",{record:this._createGeometryUndoRecord()});break;case "update":this.emit("graphic-translate",b);break;case "end":this.emit("graphic-translate-stop",b)}});this.moveManipulation.angle=e.isSome(this.scaleRotate)?this.scaleRotate.angle:0;this.scaleRotateAdapter=
this._createScaleRotateAdapter();this.handles.add(this.scaleRotateAdapter.watch("angle",()=>this._updateMoveAngle()));if(this.enableScaling||this.enableRotation)this.scaleRotate=new G.GraphicScaleRotateTransform({tool:this,mode:this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate",adapter:this.scaleRotateAdapter}),this.handles.add(this.scaleRotate.events.on("scale-changed",()=>this._onScaleChanged()));this.handles.add([E.createVisualElements({view:this.view,graphic:this.graphic,
forEachManipulator:b=>this._forEachManipulator(b),onManipulatorsChanged:()=>x.makeHandle()}),this.graphicState.on("changed",()=>this._onGeometryChanged()),this._hideManipulatorsForGraphicState(),this.view.watch("scale",()=>this._updateMoveAngle())]);this.handles.add(this.view.trackGraphicState(this.graphicState));this._onGeometryChanged();this._updateMoveAngle();this._forEachManipulator(b=>{b instanceof B.Manipulator3D&&this.handles.add(b.events.on("grab-changed",()=>this._updateManipulatorsInteractive()))});
this.finishToolCreation()};d._updateManipulatorsInteractive=function(){e.isNone(this.scaleRotate)||(this.scaleRotate.interactive=!this.moveManipulation.grabbing,this.moveManipulation.interactive=!this.scaleRotate.grabbing)};d._createScaleRotateAdapter=function(){return e.isSome(this.graphic.geometry)&&"mesh"===this.graphic.geometry.type?new H.ScaleRotateMeshAdapter({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new I.ScaleRotateObjectSymbol3DAdapter({graphic:this.graphic,
sizeFilter:a=>this._enforceNonZeroSize(a),findLayerView:()=>this.view.allLayerViews.find(a=>a.layer===this.graphic.layer)})};d._forEachManipulator=function(a){this.moveManipulation.forEachManipulator(a);e.isSome(this.scaleRotate)&&this.scaleRotate.forEachManipulator(a)};d._hideManipulatorsForGraphicState=function(){return this.graphicState.watch("displaying",a=>{this._forEachManipulator(b=>b.available=a);this.moveManipulation.zManipulation.available=a&&this.enableZ&&t.canMoveZ(this.graphic)})};d._createGeometryUndoRecord=
function(){return J.createGraphicGeometryUndoRecord(this.graphic)};d.destroy=function(){this.moveManipulation.destroy();this.scaleRotate=e.destroyMaybe(this.scaleRotate);this.scaleRotateAdapter=e.destroyMaybe(this.scaleRotateAdapter);this._set("view",null);this._set("graphic",null)};d.reset=function(){};d.onHide=function(){e.isSome(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()};d._onScaleChanged=function(){if(!e.isNone(this.scaleRotate)){var a=this.scaleRotate.getScale();this.moveManipulation.displayScale=
a}};d._updateMoveAngle=function(){this.moveManipulation.angle=this.view.state.viewingMode===A.ViewingMode.Local||this.view.scale<F.ALIGN_ARROWS_SCALE_THRESHOLD?this.scaleRotateAdapter.angle:0};d._onGeometryChanged=function(){C.placeAtGraphic(this.view,this,this.graphic)};d._enforceNonZeroSize=function(a){return a||this.view.state.camera.computeRenderPixelSizeAt(this.moveManipulation.renderLocation)};q._createClass(l,[{key:"snapToScene",set:function(a){this.moveManipulation&&(this.moveManipulation.snapToScene=
a);this._set("snapToScene",a)}},{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"location",set:function(a){this.moveManipulation.location=a;e.isSome(this.scaleRotate)&&(this.scaleRotate.location=a)}},{key:"elevationAlignedLocation",set:function(a){this.moveManipulation.elevationAlignedLocation=a;e.isSome(this.scaleRotate)&&(this.scaleRotate.elevationAlignedLocation=a)}},{key:"test",get:function(){return{discManipulator:this.moveManipulation.xyManipulation.test.discManipulator,
zManipulator:this.moveManipulation.zManipulation.test.manipulator,ringManipulator:e.isSome(this.scaleRotate)?this.scaleRotate.test.ringManipulator:null,arrowManipulators:this.moveManipulation.xyAxisManipulation.test.arrowManipulators}}}]);return l}(w.HandleOwnerMixin(v.EventedMixin(L.InteractiveToolBase)));f.__decorate([g.property({constructOnly:!0,nonNullable:!0})],c.GraphicTransformTool.prototype,"view",void 0);f.__decorate([g.property({constructOnly:!0,nonNullable:!0})],c.GraphicTransformTool.prototype,
"graphic",void 0);f.__decorate([g.property({constructOnly:!0,nonNullable:!0})],c.GraphicTransformTool.prototype,"enableZ",void 0);f.__decorate([g.property()],c.GraphicTransformTool.prototype,"enableRotation",void 0);f.__decorate([g.property()],c.GraphicTransformTool.prototype,"enableScaling",void 0);f.__decorate([g.property({value:!1})],c.GraphicTransformTool.prototype,"snapToScene",null);f.__decorate([g.property({constructOnly:!0})],c.GraphicTransformTool.prototype,"snappingManager",void 0);f.__decorate([g.property({readOnly:!0})],
c.GraphicTransformTool.prototype,"type",void 0);f.__decorate([g.property({readOnly:!0})],c.GraphicTransformTool.prototype,"updating",null);c.GraphicTransformTool=f.__decorate([y.subclass("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],c.GraphicTransformTool);Object.defineProperty(c,"__esModule",{value:!0})});