// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("exports ../../../core/compilerUtils ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/lineSegment ../../../geometry/support/plane ../../../geometry/support/ray ../../ViewingMode ./intersectionUtils".split(" "),function(t,
J,z,K,A,d,p,u,L,v,B,k,C,n,D,w,M){const E=.5*Math.PI,N=E/Math.PI*180;let I=function(){function F(a){this.renderCoordsHelper=a.renderCoordsHelper;this.extent=Array(4);this.planes=Array(6);this.maxSpan=0;this.center={origin:p.create(),direction:p.create()};for(a=0;4>a;a++)this.extent[a]={origin:p.create(),direction:p.create(),cap:{next:null,direction:p.create()}},this.planes[a]=n.create();this.planes[k.PlaneIndex.NEAR]=n.create();this.planes[k.PlaneIndex.FAR]=n.create();this.planesWithoutFar=this.planes.slice(0,
5)}var q=F.prototype;q.update=function(a,b,c,e=!0){const l=this.extent;this._toRenderBoundingExtent(a,b,c);d.add(this.center.origin,l[0].origin,l[2].origin);d.scale(this.center.origin,this.center.origin,.5);this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction);e||d.scale(this.center.direction,this.center.direction,-1);for(c=0;4>c;c++){const g=l[c];this.renderCoordsHelper.worldUpAtPosition(g.origin,g.direction);const r=l[3===c?0:c+1];g.cap.next=r.origin;d.direction(g.cap.direction,
g.origin,r.origin);n.fromVectorsAndPoint(g.direction,g.cap.direction,g.origin,this.planes[c]);e||d.scale(g.direction,g.direction,-1)}n.fromVectorsAndPoint(l[0].cap.direction,l[1].cap.direction,l[0].origin,this.planes[k.PlaneIndex.NEAR]);e?n.negate(this.planes[k.PlaneIndex.NEAR],this.planes[k.PlaneIndex.FAR]):(n.copy(this.planes[k.PlaneIndex.FAR],this.planes[k.PlaneIndex.NEAR]),n.negate(this.planes[k.PlaneIndex.NEAR],this.planes[k.PlaneIndex.NEAR]));this.maxSpan=Math.max(Math.abs(a[0]-a[2]),Math.abs(a[1]-
a[3]));this.maxSpanSpatialReference=b;this.minGlobalAltitude=.9*L.getReferenceEllipsoid(this.maxSpanSpatialReference).radius};q.isVisibleInFrustum=function(a,b,c=!1){if(null==a)return!1;if(this.renderCoordsHelper.viewingMode===w.ViewingMode.Global){if(this.maxSpan>(this.maxSpanSpatialReference.isGeographic?N:E*b))return!0;if(a.altitude>=this.minGlobalAltitude)return this._isVisibleInFrustumGlobal(a)}if(0===this.maxSpan)return b=this.extent[0],!c&&a.intersectsRay(D.wrap(b.origin,b.direction))?!0:!1;
for(b=0;b<this.extent.length;b++){var e=this.extent[b];if(!c&&a.intersectsRay(D.wrap(e.origin,e.direction))||a.intersectsLineSegment(C.fromPoints(e.origin,e.cap.next,O),e.cap.direction))return!0}c=c?this.planes:this.planesWithoutFar;for(b=0;b<a.lines.length;b++)if(e=a.lines[b],M.frustumLineSegment(c,e.origin,e.endpoint,e.direction))return!0;return!1};q._toRenderBoundingExtentGlobal=function(a,b,c){B.center(a,h);h[2]=c;u.computeTranslationToOriginAndRotation(b,h,x,this.renderCoordsHelper.spatialReference);
K.invert(G,x);v.empty(f);for(const {x0:e,x1:l,y0:g,y1:r}of P)for(let y=0;5>y;y++){const H=y/4;h[0]=z.lerp(a[e],a[l],H);h[1]=z.lerp(a[g],a[r],H);h[2]=c;u.projectVectorToVector(h,b,h,this.renderCoordsHelper.spatialReference);d.transformMat4(h,h,G);v.expandWithVec3(f,h)}d.set(this.extent[0].origin,f[0],f[1],f[2]);d.set(this.extent[1].origin,f[3],f[1],f[2]);d.set(this.extent[2].origin,f[3],f[4],f[2]);d.set(this.extent[3].origin,f[0],f[4],f[2]);for(a=0;4>a;++a)d.transformMat4(this.extent[a].origin,this.extent[a].origin,
x)};q._toRenderBoundingExtentLocal=function(a,b,c){u.projectBoundingRect(a,b,m,this.renderCoordsHelper.spatialReference);d.set(this.extent[0].origin,m[0],m[1],c);d.set(this.extent[1].origin,m[2],m[1],c);d.set(this.extent[2].origin,m[2],m[3],c);d.set(this.extent[3].origin,m[0],m[3],c)};q._toRenderBoundingExtent=function(a,b,c){switch(this.renderCoordsHelper.viewingMode){case w.ViewingMode.Global:this._toRenderBoundingExtentGlobal(a,b,c);break;case w.ViewingMode.Local:this._toRenderBoundingExtentLocal(a,
b,c);break;default:J.neverReached(this.renderCoordsHelper.viewingMode)}};q._isVisibleInFrustumGlobal=function(a){if(0>d.dot(this.center.direction,a.direction))return!0;for(let b=0;4>b;b++)if(0>d.dot(this.extent[b].direction,a.direction))return!0;return!1};return F}();const P=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],h=p.create(),x=A.create(),G=A.create(),f=v.create(),m=B.create(),O=C.create();t.FrustumExtentIntersection=I;t.default=I;Object.defineProperty(t,
"__esModule",{value:!0})});