// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("exports ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../ViewingMode ../../../chunks/SunCalc".split(" "),function(E,F,B,S,v,w,O,C){function T(d,h,l,e){const k=aa,g=B.identity(ba);if(l===O.ViewingMode.Global)C.SunCalc.getPosition(d,0,0,k),v.set(e,0,0,-1),B.rotateX(g,g,-k.azimuth),B.rotateY(g,g,-k.altitude);else{var b=x.planarDirection;l=b.globalAngles;b=(Math.abs(h[2])-b.localAltitude)/(b.globalAltitude-b.localAltitude);
b=F.clamp(b,0,1);1>b?(C.SunCalc.getPosition(d,h[1],h[0],k),k.azimuth=(1-b)*k.azimuth+b*l.azimuth,k.altitude=(1-b)*k.altitude+b*l.altitude):(k.azimuth=l.azimuth,k.altitude=l.altitude);v.set(e,0,-1,0);B.rotateZ(g,g,-k.azimuth);B.rotateX(g,g,-k.altitude)}v.transformMat4(e,e,g)}function U(d){switch(d){case "disabled":case "sunny":return{direct:1,ambient:1};case "cloudy":return{direct:1,ambient:1};case "rainy":return{direct:.4,ambient:1.2};case "snowy":return{direct:.5,ambient:1.3};case "foggy":return{direct:.2,
ambient:1.6}}}function V(d,h){const l=(d[0]+d[1]+d[2])/3;for(let e=0;3>e;e++)d[e]+=(l-d[e])*h;return d}function m(d,h,l,e){const k=[];for(let g=0;g<l.length;g++)k[g]=(e[g]-l[g])*d/h+l[g];return k}const x={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8E5,ambient:.015,direct:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}},ca=w.fromValues(.5773502691896258,
-.5773502691896258,.5773502691896258),ba=S.create(),aa={azimuth:0,altitude:0},W=new Date(0),G=S.create(),H=w.create();E.ColorAndIntensity=function(){this.ambient={color:w.fromValues(1,1,1),intensity:.55};this.direct={color:w.fromValues(1,1,1),intensity:.55,directionToLightSource:w.clone(ca)};this.noonFactor=.5;this.globalFactor=0;this.environmentStrength=this.specularStrength=1};E.computeColorAndIntensity=function(d,h,l,e,k,g,b){v.set(b.ambient.color,1,1,1);b.ambient.intensity=x.global.ambient;v.set(b.direct.color,
1,1,1);b.direct.intensity=x.global.direct;var q=F.clamp((Math.abs(h[2])-x.local.altitude)/(x.global.altitude-x.local.altitude),0,1);b.globalFactor=q;var y;"sun"===g&&(y=C.SunCalc.getTimes(d,h[1],h[0]));if(1>q){if("sun"===g){{var n=y;var a=d.valueOf();if(n.polarException===C.SunCalc.PolarException.MIDNIGHT_SUN){var p=a-36E5*(d.getHours()+48)-6E4*d.getMinutes();var f=p+432E6}else n.polarException===C.SunCalc.PolarException.POLAR_NIGHT?(p=a-2,f=a-1):(p=n.sunrise.valueOf(),f=n.sunset.valueOf());var z=
f-p;n=p+z/2;var r=z/4;var t=n-r;r=n+r;var A=.06*z;z=p-A/2;p+=A/2;const D=f-A/2,P=f+A/2;f=x.local;A=[.01,f.ambientAtNight];const Q=[.8,.8,1],R=[.01,.01,.01],I=[f.directAtTwilight,f.ambientAtTwilight],J=[1,.6,.5],K=[.8,.8,1],L=[.9*f.directAtNoon,f.ambientAtNoon],M=[1,.98,.98],N=[.98,.98,1],X=[f.directAtNoon,f.ambientAtNoon],Y=[1,1,1],Z=[1,1,1];f=[0,0];let u=[0,0,0];var c=[0,0,0];a<z||a>P?(f=A,u=R,c=Q):a<p?(c=p-z,f=m(a-z,c,A,I),u=m(a-z,c,R,J),c=m(a-z,c,Q,K)):a<t?(c=t-p,f=m(a-p,c,I,L),u=m(a-p,c,J,M),
c=m(a-p,c,K,N)):a<n?(c=n-t,f=m(a-t,c,L,X),u=m(a-t,c,M,Y),c=m(a-t,c,N,Z)):a<r?(c=r-n,f=m(a-n,c,X,L),u=m(a-n,c,Y,M),c=m(a-n,c,Z,N)):a<D?(c=D-r,f=m(a-r,c,L,I),u=m(a-r,c,M,J),c=m(a-r,c,N,K)):a<P&&(c=P-D,f=m(a-D,c,I,A),u=m(a-D,c,J,R),c=m(a-D,c,K,Q));a=0;switch(e){case "rainy":case "foggy":a=.9;case "snowy":a=.5}0<a&&(u=V(u,a),c=V(c,a));n=w.fromValues(u[0],u[1],u[2]);t=w.fromValues(c[0],c[1],c[2]);r=U(e);a=f[0]*r.direct;f=f[1]*r.ambient}}else t=U(e),a=x.local.directAtNoon*t.direct,n=w.fromValues(1,1,1),
f=x.local.ambientAtNoon*t.ambient,t=w.fromValues(1,1,1);v.lerp(b.ambient.color,t,b.ambient.color,q);b.ambient.intensity=F.lerp(f,b.ambient.intensity,q);v.lerp(b.direct.color,n,b.direct.color,q);b.direct.intensity=F.lerp(a,b.direct.intensity,q);b.specularStrength="rainy"===e||"snowy"===e||"foggy"===e?0:1;b.environmentStrength="rainy"===e?.7:"snowy"===e||"foggy"===e?.75:1}"sun"===g?(e=d.valueOf(),y.polarException===C.SunCalc.PolarException.MIDNIGHT_SUN?(q=e-36E5*(d.getHours()+48)-6E4*d.getMinutes(),
y=q+432E6):y.polarException===C.SunCalc.PolarException.POLAR_NIGHT?(q=e-2,y=e-1):(q=y.sunrise.valueOf(),y=y.sunset.valueOf()),e=1-F.clamp(Math.abs(e-(q+(y-q)/2))/432E5,0,1)):e=1;b.noonFactor=e;"sun"===g?T(d,h,l,b.direct.directionToLightSource):(d=b.direct.directionToLightSource,l===O.ViewingMode.Global?v.normalize(H,k.eye):v.set(H,0,0,1),B.fromRotation(G,.35,k.viewRight),v.transformMat4(d,H,G),B.fromRotation(G,-.5,H),v.transformMat4(d,d,G))};E.computeDirectionsOverTime=function(d,h,l,e,k){d=d.getTime();
h=h.getTime()-d;h=Math.floor(h/l)+1;const g=Array(h);for(let b=0;b<h;++b)W.setTime(d+l*b),g[b]=w.create(),T(W,e,k,g[b]);return g};E.computeShadowsEnabled=function(d,h){return h===O.ViewingMode.Global?!0:Math.abs(d)<x.planarDirection.localAltitude};Object.defineProperty(E,"__esModule",{value:!0})});