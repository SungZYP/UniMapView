// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/axisAngle ../../../../geometry/support/coordinateSystem ../../../../geometry/support/plane ../../../../chunks/sphere ../../../../geometry/support/vector ../../../../geometry/support/vectorStacks ../../support/mathUtils ../../support/geometryUtils/ray ../../support/geometryUtils/sphere ../../webgl-engine/lib/Camera".split(" "),
function(h,q,va,wa,r,Q,xa,ya,d,n,F,C,D,R,za,w,y,G,Z,Aa){function S(b,c,a){a=r.fromRotation(w.sm4d.get(),a[3],F.axis(a));d.subtract(k,b.eye,c);d.transformMat4(k,k,a);b.eye=d.add(k,k,c);d.subtract(k,b.center,c);d.transformMat4(k,k,a);b.center=d.add(k,k,c);b.up=d.transformMat4(k,b.up,a)}function aa(b,c){d.set(c,0,0,0);for(const a of b)d.add(c,c,a);d.scale(c,c,1/b.length)}function ba(b,c,a,e){return Math.sin(b/d.length(c))*(a+e.radius)}function ca(b,c,a,e){a=G.fromScreenAtEye(c,a,T);if(va.isNone(a))return!1;
R.closestPointOnSilhouette(b,a,H);return R.intersectRay(b,a,e)?d.squaredDistance(H,a.origin)<d.squaredDistance(e,a.origin)?(d.copy(e,H),!1):!0:(d.subtract(z,c.eye,c.center),d.normalize(z,z),D.fromNormalAndOffset(z,-d.dot(d.normalize(z,z),H),da),D.intersectRay(da,a,e),!1)}function ea(b,c,a,e,g,f){d.cross(I,b,c);d.subtract(J,b,c);d.length(b)<=g||!e.aboveGround?(d.cross(a,J,e.eye),b=d.dot(b,c)/(d.length(b)*d.length(c)),f=Math.cos(q.clamp(y.cyclicalPI.normalize(q.deg2rad(f)),0,U)),c=-q.acosClamped(b)-
Math.max(0,d.length(c)-g)/(f*g)):(d.subtract(fa,e.eye,e.center),d.cross(a,J,fa),c=-d.length(J)/g);d.normalize(a,a);d.scale(a,a,d.length(I));return c}function V(b,c,a,e){e=Math.cos(q.clamp(y.cyclicalPI.normalize(q.deg2rad(e)),0,U));c=c>a?-(c-a)/(e*a):c<-a?Math.PI-(c+a)/(e*a):q.acosClamped(c/a);return((b>a?-(b-a)/(e*a):b<-a?Math.PI-(b+a)/(e*a):q.acosClamped(b/a))-c)*a}function ha(b,c,a,e,g,f,l,m,p,t){p=V(b[2],c[2],l[3],p);c=t?V(b[0],c[0],l[3],180):c[0]-b[0];b=Math.sin(m)*c-Math.cos(m)*p;m=Math.cos(m)*
c+Math.sin(m)*p;d.normalize(k,g);g=t?b/Math.sqrt(Math.abs(l[3]**2-d.dot(a,k)**2)):b/l[3];a=m/Math.sqrt(Math.abs(l[3]**2-d.dot(a,e)**2));xa.set(f,g,a)}function ia(b,c,a,e,g,f,l,m,p,t){d.cross(I,b,c);C.coordinateSystemFromOneAxisAndNormalVector(f.up,f.eye,K,L,M);C.coordinateSystemFromOneAxisAndNormalVector([0,0,1],f.eye,u,v,ja);d.copy(a,v);d.copy(e,u);d.normalize(a,a);d.scale(a,a,d.length(I));C.vectorCoordinates(b,d.normalize(L,L),d.normalize(M,M),d.normalize(K,K),ka);C.vectorCoordinates(c,L,M,K,la);
ha(ka,la,b,u,v,g,l,m,p,t)}function ma(b,c,a,e,g,f,l){r.fromRotation(N,g,e);r.fromRotation(O,l,f);r.multiply(A,N,O);d.subtract(c,b,a);d.transformMat4(c,c,A);d.add(c,c,a)}function na(b,c,a,e,g,f){r.fromRotation(N,e,a);r.fromRotation(O,f,g);r.multiply(A,N,O);d.subtract(k,b.eye,c);d.transformMat4(k,k,A);b.eye=d.add(k,k,c);d.subtract(k,b.center,c);d.transformMat4(k,k,A);b.center=d.add(k,k,c);d.subtract(k,b.up,c);d.transformMat4(k,k,A);b.up=d.add(k,k,c)}function W(b,c,a,e,g,f,l=B.Pole,m=B.Angle){b=Math.abs(b[2])<
a*l||Math.abs(c)>a;return(Math.abs(e)>Math.PI-m||Math.abs(e)<m)&&b&&f.aboveGround&&g<B.Tilt?!0:!1}function oa(b,c,a,e,g,f){f?(F.fromPoints(a,e,pa),S(c,b,pa)):(a=ea(a,e,qa,c,b[3],g),S(c,b,F.wrapAxisAngle(qa,a)))}function ra(b,c,a,e,g,f,l){const m=l?20:1;d.copy(x,e);P.copyFrom(c);let p;for(let t=0;t<m&&1E-12<d.squaredDistance(a,x);t++)if(e=d.squaredDistance(a,x),ia(a,x,v,u,E,P,b,g,f,l),na(P,b,u,E[1],v,E[0]),ma(x,x,b,u,E[1],v,E[0]),p=d.squaredDistance(a,x),p<e||0===t)c.copyFrom(P);else break}const sa=
wa.createScreenPointArray();h.NavigationMode=void 0;(function(b){b[b.Vertical=0]="Vertical";b[b.Horizontal=1]="Horizontal"})(h.NavigationMode||(h.NavigationMode={}));const X={Elevation:3E4,Angle:q.deg2rad(6)},B={Pole:.95,Angle:q.deg2rad(18),Tilt:45},U=q.deg2rad(80),Y=n.create(),H=n.create(),z=n.create(),da=D.create(),fa=n.create(),u=n.create(),v=n.create(),ja=n.create(),K=n.create(),L=n.create(),M=n.create(),ka=n.create(),la=n.create(),E=ya.create(),pa=F.create(),N=Q.create(),O=Q.create(),A=Q.create(),
x=n.create(),k=n.create(),J=n.create(),P=new Aa.default,I=n.create(),qa=n.create(),T={origin:n.create(),direction:n.create()},ta={origin:n.create(),direction:n.create()};h.DISTANCE_CLAMP_VALUES=[1,3E8];h.PIVOT_DISTANCE_MODIFIER=30;h.PreservingHeadingThreshold=B;h.SCREEN_PIXEL_AREA=70;h.TiltThresholdPanningSpeed=U;h.VerticalPanTresholds=X;h.applyPanPlanar=function(b,c,a){d.subtract(Y,a,c);b.eye=d.subtract(k,b.eye,Y);b.center=d.subtract(k,b.center,Y)};h.applyPanSphericalDirectRotation=oa;h.applyPanSphericalPreserveHeading=
ra;h.applyRotation=S;h.applyRotationWithTwoAxes=na;h.applyZoomOnSphere=function(b,c,a){c.getScreenCenter(sa);Z.intersectScreen(b,c,sa,k)&&(c.center=k);b=c.distance;a*=b;1E-6>Math.abs(b-a)||(a=d.scale(w.sv3d.get(),c.viewForward,a),c.eye=d.subtract(k,c.center,a))};h.applyZoomToPoint=function(b,c,a,e){const g=w.sv3d.get();a=1-a;d.subtract(g,c,b.eye);const f=d.length(g);let l=f*(1-a);0<=a&&l<e&&(l=e,a=-(l-f)/f);1E-6>Math.abs(f-l)||(d.scale(g,g,a),b.eye=d.add(k,b.eye,g),b.center=d.lerp(k,b.center,c,a))};
h.centroid=aa;h.centroidOnSphere=function(b,c,a){aa(c,a);d.normalize(a,a);d.scale(a,a,b)};h.decideNavigationMode=function(b,c,a,e){if(d.length(b.eye)-e.radius>X.Elevation)return h.NavigationMode.Horizontal;if(!a)return h.NavigationMode.Vertical;G.fromScreenAtEye(b,c,ta);return-Math.sign(b.relativeElevation)*(.5*Math.PI+za.angle(b.eye,ta.direction))<X.Angle?h.NavigationMode.Vertical:h.NavigationMode.Horizontal};h.intersectPlaneFromScreenPoint=function(b,c,a,e){return D.intersectRay(b,G.fromScreen(c,
a,T),e)};h.intersectPlaneFromScreenPointAtEye=function(b,c,a,e){return D.intersectRay(b,G.fromScreenAtEye(c,a,T),e)};h.lengthFromPoints=V;h.normalizeCoordinate=function(b,c,a){a[0]=c[0]/(b.fullWidth/b.pixelRatio);a[1]=c[1]/(b.fullHeight/b.pixelRatio);return a};h.normalizeRotationDelta=function(b){for(;b>Math.PI;)b-=2*Math.PI;for(;b<-Math.PI;)b+=2*Math.PI;return b};h.offSurfaceTiltToEyeTiltGlobal=function(b,c,a,e){return ba(Math.PI/2,c,a,e)+(b-Math.PI/2)};h.onSurfaceTiltToEyeTiltGlobal=ba;h.panMotionToRotationMatrix=
function(b,c,a,e,g,f,l,m,p){if(W(b.center,d.dot(b.up,b.center),d.length(b.center),-y.cyclicalPI.normalize(q.deg2rad(f)),l,c))switch(b=-y.cyclicalPI.normalize(q.deg2rad(g)),{eye:g}=c,C.coordinateSystemFromOneAxisAndNormalVector([0,0,1],g,u,v,ja),g=a.translation[0]*e.pan,f="zoom"===p.mode?0:a.translation[1]*e.pan,c=Math.max(Math.sqrt(Math.abs(1-d.dot(c.center,u)**2/d.length(c.center)**2)),.5),l=-Math.cos(b)*f+Math.sin(b)*g,r.rotate(m.pan.matrix,m.pan.matrix,(Math.sin(b)*f+Math.cos(b)*g)/c,u),m.pan.enabled=
!0,p.mode){case "pan":r.rotate(m.pan.matrix,m.pan.matrix,l,v);m.pan.enabled=!0;break;case "zoom":m.zoom=-a.translation[1]*e.zoom}else{{const {eye:t,viewRight:ua}=c;c=d.cross(w.sv3d.get(),ua,t);b=a.translation[0]*e.pan;0!==b&&(r.rotate(m.pan.matrix,m.pan.matrix,-b,c),m.pan.enabled=!0);switch(p.mode){case "pan":a=a.translation[1]*e.pan;0!==a&&(r.rotate(m.pan.matrix,m.pan.matrix,a,ua),m.pan.enabled=!0);break;case "zoom":m.zoom=-a.translation[1]*e.zoom}}}};h.panToPosition=function(b,c,a,e,g,f,l){W(a,
d.dot(c.up,a),b[3],-y.cyclicalPI.normalize(q.deg2rad(g)),f,c,B.Pole,B.Angle)?ra(b,c,a,e,-y.cyclicalPI.normalize(q.deg2rad(g)),f,l):oa(b,c,a,e,f,l)};h.pickPointAndInitSphere=function(b,c,a,e,g){const f=n.create(),l=R.create();let m=!0,p=!0;b.intersectScreen(a,f)?l[3]=d.length(f):(p=!1,l[3]=c.aboveGround?Math.max(d.length(c.center),.9*g.radius):d.length(c.eye)-c.relativeElevation,e?ca(l,c,a,f):m=Z.intersectScreen(l,c,a,f));return{sphere:l,scenePickPoint:m?f:null,hasGeometryIntersection:p}};h.preserveHeadingThreshold=
W;h.rotatePointAroundTwoAxes=ma;h.rotationAngleAndAxisDirectRotation=ea;h.rotationAnglesAndAxesHeadingPreserving=ia;h.rotationAnglesHeadingPreserving=ha;h.rotationFromPointsAroundAxis=function(b,c,a){const e=w.sv3d.get(),g=w.sv3d.get(),f=w.sv3d.get();d.copy(g,b);d.copy(f,c);b=d.dot(g,a);c=d.dot(f,a);d.scale(e,a,b);d.subtract(g,g,e);d.normalize(g,g);d.scale(e,a,c);d.subtract(f,f,e);d.normalize(f,f);b=d.dot(g,f);d.cross(e,a,g);a=d.dot(f,e);return Math.atan2(a,b)};h.sphereOrPlanePointFromScreenPoint=
ca;Object.defineProperty(h,"__esModule",{value:!0})});