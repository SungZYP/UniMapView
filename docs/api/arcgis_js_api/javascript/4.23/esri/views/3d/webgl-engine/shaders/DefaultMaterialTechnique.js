// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/maybe ../../../../chunks/vec3f64 ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/DoublePrecision.glsl ../core/shaderLibrary/util/View.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../materials/internal/MaterialUtil ../../../../chunks/DefaultMaterial.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(E,v,z,f,q,F,G,h,H,I,A,B,J,K,L,C,r,M,N,O,w,d,P,e,k,Q,t,R,x,y,S,D,u){const T=q.getLogger("esri.views.3d.webgl-engine.shaders.DefaultTechnique");q=function(m){function l(){return m.apply(this,arguments)||this}z._inheritsLoose(l,m);var b=l.prototype;b.initializeProgram=function(c){var g=l.shader.get();const a=this.configuration;g=g.build({oitEnabled:a.transparencyPassType===k.TransparencyPassType.Color,output:a.output,viewingMode:c.viewingMode,receiveShadows:a.receiveShadows,slicePlaneEnabled:a.slicePlaneEnabled,
sliceHighlightDisabled:a.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:a.symbolColors,vvSize:a.vvSize,vvColor:a.vvColor,vvInstancingEnabled:!0,instanced:a.instanced,instancedColor:a.instancedColor,instancedDoublePrecision:a.instancedDoublePrecision,pbrMode:a.usePBR?a.isSchematic?r.PBRMode.Schematic:r.PBRMode.Normal:r.PBRMode.Disabled,hasMetalnessAndRoughnessTexture:a.hasMetalnessAndRoughnessTexture,hasEmissionTexture:a.hasEmissionTexture,hasOcclusionTexture:a.hasOcclusionTexture,
hasNormalTexture:a.hasNormalTexture,hasColorTexture:a.hasColorTexture,hasModelTransformation:a.hasModelTransformation,receiveAmbientOcclusion:a.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:a.normalsTypeDerivate?A.NormalAttributeType.ScreenDerivative:A.NormalAttributeType.Attribute,doubleSidedMode:a.doubleSidedMode,vertexTangents:a.vertexTangents,attributeTextureCoordinates:a.hasMetalnessAndRoughnessTexture||a.hasEmissionTexture||a.hasOcclusionTexture||a.hasNormalTexture||a.hasColorTexture?
B.TextureCoordinateAttributeType.Default:B.TextureCoordinateAttributeType.None,textureAlphaPremultiplied:a.textureAlphaPremultiplied,attributeColor:a.vertexColors,screenSizePerspectiveEnabled:a.screenSizePerspective,verticalOffsetEnabled:a.verticalOffset,offsetBackfaces:a.offsetBackfaces,doublePrecisionRequiresObfuscation:O.doublePrecisionRequiresObfuscation(c.rctx),alphaDiscardMode:a.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:a.multipassTerrainEnabled,cullAboveGround:a.cullAboveGround});
return new R.Program(c.rctx,g,Q.Default3D)};b.bindPass=function(c,g){var a,p;w.bindProjectionMatrix(this.program,g.camera.projectionMatrix);const n=this.configuration.output;this.configuration.hasModelTransformation&&(F.isSome(c.modelTransformation)?this.program.setUniformMatrix4fv("model",c.modelTransformation):T.warnOnce("hasModelTransformation true, but no modelTransformation found."));(this.configuration.output===h.ShaderOutput.Depth||g.multipassTerrainEnabled||n===h.ShaderOutput.Shadow)&&this.program.setUniform2fv("nearFar",
g.camera.nearFar);g.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",g.inverseViewport),L.bindMultipassTerrainTexture(this.program,g));n===h.ShaderOutput.Alpha&&(this.program.setUniform1f("opacity",c.opacity),this.program.setUniform1f("layerOpacity",c.layerOpacity),this.program.setUniform4fv("externalColor",c.externalColor),this.program.setUniform1i("colorMixMode",y.colorMixModes[c.colorMixMode]));n===h.ShaderOutput.Color?(g.lighting.setUniforms(this.program,!1,g.hasFillLights),
this.program.setUniform3fv("ambient",c.ambient),this.program.setUniform3fv("diffuse",c.diffuse),this.program.setUniform4fv("externalColor",c.externalColor),this.program.setUniform1i("colorMixMode",y.colorMixModes[c.colorMixMode]),this.program.setUniform1f("opacity",c.opacity),this.program.setUniform1f("layerOpacity",c.layerOpacity),this.configuration.usePBR&&r.bindPBRUniforms(this.program,c,this.configuration.isSchematic)):n===h.ShaderOutput.Highlight&&K.bindOutputHighlight(this.program,g);N.bindVisualVariablesUniformsForSymbols(this.program,
c);J.bindVerticalOffsetUniforms(this.program,c,g);y.bindScreenSizePerspective(c.screenSizePerspective,this.program,"screenSizePerspectiveAlignment");c.textureAlphaMode!==k.AlphaDiscardMode.Mask&&c.textureAlphaMode!==k.AlphaDiscardMode.MaskBlend||this.program.setUniform1f("textureAlphaCutoff",c.textureAlphaCutoff);null==(a=g.shadowMap)?void 0:a.bind(this.program);null==(p=g.ssaoHelper)?void 0:p.bind(this.program,g.camera)};b.bindDraw=function(c){const g=this.configuration.instancedDoublePrecision?
G.fromValues(c.camera.viewInverseTransposeMatrix[3],c.camera.viewInverseTransposeMatrix[7],c.camera.viewInverseTransposeMatrix[11]):c.origin;w.bindViewCustomOrigin(this.program,g,c.camera.viewMatrix);this.program.rebindTextures();(this.configuration.output===h.ShaderOutput.Color||this.configuration.output===h.ShaderOutput.Alpha||this.configuration.output===h.ShaderOutput.Depth&&this.configuration.screenSizePerspective||this.configuration.output===h.ShaderOutput.Normal&&this.configuration.screenSizePerspective||
this.configuration.output===h.ShaderOutput.Highlight&&this.configuration.screenSizePerspective)&&w.bindCameraPosition(this.program,g,c.camera.viewInverseTransposeMatrix);this.configuration.output===h.ShaderOutput.Normal&&this.program.setUniformMatrix4fv("viewNormal",c.camera.viewInverseTransposeMatrix);this.configuration.instancedDoublePrecision&&I.bindCustomOrigin(this.program,g);H.bindSliceUniforms(this.program,this.configuration,c.slicePlane,{origin:g});this.configuration.output===h.ShaderOutput.Color&&
M.bindReadShadowMapViewCustomOrigin(this.program,c,g)};b._convertDepthTestFunction=function(c){return c===k.DepthTestFunction.Lequal?D.CompareFunction.LEQUAL:D.CompareFunction.LESS};b._setPipeline=function(c,g){const a=this.configuration,p=c===k.TransparencyPassType.NONE,n=c===k.TransparencyPassType.FrontFace;return u.makePipelineState({blending:a.output!==h.ShaderOutput.Color&&a.output!==h.ShaderOutput.Alpha||!a.transparent?null:p?t.blendingDefault:t.oitBlending(c),culling:(a.cullFace?a.cullFace!==
k.CullFaceOptions.None:a.slicePlaneEnabled?!1:!a.transparent&&!a.doubleSidedMode)&&u.cullingParams(a.cullFace),depthTest:{func:t.oitDepthTest(c,this._convertDepthTestFunction(a.customDepthTest))},depthWrite:p||n?a.writeDepth&&u.defaultDepthWriteParams:null,colorWrite:u.defaultColorWriteParams,stencilWrite:a.sceneHasOcludees?x.stencilWriteMaskOn:null,stencilTest:a.sceneHasOcludees?g?x.stencilToolMaskBaseParams:x.stencilBaseAllZerosParams:null,polygonOffset:p||n?null:t.getOITPolygonOffset(a.enableOffset)})};
b.initializePipeline=function(){this._occludeePipelineState=this._setPipeline(this.configuration.transparencyPassType,!0);return this._setPipeline(this.configuration.transparencyPassType,!1)};b.getPipelineState=function(c,g){return g?this._occludeePipelineState:m.prototype.getPipelineState.call(this,c,g)};return l}(P.ShaderTechnique);q.shader=new d.ReloadableShaderModule(S.DefaultMaterialShader,()=>new Promise((m,l)=>E(["./DefaultMaterial.glsl"],m,l)));d=function(m){function l(){var b=m.apply(this,
arguments)||this;b.output=h.ShaderOutput.Color;b.alphaDiscardMode=k.AlphaDiscardMode.Opaque;b.doubleSidedMode=C.NormalsDoubleSidedMode.None;b.isSchematic=!1;b.vertexColors=!1;b.offsetBackfaces=!1;b.symbolColors=!1;b.vvSize=!1;b.vvColor=!1;b.verticalOffset=!1;b.receiveShadows=!1;b.slicePlaneEnabled=!1;b.sliceHighlightDisabled=!1;b.receiveAmbientOcclusion=!1;b.screenSizePerspective=!1;b.textureAlphaPremultiplied=!1;b.hasColorTexture=!1;b.usePBR=!1;b.hasMetalnessAndRoughnessTexture=!1;b.hasEmissionTexture=
!1;b.hasOcclusionTexture=!1;b.hasNormalTexture=!1;b.instanced=!1;b.instancedColor=!1;b.instancedDoublePrecision=!1;b.vertexTangents=!1;b.normalsTypeDerivate=!1;b.writeDepth=!0;b.sceneHasOcludees=!1;b.transparent=!1;b.enableOffset=!0;b.cullFace=k.CullFaceOptions.None;b.transparencyPassType=k.TransparencyPassType.NONE;b.multipassTerrainEnabled=!1;b.cullAboveGround=!1;b.hasModelTransformation=!1;b.customDepthTest=k.DepthTestFunction.Less;return b}z._inheritsLoose(l,m);return l}(e.ShaderTechniqueConfiguration);
f.__decorate([e.parameter({count:h.ShaderOutput.COUNT})],d.prototype,"output",void 0);f.__decorate([e.parameter({count:k.AlphaDiscardMode.COUNT})],d.prototype,"alphaDiscardMode",void 0);f.__decorate([e.parameter({count:C.NormalsDoubleSidedMode.COUNT})],d.prototype,"doubleSidedMode",void 0);f.__decorate([e.parameter()],d.prototype,"isSchematic",void 0);f.__decorate([e.parameter()],d.prototype,"vertexColors",void 0);f.__decorate([e.parameter()],d.prototype,"offsetBackfaces",void 0);f.__decorate([e.parameter()],
d.prototype,"symbolColors",void 0);f.__decorate([e.parameter()],d.prototype,"vvSize",void 0);f.__decorate([e.parameter()],d.prototype,"vvColor",void 0);f.__decorate([e.parameter()],d.prototype,"verticalOffset",void 0);f.__decorate([e.parameter()],d.prototype,"receiveShadows",void 0);f.__decorate([e.parameter()],d.prototype,"slicePlaneEnabled",void 0);f.__decorate([e.parameter()],d.prototype,"sliceHighlightDisabled",void 0);f.__decorate([e.parameter()],d.prototype,"receiveAmbientOcclusion",void 0);
f.__decorate([e.parameter()],d.prototype,"screenSizePerspective",void 0);f.__decorate([e.parameter()],d.prototype,"textureAlphaPremultiplied",void 0);f.__decorate([e.parameter()],d.prototype,"hasColorTexture",void 0);f.__decorate([e.parameter()],d.prototype,"usePBR",void 0);f.__decorate([e.parameter()],d.prototype,"hasMetalnessAndRoughnessTexture",void 0);f.__decorate([e.parameter()],d.prototype,"hasEmissionTexture",void 0);f.__decorate([e.parameter()],d.prototype,"hasOcclusionTexture",void 0);f.__decorate([e.parameter()],
d.prototype,"hasNormalTexture",void 0);f.__decorate([e.parameter()],d.prototype,"instanced",void 0);f.__decorate([e.parameter()],d.prototype,"instancedColor",void 0);f.__decorate([e.parameter()],d.prototype,"instancedDoublePrecision",void 0);f.__decorate([e.parameter()],d.prototype,"vertexTangents",void 0);f.__decorate([e.parameter()],d.prototype,"normalsTypeDerivate",void 0);f.__decorate([e.parameter()],d.prototype,"writeDepth",void 0);f.__decorate([e.parameter()],d.prototype,"sceneHasOcludees",
void 0);f.__decorate([e.parameter()],d.prototype,"transparent",void 0);f.__decorate([e.parameter()],d.prototype,"enableOffset",void 0);f.__decorate([e.parameter({count:k.CullFaceOptions.COUNT})],d.prototype,"cullFace",void 0);f.__decorate([e.parameter({count:k.TransparencyPassType.COUNT})],d.prototype,"transparencyPassType",void 0);f.__decorate([e.parameter()],d.prototype,"multipassTerrainEnabled",void 0);f.__decorate([e.parameter()],d.prototype,"cullAboveGround",void 0);f.__decorate([e.parameter()],
d.prototype,"hasModelTransformation",void 0);f.__decorate([e.parameter({count:k.DepthTestFunction.COUNT})],d.prototype,"customDepthTest",void 0);v.DefaultMaterialTechnique=q;v.DefaultMaterialTechniqueConfiguration=d;Object.defineProperty(v,"__esModule",{value:!0})});