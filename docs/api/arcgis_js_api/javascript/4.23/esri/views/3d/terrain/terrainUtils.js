// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("exports ../../../core/Collection ../../../core/maybe ../../../geometry/support/spatialReferenceUtils ../../../layers/support/layerUtils ../../ViewingMode ../support/StreamDataLoader ../../../chunks/terrainUtilsPlanar ../../../chunks/terrainUtilsSpherical".split(" "),function(c,B,f,p,q,k,C,D,E){function r(a){return"vector-tile"===(null==a?void 0:a.type)}function l(a){return"imagery-tile"===(null==a?void 0:a.type)||"wcs"===(null==a?void 0:a.type)}function m(a){return"imagery-tile-3d"===(null==
a?void 0:a.type)}function t(a){return"tile-3d"===(null==a?void 0:a.type)}function u(a){return"vector-tile-3d"===(null==a?void 0:a.type)}function v(a){return"wmts-3d"===(null==a?void 0:a.type)}function w(a){return"elevation-3d"===(null==a?void 0:a.type)}function n(a,b,g,d){return x[d].checkIfTileInfoSupportedForViewSR(a,g,b)}function y(a,b,g){a=q.getTileMaxtrixSetFromActiveLayer(a);if(f.isSome(a))if(B.isCollection(a)){if(a=a.find(d=>null==n(d.tileInfo,d.fullExtent,b,g)))return{tileInfo:a.tileInfo,
fullExtent:a.fullExtent}}else return{tileInfo:a.tileInfo,fullExtent:a.fullExtent};return{tileInfo:null,fullExtent:null}}function z(a){return a.isWGS84||a.isWebMercator||p.isCGCS2000(a)||!p.isEarth(a)}const x={[k.ViewingMode.Global]:E.terrainUtilsSpherical,[k.ViewingMode.Local]:D.terrainUtilsPlanar},F=80/180*Math.PI,G=110/180*Math.PI,A={force512VTL:!1};c.checkIfTileInfoSupportedForView=n;c.computeSkirtScale=function(a,b,g){const d=x[a.viewingMode];if(d.isInsideExtent(a,b))var e=f.unwrapOr(a.getElevation(b[0],
b[1],b[1],a.spatialReference),0);else{if(!d.isInsideExtent(a,b,1.2))return 0;var h=a.getTileWithElevation(b[0],b[1],b[1],a.spatialReference);e=f.isSome(h)?h.elevationBounds[0]:a.elevationBounds.min;h=f.isSome(h)?h.elevationBounds[1]:a.elevationBounds.max;e=.5*(e+h);a=d.tiltToExtentEdge(a,b,e);if(a>F&&a<G)return 0}b=b[2]-e;return Math.abs(b)<g?0:0>b?-1:1};c.getLayerWithExtentRange=function(a){return m(a)?{fullExtent:a.fullExtent,minScale:a.layer.minScale,maxScale:a.layer.maxScale,tilemapCache:null}:
a.layer};c.getTileInfoAndExtentFromWMTSLayer=y;c.getTiledLayerInfo=function(a,b,g){var d=null;let e=null;if(q.isWMTSLayer(a))a=y(a,b,g),d=a.tileInfo,e=a.fullExtent;else if(e=l(a)?a.getCompatibleFullExtent(b):a.fullExtent,d=g===k.ViewingMode.Local,l(a))d=a.getCompatibleTileInfo(b,e,d);else if(r(a)){d=d&&!z(b)||A.force512VTL;const h=a.tileInfo.spatialReference.isGeographic;d=d?a.tileInfo:a.tileInfo.getOrCreateCompatible(256,h?1:2)}else d=a.tileInfo;return f.isSome(d)&&f.isSome(e)&&null==n(d,e,b,g)?
{tileInfo:d,fullExtent:e}:null};c.isElevationLayerView=w;c.isImageryTileLayerView=m;c.isImageryTileRenderInfo=function(a){var b;a=null==a?void 0:null==(b=a.sourceLayerInfo)?void 0:b.data;return f.isSome(a)&&"type"in a&&"raster-tile"===a.type};c.isProjectableRasterLayer=l;c.isRasterTileRenderInfo=function(a){var b;a=null==a?void 0:null==(b=a.sourceLayerInfo)?void 0:b.data;return a instanceof HTMLImageElement||a instanceof C.ImageWithType||a instanceof HTMLCanvasElement||a instanceof ImageData};c.isSurfaceLayerView=
function(a){return a&&(t(a)||m(a)||w(a)||u(a)||v(a))};c.isTextureTileRenderInfo=function(a){var b;a=null==a?void 0:null==(b=a.sourceLayerInfo)?void 0:b.data;return f.isSome(a)&&"type"in a&&"tile-texture"===a.type};c.isTileLayerView=t;c.isVectorTileLayer=r;c.isVectorTileLayerView=u;c.isVectorTileRenderInfo=function(a){var b;a=null==a?void 0:null==(b=a.sourceLayerInfo)?void 0:b.data;return f.isSome(a)&&"type"in a&&"vector-tile"===a.type};c.isWMTSLayerView=v;c.releaseTileData=function(a){f.isSome(a)&&
"release"in a&&a.release();return null};c.test=A;c.useFetchTileForLayer=function(a){return a.fetchTile&&!1!==a.hasOverriddenFetchTile};c.vtlAssumes256PixelSizeAsDefault=z;c.weakAssert=function(a,b){a||console.warn("Terrain: "+b)};Object.defineProperty(c,"__esModule",{value:!0})});