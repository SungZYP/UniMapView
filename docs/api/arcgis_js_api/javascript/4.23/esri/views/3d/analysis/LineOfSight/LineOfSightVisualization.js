// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Color ../../../../core/Accessor ../../../../core/Handles ../../../../core/handleUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../interactive/visualElements/LineVisualElement".split(" "),
function(e,E,m,k,G,H,w,g,r,p,R,S,T,I,J,x,d,y){e.LineOfSightVisualization=function(F){function t(a){a=F.call(this,a)||this;a._lineOfSightVisualizations=[];a._handle=null;a._computationHandles=new H;return a}E._inheritsLoose(t,F);var f=t.prototype;f.initialize=function(){this._handle=this._connectAnalysis()};f.destroy=function(){this._handle=g.removeMaybe(this._handle);this._computationHandles=g.destroyMaybe(this._computationHandles)};f.createLineOfSightVisualization=function(){var a=this._configuration,
b={view:this.view,attached:!0,width:a.outerWidth,innerWidth:a.innerWidth},c=k.toUnitRGBA(a.visibleOuterColor);const z=k.toUnitRGBA(a.visibleInnerColor);var q=k.toUnitRGBA(a.occludedOuterColor);const A=k.toUnitRGBA(a.occludedInnerColor),B=k.toUnitRGBA(a.undefinedOuterColor);a=k.toUnitRGBA(a.undefinedInnerColor);c=new y.LineVisualElement({...b,color:c,innerColor:z});q=new y.LineVisualElement({...b,color:q,innerColor:A});b=new y.LineVisualElement({...b,color:B,innerColor:a});b={visibleLineVisualElement:c,
occludedLineVisualElement:q,undefinedLineVisualElement:b};this._lineOfSightVisualizations.push(b);return b};f.destroyLineOfSightVisualization=function(a){a.visibleLineVisualElement=g.destroyMaybe(a.visibleLineVisualElement);a.occludedLineVisualElement=g.destroyMaybe(a.occludedLineVisualElement);a.undefinedLineVisualElement=g.destroyMaybe(a.undefinedLineVisualElement);this._lineOfSightVisualizations.splice(this._lineOfSightVisualizations.indexOf(a),1)};f.updateLineOfSightVisualization=function(a,b){const c=
this._configuration,{computationResult:z,inputPoints:q}=a,{start:A,end:B,intersection:K,isValid:L,isTargetVisible:M}=z;var {observer:h}=q;const n=N;n[12]=h[0];n[13]=h[1];n[14]=h[2];const C=x.subtract(O,A,h),D=x.subtract(P,B,h);h=x.subtract(Q,K,h);const {visibleLineVisualElement:l,occludedLineVisualElement:u,undefinedLineVisualElement:v}=b;a=g.isNone(this.analysisViewData.elevationAlignedObserver)||g.isNone(a.elevationAlignedTargetLocation);a=this.visible&&!a;l.visible=a;u.visible=a;if(v.visible=a)l.geometry=
null,u.geometry=null,v.geometry=null,L?M?(l.geometry=[[d.fromArray(C),d.fromArray(D)]],l.transform=n,l.color=k.toUnitRGBA(c.visibleOuterColor)):(l.geometry=[[d.fromArray(C),d.fromArray(h)]],l.transform=n,l.color=k.toUnitRGBA(c.occludedOuterColor),u.geometry=[[d.fromArray(h),d.fromArray(D)]],u.transform=n):(v.geometry=[[d.fromArray(C),d.fromArray(D)]],v.transform=n)};f.getLineOfSightVisualizationDependencies=function(a){({computationResult:a}=a);const {occludedOuterColor:b,visibleOuterColor:c}=this._configuration;
return{computationResult:a,occludedOuterColor:b,visibleOuterColor:c,visible:this.visible}};f._connectComputation=function(a){const b=this._computationHandles;if(!b.has(a)){var c=this.createLineOfSightVisualization();b.add([r.watch(()=>this.getLineOfSightVisualizationDependencies(a),()=>this.updateLineOfSightVisualization(a,c),r.syncAndInitial),w.makeHandle(()=>this.destroyLineOfSightVisualization(c))],a)}};f._disconnectComputation=function(a){this._computationHandles.remove(a)};f._connectAnalysis=
function(){let a=null;return w.handlesGroup([r.watch(()=>this.analysisViewData.computations,b=>{a=g.removeMaybe(a);a=b.on("change",c=>this._onComputationsCollectionChange(c));this._onComputationsCollectionChange({target:b,added:b.items,removed:[],moved:[]})},r.syncAndInitial),w.makeHandle(()=>a=g.removeMaybe(a))])};f._onComputationsCollectionChange=function(a){a.added.forEach(b=>this._connectComputation(b));a.removed.forEach(b=>this._disconnectComputation(b))};E._createClass(t,[{key:"visible",get:function(){return this.analysisViewData.visible}},
{key:"testInfo",get:function(){return{visualizations:this._lineOfSightVisualizations}}},{key:"_configuration",get:function(){return this.analysisViewData.configuration}}]);return t}(G);m.__decorate([p.property({constructOnly:!0})],e.LineOfSightVisualization.prototype,"analysis",void 0);m.__decorate([p.property({constructOnly:!0})],e.LineOfSightVisualization.prototype,"analysisViewData",void 0);m.__decorate([p.property({constructOnly:!0})],e.LineOfSightVisualization.prototype,"view",void 0);m.__decorate([p.property({readOnly:!0})],
e.LineOfSightVisualization.prototype,"visible",null);m.__decorate([p.property()],e.LineOfSightVisualization.prototype,"testInfo",null);m.__decorate([p.property()],e.LineOfSightVisualization.prototype,"_configuration",null);e.LineOfSightVisualization=m.__decorate([I.subclass("esri.views.3d.analysis.LineOfSight.LineOfSightVisualization")],e.LineOfSightVisualization);const O=d.create(),P=d.create(),Q=d.create(),N=J.create();Object.defineProperty(e,"__esModule",{value:!0})});