// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/watch ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../ViewAnimation ../../ViewingMode ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/PropertiesPool ../webgl-engine/lib/Camera".split(" "),
function(q,c,b,w,l,f,E,F,G,x,y,k,z,A,m,B,C,n,r,d){b=function(t){function p(){var a=t.apply(this,arguments)||this;a._propertiesPool=new r.PropertiesPool({camera:d.default},q._assertThisInitialized(a));a._lastSeenCameraProjectionValues=new d.default;a.events=new w;a.viewingMode=m.ViewingMode.Global;a._cameraChanged=!1;a.updateQueue=[];a.processingUpdates=!1;return a}q._inheritsLoose(p,t);var h=p.prototype;h.init=function(a,e){this._set("viewingMode",a);this._set("spatialReference",e);this._set("constraints",
new B.default({mode:this.viewingMode}))};h.exit=function(){this.cameraController=null;this._propertiesPool.destroy();this._propertiesPool=new r.PropertiesPool({camera:d.default},this)};h.createInitialCamera=function(){if(this.viewingMode===m.ViewingMode.Global){const a=z.getReferenceEllipsoid(this.spatialReference).radius;this.camera=new d.default(k.fromValues(4*a,0,0),k.fromValues(a,0,0),k.fromValues(0,0,1))}else this.camera=new d.default(k.fromValues(0,0,100),k.fromValues(0,0,0),k.fromValues(0,
1,0))};h.switchCameraController=function(a){this.cameraController=a;return a.state!==n.State.Rejected};h.stopActiveCameraController=function(){return this.cameraController&&!this.cameraController.stopController()?!1:!0};h.updateCamera=function(a){this.updateQueue.push(a);this._processUpdateQueue()};h._processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=!0;var a=this.updateQueue.shift();g.copyFrom(this._get("camera"));a(g);this.camera=g;this.processingUpdates=
!1;this._processUpdateQueue()}};h._cameraProjectionChanged=function(a,e){return a.fov!==e.fov||a.fullViewport[0]!==e.fullViewport[0]||a.fullViewport[1]!==e.fullViewport[1]||a.fullViewport[2]!==e.fullViewport[2]||a.fullViewport[3]!==e.fullViewport[3]||a.padding[d.PaddingSide.TOP]!==e.padding[d.PaddingSide.TOP]||a.padding[d.PaddingSide.RIGHT]!==e.padding[d.PaddingSide.RIGHT]||a.padding[d.PaddingSide.BOTTOM]!==e.padding[d.PaddingSide.BOTTOM]||a.padding[d.PaddingSide.LEFT]!==e.padding[d.PaddingSide.LEFT]?
!0:!1};q._createClass(p,[{key:"animation",get:function(){return this.cameraController instanceof C.AnimationController&&l.isSome(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}},{key:"camera",get:function(){return this._get("camera")},set:function(a){a!==g&&g.copyFrom(a);g.computeUp(this.viewingMode);u.camera=g;this.events.emit("before-camera-change",u);a=this._get("camera");this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,g)&&(this._lastSeenCameraProjectionValues.copyFrom(g),
v.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",v));if(!a||!a.equals(g))if(this._set("camera",this._propertiesPool.get("camera").copyFrom(g)),this._cameraChanged=!a||!a.almostEquals(g)){const e=y.afterDispatch(()=>{this._cameraChanged=!1;e.remove()})}}},{key:"contentCamera",get:function(){return l.isSome(this._contentCamera)?this._contentCamera:this.camera},set:function(a){this._contentCamera=l.isSome(a)?a.clone():null}},{key:"fixedContentCamera",get:function(){return!!l.isSome(this._contentCamera)}},
{key:"isGlobal",get:function(){return this.viewingMode===m.ViewingMode.Global}},{key:"isLocal",get:function(){return this.viewingMode===m.ViewingMode.Local}},{key:"navigating",get:function(){return!(!this.cameraController||!this.cameraController.isInteractive)}},{key:"stationary",get:function(){return!this._cameraChanged&&!this.navigating}},{key:"cameraController",get:function(){return this._get("cameraController")},set:function(a){this.stopActiveCameraController()?(a&&(a.watch("state",e=>{if(e===
n.State.Finished||e===n.State.Stopped)this._set("cameraController",null),this.updateCamera(D=>a.onControllerEnd(D))},!0),a.onControllerStart(this.camera)),this._set("cameraController",a)):a&&(a.state=n.State.Rejected)}}]);return p}(b);c.__decorate([f.property({readOnly:!0,type:A})],b.prototype,"animation",null);c.__decorate([f.property({type:d.default})],b.prototype,"camera",null);c.__decorate([f.property({})],b.prototype,"_contentCamera",void 0);c.__decorate([f.property({type:d.default})],b.prototype,
"contentCamera",null);c.__decorate([f.property({readOnly:!0})],b.prototype,"fixedContentCamera",null);c.__decorate([f.property({readOnly:!0})],b.prototype,"constraints",void 0);c.__decorate([f.property({readOnly:!0})],b.prototype,"events",void 0);c.__decorate([f.property({readOnly:!0})],b.prototype,"isGlobal",null);c.__decorate([f.property({readOnly:!0})],b.prototype,"isLocal",null);c.__decorate([f.property({readOnly:!0})],b.prototype,"viewingMode",void 0);c.__decorate([f.property({readOnly:!0})],
b.prototype,"spatialReference",void 0);c.__decorate([f.property({readOnly:!0})],b.prototype,"navigating",null);c.__decorate([f.property({readOnly:!0})],b.prototype,"stationary",null);c.__decorate([f.property()],b.prototype,"_cameraChanged",void 0);c.__decorate([f.property()],b.prototype,"cameraController",null);c=b=c.__decorate([x.subclass("esri.views.3d.state.ViewState")],b);const g=new d.default,u={camera:null},v={camera:null};return c});