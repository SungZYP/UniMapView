// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/handleUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/watchUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../support/elevationInfoUtils ./GrabbingState ./ManipulatorState ./settings ../visualElements/ExtendedLineVisualElement ../visualElements/LaserlineVisualElement ../visualElements/PointVisualElement ../../layers/graphics/elevationAlignmentUtils ../../layers/graphics/ElevationContext ../../layers/graphics/GraphicState ../../webgl-engine/lib/Material".split(" "),
function(z,p,G,t,H,I,J,v,w,K,A,B,L,l,M,C,N,O,P,Q,R){function S(a,e,d,f){const {view:b,graphic:h}=a,m=new M.ExtendedLineVisualElement({view:b,extensionType:l.settings.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:R.RenderOccludedFlag.OccludeAndTransparent});l.settings.visualElements.zVerticalLine.apply(m);const n=new C.LaserlineVisualElement({view:b,intersectsLineInfinite:!0,attached:!1});l.settings.visualElements.pointGraphics.shadowStyle.apply(n);
var g=G.deg2rad(l.settings.visualElements.heightPlaneAngleCutoff);const q=new C.LaserlineVisualElement({view:b,attached:!1,angleCutoff:g});l.settings.visualElements.heightPlane.apply(q);g=A.getGraphicEffectiveElevationInfo(a.graphic);const T=P.ElevationContext.fromElevationInfo(g),U="on-the-ground"===g.mode||!g.offset&&"absolute-height"!==g.mode,x=new L.ManipulatorState;let D=1,E=1;const u=()=>{x.update(a);var c=y(h),r=U&&(e.isDraped||t.isNone(c)||!c.hasZ);let F=!0;if(!r&&t.isSome(c)){const V=O.evaluateElevationAlignmentAtPoint(c,
b.elevationProvider,T,b.renderCoordsHelper);I.set(k,c.x,c.y,V);v.projectVectorToVector(k,c.spatialReference,k,b.renderCoordsHelper.spatialReference);m.setStartEndFromWorldDownAtLocation(k);n.intersectsWorldUpAtLocation=k}else F=!1;c=x.grabbingState&B.GrabbingState.Z?l.settings.visualElements.laserlineAlphaMultiplier:1;c!==D&&(D=c,l.settings.visualElements.heightPlane.apply(q,c));c=w.empty(W);!r&&e.displaying&&f.calculateMapBounds(c)&&v.projectVectorToVector(w.getMin(c,k),b.spatialReference,k,b.renderCoordsHelper.spatialReference)?
(q.heightManifoldTarget=k,q.attached=!0):q.attached=!1;c=x.grabbingState&B.GrabbingState.XY?l.settings.visualElements.laserlineAlphaMultiplier:1;c!==E&&(E=c,l.settings.visualElements.pointGraphics.shadowStyle.apply(n,c));r=F&&e.displaying&&!r;n.attached=r;m.attached=r};d.push(e.watch(["displaying","isDraped"],u),e.on("changed",u));a.forEachManipulator(c=>{d.push(c.events.on("grab-changed",u))});d.push(p.destroyHandle(n));d.push(p.destroyHandle(m));d.push(p.destroyHandle(q));u()}function X(a,e,d){const {view:f,
graphic:b}=a,h=new N.PointVisualElement({view:f,geometry:y(b),elevationInfo:A.getGraphicEffectiveElevationInfo(b),attached:!1});Y(a,h,e,d);d.push(p.destroyHandle(h));return h}function y(a){a=a.geometry;return t.isNone(a)?null:"point"===a.type?a:"mesh"===a.type?a.anchor.clone():null}function Y(a,e,d,f){Z(a,e,d,f);l.settings.visualElements.pointGraphics.outline.apply(e);f.push(H.init(d,"displaying",()=>e.attached=d.displaying))}function Z(a,e,d,f){const {view:b,graphic:h}=a;let m=null;const n=g=>{t.isSome(m)&&
(m.remove(),m=null);d.isDraped&&t.isSome(g)&&(m=aa(b,g,()=>{e.geometry=g}))};a=()=>{const g=y(h);n(g);e.geometry=g};f.push(d.on("changed",a),p.refHandle(()=>m));a()}function aa(a,e,d){v.projectPointToVector(e,k,a.elevationProvider.spatialReference);const f=k[0],b=k[1];return a.elevationProvider.on("elevation-change",h=>{K.containsXY(h.extent,f,b)&&d()})}const k=J.create(),W=w.create();z.createVisualElements=function(a){const {view:e,graphic:d}=a,f=new Q.GraphicState({graphic:d}),b=[],h=X(a,f,b);S(a,
f,b,h);b.push(e.trackGraphicState(f));return{visualElement:h,remove(){p.handlesGroup(b).remove()}}};Object.defineProperty(z,"__esModule",{value:!0})});