// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ../../../../../../core/maybe ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f32 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f32 ../../../../../../chunks/vec4f64 ../../../../layers/support/symbolColorUtils ./ComponentTechnique ./shader/ComponentData.glsl ../../../../../../chunks/ComponentShader.glsl ./shader/VertexDiscardByOpacity.glsl ../../../core/material/MaterialBase ../../../core/renderPasses/AllRenderPasses ../../../core/shaderLibrary/ShaderOutputOptions ../../../core/shaderLibrary/shading/Normals.glsl ../../../core/shaderLibrary/util/AlphaDiscard.glsl ../../../core/shaderLibrary/util/EllipsoidMode ../../../lib/basicInterfaces".split(" "),
function(g,u,f,r,t,F,w,G,H,I,x,J,L,z,c,p,y,K,M,N,A){function O(e){switch(e){case p.MaterialSubPass.Color:return y.ShaderOutput.Color;case p.MaterialSubPass.Alpha:return y.ShaderOutput.Alpha;case p.MaterialSubPass.Depth:return y.ShaderOutput.Depth;case p.MaterialSubPass.Normal:return y.ShaderOutput.Normal}}let h=function(e){function n(){var b=e.apply(this,arguments)||this;b.baseColor=G.fromValues(1,1,1,1);b.usePBR=!1;b.hasParametersFromSource=!1;b.mrrFactors=F.fromValues(1,1,.5);b.emissiveFactor=F.fromValues(0,
0,0);b.baseColorTexture=null;b.metallicRoughnessTexture=null;b.emissionTexture=null;b.occlusionTexture=null;b.normalTexture=null;b.overlayTexOffset=H.fromValues(-1,-1,-1,-1);b.overlayTexScale=H.fromValues(0,0,0,0);b.overlayColor=null;b.overlayHighlight=null;b.overlayNormal=null;b.objectOpacity=1;b.commonMaterialParameters=new B;b.componentParameters=new C;b.alphaCutoff=M.defaultMaskAlphaCutoff;b.alphaDiscardMode=A.AlphaDiscardMode.Opaque;b.isIntegratedMesh=!1;b.polygonOffsetEnabled=!1;b.ellipsoidMode=
N.EllipsoidMode.Earth;b.sceneHasOcludees=!1;b._techniqueConfig=new x.ComponentTechniqueConfiguration;return b}u._inheritsLoose(n,e);var k=n.prototype;k.dispose=function(){this._technique=r.releaseMaybe(this._technique);this.normalTexture=this.occlusionTexture=this.emissionTexture=this.metallicRoughnessTexture=this.baseColorTexture=null};k.prepareTechnique=function(b,d,l){const a=this._techniqueConfig;a.hasVertexColors=l.colors;a.hasNormals=l.normals;a.vertexTextureCoordinates=l.textureCoordinates;
a.usePBR=this.usePBR;a.hasMetalnessAndRoughnessTexture=r.isSome(this.metallicRoughnessTexture);a.hasEmissionTexture=r.isSome(this.emissionTexture);a.hasOcclusionTexture=r.isSome(this.occlusionTexture);a.hasNormalTexture=r.isSome(this.normalTexture);a.transparencyPassType=d.identifier===p.RenderPassIdentifier.Material&&null!=d.transparencyPassType?d.transparencyPassType:A.TransparencyPassType.NONE;a.multipassTerrainEnabled=d.identifier===p.RenderPassIdentifier.Material&&null!=d.multipassTerrainParams?
d.multipassTerrainParams.multipassTerrainEnabled:!1;a.cullAboveGround=d.identifier===p.RenderPassIdentifier.Material&&null!=d.multipassTerrainParams?d.multipassTerrainParams.cullAboveGround:!1;a.ellipsoidMode=this.ellipsoidMode;this.dirty&&(a.componentData=this.componentParameters.type,a.cullFace=this.commonMaterialParameters.cullFace,a.doubleSidedMode=this.commonMaterialParameters.doubleSided?K.NormalsDoubleSidedMode.View:K.NormalsDoubleSidedMode.None,a.baseColorTexture=r.isSome(this.baseColorTexture),
a.isSchematic=this.hasParametersFromSource&&!r.isSome(this.baseColorTexture),l=this._computeWhichMaterialPass(),a.blendingEnabled=l===m.Transparent||l===m.OpaqueAndTransparent,a.alphaDiscardMode=this.alphaDiscardMode,a.integratedMeshMode=this.isIntegratedMesh?this.overlayColor?this.overlayNormal?x.IntegratedMeshMode.ColorOverlayWithWater:x.IntegratedMeshMode.ColorOverlay:x.IntegratedMeshMode.NoOverlay:x.IntegratedMeshMode.None,a.polygonOffsetEnabled=this.polygonOffsetEnabled,this._setClean());a.slicePlaneEnabled=
d.slicePlaneEnabled&&this.commonMaterialParameters.slicePlaneEnabled;d.identifier===p.RenderPassIdentifier.ShadowMap?(a.output=y.ShaderOutput.Shadow,a.vertexDiscardMode=z.VertexDiscardMode.None):d.identifier===p.RenderPassIdentifier.Highlight?(a.output=y.ShaderOutput.Highlight,a.vertexDiscardMode=z.VertexDiscardMode.None):(this._computeWhichMaterialPass()===m.OpaqueAndTransparent?a.vertexDiscardMode=d.transparent?z.VertexDiscardMode.Opaque:z.VertexDiscardMode.Transparent:a.vertexDiscardMode=z.VertexDiscardMode.None,
a.output=O(d.subPass),d.subPass===p.MaterialSubPass.Alpha&&(a.sceneHasOcludees=d.sceneHasOcludees),d.subPass===p.MaterialSubPass.Color?(a.receiveAmbientOcclusion=d.ambientOcclusionEnabled,a.sceneHasOcludees=d.sceneHasOcludees,a.receiveShadows=d.shadowsEnabled,a.ssrEnabled=d.ssrParams.ssrEnabled):(a.receiveAmbientOcclusion=!1,a.receiveShadows=!1));return this._technique=b.releaseAndAcquire(x.ComponentTechnique,a,this._technique)};k.submit=function(b,d){if(0!==this.objectOpacity){var l=d.renderable.geometry,
a=d.components,q=d.renderable.drawParameters;d=d.renderable.meta.cameraDepthSquared;var v=a.geometryRanges,D=a.highlightRanges;a=a.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case m.Opaque:b.materialOpaque.submitDraw(this,l,v,q,d);break;case m.Transparent:b.materialTransparent.submitDraw(this,l,v,q,d);break;case m.OpaqueAndTransparent:b.materialOpaque.submitDraw(this,l,v,q,d);b.materialTransparent.submitDraw(this,l,v,q,d);break;case m.IntegratedMesh:b.materialIntegratedMesh.submitDraw(this,
l,v,q,d),this.overlayHighlight&&b.highlightIntegratedMesh.submitDraw(this,l,v,q,d)}var E=this.componentParameters.castShadows!==g.ComponentParameterSummary.None;E&&b.shadowMap.submitDraw(this,l,v,q,d);r.isSome(D)&&(b.highlight.submitDraw(this,l,D,q,d),E&&b.highlightShadowMap.submitDraw(this,l,D,q,d));E&&r.isSome(a)&&b.defaultShadowMap.submitDraw(this,l,a,q,d)}};k._computeWhichMaterialPass=function(){return this.isIntegratedMesh?m.IntegratedMesh:1>this.objectOpacity?m.Transparent:this.componentParameters.opaqueOverride===
g.ComponentParameterSummary.All?m.Opaque:1>this.baseColor[3]||this.alphaDiscardMode===A.AlphaDiscardMode.Blend||this.alphaDiscardMode===A.AlphaDiscardMode.MaskBlend?m.Transparent:this.componentParameters.transparent===g.ComponentParameterSummary.None?m.Opaque:this.componentParameters.transparent===g.ComponentParameterSummary.All?m.Transparent:m.OpaqueAndTransparent};u._createClass(n,[{key:"attributeLocations",get:function(){return L.attributeLocations}}]);return n}(c.MaterialBase);f.__decorate([c.parameter({vectorOps:w.vec4})],
h.prototype,"baseColor",void 0);f.__decorate([c.parameter()],h.prototype,"usePBR",void 0);f.__decorate([c.parameter()],h.prototype,"hasParametersFromSource",void 0);f.__decorate([c.parameter({vectorOps:t.vec3})],h.prototype,"mrrFactors",void 0);f.__decorate([c.parameter({vectorOps:t.vec3})],h.prototype,"emissiveFactor",void 0);f.__decorate([c.parameter({dispose:!0})],h.prototype,"baseColorTexture",void 0);f.__decorate([c.parameter({dispose:!0})],h.prototype,"metallicRoughnessTexture",void 0);f.__decorate([c.parameter({dispose:!0})],
h.prototype,"emissionTexture",void 0);f.__decorate([c.parameter({dispose:!0})],h.prototype,"occlusionTexture",void 0);f.__decorate([c.parameter({dispose:!0})],h.prototype,"normalTexture",void 0);f.__decorate([c.parameter({vectorOps:{equals:w.exactEquals,copy:w.copy}})],h.prototype,"overlayTexOffset",void 0);f.__decorate([c.parameter({vectorOps:{equals:w.exactEquals,copy:w.copy}})],h.prototype,"overlayTexScale",void 0);f.__decorate([c.parameter()],h.prototype,"overlayColor",void 0);f.__decorate([c.parameter()],
h.prototype,"overlayHighlight",void 0);f.__decorate([c.parameter()],h.prototype,"overlayNormal",void 0);f.__decorate([c.parameter()],h.prototype,"objectOpacity",void 0);f.__decorate([c.parameterBlock()],h.prototype,"commonMaterialParameters",void 0);f.__decorate([c.parameterBlock()],h.prototype,"componentParameters",void 0);f.__decorate([c.parameter()],h.prototype,"alphaCutoff",void 0);f.__decorate([c.parameter()],h.prototype,"alphaDiscardMode",void 0);f.__decorate([c.parameter()],h.prototype,"isIntegratedMesh",
void 0);f.__decorate([c.parameter()],h.prototype,"polygonOffsetEnabled",void 0);f.__decorate([c.parameter()],h.prototype,"ellipsoidMode",void 0);f.__decorate([c.parameter()],h.prototype,"sceneHasOcludees",void 0);g.ShadingNormalSource=void 0;(function(e){e[e.VERTEX=0]="VERTEX";e[e.GROUND=1]="GROUND";e[e.SCREEN_DERIVATIVE=2]="SCREEN_DERIVATIVE"})(g.ShadingNormalSource||(g.ShadingNormalSource={}));var m;(function(e){e[e.Opaque=0]="Opaque";e[e.Transparent=1]="Transparent";e[e.OpaqueAndTransparent=2]=
"OpaqueAndTransparent";e[e.IntegratedMesh=3]="IntegratedMesh"})(m||(m={}));let B=function(e){function n(){var k=e.apply(this,arguments)||this;k.doubleSided=!1;k.cullFace=A.CullFaceOptions.Back;k.slicePlaneEnabled=!0;return k}u._inheritsLoose(n,e);return n}(c.MaterialParameterBlock);f.__decorate([c.parameter()],B.prototype,"doubleSided",void 0);f.__decorate([c.parameter()],B.prototype,"cullFace",void 0);f.__decorate([c.parameter()],B.prototype,"slicePlaneEnabled",void 0);let C=function(e){function n(){var k=
e.apply(this,arguments)||this;k.externalColor=G.fromValues(1,1,1,1);k.externalColorMixMode=I.ColorMixModeEnum.Multiply;k.castShadows=g.ComponentParameterSummary.All;return k}u._inheritsLoose(n,e);u._createClass(n,[{key:"transparent",get:function(){return 1>this.externalColor[3]?g.ComponentParameterSummary.All:g.ComponentParameterSummary.None}},{key:"opaqueOverride",get:function(){return this.externalColorMixMode===I.ColorMixModeEnum.Replace&&1===this.externalColor[3]?g.ComponentParameterSummary.All:
g.ComponentParameterSummary.None}},{key:"visible",get:function(){return 0<this.externalColor[3]?g.ComponentParameterSummary.All:g.ComponentParameterSummary.None}},{key:"type",get:function(){return J.ComponentDataType.Uniform}}]);return n}(c.MaterialParameterBlock);f.__decorate([c.parameter({vectorOps:w.vec4})],C.prototype,"externalColor",void 0);f.__decorate([c.parameter()],C.prototype,"externalColorMixMode",void 0);f.__decorate([c.parameter()],C.prototype,"castShadows",void 0);g.ComponentParameterSummary=
void 0;(function(e){e[e.All=0]="All";e[e.Some=1]="Some";e[e.None=2]="None"})(g.ComponentParameterSummary||(g.ComponentParameterSummary={}));t=function(e){function n(){var k=e.apply(this,arguments)||this;k.texture=null;k.transparent=g.ComponentParameterSummary.None;k.opaqueOverride=g.ComponentParameterSummary.None;k.castShadows=g.ComponentParameterSummary.None;return k}u._inheritsLoose(n,e);u._createClass(n,[{key:"type",get:function(){return J.ComponentDataType.Varying}}]);return n}(c.MaterialParameterBlock);
f.__decorate([c.parameter()],t.prototype,"texture",void 0);f.__decorate([c.parameter()],t.prototype,"transparent",void 0);f.__decorate([c.parameter()],t.prototype,"opaqueOverride",void 0);f.__decorate([c.parameter()],t.prototype,"castShadows",void 0);g.CommonMaterialParameters=B;g.ComponentMaterial=h;g.ComponentParametersUniform=C;g.ComponentParametersVarying=t;Object.defineProperty(g,"__esModule",{value:!0})});