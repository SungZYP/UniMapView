// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/PooledArray ../../lib/basicInterfaces ../../../../webgl/enums".split(" "),function(h,u,v,w,x,p){h.RenderPassSorting=void 0;(function(f){f[f.FrontToBack=0]="FrontToBack";f[f.BackToFront=1]="BackToFront"})(h.RenderPassSorting||(h.RenderPassSorting={}));let z=function(){function f(d,c,e=h.RenderPassSorting.FrontToBack){this._rctx=d;this._techniqueRepository=c;this._sorting=e;this._draws=new w({initialSize:32,
allocator:g=>g||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}});this._passBoundTechniques=new Set;this._previouslyBoundMaterials=new Map;this._previouslyBoundDraw=new Map}var l=f.prototype;l.submitDraw=function(d,c,e,g,q){const a=this._draws.pushNew();a.geometry=c;a.geometryRanges=e;a.material=d;a.bindDrawParams=g;a.depthSquaredHint=q;a.indexType=c.indexed?v.unwrap(c.vao.indexBuffer).indexType:0};l.dispatch=function(d){const c=this._rctx;this._passBoundTechniques.clear();
this._previouslyBoundMaterials.clear();this._previouslyBoundDraw.clear();let e=null;const g=this._draws.map(k=>k.material.prepareTechnique(this._techniqueRepository,d,k.geometry.parameters)),q=this._draws.length;for(let k=0;k<q;k++){var a=g[k];if(a!==e||a.configuration.transparencyPassType!==x.TransparencyPassType.NONE)c.useTechnique(a,d.slot),e=a;this._passBoundTechniques.has(a)||(a.bindPass(d),this._passBoundTechniques.add(a));var b=this._draws.data[k];const r=b.geometry;c.bindVAO(r.vao);this._previouslyBoundMaterials.get(a)!==
b.material&&(a.bindMaterial(b.material,d),this._previouslyBoundMaterials.set(a,b.material));this._previouslyBoundDraw.get(a)!==b.bindDrawParams&&(a.bindDraw(b.bindDrawParams),this._previouslyBoundDraw.set(a,b.bindDrawParams));a=b.geometryRanges;const t=a.length;if(0!==b.indexType){const y=m.get(b.indexType);for(let n=0;n<t;n+=2)c.drawElements(r.primitiveType,a[n+1],b.indexType,a[n]*y)}else for(b=0;b<t;b+=2)c.drawArrays(r.primitiveType,a[b],a[b+1])}};l.prepareSubmit=function(){this._draws.clear()};
l.finishSubmit=function(){const d=this._sorting===h.RenderPassSorting.FrontToBack?1:-1;this._draws.sort((c,e)=>{const g=d*(c.depthSquaredHint-e.depthSquaredHint);return 0!==g?g:c.geometry.vao.size-e.geometry.vao.size})};u._createClass(f,[{key:"count",get:function(){return this._draws.length}}]);return f}();const m=new Map;m.set(p.DataType.UNSIGNED_BYTE,1);m.set(p.DataType.UNSIGNED_SHORT,2);m.set(p.DataType.UNSIGNED_INT,4);h.RenderPass=z;Object.defineProperty(h,"__esModule",{value:!0})});