// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../lib/GLMaterials ../lib/GLMaterialTexture ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./VisualVariableMaterialParameters ../shaders/LineMarkerTechnique".split(" "),function(B,C,w,D,J,m,K,L,x,n,d,M,z){let Q=function(p){function l(a){a=p.call(this,a,N)||this;a._vertexAttributeLocations=z.markerVertexAttributeLocations;
a.techniqueConfig=new z.LineMarkerTechniqueConfiguration;a.layout=a.createLayout();return a}C._inheritsLoose(l,p);var c=l.prototype;c.dispose=function(){};c.getTechniqueConfig=function(a,g){this.techniqueConfig.output=a;this.techniqueConfig.draped=g.slot===n.RenderSlot.DRAPED_MATERIAL;this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled;this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees;this.techniqueConfig.transparent=this.parameters.transparent;this.techniqueConfig.writeDepth=
this.parameters.writeDepth;this.techniqueConfig.vvColor=this.parameters.vvColorEnabled;this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled;this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled;this.techniqueConfig.occluder=this.parameters.renderOccluded===x.RenderOccludedFlag.OccludeAndTransparentStencil;this.techniqueConfig.transparencyPassType=g.transparencyPassType;this.techniqueConfig.multipassTerrainEnabled=g.multipassTerrainEnabled;this.techniqueConfig.cullAboveGround=g.cullAboveGround;
return this.techniqueConfig};c.intersect=function(){};c.createLayout=function(){const a=J.newLayout().vec3f(d.VertexAttribute.POSITION).vec2f(d.VertexAttribute.UV0).vec3f(d.VertexAttribute.AUXPOS1);this.parameters.vvSizeEnabled?a.f32(d.VertexAttribute.SIZEFEATUREATTRIBUTE):a.f32(d.VertexAttribute.SIZE);this.parameters.vvColorEnabled?a.f32(d.VertexAttribute.COLORFEATUREATTRIBUTE):a.vec4f(d.VertexAttribute.COLOR);this.parameters.vvOpacityEnabled&&a.f32(d.VertexAttribute.OPACITYFEATUREATTRIBUTE);return a};
c.createBufferWriter=function(){return new O(this.layout,this.parameters)};c.requiresSlot=function(a,g){if(a===n.RenderSlot.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===x.RenderOccludedFlag.OccludeAndTransparentStencil)return a===n.RenderSlot.OPAQUE_MATERIAL||a===n.RenderSlot.OCCLUDER_MATERIAL||a===n.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL;g=K.outputFromPass(g);return g===m.ShaderOutput.Color||g===m.ShaderOutput.Alpha?a===(this.parameters.writeDepth?n.RenderSlot.TRANSPARENT_MATERIAL:
n.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):a===n.RenderSlot.OPAQUE_MATERIAL};c.createGLMaterial=function(a){return a.output===m.ShaderOutput.Color||a.output===m.ShaderOutput.Alpha||a.output===m.ShaderOutput.Highlight||a.output===m.ShaderOutput.Depth?new P(a):null};c.validateParameters=function(a){a.color&&1>a.color[3]&&(a.transparent=!0)};return l}(x.Material),P=function(p){function l(a){return p.call(this,{...a,...a.material.parameters})||this}C._inheritsLoose(l,p);var c=l.prototype;
c.updateParameters=function(a){this.updateTexture(this._material.parameters.textureId);return this.ensureTechnique(z.LineMarkerTechnique,a)};c._updateOccludeeState=function(a){a.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:a.hasOccludees})};c.beginSlot=function(a){this._output!==m.ShaderOutput.Color&&this._output!==m.ShaderOutput.Alpha||this._updateOccludeeState(a);return this.updateParameters(a)};c.bind=function(a,g){this.bindTextures(g.program);
this.bindTextureScale(g.program);g.bindPass(this._material.parameters,a)};return l}(L);const N={width:0,color:[1,1,1,1],placement:"end",textureId:null,writeDepth:!0,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,sceneHasOcludees:!1,...x.DefaultMaterialParameters,...M.VisualVariableDefaultMaterialParameters};let O=function(){function p(c,a){this.vertexBufferLayout=c;this.parameters=a}var l=p.prototype;l.allocate=function(c){return this.vertexBufferLayout.createBuffer(c)};l.elementCount=function(){return"begin-end"===
this.parameters.placement?12:6};l.write=function(c,a,g,R){const q=a.vertexAttributes.get(d.VertexAttribute.POSITION).data,E=q.length/3;let F=1,G=0;this.parameters.vvSizeEnabled?G=a.vertexAttributes.get(d.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0]:a.vertexAttributes.has(d.VertexAttribute.SIZE)&&(F=a.vertexAttributes.get(d.VertexAttribute.SIZE).data[0]);let r=[1,1,1,1],H=0;this.parameters.vvColorEnabled?H=a.vertexAttributes.get(d.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:a.vertexAttributes.has(d.VertexAttribute.COLOR)&&
(r=a.vertexAttributes.get(d.VertexAttribute.COLOR).data);let I=0;this.parameters.vvOpacityEnabled&&(I=a.vertexAttributes.get(d.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]);const A=c.transformation,e=new Float32Array(g.buffer);let f=this.vertexBufferLayout.stride/4*R;const u=(b,t,h,k)=>{e[f++]=b[0];e[f++]=b[1];e[f++]=b[2];e[f++]=h[0];e[f++]=h[1];e[f++]=t[0];e[f++]=t[1];e[f++]=t[2];this.parameters.vvSizeEnabled?e[f++]=G:e[f++]=F;this.parameters.vvColorEnabled?e[f++]=H:(b=Math.min(4*k,r.length-
4),e[f++]=r[b+0],e[f++]=r[b+1],e[f++]=r[b+2],e[f++]=r[b+3]);this.parameters.vvOpacityEnabled&&(e[f++]=I)};let y;(function(b){b[b.ASCENDING=1]="ASCENDING";b[b.DESCENDING=-1]="DESCENDING"})(y||(y={}));c=(b,t)=>{const h=w.set(S,q[3*b],q[3*b+1],q[3*b+2]),k=T;let v=b+t;do w.set(k,q[3*v],q[3*v+1],q[3*v+2]),v+=t;while(w.equals(h,k)&&0<=v&&v<E);A&&(w.transformMat4(h,h,A),w.transformMat4(k,k,A));u(h,k,[-1,-1],b);u(h,k,[1,-1],b);u(h,k,[1,1],b);u(h,k,[-1,-1],b);u(h,k,[1,1],b);u(h,k,[-1,1],b)};a=this.parameters.placement;
"begin"!==a&&"begin-end"!==a||c(0,y.ASCENDING);"end"!==a&&"begin-end"!==a||c(E-1,y.DESCENDING)};return p}();const S=D.create(),T=D.create();B.LineMarkerMaterial=Q;Object.defineProperty(B,"__esModule",{value:!0})});