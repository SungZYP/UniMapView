// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ModelDirtyTypes".split(" "),function(t,u,v,p,g,w,x,y,n){let z=function(){function q(a,b,c){this.graphics3DSymbolLayer=a;this.renderGeometries=b;this.boundingBox=c;this.type="draped";this.stage=null;this._addedToStage=
this._visible=!1;this._graphicsCoreOwner=null;this.isElevationSource=!1}var d=q.prototype;d.initialize=function(a,b,c){this.stage=a;this._graphicsCoreOwner=c;this._overlayRenderer=this._graphicsCoreOwner.view.basemapTerrain.overlayManager.renderer};d.setVisibility=function(a){if(null!=this.stage&&this._visible!==a)if((this._visible=a)&&!this._addedToStage)this._addedToStage=!0,this._overlayRenderer.addGeometries(this.renderGeometries,this._graphicsCoreOwner,n.ModelDirty.Geometry.ADD);else if(a||this._addedToStage){for(const b of this.renderGeometries)b.instanceParameters.visible=
this._visible;this._overlayRenderer.updateGeometries(this.renderGeometries,this._graphicsCoreOwner,n.ModelDirty.State.VISIBILITIES)}};d.destroy=function(){this.stage&&this._addedToStage&&this._overlayRenderer.removeGeometries(this.renderGeometries,this._graphicsCoreOwner,n.ModelDirty.Geometry.REMOVE);this._visible=this._addedToStage=!1;this.stage=null};d.getCenterObjectSpace=function(a=p.create()){return v.set(a,0,0,0)};d.getBoundingBoxObjectSpace=function(a=g.create()){return g.empty(a)};d.addObjectState=
function(a,b){a===y.Object3DState.Highlight&&(this.renderGeometries.forEach(c=>{const l=c.addHighlight();b.addRenderGeometry(c,l,this)}),this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._graphicsCoreOwner))};d.removeObjectState=function(a){this.renderGeometries.forEach(b=>{a.removeRenderGeometry(b)})};d.removeRenderGeometryObjectState=function(a,b){a.removeHighlight(b);this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._graphicsCoreOwner)};
d.computeAttachmentOrigin=function(a){for(const b of this.renderGeometries)b.computeAttachmentOrigin(m)&&(a.draped.origin[0]+=m[0],a.draped.origin[1]+=m[1],a.draped.num++)};d.getProjectedBoundingBox=function(){var a=t._asyncToGenerator(function*(b,c,l,h,e){g.empty(e);for(let k=0;k<this.renderGeometries.length;k++)this._getRenderGeometryProjectedBoundingRect(this.renderGeometries[k],b,r,l),g.expandWithRect(e,r);if(c){g.center(e,m);let k;b=x.demResolutionForBoundingBox(e,c);try{k=yield c.service.queryElevation(m[0],
m[1],h,b,"ground")}catch(A){}u.isSome(k)&&(e[2]=Math.min(e[2],k),e[5]=Math.max(e[5],k))}return e});return function(b,c,l,h,e){return a.apply(this,arguments)}}();d._getRenderGeometryProjectedBoundingRect=function(a,b,c,l){if(this.boundingBox)g.set(f,this.boundingBox);else{a=a.boundingSphere;const h=a[3];f[0]=a[0]-h;f[1]=a[1]-h;f[2]=a[2]-h;f[3]=a[0]+h;f[4]=a[1]+h;f[5]=a[2]+h}b(f,0,2);this.calculateRelativeScreenBounds&&l.push({location:g.center(f),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});
return g.toRect(f,c)};return q}();const r=w.create(),f=g.create(),m=p.create();return z});