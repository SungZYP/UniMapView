// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/util/AlphaDiscard.glsl ../lib/basicInterfaces ../lib/GLMaterialTexture ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderPass ../lib/RenderSlot ../lib/VertexAttribute ../lib/verticalOffsetUtils ./internal/bufferWriterUtils ./internal/MaterialUtil ../shaders/DefaultMaterialTechnique ../shaders/RealisticTreeTechnique".split(" "),
function(w,A,B,N,k,p,C,D,l,t,O,u,P,E,Q,x,v,f,R,S,F,G,T){function H(g){let e=D.newLayout();e=g.instancedDoublePrecision?e.vec3f(f.VertexAttribute.MODELORIGINHI).vec3f(f.VertexAttribute.MODELORIGINLO).mat3f(f.VertexAttribute.MODEL).mat3f(f.VertexAttribute.MODELNORMAL):e.mat4f(f.VertexAttribute.MODEL).mat4f(f.VertexAttribute.MODELNORMAL);g.instanced&&-1<g.instanced.indexOf("color")&&(e=e.vec4f(f.VertexAttribute.INSTANCECOLOR));g.instanced&&-1<g.instanced.indexOf("featureAttribute")&&(e=e.vec4f(f.VertexAttribute.INSTANCEFEATUREATTRIBUTE));
return e}let ba=function(g){function e(a){var b=g.call(this,a,U)||this;b.supportsEdges=!0;b.techniqueConfig=new G.DefaultMaterialTechniqueConfiguration;{var c=b.parameters;const m=c.textureId||c.normalTextureId||c.metallicRoughnessTextureId||c.emissiveTextureId||c.occlusionTextureId,h=D.newLayout().vec3f(f.VertexAttribute.POSITION).vec3f(f.VertexAttribute.NORMAL);c.vertexTangents&&h.vec4f(f.VertexAttribute.TANGENT);m&&h.vec2f(f.VertexAttribute.UV0);c.vertexColors&&h.vec4u8(f.VertexAttribute.COLOR);
c.symbolColors&&h.vec4u8(f.VertexAttribute.SYMBOLCOLOR);c=h}b.vertexBufferLayout=c;b.instanceBufferLayout=a.instanced?H(b.parameters):null;return b}A._inheritsLoose(e,g);var d=e.prototype;d.isVisibleInPass=function(a){return a===x.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL||a===x.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT||a===x.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT?this.parameters.castShadows:!0};d.isVisible=function(){var a=this.parameters;if(!g.prototype.isVisible.call(this)||0===a.layerOpacity)return!1;
var b=a.instanced;const c=a.vertexColors,m=a.symbolColors;b=!!b&&-1<b.indexOf("color");const h=a.vvColorEnabled,n="replace"===a.colorMixMode,q=0<a.opacity;a=a.externalColor&&0<a.externalColor[3];return c&&(b||h||m)?n?!0:q:c?n?a:q:b||h||m?n?!0:q:n?a:q};d.getTechniqueConfig=function(a,b){this.techniqueConfig.output=a;this.techniqueConfig.hasNormalTexture=!!this.parameters.normalTextureId;this.techniqueConfig.hasColorTexture=!!this.parameters.textureId;this.techniqueConfig.vertexTangents=this.parameters.vertexTangents;
this.techniqueConfig.instanced=!!this.parameters.instanced;this.techniqueConfig.instancedDoublePrecision=this.parameters.instancedDoublePrecision;this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled;this.techniqueConfig.verticalOffset=null!==this.parameters.verticalOffset;this.techniqueConfig.screenSizePerspective=null!==this.parameters.screenSizePerspective;this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled;this.techniqueConfig.sliceHighlightDisabled=this.parameters.sliceHighlightDisabled;
this.techniqueConfig.alphaDiscardMode=this.parameters.textureAlphaMode;this.techniqueConfig.normalsTypeDerivate="screenDerivative"===this.parameters.normals?!0:!1;this.techniqueConfig.transparent=this.parameters.transparent;this.techniqueConfig.writeDepth=this.parameters.writeDepth;B.isSome(this.parameters.customDepthTest)&&(this.techniqueConfig.customDepthTest=this.parameters.customDepthTest);this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees;this.techniqueConfig.cullFace=this.parameters.slicePlaneEnabled?
u.CullFaceOptions.None:this.parameters.cullFace;this.techniqueConfig.multipassTerrainEnabled=b.multipassTerrainEnabled;this.techniqueConfig.cullAboveGround=b.cullAboveGround;this.techniqueConfig.hasModelTransformation=B.isSome(this.parameters.modelTransformation);if(a===l.ShaderOutput.Color||a===l.ShaderOutput.Alpha)this.techniqueConfig.vertexColors=this.parameters.vertexColors,this.techniqueConfig.symbolColors=this.parameters.symbolColors,this.techniqueConfig.doubleSidedMode=this.parameters.treeRendering?
t.NormalsDoubleSidedMode.WindingOrder:this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?t.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?t.NormalsDoubleSidedMode.WindingOrder:t.NormalsDoubleSidedMode.None,this.techniqueConfig.instancedColor=!!this.parameters.instanced&&-1<this.parameters.instanced.indexOf("color"),this.techniqueConfig.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,
this.techniqueConfig.receiveAmbientOcclusion=b.ssaoEnabled?this.parameters.receiveSSAO:!1,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this.techniqueConfig.usePBR=this.parameters.usePBR,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.parameters.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=
!!this.parameters.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this.techniqueConfig.isSchematic=this.parameters.usePBR&&this.parameters.isSchematic,this.techniqueConfig.transparencyPassType=b.transparencyPassType,this.techniqueConfig.enableOffset=b.camera.relativeElevation<Q.OITPolygonOffsetLimit;return this.techniqueConfig};d.intersect=function(a,b,c,m,h,n,q){if(null!==this.parameters.verticalOffset){const I=
m.camera;k.set(y,c[12],c[13],c[14]);c=null;switch(m.viewingMode){case C.ViewingMode.Global:c=k.normalize(J,y);break;case C.ViewingMode.Local:c=k.copy(J,V)}let K=0;if(null!==this.parameters.verticalOffset){var r=k.subtract(W,y,I.eye);const L=k.length(r);r=k.scale(r,r,1/L);let M=null;this.parameters.screenSizePerspective&&(M=k.dot(c,r));K+=F.verticalOffsetAtDistance(I,L,this.parameters.verticalOffset,M,this.parameters.screenSizePerspective)}k.scale(c,c,K);k.transformMat3(z,c,m.transform.inverseRotation);
h=k.subtract(X,h,z);n=k.subtract(Y,n,z)}F.intersectTriangleGeometry(a,b,m,h,n,R.getVerticalOffsetObject3D(m.verticalOffset),q)};d.requiresSlot=function(a){return a===(this.parameters.transparent?this.parameters.writeDepth?v.RenderSlot.TRANSPARENT_MATERIAL:v.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:v.RenderSlot.OPAQUE_MATERIAL)||a===v.RenderSlot.DRAPED_MATERIAL};d.createGLMaterial=function(a){return a.output===l.ShaderOutput.Color||a.output===l.ShaderOutput.Alpha||a.output===l.ShaderOutput.Depth||
a.output===l.ShaderOutput.Normal||a.output===l.ShaderOutput.Shadow||a.output===l.ShaderOutput.Highlight?new Z(a):null};d.createBufferWriter=function(){return new aa(this.vertexBufferLayout,this.instanceBufferLayout)};return e}(E.Material),Z=function(g){function e(a){return g.call(this,{...a,...a.material.parameters})||this}A._inheritsLoose(e,g);var d=e.prototype;d.updateParameters=function(a){const b=this._material.parameters;this.updateTexture(b.textureId);return this.ensureTechnique(b.treeRendering?
T.RealisticTreeTechnique:G.DefaultMaterialTechnique,a)};d._updateShadowState=function(a){a.shadowMappingEnabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:a.shadowMappingEnabled})};d._updateOccludeeState=function(a){a.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:a.hasOccludees})};d.beginSlot=function(a){if(this._output===l.ShaderOutput.Color||this._output===l.ShaderOutput.Alpha)this._updateShadowState(a),
this._updateOccludeeState(a);return this.updateParameters(a)};d.bind=function(a,b){b.bindPass(this._material.parameters,a);this.bindTextures(b.program)};return e}(P);const U={textureId:void 0,initTextureTransparent:!1,isSchematic:!1,usePBR:!1,normalTextureId:void 0,vertexTangents:!1,occlusionTextureId:void 0,emissiveTextureId:void 0,metallicRoughnessTextureId:void 0,emissiveFactor:[0,0,0],mrrFactors:[0,1,.5],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,
layerOpacity:1,vertexColors:!1,symbolColors:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:u.CullFaceOptions.Back,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,fillLightsEnabled:!0,receiveShadows:!0,castShadows:!0,shadowMappingEnabled:!1,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,sliceHighlightDisabled:!1,offsetTransparentBackfaces:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,
1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:N.create(),modelTransformation:null,transparent:!1,writeDepth:!0,customDepthTest:u.DepthTestFunction.Less,textureAlphaMode:u.AlphaDiscardMode.Blend,textureAlphaCutoff:O.defaultMaskAlphaCutoff,textureAlphaPremultiplied:!1,sceneHasOcludees:!1,...E.DefaultMaterialParameters};let aa=function(){function g(d,
a){this.vertexBufferLayout=d;this.instanceBufferLayout=a}var e=g.prototype;e.allocate=function(d){return this.vertexBufferLayout.createBuffer(d)};e.elementCount=function(d){return d.indices.get(f.VertexAttribute.POSITION).length};e.write=function(d,a,b,c){S.writeDefaultAttributes(a,this.vertexBufferLayout,d.transformation,d.invTranspTransformation,b,c)};return g}();const X=p.create(),Y=p.create(),V=p.fromValues(0,0,1),J=p.create(),z=p.create(),y=p.create(),W=p.create();w.DefaultMaterial=ba;w.getInstanceBufferLayout=
H;Object.defineProperty(w,"__esModule",{value:!0})});