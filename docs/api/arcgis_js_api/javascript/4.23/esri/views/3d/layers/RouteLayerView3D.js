// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Collection ../../../core/CollectionFlattener ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./interfaces ./LayerView3D ./graphics/GraphicsProcessor ./support/projectExtentUtils ../support/EventedSet ../webgl-engine/lib/basicInterfaces ../../layers/LayerView".split(" "),
function(h,f,r,p,t,m,u,g,e,D,E,v,w,x,y,z,A,B,C){e=function(k){function l(){var a=k.apply(this,arguments)||this;a.type="route-3d";a.loadedGraphics=new A.EventedSet;a._byObjectID=new Map;a.slicePlaneEnabled=!1;a.drapeSourceType=w.DrapeSourceType.Features;a.fullExtentInLocalViewSpatialReference=null;return a}h._inheritsLoose(l,k);var d=l.prototype;d.initialize=function(){this._set("processor",new y.GraphicsProcessor({owner:this,scaleVisibilityEnabled:!0,frustumVisibilityEnabled:!0}));this.addResolvingPromise(this.processor.setup());
this.updatingHandles.addOnCollectionChange(()=>this._routeItems,a=>this._routeItemsChanged(a));this.addResolvingPromise(z.toViewIfLocal(this).then(a=>this.fullExtentInLocalViewSpatialReference=a));this.handles.add(u.when(()=>{var a,b;return null==(a=this.view)?void 0:null==(b=a.basemapTerrain)?void 0:b.ready},()=>()=>this.notifyChange("updating"),{once:!0}))};d.destroy=function(){this.handles.removeAll();this.updatingHandles.removeAll();this._set("processor",m.destroyMaybe(this.processor))};d._routeItemsChanged=
function(a){a.removed.length&&this.loadedGraphics.removeMany(a.removed.map(b=>{const c=this._byObjectID.get(b);this._byObjectID.delete(b);return c}));this.loadedGraphics.addMany(a.added.map(b=>{const c=r.fromJSON(b.toPortalJSON());this._byObjectID.set(b,c);return c}))};d.getSuspendInfo=function(){var a,b,c,q;const n=k.prototype.getSuspendInfo.call(this);n.outsideScaleRange=null!=(a=null==(b=this.processor)?void 0:b.scaleVisibilitySuspended)?a:!1;n.outsideOfView=null!=(c=null==(q=this.processor)?void 0:
q.frustumVisibilitySuspended)?c:!1;return n};d.fetchPopupFeatures=function(){var a=h._asyncToGenerator(function*(b,c){return m.isSome(c)?c.clientGraphics:null});return function(b,c){return a.apply(this,arguments)}}();d.getGraphicFromGraphicUid=function(a){return this.processor.getGraphicFromGraphicUid(a)};d.whenGraphicBounds=function(a,b){return this.processor.whenGraphicBounds(a,b)};d.computeAttachmentOrigin=function(a,b){var c;return null==(c=this.processor)?void 0:c.computeAttachmentOrigin(a,b)};
d.getSymbolLayerSize=function(a,b){return this.processor.getSymbolLayerSize(a,b)};d.queryGraphics=function(){var a=h._asyncToGenerator(function*(){return new p(this.loadedGraphics.toArray())});return function(){return a.apply(this,arguments)}}();d.maskOccludee=function(a){return this.processor.maskOccludee(a)};d.highlight=function(a){return this.processor.highlight(a)};d.canResume=function(){var a;return k.prototype.canResume.call(this)&&!(null!=(a=this.processor)&&a.scaleVisibilitySuspended)};d.isUpdating=
function(){var a,b,c;return!((null==(a=this.processor)||!a.updating)&&null!=(b=this.view)&&null!=(c=b.basemapTerrain)&&c.ready)};h._createClass(l,[{key:"_routeItems",get:function(){return new t({getCollections:()=>[this.layer.pointBarriers,this.layer.polygonBarriers,this.layer.polylineBarriers,this.layer.stops,this.layer.directionLines,this.layer.directionPoints,m.isSome(this.layer.routeInfo)?new p([this.layer.routeInfo]):null]})}},{key:"legendEnabled",get:function(){var a;return this.canResume()&&
!(null!=(a=this.processor)&&a.frustumVisibilitySuspended)}},{key:"updatePolicy",get:function(){var a;return(null==(a=this.processor)?void 0:a.graphicsCore.effectiveUpdatePolicy)||B.UpdatePolicy.SYNC}},{key:"performanceInfo",get:function(){var a,b,c;return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:-1,totalNumberOfFeatures:-1,nodes:0,core:null,updating:this.updating,elevationUpdating:null!=(a=null==(b=this.processor)?void 0:b.elevationAlignment.updating)?a:!1,visibilityFrustum:!(null!=
(c=this.processor)&&c.frustumVisibilitySuspended)}}}]);return l}(x.LayerView3D(C));f.__decorate([g.property()],e.prototype,"_routeItems",null);f.__decorate([g.property()],e.prototype,"loadedGraphics",void 0);f.__decorate([g.property({readOnly:!0})],e.prototype,"legendEnabled",null);f.__decorate([g.property()],e.prototype,"layer",void 0);f.__decorate([g.property({readOnly:!0})],e.prototype,"processor",void 0);f.__decorate([g.property({type:Boolean})],e.prototype,"slicePlaneEnabled",void 0);return e=
f.__decorate([v.subclass("esri.views.3d.layers.RouteLayerView3D")],e)});