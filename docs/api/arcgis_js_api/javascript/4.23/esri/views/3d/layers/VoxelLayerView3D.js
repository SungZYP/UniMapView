// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/watchUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/spatialReferenceUtils ../../../layers/VoxelWasmManager ./LayerView3D ../../layers/LayerView ../../webgl/context-util".split(" "),function(n,m,d,p,u,q,
f,A,B,v,w,h,x,y,z){f=function(r){function k(){var a=r.apply(this,arguments)||this;a._usedMemory=0;a._futureMemory=0;a.type="voxel-3d";a._wasmLayerId=-1;return a}n._inheritsLoose(k,r);var b=k.prototype;b.initialize=function(){var a;if("local"!==this.view.viewingMode)throw new d("voxel:unsupported-viewingMode","Voxel layers support local viewingMode only.",{});if(this.view._stage.renderView.renderingContext.type!==z.ContextType.WEBGL2)throw new d("voxel:unsupported-context","Voxel layers are supported in WebGL2 rendering contexts only.",
{});if(null==(a=this.view._stage.renderView.renderingContext.capabilities.colorBufferFloat)||!a.textureFloat)throw new d("voxel:missing-color-buffer-float","Voxel layers require the WebGL2 extension EXT_color_buffer_float",{});if(!w.equals(this.layer.spatialReference,this.view.spatialReference))throw new d("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});a=this.layer.style.currentVariableId;var c=this.layer.getVolume(a);
a=this.layer.getVariable(a);if(p.isSome(c)&&p.isSome(a)){var g=c.dimensions[0];const e=c.dimensions[1],l=c.getZDimension();if(1<l){c=g.size*e.size*c.dimensions[l].size;g=1;switch(a.renderingFormat.type){case "Int16":case "UInt16":g=2;break;case "Int32":case "UInt32":case "Float32":g=4}this._futureMemory=g*c}}const t=h.getInstance();a=t.addLayer(this.view,this).then(e=>{this._wasmLayerId=e;this._suspendedHandle=u.init(this,"suspended",l=>{h.getInstance().setLayerEnabled(this.view,this,!l)})}).catch(e=>
{t.removeLayer(this.view,this);this._wasmLayerId=-1;if(-1===e)throw new d("voxel:addLayer-failure","The voxel layer description was invalid.",{});if(-2===e)throw new d("voxel:addLayer-failure","The voxel layer web assembly module failed to download.",{});});this.addResolvingPromise(a)};b.destroy=function(){h.getInstance().removeLayer(this.view,this);this._suspendedHandle&&(this._suspendedHandle.remove(),this._suspendedHandle=null)};b.isUpdating=function(){return 0>this._wasmLayerId?!1:h.getInstance().isUpdating(this.view,
this._wasmLayerId)};b.updatingFlagChanged=function(){this.notifyChange("updating")};b.getUsedMemory=function(){return this._usedMemory};b.getUnloadedMemory=function(){return this._futureMemory};b.ignoresMemoryFactor=function(){return!0};b.setUsedMemory=function(a){this._usedMemory=a;this._futureMemory=0};n._createClass(k,[{key:"performanceInfo",get:function(){return{nodes:0,displayedNumberOfFeatures:0,maximumNumberOfFeatures:0,totalNumberOfFeatures:0,core:null}}}]);return k}(x.LayerView3D(y));m.__decorate([q.property()],
f.prototype,"layer",void 0);m.__decorate([q.property({readOnly:!0,aliasOf:"layer.parsedUrl.path"})],f.prototype,"baseUrl",void 0);return f=m.__decorate([v.subclass("esri.views.3d.layers.VoxelLayerView3D")],f)});