// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/Util ../../../../chunks/ShadowHighlight.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(v,e,p,l,q,w,x,r,y,z,A,f,B,C,D,E,d,m){f=function(g){function c(b){var a;return a=g.call(this,b,null,()=>a.destroy())||this}p._inheritsLoose(c,g);var n=c.prototype;n.initializeProgram=function(b){const a=c.shader.get().build({highlightedThreshold:.99999,selfShadowThreshold:.025});return new C.Program(b.rctx,a,B.Default3D)};n.initializePipeline=function(b){return m.makePipelineState({blending:m.separateBlendingParams(d.BlendFactor.SRC_ALPHA,d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA,
d.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:m.defaultColorWriteParams,depthTest:null,depthWrite:null})};n.bindPass=function(b,a){l.isNone(a.linearDepthTexture)||(this.program.bindTexture(a.linearDepthTexture,"depthMap"),this.program.bindTexture(a.highlightColorTexture,"highlightMap"),r.transformMat4(h,a.lighting.lightingMainDirection,a.camera.viewInverseTransposeMatrix),r.normalize(h,h),D.inverseProjectionInfo(a.camera.projectionMatrix,a.camera.fullWidth,a.camera.fullHeight,t,u),q.translate(k,a.camera.viewMatrix,
a.camera.center),q.invert(k,k),this.program.setUniform4fv("uColor",b.shadowColor),this.program.setUniform1f("opacity",b.shadowOpacity),this.program.setUniform1f("occludedOpacity",b.occludedShadowOpacity),this.program.setUniform1f("terminationFactor",b.opacityElevation*b.dayNightTerminator),this.program.setUniform2fv("nearFar",a.camera.nearFar),this.program.setUniformMatrix4fv("inverseViewMatrix",k),this.program.setUniform4fv("projInfo",t),this.program.setUniform2fv("zScale",u),this.program.setUniform3fv("lightingMainDirectionView",
h),this.program.setUniform2f("texelSize",1/a.linearDepthTexture.descriptor.width,1/a.linearDepthTexture.descriptor.height),a.shadowMap.bind(this.program),a.shadowMap.bindView(this.program,a.camera.center),b=a.shadowMap.getSnapshot(0),l.isSome(b)&&this.program.bindTexture(b,"highlightDepthTex"),b=a.shadowMap.getSnapshot(1),l.isSome(b)&&this.program.bindTexture(b,"defaultDepthTex"))};p._createClass(c,[{key:"primitiveType",get:function(){return d.PrimitiveType.TRIANGLE_STRIP}}]);return c}(f.ShaderTechnique);
f.shader=new A.ReloadableShaderModule(E.ShadowHighlightShader,()=>new Promise((g,c)=>v(["./ShadowHighlight.glsl"],g,c)));const h=y.create(),u=x.create(),t=z.create(),k=w.create();e.DefaultSnapshotSlot=1;e.HighlightShadowMapSlot=0;e.ShadowHighlightTechnique=f;Object.defineProperty(e,"__esModule",{value:!0})});