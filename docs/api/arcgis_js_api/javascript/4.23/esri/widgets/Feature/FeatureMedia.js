// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/events ../../core/watchUtils ../../core/accessorSupport/decorators/aliasOf ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureMedia/FeatureMediaViewModel ./support/FeatureElementInfo ./support/featureUtils ../support/chartUtils ../support/widgetUtils ../support/decorators/messageBundle ../../core/Logger ../support/jsxFactory ../support/widgetThemeUtils".split(" "),
function(t,m,C,w,r,l,K,L,x,D,E,y,F,G,z,A,H,M,n,I){l=function(B){function u(a,b){var c=B.call(this,a,b)||this;c._refreshTimer=null;c._refreshIntervalInfo=null;c._featureElementInfo=null;c.attributes=null;c.activeMediaInfoIndex=null;c.description=null;c.fieldInfoMap=null;c.layer=null;c.mediaInfos=null;c.popupTemplate=null;c.relatedInfos=null;c.title=null;c.viewModel=new y;c.messages=null;c._getChartDependencies=function(){var k=t._asyncToGenerator(function*(e){const g=yield z.loadChartsModule(),{destroyed:f,
viewModel:d}=t._assertThisInitialized(c);if(!f&&d&&e){var {activeMediaInfo:p}=d;c._renderChart({chartDiv:e,mediaInfo:p,chartsModule:g})}});return function(e){return k.apply(this,arguments)}}();return c}t._inheritsLoose(u,B);var h=u.prototype;h.initialize=function(){this._featureElementInfo=new F;this.own(w.init(this,["viewModel.activeMediaInfo","viewModel.activeMediaInfoIndex"],()=>this._setupMediaRefreshTimer()),w.init(this,["viewModel.description","viewModel.title"],()=>this._setupFeatureElementInfo()))};
h.destroy=function(){this._clearMediaRefreshTimer();this._featureElementInfo.destroy()};h.render=function(){var a;return n.tsx("div",{bind:this,class:"esri-feature-media",onkeyup:this._handleMediaKeyup},null==(a=this._featureElementInfo)?void 0:a.render(),this.renderMedia())};h.renderMedia=function(){const {formattedMediaInfoCount:a}=this.viewModel;return a?n.tsx("div",{key:"media-element-container",class:"esri-feature-media__container"},this.renderMediaPageButton("previous"),this.renderMediaInfo(),
this.renderMediaPageButton("next")):null};h.renderImageMediaInfo=function(a){var {_refreshIntervalInfo:b}=this;const {activeMediaInfoIndex:c,formattedMediaInfoCount:k}=this.viewModel,{value:e,refreshInterval:g,altText:f,title:d,type:p}=a,{sourceURL:v,linkURL:q}=e;a=G.shouldOpenInNewTab(q)?"_blank":"_self";const J="_blank"===a?"noreferrer":"";b=g?b:null;b=n.tsx("img",{alt:f||d,key:`media-${p}-${c}-${k}-${b?b.timestamp:0}`,src:b?b.sourceURL:v});return(a=q?n.tsx("a",{title:d,href:q,rel:J,target:a},b):
null)?a:b};h.renderChartMediaInfo=function(a){const {activeMediaInfoIndex:b,formattedMediaInfoCount:c}=this.viewModel;return n.tsx("div",{key:`media-${a.type}-${b}-${c}`,bind:this,class:"esri-feature-media__chart",afterCreate:this._getChartDependencies})};h.renderMediaInfoType=function(){const {activeMediaInfo:a}=this.viewModel;return a?"image"===a.type?this.renderImageMediaInfo(a):-1!==a.type.indexOf("chart")?this.renderChartMediaInfo(a):null:null};h.renderMediaInfo=function(){var {activeMediaInfo:a}=
this.viewModel;if(!a)return null;const b=a.title?n.tsx("div",{key:"media-title",class:"esri-feature-media__item-title",innerHTML:a.title}):null;a=a.caption?n.tsx("div",{key:"media-caption",class:"esri-feature-media__item-caption",innerHTML:a.caption}):null;return n.tsx("div",{key:"media-container",class:"esri-feature-media__item-container"},n.tsx("div",{key:"media-item-container",class:"esri-feature-media__item"},this.renderMediaInfoType()),b,a)};h.renderMediaPageButton=function(a){if(2>this.viewModel.formattedMediaInfoCount)return null;
const b=(a="previous"===a)?this.messages.previous:this.messages.next,c=a?this.classes("esri-feature-media__button","esri-feature-media__previous"):this.classes("esri-feature-media__button","esri-feature-media__next"),k=a?this.classes("esri-feature-media__icon","esri-feature-media__previous-icon","esri-icon-left-triangle-arrow"):this.classes("esri-feature-media__icon","esri-feature-media__next-icon","esri-icon-right-triangle-arrow"),e=a?this.classes("esri-feature-media__icon","esri-feature-media__previous-icon--rtl",
"esri-icon-right-triangle-arrow"):this.classes("esri-feature-media__icon","esri-feature-media__next-icon--rtl","esri-icon-left-triangle-arrow");return n.tsx("button",{type:"button",key:a?"media-previous":"media-next",title:b,"aria-label":b,tabIndex:0,class:c,bind:this,onclick:a?this._previous:this._next},n.tsx("span",{"aria-hidden":"true",class:k}),n.tsx("span",{"aria-hidden":"true",class:e}))};h._setupFeatureElementInfo=function(){const {description:a,title:b}=this;this._featureElementInfo.set({description:a,
title:b})};h._next=function(){this.viewModel.next()};h._previous=function(){this.viewModel.previous()};h._handleMediaKeyup=function(a){const b=C.eventKey(a);"ArrowLeft"===b&&(a.stopPropagation(),this.viewModel.previous());"ArrowRight"===b&&(a.stopPropagation(),this.viewModel.next())};h._renderChart=function(a){const {abilities:b}=this.viewModel,{chartsModule:c,chartDiv:k,mediaInfo:e}=a,{value:g,type:f}=e,{am4core:d}=c,p=z.getColorSet(d);I.isDarkTheme()&&d.useTheme(c.am4themes_dark);const v=window.matchMedia("(prefers-reduced-motion: reduce)");
b.chartAnimation&&!v.matches?d.useTheme(c.am4themes_animated):d.unuseTheme(c.am4themes_animated);d.useTheme(function(q){q instanceof d.ColorSet&&p&&(q.list=p)});a="pie-chart"===f?this._createPieChart(a):this._createXYChart(a);k.setAttribute("aria-label",e.altText||e.title);a.data=g.series.map(q=>({tooltip:q.tooltip,value:q.value})).filter(q=>"pie-chart"===f?0<q.value:!0)};h._customizeChartTooltip=function(a,b){a.label.wrap=!0;a.label.maxWidth=200;a.autoTextColor=!1;a.getFillFromObject=!1;a.label.fill=
b.color("#ffffff");a.background.fill=b.color({r:0,g:0,b:0,a:.7})};h._createPieChart=function(a){const {chartDiv:b,chartsModule:c}=a,{am4core:k,am4charts:e}=c;a=k.create(b,e.PieChart);a.rtl=A.isRTL(this.container);const g=a.series.push(new e.PieSeries);g.labels.template.disabled=!0;g.ticks.template.disabled=!0;g.dataFields.value="value";g.dataFields.category="tooltip";this._customizeChartTooltip(g.tooltip,k);g.slices.template.tooltipText=a.rtl?"{category}: %{value.percent.formatNumber('#.0')}":"{category}: {value.percent.formatNumber('#.0')}%";
return a};h._getMinSeriesValue=function(a){let b=0;a.forEach(c=>b=Math.min(c.value,b));return b};h._createColumnChart=function(a,b){const {chartsModule:c,mediaInfo:k}=b;({value:b}=k);const {am4core:e,am4charts:g}=c,f=a.xAxes.push(new g.CategoryAxis);f.dataFields.category="tooltip";f.renderer.labels.template.disabled=!0;this._customizeChartTooltip(f.tooltip,e);f.tooltip.events.on("sizechanged",()=>{f.tooltip.dy=-f.tooltip.contentHeight});var d=a.yAxes.push(new g.ValueAxis);const p=d.renderer.labels.template;
d.renderer.minLabelPosition=.05;d.renderer.maxLabelPosition=.95;d.min=this._getMinSeriesValue(b.series);this._customizeChartTooltip(d.tooltip,e);p.wrap=!0;d=a.series.push(new g.ColumnSeries);d.dataFields.valueY="value";d.dataFields.categoryX="tooltip";a.cursor=new g.XYCursor;15<b.series.length&&(a.scrollbarX=new e.Scrollbar)};h._createBarChart=function(a,b){const {chartsModule:c,mediaInfo:k}=b;({value:b}=k);const {am4core:e,am4charts:g}=c,f=a.yAxes.push(new g.CategoryAxis);f.dataFields.category="tooltip";
f.renderer.inversed=!0;f.renderer.labels.template.disabled=!0;this._customizeChartTooltip(f.tooltip,e);f.tooltip.events.on("sizechanged",()=>{f.tooltip.dx=f.tooltip.contentWidth});var d=a.xAxes.push(new g.ValueAxis);const p=d.renderer.labels.template;d.renderer.minLabelPosition=.05;d.renderer.maxLabelPosition=.95;d.min=this._getMinSeriesValue(b.series);this._customizeChartTooltip(d.tooltip,e);p.wrap=!0;d=a.series.push(new g.ColumnSeries);d.dataFields.valueX="value";d.dataFields.categoryY="tooltip";
a.cursor=new g.XYCursor;15<b.series.length&&(a.scrollbarY=new e.Scrollbar)};h._createLineChart=function(a,b){const {chartsModule:c,mediaInfo:k}=b;({value:b}=k);const {am4core:e,am4charts:g}=c,f=a.xAxes.push(new g.CategoryAxis);f.dataFields.category="tooltip";f.renderer.labels.template.disabled=!0;this._customizeChartTooltip(f.tooltip,e);f.tooltip.events.on("sizechanged",()=>{f.tooltip.dy=-f.tooltip.contentHeight});var d=a.yAxes.push(new g.ValueAxis);const p=d.renderer.labels.template;d.renderer.minLabelPosition=
.05;d.renderer.maxLabelPosition=.95;d.min=this._getMinSeriesValue(b.series);this._customizeChartTooltip(d.tooltip,e);p.wrap=!0;d=a.series.push(new g.LineSeries);d.dataFields.categoryX="tooltip";d.dataFields.valueY="value";a.cursor=new g.XYCursor;15<b.series.length&&(a.scrollbarX=new e.Scrollbar)};h._createXYChart=function(a){const {chartDiv:b,chartsModule:c,mediaInfo:k}=a,{type:e}=k,{am4core:g,am4charts:f}=c,d=g.create(b,f.XYChart);d.rtl=A.isRTL(this.container);"column-chart"===e&&this._createColumnChart(d,
a);"bar-chart"===e&&this._createBarChart(d,a);"line-chart"===e&&this._createLineChart(d,a);return d};h._clearMediaRefreshTimer=function(){const {_refreshTimer:a}=this;a&&(clearTimeout(a),this._refreshTimer=null)};h._updateMediaInfoTimestamp=function(a){const b=Date.now();this._refreshIntervalInfo={timestamp:b,sourceURL:this._getImageSource(a,b)};this.scheduleRender()};h._setupMediaRefreshTimer=function(){this._clearMediaRefreshTimer();const {activeMediaInfo:a}=this.viewModel;a&&"image"===a.type&&
a.refreshInterval&&this._setRefreshTimeout(a)};h._setRefreshTimeout=function(a){const {refreshInterval:b,value:c}=a;b&&(a=6E4*b,this._updateMediaInfoTimestamp(c.sourceURL),this._refreshTimer=setInterval(()=>{this._updateMediaInfoTimestamp(c.sourceURL)},a))};h._getImageSource=function(a,b){const c=-1!==a.indexOf("?")?"\x26":"?",[k,e=""]=a.split("#");return`${k}${c}timestamp=${b}${e?"#":""}${e}`};return u}(E);m.__decorate([r.aliasOf("viewModel.attributes")],l.prototype,"attributes",void 0);m.__decorate([r.aliasOf("viewModel.activeMediaInfoIndex")],
l.prototype,"activeMediaInfoIndex",void 0);m.__decorate([r.aliasOf("viewModel.description")],l.prototype,"description",void 0);m.__decorate([r.aliasOf("viewModel.fieldInfoMap")],l.prototype,"fieldInfoMap",void 0);m.__decorate([r.aliasOf("viewModel.layer")],l.prototype,"layer",void 0);m.__decorate([r.aliasOf("viewModel.mediaInfos")],l.prototype,"mediaInfos",void 0);m.__decorate([r.aliasOf("viewModel.popupTemplate")],l.prototype,"popupTemplate",void 0);m.__decorate([r.aliasOf("viewModel.relatedInfos")],
l.prototype,"relatedInfos",void 0);m.__decorate([r.aliasOf("viewModel.title")],l.prototype,"title",void 0);m.__decorate([x.property({type:y})],l.prototype,"viewModel",void 0);m.__decorate([x.property(),H.messageBundle("esri/widgets/Feature/t9n/Feature")],l.prototype,"messages",void 0);return l=m.__decorate([D.subclass("esri.widgets.Feature.FeatureMedia")],l)});