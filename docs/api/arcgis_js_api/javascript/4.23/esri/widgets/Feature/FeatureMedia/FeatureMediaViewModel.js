// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass ../../../popup/FieldInfo ../../../popup/content/support/ChartMediaInfoValueSeries ../support/featureUtils ../support/relatedFeatureUtils".split(" "),function(A,l,e,n,H,I,D,E,F,G,m,x){const B={chartAnimation:!0};e=
function(C){function y(a){a=C.call(this,a)||this;a.abilities={...B};a.activeMediaInfoIndex=0;a.attributes=null;a.description=null;a.fieldInfoMap=null;a.formattedAttributes=null;a.expressionAttributes=null;a.layer=null;a.mediaInfos=null;a.popupTemplate=null;a.relatedInfos=null;a.title=null;return a}A._inheritsLoose(y,C);var r=y.prototype;r.castAbilities=function(a){return{...B,...a}};r.setActiveMedia=function(a){this._setContentElementMedia(a)};r.next=function(){this._pageContentElementMedia(1)};r.previous=
function(){this._pageContentElementMedia(-1)};r._setContentElementMedia=function(a){const {formattedMediaInfoCount:c}=this;this.activeMediaInfoIndex=(a+c)%c};r._pageContentElementMedia=function(a){const {activeMediaInfoIndex:c}=this;this._setContentElementMedia(c+a)};r._formatMediaInfos=function(){const {attributes:a,mediaInfos:c,formattedAttributes:d,expressionAttributes:k,fieldInfoMap:f,layer:g}=this;return null==c?void 0:c.map(b=>{b=null==b?void 0:b.clone();if(!b)return null;b.title=m.substituteFieldsInLinksAndAttributes({attributes:a,
fieldInfoMap:f,globalAttributes:d,expressionAttributes:k,layer:g,text:b.title});b.caption=m.substituteFieldsInLinksAndAttributes({attributes:a,fieldInfoMap:f,globalAttributes:d,expressionAttributes:k,layer:g,text:b.caption});b.altText=m.substituteFieldsInLinksAndAttributes({attributes:a,fieldInfoMap:f,globalAttributes:d,expressionAttributes:k,layer:g,text:b.altText});if("image"===b.type){var {value:p}=b;this._setImageValue({value:p,formattedAttributes:d,layer:g});return b.value.sourceURL?b:void 0}return"pie-chart"===
b.type||"line-chart"===b.type||"column-chart"===b.type||"bar-chart"===b.type?({value:p}=b,this._setChartValue({value:p,chartType:b.type,attributes:a,formattedAttributes:d,layer:g}),b):null}).filter(Boolean)};r._setImageValue=function(a){const {fieldInfoMap:c}=this,{value:d,formattedAttributes:k,layer:f}=a,{linkURL:g,sourceURL:b}=d;b&&(a=m.fixTokens(b,f),d.sourceURL=m.substituteAttributes({formattedAttributes:k,template:a,fieldInfoMap:c}));g&&(a=m.fixTokens(g,f),d.linkURL=m.substituteAttributes({formattedAttributes:k,
template:a,fieldInfoMap:c}))};r._setChartValue=function(a){const {value:c,attributes:d,formattedAttributes:k,chartType:f,layer:g}=a,{popupTemplate:b,relatedInfos:p}=this,{fields:q,normalizeField:v}=c;c.fields=m.getFixedFieldNames(q,g);v&&(c.normalizeField=m.getFixedFieldName(v,g));if(q.some(h=>!!(null!=k[h]||m.isRelatedField(h)&&p.size))){var u=null==b?void 0:b.fieldInfos;q.forEach(h=>{m.isRelatedField(h)?c.series=[...c.series,...this._getRelatedChartInfos({fieldInfos:u,fieldName:h,formattedAttributes:k,
chartType:f,value:c})]:(h=this._getChartOption({value:c,attributes:d,chartType:f,formattedAttributes:k,fieldName:h,fieldInfos:u}),c.series.push(h))})}};r._getRelatedChartInfos=function(a){var c;const {fieldInfos:d,fieldName:k,formattedAttributes:f,chartType:g,value:b}=a,p=[];a=x.getRelatedFieldInfo(k);const {layerId:q,fieldName:v}=a;a=null==(c=this.relatedInfos)?void 0:c.get(q.toString());if(!a)return p;const {relatedFeatures:u,relation:h}=a;if(!h||!u)return p;({cardinality:c}=h);u.forEach(z=>{const {attributes:t}=
z;t&&Object.keys(t).forEach(w=>{w===v&&p.push(this._getChartOption({value:b,attributes:t,formattedAttributes:f,fieldName:k,chartType:g,relatedFieldName:w,fieldInfos:d}))})});return"one-to-many"===c||"many-to-many"===c?p:[p[0]]};r._getTooltip=function({label:a,value:c,chartType:d}){return"pie-chart"===d?a:`${a}: ${c}`};r._getChartOption=function(a){const {value:c,attributes:d,formattedAttributes:k,fieldName:f,relatedFieldName:g,fieldInfos:b,chartType:p}=a;var {layer:q}=this;const {normalizeField:v,
tooltipField:u}=c;var h=v?m.isRelatedField(v)?d[x.getRelatedFieldInfo(v).fieldName]:d[v]:null;a=g&&void 0!==d[g]?d[g]:void 0!==d[f]?d[f]:k[f];const z=void 0===a?null:a&&h?a/h:a;a=new G({value:z});if(m.isRelatedField(f)){var t=x.getRelatedFieldInfo(f);var w=x.getRelatedFieldInfo(u);w=w?w.fieldName:null;q=m.formatValueToFieldInfo(z,{fieldInfos:b,fieldName:g,layer:q,preventPlacesFormatting:!!h});t=t?t.label||t.fieldName:g;a.tooltip=this._getTooltip({label:w&&void 0!==d[w]?d[w]:t,value:q,chartType:p});
return a}h=m.getFieldInfo(b,f);q=m.getFixedFieldName(f,q);h=u&&void 0!==k[u]?k[u]:m.getFieldInfoLabel(h||new F({fieldName:q}),null==(t=this.popupTemplate)?void 0:t.expressionInfos);a.tooltip=this._getTooltip({label:h,value:k[q],chartType:p});return a};A._createClass(y,[{key:"activeMediaInfo",get:function(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}},{key:"formattedMediaInfos",get:function(){return this._formatMediaInfos()||[]}},{key:"formattedMediaInfoCount",get:function(){return this.formattedMediaInfos.length}}]);
return y}(e);l.__decorate([n.property()],e.prototype,"abilities",void 0);l.__decorate([D.cast("abilities")],e.prototype,"castAbilities",null);l.__decorate([n.property()],e.prototype,"activeMediaInfoIndex",void 0);l.__decorate([n.property({readOnly:!0})],e.prototype,"activeMediaInfo",null);l.__decorate([n.property()],e.prototype,"attributes",void 0);l.__decorate([n.property()],e.prototype,"description",void 0);l.__decorate([n.property()],e.prototype,"fieldInfoMap",void 0);l.__decorate([n.property()],
e.prototype,"formattedAttributes",void 0);l.__decorate([n.property()],e.prototype,"expressionAttributes",void 0);l.__decorate([n.property({readOnly:!0})],e.prototype,"formattedMediaInfos",null);l.__decorate([n.property()],e.prototype,"layer",void 0);l.__decorate([n.property({readOnly:!0})],e.prototype,"formattedMediaInfoCount",null);l.__decorate([n.property()],e.prototype,"mediaInfos",void 0);l.__decorate([n.property()],e.prototype,"popupTemplate",void 0);l.__decorate([n.property()],e.prototype,"relatedInfos",
void 0);l.__decorate([n.property()],e.prototype,"title",void 0);return e=l.__decorate([E.subclass("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],e)});