// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/HandleOwner ../../core/Loadable ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../geometry/projection ../../geometry/support/spatialReferenceUtils ../../support/basemapUtils ./support/basemapCompatibilityUtils ./support/BasemapGalleryItem ./support/LocalBasemapsSource ./support/PortalBasemapsSource".split(" "),
function(q,e,r,d,t,l,u,f,E,F,A,B,m,v,C,w,x,D,h){const y=r.ofType(x);d=function(z){function k(a){a=z.call(this,a)||this;a._loadingProjectionEngine=!1;a.items=new y;a.source=new h;a.view=null;return a}q._inheritsLoose(k,z);var g=k.prototype;g.initialize=function(){const a=()=>this._recreateItems();this.handles.add([u.watch(()=>"ready"===this.state?this.compatibilityFunction:null,()=>this._updateItems()),u.on(()=>{var b;return null==(b=this.source)?void 0:b.basemaps},"change",a,{onListenerAdd:a})])};
g.castSource=function(a){return Array.isArray(a)||r.isCollection(a)?new D({basemaps:a}):a&&"esri.portal.Portal"===a.declaredClass?new h({portal:a}):!a||a instanceof h||!a.portal&&!a.query?a&&"basemaps"in a&&"state"in a&&"refresh"in a?a:null:new h(a)};g.basemapEquals=function(a,b){return C.contentEquals(a,b)};g.refresh=function(){this._recreateItems()};g.load=function(a){this.addResolvingPromise(t.isLoadable(this.source)?this.source.load(a):null);return Promise.resolve(this)};g._recreateItems=function(){var a;
const b=null==(a=this.source)?void 0:a.basemaps,{view:c,compatibilityFunction:n}=this;this.items.removeAll().forEach(p=>p.destroy());b&&this.items.addMany(b.map(p=>new x({basemap:p,compatibilityFunction:n,view:c})))};g._updateItems=function(){for(const a of this.items)a.compatibilityFunction=this.compatibilityFunction,a.view=this.view};q._createClass(k,[{key:"activeBasemap",get:function(){var a,b,c;return null!=(a=null==(b=this.view)?void 0:null==(c=b.map)?void 0:c.basemap)?a:null},set:function(a){var b;
if(this.view.map)if(a&&this.view.ready){var c=a.spatialReference||(null==(b=this.items)?void 0:b.find(n=>n.basemap===a).spatialReference);c&&"spatialReferenceLocked"in this.view&&!this.view.spatialReferenceLocked?(b=this.view.spatialReference,!l.isSome(c)||v.equals(b,c)||m.canProjectWithoutEngine(this.view.spatialReference,c)||m.isLoaded()?(this.view.map.basemap=a,this._clearOverride("activeBasemap"),l.isSome(c)&&!v.equals(this.view.spatialReference,c)&&(this.view.spatialReference=c)):(this._override("activeBasemap",
a),this._loadingProjectionEngine=!0,m.load().then(()=>{this._get("activeBasemap")===a&&(this.view.map.basemap=a,this.view.spatialReference=c,this._clearOverride("activeBasemap"))},()=>{}).then(()=>{this._loadingProjectionEngine=!1}))):(this.view.map.basemap=a,this._clearOverride("activeBasemap"))}else this.view.map.basemap=a,this._clearOverride("activeBasemap")}},{key:"compatibilityFunction",get:function(){var a;return"3d"===(null==(a=this.view)?void 0:a.type)?w.default3DCompatibility:w.default2DCompatibility},
set:function(a){l.isSome(a)?this._override("compatibilityFunction",a):this._clearOverride("compatibilityFunction")}},{key:"state",get:function(){var a;return null!=(a=this.view)&&a.ready&&this.source?this._loadingProjectionEngine?"loading":"ready":"disabled"}}]);return k}(d.HandleOwnerMixin(t));e.__decorate([f.property()],d.prototype,"_loadingProjectionEngine",void 0);e.__decorate([f.property()],d.prototype,"activeBasemap",null);e.__decorate([f.property()],d.prototype,"compatibilityFunction",null);
e.__decorate([f.property({readOnly:!0,type:y})],d.prototype,"items",void 0);e.__decorate([f.property()],d.prototype,"source",void 0);e.__decorate([A.cast("source")],d.prototype,"castSource",null);e.__decorate([f.property({readOnly:!0})],d.prototype,"state",null);e.__decorate([f.property()],d.prototype,"view",void 0);return d=e.__decorate([B.subclass("esri.widgets.BasemapGallery.BasemapGalleryViewModel")],d)});