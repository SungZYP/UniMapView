// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../layers/support/layerUtils ../../../views/ViewingMode ../../../views/3d/terrain/terrainUtils ../../../views/3d/terrain/TilingScheme ../../../views/support/spatialReferenceSupport".split(" "),function(n,p,e,q,m,w,r,h,y,z){function t(){t=p._asyncToGenerator(function*(a,b={}){yield A(a,b);m.throwIfAborted(b)});return t.apply(this,arguments)}function u(){u=p._asyncToGenerator(function*(a,
b={}){const {basemap:c,view:f}=a;m.throwIfAborted(b);if(!("spatialReferenceLocked"in f)||f.spatialReferenceLocked)if(yield c.load(b),m.throwIfAborted(b),0!==c.baseLayers.length&&(a=c.baseLayers.getItemAt(0),w.isTiledLayer(a))){if(c.spatialReference){if(f.spatialReference.equals(c.spatialReference))return;x()}yield a.load(b);m.throwIfAborted(b);b=(("supportedSpatialReferences"in a?a.supportedSpatialReferences:null)||["tileInfo"in a?a.tileInfo.spatialReference:null]).filter(Boolean);0!==b.length&&b.every(d=>
!f.spatialReference.equals(d))&&x()}});return u.apply(this,arguments)}function x(){throw new e("basemap-compatibility:incompatible-spatial-reference","Basemap spatial reference is not compatible with the view");}function A(a,b){return v.apply(this,arguments)}function v(){v=p._asyncToGenerator(function*(a,b){const {basemap:c,view:f}=a;yield c.load(b);if(0!==c.baseLayers.length){a=c.baseLayers.concat(c.referenceLayers);a=B(a);if(a.length)throw a[0];a=c.baseLayers.getItemAt(0);try{yield a.load(b)}catch(k){const {name:C=
"basemap-compatibility:unknown-error",message:D="Unknown basemap compatibility error",details:E}=k;throw new e(C,D,E);}var d=f.state.viewingMode;if(d){b=a.tileInfo;var g=a.fullExtent;if(w.isWMTSLayer(a)){g=h.getTileInfoAndExtentFromWMTSLayer(a,f.spatialReference,d);if(q.isNone(g.tileInfo))throw new e("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view");b=g.tileInfo;g=g.fullExtent}if(!q.isNone(b)){if(!z.isSpatialReferenceSupported(b.spatialReference,
d))throw new e(`basemapgalleryitem:spatial-reference-unsupported-${r.stringFromViewingMode(d)}`,`Basemap spatial reference is unsupported in ${r.stringFromViewingMode(d)} mode`);var l=b.spatialReference.isGeographic;l=h.isVectorTileLayer(a)?b.getOrCreateCompatible(256,l?1:2):null;if(d===r.ViewingMode.Global){let k=h.checkIfTileInfoSupportedForView(b,g,null,d);k&&h.isVectorTileLayer(a)&&q.isSome(g)&&l&&!h.checkIfTileInfoSupportedForView(l,g,null,d)&&(k=null);if(k)throw new e(`basemapgalleryitem:tiling-scheme-unsupported-${b.spatialReference.isWebMercator?
"web-mercator":"wgs84"}-global`,"Basemap tiling scheme is unsupported in global mode",{error:k});}else if(y.default.checkUnsupported(b))throw new e("basemapgalleryitem:tiling-scheme-unsupported-local","Basemap tiling scheme is unsupported in local mode");if((d=f.get("basemapTerrain.tilingScheme"))&&!d.compatibleWith(b)&&!(h.isVectorTileLayer(a)&&l&&d.compatibleWith(l)))throw new e("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view");}}}});return v.apply(this,
arguments)}function B(a){const b=["ArcGISTiledImageServiceLayer","ArcGISTiledMapServiceLayer","OpenStreetMap","VectorTileLayer","WebTiledLayer"];return a.toArray().filter(c=>-1===b.indexOf(c.operationalLayerType)).map(c=>new e("basemap-compatibility:unsupported-basemap-layer-type","Unsupported basemap layer type ${operationalLayerType}",{layer:c,operationalLayerType:c.operationalLayerType||"unknown"}))}n.default2DCompatibility=function(a){return u.apply(this,arguments)};n.default3DCompatibility=function(a){return t.apply(this,
arguments)};Object.defineProperty(n,"__esModule",{value:!0})});