// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../config ../../Graphic ../../symbols ../../core/Collection ../../core/Error ../../core/Evented ../../core/HandleOwner ../../core/maybe ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/aliasOf ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass ../../intl/locale ../../layers/GraphicsLayer ../../layers/RouteLayer ../../layers/support/DefaultSymbols ../../rest/networkService ../../rest/support/RouteParameters ../../rest/support/Stop ../support/GoTo ../../symbols/SimpleLineSymbol ../../symbols/SimpleMarkerSymbol ../../symbols/PictureMarkerSymbol".split(" "),
function(q,e,G,H,z,u,I,v,d,J,f,A,r,K,X,Y,L,g,M,N,O,P,Q,R,B,S,T,C,w,D){function U(h){return Array.isArray(h)&&0<h.length&&h[0]instanceof z}function V(h){return I.isCollection(h)&&0<h.length&&h.getItemAt(0)instanceof z}u=[105,220,255];const E=new C({color:u,width:7,cap:"round",join:"round"}),p={first:new w({color:u,size:19,outline:{color:[51,51,51],width:3}}),middle:new w({color:[51,51,51],size:12,outline:{color:u,width:3}}),last:new D({width:23,height:23,url:`data:image/svg+xml;base64,${btoa('\x3csvg width\x3d"30" height\x3d"30" viewBox\x3d"0 0 30 30" xmlns\x3d"http://www.w3.org/2000/svg"\x3e\x3cg fill-rule\x3d"nonzero" fill\x3d"none"\x3e\x3cpath d\x3d"M15.15.3C6.9.3.3 6.9.3 15.15S6.9 29.7 15.15 29.7 29.7 23.1 29.7 15.15C29.7 6.9 23.25.3 15.15.3z" fill\x3d"#333"/\x3e\x3cpath d\x3d"M15 4.8C9.3 4.8 4.8 9.45 4.8 15c0 5.55 4.65 10.2 10.2 10.2 5.55 0 10.2-4.5 10.2-10.2 0-5.55-4.5-10.2-10.2-10.2z" fill\x3d"#69DCFF"/\x3e\x3cpath fill\x3d"#333" d\x3d"M10.5 10.5h9v9h-9z"/\x3e\x3c/g\x3e\x3c/svg\x3e')}`}),
unlocated:new D({height:18,width:18,url:`data:image/svg+xml;base64,${btoa('\x3csvg width\x3d"20" height\x3d"20" viewBox\x3d"0 0 20 20" xmlns\x3d"http://www.w3.org/2000/svg"\x3e\x3cg fill\x3d"none" fill-rule\x3d"evenodd"\x3e\x3cpath d\x3d"M10.1.2C4.6.2.2 4.6.2 10.1s4.4 9.7 9.9 9.7 9.7-4.4 9.7-9.7c0-5.5-4.3-9.9-9.7-9.9z" fill\x3d"#333" fill-rule\x3d"nonzero"/\x3e\x3cpath d\x3d"M10 2.7c-4.08 0-7.3 3.328-7.3 7.3s3.328 7.3 7.3 7.3 7.3-3.22 7.3-7.3c0-3.972-3.22-7.3-7.3-7.3z" fill\x3d"#69DCFF" fill-rule\x3d"nonzero"/\x3e\x3cpath d\x3d"M11.414 10l5.304-5.303-1.415-1.415L10 8.586 4.697 3.282 3.282 4.697 8.586 10l-5.304 5.303 1.415 1.415L10 11.414l5.303 5.304 1.415-1.415L11.414 10z" fill\x3d"#333"/\x3e\x3c/g\x3e\x3c/svg\x3e')}`}),
waypoint:new w({color:[255,255,255],size:10,outline:{color:[20,89,127],width:2.5}})};var l;(function(h){h[h.Active=0]="Active";h[h.Complete=1]="Complete";h[h.Failed=2]="Failed";h[h.Idle=3]="Idle";h[h.Suspended=4]="Suspended"})(l||(l={}));d=function(h){function x(a){a=h.call(this,a)||this;a._highlightLayer=new O({listMode:"hide"});a._loadPromise=null;a._loadController=null;a._routeLayer=new P({listMode:"hide",defaultSymbols:new Q({directionLines:E,directionPoints:new w({size:0}),routeInfo:new C({width:0}),
firstStop:p.first,middleStop:p.middle,lastStop:p.last,invalidStop:p.unlocated,waypointStop:p.waypoint,breakStop:p.waypoint}),url:a.routeServiceUrl});a._routeController=null;a._serviceDescriptionStatus=l.Idle;a.apiKey=void 0;a.departureTime="now";a.lastRoute=null;a.routeParameters=new B({directionsLengthUnits:"kilometers",findBestSequence:!1,restrictUTurns:"at-dead-ends-and-intersections",returnZ:!0,startTime:null,startTimeIsUTC:!0,useHierarchy:!0,useTimeWindows:!1});a.routeSymbol=E;a.serviceDescription=
null;a.error=null;a.stops=null;a.view=null;return a}q._inheritsLoose(x,h);var m=x.prototype;m.initialize=function(){this.handles.add([r.on(()=>this.stops,"change",()=>{this.clearResults()}),r.watch(()=>{var a;return null==(a=this.view)?void 0:a.map},(a,b)=>{const c=[this._routeLayer,this._highlightLayer];b&&b.removeMany(c);a&&a.addMany(c)},r.initial),r.watch(()=>this.routeServiceUrl,a=>{this._routeLayer.url=a;f.isSome(this._loadController)?(this._loadController.abort(),this._loadPromise=this._loadController=
null,this._set("serviceDescription",null),this.load()):this._set("serviceDescription",null)},r.syncAndInitial)])};m.destroy=function(){var a;null==(a=this.view)?void 0:a.map.removeMany([this._routeLayer,this._highlightLayer])};m.castStops=function(a){return U(a)||V(a)?a.map(b=>S.fromPortalJSON(b.toJSON())):a};m.load=function(){var a=q._asyncToGenerator(function*(){if(f.isSome(this._loadPromise))return this._loadPromise;this._loadPromise=this._load();yield this._loadPromise;this._loadPromise=null});
return function(){return a.apply(this,arguments)}}();m.highlightSegment=function(a){const {geometry:b,symbol:c}=a;f.isNone(this.view)||f.isNone(b)||f.isNone(c)||(this.clearHighlights(),a=c.clone(),a.color=new G([0,0,0,.8]),a.width=Math.ceil(a.width/2),a=new z({geometry:b,symbol:a}),this._highlightLayer.add(a))};m.clearHighlights=function(){this._highlightLayer.removeAll()};m.centerAt=function(a){f.isNone(this.view)||(a="esri.rest.support.Stop"===(null==a?void 0:a.declaredClass)?f.unwrap(a.geometry):
a,this.callGoTo({target:a}))};m.clearResults=function(){this._set("lastRoute",null)};m.getDirections=function(){var a=q._asyncToGenerator(function*(){var {state:b}=this;if("unauthenticated"===b||"initializing"===b||"disabled"===b||this._serviceDescriptionStatus===l.Failed)return Promise.reject(new v("directions-view-model:not-loaded","Cannot get directions until view model loads."));this._set("error",null);f.isSome(this._routeController)&&(this._routeController.abort(),this._routeController=null);
const {apiKey:c,departureTime:k}=this;var y="now"===k,n="now"===k?new Date:k;n&&!y&&(b=6E4*n.getTimezoneOffset(),n.setTime(n.getTime()-b));const W=f.isSome(this.view)?this.view.spatialReference:null;b=this.routeParameters.clone();b.set({startTime:n,startTimeIsUTC:y,directionsLanguage:this._directionsLanguage,apiKey:c,outSpatialReference:W});f.isSome(this.selectedTravelMode)&&(b.travelMode=this.selectedTravelMode);if(2>this.stops.length){var t=new v("directions-view-model:not-enough-stops","Not enough stops for routing");
this._set("error",t);return Promise.reject(t)}this._routeController=new AbortController;({signal:y}=this._routeController);n=null;try{n=yield this._routeLayer.solve(b,{signal:y}),this._routeLayer.update(n),this._set("lastRoute",n)}catch(F){if(!A.isAbortError(F))throw t=new v("directions-view-model:unable-to-route","Unable to route to these addresses",{error:F}),this._set("error",t),this._set("lastRoute",null),t;}finally{this._routeController=null}this.zoomToRoute();return n});return function(){return a.apply(this,
arguments)}}();m.getCostAttribute=function(a){const b=(f.isSome(this.serviceDescription)?this.serviceDescription.networkDataset.networkAttributes:[]).find(c=>c.name===a&&"esriNAUTCost"===c.usageType);return null!=b?b:null};m.reset=function(){this.clearHighlights();this.clearResults();this._routeLayer.removeAll()};m.zoomToRoute=function(){const {view:a,lastRoute:b}=this;if(!f.isNone(a)&&!f.isNone(b)){var {routeInfo:c}=b;if(!f.isNone(c)&&({geometry:c}=c,!f.isNone(c))){({extent:c}=c);var k=c.width>c.height;
c=c.clone().expand(k?2:1);this.callGoTo({target:c})}}};m._load=function(){var a=q._asyncToGenerator(function*(){if(!f.isSome(this.serviceDescription)){f.isSome(this._loadController)&&(this._loadController.abort(),this._loadController=null);this._loadController=new AbortController;var {signal:b}=this._loadController;try{this._serviceDescriptionStatus=l.Active;const k=yield R.fetchServiceDescription(this.routeServiceUrl,this.apiKey,{signal:b});this._set("serviceDescription",k);this._serviceDescriptionStatus=
l.Complete}catch(k){if(A.isAbortError(k))this._serviceDescriptionStatus=l.Idle;else if("identity-manager:user-aborted"===k.name)this._serviceDescriptionStatus=l.Suspended;else{var c=new v("directions-view-model:service-metadata-unavailable","Cannot load route service metadata",{error:k});this._serviceDescriptionStatus=l.Failed;this._set("error",c);throw c;}}finally{this._loadController=null}}});return function(){return a.apply(this,arguments)}}();q._createClass(x,[{key:"_directionsLanguage",get:function(){var a;
if(!f.isNone(this.serviceDescription)){var b=this.serviceDescription.directionsSupportedLanguages;if(b){var c=(null!=(a=this.routeParameters.directionsLanguage)?a:N.getLocale()).slice(0,2);return b.find(k=>k.toLowerCase().slice(0,2)===c)}}}},{key:"impedanceAttribute",get:function(){var a,b,c,k=f.isSome(this.serviceDescription)?this.serviceDescription.impedance:null;k=null!=(a=null!=(b=null==(c=this.routeParameters.travelMode)?void 0:c.impedanceAttributeName)?b:this.routeParameters.impedanceAttribute)?
a:k;return this.getCostAttribute(k)}},{key:"maxStops",set:function(a){this._set("maxStops",2>=a?2:50<a?50:a)}},{key:"routeLayer",get:function(){return this._routeLayer}},{key:"routeServiceUrl",get:function(){return H.routeServiceUrl},set:function(a){null!=a?this._override("routeServiceUrl",a):this._clearOverride("routeServiceUrl")}},{key:"selectedTravelMode",get:function(){const {serviceDescription:a}=this;if(f.isNone(a))return null;const {defaultTravelMode:b,supportedTravelModes:c=[]}=a;return c.find(k=>
k.id===b)||c[0]||null},set:function(a){void 0===a?this._clearOverride("selectedTravelMode"):this._override("selectedTravelMode",a)}},{key:"state",get:function(){if(f.isSome(this._routeController))return"routing";if(f.isSome(this.error))return"error";switch(this._serviceDescriptionStatus){case l.Suspended:return"unauthenticated";case l.Idle:return"disabled";case l.Active:return"initializing";case l.Failed:return"error";default:return"ready"}}},{key:"stopSymbols",set:function(a){this._set("stopSymbols",
{...p,...a})}},{key:"timeAttribute",get:function(){var a,b,c;const k=null!=(a=null!=(b=null==(c=this.routeParameters.travelMode)?void 0:c.timeAttributeName)?b:this.routeParameters.directionsTimeAttribute)?a:f.isSome(this.serviceDescription)?this.serviceDescription.directionsTimeAttribute:null;return this.getCostAttribute(k)}},{key:"travelModes",get:function(){return f.isSome(this.serviceDescription)?this.serviceDescription.supportedTravelModes:[]}}]);return x}(J.HandleOwnerMixin(T.GoToMixin(d.EventedAccessor)));
e.__decorate([g.property()],d.prototype,"_directionsLanguage",null);e.__decorate([g.property()],d.prototype,"_routeController",void 0);e.__decorate([g.property()],d.prototype,"_serviceDescriptionStatus",void 0);e.__decorate([g.property()],d.prototype,"apiKey",void 0);e.__decorate([g.property()],d.prototype,"departureTime",void 0);e.__decorate([g.property({readOnly:!0})],d.prototype,"impedanceAttribute",null);e.__decorate([g.property({readOnly:!0})],d.prototype,"lastRoute",void 0);e.__decorate([g.property({value:50})],
d.prototype,"maxStops",null);e.__decorate([g.property()],d.prototype,"routeLayer",null);e.__decorate([g.property({type:B,nonNullable:!0})],d.prototype,"routeParameters",void 0);e.__decorate([g.property()],d.prototype,"routeServiceUrl",null);e.__decorate([g.property()],d.prototype,"routeSymbol",void 0);e.__decorate([g.property()],d.prototype,"selectedTravelMode",null);e.__decorate([g.property({readOnly:!0})],d.prototype,"serviceDescription",void 0);e.__decorate([g.property({readOnly:!0})],d.prototype,
"state",null);e.__decorate([g.property()],d.prototype,"error",void 0);e.__decorate([K.aliasOf("routeLayer.stops")],d.prototype,"stops",void 0);e.__decorate([L.cast("stops")],d.prototype,"castStops",null);e.__decorate([g.property({value:p})],d.prototype,"stopSymbols",null);e.__decorate([g.property({readOnly:!0})],d.prototype,"timeAttribute",null);e.__decorate([g.property()],d.prototype,"travelModes",null);e.__decorate([g.property()],d.prototype,"view",void 0);e.__decorate([g.property()],d.prototype,
"getDirections",null);e.__decorate([g.property()],d.prototype,"zoomToRoute",null);return d=e.__decorate([M.subclass("esri.widgets.Directions.DirectionsViewModel")],d)});