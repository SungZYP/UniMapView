// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../symbols ../../core/Collection ../../core/has ../../core/Error ../../core/Evented ../../core/Handles ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/projection ../../geometry/projectionEllipsoid ../../geometry/support/coordsUtils ../../geometry/support/spatialReferenceUtils ../../layers/GraphicsLayer ../../views/DOMContainer ../../views/3d/interactive/editingTools/isSupportedGraphicUtils ../../views/3d/interactive/editingTools/moveGraphic/isSupportedGraphic ../../views/3d/interactive/editingTools/reshapeGraphic/isSupportedGraphic ../../views/3d/interactive/editingTools/transformGraphic/isSupportedGraphic ../../views/draw/support/layerUtils ../../views/input/InputManager ../../views/interactive/keybindings ../../views/interactive/snapping/SnappingManager ../../views/interactive/snapping/SnappingOptions ../../views/support/screenUtils ./support/OperationHandle ../../symbols/SimpleMarkerSymbol ../../symbols/SimpleFillSymbol ../../symbols/SimpleLineSymbol".split(" "),
function(E,u,x,J,ca,w,da,ea,T,fa,q,R,F,y,ra,sa,ha,L,ia,U,ja,ka,la,H,ma,M,na,V,z,v,oa,W,X,K,S,Y,Z){function pa(B){return"polygon"===B||"rectangle"===B||"circle"===B?!0:!1}function N(B,G){aa("undo",B.history.undo,B.history.redo,G)}function O(B,G){aa("redo",B.history.redo,B.history.undo,G)}function aa(B,G,n,a){const b=G.pop().updates,d=[];a.forEach((c,g)=>{g=b[g];null!=g&&("geometry"in g&&q.isSome(g.geometry)&&(d.push({geometry:c.geometry}),c.geometry=g.geometry),"symbol"in g&&q.isSome(g.symbol)&&(d.push({symbol:c.symbol}),
c.symbol=g.symbol),"undo"in g&&(d.push(g),g[B](c)))});n.push({updates:d})}function I(B){return{updates:B.map(G=>({geometry:G.geometry}))}}function C(B){return"requireError"in B&&"aborted"===B.requireError}const P=B=>Object.freeze({__proto__:null,default:B}),qa=fa.getLogger("esri.widgets.Sketch.SketchViewModel"),ba={defaultZ:0},Q={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,
preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,tool:"transform"};w=function(B){function G(a){a=B.call(this,a)||this;a._numUpdating=0;a._handles=new T;a._internalGraphicsLayer=new ka({listMode:"hide",internal:!0,title:"SVM Internal"});a._operationHandle=null;a._viewHandles=new T;a.activeFillSymbol=null;a.activeLineSymbol=null;a.activeVertexSymbol=null;a.allowDeleteKey=!0;a.layer=null;a.pointSymbol=new S({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}});a.polygonSymbol=
new Y({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}});a.polylineSymbol=new Z({color:[130,130,130,1],width:2});a._snappingManager=null;a.updateGraphics=new ca;a.updateOnGraphicClick=!0;a.updatePointSymbol=new S({size:10,color:[0,200,255,.5],outline:{color:"black",width:1}});a.updatePolygonSymbol=new Y({color:[12,207,255,.2],outline:{join:"round",color:[12,207,255],width:2}});a.updatePolylineSymbol=new Z({color:[12,207,255],width:2});a.vertexSymbol=new S({style:"circle",size:6,color:[255,
255,255],outline:{color:[50,50,50],width:1}});a._moduleLoaderAbortController=null;a._viewReadyAbortController=null;a._originalAutoOpenEnabled=null;a.defaultCreateOptions=ba;a.defaultUpdateOptions=Q;a.snappingOptions=new W;return a}u._inheritsLoose(G,B);var n=G.prototype;n.initialize=function(){this._handles.add([F.on(()=>{var a,b;return null==(a=this.view)?void 0:null==(b=a.map)?void 0:b.layers},"change",a=>{a.removed.includes(this.layer)&&this.cancel()}),F.on(()=>{var a;return null==(a=this.layer)?
void 0:a.graphics},"change",a=>{if(q.isSome(this._operationHandle))for(const b of a.removed)this.updateGraphics.includes(b)&&(1<this.updateGraphics.length?this._operationHandle.removeFromSelection(b):this._operationHandle.cancel())}),F.watch(()=>{var a,b;return null!=(a=null==(b=this.layer)?void 0:b.elevationInfo)?a:null},a=>{a!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=a)},F.syncAndInitial),F.watch(()=>this.view,a=>{q.destroyMaybe(this._snappingManager);
a&&(this._snappingManager=new oa.SnappingManager({view:a,options:this.snappingOptions}),"2d"===a.type?new Promise((b,d)=>E(["../../views/2d/interactive/editingTools"],b,d)):"3d"===a.type&&(new Promise((b,d)=>E(["../../views/3d/interactive/editingTools"],b,d)),new Promise((b,d)=>E(["../../views/3d/layers/GraphicsLayerView3D"],c=>b(P(c)),d))))},F.syncAndInitial),F.watch(()=>{var a;return null==(a=this.view)?void 0:a.spatialReference},(a,b)=>{a&&b&&!a.equals(b)&&this.cancel()})])};n.destroy=function(){this.cancel();
this._handles=q.destroyMaybe(this._handles);this._viewHandles=q.destroyMaybe(this._viewHandles);this._removeDefaultLayer();this._snappingManager=q.destroyMaybe(this._snappingManager);this._set("view",null);this.emit("destroy")};n.cancel=function(){this._moduleLoaderAbortController=q.abortMaybe(this._moduleLoaderAbortController);this._viewReadyAbortController=q.abortMaybe(this._viewReadyAbortController);this._operationHandle&&this._operationHandle.cancel()};n.complete=function(){this._operationHandle&&
this._operationHandle.complete()};n.delete=function(){const {state:a,updateGraphics:b}=this;if("active"===a&&b.length){const {activeTool:d,layer:c}=this,g=b.toArray();c.removeMany(g);this.cancel();this._emitDeleteEvent({graphics:g,tool:d})}};n.create=function(){var a=u._asyncToGenerator(function*(b,d){this.cancel();yield this._waitViewReady();if("disabled"===this.state)throw this.layer||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),this.view||this._logError("sketch:missing-property",
"Property 'view' is missing on SketchViewModel."),R.createAbortError();q.isSome(this.view.activeTool)&&(this.view.activeTool=null);if(b){V.addUniqueLayer(this.view,this._internalGraphicsLayer);var c=yield this._setupCreateOperation(b,d);q.isNone(c)||this.destroyed?this.view.map.remove(this._internalGraphicsLayer):(c.on("complete",()=>{if(c===this._operationHandle){const g=this.createGraphic,f=this._operationHandle.cancelled;this._operationHandle.destroy();this._operationHandle=null;this._set("createGraphic",
null);this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer);c.cancelled||null==g||this.layer.add(g);this.emit("create",{graphic:g,state:f?"cancel":"complete",tool:b,toolEventInfo:null,type:"create"})}}),this._operationHandle=c,this.view.ready&&la.isDOMContainer(this.view)&&this.view.focus())}else this._logError("sketch:missing-parameter","Missing parameter 'tool'.")});return function(b,d){return a.apply(this,arguments)}}();n.update=function(){var a=u._asyncToGenerator(function*(b,
d){this.cancel();yield this._waitViewReady();const {layer:c,view:g,state:f}=this;if("disabled"===f)throw g||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."),c||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),R.createAbortError();q.isSome(this.view.activeTool)&&(this.view.activeTool=null);const e=Array.isArray(b)?b:[b];null!=b&&e&&e.length?e.some(l=>l.layer!==c?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),
!0):q.isNone(l.geometry)?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0):!1)||(b=yield this._setupUpdateOperation(e,d),this.destroyed||q.isNone(b)||C(b)||(V.addUniqueLayer(this.view,this._internalGraphicsLayer),this._setUpdateOperationHandle(b,d),this.emit("update",{graphics:e,state:"start",aborted:!1,tool:b.tool,toolEventInfo:null,type:"update"}))):this._logError("sketch:missing-parameter","Missing parameter 'graphics'.")});
return function(b,d){return a.apply(this,arguments)}}();n._updateSpatialReference=function(){var a=u._asyncToGenerator(function*(b){this._beginAsyncOperation();b=Array.isArray(b)?b:[b];for(const d of b)q.isSome(d.geometry)&&"mesh"!==d.geometry.type&&!ja.equals(d.geometry.spatialReference,this.view.spatialReference)&&(L.canProjectWithoutEngine(d.geometry.spatialReference,this.view.spatialReference)||L.isLoaded()||(yield L.load()),d.geometry=L.project(d.geometry,this.view.spatialReference));this._endAsyncOperation()});
return function(b){return a.apply(this,arguments)}}();n.undo=function(){this.canUndo()&&this._operationHandle.undo()};n.redo=function(){this.canRedo()&&this._operationHandle.redo()};n.canUndo=function(){return!(!this._operationHandle||!this._operationHandle.canUndo())};n.canRedo=function(){return!(!this._operationHandle||!this._operationHandle.canRedo())};n.toggleUpdateTool=function(){this._operationHandle&&this._operationHandle.toggleTool&&this._operationHandle.toggleTool()};n._getFirstHit=function(){var a=
u._asyncToGenerator(function*(b){const d=[];switch(this.view.type){case "2d":{const g=[];this.view.map.allLayers.forEach(f=>{"vector-tile"!==f.type&&"imagery"!==f.type||g.push(f)});var c=yield this.view.hitTest(b,{exclude:g});0<c.results.length&&(c=c.results[0],c.graphic&&d.push(c))}break;case "3d":{const g=[this.view.map.ground];this.view.map.allLayers.forEach(f=>{"integrated-mesh"===f.type&&g.push(f)});c=yield this.view.hitTest(b,{exclude:g});if(0<c.results.length){const f=c.results[0];(!c.ground.mapPoint||
1>this.view.map.ground.opacity||c.ground.distance-q.unwrapOr(f.distance,0)>-Math.min(3*c.ground.distance,"global"===this.view.viewingMode?ia.getReferenceEllipsoid(this.view.renderCoordsHelper.spatialReference).radius/this.view.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY))&&d.push(f)}}}return{screenPoint:b,results:d}});return function(b){return a.apply(this,arguments)}}();n._generateViewHandles=function(a){var b=this;return[a.on("immediate-click",function(){var d=u._asyncToGenerator(function*(c){var g=
"active"===b.state&&"create"===b._operationHandle.type;if("disabled"!==b.state&&!g&&b.updateOnGraphicClick){b._beginAsyncOperation();var f=(yield c.async(()=>b._getFirstHit(X.createScreenPointFromEvent(c)))).results;g=null;if(f.length)for(const e of f){if(e.graphic){f=e.graphic;if(b.updateGraphics.includes(f)||f.layer===b.layer){c.stopPropagation();g=f;break}"2d"!==a.type||b._isComponentGraphic(f)||"active"!==b.state||b.cancel()}}else"active"===b.state&&b.cancel();q.isSome(g)&&!b.updateGraphics.includes(g)&&
(yield b.update([g],{...b.defaultUpdateOptions,reshapeOptions:{...b.defaultUpdateOptions.reshapeOptions}}));b._endAsyncOperation()}});return function(c){return d.apply(this,arguments)}}(),z.ViewEventPriorities.WIDGET)]};n._setupCreateOperation=function(){var a=u._asyncToGenerator(function*(b,d){b=yield this._setupDrawGraphicTool(b,this.view,{hasZ:"3d"===this.view.type,...this.defaultCreateOptions,...d});if(q.isNone(b))return null;this.view.tools.add(b);this.view.activeTool=b;return this._setupCreateOperationHandle(b)});
return function(b,d){return a.apply(this,arguments)}}();n._setupDrawGraphicTool=function(){var a=u._asyncToGenerator(function*(b,d,c){if("multipoint"===b&&"3d"===d.type)return this._logError("sketch:create","Multipoint geometries are not supported in SceneView"),null;const g="rectangle"!==b,f="rectangle"!==b;this.snappingOptions.enabledToggled=!1;b={view:d,mode:"rectangle"===b||"circle"===b?"hybrid":"click",...c,snapToScene:!1,geometryType:b,graphicSymbol:this._getGraphicSymbolFromTool(b),snappingManager:this._snappingManager,
forceUniformSize:f,centered:g};return"2d"===this.view.type?this._makeDrawGraphicTool2D(b):this._makeDrawGraphicTool3D(b)});return function(b,d,c){return a.apply(this,arguments)}}();n._makeDrawGraphicTool2D=function(){var a=u._asyncToGenerator(function*(b){const d=yield this._requireModule(new Promise((c,g)=>E(["../../views/2d/interactive/editingTools"],c,g)));return C(d)||this.destroyed?null:new d.module.DrawGraphicTool2D({...b,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,
activeLineSymbol:this.activeLineSymbol,activeFillSymbol:pa(b.geometryType)?this.activeFillSymbol:null})});return function(b){return a.apply(this,arguments)}}();n._makeDrawGraphicTool3D=function(){var a=u._asyncToGenerator(function*(b){const d=yield this._requireModule(new Promise((c,g)=>E(["../../views/3d/interactive/editingTools"],c,g)));return C(d)||this.destroyed?null:new d.module.DrawGraphicTool3D({...b,elevationInfo:this.layer.elevationInfo,snapToScene:q.isSome(this.layer.elevationInfo)?"absolute-height"===
this.layer.elevationInfo.mode:!0})});return function(b){return a.apply(this,arguments)}}();n._setupCreateOperationHandle=function(a){let b=null;const d=a.forceUniformSize,c=a.centered,g=[this.view.on("key-down",e=>{if(e.key===v.SKETCH_KEYS.pan)e.stopPropagation(),e.repeat||(a.enabled=!1);else if(e.key===v.SKETCH_KEYS.complete)e.stopPropagation(),a.completeCreateOperation();else if(e.key!==v.SKETCH_KEYS.vertexAdd||e.repeat)e.key===v.SKETCH_KEYS.undo?(e.stopPropagation(),f.undo()):e.key===v.SKETCH_KEYS.redo?
(e.stopPropagation(),f.redo()):e.key!==v.SKETCH_KEYS.snappingToggle||"rectangle"===a.geometryType||"circle"===a.geometryType||e.repeat?e.key!==v.SKETCH_KEYS.constraint||"rectangle"!==a.geometryType&&"circle"!==a.geometryType||e.repeat?e.key!==v.SKETCH_KEYS.center||e.repeat||(a.centered=!c,e.stopPropagation()):(a.forceUniformSize=!d,e.stopPropagation()):(this.snappingOptions.enabledToggled=!0,e.stopPropagation());else{const l=a.drawOperation.geometryType;if("polyline"===l||"polygon"===l||"multipoint"===
l)e.stopPropagation(),a.drawOperation.commitStagedVertex()}},z.ViewEventPriorities.WIDGET),this.view.on("key-up",e=>{e.key===v.SKETCH_KEYS.pan?a.enabled=!0:e.key===v.SKETCH_KEYS.snappingToggle&&"rectangle"!==a.geometryType&&"circle"!==a.geometryType?(this.snappingOptions.enabledToggled=!1,e.stopPropagation()):e.key!==v.SKETCH_KEYS.constraint||"rectangle"!==a.geometryType&&"circle"!==a.geometryType?e.key===v.SKETCH_KEYS.center&&(a.centered=c,e.stopPropagation()):(a.forceUniformSize=d,e.stopPropagation())},
z.ViewEventPriorities.WIDGET),a.on("vertex-add",e=>{b=q.isNone(b)?"start":"active";switch(e.operation){case "apply":this.emit("create",{graphic:q.unwrap(a.graphic),state:b,tool:this.activeTool,toolEventInfo:e,type:"create"});break;case "undo":this._emitUndoEvent({graphics:[q.unwrap(a.graphic)],tool:a.geometryType});break;case "redo":this._emitRedoEvent({graphics:[q.unwrap(a.graphic)],tool:a.geometryType})}}),a.on("cursor-update",e=>{0<a.drawOperation.numCommittedVertices&&this.emit("create",{graphic:q.unwrap(a.graphic),
state:"active",tool:this.activeTool,toolEventInfo:{coordinates:e.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),a.on("vertex-remove",e=>{switch(e.operation){case "apply":this.emit("create",{graphic:q.unwrap(a.graphic),state:"active",tool:this.activeTool,toolEventInfo:e,type:"create"});break;case "undo":this._emitUndoEvent({graphics:[q.unwrap(a.graphic)],tool:a.geometryType});break;case "redo":this._emitRedoEvent({graphics:[q.unwrap(a.graphic)],tool:a.geometryType})}}),a.on("complete",
e=>{this._set("createGraphic",q.unwrap(e.graphic));b="complete";e.aborted?f&&f.cancel():f&&f.complete()}),F.watch(()=>this._getGraphicSymbolFromTool(a.geometryType),e=>{a.graphicSymbol=e})],f=new K.OperationHandle({activeComponent:a,tool:a.geometryType,type:"create",onEnd:()=>{var e;g.forEach(l=>l.remove());g.length=0;null==(e=this.view.tools)?void 0:e.remove(a);a.destroy()},undo:()=>{a.canUndo&&a.undo()},redo:()=>{a.canRedo&&a.redo()},canUndo:()=>a.canUndo,canRedo:()=>a.canRedo});return f};n._getGraphicSymbolFromTool=
function(a){switch(a){case "point":case "multipoint":return this.pointSymbol;case "polyline":return this.polylineSymbol;case "circle":case "rectangle":case "polygon":return this.polygonSymbol;default:return null}};n._setupUpdateOperation=function(){var a=u._asyncToGenerator(function*(b,d){const {layer:c,view:g}=this;d={tool:this._defaultUpdateTool,...this.defaultUpdateOptions,...d,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...null==d?void 0:d.reshapeOptions}};var f=d.tool;for(var e of b)c.remove(e),
c.add(e);if("3d"===g.type){if(0===b.length)return null;switch(f){case "move":return this._setupMove3DOperation(b,d,g,f);case "reshape":if(1<b.length)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;f=M.isSupportedGraphic(b[0]);if(f===H.SupportedGraphicResult.SUPPORTED)return this._setupReshape3DOperation(b[0],d,g);this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${H.isSupportedGraphicResultMessage(f)}).`);
return null;case "transform":return this._setupGraphicTransform3DOperation(b,d,g)}}switch(f){case "move":return this._setupMove2DOperation(b,d,g);case "reshape":if(1<b.length)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;e=M.isSupportedGraphic(b[0]);if(e===H.SupportedGraphicResult.SUPPORTED)return this._setupTransformOrReshape2DOperation(b,f,d,g);this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${H.isSupportedGraphicResultMessage(e)}).`);
return null;case "transform":return 1===b.length&&(e=q.get(b[0].geometry,"type"),"point"===e||"multipoint"===e)&&(f="reshape"),this._setupTransformOrReshape2DOperation(b,f,d,g)}});return function(b,d){return a.apply(this,arguments)}}();n._setupMove3DOperation=function(){var a=u._asyncToGenerator(function*(b,d,c,g,f=!1){var e=this;for(var l of b){const h=ma.isSupportedGraphic(l);if(h!==H.SupportedGraphicResult.SUPPORTED)return this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${H.isSupportedGraphicResultMessage(h)}).`),
null}l=yield this._requireModule(new Promise((h,p)=>E(["../../views/3d/interactive/editingTools"],h,p)));if(C(l))return l;const r=new l.module.GraphicMoveTool({view:c,enableZ:d.enableZ,snappingManager:this._snappingManager});this.view.tools.add(r);r.graphics.addMany(b);f||this.updateGraphics.addMany(b);const m=[],k=new K.UpdateOperationHandle({activeComponent:r,tool:g,type:"update",onEnd:()=>{var h;m.forEach(p=>p.remove());m.length=0;null==(h=this.view.tools)?void 0:h.remove(r);r.destroyed||r.destroy()},
undo:()=>{N(k,this.updateGraphics.toArray());this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:g})},redo:()=>{O(k,this.updateGraphics.toArray());this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:g})},addToSelection:h=>{this.updateGraphics.push(h);r.graphics.push(h);this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[h],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:h=>
{const p=this.updateGraphics.indexOf(h);k.history.undo.forEach(t=>t.updates.splice(p,1));k.history.redo.forEach(t=>t.updates.splice(p,1));this.updateGraphics.remove(h);this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[h],type:"selection-change"},type:"update"});0===this.updateGraphics.length?k.complete():r.graphics.remove(h)},toggleTool:function(){var h=u._asyncToGenerator(function*(){if(1===e.updateGraphics.length&&
!1!==d.toggleToolOnClick&&"transform"===g){var p=e.updateGraphics.getItemAt(0);M.isSupportedGraphic(p)===H.SupportedGraphicResult.SUPPORTED&&(p=yield e._setupReshape3DOperation(p,d,c,!0),C(p)||(k.onEnd(),k.destroy(),e._setUpdateOperationHandle(p,d)))}});return function(){return h.apply(this,arguments)}}()});m.push(...this._getHandlesForComponent(k,d),this.view.on("immediate-click",h=>this._getCommonUpdateOperationClickHandlers(k,h,d),z.ViewEventPriorities.WIDGET),c.on("key-down",h=>{this._getCommonUpdateOperationKeyDownHandlers(k,
h);h.key===v.SKETCH_KEYS.snappingToggle&&(this.snappingOptions.enabledToggled=!0,h.stopPropagation())},z.ViewEventPriorities.WIDGET),c.on("key-up",h=>{h.key===v.SKETCH_KEYS.snappingToggle&&(this.snappingOptions.enabledToggled=!1,h.stopPropagation())},z.ViewEventPriorities.WIDGET));return k});return function(b,d,c,g){return a.apply(this,arguments)}}();n._setupGraphicTransform3DOperation=function(a,b,d,c=!1){if(1===a.length&&na.isSupportedGraphic(a[0])===H.SupportedGraphicResult.SUPPORTED){const g=
a[0],f=g.geometry;if(q.isSome(f)&&("point"===f.type||"mesh"===f.type))return this._setupPointTransform3DOperation(g,b,d);if(q.isSome(f)&&("polygon"===f.type||"polyline"===f.type))return this._setupPolyTransform3DOperation(g,b,d,c)}return this._setupMove3DOperation(a,b,d,"transform",c)};n._setupPointTransform3DOperation=function(){var a=u._asyncToGenerator(function*(b,d,c){var g=this;const {enableRotation:f,enableScaling:e,enableZ:l}=d,r=yield this._requireModule(new Promise((p,t)=>E(["../../views/3d/interactive/editingTools"],
p,t)));if(C(r))return r;const m=new r.module.GraphicTransformTool({graphic:b,view:c,enableRotation:f,enableScaling:e,enableZ:l,snappingManager:this._snappingManager});this.view.tools.add(m);this.updateGraphics.add(b);const k=[],h=new K.UpdateOperationHandle({activeComponent:m,tool:"transform",type:"update",onEnd:()=>{var p;k.forEach(t=>t.remove());k.length=0;null==(p=this.view.tools)?void 0:p.remove(m);m.destroyed||m.destroy()},undo:()=>{N(h,this.updateGraphics.toArray());this._emitUndoEvent({graphics:this.updateGraphics.toArray(),
tool:"transform"})},redo:()=>{O(h,this.updateGraphics.toArray());this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:"transform"})},addToSelection:function(){var p=u._asyncToGenerator(function*(t){g.updateGraphics.add(t);g.emit("update",{graphics:g.updateGraphics.toArray(),state:"active",aborted:!1,tool:g.activeTool,toolEventInfo:{added:[t],removed:[],type:"selection-change"},type:"update"});t=yield g._setupMove3DOperation(g.updateGraphics.toArray(),d,c,"transform",!0);C(t)||(h.onEnd(),
h.destroy(),g._setUpdateOperationHandle(t,d))});return function(t){return p.apply(this,arguments)}}(),removeFromSelection:p=>{this.updateGraphics.remove(p);this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[p],type:"selection-change"},type:"update"});h.complete()},toggleTool:()=>{}});k.push(...this._getHandlesForComponent(h,d),this.view.on("immediate-click",p=>this._getCommonUpdateOperationClickHandlers(h,p,d),
z.ViewEventPriorities.WIDGET),c.on("key-down",p=>{this._getCommonUpdateOperationKeyDownHandlers(h,p);p.key===v.SKETCH_KEYS.snappingToggle&&(this.snappingOptions.enabledToggled=!0,p.stopPropagation())},z.ViewEventPriorities.WIDGET),c.on("key-up",p=>{p.key===v.SKETCH_KEYS.snappingToggle&&(this.snappingOptions.enabledToggled=!1,p.stopPropagation())},z.ViewEventPriorities.WIDGET));return h});return function(b,d,c){return a.apply(this,arguments)}}();n._setupPolyTransform3DOperation=function(){var a=u._asyncToGenerator(function*(b,
d,c,g=!1){var f=this;const {enableRotation:e,enableScaling:l,enableZ:r,preserveAspectRatio:m}=d,k=yield this._requireModule(new Promise((A,D)=>E(["../../views/3d/interactive/editingTools"],A,D)));if(C(k))return k;const h=new k.module.ExtentTransformTool({graphic:b,view:c,enableRotation:e,enableScaling:l,enableZ:r,preserveAspectRatio:m});this.view.tools.add(h);g||this.updateGraphics.add(b);const p=[],t=new K.UpdateOperationHandle({activeComponent:h,tool:"transform",type:"update",onEnd:()=>{var A;p.forEach(D=>
D.remove());p.length=0;null==(A=this.view.tools)?void 0:A.remove(h);h.destroyed||h.destroy()},canUndo:()=>h.canUndo,undo:()=>{h.undo();this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:"transform"})},canRedo:()=>h.canRedo,redo:()=>{h.redo();this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:"transform"})},addToSelection:function(){var A=u._asyncToGenerator(function*(D){f.updateGraphics.add(D);f.emit("update",{graphics:f.updateGraphics.toArray(),state:"active",aborted:!1,
tool:f.activeTool,toolEventInfo:{added:[D],removed:[],type:"selection-change"},type:"update"});D=yield f._setupMove3DOperation(f.updateGraphics.toArray(),d,c,"transform",!0);C(D)||(t.onEnd(),t.destroy(),f._setUpdateOperationHandle(D,d))});return function(D){return A.apply(this,arguments)}}(),removeFromSelection:A=>{this.updateGraphics.remove(A);this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[A],type:"selection-change"},
type:"update"});t.complete()},toggleTool:function(){var A=u._asyncToGenerator(function*(){if(1===f.updateGraphics.length&&!1!==d.toggleToolOnClick){var D=f.updateGraphics.getItemAt(0);M.isSupportedGraphic(D)===H.SupportedGraphicResult.SUPPORTED&&(D=yield f._setupReshape3DOperation(D,d,c,!0),C(D)||(t.onEnd(),t.destroy(),f._setUpdateOperationHandle(D,d)))}});return function(){return A.apply(this,arguments)}}()});p.push(...this._getHandlesForComponent(t,d),this.view.on("immediate-click",A=>this._getCommonUpdateOperationClickHandlers(t,
A,d),z.ViewEventPriorities.WIDGET),this.view.on("key-down",A=>this._getCommonUpdateOperationKeyDownHandlers(t,A),z.ViewEventPriorities.WIDGET),this.view.on("key-down",A=>{A.key!==v.SKETCH_KEYS.constraint||A.repeat||(h.preserveAspectRatio=!h.preserveAspectRatio,A.stopPropagation())},z.ViewEventPriorities.WIDGET),this.view.on("key-up",A=>{A.key===v.SKETCH_KEYS.constraint&&(h.preserveAspectRatio=!h.preserveAspectRatio,A.stopPropagation())},z.ViewEventPriorities.WIDGET));return t});return function(b,
d,c){return a.apply(this,arguments)}}();n._setupMove2DOperation=function(){var a=u._asyncToGenerator(function*(b,d,c){var g=this;this.updateGraphics.addMany(b);yield this._updateSpatialReference(b);const f=yield this._getGraphicMover(b,d,c);if(C(f))return f;const e=new K.UpdateOperationHandle({activeComponent:f,tool:"move",type:"update",onEnd:()=>{var k;this._displayDefaultCursor();m.forEach(h=>h.remove());r.forEach(h=>h.remove());m=[];r=[];f.destroy();null==(k=this._internalGraphicsLayer)?void 0:
k.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const k=this.updateGraphics.toArray();N(e,k);e.refreshComponent();this._emitUndoEvent({graphics:k,tool:"move"})},redo:()=>{const k=this.updateGraphics.toArray();O(e,k);e.refreshComponent();this._emitRedoEvent({graphics:k,tool:"move"})},addToSelection:function(){var k=u._asyncToGenerator(function*(h){yield g._updateSpatialReference(h);g.updateGraphics.push(h);f.graphics=g.updateGraphics.toArray();g.emit("update",{graphics:g.updateGraphics.toArray(),
state:"active",aborted:!1,tool:g.activeTool,toolEventInfo:{added:[h],removed:[],type:"selection-change"},type:"update"})});return function(h){return k.apply(this,arguments)}}(),removeFromSelection:k=>{const h=this.updateGraphics.indexOf(k);e.history.undo.forEach(t=>t.updates.splice(h,1));e.history.redo.forEach(t=>t.updates.splice(h,1));this.updateGraphics.remove(k);const p=this.updateGraphics.toArray();this.emit("update",{graphics:p,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],
removed:[k],type:"selection-change"},type:"update"});0===this.updateGraphics.length?e.complete():f.graphics=p}});let l=!1,r=[c.on("immediate-click",k=>this._getCommonUpdateOperationClickHandlers(e,k,d),z.ViewEventPriorities.WIDGET),c.on("key-down",k=>{this._getCommonUpdateOperationKeyDownHandlers(e,k);k.key!==v.SKETCH_KEYS.constraint||k.repeat||(l=!0,f.enableMoveAllGraphics=!f.enableMoveAllGraphics)},z.ViewEventPriorities.WIDGET),c.on("key-up",k=>{k.key===v.SKETCH_KEYS.constraint&&l&&(l=!1,f.enableMoveAllGraphics=
!f.enableMoveAllGraphics)},z.ViewEventPriorities.WIDGET)],m=this._getHandlesForComponent(e,d);return e});return function(b,d,c){return a.apply(this,arguments)}}();n._setupReshape3DOperation=function(){var a=u._asyncToGenerator(function*(b,d,c,g=!1){var f=this;const e=yield this._requireModule(new Promise((k,h)=>E(["../../views/3d/interactive/editingTools"],k,h)));if(C(e))return e;this.snappingOptions.enabledToggled=!1;const l=new e.module.GraphicReshapeTool({view:c,graphic:b,enableZVertex:d.enableZ&&
"move"===d.reshapeOptions.vertexOperation,enableZShape:d.enableZ&&"move"===d.reshapeOptions.shapeOperation,enableMoveGraphic:"move"===d.reshapeOptions.shapeOperation||"move-xy"===d.reshapeOptions.shapeOperation,enableMidpoints:"split"===d.reshapeOptions.edgeOperation,enableEdgeOffset:"offset"===d.reshapeOptions.edgeOperation,snappingManager:this._snappingManager});c.tools.add(l);g||this.updateGraphics.add(b);const r=[],m=new K.UpdateOperationHandle({activeComponent:l,tool:"reshape",type:"update",
onEnd:()=>{var k;r.forEach(h=>h.remove());r.length=0;null==(k=this.view.tools)?void 0:k.remove(l);l.destroyed||l.destroy()},canUndo:()=>l.canUndo,undo:()=>{l.undo();this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:"reshape"})},canRedo:()=>l.canRedo,redo:()=>{l.redo();this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:"reshape"})},addToSelection:function(){var k=u._asyncToGenerator(function*(h){f.updateGraphics.add(h);f.emit("update",{graphics:f.updateGraphics.toArray(),
state:"active",aborted:!1,tool:f.activeTool,toolEventInfo:{added:[h],removed:[],type:"selection-change"},type:"update"});h=yield f._setupMove3DOperation(f.updateGraphics.toArray(),d,c,"transform",!0);C(h)||(m.onEnd(),m.destroy(),f._setUpdateOperationHandle(h,d))});return function(h){return k.apply(this,arguments)}}(),removeFromSelection:k=>{this.updateGraphics.remove(k);this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],
removed:[k],type:"selection-change"},type:"update"});m.complete()},toggleTool:function(){var k=u._asyncToGenerator(function*(){if(!1!==d.toggleToolOnClick){var h=yield f._setupGraphicTransform3DOperation(f.updateGraphics.toArray(),d,c,!0);C(h)||(m.onEnd(),m.destroy(),f._setUpdateOperationHandle(h,d))}});return function(){return k.apply(this,arguments)}}()});r.push(...this._getHandlesForComponent(m,d),c.on("immediate-click",k=>this._getCommonUpdateOperationClickHandlers(m,k,d),z.ViewEventPriorities.WIDGET),
c.on("key-down",k=>{this._getCommonUpdateOperationKeyDownHandlers(m,k);k.key===v.SKETCH_KEYS.snappingToggle&&(this.snappingOptions.enabledToggled=!0,k.stopPropagation())},z.ViewEventPriorities.WIDGET),c.on("key-up",k=>{k.key===v.SKETCH_KEYS.snappingToggle&&(this.snappingOptions.enabledToggled=!1,k.stopPropagation())},z.ViewEventPriorities.WIDGET));return m});return function(b,d,c){return a.apply(this,arguments)}}();n._setupTransformOrReshape2DOperation=function(){var a=u._asyncToGenerator(function*(b,
d,c,g){var f=this;this.updateGraphics.addMany(b);yield this._updateSpatialReference(b);b="transform"===d?yield this._getBox(b,c,g):yield this._getReshape(b,c,g);if(C(b))return b;const e=new K.UpdateOperationHandle({activeComponent:b,type:"update",onEnd:()=>{r.forEach(m=>m.remove());l.forEach(m=>m.remove());r=[];l=[];e.activeComponent&&!e.activeComponent.destroyed&&e.activeComponent.destroy();this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{N(e,this.updateGraphics.toArray());
e.refreshComponent();this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:e.tool})},redo:()=>{O(e,this.updateGraphics.toArray());e.refreshComponent();this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:e.tool})},addToSelection:function(){var m=u._asyncToGenerator(function*(k){var h=e.activeComponent;if("reshape"===h.type){h=[...f.updateGraphics,k];f.updateGraphics.removeAll();h=yield f._setupMove2DOperation(h,c,g);if(C(h))return;e.onEnd();e.destroy();f._setUpdateOperationHandle(h,
c)}else f.updateGraphics.add(k),h.graphics=f.updateGraphics.toArray(),h.refresh(),e.resetHistory();f.emit("update",{graphics:f.updateGraphics.toArray(),state:"active",aborted:!1,tool:f.activeTool,toolEventInfo:{added:[k],removed:[],type:"selection-change"},type:"update"})});return function(k){return m.apply(this,arguments)}}(),removeFromSelection:function(){var m=u._asyncToGenerator(function*(k){const h=f.updateGraphics.indexOf(k);e.history.undo.forEach(t=>t.updates.splice(h,1));e.history.redo.forEach(t=>
t.updates.splice(h,1));f.updateGraphics.remove(k);const p=f.updateGraphics.toArray();if(0===p.length)e.complete();else{const t=p[0].geometry;1!==p.length||!q.isSome(t)||"point"!==t.type&&"multipoint"!==t.type?e.activeComponent.graphics=p:e.toggleTool()}f.emit("update",{graphics:p,state:"active",aborted:!1,tool:f.activeTool,toolEventInfo:{added:[],removed:[k],type:"selection-change"},type:"update"})});return function(k){return m.apply(this,arguments)}}(),toggleTool:function(){var m=u._asyncToGenerator(function*(){if(!(1<
f.updateGraphics.length)){var k=f.updateGraphics.getItemAt(0),h=k.geometry;q.isSome(h)&&("reshape"===e.tool&&("point"===h.type||"multipoint"===h.type)||"transform"===e.tool&&"extent"===h.type)||(h=null,"transform"===e.tool?h=yield f._getReshape([k],c,g):"reshape"===e.tool&&(h=yield f._getBox([k],c,g)),C(h)||(e.activeComponent.destroy(),e.activeComponent=h,e.activeComponent&&(r.forEach(p=>p.remove()),r=f._getHandlesForComponent(e,c))))}});return function(){return m.apply(this,arguments)}}()});let l=
[g.on("immediate-click",m=>this._getCommonUpdateOperationClickHandlers(e,m,c),z.ViewEventPriorities.WIDGET),g.on("key-down",m=>{this._getCommonUpdateOperationKeyDownHandlers(e,m);m.key!==v.SKETCH_KEYS.snappingToggle||m.repeat||(this.snappingOptions.enabledToggled=!0,m.stopPropagation());m.key===v.SKETCH_KEYS.constraint&&!m.repeat&&e&&(m=e.activeComponent)&&"box"===m.type&&(m.preserveAspectRatio=!m.preserveAspectRatio)},z.ViewEventPriorities.WIDGET),g.on("key-up",m=>{var k;m.key===v.SKETCH_KEYS.snappingToggle&&
"reshape"===(null==e?void 0:null==(k=e.activeComponent)?void 0:k.type)&&(this.snappingOptions.enabledToggled=!1,m.stopPropagation());m.key===v.SKETCH_KEYS.constraint&&e&&(m=e.activeComponent)&&"box"===m.type&&(m.preserveAspectRatio=!m.preserveAspectRatio)},z.ViewEventPriorities.WIDGET)],r=this._getHandlesForComponent(e,c);return e});return function(b,d,c,g){return a.apply(this,arguments)}}();n._getGraphicMover=function(){var a=u._asyncToGenerator(function*(b,d,c){({enableMoveAllGraphics:d}=d);const g=
yield this._requireModule(new Promise((f,e)=>E(["../../views/draw/support/GraphicMover"],l=>f(P(l)),e)));return C(g)?g:new g.module.default({enableMoveAllGraphics:d,highlightsEnabled:!0,indicatorsEnabled:!1,graphics:b,view:c,callbacks:{onGraphicMoveStart:({dx:f,dy:e,graphic:l})=>{this._displayGrabbingCursor();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:f,dy:e,mover:l,type:"move-start"},type:"update"})},onGraphicMove:({dx:f,
dy:e,graphic:l})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:f,dy:e,mover:l,type:"move"},type:"update"}),onGraphicMoveStop:({dx:f,dy:e,graphic:l})=>{this._displayPointerCursor();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:f,dy:e,mover:l,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>
this._displayDefaultCursor()}})});return function(b,d,c){return a.apply(this,arguments)}}();n._getBox=function(){var a=u._asyncToGenerator(function*(b,d,c){const {enableRotation:g,enableScaling:f,preserveAspectRatio:e}=d;d=yield this._requireModule(new Promise((l,r)=>E(["../../views/draw/support/Box"],m=>l(P(m)),r)));return C(d)?d:new d.module.default({graphics:b,enableRotation:g,enableScaling:f,preserveAspectRatio:e,layer:this._internalGraphicsLayer,view:c,callbacks:{onMoveStart:l=>this.emit("update",
{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"}),onMove:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"}),onMoveStop:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"}),onScaleStart:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),
state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"}),onScale:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"}),onScaleStop:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"}),onRotateStart:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,
toolEventInfo:{...l},type:"update"}),onRotate:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"}),onRotateStop:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"})}})});return function(b,d,c){return a.apply(this,arguments)}}();n._getReshape=function(){var a=u._asyncToGenerator(function*(b,d,c){var g,f;const e="split"===
(null==(g=d.reshapeOptions)?void 0:g.edgeOperation);d="move"===(null==(f=d.reshapeOptions)?void 0:f.shapeOperation);f=yield this._requireModule(new Promise((l,r)=>E(["../../views/draw/support/Reshape"],m=>l(P(m)),r)));return C(f)?f:new f.module.default({enableMidpoints:e,enableMovement:d,graphic:b[0],layer:this._internalGraphicsLayer,snappingManager:this._snappingManager,view:c,callbacks:{onReshapeStart:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,
toolEventInfo:{...l},type:"update"}),onReshape:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"}),onReshapeStop:({mover:l,type:r})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:l,type:r},type:"update"}),onMoveStart:({dx:l,dy:r,mover:m,type:k})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,
tool:this.activeTool,toolEventInfo:{dx:l,dy:r,mover:m,type:k},type:"update"}),onMove:({dx:l,dy:r,mover:m,type:k})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:r,mover:m,type:k},type:"update"}),onMoveStop:({dx:l,dy:r,mover:m,type:k})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:r,mover:m,type:k},type:"update"}),onVertexAdd:({added:l,
type:r,vertices:m})=>{l=l.map(k=>U.geometryToCoordinates(k.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:l,vertices:m,type:r},type:"update"})},onVertexRemove:({removed:l,type:r,vertices:m})=>{l=l.map(k=>U.geometryToCoordinates(k.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:l,vertices:m,type:r},type:"update"})}}})});
return function(b,d,c){return a.apply(this,arguments)}}();n._getHandlesForComponent=function(a,b){const d=a.activeComponent;switch(d.type){case "graphic-mover":return[d.on("graphic-click",({graphic:c,viewEvent:g})=>{var f;null!=(f=g.native)&&f.shiftKey&&(g.stopPropagation(),a.removeFromSelection(c))}),d.on("graphic-move-start",c=>a.addToHistory(I(c.allGraphics)))];case "box":return[d.on("graphic-click",c=>this._onTransformOrReshape2DGraphicClick(a,b,c)),d.on("move-start",c=>a.addToHistory(I(c.graphics))),
d.on("rotate-start",c=>a.addToHistory(I(c.graphics))),d.on("scale-start",c=>a.addToHistory(I(c.graphics)))];case "reshape":return[d.on("graphic-click",c=>this._onTransformOrReshape2DGraphicClick(a,b,c)),d.on("move-start",c=>a.addToHistory(I([c.mover]))),d.on("reshape-start",c=>a.addToHistory(I([c.graphic]))),d.on("vertex-add",c=>a.addToHistory(I([c.oldGraphic]))),d.on("vertex-remove",c=>a.addToHistory(I([c.oldGraphic])))];case "move-3d":return[d.on("graphic-move-start",c=>{a.addToHistory(I(c.allGraphics));
this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:0<c.allGraphics.length?c.allGraphics[0]:null,type:"move-start"},type:"update"})}),d.on("graphic-move",c=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:c.dx,dy:c.dy,mover:0<c.allGraphics.length?c.allGraphics[0]:null,type:"move"},type:"update"})}),d.on("graphic-move-stop",c=>{this.emit("update",
{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:0<c.allGraphics.length?c.allGraphics[0]:null,type:"move-stop"},type:"update"})}),d.on("immediate-click",c=>{c.shiftKey?this._toggleSelection([c.graphic],a,b):a.toggleTool()})];case "transform-3d":return[d.on("record-undo",({record:c})=>{a.addToHistory({updates:[c]})}),d.on("graphic-translate-start",c=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,
tool:this.activeTool,toolEventInfo:{mover:c.graphic,dx:c.dxScreen,dy:c.dyScreen,type:"move-start"},type:"update"})}),d.on("graphic-translate-stop",c=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:c.graphic,dx:c.dxScreen,dy:c.dyScreen,type:"move-stop"},type:"update"})}),d.on("graphic-rotate-start",c=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:c.graphic,
angle:c.angle,type:"rotate-start"},type:"update"})}),d.on("graphic-rotate-stop",c=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:c.graphic,angle:c.angle,type:"rotate-stop"},type:"update"})}),d.on("graphic-scale-start",c=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:c.graphic,xScale:c.xScale,yScale:c.yScale,type:"scale-start"},type:"update"})}),
d.on("graphic-scale-stop",c=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:c.graphic,xScale:c.xScale,yScale:c.yScale,type:"scale-stop"},type:"update"})}),d.on("graphic-translate",c=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:c.graphic,dx:c.dxScreen,dy:c.dyScreen,type:"move"},type:"update"})}),d.on("graphic-rotate",c=>{this.emit("update",
{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:c.graphic,angle:c.angle,type:"rotate"},type:"update"})}),d.on("graphic-scale",c=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:c.graphic,xScale:c.xScale,yScale:c.yScale,type:"scale"},type:"update"})}),d.on("immediate-click",c=>{c.shiftKey?this._toggleSelection([c.graphic],a,b):a.toggleTool()})];case "reshape-3d":return[d.on("reshape",
c=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:c,type:"update"})}),d.on("move",c=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:c,type:"update"})}),d.on("vertex-add",c=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:c,type:"update"})}),d.on("vertex-remove",c=>{this.emit("update",
{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:c,type:"update"})}),d.on("immediate-click",c=>{c.shiftKey?this._toggleSelection([c.graphic],a,b):a.toggleTool()})]}};n._onTransformOrReshape2DGraphicClick=function(a,b,d){var c;const {graphic:g,viewEvent:f}=d;if(null!=(c=f.native)&&c.shiftKey&&g.layer===this.layer)return f.stopPropagation(),a.removeFromSelection(g);if(b.toggleToolOnClick)return f.stopPropagation(),a.toggleTool()};n._setUpdateOperationHandle=
function(a,b){this._operationHandle=a;const d=this.view.map;this._disablePopup(b);a.on("complete",()=>{if(a===this._operationHandle){const c=this.updateGraphics.toArray(),g=this._operationHandle.tool;this._operationHandle.destroy();this._operationHandle=null;this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray());this.updateGraphics.removeAll();d&&d.remove(this._internalGraphicsLayer);this._restorePopup(b);this.emit("update",{graphics:c,state:"complete",aborted:a.cancelled,tool:g,toolEventInfo:null,
type:"update"})}})};n._getCommonUpdateOperationClickHandlers=function(){var a=u._asyncToGenerator(function*(b,d,c){const g=X.createScreenPointFromEvent(d),f=(yield d.async(()=>this._getFirstHit(g))).results;f.length?d.native.shiftKey&&this._toggleSelection(f.map(e=>e.graphic),b,c)?d.stopPropagation():f.some(e=>e.graphic&&this.updateGraphics.includes(e.graphic))?d.stopPropagation():b.complete():b.complete()});return function(b,d,c){return a.apply(this,arguments)}}();n._toggleSelection=function(a,b,
d){const c=!!d.multipleSelectionEnabled;return a.some(g=>null==g?!1:c&&g.layer===this.layer?(this.updateGraphics.includes(g)?b.removeFromSelection(g):b.addToSelection(g),!0):!1)};n._getCommonUpdateOperationKeyDownHandlers=function(a,b){if(a){var d=b.key;d===v.SKETCH_KEYS.undo&&a.canUndo()?(b.stopPropagation(),a.undo()):d===v.SKETCH_KEYS.redo&&a.canRedo()?(b.stopPropagation(),a.redo()):d===v.SKETCH_KEYS.cancel?(b.stopPropagation(),a.cancel()):this.allowDeleteKey&&v.SKETCH_KEYS.delete.includes(d)&&
this._onDeleteKey(b)}};n._onDeleteKey=function(a){if(this._operationHandle&&"update"===this._operationHandle.type){var b=this.activeComponent,d=this.updateGraphics.toArray();q.isNone(b)||"reshape-3d"===b.type||"reshape"===b.type&&(1!==d.length||"point"!==q.get(d[0].geometry,"type"))||(a.stopPropagation(),this.delete())}};n._removeDefaultLayer=function(){this._internalGraphicsLayer&&(this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=q.destroyMaybe(this._internalGraphicsLayer))};
n._isComponentGraphic=function(a){const {activeComponent:b}=this;return!a||q.isNone(b)?!1:a.attributes&&a.attributes.esriSketchTool||"draw-2d"===b.type&&b.graphic===a||("box"===b.type||"reshape"===b.type)&&b.isUIGraphic(a)};n._displayPointerCursor=function(){this.view&&this.view.container&&"pointer"!==this.view.cursor&&(this.view.cursor="pointer")};n._displayGrabbingCursor=function(){this.view&&this.view.container&&"grabbing"!==this.view.cursor&&(this.view.cursor="grabbing")};n._displayDefaultCursor=
function(){this.view&&this.view.container&&null!==this.view.cursor&&(this.view.cursor=null)};n._logError=function(a,b,d){qa.error(new da(a,b,d))};n._requireModule=function(){var a=u._asyncToGenerator(function*(b){const d=new AbortController;this._moduleLoaderAbortController=d;b=yield b;return this._moduleLoaderAbortController!==d||d.signal.aborted?{requireError:"aborted"}:{module:b}});return function(b){return a.apply(this,arguments)}}();n._emitUndoEvent=function(a){this.emit("undo",{...a,type:"undo"})};
n._emitRedoEvent=function(a){this.emit("redo",{...a,type:"redo"})};n._emitDeleteEvent=function(a){this.emit("delete",{...a,type:"delete"})};n.test=function(){return{operationHandle:this._operationHandle,defaultUpdateOptions:Q}};n.wait=function(){return F.whenOnce(()=>!this.updating)};n._beginAsyncOperation=function(){this._numUpdating+=1;this.notifyChange("updating")};n._endAsyncOperation=function(){--this._numUpdating;this.notifyChange("updating")};n._disablePopupEnabled=function(a){var b;return"3d"!==
(null==(b=this.view)?void 0:b.type)||this.updateOnGraphicClick||q.isSome(a)&&a.toggleToolOnClick};n._disablePopup=function(a){this._disablePopupEnabled(a)&&(a=this.view.popup)&&q.isNone(this._originalAutoOpenEnabled)&&(this._originalAutoOpenEnabled=a.autoOpenEnabled,a.autoOpenEnabled=!1)};n._restorePopup=function(a){this._disablePopupEnabled(a)&&(a=this.view.popup)&&q.isSome(this._originalAutoOpenEnabled)&&(a.autoOpenEnabled=this._originalAutoOpenEnabled,this._originalAutoOpenEnabled=null)};n._waitViewReady=
function(){var a=u._asyncToGenerator(function*(){const b=this.view;b&&(q.abortMaybe(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,yield R.whenOrAbort(F.whenOnce(()=>null==b?void 0:b.ready),this._viewReadyAbortController.signal))});return function(){return a.apply(this,arguments)}}();u._createClass(G,[{key:"_defaultUpdateTool",get:function(){return"3d"===this.view.type?"move":"transform"}},{key:"updating",get:function(){return 0<this._numUpdating}},{key:"activeTool",
get:function(){return this._operationHandle&&this._operationHandle.tool?this._operationHandle.tool:null}},{key:"activeComponent",get:function(){return this._operationHandle?this._operationHandle.activeComponent:null}},{key:"createGraphic",get:function(){return!q.isSome(this.activeComponent)||"draw-3d"!==this.activeComponent.type&&"draw-2d"!==this.activeComponent.type?this._get("createGraphic"):q.unwrap(this.activeComponent.graphic)}},{key:"defaultCreateOptions",set:function(a){this._set("defaultCreateOptions",
{...ba,...a})}},{key:"defaultUpdateOptions",set:function(a){this._set("defaultUpdateOptions",{...Q,...a,reshapeOptions:{...Q.reshapeOptions,...null==a?void 0:a.reshapeOptions}})}},{key:"snappingOptions",set:function(a){q.isSome(this._snappingManager)&&(this._snappingManager.options=a);this._set("snappingOptions",a)}},{key:"state",get:function(){var a;const b=!(null==(a=this.view)||!a.ready||!this.layer);a=this._operationHandle;return b&&a?"active":b?"ready":"disabled"}},{key:"view",get:function(){return this._get("view")},
set:function(a){const b=this._get("view");if(b){const {container:d,map:c}=b;d&&(b.cursor=null);c&&c.remove(this._internalGraphicsLayer);this._viewHandles.removeAll();this.cancel()}this._handles.remove("view-ready");a&&this._handles.add(F.when(()=>a.ready,d=>{this._viewHandles.removeAll();d&&this._viewHandles.add(this._generateViewHandles(a))},F.syncAndInitial),"view-ready");this._set("view",a)}}]);return G}(ea.EventedAccessor);x.__decorate([y.property()],w.prototype,"updating",null);x.__decorate([y.property()],
w.prototype,"_operationHandle",void 0);x.__decorate([y.property({readOnly:!0})],w.prototype,"activeTool",null);x.__decorate([y.property()],w.prototype,"activeFillSymbol",void 0);x.__decorate([y.property()],w.prototype,"activeLineSymbol",void 0);x.__decorate([y.property()],w.prototype,"activeVertexSymbol",void 0);x.__decorate([y.property()],w.prototype,"allowDeleteKey",void 0);x.__decorate([y.property({readOnly:!0})],w.prototype,"createGraphic",null);x.__decorate([y.property()],w.prototype,"defaultCreateOptions",
null);x.__decorate([y.property()],w.prototype,"defaultUpdateOptions",null);x.__decorate([y.property()],w.prototype,"layer",void 0);x.__decorate([y.property({types:J.symbolTypes})],w.prototype,"pointSymbol",void 0);x.__decorate([y.property({types:J.symbolTypes})],w.prototype,"polygonSymbol",void 0);x.__decorate([y.property({types:J.symbolTypes})],w.prototype,"polylineSymbol",void 0);x.__decorate([y.property({type:W,nonNullable:!0})],w.prototype,"snappingOptions",null);x.__decorate([y.property()],w.prototype,
"_snappingManager",void 0);x.__decorate([y.property({readOnly:!0})],w.prototype,"state",null);x.__decorate([y.property({readOnly:!0})],w.prototype,"updateGraphics",void 0);x.__decorate([y.property()],w.prototype,"updateOnGraphicClick",void 0);x.__decorate([y.property({types:J.symbolTypes})],w.prototype,"updatePointSymbol",void 0);x.__decorate([y.property({types:J.symbolTypes})],w.prototype,"updatePolygonSymbol",void 0);x.__decorate([y.property({types:J.symbolTypes})],w.prototype,"updatePolylineSymbol",
void 0);x.__decorate([y.property({types:J.symbolTypes})],w.prototype,"vertexSymbol",void 0);x.__decorate([y.property({value:null})],w.prototype,"view",null);return w=x.__decorate([ha.subclass("esri.widgets.Sketch.SketchViewModel")],w)});