// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/events ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/aliasOf ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass ../../Widget ../BuildingLevel ../../../chunks/constants ./Label ./LevelItem ../../support/widgetUtils ../../../core/Logger ../../support/jsxFactory".split(" "),
function(u,e,r,v,w,p,l,x,d,H,I,f,B,C,y,h,D,E,F,J,q){const G={selectLevel:"selectLevel",clearLevel:"clearLevel",nextLevel:"nextLevel",previousLevel:"previousLevel",currentLevel:"{{value}}"};d=function(z){function t(a,c){var b=z.call(this,a,c)||this;b._defaultViewModel=new y;b.viewModel=b._defaultViewModel;b.messages=G;b._levelHandles=new v;b._levelEventHandles=new v;b._levelWidgets=[];b._labelWidget=new D.Label({onClear:()=>b.viewModel.clear()});b._hoveredLevel=null;b._expandedLevelsHeight=void 0;
b._normalizedPointerPosition=0;b._hovering=!1;b._containerPosTop=null;b._levelsContainer=null;b._onPointerUp=()=>{window.getSelection().removeAllRanges();p.isSome(b._hoveredLevel)&&(b.viewModel.enabled&&b._hoveredLevel===b.viewModel.value?b.viewModel.clear():b.viewModel.select(b._hoveredLevel))};b._onPointerEnter=()=>{var k;!b._hovering&&p.isSome(b._levelsContainer)&&(b._hovering=!0,b._containerPosTop=null!=(k=b._levelsContainer.getBoundingClientRect().top)?k:0)};b._onPointerLeave=()=>{b._hovering&&
(b._normalizedPointerPosition=0,b._hoveredLevel=null,b._hovering=!1)};b._onPointerMove=k=>{if(!b._hovering)return!1;window.getSelection().removeAllRanges();if(p.isSome(b._containerPosTop)){let m=b._levelsHeight,n=b._containerPosTop+h.LEVELS_PADDING*h.LEVELS_MARGIN_FACTOR+b._expandedLevelsMargin;const A=b._levelHeight/2;n+=A;m-=A;k=(k.clientY-n)/m;k+=h.LEVELS_POINTER_ADJUSTMENT;b._normalizedPointerPosition=k}return!1};return b}u._inheritsLoose(t,z);var g=t.prototype;g.postInitialize=function(){this.own(l.watch(()=>
this._levelsContainer,()=>this._onContainerChange(),l.initial),l.watch(()=>this._levels,()=>this._createLevelWidgets(),l.initial),l.watch(()=>this.messages,()=>{this._labelWidget.messages=this.messages},l.initial))};g.destroy=function(){this._levelHandles.destroy();this._levelEventHandles.destroy();this._levelWidgets.forEach(a=>a.destroy());this._labelWidget.destroy();this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy()};g.render=function(){const a=this._levelWidgets.length,c=
1<a?this._levelWidgets.map(n=>n.render()):null;var b=h.LEVELS_PADDING*h.LEVELS_MARGIN_FACTOR;const k=-b/h.LEVELS_MARGIN_FACTOR,m=this._levelsHeight;b=m+2*b;return q.tsx("div",{bind:this,key:this,class:this.classes("esri-widget","esri-building-level-picker",{["esri-building-level-picker--animate-level"]:!this._hovering,["esri-building-level-picker--no-level"]:2>a}),onkeydown:this._onKeyDown},this._renderLabelContainer(),q.tsx("div",{bind:this,class:"esri-building-level-picker__levels-container",styles:{height:`${b}px`,
marginTop:`${k}px`,marginBottom:`${k}px`},onfocus:this._onFocus,afterCreate:F.storeNode,"data-node-ref":"_levelsContainer"},q.tsx("div",{styles:{height:`${m}px`,margin:`${h.LEVELS_PADDING-this._expandedLevelsMargin}px 0 0 0`},class:"esri-building-level-picker__inner-levels-container"},c)))};g._renderLabelContainer=function(){const a=this.messages.previousLevel,c=this.messages.nextLevel;return q.tsx("div",{class:"esri-building-level-picker__label-container",tabIndex:0},q.tsx("button",{bind:this,class:"esri-building-level-picker__arrow-up",
disabled:!this.viewModel.hasNext,onclick:this._onArrowUpClick,"aria-label":c,title:c,type:"button"}),this._labelWidget.render(),q.tsx("button",{bind:this,class:"esri-building-level-picker__arrow-down",disabled:!this.viewModel.hasPrevious,onclick:this._onArrowDownClick,"aria-label":a,title:a,type:"button"}))};g._updateComponents=function(){const a=this.viewModel.enabled?this.viewModel.value:null,c=p.isSome(this._hoveredLevel)?this._hoveredLevel:a;this._levelWidgets.forEach(b=>{var k,m;const n=this.viewModel.getValueLabel(b.level);
b.label=p.isSome(n)?n:null==(k=this.messages)?void 0:null==(m=k.currentLevel)?void 0:m.replace("{{level}}",String(b.level));b.active=b.level===a;b.hovering=b.level===this._hoveredLevel});this._labelWidget.level=c;this._labelWidget.active=c===a;this._labelWidget.hovering=p.isSome(this._hoveredLevel)};g._createLevelWidgets=function(){this._levelWidgets.forEach(a=>a.destroy());this._levelWidgets=this._levels.map(a=>new E.LevelItem({level:a,onSelect:()=>this._onLevelToggle(a)}));this._levelHandles.removeAll();
this._levelHandles.add([l.watch(()=>{const a=this.viewModel;return[this.messages,null==a?void 0:a.value,null==a?void 0:a.enabled,this._hoveredLevel,this._hovering]},()=>this._updateComponents(),l.initial),l.watch(()=>[this._normalizedPointerPosition,this._hovering],()=>this._onPointerPositionChange(),l.initial),l.watch(()=>this._levelWidth,a=>this._levelWidgets.forEach(c=>c.width=a),l.initial)])};g._onContainerChange=function(){const a=this._levelsContainer;p.isSome(a)&&(this._levelEventHandles.removeAll(),
this._levelEventHandles.add([r.on(a,"pointerenter",this._onPointerEnter),r.on(a,"pointerover",this._onPointerEnter),r.on(a,"pointerleave",this._onPointerLeave),r.on(a,"pointerup",this._onPointerUp),r.on(a,"pointermove",this._onPointerMove)]))};g._onKeyDown=function(a){switch(a.key){case "ArrowDown":case "ArrowLeft":a.preventDefault();a.stopPropagation();this.viewModel.previous();this._focusCurrentLevel();break;case "ArrowUp":case "ArrowRight":a.preventDefault(),a.stopPropagation(),this.viewModel.next(),
this._focusCurrentLevel()}};g._focusCurrentLevel=function(){const a=this._levelWidgets.find(c=>c.level===this.viewModel.value);a&&a.focus()};g._onFocus=function(){this._hoveredLevel=0<this._levels.length?this._levels[0]:null};g._onLevelToggle=function(a){this.viewModel.enabled&&this.viewModel.value===a?this.viewModel.clear():this.viewModel.select(a)};g._onArrowUpClick=function(){this.viewModel.next()};g._onArrowDownClick=function(){this.viewModel.previous()};g._onPointerPositionChange=function(){let a=
0;this._levelWidgets.forEach((b,k)=>{const {width:m,height:n}=this._getLevelWidgetSize(k);b.height=n;b.width=m;a+=n});this._hoveredLevel=this._levelClosestToPointer;const c=this._expandedLevelsHeight;if(null==c||30<Math.abs(c-a))this._expandedLevelsHeight=a};g._getLevelWidgetSize=function(a){const c={width:this._levelWidth,height:this._levelHeight};this._hovering&&(a=this._getGaussianFactor(a,this._normalizedPointerPosition),c.width+=h.LEVEL_HOVERED_EXTRA_WIDTH*a,c.height+=h.LEVEL_HOVERED_EXTRA_HEIGHT*
a);return c};g._getGaussianFactor=function(a,c){const b=this._numLevels-1;return Math.exp(-((this._gaussianFactor*((b-a)/b-c))**2))};u._createClass(t,[{key:"_levelsHeight",get:function(){return Math.round(this._levelHeight*this._numLevels)}},{key:"_expandedLevelsMargin",get:function(){return Math.round((this._expandedLevelsHeight-this._levelsHeight)/2)}},{key:"_levelWidth",get:function(){const {LEVEL_WIDTH_NOMINATOR:a,LEVEL_WIDTH_CONSTANT:c}=h.constants;return Math.round(w.clamp(a/Math.sqrt(this._numLevels)+
c,h.LEVEL_WIDTH_MIN,h.LEVEL_WIDTH_MAX))}},{key:"_levelHeight",get:function(){const a=h.LEVEL_HEIGHT_DEFAULT;return Math.round(w.clamp(2*a/Math.sqrt(this._numLevels),2,a))}},{key:"_gaussianFactor",get:function(){const a=this._numLevels;return a/Math.log(h.ALPHA_LEVEL_DEPENDENCY_FACTOR*a)*h.ALPHA_SPREAD_FACTOR}},{key:"_levelClosestToPointer",get:function(){if(!this._hovering)return null;const a=this._numLevels-1,c=this._normalizedPointerPosition;return 0<=a&&p.isSome(c)?this._levels[Math.round((1-c)*
a)]:null}}]);return t}(C);e.__decorate([f.property({type:y})],d.prototype,"viewModel",void 0);e.__decorate([f.property()],d.prototype,"messages",void 0);e.__decorate([f.property()],d.prototype,"_levelWidgets",void 0);e.__decorate([f.property()],d.prototype,"_labelWidget",void 0);e.__decorate([f.property()],d.prototype,"_hoveredLevel",void 0);e.__decorate([x.aliasOf("viewModel.allowedValues")],d.prototype,"_levels",void 0);e.__decorate([x.aliasOf("_levels.length")],d.prototype,"_numLevels",void 0);
e.__decorate([f.property({readOnly:!0})],d.prototype,"_levelsHeight",null);e.__decorate([f.property()],d.prototype,"_expandedLevelsHeight",void 0);e.__decorate([f.property({readOnly:!0})],d.prototype,"_expandedLevelsMargin",null);e.__decorate([f.property({readOnly:!0})],d.prototype,"_levelWidth",null);e.__decorate([f.property({readOnly:!0})],d.prototype,"_levelHeight",null);e.__decorate([f.property({readOnly:!0})],d.prototype,"_gaussianFactor",null);e.__decorate([f.property({readOnly:!0})],d.prototype,
"_levelClosestToPointer",null);e.__decorate([f.property({type:Number,range:{min:0,max:1}})],d.prototype,"_normalizedPointerPosition",void 0);e.__decorate([f.property()],d.prototype,"_hovering",void 0);e.__decorate([f.property()],d.prototype,"_containerPosTop",void 0);e.__decorate([f.property()],d.prototype,"_levelsContainer",void 0);return d=e.__decorate([B.subclass("esri.widgets.BuildingExplorer.BuildingLevelPicker.BuildingLevelPicker")],d)});