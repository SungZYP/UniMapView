// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../intl ../../core/Accessor ../../core/HandleOwner ../../core/maybe ../../core/reactiveUtils ../../core/uid ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../layers/support/CodedValueDomain ../../layers/support/Domain ../../layers/support/InheritedDomain ../../layers/support/RangeDomain ../../layers/support/domainUtils ../../layers/support/fieldUtils ../../intl/substitute".split(" "),
function(x,d,c,F,G,l,H,I,e,M,N,O,J,K,P,Q,R,u,m,y){function z(n){return 1E7<=n||-1E7>=n}function A(n){return!!n&&"maxLength"in n}var q;(function(n){n.Text="text";n.Number="number";n.Date="date";n.Unsupported="unsupported"})(q||(q={}));var v;(v||(v={})).TOO_SHORT="length-validation-error::too-short";const B={type:"number"},C={type:"number",intlOptions:{notation:"scientific"}},D={type:"date",intlOptions:{day:"2-digit",month:"2-digit",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}};
c=function(n){function w(a){a=n.call(this,a)||this;a._storedValue=null;a.arcade=null;a.editableFunction=null;a.id=I.generateUID().toString();a.requiredFunction=null;a.valueFunction=null;a.visibilityFunction=null;a.feature=null;a.field=null;a.fieldElement=null;a.layer=null;a.description=null;a.inputType=null;a.error=null;a.group=null;a.hint=null;a.messages=null;a.name=null;return a}x._inheritsLoose(w,n);var r=w.prototype;r.initialize=function(){this.handles.add(H.watch(()=>this.value,(a,b)=>{if(a!==
b){const {feature:g,name:f,value:k}=this;g.setAttribute(f,k)}}))};r._isDomainCompatible=function(a){const {field:b}=this;if("coded-value"===(null==a?void 0:a.type)){const g=typeof a.codedValues[0].code;if("string"===g&&m.isStringField(b)||"number"===g&&m.isNumericField(b))return!0}return"range"===(null==a?void 0:a.type)&&m.isNumericField(b)||m.isDateField(b)?!0:!1};r._validate=function(){const {domain:a,field:b,initialFeature:g,minLength:f,required:k,type:p,valid:t,value:h}=this,E=k&&null===h,L=void 0!==
t;return!E&&g.getAttribute(b.name)===h&&L?null:"text"===p&&-1<f&&"string"===typeof h&&h.length<f?v.TOO_SHORT:a?null!==h||k?u.validateDomainValue(a,h):null:E?m.TypeValidationError.INVALID_TYPE:m.validateFieldValue(b,h)};r._isVisibleByDefault=function(){var a;const b=null==(a=this.field)?void 0:a.type;return"oid"!==b&&"global-id"!==b&&!this._isGeometryField()};r._isEditorField=function(){return-1<m.getFeatureEditFields(this.layer).indexOf(this.name)};r._isGeometryField=function(){return-1<m.getFeatureGeometryFields(this.layer).indexOf(this.name)};
r._shouldUseValueExpression=function(){return this._layerFieldAllowsEdits&&!this._configAllowsEdits&&l.isSome(this.valueFunction)};r._toErrorMessage=function(){const {domain:a,field:b,messages:g,minLength:f,value:k,required:p,type:t}=this;var h=this.error;return p&&null===k?g.validationErrors.cannotBeNull:h===u.DomainValidationError.VALUE_OUT_OF_RANGE||h===m.NumericRangeValidationError.OUT_OF_RANGE?(h=u.getDomainRange(a)||m.getFieldRange(b),y.substitute(g.validationErrors.outsideRange,h,{format:{max:"date"===
t?D:z(h.max)?C:B,min:"date"===t?D:z(h.min)?C:B}})):h===u.DomainValidationError.INVALID_CODED_VALUE?g.validationErrors.invalidCodedValue:h===m.TypeValidationError.INVALID_TYPE?g.validationErrors.invalidType:h===v.TOO_SHORT?y.substitute(g.validationErrors.tooShort,{min:f}):null};x._createClass(w,[{key:"_configAllowsEdits",get:function(){var a,b,g;const {fieldElement:f,layer:k,name:p}=this;if(l.isSome(f))return!1!==f.editable;const t="subtype-group"!==(null==k?void 0:k.type)?null==k?void 0:null==(a=
k.popupTemplate)?void 0:null==(b=a.fieldInfos)?void 0:b.find(({fieldName:h})=>h===p):null;return null!=(g=null==t?void 0:t.isEditable)?g:!0}},{key:"_layerFieldAllowsEdits",get:function(){const {field:a,layer:b}=this;return(null==b?void 0:b.capabilities.operations.supportsEditing)&&(null==a?void 0:a.editable)}},{key:"isUsingValueExpression",get:function(){return this._shouldUseValueExpression()}},{key:"evaluatedEditableExpression",get:function(){const {editableFunction:a}=this;if(l.isNone(a))return null;
const {arcade:b}=this;return b.arcadeUtils.executeFunction(a,b.arcadeUtils.createExecContext(this.feature))}},{key:"evaluatedRequiredExpression",get:function(){const {requiredFunction:a}=this;if(l.isNone(a))return null;const {arcade:b}=this;return b.arcadeUtils.executeFunction(a,b.arcadeUtils.createExecContext(this.feature))}},{key:"evaluatedVisibilityExpression",get:function(){const {visibilityFunction:a}=this;if(l.isNone(a))return null;const {arcade:b}=this;return b.arcadeUtils.executeFunction(a,
b.arcadeUtils.createExecContext(this.feature))}},{key:"evaluatedValueExpression",get:function(){const {valueFunction:a}=this;if(l.isNone(a))return null;const {arcade:b}=this;return b.arcadeUtils.executeFunction(a,b.arcadeUtils.createExecContext(this.feature))}},{key:"initialFeature",set:function(a){this._set("initialFeature",a);this.notifyChange("valid")}},{key:"domain",get:function(){var a,{typeIdField:b}=this.layer;const g=b===this.name;var f=null==(a=this.field)?void 0:a.domain;if(g&&!f)return{layer:b}=
this,b="subtype-group"===b.type?b.sublayers.map(({subtypeCode:k,title:p})=>({id:k,name:p})):b.types.map(({id:k,name:p})=>({code:k,name:p})),new K({name:"__internal-type-based-coded-value-domain__",codedValues:b});({feature:a}=this);b=b&&this.layer.getFieldDomain(this.name,{feature:a})||f;f=l.get(this.fieldElement,"domain");return l.isSome(f)&&this._isDomainCompatible(f)?f:b}},{key:"editable",get:function(){var a;return this._layerFieldAllowsEdits?null!=(a=this.evaluatedEditableExpression)?a:this._configAllowsEdits:
!1}},{key:"errorMessage",get:function(){return this._toErrorMessage()}},{key:"includeTime",get:function(){var a,{fieldElement:b}=this;b=l.isSome(b)&&"datetime-picker"===(null==(a=b.input)?void 0:a.type)?b.input.includeTime:void 0;return void 0===b?!0:b}},{key:"label",get:function(){return l.isSome(this.fieldElement)&&this.fieldElement.label||this.field.alias||this.field.name}},{key:"maxLength",get:function(){if(this.type===q.Date)return-1;const {field:a,fieldElement:b}=this,g=null==a?void 0:a.length,
f=l.isSome(b)&&A(b.input)?b.input.maxLength:NaN;return!isNaN(f)&&-1<=f&&(-1===g||f<=g)?f:g}},{key:"minLength",get:function(){if(this.type===q.Date)return-1;const {field:a,fieldElement:b}=this,g=null==a?void 0:a.length,f=l.isSome(b)&&A(b.input)?b.input.minLength:NaN;return!isNaN(f)&&-1<=f&&(-1===g||f<=g)?f:-1}},{key:"required",get:function(){var a,b;return this.editable?!1===(null==(a=this.field)?void 0:a.nullable)?!0:null!=(b=this.evaluatedRequiredExpression)?b:!1:!1}},{key:"submittable",get:function(){const {field:a,
required:b,valid:g,value:f}=this;return g?!0:b&&l.isNone(f)?!1:this.initialFeature.getAttribute(a.name)===f}},{key:"type",get:function(){const {field:a}=this;return m.isNumericField(a)?q.Number:m.isStringField(a)?q.Text:m.isDateField(a)?q.Date:q.Unsupported}},{key:"valid",get:function(){const a=this.editable?this._validate():null;this._set("error",a);return null===a}},{key:"value",get:function(){return this._shouldUseValueExpression()?this.evaluatedValueExpression:this.get("_storedValue")},set:function(a){this.notifyChange("evaluatedVisibilityExpression");
this.set("_storedValue",a)}},{key:"visible",get:function(){if(this._isEditorField())return!1;if(l.isSome(this.fieldElement)){var a;return null!=(a=this.evaluatedVisibilityExpression)?a:!0}return this._isVisibleByDefault()}}]);return w}(G.HandleOwnerMixin(F));d.__decorate([e.property()],c.prototype,"_storedValue",void 0);d.__decorate([e.property()],c.prototype,"_configAllowsEdits",null);d.__decorate([e.property()],c.prototype,"_layerFieldAllowsEdits",null);d.__decorate([e.property()],c.prototype,"arcade",
void 0);d.__decorate([e.property()],c.prototype,"editableFunction",void 0);d.__decorate([e.property()],c.prototype,"requiredFunction",void 0);d.__decorate([e.property()],c.prototype,"valueFunction",void 0);d.__decorate([e.property()],c.prototype,"isUsingValueExpression",null);d.__decorate([e.property()],c.prototype,"visibilityFunction",void 0);d.__decorate([e.property()],c.prototype,"evaluatedEditableExpression",null);d.__decorate([e.property()],c.prototype,"evaluatedRequiredExpression",null);d.__decorate([e.property()],
c.prototype,"evaluatedVisibilityExpression",null);d.__decorate([e.property()],c.prototype,"evaluatedValueExpression",null);d.__decorate([e.property()],c.prototype,"feature",void 0);d.__decorate([e.property()],c.prototype,"field",void 0);d.__decorate([e.property()],c.prototype,"fieldElement",void 0);d.__decorate([e.property()],c.prototype,"initialFeature",null);d.__decorate([e.property()],c.prototype,"layer",void 0);d.__decorate([e.property({aliasOf:"fieldElement.description"})],c.prototype,"description",
void 0);d.__decorate([e.property()],c.prototype,"domain",null);d.__decorate([e.property()],c.prototype,"editable",null);d.__decorate([e.property({aliasOf:"fieldElement.input.type"})],c.prototype,"inputType",void 0);d.__decorate([e.property({readOnly:!0})],c.prototype,"error",void 0);d.__decorate([e.property({dependsOn:["error","messages","value"]})],c.prototype,"errorMessage",null);d.__decorate([e.property()],c.prototype,"group",void 0);d.__decorate([e.property({aliasOf:"fieldElement.hint"})],c.prototype,
"hint",void 0);d.__decorate([e.property()],c.prototype,"includeTime",null);d.__decorate([e.property()],c.prototype,"label",null);d.__decorate([e.property()],c.prototype,"maxLength",null);d.__decorate([e.property()],c.prototype,"minLength",null);d.__decorate([e.property()],c.prototype,"messages",void 0);d.__decorate([e.property({aliasOf:"field.name"})],c.prototype,"name",void 0);d.__decorate([e.property()],c.prototype,"required",null);d.__decorate([e.property()],c.prototype,"submittable",null);d.__decorate([e.property()],
c.prototype,"type",null);d.__decorate([e.property()],c.prototype,"valid",null);d.__decorate([e.property({value:null})],c.prototype,"value",null);d.__decorate([e.property()],c.prototype,"visible",null);return c=d.__decorate([J.subclass("esri.widgets.FeatureForm.InputField")],c)});