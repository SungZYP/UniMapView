// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../intl ../../core/events ../../core/Logger ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/aliasOf ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass ../Widget ./datePickerUtils ./DatePickerViewModel ./Popover ./decorators/accessibleHandler ./decorators/messageBundle ./jsxFactory ./widgetUtils ../../chunks/datetime ../../intl/date ../../intl/locale".split(" "),
function(u,k,h,v,J,K,B,L,T,U,V,q,M,N,w,C,O,x,P,g,n,p,m,y){const r={year:"numeric",month:"2-digit",day:"2-digit"},Q=" ;ArrowDown;ArrowLeft;ArrowRight;ArrowUp;End;Enter;Home;PageDown;PageUp".split(";"),R=J.getLogger("esri.widgets.support.DatePicker");h=function(D){function z(a,b){var c=D.call(this,a,b)||this;c._activeDate=null;c._calendarNode=null;c._calendarPopover=new O({owner:u._assertThisInitialized(c),placement:"bottom-start",anchorElement:()=>c._rootNode,renderContentFunction:c._renderCalendar});
c._inputOrButtonNode=null;c._isOpen=!1;c._requestDayPickerFocusOnCreate=!1;c._rootNode=null;c.dateInputEnabled=!1;c.label=void 0;c.messages=null;c.value=null;c.commitOnMonthChange=!1;c.viewModel=new C;c._toggle=c._toggle.bind(u._assertThisInitialized(c));return c}u._inheritsLoose(z,D);var e=z.prototype;e.initialize=function(){this.own(B.watch(()=>{var a;return{viewModel:this.viewModel,value:null==(a=this.viewModel)?void 0:a.value}},({viewModel:a,value:b})=>{if(!this.destroyed&&a&&!K.isNone(this.onChange))this.onChange(b)},
B.sync))};e.destroy=function(){this._calendarPopover.destroy()};e.render=function(){return g.tsx("div",{afterCreate:n.storeNode,bind:this,class:this.classes("esri-date-picker","esri-widget"),"data-node-ref":"_rootNode"},this.dateInputEnabled?this.renderInputAndButtonMode():this.renderButtonOnlyMode())};e.renderButtonOnlyMode=function(){const a=m.formatDate(this.viewModel.value,r),{_isOpen:b,messages:c}=this;return g.tsx("div",{afterCreate:n.storeNode,"aria-controls":b?this._getCalendarId():null,"aria-expanded":b.toString(),
"aria-haspopup":"true","aria-label":c.setDate,"aria-pressed":b.toString(),bind:this,class:this.classes("esri-widget--button","esri-select","esri-date-picker__calendar-toggle"),"data-node-ref":"_inputOrButtonNode",onclick:this._toggle,onkeydown:this._handleDateButtonKeyDown,role:"button",tabIndex:0},g.tsx("span",{class:"esri-date-picker__date"},a))};e.renderInputAndButtonMode=function(){const a=m.formatDate(this.viewModel.value,r),{_isOpen:b,messages:c}=this;return g.tsx("div",{class:this.classes("esri-date-picker__input")},
g.tsx("input",{afterCreate:n.storeNode,"data-node-ref":"_inputOrButtonNode","aria-controls":b?this._getCalendarId():null,"aria-haspopup":"true","aria-label":c.setDate,bind:this,class:this.classes("esri-date-picker__text-input","esri-input"),key:"date-input",onblur:this._handleDateInputBlur,onclick:this._handleDateInputClick,onkeydown:this._handleDateInputKeyDown,type:"text",value:a}),g.tsx("span",{"aria-hidden":"true",class:this.classes("esri-date-picker__icon--leading","esri-icon-calendar")}))};
e._handleDateInputClick=function(){this._open(this.viewModel.value,!1)};e._handleDateInputKeyDown=function(a){const {key:b}=a;this._isOpen?"Enter"===b?this._handleDateText(a):"Escape"===b&&this._close():"ArrowDown"===b&&(this._open(this.viewModel.value),a.preventDefault())};e._handleDateButtonKeyDown=function(a){const {key:b,shiftKey:c}=a;this._isOpen&&"Tab"===b&&c?this._close():n.isActivationKey(b)&&this._toggle()};e._handleDateInputBlur=function(a){this._isOpen||this._handleDateText(a)};e._handleDateText=
function(a){a=a.currentTarget;try{var b=w.parseDateIntoParts(a.value,r)}catch(c){R.warn(c);a.value=m.formatDate(this.viewModel.value,r);return}b=p.DateTime.fromObject(b);b.isValid?(this.viewModel.value=b.toJSDate(),this._activeDate=b):a.value=m.formatDate(this.viewModel.value,r)};e._handleDatePickerKeydown=function(a){"Escape"===v.eventKey(a)&&(this._close(),a.preventDefault(),a.stopPropagation())};e._renderCalendar=function(){const a=this._activeDate,b=p.DateTime.fromJSDate(this.viewModel.value);
return g.tsx("div",{afterCreate:n.storeNode,bind:this,class:this.classes("esri-date-picker__calendar","esri-widget"),"data-node-ref":"_calendarNode",id:this._getCalendarId(),key:"esri-date-picker__calendar",onkeydown:this._handleDatePickerKeydown},this._renderMonthPicker(a),this._renderDayPicker(a,b),this._renderYearPicker(a))};e._getCalendarId=function(){return`date-picker__calendar--${this.id}`};e._renderMonthPicker=function(a){var b=n.isRTL(this.container);const c=b?"esri-icon-right":"esri-icon-left";
b=b?"esri-icon-left":"esri-icon-right";const f=p.Info.months("long",{locale:y.getLocale()}).map((l,t)=>g.tsx("option",{selected:a.month-1===t,value:t.toString()},l)),{messages:d}=this;return g.tsx("div",{class:"esri-date-picker__month-picker"},g.tsx("div",{"aria-label":d.goToPreviousMonth,bind:this,class:"esri-widget--button",onclick:this._setPreviousMonth,onkeydown:this._handlePreviousMonthKeyDown,role:"button",tabIndex:0,title:d.goToPreviousMonth},g.tsx("span",{"aria-hidden":"true",class:c})),g.tsx("select",
{"aria-live":"assertive","aria-label":d.selectMonth,bind:this,class:this.classes("esri-date-picker__month-dropdown","esri-select"),id:`${this.id}__month-picker`,onchange:this._setMonth,onkeydown:this._setMonth,title:d.selectMonth},f),g.tsx("div",{"aria-label":d.goToNextMonth,bind:this,class:"esri-widget--button",onclick:this._setNextMonth,onkeydown:this._setNextMonth,role:"button",tabIndex:0,title:d.goToNextMonth},g.tsx("span",{"aria-hidden":"true",class:b})))};e._renderDayPicker=function(a,b){const c=
this._getWeekLabels(),f=this._getDayId(a);a=this._renderMonth(a,b);return g.tsx("div",{afterCreate:this._handleDayPickerCreate,"aria-activedescendant":f,"aria-labelledby":`${this.id}__month-picker ${this.id}__selected-year`,bind:this,class:"esri-date-picker__day-picker",id:`${this.id}__day-picker`,onkeydown:this._handleDayPickerKeydown,role:"grid",tabIndex:0},g.tsx("div",{class:"esri-date-picker__week-item",role:"row"},c.map(d=>g.tsx("div",{"aria-label":d.name,class:this.classes("esri-date-picker__day-item",
"esri-date-picker__day-item--header"),role:"columnheader",title:d.name},d.abbr))),a)};e._getDayId=function(a){return`${this.id}__${m.formatDate(a.valueOf(),r)}`};e._handleDayPickerCreate=function(a){this._requestDayPickerFocusOnCreate&&(this._requestDayPickerFocusOnCreate=!1,a.focus())};e._getWeekLabels=function(){const a=[],b={weekday:"long"},c={weekday:"narrow"};let f=p.DateTime.now().set({weekday:w.getFirstDayOfWeek(y.getLocale())});for(let d=0;7>d;d++)a.push({name:m.formatDate(f.valueOf(),b),
abbr:m.formatDate(f.valueOf(),c)}),f=f.plus({day:1});return a};e._handleDayPickerKeydown=function(a){const {ctrlKey:b,shiftKey:c}=a,f=v.eventKey(a);if(-1!==Q.indexOf(f)){var d=this._activeDate;"ArrowLeft"===f?d=d.minus({day:1}):"ArrowRight"===f?d=d.plus({day:1}):"ArrowUp"===f?d=d.minus({week:1}):"ArrowDown"===f?d=d.plus({week:1}):"PageUp"===f?d=d.minus({[c?"year":"month"]:1}):"PageDown"===f?d=d.plus({[c?"year":"month"]:1}):"Home"===f?d=d.startOf(b?"year":"month"):"End"===f?d=d.endOf(b?"year":"month"):
n.isActivationKey(f)&&(this.viewModel.value=d.toJSDate(),this._close());this._activeDate=d;a.preventDefault();a.stopPropagation()}};e._renderMonth=function(a,b){const c=p.DateTime.now(),f=a.startOf("month"),d=a.endOf("month");let l=f.minus({day:w.getLocaleDayOfWeek(y.getLocale(),f.weekday)});const t=[];for(let E=0;6>E;E++){const F=[];for(let G=0;7>G;G++){const H=l.day,I=l.hasSame(a,"day");var A=l.hasSame(b,"day");const S=this._getDayId(l);A={["esri-date-picker__day-item--nearby-month"]:!p.Interval.fromDateTimes(f,
d).contains(l),["esri-date-picker__day-item--today"]:l.hasSame(c,"day"),["esri-date-picker__day-item--active"]:I,["esri-date-picker__day-item--selected"]:A};F.push(g.tsx("div",{"aria-label":H.toString(),"aria-selected":I.toString(),bind:this,class:this.classes("esri-date-picker__day-item",A),"data-iso-date":l.toISO(),id:S,onclick:this._handleSelectedDate,onkeydown:this._handleSelectedDate,role:"gridcell"},H));l=l.plus({day:1})}t.push(g.tsx("div",{class:"esri-date-picker__week-item",role:"row"},F))}return t};
e._renderYearPicker=function(a){var b={year:"numeric"};const c=m.formatDate(a.valueOf(),b),f=m.formatDate(a.plus({year:1}).valueOf(),b);a=m.formatDate(a.minus({year:1}).valueOf(),b);({messages:b}=this);return g.tsx("div",{class:"esri-date-picker__year-picker"},g.tsx("div",{"aria-label":b.goToPreviousYear,bind:this,class:"esri-date-picker__year-picker-item",onclick:this._setPreviousYear,onkeydown:this._setPreviousYear,tabIndex:0,title:b.goToPreviousYear},a),g.tsx("div",{class:this.classes("esri-date-picker__year-picker-item",
"esri-date-picker__year-picker-item--selected"),id:`${this.id}__selected-year`},c),g.tsx("div",{"aria-label":b.goToNextYear,bind:this,class:"esri-date-picker__year-picker-item",onclick:this._setNextYear,onkeydown:this._handleNextYearKeyDown,tabIndex:0,title:b.goToNextYear},f))};e._toggle=function(){this._isOpen?this._close():this._open(this.viewModel.value)};e._setMonth=function(a){this._activeDate=this._activeDate.set({month:Number(a.target.value)+1});this.commitOnMonthChange&&(this.viewModel.value=
this._activeDate.toJSDate())};e._close=function(a=!0){this._activeDate=null;this._isOpen=!1;this._calendarPopover.open=!1;this.pageClickHandler.pause();a&&this._inputOrButtonNode.focus()};e._open=function(a,b=!0){this._activeDate=p.DateTime.fromJSDate(a);this._isOpen=!0;this._calendarPopover.open=!0;this._requestDayPickerFocusOnCreate=b;this.pageClickHandler||(this.pageClickHandler=v.pausable(document,"click",({target:c})=>{var f,d;(null==(f=this._calendarNode)?0:f.contains(c))||(null==(d=this._rootNode)?
0:d.contains(c))||this._close()}),this.own(this.pageClickHandler));this.pageClickHandler.resume()};e._setPreviousMonth=function(){this._activeDate=this._activeDate.minus({month:1});this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toJSDate())};e._handlePreviousMonthKeyDown=function(a){"Tab"===a.key&&a.shiftKey?(a.preventDefault(),this._close()):n.isActivationKey(a.key)&&this._setPreviousMonth()};e._setNextMonth=function(){this._activeDate=this._activeDate.plus({month:1});this.commitOnMonthChange&&
(this.viewModel.value=this._activeDate.toJSDate())};e._setPreviousYear=function(){this._activeDate=this._activeDate.minus({year:1})};e._setNextYear=function(){this._activeDate=this._activeDate.plus({year:1})};e._handleNextYearKeyDown=function(a){"Tab"!==a.key||a.shiftKey?n.isActivationKey(a.key)&&this._setNextYear():(a.preventDefault(),this._close())};e._handleSelectedDate=function(a){this.viewModel.value=p.DateTime.fromISO(a.target.getAttribute("data-iso-date")).toJSDate();this._close()};return z}(N);
k.__decorate([q.property()],h.prototype,"dateInputEnabled",void 0);k.__decorate([q.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],h.prototype,"label",void 0);k.__decorate([q.property(),P.messageBundle("esri/widgets/support/t9n/DatePicker")],h.prototype,"messages",void 0);k.__decorate([L.aliasOf("viewModel.value")],h.prototype,"value",void 0);k.__decorate([q.property()],h.prototype,"commitOnMonthChange",void 0);k.__decorate([q.property({type:C})],h.prototype,"viewModel",void 0);
k.__decorate([q.property()],h.prototype,"onChange",void 0);k.__decorate([x.accessibleHandler()],h.prototype,"_setNextMonth",null);k.__decorate([x.accessibleHandler()],h.prototype,"_setPreviousYear",null);k.__decorate([x.accessibleHandler()],h.prototype,"_handleSelectedDate",null);return h=k.__decorate([M.subclass("esri.widgets.support.DatePicker")],h)});