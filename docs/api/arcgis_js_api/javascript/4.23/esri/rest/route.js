// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("exports ../chunks/_rollupPluginBabelHelpers ../request ../core/maybe ../core/queryUtils ../geometry/support/normalizeUtils ./networkService ./utils ./support/RouteSolveResult".split(" "),function(D,G,H,E,I,J,r,K,L){function y(e){return"esri.rest.support.FeatureSet"===(null==e?void 0:e.declaredClass)}function z(){z=G._asyncToGenerator(function*(e,f,m){var p=[],n=[],d={};const a={},t=K.parseUrl(e);({path:e}=t);y(f.stops)&&r.collectGeometries(f.stops.features,n,"stops.features",d);y(f.pointBarriers)&&
r.collectGeometries(f.pointBarriers.features,n,"pointBarriers.features",d);y(f.polylineBarriers)&&r.collectGeometries(f.polylineBarriers.features,n,"polylineBarriers.features",d);y(f.polygonBarriers)&&r.collectGeometries(f.polygonBarriers.features,n,"polygonBarriers.features",d);n=yield J.normalizeCentralMeridian(n);for(const k in d){const u=d[k];p.push(k);a[k]=n.slice(u[0],u[1])}if(r.isInputGeometryZAware(a,p)){d=null;try{d=yield r.fetchServiceDescription(e,f.apiKey,m)}catch{}d&&!d.hasZ&&r.dropZValuesOffInputGeometry(a,
p)}for(const k in a)a[k].forEach((u,x)=>{f.get(k)[x].geometry=u});m={...m,query:{...t.query,...M.toQueryParams(f),f:"json"}};p=e.endsWith("/solve")?e:`${e}/solve`;({data:m}=yield H(p,m));return N(m)});return z.apply(this,arguments)}function N(e){var f,m,p,n,d;const a=new Map,{directionLines:t,directionPoints:k,directions:u,routes:x,stops:q,barriers:A,polygonBarriers:B,polylineBarriers:C,messages:O}=e,F=null!=(f=null!=(m=null!=(p=null!=(n=null==x?void 0:x.spatialReference)?n:null==q?void 0:q.spatialReference)?
p:null==A?void 0:A.spatialReference)?m:null==B?void 0:B.spatialReference)?f:null==C?void 0:C.spatialReference;null==x?void 0:x.features.forEach(b=>{const c=b.attributes.Name,h=b.attributes.ObjectID;a.has(c)?(a.get(c).route=b,a.get(c).routeId=h):a.set(c,{route:b,routeId:h,routeName:c});E.isSome(b.geometry)&&(b.geometry.spatialReference=F)});null==u?void 0:u.forEach(b=>{const c=b.routeName;a.has(c)?a.get(c).directions=b:a.set(c,{routeName:c,directions:b})});null==q?void 0:q.features.forEach(b=>{var c;
const h=null!=(c=b.attributes.RouteName)?c:null;a.has(h)?a.get(h).stops?a.get(h).stops.push(b):a.get(h).stops=[b]:a.set(h,{stops:[b],routeName:h});E.isSome(b.geometry)&&(b.geometry.spatialReference=F)});e=null!=(d=null==q?void 0:q.features.every(b=>null==b.attributes.RouteName))?d:!0;0<(null==q?void 0:q.features.length)&&e&&(d=Array.from(a.keys())[0],a.get(d).stops=a.get(null).stops,a.delete(null));null==t?void 0:t.features.forEach(b=>{var c;const h=b.attributes.RouteID,g=null==(c=Array.from(a.values()).find(l=>
l.routeId===h))?void 0:c.routeName;if(g)if(a.has(g))if(a.get(g).directionLines)a.get(g).directionLines.features.push(b);else{const {fieldAliases:l,geometryType:v,spatialReference:w}=t;a.get(g).directionLines={features:[b],fieldAliases:l,geometryType:v,spatialReference:w}}else{const {fieldAliases:l,geometryType:v,spatialReference:w}=t;a.set(g,{routeName:g,directionLines:{features:[b],fieldAliases:l,geometryType:v,spatialReference:w}})}});null==k?void 0:k.features.forEach(b=>{var c;const h=b.attributes.RouteID,
g=null==(c=Array.from(a.values()).find(l=>l.routeId===h))?void 0:c.routeName;if(g)if(a.has(g))if(a.get(g).directionPoints)a.get(g).directionPoints.features.push(b);else{const {fieldAliases:l,geometryType:v,spatialReference:w}=k;a.get(g).directionPoints={features:[b],fieldAliases:l,geometryType:v,spatialReference:w}}else{const {fieldAliases:l,geometryType:v,spatialReference:w}=k;a.set(g,{routeName:g,directionPoints:{features:[b],fieldAliases:l,geometryType:v,spatialReference:w}})}});d=Array.from(a.values());
return L.fromJSON({routeResults:d,barriers:A,polygonBarriers:B,polylineBarriers:C,messages:O})}const M=I.createQueryParamsHelper({accumulateAttributes:{name:"accumulateAttributeNames"},attributeParameterValues:!0,directionsTimeAttribute:{name:"directionsTimeAttributeName"},impedanceAttribute:{name:"impedanceAttributeName"},outSpatialReference:{name:"outSR",getter:e=>e.outSpatialReference.wkid},pointBarriers:{name:"barriers"},polylineBarriers:!0,polygonBarriers:!0,restrictionAttributes:{name:"restrictionAttributeNames"},
stops:!0,travelMode:!0});D.solve=function(e,f,m){return z.apply(this,arguments)};Object.defineProperty(D,"__esModule",{value:!0})});