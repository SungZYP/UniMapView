// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../core/Error ../../core/maybe ./support/utils ../support/utils ../support/adapters/support/layerUtils".split(" "),function(w,r,x,y,z,f){function A(a){return t.apply(this,arguments)}function t(){t=w._asyncToGenerator(function*(a){if(!(a&&a.layer&&a.attributes))throw new r("summary-statistics-for-attributes:missing-parameters","'layer' and 'attributes' parameters are required");if(a.attributes.some(p=>!!p.valueExpression)&&!a.view)throw new r("summary-statistics-for-attributes:missing-parameters",
"View is required when 'valueExpression' is specified in attributes");var b=[f.LayerType.CSVLayer,f.LayerType.FeatureLayer,f.LayerType.OGCFeatureLayer,f.LayerType.GeoJSONLayer,f.LayerType.WFSLayer];const {layer:c,...k}=a,e=f.createLayerAdapter(c,b);a={layerAdapter:e,...k};a.includeZeros=null==a.includeZeros||a.includeZeros;a.includeNegatives=null==a.includeNegatives||a.includeNegatives;if(!e)throw new r("summary-statistics-for-attributes:invalid-parameters","'layer' must be one of these types: "+
f.getLayerTypeLabels(b).join(", "));b=a.view;var l=x.isSome(a.signal)?{signal:a.signal}:null;yield Promise.all([b&&b.when(),e.load(l)]);b=[];for(var g of a.attributes)l=yield z.getFieldsList({field:g.field,valueExpression:g.valueExpression}),Array.prototype.push.apply(b,l);if(g=y.verifyBasicFieldValidity(e,b,"summary-statistics-for-attributes:invalid-parameters"))throw g;return a});return t.apply(this,arguments)}function B(a,b,c){const k=[],e=[],l=[],g=[],p=[];a.forEach((m,d)=>{const n=m.field?"field":
"expression",u=m.field||m.valueExpression;m.field?(p.push(u),e.push(`var ${n}${d} = Number($feature["${u}"]);`)):(k.push(`function getValueForExpr${d}() {\n  ${u} \n}`),e.push(`var ${n}${d} = Number(getValueForExpr${d}());`));c||l.push(`${n}${d} = IIf(${n}${d} < 0, 0, ${n}${d});`);g.push(`${n}${d}`)});a="return sum;";const h=k.length?null:p.reduce((m,d)=>`${m} + ${d}`);let q=null;b||c?b?c||(a="return IIf(sum \x3e\x3d 0, sum, null);",h&&(q=`(( ${h} ) >= 0)`)):(a="return IIf(sum !\x3d 0, sum, null);",
h&&(q=`(( ${h} ) <> 0)`)):(a="return IIf(sum \x3e 0, sum, null);",h&&(q=`(( ${h} ) > 0)`));return{valueExpression:[k.length?k.join("\n"):"",e.join("\n"),l.join("\n"),`var sum = ${g.join(" + ")};`,a].filter(Boolean).join("\n\n"),sqlExpression:h,sqlWhere:q}}function v(){v=w._asyncToGenerator(function*(a){const {layerAdapter:b,...c}=yield A(a);a=B(c.attributes,c.includeZeros,c.includeNegatives);return b.summaryStatistics({valueExpression:a.valueExpression,sqlExpression:a.sqlExpression,sqlWhere:a.sqlWhere,
view:c.view,signal:c.signal})});return v.apply(this,arguments)}return function(a){return v.apply(this,arguments)}});